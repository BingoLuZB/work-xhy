var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__decorate=this&&this.__decorate||function(t,e,i,s){var n,o=arguments.length,a=3>o?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(3>o?n(a):o>3?n(e,i,a):n(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,o){function a(t){try{l(s.next(t))}catch(e){o(e)}}function r(t){try{l(s["throw"](t))}catch(e){o(e)}}function l(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(a,r)}l((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(s){i=[6,s],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,a,r,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},ActivityType55Data=function(t){function e(e,i,s,n){var o=t.call(this,e)||this;o.list=[],o.update(e),o.id=i;var a=GlobalConfig.ActivityConfig[i];return a?(o.pageStyle=a.pageStyle,o.activityType=ActivityType.Normal):GlobalConfig.PActivityConfig[i]&&(o.pageStyle=GlobalConfig.PActivityConfig[i].pageStyle,o.activityType=ActivityType.Personal),o.startTime=s,o.endTime=n,o.showOpen(),o}return __extends(e,t),e.prototype.update=function(t){this.list=[];for(var e=t.readShort(),i=0;e>i;i++){var s={index:t.readInt(),state:t.readShort()};this.list.push(s)}},e.prototype.showOpen=function(){var t=this;if(this.isOpenActivity()&&!LocationProperty.isIosTS&&!LocationProperty.isTSServer){var e=GlobalConfig.ActivityType55Config[this.id];this.activityType==ActivityType.Personal&&(e=GlobalConfig.PActivityType55Config[this.id]);for(var i in this.list)this.pageStyle==ActivityPageStyle.LIMITEDGIFT&&OpenSystem.ins().checkSysOpen(SystemType.LIMITEDGIFT)&&!ViewManager.ins().isShow(LimitedGiftWin)&&this.list[i].state<e[this.list[i].index].buyTimes&&LimitedGiftRule.ids.indexOf(this.id)<0&&(LimitedGiftRule.ids.push(this.id),Timer.start(1500,1,function(){ViewManager.ins().open(LimitedGiftWin,t.id)},this)),this.pageStyle==ActivityPageStyle.PActivity55&&OpenSystem.ins().checkSysOpen(SystemType.PActivity55)&&!ViewManager.ins().isShow(LimitedGiftWin2)&&this.list[i].state<e[this.list[i].index].buyTimes&&LimitedGiftRule.ids.indexOf(this.id)<0&&(LimitedGiftRule.ids.push(this.id),Timer.start(1500,1,function(){ViewManager.ins().open(LimitedGiftWin2,t.id)},this))}},e.prototype.postRewardResult=function(t){},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.canReward=function(){return!1},__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType55Data.prototype,"ActivityType55Data"),window.ActivityType55Data=ActivityType55Data;var ActivityType57Data=function(t){function e(e,i,s){void 0===s&&(s=ActivityType.Normal);var n=t.call(this,e)||this;return n.bossData=[],n.rewardData=[],n.actId=i,n.update(e),n}return __extends(e,t),e.prototype.update=function(t){this.bossData=[],this.rewardData=[];var e=GlobalConfig.ActivityType57Config[this.actId],i=GlobalConfig.ActivityBaseConfig.Type57Tab;for(var s in i)this.bossData[+s]=[],this.rewardData[+s]=[];for(var n=t.readShort(),o=0;n>o;o++){var a=t.readShort(),r=e[a],l={index:a,playerId:t.readInt(),player:t.readString()};this.bossData[r.groupType].push(l)}for(var h=t.readShort(),p=0;h>p;p++){var a=t.readShort(),r=e[a],l={index:a,belong:t.readByte(),all:t.readByte(),person:t.readByte()};this.rewardData[r.groupType].push(l)}},e.prototype.canReward=function(){for(var t in this.rewardData)if(this.checkTypeAward(+t))return!0;return!1},e.prototype.checkTypeAward=function(t){for(var e in this.rewardData[t])if(this.checkAward(t,+e))return!0;return!1},e.prototype.checkAward=function(t,e){var i=GlobalConfig.ActivityType57Config[this.actId][this.bossData[t][e].index];return ZsCT.ins().lv>=i.zsLevel&&Actor.level>=i.level&&(1==this.rewardData[t][e].belong||1==this.rewardData[t][e].person)||1==this.rewardData[t][e].all},e.prototype.checkGetAward=function(t,e){return 2==this.rewardData[t][e].belong&&2==this.rewardData[t][e].all&&2==this.rewardData[t][e].person},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType57Data.prototype,"ActivityType57Data"),window.ActivityType57Data=ActivityType57Data;var BeastSelectItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareAnimalSelectItemSkin",e.mc=new MovieClip,e.eEff.addChild(e.mc),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0];this.eRed.visible=this.data[1]||!1,this.eBg.source="RareQuality"+t.quality,this.eIcon.source="RareLittle_"+t.id,this.eNature.source="nature_"+t.wx,this.eQuality.source=BeastCT.getQualityRes(t.quality);var e=BeastCT.ins().getBeastInfoById(t.id);this.sTips=e&&e.stage>0?e.stage+"阶"+e.lv+"级":"未激活",this.eGrayGroup.filters=e&&e.stage>0?null:FilterUtil.ARRAY_GRAY_FILTER,e&&e.stage>0?this.mc.playFile(RES_DIR_EFF+("rareQuality"+t.quality),-1):(this.mc.stop(),this.mc.visible=!1)}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(BeastSelectItemRenderer.prototype,"BeastSelectItemRenderer"),window.BeastSelectItemRenderer=BeastSelectItemRenderer;var ComActivityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.systemId=SystemType.ACTIVITY,s.hasPAct=!1,s.actList=[],s.actID=0,s.showMessage=[ZsCT.ins().postZsData,Actor.ins().postLevelChange,GameApp.ins().postZeroInit,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[Actor.ins().postYbChange,GameApp.ins().postZeroInit,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards,BagCT.ins().postItemAdd,BagCT.ins().postItemChange,BagCT.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(this.systemId))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;if(this.hasPAct){this.actList=[];for(var i in t){var s=t[i];if(s.pageStyle==this.pageStyle&&s.isOpenActivity()){var n=GlobalConfig.ActivityType55Config[s.id],o=s;for(var a in o.list)n[o.list[a].index]&&o.list[a].state<n[o.list[a].index].buyTimes&&this.actList.push(o.endTime)}}if(t=PActivity.ins().activityData,e=Object.keys(t),!e.length)return!1;for(var r in t){var s=t[r];if(s.pageStyle==this.pageStyle&&s.isOpenActivity()){var n=GlobalConfig.PActivityType55Config[s.id],o=s;for(var a in o.list)n[o.list[a].index]&&o.list[a].state<n[o.list[a].index].buyTimes&&this.actList.push(o.endTime)}}return this.actList.length>0}for(var i in t){var s=t[i];if(s.pageStyle==this.pageStyle&&s.isOpenActivity()&&!s.getHide())return this.actID=+i,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==this.pageStyle&&i.isOpenActivity()&&i.canReward())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().openBySkin(ComActivityWin,"ActivityWinSkin",this.pageStyle),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ComActivityIconRule.prototype,"ComActivityIconRule"),window.ComActivityIconRule=ComActivityIconRule;var LegendTowerCT=function(t){function e(){var e=t.call(this)||this;return e.score=0,e.soulNum=0,e.openType=open_Status.None,e.periodType=period_Status.None,e.legendInfos=[],e.myRank=0,e.myScore=0,e.dieNum=0,e.rewards=1,e.sumDieNum=0,e.buffData=[],e.sysId=PackageID.LegendTower,e.regNetMsg(1,e.postInit),e.regNetMsg(2,e.postEnroll),e.regNetMsg(5,e.postSoulNum),e.regNetMsg(6,e.postScore),e.regNetMsg(7,e.postRank),e.regNetMsg(8,e.postPeriod),e.regNetMsg(9,e.postLayer),e.regNetMsg(11,e.postAwardRecord),e.regNetMsg(12,e.postElert),e.regNetMsg(14,e.postHandle),e.regNetMsg(15,e.postResult),e.regNetMsg(16,e.postDieNum),e.regNetMsg(17,e.postSumDieNum),e.regNetMsg(18,e.postUpdateFlag),e.regNetMsg(19,e.postFlag),e.regNetMsg(20,e.postBuffTips),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.openType=t.readByte();var e=DateUtils.formatMiniDateTime(t.readInt()),i=GlobalConfig.LegendTowerBaseConfig.openTimePoint[0],s=i[0]*DateUtils.SECOND_PER_HOUR*1e3+i[1]*DateUtils.MS_PER_MINUTE+i[2];this.openTime=e+DateUtils.MS_PER_DAY+s,i=GlobalConfig.LegendTowerBaseConfig.openTimePoint[1],s=i[0]*DateUtils.SECOND_PER_HOUR*1e3+i[1]*DateUtils.MS_PER_MINUTE+i[2],this.endTime=e+DateUtils.MS_PER_DAY+s,this.actTime=DateUtils.formatMiniDateTime(t.readInt()),this.isEnroll=t.readByte(),this.periodType=t.readByte(),this.layer=t.readByte(),this.score=t.readInt()},e.prototype.postEnroll=function(t){var e=t.readBoolean();e&&(this.isEnroll=1)},e.prototype.postSoulNum=function(t){this.soulNum=t.readInt()},e.prototype.postScore=function(t){this.score=t.readInt()},e.prototype.postRank=function(t){this.legendInfos=[],this.isTop=t.readBoolean();for(var e=t.readShort(),i=0;e>i;i++){var s={rank:i+1,name:t.readString(),guildName:t.readString(),score:t.readInt(),serverId:t.readInt(),actorId:t.readInt()};this.legendInfos.push(s),this.score=s.score,s.actorId==Actor.actorID&&(this.myRank=s.rank,this.myScore=s.score)}},e.prototype.postPeriod=function(t){this.periodType=t.readByte();t.readInt()},e.prototype.postLayer=function(t){this.layer=t.readByte()},e.prototype.postAwardRecord=function(t){var e,i=t.readInt();for(var s in GlobalConfig.LegendTowerCreditRewardConfig)e=parseInt(s);return this.rewards<=e&&1==(i>>this.rewards&1)&&(this.rewards+=1),this.rewards},e.prototype.postElert=function(t){var e=t.readString(),i=DateUtils.formatMiniDateTime(t.readInt()),s=Math.floor((i-GameServer.serverTime)/1e3);this.layer=t.readByte(),s>0&&ViewManager.ins().open(KFBossReliveWin,s,e)},e.prototype.postHandle=function(t){var e=t.readByte();if(e==this.layer){this.handle=t.readDouble();var i=EntityManager.ins().getEntityBymasterhHandle(this.handle);i&&(this.winner=i.infoModel.name)}},e.prototype.postResult=function(t){for(var e=t.readString(),i=t.readShort(),s=[],n=0;i>n;n++){var o={type:t.readByte(),id:t.readInt(),count:t.readInt()};s.push(o)}ResultManager.ins().create(FbCT.FB_TYPE_Legend,s,1,e)},e.prototype.postDieNum=function(t){var e=t.readByte();e==this.layer&&(this.dieNum=t.readShort())},e.prototype.postSumDieNum=function(t){var e=t.readByte();e==this.layer&&(this.sumDieNum=t.readShort())},e.prototype.postUpdateFlag=function(t){var e=t.readDouble(),i=t.readDouble(),s=DateUtils.formatMiniDateTime(t.readInt()),n=!0,o=this.checkNum(e);if((o||0==o)&&(n=!1,this.buffData[o].belongHandle=i,i&&(this.buffData[o].times=Math.floor((s-GameServer.serverTime)/1e3))),n){var a=Math.floor((s-GameServer.serverTime)/1e3),r={buffHandle:e,belongHandle:i,times:0>a?0:a};this.buffData.push(r)}return this.attackHandle==e},e.prototype.postFlag=function(t){var e=t.readByte();if(this.buffData=[],e==this.layer)for(var i=t.readShort(),s=0;i>s;s++){var n={buffHandle:t.readDouble(),belongHandle:t.readDouble(),times:0};if(this.buffData.push(n),this.buffData[s].belongHandle){var o=DateUtils.formatMiniDateTime(t.readInt());this.buffData[s].times=Math.floor((o-GameServer.serverTime)/1e3)}}},e.prototype.postBuffTips=function(t){var e=t.readInt();TipsCT.ins().showTips(""+GlobalConfig.LegendTowerCollectConfig[e].desc)},e.prototype.sendUpStage=function(){this.sendBaseProto(2)},e.prototype.sendEnter=function(){this.sendBaseProto(3)},e.prototype.sendRankInfo=function(){this.sendBaseProto(7)},e.prototype.sendAward=function(t){var e=this.getBytes(11);e.writeByte(t),this.sendToServer(e)},e.prototype.sendCancel=function(t){var e=this.getBytes(21);e.writeByte(t),this.sendToServer(e)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e="";return ZsCT.ins().lv<GlobalConfig.LegendTowerBaseConfig.zslv&&(e=GlobalConfig.LegendTowerBaseConfig.zslv+"转开启"),GameServer.serverOpenDay<GlobalConfig.LegendTowerBaseConfig.openserverday-1&&(e="开服第"+GlobalConfig.LegendTowerBaseConfig.openserverday+"天开启"),t&&""!=e&&TipsCT.ins().showTips(e),""==e},e.prototype.checkNum=function(t){for(var e=this.buffData.length,i=0;e>i;i++)if(t==this.buffData[i].buffHandle)return i},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postEnroll",null),__decorate([post()],e.prototype,"postSoulNum",null),__decorate([post()],e.prototype,"postScore",null),__decorate([post()],e.prototype,"postRank",null),__decorate([post()],e.prototype,"postPeriod",null),__decorate([post()],e.prototype,"postLayer",null),__decorate([post()],e.prototype,"postAwardRecord",null),__decorate([post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postHandle",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postDieNum",null),__decorate([post()],e.prototype,"postSumDieNum",null),__decorate([post()],e.prototype,"postUpdateFlag",null),__decorate([post()],e.prototype,"postFlag",null),__decorate([post()],e.prototype,"postBuffTips",null),e}(BaseSystem);__reflect(LegendTowerCT.prototype,"LegendTowerCT");var open_Status;!function(t){t[t.None=0]="None",t[t.Open=1]="Open",t[t.Over=2]="Over"}(open_Status||(open_Status={}));var period_Status;!function(t){t[t.None=0]="None",t[t.SignUp=1]="SignUp",t[t.SignEnd=2]="SignEnd",t[t.OnGoing=3]="OnGoing",t[t.Over=4]="Over"}(period_Status||(period_Status={})),System.LegendTowerCT=function(){return LegendTowerCT.ins()},window.LegendTowerCT=LegendTowerCT,window.open_Status=open_Status,window.period_Status=period_Status;var ActivityType49Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.dressId=t.readInt(),this.buyRecord=t.readInt(),this.hasRecharge=t.readInt()},Object.defineProperty(e.prototype,"hasPay",{get:function(){return this.dressId>0?GlobalConfig.ActivityType49Config[this.id][this.dressId].price:0},enumerable:!0,configurable:!0}),e.prototype.hasBuyById=function(t){return 1==(this.buyRecord>>t&1)},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e}(ActivityBaseData);__reflect(ActivityType49Data.prototype,"ActivityType49Data"),window.ActivityType49Data=ActivityType49Data;var ActivityType51Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.tips=[];for(var e=t.readShort(),i=0;e>i;i++){t.readString(),t.readInt()}},e.prototype.addTips=function(t){this.tips||(this.tips=[]);var e=t.readString(),i=t.readInt();e==Actor.myName&&i&&ShowImgCT.ins().showImg(),this.tips.unshift("|C:0x16b2ff&T:"+e+"|回收装备获得了|C:0xFFFF00&T:"+i+"元宝|！"),this.tips.length=Math.min(2,this.tips.length);var s=ViewManager.ins().open(AddYBWin,this);return s.updateTips(),this.tips},e.prototype.isOpenActivity=function(){return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType51Data.prototype,"ActivityType51Data"),window.ActivityType51Data=ActivityType51Data;var ActivityType52Data=function(t){function e(e){var i=t.call(this,e)||this;return i.indexsEx=[],i.itemList=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.hasLottery=t.readInt(),this.totoYb=t.readInt();for(var e=t.readInt(),i=0;e>i;i++)this.addTips(t)},e.prototype.postRewardResult=function(t){t.readUnsignedShort();this.hasLottery=t.readUnsignedShort(),this.totoYb=t.readInt();var e=t.readByte();this.indexs=[];for(var i=0;e>i;i++)this.indexs.push(t.readUnsignedShort());this.indexs.length&&(this.indexsEx=this.indexs),this.itemList=[],e=t.readUnsignedShort();for(var i=0;e>i;i++){var s=t.readInt(),n=t.readInt();this.itemList.push({type:1,id:s,count:n})}return this.id},e.prototype.addTips=function(t){this.tips||(this.tips=[]);var e=t.readInt(),i=t.readString(),s=t.readInt(),n=t.readInt();if(0==n){var o=GlobalConfig.ActivityType52Config[e][s];n=o.showReward.id}var a=t.readInt(),r=GlobalConfig.ItemConfig[n],l=ItemUtil.getQualityColor(r),h=i+"获得:|C:"+l+"&T:"+r.name+"|"+(-1==a?"":"，获得|C:"+l+"&T:"+a+"元宝|");this.tips.unshift(h),this.tips.length=Math.min(50,this.tips.length)},e.prototype.addTips2=function(t){this.totoYb=t.readInt(),this.tips||(this.tips=[]);var e=t.readString(),i=t.readInt(),s=t.readInt();if(0==s){var n=GlobalConfig.ActivityType52Config[this.id][i];s=n.showReward.id}var o=t.readInt(),a=GlobalConfig.ItemConfig[s],r=ItemUtil.getQualityColor(a),l=e+"获得:|C:"+r+"&T:"+a.name+"|"+(-1==o?"":"，获得|C:"+r+"&T:"+o+"元宝|");this.tips.unshift(l),this.tips.length=Math.min(50,this.tips.length)},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getRollSum=function(t){var e=GlobalConfig.ActivityType52Config[t];if(e&&e[0]){var i=BagCT.ins().getBagItemById(e[0].item);if(i)return!0}return!1},e.prototype.getIsRollTen=function(t){var e=GlobalConfig.ActivityType52Config[t][0];if(!e)return!1;var i=0;if(e.item){var s=BagCT.ins().getBagItemById(e.item);if(s&&(i+=s.count),i>=10)return!0}return i=10-i,e.yb&&Actor.yb>=e.yb*i?!0:void 0},__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType52Data.prototype,"ActivityType52Data"),window.ActivityType52Data=ActivityType52Data;var ActivityType54Data=function(t){function e(e,i){var s=t.call(this,e)||this;return s.bossLevel=1,s.itemList=[],s.update(e),s.actId=i,s}return __extends(e,t),e.prototype.update=function(t){this.bossHp=t.readUnsignedInt(),this.bossLevel=t.readUnsignedInt()},e.prototype.postRewardResult=function(t){var e=(t.readShort(),this.bossLevel);this.bossLevel=t.readUnsignedInt(),this.isDie=e!=this.bossLevel,this.bossHp=t.readUnsignedInt();var i=t.readInt();this.itemList=[];for(var s=0;i>s;s++){var n=t.readInt(),o=t.readInt(),a=t.readInt();this.itemList.push({type:n,id:o,count:a})}this.canFly=this.itemList.length>0},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType54_1Config[this.actId];for(var e in t){var i=GlobalConfig.ItemConfig[t[e].itemId],s=BagCT.ins().getBagItemById(i.id);if(s&&s.count>0)return!0}return!1},__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType54Data.prototype,"ActivityType54Data"),window.ActivityType54Data=ActivityType54Data;var ActivityType44Data=function(t){function e(e){var i=t.call(this,e)||this;return i.recharge=0,i.logVipLv=0,i.hasGet=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.recharge=t.readInt(),this.logVipLv=t.readByte(),this.hasGet=t.readByte()},e.prototype.awardState=function(){var t=GlobalConfig.ActivityType44Config[this.id];return 1==this.hasGet?2:t&&this.recharge>=t.needYb&&this.logVipLv>=t.vipRange[0]&&this.logVipLv<=t.vipRange[1]?1:0},e.prototype.canReward=function(){return 1==this.awardState()},e.prototype.isOpenActivity=function(){var t=GlobalConfig.ActivityType44Config[this.id],e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t&&this.logVipLv>=t.vipRange[0]&&this.logVipLv<=t.vipRange[1]&&0>e&&i>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType44Data.prototype,"ActivityType44Data"),window.ActivityType44Data=ActivityType44Data;var ActivityType56Data=function(t){function e(e){var i=t.call(this,e)||this;return i.giftData={},i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.times=t.readUnsignedInt();for(var e=t.readByte(),i=0;e>i;i++)this.giftData[t.readByte()]=t.readByte()},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType56Data.prototype,"ActivityType56Data"),window.ActivityType56Data=ActivityType56Data;var ActivityType46Data=function(t){function e(e){var i=t.call(this,e)||this;return i.awardstatus=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.yb=t.readInt(),this.use=t.readInt(),this.awardstatus=[];for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte();this.awardstatus[s]=t.readByte()}},e.prototype.canReward=function(){for(var t in this.awardstatus)if(1==this.awardstatus[t])return!0;return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType46Data.prototype,"ActivityType46Data"),window.ActivityType46Data=ActivityType46Data;var ActivityType58Data=function(t){function e(e){var i=t.call(this,e)||this;return i.cid=0,i.ranks=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.cid=t.readShort()},e.prototype.postRewardResult=function(t){var e=t.readShort();if(2==e){var i=t.readInt();this.ranks=[];for(var s=0;i>s;s++){var n=PFVipCT.parserPFVipInfo(t);this.ranks.push({name:t.readString(),vip:t.readShort(),power:t.readDouble(),fpVipInfo:n})}}else if(1==e){for(var o=t.readByte(),a=t.readInt(),r=[],s=0;a>s;s++){var l=new RewardData;l.parser(t),r.push(l)}ResultManager.ins().create(FbCT.FB_TYPE_ACTIVITY,o,r)}},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType58Data.prototype,"ActivityType58Data"),window.ActivityType58Data=ActivityType58Data;var ActivityType59Data=function(t){function e(e){var i=t.call(this,e)||this;return i.guildData=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.guildData=[];for(var e=t.readByte(),i=0;e>i;i++){var s=t.readInt(),n=t.readString(),o=t.readByte(),a=t.readDouble();this.guildData.push({id:s,name:n,rank:o,power:a,member:[]})}for(var r=t.readByte(),l=0;r>l;l++){var h=t.readInt(),p=t.readInt(),o=t.readByte(),u=t.readString(),d=t.readByte(),c=t.readByte(),f=t.readByte(),g=t.readInt(),y=t.readInt(),v=t.readByte(),a=t.readDouble(),m=t.readString(),T=t.readInt();for(var C in this.guildData)this.guildData[C].id==h&&this.guildData[C].member.push({id:p,name:u,rank:o,servId:T,guildName:this.guildData[C].name,job:d,sex:c,vip:f,lv:g,zsLevel:y,monthCard:v,power:a,appId:m})}},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType59Data.prototype,"ActivityType59Data"),window.ActivityType59Data=ActivityType59Data;var PActivityType30Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType30Data);__reflect(PActivityType30Data.prototype,"PActivityType30Data"),window.PActivityType30Data=PActivityType30Data;var PActivityType53Data=function(t){function e(e,i,s){void 0===s&&(s=ActivityType.Personal);var n=t.call(this,e)||this;return n.costRecord=0,n.activityType=s,n.id=i,n.update(e),n}return __extends(e,t),e.prototype.update=function(t){this.rewardId=t.readShort(),this.dayNum=t.readShort(),this.costRecord=t.readByte(),this.allCost=t.readByte()},e.prototype.canReward=function(){var t=GlobalConfig.PActivityType53Config[this.id][this.rewardId][this.dayNum];return t?0==this.costRecord&&Actor.yb>=t.price:!1},e.prototype.isOpenActivity=function(){var t=GlobalConfig.PActivityType53Config[this.id];return 1e3*ZsCT.ins().lv+Actor.level>=GlobalConfig.PActivityConfig[this.id].lv&&t&&t[this.rewardId]?!0:!1},e}(ActivityBaseData);__reflect(PActivityType53Data.prototype,"PActivityType53Data"),window.PActivityType53Data=PActivityType53Data;var PActivityType55Data=function(t){function e(e,i,s,n){return t.call(this,e,i,s,n)||this}return __extends(e,t),e}(ActivityType55Data);__reflect(PActivityType55Data.prototype,"PActivityType55Data"),window.PActivityType55Data=PActivityType55Data;var PActivityType57Data=function(t){function e(e,i){return t.call(this,e,i,ActivityType.Personal)||this}return __extends(e,t),e}(ActivityType57Data);__reflect(PActivityType57Data.prototype,"PActivityType57Data"),window.PActivityType57Data=PActivityType57Data;var QiongQiRankData=function(){function t(){this.rank=0,this.actorId=0,this.level=0,this.serverId=0,this.roleName=""}return t}();__reflect(QiongQiRankData.prototype,"QiongQiRankData"),window.QiongQiRankData=QiongQiRankData;var FudaiHuntViewItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="FudaiHuntitemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&this.data.award instanceof RewardData&&(this.eItem.data=this.data.award,this.eNumFlow=TextFlowMaker.generateTextFlow("|C:"+(this.data.renum>0?ColorUtil.GREEN:ColorUtil.RED)+"&T:剩余"+this.data.renum+"次|"))},e}(BaseItemRender);__reflect(FudaiHuntViewItem.prototype,"FudaiHuntViewItem"),window.FudaiHuntViewItem=FudaiHuntViewItem;var FudaiHuntViewWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="FudaiHuntViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP0=new eui.ArrayCollection,this.eListDP1=new eui.ArrayCollection,this.eListDP2=new eui.ArrayCollection,this.eListDP3=new eui.ArrayCollection,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.data=Activity.ins().activityData[this.actId],this.eListDP0.source=this.data.awardInfo[0],this.eListDP1.source=this.data.awardInfo[1],this.eListDP2.source=this.data.awardInfo[2],this.eListDP3.source=this.data.awardInfo[3]},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(FudaiHuntViewWin.prototype,"FudaiHuntViewWin"),window.FudaiHuntViewWin=FudaiHuntViewWin,ViewManager.ins().reg(FudaiHuntViewWin,LayerManager.UI_Main);var FudaiResultWin=function(t){function e(){var e=t.call(this)||this;
return e.arr=[],e.items=[],e.type=0,e.addTouchEndEvent(e,e.otherClose),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="FudaiResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.arr=t[0],this.playResult()},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,s=0;i>s;s++){this.items[s]=this.createItem(this.arr[s]);var n=egret.Tween.get(this.items[s]);this.items[s].x=s%5*c_distantX+c_firstX,this.items[s].y=Math.floor(s/5)*c_distantY+c_firstY,this.items[s].alpha=0,n.wait(s*waitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}this.listGroup.verticalCenter=-120,this.listCon.horizontalCenter=46,this.listCon.verticalCenter=50},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.createItem=function(t){var e=new ItemBase;this.listCon.addChild(e);var i=GlobalConfig.ItemConfig[t.id];return i?(e.num=t.count,e.data=t.id):e.data={type:0,count:t.count,id:t.id},e.x=c_launchX,e.y=c_launchY,e},e}(BaseEuiView);__reflect(FudaiResultWin.prototype,"FudaiResultWin"),window.FudaiResultWin=FudaiResultWin,ViewManager.ins().reg(FudaiResultWin,LayerManager.UI_Main);var LuckyResultWinEx=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HuntResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.buy),this.observe(Activity.ins().postRewardResult,this.updateView),this.activityID=t[0],this.indexs=t[1],this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateView=function(){this.canClicck=!0,this.zwHunt.visible=!0;var t=GlobalConfig.ActivityType52Config,e=Activity.ins().activityData[this.activityID];if(this.indexs.length>1){var i=t[this.activityID];this.arr=e.itemList,this.title.text="获得如下宝物",this.buyBtn.labelDisplay.text="抽10次",this.yb=10*i[0].yb,this.zw.text=this.yb+"";var s=GlobalConfig.ItemConfig[i[0].item];this.icon.source=s?s.icon+"_png":null,this.itemId=i[0].item,this.updateDesc(),this.playResult(),this.zwNum2.text="/10）"}else if(e.indexsEx.length){var i=t[this.activityID];this.arr=e.itemList,this.title.text="获得如下宝物",this.buyBtn.labelDisplay.text="抽1次",this.yb=1*i[0].yb,this.zw.text=this.yb+"";var s=GlobalConfig.ItemConfig[i[0].item];this.icon.source=s?s.icon+"_png":null,this.itemId=i[0].item,this.updateDesc(),this.playResult(),this.zwNum2.text="/1）"}},e.prototype.updateDesc=function(){var t=BagCT.ins().getBagItemById(this.itemId),e=ColorUtil.WHITE_COLOR,i=0,s=10;t&&(i=t.count,e=t.count>=s?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR),this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+i+"</font> ")},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,s=0;i>s;s++){this.items[s]=this.createItem(this.arr[s],s);var n=egret.Tween.get(this.items[s]);this.items[s].x=s%5*cc_distantX+cc_firstX,this.items[s].y=Math.floor(s/5)*cc_distantY+cc_firstY,this.items[s].alpha=0,n.wait(s*cwaitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.createItem=function(t,e){var i=new ItemBase;this.listCon.addChild(i);var s=GlobalConfig.ItemConfig[t.id];return s?(i.num=t.count,i.data=t):i.data=GlobalConfig.ActivityType52Config[this.activityID][this.indexs[e]].showReward,i.x=cc_launchX,i.y=cc_launchY,i},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.buy=function(t){if(this.canClicck)if(this.ins=Activity.ins(),this.config52=GlobalConfig.ActivityType52Config,this.indexs.length>1){var e=this.config52[this.activityID][0],i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e.item);if(i&&i.count)this.ins.sendReward(this.activityID,2);else{var s=10;HuntWarnBuyWin.showBuyWarn("LuckyResultWinEx"+this.activityID+"-10",this.huntWarnFun.bind(this),"是否消耗"+e.yb*s+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+s)}}else{var e=this.config52[this.activityID][0],i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e.item);if(i&&i.count)this.ins.sendReward(this.activityID,1,1),this.ins.sendReward(this.activityID,1,2);else{var s=1;HuntWarnBuyWin.showBuyWarn("LuckyResultWinEx"+this.activityID+"-1",this.huntWarnFun.bind(this),"是否消耗"+e.yb*s+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+s)}}},e.prototype.huntWarnFun=function(){var t=this.config52[this.activityID][0],e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);this.indexs.length>1?(e&&e.count&&this.ins.sendReward(this.activityID,2),Actor.yb>=10*t.yb?this.ins.sendReward(this.activityID,2):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")):e&&e.count?(this.ins.sendReward(this.activityID,1,1),this.ins.sendReward(this.activityID,1,2)):Actor.yb>=1*t.yb?(this.ins.sendReward(this.activityID,1,1),this.ins.sendReward(this.activityID,1,2)):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(LuckyResultWinEx.prototype,"LuckyResultWinEx"),window.LuckyResultWinEx=LuckyResultWinEx,ViewManager.ins().reg(LuckyResultWinEx,LayerManager.UI_Main);var OSATarget11Panel2=function(t){function e(){var e=t.call(this)||this;return e._curDay=0,e._curDayIndex=0,e._curGroupIndex=0,e.activityType=ActivityType.Normal,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityID",{set:function(t){this._activityID=t,this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID)},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.activityType==ActivityType.Normal?GlobalConfig.ActivityConfig[this._activityID]:GlobalConfig.PActivityConfig[this._activityID];i&&i.pageSkin?(this.skinName=i.pageSkin,this.tabP.itemRenderer=HSDTabListItemRender,this.tabD.itemRenderer=HSDTabListItemRender,this.showType=!1):(this.showType=!0,this.skinName=this.activityType==ActivityType.Normal?"ThreeDayWinSkin":"CDHuiGuitask",this.tabP.itemRenderer=HappySevenDayTabListItemRender,this.tabD.itemRenderer=HappySevenDayBtnItemRender,this.eList.itemRenderer=HappySevenDayScoreItem),this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType11_1Config[this._activityID]):this.activityType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType11_1Config[this._activityID]),this.list.itemRenderer=HappySevenDayItemRender,this.actInfo0.text=i.desc,this._curDayIndex=0,this._curGroupIndex=0,this.updateView(),this.updateTabs(),this.tabD.selectedIndex=this._curDayIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData(),this.updateTargetAward(),this.addTouchEvent(this,this.onTouch),this.observe(this.ins.postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),this.addChangeEvent(this.tabP,this.onTabBtn),Timer.start(1e3,0,this.setTime,this),this.updateLock(),this.setTime()},e.prototype.updateView=function(){this.data=this.ins.getActivityDataById(this._activityID),this._curDay=this.data.getCurDay(),this._items=[];var t,e,i,s,n,o,a=this.activityType==ActivityType.Normal?GlobalConfig.ActivityType11_2Config[this._activityID]:GlobalConfig.PActivityType11_2Config[this._activityID],r=[];for(var l in a)t=a[l],i=t.day,e=this._items[t.day-1],e||(e=[],this._items[t.day-1]=e,r.push({res:t.dayImg,isOpen:this._curDay>=t.day,showRed:!1,day:t.day})),o=this.data.achieveInfo[t.index-1],this._curDay>=t.day&&!o.isGot&&o.times>=t.dayLimit&&(r[t.day-1].showRed=!0),s=t.group,n=e[s-1],n||(n=[],e[s-1]=n),n.push(t);this._btnCollect||(this._btnCollect=new eui.ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.source=r,this.tabD.validateNow(),this._tabCollect||(this._tabCollect=new eui.ArrayCollection,this.tabP.dataProvider=this._tabCollect)},e.prototype.refreshReds=function(){this.updateView(),this.updateTabs(),this.updateData(),this.updateTargetAward(),this.updateRewardBtnRed()},e.prototype.updateRewardBtnRed=function(){if(this.rewardBtnRed){var t=this.ins.getActivityDataById(this._activityID),e=this.cfgs;this.rewardBtnRed.visible=!1;for(var i in e)1==t.getRewardState(e[i].index)&&(this.rewardBtnRed.visible=!0)}},e.prototype.updateData=function(){var t=this._items[this._curDayIndex][this._curGroupIndex];if(t&&t.length){this._listCollect||(this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect);for(var e,i,s=t.length,n=[],o=0,a=this.ins.getActivityDataById(this._activityID),r=0;s>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,n[r]={activityID:this._activityID,conf:e,state:o,times:i.times,achieve:i,yunBao:a.yunBao,activityType:this.activityType};n.sort(this.sort),this._listCollect.source=n}},e.prototype.sort=function(t,e){return 1!=t.state&&1!=t.achieve.otherState||1==e.state||1==e.achieve.otherState?1!=e.state&&1!=e.achieve.otherState||1==t.state||1==t.achieve.otherState?2==t.state&&2!=e.state?1:2!=t.state&&2==e.state?-1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0:1:-1},e.prototype.updateTargetAward=function(){var t=null,e=this.ins.getActivityDataById(this._activityID).hiScore;if(!this.showType){var i=this.cfgs;for(var s in i)!t&&e<i[s].score&&(t=i[s])}if(t||(t=this.cfgs[Object.keys(this.cfgs).length]),this.schedule&&(this.schedule.maximum=t.score,this.schedule.value=e),this.eScore&&(this.eScore.text=e+""),this.eList){var n=CommonUtils.objectToArray(this.cfgs),o=[];for(var s in n)o.push([n[s],this.data]);this.eList.dataProvider=new eui.ArrayCollection(o)}},e.prototype.onTouch=function(t){if(t.target instanceof HappySevenDayScoreItem){var e=t.target.data[0],i=this.ins.getActivityDataById(this._activityID);switch(i.getRewardState(e.index)){case 1:this.ins.sendReward(this._activityID,e.index,1)}}else switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:var s=this.cfgs;for(var n in s){0==s[n].rewardType?ViewManager.ins().open(CDYBZhuanPanRewardWin,this._activityID):ViewManager.ins().open(SDRewardWin,this._activityID);break}}},e.prototype.updateLock=function(){if(this.lock){var t=this.tabD.selectedItem;this.lock.visible=!t.isOpen,this.eLockLab.text="活动第"+t.day+"天开启，敬请期待"}},e.prototype.onClickBtn=function(t){if(this._curDayIndex!=t.currentTarget.selectedIndex){var e=this.tabD.getChildAt(t.currentTarget.selectedIndex);e.selected=!1;var i=e.data;i.isOpen?this._curDayIndex=t.currentTarget.selectedIndex:this.showType||(this._curDayIndex=t.currentTarget.selectedIndex),this.updateLock(),this.tabD.selectedIndex=this._curDayIndex,e=this.tabD.getChildAt(this._curDayIndex),e.selected=!0,this.updateTabs(),this.tabP.selectedIndex=this._curGroupIndex=0,this.updateData()}},e.prototype.onTabBtn=function(t){this._curGroupIndex!=t.currentTarget.selectedIndex&&(this._curGroupIndex=t.currentTarget.selectedIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData())},e.prototype.updateTabs=function(){var t,e,i,s=this._items[this._curDayIndex],n=this.ins.getActivityDataById(this._activityID),o=[];for(var a in s){o.push({res:s[a][0].gName,showRed:!1}),t=s[a].length;for(var r=0;t>r;r++)if(i=s[a][r],e=n.achieveInfo[i.index-1],this._curDay>=(i.day||0)&&!e.isGot&&e.times>=i.dayLimit){o[a].showRed=!0;break}}this._tabCollect.source=o},e.prototype.setTime=function(){var t=this.ins.getActivityDataById(this._activityID);t&&(this.actTime0.text=t.getRemainTime())},e.prototype.close=function(){this.removeObserve()},e}(BaseView);__reflect(OSATarget11Panel2.prototype,"OSATarget11Panel2"),window.OSATarget11Panel2=OSATarget11Panel2;var OSATarget19Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddSkin",e}return __extends(e,t),e.prototype.close=function(){this.panelArr[this.curSelectIndex].close(),this.removeObserve(),Timer.stopAll(this)},e.prototype.open=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.updateRedPoint),this.panelArr=[this.ranking,this.reward],this.setSelectedIndex(0),this.updateRedPoint()},e.prototype.onTabTouch=function(t){this.panelArr[this.curSelectIndex].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(this.activityID),this.viewStack.selectedIndex=t},e.prototype.updateRedPoint=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.redPoint1.visible=t.canReward()},e}(BaseView);__reflect(OSATarget19Panel2.prototype,"OSATarget19Panel2"),window.OSATarget19Panel2=OSATarget19Panel2;var OSATarget1Item11=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddResourcePackItemSkin",e.gift.isShowName(!1),e.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||e.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.onRemove=function(){this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)&&this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.dataChanged=function(){this.get.visible=!1,this.level.text=this.data[0].qiongqiLevel+"级",this.gift.data=this.data[0].rewards[0],this.gift.setRedPoint(!1),this.data[1].bossLevel>=this.data[0].qiongqiLevel&&(this.data[1].awardArr.indexOf(this.data[0].index)>=0?this.get.visible=!0:this.gift.setRedPoint(!0))},e.prototype.showDetail=function(){if(0==(this.data[1].record>>this.data[0].index&1))if(this.data[1].bossLevel>=this.data[0].qiongqiLevel){var t=this.data[1].activityType,e=void 0;0==t?e=Activity.ins():1==t&&(e=PActivity.ins()),e.sendReward(this.data[1].id,this.data[0].index)}else this.gift.showDetail()},e}(ItemBase);__reflect(OSATarget1Item11.prototype,"OSATarget1Item11"),window.OSATarget1Item11=OSATarget1Item11;var OSATarget3Panel13=function(t){function e(e){var i=t.call(this)||this;return i.btnSelect=0,i._state=0,i._sn_="CDRechargeContinuitySkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.updateData=function(){this.initData()},e.prototype.initData=function(){var t;if(this.actType==ActivityType.Normal?(this.act=Activity.ins().getActivityDataById(this.activityID),this.cfg=GlobalConfig.ActivityType3Config[this.activityID],t=this.cfg[this.btnSelect+1]):this.actType==ActivityType.Personal&&(this.act=PActivity.ins().getActivityDataById(this.activityID),this.cfg=GlobalConfig.PActivity3Config[this.activityID],t=this.cfg[this.btnSelect+1]),t){if(this.items.dataProvider=new eui.ArrayCollection(t.rewards),this.show.source=t.image+"",this.tips.visible=!0,this.act.chongzhiTotal>=t.val){var e=this.act.recrod>>this.btnSelect+1&1;0==e?(this.pay.label="领取",this.eRp.visible=this.pay.visible=!0,this.isget.visible=!1,this._state=1):(this.pay.label="已领取",this.tips.visible=this.eRp.visible=this.pay.visible=!1,this.isget.visible=!0,this._state=2)}else this.pay.label="充点小钱",this.pay.visible=!0,this.eRp.visible=this.isget.visible=!1,this._state=0;var i=GlobalConfig.ClientGlobalConfig.rate,s=this.act.chongzhiTotal>=t.val?3532333:16711680;this.tips.textFlow=TextFlowMaker.generateTextFlow1("充值|C:"+s+"&T:"+this.act.chongzhiTotal/i+"|/|C:0x35E62D&T:"+t.val/i+"|元即可领取");for(var n=0;3>n;n++)this["tab"+n].currentState=n==this.btnSelect?"up":"down",this["tab"+n].label=this.cfg[n+1].val/GlobalConfig.ClientGlobalConfig.rate+"元",this["tab"+n].eRp.visible=this.act.chongzhiTotal>=this.cfg[n+1].val&&!(this.act.recrod>>n+1&1)}},e.prototype.onClick=function(t){switch(t.target){case this.tab0:case this.tab1:case this.tab2:var e=[this.tab0,this.tab1,this.tab2];this.btnSelect=Number(e.indexOf(t.target)),this.initData();break;case this.pay:if(1==this._state){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void TipsCT.ins().showTips("背包剩余空位不足，请先清理");this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this.btnSelect+1):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this.btnSelect+1)}else{var i=Recharge.ins().getRechargeData(0);i&&0!=i.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}}},e}(BaseView);__reflect(OSATarget3Panel13.prototype,"OSATarget3Panel13"),window.OSATarget3Panel13=OSATarget3Panel13;var OSATarget40Item2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),t.prototype.setImgBg2.call(this,"rich_kuang_png")},e}(ItemBase);__reflect(OSATarget40Item2.prototype,"OSATarget40Item2"),window.OSATarget40Item2=OSATarget40Item2;var OSATarget40Panel1=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDPTXunbaoSkin",i.eList.itemRenderer=XiaoNianListRenderer,i.activityID=e,i.addTouchEvent(i,i.onClick),i.mc=new MovieClip,i.mc.playFile(RES_DIR_EFF+"zhuanpaneff1",-1),i.circleEff.addChild(i.mc),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.addChangeEvent(this.eCheckBox,this.updateView),this.observe(Activity.ins().postRewardResult,this.updateResult),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update(),this.setTime()},e.prototype.onClick=function(t){var e=this;switch(t.target){case this.choujiangBtn0:var i=GlobalConfig.ActivityType40Config[this.activityID],s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i[1].itemId),n=this.eCheckBox.selected?10:1;BagCT.ins().getSurplusCount()<50?ViewManager.ins().open(BagFullTipsWin,50):s>=n?(this.choujiangBtn0.enabled=!1,ActivityType40Data.ShowRoll=!0,this.rolling=!0,Activity.ins().sendReward(this.activityID,0,this.eCheckBox.selected?2:1)):i[1].yb&&i[1].yb>0?HuntWarnBuyWin.showBuyWarn("OSATarget40Panel_"+this.activityID+"-HuntResultWin"+this.eCheckBox.selected?10:0,function(){GlobalFun.checkMoney(i[1].yb*n)&&(e.choujiangBtn0.enabled=!1,ActivityType40Data.ShowRoll=!0,e.rolling=!0,Activity.ins().sendReward(e.activityID,0,e.eCheckBox.selected?2:1))},"是否消耗"+i[1].yb*n+"元宝购买"+GlobalConfig.ItemConfig[i[1].itemId].name+"*"+n):WarnCT.ins().setBuyGoodsWarn(i[1].itemId,1);break;case this.eShopBtn:ViewManager.ins().open(OSATarget40JFStoreWin,this.activityID)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.updateView()},e.prototype.updateView=function(){var t=GlobalConfig.ActivityType40Config[this.activityID];for(var e in t)this["a"+e].data=t[e].showDrop;var i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t[1].itemId),s=this.eCheckBox.selected?10:1;this.num0.textFlow=TextFlowMaker.generateTextFlow("|C:"+(i>=s?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+i+"|/"+s),this.redPoint.visible=this.data.scoreReward(),this.num1.text=t[1].yb>0?s*t[1].yb+"":"",this.eLab.text=this.data.score+"",this.updateLog()},e.prototype.updateLog=function(){this.rolling||(this.eList.dataProvider=new eui.ArrayCollection(this.data.logs))},e.prototype.updateResult=function(){if(ActivityType40Data.ShowRoll){ActivityType40Data.ShowRoll=!1;var t=ActivityType40Data.RewardResultId[this.activityID];this.beginLottery(t)}},e.prototype.beginLottery=function(t){var e=this,i=t>0,s=t>0?1440+360*(t-1)/16:this.tttzhi0.rotation+720,n=egret.Tween.get(this.tttzhi0);n.to({rotation:s},4e3,egret.Ease.circOut).call(function(){i&&e.flyItem(e["a"+t]),setTimeout(function(){e.rolling=!1,e.choujiangBtn0.enabled=!0,e.updateView()},1e3)},this)},e.prototype.flyItem=function(t){var e=ActivityType40Data.RewardResultItem[0]||0,i=ActivityType40Data.RewardResultItem[1]||0,s=new ItemBase;s.x=t.x,s.y=t.y,s.data=e,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,t.parent.addChild(s),GameLogic.ins().postFlyItemEx(s);var n=GlobalConfig.ItemConfig[e],o="获得|C:"+ItemUtil.getQualityColor(n)+"&T:"+n.name+" x "+i+"|";TipsCT.ins().showTips(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),this.removeObserve()},e.prototype.onEnterFrame=function(){var t=22.5;this.kuang.rotation=Math.ceil((this.tttzhi0.rotation-t/2)/t)*t},e.prototype.setTime=function(){this.data&&(this.eTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget40Panel1.prototype,"OSATarget40Panel1"),window.OSATarget40Panel1=OSATarget40Panel1;var OSATarget40Panel2=function(t){function e(e){var i=t.call(this)||this;return i.boxSum=0,i.boxList=[],i.huntType=0,i._sn_="richtreasure",i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list1.itemRenderer=OSATarget40Item2,this.showList1.itemRenderer=this.showList2.itemRenderer=ItemBase,this.observe(Actor.ins().postYbChange,this.updateYb),this.observe(BagCT.ins().postItemAdd,this.updateYb),this.observe(BagCT.ins().postItemChange,this.updateYb),this.observe(BagCT.ins().postItemDel,this.updateYb),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.cfg=GlobalConfig.ActivityType40Config[this.activityID],this.mallCfg=GlobalConfig.ActivityType40_1Config[this.activityID],this.update(),this.updateData(),this.updateYb()},e.prototype.updateData=function(){this.actData=Activity.ins().getActivityDataById(this.activityID),this.redPoint.visible=this.actData.scoreReward(),this.setBoxData()},e.prototype.update=function(){this.boxSum=0,this.boxList=[];for(var t in this.mallCfg)this.mallCfg[t].lotteryCount&&(this.boxSum++,this.boxList.push(this.mallCfg[t]));for(var e=0;e<this.boxSum;e++)this.addTouchEvent(this["box"+e],this.onTab);var i=[],s=[],n=[];for(var o in this.cfg)switch(this.cfg[o].showPosition){case 1:s.push(this.cfg[o].showDrop);break;case 2:n.push(this.cfg[o].showDrop);break;default:i.push(this.cfg[o].showDrop)}s=s.concat(s).concat(s),n=n.concat(n).concat(n),this.showList1.dataProvider=new eui.ArrayCollection(s),this.showList2.dataProvider=new eui.ArrayCollection(n),this.list1.dataProvider=new eui.ArrayCollection(i),this.showListEff()},e.prototype.updateYb=function(){this.img0.source=this.img1.source=this.left0.text=this.left1.text=this.yb0.text=this.yb1.text="";var t=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,this.cfg[1].itemId);this.num0.text=this.num1.text=t+"",this.icon0.source=this.icon1.source=GlobalConfig.ItemConfig[this.cfg[1].itemId].icon+"_png",this.right0.text="/1",this.right1.text="/10",this.cfg[1].yb&&(Actor.yb>=10*this.cfg[1].yb?(this.img0.source=this.img1.source="szyuanbao",this.yb0.text=this.cfg[1].yb+"",this.yb1.text=10*this.cfg[1].yb+"",this.left0.text=this.left1.text="(",this.right0.text="/1)",this.right1.text="/10)"):Actor.yb>=this.cfg[1].yb&&(this.img0.source="szyuanbao",this.yb0.text=this.cfg[1].yb+"",this.left0.text="(",this.right0.text="/1)"))},e.prototype.onTab=function(t){for(var e=0;e<this.boxSum;e++){var i=this.boxList[e].index;if(t.target==this["box"+e]&&i){if(1!=this.actData.getStateByIndex(i)){ViewManager.ins().open(HuntBoxsTips,i,4,this.activityID);break}Activity.ins().sendReward(this.activityID,0,3,i);break}}},e.prototype.onClick=function(t){switch(t.target){case this.eShopBtn:ViewManager.ins().open(OSATarget40JFStoreWin,this.activityID);break;case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1)}},e.prototype.buyHunt=function(t){var e=this;this.huntType=t;var i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,this.cfg[1].itemId),s=t?10:1;BagCT.ins().getSurplusCount()<50?ViewManager.ins().open(BagFullTipsWin,50):i>=s?Activity.ins().sendReward(this.activityID,0,t?2:1):this.cfg[1].yb&&this.cfg[1].yb>0?HuntWarnBuyWin.showBuyWarn("OSATarget40Panel_"+this.activityID+"-HuntResultWin"+(t?10:0),function(){GlobalFun.checkMoney(e.cfg[1].yb*s)&&Activity.ins().sendReward(e.activityID,0,t?2:1)},"是否消耗"+this.cfg[1].yb*s+"元宝购买"+GlobalConfig.ItemConfig[this.cfg[1].itemId].name+"*"+s):WarnCT.ins().setBuyGoodsWarn(this.cfg[1].itemId,1)},e.prototype.setBoxData=function(){this.times.text=this.actData.lottery+"";for(var t=0;t<this.boxSum;t++){var e=this.boxList[t];if(!e)return;switch(this["done"+t].visible=!0,this.actData.getStateByIndex(e.index)){case 0:this["time"+t].text=e.lotteryCount+"次",this["done"+t].text="",this["box"+t].source="ttxunbao_box2",this["boxPoint"+t].visible=!1;break;case 1:this["time"+t].text="",this["done"+t].text="可领取",this["box"+t].source="ttxunbao_box1",this["boxPoint"+t].visible=!0;break;case 2:this["time"+t].text="",this["done"+t].text="已领取",this["box"+t].source="ttxunbao_box2",this["boxPoint"+t].visible=!1}}},e.prototype.showListEff=function(){var t=this;this.showList1.scrollH=0;var e=this.showList1.dataProvider.length/3;egret.Tween.removeTweens(this.showList1);var i=egret.Tween.get(this.showList1,{loop:!0});i.to({scrollH:96*e},GlobalConfig.ClientGlobalConfig.time).call(function(){t.showList1.scrollH=0});var s=this.showList2.dataProvider.length/3;this.showList2.scrollH=96*s,egret.Tween.removeTweens(this.showList2);var n=egret.Tween.get(this.showList2,{loop:!0});n.to({scrollH:0},GlobalConfig.ClientGlobalConfig.time).call(function(){t.showList2.scrollH=96*s})},e.prototype.enterFrame=function(){this.actData&&(this.eTime.text=this.actData.getRemainTime())},e}(BaseView);__reflect(OSATarget40Panel2.prototype,"OSATarget40Panel2"),window.OSATarget40Panel2=OSATarget40Panel2;var OSATarget42ListItem2=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddSupplyMissionItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.index){this.list.dataProvider=new eui.ArrayCollection(this.data.reward),this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.name);var t=ActivityPanel.getActivityTypeFromId(this.data.id);t==ActivityType.Normal?this.ins=Activity.ins():t==ActivityType.Personal&&(this.ins=PActivity.ins()),this.actData=this.ins.activityData[this.data.id];var e=this.actData.achieveInfo[this.data.index];this.isGet.visible=!!e&&!!e.isGot,this.actBtn.visible=this.scedule.visible=!this.isGet.visible,this.redpoint.visible=!!e&&!e.isGot&&e.times>=this.data.target,this.scedule.text=(e?e.times:0)+" / "+this.data.target,this.actBtn.label=e&&e.times>=this.data.target||!this.data.turn?"领取":"前往"}},e.prototype.onClick=function(){if(this.data){var t=this.actData.achieveInfo[this.data.index];if(t&&t.times>=this.data.target)return void this.ins.sendReward(this.data.id,this.data.index);if(this.data.turn)return"GuanQiaRewardWin"==this.data.turn[0]?void(FbCT.ins().currentEnergy>=FbCT.ins().energy?(ViewManager.ins().closeTopLevel(),FbCT.ins().autoPk()):TipsCT.ins().showTips("|C:0xf3311e&T:能量不足|")):void ViewManager.ins().open(this.data.turn[0],this.data.turn[1],this.data.turn[2])}},e}(BaseItemRender);__reflect(OSATarget42ListItem2.prototype,"OSATarget42ListItem2"),window.OSATarget42ListItem2=OSATarget42ListItem2;var OSATarget42Panel1=function(t){function e(e){var i=t.call(this)||this;return i.skinName="NewDailytasks",i.tabDP=new eui.ArrayCollection,i.eTab.itemRenderer=OSATarget42TabItem,i.eTab.dataProvider=i.tabDP,i.listDP=new eui.ArrayCollection,i.list.itemRenderer=OSATarget42ListItem,i.list.dataProvider=i.listDP,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?this.ins=Activity.ins():this.actType==ActivityType.Personal&&(this.ins=PActivity.ins()),this.addChangeEvent(this.eTab,this.updateList),this.observe(this.ins.postActivityIsGetAwards,this.update),this.initCfgs(),this.update(),this.setTime()},e.prototype.initCfgs=function(){if(null==this.cfgs){this.cfgs=[];var t=this.actType==ActivityType.Normal?GlobalConfig.ActivityType42Config[this.activityID]:GlobalConfig.PActivityType42Config[this.activityID];for(var e in t){var i=t[e];this.cfgs[i.group-1]||(this.cfgs[i.group-1]=[]),this.cfgs[i.group-1].push(i)}}},e.prototype.update=function(){this.data=this.ins.activityData[this.activityID],this.updateTab(),this.updateList()},e.prototype.updateTab=function(){var t=[];for(var e in this.cfgs)t.push([this.cfgs[e],this.data]);this.tabDP.source=t},e.prototype.updateList=function(){var t=-1!=this.eTab.selectedIndex?this.eTab.selectedIndex:0,e=[];for(var i in this.cfgs[t])e.push([this.cfgs[t][i],this.data]);e.sort(this.sort),this.listDP.source=e},e.prototype.sort=function(t,e){var i=t[1],s=e[1],n=i.getStatus(t[0].index),o=s.getStatus(e[0].index);return 1==n&&1!=o?-1:1!=n&&1==o?1:t[0].index<e[0].index?-1:t[0].index>e[0].index?1:0},e.prototype.onClick=function(t){t.target instanceof eui.Button&&t.target.parent instanceof OSATarget42ListItem&&t.target.parent.onClick()},e.prototype.setTime=function(){this.data&&(this.actTime0.text=this.data.getRemainTime())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e}(BaseView);__reflect(OSATarget42Panel1.prototype,"OSATarget42Panel1"),window.OSATarget42Panel1=OSATarget42Panel1;var OSATarget42Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddSupplyMissionSkin",e.addTouchEvent(e,e.onClick),e}return __extends(e,t),e.prototype.open=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?this.ins=Activity.ins():this.actType==ActivityType.Personal&&(this.ins=PActivity.ins()),this.observe(this.ins.postActivityIsGetAwards,this.update),this.update(),this.setTime()},e.prototype.update=function(){this.data=this.ins.activityData[this.activityID];var t=[],e=[],i=[],s=this.actType==ActivityType.Normal?GlobalConfig.ActivityType42Config[this.activityID]:GlobalConfig.PActivityType42Config[this.activityID];for(var n in s){var o=s[n];this.data.achieveInfo[n]&&this.data.achieveInfo[n].isGot?t.push(o):this.data.achieveInfo[n]&&!this.data.achieveInfo[n].isGot&&this.data.achieveInfo[n].times>=o.target?e.push(o):i.push(o)}t.sort(this.sort),e.sort(this.sort),i.sort(this.sort);var a=e.concat(i,t);this.reward.dataProvider=new eui.ArrayCollection(a)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.index,e.index)},e.prototype.onClick=function(t){t.target instanceof eui.Button&&t.target.parent instanceof OSATarget42ListItem2&&t.target.parent.onClick()},e.prototype.setTime=function(){this.data&&(this.eTime.text=this.data.getRemainTime())},e.prototype.close=function(){this.removeObserve()},e}(BaseView);__reflect(OSATarget42Panel2.prototype,"OSATarget42Panel2"),window.OSATarget42Panel2=OSATarget42Panel2;var OSATarget44Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDVipActivitySkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.initUI(),this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.updateBtn(),this.updateTips(),this.setTime()},e.prototype.updateBtn=function(){switch(this.suerBtn.enabled=!0,this.suerBtn.visible=!0,this.redPoint.visible=!1,this.done.visible=!1,this.data.awardState()){case 1:this.redPoint.visible=!0;break;case 2:this.done.visible=!0,this.suerBtn.visible=!1;break;default:this.suerBtn.enabled=!1}},e.prototype.updateTips=function(){this.sRechargeTip="活动期间已充值："+this.data.recharge+"元宝"},e.prototype.onClick=function(t){switch(t.target){case this.suerBtn:Activity.ins().sendReward(this.activityID,0)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.removeObserve()},e.prototype.initUI=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];this.sTitle=t.title;var e=GlobalConfig.ActivityConfig[this.activityID];this.sDesc=e.desc;var i=GlobalConfig.ActivityType44Config[this.activityID];this.reward.dataProvider=new eui.ArrayCollection(i.reward),this.sVip=VipCT.getVipStr(i.vipRange[0],!0)+" - "+VipCT.getVipStr(i.vipRange[1],!0)+"\n专属好礼",this.sNum=i.needYb+"",this.VipImg.source=i.vipImg},e.prototype.setTime=function(){this.sTime=this.data.getRemainTime()},e}(BaseView);__reflect(OSATarget44Panel.prototype,"OSATarget44Panel"),window.OSATarget44Panel=OSATarget44Panel;var OSATarget45Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="FudaiHuntSkin",i.activityID=e,i.eListDP=new eui.ArrayCollection,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];var t,e=0;for(var i in GlobalConfig.ActivityType45Config[this.activityID])t||(t=GlobalConfig.ActivityType45Config[this.activityID][i]),e+=GlobalConfig.ActivityType45Config[this.activityID][i].total;var s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.itemId);this.icon0.source=this.icon1.source=GlobalConfig.ItemConfig[t.itemId].icon+"_png",this.sNumFlow1=TextFlowMaker.generateTextFlow("<font color="+(s>=1?ColorUtil.GREEN:ColorUtil.RED)+">"+s+"</font> "),this.sNumFlow10=TextFlowMaker.generateTextFlow("<font color="+(s>=10?ColorUtil.GREEN:ColorUtil.RED)+">"+s+"</font> "),this.sZb1=t.yb+"",this.sZb10=10*t.yb+"",this.eListDP.source=this.data.awardInfo[0],this.eTips=this.data.getAwardNum()+"/"+e,this.setTime()},e.prototype.onClick=function(t){switch(t.target){case this.eBuy1:if(BagCT.ins().getSurplusCount()<50)return void ViewManager.ins().open(BagFullTipsWin,50);this.data.getAwardNum()<=0?TipsCT.ins().showTips("全部福袋均已被开启"):this.buyBtnClick(1);break;case this.eBuy10:if(BagCT.ins().getSurplusCount()<50)return void ViewManager.ins().open(BagFullTipsWin,50);this.data.getAwardNum()<=0?TipsCT.ins().showTips("全部福袋均已被开启"):this.data.getAwardNum()<10&&this.data.getAwardNum()>0?TipsCT.ins().showTips("福袋数量不足10个"):this.data.getAwardNum1()<=0?TipsCT.ins().showTips("天命和神运福袋不足"):this.buyBtnClick(10);break;case this.btnChallenge:ViewManager.ins().open(FudaiHuntViewWin,this.activityID)}},e.prototype.buyBtnClick=function(t){var e,i=this;for(var s in GlobalConfig.ActivityType45Config[this.activityID]){e=GlobalConfig.ActivityType45Config[this.activityID][s];break}var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.itemId);n>=t?Activity.ins().sendReward(this.activityID,1==t?1:2):Actor.yb<e.yb*(t-n)?TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):HuntWarnBuyWin.showBuyWarn("OSATarget45Panel-HuntResultWin",function(){Activity.ins().sendReward(i.activityID,1==t?1:2)},"是否消耗"+e.yb*(t-n)+"元宝购买"+GlobalConfig.ItemConfig[e.itemId].name+"*"+(t-n))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.setTime=function(){this.eTime=this.data.getRemainTime()},e}(BaseView);__reflect(OSATarget45Panel.prototype,"OSATarget45Panel"),window.OSATarget45Panel=OSATarget45Panel;var OSATarget46Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDRechargeAndPayItem",e.eListDP=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eListDP.source=t.reward,this.sName="累计充值并消费"+t.use+"元宝";var e=Activity.ins().activityData[t.id];switch(this.redPoint.visible=!1,this.eBtn.enabled=!1,e.awardstatus[t.index]){case 1:this.eBtn.label="领取",this.eBtn.enabled=this.redPoint.visible=!0;break;case 2:this.eBtn.label="已领取";break;default:this.eBtn.label="未完成"}}},e}(BaseItemRender);__reflect(OSATarget46Item.prototype,"OSATarget46Item"),window.OSATarget46Item=OSATarget46Item;var OSATarget46Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDRechargeAndPaySkin",i.activityID=e,i.eListDP=new eui.ArrayCollection,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];var t=CommonUtils.objectToArray(GlobalConfig.ActivityType46Config[this.activityID]);t.sort(this.sort),this.eListDP.source=t;var e=GlobalConfig.ActivityConfig[this.activityID];this.sDesc=e.desc,this.sRecord="已充值："+this.data.yb+"元宝",this.sPay="已消费："+this.data.use+"元宝",this.setTime()},e.prototype.sort=function(t,e){var i=Activity.ins().activityData[t.id],s=i.awardstatus[t.index],n=i.awardstatus[e.index];return 2!=s&&2==n?-1:2==s&&2!=n?1:0},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof OSATarget46Item){var e=t.target.parent.parent.data;Activity.ins().sendReward(this.activityID,e.index)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.setTime=function(){this.eTime=this.data.getRemainTime()},e}(BaseView);__reflect(OSATarget46Panel.prototype,"OSATarget46Panel"),window.OSATarget46Panel=OSATarget46Panel;var OSATarget47ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAExchangeReward",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().activityData[t.index],i=GlobalConfig.ItemConfig[t.propid];if(i){this.sName=i.name,this.eItem.data=t.propid,this.eItem.setCount(t.propcount+"");var s=e.canChangeNum(t);this.des.textFlow=TextFlowMaker.generateTextFlow("可兑换：|C:"+(s>0?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+s+"|/"+t.count);var n=t.materials.length;this.arrowIcon.visible=this.eIcon1.visible=this.eVal1.visible=n>1;for(var o in t.materials){var a=t.materials[o];this["eIcon"+o]&&(this["eVal"+o].text=a.count+"",0==a.type?this["eIcon"+o].source="szyuanbao":this["eIcon"+o].source=GlobalConfig.ItemConfig[a.id].icon+"_png")}this.eDiscountGroup.visible=t.discount&&t.discount<10,this.eDiscountNum.text=""+(t.discount&&t.discount<10?t.discount:10),this.buyBtn.visible=s>0,this.buyBtn.enabled=e.isEnough(t),this.eRp.visible=this.buyBtn.visible&&this.buyBtn.enabled,this.eTips.visible=!this.buyBtn.visible}}},e}(BaseItemRender);__reflect(OSATarget47ItemRender.prototype,"OSATarget47ItemRender"),window.OSATarget47ItemRender=OSATarget47ItemRender;var OSATarget47Panel=function(t){function e(e){var i=t.call(this)||this;return i.curGroupId=0,i.skinName="OSAExchangeAct",i.activityID=e,i.addTouchEvent(i,i.onClick),i.groupList.addEventListener(eui.ItemTapEvent.ITEM_TAP,i.onTouchList,i),i.groupDP=new eui.ArrayCollection,i.groupList.dataProvider=i.groupDP,i.groupList.itemRenderer=OSATarget47TabRender,i.rewardDP=new eui.ArrayCollection,i.rewardList.dataProvider=i.rewardDP,i.rewardList.itemRenderer=OSATarget47ItemRender,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(BagCT.ins().postItemCountChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.update(),this.initView(),this.groupList.selectedIndex=0},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.setTime(),this.updateGroupList(),this.updateList()},e.prototype.onTouchList=function(t){this.curGroupId=this.groupList.selectedIndex,this.rewardDP.source=this.data.getChangeItems(this.curGroupId)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget47ItemRender){var e=t.target.parent.data;return void Activity.ins().sendReward(this.activityID,0,0,e.propid)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.updateList=function(){this.rewardDP.replaceAll(this.data.getChangeItems(this.curGroupId))},e.prototype.updateGroupList=function(){this.groupDP.replaceAll(this.data.getGroups())},e.prototype.initView=function(){var t=GlobalConfig.ActivityConfig[this.activityID];this.sDesc=t.desc},e.prototype.setTime=function(){this.sTime=this.data.getRemainTime()},e}(BaseView);__reflect(OSATarget47Panel.prototype,"OSATarget47Panel"),window.OSATarget47Panel=OSATarget47Panel;var OSATarget47TabRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAExchangeBtnSkin",e.eselect.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=Activity.ins().activityData[t],i=this.data[1];this.sName=GlobalConfig.ActivityBaseConfig.Type47GroupNames[i]||"待配",this.eRp.visible=e.canRewardByGroup(i)}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eselect.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(OSATarget47TabRender.prototype,"OSATarget47TabRender"),window.OSATarget47TabRender=OSATarget47TabRender;var OSATarget48Panel=function(t){function e(e){var i=t.call(this)||this;return i.curId=1,i.skinName="OSAVipAct",i.activityID=e,i.addTouchEvent(i,i.onClick),i.listDP=new eui.ArrayCollection,i.eList.dataProvider=i.listDP,i.eList.itemRenderer=OSATarget48TabRender,i.eRewardList.itemRenderer=ItemBase,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.eList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update(),this.initView()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.setTime(),this.updateList(),this.updateView()},e.prototype.updateView=function(){var t=GlobalConfig.ActivityType48Config[this.activityID][this.curId],e=this.data.getCurDiscount(this.curId),i=this.data.canBuyNum(this.curId);this.sVipTips=VipCT.getVipStr(t.vip,!0)+"限定",this.sRewardName=t.name,this.sBuyTips="限购\n"+this.data.canBuyNum(this.curId)+"/"+t.max,this.eSureBtn.visible=i>0,this.sVIPTips2=VipCT.getVipStr(t.vip,!0)+"可购买",this.OriginalPrice.setPrice(t.price),this.sCurPrice=0==e?"???":this.data.getCurPrice(this.curId)+"",this.ShowImg.source=t.showIcon,this.sBtnName=0==e?"折扣抽取":e+"折购买",this.eRewardList.dataProvider=new eui.ArrayCollection(t.award),this.eRp.visible=i>0},e.prototype.updateList=function(){this.listDP.replaceAll(CommonUtils.objectToArray(GlobalConfig.ActivityType48Config[this.activityID]))},e.prototype.onTouchList=function(t){var e=this.eList.getElementAt(this.curId-1);e&&(e.eSelect.visible=!1),e=this.eList.getElementAt(this.eList.selectedIndex),e&&(e.eSelect.visible=!0),this.curId=this.eList.selectedIndex+1,this.updateView()},e.prototype.onClick=function(t){switch(t.target){case this.eSureBtn:var e=this.data.getCurDiscount(this.curId);if(0==e)Activity.ins().sendType48Discount(this.activityID,this.curId);else if(e>0){var i=GlobalConfig.ActivityType48Config[this.activityID][this.curId];Actor.vip<i.vip?TipsCT.ins().showTips("购买失败，"+VipCT.getVipStr(i.vip)+"等级不足"):GlobalFun.checkMoney(this.data.getCurPrice(this.curId))&&Activity.ins().sendReward(this.activityID,this.curId)}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.initView=function(){var t=GlobalConfig.ActivityConfig[this.activityID];this.sDesc=t.desc},e.prototype.setTime=function(){this.sTime=this.data.getRemainTime()},e}(BaseView);__reflect(OSATarget48Panel.prototype,"OSATarget48Panel"),window.OSATarget48Panel=OSATarget48Panel;var OSATarget48TabRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAVipBagItemSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().activityData[t.actid];this.eIcon.source=t.icon;var i=e.getCurDiscount(t.index);this.eTips=0==i?"?折":i+"折",this.eName.source=t.artpicture,this.eSelect.visible=this.selected,this.eRp.visible=e.canBuyNum(t.index)>0}},e}(BaseItemRender);__reflect(OSATarget48TabRender.prototype,"OSATarget48TabRender"),window.OSATarget48TabRender=OSATarget48TabRender;var OSATarget4Item1=function(t){function e(){var e=t.call(this)||this;return e._sn_="OSARankListItemSkin2",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.data&&this.skin){var t=this.data[0];switch(t.ranking){case 1:this.rankImg.source="openserveract_paihang1",this.imgBg.source="openserveract_redBg_png",this.rankNum.text="";break;case 2:this.rankImg.source="openserveract_paihang2",this.imgBg.source="openserveract_orangeBg_png",this.rankNum.text="";break;case 3:this.rankImg.source="openserveract_paihang3",this.imgBg.source="openserveract_purpleBg_png",this.rankNum.text="";break;default:this.rankImg.source="",this.imgBg.source="openserveract_greyBg_png",this.rankNum.text=t.ranking+""}this.reward1.dataProvider=new eui.ArrayCollection(t.rewards),this.reward2.dataProvider=new eui.ArrayCollection(t.rewards2);var e=Activity.ins().getActivityDataById(t.Id);this.name1.text=e.getTypeDesc(t.rankType)+t.value+"\n即可上榜",this.value.text="";var i=this.data[1];if(i){this.name1.text=i.player;var s=e.getTypeDesc(t.rankType);this.value.text=s+i.value}}},e}(BaseItemRender);__reflect(OSATarget4Item1.prototype,"OSATarget4Item1"),window.OSATarget4Item1=OSATarget4Item1;var OSATarget4Panel1=function(t){function e(){var e=t.call(this)||this;return e._sn_="OSARankSkin2",e.time=0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.attr.text=this.myAttrValue.text=this.myRanking.text="",this.rankList.itemRenderer=OSATarget4Item1,this.rankList.dataProvider=this.listDP=new eui.ArrayCollection,this.titleEffNameMc||(this.titleEffNameMc=new MovieClip),this.titleEffNameMc.parent||this.titleMcGroup0.addChild(this.titleEffNameMc),this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eBodyMCGroup1.addChild(this.bodyMc),this.addTouchEvent(this,this.onTap),this.observe(ReadPlayerCT.ins().postPlayerResult,this.updatePraise),this.observe(Activity.ins().postGetDaBiaoInfo,this.updateData),this.observe(Rank.ins().postRankingData,this.initInfo),this.cfg=GlobalConfig.ActivityType4Config[this.activityID];var i=this.cfg[1];i&&i.rankType==RankDataType.TYPE_HF_XIAOFEI?Activity.ins().sendDabiaoInfo(this.activityID):Rank.ins().sendGetRankingData(i.rankType),this.initPlayer()},e.prototype.initInfo=function(t){this.model=t,this.updateData(),this.updateUI()},e.prototype.enterFrame=function(){var t=egret.getTimer();t-this.time>1e3&&(this.time=t,this.actData&&(this.actTime.text=this.actData.getRemainTime()))},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),Timer.stopAll(this),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.seek:this.cfg[0].turn&&ViewManager.ins().open(this.cfg[0].turn[0],this.cfg[0].turn[1],this.cfg[0].turn[2])}},e.prototype.hideWeapon=function(t,e){return!!GlobalConfig.EquipWithEffConfig[t+"_"+e]},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.setWeaponEffect=function(t,e,i,s,n,o){void 0===o&&(o=!1);var a=o?this.getZhuangbanById(t):GlobalConfig.EquipWithEffConfig[t+"_"+i];if(a)if(n.scaleX=n.scaleY=o?.9:a.scaling,n.parent||s.addChild(n),n.x=o?this[e+i].x-20:this[e+i].x+a.offX-2,n.y=o?this[e+i].y+65:this[e+i].y+a.offY+42,o){var r=this.getZhuangbanById(t);n.playFile(RES_DIR_DRESS+r.res+"_"+i+"_c_m",-1)}else n.playFile(RES_DIR_EFF+a.inShowEff,-1);else n.parent&&n.parent.removeChild(n)},e.prototype.updatePraise=function(t){if(this.wingEffect1.removeChildren(),this.wingEffect0.removeChildren(),this.initPlayer(),t){this.player.text=t.name+"",this.guild.text=t.guildName+"";var e=t.roleData[0];if(this.deEff&&(this.deEff.stop(),DisplayUtils.removeFromParent(this.deEff)),e){var i=GlobalConfig.ClientGlobalConfig.useManRes?0:e.sex,s=GlobalConfig.EquipConfig[e.clothID];if(s){var n=s.appearance;n&&n.indexOf("[job]")>-1&&(n=n.replace("[job]",e.job+"")),this.bodyImg1.source=(e.clothID>0?n+"_":e.job+"00_")+e.sex+"_c_png"}else this.bodyImg1.source="body000_"+e.sex+"_c_png";var o=GlobalConfig.EquipConfig[e.swordID];if(o){var n=GlobalConfig.EquipConfig[e.swordID].appearance;n&&n.indexOf("[job]")>-1&&(n=n.replace("[job]",e.job+"")),this.weaponImg1.source=this.hideWeapon(e.swordID,e.sex)?"":e.swordID>0?n+"_"+i+"_c_png":""}else this.weaponImg1.source="";var a=GlobalConfig.WingLevelConfig[e.wingLevel];a?this.wingImg1.source=e.wingLevel>=0?a.appearance+"_png":"":this.wingImg1.source="";var r=e.godWingData,l=r.getSuitSum();if(l>=WingCT.GodWingMaxSlot){var h=r.getSuitLevel(),p=GlobalConfig.GodWingSuitConfig[h];this.godWingEff0||(this.godWingEff0=new MovieClip,this.godWingEff00=new MovieClip),this.godWingEff0.parent||(this.wingEffect1.addChild(this.godWingEff0),this.wingEffect0.addChild(this.godWingEff00)),p.suiteff&&p.lv>=2?(this.godWingEff0.visible=!0,this.godWingEff0.playFile(RES_DIR_EFF+p.suiteff,-1),this.godWingEff00.visible=!0,this.godWingEff00.playFile(RES_DIR_EFF+p.suiteff,-1)):(this.godWingEff0.visible=!1,this.godWingEff00.visible=!1)}if(e.pos1>0){var u=this.getZhuangbanById(e.pos1);u.useMc>0?(this.bodyImg1.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+u.res+"_"+e.sex+"_c_m",-1)):(this.bodyMc.visible=!1,this.bodyImg1.visible=!0,this.bodyImg1.source=u.res+"_"+e.sex+"_c_png"),DisplayUtils.removeFromParent(this.bodyEff)}else this.bodyEff||(this.bodyEff=new MovieClip),this.setWeaponEffect(e.clothID,"bPos0_",e.sex,this.bodyEffect1,this.bodyEff);if(e.pos2>0){this.weaponEff||(this.weaponEff=new MovieClip);var u=this.getZhuangbanById(e.pos2);u.useMc>0?(this.weaponImg1.visible=!1,this.setWeaponEffect(e.pos2,"wPos0_",i,this.weaponEffect1,this.weaponEff,!0)):(this.weaponImg1.visible=!0,this.weaponImg1.source=this.getZhuangbanById(e.pos2).res+"_"+i+"_c_png",DisplayUtils.removeFromParent(this.weaponEff))}else this.weaponEff||(this.weaponEff=new MovieClip),this.setWeaponEffect(e.swordID,"wPos0_",i,this.weaponEffect1,this.weaponEff);if(e.pos3>0&&(this.wingImg1.source=this.getZhuangbanById(e.pos3).res+"_png"),e.deCirShowID>0&&(this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.demonCirEff1.addChild(this.deEff),this.deEff.playFile(""+RES_DIR_EFF+GlobalConfig.DemonCirBase[e.deCirShowID].footEff,-1)),e.soulId>0&&e.pos1<=0&&GlobalConfig.EquipConfig[e.swordID]&&!GlobalConfig.EquipConfig[e.swordID].noWSoulEff&&!e.hideWeapons()){var d=GlobalConfig.WeaponSoulConfig[e.soulId];d&&(this.soulEff||(this.soulEff=new MovieClip),this.soulEff.playFile(RES_DIR_EFF+d.inside[e.job-1],-1),this.soldierSoulEff1.addChild(this.soulEff))}else DisplayUtils.removeFromParent(this.soulEff)}}},e.prototype.initPlayer=function(){this.bodyMc.visible=!1,this.bodyImg1.visible=!0,this.bodyImg1.source="body00_png",this.guild.text=this.wingImg1.source=this.weaponImg1.source="",this.player.text="虚位以待",this.weaponEff&&DisplayUtils.removeFromParent(this.weaponEff),this.bodyEff&&DisplayUtils.removeFromParent(this.bodyEff),this.soulEff&&DisplayUtils.removeFromParent(this.soulEff),this.deEff&&DisplayUtils.removeFromParent(this.deEff)},e.prototype.updateData=function(){this.actData=Activity.ins().getActivityDataById(this.activityID);var t,e=this.cfg[0].rankType;if(t=this.model?this.model.getDataList():Activity.ins().rankInfoList){var i=[];for(var s in t)for(var n in this.cfg)if(this.cfg[n].ranking&&!i[this.cfg[n].ranking]&&this.cfg[n].value<=t[s].value){t[s].realPos=this.cfg[n].ranking,i[this.cfg[n].ranking]=t[s];break}i[1]&&i[1].id&&i[1].id!=this.playerId&&(this.playerId=i[1].id,ReadPlayerCT.ins().sendFindPlayer(i[1].id,Actor.serverName));var o,a=[];for(var n in this.cfg)this.cfg[n].ranking&&(a.push([this.cfg[n],i[+n]]),i[+n]&&i[+n].id==Actor.actorID&&(o=i[+n].realPos));this.listDP.replaceAll(a),this.attr.text=this.actData.getAttrDesc(e),this.myAttrValue.text="0",this.model&&this.model.selfPos&&t[this.model.selfPos-1]&&(this.myAttrValue.text=t[this.model.selfPos-1].value),o?this.myRanking.text=o+"":this.myRanking.text="20名以后"}},e.prototype.updateUI=function(){if(this.cfg[0].titleEffName){var t=this.cfg[0].titleEffName;this.titleEffNameMc.playFile(RES_DIR_EFF+t,-1)}else this.titleImg0.source=RES_DIR_CHENGHAO+this.cfg[0].titleName;this.rankName.text=this.actData.getRankName(this.cfg[0].rankType)+"榜";var e=Object.keys(this.cfg).length-1;if(this.desc1.text="上榜前"+e,this.value.text=this.desc2.text="",this.rank0.text=this.power0.text=this.attr0.text="",this.rank1.text=this.power1.text=this.attr1.text="",this.cfg[e].value){var i=this.actData.getTypeDesc(this.cfg[e].rankType);this.desc2.text="且"+i+"达到",this.value.text=""+this.cfg[e].value}if(this.cfg[e].rewards2){var s=this.cfg[e].rewards2[0].id,n=GlobalConfig.ItemConfig[s];this.rank0.text="前"+e+"名:"+n.name;var o=Title.getTitleCfgByItemId(n.id),a=BagCT.getAttrPower(o.attrs);this.power0.text="战力+"+3*a;for(var r=[],l=o.sysadd?o.sysadd.length:0;l--;){var i=Title.ins().attrDesc(o.sysadd[l]);r[l]=i.h.replace(":","+")+i.t+"\n"}o.sysadd&&(this.attr0.text=r+"")}if(this.cfg[1].rewards2){var s=this.cfg[1].rewards2[0].id,n=GlobalConfig.ItemConfig[s];this.rank1.text="第一名:"+n.name;var o=Title.getTitleCfgByItemId(n.id),a=BagCT.getAttrPower(o.attrs);this.power1.text="战力+"+3*a;for(var r=[],l=o.sysadd?o.sysadd.length:0;l--;){var i=Title.ins().attrDesc(o.sysadd[l]);r[l]=i.h.replace(":","+")+i.t+"\n"}o.sysadd&&(this.attr1.text=r+"")}},e}(BaseView);__reflect(OSATarget4Panel1.prototype,"OSATarget4Panel1"),window.OSATarget4Panel1=OSATarget4Panel1;var OSATarget51Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="EquipRecoverySkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this,this.onClick),this.setTime(),Timer.start(1e3,0,this.setTime,this);var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=""+i.desc},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.setTime=function(){this.actTime1.text=this.activityData.getRemainTime()},e.prototype.onClick=function(t){switch(t.target){case this.pay:ViewManager.ins().open(SmeltEquipTotalWin)}},e}(BaseView);__reflect(OSATarget51Panel.prototype,"OSATarget51Panel"),window.OSATarget51Panel=OSATarget51Panel;var OSATarget52ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.showText.textFlow=TextFlowMaker.generateTextFlow(this.data))},e}(BaseItemRender);__reflect(OSATarget52ItemRender.prototype,"OSATarget52ItemRender"),window.OSATarget52ItemRender=OSATarget52ItemRender;var OSATarget52Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDGoodluckTurntableSkin",e.eTips.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.eTips.text+"</u>"),e.eTips.touchEnabled=!0,e.listDP=new eui.ArrayCollection,e.list.itemRenderer=OSATarget52ItemRender,e.list.dataProvider=e.listDP,e.mcUp=new MovieClip,e.mcUp.playFile(RES_DIR_EFF+"TurnEff_1",-1),e.mcDown=new MovieClip,e.mcDown.playFile(RES_DIR_EFF+"TurnEff_2",-1),e.eUpGroup.addChild(e.mcUp),e.eDownGroup.addChild(e.mcDown),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.config=GlobalConfig.ActivityType52Config,this.observe(Activity.ins().postRewardResult,this.resultCallBack),this.observe(Activity.ins().postAddTips52,this.updateData),this.addTouchEvent(this,this.onClick),this.updateData()},e.prototype.updateData=function(){this.actData=Activity.ins().activityData[this.activityID];var t=this.config[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n)}for(var a in this.config[this.activityID])if(+a){var r=this.config[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.showReward,i.rewardState(!1)}this.totalPower.text=this.actData.totoYb+"",this.listDP.source=this.actData.tips},e.prototype.resultCallBack=function(t){this.actData=Activity.ins().activityData[this.activityID],this.actData&&this.activityID==t&&(this.actData.indexs.length>1?ViewManager.ins().open(LuckyResultWinEx,this.activityID,this.actData.indexs):1==this.actData.indexs.length&&this.beginLottery(this.actData.indexs[0]),this.updateData())},e.prototype.enterFrame=function(){this.sTime=this.actData?this.actData.getRemainTime():""},e.prototype.onClick=function(t){switch(t.target){case this.choujiangBtn:this.getLottery();break;case this.eTips:var e=this.config[this.activityID][0];ViewManager.ins().open(ShowChanceWin,e.showReward)}},e.prototype.beginLottery=function(t){var e=this,i=1440+30*(t-1),s=egret.Tween.get(this.tttzhi);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,1,2);var i=GlobalConfig.ItemConfig[e.actData.itemList[0].id];i?e.flyItem(e["item"+(t-1)],e.actData.itemList[0]):e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t,e){var i=new ItemBase;i.x=t.x,i.y=t.y,i.data=e?e:t.itemIcon.data,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,t.parent.addChild(i),GameLogic.ins().postFlyItemEx(i)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=this.config[this.activityID][0];if(this.turnten.selected){var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);if(e&&e.count)Activity.ins().sendReward(this.activityID,2);else{var i=10,s=t.yb*i;HuntWarnBuyWin.showBuyWarn("LuckyResultWinEx"+this.activityID+"-10",this.checkSend10.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}else{var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);if(e&&e.count)Activity.ins().sendReward(this.activityID,1,1);else{var i=1,s=1*t.yb;HuntWarnBuyWin.showBuyWarn("LuckyResultWinEx"+this.activityID+"-1",this.checkSend1.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}},e.prototype.checkSend10=function(){this.actData&&(this.actData.getIsRollTen(this.activityID)?Activity.ins().sendReward(this.activityID,2):TipsCT.ins().showTips("元宝不足"))},e.prototype.checkSend1=function(){this.actData&&(this.actData.getRollSum(this.activityID)||Actor.yb>=this.config[this.activityID][0].yb?Activity.ins().sendReward(this.activityID,1,1):TipsCT.ins().showTips("元宝不足"))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e}(BaseView);__reflect(OSATarget52Panel.prototype,"OSATarget52Panel"),window.OSATarget52Panel=OSATarget52Panel;var OSATarget53Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42BigRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;if(e&&e.id){this.days.text="",this.reward.data=e.content[1];var i=PActivity.ins().activityData[e.id];i.dayNum>e.day||i.dayNum==e.day&&i.costRecord?this.state.visible=!0:this.state.visible=!1}},e}(BaseItemRender);__reflect(OSATarget53Item.prototype,"OSATarget53Item"),window.OSATarget53Item=OSATarget53Item;var OSATarget53ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyGiftTaskSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data[0]){var t=this.data[0],e=GlobalConfig.PActivityType53Config[t.id][t.rewardId][this.data[1]];this.cost.text=e.price+"",this.buy.enabled=t.dayNum==this.data[1],this.already.visible=!!t.costRecord&&t.dayNum==this.data[1]||t.dayNum>this.data[1],this.eBuy.visible=!this.already.visible,this.eList.dataProvider=new eui.ArrayCollection(e.content),this.dayName.text="第"+this.data[1]+"天礼包",this.redPoint.visible=t.dayNum==this.data[1]&&!t.costRecord&&Actor.yb>=e.price}},e}(BaseItemRender);__reflect(OSATarget53ItemRender.prototype,"OSATarget53ItemRender"),window.OSATarget53ItemRender=OSATarget53ItemRender;var OSATarget53Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyGift",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),this.addTouchEvent(this,this.onClick),this.updateData();var i=GlobalConfig.PActivityConfig[this.activityID];this.desc.text=i.desc},e.prototype.updateData=function(){this.actData=PActivity.ins().activityData[this.activityID],this.config=GlobalConfig.PActivityType53Config[this.activityID][this.actData.rewardId],this.update()},e.prototype.update=function(){var t=[],e=[];for(var i in this.config){t.push([this.actData,Number(i)]);var s=this.config[i];s.content.length>1&&e.push(s)}t.sort(this.sort),this.itemList.dataProvider=new eui.ArrayCollection(t),e.sort(this.sort2),e=e.concat(e),this.showList.dataProvider=new eui.ArrayCollection(e),this.showList.validateNow(),this.showListEff()},e.prototype.showListEff=function(){var t=this;this.showList.scrollH=0;var e=this.showList.dataProvider.length/2;egret.Tween.removeTweens(this.showList);var i=egret.Tween.get(this.showList,{loop:!0});i.to({scrollH:90*e},GlobalConfig.ClientGlobalConfig.time).call(function(){t.showList.scrollH=0})},e.prototype.sort2=function(t,e){return Algorithm.sortDesc(t.id,e.id)},e.prototype.sort=function(t,e){var i=e[0].dayNum;return(i==t[1]&&t[0].costRecord||i>t[1])&&(i==e[1]&&e[0].costRecord||i>e[1])?Algorithm.sortAsc(t[1],e[1]):i==e[1]&&e[0].costRecord||i>e[1]?-1:Algorithm.sortAsc(t[1],e[1])},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof OSATarget53ItemRender){var e=this.config[this.actData.dayNum],i=t.target.parent.parent.data,s=e.price;Actor.yb<s?TipsCT.ins().showTips("元宝不足"):PActivity.ins().sendReward(this.activityID,i[0].rewardId,i[0].dayNum)}},e.prototype.close=function(){this.removeObserve(),this.showList&&egret.Tween.removeTweens(this.showList)},e}(BaseView);__reflect(OSATarget53Panel.prototype,"OSATarget53Panel"),window.OSATarget53Panel=OSATarget53Panel;var OSATarget54Item=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),t.prototype.setImgBg2.call(this,this.data.imgBg),t.prototype.setJueban.call(this,this.data.jueban)},e.prototype.onClick=function(){},e}(ItemBase);__reflect(OSATarget54Item.prototype,"OSATarget54Item"),window.OSATarget54Item=OSATarget54Item;var OSATarget54Item1=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddBreakDownItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.reward.dataProvider=new eui.ArrayCollection(this.data.showDrop),this.gift.setData(GlobalConfig.ItemConfig[this.data.itemId]))},e}(BaseItemRender);__reflect(OSATarget54Item1.prototype,"OSATarget54Item1"),window.OSATarget54Item1=OSATarget54Item1;var OSATarget54Panel=function(t){function e(){var e=t.call(this)||this;return e.canClick=!0,e.curValue=1,e.GRAYIMG_WIDTH=0,e.skinName="ZXPoorOddMainSkin",e.mc=new MovieClip,e.mc.y=0,e.bosseff.addChild(e.mc),e
}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.grayImg=new eui.Image,this.grayImg.source="bar15Skin",this.observe(BagCT.ins().postItemCountChange,this.updateData),this.observe(BagCT.ins().postItemAdd,this.updateData),this.observe(BagCT.ins().postItemDel,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateBoss),this.addTouchEvent(this,this.onClick),this.isShow=!1,this.canClick=!0,this.updateData(),this.setTime()},e.prototype.setTime=function(){this.actData&&(this.eTime.text=this.actData.getRemainTime())},e.prototype.updateData=function(){this.actData=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityType54_1Config[this.activityID],e=[];for(var i in t){var s=GlobalConfig.ItemConfig[t[i].itemId],n=BagCT.ins().getBagItemById(s.id),o={type:1,id:s.id,count:n?n.count:0,isRedPoint:n?1:0,eff:t[i].eff,jueban:t[i].jueban,imgBg:t[i].imgBg};e.push(o)}this.reward.dataProvider=new eui.ArrayCollection(e),this.updateBoss()},e.prototype.updateBoss=function(){var t=this,e=GlobalConfig.ActivityType54Config[this.activityID],i=e.boss,s=GlobalConfig.MonstersConfig[i];this.nameTxt.text=s.name+"",this.head.source="monhead"+s.head+"_png",this.isShow||this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_3r"),-1),this.actData.isDie?(this.canClick=!1,this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_3d"),1,function(){t.actData.isDie=!1,t.bloodBar.value=0,t.bloodBar.maximum=e.hp,t.myTxt.text="Lv."+(t.actData.bossLevel-1),Timer.start(1500,1,function(){t.mc.y=-140,t.mc.playFile(RES_DIR_EFF+"fuhuoEff2",1,function(){t.canClick=!0,t.mc.y=0,t.myTxt.text="Lv."+t.actData.bossLevel,t.bloodBar.value=t.actData.bossHp,t.bloodBar.maximum=e.hp,t.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_3r"),-1,null,!1)},!1)},t)},!1)):(this.myTxt.text="Lv."+this.actData.bossLevel,this.bloodBar.value=this.actData.bossHp,this.bloodBar.maximum=e.hp),this.barGroup.visible=this.bloodBar.value>0,this.curValue=Math.floor(this.bloodBar.value/e.hp*100),this.tweenBlood(),this.actData.itemList.length>0&&this.actData.canFly&&this.flyItem(this.item,this.actData.itemList[0])},e.prototype.tweenBlood=function(){var t=this,e=this.curValue*this.GRAYIMG_WIDTH/100;if(egret.Tween.removeTweens(this.grayImg),!(3>e)){var i=egret.Tween.get(this.grayImg);i.to({width:e-3},1e3).call(function(){0>=e&&(t.grayImg.width=0,egret.Tween.removeTweens(t.grayImg))})}},e.prototype.onClick=function(t){var e=this;if(this.actData.canFly=!1,t.target.parent.parent instanceof OSATarget54Item&&this.canClick){var i=t.target.parent.parent.data,s=BagCT.ins().getBagItemById(i.id);if(!s||s&&!s.count)TipsCT.ins().showTips("道具不足");else{var n=GlobalConfig.ActivityType54Config[this.activityID],o=n.boss,a=GlobalConfig.MonstersConfig[o];this.isShow=!0,this.mc.playFile(RES_DIR_MONSTER+(a.avatar+"_3h"),1,function(){e.mc.playFile(RES_DIR_MONSTER+(a.avatar+"_3r"),-1,null,!1)},!1),this.itemMc=new MovieClip,this.itemMc.playFile(RES_DIR_SKILLEFF+i.eff,1),this.bosseff.addChild(this.itemMc),Activity.ins().sendReward(this.activityID,null,null,i.id)}}switch(t.target){case this.awardBtn:ViewManager.ins().open(OSATarget54Panel1,this.activityID);break;case this.ruleBtn:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[61].text)}},e.prototype.flyItem=function(t,e){this.actData.canFly=!1;var i=new ItemBaseNoTap;i.x=t.x,i.y=t.y,i.data=e,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,t.parent.addChild(i),GameLogic.ins().postFlyItemEx(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.grayImg&&egret.Tween.removeTweens(this.grayImg),Timer.stopAll(this)},e}(BaseView);__reflect(OSATarget54Panel.prototype,"OSATarget54Panel"),window.OSATarget54Panel=OSATarget54Panel;var OSATarget54Panel1=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZXPoorOddBreakDownSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actID=t[0],this.update()},e.prototype.update=function(){var t=GlobalConfig.ActivityType54_1Config[this.actID],e=[];for(var i in t)e.push(t[i]);this.itemList.dataProvider=new eui.ArrayCollection(e)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(OSATarget54Panel1.prototype,"OSATarget54Panel1"),window.OSATarget54Panel1=OSATarget54Panel1,ViewManager.ins().reg(OSATarget54Panel1,LayerManager.UI_Popup);var OSATarget56Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="chaozhilibaoItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data[0]){var t=this.data[0],e=this.data[1];this.reward.dataProvider=new eui.ArrayCollection(e.awardItem);var i=e.buyTimeLimit-t.giftData[e.giftId];this.buyNum.text="可购买"+i+"次",this.buyBtn.name=e.ybCount+"_"+e.giftId,this.redPoint.visible=!1,i>0?(this.buyBtn.label=e.ybCount/GlobalConfig.ClientGlobalConfig.rate+"元",this.buyBtn.enabled=!0):(this.buyBtn.label="已购买",this.buyBtn.enabled=!1),this.show.source=e.img?e.img:"",this.des.text=e.giftName+""}},e}(BaseItemRender);__reflect(OSATarget56Item.prototype,"OSATarget56Item"),window.OSATarget56Item=OSATarget56Item;var OSATarget56Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="chaozhilibaoSkin",e.eList.itemRenderer=OSATarget56Item,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postRewardResult,this.update),this.addTouchEvent(this,this.onClick),this.update(),this.setTime(),Timer.start(1e3,0,this.setTime,this)},e.prototype.setTime=function(){if(this.actData){var t=Math.floor((DateUtils.formatMiniDateTime(this.actData.times)-GameServer.serverTime)/1e3),e="";t>=0&&(e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3)),this.times.text=e}},e.prototype.update=function(){this.actData=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityType56Config[this.activityID],e=[];for(var i in t)e.push([this.actData,t[i]]);this.eList.dataProvider=new eui.ArrayCollection(e),this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof OSATarget56Item){var e=t.target.parent.parent.data,i=e[1].rid;if(GlobalConfig.ClientGlobalConfig.oldRecharge||!i){if(t.target.name){var s=t.target.name.split("_");Recharge.ins().showReCharge(+s[0],ShowRechargeType.Type_DailyGift,this.activityID+"_"+ +s[1])}}else Recharge.ins().sendPayOrder(i)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e}(BaseView);__reflect(OSATarget56Panel.prototype,"OSATarget56Panel"),window.OSATarget56Panel=OSATarget56Panel;var OSATarget57Item=function(t){function e(){var e=t.call(this)||this;return e._sn_="BossFirstKillItemSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.data&&this.skin){var t=this.data.cfg;this.redPoint.visible=this.data.showRed;var e=GlobalConfig.MonstersConfig[t.bossId];this.iconDisplay.source="monhead"+e.head+"_png",this.boss.text=e.name+"",this.level.text=t.desc+"",this.killer.text=this.data.bossData.player+"",this.killImg.visible=!!this.data.bossData.player,this.noAct.visible=!1,this.firstBlood.visible=!!this.data.rewardData.belong,this.selffirstBlood.visible=!!this.data.rewardData.person}},e}(BaseItemRender);__reflect(OSATarget57Item.prototype,"OSATarget57Item"),window.OSATarget57Item=OSATarget57Item;var OSATarget57Panel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.activityType=ActivityType.Normal,e.tabIndex=0,e.selectIndex=0,e.canChange=!1,e._sn_="BossFirstKillSkin",e.isTopLevel=!0,e.bossList=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.list0.itemRenderer=ItemBossBase,this.list1.itemRenderer=ItemBase,this.menuList0.itemRenderer=OSATarget57Item,this.menuList0.dataProvider=this.listDP=new eui.ArrayCollection,this.menuList1.itemRenderer=OSATarget57TabItem,this.menuList1.dataProvider=this.tabDP=new eui.ArrayCollection,this.effect=new MovieClip,this.eff.addChild(this.effect)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actID=t[0],this.curPageStyle=t[1],this.activityType=t[2],this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType57Config[this.actID]):this.activityType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType57Config[this.actID]),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList1,this.onClickMenu1),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller1,this.onChange1),this.addChangeEvent(this.menuList0,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller0,this.onChange),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),this.updateData(),this.tabIndex=0,this.menuList1.selectedIndex=this.tabIndex,this.canChange=!0,this.updateView(),this.onChange1(),this.onChange(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.setTime()},e.prototype.updateData=function(){this.data=this.ins.getActivityDataById(this.actID),this.updateTabs(),this.updateView()},e.prototype.updateTabs=function(){var t=GlobalConfig.ActivityBaseConfig.Type57Tab,e=[];for(var i in this.data.bossData)e.push({res:t[i],showRed:this.data.checkTypeAward(+i)});this.tabDP.replaceAll(e)},e.prototype.onTouch=function(t){var e=430,i=0,s=512,n=0;switch(t.target){case this.leftBtn1:i=this.menuList1.scrollH-e,i=86*Math.round(i/86),0>i&&(i=0),this.menuList1.scrollH=i,this.onChange1();break;case this.rightBtn1:i=this.menuList1.scrollH+e,i=86*Math.round(i/86),i>this.menuList1.contentWidth-this.menuScroller1.width&&(i=this.menuList1.contentWidth-this.menuScroller1.width),this.menuList1.scrollH=i,this.onChange1();break;case this.leftBtn0:n=this.menuList0.scrollH-s,n=86*Math.round(n/86),0>n&&(n=0),this.menuList0.scrollH=n,this.onChange();break;case this.rightBtn0:n=this.menuList0.scrollH+s,n=86*Math.round(n/86),n>this.menuList0.contentWidth-this.menuScroller1.width&&(n=this.menuList0.contentWidth-this.menuScroller1.width),this.menuList0.scrollH=n,this.onChange();break;case this.buy:var o=GlobalConfig.ActivityBaseConfig.Type57Turn[this.tabIndex+1];1==this.bossList[this.selectIndex].rewardData.belong?this.ins.sendReward(this.actID,this.bossList[this.selectIndex].cfg.idx,1):1==this.bossList[this.selectIndex].rewardData.all?this.ins.sendReward(this.actID,this.bossList[this.selectIndex].cfg.idx,2):1==this.bossList[this.selectIndex].rewardData.person?this.ins.sendReward(this.actID,this.bossList[this.selectIndex].cfg.idx,3):ViewManager.ins().open(o[0],o[1],o[2])}},e.prototype.onChange1=function(){this.menuList1.scrollH<20?(this.leftBtn1.visible=!1,this.rightBtn1.visible=!0):this.menuList1.scrollH>88*(this.menuList1.dataProvider.length-5)+2?(this.leftBtn1.visible=!0,this.rightBtn1.visible=!1):(this.leftBtn1.visible=!0,this.rightBtn1.visible=!0),this.leftRed1.visible=this.rightRed1.visible=!1;var t=this.menuList1.dataProvider.length;if(5>=t)this.leftBtn1.visible=!1,this.rightBtn1.visible=!1;else{var e=Math.floor(this.menuList1.scrollH/76)+4;if(this.leftBtn1.visible)for(var i=0;e-5>=i;i++)if(this.data.checkTypeAward(i+1)){this.leftRed1.visible=!0;break}if(this.rightBtn1.visible)for(var i=e+1;t>i;i++)if(this.data.checkTypeAward(i+1)){this.rightRed1.visible=!0;break}}},e.prototype.onChange=function(){this.menuList0.scrollH<20?(this.leftBtn0.visible=!1,this.rightBtn0.visible=!0):this.menuList0.scrollH>88*(this.menuList0.dataProvider.length-4)+2?(this.leftBtn0.visible=!0,this.rightBtn0.visible=!1):(this.leftBtn0.visible=!0,this.rightBtn0.visible=!0),this.leftRed0.visible=this.rightRed0.visible=!1;var t=this.menuList0.dataProvider.length;if(4>=t)this.leftBtn0.visible=!1,this.rightBtn0.visible=!1;else{var e=Math.floor(this.menuList0.scrollH/118)+3;if(this.leftBtn0.visible)for(var i=0;e-4>=i;i++)if(this.data.checkAward(this.tabIndex+1,this.bossList[i].index)){this.leftRed0.visible=!0;break}if(this.rightBtn0.visible)for(var i=e+1;t>i;i++)if(this.data.checkAward(this.tabIndex+1,this.bossList[i].index)){this.rightRed0.visible=!0;break}}},e.prototype.onClickMenu1=function(t){this.tabIndex!=t.currentTarget.selectedIndex&&(this.tabIndex=t.currentTarget.selectedIndex,this.menuList1.selectedIndex=this.tabIndex,this.canChange=!0,this.updateView(),this.onChange())},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(this.selectIndex=t.currentTarget.selectedIndex,this.menuList0.selectedIndex=this.selectIndex,this.updateView())},e.prototype.updateBossItem=function(t){this.selectIndex=0;for(var e in t)if(1==t[e].rewardData.belong||1==t[e].rewardData.all||1==t[e].rewardData.person){this.selectIndex=+e;break}this.menuList0.selectedIndex=this.selectIndex,this.menuList0.scrollH=this.menuList0.contentWidth>485?90*this.selectIndex:0,this.updateUI(),this.onChange()},e.prototype.updateView=function(){var t=[],e=[];for(var i in this.data.bossData[this.tabIndex+1]){var s=this.data.bossData[this.tabIndex+1][i].index;this.data.checkGetAward(this.tabIndex+1,+i)?t.push({index:+i,cfg:this.cfgs[s],bossData:this.data.bossData[this.tabIndex+1][i],rewardData:this.data.rewardData[this.tabIndex+1][i],showRed:this.data.checkAward(this.tabIndex+1,+i)}):e.push({index:+i,cfg:this.cfgs[s],bossData:this.data.bossData[this.tabIndex+1][i],rewardData:this.data.rewardData[this.tabIndex+1][i],showRed:this.data.checkAward(this.tabIndex+1,+i)})}t.sort(this.sort),e.sort(this.sort),this.bossList=e.concat(t),this.listDP.replaceAll(this.bossList),this.canChange&&(this.canChange=!1,this.updateBossItem(e)),this.updateUI()},e.prototype.updateUI=function(){var t=this.bossList[this.selectIndex];if(t){var e=GlobalConfig.MonstersConfig[t.cfg.bossId];this.effect.playFile(RES_DIR_MONSTER+(e.avatar+"_4s"),-1),this.killer.text=t.bossData.player?t.bossData.player+"":"未击杀",this.redPoint.visible=this.data.checkAward(this.tabIndex+1,t.index);var i=ZsCT.ins().lv>=t.cfg.zsLevel&&Actor.level>=t.cfg.level,s=this.data.checkGetAward(this.tabIndex+1,t.index);this.buy.label=this.redPoint.visible?"领取奖励":s?"已领取":i?"前往挑战":"未解锁",this.buy.enabled=this.redPoint.visible||!s&&!!i;var n=t.cfg.belongReward.concat(),o=t.cfg.everyoneReward.concat();for(var a in n)n[a].tagIcon="bosskill_tittle5",n[a].isRedPoint=2==t.rewardData.belong?2:0;for(var r in o)o[r].tagIcon="bosskill_tittle3",o[r].isRedPoint=2==t.rewardData.all?2:0;for(var l in t.cfg.personReward)t.cfg.personReward[l].isRedPoint=2==t.rewardData.person?2:0;n=n.concat(o),this.list0.dataProvider=new eui.ArrayCollection(n),this.list1.dataProvider=new eui.ArrayCollection(t.cfg.personReward)}},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.bossData.index,e.bossData.index)},e.prototype.setTime=function(){var t=this.ins.getActivityDataById(this.actID);t&&(this.actTime.text=t.getRemainTime())},__decorate([callDelay(100)],e.prototype,"updateBossItem",null),e}(BaseEuiView);__reflect(OSATarget57Panel.prototype,"OSATarget57Panel"),window.OSATarget57Panel=OSATarget57Panel,ViewManager.ins().reg(OSATarget57Panel,LayerManager.UI_Main);var OSATarget57TabItem=function(t){function e(){var e=t.call(this)||this;return e._sn_="BossFirstKillIconSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){this.data&&this.skin&&(this.iconDisplay.source=this.data.res,this.redPoint.visible=this.data.showRed)},e}(BaseItemRender);__reflect(OSATarget57TabItem.prototype,"OSATarget57TabItem"),window.OSATarget57TabItem=OSATarget57TabItem;var OSATarget58Item=function(t){function e(e){var i=t.call(this)||this;return i._sn_="ActivityFbItemSkin",i.cfg=e,i}return __extends(e,t),e.prototype.skinComplete=function(){this.x=this.cfg.showPos[0],this.y=this.cfg.showPos[1],this.eGrp.scaleX=this.cfg.showPos[2]||1,this.mc=new MovieClip,this.eBoss.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEvent(egret.Event.CHANGE,this.mc,this.updateMC),this.updateView(),this.update()},e.prototype.updateData=function(t){this.data=t,this.update()},e.prototype.updateMC=function(){this.cfg.cid!=this.data.cid+1&&this.mc.gotoAndStop(1)},e.prototype.update=function(){if(this.data&&this.skin){var t=this.data.cid;this.locked.visible=this.passed.visible=this.eBg.visible=!1,this.eGrp.filters=null,this.mc.playFile(RES_DIR_BODY+(GlobalConfig.MonstersConfig[this.cfg.bossId].avatar+"_3s"),-1),this.cfg.cid==t+1?this.eBg.visible=!0:this.cfg.cid<=t?(this.passed.visible=!0,this.eGrp.filters=FilterUtil.ARRAY_GRAY_FILTER):this.locked.visible=!0,this.currentState="level"+this.cfg.cid}},e.prototype.updateView=function(){this.eName.source="activityFb_level"+this.cfg.cid,this.eItem.data=this.cfg.reward[0]},e}(BaseView);__reflect(OSATarget58Item.prototype,"OSATarget58Item"),window.OSATarget58Item=OSATarget58Item;var OSATarget58Panel=function(t){function e(e){var i=t.call(this)||this;return i.items=[],i.job=["","战士","法师","道士"],i._sn_="ActivityFbSkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.initView(),this.update(),this.setTime(),this.eSscrollV()},e.prototype.initView=function(){if(!(this.items.length>0)){var t=GlobalConfig.ActivityType58Config[this.activityID],e=GlobalConfig.ActivityConfig[this.activityID].source1;e&&(this.eTitle.source=e);for(var i in t){var s=new OSATarget58Item(t[i]);this.eMCGroup.addChild(s),this.items.push(s)}}},e.prototype.eSscrollV=function(){var t=GlobalConfig.ActivityType58Config[this.activityID][this.data.cid+1];this.eS.viewport.scrollV=t?Math.max(0,t.showPos[1]-this.eS.parent.height/2):0},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:Activity.ins().sendReward(this.activityID,1,this.data.cid+1);break;case this.eRankBtn:ViewManager.ins().open(OSATarget58RankWin,this.activityID)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.updateReward(),this.updateItems(),this.updateBtn()},e.prototype.updateBtn=function(){var t=this.data.cid>0&&!GlobalConfig.ActivityType58Config[this.activityID][this.data.cid+1];this.eBtn.visible=!t,this.eAlready.visible=t},e.prototype.updateItems=function(){for(var t in this.items)this.items[t].updateData(this.data)},e.prototype.updateReward=function(){var t=this.data.cid,e=GlobalConfig.ActivityType58Config[this.activityID][t+1],i="";if(e)switch(e.jobLimit.length){case 1:i="仅限"+this.job[e.jobLimit[0]]+"出战";break;case 2:i="仅限"+this.job[e.jobLimit[0]]+"&"+this.job[e.jobLimit[1]]+"出战";break;case 3:i="三角色出战"}this.tips.text=i;var s=CommonUtils.getObjectLength(GlobalConfig.ActivityType58Config[this.activityID]),n=GlobalConfig.ActivityType58Config[this.activityID][s];this.eListL.dataProvider=new eui.ArrayCollection(e?e.reward:n.reward),this.eListR.dataProvider=new eui.ArrayCollection(n.reward)},e.prototype.setTime=function(){this.data&&(this.eTime.text=this.data.getRemainTime())},__decorate([callLater],e.prototype,"eSscrollV",null),e}(BaseView);__reflect(OSATarget58Panel.prototype,"OSATarget58Panel"),window.OSATarget58Panel=OSATarget58Panel;var OSATarget58RankItemRender=function(t){function e(){var e=t.call(this)||this;return e._sn_="ActivityFbRankItemSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.data&&this.skin){var t=this.data,e=t.name,i=t.vip,s=t.power;this.player.text=e,this.ePow.text=s,this.pos.text=this.itemIndex+1+"",this.vip.visible=i>0}},e}(BaseItemRender);__reflect(OSATarget58RankItemRender.prototype,"OSATarget58RankItemRender"),window.OSATarget58RankItemRender=OSATarget58RankItemRender;var OSATarget58RankWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="ActivityFbRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=OSATarget58RankItemRender},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.addTouchEvent(this.bgClose,this.onClick),this.observe(Activity.ins().postRewardResult,this.updateRank),this.updateRank(),Activity.ins().sendReward(this.actId,2)},e.prototype.updateRank=function(){var t=Activity.ins().activityData[this.actId];t?this.eList.dataProvider=new eui.ArrayCollection(t.ranks):this.eList.dataProvider=null,this.eTips.visible=!t||0==t.ranks.length},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(OSATarget58RankWin.prototype,"OSATarget58RankWin"),window.OSATarget58RankWin=OSATarget58RankWin,ViewManager.ins().reg(OSATarget58RankWin,LayerManager.UI_Popup);var OSATarget59Panel=function(t){function e(e){var i=t.call(this)||this;return i._sn_="GuildContrastSkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.observe(Activity.ins().postActivityIsGetAwards,this.update),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.setTime()},e.prototype.onClick=function(t){if(t.target.name){var e=t.target.name;return Actor.actorID==e.id&&Actor.serverName==e.servId?void ViewManager.ins().open(RoleWin):void ViewManager.ins().open(PlayerTipsWin,e)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];var t=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=t&&t.acDesc?t.acDesc:"",this.title.source=t&&t.title?t.title:"";var e=GlobalConfig.ActivityType59Config[this.activityID];this.guild0.text=this.guild1.text="",this.powerPanel0.setPower(0),this.powerPanel1.setPower(0),this.reward0.dataProvider=new eui.ArrayCollection(e[1][1][0].reward),this.reward1.dataProvider=new eui.ArrayCollection(e[1][2][0].reward);for(var i=Object.keys(e[2][1]).length,s=1;i>=s;s++)this["name0_"+s].text=this["name1_"+s].text="虚位以待",this["reward0_"+s].dataProvider=new eui.ArrayCollection(e[2][1][s].reward),this["reward1_"+s].dataProvider=new eui.ArrayCollection(e[2][2][s].reward);var n=this.data.guildData[0],o=this.data.guildData[1];if(n){this["guild"+(n.rank-1)].text=n.name,this["powerPanel"+(n.rank-1)].setPower(n.power);for(var s in n.member)this["name0_"+n.member[s].rank].textFlow=(new egret.HtmlTextParser).parser("<u>"+n.member[s].name+"</u>"),this["name0_"+n.member[s].rank].name=n.member[s]}if(o){this["guild"+(o.rank-1)].text=o.name,this["powerPanel"+(o.rank-1)].setPower(o.power);for(var s in o.member)this["name1_"+o.member[s].rank].textFlow=(new egret.HtmlTextParser).parser("<u>"+o.member[s].name+"</u>"),this["name1_"+o.member[s].rank].name=o.member[s]}},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget59Panel.prototype,"OSATarget59Panel"),window.OSATarget59Panel=OSATarget59Panel;var OSATarget7ItemRender7=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDRXExchangeItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];this.eUse.data=t.itemId,this.eGet.data=t.rewards[0],this.eBtn.enabled=this.eRp.visible=e.getExchange(t.index,1)==Activity.CanGet}},e}(BaseItemRender);__reflect(OSATarget7ItemRender7.prototype,"OSATarget7ItemRender7"),window.OSATarget7ItemRender7=OSATarget7ItemRender7;var OSATarget7Panel7=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDRXExchange",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listDP=new eui.ArrayCollection,this.eList.dataProvider=this.listDP,this.eList.itemRenderer=OSATarget7ItemRender7},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.aCon=GlobalConfig.ActivityConfig[this.activityID],this.config7=GlobalConfig.ActivityType7Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.aCon=GlobalConfig.PActivityConfig[this.activityID],this.config7=GlobalConfig.PActivityType7Config),this.sDesc=this.aCon.desc,this.observe(BagCT.ins().postItemAdd,this.updateList),this.observe(BagCT.ins().postItemChange,this.updateList),this.observe(BagCT.ins().postItemDel,this.updateList),this.observe(Activity.ins().postActivityIsGetAwards,this.updateList),this.addTouchEvent(this,this.onClick),this.updateData()},e.prototype.close=function(){this.removeObserve()},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget7ItemRender7){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var e=t.target.parent.data[0];return void this.ins.sendReward(e.Id,e.index)}},e.prototype.updateData=function(){this.actData=this.ins.getActivityDataById(this.activityID),this.setTime(),this.updateList()},e.prototype.updateList=function(){var t=[],e=this.config7[this.activityID];for(var i in e)t.push([e[i],this.actData]);this.listDP.source=t},e.prototype.setTime=function(){this.actData&&(this.sTime="剩余时间："+this.actData.getRemainTime())},e}(BaseView);__reflect(OSATarget7Panel7.prototype,"OSATarget7Panel7"),window.OSATarget7Panel7=OSATarget7Panel7;var OSATarget9ItemRender6=function(t){function e(){var e=t.call(this)||this;return e.skinName="sevenDayItem",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1],i=this.data[2];this.ItemIcon.data=t,this.eScore.text=Math.min(e.count,t.times)+"",this.eScore.textColor=e.count>=t.times?ColorUtil.GREEN:ColorUtil.RED,this.eLab.text="/"+t.times;var s=e.getStateByIndex(i);this.touchEnabled=this.eGetImg.visible=this.Rp.visible=!1,s?this.eGetImg.visible=!0:this.touchEnabled=this.Rp.visible=e.count>=t.times,this.touchChildren=!this.touchEnabled}},e.prototype.getIndex=function(){return this.data[2]||0},e}(BaseItemRender);__reflect(OSATarget9ItemRender6.prototype,"OSATarget9ItemRender6"),window.OSATarget9ItemRender6=OSATarget9ItemRender6;var OSATarget9Panel6=function(t){function e(){var e=t.call(this)||this;return e.currentState="common",e.hasInit=!0,e.mcUp=new MovieClip,e.mcUp.playFile(RES_DIR_EFF+"TurnEff_1",-1),e.mcDown=new MovieClip,e.mcDown.playFile(RES_DIR_EFF+"TurnEff_2",-1),e}return __extends(e,t),e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="CDRXZhuanpanSkin",this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=OSATarget9ItemRender6,this.eList.dataProvider=this.listDP,this.sDesc=t.desc,this.eUpGroup.addChild(this.mcUp),this.eDownGroup.addChild(this.mcDown)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1,this.actData&&1==this.actData.indexs.length&&this.ins.sendReward(this.activityID,1),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin(),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config),this.observe(this.ins.postChangePage,this.resultCallBack),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this,this.onClick),this.hasInit?(this.hasInit=!1,this.autoChangeState()):this.updateData()},e.prototype.autoChangeState=function(){this.actType==ActivityType.Normal?this.actData=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(this.actData=this.ins.activityData[this.activityID]),this.actData&&((this.actData.count+1)%5==0?"thunder"!=this.currentState&&this.changeState():"thunder"==this.currentState?this.changeState():this.updateData())},e.prototype.changeState=function(){this.rolling||("thunder"==this.currentState?this.currentState="common":this.currentState="thunder",this.updateData())},e.prototype.updateData=function(){var t=this.config9[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id),s=0,n=1,o=13746831;i?(s=i.count,o=s>=n?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+s+"|C:0xD1C28F&T:/"+n)}this.sTips=(this.actData.count+1)%5==0?"已开启豪华热血转盘":"再转"+(5-(this.actData.count+1)%5)+"次即可开启热血转盘";for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data="thunder"==this.currentState?r.sReward[0]:r.reward[0],i.rewardState(!1)}this.updateProgress(),this.setTime()},e.prototype.resultCallBack=function(t){this.actType==ActivityType.Normal?this.actData=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(this.actData=this.ins.activityData[this.activityID]),this.actData&&this.activityID==t&&(this.actData.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,this.actData.indexs):1==this.actData.indexs.length&&this.beginLottery(this.actData.indexs[0]),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1);this.rolling=!0;var s=function(){e.ins.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.autoChangeState()},2e3)};if(this.eCD&&this.eCD.selected)this.tttzhi.rotation=i,s();else{var n=egret.Tween.get(this.tttzhi);n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){s()},this)}},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");if(this.autoChangeState(),BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=this.config9[this.activityID][0],e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);e&&e.count?(this.ins.sendReward(this.activityID,1),this.rolling=!0):TipsCT.ins().showTips("道具不足")},e.prototype.updateProgress=function(){var t,e;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config[this.activityID],e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID],e=PActivity.ins().activityData[this.activityID]);var i=t[0];if(i&&e){this.eScore.text=this.actData.count+"";var s=[];for(var n in i.reward)s.push([i.reward[n],e,+n+1]);this.listDP.source=s}},e.prototype.onClick=function(t){if(t.target instanceof OSATarget9ItemRender6){var e=t.target.getIndex();return void(e>0&&this.ins.sendReward(this.activityID,0,e))}switch(t.target){case this.choujiangBtn:this.getLottery();break;case this.thu:this.changeState()}},e.prototype.setTime=function(){this.actData&&(this.sTime="剩余时间："+this.actData.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel6.prototype,"OSATarget9Panel6"),window.OSATarget9Panel6=OSATarget9Panel6;var QiongQiRankPanel=function(t){function e(){var e=t.call(this)||this;
return e._time=0,e.skinName="ZXPoorOddRankSkin",e.actorIds=[],e}return __extends(e,t),e.prototype.close=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postKuaFuRank,this.updateData),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.activityID=t[0],this.list.itemRenderer=KfCostRankItemRender,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,Activity.ins().sendKuaFuRank(this.activityID),this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=t.GetQRankList();if(e.length?this.currentState="normal":this.currentState="none",this.validateNow(),this.myRanking.text="未上榜","none"!=this.currentState){var i=[],s=e.length>3?e.length:3;this.actorIds=[];for(var n=0,o=0;s>o;o++){var a=e[o];if(3>o){if(a&&a.actorId){var r={actorId:a.actorId,serverId:a.serverId};this.actorIds.push(r),this["playName"+o].text="s"+a.serverId+"."+a.roleName,this["recharge"+o].text="神族等级："+a.level+"级",this["playName"+o].visible=this["recharge"+o].visible=!0}else{var r={actorId:0,serverId:0};this.actorIds.push(r),this["playName"+o].visible=this["recharge"+o].visible=!1}this["rank"+o].data=null}else a&&i.push(a);a&&Actor.actorID==a.actorId&&(n=a.rank)}for(var l=0;l<this.actorIds.length;l++)this.actorIds[l]&&this.actorIds[l].actorId&&ReadPlayerCT.ins().sendFindPlayer(this.actorIds[l].actorId,this.actorIds[l].serverId);this.listdata.replaceAll(i),this._time=t.getleftTime(),this.myRanking.text=n?n+"":"未上榜";var h=this.list.parent;h.stopAnimation(),this.list.scrollV=0}}},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.actorIds.length;e++)this.actorIds[e].actorId==t.id&&(this["rank"+e].data={otherPlayerData:t})},e}(BaseView);__reflect(QiongQiRankPanel.prototype,"QiongQiRankPanel"),window.QiongQiRankPanel=QiongQiRankPanel;var QiongQiRankRewardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZXPoorOddRewardItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.pos.text=t.rank+"",this.level.text="神族等级≥"+t.condition,this.reward.dataProvider=new eui.ArrayCollection(t.rewards)}},e}(BaseItemRender);__reflect(QiongQiRankRewardItem.prototype,"QiongQiRankRewardItem"),window.QiongQiRankRewardItem=QiongQiRankRewardItem;var QiongQiRankRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="ZXPoorOddRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.list.itemRenderer=QiongQiRankRewardItem,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType19Config[this.activityID],i=[];for(var s in e){var n="";n=e[s].range[0]==e[s].range[1]?""+e[s].range[0]:e[s].range[0]+"-"+e[s].range[1];var o=e[s].rewards,a=e[s].condition,r={rank:n,condition:a,rewards:o};i.push(r)}this.listdata.replaceAll(i),this._time=t.getleftTime();var l=this.list.parent;l.stopAnimation(),this.list.scrollV=0,this.setTime()}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text="活动结束时间:"+DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(eui.Component);__reflect(QiongQiRankRewardPanel.prototype,"QiongQiRankRewardPanel"),window.QiongQiRankRewardPanel=QiongQiRankRewardPanel;var ShowChanceWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="CDGoodluckTurntableTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.eLab.textFlow=TextFlowMaker.generateTextFlow(t[0]?t[0]:"")},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShowChanceWin.prototype,"ShowChanceWin"),window.ShowChanceWin=ShowChanceWin,ViewManager.ins().reg(ShowChanceWin,LayerManager.UI_Popup);var FashionLeasingWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="AppearanceLeaseSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=OSATarget49ItemRender,this.eList.dataProvider=this.listDP,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.setTime(),this.updateView()},e.prototype.updateView=function(){var t=GlobalConfig.ActivityType49Config[this.activityID];this.listDP.source=CommonUtils.objectToArray(t)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof OSATarget49ItemRender)return void t.target.parent.parent.onClick();switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e.prototype.setTime=function(){this.sTime=this.data.getRemainTime()},e}(BaseEuiView);__reflect(FashionLeasingWin.prototype,"FashionLeasingWin"),window.FashionLeasingWin=FashionLeasingWin,ViewManager.ins().reg(FashionLeasingWin,LayerManager.UI_Main);var OSATarget49ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="AppearanceLeaseItemRenderSkin",e.mc=new MovieClip,e.EffGrp.addChild(e.mc),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().activityData[t.actid],i=e.dressId,s=GlobalConfig.ZhuangBanId[t.zbId];this.eImg.source=s.res+"_0_c_png",s.res?(this.eImg.visible=!1,this.mc.visible=!0,this.mc.playFile(RES_DIR_DRESS+s.res+"_0_c_m",-1)):(this.eImg.visible=!0,this.mc.visible=!1,this.mc.stop()),this.numStr=(i>=t.index?0:t.price-e.hasPay)+"",this.attrStr=t.tips1,this.attrStr1=t.tips2,this.eLab.text="总返还\n"+2*t.price+"元宝",this.ybNum.text=t.price+"";var n=e.hasRecharge<t.price?16711680:3532333,o=GlobalConfig.ClientGlobalConfig.rate;this.desc.textFlow=TextFlowMaker.generateTextFlow1("充值|C:0x35E62D&T:"+t.price/o+"元|即可租赁（|C:"+n+"&T:"+e.hasRecharge/o+"|/|C:0x35E62D&T:"+t.price/o+"|）"),this.eBuy.visible=!e.hasBuyById(t.index),this.buyLab.visible=!this.eBuy.visible}},e.prototype.onClick=function(){var t=this.data,e=Activity.ins().activityData[t.actid],i=e.dressId;i>t.index?TipsCT.ins().showTips("已经有更高等级的时装了！"):e.hasRecharge<t.chargeAmountLimit?TipsCT.ins().showTips("|C:0xF3311E&T:累充"+t.chargeAmountLimit+"元宝即可租赁|"):GlobalFun.checkMoney(t.price-e.hasPay)&&Activity.ins().sendReward(t.actid,t.index)},e}(BaseItemRender);__reflect(OSATarget49ItemRender.prototype,"OSATarget49ItemRender"),window.OSATarget49ItemRender=OSATarget49ItemRender;var HappySevenDayWin2=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSelect=1,e.activityType=ActivityType.Normal,e._sn_="SpringDayWin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.dayViews=[this.eDay1,this.eDay2,this.eDay3,this.eDay4,this.eDay5,this.eDay6,this.eDay7],this.list0DP=new eui.ArrayCollection,this.list0.itemRenderer=ItemBase,this.list0.dataProvider=this.list0DP,this.listDP=new eui.ArrayCollection,this.list.itemRenderer=HSDTaskItemRender,this.list.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateView),this._activityID=t[0],this.curPageStyle=t[1],this.activityType=t[2];var i=this.activityType==ActivityType.Normal?GlobalConfig.ActivityConfig[this._activityID]:GlobalConfig.PActivityConfig[this._activityID];i.pageSkin&&(this._sn_=i.pageSkin),this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType11_1Config[this._activityID],this.cfg2=GlobalConfig.ActivityType11_2Config[this._activityID]):this.activityType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType11_1Config[this._activityID],this.cfg2=GlobalConfig.PActivityType11_2Config[this._activityID]),Timer.start(1e3,0,this.setTime,this),this.actInfo.text=i.desc,this.initDaysView(),this.updateView()},e.prototype.onClick=function(t){if(t.target instanceof HSDItemView){var e=t.target.day;if(e==this.curSelect)return;return this.dayViews[this.curSelect-1].select=!1,t.target.select=!0,this.curSelect=e,void this.updateView()}if(t.target instanceof eui.Button&&t.target.parent instanceof HSDTaskItemRender){var i=t.target.parent.data;return void this.ins.sendReward(this._activityID,i.index,2)}switch(t.target){case this.actBtn:var s=this.ins.getActivityDataById(this._activityID),n=s.getGroupRewardState(this.curSelect);switch(n){case 1:this.ins.sendReward(this._activityID,this.curSelect,1);break;case 0:TipsCT.ins().showTips("请完成任务后再试")}}},e.prototype.updateView=function(){this.sDayImg="springDay"+this.curSelect+"_1",this.list0DP.source=this.cfgs[this.curSelect].reward,this.updateDaysView(),this.updateTask()},e.prototype.updateTask=function(){var t=this.ins.getActivityDataById(this._activityID),e=t.getGroupTaskFinishNum(this.curSelect),i=t.getCfg2ByGroup(this.curSelect).length;switch(this.sTaskLab="任务（"+e+"/"+i+"）",this.listDP.source=t.getCfg2ByGroup(this.curSelect),this.eGetImg.visible=this.eRed.visible=!1,t.getGroupRewardState(this.curSelect)){case 1:this.eRed.visible=this.actBtn.visible=!0;break;case 2:this.eGetImg.visible=!0,this.actBtn.visible=!1;break;default:this.actBtn.visible=!0}this.curSelect>1&&0==t.getGroupRewardState(this.curSelect-1)?(this.eBtnTips.textFlow=TextFlowMaker.generateTextFlow(this.cfgs[this.curSelect-1].showText),this.eBtnTips.visible=!0):this.eBtnTips.visible=!1,this.eBtnGroup.visible=!this.eBtnTips.visible},e.prototype.initDaysView=function(){for(var t=this.dayViews.length,e=0;t>e;e++)this.dayViews[e].day=e+1,this.dayViews[e].select=e+1==this.curSelect},e.prototype.updateDaysView=function(){for(var t=this.ins.getActivityDataById(this._activityID),e=this.dayViews.length,i=1;e>=i;i++){this.dayViews[i-1].showRed(!1);var s=1==i&&1==t.getGroupRewardState(i)||i>1&&1==t.getGroupRewardState(i)&&t.getGroupRewardState(i-1)>=1;if(s)this.dayViews[i-1].showRed(s);else{var n=t.getCfg2ByGroup(i);for(var o in n)if(1==t.getTaskState(n[o].index)){this.dayViews[i-1].showRed(!0);break}}}},e.prototype.setTime=function(){var t=this.ins.getActivityDataById(this._activityID);t&&(this.actTime.text=t.getRemainTime())},e}(BaseEuiView);__reflect(HappySevenDayWin2.prototype,"HappySevenDayWin2"),window.HappySevenDayWin2=HappySevenDayWin2,ViewManager.ins().reg(HappySevenDayWin2,LayerManager.UI_Main);var HSDItemView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._red=!1,e._sn_="SpringDayItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchEnabled=!0,this.touchChildren=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){this.skin&&this._day&&(this.eImg.source="springDay"+this._day,this.showRed(this._red))},Object.defineProperty(e.prototype,"day",{get:function(){return this._day},set:function(t){this._day=t,this.update()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"select",{set:function(t){this.currentState=t?"done":"normal"},enumerable:!0,configurable:!0}),e.prototype.showRed=function(t){this._red=t,this.skin&&(this.redpoint.visible=this._red)},e}(BaseView);__reflect(HSDItemView.prototype,"HSDItemView"),window.HSDItemView=HSDItemView;var HSDTaskItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="SpringDayProjectItemSkin",e.listDP=new eui.ArrayCollection,e.list.itemRenderer=ItemBase,e.list.dataProvider=e.listDP,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.listDP.source=t.reward,this.redpoint.visible=this.eGetImg.visible=!1;var e=Activity.ins().getActivityDataById(t.id);if(e||(e=PActivity.ins().getActivityDataById(t.id)),e){var i=e.getTaskState(t.index);switch(i){case 1:this.redpoint.visible=this.actBtn.visible=this.actBtn.enabled=!0,this.actBtn.label="领取";break;case 2:this.eGetImg.visible=!0,this.actBtn.visible=!1;break;default:this.actBtn.visible=!0,this.actBtn.enabled=!1,this.actBtn.label="未完成"}this.pName.textFlow=TextFlowMaker.generateTextFlow(t.name+"\n"+("（|C:"+(0==i?ColorUtil.RED:ColorUtil.GREEN)+"&T:"+e.achieveInfo[t.index-1].times+"/"+t.target+"|）"))}}},e}(BaseItemRender);__reflect(HSDTaskItemRender.prototype,"HSDTaskItemRender"),window.HSDTaskItemRender=HSDTaskItemRender;var CumRechargeCT=function(t){function e(){var e=t.call(this)||this;return e.lfData=[],e.isFirstEnter=!0,e.sysId=PackageID.Recharge,e.regNetMsg(25,e.postLifelongAward),e.regNetMsg(26,e.postOneSeckill),e.observe(GameLogic.ins().postEnterMap,function(){e.isFirstEnter&&(e.isFirstEnter=!1,Timer.start(2e3,1,e.checkUpdate,e))}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkUpdate=function(){if(OpenSystem.ins().checkSysOpen(SystemType.SECKILL)){var t=GlobalConfig.OneYuanGiftConfig;1e3*ZsCT.ins().lv+Actor.level<t.openLv||GameServer.serverOpenDay+1<t.openDay||this.seckill||ViewManager.ins().open(SeckillWin)}},e.prototype.postLifelongAward=function(t){this.lfYB=t.readDouble(),this.lfData=[];for(var e=t.readByte(),i=0;e>i;i++){var s={id:t.readByte(),canRecharge:t.readByte(),getNum:t.readInt()};this.lfData.push(s)}},e.prototype.postOneSeckill=function(t){this.seckill=t.readByte()},e.prototype.sendLifelongAward=function(t){var e=this.getBytes(25);e.writeByte(t),this.sendToServer(e)},e.prototype.totalRp=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.CUMULRECHARGE&&i.isOpenActivity()&&i.canReward())return!0}return!1},e.prototype.dailyRp=function(){for(var t in this.lfData)if(this.lfData[t].canRecharge&&this.lfData[t].getNum)return!0;return!1},__decorate([post()],e.prototype,"postLifelongAward",null),__decorate([post()],e.prototype,"postOneSeckill",null),e}(BaseSystem);__reflect(CumRechargeCT.prototype,"CumRechargeCT"),System.CumRechargeCT=function(){return CumRechargeCT.ins()},window.CumRechargeCT=CumRechargeCT;var CDRechargeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDRechargeWinSkinItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.actData=this.data[1];var t=this.actData.subType,e=this.data[0];this.eBl.text=(1==t&&this.actData.hasRecharge()?e.yuanbao:e.yuanbao+e.reward[0].count)+"",this.payed.visible=2==t&&this.actData.hasRechargeById(e.subid),this.chong.name=e.subid+"",this.chong.label=e.yuanbao/GlobalConfig.ClientGlobalConfig.rate*Recharge.getChannelMulti()+"元"}},e}(BaseItemRender);__reflect(CDRechargeItem.prototype,"CDRechargeItem"),window.CDRechargeItem=CDRechargeItem;var CDRechargeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CDRechargeWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=CDRechargeItem},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(Activity.ins().postChangePage,this.updateUI);var i=Activity.ins().activityData;for(var s in i){var n=i[s];n.pageStyle==ActivityPageStyle.CDRECHARGE&&n.isOpenActivity()&&!n.getHide()&&(this.data=n)}this.update(),this.setTime(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)},e.prototype.removeDisplay=function(){Timer.stop(this.setTime,this)},e.prototype.onTap=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent.parent instanceof CDRechargeItem){var e=this.data.subType;if(1==e&&this.data.hasRecharge())TipsCT.ins().showTips("活动期间内已充值");else if(2==e&&this.data.hasRechargeById(parseInt(t.target.name)));else{var i=GlobalConfig.ActivityType25Config[this.data.id],s=i[t.target.name].yuanbao;Recharge.ins().showReCharge(s)}}},e.prototype.update=function(){this.updateUI()},e.prototype.updateUI=function(){this.data=Activity.ins().activityData[this.data.id];var t=this.data.subType,e=GlobalConfig.ActivityType25Config[this.data.id];this.payed.visible=1==t&&this.data.hasRecharge(),this.eBigTitle.source=1==t?"xianshifanli_00_png":"xianshifanli_000_png";var i=[];for(var s in e)i.push([e[s],this.data]);this.list.dataProvider=new eui.ArrayCollection(i)},e.prototype.setTime=function(){var t=new Date(new Date(GameServer.serverTime).toLocaleDateString()).getTime()+864e5,e=Math.floor((t-GameServer.serverTime)/1e3);this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},__decorate([callLater],e.prototype,"updateUI",null),e}(BaseEuiView);__reflect(CDRechargeWin.prototype,"CDRechargeWin"),window.CDRechargeWin=CDRechargeWin,ViewManager.ins().reg(CDRechargeWin,LayerManager.UI_Main);var CumulativeRechargeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CumulativeRechargeWinSkin",e.isTopLevel=!0,e.index=1,e.choose=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.reward.itemRenderer=ItemBase,this.redPoint.touchEnabled=this.redPoint0.touchEnabled=this.redPoint1.touchEnabled=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Activity.ins().activityData,s=Object.keys(i);if(!s.length)for(var n in i){var o=i[n];o.pageStyle==ActivityPageStyle.CUMULRECHARGE&&o.isOpenActivity()&&!o.getHide()&&(this.actData=o)}this.actData&&this.actData.activityType==ActivityType.Normal?(this.cfg=GlobalConfig.ActivityType3Config[this.actData.id],this.ins=Activity.ins()):this.actData&&this.actData.activityType==ActivityType.Personal&&(this.cfg=GlobalConfig.PActivity3Config[this.actData.id],this.ins=PActivity.ins()),this.updateUI(),this.observe(Recharge.ins().postUpdateRechargeEx,this.update),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(CumRechargeCT.ins().postLifelongAward,this.updateDaily)},e.prototype.updateRed=function(){this.eRp1.visible=CumRechargeCT.ins().dailyRp(),this.eRp2.visible=CumRechargeCT.ins().totalRp()},e.prototype.updateUI=function(){this.total.visible=!!this.choose,this.daily.visible=!this.choose,this.total.visible?(this.update(),this.setTime(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)):this.updateDaily()},e.prototype.updateDaily=function(){this.updateRed();var t=this.getLFData();if(t){this.pay.visible=!0,this.got.visible=!1;var e=GlobalConfig.LifetimeRebateConfig[t.id];this.awardName.text=e.awardName,this.itemIcon.data=e.awardList[0];var i=this.getTitle();this.title.source="zhongshenfanli_lv"+i+"_png",t.canRecharge&&t.getNum?(this.getInfo.visible=this.redPoint2.visible=!0,this.costInfo.visible=!1,this.getBtn.icon="Lifetimerebate_btn_receive_png",this.mc=this.mc||new MovieClip,this.mc.playFile(RES_DIR_EFF+"BtnPrompt11",-1),this.eff.addChild(this.mc)):(this.getInfo.visible=this.redPoint2.visible=!1,this.costInfo.visible=!0,this.getBtn.icon="Lifetimerebate_btn_Recharge_png",this.cost.text=(e.num-CumRechargeCT.ins().lfYB)/GlobalConfig.ClientGlobalConfig.rate+"",this.mc&&DisplayUtils.removeFromParent(this.mc)),this.awardNum.text=""+t.getNum,this.exp.textFlow=TextFlowMaker.generateTextFlow1("|C:0xfee900&T:"+e.awardExp[1]*t.getNum+"元宝| |C:0x28FF00&T:+| |C:0xfee900&T:"+e.awardExp[1]*t.getNum+"VIP经验|");var s=t.getNum>1?t.getNum+"":"";this.itemIcon.setCount(s)}else this.got.visible=!0,this.pay.visible=!1},e.prototype.getTitle=function(){var t,e=CumRechargeCT.ins().lfData;for(var i in e){if(!e[i].canRecharge)return e[+i-1].getNum?e[+i-1].id:e[i].id;t=e[i].id}return t},e.prototype.getLFData=function(){var t=CumRechargeCT.ins().lfData;t.sort(this.taskSort);for(var e in t)if(!t[e].canRecharge||t[e].canRecharge&&t[e].getNum)return t[e]},e.prototype.taskSort=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.setTime=function(){if(this.actData){var t=this.actData.getLeftTime();this.actTime.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3)}},e.prototype.setIndex=function(){for(var t in this.cfg)if(0==(this.actData.recrod>>this.cfg[t].index&1))return+t;return this.cfg?Object.keys(this.cfg).length:1},e.prototype.update=function(t){if(void 0===t&&(t=!0),this.actData){this.updateRed(),this.actData.activityType==ActivityType.Normal?this.actData=this.ins.getActivityDataById(this.actData.id):this.actData.activityType==ActivityType.Personal&&(this.actData=this.ins.getActivityDataById(this.actData.id)),t&&(this.index=this.setIndex()),this.leftBtn.visible=this.rightBtn.visible=!0,1==this.index?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.index==Object.keys(this.cfg).length&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1);var e=this.cfg[this.index];this.bar.maximum=e.val/1e3,this.bar.value=this.actData.chongzhiTotal/1e3,this.ePow.text=e.power?e.power+"":"",this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.eshow.source=e.image;var i=e.val>this.actData.chongzhiTotal;if(this.rmb.text=i?(e.val-this.actData.chongzhiTotal)/1e3+"":"0",this.btn.visible=!0,this.redPoint.visible=this.redPoint0.visible=this.redPoint1.visible=this.payed.visible=!1,this.redPoint0.visible=this.leftBtn.visible&&this.setLeft(),this.redPoint1.visible=this.rightBtn.visible&&this.setRight(),i)this.btn.label="充值";else{var s=this.actData.recrod>>this.index&1;0==s?(this.btn.label="领取",this.redPoint.visible=!0):(this.btn.visible=!1,this.payed.visible=!0)}}},e.prototype.setLeft=function(){for(var t=this.index-1;t>0;t--){var e=this.actData.recrod>>t&1;if(this.actData.chongzhiTotal>=this.cfg[t].val&&0==e)return!0}return!1},e.prototype.setRight=function(){for(var t=this.index+1;t<=Object.keys(this.cfg).length;t++){var e=this.actData.recrod>>t&1;if(this.actData.chongzhiTotal>=this.cfg[t].val&&0==e)return!0}return!1},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.leftBtn:this.index--,this.update(!1);break;case this.rightBtn:this.index++,this.update(!1);break;case this.btn:if(this.cfg[this.index].val>this.actData.chongzhiTotal)ViewManager.ins().open(RechargeWin);else{if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void TipsCT.ins().showTips("背包剩余空位不足，请先清理");this.actData.activityType==ActivityType.Normal?Activity.ins().sendReward(this.actData.id,this.index):this.actData.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.actData.id,this.index)}break;case this.btn2:if(!this.actData)return;var i=this.choose;this.choose=1,i!=this.choose&&this.updateUI();break;case this.btn1:var i=this.choose;this.choose=0,i!=this.choose&&this.updateUI();break;case this.getBtn:var s=this.getLFData();if(s&&s.canRecharge&&s.getNum)CumRechargeCT.ins().sendLifelongAward(s.id);else{var n=Recharge.ins().getRechargeData(0);if(n&&0!=n.num)ViewManager.ins().open(RechargeWin);else{var o=ViewManager.ins().open(Recharge1Win);ViewManager.ins().close(e),o.closeFun=function(){ViewManager.ins().open(e)}}}break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[70].text)}},e}(BaseEuiView);__reflect(CumulativeRechargeWin.prototype,"CumulativeRechargeWin"),window.CumulativeRechargeWin=CumulativeRechargeWin,ViewManager.ins().reg(CumulativeRechargeWin,LayerManager.UI_Popup);var GMActivityWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="GMskin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick)},e.prototype.removeDisplay=function(){Setting.ins().setValue(ClientSet.gmActivity,1),this.skin&&PlayFun.ins().postFlyToIcon(this,"CumulativeRechargeRule")},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GMActivityWin.prototype,"GMActivityWin"),window.GMActivityWin=GMActivityWin,ViewManager.ins().reg(GMActivityWin,LayerManager.UI_Main);var LimitCheapieWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BuyLimitSkin",e._time=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=Activity.ins().activityData;for(var n in s){var o=s[n];o.pageStyle==ActivityPageStyle.LIMITCHEAPIE&&o.isOpenActivity()&&!o.getHide()&&(this.actData=o)}this.actData.activityType==ActivityType.Normal?(this.cfg=GlobalConfig.ActivityType2Config[this.actData.id],this.ins=Activity.ins()):this.actData.activityType==ActivityType.Personal&&(this.cfg=GlobalConfig.PActivity2Config[this.actData.id],this.ins=PActivity.ins()),this.update(),this.itemPos=[],this.itemGroup.$children.forEach(function(e){var i={x:e.x,y:e.y};t.itemPos.push(i)}),this.setTime(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.observe(this.ins.postActivityIsGetAwards,this.update),this.observe(this.ins.postRewardResult,this.updateFly)},e.prototype.setTime=function(){this.actData&&(this._time=this.actData.getLeftTime(),this.times.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_11,3))},e.prototype.update=function(){var t=this;if(this.skin){this.actData.activityType==ActivityType.Normal?this.actData=this.ins.getActivityDataById(this.actData.id):this.actData.activityType==ActivityType.Personal&&(this.actData=this.ins.getActivityDataById(this.actData.id)),this.preNum=this.index;for(var e=1;e<this.actData.buyData.length;e++)if(this.actData.buyData[e]<this.cfg[e].count){this.index=e;break}if(this.preNum&&this.preNum!=this.index){var i=this.cfg[this.index].rewards.length;this.itemGroup.$children.forEach(function(e,s){if(i>s){e.x=t.itemPos[s+1].x,e.y=t.itemPos[s+1].y;var n=t["item"+s];n.itemIcon.data=t.cfg[t.index].rewards[s],egret.Tween.get(e).to({x:t.itemPos[s].x,y:t.itemPos[s].y},800,egret.Ease.sineOut)}})}else for(var e in this.cfg[this.index].rewards){var s=this["item"+e];s.itemIcon.data=this.cfg[this.index].rewards[e]}this.buyText.visible=this.actData.buyData[this.index]>=this.cfg[this.index].count,this.money.visible=!this.buyText.visible,this.cost.text=this.cfg[this.index].price+"",this.preCost.text=this.cfg[this.index].originalPrice+""}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.buyBtn:if(Actor.yb<this.cfg[this.index].price)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");this.cfg[this.index]instanceof ActivityType2Config?Activity.ins().sendReward(this.actData.id,this.index):this.cfg[this.index]instanceof PActivity2Config&&PActivity.ins().sendReward(this.actData.id,this.index)}},e.prototype.updateFly=function(){for(var t in this.cfg[this.index-1].rewards)this.flyItem(this["item"+t],this.cfg[this.preNum].rewards[t],t)},e.prototype.flyItem=function(t,e,i){var s=new ItemBaseNoTap;s.x=this.itemPos[i].x+t.width,s.y=this.itemPos[i].y+t.height,s.scaleX=s.scaleY=.7,s.data=e,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,t.parent.addChild(s),GameLogic.ins().postFlyItemEx(s)},e}(BaseEuiView);__reflect(LimitCheapieWin.prototype,"LimitCheapieWin"),window.LimitCheapieWin=LimitCheapieWin,ViewManager.ins().reg(LimitCheapieWin,LayerManager.UI_Main2);var TabBar=eui.TabBar,LimitedGiftWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="limitedGiftSkin",e.isTopLevel=!0,e.temp=[],e.index=0,e.pageStyle=ActivityPageStyle.LIMITEDGIFT,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.bgClose.visible=!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(PActivity.ins().postActivityIsGetAwards,this.update),this.addChangeEvent(this.menuList,this.onClickTab),this.updateData(),this.temp=[];for(var i in this.actList)for(var s in this.actList[i])this.temp.push(this.actList[i][s]);if(this.temp.length){if(this.menuList.dataProvider=new eui.ArrayCollection(this.temp),t[0])for(var n in this.temp)this.temp[n].Id==t[0]&&(this.index=+n);this.menuList.selectedIndex=this.index,this.menuList.validateNow();for(var o=0;o<this.temp.length;o++){var a=this.menuList.getChildAt(o);a.labelDisplay.text=this.temp[o].giftname,a.currentState="down"}this.update(),this.updateTime(),Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this)}},e.prototype.onClickTab=function(){this.index=this.menuList.selectedIndex;for(var t=0;t<this.temp.length;t++){var e=this.menuList.getChildAt(t);e.currentState="down"}this.update(),this.updateTime()},e.prototype.removeDisplay=function(){Timer.stop(this.updateTime,this),this.skin&&(this.bgClose.visible=!1,PlayFun.ins().postFlyToIcon(this,"LimitedGiftRule"))},e.prototype.update=function(){var t=this.menuList.getChildAt(this.menuList.selectedIndex);t.currentState="up";var e=this.temp[this.index];this.ePow.text=e.discount+"",this.list.dataProvider=new eui.ArrayCollection(e.award),this.pay.label=e.money/GlobalConfig.ClientGlobalConfig.rate+"元";var i=this.ins.activityData[e.Id];for(var s in i.list)i.list[s].index==e.money&&i.list[s].state>=e.buyTimes?(this.showGroup.visible=!1,this.isget.visible=!0):(this.showGroup.visible=!0,this.isget.visible=!1)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.pay:var e=Activity.ins().activityData[this.actId]?ShowRechargeType.Type_Treasure:ShowRechargeType.Type_Pactivity55,i=this.temp&&this.temp[this.index]?this.temp[this.index].rid:0;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(this.temp[this.index].money,e,this.temp[this.index].Id+""):Recharge.ins().sendPayOrder(i)}},e.prototype.updateTime=function(){if(this.skin&&this.temp&&this.temp[this.index]){var t=this.ins.activityData[this.temp[this.index].Id];t&&(this.time.text=""+t.getRemainTime())}},e}(ComActivityWin55);__reflect(LimitedGiftWin.prototype,"LimitedGiftWin"),window.LimitedGiftWin=LimitedGiftWin,ViewManager.ins().reg(LimitedGiftWin,LayerManager.UI_Popup);var LimitedGiftWin2=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="limitedGiftSkin2",e.isTopLevel=!0,e.pageStyle=ActivityPageStyle.PActivity55,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.bgClose.visible=!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(PActivity.ins().postActivityIsGetAwards,this.update),this.updateData(),this.update(),this.updateTime(),Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this)},e.prototype.removeDisplay=function(){Timer.stop(this.updateTime,this),this.skin&&(this.bgClose.visible=!1,PlayFun.ins().postFlyToIcon(this,"LimitedGiftRule2"))},e.prototype.update=function(){if(this.actList.length)for(var t in this.actList){var e=this.ins.activityData[this.actId];for(var i in e.list){var s=this.actList[t][e.list[i].index];if(!s)break;this.rid=s.rid,this.money=s.money,this.pay.label=s.money/GlobalConfig.ClientGlobalConfig.rate+"元",this.list.dataProvider=new eui.ArrayCollection(s.award),this.img.source=s.desc,this.btnGroup.visible=e.list[i].state<s.buyTimes,this.isget.visible=!this.btnGroup.visible,this.mc=new MovieClip,this.eff.addChild(this.mc),s.eff&&this.mc.playFile(""+RES_DIR_EFF+s.eff,-1)}}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.pay:var e=Activity.ins().activityData[this.actId]?ShowRechargeType.Type_Treasure:ShowRechargeType.Type_Pactivity55;
GlobalConfig.ClientGlobalConfig.oldRecharge||!this.rid?Recharge.ins().showReCharge(this.money,e,this.actId+""):Recharge.ins().sendPayOrder(this.rid)}},e.prototype.updateTime=function(){if(this.skin&&this.actId){var t=this.ins.activityData[this.actId];t&&(this.time.text=""+t.getRemainTime())}},e}(ComActivityWin55);__reflect(LimitedGiftWin2.prototype,"LimitedGiftWin2"),window.LimitedGiftWin2=LimitedGiftWin2,ViewManager.ins().reg(LimitedGiftWin2,LayerManager.UI_Popup);var LimitGiftWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BuyTimeLimitSkin",e.isTopLevel=!0,e._time=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=Activity.ins().activityData;for(var s in i){var n=i[s];n.pageStyle==ActivityPageStyle.LIMITGIFT&&n.isOpenActivity()&&!n.getHide()&&(this.actData=n)}this.actData.activityType==ActivityType.Normal?(this.cfg=GlobalConfig.ActivityType2Config[this.actData.id],this.ins=Activity.ins()):this.actData.activityType==ActivityType.Personal&&(this.cfg=GlobalConfig.PActivity2Config[this.actData.id],this.ins=PActivity.ins()),this.update(),this.setTime(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.observe(this.ins.postActivityIsGetAwards,this.update)},e.prototype.setTime=function(){this.actData&&(this._time=this.actData.getLeftTime(),this.times.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_11,3))},e.prototype.update=function(){this.actData.activityType==ActivityType.Normal?this.actData=this.ins.getActivityDataById(this.actData.id):this.actData.activityType==ActivityType.Personal&&(this.actData=this.ins.getActivityDataById(this.actData.id));for(var t=1;t<this.actData.buyData.length;t++)if(this.actData.buyData[t]<this.cfg[t].count){this.index=t;break}for(var e=this.cfg[this.index].rewards.length,t=0;e>t;t++)this["gift"+t].data=this.cfg[this.index].rewards[t];this.buyText.visible=this.actData.buyData[this.index]>=this.cfg[this.index].count,this.buyGroup.visible=this.buyBtn.visible=!this.buyText.visible,this.preCost.text="原价："+this.cfg[this.index].originalPrice,this.curCost.text=""+this.cfg[this.index].price},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.buyBtn:if(Actor.yb<this.cfg[this.index].price)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");this.cfg[this.index]instanceof ActivityType2Config?Activity.ins().sendReward(this.actData.id,this.index):this.cfg[this.index]instanceof PActivity2Config&&PActivity.ins().sendReward(this.actData.id,this.index)}},e}(BaseEuiView);__reflect(LimitGiftWin.prototype,"LimitGiftWin"),window.LimitGiftWin=LimitGiftWin,ViewManager.ins().reg(LimitGiftWin,LayerManager.UI_Popup);var PlayTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="wanfatips",e.time=0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];switch(e.type=t[0],e.type){case e.TYPE_BOSS:return BossCT.ins().checkNewWorldBossOpen();case e.TYPE_Battle:return BattleCC.ins().checkRedPoint();case e.TYPE_Paodian:return PaoDianCC.ins().checkRedPoint();case e.TYPE_Revelry:return CityCC.ins().checkIsOpen()}return e.checkClose()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.nameImg.source=this.nameTxt.text="",this.addTouchEvent(this,this.onClick);var i=GlobalConfig.ClientGlobalConfig.openWinImg[t[0]],s=GlobalConfig.ClientGlobalConfig.openWinTxt[t[0]];i?this.nameImg.source=i:this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1(""+s)},e.prototype.enterFrame=function(){var t=egret.getTimer();t-this.time>1e3&&(this.time=t,e.checkClose()||ViewManager.ins().close(this))},e.checkClose=function(){switch(e.type){case e.TYPE_BOSS:return BossCT.ins().checkNewWorldBossOpen();case e.TYPE_Battle:return BattleCC.ins().checkRedPoint();case e.TYPE_Paodian:return PaoDianCC.ins().checkRedPoint();case e.TYPE_Revelry:return CityCC.ins().checkIsOpen()}return!1},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.btn:switch(e.type){case e.TYPE_BOSS:BossCT.ins().checkBossOpen()&&ViewManager.ins().close(this);break;case e.TYPE_Battle:BattleCC.ins().checkBattleOpen()&&ViewManager.ins().close(this);break;case e.TYPE_Paodian:PaoDianCC.ins().checkPaodianOpen()&&ViewManager.ins().close(this);break;case e.TYPE_Revelry:CityCC.ins().checkRevelryOpen()&&ViewManager.ins().close(this)}}},e.TYPE_BOSS=0,e.TYPE_Battle=1,e.TYPE_Paodian=2,e.TYPE_Revelry=3,e}(BaseEuiView);__reflect(PlayTipsWin.prototype,"PlayTipsWin"),window.PlayTipsWin=PlayTipsWin,ViewManager.ins().reg(PlayTipsWin,LayerManager.UI_Main);var TreasureRoomItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="zhenbaogeItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.actData=this.data[0],this.reward.dataProvider=new eui.ArrayCollection(this.data[1].award),this.eName.text=this.data[1].giftname+"",this.cost.text="原价："+this.data[1].preCost+"元",this.desc.text=this.data[1].desc+"",this.buyNum.text="限购"+this.data[1].buyTimes+"次";var t=0;for(var e in this.actData.list)this.actData.list[e].index==this.data[1].money&&(t=this.actData.list[e].state);this.buyTimes.text=t+"/"+this.data[1].buyTimes,this.discount.text=this.data[1].discount+"",this.isGet=t>=this.data[1].buyTimes,this.buyBtn.label=this.isGet?"已购买":"充值"+this.data[1].money/100+"元",this.redPoint.visible=this.buyBtn.enabled=!this.isGet,this.setTime()}},e.prototype.setTime=function(){this.actData&&this.skin&&(this.isGet?this.times.text="剩余时间： 0时0分0秒":this.times.text="剩余时间： "+this.actData.getRemainTime())},e}(BaseItemRender);__reflect(TreasureRoomItem.prototype,"TreasureRoomItem"),window.TreasureRoomItem=TreasureRoomItem;var TreasureRoomWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="zhenbaogeSkin",e.isTopLevel=!0,e.pageStyle=ActivityPageStyle.TREASUREROOM,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(PActivity.ins().postActivityIsGetAwards,this.update),this.updateData(),this.update(),Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this)},e.prototype.removeDisplay=function(){Timer.stop(this.updateTime,this),this.skin&&PlayFun.ins().postFlyToIcon(this,"TreasureRoomRule")},e.prototype.update=function(){var t=[],e=[];for(var i in this.actList){var s=this.actList[i],n=this.ins.activityData[this.actId];for(var o in n.list)n.list[o].state>=s[n.list[o].index].buyTimes?t.push([n,s[n.list[o].index]]):e.push([n,s[n.list[o].index]])}t.sort(this.sort),e.sort(this.sort);var a=e.concat(t);this.eList.dataProvider=new eui.ArrayCollection(a)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t[1].money,e[1].money)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof TreasureRoomItem){var e=t.target.parent.parent.data[1],i=e?e.rid:0;if(GlobalConfig.ClientGlobalConfig.oldRecharge||!i){var s=Activity.ins().activityData[this.actId]?ShowRechargeType.Type_Treasure:ShowRechargeType.Type_Pactivity55;Recharge.ins().showReCharge(t.target.parent.parent.data[1].money,s,this.actId+"")}else Recharge.ins().sendPayOrder(i)}},e.prototype.updateTime=function(){for(var t=0;t<this.eList.numElements;t++){var e=this.eList.getElementAt(t);e&&e.setTime()}},e}(ComActivityWin55);__reflect(TreasureRoomWin.prototype,"TreasureRoomWin"),window.TreasureRoomWin=TreasureRoomWin,ViewManager.ins().reg(TreasureRoomWin,LayerManager.UI_Main);var BeastCT=function(t){function e(){var e=t.call(this)||this;return e.formationPower=0,e.winSelecPos=0,e.firstTen=!1,e.logs=[],e.roundLogs=[],e.blessing=0,e.sysId=PackageID.Beast,e.regNetMsg(1,e.postInfo),e.regNetMsg(2,e.postHatchInfo),e.regNetMsg(3,e.postSeniorHatchInfo),e.regNetMsg(4,e.postHatchTimeUp),e.regNetMsg(5,e.postGetBeast),e.regNetMsg(6,e.postBeastInfo),e.regNetMsg(7,e.postUpLevel),e.regNetMsg(8,e.postUpStage),e.regNetMsg(9,e.postFormationInfo),e.regNetMsg(10,e.postFormationUp),e.regNetMsg(11,e.postBeastPut),e.regNetMsg(12,e.postTreasureInfo),e.regNetMsg(13,e.postTreasure),e.regNetMsg(14,e.postRound),e.regNetMsg(15,e.postTreasureTime),e.regNetMsg(16,e.postTreasureLog),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){this.eggPosMax=CommonUtils.getObjectLength(GlobalConfig.BeastEggPlotConfig),this.hasHatchNum=t.readShort(),this.seniorHatchTotal=t.readInt(),this.beastEggPos={};for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte();this.beastEggPos[s]={pos:s,eggItemId:t.readInt(),wuXing:t.readByte(),timeLeft:1e3*t.readInt()+egret.getTimer(),beastItemId:t.readInt()}}},e.prototype.sendHatch=function(t,e){var i=this.getBytes(2);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postHatchInfo=function(t){var e=t.readByte();this.beastEggPos[e]={pos:e,eggItemId:t.readInt(),wuXing:t.readByte(),timeLeft:1e3*t.readInt()+egret.getTimer(),beastItemId:0},this.hasHatchNum=t.readShort()},e.prototype.sendSeniorHatch=function(t,e){var i=this.getBytes(3);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postSeniorHatchInfo=function(t){var e=t.readByte();this.beastEggPos[e]={pos:e,eggItemId:t.readInt(),wuXing:t.readByte(),timeLeft:0,beastItemId:t.readInt()};var i=t.readByte();return this.seniorHatchTotal=t.readInt(),this.hasHatchNum=t.readShort(),i},e.prototype.postHatchTimeUp=function(t){var e=t.readByte();this.beastEggPos[e]&&(this.beastEggPos[e].beastItemId=t.readInt())},e.prototype.sendGetBeast=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.postGetBeast=function(t){var e=t.readByte(),i=0;return this.beastEggPos[e]&&(i=this.beastEggPos[e].beastItemId,this.beastEggPos[e].eggItemId=0,this.beastEggPos[e].beastItemId=0),i},e.prototype.postBeastInfo=function(t){var e=t.readShort();this.beastInfos={};for(var i=0;e>i;i++){var s=t.readInt();this.beastInfos[s]={id:s,lv:t.readShort(),stage:t.readShort(),lvPower:t.readUnsignedInt(),stagePower:t.readUnsignedInt()}}},e.prototype.sendUpLevel=function(t,e){void 0===e&&(e=1);var i=this.getBytes(7);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postUpLevel=function(t){var e=this.getBeastInfoById(t.readInt());e.lv=t.readShort(),e.lvPower=t.readUnsignedInt()},e.prototype.sendUpStage=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.postUpStage=function(t){var e=t.readInt(),i=t.readShort(),s=t.readUnsignedInt(),n=this.getBeastInfoById(e);n?(n.stage=i,n.stagePower=s):this.beastInfos[e]={id:e,lv:0,stage:i,lvPower:0,stagePower:s}},e.prototype.postFormationInfo=function(t){this.formationStage=t.readShort(),this.formationInfos={};for(var e=0;5>e;e++){var i=t.readByte();this.formationInfos[i]={type:i,beastId:[t.readInt(),t.readInt(),t.readInt()],att:t.readInt(),def:t.readInt(),qualit:[t.readShort(),t.readShort(),t.readShort(),t.readShort(),t.readShort()]}}this.totalPower=[];for(var e=1;5>=e;e++)this.totalPower[e]=t.readInt();this.totalStage=t.readShort(),this.formationPower=t.readUnsignedInt(),this.updateSkillLv()},e.prototype.sendFormationUp=function(){this.sendBaseProto(10)},e.prototype.postFormationUp=function(t){this.formationStage=t.readShort(),this.formationPower=t.readUnsignedInt()},e.prototype.sendBeastPut=function(t,e,i){var s=this.getBytes(11);s.writeByte(t),s.writeByte(e),s.writeInt(i),this.sendToServer(s)},e.prototype.postBeastPut=function(t){var e=t.readByte(),i=t.readByte(),s=this.formationInfos[e];s.beastId[i-1]=t.readInt(),s.att=t.readInt(),s.def=t.readInt(),s.qualit=[t.readShort(),t.readShort(),t.readShort(),t.readShort(),t.readShort()],this.totalPower=[];for(var n=1;5>=n;n++)this.totalPower[n]=t.readInt();this.totalStage=t.readShort(),this.formationPower=t.readUnsignedInt(),this.updateSkillLv()},e.prototype.postTreasureInfo=function(t){this.hasTreasure=t.readInt(),this.firstTen=t.readByte()>=1,this.round=t.readByte();var e=t.readByte();this.getRoundReward=[];for(var i=0;e>i;i++)this.getRoundReward.push(t.readByte());e=t.readInt(),this.logs=[];for(var i=0;e>i;i++){var s=t.readByte(),n=t.readString(),o=t.readInt(),a=t.readInt(),r=GlobalConfig.ItemConfig[o],l=ItemUtil.getType(r),h=0;if(l==ItemType.TYPE_42){var p=GlobalConfig.BeastEggConfig[o];if(h=p.quality[0],3>h)continue}else{if(l!=ItemType.TYPE_44)continue;if(h=MathUtils.toInteger(o/10%10),3>h)continue}var u="|C:0x008CFF&T:"+n+"| 获得 |C:"+(4==h?ColorUtil.RED:16742144)+"&T:"+GlobalConfig.ItemConfig[o].name+"x"+a+"|";1==s?this.logs.unshift(u):this.roundLogs.unshift(u)}this.logs.length=Math.min(this.logs.length,6),this.blessing=t.readShort()},e.prototype.sendTreasure=function(t){var e=this.getBytes(13);e.writeByte(t+1),this.sendToServer(e)},e.prototype.postTreasure=function(t){this.hasTreasure=t.readInt();for(var e=t.readShort(),i=1>=e?1:2,s=[],n=0;e>n;n++)s[n]=[t.readInt(),t.readInt()];e>1&&(this.firstTen=!0),ViewManager.ins().isShow(HuntResultWin)?Hunt.ins().postHuntResult(i-1,s,5):ViewManager.ins().open(HuntResultWin,i-1,s,5),this.blessing=t.readShort()},e.prototype.sendRound=function(t){var e=this.getBytes(14);e.writeByte(t),this.sendToServer(e)},e.prototype.postRound=function(t){this.hasTreasure=t.readInt();var e=t.readByte();this.getRoundReward.push(e);var i=t.readByte();return i!=this.round&&(this.round=i,this.getRoundReward=[]),e},e.prototype.postTreasureTime=function(t){this._freeCD=1e3*t.readUnsignedInt()+egret.getTimer()},e.prototype.postTreasureLog=function(t){var e=t.readByte(),i=t.readString(),s=t.readInt(),n=t.readInt(),o=GlobalConfig.ItemConfig[s],a=ItemUtil.getType(o),r=0;if(a==ItemType.TYPE_42){var l=GlobalConfig.BeastEggConfig[s];if(r=l.quality[0],3>r)return}else{if(a!=ItemType.TYPE_44)return;if(r=MathUtils.toInteger(s/10%10),3>r)return}var h="|C:0x008CFF&T:"+i+"| 获得 |C:"+(4==r?ColorUtil.RED:16742144)+"&T:"+GlobalConfig.ItemConfig[s].name+"x"+n+"|";1==e?(this.logs.unshift(h),this.logs.length=Math.min(this.logs.length,6)):this.roundLogs.unshift(h)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.BeastBaseConfig,i="";return GameServer.serverOpenDay+1<e.openday?i="第"+e.openday+"天开启":ZsCT.ins().lv<e.zslevel&&(i=e.zslevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.isUnlockEggPosByPos=function(t){return this.seniorHatchTotal>=GlobalConfig.BeastEggPlotConfig[t].count},e.prototype.getEggPosInfoByPos=function(t){return this.beastEggPos[t]},e.prototype.getEmptyPos=function(){for(var t=1;t<=this.eggPosMax;t++){if(!this.isUnlockEggPosByPos(t))return 0;var e=this.getEggPosInfoByPos(t);if(!e||e.eggItemId<=0)return t}return 0},e.prototype.getBeastInfoById=function(t){return this.beastInfos?this.beastInfos[t]:null},e.prototype.isActionById=function(t){return!!this.beastInfos&&!!this.beastInfos[t]&&this.beastInfos[t].stage>0},e.prototype.isInFormation=function(t){for(var e in this.formationInfos){var i=this.formationInfos[e];if(i.beastId.indexOf(t)>-1)return!0}return!1},e.prototype.updateSkillLv=function(){this._skillLvs=[],this._skillInfo={};for(var t in GlobalConfig.BeastFormSkillConfig){var e=GlobalConfig.BeastFormSkillConfig[t];for(var i in e){var s=e[i],n=s.skillId;if(this._skillInfo[n]||(this._skillInfo[n]={wuXing:0,index:s.index}),s.goldSum>0&&this.getWxXingPower(WuXingType.Gold)<s.goldSum)break;if(s.woodSum>0&&this.getWxXingPower(WuXingType.Wood)<s.woodSum)break;if(s.waterSum>0&&this.getWxXingPower(WuXingType.Water)<s.waterSum)break;if(s.fireSum>0&&this.getWxXingPower(WuXingType.Fire)<s.fireSum)break;if(s.earthSum>0&&this.getWxXingPower(WuXingType.Earth)<s.earthSum)break;if(s.stage>0&&this.formationStage<s.stage)break;if(s.prCount>0&&this.totalStage<s.prCount)break;this._skillLvs[n]=s}}for(var t in GlobalConfig.BeastGodSkillConfig){var o=GlobalConfig.BeastGodSkillConfig[t];for(var i in o){var e=o[i],a=void 0,n=void 0,r=void 0;for(var l in e){var s=e[l];n=s.skillId,a=s.type,r=s.index;var h=this.formationInfos[a];if(s.wuxingAtk>0&&h.att<1e4*s.wuxingAtk)break;if(s.wuxingDef>0&&h.def<1e4*s.wuxingDef)break;if(s.rCount>0&&h.qualit[0]+h.qualit[1]+h.qualit[2]+h.qualit[3]+h.qualit[4]<s.rCount)break;if(s.srCount>0&&h.qualit[1]+h.qualit[2]+h.qualit[3]+h.qualit[4]<s.srCount)break;if(s.ssrCount>0&&h.qualit[2]+h.qualit[3]+h.qualit[4]<s.ssrCount)break;if(s.sssrCount>0&&h.qualit[3]+h.qualit[4]<s.sssrCount)break;if(s.prCount>0&&h.qualit[4]<s.prCount)break;this._skillLvs[n]=s}this._skillInfo[n]||(this._skillInfo[n]={wuXing:a,index:r})}}},e.prototype.getFrontSkillStr=function(t){var e="";return e+=this.getStr(this.getWxXingPower(WuXingType.Gold),t.goldSum||0),e+=this.getStr(this.getWxXingPower(WuXingType.Wood),t.woodSum||0),e+=this.getStr(this.getWxXingPower(WuXingType.Water),t.waterSum||0),e+=this.getStr(this.getWxXingPower(WuXingType.Fire),t.fireSum||0),e+=this.getStr(this.getWxXingPower(WuXingType.Earth),t.earthSum||0),e+=this.getStr(this.formationStage,t.stage||0),e+=this.getStr(this.totalStage,t.prCount||0,!1)},e.prototype.getGodSkillStr=function(t){var e="",i=this.formationInfos[t.type];return e+=this.getStr(i.att/1e4,t.wuxingAtk||0),e+=this.getStr(i.def/1e4,t.wuxingDef||0),e+=this.getStr(i.qualit[0]+i.qualit[1]+i.qualit[2]+i.qualit[3]+i.qualit[4],t.rCount||0),e+=this.getStr(i.qualit[1]+i.qualit[2]+i.qualit[3]+i.qualit[4],t.srCount||0),e+=this.getStr(i.qualit[2]+i.qualit[3]+i.qualit[4],t.ssrCount||0),e+=this.getStr(i.qualit[3]+i.qualit[4],t.sssrCount||0),e+=this.getStr(i.qualit[4],t.prCount||0,!1)},e.prototype.getStr=function(t,e,i){void 0===i&&(i=!0);var s=e>0?e+"":"--",n=e>0?(e+"").length-1:-1;return"|C:"+(e>0&&e>t?ColorUtil.GRAY:ColorUtil.GREEN)+"&T:"+(i?StringUtils.complementByChar(s,7-n," "):s)+"|"},e.prototype.getActSkillcfg=function(t){return this._skillLvs[t]||null},e.prototype.getSkillInfo=function(t){return this._skillInfo[t]||null},e.prototype.getActSkillLv=function(t){return this._skillLvs[t]?this._skillLvs[t].level:0},e.prototype.getWxXingPower=function(t){return MathUtils.toInteger(this.totalPower[t]/1e4)},e.prototype.getWuXingAttrs=function(){for(var t=[],e=0;10>e;e++){var i=new AttributeData;i.type=AttributeType.atGoldAtk+e;var s=this.formationInfos[MathUtils.toInteger(e/2)+1];i.value=e%2==0?s.att:s.def,t.push(i)}return t},e.getWuXingRes=function(t){return"hatchnature_"+t},e.getWuXingName=function(t){var e=["","金","木","水","火","土"];return e[t]},e.getQualityRes=function(t){return"rarequality_"+t},e.getBeastNameRes=function(t){return"RareName_"+t},e.getBeastImgRes=function(t){return"rareanimal_"+t+"_png"},Object.defineProperty(e.prototype,"freeCD",{get:function(){return Math.max((this._freeCD-egret.getTimer())/1e3,0)},enumerable:!0,configurable:!0}),e.prototype.isRoundFinish=function(){var t=GlobalConfig.BeastTurntableConfig[this.round];for(var e in t){var i=t[e].index;if(-1==this.getRoundReward.indexOf(i))return!1}return!0},e.prototype.checkTreasureOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.BeastTreasureBase,i="";return GameServer.serverOpenDay+1<e.openday?i="第"+e.openday+"天开启":ZsCT.ins().lv<e.zslevel&&(i=e.zslevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.postSetWinSelectPos=function(t){this.winSelecPos=t},e.sortListMenu=function(t,i){var s=t[0],n=i[0],o=BeastRedPoint.ins().stageRedPoint[s.id],a=BeastRedPoint.ins().stageRedPoint[n.id],r=e.ins().isActionById(s.id),l=e.ins().isActionById(n.id);return r&&!l?-1:!r&&l?1:o&&!a?-1:!o&&a?1:s.quality<n.quality?-1:s.quality>n.quality?1:s.id<n.id?-1:1},__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postHatchInfo",null),__decorate([post()],e.prototype,"postSeniorHatchInfo",null),__decorate([post()],e.prototype,"postHatchTimeUp",null),__decorate([post()],e.prototype,"postGetBeast",null),__decorate([post()],e.prototype,"postBeastInfo",null),__decorate([post()],e.prototype,"postUpLevel",null),__decorate([post()],e.prototype,"postUpStage",null),__decorate([post()],e.prototype,"postFormationInfo",null),__decorate([post()],e.prototype,"postFormationUp",null),__decorate([post()],e.prototype,"postBeastPut",null),__decorate([post()],e.prototype,"postTreasureInfo",null),__decorate([post()],e.prototype,"postTreasure",null),__decorate([post()],e.prototype,"postRound",null),__decorate([post()],e.prototype,"postTreasureTime",null),__decorate([post()],e.prototype,"postTreasureLog",null),__decorate([post()],e.prototype,"postSetWinSelectPos",null),e}(BaseSystem);__reflect(BeastCT.prototype,"BeastCT");var WuXingType;!function(t){t[t.Gold=1]="Gold",t[t.Wood=2]="Wood",t[t.Water=3]="Water",t[t.Fire=4]="Fire",t[t.Earth=5]="Earth"}(WuXingType||(WuXingType={})),window.WuXingType=WuXingType,System.BeastCT=function(){return BeastCT.ins()},window.BeastCT=BeastCT;var BeastRedPoint=function(t){function e(){var e=t.call(this)||this;return e.starTotal=!1,e.stageTotal=!1,e.stageRedPoint=[],e.starRedPoint=[],e.frontRedPoint=!1,e.associated(e.postRedPoint,e.postStageRedPoint,e.postStarRedPoint),e.associated(e.postStageRedPoint,BeastCT.ins().postBeastInfo,BeastCT.ins().postGetBeast,BeastCT.ins().postUpStage,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e.associated(e.postStarRedPoint,BeastCT.ins().postBeastInfo,BeastCT.ins().postGetBeast,BeastCT.ins().postUpLevel,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e.associated(e.postFrontRedPoint,BeastCT.ins().postFormationUp,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e.associated(e.postTreasureRedPoint,BeastCT.ins().postTreasureInfo,BeastCT.ins().postTreasure,BeastCT.ins().postTreasureTime,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.starTotal||this.stageTotal||this.frontRedPoint,t!=this.redPoint},e.prototype.postStageRedPoint=function(){if(this.stageRedPoint=[],this.stageTotal=!1,BeastCT.ins().checkOpen()){var t=BeastCT.ins();for(var e in GlobalConfig.BeastConfig){var i=GlobalConfig.BeastConfig[e],s=t.getBeastInfoById(i.id),n=!!s&&!GlobalConfig.BeastStageConfig[i.id][(s?s.stage:0)+1];if(n)this.stageRedPoint[i.id]=!1;else{var o=GlobalConfig.BeastStageConfig[i.id][s?s.stage:0],a=o.cost[0],r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,a.id);this.stageRedPoint[i.id]=r>=a.count,this.stageRedPoint[i.id]&&(this.stageTotal=!0)}}}},e.prototype.postStarRedPoint=function(){if(this.starRedPoint=[],this.starTotal=!1,BeastCT.ins().checkOpen()){var t=BeastCT.ins();for(var e in GlobalConfig.BeastConfig){var i=GlobalConfig.BeastConfig[e];if(this.starRedPoint[i.id]=!1,t.isActionById(i.id)){var s=t.getBeastInfoById(i.id),n=!GlobalConfig.BeastLevelConfig[i.quality][(s?s.lv:0)+1];if(!n){var o=GlobalConfig.BeastStageConfig[i.id][s.stage].maxlevel;if(!(s.lv>=o)){var a=GlobalConfig.BeastLevelConfig[i.quality][s?s.lv:0],r=Actor.gold>=a.gold,l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.lvItemId);if(l<a.itemNum){r=!1;break}this.starRedPoint[i.id]=r&&a.gold>0,this.starRedPoint[i.id]&&(this.starTotal=!0)}}}}}},e.prototype.postFrontRedPoint=function(){this.frontRedPoint=!1;var t=!GlobalConfig.BeastFormStageConfig[BeastCT.ins().formationStage+1];if(!t){var e=GlobalConfig.BeastFormStageConfig[BeastCT.ins().formationStage],i=e.cost[0].count,s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.cost[0].id);this.frontRedPoint=s>=i}},e.prototype.postTreasureRedPoint=function(){if(BeastCT.ins().checkTreasureOpen()){var t=this.postFreeRedPoint(),e=this.postOutBagRedPoint(),i=this.postRoundRedPoint();this.treasureRedPoint=t||e||i}else this.treasureRedPoint=!1},e.prototype.postFreeRedPoint=function(){return this.freeRedPoint=BeastCT.ins().freeCD<=0,this.freeRedPoint},e.prototype.postOutBagRedPoint=function(){return this.outBagRedPoint=BagCT.ins().getHuntGoodsBySort(DepotType.Beast).length>0,this.outBagRedPoint},e.prototype.postRoundRedPoint=function(){return this.roundRedPoint=BeastCT.ins().hasTreasure>=GlobalConfig.BeastTreasureBase.costNumber,this.roundRedPoint},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postStageRedPoint",null),__decorate([post()],e.prototype,"postStarRedPoint",null),__decorate([post()],e.prototype,"postFrontRedPoint",null),__decorate([post()],e.prototype,"postTreasureRedPoint",null),__decorate([post()],e.prototype,"postFreeRedPoint",null),__decorate([post()],e.prototype,"postOutBagRedPoint",null),__decorate([post()],e.prototype,"postRoundRedPoint",null),e}(BaseSystem);__reflect(BeastRedPoint.prototype,"BeastRedPoint"),System.BeastRedPoint=function(){return BeastRedPoint.ins()},window.BeastRedPoint=BeastRedPoint;var AttrWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RoleAttrSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=AttViewItem,this.leftBtn.visible=this.rightBtn.visible=this.job.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onClick),this.update(t[0])},e.prototype.update=function(t){this.eList.dataProvider=new eui.ArrayCollection(t)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(AttrWin.prototype,"AttrWin"),window.AttrWin=AttrWin,ViewManager.ins().reg(AttrWin,LayerManager.UI_Popup);var AttViewItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleAttrPanelSkin",e.eList.itemRenderer=RoleAttrItem,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eTitle.text=t.title;var e=[];for(var i in t.attrs){var s=AttributeData.getAttrStrByType(t.attrs[i].type),n=AttributeData.getAttStrByType(t.attrs[i],0,"",!1,!1);e.push([s+"：",n])}this.eList.dataProvider=new eui.ArrayCollection(e)}},e}(BaseItemRender);__reflect(AttViewItem.prototype,"AttViewItem"),window.AttViewItem=AttViewItem;var BeactTalentItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareAnimalTalentItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=t[1].id;this.eImg.source=t[1].icon,this.eDes.text=t[1].name;var i=BeastCT.ins().getBeastInfoById(e),s=0;if(i)for(var n in t){if(!(i.lv>=t[n].beastLevelLimit))break;s=t[n].level}this.eLv.text=s>0?"(Lv."+s+")":"未学习",this.eImg.filters=s>0?null:FilterUtil.ARRAY_GRAY_FILTER}},e}(BaseItemRender);__reflect(BeactTalentItemRenderer.prototype,"BeactTalentItemRenderer"),window.BeactTalentItemRenderer=BeactTalentItemRenderer;var BeastEggSelectWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.showEff=!1,e.selectId=0,e.isEnough=!1,e._sn_="RareAnimalSelectSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.itemListDP=new eui.ArrayCollection,this.eItemList.itemRenderer=ItemBaseSelect,this.eItemList.dataProvider=this.itemListDP,this.eItemList.selectedIndex=0,this.eList0.itemRenderer=BeastSkillItemRender,this.eList0.dataProvider=new eui.ArrayCollection(GlobalConfig.BeastBaseConfig.fixedAtt),this.eList1.itemRenderer=BeastSkillItemRender,this.eList1.dataProvider=new eui.ArrayCollection(GlobalConfig.BeastBaseConfig.randomAtt),this.randomAttNum=CommonUtils.getObjectLength(GlobalConfig.BeastBaseConfig.randomAtt),this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getTreasureBtn.text+"</u>")},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currentState=t&&t[0]?t[0]:"normal",this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postHatchInfo,this.closeWin),this.observe(BeastCT.ins().postSeniorHatchInfo,this.onSeniorHatchInfo),this.updateItems(),this.updateView()},e.prototype.removeDisplay=function(){egret.Tween.removeTweens(this)},e.prototype.onSeniorHatchInfo=function(t){var e=this;this.showEff=!0,this.selectId=0;var i=egret.Tween.get(this);i.to({selectId:5*this.randomAttNum+t-1},2500,egret.Ease.quadOut).wait(1e3).call(function(){e.showEff=!1,e.closeWin()},this)},e.prototype.enterFrame=function(){this.showEff&&(this.eList1.selectedIndex=Math.round(this.selectId%this.randomAttNum))},e.prototype.updateView=function(){this.zb.text=GlobalConfig.BeastBaseConfig.advHatchCostYB+"";var t=GlobalConfig.BeastBaseConfig.advHatchCostItems[0],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.id);this.isEnough=e>=t.count,this.eCostIcon.source=GlobalConfig.ItemConfig[t.id].icon+"_png",this.num.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this.isEnough?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+e+"/"+t.count+"|）")},e.prototype.updateItems=function(){this.itemListDP.source=BagCT.ins().getBagGoodsByType(ItemType.TYPE_42)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.onClick=function(t){if(t.target instanceof BeastSkillItemRender){var e=t.target.data;return void ViewManager.ins().open(BeastEggTipsWin,e[0],e[1],TextFlowMaker.generateTextFlow(e[2]))}switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.getTreasureBtn:WarnCT.ins().setBuyGoodsWarn(GlobalConfig.BeastBaseConfig.itemIndex,1);break;case this.eSmeltBtn:var i=this.eItemList.selectedItem,s=BeastCT.ins().getEmptyPos();if(!i||0==s)return void TipsCT.ins().showTips("无法孵化");this.eItemList.touchEnabled=this.eItemList.touchChildren=!1,"senior"==this.currentState?this.isEnough||GlobalFun.checkMoney(GlobalConfig.BeastBaseConfig.advHatchCostYB)?(this.eSmeltBtn.enabled=!1,BeastCT.ins().sendSeniorHatch(i.configID,s)):TipsCT.ins().showTips("道具不足"):(this.eSmeltBtn.enabled=!1,BeastCT.ins().sendHatch(i.configID,s))}},e}(BaseEuiView);__reflect(BeastEggSelectWin.prototype,"BeastEggSelectWin"),window.BeastEggSelectWin=BeastEggSelectWin,ViewManager.ins().reg(BeastEggSelectWin,LayerManager.UI_Popup);var BeastEggTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareAnimalHoleSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.eImg.source=t[0],this.sName=t[1]||"",this.eDesc.textFlow=t[2]?t[2]:null,this.addTouchEvent(this,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastEggTipsWin.prototype,"BeastEggTipsWin"),window.BeastEggTipsWin=BeastEggTipsWin,ViewManager.ins().reg(BeastEggTipsWin,LayerManager.UI_Popup);var BeastFormationPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareFrontSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.panels=[this.panel0,this.panel1,this.panel2,this.panel3,this.panel4];for(var t=0;t<this.panels.length;t++)this.panels[t].wuXing=t+1;this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastFrontSkillItem,this.eList.dataProvider=this.listDP,this.mc=new MovieClip,this.eEffGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"rareBeast0",-1)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BeastCT.ins().postBeastPut,this.update),this.observe(BeastCT.ins().postFormationUp,this.update),this.observe(BeastRedPoint.ins().postFrontRedPoint,this.updateRed),this.addTouchEvent(this,this.onClick),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRed.visible=BeastRedPoint.ins().frontRedPoint},e.prototype.update=function(){this.eEffGroup.filters=BeastCT.ins().formationStage>0?null:FilterUtil.ARRAY_GRAY_FILTER,this.powerPanel.setPower(BeastCT.ins().formationPower),this.updateList()},e.prototype.updateList=function(){var t=BeastCT.ins(),e=[];for(var i in GlobalConfig.BeastAllSkillConfig){var s=GlobalConfig.BeastAllSkillConfig[i];
t.getActSkillLv(s.id)>0&&e.push(s.id)}this.listDP.replaceAll(e)},e.prototype.onClick=function(t){if(t.target instanceof BeastFrontSkillItem)return void ViewManager.ins().open(BeastSkillTipsWin,t.target.data);switch(t.target){case this.eEffGroup:ViewManager.ins().open(BeastFrontSkillWin,0);break;case this.eBtn:ViewManager.ins().open(AttrWin,[{title:"高级属性",attrs:BeastCT.ins().getWuXingAttrs()}])}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(BeastFormationPanel.prototype,"BeastFormationPanel"),window.BeastFormationPanel=BeastFormationPanel;var BeastFormationSelectWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareFrontSelectSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastSelectItemRenderer1,this.eList.dataProvider=this.listDP,this.eList.selectedIndex=0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.wuXing=t[0],this.pos=t[1],this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postBeastPut,this.closeWin),this.update()},e.prototype.update=function(){this.updateList(),this.updateAtt()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.updateList=function(){var t=BeastCT.ins(),e=[];for(var i in GlobalConfig.BeastConfig){var s=GlobalConfig.BeastConfig[i];!t.isActionById(s.id)||s.wx!=this.wuXing&&0!=s.wx||e.push([s])}e.sort(this.sort),this.listDP.source=e},e.prototype.sort=function(t,e){var i=t[0],s=e[0],n=BeastCT.ins().isInFormation(i.id),o=BeastCT.ins().isInFormation(s.id);return n&&!o?-1:!n&&o?1:0},e.prototype.updateAtt=function(){var t=AttributeFormat.getFormat(),e=this.eList.selectedItem?this.eList.selectedItem[0]:null;if(this.eAttr.visible=!!e,e){var i=BeastCT.ins().getBeastInfoById(e.id),s=GlobalConfig.BeastStageConfig[e.id][i?i.stage:0],n="";for(var o in s.basicAttr){var a=AttributeData.getAttStrByType1(s.basicAttr[o],t);n+=+o%2==0?StringUtils.complementByChar(a,20):a+"\n"}this.eAttr.textFlow=TextFlowMaker.generateTextFlow(n)}},e.prototype.onClick=function(t){if(t.target instanceof BeastSelectItemRenderer1)return void this.updateAtt();switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.eBtn:var e=this.eList.selectedItem?this.eList.selectedItem[0]:null;e&&!BeastCT.ins().isInFormation(e.id)&&BeastCT.ins().sendBeastPut(this.wuXing,this.pos,e.id)}},e}(BaseEuiView);__reflect(BeastFormationSelectWin.prototype,"BeastFormationSelectWin"),window.BeastFormationSelectWin=BeastFormationSelectWin,ViewManager.ins().reg(BeastFormationSelectWin,LayerManager.UI_Popup);var BeastFrontAttrRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareFrontSkillTermSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1],i=0,s="";if(0==t)switch(e){case 1:case 2:case 3:case 4:case 5:i=BeastCT.ins().getWxXingPower(e),s=i+"\n万",this.sName=BeastCT.getWuXingName(e)+"\n属\n性";break;case 6:i=BeastCT.ins().formationStage,s=i+"\n阶",this.sName="命\n盘";break;case 7:i=BeastCT.ins().totalStage,s=i+"\n只",this.sName="PR\n异\n兽"}else{var n=BeastCT.getWuXingName(t),o=BeastCT.ins().formationInfos[t];switch(e){case 1:i=MathUtils.toInteger(o.att/1e4),s=i+"\n万",this.sName=n+"\n攻\n击";break;case 2:i=MathUtils.toInteger(o.def/1e4),s=i+"\n万",this.sName=n+"\n防\n御";break;case 3:i=o.qualit[0],s=i+"\n只",this.sName="R\n异\n兽";break;case 4:i=o.qualit[1],s=i+"\n只",this.sName="SR\n异\n兽";break;case 5:i=o.qualit[2],s=i+"\n只",this.sName="SSR\n异\n兽";break;case 6:i=o.qualit[3],s=i+"\n只",this.sName="SSSR\n异\n兽";break;case 7:i=o.qualit[4],s=i+"\n只",this.sName="PR\n异\n兽"}}this.eVal.text=s,this.eVal.textColor=i>0?ColorUtil.GREEN:ColorUtil.GRAY}},e}(BaseItemRender);__reflect(BeastFrontAttrRenderer.prototype,"BeastFrontAttrRenderer"),window.BeastFrontAttrRenderer=BeastFrontAttrRenderer;var BeastFrontItem=function(t){function e(){var e=t.call(this)||this;return e._sn_="RareFrontItemSelectSkin",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){if(this.beastId>0){var t=GlobalConfig.BeastConfig[this.beastId];this.eIcon.source="RareLittle_"+this.beastId,this.eNature.source="nature_"+t.wx,this.eQuality.source=BeastCT.getQualityRes(t.quality)}else this.eQuality.source=this.eNature.source=this.eIcon.source=""},e.prototype.setData=function(t){this.beastId=t,this.skin&&this.update()},e}(BaseView);__reflect(BeastFrontItem.prototype,"BeastFrontItem"),window.BeastFrontItem=BeastFrontItem;var BeastFrontItemPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="RareFrontItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.items=[this.item1,this.item2,this.item3],this.mc=new MovieClip,this.eEffGroup.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postBeastPut,this.update),this.observe(BeastCT.ins().postFormationUp,this.update),this.update()},e.prototype.update=function(){var t=BeastCT.ins().formationInfos[this.wuXing];this.eShow.source="rareFrontPart_"+this.wuXing;for(var e=0;e<this.items.length;e++)this.items[e].setData(t.beastId[e]);var i=GlobalConfig.BeastGodSkillConfig[this.wuXing],s=!1;for(var e in i){var n=BeastCT.ins().getActSkillLv(i[e][1].skillId);if(n>0){s=!0;break}}s?(this.eShow.visible=!1,this.mc.playFile(RES_DIR_EFF+("rareBeast"+this.wuXing),-1)):(this.mc.stop(),this.mc.visible=!1,this.eShow.visible=!0)},e.prototype.onClick=function(t){var e=this.items.indexOf(t.target);if(e>-1)return void ViewManager.ins().open(BeastFormationSelectWin,this.wuXing,e+1);switch(t.target){case this.eEffGroup:ViewManager.ins().open(BeastFrontSkillWin,this.wuXing)}},e}(BaseView);__reflect(BeastFrontItemPanel.prototype,"BeastFrontItemPanel"),window.BeastFrontItemPanel=BeastFrontItemPanel;var BeastFrontSkillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareFrontSkillItemSkin",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.skillId=this.data;var t=GlobalConfig.BeastAllSkillConfig[this.skillId];this.eShow.source="RareSkill"+this.skillId,this.eDes.text=t.name,this.eLv.text=BeastCT.ins().getActSkillLv(this.skillId)+""}},e}(BaseItemRender);__reflect(BeastFrontSkillItem.prototype,"BeastFrontSkillItem"),window.BeastFrontSkillItem=BeastFrontSkillItem;var BeastFrontSkillItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareFrontSkillListTermSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=t.type||0;0==e?this.updateFormSkill():this.updateGodSkill()}},e.prototype.updateFormSkill=function(){var t=this.data,e=t.skillId;this.eTerm.textFlow=TextFlowMaker.generateTextFlow(BeastCT.ins().getFrontSkillStr(t)),this.updateView(e,t.level)},e.prototype.updateGodSkill=function(){var t=this.data,e=t.skillId;this.eTerm.textFlow=TextFlowMaker.generateTextFlow(BeastCT.ins().getGodSkillStr(t)),this.updateView(e,t.level)},e.prototype.updateView=function(t,e){var i=BeastCT.ins().getActSkillLv(t),s=i>=e;this.eName.text=GlobalConfig.BeastAllSkillConfig[t].name+(" 等级"+e),this.eName.textColor=s?ColorUtil.GREEN:ColorUtil.GRAY},e}(BaseItemRender);__reflect(BeastFrontSkillItemRenderer.prototype,"BeastFrontSkillItemRenderer"),window.BeastFrontSkillItemRenderer=BeastFrontSkillItemRenderer;var BeastFrontSkillListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareFrontSkillListSkin",e.touchChildren=!0,e.touchEnabled=!1,e.eList.itemRenderer=BeastFrontSkillItemRenderer,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0];0==t?this.updateFormSkill():this.updateGodSkill()}},e.prototype.updateFormSkill=function(){var t=this.data[1],e=t[1].skillId,i=BeastCT.ins().getActSkillLv(e);this.eList.dataProvider=new eui.ArrayCollection(this._showList?CommonUtils.objectToArray(t):[]),this.eTerm.textFlow=TextFlowMaker.generateTextFlow(BeastCT.ins().getFrontSkillStr(t[i||1])),this.updateView(e)},e.prototype.updateGodSkill=function(){var t=this.data[1],e=t[1].skillId,i=BeastCT.ins().getActSkillLv(e);this.eList.dataProvider=new eui.ArrayCollection(this._showList?CommonUtils.objectToArray(t):[]),this.eTerm.textFlow=TextFlowMaker.generateTextFlow(BeastCT.ins().getGodSkillStr(t[i||1])),this.updateView(e)},e.prototype.updateView=function(t){var e=BeastCT.ins().getActSkillLv(t),i=e>0;this.eItem.skillId=t,this.eItem.eShow.source="RareSkill"+t,this.eName.text=GlobalConfig.BeastAllSkillConfig[t].name,this.eName.textColor=i?ColorUtil.GREEN:ColorUtil.GRAY,this.eLv.text="等级"+(e||1),this.eLv.textColor=i?ColorUtil.GREEN:ColorUtil.GRAY},Object.defineProperty(e.prototype,"showList",{get:function(){return this._showList},set:function(t){this._showList=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(BeastFrontSkillListRenderer.prototype,"BeastFrontSkillListRenderer"),window.BeastFrontSkillListRenderer=BeastFrontSkillListRenderer;var BeastFrontSkillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listSelect=0,e.isEnough=!1,e._sn_="RareFrontSkillSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.attListDP=new eui.ArrayCollection,this.eAttList.itemRenderer=BeastFrontAttrRenderer,this.eAttList.dataProvider=this.attListDP,this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastFrontSkillListRenderer,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.wuXing=t[0],this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postFormationUp,this.update),this.observe(BeastRedPoint.ins().postFrontRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRed.visible=0==this.wuXing&&BeastRedPoint.ins().frontRedPoint},e.prototype.update=function(){this.updateAttList(),this.updateList(),this.updateView()},e.prototype.updateView=function(){this.isEnough=!1;var t=!GlobalConfig.BeastFormStageConfig[BeastCT.ins().formationStage+1];if(0==this.wuXing){var e=GlobalConfig.BeastFormStageConfig[BeastCT.ins().formationStage];if(!t){this.eIcon.source=GlobalConfig.ItemConfig[e.cost[0].id].icon+"_png";var i=e.cost[0].count,s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.cost[0].id);this.isEnough=s>=i;var n="|C:"+(s>=i?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+s+"/"+i+"|";this.eNum.textFlow=TextFlowMaker.generateTextFlow(n)}}this.eBtn.visible=this.eCostGroup.visible=0==this.wuXing&&!t,this.eName.text=GlobalConfig.BeastBaseConfig.formNames[this.wuXing]},e.prototype.updateAttList=function(){for(var t=[],e=1;7>=e;e++)t.push([this.wuXing,e]);this.attListDP.source=t},e.prototype.updateList=function(){var t=[];if(0==this.wuXing)for(var e in GlobalConfig.BeastFormSkillConfig)t.push([this.wuXing,GlobalConfig.BeastFormSkillConfig[e]]);else{var i=GlobalConfig.BeastGodSkillConfig[this.wuXing];for(var e in i)t.push([this.wuXing,i[e]])}this.listDP.source=t},e.prototype.onClick=function(t){if(t.target instanceof BeastFrontSkillItem)return void ViewManager.ins().open(BeastSkillTipsWin,t.target.skillId);if(t.target.parent.parent instanceof BeastFrontSkillListRenderer){var e=t.target.parent.parent;if(this.listSelect==e.itemIndex)e.showList=!e.showList;else{var i=this.eList.getElementAt(this.listSelect);i&&(i.showList=!1),e.showList=!0,this.listSelect=e.itemIndex}return void this.listDP.refresh()}switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.eBtn:this.isEnough?BeastCT.ins().sendFormationUp():TipsCT.ins().showTips("材料不足")}},e}(BaseEuiView);__reflect(BeastFrontSkillWin.prototype,"BeastFrontSkillWin"),window.BeastFrontSkillWin=BeastFrontSkillWin,ViewManager.ins().reg(BeastFrontSkillWin,LayerManager.UI_Popup);var BeastGetWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareAnimalGetSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.beastItemId=t[0],this.addTouchEvent(this,this.onClick),this.eShow.source=BeastCT.getBeastImgRes(this.beastItemId),this.eShow1.source=BeastCT.getBeastImgRes(this.beastItemId);var i=GlobalConfig.BeastConfig[this.beastItemId];this.eQuality.source=BeastCT.getQualityRes(i.quality),this.eWuXing.source="nature_"+i.wx,this.eName.source=BeastCT.getBeastNameRes(this.beastItemId),this.showEff()},e.prototype.showEff=function(){var t=this;if(this.skin){this.eShow1.scaleX=this.eShow.scaleX,this.eShow1.scaleY=this.eShow.scaleY,this.eShow1.alpha=1,this.eShow1.visible=!0;var e=egret.Tween.get(this.eShow1);e.to({alpha:1},300).to({scaleX:1.2*this.eShow1.scaleX,scaleY:1.2*this.eShow1.scaleY,alpha:0},500).call(function(){t.eShow1.scaleX=t.eShow1.scaleY=1})}},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastGetWin.prototype,"BeastGetWin"),window.BeastGetWin=BeastGetWin,ViewManager.ins().reg(BeastGetWin,LayerManager.UI_Popup);var BeastHatchItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareHatchItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=BeastCT.ins().isUnlockEggPosByPos(t.pos);if(this.eLock.visible=!e,!e)return this.eImg.source="",void(this.sTime="");var i=BeastCT.ins().getEggPosInfoByPos(t.pos);if(!i||!i.eggItemId)return this.eImg.source="",void(this.sTime="");this.eImg.source=GlobalConfig.ItemConfig[i.eggItemId].icon+"_png";var s=(i.timeLeft-egret.getTimer())/1e3;s>0?this.sTime=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_1):this.sTime="孵化完成"}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(BeastHatchItemRenderer.prototype,"BeastHatchItemRenderer"),window.BeastHatchItemRenderer=BeastHatchItemRenderer;var BeastHatchPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curSelectPos=-1,e._sn_="RareHatchSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastHatchItemRenderer,this.eList.dataProvider=this.listDP,this.mc=new MovieClip,this.eCostIcon.source=GlobalConfig.ItemConfig[GlobalConfig.BeastBaseConfig.advHatchCostItems[0].id].icon+"_png"},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curSelectPos=1,this.addTouchEvent(this,this.onClick),Timer.start(1e3,0,this.updateTimer,this),this.observe(BeastCT.ins().postHatchInfo,this.update),this.observe(BeastCT.ins().postSeniorHatchInfo,this.update),this.observe(BeastCT.ins().postHatchTimeUp,this.update),this.observe(BeastCT.ins().postGetBeast,this.onGetBeast),this.eList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickList,this),this.updateList()},e.prototype.removeDisplay=function(){Timer.stopAll(this),this.rareRelive&&egret.Tween.removeTweens(this.rareRelive)},e.prototype.onGetBeast=function(t){t>0&&ViewManager.ins().open(BeastGetWin,t),this.update()},e.prototype.updateTimer=function(){this.listDP.refresh(),this.eList.selectedIndex=this._curSelectPos-1;var t=BeastCT.ins().getEggPosInfoByPos(this._curSelectPos);t&&t.beastItemId>0&&!this.mc.parent&&this.updateView()},e.prototype.onClickList=function(){if(BeastCT.ins().isUnlockEggPosByPos(this.eList.selectedIndex+1))this.curSelectPos=this.eList.selectedIndex+1;else{var t=GlobalConfig.BeastEggPlotConfig[this.eList.selectedIndex+1],e=t.count,i=BeastCT.ins().seniorHatchTotal>=e?ColorUtil.GREEN:ColorUtil.RED;ViewManager.ins().open(BeastEggTipsWin,t.icon,t.name,TextFlowMaker.generateTextFlow("解锁条件|C:"+i+"&T:"+BeastCT.ins().seniorHatchTotal+"/"+e+"|")),this.eList.selectedIndex=this._curSelectPos-1}},e.prototype.update=function(){this.updateView()},e.prototype.updateView=function(){this.zb.text=GlobalConfig.BeastBaseConfig.advHatchCostYB+"";var t=GlobalConfig.BeastBaseConfig.advHatchCostItems[0],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.id);this.num.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e>=t.count?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+e+"/"+t.count+"|）"),e=BeastCT.ins().hasHatchNum;var i=GlobalConfig.BeastBaseConfig.dailyHatchConut,s=i>e?ColorUtil.GREEN:ColorUtil.RED;this.eNumTips.textFlow=TextFlowMaker.generateTextFlow("孵化上限(|C:"+s+"&T:"+e+"/"+i+"|)");var n=BeastCT.ins().getEggPosInfoByPos(this._curSelectPos);if(!n||n.eggItemId<=0)this.eEggIcon.source=this.eEggName.source=this.eWuXing.source="",this.eQualityGroup.visible=!1;else{this.eEggName.source=GlobalConfig.BeastEggConfig[n.eggItemId].nameRes,this.eQualityGroup.visible=!0;var o=GlobalConfig.BeastEggConfig[n.eggItemId];this.eQualityL.source=BeastCT.getQualityRes(o.quality[0]),this.eQualityR.source=BeastCT.getQualityRes(o.quality[1]),this.eWuXing.source=BeastCT.getWuXingRes(n.wuXing),this.eEggIcon.source="egg_"+o.quality[1]+"_png"}if(this.rareRelive&&egret.Tween.removeTweens(this.rareRelive),!n||n.eggItemId<=0||0==n.beastItemId)this.mc.stop(),DisplayUtils.removeFromParent(this.mc),this.rareRelive.visible=!1;else{var o=GlobalConfig.BeastEggConfig[n.eggItemId];this.eEffGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+("rareEgg"+o.quality[1]),-1),this.rareRelive.visible=!0,this.rareRelive.right=40;var a=egret.Tween.get(this.rareRelive,{loop:!0});a.to({right:60},1e3).to({right:40},1e3)}},e.prototype.updateList=function(){this.listDP.source=CommonUtils.objectToArray(GlobalConfig.BeastEggPlotConfig)},e.prototype.onClick=function(t){var e="senior";switch(t.target){case this.eEggIcon:var i=BeastCT.ins().getEggPosInfoByPos(this._curSelectPos);i&&i.beastItemId>0&&BeastCT.ins().sendGetBeast(this._curSelectPos);break;case this.eNormalBtn:e="normal";case this.eSeniorBtn:var s=BeastCT.ins().getEmptyPos();0==s?TipsCT.ins().showTips("没有空位"):BeastCT.ins().hasHatchNum>=GlobalConfig.BeastBaseConfig.dailyHatchConut?TipsCT.ins().showTips("今天孵化已达到上限"):ViewManager.ins().open(BeastEggSelectWin,e)}},Object.defineProperty(e.prototype,"curSelectPos",{set:function(t){this._curSelectPos!=t&&(this._curSelectPos=t,this.eList.selectedIndex=t-1,this.updateView())},enumerable:!0,configurable:!0}),__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(BeastHatchPanel.prototype,"BeastHatchPanel"),window.BeastHatchPanel=BeastHatchPanel;var BeastlEggPosWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareAnimalHoleSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.addTouchEvent(this,this.onClick);var s=GlobalConfig.BeastEggPlotConfig[i].count,n=BeastCT.ins().seniorHatchTotal>=s?ColorUtil.GREEN:ColorUtil.RED;this.eDesc.textFlow=TextFlowMaker.generateTextFlow("|C:"+n+"&T:"+BeastCT.ins().seniorHatchTotal+"/"+s+"|")},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastlEggPosWin.prototype,"BeastlEggPosWin"),window.BeastlEggPosWin=BeastlEggPosWin,ViewManager.ins().reg(BeastlEggPosWin,LayerManager.UI_Popup);var BeastMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareAnimalSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.tab.validateNow()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(BeastRedPoint.ins().postStarRedPoint,this.updateRed),this.observe(BeastRedPoint.ins().postStageRedPoint,this.updateRed),this.observe(BeastRedPoint.ins().postFrontRedPoint,this.updateRed),this.updateRed()},e.prototype.removeDisplay=function(){BeastCT.ins().winSelecPos=0},e.prototype.onClick=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[63].text)}},e.prototype.updateRed=function(){for(var t=0;t<this.viewStack.numElements;t++){var e=!1;switch(this.viewStack.getElementAt(t)){case this.RareStarPanel:e=BeastRedPoint.ins().starTotal;break;case this.RareRankPanel:e=BeastRedPoint.ins().stageTotal;break;case this.RareFrontPanel:e=BeastRedPoint.ins().frontRedPoint;break;default:e=!1}this.tab.getElementAt(t).eRp.visible=e}},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseEuiView);__reflect(BeastMainWin.prototype,"BeastMainWin"),window.BeastMainWin=BeastMainWin,ViewManager.ins().reg(BeastMainWin,LayerManager.UI_Main);var ActivityType47Data=function(t){function e(e){var i=t.call(this,e)||this;return i.itemData={},i.update(e),i}return __extends(e,t),e.prototype.update=function(t){var e=t.readShort();this.itemData={};for(var i=0;e>i;i++)this.itemData[t.readInt()]=t.readInt()},e.prototype.getChangeItems=function(t){var e=[],i=GlobalConfig.ActivityType47Config[this.id];for(var s in i){var n=i[s].groupId;n.indexOf(t)>-1&&e.push(i[s])}return e.sort(this.itemSort),e},e.prototype.itemSort=function(t,e){var i=Activity.ins().activityData[t.index],s=i.canChangeNum(t),n=i.canChangeNum(e),o=i.isEnough(t),a=i.isEnough(e);return s>0&&0>=n?-1:0>=s&&n>0?1:o&&!a?-1:!o&&a?1:t.discount<e.discount?-1:t.discount>e.discount?1:0},e.prototype.isEnough=function(t){for(var e in t.materials){var i=t.materials[e];if(0==i.type){if(i.id==MoneyConst.yuanbao&&Actor.yb<i.count)return!1}else{var s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.id);if(s<i.count)return!1}}return!0},e.prototype.canChangeNum=function(t){return Math.max(0,t.count-(this.itemData[t.propid]||0))},e.prototype.canReward=function(){return this.canRewardByGroup()},e.prototype.canRewardByGroup=function(t){void 0===t&&(t=-1);var e=GlobalConfig.ActivityType47Config[this.id];for(var i in e){var s=e[i];if(-1==t){if(this.canChangeNum(s)&&this.isEnough(s))return!0}else if(s.groupId.indexOf(t)>-1&&this.canChangeNum(s)&&this.isEnough(s))return!0}return!1},e.prototype.getGroups=function(){var t=[],e=GlobalConfig.ActivityType47Config[this.id];for(var i in e){var s=e[i];for(var n in s.groupId){var o=s.groupId[n];-1==t.indexOf(o)&&t.push(o)}}t.sort(this.sort);var a=[];for(var i in t)a.push([this.id,t[i]]);return a},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t,e)},e.prototype.isOpenActivity=function(){var t=GlobalConfig.ActivityType47Config[this.id],e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t&&0>e&&i>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType47Data.prototype,"ActivityType47Data"),window.ActivityType47Data=ActivityType47Data;var BeastSelectItemRenderer1=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){var e=this.data[0];this.eHasLab.visible=BeastCT.ins().isInFormation(e.id)}},e}(BeastSelectItemRenderer);__reflect(BeastSelectItemRenderer1.prototype,"BeastSelectItemRenderer1"),window.BeastSelectItemRenderer1=BeastSelectItemRenderer1;var BeastSelectWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareSelectSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastSelectItemRenderer,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.redPoints=t[0],this.addTouchEvent(this,this.onClick),this.eList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.update()},e.prototype.update=function(){var t=[];for(var e in GlobalConfig.BeastConfig){var i=GlobalConfig.BeastConfig[e];t.push([i,this.redPoints[i.id]])}t.sort(BeastCT.sortListMenu),this.listDP.replaceAll(t)},e.prototype.onClickMenu=function(){BeastCT.ins().postSetWinSelectPos(this.eList.selectedIndex),ViewManager.ins().close(this)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastSelectWin.prototype,"BeastSelectWin"),window.BeastSelectWin=BeastSelectWin,ViewManager.ins().reg(BeastSelectWin,LayerManager.UI_Popup);var BeastSkillItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareHatchSkillItemSkin",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.eImg.source=this.data[0],this.sName=this.data[1])},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(BeastSkillItemRender.prototype,"BeastSkillItemRender"),window.BeastSkillItemRender=BeastSkillItemRender;var BeastSkillTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareFrontSkillTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.skillId=t[0],this.addTouchEndEvent(this,this.onClick),this.update()},e.prototype.update=function(){var t,e=BeastCT.ins().getActSkillcfg(this.skillId),i=!!e;if(i)t=e.type||0;else{var s=BeastCT.ins().getSkillInfo(this.skillId);t=s.wuXing,e=0>=t?GlobalConfig.BeastFormSkillConfig[s.index][1]:GlobalConfig.BeastGodSkillConfig[s.wuXing][s.index][1]}0==t?this.updateFormSkill(i,e):this.updateGodSkill(i,e),this.updateView()},e.prototype.updateFormSkill=function(t,e){var i=GlobalConfig.BeastFormSkillConfig[e.index],s="",n=0;for(var o in i)s+="|C:"+(t&&e.level>=i[o].level?ColorUtil.GREEN:ColorUtil.GRAY)+"&T:"+i[o].lvDes+"|\n",n++;this.eLvDes.textFlow=TextFlowMaker.generateTextFlow(s),this.eIcon.eDes.text=e.level+"/"+n},e.prototype.updateGodSkill=function(t,e){var i=GlobalConfig.BeastGodSkillConfig[e.type][e.index],s="",n=0;for(var o in i)s+="|C:"+(t&&e.level>=i[o].level?ColorUtil.GREEN:ColorUtil.GRAY)+"&T:"+i[o].lvDes+"|\n",n++;this.eLvDes.textFlow=TextFlowMaker.generateTextFlow(s),this.eIcon.eDes.text=e.level+"/"+n},e.prototype.updateView=function(){var t=GlobalConfig.BeastAllSkillConfig[this.skillId];this.eIcon.eShow.source="RareSkill"+this.skillId,this.eIcon.eLv.text="",this.eName.text=t.name,this.eSkillDes.textFlow=TextFlowMaker.generateTextFlow(t.des)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastSkillTipsWin.prototype,"BeastSkillTipsWin"),window.BeastSkillTipsWin=BeastSkillTipsWin,ViewManager.ins().reg(BeastSkillTipsWin,LayerManager.UI_Popup);var BeastStageSkillItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareAnimalSkillItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=BeastCT.ins().getBeastInfoById(t.id),i=!!e&&e.stage>=t.unlockStage;this.eImage.source=t.skillIcon,this.eLock.visible=!i,this.eImage.filters=i?null:FilterUtil.ARRAY_GRAY_FILTER,this.eDes.text=i?t.skillName:t.unlockStage+"阶解锁"}},e}(BaseItemRender);__reflect(BeastStageSkillItemRenderer.prototype,"BeastStageSkillItemRenderer"),window.BeastStageSkillItemRenderer=BeastStageSkillItemRenderer;var BeastTalentTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZhanlingSkillTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(t[0])},e.prototype.update=function(t){if(t){var e=BeastCT.ins().getBeastInfoById(t[1].id),i=0;if(e)for(var s in t){if(!(e.lv>=t[s].beastLevelLimit))break;i=t[s].level}var n=i>0,o=n&&!t[i+1];n?o?this.currentState="max":this.currentState="active":this.currentState="unactive",i=Math.max(1,i),this.skillName0.text=t[1].name+("Lv"+i);var a=AttributeFormat.getFormat();this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(t[i].basicAttr,a)),this.condition0.text=n?"":t[i].beastLevelLimit+"级",!o&&n&&(this.skillName1.text=t[1].name+("Lv"+Math.max(1,i+1)),this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(t[i+1].basicAttr,a)),this.condition1.text=t[i+1].beastLevelLimit+"级")}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastTalentTipsWin.prototype,"BeastTalentTipsWin"),window.BeastTalentTipsWin=BeastTalentTipsWin,ViewManager.ins().reg(BeastTalentTipsWin,LayerManager.UI_Popup);var BeastTipsItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="PRTipsSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.eLab.textFlow=TextFlowMaker.generateTextFlow1(this.data))},e}(BaseItemRender);__reflect(BeastTipsItemRenderer.prototype,"BeastTipsItemRenderer"),window.BeastTipsItemRenderer=BeastTipsItemRenderer;var BeastTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YiShouPRTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastTipsItemRenderer,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BeastCT.ins().postTreasureLog,this.updateList),this.addTouchEvent(this,this.onClick),this.updateList()},e.prototype.updateList=function(){this.listDP.source=BeastCT.ins().roundLogs},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BeastTipsWin.prototype,"BeastTipsWin"),window.BeastTipsWin=BeastTipsWin,ViewManager.ins().reg(BeastTipsWin,LayerManager.UI_Popup);var BeastUpStagePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canUp=!1,e.canShowEff=!1,e._sn_="RareRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listMenuDP=new eui.ArrayCollection,this.eListMenu.itemRenderer=BeastSelectItemRenderer,this.eListMenu.dataProvider=this.listMenuDP,this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeastStageSkillItemRenderer,this.eList.dataProvider=this.listDP,this.horizontal=this.curAtt.horizontalCenter,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getTreasureBtn.text+"</u>")},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curSelect=BeastCT.ins().winSelecPos,this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postUpStage,this.update),this.observe(BeastCT.ins().postSetWinSelectPos,this.updateSelect),this.observe(BeastRedPoint.ins().postStageRedPoint,this.updateRed),this.eListMenu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),Timer.start(3e3,0,this.showEff,this),this.update(!1)},e.prototype.removeDisplay=function(){Timer.stop(this.showEff,this),this.eShow0&&egret.Tween.removeTweens(this.eShow0),this.listScroller&&this.listScroller.viewport&&egret.Tween.removeTweens(this.listScroller.viewport)},e.prototype.updateSelect=function(){this.curSelect=BeastCT.ins().winSelecPos},e.prototype.updateRed=function(){this.updateListMenu()},e.prototype.update=function(t){void 0===t&&(t=!0),t&&this.showEff(),this.updateListMenu(),this.updateView()},e.prototype.updateView=function(){var t=this.eListMenu.selectedItem?this.eListMenu.selectedItem[0]:null;
if(!t)return void(this.curSelect=BeastCT.ins().winSelecPos);var e=BeastCT.ins(),i=e.isActionById(t.id);this.canShowEff=i;var s=e.getBeastInfoById(t.id),n=GlobalConfig.BeastStageConfig[t.id][s?s.stage:0],o=!!s&&!GlobalConfig.BeastStageConfig[t.id][(s?s.stage:0)+1];this.eDesImg.source=BeastCT.getBeastNameRes(t.id),this.eQuality.source=BeastCT.getQualityRes(t.quality),this.eWuXing.source="nature_"+t.wx,this.ePowerPanel.setPower(i?s.stagePower:0),this.eShow.source=BeastCT.getBeastImgRes(t.id),this.eShow.filters=i?null:FilterUtil.ARRAY_GRAY_FILTER,this.eShow0.source=BeastCT.getBeastImgRes(t.id),this.eShow0.visible=i,this.eShow0.alpha=0,this.eBtn.label=i?"一键升阶":"激 活",this.eCursor.visible=this.eUpGroup.visible=!o,this.curAtt.horizontalCenter=o?0:this.horizontal,this.nextAtt.visible=!o&&i,this.curAtt.visible=i,this.getTreasureBtn.visible=!0;var a=AttributeFormat.getFormat();if(a.attrColor=a.wordColor=10458221,o)this.canUp=!1,this.curAtt.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(n.basicAttr,a)),this.getTreasureBtn.visible=!1;else{var r=n.cost[0];this.itemId=r.id;var l=GlobalConfig.ItemConfig[r.id];this.eItemIcon.setData(l);var h=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,r.id);this.canUp=h>=r.count;var p=h>=r.count?ColorUtil.GREEN:ColorUtil.RED;if(this.ePraCost.textFlow=TextFlowMaker.generateTextFlow(l.name+"(|C:"+p+"&T:"+h+"/"+r.count+"|)"),i){this.curAtt.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(n.basicAttr,a));var u=GlobalConfig.BeastStageConfig[t.id][s.stage+1];a.attrColor=a.wordColor=3066402,this.nextAtt.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(u.basicAttr,a))}else;}this.updateList()},e.prototype.updateList=function(){this.listDP.source=CommonUtils.objectToArray(GlobalConfig.BeastStageSkillConfig[this.eListMenu.selectedItem[0].id])},e.prototype.updateListMenu=function(){var t=[];for(var e in GlobalConfig.BeastConfig){var i=GlobalConfig.BeastConfig[e];t.push([i,BeastRedPoint.ins().stageRedPoint[i.id]])}t.sort(BeastCT.sortListMenu);var s=0;this.listMenuDP.source.length>0&&(s=this.listMenuDP.source[this._curSelect][0].id),this.listMenuDP.replaceAll(t);var n=this._curSelect;for(var e in this.listMenuDP.source)if(this.listMenuDP.source[e][0].id==s){n=+e;break}this.curSelect=this.eListMenu.selectedIndex=n},e.prototype.onClickMenu=function(){this.curSelect=this.eListMenu.selectedIndex},Object.defineProperty(e.prototype,"curSelect",{set:function(t){var e=this;if(this._curSelect!=t)if(this._curSelect=t,BeastCT.ins().winSelecPos=this._curSelect,egret.Tween.removeTweens(this.listScroller.viewport),this.eListMenu.getElementAt(t))this.eListMenu.selectedIndex=t,this.updateView();else{var i=egret.Tween.get(this.listScroller.viewport);i.to({scrollH:106*BeastCT.ins().winSelecPos},2e3,egret.Ease.cubicInOut).call(function(){e.eListMenu.selectedIndex=t,e.updateView()},this)}},enumerable:!0,configurable:!0}),e.prototype.onClick=function(t){if(t.target instanceof BeastStageSkillItemRenderer){var e=t.target.data;return void ViewManager.ins().open(YupeiSkillTipsWin,e.skillName||"",e.skillDesc||"")}switch(t.target){case this.eBtn:if(this.canUp){var e=this.eListMenu.selectedItem?this.eListMenu.selectedItem[0]:null;e&&BeastCT.ins().sendUpStage(e.id)}else TipsCT.ins().showTips("材料不足");break;case this.eLeftBtn:this.onLeft();break;case this.eRightBtn:this.onRight();break;case this.eListBtn:ViewManager.ins().open(BeastSelectWin,BeastRedPoint.ins().stageRedPoint);break;case this.getTreasureBtn:WarnCT.ins().setBuyGoodsWarn(this.itemId,1)}},e.prototype.onLeft=function(){var t=92,e=this.eListMenu.scrollH-t;e=Math.round(e/t)*t,0>e&&(e=0),this.eListMenu.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=92,e=this.eListMenu.scrollH+t;e=92*Math.round(e/92),e>this.eListMenu.contentWidth-this.eListMenu.width&&(e=this.eListMenu.contentWidth-this.eListMenu.width),this.eListMenu.scrollH=e,this.onChange()},e.prototype.onChange=function(){this.eListMenu.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.eListMenu.scrollH>=this.eListMenu.contentWidth-this.eListMenu.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0)},e.prototype.showEff=function(){if(this.canShowEff&&this.skin){this.eShow0.scaleX=this.eShow.scaleX,this.eShow0.scaleY=this.eShow.scaleY,this.eShow0.alpha=0,this.eShow0.visible=!0;var t=egret.Tween.get(this.eShow0);t.to({alpha:1},300).to({scaleX:1.2*this.eShow0.scaleX,scaleY:1.2*this.eShow0.scaleY,alpha:0},500)}},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateView",null),__decorate([callLater],e.prototype,"updateListMenu",null),e}(BaseView);__reflect(BeastUpStagePanel.prototype,"BeastUpStagePanel"),window.BeastUpStagePanel=BeastUpStagePanel;var BeastUpStarPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canAction=!1,e.canShowEff=!1,e._sn_="RareStarSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listMenuDP=new eui.ArrayCollection,this.eListMenu.itemRenderer=BeastSelectItemRenderer,this.eListMenu.dataProvider=this.listMenuDP,this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=BeactTalentItemRenderer,this.eList.dataProvider=this.listDP,this.horizontal=this.eCurAtt.horizontalCenter,this.eShow1.alpha=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getTreasureBtn.text+"</u>")},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curSelect=BeastCT.ins().winSelecPos,this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postUpLevel,this.update),this.observe(BeastCT.ins().postUpStage,this.update),this.observe(BeastCT.ins().postSetWinSelectPos,this.updateSelect),this.observe(BeastRedPoint.ins().postStarRedPoint,this.updateRed),this.eListMenu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),Timer.start(3e3,0,this.showEff,this),this.update(!1)},e.prototype.removeDisplay=function(){Timer.stop(this.showEff,this),this.eShow1&&egret.Tween.removeTweens(this.eShow1),this.listScroller&&this.listScroller.viewport&&egret.Tween.removeTweens(this.listScroller.viewport)},e.prototype.updateSelect=function(){this.curSelect=BeastCT.ins().winSelecPos},e.prototype.updateRed=function(){this.updateListMenu()},e.prototype.update=function(t){void 0===t&&(t=!0),t&&this.showEff(),this.updateListMenu(),this.updateView()},e.prototype.updateView=function(){var t=this.eListMenu.selectedItem?this.eListMenu.selectedItem[0]:null;if(!t)return void(this.curSelect=BeastCT.ins().winSelecPos);var e=BeastCT.ins(),i=e.isActionById(t.id);this.canShowEff=i;var s=e.getBeastInfoById(t.id),n=GlobalConfig.BeastLevelConfig[t.quality][s?s.lv:0],o=!!s&&!GlobalConfig.BeastLevelConfig[t.quality][(s?s.lv:0)+1];this.sStage=s?"阶数:"+s.stage:"",this.sLv=s?"等级:"+s.lv:"",this.eName.source=BeastCT.getBeastNameRes(t.id),this.eQuality.source=BeastCT.getQualityRes(t.quality),this.eWuXing.source="nature_"+t.wx,this.ePowerPanel.setPower(i?s.lvPower:0),this.eShow.source=BeastCT.getBeastImgRes(t.id),this.eShow.filters=i?null:FilterUtil.ARRAY_GRAY_FILTER,this.eShow1.source=BeastCT.getBeastImgRes(t.id),this.eShow1.visible=i,this.eShow1.alpha=0,this.eCursor.visible=!o,this.eCurAtt.horizontalCenter=o?0:this.horizontal,this.eUpGroup.visible=this.eNextAtt.visible=!o&&i,this.eCurAtt.visible=i,this.activateGroup.visible=!i,this.canAction=!1;var a=AttributeFormat.getFormat();if(a.attrColor=a.wordColor=10458221,this.getTreasureBtn.visible=!0,o)this.getTreasureBtn.visible=!1;else{if(n.gold>0&&(this.ePraCost0.textFlow=TextFlowMaker.generateTextFlow("|C:"+(Actor.gold>=n.gold?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+n.gold+"|")),n.itemNum>0){this.itemId=t.lvItemId;var r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,this.itemId);this.ePraCost1.textFlow=TextFlowMaker.generateTextFlow("|C:"+(r>=n.itemNum?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+r+"/"+n.itemNum+"|"),this.eProp1.source=GlobalConfig.ItemConfig[this.itemId].icon+"_png"}if(i){this.eCurAtt.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(AttributeData.getAttrFromCfg(n),a));var l=GlobalConfig.BeastLevelConfig[t.quality][s.lv+1];a.attrColor=a.wordColor=3066402,this.eNextAtt.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(AttributeData.getAttrFromCfg(l),a))}else{var h=GlobalConfig.BeastStageConfig[t.id][s?s.stage:0],p=h.cost[0];this.itemId=p.id;var u=GlobalConfig.ItemConfig[p.id];this.eItemIcon.setData(u);var r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,p.id);this.canAction=r>=p.count;var d=r>=p.count?ColorUtil.GREEN:ColorUtil.RED;this.eActCost.textFlow=TextFlowMaker.generateTextFlow(u.name+"(|C:"+d+"&T:"+r+"/"+p.count+"|)")}}this.updateList()},e.prototype.updateList=function(){this.listDP.source=CommonUtils.objectToArray(GlobalConfig.BeastTalentConfig[this.eListMenu.selectedItem[0].id])},e.prototype.updateListMenu=function(){var t=[];for(var e in GlobalConfig.BeastConfig){var i=GlobalConfig.BeastConfig[e];t.push([i,BeastRedPoint.ins().starRedPoint[i.id]])}t.sort(BeastCT.sortListMenu),this.listMenuDP.replaceAll(t),this.eListMenu.selectedIndex=this._curSelect},e.prototype.onClickMenu=function(){this.curSelect=this.eListMenu.selectedIndex},Object.defineProperty(e.prototype,"curSelect",{set:function(t){var e=this;if(this._curSelect!=t)if(this._curSelect=t,BeastCT.ins().winSelecPos=this._curSelect,egret.Tween.removeTweens(this.listScroller.viewport),this.eListMenu.getElementAt(t))this.eListMenu.selectedIndex=t,this.updateView();else{var i=egret.Tween.get(this.listScroller.viewport);i.to({scrollH:106*BeastCT.ins().winSelecPos},2e3,egret.Ease.cubicInOut).call(function(){e.eListMenu.selectedIndex=t,e.updateView()},this)}},enumerable:!0,configurable:!0}),e.prototype.onClick=function(t){if(t.target instanceof BeactTalentItemRenderer)return void ViewManager.ins().open(BeastTalentTipsWin,t.target.data);var e=0;switch(t.target){case this.eTenBtn:e=2;break;case this.eBtn:e=1;break;case this.eLeftBtn:this.onLeft();break;case this.eRightBtn:this.onRight();break;case this.eActBtn:if(this.canAction){var i=this.eListMenu.selectedItem?this.eListMenu.selectedItem[0]:null;i&&BeastCT.ins().sendUpStage(i.id)}else TipsCT.ins().showTips("材料不足");break;case this.eListBtn:ViewManager.ins().open(BeastSelectWin,BeastRedPoint.ins().starRedPoint);break;case this.getTreasureBtn:WarnCT.ins().setBuyGoodsWarn(this.itemId,1)}e>0&&this.levelUp(e)},e.prototype.levelUp=function(t){var e=this.eListMenu.selectedItem?this.eListMenu.selectedItem[0]:null;if(e){var i=BeastCT.ins().getBeastInfoById(e.id);if(i){var s=GlobalConfig.BeastLevelConfig[e.quality],n=2==t?10:1,o=GlobalConfig.BeastStageConfig[i.id][i.stage].maxlevel;if(i.lv+n>o&&s[i.lv+n])return void TipsCT.ins().showTips("需进阶拓展等级上限");for(var a=0,r={},l=0;n>l;l++){var h=s[l];if(!h)break;if(h.gold>0&&(a+=h.gold),h.itemNum>0){var p=r[e.lvItemId]||new RewardData;p.id=e.lvItemId,p.type=1,p.count=(p.count||0)+h.itemNum,r[e.lvItemId]=p}}if(Actor.gold<a)return void TipsCT.ins().showTips("材料不足");for(var l in r){var u=r[l],d=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,u.id);if(d<u.count)return void TipsCT.ins().showTips("材料不足")}BeastCT.ins().sendUpLevel(i.id,t)}}},e.prototype.onLeft=function(){var t=92,e=this.eListMenu.scrollH-t;e=Math.round(e/t)*t,0>e&&(e=0),this.eListMenu.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=92,e=this.eListMenu.scrollH+t;e=92*Math.round(e/92),e>this.eListMenu.contentWidth-this.eListMenu.width&&(e=this.eListMenu.contentWidth-this.eListMenu.width),this.eListMenu.scrollH=e,this.onChange()},e.prototype.onChange=function(){this.eListMenu.scrollH<46?(this.eLeftGroup.visible=!1,this.eRightGroup.visible=!0):this.eListMenu.scrollH>=this.eListMenu.contentWidth-this.eListMenu.width-46?(this.eLeftGroup.visible=!0,this.eRightGroup.visible=!1):(this.eLeftGroup.visible=!0,this.eRightGroup.visible=!0)},e.prototype.showEff=function(){if(this.canShowEff&&this.skin){this.eShow1.scaleX=this.eShow.scaleX,this.eShow1.scaleY=this.eShow.scaleY,this.eShow1.alpha=1,this.eShow1.visible=!0;var t=egret.Tween.get(this.eShow1);t.to({alpha:1},300).to({scaleX:1.2*this.eShow1.scaleX,scaleY:1.2*this.eShow1.scaleY,alpha:0},500)}},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateView",null),__decorate([callLater],e.prototype,"updateListMenu",null),e}(BaseView);__reflect(BeastUpStarPanel.prototype,"BeastUpStarPanel"),window.BeastUpStarPanel=BeastUpStarPanel;var TreasureBeastPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.huntType=0,e._sn_="TreasureYishouSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.sCost1=GlobalConfig.BeastTreasureBase.costYB+"",this.sCost10=GlobalConfig.BeastTreasureBase.costYBten+"",this.eBar.maximum=GlobalConfig.BeastTreasureBase.maxBlissVal,this.eTips.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.BeastTreasureBase.tips)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(BeastCT.ins().postTreasure,this.updateView),this.observe(BeastCT.ins().postTreasureLog,this.updateLogs),this.observe(BeastCT.ins().postRound,this.updateView),this.observe(BeastRedPoint.ins().postTreasureRedPoint,this.updateRed),this.updateView(),this.updateLogs(),this.updateRed()},e.prototype.updateShow=function(){for(var t=BeastCT.ins().firstTen?GlobalConfig.BeastTreasureBase.treasureItems:GlobalConfig.BeastTreasureBase.treasureItems2,e=0;e<t.length;e++)this["gift"+e].data=t[e]},e.prototype.updateView=function(){this.eFirstTips.visible=!BeastCT.ins().firstTen,this.eBar.value=Math.min(BeastCT.ins().blessing,this.eBar.maximum),this.hopeValue.text=BeastCT.ins().blessing+"";var t=BeastCT.ins().hasTreasure>=GlobalConfig.BeastTreasureBase.costNumber?ColorUtil.GREEN:ColorUtil.RED;this.eTips0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+BeastCT.ins().hasTreasure+"/"+GlobalConfig.BeastTreasureBase.costNumber+"|"),this.updateShow()},e.prototype.updateLogs=function(){var t=BeastCT.ins().logs,e="";for(var i in t)e+=t[i]+"\n";this.eLogs.textFlow=TextFlowMaker.generateTextFlow1(e)},e.prototype.updateRed=function(){this.eRp0.visible=BeastRedPoint.ins().roundRedPoint,this.eRp1.visible=BeastRedPoint.ins().freeRedPoint,this.eRp2.visible=BeastRedPoint.ins().outBagRedPoint},e.prototype.enterFrame=function(){var t=BeastCT.ins().freeCD;t>0?this.sTime="免费寻宝"+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1):this.sTime="",this.eBtn1.label=t>0?"寻宝1次":"免费寻宝"},e.prototype.onClick=function(t){switch(t.target){case this.eBtn1:this.buyHunt(0);break;case this.eBtn10:this.buyHunt(1);break;case this.eBtnWin:ViewManager.ins().open(TreasureBeastPRWin);break;case this.eOutBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Beast)}},e.prototype.buyHunt=function(t){this.huntType=t;var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.BeastTreasureBase.costItemId);if(BeastCT.ins().freeCD<=0&&0==t||e&&e.count)BeastCT.ins().sendTreasure(t);else{var i=0==t?GlobalConfig.BeastTreasureBase.costYB:GlobalConfig.BeastTreasureBase.costYBten;HuntWarnBuyWin.showBuyWarn("TreasureBeastPanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.BeastTreasureBase.costItemId].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.BeastTreasureBase.costYB:GlobalConfig.BeastTreasureBase.costYBten;GlobalFun.checkMoney(t)&&BeastCT.ins().sendTreasure(this.huntType)},__decorate([callLater],e.prototype,"updateView",null),__decorate([callLater],e.prototype,"updateLogs",null),__decorate([callLater],e.prototype,"updateRed",null),e}(BaseView);__reflect(TreasureBeastPanel.prototype,"TreasureBeastPanel"),window.TreasureBeastPanel=TreasureBeastPanel;var TreasureBeastPRWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isTopLevel=!0,e._sn_="TreasurePRSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BeastCT.ins().postRound,this.resultCallBack),this.addTouchEvent(this,this.onClick),this.updateView()},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:this.getLottery();break;case this.eLogBtn:ViewManager.ins().open(BeastTipsWin)}},e.prototype.updateView=function(){var t=GlobalConfig.BeastTurntableConfig[BeastCT.ins().round];for(var e in t){var i=RewardData.objectToRewardData(t[e].item);i.isRedPoint=BeastCT.ins().getRoundReward.indexOf(t[e].index)>-1?2:0,this["gift"+(+e-1)].data=i}var s=BeastCT.ins().hasTreasure>=GlobalConfig.BeastTreasureBase.costNumber?ColorUtil.GREEN:ColorUtil.RED;this.eTips.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+BeastCT.ins().hasTreasure+"/"+GlobalConfig.BeastTreasureBase.costNumber+"|"),this.eBtn.enabled=!BeastCT.ins().isRoundFinish()},e.prototype.getLottery=function(){return this.rolling?void TipsCT.ins().showTips("正在抽奖，请稍候"):BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void(BeastCT.ins().hasTreasure>=GlobalConfig.BeastTreasureBase.costNumber?BeastCT.ins().sendRound(0):TipsCT.ins().showTips("未满足寻宝条件"))},e.prototype.resultCallBack=function(t){var e=this;if(t>0){var i=1440+36*(t-1),s=egret.Tween.get(this.eZhiZhen);this.rolling=!0,s.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.flyItem(e["gift"+(t-1)]),BeastCT.ins().sendRound(1),e.updateView(),e.rolling=!1},this)}},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e}(BaseEuiView);__reflect(TreasureBeastPRWin.prototype,"TreasureBeastPRWin"),window.TreasureBeastPRWin=TreasureBeastPRWin,ViewManager.ins().reg(TreasureBeastPRWin,LayerManager.UI_Main);var BloodstainCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.LianJi,e.regNetMsg(16,e.postInfo),e.regNetMsg(17,e.postLvUp),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){this.roleBloodInfos=[];for(var e=t.readByte(),i=0;e>i;i++){for(var s={roleId:t.readByte(),equipInfos:[]},n=t.readByte(),o=0;n>o;o++){var a={pos:t.readByte(),power:t.readUnsignedInt(),lv:t.readByte()};s.equipInfos[a.pos]=a}this.roleBloodInfos.push(s)}},e.prototype.sendLvUp=function(t,e){var i=this.getBytes(17);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postLvUp=function(t){var e=t.readByte(),i=t.readByte();if(this.roleBloodInfos&&this.roleBloodInfos[e]){var s=this.roleBloodInfos[e].equipInfos[i];s.lv=t.readByte(),s.power=t.readUnsignedInt()}},e.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.BloodstainBaseConfig,i="";return GameServer.serverOpenDay+1<e.openday?i="第"+e.openday+"天开启":ZsCT.ins().lv<e.zslevel&&(i=e.zslevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.checkItem=function(t){if(!t||!t.itemConfig)return!1;if(!e.checkOpen())return!1;var i=ItemUtil.getType(t.itemConfig);if(i!=ItemType.TYPE_0)return!1;var s=ItemUtil.getSubType(t.itemConfig);return-1==GlobalConfig.BloodstainBaseConfig.enableSlot.indexOf(s)?!1:!0},e.prototype.getBloodstainEquip=function(t,e){return this.roleBloodInfos?this.roleBloodInfos[t].equipInfos[e]:null},e.prototype.getEquipSuitLvs=function(t){var e=this.roleBloodInfos[t],i=[];for(var s in e.equipInfos)i.push(e.equipInfos[s].lv);return i.sort(Algorithm.sortDesc),i},__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postLvUp",null),e}(BaseSystem);__reflect(BloodstainCT.prototype,"BloodstainCT"),System.BloodstainCT=function(){return BloodstainCT.ins()},window.BloodstainCT=BloodstainCT;var BloodstainRedPoint=function(t){function e(){var e=t.call(this)||this;return e.rolePoints=[],e.itemReds=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,BloodstainCT.ins().postInfo,BloodstainCT.ins().postLvUp,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.rolePoints.length;e++)this.rolePoints[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){if(!BloodstainCT.checkOpen()||!BloodstainCT.ins().roleBloodInfos)return!1;for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);e?this.rolePoints[t]=this.postItemReds(t):this.rolePoints[t]=!1}return!0},e.prototype.postItemReds=function(t){this.itemReds[t]=[];var e=!1;if(!BloodstainCT.ins().roleBloodInfos)return e;var i=BloodstainCT.ins().roleBloodInfos[t],s=SubRoles.ins().getSubRoleByIndex(t);if(!i)return e;for(var n in i.equipInfos){var o=i.equipInfos[n];if(this.itemReds[t][o.pos]=!1,s.equipsData[o.pos].item.itemConfig){var a=GlobalConfig.BloodstainLevelConfig[o.lv];if(a.costItem){var r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,a.costItem[0].id),l=r>=a.costItem[0].count;this.itemReds[t][o.pos]=l,l&&(e=l)}}}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postItemReds",null),e}(BaseSystem);__reflect(BloodstainRedPoint.prototype,"BloodstainRedPoint"),System.BloodstainRedPoint=function(){return BloodstainRedPoint.ins()},window.BloodstainRedPoint=BloodstainRedPoint;var BloodstainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.iconYs=[],e.curRole=0,e.curPos=0,e.isEnough=!1,e._sn_="XueyinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curPos=t[0],this.curRole=t[1]||0,this.roleSelect.setCurRole(this.curRole),this.addTouchEndEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(BloodstainCT.ins().postLvUp,this.update),this.observe(BloodstainRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.removeDisplay=function(){if(this.skin)for(var t=0;3>t;t++)egret.Tween.removeTweens(this["eIcon"+t])},e.prototype.update=function(){var t=BloodstainCT.ins().getBloodstainEquip(this.curRole,this.curPos);this.updateView(t),this.updateAttr(t),this.updateCost(t),this.updateRed()},e.prototype.updateRed=function(){this.eBtn.eRp.visible=BloodstainRedPoint.ins().itemReds[this.curRole][this.curPos]},e.prototype.updateView=function(t){if(this.skin){this.powerPanel.setPower(t.power);for(var e=t.lv,i=0;3>i;i++){var s=this["eIcon"+i];if(this.iconYs[i]||(this.iconYs[i]=s.y),s.filters=e>i?null:FilterUtil.ARRAY_GRAY_FILTER,egret.Tween.removeTweens(s),e>i){s.y=this.iconYs[i];var n=egret.Tween.get(s,{loop:!0});n.to({y:this.iconYs[i]+10},500).to({y:this.iconYs[i]},500)}s=this["guangzhu"+i],s.visible=e>i}}},e.prototype.updateAttr=function(t){var e=GlobalConfig.BloodstainLevelConfig[t.lv],i=GlobalConfig.BloodstainLevelConfig[t.lv+1],s=!i,n=AttributeFormat.getFormat();n.wordColor=n.attrColor=null,s?(this.plain.visible=!1,this.eMaxCur.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(AttributeData.getAttrFromCfg(e),n))):(this.plain.visible=!0,this.eCurLab.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(AttributeData.getAttrFromCfg(e),n)),this.eNextLab.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(AttributeData.getAttrFromCfg(i),n))),this.maxShowGroup.visible=!this.plain.visible;var o=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子","","面甲","护肩","披风","护符"];this.eSpecialLab.text=e.equipAdd>0?o[t.pos]+"部位基础属性+"+MathUtils.toInteger(e.equipAdd/100)+"%":""},e.prototype.updateCost=function(t){var e=GlobalConfig.BloodstainLevelConfig[t.lv],i=GlobalConfig.BloodstainLevelConfig[t.lv+1],s=!i;if(this.eBtn.visible=this.eCostGroup.visible=!s,!s){var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.costItem[0].id);this.isEnough=n>=e.costItem[0].count;var o=this.isEnough?ColorUtil.GREEN:ColorUtil.RED;this.eMaterial.textFlow=TextFlowMaker.generateTextFlow("|C:"+o+"&T:"+n+"|/"+e.costItem[0].count),this.eItemImg.source=GlobalConfig.ItemConfig[e.costItem[0].id].icon+"_png"}this.eMaxLevel.visible=s},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){this.curRole!=t&&(this.curRole=t,this.update())},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:this.isEnough?BloodstainCT.ins().sendLvUp(this.curRole,this.curPos):TipsCT.ins().showTips("道具不足，无法铭刻")}},e.prototype.openCheck=function(){return BloodstainCT.checkOpen()},e}(BaseEuiView);__reflect(BloodstainWin.prototype,"BloodstainWin"),window.BloodstainWin=BloodstainWin,ViewManager.ins().reg(BloodstainWin,LayerManager.UI_Main);var ContactBtnCT=function(t){function e(){var e=t.call(this)||this;return e.openCheck()&&(e.observe(GameLogic.ins().postEnterMap,e.onChangeScene),e.observe(GameLogic.ins().postViewOpen,e.onChangeScene),e.btn=window.platform.getContact()),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onChangeScene=function(t){void 0===t&&(t=-1),-1!=t&&(this.type=t),1==this.type||0!=GameMap.fbType||0!=GameMap.fubenID?window.platform.hideContact(this.btn):window.platform.showContact(this.btn)},e.prototype.openCheck=function(){return window.platform.getOpenCheck?window.platform.getOpenCheck():!1},e}(BaseSystem);__reflect(ContactBtnCT.prototype,"ContactBtnCT"),System.ContactBtnCT=function(){return ContactBtnCT.ins()},window.ContactBtnCT=ContactBtnCT;var ControlCT=function(t){function e(){var e=t.call(this)||this;return e._dir=-1,e._isMoving=!1,e.publicCD=0,e.roleId=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir!=t&&(this._dir=t,this.checkMove())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMoving",{get:function(){return this._isMoving},set:function(t){this._isMoving&&!t&&(this.stopMove(),this.dir=-1),this._isMoving=t},enumerable:!0,configurable:!0}),e.prototype.checkMove=function(){return GameLogic.ins().stopAI(),EntrustManager.ins().cancelEntrusTask(EntrustType.Transfer),this.isMoving?this.moveByDir():!1},e.prototype.stopMove=function(){var t=SubRoles.lookAtTar;if(!t)return!1;var e=GameMap.point2Grip(t.x),i=GameMap.point2Grip(t.y),s=t.x%GameMap.CELL_SIZE>=GameMap.CELL_SIZE>>1,n=t.y%GameMap.CELL_SIZE>=GameMap.CELL_SIZE>>1,o=e,a=i;switch(this.dir){case 0:a=n?a:a-1;break;case 1:o=s?o+1:o,a=n?a:a-1;break;case 2:o=s?o+1:o;break;case 3:o=s?o+1:o,a=n?a+1:a;break;case 4:a=n?a+1:a;break;case 5:o=s?o:o-1,a=n?a+1:a;break;case 6:o=s?o:o-1;break;case 7:o=s?o:o-1,a=n?a:a-1}var r=t.x,l=t.y;GameMap.checkWalkable(o,a)&&(r=GameMap.grip2Point(o),l=GameMap.grip2Point(a)),GameMap.moveTo(r,l)},e.prototype.moveByDir=function(){var t=SubRoles.lookAtTar;if(!t)return!1;var e=GameMap.point2Grip(t.x),i=GameMap.point2Grip(t.y),s=e,n=i,o=0;switch(this.dir){case 0:n=0;break;case 1:o=Math.min(GameMap.COL-e,i),s+=o,n-=o;break;case 2:s=GameMap.COL;break;case 3:o=Math.min(GameMap.COL-e,GameMap.ROW-i),s+=o,n+=o;break;case 4:n=GameMap.ROW;break;case 5:o=Math.min(e,GameMap.ROW-i),s-=o,n+=o;break;case 6:s=0;break;case 7:o=Math.min(e,i),s-=o,n-=o}var a=BresenhamLine.isAbleToThrough(e,i,s,n);if(0==a[0]){var r=GameMap.grip2Point(a[2]),l=GameMap.grip2Point(a[3]);return GameMap.moveTo(r,l),!0}return!1},e}(BaseSystem);__reflect(ControlCT.prototype,"ControlCT"),System.ControlCT=function(){return ControlCT.ins()},window.ControlCT=ControlCT;var ControlView=function(t){function e(){var e=t.call(this)||this;return e._sn_="ControlSkin",e.touchId=-1,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.controlGroup.alpha=0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.addEvent(egret.TouchEvent.TOUCH_BEGIN,this,this.onTouchBegin),this.addEvent(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this,this.onTouchEnd),this.addEvent(egret.TouchEvent.TOUCH_END,this,this.onTouchEnd),this.addEvent(egret.TouchEvent.TOUCH_CANCEL,this,this.onTouchEnd),this.addEvent(eui.UIEvent.MOVE,this.controlGroup,this.moveCenter),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.moveCenter()},e.prototype.removeDisplay=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},e.prototype.onTouchBegin=function(t){t.target&&t.target.parent&&"GameFightSceneSkin"!=t.target.parent.skinName||(this.touchId=t.touchPointID,this.startX=t.stageX,this.startY=t.stageY,this.eBG.x=this.startX,this.eBG.y=this.startY,this.controlGroup.anchorOffsetX=this.controlGroup.width/2,this.controlGroup.anchorOffsetY=this.controlGroup.height/2,this.controlGroup.width=this.eBG.width+this.eRock.width,this.controlGroup.height=this.eBG.height+this.eRock.height,this.circleRadius=this.controlGroup.width/4,this.oldXY={x:0,y:0},ControlCT.ins().isMoving=!1)},e.prototype.onTouchMove=function(t){if(this.touchId==t.touchPointID){this.controlGroup.x=this.startX,this.controlGroup.y=this.startY;var e={x:t.stageX,y:t.stageY},i=MathUtils.getDistanceByObject(e,this.controlGroup);if(!(100>i&&0==this.controlGroup.alpha||this.checkOutsideStage(e))){var s=egret.Tween.get(this.controlGroup);s.to({alpha:1},500),ControlCT.ins().isMoving=i>0,i=Math.min(i,this.circleRadius);var n=MathUtils.getRadian2(this.controlGroup.x,this.controlGroup.y,e.x,e.y);this.eRock.horizontalCenter=Math.cos(n)*i,this.eRock.verticalCenter=Math.sin(n)*i,ControlCT.ins().dir=DirUtil.angle2dir(MathUtils.getAngle(n)),this.oldXY=e}}},e.prototype.checkOutsideStage=function(t){if(0==this.oldXY.x&&0==this.oldXY.y)this.oldXY=t;else{var e=Math.abs(this.oldXY.x-t.x),i=Math.abs(this.oldXY.y-t.y);if(t.x-e<=0||t.x+e>=StageUtils.ins().getWidth()||t.y-i<=0||t.y+i>=StageUtils.ins().getHeight())return this.moveEnd(),!0}return!1},e.prototype.onTouchEnd=function(t){this.touchId==t.touchPointID&&this.moveEnd()},e.prototype.moveEnd=function(){this.oldXY={x:0,y:0},this.touchId=-1,this.moveCenter(),egret.Tween.removeTweens(this.controlGroup),this.controlGroup.alpha=0,this.controlGroup.x=0-this.stage.width,this.controlGroup.y=0-this.stage.height,ControlCT.ins().isMoving=!1},e.prototype.moveCenter=function(){this.eRock.horizontalCenter=0,this.eRock.verticalCenter=0},e}(BaseEuiView);__reflect(ControlView.prototype,"ControlView"),window.ControlView=ControlView,ViewManager.ins().reg(ControlView,LayerManager.UI_Main);var CrossGuildBattleCT=function(t){function e(){var e=t.call(this)||this;return e.stageFullType=Battle_FullStatus.None,e.startingPoint=0,e.hasSign=!1,e.statusChange=!1,e.guildInfos={},e.guildPosition=[],e.winGuildId=0,e.myGuildResult=0,e.overTime=0,e.flagStatu=0,e._endTime=0,e.flagName="",e.flagAcId=0,e.flagGuild="",e.gongXun=0,e.killName="",e.killGuild="",e.doorDie=!1,e.attHandle=0,e.weixieList=[],e.canAttackList=[],e.logGuildId=0,e.myGuildMember=[],e.guildRewards=[],e.rewardGroupId=0,e.assignRewards=[],e.fbCanEnter=!1,e.canClick=!0,e.sysId=PackageID.CrossGuildBattle,e.regNetMsg(1,e.postStatus),e.regNetMsg(2,e.postSignUp),e.regNetMsg(3,e.postInfo),e.regNetMsg(4,e.postEnterChapter),e.regNetMsg(5,e.postPersonalRank),e.regNetMsg(6,e.postBattleGuildInfo),e.regNetMsg(7,e.postGuildInfo),e.regNetMsg(8,e.postBattleResult),e.regNetMsg(9,e.postAssignInfo),e.regNetMsg(10,e.postGuildRank),e.regNetMsg(11,e.postGongXun),e.regNetMsg(12,e.postFlagInfo),e.regNetMsg(13,e.postHudunInfo),e.regNetMsg(14,e.postReliveInfo),e.regNetMsg(15,e.postDoorInfo),e.regNetMsg(16,e.postChangeShowList),e.regNetMsg(17,e.postKillHuman),e.regNetMsg(18,e.postLogGuildId),e.regNetMsg(19,e.postBossInfo),e.regNetMsg(20,e.postFBInfo),e.observe(GameLogic.ins().postEnterMap,e.onEnterMap),e
}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onEnterMap=function(){if(this.checkFB(),this.clearGuildWarList(),this.killName="",3!=this.getCurMapLevel()&&(this.bossInfo=null),this.getCurMapLevel()>0){var t=void 0,e=void 0,i=EntityManager.ins().getAllEntity();for(var s in i)t=i[s],e=t.infoModel,e&&(e.guildID==Guild.ins().guildID||e.type!=EntityType.Role&&e.type!=EntityType.LadderPlayer||this.changecanPlayList(e.masterHandle))}},e.prototype.sendSignUp=function(){this.sendBaseProto(1)},e.prototype.postStatus=function(t){this.stageFullType=t.readUnsignedByte(),this.stageOverTime=DateUtils.formatMiniDateTime(t.readUnsignedInt()),this.statusChange=!0,this.stageFullType>Battle_FullStatus.None&&0==CommonUtils.getObjectLength(this.guildInfos)&&this.sendInfo()},e.prototype.sendEnter=function(){this.sendBaseProto(2)},e.prototype.postSignUp=function(t){this.hasSign=1==t.readUnsignedByte(),this.startingPoint=DateUtils.formatMiniDateTime(t.readUnsignedInt())},e.prototype.sendInfo=function(){this.sendBaseProto(3)},e.prototype.postInfo=function(t){this.statusChange=!1,this.guildInfos={},this.guildPosition=[];var e=[],i=t.readUnsignedByte();this.myGuildResult=Battle_Result.None;for(var s=0;i>s;s++){var n={guildId:t.readInt(),serverName:t.readUnsignedInt(),guildName:t.readString(),pos:t.readUnsignedByte(),power:0};this.guildInfos[n.guildId+""]=n,e[n.pos-1]=n.guildId,Guild.ins().guildID==n.guildId&&(this.myGuildResult=Battle_Result.Res32)}this.guildPosition.push(e);for(var o=0;4>o;o++){e=[];for(var a=t.readUnsignedByte(),s=0;a>s;s++){var r=t.readInt(),l=this.guildInfos[r].pos,h=Math.ceil(l/Math.pow(2,o+1));e[h-1]=r,Guild.ins().guildID==r&&this.myGuildResult++}this.guildPosition.push(e)}this.winGuildId=t.readInt(),e=[this.winGuildId],this.guildPosition.push(e),0!=this.winGuildId&&Guild.ins().guildID==this.winGuildId&&this.myGuildResult++},e.prototype.sendEnterChapter=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.postEnterChapter=function(t){},e.prototype.sendPersonalRank=function(){this.sendBaseProto(5)},e.prototype.postPersonalRank=function(t){var e=t.readUnsignedInt();this.myGuildMember=[];for(var i=0;e>i;i++){var s={roleID:t.readInt(),myName:t.readString(),mapName:t.readString(),point:t.readUnsignedInt(),attr:t.readUnsignedInt(),office:t.readUnsignedInt(),job:t.readUnsignedInt(),sex:t.readUnsignedInt()};this.myGuildMember.push(s)}},e.prototype.sendCollectFlag=function(){this.sendBaseProto(6)},e.prototype.postBattleGuildInfo=function(t){this.guildLId=t.readInt(),this.guildLScore=t.readUnsignedInt(),this.guildRId=t.readInt(),this.guildRScore=t.readUnsignedInt(),this.overTime=DateUtils.formatMiniDateTime(t.readUnsignedInt())},e.prototype.postGuildInfo=function(t){var e=t.readInt();this.guildLId==e?this.guildLScore=t.readUnsignedInt():this.guildRScore=t.readUnsignedInt()},e.prototype.sendGuildRank=function(){this.sendBaseProto(8)},e.prototype.postBattleResult=function(t){var e=t.readInt(),i=t.readUnsignedInt(),s=t.readInt(),n=t.readUnsignedInt(),o=t.readInt();ViewManager.ins().open(CrossGuildBattleResultWin,e,i,s,n,o)},e.prototype.postAssignInfo=function(t){var e=t.readUnsignedShort();e<this.guildRewards.length&&(ViewManager.ins().close(SelectMemberRewardWinEx),TipsCT.ins().showTips("奖励已分配完")),this.guildRewards=[];for(var i=0;e>i;i++){for(var s=t.readUnsignedInt(),n=[],o=0;s>o;o++){var a=new RewardData;a.parser(t),n.push(a)}this.guildRewards.push(n)}},e.prototype.sendAssignInfo=function(t){var e=this.getBytes(7);e.writeInt(t+1);var i=this.guildRewards[t];if(i){var s=i.length;e.writeInt(s);for(var n=1;s>=n;n++){e.writeInt(n);var o=this.assignRewards[n-1],a=o.length;e.writeInt(a);for(var r=0;a>r;r++){var l=o[r];e.writeInt(l.actorId),e.writeInt(l.num)}}this.sendToServer(e)}},e.prototype.postGuildRank=function(t){this.guildRankInfos=[];for(var e=t.readUnsignedByte(),i=0;e>i;i++){var s={power:t.readDouble(),serverName:t.readUnsignedInt(),guildName:t.readString(),guildId:0,pos:i+1};this.guildRankInfos.push(s)}},e.prototype.postGongXun=function(t){this.gongXun=t.readUnsignedInt()},e.prototype.postFlagInfo=function(t){this.flagAcId=0,this.flagStatu=t.readUnsignedShort(),0==this.flagStatu?this._endTime=1e3*t.readInt()+egret.getTimer():2==this.flagStatu?(this.flagName=t.readString(),this.flagAcId=t.readInt(),this._endTime=1e3*t.readInt()+egret.getTimer(),this.flagGuild=t.readString(),this.flagAcId==Actor.actorID&&TipsCT.ins().showTips("开始采集")):3==this.flagStatu},Object.defineProperty(e.prototype,"endTime",{get:function(){return Math.floor(Math.max((this._endTime-egret.getTimer())/1e3,0))},enumerable:!0,configurable:!0}),e.prototype.postHudunInfo=function(t){return[t.readUnsignedInt(),t.readUnsignedInt()]},e.prototype.postReliveInfo=function(t){var e=t.readUnsignedInt();this.killName=t.readString(),this.killGuild=t.readString(),ViewManager.ins().open(CrossGuileWarReliveWin,2,e)},e.prototype.postDoorInfo=function(t){this.doorDie=0==t.readByte()},e.prototype.postChangeShowList=function(t){if(14==GameMap.fbType){var e=t.readDouble(),i=(t.readInt(),t.readUnsignedByte()),s=i==this.getCurMapLevel();s&&(this.changeWeiXieList(e,!1),this.changecanPlayList(e,!1),this.attHandle&&this.attHandle==e&&(this.attHandle=0,console.log("cancel------------:"+e)))}},e.prototype.postKillHuman=function(t){var e=t.readInt();return e},e.prototype.sendLogGuildId=function(){this.sendBaseProto(9)},e.prototype.postLogGuildId=function(t){this.logGuildId=t.readInt()},e.prototype.postBossInfo=function(t){this.bossInfo={isDie:0==t.readUnsignedByte(),guildIdL:t.readInt(),guildNameL:"",timeL:t.readInt(),guildIdR:t.readInt(),guildNameR:"",timeR:t.readInt(),belongGuild:t.readInt(),belongStartTime:DateUtils.formatMiniDateTime(t.readInt()),belongName:t.readString(),belongHandle:t.readDouble()};var e=this.guildInfos[this.bossInfo.guildIdL];null!=e&&(this.bossInfo.guildNameL="s."+e.serverName+" "+e.guildName),e=this.guildInfos[this.bossInfo.guildIdR],null!=e&&(this.bossInfo.guildNameR="s."+e.serverName+" "+e.guildName)},e.prototype.postFBInfo=function(t){this.fbCanEnter=1==t.readByte()},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.CrossGuildBattleBase,i="";return GameServer.serverOpenDay+1<e.openDay||0==this.stageFullType?i="跨服战区内所有服务器开服达到"+e.openDay+"天开启":ZsCT.ins().lv<e.zhuanshengLevel&&(i=e.zhuanshengLevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getStatus=function(t){void 0===t&&(t=this.stageFullType);var e=[0,1,2,2,3,3,4,4,5,5,6,6,7];return e[t]||0},e.prototype.getStatusName=function(t){void 0===t&&(t=this.getStatus());var e=["","报名","小组赛","小组四强赛","小组冠军赛","半决赛","决赛","结束"];return e[t]||""},e.prototype.checkType=function(){return this.stageFullType<=Battle_FullStatus.Sign||this.stageFullType>=Battle_FullStatus.Over?0:this.stageFullType%2==0?1:2},e.prototype.checkMyGuild=function(){return null!=this.guildInfos[Guild.ins().guildID]},e.prototype.checkMine=function(){return 0==this.logGuildId||this.logGuildId==Guild.ins().guildID},e.prototype.checkFB=function(){GameMap.fbType==FbCT.FB_TYPE_GUILD_WAR&&this.getCurMapLevel()>0?ViewManager.ins().isShow(CrossGuildWarUiWin)||ViewManager.ins().open(CrossGuildWarUiWin):ViewManager.ins().isShow(CrossGuildWarUiWin)&&ViewManager.ins().close(CrossGuildWarUiWin)},e.prototype.getCurMapLevel=function(){var t=this.getCurMapLevelCfg();return t?t.id:0},e.prototype.getCurMapLevelCfg=function(){var t=GameMap.fubenID,e=GlobalConfig.CrossGuildBattleLevel,i=0;for(var s in e)t==e[s].fbId&&(i=e[s].id);return e[i]},Object.defineProperty(e.prototype,"clickTime",{get:function(){return this._clickTime},set:function(t){this.canClick=!1,this._clickTime=t,Timer.stop(this.endTimeChangeStatu,this),Timer.start(1e3,this._clickTime,this.endTimeChangeStatu,this)},enumerable:!0,configurable:!0}),e.prototype.endTimeChangeStatu=function(){--this._clickTime,this._clickTime<=0&&(this.canClick=!0,Timer.stop(this.endTimeChangeStatu,this))},e.prototype.changeWeiXieList=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),Actor.handle!=t){var s=this.checkListElements(t,this.weixieList);e?-1==s&&(this.weixieList.push(t),TipsCT.ins().showTips("|C:0xf3311e&T:"+i+" 正在攻击你|")):-1!=s&&this.weixieList.splice(s,1),GuildWar.ins().postWeixieChange(0)}},e.prototype.changecanPlayList=function(t,e){if(void 0===e&&(e=!0),Actor.handle!=t){var i=this.checkListElements(t,this.canAttackList);e?-1==i&&this.canAttackList.push(t):-1!=i&&this.canAttackList.splice(i,1),GuildWar.ins().postCanplayChange()}},e.prototype.clearGuildWarList=function(){this.weixieList=[],this.canAttackList=[],this.attHandle=0},e.prototype.checkListElements=function(t,e){if(e.length<=0)return-1;for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},e.prototype.getMyGuildPointRank=function(){for(var t,e,i=Guild.ins().getGuildMembers(0),s=i.length,n=[],o=0;s>o;o++)t=i[o],e=new SelectInfoData,e.data=t,e.num=this.getPointByAcId(t.roleID),n.push(e);return n.sort(this.sort),n},e.prototype.sort=function(t,e){var i=t.num,s=e.num;return i>s?-1:s>i?1:0},e.prototype.getPointByAcId=function(t){for(var e=this.myGuildMember.length,i=0;e>i;i++)if(this.myGuildMember[i].roleID==t)return this.myGuildMember[i].point;return 0},e.prototype.postChangeAssignMember=function(){},e.prototype.checkISSendAll=function(){var t=this.guildRewards[this.rewardGroupId];if(!t)return!1;for(var e=[],i=0;i<t.length;i++){var s=t[i].count,n=this.assignRewards[i],o=0;for(var a in n)o+=n[a].num,-1==n.indexOf(n[a])&&n.push(n[a]);if(s>o)return TipsCT.ins().showTips("|C:0xf3311e&T:|请先选择需要分配奖励的成员"),!1}for(var i in e)if(!Guild.ins().checkIsInGuild(e[i].actorId))return TipsCT.ins().showTips("|C:0xf3311e&T:|"+e[i].actorName+" 已退出公会"),!1;return!0},__decorate([post()],e.prototype,"postStatus",null),__decorate([post()],e.prototype,"postSignUp",null),__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postEnterChapter",null),__decorate([post()],e.prototype,"postPersonalRank",null),__decorate([post()],e.prototype,"postBattleGuildInfo",null),__decorate([post()],e.prototype,"postGuildInfo",null),__decorate([post()],e.prototype,"postBattleResult",null),__decorate([post()],e.prototype,"postAssignInfo",null),__decorate([post()],e.prototype,"postGuildRank",null),__decorate([post()],e.prototype,"postGongXun",null),__decorate([post()],e.prototype,"postFlagInfo",null),__decorate([post()],e.prototype,"postHudunInfo",null),__decorate([post()],e.prototype,"postReliveInfo",null),__decorate([post()],e.prototype,"postDoorInfo",null),__decorate([post()],e.prototype,"postChangeShowList",null),__decorate([post()],e.prototype,"postKillHuman",null),__decorate([post()],e.prototype,"postLogGuildId",null),__decorate([post()],e.prototype,"postBossInfo",null),__decorate([post()],e.prototype,"postFBInfo",null),__decorate([post()],e.prototype,"postChangeAssignMember",null),e}(BaseSystem);__reflect(CrossGuildBattleCT.prototype,"CrossGuildBattleCT");var Battle_Result;!function(t){t[t.None=0]="None",t[t.Res32=1]="Res32",t[t.Res16=2]="Res16",t[t.Res8=3]="Res8",t[t.Res4=4]="Res4",t[t.Res2=5]="Res2",t[t.Win=6]="Win"}(Battle_Result||(Battle_Result={})),window.Battle_Result=Battle_Result;var Battle_Status;!function(t){t[t.None=0]="None",t[t.Sign=1]="Sign",t[t.Round16=2]="Round16",t[t.Round8=3]="Round8",t[t.Round4=4]="Round4",t[t.Round2=5]="Round2",t[t.Round1=6]="Round1",t[t.Over=7]="Over"}(Battle_Status||(Battle_Status={})),window.Battle_Status=Battle_Status;var Battle_FullStatus;!function(t){t[t.None=0]="None",t[t.Sign=1]="Sign",t[t.Round32_S=2]="Round32_S",t[t.Round16_F=3]="Round16_F",t[t.Round16_S=4]="Round16_S",t[t.Round8_F=5]="Round8_F",t[t.Round8_S=6]="Round8_S",t[t.Round4_F=7]="Round4_F",t[t.Round4_S=8]="Round4_S",t[t.Round2_F=9]="Round2_F",t[t.Round2_S=10]="Round2_S",t[t.Round1_F=11]="Round1_F",t[t.Over=12]="Over"}(Battle_FullStatus||(Battle_FullStatus={})),window.Battle_FullStatus=Battle_FullStatus,System.CrossGuildBattleCT=function(){return CrossGuildBattleCT.ins()},window.CrossGuildBattleCT=CrossGuildBattleCT;var CrossGuildBattleRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,CrossGuildBattleCT.ins().postStatus,CrossGuildBattleCT.ins().postSignUp,CrossGuildBattleCT.ins().postInfo,CrossGuildBattleCT.ins().postLogGuildId,CrossGuildBattleCT.ins().postFBInfo,ZsCT.ins().postZsData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=CrossGuildBattleCT.ins();return this.redPoint=!1,t.checkOpen()?t.stageFullType==Battle_FullStatus.Sign?this.redPoint=!t.hasSign:2==t.checkType()&&(this.redPoint=t.fbCanEnter&&t.checkMyGuild()&&t.checkMine()):this.redPoint=!1,!0},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(CrossGuildBattleRedPoint.prototype,"CrossGuildBattleRedPoint"),System.CrossGuildBattleRedPoint=function(){return CrossGuildBattleRedPoint.ins()},window.CrossGuildBattleRedPoint=CrossGuildBattleRedPoint;var CrossGuildBattleAwardItem1=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFshachengGuildRewardsItemSkin",e.listDP=new eui.ArrayCollection,e.listDP2=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.sBg="Kfsc_jl"+t.id+"_png",this.listDP.source=t.winAwards,this.listDP2.source=t.loseAwards}},e}(BaseItemRender);__reflect(CrossGuildBattleAwardItem1.prototype,"CrossGuildBattleAwardItem1"),window.CrossGuildBattleAwardItem1=CrossGuildBattleAwardItem1;var CrossGuildBattleAwardItem2=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFshachengGroupRewardsItemSkin",e.listDP=new eui.ArrayCollection,e.listDP2=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.sTitle=t.title,this.listDP.source=t.winAwards,this.listDP2.source=t.loseAwards}},e}(BaseItemRender);__reflect(CrossGuildBattleAwardItem2.prototype,"CrossGuildBattleAwardItem2"),window.CrossGuildBattleAwardItem2=CrossGuildBattleAwardItem2;var CrossGuildBattleAwardItem3=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFshachengBattleRewardsItemSkin",e.listDP=new eui.ArrayCollection,e.listDP2=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.sTitle=t.title,this.listDP.source=t.winAwards,this.listDP2.source=t.loseAwards}},e}(BaseItemRender);__reflect(CrossGuildBattleAwardItem3.prototype,"CrossGuildBattleAwardItem3"),window.CrossGuildBattleAwardItem3=CrossGuildBattleAwardItem3;var CrossGuildBattleAwardPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFshachengRewardsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.listDP.source=CommonUtils.objectToArray(GlobalConfig.CrossGuildBattleAward[1]),this.listDP2=new eui.ArrayCollection,this.listDP2.source=CommonUtils.objectToArray(GlobalConfig.CrossGuildBattleAward[2]),this.listDP3=new eui.ArrayCollection,this.listDP3.source=CommonUtils.objectToArray(GlobalConfig.CrossGuildBattleAward[3])},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(t){t.target},e}(BaseEuiView);__reflect(CrossGuildBattleAwardPanel.prototype,"CrossGuildBattleAwardPanel"),window.CrossGuildBattleAwardPanel=CrossGuildBattleAwardPanel;var CrossGuildBattleGuildRankItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;t.pos<4?(this.sRankIcon="paihang"+t.pos,this.sRank=""):(this.sRankIcon="",this.sRank=t.pos+""),this.sName=t.guildName,this.sPower=t.power}},e}(BaseItemRender);__reflect(CrossGuildBattleGuildRankItem.prototype,"CrossGuildBattleGuildRankItem"),window.CrossGuildBattleGuildRankItem=CrossGuildBattleGuildRankItem;var CrossGuildBattleInfoPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curTeam=0,e._sn_="KFshachengpairupSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=CrossGuildBattleCT.ins(),this.addTouchEvent(this,this.onClick),this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+"KFghz",-1),this.eMCGroup.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.start(1e3,0,this.updateTime,this),this.observe(this.ins.postInfo,this.update),this.selectState("xzs")},e.prototype.removeDisplay=function(){Timer.stop(this.updateTime,this)},e.prototype.updateTime=function(){if(1==this.ins.checkType()){this.sTimeLab=this.ins.getStatus()==Battle_Status.Round1?"Kfscbm_sjxs1_png":"Kfscbm_sjxs2_png";var t=(this.ins.stageOverTime-GameServer.serverTime)/1e3;0>t&&(t=0);var e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1).split(":");this.s0=e[0],this.s1=e[1],this.s2=e[2]}else this.sTimeLab=this.s0=this.s1=this.s2=""},e.prototype.update=function(){this.updateName(),this.updateLine(),this.updateMyGuildTips(),this.sTitleIcon="xzs"==this.currentState?"Kfscbm_jjs"+(this.curTeam+1)+"_png":"Kfsc_scyg_pp5_png"},e.prototype.updateMyGuildTips=function(){var t=this.ins.getStatus();if(t<=Battle_Status.Sign)this.sMyGuildTips="";else if(this.ins.checkMyGuild())if(this.ins.myGuildResult==Battle_Result.Win)this.sMyGuildTips="所属公会在本届比赛中获得了冠军";else if(this.ins.myGuildResult<t-1)if(this.ins.myGuildResult==Battle_Result.Res32)this.sMyGuildTips="很遗憾，所属公会已在小组赛被淘汰";else{var e=["","小组赛第5-8名","小组赛第3-4名","小组赛第2名","季军","亚军"];this.sMyGuildTips="所属公会在本届比赛中获得了"+e[this.ins.myGuildResult]}else this.sMyGuildTips="所属公会"+(2==this.ins.checkType()?"正在":"即将")+"进行"+this.ins.getStatusName(t);else this.sMyGuildTips="所在公会没有参与本届比赛"},e.prototype.updateLine=function(){var t=[];if("xzs"==this.currentState)for(var e=0;3>e;e++)for(var i=this.ins.guildPosition[e],s=this.ins.guildPosition[e+1],n=4>>e,o=0;n>o;o++){var a=i?i[2*o+this.curTeam*(8>>e)]:0,r=s?s[o+this.curTeam*(4>>e)]:0;isNaN(r)?t.push(0):t.push(a==r?1:2)}else{t.length=4;for(var e=0;2>e;e++)for(var i=this.ins.guildPosition[e+3],s=this.ins.guildPosition[e+4],n=2>>e,o=0;n>o;o++){var a=i?i[2*o]:0,r=s?s[o]:0;!isNaN(r)&&r>0?t.push(a==r?1:2):t.push(0)}}for(var e=1;e<=t.length;e++){var l=t[e-1];this["sLine"+e]=0==l?"line_black":"line_light",this["sLineL"+e]=1==l?"line_light":"line_black",this["sLineR"+e]=2==l?"line_light":"line_black",this["sFilterL"+e]=2==l?FilterUtil.ARRAY_GRAY_FILTER:[],this["sFilterR"+e]=1==l?FilterUtil.ARRAY_GRAY_FILTER:[]}},e.prototype.updateName=function(){var t=[];if("xzs"==this.currentState)for(var e=0;4>e;e++)for(var i=this.ins.guildPosition[e],s=8>>e,n=0;s>n;n++){var o=i?i[n+this.curTeam*(8>>e)]:0;0!=o?t.push(this.ins.guildInfos[o]):t.push(null)}else{t.length=8;for(var e=0;3>e;e++)for(var i=this.ins.guildPosition[e+3],s=4>>e,n=0;s>n;n++){var o=i?i[n]:0;0!=o?t.push(this.ins.guildInfos[o]):t.push(null)}}for(var e=0;e<t.length;e++){var a=t[e];this["sName"+(e+1)]=a?a.guildName:8>e?"":"虚位以待",this["sServer"+(e+1)]=a?"s"+a.serverName:""}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn0:this.selectTeam(0);break;case this.eBtn1:this.selectTeam(1);break;case this.eBtn2:this.selectTeam(2);break;case this.eBtn3:this.selectTeam(3);break;case this.eTeamBtn:this.selectState("xzs");break;case this.eFinalsBtn:this.selectState("js")}},e.prototype.selectTeam=function(t){this.curTeam!=t&&(this.curTeam=t,this.update())},e.prototype.selectState=function(t){this.currentState!=t&&(this.currentState=t,this.update())},e}(BaseEuiView);__reflect(CrossGuildBattleInfoPanel.prototype,"CrossGuildBattleInfoPanel"),window.CrossGuildBattleInfoPanel=CrossGuildBattleInfoPanel;var CrossGuildBattleResultWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.repeatTimes=8,e._sn_="KFshachengResultSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],r=Guild.ins().guildID==a;this.closeBtn.name="退出",this.sBg=r?"win_png":"lost_png",this.sResultImg=r?"win_02":"lost_02";var l=CrossGuildBattleCT.ins(),h=l.guildInfos[i];this.sLeftGuild=h?"S"+h.serverName+"."+h.guildName:"",this.sLeftScore=s+"",h=l.guildInfos[n],this.sRightGuild=h?"S"+h.serverName+"."+h.guildName:"",this.sRightScore=o+"",this.sResultLab=r?"恭喜，您的行会齐心协力成功击败了对手":"很遗憾，您的行会未能战胜对手\n请下次再接再厉",this.sAwardTitle=r?"个人战斗胜利奖":"个人战斗失败奖";var p=GlobalConfig.CrossGuildBattleTime[l.stageFullType];this.eListDP.source=r?p.oneWinAward:p.oneFailAward,this.s=this.repeatTimes,Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this)},e.prototype.updateCloseBtnLabel=function(){this.s=this.s-1,this.s<=0&&(ViewManager.ins().close(this),FbCT.ins().sendExitFb()),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(e),FbCT.ins().sendExitFb()}},e}(BaseEuiView);__reflect(CrossGuildBattleResultWin.prototype,"CrossGuildBattleResultWin"),window.CrossGuildBattleResultWin=CrossGuildBattleResultWin,ViewManager.ins().reg(CrossGuildBattleResultWin,LayerManager.UI_Popup);var CrossGuildBattleSignPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sTips="",e._sn_="KFshachengsignup",e}return __extends(e,t),e.prototype.skinComplete=function(){this.lights=[this.eLight1,this.eLight2,this.eLight3,this.eLight4,this.eLight5,this.eLight6],this.eLink.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eLink.text+"</u>"),this.eCheckGuild.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eCheckGuild.text+"</u>"),this.addTouchEvent(this,this.onClick),this.ins=CrossGuildBattleCT.ins()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.start(1e3,0,this.updateTime,this),this.observe(this.ins.postInfo,this.update),this.observe(this.ins.postSignUp,this.updateStatus),this.observe(this.ins.postStatus,this.updateStatus),this.observe(CrossGuildBattleRedPoint.ins().postRedPoint,this.updateRp),this.update(),this.updateStatus(),this.updateTime(),this.updateRp(),this.ins.sendLogGuildId()},e.prototype.removeDisplay=function(){Timer.stop(this.updateTime,this)},e.prototype.update=function(){this.updateBtn()},e.prototype.updateStatus=function(){for(var t=this.lights.length,e=this.ins.getStatus(),i=0;t>i;i++)if(this.lights[i].visible=e-1>=i,this.ins.startingPoint>0){var s=new Date(this.ins.startingPoint+1e3*GlobalConfig.CrossGuildBattleTime[0==i?i+1:2*i+1].startTime);this["sLab"+(i+1)]=s.getMonth()+1+"月"+s.getDate()+"日\n周"+DateUtils.WEEK_CN[s.getDay()]}else this["sLab"+(i+1)]="";e>1?this.eLine.scaleX=Math.min(e,t)-1:this.eLine.scaleX=0},e.prototype.updateTime=function(){var t=this.ins.stageFullType,e=(this.ins.stageOverTime-GameServer.serverTime)/1e3;if(0>e&&(e=0),t==Battle_FullStatus.Sign)this.sTime=TextFlowMaker.generateTextFlow("报名剩余时间：|C:"+(ColorUtil.RED+"")+"&T:"+DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_1)+"|");else{var i=this.ins.checkType();0==i?this.sTime=[]:this.sTime=TextFlowMaker.generateTextFlow((1==this.ins.checkType()?"开始倒计时":"结束倒计时")+"：|C:"+(ColorUtil.RED+"")+"&T:"+DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_1)+"|")}},e.prototype.updateBtn=function(){this.sTips="",this.eBtn.visible=!0,this.ins.stageFullType==Battle_FullStatus.Sign?(this.eBtn.label="报名参赛",this.eBtn.visible=!this.ins.hasSign,this.sTips=this.ins.hasSign?"公会已报名参赛":""):this.eBtn.label="进入战场"},e.prototype.onClick=function(t){switch(t.target){case this.eLink:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[53].text);break;case this.eCheckGuild:ViewManager.ins().open(CrossGuildRankWin);break;case this.eBtn:this.eBtnClick()}},e.prototype.eBtnClick=function(){this.ins.stageFullType==Battle_FullStatus.Sign?Guild.ins().myOffice!=GuildOffice.GUILD_BANGZHU?TipsCT.ins().showTips("|C:"+(ColorUtil.RED+"")+"&T:公会会长才能进行报名|"):Guild.ins().guildLv<3?TipsCT.ins().showTips("|C:"+(ColorUtil.RED+"")+"&T:公会3级可报名|"):this.ins.hasSign?TipsCT.ins().showTips("|C:"+(ColorUtil.RED+"")+"&T:请勿重复报名|"):this.ins.sendSignUp():this.ins.checkMyGuild()?2!=this.ins.checkType()?TipsCT.ins().showTips("|C:"+(ColorUtil.RED+"")+"&T:战斗还未开启|"):this.ins.sendEnter():TipsCT.ins().showTips("|C:"+(ColorUtil.RED+"")+"&T:本公会未参赛|")},e.prototype.updateRp=function(){this.eRp.visible=CrossGuildBattleRedPoint.ins().redPoint},e}(BaseEuiView);__reflect(CrossGuildBattleSignPanel.prototype,"CrossGuildBattleSignPanel"),window.CrossGuildBattleSignPanel=CrossGuildBattleSignPanel;var CrossGuildBattleWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFshachengSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.sSelect=1==CrossGuildBattleCT.ins().checkType()?"1":"0",this.observe(CrossGuildBattleRedPoint.ins().postRedPoint,this.updateRp),this.observe(CrossGuildBattleCT.ins().postStatus,this.updateStatus),this.addChangingEvent(this.tab,this.checkIsOpen),this.updateStatus(),this.updateRp()},e.prototype.checkIsOpen=function(t){var e=t.target;return 1==e.selectedIndex&&CrossGuildBattleCT.ins().stageFullType<=Battle_FullStatus.Sign?(TipsCT.ins().showTips("暂无对阵信息"),void t.preventDefault()):void 0},e.prototype.updateRp=function(){this.redPoint0.visible=CrossGuildBattleRedPoint.ins().redPoint},e.prototype.updateStatus=function(){CrossGuildBattleCT.ins().statusChange&&CrossGuildBattleCT.ins().sendInfo()},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return CrossGuildBattleCT.ins().checkOpen(!0)},e}(BaseEuiView);__reflect(CrossGuildBattleWin.prototype,"CrossGuildBattleWin"),window.CrossGuildBattleWin=CrossGuildBattleWin,ViewManager.ins().reg(CrossGuildBattleWin,LayerManager.UI_Main);var CrossGuildRankWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="KFshahchengGuildRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossGuildBattleCT.ins().postGuildRank,this.update),CrossGuildBattleCT.ins().sendGuildRank()},e.prototype.update=function(){this.eListDP.source=CrossGuildBattleCT.ins().guildRankInfos,this.eTip.visible=!(this.eListDP.source.length>0)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(CrossGuildRankWin.prototype,"CrossGuildRankWin"),window.CrossGuildRankWin=CrossGuildRankWin,ViewManager.ins().reg(CrossGuildRankWin,LayerManager.UI_Popup);var CrossGuildWarMemWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossGuildBattleCT.ins().postPersonalRank,this.refushList),CrossGuildBattleCT.ins().sendPersonalRank()},e.prototype.refushList=function(){this.eListDP.replaceAll(CrossGuildBattleCT.ins().myGuildMember)},e}(GuildWarMemWin);__reflect(CrossGuildWarMemWin.prototype,"CrossGuildWarMemWin"),window.CrossGuildWarMemWin=CrossGuildWarMemWin,ViewManager.ins().reg(CrossGuildWarMemWin,LayerManager.UI_Popup);var CrossGuildWarUiWin=function(t){function e(){var e=t.call(this)||this;return e.currAttackHandle=0,e.curMapLv=1,e._sn_="KFshachengUiSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=CrossGuildBattleCT.ins(),this.clickEffc=new MovieClip,this.eListDP=new eui.ArrayCollection,this.eListDP2=new eui.ArrayCollection,this.addTouchEvent(this,this.onClick),this.belongGroup.visible=!1,this.attackBoss0.touchChildren=!1,this.attackBoss0.touchEnabled=!0,this.attackPlayer0.touchChildren=!1,this.attackPlayer0.touchEnabled=!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.start(1e3,0,this.updateTime,this),this.observe(GameLogic.ins().postEnterMap,this.onEnterMap),this.observe(this.ins.postBattleGuildInfo,this.updateGuildInfo),this.observe(this.ins.postGuildInfo,this.updateGuildInfo),this.observe(this.ins.postFlagInfo,this.updateFlagInfo),this.observe(this.ins.postKillHuman,this.showSkill),this.observe(this.ins.postGongXun,this.updateGongXun),this.observe(this.ins.postHudunInfo,this.hudunChange),this.observe(this.ins.postBossInfo,this.updateBelong),this.observe(GuildWar.ins().postWeixieChange,this.updateWeixieList),this.observe(GuildWar.ins().postCanplayChange,this.updateCanAttackList),this.observe(GameLogic.ins().postChangeTarget,this.updateUI),this.addTouchEvent(this.list1,this.listTap),this.addTouchEvent(this.list2,this.listTap),this.updateTime(),this.update()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateTime,this)},e.prototype.update=function(){this.onEnterMap(),this.updateGuildInfo(),this.updateFlagInfo()},e.prototype.updateBelong=function(){this.attackBtnGroup.visible=3==this.curMapLv&&this.ins.bossInfo&&!this.ins.bossInfo.isDie,this.updateTarget()},e.prototype.showSkill=function(t){if(!t)return egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup),void(this.skillGroup.visible=!1);this.skillGroup.visible&&(egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup)),this.skillGroup.visible=!0,this.skillGroup.alpha=1,this.lzlabel.scaleX=this.lzlabel.scaleY=1,this.lzlabel.text=t+"";var e=this;egret.Tween.get(this.lzlabel).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(e.skillGroup).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(e.lzlabel),egret.Tween.removeTweens(e.skillGroup),e.skillGroup.visible=!1})})},e.prototype.updateUI=function(){this.updateCanAttackList(),this.updateWeixieList(),this.updateTarget()},e.prototype.updateTarget=function(){this.setBtnState();var t=this.ins.getCurMapLevelCfg();1==t.id?this.belongGroup.visible=!1:this.belongGroup.visible=!0;var e=this.ins.bossInfo?this.ins.bossInfo.belongHandle:0;if(0==GameLogic.ins().currAttackHandle&&0==e&&(this.belongGroup.visible=!1),(0!=GameLogic.ins().currAttackHandle||0!=e)&&this.currAttackHandle!=GameLogic.ins().currAttackHandle||e!=GameLogic.ins().currAttackHandle){this.currAttackHandle=e||GameLogic.ins().currAttackHandle;var i=void 0,s=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(s&&s.length>0){i=s[0].infoModel;var n=i.name,o=n.split("\n");n=o[1]?o[1]:o[0],this.belongNameTxt0.textFlow=TextFlowMaker.generateTextFlow(n),this.roleHead0.source="yuanhead"+i.job+i.sex,this.changeHp()}else this.belongGroup.visible=!1}this.belongGroup.visible&&this.changeHp()},e.prototype.changeHp=function(){var t=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(t&&t.length>0){for(var e=t.length,i=0,s=0,n=0,o=0,a=0;e>a;a++){var r=t[a];if(r){var l=r.infoModel.getAtt(AttributeType.atHp)||0,h=r.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=l,s+=h;var p=r.infoModel.getAtt(AttributeType.cruNeiGong)||0,u=r.infoModel.getAtt(AttributeType.maxNeiGong)||0;n+=p,o+=u}}this.neigongBar1.maximum=o,this.neigongBar1.value=n,this.bloodBar1.maximum=s,this.bloodBar1.value=i,0>=i&&(this.belongGroup.visible=!1)}},e.prototype.updateWeixieList=function(t){void 0===t&&(t=0),this.eListDP2.replaceAll(this.ins.weixieList.concat()),this.list2.dataProvider=new eui.ArrayCollection(this.ins.weixieList),1==t&&this.updateCanAttackList(),this.weixie.visible=this.curMapLv>=2&&this.ins.weixieList.length>0},e.prototype.updateCanAttackList=function(t){t=t||this.ins.canAttackList,this.eListDP.replaceAll(t.concat()),this.attList.visible=this.curMapLv>=2&&(t.length>0||this.mon.visible)},e.prototype.listTap=function(t){if(t.target.parent instanceof GuildWarMemberHeadRender){var e=t.target.parent;
if(e.showEffect(),!this.ins.canClick)return;if(this.ins.flagAcId==Actor.actorID)return void WarnWin.show("采集中攻击玩家会导致采集<font color='#FFB82A'>进度归0</font>，确定要攻击玩家嘛？",function(){GameLogic.ins().postChangeAttrPoint(e.data),EntityShowMgr.ins().showHideSomeOne(e.data)},this);GameLogic.ins().postChangeAttrPoint(e.data),this.ins.attHandle!=e.data&&EntityShowMgr.ins().showHideSomeOne(e.data)}},e.prototype.updateFlagInfo=function(){this.hudun1.visible=!1,0==this.ins.flagStatu?this.clearTimeBar():1==this.ins.flagStatu?(this.clearTimeBar(),this.sFlagTime="当前皇旗可采集"):(this.bloodBar.maximum=GlobalConfig.CrossGuildBattleBase.gatherTime,this.hudun1.visible=!0),this.flag.visible=this.ins.flagStatu<3&&4==this.ins.getCurMapLevel(),this.flagStatu.visible=2==this.ins.flagStatu&&4!=this.curMapLv,this.updateBtn()},e.prototype.hudunChange=function(t){this.hudun.maximum=t[1],this.hudun.value=t[0],this.hudun.labelFunction=function(){return Math.ceil(100*t[0]/t[1])+"%"}},e.prototype.clearTimeBar=function(){this.bloodBar.maximum=0,this.bloodBar.value=0,this.bloodBar.labelFunction=function(){return""}},e.prototype.updateFlagTime=function(){var t=this.ins.endTime;if(t>=0)if(0==this.ins.flagStatu)this.sFlagTime=Math.floor(t/60)+"分"+t%60+"秒后可采集";else if(1==this.ins.flagStatu)this.sFlagTime="可采集";else if(this.sFlagTime=this.ins.flagName+" 采集中.....",this.bloodBar.value=t,this.bloodBar.labelFunction=function(){return"采集成功剩余时间："+Math.floor(CrossGuildBattleCT.ins().endTime/60)+"分"+CrossGuildBattleCT.ins().endTime%60+"秒"},this.flagStatu.visible){var e=this.ins.endTime,i="<font color = '#FFB82A'>"+this.ins.flagName+"</font>采集皇旗中（<font color = '#35e62d'>"+Math.floor(e/60)+"分"+e%60+"</font>秒）";this.flagTime.textFlow=(new egret.HtmlTextParser).parser(i),this.guildName1.text="公会："+this.ins.flagGuild}},e.prototype.updateGongXun=function(){var t=GlobalConfig.CrossGuildBattleLevel[this.curMapLv+1];this.gongxun.visible=t?this.ins.gongXun<t.feats:!1,t&&t.feats>0&&(this.sGongXun=TextFlowMaker.generateTextFlow("沙城战功：|C:"+(this.ins.gongXun<t.feats?ColorUtil.RED:ColorUtil.GREEN)+"&T:"+Math.min(this.ins.gongXun,t.feats)+"/"+t.feats+"|")),this.updateBtn()},e.prototype.updateBtn=function(){switch(this.eBtnGroup.visible=!this.gongxun.visible,this.eBtnGroup.addChild(this.eBtnR),this.eBtnL.enabled=!0,this.curMapLv){case 1:this.eBtnL.icon="chengneip1",this.eBtnL.id=2,this.eBtnGroup.removeChild(this.eBtnR);break;case 2:this.eBtnL.icon="dianqianp1",this.eBtnL.id=3,this.eBtnGroup.removeChild(this.eBtnR);break;case 3:this.eBtnL.icon="chengneip1",this.eBtnL.id=2,this.eBtnR.icon="huanggongp1",this.eBtnR.id=4;break;case 4:this.eBtnL.icon="hhzcaiqi1",this.eBtnL.id=0,this.eBtnL.enabled=1==this.ins.flagStatu,this.eBtnR.icon="dianqianp1",this.eBtnR.id=3}},e.prototype.onEnterMap=function(){this.curMapLv=this.ins.getCurMapLevelCfg().id,this.mon.visible=2==this.ins.getCurMapLevel(),this.bar1.y=this.mon.visible?99:30,this.updateBelong(),this.updateGongXun(),this.updateCanAttackList(),this.updateWeixieList(),this.updateFlagInfo()},e.prototype.updateGuildInfo=function(){this.sGuildNameL=this.ins.guildInfos[this.ins.guildLId]?this.ins.guildInfos[this.ins.guildLId].guildName:"",this.sScoreL=this.ins.guildLScore+"",this.sGuildNameR=this.ins.guildInfos[this.ins.guildRId]?this.ins.guildInfos[this.ins.guildRId].guildName:"",this.sScoreR=this.ins.guildRScore+"",this.eRankBtnL.visible=Guild.ins().guildID==this.ins.guildLId,this.eRankBtnR.visible=Guild.ins().guildID==this.ins.guildRId},e.prototype.updateTime=function(){var t=(this.ins.overTime-GameServer.serverTime)/1e3;0>t&&(t=0),this.sTimeLab=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1),this.updateFlagTime()},e.prototype.onClick=function(t){switch(t.target){case this.eRankBtnL:case this.eRankBtnR:ViewManager.ins().open(CrossGuildWarMemWin);break;case this.eBtnL:case this.eBtnR:this.btnOnClick(t.target.id);break;case this.mon:this.clickEffc.playFile(RES_DIR_EFF+"PromptEff5",1),this.mon.addChild(this.clickEffc),this.clickEffc.x=this.mon.width/2,this.clickEffc.y=35,GameLogic.ins().postChangeAttrPoint(0);break;case this.attackBoss0:this.attBoss();break;case this.attguishu:case this.attackPlayer0:this.attPlayer()}},e.prototype.attBoss=function(){this.ins.bossInfo&&!this.ins.bossInfo.isDie&&0!=BossCT.ins().bossHandler&&(GameLogic.ins().postChangeAttrPoint(BossCT.ins().bossHandler),this.attackBoss0.currentState="attbossing",this.attackPlayer0.currentState="attgsup")},e.prototype.attPlayer=function(){return this.ins.canClick?this.ins.bossInfo&&0!=this.ins.bossInfo.belongHandle?void(this.ins.bossInfo.belongGuild!=Guild.ins().guildID&&this.ins.bossInfo.belongHandle!=GameLogic.ins().currAttackHandle&&(GameLogic.ins().postChangeAttrPoint(this.ins.bossInfo.belongHandle),this.setBtnState())):void TipsCT.ins().showTips("|C:0xFFFF00&T:该BOSS无归属者,快去抢夺!|"):void 0},e.prototype.setBtnState=function(){var t=this.ins.bossInfo;this.sameHanghui.visible=!1,t&&t.belongGuild==Guild.ins().guildID?(this.attguishu.visible=!1,this.attackPlayer0.currentState="attgsdis3",this.sameHanghui.visible=!0):(this.attguishu.visible=3==this.ins.getCurMapLevel()&&t&&t.belongHandle>0&&t.belongHandle!=GameLogic.ins().currAttackHandle,GameLogic.ins().currAttackHandle&&t&&t.belongHandle>0&&GameLogic.ins().currAttackHandle==t.belongHandle?this.attackPlayer0.currentState="attgsing":this.attackPlayer0.currentState="attgsup"),GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==BossCT.ins().bossHandler?this.attackBoss0.currentState="attbossing":this.attackBoss0.currentState="attbossup"},e.prototype.btnOnClick=function(t){if(t>=0)if(0==t)0!=this.ins.flagStatu?this.ins.sendCollectFlag():TipsCT.ins().showTips("|C:0xf3311e&T:皇旗当前不可采集|");else{var e=GlobalConfig.CrossGuildBattleLevel[t];if(""!=this.ins.killName)return void TipsCT.ins().showTips("|C:0xf3311e&T:复活状态，不能切换地图|");if(this.ins.gongXun<e.feats)return void TipsCT.ins().showTips("|C:0xf3311e&T:战功不满足条件，不能进入下一层|");if(!this.ins.doorDie)return void TipsCT.ins().showTips("|C:0xf3311e&T:击破城门后可进入下一关|");ViewManager.ins().open(CrossGuileWarReliveWin,1,t)}},e}(BaseEuiView);__reflect(CrossGuildWarUiWin.prototype,"CrossGuildWarUiWin"),window.CrossGuildWarUiWin=CrossGuildWarUiWin,ViewManager.ins().reg(CrossGuildWarUiWin,LayerManager.UI_Main);var CrossGuileWarReliveWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SwitchCDSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.ins=CrossGuildBattleCT.ins()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.sceneIndex=t[1];var i=this.ins.getCurMapLevelCfg();switch(this.type){case 1:this.currentState="switch",this.defaultStr="秒后自动切换区域",this.s=i?i.switchSceneCd:0;break;case 2:this.currentState="revive",this.defaultStr="秒后在沙城城门复活",this.s=t[1];break;case 3:this.currentState="exit",this.defaultStr="秒后自动退出活动",this.s=i?i.switchSceneCd:0}this.timeDown.text=""+this.s+this.defaultStr,Timer.stop(this.updateCloseBtnLabel,this),Timer.start(1e3,this.s,this.updateCloseBtnLabel,this),this.refushMapInfo()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),1!=this.type&&(this.ins.killName="")},e.prototype.refushMapInfo=function(){1==this.type?this.mapName.text=GlobalConfig.CrossGuildBattleLevel[this.sceneIndex].name:2==this.type&&(this.killName.text="你被 "+this.ins.killName+" 击败！",this.guildName.text="所属公会："+this.ins.killGuild+" ")},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&(1==this.type&&this.ins.sendEnterChapter(this.sceneIndex),3==this.type&&FbCT.ins().sendExitFb(),ViewManager.ins().close(this)),this.timeDown.text=""+this.s+this.defaultStr},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(CrossGuileWarReliveWin.prototype,"CrossGuileWarReliveWin"),window.CrossGuileWarReliveWin=CrossGuileWarReliveWin,ViewManager.ins().reg(CrossGuileWarReliveWin,LayerManager.UI_Popup);var SelectMemberPanelWinEx=function(t){function e(){var e=t.call(this)||this;return e._sn_="SelectMemberPanelSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=CrossGuildBattleCT.ins(),this.list.itemRenderer=MemberItem3Renderer},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.maxNum=this.ins.guildRewards[this.ins.rewardGroupId][this.index].count,this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.ins.assignRewards[this.index]=[],this.selectList=[],this.selectMarkList=[],this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.selectList.length==this.maxNum,this.refushList()},e.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(this.ins.getMyGuildPointRank())},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ins.postChangeAssignMember()},e.prototype.countNum=function(){var t=0;if(this.selectList)for(var e in this.selectList)t+=this.selectList[e].num;return t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.sureBtn:this.ins.assignRewards[this.index]=this.selectList,ViewManager.ins().close(this);break;case this.list:var e=t.target.parent;if(e&&e.data){var i=this.selectMarkList.lastIndexOf(e.data.data.name);switch(t.target){case e.btn1:--e.chooseNum,e.chooseNum<1&&(e.chooseNum=1),this.selectList[i].num=e.chooseNum;break;case e.btn2:if(this.countNum()>=this.maxNum)return void TipsCT.ins().showTips("|C:0xf3311e&T:分配人数已满|");this.selectList[i].num=++e.chooseNum;break;default:if(i>=0)e.checkBoxs.selected=!1,e.data.isSelect=!1,e.chooseNum=1,this.selectMarkList.splice(i,1),this.selectList.splice(i,1);else{if(this.countNum()>=this.maxNum)return e.checkBoxs.selected=!1,void TipsCT.ins().showTips("|C:0xf3311e&T:分配人数已满|");e.checkBoxs.selected=!0,e.data.isSelect=!0,e.chooseNum=1,this.selectMarkList.push(e.data.data.name);var s={actorId:e.data.data.roleID,actorName:e.data.data.name,num:e.chooseNum};this.selectList.push(s)}}e.num1.text=e.chooseNum+"",this.setAddInfoShow(e,e.checkBoxs.selected),this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.countNum()==this.maxNum}}},e.prototype.setAddInfoShow=function(t,e){void 0===e&&(e=!1),t.btn1.visible=t.btn2.visible=t.num1.visible=t.inputBg.visible=e},e}(BaseEuiView);__reflect(SelectMemberPanelWinEx.prototype,"SelectMemberPanelWinEx"),window.SelectMemberPanelWinEx=SelectMemberPanelWinEx,ViewManager.ins().reg(SelectMemberPanelWinEx,LayerManager.UI_Popup);var SelectMemberRewardWinEx=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SelectMemberRewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=SelectRewardItemRendererEx,this.addTouchEvent(this,this.onClick),this.ins=CrossGuildBattleCT.ins()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ins.sendPersonalRank(),this.rankLabel.text=t[0]||"",this.observe(this.ins.postChangeAssignMember,this.updateList),this.update()},e.prototype.update=function(){this.updateList()},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(this.ins.guildRewards[this.ins.rewardGroupId])},e.prototype.onClick=function(t){var e=this;if(t.target instanceof eui.Button&&t.target.parent instanceof SelectRewardItemRendererEx)return void ViewManager.ins().open(SelectMemberPanelWinEx,t.target.parent.itemIndex);switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.sendReward:Timer.start(100,1,function(){CrossGuildBattleCT.ins().checkISSendAll()&&CrossGuildBattleCT.ins().sendAssignInfo(e.ins.rewardGroupId)},this)}},e}(BaseEuiView);__reflect(SelectMemberRewardWinEx.prototype,"SelectMemberRewardWinEx"),window.SelectMemberRewardWinEx=SelectMemberRewardWinEx,ViewManager.ins().reg(SelectMemberRewardWinEx,LayerManager.UI_Popup);var SelectRewardItemRendererEx=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="SelectRewardItemSkin",e.list.itemRenderer=GuildWarMemberHeadRender,e.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=CrossGuildBattleCT.ins(),e=this.itemIndex,i=this.data;this.goods.data=i,0==i.type?this.boxname.text=RewardData.getCurrencyName(i.id):this.boxname.text=GlobalConfig.ItemConfig[i.id].name,this.sendNum=t.guildRewards[t.rewardGroupId][e].count;var s=t.assignRewards[e],n=0,o=[];for(var a in s){n+=s[a].num;var r=new SelectInfoData;r.data=Guild.ins().getMemberByRoleId(s[a].actorId),r.num=s[a].num,o.push(r)}this.chooseNum.text=n+"/"+this.sendNum,this.list.dataProvider=new eui.ArrayCollection(o)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.rightBtn:var e=this.list.layout.gap,i=this.list.getChildAt(0);if(!i)return;var s=i.width+e,n=Math.ceil(this.list.width/s);if(this.index=Math.ceil(this.list.scrollH/s),this.index+n>=this.list.numElements)return;this.index++,egret.Tween.removeTweens(this.list);var o=egret.Tween.get(this.list);o.to({scrollH:s*this.index},100);break;case this.leftBtn:if(e=this.list.layout.gap,i=this.list.getChildAt(0),!i)return;if(s=i.width+e,n=Math.ceil(this.list.width/s),this.index=Math.ceil(this.list.scrollH/s),this.index<=0)return;this.index--,egret.Tween.removeTweens(this.list),o=egret.Tween.get(this.list),o.to({scrollH:s*this.index},100)}},e}(BaseItemRender);__reflect(SelectRewardItemRendererEx.prototype,"SelectRewardItemRendererEx"),window.SelectRewardItemRendererEx=SelectRewardItemRendererEx;var DevilBossPanel=function(t){function e(){var e=t.call(this)||this;e.skinName="KFMzInvasionSkin",e.addTouchEvent(e,e.onClick),e.bossBody=new MovieClip,e.bossBody.x=e.bossBody.y=0,e.bossGroup.addChild(e.bossBody);var i,s=GlobalConfig.DevilBossConfig;for(var n in s)s[n].isBoss&&(i=parseInt(n),DevildomSys.ins().bossId=i);var o=DevildomBossModel.ins().getCurBossIdByIndex(i);return e.bossDp=GlobalConfig.MonstersConfig[o],e.award.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.award.text+"</u>"),e.eList.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.tablets)),e.challengeBtn.enabled=!DevildomSys.ins().bossState,e.bossX=e.bossGroup.verticalCenter,e.bossY=e.bossGroup.horizontalCenter,e}return __extends(e,t),e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.observe(BagCT.ins().postItemAdd,this.update),this.observe(DevildomSys.ins().postBossInfo,this.update),this.update(),egret.Tween.removeTweens(this.bossGroup);var s=this.bossDp.avatar+"_3r";this.bossBody.playFile(RES_DIR_MONSTER+s,-1);var n=egret.Tween.get(this.bossGroup);n.to({verticalCenter:-220,horizontalCenter:-220,scaleX:.3,scaleY:.3},0).to({verticalCenter:this.bossX,horizontalCenter:this.bossY,scaleX:1,scaleY:1},2e3).call(function(){var e=t.bossDp.avatar+"_3a";t.bossBody.playFile(RES_DIR_MONSTER+e,1,function(){var e=t.bossDp.avatar+"_3s";t.bossBody.playFile(RES_DIR_MONSTER+e,-1,null,!1)},!1)})},e.prototype.update=function(){var t=DevildomSys.ins();this.challengeBtn.enabled=!t.bossState,this.guildName.text=""+t.guildName,this.killer.text=""+t.killer,this.killer.visible=!!t.killer,this.guildName.visible=!!t.guildName&&!!t.killer,t.guildName||t.killer||(this.guildName.text="虚位以待",this.guildName.visible=!0);var e=t.bossState?"|C:0xffd93f&T:未达到开放条件|":t.killedState[t.bossId]?"|C:0xf3311e&T:魔主已被击杀|":"";this.desc.textFlow=TextFlowMaker.generateTextFlow1(""+e)},e.prototype.onClick=function(t){switch(t.target){case this.award:ViewManager.ins().open(DevilTabletWin);break;case this.challengeBtn:if(!KfArenaSys.ins().checkIsMatching())return;var e=DevildomSys.ins();e.bossState||e.killedState[e.bossId]?TipsCT.ins().showTips("魔主已被击杀"):DevildomSys.ins().sendEnter(e.bossId)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(DevilBossPanel.prototype,"DevilBossPanel"),window.DevilBossPanel=DevilBossPanel;var DevilInvadeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="DevildomSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return DevildomSys.ins().isOpen(!0)},e.prototype.skinComplete=function(){this.roleSelect.hideRole(),this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(DevildomRedPoint.ins().postRedPoint,this.updateRed),this.updateRed(),t[0]?(this.lastSelect=t[0],this.selectedIndex(this.lastSelect)):this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,0==this.lastSelect?this.viewStack.getElementAt(this.lastSelect).open(DevildomBossModel.ins().getCurFbIndex()):this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[38].text)}},e.prototype.setSelectedIndex=function(t){this.selectedIndex(this.viewStack.selectedIndex),this.updateRed()},e.prototype.selectedIndex=function(t){void 0!=this.lastSelect&&this.viewStack.getElementAt(this.lastSelect).close&&this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=t,this.viewStack.getElementAt(this.lastSelect).open&&(0==this.lastSelect?this.viewStack.getElementAt(this.lastSelect).open(DevildomBossModel.ins().getCurFbIndex()):this.viewStack.getElementAt(this.lastSelect).open())},e.prototype.updateRed=function(){this.redPoint0.visible=1==DevildomRedPoint.ins().redPoint&&Actor.level>=GlobalConfig.DevilBossBase.openLevel&&DevildomSys.ins().isOpen(),this.redPoint1.visible=DevildomRedPoint.ins().bossRedPoint},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(DevilInvadeWin.prototype,"DevilInvadeWin"),window.DevilInvadeWin=DevilInvadeWin,ViewManager.ins().reg(DevilInvadeWin,LayerManager.UI_Main);var DevilTabletWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFMzInvasionJiangLiTishiSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.tabletsDetail.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.tabletsDetail)),this.tabletsBelong.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.tabletsBelong)),this.tabletsAwards.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.tabletsAwards))},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DevilTabletWin.prototype,"DevilTabletWin"),window.DevilTabletWin=DevilTabletWin,ViewManager.ins().reg(DevilTabletWin,LayerManager.UI_Popup);var EightRefuseCT=function(t){function e(){var e=t.call(this)||this;return e.roleErDatas=[],e.sysId=PackageID.Equip,e.regNetMsg(36,e.postInit),e.regNetMsg(37,e.postActive),e.regNetMsg(38,e.postUpPos),e.regNetMsg(39,e.postUseDan),e.regNetMsg(41,e.postUpStage),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.roleErDatas=[];for(var e=t.readByte(),i=0;e>i;i++){for(var s={roleId:i,power:t.readInt(),stage:t.readShort(),star:t.readUnsignedByte(),dans:[t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte()],erDatas:[]},n=0;8>n;n++){var o={pos:t.readByte(),act:t.readBoolean(),level:t.readShort()};s.erDatas.push(o)}this.roleErDatas.push(s)}},e.prototype.postActive=function(t){var e=t.readByte(),i=t.readByte(),s=this.getErDataByRoleByPos(e,i);s&&(s.act=!0,s.level=1);var n=t.readInt(),o=this.getRoleDataByRole(e);o&&(o.power=n)},e.prototype.postUpPos=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=t.readUnsignedByte(),n=this.getErDataByRoleByPos(e,i);n&&(n.level=s);var o=t.readInt(),a=this.getRoleDataByRole(e);a&&(a.power=o)},e.prototype.postUseDan=function(t){var e=t.readByte(),i=t.readInt(),s=this.getRoleDataByRole(e);s&&(s.power=i,s.dans=[t.readUnsignedByte(),t.readUnsignedByte(),t.readUnsignedByte()])},e.prototype.postUpStage=function(t){var e=t.readUnsignedByte(),i=t.readByte(),s=t.readUnsignedByte(),n=t.readInt(),o=this.getRoleDataByRole(e);o&&(o.stage=i,o.star=s,o.power=n)},e.prototype.sendActive=function(t,e){var i=this.getBytes(37);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUpPos=function(t,e){var i=this.getBytes(38);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUseDan=function(t,e,i){void 0===i&&(i=1);var s=this.getBytes(39);s.writeByte(t),s.writeByte(e+1),s.writeShort(i),this.sendToServer(s)},e.prototype.sendUpStage=function(t){var e=this.getBytes(41);e.writeByte(t),this.sendToServer(e)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.EightGateBaseConfig,i="";return GameServer.serverOpenDay+1<e.openserverday?i="第"+e.openserverday+"天开启":ZsCT.ins().lv<e.openzhuanshenglv&&(i=e.openzhuanshenglv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getRoleDataByRole=function(t){return this.roleErDatas[t]},e.prototype.getErDataByRoleByPos=function(t,e){return this.roleErDatas[t]?this.roleErDatas[t].erDatas[e-1]:null},e.prototype.getUseDanMax=function(t,e){var i=this.getRoleDataByRole(t),s=GlobalConfig.EightGateBodyConfig[i.stage][i.star];return s.countconstrain[e]},e.prototype.canUseDan=function(t,i){var s=ExpansionCardCT.ins().useDanData,n=s&&s[i+7]?s[i+7].addNum:0,o=e.ins().getUseDanMax(t,i)+n,a=this.getRoleDataByRole(t);if(a.dans[i]<o){var r=BagCT.ins().getBagGoodsCountById(0,e.getDanItemId(i));return r>0}return!1},e.getDanItemId=function(t){return GlobalConfig.EightGateElixirConfig[t+1].id},e.getNameByPos=function(t){return GlobalConfig.EightGateBaseConfig.name[t-1]+"门"},e.prototype.canActEight=function(t,e){var i=this.getRoleDataByRole(t),s=GlobalConfig.EightGateActivateConfig[e].duantilv;if(i.stage<s)return!1;var n=GlobalConfig.EightGateActivateConfig[e].consumeList[0],o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.id);return o>=n.count},e.prototype.canUpEight=function(t,e){var i=this.getErDataByRoleByPos(t,e),s=GlobalConfig.EightGateSlotUpgradeConfig[e][i.level+1];if(!s)return!1;for(var n in s.comsumeItem){var o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.comsumeItem[n].id);if(o<s.comsumeItem[n].count)return!1}return!0},e.getSkillLvByNum=function(t,e){for(var i=0,s=0;t>s;s++){if(!e[s]||0==e[s].level)return 0;i=0==i?e[s].level:Math.min(i,e[s].level)}return i},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postActive",null),__decorate([post()],e.prototype,"postUpPos",null),__decorate([post()],e.prototype,"postUseDan",null),__decorate([post()],e.prototype,"postUpStage",null),e}(BaseSystem);__reflect(EightRefuseCT.prototype,"EightRefuseCT");var DanType;!function(t){t[t.One=0]="One",t[t.Two=1]="Two",t[t.Three=2]="Three"}(DanType||(DanType={})),System.EightRefuseCT=function(){return EightRefuseCT.ins()},window.EightRefuseCT=EightRefuseCT;var EightRefuseRedPoint=function(t){function e(){var e=t.call(this)||this;return e.rolePoints=[],e.danPoints=[],e.upPoints=[],e.eightPoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,EightRefuseCT.ins().postInit,EightRefuseCT.ins().postActive,EightRefuseCT.ins().postUpPos,EightRefuseCT.ins().postUseDan,EightRefuseCT.ins().postUpStage,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.rolePoints.length;e++)this.rolePoints[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.postDanPoints(t),s=this.postUpPoint(t),n=this.postEightPoint(t);this.rolePoints[t]=i||s||n}else this.rolePoints[t]=!1}return!0},e.prototype.postEightPoint=function(t){this.eightPoints[t]=[];var e=!1,i=EightRefuseCT.ins().getRoleDataByRole(t);if(!EightRefuseCT.ins().checkOpen()||!i)return e;for(var s in i.erDatas){var n=i.erDatas[s];if(n.act){var o=EightRefuseCT.ins().canUpEight(t,n.pos);o&&(e=o),this.eightPoints[t][n.pos-1]=o}else{var o=EightRefuseCT.ins().canActEight(t,n.pos);o&&(e=o),this.eightPoints[t][n.pos-1]=o}}return e},e.prototype.postUpPoint=function(t){this.upPoints[t]=!1;var e=!1,i=EightRefuseCT.ins().getRoleDataByRole(t);if(!EightRefuseCT.ins().checkOpen()||!i)return e;for(var s=i.stage,n=i.star,o={},a=1;5>=a;a++){n++;var r=GlobalConfig.EightGateBodyConfig[s][n];if(r){if(r.gradeconsume){var l=r.gradeconsume[0].id;o[l]||(o[l]=0),o[l]+=r.gradeconsume[0].count}}else if(s++,n=0,!GlobalConfig.EightGateBodyConfig[s])return e}for(var a in o){var h=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,+a);if(h<o[a])return e}return this.upPoints[t]=e=!0,e},e.prototype.postDanPoints=function(t){var e=!1;this.danPoints[t]=[];var i=EightRefuseCT.ins().getRoleDataByRole(t);if(!EightRefuseCT.ins().checkOpen()||!i)return e;for(var s=0;s<i.dans.length;s++)this.danPoints[t][s]=EightRefuseCT.ins().canUseDan(t,s),this.danPoints[t][s]&&(e=!0);return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postEightPoint",null),__decorate([post()],e.prototype,"postUpPoint",null),__decorate([post()],e.prototype,"postDanPoints",null),e}(BaseSystem);__reflect(EightRefuseRedPoint.prototype,"EightRefuseRedPoint"),System.EightRefuseRedPoint=function(){return EightRefuseRedPoint.ins()},window.EightRefuseRedPoint=EightRefuseRedPoint;var EightRefuseItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="EightRefuseItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.iconMc=new MovieClip,this.iconEff.addChild(this.iconMc),this.tipsMc=new MovieClip,this.tipsMc.playFile(RES_DIR_EFF+"BtnPrompt9",-1),this.tipsEff.addChild(this.tipsMc),this.updateRed(!1),this.touchEnabled=!1,this.touchChildren=!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(t){if(void 0===t&&(t=null),t&&(this.erData=t),this.skin&&this.erData){this.sIcon="eightRefuseItem_"+this.erData.pos+"_png",this.sLv=this.erData.level+"";var e=GlobalConfig.EightGateActivateConfig[this.erData.pos].eff;e&&e.length>0&&this.erData.act?(this.iconMc.playFile(RES_DIR_EFF+e,-1),this.iconEff.visible=!0):this.iconEff.visible=!1}},e.prototype.updateRed=function(t){this.tipsEff&&(this.tipsEff.visible=t)},e}(BaseView);__reflect(EightRefuseItem.prototype,"EightRefuseItem"),window.EightRefuseItem=EightRefuseItem;var EightRefusePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curRoleId=0,e.items=[],e._sn_="EightRefuseSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.bgMc=new MovieClip,this.bgEff.addChild(this.bgMc),this.bgMc.playFile(RES_DIR_EFF+"bamenxm",-1),this.ins=EightRefuseCT.ins(),this.getItemTxt1.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt1.text+"</u>"),this.addTouchEvent(this,this.onClick),this.starList=new StarList(10),this.starList.horizontalCenter=0,this.starGroup.addChild(this.starList),this.oldHorizontalCenter=this.nowAttr.horizontalCenter;for(var t=0;8>t;t++){var e=this["eItem"+t];e.pos=t,this.items.push(e)}this.up1.type=DanType.One,this.up2.type=DanType.Two,this.up3.type=DanType.Three,this.skill1.num=2,this.skill2.num=5,this.skill3.num=8},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postUseDan,this.updateDan),this.observe(this.ins.postUpStage,this.doLevelup),this.observe(this.ins.postUpPos,this.updateItems),this.observe(this.ins.postActive,this.updateItems),this.observe(EightRefuseRedPoint.ins().postRoleRedPoint,this.updateRed),this.update()},e.prototype.update=function(){this.skin&&this.ins.getRoleDataByRole(this.curRoleId)&&(this.updateStar(),this.updateView(),this.updateItems(),this.updateDan(),this.updateRed())},e.prototype.updatePower=function(){var t=this.ins.getRoleDataByRole(this.curRoleId);this.powerPanel.setPower(t.power)},e.prototype.updateDan=function(){var t=this.ins.getRoleDataByRole(this.curRoleId);this.eUse1=t.dans[DanType.One]+"",this.eUse2=t.dans[DanType.Two]+"",this.eUse3=t.dans[DanType.Three]+"",this.updatePower()},e.prototype.updateRed=function(){var t=EightRefuseRedPoint.ins();this.redPoint1.visible=t.danPoints[this.curRoleId][DanType.One],this.redPoint2.visible=t.danPoints[this.curRoleId][DanType.Two],this.redPoint3.visible=t.danPoints[this.curRoleId][DanType.Three],this.redPoint.visible=t.upPoints[this.curRoleId];for(var e=0;e<this.items.length;e++)this.items[e].updateRed(t.eightPoints[this.curRoleId][e])},e.prototype.onClick=function(t){if(t.target.parent instanceof EightRefuseItem)return void ViewManager.ins().open(EightRefuseTipsWin,this.curRoleId,t.target.parent.erData);switch(t.target){case this.skill1:case this.skill2:case this.skill3:ViewManager.ins().open(EightRefuseSkillWin,this.curRoleId,t.target.num);break;case this.getItemTxt1:WarnCT.ins().setBuyGoodsWarn(this.nextBodyCfg.gradeconsume[0].id,1);break;case this.up1:case this.up2:case this.up3:var e=t.target.type;e>=0&&this.ins.canUseDan(this.curRoleId,t.target.type)?this.ins.sendUseDan(this.curRoleId,e):ViewManager.ins().open(EightUpTipsWin,this.curRoleId,t.target.type);break;case this.boostBtn:if(this.nextBodyCfg.gradeconsume){var i=this.nextBodyCfg.gradeconsume[0].id,s=ItemUtil.isEquip(GlobalConfig.ItemConfig[i])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,n=BagCT.ins().getBagGoodsCountById(s,i),o=this.nextBodyCfg.gradeconsume[0].count;if(o>n)return void TipsCT.ins().showTips("材料不足")}EightRefuseCT.ins().sendUpStage(this.curRoleId)}},Object.defineProperty(e.prototype,"curRole",{set:function(t){this.curRoleId=t,this.update()},enumerable:!0,configurable:!0}),e.prototype.updateStar=function(){var t=this.ins.getRoleDataByRole(this.curRoleId),e=t.star>this.starList.starNum?1:0;this.starList.setStarNum(t.star,e)},e.prototype.updateItems=function(){for(var t=0;t<this.items.length;t++)this.items[t].update(this.ins.getErDataByRoleByPos(this.curRoleId,t+1));for(var e=this.ins.getRoleDataByRole(this.curRoleId),i=!0,s=0;8>s;s++)if(!e.erDatas[s].act){i=!1;break}this.bgMc.visible=i,this.updatePower()},e.prototype.updateView=function(){var t=this.ins.getRoleDataByRole(this.curRoleId),e=t.stage,i=t.star;if(this.nextBodyCfg=null,GlobalConfig.EightGateBodyConfig[e][i+1]){this.costGroup.visible=this.getItemTxt1.visible=!0,this.nextBodyCfg=GlobalConfig.EightGateBodyConfig[e][i+1],this.boostBtn.label="锻  体";var s=this.nextBodyCfg.gradeconsume[0].id;this.icon1.source=GlobalConfig.ItemConfig[s].icon+"_png";var n=ItemUtil.isEquip(GlobalConfig.ItemConfig[s])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,o=BagCT.ins().getBagGoodsCountById(n,s),a="";a=o>=this.nextBodyCfg.gradeconsume[0].count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+a+">"+o+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.nextBodyCfg.gradeconsume[0].count+"</font> ")}else{this.costGroup.visible=this.getItemTxt1.visible=!1;var r=GlobalConfig.EightGateBodyConfig[e+1];this.nextBodyCfg=r?r[0]:null,this.boostBtn.label="升  阶"}var l=!this.nextBodyCfg,h=GlobalConfig.EightGateBodyConfig[e][i];this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(h.attrs,0,1,"：")),this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(l?"":AttributeData.getAttStr(this.nextBodyCfg.attrs,0,1,"：")),this.nowAttr.horizontalCenter=l?0:this.oldHorizontalCenter,this.upInfo.visible=this.arrow.visible=!l,this.stageImg.setValue(e)
},e.prototype.doLevelup=function(){this.updateStar(),this.updateView(),this.updatePower()},e}(BaseView);__reflect(EightRefusePanel.prototype,"EightRefusePanel"),window.EightRefusePanel=EightRefusePanel;var EightRefuseSkillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="EightRefuseSkillSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.ins=EightRefuseCT.ins()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRoleId=t[0],this.num=t[1],this.update()},e.prototype.update=function(){var t=EightRefuseCT.ins().getRoleDataByRole(this.curRoleId),e=EightRefuseCT.getSkillLvByNum(this.num,t.erDatas),i=0,s=0;for(var n in GlobalConfig.EightGateSkillConfig)e>=+n?s=+n:0==i&&(i=+n);switch(e=s,this.sTitle=StringUtils.NumberToChinese(this.num)+"门血脉",this.num){case 2:this.eIcon.source="EightRefuseSkill_1_png";break;case 5:this.eIcon.source="EightRefuseSkill_2_png";break;case 8:this.eIcon.source="EightRefuseSkill_3_png"}var o=0==i;this.sQuality2=this.sDesc2="",this.sPos2=TextFlowMaker.generateTextFlow1("");var a;if(0==e)a=GlobalConfig.EightGateSkillConfig[i][this.num];else if(o)a=GlobalConfig.EightGateSkillConfig[e][this.num];else{a=GlobalConfig.EightGateSkillConfig[e][this.num];var r=GlobalConfig.EightGateSkillConfig[i][this.num];this.sQuality2=StringUtils.NumberToChinese(this.num)+"门血脉"+i+"级共鸣";for(var l="",n=1;n<=this.num;n++){var h=this.ins.getErDataByRoleByPos(this.curRoleId,n);l+="|C:"+(h.level>=i?ColorUtil.GREEN:8026746)+"&T:"+EightRefuseCT.getNameByPos(n)+"| "}this.sPos2=TextFlowMaker.generateTextFlow1(l),this.sDesc2=SkillUtil.getDesc(GlobalConfig.SkillsConfig[r.skill])}this.sQuality=StringUtils.NumberToChinese(this.num)+"门血脉"+a.stage+"级共鸣";for(var p="",n=1;n<=this.num;n++){var h=this.ins.getErDataByRoleByPos(this.curRoleId,n);p+="|C:"+(h.level>=a.stage?ColorUtil.GREEN:8026746)+"&T:"+EightRefuseCT.getNameByPos(n)+"| "}this.sPos=TextFlowMaker.generateTextFlow1(p),this.sDesc=SkillUtil.getDesc(GlobalConfig.SkillsConfig[a.skill])},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(EightRefuseSkillWin.prototype,"EightRefuseSkillWin"),window.EightRefuseSkillWin=EightRefuseSkillWin,ViewManager.ins().reg(EightRefuseSkillWin,LayerManager.UI_Popup);var EightRefuseTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="EightRefuseTips",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=EightRefuseCT.ins(),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRoleId=t[0],this.erData=t[1],this.pos=this.erData.pos;var i=EightRefuseCT.getNameByPos(this.erData.pos);this.erName.text=i,this.erName0.text="八门·"+i,this.observe(this.ins.postActive,this.update),this.observe(this.ins.postUpPos,this.update),this.observe(EightRefuseRedPoint.ins().postRoleRedPoint,this.updateRed),this.update()},e.prototype.update=function(){if(this.updateRed(),this.refuseItem.update(this.ins.getErDataByRoleByPos(this.curRoleId,this.pos)),this.erData.act){var t=GlobalConfig.EightGateActivateConfig[this.pos],e=GlobalConfig.EightGateSlotUpgradeConfig[this.pos][this.erData.level],i=GlobalConfig.EightGateSlotUpgradeConfig[this.pos][this.erData.level+1],s=!i;this.act.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00FF00&T:"+this.erData.level+"级"),this.curdesc.text="当前效果:",this.nextdesc.text="下级效果:";var n="";if((t.attrs&&t.attrs.length>0||e.strengthattr&&e.strengthattr.length>0)&&(n=AttributeData.getAttStr(AttributeData.AttrAddition(t.attrs,e.strengthattr))+"\n"),null!=t.fuwenexattr||null!=e.fuwenexattr){var o=AttributeData.AttrAddition(t.fuwenexattr,e.fuwenexattr);for(var a in o)n+=AttributeData.getExtAttStrByType(o[a],0)+"\n"}if(this.curatt.textFlow=TextFlowMaker.generateTextFlow1(n),s)this.next.visible=this.eBottom.visible=!1,this.max.visible=!0;else{this.next.visible=this.eBottom.visible=!0,this.max.visible=!1,this.upBtn.label="升  级";var r="";if((t.attrs&&t.attrs.length>0||i.strengthattr&&i.strengthattr.length>0)&&(r=AttributeData.getAttStr(AttributeData.AttrAddition(t.attrs,i.strengthattr))+"\n"),null!=t.fuwenexattr||null!=i.fuwenexattr){var o=AttributeData.AttrAddition(t.fuwenexattr,i.fuwenexattr);for(var a in i.fuwenexattr)r+=AttributeData.getExtAttStrByType(o[a],0)+"\n"}this.nextatt.textFlow=TextFlowMaker.generateTextFlow1(r);var l=i.comsumeItem[0],h=GlobalConfig.ItemConfig[l.id];this.itemIcon.setData(h);var p=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,l.id),u="";u=p>=l.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.upname.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+GlobalConfig.ItemConfig[l.id].name+"</font> "),this.use.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+p+"/"+l.count+"</font> ");var d=i.comsumeItem[1],c=GlobalConfig.ItemConfig[d.id];this.itemIcon1.setData(c);var f=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,d.id),g="";g=f>=d.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.upname1.textFlow=TextFlowMaker.generateTextFlow("<font color="+g+">"+GlobalConfig.ItemConfig[d.id].name+"</font> "),this.use1.textFlow=TextFlowMaker.generateTextFlow("<font color="+g+">"+f+"/"+d.count+"</font> ")}}else{this.act.textFlow=TextFlowMaker.generateTextFlow1("|C:0xFF0000&T:未激活"),this.next.visible=this.max.visible=!1,this.eBottom.visible=!0,this.upBtn.label="激  活",this.curdesc.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GRAY_COLOR2+">下级效果：</font> ");var y=GlobalConfig.EightGateActivateConfig[this.pos],v=GlobalConfig.EightGateSlotUpgradeConfig[this.pos][1],m="";if((y.attrs&&y.attrs.length>0||v.strengthattr&&v.strengthattr.length>0)&&(m=AttributeData.getAttStr(AttributeData.AttrAddition(y.attrs,v.strengthattr))+"\n"),null!=y.fuwenexattr||null!=v.fuwenexattr){var o=AttributeData.AttrAddition(y.fuwenexattr,v.fuwenexattr);for(var a in y.fuwenexattr)m+=AttributeData.getExtAttStrByType(o[a],0)+"\n"}this.curatt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GRAY_COLOR2+">"+m+"</font> ");var T=GlobalConfig.EightGateActivateConfig[this.pos].duantilv,C=this.ins.getRoleDataByRole(this.curRoleId).stage,u="";u=T>C?ColorUtil.RED_COLOR:ColorUtil.GREEN_COLOR,this.upname.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">八门锻体</font> "),this.use.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+T+"阶</font> "),this.itemIcon.setData(GlobalConfig.ItemConfig[GlobalConfig.EightGateActivateConfig[this.pos].id]);var I=y.consumeList[0],w=GlobalConfig.ItemConfig[I.id];this.itemIcon1.setData(w);var p=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,I.id),g="";g=p>=I.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.upname1.textFlow=TextFlowMaker.generateTextFlow("<font color="+g+">"+GlobalConfig.ItemConfig[I.id].name+"</font> "),this.use1.textFlow=TextFlowMaker.generateTextFlow("<font color="+g+">"+p+"/"+I.count+"</font> ")}},e.prototype.updateRed=function(){this.redPoint.visible=EightRefuseRedPoint.ins().eightPoints[this.curRoleId][this.pos-1]},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.getItemTxt:WarnCT.ins().setBuyGoodsWarn(this.erData.act?GlobalConfig.EightGateSlotUpgradeConfig[this.pos][this.erData.level+1].comsumeItem[0].id:GlobalConfig.EightGateActivateConfig[this.pos].consumeList[0].id,1),ViewManager.ins().close(this);break;case this.upBtn:if(this.erData.act){if(!this.ins.canUpEight(this.curRoleId,this.pos))return void TipsCT.ins().showTips("升级条件不足");EightRefuseCT.ins().sendUpPos(this.curRoleId,this.pos)}else{if(!this.ins.canActEight(this.curRoleId,this.pos))return void TipsCT.ins().showTips("升级条件不足");EightRefuseCT.ins().sendActive(this.curRoleId,this.pos)}}},e}(BaseEuiView);__reflect(EightRefuseTipsWin.prototype,"EightRefuseTipsWin"),window.EightRefuseTipsWin=EightRefuseTipsWin,ViewManager.ins().reg(EightRefuseTipsWin,LayerManager.UI_Popup);var EightUpTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YuPeiUpTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eTip.text="（八门锻体达到",this.eAttTitle.text="使用后八门锻体属性：",this.eTip2.text="八门锻体",this.eTips3.text="界面使用为八门锻体提升属性"},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRoleId=t[0],this.type=t[1],this.update(),this.observe(ExpansionCardCT.ins().postActive,this.update),this.observe(ExpansionCardCT.ins().postInit,this.update)},e.prototype.update=function(){var t=EightRefuseCT.ins().getRoleDataByRole(this.curRoleId),e=EightRefuseCT.getDanItemId(this.type),i=GlobalConfig.ItemConfig[e];this.itemIcon.setData(i),this.nameLabel.text=i.name;var s=ExpansionCardCT.ins().useDanData,n=s&&s[this.type+7]?s[this.type+7].addNum:0;this.use.text=t.dans[this.type]+"/"+(EightRefuseCT.ins().getUseDanMax(this.curRoleId,this.type)+n),this.num.text=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e)+"",this.attr.textFlow=TextFlowMaker.generateTextFlow1(i.desc);var o=GlobalConfig.EightGateBodyConfig[t.stage+1];o?(this.info.visible=!0,this.num0.text=t.stage+1+"阶"):this.info.visible=!1},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(EightUpTipsWin.prototype,"EightUpTipsWin"),window.EightUpTipsWin=EightUpTipsWin,ViewManager.ins().reg(EightUpTipsWin,LayerManager.UI_Popup);var ExclusiveFBCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Guanqia,e.regNetMsg(73,e.postInit),e.regNetMsg(74,e.postResult),e.regNetMsg(75,e.postTriggerFB),e.regNetMsg(76,e.postRelive),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){var e=(t.readShort(),t.readShort(),t.readByte());this.fbInfos={};for(var i=0;e>i;i++){var s=t.readByte();this.fbInfos[s]={id:s,time:DateUtils.formatMiniDateTime(t.readUnsignedInt())}}},e.prototype.postFBTips=function(t){return t},e.prototype.sendEnter=function(t){var e=this.getBytes(73);e.writeInt(t),this.sendToServer(e)},e.prototype.postResult=function(t){var e=t.readByte(),i=t.readShort(),s=[],n=new RewardData;n.id=MoneyConst.yuanbao,n.type=0,n.count=0;for(var o=0;i>o;o++){var a=new RewardData;a.type=t.readInt(),a.id=t.readInt(),a.count=t.readInt(),0==a.type&&a.id==MoneyConst.yuanbao?n.count+=a.count:s.push(a)}s.sort(this.qualitySort),n.count>0&&s.unshift(n);var r=function(){ResultManager.ins().create(FbCT.FB_TYPE_EXCLUSIVE,e,s,"获得奖励如下：")};1==e?DropHelp.addCompleteFunc(r,this):r()},e.prototype.qualitySort=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=1e3*(i.zsLevel||0)+(i.level||0),o=1e3*(s.zsLevel||0)+(s.level||0),a=ItemUtil.getQuality(i),r=ItemUtil.getQuality(s);return a>r?-1:r>a?1:n>o?-1:o>n?1:0},e.prototype.postTriggerFB=function(t){this.postFBTips(t.readByte())},e.prototype.postRelive=function(t){var e=t.readDouble(),i=t.readShort(),s=EntityManager.ins().getEntityByHandle(e),n="";if(s){var o=EntityManager.ins().getEntityByHandle(s.infoModel.masterHandle);n=s instanceof CharRole?s.infoModel.name:s.infoModel.masterHandle&&o?""+o.infoModel.name:"Boss"+s.infoModel.name}ViewManager.ins().open(ReliveWin,i,n)},e.prototype.canEnterById=function(t){return this.fbInfos[t]&&this.fbInfos[t].time>GameServer.serverTime},e.prototype.hascanEnterFB=function(){for(var t in this.fbInfos)if(this.canEnterById(this.fbInfos[t].id))return!0;return!1},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postFBTips",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postTriggerFB",null),__decorate([post()],e.prototype,"postRelive",null),e}(BaseSystem);__reflect(ExclusiveFBCT.prototype,"ExclusiveFBCT"),System.ExclusiveFBCT=function(){return ExclusiveFBCT.ins()},window.ExclusiveFBCT=ExclusiveFBCT;var ExclusiveFBPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ExclusiveItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchEnabled=!0,this.touchChildren=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setData(this.info),this.select=this._select},e.prototype.updateTime=function(){if(this.skin){var t=(this.info.time-GameServer.serverTime)/1e3;this.eLab.text=t>0?DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3):"",this.eRp.visible=t>0}},e.prototype.setData=function(t){if(this.info=t,this.skin){var e=GlobalConfig.ExclusiveLandFubenConfig[t.id];this.bg.source="Exclusive_fb"+e.type+"_png",this.x=e.pos[0],this.y=e.pos[1]}},Object.defineProperty(e.prototype,"select",{set:function(t){this._select=t,this.skin&&(this.eSelect.visible=t)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(ExclusiveFBPanel.prototype,"ExclusiveFBPanel"),window.ExclusiveFBPanel=ExclusiveFBPanel;var ExclusiveFBTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ExclusiveFBTipsSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"id",{set:function(t){this._id=t;var e=GlobalConfig.ExclusiveLandFubenConfig[t];this.eImg.source="Exclusive_fbname"+e.type+"_png"},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(ExclusiveFBTips.prototype,"ExclusiveFBTips"),window.ExclusiveFBTips=ExclusiveFBTips;var ExclusiveFBWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.panels=[],e.curSelectId=0,e._sn_="ExclusiveChallengeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.dataProvider=this.listDP,this.eList.itemRenderer=ItemBase,this.eLab.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[69].text)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.update()},e.prototype.update=function(){this.eGroup.removeChildren();var t=ExclusiveFBCT.ins().fbInfos,e=0,i=[];for(var s in t)if(0==this.curSelectId&&(this.curSelectId=t[s].id),ExclusiveFBCT.ins().canEnterById(t[s].id)){var n=void 0;n=this.panels.length>0?this.panels.pop():new ExclusiveFBPanel,n.setData(t[s]),n.select=e==this.curSelectId,i.push(n),this.eGroup.addChild(n)}this.panels=i,this.updateItem()},e.prototype.updateBtn=function(){this.eBtn.enabled=ExclusiveFBCT.ins().canEnterById(this.curSelectId)},e.prototype.updateItem=function(){var t=GlobalConfig.ExclusiveLandFubenConfig[this.curSelectId];this.listDP.source=t?CommonUtils.objectToArray(t.rewards):null},e.prototype.enterFrame=function(){for(var t in this.panels){var e=this.panels[t];e.updateTime(),e.visible=ExclusiveFBCT.ins().canEnterById(e.info.id)}this.eBtn.enabled=this.eRp.visible=ExclusiveFBCT.ins().canEnterById(this.curSelectId)},e.prototype.onClick=function(t){var e=this.panels.indexOf(t.target);if(e>-1)for(var i in this.panels){var s=this.panels[i],n=s.info;s.select=n.id==this.curSelectId,this.updateItem(),this.updateBtn()}else switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:ExclusiveFBCT.ins().canEnterById(this.curSelectId)&&(ExclusiveFBCT.ins().sendEnter(this.curSelectId),ViewManager.ins().close(this))}},e}(BaseEuiView);__reflect(ExclusiveFBWin.prototype,"ExclusiveFBWin"),window.ExclusiveFBWin=ExclusiveFBWin,ViewManager.ins().reg(ExclusiveFBWin,LayerManager.UI_Popup);var ExpansionCardCT=function(t){function e(){var e=t.call(this)||this;return e.useData=[],e.useDanData=[],e.sysId=PackageID.LianJi,e.regNetMsg(14,e.postInit),e.regNetMsg(15,e.postActive),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){var e=t.readShort();this.useData=[],this.useDanData=[];for(var i=0;e>i;i++){var s={danUseNum:t.readInt(),maxNum:t.readInt()};this.useData.push(s);var n={addNum:0};this.useDanData.push(n)}this.getJadeDan(),this.getWingDan(),this.getEightRefuseDan()},e.prototype.postActive=function(t){var e=t.readShort();this.useData[e-1].danUseNum=t.readInt(),this.useData[e-1].maxNum=t.readInt(),this.getMaxNum(e-1)},e.prototype.getMaxNum=function(t){switch(t||0==t){case 0:case 1:break;case 2:case 3:case 4:this.getJadeDan();break;case 5:case 6:this.getWingDan();break;case 7:case 8:case 9:this.getEightRefuseDan()}},e.prototype.getWingDan=function(){if(0!=this.useData.length){var t=SubRoles.ins().getSubRoleByIndex(0);if(t&&t.wingsData&&1==t.wingsData.openStatus){var e=GlobalConfig.WingLevelConfig[t.wingsData.lv],i=e.flyPill,s=this.useData[6].maxNum-i;this.useDanData[6].addNum=s>0?s:0;var n=e.attrPill,o=this.useData[5].maxNum-n;this.useDanData[5].addNum=o>0?o:0}}},e.prototype.getJadeDan=function(){var t,e=JadeNew.ins().getJadeDataByID(0);if(0!=this.useData.length&&e){var i=e.lv,s=Math.floor(i/GlobalConfig.JadePlateBaseConfig.perLevel)+1;for(var n in GlobalConfig.JadePlateBaseConfig.upgradeInfo){t=BagCT.ins().getBagItemById(+n);var o=GlobalConfig.JadePlateLevelConfig[(s-1)*GlobalConfig.JadePlateBaseConfig.perLevel];if(o.upgradeItemInfo&&o.upgradeItemInfo[n]){var a=+o.upgradeItemInfo[n],r=Number(n)-204067,l=this.useData[r].maxNum-a;this.useDanData[r].addNum=l>0?l:0}}}},e.prototype.getEightRefuseDan=function(){if(0!=this.useData.length&&0!=EightRefuseCT.ins().roleErDatas.length)for(var t=0;t<Object.keys(GlobalConfig.EightGateElixirConfig).length;t++){var e=EightRefuseCT.ins().getUseDanMax(0,t),i=this.useData[t+7].maxNum-e;this.useDanData[t+7].addNum=i>0?i:0}},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postActive",null),e}(BaseSystem);__reflect(ExpansionCardCT.prototype,"ExpansionCardCT"),System.ExpansionCardCT=function(){return ExpansionCardCT.ins()},window.ExpansionCardCT=ExpansionCardCT;var ExpansionCardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxNum=0,e._sn_="ExpansionCardTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.itemIcon.imgJob.visible=!1,this.numLabel0.restrict="0-9"},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0];var i=this._data.itemConfig;this.add.visible=this.btnGroup.visible=!!i,this.itemId=0,i||(i=GlobalConfig.ItemConfig[t[0].id],this.itemId=t[0].id),this.nameLabel.text=i.name,this.nameLabel.textColor=ItemUtil.getQualityColor(i),this.itemIcon.setData(i);var s=i.name.indexOf("扩展卡")>-1?i.name.indexOf("扩展卡"):0;this.nameStr=i.name.slice(0,s),this.description.text="使用该扩展卡能提升1次"+this.nameStr+"最大使用上限",this.observe(ExpansionCardCT.ins().postInit,this.update),this.observe(ExpansionCardCT.ins().postActive,this.update),this.addChangeEvent(this.numLabel0,this.onTxtChange),this.update()},e.prototype.onTxtChange=function(t){var e=Number(this.numLabel0.text);e>this.maxNum?e=this.maxNum:0>=e&&(e=1),this.useNum=e,this.numLabel0.text=this.useNum+""},e.prototype.updateUse=function(){this.useNum=this._data.count,this.numLabel0.text=this.useNum+"",this.maxNum=this._data.count>this.canUseNo?this.canUseNo:this._data.count},e.prototype.update=function(){this.des.text="当前"+this.nameStr+"使用:";var t=this.itemId?this.itemId:this._data.configID,e=t-370240,i=ExpansionCardCT.ins().useData[e];this.canUseNo=i.maxNum,this.use.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+i.danUseNum+"</font>/"+i.maxNum+" "),this.updateUse(),this.updateLimit()},e.prototype.updateLimit=function(){var t=this.useNum+this.canUseNo;this.desc.text="使用后"+this.nameStr+"使用上限提升至"+t},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.minBtn0:this.useNum=1;break;case this.maxBtn0:this.useNum=this.maxNum;break;case this.sub1Btn0:this.useNum--,this.useNum<=0&&(this.useNum=1);break;case this.add1Btn0:this.useNum++,this.useNum>this.maxNum&&(this.useNum=this.maxNum);break;case this.useBtn0:Number(this.numLabel0.text)<=0&&(this.numLabel0.text="1"),BagCT.ins().sendUseItem(this._data.configID,this.useNum),BagCT.ins().postUseItemSuccess&&(ViewManager.ins().close(e),TipsCT.ins().showTips(this.nameStr+"使用上限+"+this.useNum))}this.useNum>=0&&(this.numLabel0.text=this.useNum+"",this.updateLimit())},e}(BaseEuiView);__reflect(ExpansionCardWin.prototype,"ExpansionCardWin"),window.ExpansionCardWin=ExpansionCardWin,ViewManager.ins().reg(ExpansionCardWin,LayerManager.UI_Popup);var FangpianCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Activity,e.regNetMsg(26,e.doData),e.regNetMsg(27,e.doChangeData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendGetAwards=function(t){var e=this.getBytes(25);e.writeShort(t),this.sendToServer(e)},e.prototype.doData=function(t){this.dayNum=t.readShort(),this.isAwards=t.readInt(),this.postIsAwards()},e.prototype.doChangeData=function(t){t.readBoolean();this.dayNum=t.readShort(),this.isAwards=t.readInt(),this.postIsAwards()},e.prototype.postAwardCallback=function(){},e.prototype.postIsAwards=function(){},e.prototype.getAwardStast=function(){var t=GlobalConfig.AntiCheatNoticeBaseConfig;return this.dayNum<=t.days?1==(e.ins().isAwards>>this.dayNum&1)?2:1:0},__decorate([post()],e.prototype,"postAwardCallback",null),__decorate([post()],e.prototype,"postIsAwards",null),e}(BaseSystem);__reflect(FangpianCT.prototype,"FangpianCT"),System.FangpianCT=function(){return FangpianCT.ins()},window.FangpianCT=FangpianCT;var FangpianRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,FangpianCT.ins().postIsAwards),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){this.redPoint=1==FangpianCT.ins().getAwardStast()},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(FangpianRedPoint.prototype,"FangpianRedPoint"),System.FangpianRedPoint=function(){return FangpianRedPoint.ins()},window.FangpianRedPoint=FangpianRedPoint;var FangpianPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="gameFangPianSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.suerBtn,this.onTap),this.observe(FangpianCT.ins().postIsAwards,this.update),this.observe(FangpianRedPoint.ins().postRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.RedPoint.visible=FangpianRedPoint.ins().redPoint},e.prototype.onTap=function(){FangpianCT.ins().sendGetAwards(FangpianCT.ins().dayNum),GlobalConfig.AnticheatnoticeConfig[FangpianCT.ins().dayNum]||TipsCT.ins().showTips("未到领取时间")},e.prototype.update=function(){var t=GlobalConfig.AntiCheatNoticeBaseConfig,e=FangpianCT.ins().dayNum>t.days;if(e)return void(this.Num.visible=this.Reward.visible=this.suerBtn.visible=!1);if(!GlobalConfig.AnticheatnoticeConfig[FangpianCT.ins().dayNum]){var i=GlobalConfig.AnticheatnoticeConfig[FangpianCT.ins().dayNum+1];return this.Reward.source="szyuanbao",this.Num.text=i.rewards[0].count+"",void(this.Num.visible=this.Reward.visible=this.suerBtn.visible=!0)}this.suerBtn.visible=!0,this.suerBtn.label="领取奖励",this.Reward.source="szyuanbao";var s=GlobalConfig.AnticheatnoticeConfig[FangpianCT.ins().dayNum];switch(this.Num.text=s.rewards[0].count+"",FangpianCT.ins().getAwardStast()){case 1:this.suerBtn.enabled=!0;break;case 2:this.suerBtn.enabled=!1,this.suerBtn.label="已成功领取",this.Num.visible=this.Reward.visible=this.suerBtn.visible=FangpianCT.ins().dayNum<t.days}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(FangpianPanel.prototype,"FangpianPanel"),window.FangpianPanel=FangpianPanel;var GuideTaskCT=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getTaskLevel=function(t){return t[0]?t[1]?t[0]&&t[1]?t[1]+"转"+t[0]+"级":void 0:t[0]+"级":t[1]+"转"},e}(BaseSystem);__reflect(GuideTaskCT.prototype,"GuideTaskCT"),System.GuideTaskCT=function(){return GuideTaskCT.ins()},window.GuideTaskCT=GuideTaskCT;var GuideTaskItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="NewGuideTaskItem",e.addTouchEvent(e.actBtn,e.onClick),e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.skin&&this.data&&this.data instanceof Array){var t=this.data[0],e=this.data[1];this.pName.textFlow=TextFlowMaker.generateTextFlow(t.name);var i=e.getAchieveInfo(t.index),s=i?i.times:0;this.hpDesc.text=s+"/"+t.target;var n=Math.min(s,t.target);this.bosshp.maximum=t.target,this.bosshp.value=n,this.state=e.getStatus(t.index),this.list.dataProvider=new eui.ArrayCollection(t.reward),this.actBtn.label=0==this.state?"前  往":"领  取",this.eRed.visible=1==this.state,this.done.visible=2==this.state,this.actBtn.visible=!this.done.visible}},e.prototype.onClick=function(){if(this.data){var t=this.data[0];if(1==this.state)return void PActivity.ins().sendReward(t.id,t.index,2);if(t.turn)return"GuanQiaRewardWin"==t.turn[0]?void(FbCT.ins().currentEnergy>=FbCT.ins().energy?(ViewManager.ins().closeTopLevel(),FbCT.ins().autoPk()):TipsCT.ins().showTips("|C:0xf3311e&T:能量不足|")):void ViewManager.ins().open(t.turn[0],t.turn[1],t.turn[2])}},e}(BaseItemRender);__reflect(GuideTaskItem.prototype,"GuideTaskItem"),window.GuideTaskItem=GuideTaskItem;var GuideTaskTabItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="Btn27Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.labelDisplay.text=this.data[0],this.redPoint.visible=this.data[2].tabCanReward(this.data[1]))},e}(BaseItemRender);__reflect(GuideTaskTabItem.prototype,"GuideTaskTabItem"),window.GuideTaskTabItem=GuideTaskTabItem;var GuideTaskWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e.skinName="NewGuideTaskSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.updateView(),this.addTouchEvent(this,this.onTouch),this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(PActivity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(BagCT.ins().postItemAdd,this.refushRedPoint),this.observe(BagCT.ins().postItemChange,this.refushRedPoint),this.observe(BagCT.ins().postItemDel,this.refushRedPoint),this.selectIndex=0,t&&t.length){var i=t[0],s=0;for(var n in this._datas){if(this._datas[n].id==i){this.selectIndex=s;break}s++}}SoundUtil.play(SoundEnum.WINDOW),0!=this.selectIndex&&this.activityPanelList[0].close(),this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,PActivity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.close=function(){this.removeEventListener(egret.TouchEvent.CHANGE,this.onClickMenu,this.menuList),this.removeEventListener(eui.UIEvent.CHANGE_END,this.onChange,this.menuScroller);for(var t=0;t<this.activityPanelList.length;t++)this.activityPanelList[t].close()},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.leftRed.visible=this.rightRed.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn.visible=!1,this.rightBtn.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible)for(var i=0;e-5>=i;i++)if(PActivity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=!0;break}if(this.rightBtn.visible)for(var i=e+1;t>i;i++)if(PActivity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=!0;break}}},e.prototype.updateView=function(){var t=0;for(t=0;t<this.viewStack.numElements;t++)ObjectPool.push(this.viewStack.getElementAt(t));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];var e=PActivity.ins().activityData;for(var i in e){var s=e[i];s.pageStyle==ActivityPageStyle.NewGuideTask&&s.isOpenActivity()&&!s.getHide()&&this._datas.push(PActivity.ins().getbtnInfo(i))}this._datas.sort(this.sort),t=0;var n;for(var i in this._datas){var o=this._datas[i].id,a=PActivity.ins().getActivityDataById(+o);n=ActivityPanel.create(o,a.activityType),n.top=0,n.left=0,n.bottom=0,n.right=0,this.activityPanelList[t]=n,this.viewStack.addChild(this.activityPanelList[t]),t++}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList.dataProvider=this.dataArr,this.viewStack.validateNow(),this.menuList.validateNow()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList.dataProvider=this.dataArr},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange()}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,PActivity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0))},e}(BaseEuiView);__reflect(GuideTaskWin.prototype,"GuideTaskWin"),window.GuideTaskWin=GuideTaskWin,ViewManager.ins().reg(GuideTaskWin,LayerManager.UI_Main);var OSATarget50Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){var t=GlobalConfig.PActivityType50_1Config[this.activityID];this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget50Panel"+t[1].showType),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel),this.cruPanel.open())},e.prototype.close=function(){this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(BaseView);__reflect(OSATarget50Panel.prototype,"OSATarget50Panel"),window.OSATarget50Panel=OSATarget50Panel;var OSATarget50Panel1=function(t){function e(){var e=t.call(this)||this;return e.awardNum=1,e.skinName="NewGuideTask",e}return __extends(e,t),e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.listTab=new eui.ArrayCollection,this.list1.dataProvider=this.listTab,this.listTask=new eui.ArrayCollection,this.list.dataProvider=this.listTask,this.activityData=PActivity.ins().getActivityDataById(this.activityID),this.num=this.activityData.getAwardNum(),egret.callLater(function(){t.cardMoveTo(t.num)},this),this.update(),this.addTouchEvent(this,this.onClick),this.list1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange1,this),this.observe(PActivity.ins().postActivityIsGetAwards,this.update),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)
},e.prototype.cardMoveTo=function(t){var e=this;egret.callLater(function(){var i=GlobalConfig.PActivityType50_1Config[e.activityID],s=CommonUtils.getObjectLength(i),n=160;e.eScroller.viewport.scrollH=n*(Math.min(t,s-2)-1)},this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onListChange1=function(t){var e=GlobalConfig.PActivityType50_1Config[this.activityID][t.itemIndex+1];if(ZsCT.ins().lv>=e.openZsLv&&Actor.level>=e.openLv)this.num=t.itemIndex+1;else{var i=GuideTaskCT.ins().getTaskLevel([e.openLv,e.openZsLv]);TipsCT.ins().showTips("达到"+i+"可开启")}this.awardNum=t.itemIndex+1,this.list1.selectedIndex=this.num-1},e.prototype.update=function(){this.actBtn.enabled=!0,this.actBtn.label="领取",this.activityData=PActivity.ins().getActivityDataById(this.activityID);var t=[],e=GlobalConfig.PActivityType50_1Config[this.activityID];if(e){for(var i in e)t.push([e[i].tabName,e[i].index,this.activityData]);this.listTab.replaceAll(t),e[this.num]||(this.num=this.num-1),this.awardNum=this.num;e[this.num];this.list1.selectedIndex=this.num-1;for(var s=[],n=this.num,o=e[n];o&&!o.showIcon;)n++,o=e[n];s.push(o.reward[0]),this.list2.dataProvider=new eui.ArrayCollection(s);var a=GuideTaskCT.ins().getTaskLevel([o.openLv,o.openZsLv]);this.level.text="完成"+a+"任务即可领取",this.showTask(),this.setTime()}},e.prototype.setTime=function(){this.level0.text="剩余时间："+this.activityData.getRemainTime()},e.prototype.showTask=function(t){var e=GlobalConfig.PActivityType50_2Config[this.activityID];if(e){var i=[],s=[];for(var n in e)e[n].group==this.num&&(2==this.activityData.getStatus(e[n].index)?s.push([e[n],this.activityData]):i.push([e[n],this.activityData]));i=i.concat(s),t?this.listTask.source=i:this.listTask.replaceAll(i),this.list0.dataProvider=new eui.ArrayCollection(GlobalConfig.PActivityType50_1Config[this.activityID][this.awardNum].reward),this.eRed.visible=this.activityData.groupCanReward(this.awardNum),this.eGetImg.visible=1==(this.activityData.rewardInfo>>this.awardNum&1),this.actBtn.touchEnabled=!this.eGetImg.visible}},e.prototype.onClick=function(t){switch(t.target instanceof GuideTaskTabItem&&t.target.itemIndex==this.list1.selectedIndex&&(this.list1.selectedIndex=t.target.itemIndex,this.showTask(!0)),t.target){case this.actBtn:var e=GlobalConfig.PActivityType50_2Config[this.activityID][this.awardNum];this.eRed.visible?PActivity.ins().sendReward(e.id,e.index,1):TipsCT.ins().showTips("完成全部任务后可领取")}},e}(BaseView);__reflect(OSATarget50Panel1.prototype,"OSATarget50Panel1"),window.OSATarget50Panel1=OSATarget50Panel1;var PActivityType50Data=function(t){function e(e,i,s,n,o){void 0===o&&(o=ActivityType.Personal);var a=t.call(this,e)||this;return a.rewardInfo=0,a.awardNum=1,a.activityType=o,a.id=i,a.startTime=s,a.endTime=n,a.update(e),a}return __extends(e,t),e.prototype.update=function(t){this.rewardInfo=t.readInt();var e=t.readShort();this.achieveInfo=[];for(var i=0;e>i;i++){var s=t.readShort(),n=t.readInt(),o=t.readByte();this.achieveInfo[s]={times:n,isGot:o}}this.getAwardNum()},e.prototype.getAwardNum=function(){var t,e=GlobalConfig.PActivityType50_1Config[this.id];for(var i in e)t=parseInt(i);for(var s=0;t>s;s++)this.awardNum<=t&&1==(this.rewardInfo>>this.awardNum&1)&&(this.awardNum+=1);return this.awardNum},e.prototype.getAchieveInfo=function(t){return this.achieveInfo[t]},e.prototype.getStatus=function(t){var e=GlobalConfig.PActivityType50_2Config[this.id],i=e[t],s=this.getAchieveInfo(t);return s?s.isGot?2:s.times>=i.target?1:0:0},e.prototype.groupCanReward=function(t){var e=!1,i=GlobalConfig.PActivityType50_2Config[this.id];for(var s in i)if(i[s].group==t){var n=this.achieveInfo[i[s].index];if(!(n&&n.times>=i[s].target&&n.isGot&&0==(this.rewardInfo>>t&1)))return!1;e=!0}return e},e.prototype.tabCanReward=function(t){var e=GlobalConfig.PActivityType50_1Config[this.id][t];if(ZsCT.ins().lv<e.openZsLv||Actor.level<e.openLv)return!1;var i=GlobalConfig.PActivityType50_2Config[this.id];for(var s in i)if(i[s].group==t){var n=this.achieveInfo[i[s].index];if(n&&n.times>=i[s].target&&!n.isGot)return!0}return!1},e.prototype.canReward=function(){for(var t=Object.keys(GlobalConfig.PActivityType50_1Config[this.id]).length,e=0;t>e;e++){if(this.tabCanReward(e+1))return!0;if(this.groupCanReward(e+1))return!0}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(PActivityType50Data.prototype,"PActivityType50Data"),window.PActivityType50Data=PActivityType50Data;var GuildFBCT=function(t){function e(){var e=t.call(this)||this;return e.isOpenTime=!1,e.sysId=PackageID.Guanqia,e.regNetMsg(64,e.postInfo),e.regNetMsg(66,e.doBelongChange),e.regNetMsg(67,e.postElert),e.regNetMsg(68,e.postHudun),e.regNetMsg(69,e.postResult),e.regNetMsg(70,e.postFBInfo),e.regNetMsg(71,e.postBuffInfo),e.regNetMsg(72,e.postHelp),e.observe(BossCT.ins().postBossAppear,function(){GameMap.fbType==FbCT.FB_TYPE_GUILDFB&&ViewManager.ins().open(BossBelongPanel)}),e.observe(GameApp.ins().postZeroInit,e.postCheckOpenTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){this.beganTime=DateUtils.formatMiniDateTime(t.readInt()),this.endedTime=DateUtils.formatMiniDateTime(t.readInt()),this.postCheckOpenTime();var e=t.readByte();this.guildBoss=[];for(var i=0;e>i;i++){for(var s={id:t.readByte(),alive:1==t.readByte(),deadNum:t.readByte(),belongs:[],attRanks:[]},n=t.readByte(),o=0;n>o;o++){var a={msg:t.readString(),msg1:t.readString()};s.belongs.push(a)}n=t.readShort();for(var o=0;n>o;o++){var r={msg:t.readString(),msg1:t.readDouble()+""};s.attRanks.push(r)}this.guildBoss[s.id]=s}e=t.readByte(),this.buffIds=[];for(var i=0;e>i;i++)this.buffIds.push(t.readByte())},e.prototype.sendEnterFB=function(t){var e=this.getBytes(65);e.writeByte(t),this.sendToServer(e),this.bossId=t},e.prototype.doBelongChange=function(t){var e=t.readDouble(),i=t.readDouble(),s=t.readString();BossCT.ins().postBelongChange(i,e,s)},e.prototype.sendCleanBelong=function(t){var e=this.getBytes(66);e.writeByte(t),this.sendToServer(e)},e.prototype.sendRevive=function(){this.sendBaseProto(67)},e.prototype.postElert=function(t){var e=DateUtils.formatMiniDateTime(t.readInt()),i=t.readString(),s=Math.floor((e-GameServer.serverTime)/1e3);s>0&&ViewManager.ins().open(KFBossReliveWin,s,i)},e.prototype.postHudun=function(t){BossCT.ins().shieldType=1,BossCT.ins().curShield=t.readInt(),BossCT.ins().totalShield=t.readInt(),BossCT.ins().postShieldPer()},e.prototype.postResult=function(t){for(var e=t.readByte(),i=t.readByte(),s=t.readString(),n=t.readByte()||1,o=t.readByte(),a=t.readShort(),r=[],l=0;a>l;l++)r[l]=new RewardData,r[l].parser(t);var h=t.readString();s=(""==h?"":"|C:0x2eb6ff&T:【"+h+"】|\n")+s;var p="yuanhead"+n+o;ResultManager.ins().create(GameMap.fbType,!0,r,"",null,[e,s,p,i])},e.prototype.postFBInfo=function(t){var e=t.readByte();if(this.guildBoss){var i=this.guildBoss[e];i.alive=1==t.readByte(),i.deadNum=t.readByte();var s=t.readByte();i.belongs.length=0;for(var n=0;s>n;n++){var o={msg:t.readString(),msg1:t.readString()};i.belongs.push(o)}i.attRanks.length=0,s=t.readShort();for(var n=0;s>n;n++){var a={msg:t.readString(),msg1:t.readDouble()+""};i.attRanks.push(a)}}},e.prototype.postBuffInfo=function(t){this.buffIds=[];for(var e=t.readByte(),i=0;e>i;i++)this.buffIds.push(t.readByte())},e.prototype.sendHelp=function(t){var e=this.getBytes(72);e.writeString(t),this.sendToServer(e)},e.prototype.postHelp=function(t){ChatCT.ins().postSysChatMsg(new ChatSystemData(3,t.readString()))},e.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.GuildFubenBaseConfig,i="";return GameServer.serverOpenDay+1<e.openday?i="第"+e.openday+"天开启":ZsCT.ins().lv<e.zslevel&&(i=e.zslevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.postCheckOpenTime=function(){var t=Math.floor((this.beganTime-GameServer.serverTime)/1e3),e=Math.floor((this.endedTime-GameServer.serverTime)/1e3);this.isOpenTime=0>t&&e>0},__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postHudun",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postFBInfo",null),__decorate([post()],e.prototype,"postBuffInfo",null),__decorate([post()],e.prototype,"postHelp",null),__decorate([post()],e.prototype,"postCheckOpenTime",null),e}(BaseSystem);__reflect(GuildFBCT.prototype,"GuildFBCT");var GameSystemHL;!function(t){t.guildFBCT=GuildFBCT.ins.bind(GuildFBCT)}(GameSystemHL||(GameSystemHL={})),egret.registerClass(GuildFBCT,"GuildFBCT"),window.GuildFBCT=GuildFBCT;var GuildFBRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.fbRedPoints=[],e.associated(e.postRedPoint,GuildFBCT.ins().postInfo,GuildFBCT.ins().postFBInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.postFBRedPoint(),t!=this.redPoint},e.prototype.postFBRedPoint=function(){var t=!1;this.fbRedPoints=[];var e=GlobalConfig.GuildFubenBossConfig;if(!GuildFBCT.ins().guildBoss)return t;for(var i in e){var s=GuildFBCT.ins().guildBoss[e[i].index];this.fbRedPoints[i]=s.alive,this.fbRedPoints&&(t=!0)}return t},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postFBRedPoint",null),e}(BaseSystem);__reflect(GuildFBRedPoint.prototype,"GuildFBRedPoint");var GameSystemHL;!function(t){t.guildFBRedPoint=GuildFBRedPoint.ins.bind(GuildFBRedPoint)}(GameSystemHL||(GameSystemHL={})),egret.registerClass(GuildFBRedPoint,"GuildFBRedPoint"),window.GuildFBRedPoint=GuildFBRedPoint;var GuildFBInfoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GonghuibossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ItemBase},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.bossId=t[0],this.addTouchEvent(this,this.onClick),this.observe(GuildFBCT.ins().postFBInfo,this.update),this.observe(GuildFBCT.ins().postInfo,this.update),this.observe(GuildFBRedPoint.ins().postFBRedPoint,this.updateRed),this.initView(),this.update()},e.prototype.updateRed=function(){this.eBtn.eRp.visible=GuildFBRedPoint.ins().fbRedPoints[this.bossId]},e.prototype.initView=function(){var t=GlobalConfig.GuildFubenBossConfig[this.bossId];this.eBossImg.source=t.icon,this.eNameImg.source=t.nameImg,this.eDes.textFlow=TextFlowMaker.generateTextFlow(t.desc),this.eList.dataProvider=new eui.ArrayCollection(t.reward)},e.prototype.update=function(){var t=GuildFBCT.ins().guildBoss[this.bossId],e=GlobalConfig.GuildFubenBossConfig[this.bossId];this.eBtn.enabled=t.alive;var i;if(2==e.type){i="荣誉榜",t.belongs[0]&&(i+="\n"+StringUtils.complementByChar(t.belongs[0].msg,20)+"归属");for(var s=t.attRanks.length,n=0;s>n;n++){var o=t.attRanks[n];i+="\n"+StringUtils.complementByChar(o.msg,20)+o.msg1}}else{i="已击败\n";for(var s=t.belongs.length,n=0;s>n;n++){var a=t.belongs[n],r=a.msg+"-"+a.msg1;i+=n%2==0?"\n"+StringUtils.complementByChar(r,20):r}}this.eLab.text=i},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:GuildFBCT.ins().sendEnterFB(this.bossId),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildFBInfoWin.prototype,"GuildFBInfoWin"),egret.registerClass(GuildFBInfoWin,"GuildFBInfoWin"),window.GuildFBInfoWin=GuildFBInfoWin,ViewManager.ins().reg(GuildFBInfoWin,LayerManager.UI_Popup);var GuildFBWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GonghuiRaidSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.bossImgs=[this.eBoss1,this.eBoss2,this.eBoss3,this.eBoss4,this.eBoss5];for(var t=this.bossImgs.length,e=0;t>e;e++)this.bossImgs[e].init(e+1)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(GuildFBCT.ins().postFBInfo,this.update),this.observe(GuildFBCT.ins().postInfo,this.update),this.update()},e.prototype.update=function(){for(var t=this.bossImgs.length,e=0;t>e;e++)this.bossImgs[e].update();this.updateBuff()},e.prototype.updateBuff=function(){var t=GlobalConfig.GuildFubenBuffConfig,e=GuildFBCT.ins().buffIds,i=[];for(var s in e)i.push(t[e[s]].groupId);var n="";for(var s in t){var o=t[s];i.indexOf(o.groupId)>-1?e.indexOf(o.buffId)>-1&&(""!=n&&(n+="\n"),n+="|C:"+ColorUtil.GREEN+"&T:"+o.desc+"|"):(i.push(o.groupId),""!=n&&(n+="\n"),n+=o.desc)}this.eBuffLab.textFlow=TextFlowMaker.generateTextFlow(n)},e.prototype.onClick=function(t){var e=this.bossImgs.indexOf(t.target);if(e>-1)return void ViewManager.ins().open(GuildFBInfoWin,e+1);switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[64].text);break;case this.eBuff:this.eBuffGroup.visible=!this.eBuffGroup.visible}},e}(BaseEuiView);__reflect(GuildFBWin.prototype,"GuildFBWin"),egret.registerClass(GuildFBWin,"GuildFBWin"),window.GuildFBWin=GuildFBWin,ViewManager.ins().reg(GuildFBWin,LayerManager.UI_Main);var GuildRaidItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GonghuiRaidItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchChildren=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GuildFBRedPoint.ins().postFBRedPoint,this.updateRed),this.eImg.source=this.cfg.icon,this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRp.visible=GuildFBRedPoint.ins().fbRedPoints[this.cfg.index]},e.prototype.init=function(t){this.cfg=GlobalConfig.GuildFubenBossConfig[t]},e.prototype.update=function(){if(this.skin){var t=GuildFBCT.ins().guildBoss[this.cfg.index];this.eImg.filters=t.alive?null:FilterUtil.ARRAY_GRAY_FILTER}},e}(BaseView);__reflect(GuildRaidItem.prototype,"GuildRaidItem"),egret.registerClass(GuildRaidItem,"GuildRaidItem"),window.GuildRaidItem=GuildRaidItem;var GuildJackpotChargeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildJackpotChargeItemSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eBl.text=t.chargeamount+"",this.pay.text="￥"+t.cash,this.yuanbaoImg.source=t.show}},e}(BaseItemRender);__reflect(GuildJackpotChargeItem.prototype,"GuildJackpotChargeItem"),window.GuildJackpotChargeItem=GuildJackpotChargeItem;var GuildJackpotChargeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildJackpotChargeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eListDP=new eui.ArrayCollection},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){this.eListDP.source=CommonUtils.objectToArray(GlobalConfig.GuildGildPoolChargeTypeConfig)},e.prototype.onClick=function(t){if(t.target instanceof GuildJackpotChargeItem){var i=t.target.data;return void Recharge.ins().showReCharge(i.amount,ShowRechargeType.Type_JackPot)}switch(t.target){case this.eClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildJackpotChargeWin.prototype,"GuildJackpotChargeWin"),window.GuildJackpotChargeWin=GuildJackpotChargeWin,ViewManager.ins().reg(GuildJackpotChargeWin,LayerManager.UI_Popup);var GuildJackPotCT=function(t){function e(){var e=t.call(this)||this;return e.overTime=0,e.logs=[],e.state=!0,e.sysId=PackageID.Guild,e.regNetMsg(32,e.postInit),e.regNetMsg(34,e.postlogs),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.total=t.readInt(),this.overTime=DateUtils.formatMiniDateTime(t.readUnsignedInt());var e=t.readInt();this.logs=[];for(var i=0;e>i;i++){var s=t.readString(),n=t.readInt();this.logs.unshift(s+"注入"+n+"元宝")}this.state=t.readBoolean()},e.prototype.postlogs=function(t){this.total=t.readInt(),this.overTime=DateUtils.formatMiniDateTime(t.readUnsignedInt());for(var e=t.readInt(),i=0;e>i;i++){var s=t.readString(),n=t.readInt();this.logs.unshift(s+"注入"+n+"元宝")}this.logs.length=Math.min(20,this.logs.length),this.state=t.readBoolean()},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postlogs",null),e}(BaseSystem);__reflect(GuildJackPotCT.prototype,"GuildJackPotCT"),System.GuildJackPotCT=function(){return GuildJackPotCT.ins()},window.GuildJackPotCT=GuildJackPotCT;var GuildJackpotLogItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildJackpotLogItemSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.sLab=this.data?this.data:""},e}(BaseItemRender);__reflect(GuildJackpotLogItem.prototype,"GuildJackpotLogItem"),window.GuildJackpotLogItem=GuildJackpotLogItem;var GuildJackpotPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildJackpotSkin",e.addTouchEvent(e,e.onClick),e.mc=new MovieClip,e.mc.playFile(RES_DIR_EFF+"goldEff",-1),e.eff.addChild(e.mc),e.eListDP=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GuildJackPotCT.ins().postlogs,this.update),this.update()},e.prototype.update=function(){var t=GuildJackPotCT.ins();if(this.Jackpot.text=t.total+"",t.overTime>0){var e=new Date(t.overTime);this.mon.text=e.getMonth()+1+"",this.date.text=e.getDate()+"";var i=e.getHours(),s=e.getMinutes(),n=void 0;n=0==s?"00":10>s?"0"+s:s+"",this.sTime=i+":"+n+"行会所有成员(包括离线成员)"}var o=[];for(var a in t.logs)o.unshift(t.logs[a]);t.logs.length>=5&&(o.push("","","",""),o.unshift("","","",""),egret.callLater(this.scroll,this)),this.eListDP.source=o,this.give.visible=t.state,this.eTips.visible=!this.give.visible},e.prototype.scroll=function(){this.eScroller.viewport.scrollV=0,egret.Tween.removeTweens(this.eScroller.viewport);var t=500*(this.eListDP.source.length-4),e=Math.max(this.eScroller.viewport.contentHeight-this.eScroller.viewport.height,0),i=egret.Tween.get(this.eScroller.viewport,{loop:!0});i.to({scrollV:e},t)},e.prototype.onClick=function(t){switch(t.target){case this.give:ViewManager.ins().open(GuildJackpotChargeWin)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.Tween.removeTweens(this.eScroller.viewport)},e}(BaseView);__reflect(GuildJackpotPanel.prototype,"GuildJackpotPanel"),window.GuildJackpotPanel=GuildJackpotPanel;var GuildSoulsLandCT=function(t){function e(){var e=t.call(this)||this;return e.open=!0,e.openTime=0,e.cur=1,e.challenge=0,e.guildInfos=[],e.monsterInfos=[],e.sysId=PackageID.GuildFB,e.regNetMsg(10,e.postlogs),e.regNetMsg(11,e.postupdatePass),e.regNetMsg(12,e.postrankCB),e.regNetMsg(13,e.postInit),e.regNetMsg(14,e.poststate),e.regNetMsg(16,e.postaward),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postlogs=function(t){},e.prototype.postupdatePass=function(t){this.cur=t.readInt(),this.challenge=t.readShort(),this.updateMonInfos(null)},e.prototype.postrankCB=function(t){var e=t.readInt();this.guildInfos=[],this.myGuild=null;for(var i=0;e>i;i++){var s={name:t.readString(),guildId:t.readInt(),pass:t.readInt(),score:t.readInt(),rank:i+1,time:DateUtils.formatMiniDateTime(t.readUnsignedInt())};this.guildInfos.push(s),s.guildId==Guild.ins().guildID&&(this.myGuild=s)}},e.prototype.postInit=function(t){return this.openTime=DateUtils.formatMiniDateTime(t.readInt()),this.open=t.readBoolean(),this.open?(this.cur=t.readInt(),this.challenge=t.readShort(),void this.updateMonInfos(t)):(this.cur=1,void this.updateMonInfos(null))},e.prototype.updateMonInfos=function(t){var e=!t||this.isAllPass();this.monsterInfos=[];var i,s=e?!this.isAllPass():t.readBoolean();i=GlobalConfig.GuildAllSoulLandBossInfoConfig[this.cur-(this.isAllPass()?1:0)];var n=i.clientPos,o=1;for(var a in n){var r={monsterId:n[a].monId,x:n[a].posX,y:n[a].posY,desc:n[a].desc,state:s,type:GuildSoulsMonType.boss,scene:o++,cfg:i};this.monsterInfos.push(r)}i=GlobalConfig.GuildAllSoulLandEliteMonsterInfoConfig[this.cur-(this.isAllPass()?1:0)],n=i.clientPos;for(var l=e?n.length:t.readShort(),a=0;l>a;a++){var r={monsterId:n[a].monId,x:n[a].posX,y:n[a].posY,desc:n[a].desc,state:e?!this.isAllPass():t.readBoolean(),type:GuildSoulsMonType.JYMon,scene:o++,cfg:i};this.monsterInfos.push(r)}i=GlobalConfig.GuildAllSoulLandSmallMonsterInfoConfig[this.cur-(this.isAllPass()?1:0)],n=i.clientPos,l=e?n.length:t.readShort();for(var a=0;l>a;a++){var r={monsterId:n[a].monId,x:n[a].posX,y:n[a].posY,desc:n[a].desc,state:e?!this.isAllPass():t.readBoolean(),type:GuildSoulsMonType.mon,scene:o++,cfg:i};this.monsterInfos.push(r)}},e.prototype.poststate=function(t){var e=t.readByte();if(e==this.cur){var i=this.getMonInfo(t.readByte(),t.readByte());i&&(i.state=!1)}},e.prototype.postaward=function(t){var e=t.readByte(),i=t.readByte(),s=t.readBoolean();ResultManager.ins().create(FbCT.FB_TYPE_SOULS,s,s?1==i?GlobalConfig.GuildAllSoulLandBossInfoConfig[e].passAwards:"":null)},e.prototype.sendInterPass=function(t,e){var i=this.getBytes(10);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendrank=function(){this.sendBaseProto(12)},e.prototype.isOpen=function(){return ZsCT.ins().lv>=GlobalConfig.AllSoulLandBaseConfig.zslevel&&GameServer.serverOpenDay+1>=GlobalConfig.AllSoulLandBaseConfig.openserverday},e.prototype.isAllPass=function(){return this.cur>0&&null==GlobalConfig.GuildAllSoulLandBossInfoConfig[this.cur]},e.prototype.getMonInfo=function(t,e){var i=1;for(var s in this.monsterInfos)if(this.monsterInfos[s].type==t){if(i==e)return this.monsterInfos[s];i++}return null},__decorate([post()],e.prototype,"postlogs",null),__decorate([post()],e.prototype,"postupdatePass",null),__decorate([post()],e.prototype,"postrankCB",null),__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"poststate",null),__decorate([post()],e.prototype,"postaward",null),e}(BaseSystem);__reflect(GuildSoulsLandCT.prototype,"GuildSoulsLandCT");var GuildSoulsMonType;!function(t){t[t.boss=1]="boss",t[t.JYMon=2]="JYMon",t[t.mon=3]="mon"}(GuildSoulsMonType||(GuildSoulsMonType={})),System.GuildSoulsLandCT=function(){return GuildSoulsLandCT.ins()},window.GuildSoulsLandCT=GuildSoulsLandCT;var GuildSoulsRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,GuildSoulsLandCT.ins().postupdatePass,GuildSoulsLandCT.ins().postInit),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=GuildSoulsLandCT.ins();this.redPoint=t.challenge>0&&t.open&&t.isOpen()&&!t.isAllPass()},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(GuildSoulsRedPoint.prototype,"GuildSoulsRedPoint"),System.GuildSoulsRedPoint=function(){return GuildSoulsRedPoint.ins()},window.GuildSoulsRedPoint=GuildSoulsRedPoint;var GuildRankrewardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSoulsLandRankrewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.rank.text="第"+t.rank+"名",this.guild.text=""+t.name,this.time.text=DateUtils.getFormatBySecond(t.time/1e3,DateUtils.TIME_FORMAT_18);var e=t.pass>0&&null==GlobalConfig.GuildAllSoulLandBossInfoConfig[t.pass]?t.pass-1:t.pass,i=t.pass>0&&null==GlobalConfig.GuildAllSoulLandBossInfoConfig[t.pass]?100:t.score;this.num.text="第"+e+"关",this.expBar.value=i>100?100:i,this.expLabel.text=(i>100?100:i)+"/100";var s=GlobalConfig.GuildAllSoulLandRankConfig;for(var n in s)if(s[n].srank<=t.rank&&s[n].erank>=t.rank){this.list.dataProvider=new eui.ArrayCollection(s[n].awards);break}}},e}(BaseItemRender);__reflect(GuildRankrewardItem.prototype,"GuildRankrewardItem"),window.GuildRankrewardItem=GuildRankrewardItem;var GuildRankrewardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildSoulsLandRankreward",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.list.dataProvider=this.eListDP,GuildSoulsLandCT.ins().sendrank()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GuildSoulsLandCT.ins().postrankCB,this.update),this.update()},e.prototype.update=function(){this.eListDP.replaceAll(GuildSoulsLandCT.ins().guildInfos);var t=GuildSoulsLandCT.ins().myGuild;this.guildPos.text="我的公会排名："+(t?"第"+t.rank+"名":"未上榜")},e}(BaseEuiView);__reflect(GuildRankrewardWin.prototype,"GuildRankrewardWin"),window.GuildRankrewardWin=GuildRankrewardWin,ViewManager.ins().reg(GuildRankrewardWin,LayerManager.UI_Popup);var GuildrewardsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSoulsLandGuildrewardsItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.pass.text="第"+StringUtils.NumberToChinese(t.id)+"关",this.list.dataProvider=new eui.ArrayCollection(t.passAwards)},e}(BaseItemRender);__reflect(GuildrewardsItem.prototype,"GuildrewardsItem"),window.GuildrewardsItem=GuildrewardsItem;var GuildrewardsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildSoulsLandGuildrewards",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=GuildrewardsItem,this.update()},e.prototype.update=function(){var t=GlobalConfig.GuildAllSoulLandBossInfoConfig,e=[];for(var i in t)e.push(t[i]);this.list.dataProvider=new eui.ArrayCollection(e)},e}(BaseEuiView);__reflect(GuildrewardsWin.prototype,"GuildrewardsWin"),window.GuildrewardsWin=GuildrewardsWin;var GuildSoulsBossPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSoulsLandMonsterItem",e.mc=new MovieClip,e.boss.addChild(e.mc),e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.setData=function(t){this.cfg=t;var e=GlobalConfig.MonstersConfig[t.monsterId];this.des.text=e.name,this.buff.text=t.desc,this.mc.once(egret.Event.CHANGE,this.updateHeight,this),t.state?(this.mc.playFile(RES_DIR_MONSTER+(e.avatar+"_4s"),-1),this.title.visible=!0):(this.mc.playFile(RES_DIR_MONSTER+(e.avatar+"_4d"),1,null,!1),this.title.visible=!1)},e.prototype.updateHeight=function(){this.mc.y=this.mc.height},e.prototype.clear=function(){this.mc.stop(),this.mc.removeEventListener(egret.Event.CHANGE,this.updateHeight,this),DisplayUtils.removeFromParent(this)},e}(BaseView);__reflect(GuildSoulsBossPanel.prototype,"GuildSoulsBossPanel"),window.GuildSoulsBossPanel=GuildSoulsBossPanel;var GuildSoulsChooseWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildSoulsLandChooseSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(t[0])},e.prototype.update=function(t){this.fbscene=t.scene,this.head.source="monhead"+GlobalConfig.MonstersConfig[t.monsterId].head+"_png",this.des.text=""+GlobalConfig.MonstersConfig[t.monsterId].name,this.desc.text=t.desc,this.fight.text="推荐战力："+t.cfg.power},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(e);break;case this.eB:if(GuildSoulsLandCT.ins().challenge<=0)return void TipsCT.ins().showTips("次数不足");GuildSoulsLandCT.ins().sendInterPass(GuildSoulsLandCT.ins().cur,this.fbscene),ViewManager.ins().close(this),ViewManager.ins().close(GuildSkillWin),ViewManager.ins().close(GuildMap)}},e}(BaseEuiView);__reflect(GuildSoulsChooseWin.prototype,"GuildSoulsChooseWin"),window.GuildSoulsChooseWin=GuildSoulsChooseWin,ViewManager.ins().reg(GuildSoulsChooseWin,LayerManager.UI_Popup);var GuildSoulsLandPanel=function(t){function e(){var e=t.call(this)||this;return e.bossPanels=[],e.skinName="GuildSoulsLandSkin",e.addTouchEvent(e,e.onClick),e.eBgImg.once(egret.Event.COMPLETE,e.init,e),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.has(this.timeCB,this)||Timer.start(1e3,0,this.timeCB,this),this.observe(GuildSoulsLandCT.ins().postInit,this.update),this.observe(GuildSoulsLandCT.ins().poststate,this.updateMc),this.observe(GuildSoulsLandCT.ins().postupdatePass,this.updateAward),this.eScroller.addEventListener(egret.Event.RESIZE,this.init,this),this.timeCB(),this.update(),egret.callLater(this.init,this),this.init()},e.prototype.init=function(){this.eScroller.viewport.scrollH=((this.eBgImg.width||1063)-this.eScroller.width)/2,this.eScroller.viewport.scrollV=((this.eBgImg.height||1110)-this.eScroller.height)/1.5},e.prototype.update=function(){this.updateMc(),this.updateAward()},e.prototype.updateAward=function(){var t=GuildSoulsLandCT.ins().cur;this._isMax=!1,t>Object.keys(GlobalConfig.GuildAllSoulLandBossInfoConfig).length&&(this._isMax=!0,t--);var e=GlobalConfig.GuildAllSoulLandBossInfoConfig[t];this.des.source=e.pic,this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect),this._collect.source=e.passAwards},e.prototype.updateMc=function(){this.clearBossMCs();var t=GuildSoulsLandCT.ins();for(var e in t.monsterInfos){var i=t.monsterInfos[e],s=void 0;this.bossPanels[e]||(this.bossPanels[e]=new GuildSoulsBossPanel),s=this.bossPanels[e],this.bossPanels[e].setData(i),s.x=i.x,s.y=i.y,this.eMCGroup.addChild(s)}},e.prototype.clearBossMCs=function(){for(var t in this.bossPanels){var e=this.bossPanels[t];e.clear()}},e.prototype.timeCB=function(){var t=GuildSoulsLandCT.ins();if(1==t.open&&t.openTime>0){var e=t.openTime+6048e5;GameServer.serverTime==e?this.times.text="已结算":t.isAllPass()?this.times.text="已通关最高关卡":this.times.text="剩余挑战次数："+t.challenge;var i=e-GameServer.serverTime;this.sTime="剩余挑战时间："+DateUtils.getFormatBySecond(Math.round(i/1e3),DateUtils.TIME_FORMAT_5,4)}else if(0==t.open&&t.openTime>0){var i=t.openTime-GameServer.serverTime;this.sTime="距离下期："+DateUtils.getFormatBySecond(Math.round(i/1e3),DateUtils.TIME_FORMAT_5,4),this.times.text="已结算"}else this.sTime="",this.times.text=""},e.prototype.onClick=function(t){if(t.target instanceof GuildSoulsBossPanel)if(GuildSoulsLandCT.ins().open)if(t.target.cfg.state){if(GuildSoulsLandCT.ins().challenge>0)return void ViewManager.ins().open(GuildSoulsChooseWin,t.target.cfg);TipsCT.ins().showTips("次数不足，明日或公会通关恢复次数")}else TipsCT.ins().showTips("怪物已死亡");else TipsCT.ins().showTips("已结算，期待下期比赛");else switch(t.target){case this.reward:ViewManager.ins().open(GuildSoulsLandRewardsWin)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this),this.eScroller.removeEventListener(egret.Event.RESIZE,this.init,this)},e}(BaseView);__reflect(GuildSoulsLandPanel.prototype,"GuildSoulsLandPanel"),window.GuildSoulsLandPanel=GuildSoulsLandPanel;var GuildSoulsLandRewardsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildSoulsLandRewardsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildSoulsLandRewardsWin.prototype,"GuildSoulsLandRewardsWin"),window.GuildSoulsLandRewardsWin=GuildSoulsLandRewardsWin,ViewManager.ins().reg(GuildSoulsLandRewardsWin,LayerManager.UI_Popup);
var IronShopCT=function(t){function e(){var e=t.call(this)||this;return e.cost=0,e.surplus=0,e.getNum=0,e.sysId=PackageID.Shop,e.regNetMsg(12,e.postInit),e.regNetMsg(13,e.postCost),e.regNetMsg(14,e.postIronItem),e.regNetMsg(15,e.postIronInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.isOpen=t.readByte(),this.cost=t.readInt(),this.awardNum=t.readByte(),this.surplus=t.readInt(),this.getNum=t.readInt();var e=t.readInt();this.ironData=new Object;for(var i=0;e>i;i++)this.ironData[t.readInt()]=t.readInt()},e.prototype.postCost=function(t){this.cost=t.readInt()},e.prototype.postIronItem=function(t){this.surplus=t.readInt(),this.getNum=t.readInt(),this.awardNum=t.readByte()},e.prototype.postIronInfo=function(t){var e=t.readInt();this.ironData[e]=t.readInt(),this.surplus=t.readInt()},e.prototype.sendAward=function(t){var e=this.getBytes(14);e.writeByte(t),this.sendToServer(e)},e.prototype.sendBuyIron=function(t,e){var i=this.getBytes(15);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.checkOpen=function(){var t=GlobalConfig.IronStore[0];return ZsCT.ins().lv<t.openzs?!1:!(GameServer.serverOpenDay<t.openday-1)},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postCost",null),__decorate([post()],e.prototype,"postIronItem",null),__decorate([post()],e.prototype,"postIronInfo",null),e}(BaseSystem);__reflect(IronShopCT.prototype,"IronShopCT"),System.IronShopCT=function(){return IronShopCT.ins()},window.IronShopCT=IronShopCT;var IronShopRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,IronShopCT.ins().postInit,IronShopCT.ins().postCost,IronShopCT.ins().postIronItem),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){for(var t=IronShopCT.ins(),e=GlobalConfig.IronStore,i=1;i<Object.keys(e).length;i++)if(!(t.awardNum>i-1)&&t.cost>=e[i].ybCostLevel)return this.redPoint=!0;this.redPoint=!1},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(IronShopRedPoint.prototype,"IronShopRedPoint"),System.IronShopRedPoint=function(){return IronShopRedPoint.ins()},window.IronShopRedPoint=IronShopRedPoint;var IronInfoItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XuanJinInfor",e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){var t=GlobalConfig.IronStore[0].itemId;this.icon0.source=this.icon1.source=GlobalConfig.ItemConfig[t].icon+"_png";var e=IronShopCT.ins();this.sNum=""+e.surplus,this.sNum1=""+e.getNum},e}(BaseView);__reflect(IronInfoItem.prototype,"IronInfoItem"),window.IronInfoItem=IronInfoItem;var IronShopItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="XuanJinRewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.index){var t=IronShopCT.ins();this.desc.text=this.data.maxBuy?"限购"+(this.data.maxBuy-t.ironData[this.data.index])+"次":"不限购";var e=t.getNum<this.data.weekIron;this.limit.visible=e,this.limit.text="本周获得\n"+this.data.weekIron+"\n玄金",this.item.data=this.data.goods[0],this.item.filters=e?FilterUtil.ARRAY_GRAY_FILTER:null,this.money.text=this.data.cost+"";var i=GlobalConfig.IronStore[0].itemId;this.icon.source=GlobalConfig.ItemConfig[i].icon+"_png"}},e}(BaseItemRender);__reflect(IronShopItem.prototype,"IronShopItem"),window.IronShopItem=IronShopItem;var IronShopPanel=function(t){function e(){var e=t.call(this)||this;e.isMove=!1,e.skinName="XuanJinReward",e.addTouchEvent(e,e.onClick),e.goodsOverView.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.goodsOverView.text+"</u>"),e.ins=IronShopCT.ins(),e.cfg=GlobalConfig.IronStore,e.eScoller.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.isMove=!1},e),e.eScoller.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.isMove=!0},e);for(var i=0;i<Object.keys(e.cfg).length-1;i++)e.addTouchEvent(e["isget"+i],e.onGiftClick),e["lilian"+i].touchEnabled=!1,e["gift"+i].isShowName(!1);return e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postCost,this.update),this.observe(this.ins.postIronItem,this.update),this.observe(this.ins.postIronInfo,this.update),this.update()},e.prototype.updateItems=function(){this.info.update()},e.prototype.onGiftClick=function(t){for(var e=0;e<Object.keys(this.cfg).length-1;e++)if(t.currentTarget==this["isget"+e]){this.ins.sendAward(e+1);break}},e.prototype.update=function(){this.updateItems(),this.showList(),this.sNum=""+this.ins.cost;for(var t=0;t<Object.keys(this.cfg).length-1;t++){this["gift"+t].data={id:this.cfg[0].itemId,type:1,count:this.cfg[t+1].ironCount};var e=this.cfg[t+1].ybCostLevel;if(this["lilian"+t].text="消费元宝"+e,this["bar"+t].maximum=100,this["lilian"+t].visible=this["gift"+t].getImg.touchEnabled=!1,this.ins.awardNum>t)this["bar"+t].value=100,this["gift"+t].getImg.visible=!0,this["gift"+t].redPoint.visible=this["isget"+t].touchEnabled=!1;else if(this.ins.cost>=e)this["bar"+t].value=100,this["gift"+t].redPoint.visible=this["isget"+t].touchEnabled=!0;else{var i=this.cfg[t].ybCostLevel,s=this.ins.cost-i,n=e-i;this["bar"+t].value=Math.floor(s/n*100),this["gift"+t].redPoint.visible=this["isget"+t].touchEnabled=!1,this["lilian"+t].visible=!0}}},e.prototype.showList=function(){var t=[],e=GlobalConfig.IronStoreItem;for(var i in e)GameServer.serverOpenDay+1<e[i].openday||t.push(e[i]);var s=this.elist.dataProvider;s?s.replaceAll(t):this.elist.dataProvider=new eui.ArrayCollection(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(t){if(t.target.parent instanceof IronShopItem&&!this.isMove){var e=t.target.parent.data.index,i=GlobalConfig.IronStoreItem[e];return this.ins.surplus<i.cost||this.ins.getNum<i.weekIron?void TipsCT.ins().showTips("本周获得玄金不足"):void(GlobalConfig.IronStoreItem[e].maxBuy&&GlobalConfig.IronStoreItem[e].maxBuy<=this.ins.ironData[e]?TipsCT.ins().showTips("本周购买已达到上限"):this.ins.sendBuyIron(e,1))}switch(t.target){case this.goodsOverView:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[59].text)}},e}(BaseView);__reflect(IronShopPanel.prototype,"IronShopPanel"),window.IronShopPanel=IronShopPanel;var KFBattleRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint1=0,e.redPoint2=0,e.redPoint=0,e.associated(e.postRedPoint2,KFBossRedpoint.ins().postRedPoint),e.associated(e.postRedPoint,e.postRedPoint2),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint2=function(){return this.redPoint2=KFBossRedpoint.ins().redpoint,this.redPoint2},e.prototype.postRedPoint=function(){return this.redPoint=this.redPoint1+this.redPoint2,this.redPoint},__decorate([post(),post()],e.prototype,"postRedPoint2",null),__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(KFBattleRedPoint.prototype,"KFBattleRedPoint"),System.KFBattleRedPoint=function(){return KFBattleRedPoint.ins()},window.KFBattleRedPoint=KFBattleRedPoint;var KFBossShowWin2=function(t){function e(){var e=t.call(this)||this;return e._sn_="KFBossShowSkin2",e}return __extends(e,t),e.prototype.skinComplete=function(){this.boss.touchEnabled=!1,this.boss.touchChildren=!1,this.eItems=[this.eItem0,this.eItem1,this.eItem2,this.eItem3]},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.addChangingEvent(this.eTab,this.checkIsOpen),this.addChangeEvent(this.eTab,this.onClickTab);var i=[],s=0;for(var n in t[0])i.push(t[0][n]),this.checkOpen(t[0][n])&&(s=+n);this.eTab.dataProvider=new eui.ArrayCollection(i),this.eTab.selectedIndex=s,this.eTab.validateNow();for(var n=0;n<i.length;n++){var o=this.eTab.getChildAt(n);o.eLab.source="KFshenwei_name"+(n+1)+"_"+(this.eTab.selectedIndex==n?1:2)+"_png"}this.fbId=this.eTab.selectedItem,this.dp=GlobalConfig.CrossBossConfig[this.fbId],this.updateView()},e.prototype.checkIsOpen=function(t){var e=t.target;return KFBossSys.ins().fbInfo[e.selectedItem]&&this.checkOpen(e.selectedItem,!0)?void 0:void t.preventDefault()},e.prototype.onClickTab=function(){if(this.fbId!=this.eTab.selectedItem){this.fbId=this.eTab.selectedItem;for(var t=0;t<this.eTab.dataProvider.length;t++){var e=this.eTab.getChildAt(t);e.eLab.source="KFshenwei_name"+(t+1)+"_"+(this.eTab.selectedIndex==t?1:2)+"_png"}this.dp=GlobalConfig.CrossBossConfig[this.fbId],this.updateView()}},e.prototype.updateView=function(){this.eBg.source="KFshenwei_bg"+(this.eTab.selectedIndex+1)+"_jpg",this.eBossTimes.text=KFBossSys.ins().bossTimes+"",this.eHelpTimes.text=KFBossSys.ins().helpNum[KFBossType.KF-1]+"",this.eName.source="KFshenwei_name"+(this.eTab.selectedIndex+1)+"_0_png";for(var t=this.dp.belongRewardshow,e=KFBossSys.ins().getBossShowAward(t),i=0;i<this.eItems.length;i++)this.eItems[i].data=e[i];this.bossMc||(this.bossMc=ObjectPool.pop("MovieClip"),this.bossMc.scaleX=-1,this.bossMc.scaleY=1,this.boss.addChild(this.bossMc));var s=this.dp.bossId,n=GlobalConfig.MonstersConfig[s];this.bossMc.playFile(RES_DIR_MONSTER+(n.avatar+"_4s"),-1),this.updateItem()},e.prototype.updateItem=function(){var t=GlobalConfig.CrossBossBase.swyscroll,e=BagCT.ins().getBagItemById(t);this.eJIcon.source=GlobalConfig.ItemConfig[t].icon+"_png",this.eJCount.text=e?e.count+"":"0"},e.prototype.checkOpen=function(t,e){void 0===e&&(e=!1);var i=GlobalConfig.CrossBossConfig[t],s="";if((ZsCT.ins().lv<i.levelLimit[0]/1e3||ZsCT.ins().lv>i.levelLimit[1]/1e3)&&(s=i.levelLimit[0]/1e3+"转开启"),""==s){var n=!1,o=0;for(var a in i.openBossList)GameServer.serverMaxOpenDay+1>=+a?n=!0:o=0>=o?+a:Math.min(o,+a);s=n?"":"开服"+o+"天开启"}return e&&""!=s&&TipsCT.ins().showTips(s),""==s},e.prototype.onTouch=function(t){var e=this;switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:if(!this.checkOpen(this.fbId,!0))return;if(!KfArenaSys.ins().checkIsMatching())return;var i=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(i>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+i+"秒后可以进入！");if(ZsCT.ins().lv<this.dp.levelLimit[0]/1e3||ZsCT.ins().lv>this.dp.levelLimit[1]/1e3)return void TipsCT.ins().showTips("|C:0xf3311e&T:需要转生等级到达"+(this.dp.levelLimit[0]/1e3>>0)+"转！");var s=BagCT.ins().getBagItemById(GlobalConfig.CrossBossBase.swyscroll),n=s?s.count:0,o=KFBossSys.ins().bossTimes+n;o>0?RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,o,function(){KFBossSys.ins().sendEnter(e.fbId),KFBossSys.ins().kfBossCfgID=e.fbId}):(KFBossSys.ins().sendEnter(this.fbId),KFBossSys.ins().kfBossCfgID=this.fbId)}},e.prototype.enterFrame=function(){var t=KFBossSys.ins().fbInfo[this.fbId],e=(t.bossRefTimer-egret.getTimer())/1e3>>0;this.sTime=e>0?"复活时间 "+DateUtils.getFormatBySecond(e):""},e}(BaseEuiView);__reflect(KFBossShowWin2.prototype,"KFBossShowWin2"),window.KFBossShowWin2=KFBossShowWin2,ViewManager.ins().reg(KFBossShowWin2,LayerManager.UI_Popup);var KFServerSys=function(t){function e(){var e=t.call(this)||this;return e.isLinkingKF=!1,e.curServerType=ServerType.bsCommSrv,e.sysId=PackageID.Login,e.regNetMsg(9,e.doSwitchServer),e.observe(RoleMgr.ins().postEnterGame,e.onEnterGame),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.linkingKFState=function(t){this.isLinkingKF=t,t?(ViewManager.ins().closeAll(),ViewManager.ins().open(ServerSwitchIngWin)):ServerSwitchIngWin.redClose()},e.prototype.doSwitchServer=function(t){this.kfSrvid=t.readInt(),this.kfIp=t.readString(),this.kfPort=t.readInt(),this.kfLoginKey=t.readString(),this.curServerType=t.readInt(),console.log("255-9  接收连接跨服服务器！ip:"+this.kfIp+" port:"+this.kfPort+"type:"+this.curServerType),this.linkingKFState(!0),Timer.start(2e3,1,this.connectKFServer,this)},e.prototype.sendKFLogin=function(){var t=this.getBytes(9);t.writeInt(Actor.actorID),t.writeString(this.kfLoginKey),this.sendToServer(t)},Object.defineProperty(e.prototype,"isKF",{get:function(){return this.isKFServ||KFBossSys.ins().isKFBossBattle||KfArenaSys.ins().isKFArena||DevildomSys.ins().isDevildomBattle||GameMap.fbType==FbCT.FB_TYPE_37BOSS},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isKFServ",{get:function(){return this.curServerType>ServerType.bsCommSrv},enumerable:!0,configurable:!0}),e.prototype.connectKFServer=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return Socket.ins().close(),Socket.ins().newSocket(),Socket.ins().getSocket().connected?[3,4]:(console.log("kf connect to "+this.kfIp+" ,port: "+this.kfPort),console.log("重新连接跨服服务器！ip:"+this.kfIp+" port:"+this.kfPort),this.curServerType!=ServerType.bsCommSrv?[3,1]:(Socket.ins().reconnect(),[3,3]));case 1:return[4,Socket.ins().connect(this.kfIp)];case 2:t.sent(),Socket.ins().setDispatch(!0),this.sendKFLogin(),t.label=3;case 3:return[3,5];case 4:console.log("开始登陆跨服服务器！ipgameso:"+this.kfIp+" port:"+this.kfPort),this.sendKFLogin(),t.label=5;case 5:return[2]}})})},e.prototype.closeSocket=function(){this.curServerType=ServerType.bsCommSrv,this.kfSrvid=LocationProperty.srvid},e.prototype.checkIsKFBattle=function(t){return this.isKF&&t&&TipsCT.ins().showTips(t),this.isKF},e.prototype.onEnterGame=function(){this.linkingKFState(!1)},e}(BaseSystem);__reflect(KFServerSys.prototype,"KFServerSys");var ServerType;!function(t){t[t.bsCommSrv=0]="bsCommSrv",t[t.bsBattleSrv=1]="bsBattleSrv",t[t.bsMainBattleSrv=2]="bsMainBattleSrv",t[t.bsLianFuSrv=3]="bsLianFuSrv"}(ServerType||(ServerType={})),window.KFServerSys=KFServerSys;var KFData=function(){function t(){}return t}();__reflect(KFData.prototype,"KFData");var KFDropRecordData=function(){function t(t){this.type=t.readShort(),this.type==KFDropType.KF_BOSS?this.kfBossData(t):this.type==KFDropType.DEVILDOM&&this.devildomData(t)}return t.prototype.kfBossData=function(t){this.time=t.readInt(),this.roleId=t.readInt(),this.servId=t.readInt(),this.nick=t.readString(),this.sceneName=t.readString(),this.bossName=t.readString(),this.goodsId=t.readInt(),this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND),this.isBest=!1},t.prototype.devildomData=function(t){this.time=t.readInt(),this.servId=t.readInt(),this.guildName=t.readString(),this.bossName=t.readString(),this.goodsId=t.readInt(),this.time=Math.floor(DateUtils.formatMiniDateTime(this.time)/DateUtils.MS_PER_SECOND)},t}();__reflect(KFDropRecordData.prototype,"KFDropRecordData"),window.KFDropRecordData=KFDropRecordData;var KFDropType;!function(t){t[t.KF_BOSS=1]="KF_BOSS",t[t.DEVILDOM=2]="DEVILDOM"}(KFDropType||(KFDropType={}));var DevildomRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=0,e.redPoints=[],e.bossRedPoint=!1,e.associated(e.postRedPoint,DevildomSys.ins().postBossInfo,DevildomSys.ins().postInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){this.redPoint=0;var t=DevildomSys.ins();if(t.isOpen()){var e=GlobalConfig.DevilBossConfig;for(var i in t.killedState)this.redPoints[i]=!(e[i].isBoss||t.killedState[i]||t.historyId&&t.historyId!=i);this.bossRedPoint=!t.bossState&&!!t.killedState&&!t.killedState[t.bossId],this.redPoint=this.redPoints.indexOf(!0)>-1?1:0}},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(DevildomRedPoint.prototype,"DevildomRedPoint"),System.DevildomRedPoint=function(){return DevildomRedPoint.ins()},window.DevildomRedPoint=DevildomRedPoint;var DevildomSys=function(t){function e(){var e=t.call(this)||this;return e.refTime=[],e.dropRecordDataList=[],e.isInit=!1,e.sysId=PackageID.Devildom,e.regNetMsg(1,e.postBossInfo),e.regNetMsg(2,e.postAscriptionChange),e.regNetMsg(3,e.postRevive),e.regNetMsg(7,e.doResult),e.regNetMsg(8,e.postInfo),e.regNetMsg(9,e.postHudun),e.observe(GameLogic.ins().postEnterMap,function(){e.isDevildomBattle?e.postEnterFb():e.lastDevildom&&e.postQuiKFb()}),e.observe(BossCT.ins().postBossAppear,function(){e.isDevildomBattle&&ViewManager.ins().open(BossBelongPanel)}),e}return __extends(e,t),Object.defineProperty(e.prototype,"isDevildomBattle",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_DEVILDOM_BOSS},enumerable:!0,configurable:!0}),e.prototype.isDevildomBOss=function(t){var e=GlobalConfig.DevilBossConfig;if(GameMap.fbType!=FbCT.FB_TYPE_DEVILDOM_BOSS)return!1;for(var i in e){var s=e[i].openBossList;for(var n in s)if(s[n]==t)return 1==e[i].isBoss}return!1},e.prototype.postBossInfo=function(t){var e=t.readShort();this.killedState=[];for(var i=[],s=0;e>s;s++){var n=t.readShort(),o=t.readInt(),a=t.readBoolean();this.killedState[n]=a;var r=t.readByte(),l=t.readString(),h=t.readString();r?(this.guildName=l,this.killer=h,this.bossId=n):i[n]=o}this.historyId&&this.refTime[this.historyId]&&i[this.historyId]!=this.refTime[this.historyId]&&(this.historyId=0),this.refTime=i.concat(),this.bossState=t.readByte(),this.openTime=t.readInt(),Timer.has(this.setRepeat,this)||Timer.start(1e3,this.openTime+1,this.setRepeat,this)},e.prototype.setRepeat=function(){this.openTime--,this.openTime<=GlobalConfig.DevilBossBase.countdown&&this.openTime>=0&&this.postShowIcon()},e.prototype.postShowIcon=function(){this.isInit?this.isInit&&this.openTime<1&&(this.isInit=!1):this.isInit=!0},e.prototype.postAscriptionChange=function(t){var e=t.readDouble(),i=t.readDouble(),s="";if(e>0){var n=EntityManager.ins().getMasterList(e);n&&n[0]&&n[0].infoModel&&(s=n[0].infoModel.name)}BossCT.ins().postBelongChange(i,e,s)},e.prototype.postRevive=function(t){var e=t.readInt(),i=t.readDouble();if(e>0)ViewManager.ins().open(DevildomReliveWin,e,i);else if(ViewManager.ins().close(DevildomReliveWin),KFServerSys.ins().isKF){var s=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(s)}},e.prototype.doResult=function(t){for(var e=t.readString(),i=t.readString(),s=t.readDouble(),n=t.readBoolean(),o=t.readShort(),a=[],r=0;o>r;r++){var l=new RewardData;l.type=t.readInt(),l.id=t.readInt(),l.count=t.readInt(),a.push(l)}o=t.readShort();for(var h=[],r=0;o>r;r++){var p=t.readInt();h.push(GlobalConfig.AuctionItem[p].item)}i&&""!=i&&(e="|C:0x2eb6ff&T:【"+i+"】|\n"+e),ViewManager.ins().open(DevildomResultWin,s,e,n,h,a)},e.prototype.postInfo=function(t){var e=t.readShort();GlobalConfig.DevilBossConfig[e]&&!GlobalConfig.DevilBossConfig[e].isBoss&&(this.historyId=e);var i=t.readShort();this.enterCD=1e3*i+egret.getTimer()},e.prototype.postHudun=function(t){t&&(this.hudun=t.readShort(),this.hudunMax=t.readShort()),this.hudun>0&&(this.hudun--,Timer.start(1e3,1,this.postHudun,this))},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(4)},e.prototype.sendEnter=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.postEnterFb=function(){this.lastDevildom=!0},e.prototype.postQuiKFb=function(){this.lastDevildom=!1,ViewManager.ins().close(BossBelongPanel)},e.prototype.isOpen=function(t){void 0===t&&(t=!1);var e="",i=GlobalConfig.DevilBossBase;return Actor.level<i.openLevel&&(e=i.openLevel+"级可参与魔界入侵"),GameServer.serverOpenDay+1<i.openDay&&(e="开服"+i.openDay+"天后可参与魔界入侵"),(i.LfState?GameServer.isOpenLF:1)&&this.isHfTerm()||(e="未满足合服开启条件"),t&&""!=e&&TipsCT.ins().showTips(e),""==e},e.prototype.isHfTerm=function(){var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime)+GlobalConfig.DevilBossBase.hefuTimeLimit*DateUtils.MS_PER_DAY;return GameServer.serverTime-t>0},__decorate([post()],e.prototype,"postBossInfo",null),__decorate([post()],e.prototype,"postShowIcon",null),__decorate([post()],e.prototype,"postAscriptionChange",null),__decorate([post()],e.prototype,"postRevive",null),__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postHudun",null),__decorate([post()],e.prototype,"postEnterFb",null),__decorate([post()],e.prototype,"postQuiKFb",null),e}(BaseSystem);__reflect(DevildomSys.prototype,"DevildomSys"),System.DevildomSys=function(){return DevildomSys.ins()},window.DevildomSys=DevildomSys;var DevildomBossTab=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=DevildomSys.ins();this.itemIcon.source="invasion_boss_head"+(this.data-1),this.nameLabel.text=GlobalConfig.DevilBossConfig[this.data].bossName,this.redPoint.visible=DevildomRedPoint.ins().redPoints[this.data],this.state.visible=t.killedState[this.data]}},e}(BaseItemRender);__reflect(DevildomBossTab.prototype,"DevildomBossTab"),window.DevildomBossTab=DevildomBossTab;var DevildomBossModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.getCurBossIdByIndex=function(t){var e=GlobalConfig.DevilBossConfig[t].openBossList;return e[0]||e[1]},e.prototype.getCurFbIndex=function(){var t=DevildomSys.ins();if(t.historyId)return t.historyId-1;var e=[];for(var i in t.killedState)i==t.bossId||t.killedState[i]||e.push(i);return e.length>0?e[MathUtils.limit(0,e.length)>>0]-1:MathUtils.limit(0,3)>>0},e}(BaseClass);__reflect(DevildomBossModel.prototype,"DevildomBossModel"),window.DevildomBossModel=DevildomBossModel;var DevildomBelongAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionBelongSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleReward0.itemRenderer=ItemBase,this.belongReward0.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.BG,this.onCloseWin),this.addTouchEvent(this.tipGroup1,this.onCloseWin),this.belongReward0.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.belongAwards)),this.saleReward0.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.belongSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomBelongAwardWin.prototype,"DevildomBelongAwardWin"),window.DevildomBelongAwardWin=DevildomBelongAwardWin,ViewManager.ins().reg(DevildomBelongAwardWin,LayerManager.UI_Popup);var DevildomBossAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionJiangLiTishiSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.belongReward1.itemRenderer=ItemBase,this.saleReward1.itemRenderer=ItemBase,this.belongReward0.itemRenderer=ItemBase,this.saleReward0.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onCloseWin),this.addTouchEvent(this.giveUp,this.onCloseWin),this.belongReward1.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.belongAwards)),this.saleReward1.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.belongSaleAwards)),this.belongReward0.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.partAwards)),this.saleReward0.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.partSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomBossAwardWin.prototype,"DevildomBossAwardWin"),window.DevildomBossAwardWin=DevildomBossAwardWin,ViewManager.ins().reg(DevildomBossAwardWin,LayerManager.UI_Popup);var DevildomPartAwardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFInvasionPartSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleReward.itemRenderer=ItemBase,this.belongReward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.BG,this.onCloseWin),this.addTouchEvent(this.tipGroup0,this.onCloseWin),this.belongReward.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.partAwards)),this.saleReward.dataProvider=new eui.ArrayCollection(KFBossSys.ins().getBossShowAward(GlobalConfig.DevilBossBase.partSaleAwards))},e.prototype.onCloseWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DevildomPartAwardWin.prototype,"DevildomPartAwardWin"),window.DevildomPartAwardWin=DevildomPartAwardWin,ViewManager.ins().reg(DevildomPartAwardWin,LayerManager.UI_Popup);var DevildomReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onRelive),this.addTouchEvent(this.exitBtn,this.onTap),this.setWin(t[0],t[1])},e.prototype.setWin=function(t,e){if(e>0){var i=EntityManager.ins().getEntityByHandle(e),s="";if(i){var n=EntityManager.ins().getEntityByHandle(i.infoModel.masterHandle);s=i instanceof CharRole?i.infoModel.name:i.infoModel.masterHandle&&n?""+n.infoModel.name:"Boss"+i.infoModel.name}this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+s+"|击败"),this.alive.visible=!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1")}this.reliveBtn.label=GlobalConfig.DevilBossBase.rebornCost+"原地复活",this.reliveTimesTxt.text=t+"秒",this.remainM=t,Timer.start(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒"},e.prototype.overTime=function(){ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.exitBtn:FbCT.ins().sendExitFb()}},e.prototype.onRelive=function(t){return this.aliveNum?void DevildomSys.ins().sendClearReliveCD():void(GlobalFun.checkMoney(GlobalConfig.DevilBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活")&&DevildomSys.ins().sendClearReliveCD())},e}(BaseEuiView);__reflect(DevildomReliveWin.prototype,"DevildomReliveWin"),window.DevildomReliveWin=DevildomReliveWin,ViewManager.ins().reg(DevildomReliveWin,LayerManager.UI_Popup);var DevildomResultWin=function(t){function e(){var e=t.call(this)||this;return e.quitTime=30,e.skinName="KFInvasionResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.saleList.itemRenderer=ItemBase,this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onCloseWin);var i=EntityManager.ins().getEntityByHandle(t[0]);if(i){var s=i.infoModel;this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(""+t[1]),this.eFace.source="yuanhead"+s.job+s.sex}else this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(""+t[1]);t[2]||(this.rewardLabel.text="我的参与奖："),this.eRewardTitle.source=t[2]?"win_guishu_png":"win_canyu_png";var n=t[3];this.saleList.dataProvider=new eui.ArrayCollection(n),0==n.length&&(this.saleLabel.text="行会拍卖品：无");var o=t[4];this.rewardList.dataProvider=new eui.ArrayCollection(o),Timer.start(1e3,this.quitTime+1,this.onTimer,this),this.onTimer()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.onCloseWin=function(){ViewManager.ins().close(this),FbCT.ins().sendExitFb()},e.prototype.onTimer=function(){this.closeBtn.label="确定("+--this.quitTime+")",this.quitTime<=0&&this.onCloseWin()},e}(BaseEuiView);__reflect(DevildomResultWin.prototype,"DevildomResultWin"),window.DevildomResultWin=DevildomResultWin,ViewManager.ins().reg(DevildomResultWin,LayerManager.UI_Popup);var DevildomWin=function(t){function e(){var e=t.call(this)||this;return e.MAX_LEN=4,e.TAB_W=92,e.skinName="KFInvasionSkin",e.menuList.itemRenderer=DevildomBossTab,e.refreshTime.text=GlobalConfig.DevilBossBase.startTime[0]+":"+GlobalConfig.DevilBossBase.startTime[1],e.bossBody=new MovieClip,e.bossBody.x=0,e.bossBody.y=0,e.bossGroup.addChild(e.bossBody),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.challengeBtn,this.onTouch),this.addTouchEvent(this.belongBtn,this.onTouch),this.addTouchEvent(this.partBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.addChangeEvent(this.menuList,this.onChoose),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.dataSys=DevildomSys.ins();var i=isNaN(t[0])?0:t[0];this.menuList.selectedIndex=i,GlobalConfig.DevilBossConfig[i+1].isBoss||this.selectBoss(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-this.MAX_LEN)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.menuList.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.onTouch=function(t){var e=this;switch(t.target){case this.challengeBtn:if(!KfArenaSys.ins().checkIsMatching())return;var i=(this.dataSys.enterCD-egret.getTimer())/1e3>>0;if(i>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+i+"秒后可以进入！");var s=GlobalConfig.DevilBossConfig[this.menuList.selectedIndex+1],n=s.levelLimit/1e3>>0;if(n>ZsCT.ins().lv)return void TipsCT.ins().showTips("|C:0xf3311e&T:转生等级到达"+n+"级可进去！");var o=s.levelLimit%1e3;if(o>Actor.level)return void TipsCT.ins().showTips("|C:0xf3311e&T:人物等级到达"+o+"级可进去！");if(DevildomSys.ins().historyId){if(DevildomSys.ins().historyId!=this.menuList.selectedIndex+1)return void TipsCT.ins().showTips("|C:0xf3311e&T:您已进入"+GlobalConfig.DevilBossConfig[DevildomSys.ins().historyId].bossName+"地图，无法再进入此魔君地图！");DevildomSys.ins().sendEnter(this.menuList.selectedIndex+1)}else WarnWin.show("魔君刷新后，只可进入其中一位魔君的地图且不可改变，是否进入？",function(){e.dataSys.sendEnter(e.menuList.selectedIndex+1)},this);break;case this.closeBtn:ViewManager.ins().close(this);break;case this.belongBtn:ViewManager.ins().open(DevildomBelongAwardWin);break;case this.partBtn:ViewManager.ins().open(DevildomPartAwardWin);break;case this.leftBtn:var a=this.TAB_W*this.MAX_LEN,r=this.menuList.scrollH-a;r=Math.round(r/this.TAB_W)*this.TAB_W,0>r&&(r=0),this.menuList.scrollH=r;break;case this.rightBtn:a=this.TAB_W*this.MAX_LEN,r=this.menuList.scrollH+a,r=Math.round(r/this.TAB_W)*this.TAB_W,r>this.menuList.contentWidth-this.menuScroller.width&&(r=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=r}},e.prototype.onChoose=function(t){this.selectBoss(this.menuList.selectedIndex)},e.prototype.selectBoss=function(t){var e=[],i=GlobalConfig.DevilBossConfig;if(i){for(var s in i)i[s].isBoss||e.push(i[s].id);this.menuList.dataProvider=new eui.ArrayCollection(e);var n=this.menuList.selectedIndex+1,o=DevildomBossModel.ins().getCurBossIdByIndex(n),a=GlobalConfig.MonstersConfig[o],r=a.avatar+"_3s";this.bossBody.playFile(RES_DIR_MONSTER+r,-1),this.bossName.source="invasion_boss_name"+t,this.closetext.visible=!DevildomSys.ins().isHfTerm(),this.challengeBtn.enabled=DevildomSys.ins().isHfTerm()&&this.dataSys.killedState.length>0&&!this.dataSys.killedState[n];var l=e.length;this.leftGroup.visible=l>this.MAX_LEN,this.rightGroup.visible=l>this.MAX_LEN}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=DevildomSys.ins().isOpen();return GameServer.isOpenLF?DevildomSys.ins().isHfTerm()?GameServer.serverOpenDay+1<GlobalConfig.DevilBossBase.openDay?TipsCT.ins().showTips("|C:0xf3311e&T:开服"+GlobalConfig.DevilBossBase.openDay+"天后可参与魔界入侵玩法"):Actor.level<GlobalConfig.DevilBossBase.openLevel&&TipsCT.ins().showTips("|C:0xf3311e&T:"+GlobalConfig.DevilBossBase.openLevel+"级开启"):TipsCT.ins().showTips("|C:0xf3311e&T:合服期间不可进入"):TipsCT.ins().showTips("|C:0xf3311e&T:开启跨服后可参与魔界入侵玩法"),i
},e}(BaseView);__reflect(DevildomWin.prototype,"DevildomWin"),window.DevildomWin=DevildomWin;var KfArenaRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redpoint=0,e.redpoint_1=0,e.redpoint_2=0,e.joinState=0,e.JoinRedPoint=[],e.redpoint_3=0,e.associated(e.postRedPoint,e.postRedPoint_1,e.postRedPoint_2),e.associated(e.postRedPoint_1,KfArenaSys.ins().postOpenKfArena,KfArenaSys.ins().postPlayerInfo),e.associated(e.postRedPoint_2,KfArenaSys.ins().postOpenKfArena,KfArenaSys.ins().postJoinRewards),e}return __extends(e,t),e.prototype.postRedPoint=function(){return this.redpoint=this.redpoint_1+this.redpoint_2+this.redpoint_3,this.redpoint},e.prototype.postRedPoint_1=function(){return this.redpoint_1=0,KfArenaSys.ins().isOpen()?(this.redpoint_1=KfArenaSys.ins().times,this.redpoint_1):0},e.prototype.postRedPoint_2=function(){this.redpoint_2=this.redpoint_3=0,this.joinState=0,this.JoinRedPoint=[];var t=KfArenaSys.ins();if(!(GlobalConfig.CrossArenaBase.openDay>GameServer.serverOpenDay+1||ZsCT.ins().lv<GlobalConfig.CrossArenaBase.zhuanshengLevel)&&t.isServerOpen){var e=GlobalConfig.CrossArenaBase.peakAwards,i=1,s=0,n=t.dflState;for(var o in e)1!=(n>>i&1)&&KfArenaSys.ins().dflCount>=e[o].count&&s++,1!=(n>>i&1)&&t.dflCount>=e[o].count?this.JoinRedPoint[i]=1:this.JoinRedPoint[i]=0,i++;this.redpoint_2=s,this.redpoint_3=0==KfArenaSys.ins().dailyState?1:0,this.joinState=0==KfArenaSys.ins().dailyState?1:2}},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRedPoint_1",null),__decorate([post()],e.prototype,"postRedPoint_2",null),e}(BaseSystem);__reflect(KfArenaRedPoint.prototype,"KfArenaRedPoint"),System.KfArenaRedPoint=function(){return KfArenaRedPoint.ins()},window.KfArenaRedPoint=KfArenaRedPoint;var KfArenaSys=function(t){function e(){var e=t.call(this)||this;return e.lastKFArena=!1,e.times=0,e.duanLevel=0,e.score=0,e.leaderID=0,e.inviteDataList=[],e.worldTimeCd=0,e.flagHandle=10011010110,e.flagCD=0,e.ownScore=0,e.ownBattleRank=0,e.dflCount=0,e._openLeftTime=0,e._openTimer=0,e.isStartIng=0,e.isServerOpen=!1,e.sysId=PackageID.KfArena,e.regNetMsg(1,e.postPlayerInfo),e.regNetMsg(2,e.postTeamInfo),e.regNetMsg(5,e.postReceiveInvitation),e.regNetMsg(7,e.postBack),e.regNetMsg(9,e.postRefFlag),e.regNetMsg(10,e.doCollectFlag),e.regNetMsg(11,e.postRelive),e.regNetMsg(13,e.postFbInfo),e.regNetMsg(14,e.doResult),e.regNetMsg(16,e.postMacthState),e.regNetMsg(17,e.postChangeScore),e.regNetMsg(19,e.postDataInfo),e.regNetMsg(20,e.postKfArenaGuilds),e.regNetMsg(21,e.doNotice),e.regNetMsg(22,e.postMyBattleInfo),e.regNetMsg(23,e.postJoinRewards),e.regNetMsg(26,e.postOpenKfArena),e.regNetMsg(25,e.postRank),e.observe(GameLogic.ins().postEnterMap,e.changeScene),e}return __extends(e,t),e.prototype.sendCreateTeam=function(){this.sendBaseProto(1)},e.prototype.postPlayerInfo=function(t){this.times=t.readInt(),this.duanLevel=t.readInt(),this.score=t.readInt(),this.curMouth||(this.curMouth=new kfArenaMark),this.curMouth.parse(t),this.history||(this.history=new kfArenaMark),this.history.parse(t),this.isServerOpen=1==t.readInt()},e.prototype.sendPersonalMatch=function(){this.sendBaseProto(2)},e.prototype.postTeamInfo=function(t){this.leaderID=t.readInt(),this.macthState=t.readInt();var e=t.readInt();this.tfMembers=[];for(var i=0;e>i;i++){var s=new KfArenaRoleVo;this.tfMembers[i]=s,s.parse(t)}this.isTFCaptain=Actor.actorID==this.leaderID},e.prototype.sendLeaveTeam=function(){this.sendBaseProto(3)},e.prototype.sendStartMacth=function(){this.sendBaseProto(4)},e.prototype.sendCancelMacth=function(){this.sendBaseProto(16)},e.prototype.sendGuilds=function(t){var e=this.getBytes(20);e.writeInt(t),this.sendToServer(e)},e.prototype.sendInvite=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e),this.postKfArenaDelID(t)},e.prototype.postKfArenaDelID=function(t){return t},e.prototype.postReceiveInvitation=function(t){var e=new KFInviteData;e.parse(t),this.checkInviteByID(e.roleId)||this.inviteDataList.push(e),this.inviteDataList.length>0&&ViewManager.ins().open(kfReceiveInviteWin,0)},e.prototype.checkInviteByID=function(t){for(var e=0;e<this.inviteDataList.length;e++)if(this.inviteDataList[e].roleId==t)return!0;return!1},e.prototype.sendWorldInvite=function(){this.sendBaseProto(6)},e.prototype.sendRespondInvite=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postBack=function(t){var e=t.readInt();switch(e){case 1:ViewManager.ins().open(KfArenaWin,KfArenaWin.Page_Select_Macth)}},e.prototype.postMacthState=function(t){this.macthState=t.readInt()},e.prototype.postKfArenaGuilds=function(t){var e=t.readInt(),i=t.readInt();if(e==KFInviteType.Guild){this.guildDataList=[];for(var s=0;i>s;s++){var n=new GuildMemberInfo;n.parse(t),this.guildDataList.push(n)}}else if(e==KFInviteType.Friend){this.friendsDataList=[];for(var s=0;i>s;s++){var n=new GuildMemberInfo;n.parse(t),this.friendsDataList.push(n)}}return e},e.prototype.getDataList=function(t){var e,i=[];if(e=t==KFInviteType.Friend?this.friendsDataList:this.guildDataList,!e)return i;for(var s=0,n=e;s<n.length;s++){var o=n[s];if(o.roleID!=Actor.actorID){var a=new GuildMemberInfo;a.copyData(o),i.push(a)}}return i},e.prototype.sendJoinTeam=function(t){var e=this.getBytes(18);e.writeInt(t),this.sendToServer(e)},e.prototype.sendOutTeam=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.postRefFlag=function(t){t.readDouble();this.flagCD=1e3*t.readInt()+egret.getTimer(),this.flagHandle=10011010110},e.prototype.doCollectFlag=function(t){var e=t.readDouble(),i=t.readInt();this.firstCollect=t.readBoolean(),this.collectCamp=t.readByte(),i||(this.collectCamp=0),e&&e==Actor.handle&&i?(ViewManager.ins().open(CollectWin,e,i),GameLogic.ins().currAttackHandle=0):ViewManager.ins().close(CollectWin)},e.prototype.sendCollectFlag=function(){this.sendBaseProto(10)},e.prototype.postRelive=function(t){var e=t.readInt(),i=t.readDouble(),s=EntityManager.ins().getEntityByHandle(i),n="";if(s){var o=EntityManager.ins().getEntityByHandle(s.infoModel.masterHandle);n=s instanceof CharRole?s.infoModel.name:s.infoModel.masterHandle&&o?""+o.infoModel.name:"Boss"+s.infoModel.name}ViewManager.ins().open(ReliveWin,e,n)},e.prototype.postFbInfo=function(t){this.startTime=t.readInt();var e=t.readInt();this.myCampId=t.readByte(),this.scoreA=t.readInt(),this.scoreB=t.readInt(),this.readyIndex=t.readByte(),ViewManager.ins().open(KfArenaFightWin,(DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0,e)},e.prototype.doResult=function(t){var e=t.readInt(),i=t.readInt();this.winCamp=t.readShort();for(var s=t.readShort(),n=[],o=0;s>o;o++){var a=new KfArenaData(t);a.rank=o+1,n.push(a)}var r=[];s=t.readShort();for(var o=0;s>o;o++){var l=new RewardData;l.type=t.readInt(),l.id=t.readInt(),l.count=t.readInt(),r.push(l)}ViewManager.ins().open(KfArenaResultWin,this.winCamp,e,i,n,r)},e.prototype.enterBattle=function(){this.sendBaseProto(15)},e.prototype.postChangeScore=function(t){this.scoreA=t.readInt(),this.scoreB=t.readInt()},e.prototype.postDataInfo=function(t){this.dataList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=new KfArenaData;s.readRankData(t),s.rank=i+1,this.dataList.push(s)}return this.dataList},e.prototype.sendDataInfo=function(){this.sendBaseProto(19)},e.prototype.doNotice=function(t){var e=t.readString();ViewManager.ins().open(NoticeView).showNotice(e)},e.prototype.postMyBattleInfo=function(t){this.ownScore=t.readShort(),this.ownBattleRank=t.readShort()},e.prototype.postRank=function(t){this.rankDataList=[];for(var e=t.readInt(),i=0;e>i;i++)this.rankDataList.push(new KfArenaRankData(t));this.ownRank=t.readInt()},e.prototype.sendRank=function(){this.sendBaseProto(25)},e.prototype.sendDailyRewards=function(){this.sendBaseProto(23)},e.prototype.sendJoinRewards=function(t){var e=this.getBytes(24);e.writeInt(t),this.sendToServer(e)},e.prototype.postJoinRewards=function(t){this.yesterdayDuan=t.readInt(),this.dailyState=t.readInt(),this.dflCount=t.readInt(),this.dflState=t.readInt()},e.prototype.postOpenKfArena=function(t){this.isStartIng=t.readInt(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer()},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.getIsNoOnline=function(){for(var t="",e=0,i=this.tfMembers;e<i.length;e++){var s=i[e];s.isonline||(t+=""==t?s.roleName:"、"+s.roleName)}return t},e.prototype.getWinRate=function(){var t;return t=this.curMouth.win/(this.curMouth.win+this.curMouth.fail+this.curMouth.ping)*100,(t>>0)+"%"},e.prototype.checkIsMatching=function(){return 1==e.ins().macthState?(TipsCT.ins().showTips("跨服竞技场匹配中暂不能操作"),!1):!0},e.prototype.checkFBOperat=function(t){void 0===t&&(t=!1),t&&this.collectCamp&&this.collectCamp==this.myCampId&&TipsCT.ins().showCenterTips("当前有队友正在采集！");var i=(DateUtils.formatMiniDateTime(e.ins().startTime)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0;return i>0&&TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:"+i+"秒后战场开始|"),0>=i},e.prototype.getIsJoinTeam=function(){return 0!=this.leaderID},Object.defineProperty(e.prototype,"isKFArena",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_KF_ARENA},enumerable:!0,configurable:!0}),e.prototype.changeScene=function(){this.isKFArena?(this.lastKFArena=!0,this.updataModel()):this.lastKFArena&&(this.lastKFArena=!1,this.flagHandle=0,this.ownScore=0,this.ownBattleRank=0,ViewManager.ins().close(KfArenaFightWin),this.updataModel())},e.prototype.updataModel=function(){var t=EntityManager.ins().getAllEntity();for(var e in t){var i=t[e];i&&i.updateModel()}},e.prototype.getDuanAwards=function(){var t=GlobalConfig.CrossArenaBase.everyDayAward;for(var e in t)if(t[e].metal==this.yesterdayDuan)return t[e].award;return null},e.prototype.getDuanName=function(t){return void 0===t&&(t=0),t?GlobalConfig.CrossArenaBase.scoreMetalName[t-1]:GlobalConfig.CrossArenaBase.scoreMetalName[this.duanLevel-1]},e.prototype.getActorIdByName=function(t){for(var e=0,i=this.dataList;e<i.length;e++){var s=i[e];if(s.playerName==t)return s.actorid}return 0},e.prototype.isOpen=function(){if(!this.isServerOpen)return!1;var t=GlobalConfig.CrossArenaBase.openDay<=GameServer.serverOpenDay+1&&ZsCT.ins().lv>=GlobalConfig.CrossArenaBase.zhuanshengLevel;return t&&(1==this.isStartIng||0==this.isStartIng&&this._openLeftTime>0)?!0:!1},__decorate([post()],e.prototype,"postPlayerInfo",null),__decorate([post()],e.prototype,"postTeamInfo",null),__decorate([post()],e.prototype,"postKfArenaDelID",null),__decorate([post()],e.prototype,"postReceiveInvitation",null),__decorate([post()],e.prototype,"postBack",null),__decorate([post()],e.prototype,"postMacthState",null),__decorate([post()],e.prototype,"postKfArenaGuilds",null),__decorate([post()],e.prototype,"postRefFlag",null),__decorate([post()],e.prototype,"postRelive",null),__decorate([post()],e.prototype,"postFbInfo",null),__decorate([post()],e.prototype,"postChangeScore",null),__decorate([post()],e.prototype,"postDataInfo",null),__decorate([post()],e.prototype,"postMyBattleInfo",null),__decorate([post()],e.prototype,"postRank",null),__decorate([post()],e.prototype,"postJoinRewards",null),__decorate([post()],e.prototype,"postOpenKfArena",null),e}(BaseSystem);__reflect(KfArenaSys.prototype,"KfArenaSys"),System.KfArenaSys=function(){return KfArenaSys.ins()},window.KfArenaSys=KfArenaSys;var KfArenaData=function(){function t(t){this.killNum=0,this.aidNum=0,this.collectNum=0,this.curScore=0,this.curGetScore=0,this.totalScore=0,this.arenaScore=0,t&&this.readData(t)}return t.prototype.readData=function(t){this.servId=t.readInt(),this.campId=t.readByte(),this.actorid=t.readInt(),this.playerName=t.readString(),this.killNum=t.readShort(),this.aidNum=t.readShort(),this.collectNum=t.readShort(),this.curScore=t.readShort(),this.curGetScore=t.readShort(),this.totalScore=t.readInt(),this.arenaScore=t.readShort(),this.isFirstKiller=t.readBoolean(),this.isFirstCollect=t.readBoolean(),this.isMvp=t.readBoolean(),this.isOnWin=t.readBoolean(),this.isDeserter=t.readBoolean()},t.prototype.readRankData=function(t){this.servId=t.readInt(),this.campId=t.readByte(),this.actorid=t.readInt(),this.playerName=t.readString(),this.killNum=t.readShort(),this.aidNum=t.readShort(),this.collectNum=t.readShort(),this.curScore=t.readShort(),this.totalScore=t.readInt()},t}();__reflect(KfArenaData.prototype,"KfArenaData"),window.KfArenaData=KfArenaData;var KfArenaNoticeData=function(){function t(t){var e=t.readShort();1==e||3==e?(this.servId=t.readInt(),this.name=t.readString()):(this.killerServId=t.readInt(),this.killerName=t.readString(),this.deadServId=t.readInt(),this.deadName=t.readString()),this.noticeMsg=t.readString()}return t}();__reflect(KfArenaNoticeData.prototype,"KfArenaNoticeData"),window.KfArenaNoticeData=KfArenaNoticeData;var KfArenaRankData=function(){function t(t){this.rank=t.readInt(),this.playerId=t.readInt(),this.score=t.readInt(),this.vip=t.readInt(),this.playerName=t.readString(),this.dan=t.readInt(),this.servId=t.readInt()}return t}();__reflect(KfArenaRankData.prototype,"KfArenaRankData"),window.KfArenaRankData=KfArenaRankData;var KfArenaRoleVo=function(){function t(){this.curMonth=new kfArenaMark,this.history=new kfArenaMark,this.power=0,this.winRate=0}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.serverId=t.readInt(),this.isonline=0!=t.readInt(),this.duanLevel=t.readInt(),this.score=t.readInt(),this.curMonth.parse(t),this.history.parse(t),this.power=t.readInt(),this.winRate=t.readInt()/100>>0,this.roleName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.cloth=t.readInt(),this.weapon=t.readInt(),this.wingLv=t.readInt(),this.wingState=t.readByte(),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt(),this.zs=t.readInt(),this.lv=t.readInt()},t.prototype.isLeader=function(){return KfArenaSys.ins().leaderID==this.roleID},t}();__reflect(KfArenaRoleVo.prototype,"KfArenaRoleVo"),window.KfArenaRoleVo=KfArenaRoleVo;var kfArenaMark=function(){function t(){}return t.prototype.parse=function(t){this.win=t.readInt(),this.ping=t.readInt(),this.fail=t.readInt()},t}();__reflect(kfArenaMark.prototype,"kfArenaMark"),window.kfArenaMark=kfArenaMark;var KFInviteData=function(){function t(){}return t.prototype.parse=function(t){this.roleId=t.readInt(),this.name=t.readString(),this.power=t.readInt(),this.score=t.readInt(),this.winRate=t.readInt()/100>>0},t}();__reflect(KFInviteData.prototype,"KFInviteData"),window.KFInviteData=KFInviteData;var KFInviteType;!function(t){t[t.Friend=0]="Friend",t[t.Guild=1]="Guild"}(KFInviteType||(KFInviteType={})),window.KFInviteType=KFInviteType;var KfArenaBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnTab0Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelDisplay.text=this.data},e}(BaseItemRender);__reflect(KfArenaBtn.prototype,"KfArenaBtn"),window.KfArenaBtn=KfArenaBtn;var KfArenaDataItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof KfArenaData&&(this.data.actorid==Actor.actorID?this.currentState="oneself":this.data.campId==KfArenaSys.ins().myCampId?this.currentState="own":this.currentState="enemy",this.data.rank<=3?(this.rankImg.source="paihangs"+this.data.rank,this.rankImg.visible=!0,this.rankTxt.visible=!1):(this.rankTxt.text=this.data.rank+"",this.rankImg.visible=!1,this.rankTxt.visible=!0),this.nameTxt.text=this.data.playerName+"S"+this.data.servId,this.kaTxt.text=this.data.killNum+"/"+this.data.aidNum,this.collectionTxt.text=this.data.collectNum+"",this.scoreTxt.text=this.data.curScore+"",this.arenaPointTxt.text=this.data.curGetScore+"",this.arenaScoreTxt.text=this.data.totalScore+"",this.mvp.visible=this.data.isMvp,this.firstBloodImg.visible=this.data.isFirstKiller,this.firstCollectionImg.visible=this.data.isFirstCollect)},e}(BaseItemRender);__reflect(KfArenaDataItem.prototype,"KfArenaDataItem"),window.KfArenaDataItem=KfArenaDataItem;var KfArenaDuanItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.dwImg.source=""+t.icon,this.dwName.text=""+t.name,this.background.source=""+t.background,this.reward.dataProvider=new eui.ArrayCollection(t.award)}},e}(BaseItemRender);__reflect(KfArenaDuanItemRender.prototype,"KfArenaDuanItemRender"),window.KfArenaDuanItemRender=KfArenaDuanItemRender;var KfArenaJoinItemRender=function(t){function e(){var e=t.call(this)||this;return e.isGet=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=ItemBase,this.btnGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this.data){this.isGet=!1,this.stateImg.source="tag_weidacheng",this.btnGroup.visible=!1,this.target.text=""+this.data.count;var t=KfArenaSys.ins().dflState;1==(t>>this.data.id&1)?(this.stateImg.source="yilingqu",this.btnGroup.visible=!1):KfArenaRedPoint.ins().JoinRedPoint.length>0&&KfArenaRedPoint.ins().JoinRedPoint[this.data.id]>0&&(this.isGet=!0,this.stateImg.source=null,this.btnGroup.visible=!0),this.rewardList.dataProvider=new eui.ArrayCollection(this.data.award)}},e.prototype.onTap=function(t){this.isGet&&KfArenaSys.ins().sendJoinRewards(this.data.id)},e.prototype.destruct=function(){this.btnGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(KfArenaJoinItemRender.prototype,"KfArenaJoinItemRender"),window.KfArenaJoinItemRender=KfArenaJoinItemRender;var kfArenaMemberItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemData=new GuildMemberInfo,this.inviteBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this.data instanceof GuildMemberInfo&&(this.itemData=this.data),this.data&&(this.nameLab.text=this.itemData.name,this.powerLab.text="战力："+CommonUtils.overLengthNo(this.itemData.attack),this.scoreLab.text="积分："+this.itemData.score,this.winRateLab.text="胜率："+this.itemData.winRate+"%",this.face.source="head_"+this.itemData.job+this.itemData.sex,this.vipTitle.visible=0!=this.itemData.vipLevel)},e.prototype.onTap=function(t){KfArenaSys.ins().sendInvite(this.itemData.roleID)},e.prototype.destruct=function(){this.inviteBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(kfArenaMemberItemRender.prototype,"kfArenaMemberItemRender"),window.kfArenaMemberItemRender=kfArenaMemberItemRender;var KfArenaRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof KfArenaRankData&&(this.data.rank<=3?(this.rankImg.source="paihang"+this.data.rank,this.rankTxt.visible=!1,this.rankImg.visible=!0):(this.rankTxt.text=this.data.rank+"",this.rankTxt.visible=!0,this.rankImg.visible=!1),this.player.text=""+this.data.playerName,this.score.text=this.data.score+"",this.seasonTitle.text=GlobalConfig.CrossArenaBase.scoreMetalName[this.data.dan-1],this.serverId.text="S"+this.data.servId,this.vip.visible=this.data.vip>0)},e}(BaseItemRender);__reflect(KfArenaRankItemRender.prototype,"KfArenaRankItemRender"),window.KfArenaRankItemRender=KfArenaRankItemRender;var KfArenaResultDataItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this;this.data instanceof KfArenaData&&(this.data.actorid==Actor.actorID?this.currentState="oneself":this.data.campId==KfArenaSys.ins().myCampId?this.currentState="own":this.currentState="enemy",egret.callLater(function(){t.data.rank<=3?(t.rankImg.source="paihangs"+t.data.rank,t.rankImg.visible=!0,t.rankTxt.visible=!1):(t.rankTxt.text=t.data.rank+"",t.rankImg.visible=!1,t.rankTxt.visible=!0),t.nameTxt.text=t.data.playerName+"S"+t.data.servId,t.kaTxt.text=t.data.killNum+"/"+t.data.aidNum,t.collectionTxt.text=t.data.collectNum+"",t.scoreTxt.text=t.data.curScore+"",t.arenaPointTxt.text=t.data.curGetScore+"",0==t.data.arenaScore?t.arenaScoreTxt.text=t.data.totalScore+" "+(KfArenaSys.ins().winCamp==t.data.campId||3==KfArenaSys.ins().winCamp?"+":"-")+t.data.arenaScore:t.arenaScoreTxt.text=t.data.totalScore+" "+(t.data.arenaScore>0?"+":"")+t.data.arenaScore,t.mvp.visible=t.data.isMvp,t.firstBloodImg.visible=t.data.isFirstKiller,t.firstCollectionImg.visible=t.data.isFirstCollect,t.data.isOnWin?(t.tags.visible=!0,t.tags.source="kfarena_straight_win_tag"):t.data.isDeserter?(t.tags.visible=!0,t.tags.source="kfarena_deserter_tag"):t.tags.visible=!1},this))},e}(BaseItemRender);__reflect(KfArenaResultDataItem.prototype,"KfArenaResultDataItem"),window.KfArenaResultDataItem=KfArenaResultDataItem;var KfArenaRoleItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRoleItem",e.touchEnabled=!1,e.bodyMc=new MovieClip,e.eBodyMCGroup.addChild(e.bodyMc),e.wefBodyMc=new MovieClip,e.eWeapon.addChild(e.wefBodyMc),e.wingMc=new MovieClip,e.eWingMCGroup.addChild(e.wingMc),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){switch(t.target){case this.invite:case this.nomember:ViewManager.ins().open(KfArenaInviteWin);break;case this.body:this.data.roleID!=Actor.actorID&&ViewManager.ins().open(kfArenaCheckWin,this.data)}},e.prototype.dataChanged=function(){if(this.bodyMc.visible=this.wefBodyMc.visible=this.wingMc.visible=!1,this.data){this.nomember.visible=this.invite.visible=!1,this.body.visible=this.position.visible=this.weapon.visible=!0;var t=this.data,e=GlobalConfig.ClientGlobalConfig.useManRes?0:t.sex;this.offLineImg.visible=!t.isonline,this.roleName.text=t.roleName,this.position.source=t.isLeader()?"tfb_leader":null,this.body.source=this.weapon.source=this.wing.source=null;var i=GlobalConfig.EquipConfig[t.cloth];if(i){var s=i.appearance;s&&s.indexOf("[job]")>-1&&(s=s.replace("[job]",t.job+"")),this.body.source=(t.cloth>0?s+"_":t.job+"00_")+t.sex+"_c_png"}var n=GlobalConfig.EquipConfig[t.weapon];if(n){var s=n.appearance;s&&s.indexOf("[job]")>-1&&(s=s.replace("[job]",t.job+"")),this.weapon.source=t.weapon>0?s+"_"+e+"_c_png":""}this.wing.visible=!0;var o=GlobalConfig.WingLevelConfig[t.wingLv];if(o&&(this.wing.source=t.wingLv>=0?o.appearance+"_png":""),t.pos1>0){var a=this.getZhuangbanById(t.pos1);a.useMc>0?(this.body.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+a.res+"_"+t.sex+"_c_m",-1)):this.body.source=a.res+"_"+t.sex+"_c_png"}if(t.pos2>0){var a=this.getZhuangbanById(t.pos2);a.useMc>0?(this.weapon.visible=!1,this.wefBodyMc.visible=!0,this.wefBodyMc.playFile(RES_DIR_DRESS+a.res+"_"+e+"_c_m",-1)):this.weapon.source=a.res+"_"+e+"_c_png"}if(t.pos3>0){var a=this.getZhuangbanById(t.pos3);a.useMc>0?(this.wing.visible=!1,this.wingMc.visible=!0,this.wingMc.playFile(RES_DIR_DRESS+a.res+"_c_m",-1)):this.wing.source=a.res+"_png"}this.body.source||(this.body.source="body000_"+t.sex+"_c_png")}else this.nomember.visible=this.invite.visible=!0,this.offLineImg.visible=this.body.visible=this.position.visible=this.weapon.visible=this.wing.visible=!1,this.roleName.text="虚位以待"},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(KfArenaRoleItemRender.prototype,"KfArenaRoleItemRender"),window.KfArenaRoleItemRender=KfArenaRoleItemRender;var KfArenaTeamItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.bloodBar.slideDuration=0,this.touchChildren=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.clickEffc=new MovieClip,this.clickEffc.x=32,this.clickEffc.y=31,this.clickEffc.scaleX=this.clickEffc.scaleY=.85},e.prototype.dataChanged=function(){if(isNaN(this.data))this.data instanceof Role&&this.setData(this.data);else if(this.data){var t=EntityManager.ins().getEntityBymasterhHandle(this.data)||EntityManager.ins().getEntityByHandle(this.data);t&&t.infoModel&&(this.setData(t.infoModel),this.roleName.textColor=16711680,this.bloodBar.thumb.source="ttred2",this.reliveWordImg.visible=t.infoModel.getAtt(AttributeType.atHp)>0&&t.isSafety())}},e.prototype.setData=function(t){this.roleDt=t,t&&(this.roleHead.source="yuanhead"+t.job+t.sex,this.roleName.text=t.getNameWithServer(),this.upHp())},e.prototype.startRelive=function(){Timer.has(this.onTime,this)||(this.countDown.visible=!0,this.deadMask.visible=!0,this.handle=this.data,this.relCD=egret.getTimer()+1e3*(GlobalConfig.CrossArenaBase.rebornCd+1),Timer.start(1e3,20,this.onTime,this),this.countDown.text=GlobalConfig.CrossArenaBase.rebornCd+"")},e.prototype.onTime=function(){var t=(this.relCD-egret.getTimer())/1e3>>0;t>0&&this.handle==this.data?this.countDown.text=t+"":(this.onRelive(),Timer.stop(this.onTime,this))},e.prototype.onRelive=function(){this.countDown.visible=!1,this.deadMask.visible=!1,this.bloodBar.value=100,this.bloodBar.maximum=100},e.prototype.upHp=function(){if(this.data){var t;if(isNaN(this.data)?this.data instanceof Role&&(t=EntityManager.ins().getMasterList(this.data.masterHandle)):t=EntityManager.ins().getMasterList(this.data),t&&0!=t.length){for(var e=t.length,i=0,s=0,n=0;e>n;n++){var o=t[n];if(o instanceof CharRole){var a=o.infoModel.getAtt(AttributeType.atHp)||0,r=o.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=a,s+=r}}this.bloodBar.value=i,this.bloodBar.maximum=s,0>=i&&this.startRelive()}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.data=null},e.prototype.onTap=function(t){if(isNaN(this.data))this.data instanceof Role&&ReadPlayerCT.ins().sendFindPlayer(KfArenaSys.ins().getActorIdByName(this.data.name),0);else{if(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),this.showEffect(),!KfArenaSys.ins().checkFBOperat(KfArenaSys.ins().flagHandle==parseInt(this.data)))return;var e=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(e&&e.isSafety())return void TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:此玩家在复活点，不可攻击！|");var i=SubRoles.lookAtTar;if(i&&i.isSafety()){var s=GlobalConfig.CrossArenaBase.readyPos[KfArenaSys.ins().readyIndex-1].tranferPoint;return GameMap.moveTo((s.x+.5)*GameMap.CELL_SIZE>>0,s.y*GameMap.CELL_SIZE>>0),void EntrustManager.ins().regEntrusTask(EntrustType.Transfer,this.touchDo,this)}this.touchDo()}},e.prototype.touchDo=function(){if(KfArenaSys.ins().flagHandle==parseInt(this.data)){if(KfArenaSys.ins().flagCD-egret.getTimer()>0)return void TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:天书未刷新！|");KfArenaSys.ins().sendCollectFlag()}else GameLogic.ins().postChangeAttrPoint(this.data)},e.prototype.showEffect=function(){this.clickEffc.playFile(RES_DIR_EFF+"PromptEff5",1),this.addChild(this.clickEffc)},__decorate([callLater],e.prototype,"upHp",null),e}(BaseItemRender);__reflect(KfArenaTeamItemRender.prototype,"KfArenaTeamItemRender"),window.KfArenaTeamItemRender=KfArenaTeamItemRender;var kfArenaCheckWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfArenaCheckSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.outBtn,this.onTouch),this.addTouchEvent(this.checkBtn,this.onTouch),this.data=t[0],this.update()},e.prototype.update=function(){this.currentState=KfArenaSys.ins().isTFCaptain?"normal":"check",this.nameLab.text=this.data.roleName,this.powerLab.text="战力："+CommonUtils.overLengthNo(this.data.power),this.scoreLab.text="积分："+this.data.score,this.winRateLab.text="胜率："+this.data.winRate+"%",this.face.source="head_"+this.data.job+this.data.sex},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:break;case this.outBtn:KfArenaSys.ins().sendOutTeam(this.data.roleID);break;case this.checkBtn:ReadPlayerCT.ins().sendFindPlayer(this.data.roleID,this.data.serverId)}ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(kfArenaCheckWin.prototype,"kfArenaCheckWin"),window.kfArenaCheckWin=kfArenaCheckWin,ViewManager.ins().reg(kfArenaCheckWin,LayerManager.UI_Popup);var KfArenaDuanPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.listArray=new eui.ArrayCollection,this.list.itemRenderer=KfArenaDuanItemRender,this.rewardList.touchChildren=!1,this.list.dataProvider=this.listArray,this.rewardList.itemRenderer=ItemBaseNoName,this.degree.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.degree.text+"</u>"),this.addTouchEvent(this.rewardList,this.onTouch),this.addTouchEvent(this.degree,this.onTouch)},e.prototype.addDisplay=function(){this.observe(KfArenaRedPoint.ins().postRedPoint_2,this.update),this.update()},e.prototype.update=function(){var t=KfArenaSys.ins().getDuanAwards();for(var e in t)t[e].isRedPoint=KfArenaRedPoint.ins().joinState;var i=CommonUtils.objectToArray(GlobalConfig.CrossArenaRankAward),s=CommonUtils.objectToArray(GlobalConfig.CrossArenaMetalAward);s.sort(this.sort);for(var n=0,o=s;n<o.length;n++){var e=o[n];i.push(e)}this.listArray.source=i,this.rewardList.dataProvider=new eui.ArrayCollection(t),this.dw.text=KfArenaSys.ins().getDuanName()},e.prototype.onTouch=function(t){switch(t.target){case this.rewardList:KfArenaSys.ins().isOpen()?KfArenaSys.ins().sendDailyRewards():TipsCT.ins().showTips("休战期间不能领取");break;case this.degree:ViewManager.ins().open(CommonHelpWin,GlobalConfig.CrossArenaBase.degreeTpis)}},e.prototype.sort=function(t,e){return Algorithm.sortDesc(t.metal,e.metal)},e}(BaseView);__reflect(KfArenaDuanPanel.prototype,"KfArenaDuanPanel"),window.KfArenaDuanPanel=KfArenaDuanPanel;var KfArenaFightWin=function(t){function e(){var e=t.call(this)||this;return e.lastTips=!1,e.lastAScoreTip=!1,e.lastBScoreTip=!1,e.skinName="KfArenaFightSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.bigTimeGroup.visible=!0,this.showCollectTip(!1),this.teamList.itemRenderer=KfArenaTeamItemRender,this.teamDt=new eui.ArrayCollection,this.teamList.dataProvider=this.teamDt,this.canAttackList.itemRenderer=KfArenaTeamItemRender,this.bookList.itemRenderer=TargetMemberHeadRender,this.list2Dt=new eui.ArrayCollection,this.list2Dt.source=TargetListCC.ins().canAttackHandles,this.canAttackList.dataProvider=this.list2Dt,this.bookDt=new eui.ArrayCollection,this.bookList.dataProvider=this.bookDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.modeSys=KfArenaSys.ins(),this.addTouchEvent(this.seeRule,this.onTouch),this.addTouchEvent(this.infoBtn,this.onTouch),this.observe(this.modeSys.postChangeScore,this.upScore),this.observe(this.modeSys.postMyBattleInfo,this.updata),this.observe(this.modeSys.postRefFlag,this.refBook),this.observe(GameLogic.ins().postCreateOtherEntity,this.upTeam),this.observe(GameLogic.ins().postChangeCamp,this.upTeam),this.observe(GameLogic.ins().postRemoveEntity,this.onRemove),this.observe(GameLogic.ins().postHpChange,this.onHpchange),this.observe(GameLogic.ins().syncMyPos,this.transferFun),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.observe(TargetListCC.ins().postChangeCanAttackHandle,this.updateCanAttackList),this.startTime=t[0],this.endTimeStamp=t[1],this.startCountDown(this.startTime),this.upScore(),this.updata(),this.upTeam()
},e.prototype.close=function(){for(var t=0;t<this.teamList.numElements;t++){var e=this.teamList.getElementAt(t);e&&e.close()}for(var t=0;t<this.canAttackList.numElements;t++){var e=this.canAttackList.getElementAt(t);e&&e.close()}},e.prototype.onTime=function(){this.refBook()},e.prototype.refBook=function(){var t=this,e=KfArenaSys.ins().flagCD-egret.getTimer()/1e3>>0;e>0?Timer.start(1e3,e+1,function(){t.bookDt.replaceAll([KfArenaSys.ins().flagHandle])},this):this.bookDt.replaceAll([KfArenaSys.ins().flagHandle])},e.prototype.openOtherPlayerView=function(t){var e=ViewManager.ins().open(RRoleWin,t);e.hideEx(2)},e.prototype.upTeam=function(){var t=EntityManager.ins().getAllEntity(),e=[],i={};for(var s in t){var n=t[s].infoModel;n.camp!=KfArenaSys.ins().myCampId||n.isMy||(i[n.masterHandle]=n,e[Object.keys(i).length-1]=i[n.masterHandle])}this.teamDt.length||this.modeSys.sendDataInfo(),this.teamDt.replaceAll(e)},e.prototype.onRemove=function(t){var e=(t[0],t[1]);e instanceof CharRole&&e.infoModel.camp==KfArenaSys.ins().myCampId&&this.upTeam()},e.prototype.updata=function(){this.score.text=this.modeSys.ownScore+"",this.rank.text=this.modeSys.ownBattleRank+""},e.prototype.onHpchange=function(t){var e=t[0];t[1],t[2];if(!e.isMy){for(var i=0;i<this.teamList.numElements;i++){var s=this.teamList.getElementAt(i);if(s&&e.infoModel==s.data){s.upHp();break}}for(var i=0;i<this.canAttackList.numElements;i++){var s=this.canAttackList.getElementAt(i);if(s&&e.infoModel.masterHandle==s.data){s.upHp();break}}}},e.prototype.upScore=function(){1==this.modeSys.myCampId?(this.blueScore.text=this.modeSys.scoreA+"",this.redScore.text=this.modeSys.scoreB+""):(this.blueScore.text=this.modeSys.scoreB+"",this.redScore.text=this.modeSys.scoreA+""),GlobalConfig.CrossArenaBase.tipScore||(GlobalConfig.CrossArenaBase.tipScore=800),!this.lastAScoreTip&&this.modeSys.scoreA>=GlobalConfig.CrossArenaBase.tipScore?(this.showScoreTip(1==this.modeSys.myCampId?1:2,this.modeSys.scoreA),this.lastAScoreTip=!0):!this.lastBScoreTip&&this.modeSys.scoreB>=GlobalConfig.CrossArenaBase.tipScore&&(this.showScoreTip(1==this.modeSys.myCampId?2:1,this.modeSys.scoreB),this.lastBScoreTip=!0)},e.prototype.showScoreTip=function(t,e){this.hintImg.source=1==t?"kfarena_words_win_friend":"kfarena_words_win_enemy",this.bigTimeGroup.visible=!0,this.countDown.text=e+"",Timer.start(5e3,1,this.hideEnd,this)},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[42].text);break;case this.infoBtn:ViewManager.ins().open(KfArenaInfoWin)}},e.prototype.startCountDown=function(t){this.txtPrepare.visible=!0,this.leftTime.visible=!1,this.startTime=egret.getTimer()+1e3*t,this.hintImg.source="kfarena_words_start",this.timeGo(),t>0&&!Timer.has(this.timeGo,this)&&(this.bigTimeGroup.visible=!0,Timer.start(1e3,0,this.timeGo,this))},e.prototype.timeGo=function(){var t=(this.startTime-egret.getTimer())/1e3>>0;if(t>0)this.countDown.text=t+"";else{Timer.stop(this.timeGo,this),this.bigTimeGroup.visible=!1,this.showCollectTip(!0),this.txtPrepare.visible=!1,this.leftTime.visible=!0;var e=(DateUtils.formatMiniDateTime(this.endTimeStamp)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0;e>0&&!Timer.has(this.lefttimeFun,this)&&Timer.start(1e3,0,this.lefttimeFun,this)}},e.prototype.lefttimeFun=function(){var t=(DateUtils.formatMiniDateTime(this.endTimeStamp)-GameServer.serverTime)/DateUtils.MS_PER_SECOND>>0;return 0>t?void Timer.stopAll(this):(this.leftTime.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3),void(!this.lastTips&&10>=t&&(this.lastTips=!0,this.countDown.text=t+"",this.hintImg.source="kfarena_words_end",this.bigTimeGroup.visible=!0,Timer.start(5e3,1,this.hideEnd,this))))},e.prototype.hideEnd=function(){this.bigTimeGroup.visible=!1},e.prototype.transferFun=function(){this.showCollectTip(!1)},e.prototype.showCollectTip=function(t){this.collectBookTip.visible=t},e.prototype.updateCanAttackList=function(){var t=TargetListCC.ins().canAttackHandles;this.canAttackBar.visible=t.length>0,this.canAttackBar.visible&&this.list2Dt.replaceAll(TargetListCC.ins().canAttackHandles)},e}(BaseEuiView);__reflect(KfArenaFightWin.prototype,"KfArenaFightWin"),window.KfArenaFightWin=KfArenaFightWin,ViewManager.ins().reg(KfArenaFightWin,LayerManager.UI_Main);var KfArenaInfoWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfArenaInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=KfArenaDataItem,this.itemDt=new eui.ArrayCollection,this.list.dataProvider=this.itemDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch),this.observe(KfArenaSys.ins().postDataInfo,this.updata),KfArenaSys.ins().sendDataInfo()},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.sureBtn:ViewManager.ins().close(this)}},e.prototype.updata=function(t){var e=KfArenaSys.ins();1==e.myCampId?(this.blueScore.text=e.scoreA+"",this.redScore.text=e.scoreB+""):(this.blueScore.text=e.scoreB+"",this.redScore.text=e.scoreA+""),this.itemDt.replaceAll(t)},e}(BaseEuiView);__reflect(KfArenaInfoWin.prototype,"KfArenaInfoWin"),window.KfArenaInfoWin=KfArenaInfoWin,ViewManager.ins().reg(KfArenaInfoWin,LayerManager.UI_Popup);var KfArenaInviteWin=function(t){function e(){var e=t.call(this)||this;return e.friendList=[],e.guildList=[],e.type=0,e.cdTime=30,e.skinName="kfInviteSkin",e.isTopLevel=!0,e.listView.itemRenderer=kfArenaMemberItemRender,e.worldInvite.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.worldInvite.text+"</u>"),e.listArray=new eui.ArrayCollection,e.listView.dataProvider=e.listArray,e.tab.itemRenderer=KfArenaBtn,e.updateTabRedPt(),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tab.selectedIndex=0,this.addTouchEvent(this.closeBtn0,this.onTouch),this.addTouchEvent(this.worldInvite,this.onTouch),this.addTouchEvent(this.tab,this.onTabClick),this.observe(KfArenaSys.ins().postKfArenaGuilds,this.updateGuild),this.type=KFInviteType.Friend,KfArenaSys.ins().sendGuilds(0),KfArenaSys.ins().sendGuilds(1)},e.prototype.updateGuild=function(t){switch(t){case KFInviteType.Friend:this.friendList=KfArenaSys.ins().getDataList(t);break;case KFInviteType.Guild:this.guildList=KfArenaSys.ins().getDataList(t)}this.setType(this.type)},e.prototype.onTabClick=function(t){void 0===t&&(t=null),this.setType(this.tab.selectedIndex)},e.prototype.updateTabRedPt=function(){this.tab.dataProvider=new eui.ArrayCollection(["好  友","帮  派"])},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn0:ViewManager.ins().close(this);break;case this.worldInvite:var e=egret.getTimer(),i=(KfArenaSys.ins().worldTimeCd-e)/1e3>>0;i>0?TipsCT.ins().showTips(i+"秒后可再次世界邀请"):(KfArenaSys.ins().worldTimeCd=e+1e3*this.cdTime,KfArenaSys.ins().sendWorldInvite(),TipsCT.ins().showTips("邀请发送成功"))}},e.prototype.setType=function(t){switch(this.type=t,t){case KFInviteType.Friend:this.listArray.source=this.friendList,this.noPlayer.visible=0==this.friendList.length;break;case KFInviteType.Guild:this.listArray.source=this.guildList,this.noPlayer.visible=0==this.guildList.length}},e}(BaseEuiView);__reflect(KfArenaInviteWin.prototype,"KfArenaInviteWin"),window.KfArenaInviteWin=KfArenaInviteWin,ViewManager.ins().reg(KfArenaInviteWin,LayerManager.UI_Popup);var KfArenaJoinPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.listArray=new eui.ArrayCollection,this.list.itemRenderer=KfArenaJoinItemRender,this.list.dataProvider=this.listArray},e.prototype.addDisplay=function(){this.observe(KfArenaSys.ins().postJoinRewards,this.update),this.update()},e.prototype.update=function(){var t=GlobalConfig.CrossArenaBase.peakAwards,e=[],i=1;for(var s in t)t[s].id=i,t[s].sortIndex=1,1==(KfArenaSys.ins().dflState>>i&1)?t[s].sortIndex=0:KfArenaRedPoint.ins().JoinRedPoint.length>0&&KfArenaRedPoint.ins().JoinRedPoint[i]>0&&(t[s].sortIndex=2),e.push(t[s]),i++;e.sort(this.sort),this.listArray.source=e,this.myRecord.text=KfArenaSys.ins().dflCount},e.prototype.sort=function(t,e){var i=Algorithm.sortDesc(t.sortIndex,e.sortIndex);return 0==i&&(i=Algorithm.sortAsc(t.id,e.id)),i},e}(BaseView);__reflect(KfArenaJoinPanel.prototype,"KfArenaJoinPanel"),window.KfArenaJoinPanel=KfArenaJoinPanel;var KfArenaMacthPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.memberArr=[this.leader,this.member1,this.member2],this.dailyTime.text=""+GlobalConfig.CrossArenaBase.joinCount,this.maxTime.text=""+GlobalConfig.CrossArenaBase.maxJoinCount,this.addTouchEvent(this.disBtn,this.onTouch),this.addTouchEvent(this.macthBtn,this.onTouch)},e.prototype.addDisplay=function(){this.observe(KfArenaSys.ins().postPlayerInfo,this.updateInfo),this.observe(KfArenaSys.ins().postTeamInfo,this.update),this.observe(KfArenaSys.ins().postMacthState,this.update),this.update()},e.prototype.update=function(){this.updateMember(),this.updateInfo(),this.updateBtnState()},e.prototype.updateMember=function(){this.roleGroup.visible=KfArenaSys.ins().getIsJoinTeam();for(var t=0,e=this.memberArr;t<e.length;t++){var i=e[t];i.data=null}var s=KfArenaSys.ins().tfMembers,n=1;if(s&&s.length)for(var o=0;o<s.length;o++){var a=s[o],r=a.isLeader();r?this.leader.data=a:(this.memberArr[n].data=a,n++)}},e.prototype.updateInfo=function(){var t=KfArenaSys.ins();this.curMonthLabel.textFlow=TextFlowMaker.generateTextFlow("当前战绩：|C:10458221&T:"+t.curMouth.win+"胜"+t.curMouth.ping+"平"+t.curMouth.fail+"败|"),this.winRateLbl.textFlow=TextFlowMaker.generateTextFlow("当前胜率：|C:16298305&T:"+t.getWinRate()+"|"),this.countLabel.text=""+t.times,this.macthingLabel.visible=1==t.macthState,this.duanTxt.text=t.getDuanName(),this.duanImg.source="kfarena_rank_img_"+((t.duanLevel-1)/3>>0);var e=GlobalConfig.CrossArenaBase.scoreMetal[t.duanLevel];e?(this.scoreProgressTxt.text=t.score+"/"+e,this.nextDuanTxt.text="再获得"+(e-t.score)+"积分晋升到"+t.getDuanName(t.duanLevel+1)):(this.scoreProgressTxt.text=t.score+"/"+GlobalConfig.CrossArenaBase.scoreMetal[t.duanLevel-1],this.nextDuanTxt.text="当前已达最高阶")},e.prototype.updateBtnState=function(){var t=KfArenaSys.ins().getIsJoinTeam();this.waitGroup.visible=!t,this.matchGroup.visible=t,t?(KfArenaSys.ins().isTFCaptain?this.disBtn.label="解散战队":this.disBtn.label="离开战队",1==KfArenaSys.ins().macthState?this.macthBtn.label="取消匹配":this.macthBtn.label="开始匹配"):(this.disBtn.label="创建战队",this.macthBtn.label="单人匹配")},e.prototype.onTouch=function(t){switch(t.target){case this.disBtn:if(0==KfArenaSys.ins().isStartIng)return void TipsCT.ins().showCenterTips(GlobalConfig.CrossArenaBase.hintTxt);if(!KfArenaSys.ins().getIsJoinTeam())return void KfArenaSys.ins().sendCreateTeam();KfArenaSys.ins().sendLeaveTeam();break;case this.macthBtn:var e=KfArenaSys.ins();if(1==e.macthState)return e.isTFCaptain?void e.sendCancelMacth():void TipsCT.ins().showCenterTips("只有队长才可以取消匹配");if(0==KfArenaSys.ins().isStartIng)return void TipsCT.ins().showCenterTips(GlobalConfig.CrossArenaBase.hintTxt);if(!e.getIsJoinTeam())return void e.sendPersonalMatch();if(!e.isTFCaptain)return void TipsCT.ins().showCenterTips("只有队长才可以开始匹配");var i=e.getIsNoOnline();if(""!=i)return void TipsCT.ins().showCenterTips(i+"离线了，请稍后匹配");e.sendStartMacth()}},e}(BaseView);__reflect(KfArenaMacthPanel.prototype,"KfArenaMacthPanel"),window.KfArenaMacthPanel=KfArenaMacthPanel;var KfArenaRankPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fristView=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=KfArenaRankItemRender,this.rankDatas=new eui.ArrayCollection,this.list.dataProvider=this.rankDatas,this.rank0.index=0,this.rank1.index=1,this.rank2.index=2,this.firstGroup.visible=!1,this.firstGroup.touchChildren=!1,this.state.visible=!0,this.addTouchEvent(this.list,this.onViewPlayer),this.addTouchEvent(this.firstGroup,this.onViewPlayer)},e.prototype.addDisplay=function(){this.observe(KfArenaSys.ins().postRank,this.upData),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayer),KfArenaSys.ins().sendRank()},e.prototype.upData=function(){this.firstData=KfArenaSys.ins().rankDataList.shift(),this.rankDatas.replaceAll(KfArenaSys.ins().rankDataList),this.selfPos0.text=KfArenaSys.ins().ownRank>0?KfArenaSys.ins().ownRank:"未上榜",this.firstData&&(this.firstGroup.visible=!0,this.state.visible=!1,this.serverId0.text="S"+this.firstData.servId,this.vip0.visible=this.firstData.vip>0,this.firstNameTxt0.text=this.firstData.playerName,this.score0.text=this.firstData.score+"",this.seasonTitle0.text=GlobalConfig.CrossArenaBase.scoreMetalName[this.firstData.dan-1],ReadPlayerCT.ins().sendFindPlayer(this.firstData.playerId,this.firstData.servId))},e.prototype.onViewPlayer=function(t){if(t.target instanceof KfArenaRankItemRender){var e=this.list.selectedItem;e&&ReadPlayerCT.ins().sendFindPlayer(e.playerId,e.servId)}else t.target==this.firstGroup&&this.firstData&&ReadPlayerCT.ins().sendFindPlayer(this.firstData.playerId,this.firstData.servId)},e.prototype.openOtherPlayer=function(t){if(this.fristView){var e=ViewManager.ins().open(RRoleWin,t);e.hideEx(2)}else this.rank0.data={otherPlayerData:t},this.rank1.data={otherPlayerData:t},this.rank2.data={otherPlayerData:t},this.fristView=!0},e}(BaseView);__reflect(KfArenaRankPanel.prototype,"KfArenaRankPanel"),window.KfArenaRankPanel=KfArenaRankPanel;var KfArenaResultWin=function(t){function e(){var e=t.call(this)||this;return e.QUIT_T=30,e.skinName="KfArenaResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.extrReward.itemRenderer=ItemBase,this.list.itemRenderer=KfArenaResultDataItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch);var i=t[0],s=t[1],n=t[2],o=t[3],a=t[4];3==i?(this.blueResult.source="tag_draw",this.redResult.source="tag_draw",this.loseMask0.visible=!1,this.loseMask1.visible=!1):i==KfArenaSys.ins().myCampId?(this.blueResult.source="tag_win",this.redResult.source="tag_lose",this.loseMask0.visible=!1,this.loseMask1.visible=!0):(this.blueResult.source="tag_lose",this.redResult.source="tag_win",this.loseMask0.visible=!0,this.loseMask1.visible=!1),1==KfArenaSys.ins().myCampId?(this.blueScore.text=s+"",this.redScore.text=n+""):(this.blueScore.text=n+"",this.redScore.text=s+""),this.list.dataProvider=new eui.ArrayCollection(o),this.extrReward.dataProvider=new eui.ArrayCollection(a),this.quitTime=egret.getTimer()+1e3*this.QUIT_T,Timer.has(this.onTime,this)||Timer.start(1e3,0,this.onTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.sureBtn:this.onExit()}},e.prototype.onTime=function(){var t=(this.quitTime-egret.getTimer())/1e3>>0;t>0?this.leaveInfo.text=t+"s后自动离开战场":(this.onExit(),Timer.stop(this.onTime,this))},e.prototype.onExit=function(){FbCT.ins().sendExitFb(),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(KfArenaResultWin.prototype,"KfArenaResultWin"),window.KfArenaResultWin=KfArenaResultWin,ViewManager.ins().reg(KfArenaResultWin,LayerManager.UI_Popup);var KfArenaWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfArenaSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.viewStack.selectedIndex=e.Page_Select_Macth,this.tab.dataProvider=this.viewStack,this.addTouchEvent(this.closeBtn,this.onTouch),this.addChangeEvent(this.tab,this.onTabTouch),this.addTouchEvent(this.seeRule,this.onTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.redPointEx()},e.prototype.addDisplay=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.observe(KfArenaRedPoint.ins().postRedPoint,this.redPointEx),this.tab.selectedIndex=this.viewStack.selectedIndex=isNaN(t[0])?e.Page_Select_Macth:t[0],this.setOpenIndex(this.tab.selectedIndex)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return KfArenaSys.ins().isServerOpen?GlobalConfig.CrossArenaBase.openDay>GameServer.serverOpenDay+1?(TipsCT.ins().showTips("|C:0xf3311e&T:开服"+GlobalConfig.CrossArenaBase.openDay+"天开启|"),!1):ZsCT.ins().lv<GlobalConfig.CrossArenaBase.zhuanshengLevel?(TipsCT.ins().showTips("|C:0xf3311e&T:转生等级"+GlobalConfig.CrossArenaBase.zhuanshengLevel+"转开启|"),!1):!0:(TipsCT.ins().showTips("|C:0xf3311e&T:跨服内所有服务器都达到开服"+GlobalConfig.CrossArenaBase.openDay+"天后开启跨服竞技场玩法|"),!1)},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[42].text)}},e.prototype.onTabTouch=function(t){this.redPointEx(),this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){this.oldIndex=t},e.prototype.redPointEx=function(){this.redPoint0.visible=KfArenaRedPoint.ins().redpoint_1>0,this.redPoint1.visible=!1,this.redPoint2.visible=KfArenaRedPoint.ins().redpoint_2>0,this.redPoint3.visible=KfArenaRedPoint.ins().redpoint_3>0},e.Page_Select_Macth=0,e.Page_Select_Rank=1,e.Page_Select_Join=2,e.Page_Select_Duan=3,e}(BaseEuiView);__reflect(KfArenaWin.prototype,"KfArenaWin"),window.KfArenaWin=KfArenaWin,ViewManager.ins().reg(KfArenaWin,LayerManager.UI_Main);var kfReceiveInviteWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="kfReceiveInviteSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.inviteData=KfArenaSys.ins().inviteDataList[this.index],this.addTouchEvent(this.notBtn,this.onTouch),this.addTouchEvent(this.sureBtn,this.onTouch),this.update()},e.prototype.update=function(){this.nameLabel.text=this.inviteData.name,this.powerLabel.text="战力："+CommonUtils.overLengthNo(this.inviteData.power),this.scoreLabel.text="积分："+this.inviteData.score,this.winRateLabel.textFlow=TextFlowMaker.generateTextFlow("胜率：|C:16776960&T:"+this.inviteData.winRate+"%|")},e.prototype.onTouch=function(t){switch(t.target){case this.notBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,0),KfArenaSys.ins().inviteDataList.slice(this.index,1),ViewManager.ins().close(this);break;case this.sureBtn:KfArenaSys.ins().sendRespondInvite(this.inviteData.roleId,1),KfArenaSys.ins().inviteDataList.slice(this.index,1),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(kfReceiveInviteWin.prototype,"kfReceiveInviteWin"),window.kfReceiveInviteWin=kfReceiveInviteWin,ViewManager.ins().reg(kfReceiveInviteWin,LayerManager.UI_Popup);var KFBossRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpoints=[],e.redpointGroup1=!1,e.redpointGroup2=!1,e.associated(e.postRedPoint,KFBossSys.ins().postBossInfo,KFBossSys.ins().postBossRevive,KFBossSys.ins().postInfo),e}return __extends(e,t),e.prototype.postRedPoint=function(){if(this.redpoints=[],this.redpoint=0,this.redpointGroup1=!1,this.redpointGroup2=!1,!KFBossSys.ins().isOpen())return 0;for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i){var s=GlobalConfig.CrossBossConfig[i.dpId],n=ZsCT.ins().lv>=s.levelLimit[0]/1e3&&ZsCT.ins().lv<=s.levelLimit[1]/1e3,o=BagCT.ins().getBagItemById(GlobalConfig.CrossBossBase.swyscroll),a=BagCT.ins().getBagItemById(GlobalConfig.CrossBossBase.symdscroll);n&&(n=s.type==KFBossType.KF?i.flagRefTimer-egret.getTimer()<0&&KFBossSys.ins().flagTimes>0||i.bossRefTimer-egret.getTimer()<0&&(KFBossSys.ins().bossTimes>0||!!o&&o.count>0):s.type==KFBossType.SYMD?i.bossRefTimer-egret.getTimer()<0&&(KFBossSys.ins().enterNum9>0||!!a&&a.count>0):!1),this.redpoints[i.dpId]=n?1:0,n&&(i.dpId<=8?this.redpointGroup1=!0:this.redpointGroup2=!0)}}return this.redpoint=this.redpointGroup1||this.redpointGroup2?1:0,this.redpoint},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(KFBossRedpoint.prototype,"KFBossRedpoint"),System.KFBossRedpoint=function(){return KFBossRedpoint.ins()},window.KFBossRedpoint=KFBossRedpoint;var KFBossSys=function(t){function e(){var e=t.call(this)||this;return e.fbInfo=[],e.lastKFBoss=!1,e.txmyNum=0,e.kfBossCfgID=0,e.isHelp=!1,e.helpNum=[],e._hasBuyBelongNum={},e.dropRecordDataList=[],e.dropBestRecordDataList=[],e._destroyTime=0,e.info=[],e.cdCount=0,e.sysId=PackageID.KFBoss,e.regNetMsg(1,e.postBossInfo),e.regNetMsg(2,e.postAscriptionChange),e.regNetMsg(3,e.postRevive),e.regNetMsg(5,e.postBossRevive),e.regNetMsg(7,e.postRefFlag),e.regNetMsg(8,e.postCollectFlag),e.regNetMsg(9,e.postInfo),e.regNetMsg(10,e.doResult),e.regNetMsg(11,e.postDropList),e.regNetMsg(12,e.postBroadcastResult),e.regNetMsg(13,e.postEffigyInfo),e.regNetMsg(24,e.postAscriptionChange),e.regNetMsg(25,e.setShieldPer),e.regNetMsg(26,e.postBossChallengeResult),e.regNetMsg(27,e.postRevive),e.regNetMsg(29,e.posthasBelongNum),e.regNetMsg(30,e.sendUpItemId),e.regNetMsg(31,e.doHelpInfo),e.regNetMsg(32,e.postHelpNum),e.regNetMsg(33,e.postElert),e.regNetMsg(34,e.postCanHelpNum),e.observe(BossCT.ins().postBossAppear,function(){(e.isKFBossBattle||GameMap.fbType==FbCT.FB_TYPE_37BOSS)&&ViewManager.ins().open(BossBelongPanel)}),e.observe(BossCT.ins().postBossDisappear,function(){(e.isKFBossBattle||GameMap.fbType==FbCT.FB_TYPE_37BOSS)&&ViewManager.ins().close(BossBelongPanel)}),e.observe(GameLogic.ins().postEnterMap,function(){e.isKFBossBattle||GameMap.fbType==FbCT.FB_TYPE_37BOSS?e.postEnterKFBossFb():e.lastKFBoss&&e.postQuiKFBossFb()}),e}return __extends(e,t),Object.defineProperty(e.prototype,"isKFBossBattle",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_KF_BOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS2},enumerable:!0,configurable:!0}),e.prototype.postBossInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=new KFBossInfoData(t);this.fbInfo[s.dpId]=s}},e.prototype.postAscriptionChange=function(t){var e=t.readDouble(),i=t.readDouble(),s="";if(e>0){var n=EntityManager.ins().getMasterList(e);n&&n[0]&&n[0].infoModel&&(s=n[0].infoModel.name)}BossCT.ins().postBelongChange(i,e,s)},e.prototype.postRevive=function(t){var e=t.readInt(),i=t.readDouble();if(e>0)ViewManager.ins().open(KFBossReliveWin,e,i);else if(ViewManager.ins().close(KFBossReliveWin),KFServerSys.ins().isKF){var s=Actor.yb-GlobalConfig.CrossBossBase.rebornCost;Actor.ins().postYbChange(s)}},e.prototype.postBossRevive=function(t){var e=t.readShort(),i=t.readShort();this.fbInfo[i]&&(1==e?this.fbInfo[i].flagRefTimer=egret.getTimer():2==e&&(this.fbInfo[i].bossRefTimer=egret.getTimer(),GlobalConfig.CrossBossConfig[i].type==KFBossType.TXMY&&this.openTxmyBossRemindWin(i)))},e.prototype.postRefFlag=function(t){this.flagHandle=t.readDouble(),this.flagCD=1e3*t.readInt()+egret.getTimer(),GameMap.fubenID!=GlobalConfig.CrossBossConfig[8].fbid?this.flagHandle=100010100101:this.flagHandle=0},e.prototype.postCollectFlag=function(t){var e=t.readDouble(),i=t.readInt();e&&e==Actor.handle&&i?(ViewManager.ins().open(CollectWin,e,i),GameLogic.ins().currAttackHandle=0):ViewManager.ins().close(CollectWin)},e.prototype.postInfo=function(t){this.flagTimes=t.readShort(),this.bossTimes=t.readShort();var e=t.readShort();this.enterCD=1e3*e+egret.getTimer(),this.enterNum9=t.readUnsignedByte(),this.txmyNum=t.readUnsignedShort(),this._hasBuyBelongNum[KFBossType.TXMY]=t.readUnsignedShort(),this.swlyUseNum=t.readInt()},e.prototype.doResult=function(t){for(var e=t.readShort(),i=[],s=t.readShort(),n=1==e,o=0;s>o;o++){var a=new RewardData;a.type=t.readInt(),a.count=t.readInt(),a.id=t.readInt(),i.push(a),0==a.type&&1!=a.id&&2!=a.id&&a.id!=MoneyConst.rune||n||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),a])}if(n)ResultManager.ins().create(GameMap.fbType,i,n);else{var r=function(){ResultManager.ins().create(GameMap.fbType,i,n)};DropHelp.start(),DropHelp.addCompleteFunc(r,this)}},e.prototype.postDropList=function(t){this.dropRecordDataList=[],this.dropBestRecordDataList=[];for(var e=t.readShort(),i=0;e>i;i++)this.dropRecordDataList.push(new KFDropRecordData(t));e=t.readShort();for(var i=0;e>i;i++){var s=new KFDropRecordData(t);s.isBest=!0,this.dropBestRecordDataList.push(s)}},e.prototype.postBroadcastResult=function(t){var e=t.readInt(),i=t.readString(),s=t.readDouble(),n=EntityManager.ins().getEntityByHandle(s);if(!n||n.action==EntityAction.DIE||n==SubRoles.lookAtTar)return"S"+e+i;for(var o=[],a=t.readShort(),r=0;a>r;r++){var l=new RewardData;l.type=t.readInt(),l.id=t.readInt(),l.count=t.readInt(),o.push(l),0==l.type&&1!=l.id&&2!=l.id&&l.id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(n.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(n.y/GameMap.CELL_SIZE),l])}var h=function(){};return DropHelp.start(n),DropHelp.addCompleteFunc(h,this),"S"+e+i},e.prototype.postEffigyInfo=function(t){var e=(t.readInt(),t.readByte()),i=t.readByte(),s=t.readString(),n=t.readString();n=n?n+"\n":"",GameMap.fbType==FbCT.FB_TYPE_KF_BOSS&&this.creatEffigy("{"+n+s,e,i)},e.prototype.setShieldPer=function(t){BossCT.ins().setShieldPer(t)},e.prototype.postBossChallengeResult=function(t){BossCT.ins().doBossChallengeResult(t)},e.prototype.postBossDestroyTime=function(t){this._destroyTime=DateUtils.formatMiniDateTime(t.readUnsignedInt())-GameServer.serverTime+egret.getTimer()},Object.defineProperty(e.prototype,"destroyTime",{get:function(){return this._destroyTime-egret.getTimer()},enumerable:!0,configurable:!0}),e.prototype.creatEffigy=function(t,e,i){var s,n=GameSceneView.ins,o=this.getStatuePos();o&&(s=new StatueView(KFServerSys.ins().isKFServ?"Title1qiang":"Title2qiang",t||"虚位以待","statue_"+e+"_"+i),s.x=o.x,s.y=o.y,n.map.addEntity(s))},e.prototype.getStatuePos=function(){for(var t in GlobalConfig.CrossBossConfig)if(GlobalConfig.CrossBossConfig[t].fbid==GameMap.fubenID)return GlobalConfig.CrossBossConfig[t].statuePos},e.prototype.postEnterKFBossFb=function(){this.lastKFBoss=!0,ViewManager.ins().isShow(BossBloodPanel)&&ViewManager.ins().open(BossBloodPanel),ViewManager.ins().close(KFBossShowWin),ViewManager.ins().open(KFBossSceneWin)},e.prototype.postQuiKFBossFb=function(){ViewManager.ins().close(BossBelongPanel),this.lastKFBoss=!1,this.flagHandle=0,ViewManager.ins().close(KFBossReliveWin),ViewManager.ins().close(KFBossSceneWin)},e.prototype.posthasBelongNum=function(t){this._hasBuyBelongNum[""+t.readByte()]=t.readUnsignedInt()},e.prototype.getHasBuyBelongNum=function(t){return this._hasBuyBelongNum[t]||0},e.prototype.doHelpInfo=function(t){if(this.isHelp=t.readBoolean(),this.isHelp||(this.helpInfo=t.readString()),this.helpInfo){var e=new GuildMessageInfo;e.content=this.helpInfo,e.type=1,Guild.ins().guildMessageInfoData.addItem(e),ChatCT.ins().insertAllChatMsg(e),ChatCT.ins().postNewChatMsg(e),e.cd=120,this.info.push(e)}Timer.has(this.resetCD,this)||Timer.start(1e3,0,this.resetCD,this),!Timer.has(this.updateTime,this)&&this.info.length>0&&Timer.start(1e3,0,this.updateTime,this)},e.prototype.resetCD=function(){for(var t in this.info)this.info[t].cd>0&&this.info[t].cd--;0==this.info.length&&Timer.stop(this.resetCD,this)},e.prototype.updateTime=function(){for(var t in this.info)!this.info[t].cd&&Guild.ins().guildMessageInfoData.getItemIndex(this.info[t])>=0&&(Guild.ins().guildMessageInfoData.removeItemAt(Guild.ins().guildMessageInfoData.getItemIndex(this.info[t])),this.info.splice(this.info.indexOf(this.info[t]),1));0==this.info.length&&Timer.stop(this.updateTime,this)},e.prototype.postHelpNum=function(t){for(var e=t.readByte(),i=0;e>i;i++)this.helpNum[i]=t.readByte()},e.prototype.postElert=function(t){for(var e=t.readString(),i=t.readShort(),s=[],n=0;i>n;n++){var o={type:t.readByte(),id:t.readInt(),count:t.readInt()};s.push(o)}ResultManager.ins().create(GameMap.fbType==FbCT.FB_TYPE_KF_BOSS?FbCT.FB_TYPE_KF_BOSS:FbCT.FB_TYPE_KF_BOSS2,s,1,e)},e.prototype.postCanHelpNum=function(t){var e=t.readByte();this.helpNum[e-1]&&(this.helpNum[e-1]=t.readByte())},e.prototype.sendBossInfo=function(){this.sendBaseProto(1)},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(3)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(4)},e.prototype.sendEnter=function(t){var e=this.getBytes(6);e.writeUnsignedShort(t),this.sendToServer(e)},e.prototype.sendCollectFlag=function(){this.sendBaseProto(8)},e.prototype.sendDropList=function(){this.sendBaseProto(11)},e.prototype.sendRelive=function(){this.sendBaseProto(27)},e.prototype.sendBugBelongNum=function(t){var e=this.getBytes(29);e.writeByte(t),this.sendToServer(e)},e.prototype.sendUpItemId=function(t){var e=this.getBytes(30);e.writeByte(t),this.sendToServer(e)},e.prototype.sendHelpLottery=function(t){var e=this.getBytes(31);e.writeString(t),this.sendToServer(e)},e.ins=function(){return t.ins.call(this)},e.prototype.isOpen=function(){return GlobalConfig.CrossBossBase.openDay<=GameServer.serverOpenDay+1&&ZsCT.ins().lv>=5},Object.defineProperty(e.prototype,"fieldisOpen",{get:function(){return GlobalConfig.CrossBossBase.kfIconOpenDay<=GameServer.serverOpenDay+1&&ZsCT.ins().lv>=GlobalConfig.CrossBossBase.limitZsLv},enumerable:!0,configurable:!0}),e.prototype.getBossShowAward=function(t){var e=GameServer.serverOpenDay+1,i=[];for(var s in t)e>=+s&&(i=t[s].concat());return i},e.prototype.getTxmyLayerByDpId=function(t){var e=[],i=GlobalConfig.CrossBossConfig[t].masterLevelLimit;for(var s in GlobalConfig.CrossBossConfig){var n=GlobalConfig.CrossBossConfig[s];n.type==KFBossType.TXMY&&-1==e.indexOf(n.masterLevelLimit)&&e.push(n.masterLevelLimit)}return e.indexOf(i)},e.prototype.canChallengeTxmy=function(t){var e=GlobalConfig.CrossBossConfig[t];if(!GlobalConfig.CrossBossConfig[t]||e.type!=KFBossType.TXMY)return!1;var i=PowerEquipCT.ins().powerEquipLevel;return i<e.masterLevelLimit?!1:ZsCT.ins().lv>=e.levelLimit[0]/1e3},e.prototype.txmyBossRemindInfo=function(){var t=[],e=PowerEquipCT.ins().powerEquipLevel;for(var i in this.fbInfo){var s=this.fbInfo[i],n=GlobalConfig.CrossBossConfig[s.dpId];if(!(n.type!=KFBossType.TXMY||e<n.masterLevelLimit)){var o=new WorldBossItemData;o.id=n.id,o.bossAlert=n.id+5e3,o.bossType=BossCT.BOSS_SUBTYPE_TXMY,t.push(o)}}return t},e.prototype.openTxmyBossRemindWin=function(t){var i=GlobalConfig.CrossBossConfig[t];if(this.canChallengeTxmy(i.id)&&!(e.ins().txmyNum<=0)){var s=GlobalConfig.MonstersConfig[i.bossId],n=new BossRemindInfo;n.title=i.sceneName,n.head="monhead"+s.head+"_png",n.name=s.name,n.btnFun=e.ins().openTxmyWin,n.tipsFun=e.ins().openTxmyTipsWin,n.winParam=this.getTxmyLayerByDpId(i.id),BossCT.ins().getBossRemindByIndex(i.id+5e3)&&ViewManager.ins().open(BossRemindWin,n)}},e.prototype.openTxmyWin=function(t){ViewManager.ins().open(BossWin,2,1),ViewManager.ins().close(BossRemindWin)},e.prototype.openTxmyTipsWin=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_TXMY),ViewManager.ins().close(BossRemindWin)},e.prototype.txmyIsOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.CrossBossBase,i="";if(e.txmyOpen[1]>GameServer.serverOpenDay+1)i="开服"+e.txmyOpen[1]+"天开启";else if(ZsCT.ins().lv<e.txmyOpen[0])i=e.txmyOpen[0]+"转开启";else{var s=!1;for(var n in this.fbInfo){var o=this.fbInfo[n],a=GlobalConfig.CrossBossConfig[o.dpId];if(a&&a.type==KFBossType.TXMY){s=!0;break}}s||(i="当前暂未开放")}return t&&""!=i&&TipsCT.ins().showTips(i),""==i},__decorate([post()],e.prototype,"postBossInfo",null),__decorate([post()],e.prototype,"postAscriptionChange",null),__decorate([post()],e.prototype,"postRevive",null),__decorate([post()],e.prototype,"postBossRevive",null),__decorate([post()],e.prototype,"postRefFlag",null),__decorate([post()],e.prototype,"postCollectFlag",null),__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postDropList",null),__decorate([post()],e.prototype,"postBroadcastResult",null),__decorate([post()],e.prototype,"postEffigyInfo",null),__decorate([post()],e.prototype,"postBossChallengeResult",null),__decorate([post()],e.prototype,"postBossDestroyTime",null),__decorate([post()],e.prototype,"postEnterKFBossFb",null),__decorate([post()],e.prototype,"postQuiKFBossFb",null),__decorate([post()],e.prototype,"posthasBelongNum",null),__decorate([post()],e.prototype,"doHelpInfo",null),__decorate([post()],e.prototype,"postHelpNum",null),__decorate([post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postCanHelpNum",null),e
}(BaseSystem);__reflect(KFBossSys.prototype,"KFBossSys");var KFBossType;!function(t){t[t.KF=1]="KF",t[t.SYMD=2]="SYMD",t[t.TXMY=3]="TXMY"}(KFBossType||(KFBossType={})),window.KFBossType=KFBossType,System.KFBossSys=function(){return KFBossSys.ins()},window.KFBossSys=KFBossSys;var KFBossData=function(){function t(){}return t}();__reflect(KFBossData.prototype,"KFBossData");var KFBossInfoData=function(){function t(t){this.dpId=t.readShort(),this.serverId=t.readInt(),this.bossRefTimer=1e3*t.readInt()+egret.getTimer(),this.flagRefTimer=1e3*t.readInt()+egret.getTimer(),this.hpPercent=t.readInt(),8==this.dpId&&(this.flagRefTimer=Number.MAX_VALUE+egret.getTimer())}return t}();__reflect(KFBossInfoData.prototype,"KFBossInfoData"),window.KFBossData=KFBossData;var KFBossFbPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangingEvent(this.tab,this.onTabTouching)},e.prototype.addDisplay=function(){this.observe(KFBossRedpoint.ins().postRedPoint,this.updateRedPoint),this.updateRedPoint()},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){switch(this.viewStack.getElementAt(t)){case this.KFBossWin:break;case this.kfSymdPanel:if(ZsCT.ins().lv<GlobalConfig.CrossBossBase.symdOpen[0])return TipsCT.ins().showTips(GlobalConfig.CrossBossBase.symdOpen[0]+"转开启功能"),!1;if(GameServer.serverOpenDay+1<GlobalConfig.CrossBossBase.symdOpen[1])return TipsCT.ins().showTips("开服"+GlobalConfig.CrossBossBase.symdOpen[1]+"天开启"),!1}return!0},e.prototype.updateRedPoint=function(){this.tab&&this.tab.numChildren>=2&&(this.tab.getChildAt(0).eRp.visible=KFBossRedpoint.ins().redpointGroup1,this.tab.getChildAt(1).eRp.visible=KFBossRedpoint.ins().redpointGroup2)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=KFBossSys.ins().isOpen();return i||TipsCT.ins().showTips("|C:0xf3311e&T:条件不够，不可进入"),i},__decorate([callLater],e.prototype,"updateRedPoint",null),e}(BaseView);__reflect(KFBossFbPanel.prototype,"KFBossFbPanel"),window.KFBossFbPanel=KFBossFbPanel;var KFBossReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onRelive),this.addTouchEvent(this.exitBtn,this.onTap),GameMap.fbType==FbCT.FB_TYPE_Legend?this.setKill(t[0],t[1]):this.setWin(t[0],t[1],t[2])},e.prototype.setKill=function(t,e){e&&(this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+e+"|击败"),this.revive.visible=this.alive.visible=!1,this.reliveBtn.visible=this.reliveTimesTxt.visible=this.relive.visible=this.moneyIcon.visible=!1),this.revive.visible=!0,this.revive.textFlow=TextFlowMaker.generateTextFlow1("|C:0xffff00&T:"+t+"秒||C:0xe2dfd4&T:后在||C:0xffff00&T:群雄塔"+LegendTowerCT.ins().layer+"层||C:0xe2dfd4&T:复活"),Timer.stop(this.refushLabel,this),this.remainM=t,Timer.start(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.setWin=function(t,e,i){if(i)this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+i+"|击败"),this.alive.visible=!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1"),this.revive.visible=!1;else if(e>0){var s=EntityManager.ins().getEntityByHandle(e),n="";if(s){var o=EntityManager.ins().getEntityByHandle(s.infoModel.masterHandle);n=s instanceof CharRole?s.infoModel.name:s.infoModel.masterHandle&&o?""+o.infoModel.name:"Boss"+s.infoModel.name}this.killTips.textFlow=TextFlowMaker.generateTextFlow1("你被|C:2343978&T:"+n+"|击败"),this.alive.visible=!1,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1"),this.revive.visible=!1}switch(GameMap.fbType){case FbCT.FB_TYPE_XUANWU:this.reliveBtn.label=GlobalConfig.XuanWuBossBase.rebornCost+"原地复活";break;case FbCT.FB_TYPE_SPIRIT:this.reliveBtn.label=GlobalConfig.SpiritForbiddenLandBaseConfig.rebornPrice+"原地复活";break;case FbCT.FB_TYPE_SMYJ:this.reliveBtn.label=GlobalConfig.DevilRuinsBase.rebornCost+"原地复活";break;case FbCT.FB_TYPE_KING:this.reliveBtn.label=GlobalConfig.KingFuBenBaseConfig.needYb+"原地复活";break;default:this.reliveBtn.label=GlobalConfig.CrossBossBase.rebornCost+"原地复活"}this.reliveTimesTxt.text=t+"秒",Timer.stop(this.refushLabel,this),this.remainM=t,Timer.start(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){return this.remainM--,this.remainM<=0?void ViewManager.ins().close(e):void(GameMap.fbType==FbCT.FB_TYPE_Legend?this.revive.textFlow=TextFlowMaker.generateTextFlow1("|C:0xffff00&T:"+this.remainM+"秒||C:0xe2dfd4&T:后在||C:0xffff00&T:群雄塔"+LegendTowerCT.ins().layer+"层||C:0xe2dfd4&T:复活"):this.reliveTimesTxt.text=this.remainM+"秒")},e.prototype.overTime=function(){ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.exitBtn:FbCT.ins().sendExitFb()}},e.prototype.onRelive=function(t){switch(GameMap.fbType){case FbCT.FB_TYPE_Legend:break;case FbCT.FB_TYPE_SPIRIT:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.SpiritForbiddenLandBaseConfig.rebornPrice,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&(SpiritBossCT.ins().sendClearReliveCD(),SpiritBossCT.ins().isInit=1,ViewManager.ins().close(e));break;case FbCT.FB_TYPE_SMYJ:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.DevilRuinsBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&(KFSmyjBossCT.ins().sendRevive(),KFSmyjBossCT.ins().isInit=1,ViewManager.ins().close(e));break;case FbCT.FB_TYPE_KING:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.KingFuBenBaseConfig.needYb,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&(KingAreaCT.ins().sendRevive(),ViewManager.ins().close(e));break;case FbCT.FB_TYPE_XUANWU:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.XuanWuBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&XuanWuCT.ins().sendClearReliveCD();break;case FbCT.FB_TYPE_KF_BOSS:case FbCT.FB_TYPE_KF_BOSS2:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.CrossBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&KFBossSys.ins().sendClearReliveCD();break;case FbCT.FB_TYPE_GUILDFB:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.CrossBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&(GuildFBCT.ins().sendRevive(),ViewManager.ins().close(e));break;default:(this.aliveNum||GlobalFun.checkMoney(GlobalConfig.CrossBossBase.rebornCost,MoneyConst.yuanbao,"元宝不足，无法立即复活"))&&KFBossSys.ins().sendRelive()}},e}(BaseEuiView);__reflect(KFBossReliveWin.prototype,"KFBossReliveWin"),ViewManager.ins().reg(KFBossReliveWin,LayerManager.UI_Popup),window.KFBossReliveWin=KFBossReliveWin;var KFBossResultWin=function(t){function e(){var e=t.call(this)||this;return e._quitTime=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.bg.source="win_png",this.closeBtn.label="确定",this.title.source="win_02",this.roleTitleLabel.text=e[1]?"旗子归属者：":"BOSS归属者",this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"FireWork",1);var s=e[2]?e[2]:Actor.myName;s=StringUtils.replaceStr(s,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(s),this.labelItem.text="我的归属奖：";var n=SubRoles.ins().getSubRoleByIndex(0);n&&(this.eFace.source="yuanhead"+n.job+n.sex);var o=e[0];o&&this.setRewardList(o),this._quitTime=6,Timer.start(1e3,this._quitTime+1,this.onTimer,this),this.onTimer(),e[2]&&e[2]!=Actor.myName&&GameMap.fbType!=FbCT.FB_TYPE_Legend?this.eRewardTitle.source="win_xiezhu_png":this.eRewardTitle.source="win_guishu_png"},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],s=[],n=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?n.push(t[a]):e.push(t[a]):s.push(t[a]);else if(i.length){for(var l=!1,h=0;h<i.length;h++)if(i[h].id==t[a].id){i[h].count+=t[a].count,l=!0;break}l||i.push(t[a])}else i.push(t[a])}s.sort(this.RuleSortByItem),o=n.concat(e,i,s),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTimer=function(){this.closeBtn.label="确定("+--this._quitTime+")",this._quitTime<=0&&ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],s=GlobalConfig.ItemConfig[e.id],n=ItemUtil.getQuality(i),o=ItemUtil.getQuality(s);return n>o?-1:o>n?1:0},e}(BaseEuiView);__reflect(KFBossResultWin.prototype,"KFBossResultWin"),window.KFBossResultWin=KFBossResultWin,ViewManager.ins().reg(KFBossResultWin,LayerManager.UI_Popup);var KFBossSceneWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="kfBossSceneSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(KFBossSys.ins().postBroadcastResult,this.bossEnd),this.observe(SpiritBossCT.ins().postMonState,this.monsEnd),this.observe(GameLogic.ins().postRemoveEntity,this.onRemove),this.observe(KFBossSys.ins().postBossInfo,this.checkBossRelive),this.observe(XuanWuCT.ins().postBossDestroyTime,this.xuanWuBossUpdate),this.observe(KFBossSys.ins().postBossDestroyTime,this.kfBossUpdateEx),this.endGroup.visible=!1;var t=GameMap.fubenID;if(this.bossRefTimer=0,GameMap.fbType==FbCT.FB_TYPE_XUANWU)this.eTopRight.visible=!1,this.bossRefTimer=XuanWuCT.ins().destroyTime,this.eTimeGroup.visible=!1,this.winnerName.visible=!1,this.eTip.visible=!0,this.xuanWuBossUpdate();else if(KFBossSys.ins().isKFBossBattle){for(var e in GlobalConfig.CrossBossConfig)if(t==GlobalConfig.CrossBossConfig[e].fbid){var i=GlobalConfig.CrossBossConfig[e],s=KFBossSys.ins().fbInfo[i.id];this.nameTxt.text="跨服战场"==i.sceneName?"S."+s.serverId+"跨服战场":i.sceneName,this.curInfo=KFBossSys.ins().fbInfo[i.id],this.dpId=i.id,this.eTopRight.visible=!0,this.openBossList=CommonUtils.objectToArrayShallow(i.openBossList);break}this.checkBossRelive()}else this.curInfo=null,this.nameTxt.text=GameMap.fbName,this.bossRefTimer=KFBossSys.ins().destroyTime,this.eTopRight.visible=!0,this.bossRefTimeLabel.text="",this.kfBossUpdateEx()},e.prototype.removeDisplay=function(){Timer.stopAll(this),this.endGroup&&egret.Tween.removeTweens(this.endGroup)},e.prototype.xuanWuBossUpdate=function(){this.bossRefTimer<=0||(this.endGroup.visible=!0,this.eTip.visible=!0,this.bossRefTimer=XuanWuCT.ins().destroyTime,Timer.has(this.xuanWuBossDestroy,this)||Timer.start(1e3,MathUtils.toInteger(this.bossRefTimer/1e3),this.xuanWuBossDestroy,this),this.xuanWuBossDestroy())},e.prototype.xuanWuBossDestroy=function(){var t=MathUtils.toInteger(XuanWuCT.ins().destroyTime/1e3);t>0?this.eTip.text="BOSS已被击杀\n"+t+"秒后自动退出副本":(Timer.stop(this.xuanWuBossDestroy,this),this.eTip.text="BOSS已被击杀")},e.prototype.kfBossUpdateEx=function(){this.bossRefTimer<=0||(this.endGroup.visible=!0,this.eTip.visible=!0,this.bossRefTimer=KFBossSys.ins().destroyTime,Timer.has(this.kfBossDestroyEx,this)||Timer.start(1e3,MathUtils.toInteger(this.bossRefTimer/1e3),this.kfBossDestroyEx,this),this.kfBossDestroyEx())},e.prototype.kfBossDestroyEx=function(){var t=MathUtils.toInteger(KFBossSys.ins().destroyTime/1e3);t>0?this.eTip.text="BOSS已被击杀\n"+t+"秒后自动退出副本":(Timer.stop(this.kfBossDestroyEx,this),this.eTip.text="BOSS已被击杀")},e.prototype.onRemove=function(t){var e=t[0];e instanceof CharRole||!e.infoModel||!this.openBossList||this.openBossList.indexOf(e.infoModel.configID)<0||this.curInfo&&(this.curInfo.bossRefTimer=1e3*GlobalConfig.CrossBossConfig[this.curInfo.dpId].refreshTime+egret.getTimer(),this.checkBossRelive())},e.prototype.checkBossRelive=function(){if(this.curInfo=KFBossSys.ins().fbInfo[this.dpId],this.curInfo){var t=(this.curInfo.bossRefTimer-egret.getTimer())/1e3>>0;Timer.has(this.onBossRelive,this)||Timer.start(1e3,t+2,this.onBossRelive,this),this.onBossRelive()}},e.prototype.onBossRelive=function(){if(this.curInfo){var t=(this.curInfo.bossRefTimer-egret.getTimer())/1e3>>0;t>0?(this.bossRefTimeLabel.text="boss复活："+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3),this.nameTxt.y=8):(Timer.stop(this.onBossRelive,this),this.bossRefTimeLabel.text="",this.nameTxt.y=18)}},e.prototype.bossEnd=function(t){var e=this;GameMap.fbType==FbCT.FB_TYPE_KF_BOSS&&(this.endGroup.visible=!0,this.endGroup.alpha=1,this.winnerName.text="最终归属者是："+t,Timer.start(1e4,1,function(){e.endGroup&&egret.Tween.get(e.endGroup).to({alpha:0},300).call(function(){e.endGroup&&(e.endGroup.visible=!1)})},this))},e.prototype.monsEnd=function(t){var e=this;GameMap.fbType==FbCT.FB_TYPE_SPIRIT&&t&&(this.endGroup.visible=!0,this.endGroup.alpha=1,this.winnerName.text=t[0]+"归属者是："+t[1],Timer.start(1e4,1,function(){e.endGroup&&egret.Tween.get(e.endGroup).to({alpha:0},300).call(function(){e.endGroup&&(e.endGroup.visible=!1)})},this))},e}(BaseEuiView);__reflect(KFBossSceneWin.prototype,"KFBossSceneWin"),window.KFBossSceneWin=KFBossSceneWin,ViewManager.ins().reg(KFBossSceneWin,LayerManager.UI_Main);var KFBossShowWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFBossShowSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.boss.touchEnabled=!1,this.boss.touchChildren=!1,this.dropRewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.challengeBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.fbId=t[0],this.dp=GlobalConfig.CrossBossConfig[this.fbId],this.showAward(),this.showBoss(),this.bossName.source="kf_name_"+this.dp.bossId},e.prototype.showAward=function(){var t=this.dp.belongRewardshow,e=KFBossSys.ins().getBossShowAward(t);this.dropRewardList.dataProvider=new eui.ArrayCollection(e)},e.prototype.showBoss=function(){this.bossMc||(this.bossMc=ObjectPool.pop("MovieClip"),this.bossMc.scaleX=-1,this.bossMc.scaleY=1,this.bossMc.x=78,this.bossMc.y=50,this.boss.addChild(this.bossMc));var t=this.dp.bossId,e=GlobalConfig.MonstersConfig[t];this.bossMc.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)},e.prototype.onTouch=function(t){var e=this;switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.challengeBtn:if(!KfArenaSys.ins().checkIsMatching())return;var i=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(i>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+i+"秒后可以进入！");if(ZsCT.ins().lv<this.dp.levelLimit[0]/1e3||ZsCT.ins().lv>this.dp.levelLimit[1]/1e3)return void TipsCT.ins().showTips("|C:0xf3311e&T:需要转生等级到达"+(this.dp.levelLimit[0]/1e3>>0)+"转！");var s=BagCT.ins().getBagItemById(GlobalConfig.CrossBossBase.swyscroll),n=s?s.count:0,o=KFBossSys.ins().bossTimes+n;o>0?RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,o,function(){KFBossSys.ins().sendEnter(e.fbId),KFBossSys.ins().kfBossCfgID=e.fbId}):(KFBossSys.ins().sendEnter(this.fbId),KFBossSys.ins().kfBossCfgID=this.fbId)}},e}(BaseEuiView);__reflect(KFBossShowWin.prototype,"KFBossShowWin"),window.KFBossShowWin=KFBossShowWin,ViewManager.ins().reg(KFBossShowWin,LayerManager.UI_Popup);var KFBossUIWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFbossUISkin",e.attackList.itemRenderer=TargetMemberHeadRender,e.attackedList.itemRenderer=TargetMemberHeadRender,e}return __extends(e,t),e}(BaseEuiView);__reflect(KFBossUIWin.prototype,"KFBossUIWin"),window.KFBossUIWin=KFBossUIWin,ViewManager.ins().reg(KFBossUIWin,LayerManager.UI_Main);var KFBossWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFBossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=1;8>=t;t++){this["island"+t].island.source="kf_boss_area"+t,this["island"+t].touchChildren=!1,this["island"+t].filters=FilterUtil.ARRAY_GRAY_FILTER;var e=GlobalConfig.CrossBossConfig[t],i=[e.levelLimit[0]/1e3>>0,e.levelLimit[1]/1e3>>0];this["island"+t].info.text=i[0]+"转-"+i[1]+"转",this["island"+t].info.textColor=i[0]<=ZsCT.ins().lv&&ZsCT.ins().lv<=i[1]?ColorUtil.GREEN:ColorUtil.RED,this["island"+t].serverInfo.visible=!1}this.eTip.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eTip.text+"</u>"),this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){this.observe(KFBossSys.ins().postBossInfo,this.refData),this.observe(KFBossSys.ins().postBossRevive,this.refData),this.observe(KFBossRedpoint.ins().postRedPoint,this.refRedpoint),this.observe(BagCT.ins().postItemCountChange,this.updateItem),this.observe(BagCT.ins().postItemAdd,this.updateItem),this.observe(BagCT.ins().postItemDel,this.updateItem),this.observe(KFBossSys.ins().postInfo,this.refData),this.observe(KFBossSys.ins().postHelpNum,this.refData),this.observe(KFBossSys.ins().postCanHelpNum,this.refData),this.updateItem(),this.upCurState(),KFBossSys.ins().sendBossInfo()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.updateItem=function(){var t=GlobalConfig.CrossBossBase.swyscroll;this.item=BagCT.ins().getBagItemById(t),this.jicon.source=GlobalConfig.ItemConfig[t].icon+"_png",this.jcount.text=this.item?this.item.count+"":"0"},e.prototype.upCurState=function(){var t=0,e=KFBossSys.ins().fbInfo;for(var i in e)e[i]&&GlobalConfig.CrossBossConfig[e[i].dpId].type==KFBossType.KF&&t++;t>=8?this.currentState="7":7==t?this.currentState="6":7>t&&(this.currentState="5"),this.refData(),this.refRedpoint()},e.prototype.refData=function(){this.flagTimes.text=KFBossSys.ins().flagTimes+"",this.bossTimes.text=KFBossSys.ins().bossTimes+"",this.helpTimes.text=KFBossSys.ins().helpNum[KFBossType.KF-1]+"";for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i&&GlobalConfig.CrossBossConfig[i.dpId].type==KFBossType.KF){var s=i.dpId;if(this["island"+s])if(this["island"+s].headGroup.visible=!1,this["island"+s].head.source="",this["island"+s].name=i.dpId,this["island"+s].filters=[],i.serverId)if(this["island"+s].serverInfo.visible=!0,this["island"+s].serverName.text=""+(i.serverId==LocationProperty.srvid?"本服":"S."+i.serverId+"服"),i.serverId==LocationProperty.srvid){this["island"+s].headGroup.visible=!0;var n=SubRoles.ins().getSubRoleByIndex(0);this["island"+s].head.source="yuanhead"+n.job+n.sex}else this["island"+s].serverName.x=13;else this["island"+s].serverInfo.visible=!1}}Timer.stop(this.onTimer,this),Timer.start(1e3,0,this.onTimer,this),this.onTimer()},e.prototype.onTimer=function(){for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];if(i&&GlobalConfig.CrossBossConfig[i.dpId].type==KFBossType.KF&&0!=i.bossRefTimer){var s=GlobalConfig.CrossBossConfig[i.dpId],n=(i.bossRefTimer-egret.getTimer())/1e3>>0,o="";n>0&&(o="\n"+DateUtils.getFormatBySecond(n)),this["island"+i.dpId]?this["island"+i.dpId].info.text=(s.levelLimit[0]/1e3>>0)+"转-"+(s.levelLimit[1]/1e3>>0)+"转"+o:(37==i.dpId||38==i.dpId)&&ZsCT.ins().lv>=s.levelLimit[0]/1e3&&(this.island8.info.text=(s.levelLimit[0]/1e3>>0)+"转-"+(s.levelLimit[1]/1e3>>0)+"转"+o)}}},e.prototype.refRedpoint=function(){for(var t=0,e=KFBossSys.ins().fbInfo;t<e.length;t++){var i=e[t];i&&GlobalConfig.CrossBossConfig[i.dpId].type==KFBossType.KF&&this["island"+i.dpId]&&(this["island"+i.dpId].redPoint.visible=KFBossRedpoint.ins().redpoints[i.dpId])}},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[34].text);break;case this.closeBtn:ViewManager.ins().close(this);break;case this.eTip:ViewManager.ins().open(RareListWin);break;default:if(t.target instanceof eui.Component){var e=parseInt(t.target.name);if(!e)return void TipsCT.ins().showTips("|C:0xf3311e&T:暂未开启!");8==e?ViewManager.ins().open(KFBossShowWin2,[e,37,38]):ViewManager.ins().open(KFBossShowWin,e)}}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=KFBossSys.ins().isOpen();return i||TipsCT.ins().showTips("|C:0xf3311e&T:条件不够，不可进入"),i},__decorate([callLater],e.prototype,"refData",null),__decorate([callLater],e.prototype,"refRedpoint",null),e}(BaseView);__reflect(KFBossWin.prototype,"KFBossWin"),window.KFBossWin=KFBossWin;var KFsymdBossItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._fbId=0,e.isOpen=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.itemList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onClick),this.gray.filters=FilterUtil.ARRAY_GRAY_FILTER},e.prototype.addDisplay=function(){this.observe(KFBossRedpoint.ins().postRedPoint,this.updateRedpoint),Timer.stop(this.onTimer,this),Timer.start(1e3,0,this.onTimer,this),this.update(),this.onTimer(),this.updateRedpoint()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onClick=function(t){if(t.target==this.island){if(!KfArenaSys.ins().checkIsMatching())return;if(!this.isOpen)return void TipsCT.ins().showTips("未达到转生等级");var e=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(e>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+e+"秒后可以进入！");KFBossSys.ins().sendEnter(this._fbId),KFBossSys.ins().kfBossCfgID=this._fbId}},e.prototype.setFbId=function(t){this._fbId=t,this.update(),this.onTimer()},e.prototype.update=function(){if(this.skin&&0!=this._fbId){this.island.source="kf_boss_area"+this._fbId;var t=GlobalConfig.CrossBossConfig[this._fbId];this.isOpen=ZsCT.ins().lv>=t.levelLimit[0]/1e3,this.eNameLab.text=GlobalConfig.CrossBossConfig[this._fbId].sceneName,this.lv.source="kf_symd_level"+(this._fbId-8)+"_png",this.lv.visible=!this.isOpen;for(var e=KFBossSys.ins().getBossShowAward(t.belongRewardshow);e.length>3;)e.shift();this.itemList.dataProvider=new eui.ArrayCollection(e)}},e.prototype.updateRedpoint=function(){this.skin&&(this.redPoint.visible=1==KFBossRedpoint.ins().redpoints[this._fbId])},e.prototype.onTimer=function(){if(this.isOpen){var t=KFBossSys.ins().fbInfo[this._fbId];if(!t||t.bossRefTimer<=0)return this.time.visible=!1,this.eNameLab.visible=!this.time.visible,void(this.gray.filters=this.eNameLab.visible?FilterUtil.ARRAY_GRAY_FILTER:[]);var e=(t.bossRefTimer-egret.getTimer())/1e3>>0;e>0?(this.time.visible=!0,this.info.text=DateUtils.getFormatBySecond(e)):this.time.visible=!1,this.eNameLab.visible=!this.time.visible,this.gray.filters=this.eNameLab.visible?[]:FilterUtil.ARRAY_GRAY_FILTER}},__decorate([callLater],e.prototype,"updateRedpoint",null),e}(BaseView);__reflect(KFsymdBossItem.prototype,"KFsymdBossItem"),window.KFsymdBossItem=KFsymdBossItem;var KFsymdBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.START=9,e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t in GlobalConfig.CrossBossConfig)if(GlobalConfig.CrossBossConfig[t].type==KFBossType.SYMD){this.START=GlobalConfig.CrossBossConfig[t].id;break}this.island1.setFbId(this.START),this.island2.setFbId(this.START+1),this.island3.setFbId(this.START+2)},e.prototype.addDisplay=function(){this.observe(KFBossSys.ins().postInfo,this.updateNum),this.observe(KFBossSys.ins().postBossInfo,this.updateUI),this.observe(KFBossSys.ins().postBossRevive,this.updateUI),this.observe(BagCT.ins().postItemCountChange,this.updateItem),this.observe(BagCT.ins().postItemAdd,this.updateItem),this.observe(BagCT.ins().postItemDel,this.updateItem),this.observe(KFBossSys.ins().postHelpNum,this.updateHelpNum),this.observe(KFBossSys.ins().postCanHelpNum,this.updateHelpNum),this.updateItem(),this.updateUI(),this.updateNum(),this.updateHelpNum(),KFBossSys.ins().sendBossInfo()},e.prototype.updateItem=function(){var t=GlobalConfig.CrossBossBase.symdscroll,e=BagCT.ins().getBagItemById(t);this.jicon.source=GlobalConfig.ItemConfig[t].icon+"_png",this.jcount.text=e?e.count+"":"0"},e.prototype.updateNum=function(){this.bossTimes0.text=KFBossSys.ins().enterNum9+""},e.prototype.updateHelpNum=function(){this.helpTimes.text=KFBossSys.ins().helpNum[KFBossType.SYMD-1]+""},e.prototype.updateUI=function(){this.island1.update(),this.island2.update(),this.island3.update()},__decorate([callLater],e.prototype,"updateUI",null),e}(BaseView);__reflect(KFsymdBossPanel.prototype,"KFsymdBossPanel"),window.KFsymdBossPanel=KFsymdBossPanel;var RareListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RareListItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&this.data instanceof KFDropRecordData&&(this.time.text=DateUtils.getFormatBySecond(this.data.time,DateUtils.TIME_FORMAT_8),this.des.textFlow=TextFlowMaker.generateTextFlow("s"+(this.data.servId+this.data.nick)+" 击败了|C:16711680&T: "+this.data.bossName+"| 获得了|C:16711680&T:"+GlobalConfig.ItemConfig[this.data.goodsId].name+"|"),this.zhiding.visible=this.data.isBest)},e}(BaseItemRender);__reflect(RareListItem.prototype,"RareListItem"),window.RareListItem=RareListItem;var RareListWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RareListSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.record.itemRenderer=RareListItem},e.prototype.addDisplay=function(){this.observe(KFBossSys.ins().postDropList,this.update),KFBossSys.ins().sendDropList()},e.prototype.update=function(){var t=KFBossSys.ins().dropRecordDataList,e=[],i=[];for(var s in t)t[s].type==KFDropType.KF_BOSS&&(i.length<3&&ItemUtil.getType(GlobalConfig.ItemConfig[t[s].goodsId])==ItemType.TYPE_8?(t[s].isBest=!0,i.push(t[s])):e.push(t[s]));this.record.dataProvider=new eui.ArrayCollection(i.concat(e))},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(RareListWin.prototype,"RareListWin"),window.RareListWin=RareListWin,ViewManager.ins().reg(RareListWin,LayerManager.UI_Popup);var KFBattleWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFFieldWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.initFields()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.initFields=function(){this.fields=[];var t=GlobalConfig.CrossFieldConfig;for(var e in t){var i=new KFFieldItem;i.init(t[e]),this.eIslandsGroup.addChild(i),this.fields.push(i)}},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(e);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[33].text)}},e}(BaseEuiView);__reflect(KFBattleWin.prototype,"KFBattleWin"),window.KFBattleWin=KFBattleWin,ViewManager.ins().reg(KFBattleWin,LayerManager.UI_Main);var KFFieldItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFFieldItemSkin",e}return __extends(e,t),e.prototype.init=function(t){this.cfg=t},e.prototype.skinComplete=function(){this.iconMc=new MovieClip,this.iconMc.visible=!1,this.boossGroup.addChild(this.iconMc),this.x=this.cfg.pos[0],this.y=this.cfg.pos[1],this.touchEnabled=!0,this.touchChildren=!1,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){this.observe(Actor.ins().postLevelChange,this.updateRed),this.observe(DevildomRedPoint.ins().postRedPoint,this.updateRed),this.observe(KfArenaRedPoint.ins().postRedPoint,this.updateRed),this.observe(DartRedPoint.ins().postRedPoint,this.updateRed),this.observe(PeakedRedpoint.ins().postRedPoint,this.updateRed),this.update()},e.prototype.onClick=function(t){if("lock"==this.currentState)return void TipsCT.ins().showTips("|C:0xff0000&T:功能暂未开放|");var e;switch(this.cfg.id){case 1:e=ViewManager.ins().open(DevilInvadeWin);break;case 2:e=ViewManager.ins().open(KfArenaWin,KfArenaWin.Page_Select_Macth);break;case 3:e=ViewManager.ins().open(CrossDartWin);break;case 4:e=ViewManager.ins().open(PeakedMainWin);break;case 6:e=ViewManager.ins().open(CrossGuildBattleWin);break;case 7:ViewManager.ins().open(LegendTowerWin)}null!=e&&ViewManager.ins().close(KFBattleWin)},e.prototype.update=function(){this.skin&&(this.currentState=1==this.cfg.isClose?"lock":"unlock",egret.callLater(this.updateUI,this))},e.prototype.updateUI=function(){if("lock"!=this.currentState){if(this.cfg.icon&&this.cfg.icon.length>0?this.island.source=this.cfg.icon:this.island.source="",this.cfg.iconMc&&this.cfg.iconMc.length>0?(this.iconMc.visible=!0,this.iconMc.playFile(RES_DIR_EFF+this.cfg.iconMc,-1)):(this.iconMc.stop(),this.iconMc.visible=!1),this.title.source=this.cfg.title,1==this.cfg.id&&!DevildomSys.ins().isHfTerm()){this.eEffGroup.removeChildren();var t=new MovieClip;this.iconMc.playFile(RES_DIR_EFF+"mojieruqin_off",-1),this.eEffGroup.addChild(t)}2==this.cfg.id||3==this.cfg.id?this.updateTime():1!=this.cfg.id&&(this.eTimeLab.text=""),this.updateRed()}},e.prototype.enterFrame=function(){switch(this.cfg.id){case 1:var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime)+GlobalConfig.DevilBossBase.hefuTimeLimit*DateUtils.MS_PER_DAY,e=t-GameServer.serverTime;this.eTimeLab.text=0>e?"":DateUtils.getFormatBySecond(e/1e3,DateUtils.TIME_FORMAT_1)}},e.prototype.updateTime=function(){switch(this.cfg.id){case 2:this.eTimeLab.text="";break;case 3:if(!CrossDartCT.ins().checkSysOpen())return void(this.eTimeLab.text="");var t=new Date(GameServer.serverTime).getDate();if(CrossDartCT.ins().openState!=CrossDartCT.STATE_CLOSE)this.eTimeLab.textFlow=TextFlowMaker.generateTextFlow1("距离赛季结束的剩余"+(DateUtils.DAYS_PER_WEEK-t%DateUtils.DAYS_PER_WEEK)+"天");else{var e=0;if(t>=4*DateUtils.DAYS_PER_WEEK){var i=DateUtils.getCurrentMonthLast().getDate();e=i-t+1}else e=DateUtils.DAYS_PER_WEEK-t%DateUtils.DAYS_PER_WEEK;this.eTimeLab.text="距离赛季开启剩余的"+e+"天"}}},e.prototype.updateRed=function(){var t=!1;switch(this.cfg.id){case 1:t=(1==DevildomRedPoint.ins().redPoint||DevildomRedPoint.ins().bossRedPoint)&&DevildomSys.ins().isOpen();break;case 2:t=0!=KfArenaRedPoint.ins().redpoint;break;case 3:t=DartRedPoint.ins().redPoint;break;case 4:t=0!=PeakedRedpoint.ins().redpoint;break;case 5:break;case 6:t=CrossGuildBattleRedPoint.ins().redPoint}this.redPoint.visible=t},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseView);__reflect(KFFieldItem.prototype,"KFFieldItem"),window.KFFieldItem=KFFieldItem;var KffieldPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){this.observe(KFBattleRedPoint.ins().postRedPoint,this.refRedPoint),this.observe(DevildomRedPoint.ins().postRedPoint,this.refRedPoint),this.observe(KfArenaRedPoint.ins().postRedPoint,this.refRedPoint),this.initData(),this.refRedPoint()},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.kfBossMc)},e.prototype.onTouch=function(t){switch(t.target){case this.island0:break;case this.island1:ViewManager.ins().open(KfArenaWin);break;case this.island2:break;case this.island3:ViewManager.ins().open(DevilInvadeWin)}},e.prototype.initData=function(){var t=this;this.island0.currentState="unlock",this.island0.title.source="kf_function_boss",this.island0.island.source="",this.island3.currentState="unlock",egret.callLater(function(){t.island3.title.source="kf_function_invasion",t.island3.island.source="kf_field_invasion"},this),this.kfBossMc||(this.kfBossMc=new MovieClip,this.kfBossMc.scaleX=this.kfBossMc.scaleY=.45,this.kfBossMc.x=0,this.kfBossMc.y=35),this.island0.boossGroup.addChild(this.kfBossMc);var e=GlobalConfig.CrossBossBase.showBoss?GlobalConfig.CrossBossBase.showBoss:"monster10041_3s";this.kfBossMc.playFile(RES_DIR_MONSTER+e,-1),egret.callLater(function(){t.island1.title.source="kf_function_ladder",t.island1.island.source="kf_field_ladder"
},this),this.island1.currentState="unlock",this.island2.currentState="lock"},e.prototype.refRedPoint=function(){this.island0.redPoint.visible=KFBattleRedPoint.ins().redPoint2>0,this.island1.redPoint.visible=KfArenaRedPoint.ins().redpoint>0,this.island3.redPoint.visible=DevildomRedPoint.ins().redPoint>0},e}(BaseView);__reflect(KffieldPanel.prototype,"KffieldPanel");var PeakedRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpoint1=0,e.redpoint2=0,e.redpoint3=0,e.redpoint=0,e.associated(e.postRedPoint,PeakedSys.ins().postSignUp,PeakedSys.ins().postState,PeakedSys.ins().postWorship,PeakedSys.ins().postKFInfoList,ZsCT.ins().postZsLv),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){return this.redpoint1=0,this.redpoint2=0,this.redpoint3=0,this.redpoint=0,PeakedSys.ins().isOpen()?ZsCT.ins().lv<GlobalConfig.PeakRaceBase.needZsLv?this.redpoint:(PeakedSys.ins().bfStatus==BF_PeakStatus.SignUp&&0==PeakedSys.ins().isSignUp&&PeakedSys.ins().canSignUp()&&(this.redpoint1=1),PeakedSys.ins().isKf()&&PeakedHelp.canSupport()?(PeakedSys.ins().kfStatus>KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatus<KF_PeakStatus.Over||PeakedSys.ins().kfStatus==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd)&&(this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum):(PeakedSys.ins().bfStatus>BF_PeakStatus.Knockout&&PeakedSys.ins().kfStatus<KF_PeakStatus.Over||PeakedSys.ins().bfStatus==BF_PeakStatus.Knockout&&PeakedSys.ins().bfStatusIsEnd)&&PeakedSys.ins().bfStatus<BF_PeakStatus.Over&&PeakedHelp.canSupport()&&(this.redpoint2=GlobalConfig.PeakRaceBase.likeCount-PeakedSys.ins().kideNum),this.redpoint3=PeakedSys.ins().worshipNum<GlobalConfig.PeakRaceBase.mobaiNum&&PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd?1:0,this.redpoint=this.redpoint1+this.redpoint2+this.redpoint3,this.redpoint):this.redpoint},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(PeakedRedpoint.prototype,"PeakedRedpoint"),System.PeakedRedpoint=function(){return PeakedRedpoint.ins()},window.PeakedRedpoint=PeakedRedpoint;var PeakedSys=function(t){function e(){var e=t.call(this)||this;return e.player16List=[],e.player8List=[],e.player4List=[],e.topRankInfoList=[],e.betInfo=[],e.myBattleReportList=[],e.bfStatusIsEnd=0,e.kfStatusIsEnd=0,e.bfKonckReportList=[],e.kfPlayer64List=[],e.kfPlayer32List=[],e.kfPlayer16List=[],e.kfPlayer8List=[],e.kfPlayer4List=[],e.kfKonckReportList=[],e.kfTopRankInfoList=[],e.kfBetInfo=[],e.myKFBattleReportList=[],e.crossScene=1e4,e.sysId=PackageID.PKCompetition,e.regNetMsg(0,e.postState),e.regNetMsg(1,e.postSignUp),e.regNetMsg(2,e.doPKResult),e.regNetMsg(3,e.postEliminateReportData),e.regNetMsg(4,e.postBFInfoList),e.regNetMsg(5,e.postTopRank),e.regNetMsg(7,e.postBetInfo),e.regNetMsg(8,e.postKFEliminateReportData),e.regNetMsg(9,e.postKFInfoList),e.regNetMsg(10,e.postKFTopRank),e.regNetMsg(12,e.postKFBetInfo),e.regNetMsg(13,e.doFbCountDown),e.regNetMsg(14,e.postWorship),e.observe(GameLogic.ins().postEnterMap,function(){e.isCrossScene()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postState=function(t){var i=this;if(t&&(this.bfStatus=t.readByte(),this.bfStatusIsEnd=t.readByte(),this.kfStatus=t.readByte(),this.kfStatusIsEnd=t.readByte(),0==this.bfStatus&&(this.isSignUp=0)),this.bfStatus==BF_PeakStatus.Finals&&this.bfStatusIsEnd){var s=1e3*PeakedHelp.bfStatusTimer[BF_PeakStatus.Over]-GameServer.serverTime;this.kfStatus>KF_PeakStatus.None&&(s=0),0>=s?this.bfStatus=BF_PeakStatus.Over:Timer.start(s,1,function(){i.bfStatus=BF_PeakStatus.Over,PeakedHelp.calcTimerNode(),i.postState(null)},this)}PeakedHelp.calcTimerNode(),e.ins().isKf()?(e.ins().sendKFBetInfo(),this.kfStatus>=KF_PeakStatus.Knockout&&this.sendKFInfoList()):this.bfStatus>=BF_PeakStatus.Knockout&&this.sendBFInfoList()},e.prototype.postSignUp=function(t){return this.isSignUp=t.readByte(),this.kideNum=t.readInt(),Actor.ins().postChip(t.readNumber()),this.curStateTime=t.readInt(),this.worshipNum=t.readByte(),PeakedHelp.calcTimerNode(),this.isSignUp},e.prototype.doPKResult=function(t){var e=t.readByte(),i=t.readString();ViewManager.ins().open(PeakedFBResult,e,i)},e.prototype.postEliminateReportData=function(t){this.bfKonckRound=t.readShort(),this.bfKonckNextTimer=t.readInt(),this.bfKonckSurplusNum=t.readShort(),this.bfKonckReportList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=new KonckReportData;s.readBFData(t),s.round=i+1,this.bfKonckReportList.push(s)}},e.prototype.postBFInfoList=function(t){var e;this.player16List=[];for(var i=t.readByte(),s=0;i>s;s++)e=new PeakPlayerData,e.readBaseData(t),this.player16List.push(e);this.player8List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.player16List,this.player16List,e.playerList,s),e.readToData(t),this.player8List.push(e);this.player4List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.player8List,this.player16List,e.playerList,s),e.readToData(t),this.player4List.push(e);this.player2Data=new PeakPlayerData,this.player2Data.playerList=[],PeakedHelp.pushPlayerList(this.player4List,this.player16List,this.player2Data.playerList,0),this.player2Data.readToData(t),this.myBattleReportList=PeakedHelp.countMyRecordData()},e.prototype.postTopRank=function(t){var e=t.readShort();this.topRankInfoList=[];for(var i=0;e>i;i++){var s=new PeakTopRankData(t);s.rank=i+1,this.topRankInfoList.push(s)}},e.prototype.postBetInfo=function(t){var e=t.readByte();this.betInfo=[];for(var i=0;e>i;i++){var s=new PeakBetData(t);this.betInfo.push(s)}ViewManager.ins().isShow(PeakBetWin)&&TipsCT.ins().showTips("恭喜您，下注成功"),ViewManager.ins().close(PeakBetWin)},e.prototype.postKFEliminateReportData=function(t){this.kfKonckRound=t.readShort(),this.kfKonckNextTimer=t.readInt(),this.kfKonckSurplusNum=t.readShort(),this.kfKonckReportList=[];for(var e=t.readShort(),i=0;e>i;i++){var s=new KonckReportData;s.readKFData(t),s.round=i+1,this.kfKonckReportList.push(s)}},e.prototype.postKFInfoList=function(t){var e;this.kfPlayer64List=[];for(var i=t.readByte(),s=0;i>s;s++)e=new PeakPlayerData,e.readBaseData(t,!0),this.kfPlayer64List.push(e);this.kfPlayer32List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer64List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer32List.push(e);this.kfPlayer16List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer32List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer16List.push(e);this.kfPlayer8List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer16List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer8List.push(e);this.kfPlayer4List=[],i=t.readByte();for(var s=0;i>s;s++)e=new PeakPlayerData,e.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer8List,this.kfPlayer64List,e.playerList,s),e.readToData(t),this.kfPlayer4List.push(e);this.kfPlayer2Data=new PeakPlayerData,this.kfPlayer2Data.playerList=[],PeakedHelp.pushPlayerList(this.kfPlayer4List,this.kfPlayer64List,this.kfPlayer2Data.playerList,0),this.kfPlayer2Data.readToData(t),this.myKFBattleReportList=PeakedHelp.countKFMyRecordData()},e.prototype.postKFTopRank=function(t){var e=t.readShort();this.kfTopRankInfoList=[];for(var i=0;e>i;i++){var s=new PeakTopRankData(t);s.rank=i+1,this.kfTopRankInfoList.push(s)}},e.prototype.postKFBetInfo=function(t){var e=t.readByte();this.kfBetInfo=[];for(var i=0;e>i;i++){var s=new PeakBetData(t);this.kfBetInfo.push(s)}ViewManager.ins().isShow(PeakBetWin)&&TipsCT.ins().showTips("恭喜您，下注成功"),ViewManager.ins().close(PeakBetWin)},e.prototype.doFbCountDown=function(t){var e=t.readInt(),i=Math.floor((DateUtils.formatMiniDateTime(e)-GameServer.serverTime)/1e3);egret.log(i),i>0&&ViewManager.ins().open(FBCountDown,i)},e.prototype.postWorship=function(t){this.worshipNum=t.readByte(),GlobalConfig.PeakRaceBase.mobaiChips||(GlobalConfig.PeakRaceBase.mobaiChips=1e3),TipsCT.ins().showCenterTips("膜拜成功，筹码+"+GlobalConfig.PeakRaceBase.mobaiChips)},e.prototype.sendSignUp=function(){this.sendBaseProto(1)},e.prototype.sendEliminateReport=function(){this.sendBaseProto(3)},e.prototype.sendBFInfoList=function(){this.sendBaseProto(4)},e.prototype.sendTopRank=function(){this.sendBaseProto(5)},e.prototype.sendToLikes=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.sendBet=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendKFEliminateReport=function(){this.sendBaseProto(8)},e.prototype.sendKFInfoList=function(){this.sendBaseProto(9)},e.prototype.sendKFTopRank=function(){this.sendBaseProto(10)},e.prototype.sendKFToLikes=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.sendKFBet=function(t,e){var i=this.getBytes(12);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendKFBetInfo=function(){this.sendBaseProto(13)},e.prototype.sendWorship=function(){this.sendBaseProto(14)},e.prototype.isOpen=function(t){void 0===t&&(t=!1);var e="";return ZsCT.ins().lv<GlobalConfig.PeakRaceBase.needZsLv&&(e=GlobalConfig.PeakRaceBase.needZsLv+"转开启"),GameServer.serverOpenDay+1<GlobalConfig.PeakRaceBase.openDay&&(e="开服"+GlobalConfig.PeakRaceBase.openDay+"天开启"),t&&""!=e&&TipsCT.ins().showTips(e),""==e},e.prototype.isKf=function(){return this.bfStatus==BF_PeakStatus.Over&&0!=this.bfStatusIsEnd},e.prototype.canSignUp=function(){1e3*PeakedHelp.bfStatusTimer[BF_PeakStatus.Knockout]-GameServer.serverTime;return!0},e.prototype.isKFSixteen=function(){return this.kfStatus>KF_PeakStatus.Prom32||this.kfStatus==KF_PeakStatus.Prom32&&0!=this.kfStatusIsEnd},e.prototype.isCrossScene=function(){2==this.crossScene&&GameMap.sceneInMain()&&ViewManager.ins().open(PeakedMainWin),this.crossScene++},__decorate([post()],e.prototype,"postState",null),__decorate([post()],e.prototype,"postSignUp",null),__decorate([post()],e.prototype,"postEliminateReportData",null),__decorate([post()],e.prototype,"postBFInfoList",null),__decorate([post()],e.prototype,"postTopRank",null),__decorate([post()],e.prototype,"postBetInfo",null),__decorate([post()],e.prototype,"postKFEliminateReportData",null),__decorate([post()],e.prototype,"postKFInfoList",null),__decorate([post()],e.prototype,"postKFTopRank",null),__decorate([post()],e.prototype,"postKFBetInfo",null),__decorate([post()],e.prototype,"postWorship",null),e}(BaseSystem);__reflect(PeakedSys.prototype,"PeakedSys"),System.PeakedSys=function(){return PeakedSys.ins()},window.PeakedSys=PeakedSys;var PeakedData=function(){function t(){}return t.STATE_TYPE_CN=["","","","16进8强","8进4强","半决赛","决赛",""],t.STATE_TYPE_AWARD_CN=["","","参与奖","16强","8强","4强","亚军","冠军"],t.STATE_ICON_CN=["","报名","淘汰赛","8强赛","4强赛","半决赛","决赛","跨服赛"],t.STATE_KF_TYPE_CN=["","","64进32强","32进16强","16进8强","8进4强","半决赛","决赛",""],t.STATE_KF_TYPE_AWARD_CN=["","参与奖","64强","32强","16强","8强","4强","亚军","冠军"],t.STATE_KF_ICON_CN=["跨服赛","淘汰赛","32强赛","16强赛","8强赛","4强赛","半决赛","决赛"],t.SERV_CN=["本服赛","跨服赛"],t}();__reflect(PeakedData.prototype,"PeakedData"),window.PeakedData=PeakedData;var PeakPlayerData=function(){function t(t){t&&this.readBaseData(t)}return t.prototype.readBaseData=function(t,e){void 0===e&&(e=!1);var i=t.readByte();this.playerList=[];for(var s=0;i>s;s++){var n=new PeakPlayerInfo;e?n.readKFData(t):n.readData(t),this.playerList.push(n)}this.winId=t.readInt(),i=t.readByte(),this.reportList=[];for(var s=0;i>s;s++)this.reportList.push(t.readInt())},t.prototype.readToData=function(t){this.winId=t.readInt();var e=t.readByte();this.reportList=[];for(var i=0;e>i;i++)this.reportList.push(t.readInt())},t}();__reflect(PeakPlayerData.prototype,"PeakPlayerData"),window.PeakPlayerData=PeakPlayerData;var PeakPlayerInfo=function(){function t(t){this.serverId=0,t&&this.readData(t)}return t.prototype.readData=function(t){this.roleId=t.readInt(),this.playerName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.pos=t.readByte()},t.prototype.readKFData=function(t){this.roleId=t.readInt(),this.serverId=t.readInt(),this.playerName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.pos=t.readByte()},t}();__reflect(PeakPlayerInfo.prototype,"PeakPlayerInfo"),window.PeakPlayerInfo=PeakPlayerInfo;var PeakTopRankData=function(){function t(t){t&&this.readData(t)}return t.prototype.readData=function(t){this.playerId=t.readInt(),this.playerName=t.readString(),this.servId=t.readInt(),this.likeNum=t.readInt()},t}();__reflect(PeakTopRankData.prototype,"PeakTopRankData"),window.PeakTopRankData=PeakTopRankData;var PeakBetData=function(){function t(t){t&&this.readData(t)}return t.prototype.readData=function(t){this.status=t.readByte(),this.playerId=t.readInt(),this.batNum=t.readInt()},t}();__reflect(PeakBetData.prototype,"PeakBetData"),window.PeakBetData=PeakBetData;var PeakBattleReportData=function(){function t(){}return t}();__reflect(PeakBattleReportData.prototype,"PeakBattleReportData"),window.PeakBattleReportData=PeakBattleReportData;var KonckReportData=function(){function t(){}return t.prototype.readBFData=function(t){this.id=t.readInt(),this.player=t.readString(),this.result=t.readByte()},t.prototype.readKFData=function(t){this.id=t.readInt(),this.player=t.readString(),this.servId=t.readInt(),this.result=t.readByte()},t}();__reflect(KonckReportData.prototype,"KonckReportData"),window.KonckReportData=KonckReportData;var BF_PeakStatus;!function(t){t[t.None=0]="None",t[t.SignUp=1]="SignUp",t[t.Knockout=2]="Knockout",t[t.Prom16=3]="Prom16",t[t.Prom8=4]="Prom8",t[t.Prom4=5]="Prom4",t[t.Finals=6]="Finals",t[t.Over=7]="Over"}(BF_PeakStatus||(BF_PeakStatus={})),window.BF_PeakStatus=BF_PeakStatus;var KF_PeakStatus;!function(t){t[t.None=0]="None",t[t.Knockout=1]="Knockout",t[t.Prom64=2]="Prom64",t[t.Prom32=3]="Prom32",t[t.Prom16=4]="Prom16",t[t.Prom8=5]="Prom8",t[t.Prom4=6]="Prom4",t[t.Finals=7]="Finals",t[t.Over=8]="Over"}(KF_PeakStatus||(KF_PeakStatus={})),window.KF_PeakStatus=KF_PeakStatus;var PeakedHelp=function(){function t(){}return t.calcTimerNode=function(){var t=GlobalConfig.PeakRaceBase,e=GlobalConfig.PeakRaceTime,i=PeakedSys.ins();this.bfStatusTimer=[],this.kfStatusTimer=[];var s=Math.floor(DateUtils.formatMiniDateTime(i.curStateTime)/DateUtils.MS_PER_SECOND);PeakedSys.ins().bfStatus>=BF_PeakStatus.Finals&&PeakedSys.ins().bfStatusIsEnd&&(GlobalConfig.PeakRaceBase.interval||(GlobalConfig.PeakRaceBase.interval=14),s-=GlobalConfig.PeakRaceBase.interval*DateUtils.MS_PER_DAY/DateUtils.MS_PER_SECOND),this.bfStatusTimer[BF_PeakStatus.None]=s,this.bfStatusTimer[BF_PeakStatus.Over]=s+t.crossRelTime;for(var n=1;n<=BF_PeakStatus.Finals;n++)this.bfStatusTimer[n]=s+e[n].relTime;e=GlobalConfig.PeakRaceCrossTime,this.kfStatusTimer[KF_PeakStatus.None]=s;for(var o=1;o<=KF_PeakStatus.Finals;o++)this.kfStatusTimer[o]=s+e[o].relTime},t.getNextTimerStr=function(){var t=0;PeakedSys.ins().bfStatus>=BF_PeakStatus.Finals&&PeakedSys.ins().bfStatusIsEnd&&(t=GlobalConfig.PeakRaceBase.interval*DateUtils.MS_PER_DAY/DateUtils.MS_PER_SECOND);var e=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.SignUp]+t,DateUtils.TIME_FORMAT_13),i=e+"可报名单服晋级赛";return i},t.getNextKfTimerStr=function(){var t=0,e=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Knockout]+t,DateUtils.TIME_FORMAT_13),i=e+"可报名跨服巅峰赛季";return i},t.getTimerRuleStr=function(){var t=GlobalConfig.PeakRaceBase,e="|C:"+ColorUtil.GREEN+"&T:",i="1、报名等级：达到"+e+t.needZsLv+"|转\n",s=DateUtils.TIME_FORMAT_13,n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.SignUp],s),o=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],s);return i+="2、报名时间："+e+n+"|到"+e+o+"|\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Knockout],s),i+="3、淘汰赛："+e+n+"|举行，所有报名玩家争夺16强席位\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom16],s),i+="4、八强赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom8],s),i+="5、四强赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Prom4],s),i+="6、半决赛："+e+n+"|举行\n",n=DateUtils.getFormatBySecond(this.bfStatusTimer[BF_PeakStatus.Finals],s),i+="7、决赛："+e+n+"|举行\n"},t.getKFTimerRuleStr=function(){var t="|C:"+ColorUtil.GREEN+"&T:",e="1、报名条件：单服16强自动报名\n",i=DateUtils.TIME_FORMAT_13,s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Knockout],i);return e+="2、淘汰赛："+t+s+"|举行，决出64强\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom64],i),e+="3、32强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom32],i),e+="4、16强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom16],i),e+="4、八强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom8],i),e+="5、四强赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Prom4],i),e+="6、半决赛："+t+s+"|举行\n",s=DateUtils.getFormatBySecond(this.kfStatusTimer[KF_PeakStatus.Finals],i),e+="7、决赛："+t+s+"|举行\n"},t.calcEliminateWinNum=function(){var t=0;if(PeakedSys.ins().isKf())for(var e=0,i=PeakedSys.ins().kfKonckReportList;e<i.length;e++){var s=i[e];s.result&&t++}else for(var n=0,o=PeakedSys.ins().bfKonckReportList;n<o.length;n++){var s=o[n];s.result&&t++}return t},t.getPlayerData=function(t,e){var i=PeakedSys.ins();return t==this.PK_GROUP_1?i.player16List[e-1]:t==this.PK_GROUP_2?i.player8List[e-1]?i.player8List[e-1]:this.findLastDt(e,i.player16List):t==this.PK_GROUP_3?i.player4List[e-1]?i.player4List[e-1]:this.findLastDt(e,i.player8List):i.player2Data?i.player2Data:this.findLastDt(e,i.player4List)},t.getKFPlayerData=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=!1);var n=PeakedSys.ins();return t==this.PK_GROUP_1?s?n.kfPlayer16List[e-1]?n.kfPlayer16List[e-1]:this.findLastDt(e,n.kfPlayer64List):n.kfPlayer64List.slice(8*i,8*i+8)[e-1]:t==this.PK_GROUP_2?s?n.kfPlayer8List[e-1]?n.kfPlayer8List[e-1]:this.findLastDt(e,n.kfPlayer16List):n.kfPlayer32List.slice(4*i,4*i+4)[e-1]?n.kfPlayer32List.slice(4*i,4*i+4)[e-1]:this.findLastDt(e,n.kfPlayer64List.slice(8*i,8*i+8)):t==this.PK_GROUP_3?s?n.kfPlayer4List[e-1]?n.kfPlayer4List[e-1]:this.findLastDt(e,n.kfPlayer8List):n.kfPlayer16List.slice(2*i,2*i+2)[e-1]?n.kfPlayer16List.slice(2*i,2*i+2)[e-1]:this.findLastDt(e,n.kfPlayer32List.slice(4*i,4*i+4)):n.kfPlayer2Data?n.kfPlayer2Data:this.findLastDt(e,n.kfPlayer4List)},t.findLastDt=function(t,e){if(e&&e[2*(t-1)+1]){var i=e[2*(t-1)>>0].winId,s=e[2*(t-1)+1>>0].winId,n=new PeakPlayerData;return n.playerList=[],n.playerList.push(this.findPlayerDtById(i)),n.playerList.push(this.findPlayerDtById(s)),n.reportList=[],n}return null},t.findPlayerDtById=function(t,e){e||(e=PeakedSys.ins().isKf()?PeakedSys.ins().kfPlayer64List:PeakedSys.ins().player16List);for(var i=0,s=e;i<s.length;i++)for(var n=s[i],o=0,a=n.playerList;o<a.length;o++){var r=a[o];if(t==r.roleId)return r}return null},t.checkIsWinById=function(e,i,s){s||(s=PeakedSys.ins().isKf()?t.getPlayerListByStage(i):t.getPlayerListByStage(i));for(var n=0,o=s;n<o.length;n++){var a=o[n];if(e==a.winId)return!0}return!1},t.getPlayerListByStage=function(t){if(PeakedSys.ins().isKf())switch(t){case KF_PeakStatus.Knockout:case KF_PeakStatus.Prom64:return PeakedSys.ins().kfPlayer64List;case KF_PeakStatus.Prom32:return PeakedSys.ins().kfPlayer32List;case KF_PeakStatus.Prom16:return PeakedSys.ins().kfPlayer16List;case KF_PeakStatus.Prom8:return PeakedSys.ins().kfPlayer8List;case KF_PeakStatus.Prom4:return PeakedSys.ins().kfPlayer4List;case KF_PeakStatus.Finals:return[PeakedSys.ins().kfPlayer2Data]}else switch(t){case BF_PeakStatus.Prom16:case BF_PeakStatus.Knockout:return PeakedSys.ins().player16List;case BF_PeakStatus.Prom8:return PeakedSys.ins().player8List;case BF_PeakStatus.Prom4:return PeakedSys.ins().player4List;case BF_PeakStatus.Finals:return[PeakedSys.ins().player2Data]}},t.countMyRecordData=function(){for(var t=PeakedSys.ins().player16List,e=PeakedSys.ins().player8List,i=PeakedSys.ins().player4List,s=PeakedSys.ins().player2Data,n=function(t,e,i){for(var s=t.playerList.length,n=0;s>n;n++){var o=t.playerList[n];if(o.roleId==Actor.actorID){var a=s>1?t.playerList[0==n?1:0].playerName:"轮空";if(0==t.reportList.length&&!t.playerList[1]&&i<PeakedSys.ins().bfStatus){var r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=1,r.round=0,e.push(r)}else for(var l=0,h=0,p=t.reportList;h<p.length;h++){var u=p[h],r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=u==Actor.actorID?1:0,r.round=++l,e.push(r)}break}}},o=[],a=0,r=t;a<r.length;a++){var l=r[a];n(l,o,BF_PeakStatus.Prom16)}for(var h=0,p=e;h<p.length;h++){var l=p[h];n(l,o,BF_PeakStatus.Prom8)}for(var u=0,d=i;u<d.length;u++){var l=d[u];n(l,o,BF_PeakStatus.Prom4)}return n(s,o,BF_PeakStatus.Finals),o},t.countKFMyRecordData=function(){for(var t=PeakedSys.ins().kfPlayer64List,e=PeakedSys.ins().kfPlayer32List,i=PeakedSys.ins().kfPlayer16List,s=PeakedSys.ins().kfPlayer8List,n=PeakedSys.ins().kfPlayer4List,o=PeakedSys.ins().kfPlayer2Data,a=function(t,e,i){for(var s=t.playerList.length,n=0;s>n;n++){var o=t.playerList[n];if(o.roleId==Actor.actorID){var a=s>1?t.playerList[0==n?1:0].playerName:"轮空";if(0==t.reportList.length&&!t.playerList[1]&&i<PeakedSys.ins().kfStatus){var r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=1,r.round=0,e.push(r)}else for(var l=0,h=0,p=t.reportList;h<p.length;h++){var u=p[h],r=new PeakBattleReportData;r.stateType=i,r.playerName=a,r.result=u==Actor.actorID?1:0,r.round=++l,e.push(r)}break}}},r=[],l=0,h=t;l<h.length;l++){var p=h[l];a(p,r,KF_PeakStatus.Prom64)}for(var u=0,d=e;u<d.length;u++){var p=d[u];a(p,r,KF_PeakStatus.Prom32)}for(var c=0,f=i;c<f.length;c++){var p=f[c];a(p,r,KF_PeakStatus.Prom16)}for(var g=0,y=s;g<y.length;g++){var p=y[g];a(p,r,KF_PeakStatus.Prom8)}for(var v=0,m=n;v<m.length;v++){var p=m[v];a(p,r,KF_PeakStatus.Prom4)}return a(o,r,KF_PeakStatus.Finals),r},t.findBetInfoById=function(t,e,i){if(!i){var s=PeakedSys.ins().isKf();i=s?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo}if(!i)return null;for(var n=0,o=i;n<o.length;n++){var a=o[n];if(a.playerId==t&&a.status==e)return a}return null},t.getStatusByGroup=function(t){if(PeakedSys.ins().isKf())if(PeakedSys.ins().isKFSixteen())switch(t){case this.PK_GROUP_1:return KF_PeakStatus.Prom16;case this.PK_GROUP_2:return KF_PeakStatus.Prom8;case this.PK_GROUP_3:return KF_PeakStatus.Prom4;case this.PK_GROUP_4:return KF_PeakStatus.Finals}else switch(t){case this.PK_GROUP_1:return KF_PeakStatus.Prom64;case this.PK_GROUP_2:return KF_PeakStatus.Prom32}else switch(t){case this.PK_GROUP_1:return BF_PeakStatus.Prom16;case this.PK_GROUP_2:return BF_PeakStatus.Prom8;case this.PK_GROUP_3:return BF_PeakStatus.Prom4;case this.PK_GROUP_4:return BF_PeakStatus.Finals}},t.checkIsBetByGroup=function(t){var e=(parseInt(t),PeakedSys.ins().isKf()),i=e?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo,s=this.getStatusByGroup(parseInt(t));for(var n in i)if(i[n].status==s)return!0;return!1},t.checkIsBet=function(t,e){for(var i=parseInt(e),s=PeakedSys.ins().isKf(),n=0,o=t;n<o.length;n++){var a=o[n];if(a){var r=this.findBetInfoById(a.roleId,this.getStatusByGroup(parseInt(e)));if(r)if(s)if(PeakedSys.ins().isKFSixteen()){if(i==this.PK_GROUP_1&&r.status==KF_PeakStatus.Prom16)return!0;if(i==this.PK_GROUP_2&&r.status==KF_PeakStatus.Prom8)return!0;if(i==this.PK_GROUP_3&&r.status==KF_PeakStatus.Prom4)return!0;if(i==this.PK_GROUP_4&&r.status==KF_PeakStatus.Finals)return!0}else{if(i==this.PK_GROUP_1&&r.status==KF_PeakStatus.Prom64)return!0;if(i==this.PK_GROUP_2&&r.status==KF_PeakStatus.Prom32)return!0}else{if(i==this.PK_GROUP_1&&r.status==BF_PeakStatus.Prom16)return!0;if(i==this.PK_GROUP_2&&r.status==BF_PeakStatus.Prom8)return!0;if(i==this.PK_GROUP_3&&r.status==BF_PeakStatus.Prom4)return!0;if(i==this.PK_GROUP_4&&r.status==BF_PeakStatus.Finals)return!0}}}return!1},t.findPlayerIndexById=function(t,e){for(var i=0;i<e.length;i++)if(e[i].roleId==t)return i;return-1},t.setImgGroupSource=function(t,e){for(var i=0;i<t.numChildren;i++){var s=t.getChildAt(i);s&&(s.source=e)}},t.statusIsOver=function(t,e){return e?PeakedSys.ins().kfStatus>t||PeakedSys.ins().kfStatus==t&&0!=PeakedSys.ins().kfStatusIsEnd:PeakedSys.ins().bfStatus>t||PeakedSys.ins().bfStatus==t&&0!=PeakedSys.ins().bfStatusIsEnd},t.statusIsOverByGroup=function(e){var i=!1;return PeakedSys.ins().isKf()?PeakedSys.ins().isKFSixteen()?i=e==this.PK_GROUP_1?t.statusIsOver(KF_PeakStatus.Prom16,!1):e==this.PK_GROUP_2?t.statusIsOver(KF_PeakStatus.Prom8,!1):e==this.PK_GROUP_3?t.statusIsOver(KF_PeakStatus.Prom4,!1):t.statusIsOver(KF_PeakStatus.Finals,!1):e==this.PK_GROUP_1?i=t.statusIsOver(KF_PeakStatus.Prom64,!1):e==this.PK_GROUP_2&&(i=t.statusIsOver(KF_PeakStatus.Prom32,!1)):i=e==this.PK_GROUP_1?t.statusIsOver(BF_PeakStatus.Prom16,!1):e==this.PK_GROUP_2?t.statusIsOver(BF_PeakStatus.Prom8,!1):e==this.PK_GROUP_3?t.statusIsOver(BF_PeakStatus.Prom4,!1):t.statusIsOver(BF_PeakStatus.Finals,!1),i},t.pushPlayerList=function(e,i,s,n){if(e[2*n]){var o=t.findPlayerDtById(e[2*n].winId,i);o&&s.push(o)}if(e[2*n+1]){var o=t.findPlayerDtById(e[2*n+1].winId,i);o&&s.push(o)}},t.isSixteenById=function(t){for(var e=0,i=PeakedSys.ins().player16List;e<i.length;e++){var s=i[e];if(s)for(var n=0,o=s.playerList;n<o.length;n++){var a=o[n];if(a.roleId==t)return!0}}return!1},t.sortBetFun=function(t,e){return t.status>e.status?1:t.status<e.status?-1:0},t.findKFGroupById=function(t){for(var e=0,i=0,s=PeakedSys.ins().kfPlayer64List;i<s.length;i++)for(var n=s[i],o=0,a=n.playerList;o<a.length;o++){var r=a[o];if(r.roleId==t)return e/16>>0;e++}return-1},t.findBetKFGroup=function(){for(var t=PeakedSys.ins().kfStatus,e=0,i=PeakedSys.ins().kfBetInfo;e<i.length;e++){var s=i[e];if(s.status==KF_PeakStatus.Prom64&&t==KF_PeakStatus.Knockout||s.status==KF_PeakStatus.Prom32&&t==KF_PeakStatus.Prom64)return this.findKFGroupById(s.playerId)}return-1},t.canSupport=function(){var t=this.kfStatusTimer[KF_PeakStatus.None]+DateUtils.DAYS_PER_WEEK*DateUtils.SECOND_PER_DAY;return GameServer.serverTime/DateUtils.MS_PER_SECOND>t&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Finals&&PeakedSys.ins().kfStatusIsEnd?!1:!0},t.PK_GROUP_1=1,t.PK_GROUP_2=2,t.PK_GROUP_3=3,t.PK_GROUP_4=4,t}();__reflect(PeakedHelp.prototype,"PeakedHelp"),window.PeakedHelp=PeakedHelp;var PeakAwardItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.awardslist.itemRenderer=ItemBase},e.prototype.dataChanged=function(){this.data instanceof PeakRaceTime?this.typeLabel.text=PeakedData.STATE_TYPE_AWARD_CN[this.data.status]:this.data instanceof PeakRaceCrossTime&&(this.typeLabel.text=PeakedData.STATE_KF_TYPE_AWARD_CN[this.data.status]);var t=GlobalConfig.MailIdConfig[this.data.loseMail];this.awardslist.dataProvider=new eui.ArrayCollection(t.attachment)},e}(BaseItemRender);__reflect(PeakAwardItemRender.prototype,"PeakAwardItemRender"),window.PeakAwardItemRender=PeakAwardItemRender;var PeakKnockoutItemItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.infoLabel.text=(this.data.servId?"跨服":"单服")+"淘汰赛第"+this.data.round+"场",this.playerName.text=this.data.player?this.data.player:"轮空",this.playerName.name=this.data.id,this.data.result?(this.result.textColor=ColorUtil.GREEN,this.result.text="胜利"):(this.result.textColor=ColorUtil.RED,this.result.text="失败"))},e}(BaseItemRender);__reflect(PeakKnockoutItemItemRender.prototype,"PeakKnockoutItemItemRender"),window.PeakKnockoutItemItemRender=PeakKnockoutItemItemRender;var PeakMyBattleRecordItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.playerName){var t=this.data.round?"第"+this.data.round+"场":"";PeakedSys.ins().isKf()?this.roundInfo.text=""+PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.stateType]+" "+t:this.roundInfo.text=""+PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.stateType]+" "+t,this.enemyLabel.text=this.data.playerName,this.result.text=this.data.result?"胜利":"失败",this.result.textColor=this.data.result?ColorUtil.GREEN:ColorUtil.RED}},e}(BaseItemRender);__reflect(PeakMyBattleRecordItemRender.prototype,"PeakMyBattleRecordItemRender"),window.PeakMyBattleRecordItemRender=PeakMyBattleRecordItemRender;var PeakMyBetItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof PeakBetData){PeakedSys.ins().isKf()?this.eTitle.text=PeakedData.SERV_CN[1]+PeakedData.STATE_KF_TYPE_CN[this.data.status]:this.eTitle.text=PeakedData.SERV_CN[0]+PeakedData.STATE_TYPE_CN[this.data.status];var t="";t=PeakedHelp.statusIsOver(this.data.status,PeakedSys.ins().isKf())?PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)?"|C:"+ColorUtil.GREEN+"&T:获利"+this.data.batNum+"筹码|":"|C:"+ColorUtil.RED+"&T:损失"+this.data.batNum+"筹码|":PeakedHelp.checkIsWinById(this.data.playerId,this.data.status)?"|C:"+ColorUtil.GREEN+"&T:获利"+this.data.batNum+"筹码|":"等待结果中...";var e=PeakedHelp.findPlayerDtById(this.data.playerId);this.eLab.textFlow=TextFlowMaker.generateTextFlow1("下注【"+e.playerName+"】 "+this.data.batNum+"筹码，"+t)}this.eResult.text=""},e}(BaseItemRender);__reflect(PeakMyBetItemRender.prototype,"PeakMyBetItemRender"),window.PeakMyBetItemRender=PeakMyBetItemRender;var PeakTopRankItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof PeakTopRankData&&(this.nameLabel.text=this.data.playerName,this.score.text=this.data.likeNum*GlobalConfig.PeakRaceBase.likeScore+"",this.supportBtn.visible=PeakedHelp.canSupport(),PeakedSys.ins().kideNum>=GlobalConfig.PeakRaceBase.likeCount&&(this.supportBtn.enabled=!1),this.data.rank<=3?(this.rankImg.source="paihang"+this.data.rank,this.rank.text=""):(this.rank.text=this.data.rank+"",this.rankImg.source=""),PeakedSys.ins().isKf()?this.eOverLab.visible=PeakedSys.ins().kfStatusIsEnd&&PeakedSys.ins().kfStatus==KF_PeakStatus.Finals:this.eOverLab.visible=PeakedSys.ins().bfStatusIsEnd&&PeakedSys.ins().bfStatus==BF_PeakStatus.Finals,this.supportBtn.visible=!this.eOverLab.visible)},e}(BaseItemRender);__reflect(PeakTopRankItemRender.prototype,"PeakTopRankItemRender"),window.PeakTopRankItemRender=PeakTopRankItemRender;var PeakViewBattleReportItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.data?(this.roundTxt.text="第"+this.data.round+"局",this.player.text=this.data.winer,this.noOpen.visible=!1,this.infoGroup.visible=!0):(this.noOpen.visible=!0,this.infoGroup.visible=!1)},e}(BaseItemRender);__reflect(PeakViewBattleReportItemRender.prototype,"PeakViewBattleReportItemRender"),window.PeakViewBattleReportItemRender=PeakViewBattleReportItemRender;var PeakAwardPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.curServList.itemRenderer=PeakAwardItemRender,this.kfServList.itemRenderer=PeakAwardItemRender,this._listDt1=new eui.ArrayCollection,this._listDt2=new eui.ArrayCollection,this.curServList.dataProvider=this._listDt1,this.kfServList.dataProvider=this._listDt2},e.prototype.addDisplay=function(){var t=[];for(var e in GlobalConfig.PeakRaceTime){var i=GlobalConfig.PeakRaceTime[e];i.loseMail&&t.push(i)}var s=new PeakRaceTime;s.loseMail=GlobalConfig.PeakRaceBase.winMail,s.status=BF_PeakStatus.Over,t.push(s),t.reverse(),this._listDt1.replaceAll(t),t=[];for(var e in GlobalConfig.PeakRaceCrossTime){var i=GlobalConfig.PeakRaceCrossTime[e];i.loseMail&&t.push(i)}var n=new PeakRaceCrossTime;n.loseMail=GlobalConfig.PeakRaceBase.crossWinMail,n.status=KF_PeakStatus.Over,t.push(n),t.reverse(),this._listDt2.replaceAll(t)
},e}(BaseView);__reflect(PeakAwardPanel.prototype,"PeakAwardPanel"),window.PeakAwardPanel=PeakAwardPanel;var PeakChipMallPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr,this.addTouchEvent(this.getWay,this.onGetway)},e.prototype.addDisplay=function(){this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Actor.ins().postChip,this.callback),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.onGetway=function(){},e.prototype.updateData=function(){var t=[];for(var e in GlobalConfig.FeatsStore){var i=GlobalConfig.FeatsStore[e];if(!(2==i.shopType||i.openday[0]>GameServer.serverOpenDay+1||i.openday[1]<GameServer.serverOpenDay+1)){var s=!0;if(i.buyType==FEATS_TYPE.forever&&Shop.ins().medalData)for(var n in Shop.ins().medalData.exchangeCount)if(i.index==Number(n)&&i.daycount){Shop.ins().medalData.exchangeCount[n]>=i.daycount&&(s=!1);break}s&&t.push(i)}}t.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"sort")}),this.dataArr.replaceAll(t),this.myLabel.text=Actor.chip+"";var o=this.getWay.text;this.getWay.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)},e}(BaseView);__reflect(PeakChipMallPanel.prototype,"PeakChipMallPanel"),window.PeakChipMallPanel=PeakChipMallPanel;var PeakedFBResult=function(t){function e(){var e=t.call(this)||this;return e.AUTO_QUIT_TIME=5,e._curTime=0,e.skinName="PeakedNessResultSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.quitBtn,this.onQuit);var i=t[1];t[0]?(this.bg.source="win_png",this.result.source="win_02",this.resultImg.source="peakness_win",this.win.visible=!0,this.lose.visible=!1,this.winPlayer.text=i):(this.bg.source="lost_png",this.result.source="lost_02",this.resultImg.source="peakness_lose",this.win.visible=!1,this.lose.visible=!0,this.losePlayer.text=i),Timer.start(1e3,this.AUTO_QUIT_TIME,this.onTick,this),this._curTime=this.AUTO_QUIT_TIME,this.onTick()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.onTick,this)},e.prototype.onTick=function(){this.quitBtn.label="退出("+--this._curTime+")",this._curTime<0&&this.onQuit()},e.prototype.onQuit=function(){FbCT.ins().sendExitFb(),ViewManager.ins().close(e),PeakedSys.ins().isKf()?(PeakedSys.ins().crossScene=1,PeakedSys.ins().kfStatus>=2&&PeakedSys.ins().sendKFInfoList()):Timer.start(300,1,function(){ViewManager.ins().open(PeakedMainWin),PeakedSys.ins().bfStatus>=3&&(console.log("state",PeakedSys.ins().bfStatus),PeakedSys.ins().sendBFInfoList())},this)},e}(BaseEuiView);__reflect(PeakedFBResult.prototype,"PeakedFBResult"),window.PeakedFBResult=PeakedFBResult,ViewManager.ins().reg(PeakedFBResult,LayerManager.UI_Popup);var PeakedMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="PeakednessWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=t[0]?t[0]:0,this.setOpenIndex(this.oldIndex),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint)},e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addTouchEvent(this.help,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch)},e.prototype.openOtherPlayerView=function(t){if(4!=this.oldIndex){var e=ViewManager.ins().isShow(PeakTopRankWin);e&&ViewManager.ins().close(PeakTopRankWin);var i=ViewManager.ins().open(RRoleWin,t);i.hideEx(1),i.closeFun=function(){e&&ViewManager.ins().open(PeakTopRankWin)}}},e.prototype.onTabTouch=function(t){var e=this.tab.selectedIndex;this.setOpenIndex(e)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.setOpenIndex=function(t){this.oldIndex!=t?this.oldIndex=t:this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.onTouch=function(t){switch(t.target){case this.help:var e=PeakedSys.ins().isKf()?32:31;ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[e].text);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.refRedpoint=function(){this.redPoint0.visible=PeakedRedpoint.ins().redpoint1>0,this.redPoint1.visible=!1,this.redPoint2.visible=!1,this.redPoint3.visible=!1,this.redPoint4.visible=PeakedRedpoint.ins().redpoint3>0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:PeakedSys.ins().isOpen(!0)?!0:!1},e}(BaseEuiView);__reflect(PeakedMainWin.prototype,"PeakedMainWin"),window.PeakedMainWin=PeakedMainWin,ViewManager.ins().reg(PeakedMainWin,LayerManager.UI_Main);var PeakedMallPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr,this.addTouchEvent(this.getWay,this.onGetway)},e.prototype.addDisplay=function(){this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.onGetway=function(){},e.prototype.updateData=function(){var t=[];for(var e in GlobalConfig.FeatsStore){var i=GlobalConfig.FeatsStore[e];if(!(1==i.shopType||i.openday[0]>GameServer.serverOpenDay+1||i.openday[1]<GameServer.serverOpenDay+1)){var s=!0;if(i.buyType==FEATS_TYPE.forever&&Shop.ins().medalData)for(var n in Shop.ins().medalData.exchangeCount)if(i.index==Number(n)&&i.daycount){Shop.ins().medalData.exchangeCount[n]>=i.daycount&&(s=!1);break}s&&t.push(i)}}t.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"sort")}),this.dataArr.replaceAll(t),this.myLabel.text=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.PeakRaceBase.exchangeItems[0])+"",this.eIcon.source=GlobalConfig.ItemConfig[GlobalConfig.PeakRaceBase.exchangeItems[0]].icon+"_png"},e}(BaseView);__reflect(PeakedMallPanel.prototype,"PeakedMallPanel"),window.PeakedMallPanel=PeakedMallPanel;var PeakedPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(PeakedSys.ins().postState,this.upCurState),this.upCurState(),Timer.start(3e4,0,this.sendInfo,this)},e.prototype.sendInfo=function(){PeakedSys.ins().isKf()?PeakedSys.ins().sendKFInfoList():PeakedSys.ins().sendBFInfoList()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.upCurState=function(){if(this._curPanel&&DisplayUtils.removeFromParent(this._curPanel),PeakedSys.ins().isKf()){var t=PeakedSys.ins().kfStatus;switch(t==KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd&&(t=KF_PeakStatus.Prom64),t){case KF_PeakStatus.None:case KF_PeakStatus.Knockout:this.signupPanel||(this.signupPanel=new SignupPanel),this._curPanel=this.signupPanel;break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:this.sixteenPanel||(this.sixteenPanel=new SixteenPanel),this._curPanel=this.sixteenPanel}}else{var t=PeakedSys.ins().bfStatus;switch(t==BF_PeakStatus.Knockout&&(PeakedSys.ins().bfStatusIsEnd?t=BF_PeakStatus.Prom16:PeakedSys.ins().isSignUp||(TipsCT.ins().showTips("您未报名，请等决出16强后再来查看"),t=BF_PeakStatus.SignUp)),t){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:case BF_PeakStatus.Knockout:this.signupPanel||(this.signupPanel=new SignupPanel),this._curPanel=this.signupPanel;break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:case BF_PeakStatus.Over:this.sixteenPanel||(this.sixteenPanel=new SixteenPanel),this._curPanel=this.sixteenPanel}}this._curPanel&&this.addChild(this._curPanel)},e}(BaseView);__reflect(PeakedPanel.prototype,"PeakedPanel"),window.PeakedPanel=PeakedPanel;var SignupPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="SignupSkin",e.curKonckRound=0,e.left=0,e.right=0,e.top=0,e.bottom=0,e}return __extends(e,t),e.prototype.addDisplay=function(){if(this.observe(PeakedSys.ins().postState,this.upCurState),this.observe(PeakedSys.ins().postSignUp,this.upSignUpState),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedPoint),this.observe(PeakedSys.ins().postEliminateReportData,this.upEliminateReport),this.observe(PeakedSys.ins().postKFEliminateReportData,this.upEliminateReport),PeakedRedpoint.ins().postRedPoint(),PeakedSys.ins().isKf()){var t=PeakedSys.ins().kfStatus;t==KF_PeakStatus.Knockout&&0==PeakedSys.ins().kfStatusIsEnd?(this.observe(PeakedSys.ins().postBFInfoList,this.upCurState),PeakedSys.ins().sendBFInfoList()):this.upCurState()}else this.upCurState()},e.prototype.skinComplete=function(){this.eliminateInfoList.itemRenderer=PeakKnockoutItemItemRender,this._eliminateInfoDt=new eui.ArrayCollection,this.eliminateInfoList.dataProvider=this._eliminateInfoDt,this.rewardList.itemRenderer=ItemBase;var t=DateUtils.getFormatBySecond(GlobalConfig.PeakRaceBase.KnockOutTime,DateUtils.TIME_FORMAT_10);this.info.text="淘汰赛负"+GlobalConfig.PeakRaceBase.signUpLose+"场出局,每场间隔"+t,this.addTouchEvent(this.signUpBtn,this.onTouch),this.addTouchEvent(this.eliminateInfoList,this.onTouch)},e.prototype.removeDisplay=function(){Timer.stop(this.onTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.signUpBtn:if(!KfArenaSys.ins().checkIsMatching())return;PeakedRedpoint.ins().redpoint1>0?PeakedSys.ins().sendSignUp():PeakedSys.ins().bfStatus!=BF_PeakStatus.Knockout||PeakedSys.ins().isSignUp?ZsCT.ins().lv<GlobalConfig.PeakRaceBase.needZsLv?TipsCT.ins().showTips("需要转生等级到达"+GlobalConfig.PeakRaceBase.needZsLv):TipsCT.ins().showTips("当前不在报名时间"):TipsCT.ins().showTips("当前的报名时间已过！");break;case this.eliminateInfoList:break;default:if(t.target instanceof eui.Label&&t.target.parent instanceof PeakKnockoutItemItemRender&&t.target.name){var e=t.target.parent.data;e?ReadPlayerCT.ins().sendFindPlayer(t.target.name,e.servId):ReadPlayerCT.ins().sendFindPlayer(t.target.name)}}},e.prototype.upCurState=function(){if(PeakedSys.ins().isKf()){var t=PeakedSys.ins().kfStatus;switch(t==KF_PeakStatus.Knockout&&0==PeakedSys.ins().kfStatusIsEnd&&(PeakedSys.ins().isSignUp?PeakedHelp.isSixteenById(Actor.actorID)||(TipsCT.ins().showTips("您未进入单服16强，请等决出64强后再来查看"),t=KF_PeakStatus.None):(TipsCT.ins().showTips("您未报名，请等决出64强后再来查看"),t=KF_PeakStatus.None)),t){case KF_PeakStatus.None:this.signGroup.visible=!0,this.knockoutGroup.visible=!1,this.signUpBtn.visible=!1,this.signed.visible=!1,this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getKFTimerRuleStr()),this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.croosRewards);break;case KF_PeakStatus.Knockout:this.signGroup.visible=!1,this.knockoutGroup.visible=!0,this.signUpBtn.visible=!1,this.signed.visible=!1,PeakedSys.ins().sendKFEliminateReport();break;case KF_PeakStatus.Prom64:case KF_PeakStatus.Prom32:case KF_PeakStatus.Prom16:case KF_PeakStatus.Prom8:case KF_PeakStatus.Prom4:case KF_PeakStatus.Finals:}}else{var t=PeakedSys.ins().bfStatus;switch(t!=BF_PeakStatus.Knockout||PeakedSys.ins().isSignUp||(t=BF_PeakStatus.SignUp),t){case BF_PeakStatus.None:case BF_PeakStatus.SignUp:this.signGroup.visible=!0,this.knockoutGroup.visible=!1,PeakedSys.ins().isSignUp?(this.signed.visible=!0,this.signUpBtn.visible=!1):(this.signUpBtn.label="报名",this.signed.visible=!1),this.signUpRuleTxt.textFlow=TextFlowMaker.generateTextFlow(PeakedHelp.getTimerRuleStr()),this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.PeakRaceBase.singleRewards);break;case BF_PeakStatus.Knockout:this.signGroup.visible=!1,this.knockoutGroup.visible=!0,PeakedSys.ins().sendEliminateReport();break;case BF_PeakStatus.Prom16:case BF_PeakStatus.Prom8:case BF_PeakStatus.Prom4:case BF_PeakStatus.Finals:}}},e.prototype.upSignUpState=function(t){void 0===t&&(t=-1),PeakedSys.ins().isSignUp&&(this.signed.visible=!0,this.signUpBtn.visible=!1,-1!=t&&TipsCT.ins().showTips("成功报名巅峰赛季"))},e.prototype.upEliminateReport=function(){var t=PeakedSys.ins(),e=t.isKf()?t.kfKonckReportList:t.bfKonckReportList;this.curKonckRound=t.isKf()?t.kfKonckRound:t.bfKonckRound;var i=t.isKf()?t.kfKonckSurplusNum:t.bfKonckSurplusNum;this._eliminateInfoDt.replaceAll(e),DisplayUtils.scrollerToBottom(this.eliminateListScroller);var s="，我的战绩：",n=PeakedHelp.calcEliminateWinNum();if(e.length-n>=GlobalConfig.PeakRaceBase.signUpLose)s="|C:"+ColorUtil.RED+"&T:(您已经被淘汰)|",this.nextStartCountdownLabel.visible=!1,this.state2.visible=!1;else{var o=this.curKonckRound-n<0?0:this.curKonckRound-n;s+=n+"胜"+o+"负",Timer.stop(this.onTime,this),Timer.start(1e3,0,this.onTime,this),this.onTime(!0),this.state2.visible=!0}this.eliminateInfoLabel.textFlow=TextFlowMaker.generateTextFlow1("当前淘汰赛第"+this.curKonckRound+"轮，剩余"+i+"人 "+s)},e.prototype.onTime=function(t){void 0===t&&(t=!1);var e=PeakedSys.ins().isKf()?PeakedSys.ins().kfKonckNextTimer:PeakedSys.ins().bfKonckNextTimer,i=Math.floor((DateUtils.formatMiniDateTime(e)-GameServer.serverTime)/1e3);i>0?this.nextStartCountdownLabel.text=DateUtils.getFormatBySecond(i):(Timer.stop(this.onTime,this),this.nextStartCountdownLabel.text="")},e.prototype.refRedPoint=function(){this.redPoint.visible=PeakedRedpoint.ins().redpoint1>0},__decorate([callLater],e.prototype,"upCurState",null),e}(BaseView);__reflect(SignupPanel.prototype,"SignupPanel"),window.SignupPanel=SignupPanel;var SixteenPanel=function(t){function e(){var e=t.call(this)||this;return e._curGroup=0,e.MAX=16,e.PK_GROUP_0=0,e.PK_GROUP_1=1,e.PK_GROUP_2=2,e.PK_GROUP_3=3,e._sn_="SixteenSkin",e.hasBed=!1,e.lastStatus=0,e.left=0,e.right=0,e.top=0,e.bottom=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.myBet.label="我的支持",this._linkGroupList=[],this._linkGroupList[this.PK_GROUP_0]=[],this._linkGroupList[this.PK_GROUP_1]=[],this._linkGroupList[this.PK_GROUP_2]=[],this._linkGroupList[this.PK_GROUP_3]=[],this._vsBtnList=[],this._vsBtnList[this.PK_GROUP_1]=[],this._vsBtnList[this.PK_GROUP_2]=[],this._vsBtnList[this.PK_GROUP_3]=[],this._playerLabelList=[];for(var t=1;t<=this.MAX;t++){var e=this["actState_1_"+t],i=this["actState_2_"+t],s=this["actState_3_"+t];e&&(e.name=this.PK_GROUP_1+"_"+t,e.currentState="view",this._vsBtnList[this.PK_GROUP_1].push(e),e.visible=!1),i&&(i.name=this.PK_GROUP_2+"_"+t,i.currentState="view",this._vsBtnList[this.PK_GROUP_2].push(i),i.visible=!1),s&&(s.name=this.PK_GROUP_3+"_"+t,s.currentState="view",this._vsBtnList[this.PK_GROUP_3].push(s),s.visible=!1),this["player"+(t-1)].text="---",this["player"+(t-1)].name="",this._playerLabelList.push(this["player"+(t-1)]);var n=this["link_0_"+t],o=this["link_1_"+t],a=this["link_2_"+t],r=this["link_3_"+t];n&&this._linkGroupList[this.PK_GROUP_0].push(n),o&&this._linkGroupList[this.PK_GROUP_1].push(o),a&&this._linkGroupList[this.PK_GROUP_2].push(a),r&&this._linkGroupList[this.PK_GROUP_3].push(r),this.finals.touchChildren=!1}this.groupBtnSelect0.touchEnabled=!1,this.groupBtnSelect1.touchEnabled=!1,this.groupBtnSelect2.touchEnabled=!1,this.groupBtnSelect3.touchEnabled=!1;for(var l=0,h=this._vsBtnList;l<h.length;l++){var p=h[l];if(p)for(var u=0,d=p;u<d.length;u++){var c=d[u];this.addTouchEvent(c,this.onTouchBtn)}}for(var f=0,g=this._playerLabelList;f<g.length;f++){var y=g[f];this.addTouchEvent(y,this.onTouchPlayer)}this.addTouchEvent(this.myRecord,this.onTouch),this.addTouchEvent(this.myBet,this.onTouch),this.addTouchEvent(this.topRank,this.onTouch),this.addTouchEvent(this.groupBtn1,this.onChargeTab),this.addTouchEvent(this.groupBtn2,this.onChargeTab),this.addTouchEvent(this.groupBtn3,this.onChargeTab),this.addTouchEvent(this.groupBtn0,this.onChargeTab),this.addTouchEvent(this.finals,this.onTouch),this.addTouchEvent(this.vewChampScore,this.onTouch)},e.prototype.addDisplay=function(){this.observe(PeakedSys.ins().postState,this.upCurState),this.observe(PeakedSys.ins().postBetInfo,this.refBetState),this.observe(PeakedSys.ins().postKFBetInfo,this.refBetState),this.observe(PeakedSys.ins().postBFInfoList,this.upSixteenData),this.observe(PeakedSys.ins().postKFInfoList,this.upSixteenData),this.observe(PeakedRedpoint.ins().postRedPoint,this.refRedpoint),this.clearGroupSelect(),PeakedRedpoint.ins().postRedPoint(),this.upCurState(),this.upSixteenData()},e.prototype.removeDisplay=function(){this.cleanMc()},e.prototype.upCurState=function(){this.updateMc(),PeakedSys.ins().isKf()?(PeakedSys.ins().isKFSixteen()?this.currentState="kf":(this.currentState="kf_four",this.cleanMc()),this.upKf16Data()):this.currentState="bf",this.upStateData()},e.prototype.upStateData=function(){var t=0;if(PeakedSys.ins().isKf()){var e=PeakedSys.ins().kfStatus;e==KF_PeakStatus.Finals&&0!=PeakedSys.ins().kfStatusIsEnd?(this.singleTimeInfoLabel.text=PeakedHelp.getNextTimerStr(),this.timerGroup.visible=!1):(PeakedSys.ins().kfStatusIsEnd&&e++,t=PeakedHelp.kfStatusTimer[e],this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_KF_TYPE_CN[e])}else{var e=PeakedSys.ins().bfStatus;if(0==e)return;e==BF_PeakStatus.Finals&&0!=PeakedSys.ins().bfStatusIsEnd?(this.singleTimeInfoLabel.text=PeakedHelp.getNextKfTimerStr(),this.timerGroup.visible=!1):(PeakedSys.ins().bfStatusIsEnd&&e++,t=PeakedHelp.bfStatusTimer[e],this.singleTimeInfoLabel.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_13)+" "+PeakedData.STATE_TYPE_CN[e])}if(this.timerGroup.visible)for(var i=1;5>=i;i++)this["gameTime"+i+"Txt"].text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_14),t+=GlobalConfig.PeakRaceBase.promInterval},e.prototype.refBetState=function(){var t=PeakedSys.ins().bfStatus,e=PeakedSys.ins().kfStatus,i=PeakedSys.ins().isKf();if(i?(e!=this.lastStatus&&(this.hasBed=!1),this.lastStatus=e):(t!=this.lastStatus&&(this.hasBed=!1),this.lastStatus=t),t=PeakedSys.ins().bfStatusIsEnd?t+1:t,e=PeakedSys.ins().kfStatusIsEnd?e+1:e,PeakedSys.ins().bfStatus+1!=BF_PeakStatus.Finals&&PeakedSys.ins().kfStatus+1!=KF_PeakStatus.Finals||!PeakedSys.ins().bfStatusIsEnd)this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:查看比分");else{var s=void 0;s=i?PeakedHelp.getKFPlayerData(4,1,this._curGroup,PeakedSys.ins().isKFSixteen()):PeakedHelp.getPlayerData(4,1),s&&PeakedHelp.checkIsBet(s.playerList,"4")?this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:已支持"):this.vewChampScore.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:决赛支持")}i?this.vewChampScore.visible=e>KF_PeakStatus.Prom4:this.vewChampScore.visible=t>BF_PeakStatus.Prom4;for(var n in this._vsBtnList){var o=!1;if(i)if(PeakedSys.ins().isKFSixteen()){o=n==this.PK_GROUP_1+""&&e==KF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&e==KF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&e==KF_PeakStatus.Prom4;for(var a=0,r=this._vsBtnList[n];a<r.length;a++){var l=r[a];l.visible=n==this.PK_GROUP_1+""&&e>=KF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&e>=KF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&e>=KF_PeakStatus.Prom4}}else{o=n==this.PK_GROUP_1+""&&e==KF_PeakStatus.Prom64||n==this.PK_GROUP_2+""&&e==KF_PeakStatus.Prom32;for(var h=0,p=this._vsBtnList[n];h<p.length;h++){var l=p[h];l.visible=n==this.PK_GROUP_1+""&&e>=KF_PeakStatus.Prom64||n==this.PK_GROUP_2+""&&e>=KF_PeakStatus.Prom32}}else{o=n==this.PK_GROUP_1+""&&t==BF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&t==BF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&t==BF_PeakStatus.Prom4;for(var u=0,d=this._vsBtnList[n];u<d.length;u++){var l=d[u];l.visible=n==this.PK_GROUP_1+""&&t>=BF_PeakStatus.Prom16||n==this.PK_GROUP_2+""&&t>=BF_PeakStatus.Prom8||n==this.PK_GROUP_3+""&&t>=BF_PeakStatus.Prom4}}o=i?o&&0!=PeakedSys.ins().kfStatusIsEnd:o&&0!=PeakedSys.ins().bfStatusIsEnd,this.hasBed=PeakedHelp.checkIsBetByGroup(n);for(var c=0,f=this._vsBtnList[n];c<f.length;c++){var l=f[c];if(l)if(o){var g=l.name.split("_"),s=void 0;if(s=i?PeakedHelp.getKFPlayerData(+g[0],+g[1],this._curGroup,PeakedSys.ins().isKFSixteen()):PeakedHelp.getPlayerData(+g[0],+g[1]),s&&PeakedHelp.checkIsBet(s.playerList,n)){l.currentState="beted";break}l.currentState="bet"}else l.currentState="view"}if(o&&this.hasBed)for(var y=0,v=this._vsBtnList[n];y<v.length;y++){var l=v[y];"bet"==l.currentState&&(l.currentState="view")}}},e.prototype.upSixteenData=function(){if(PeakedSys.ins().isKf()){if("kf_four"==this.currentState){var t=PeakedHelp.findBetKFGroup();t>-1?this._curGroup=t:this._curGroup=PeakedHelp.findKFGroupById(Actor.actorID),this._curGroup=this._curGroup<0?0:this._curGroup,this["groupBtnSelect"+this._curGroup]&&(this["groupBtnSelect"+this._curGroup].visible=!0)}this.upKf16Data()}else this.up16Data(PeakedSys.ins().player16List)},e.prototype.upKf16Data=function(){PeakedSys.ins().isKFSixteen()?this.up16Data(PeakedSys.ins().kfPlayer16List):PeakedSys.ins().kfPlayer64List&&this.up16Data(PeakedSys.ins().kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1))},e.prototype.up16Data=function(t){if(this.clearPlayer(),t)for(var e=0;e<this.MAX;e++)if(e%2==0){var i=t[e/2];i&&i.playerList[0]&&(this["player"+e].text=""+i.playerList[0].playerName,this["player"+e].name=i.playerList[0].playerName+"_"+i.playerList[0].roleId,i.playerList[0].roleId==Actor.actorID?this["player"+e].textColor=ColorUtil.GREEN:this["player"+e].textColor=16298305),i&&i.playerList[1]&&(this["player"+(e+1)].text=""+i.playerList[1].playerName,this["player"+(e+1)].name=i.playerList[1].playerName+"_"+i.playerList[1].roleId,i.playerList[1].roleId==Actor.actorID?this["player"+(e+1)].textColor=ColorUtil.GREEN:this["player"+(e+1)].textColor=16298305)}var s;if(PeakedSys.ins().isKf()){if(PeakedSys.ins().isKFSixteen()){var n=PeakedSys.ins().kfPlayer2Data;n&&n.winId&&(s=PeakedHelp.findPlayerDtById(n.winId))}}else{var n=PeakedSys.ins().player2Data;n&&n.winId&&(s=PeakedHelp.findPlayerDtById(n.winId))}s?(this.championFace.source="yuanhead"+s.job+s.sex,this.championNameLabel.text=s.playerName,this.championNameLabel.name=s.playerName+"_"+s.roleId,this.peaknessProcess.visible=!1,this.finals.visible=!0):(this.championFace.source="",this.championNameLabel.text="",this.championNameLabel.name="",this.peaknessProcess.visible=!0,this.finals.visible=!1),this.peaknessProcess.visible?this.updateMc():this.cleanMc(),this.upLink(),this.refBetState()},e.prototype.upLink=function(){this.clearLink();var t=PeakedSys.ins(),e=[];e=t.isKf()?PeakedSys.ins().isKFSixteen()?[t.kfPlayer16List,t.kfPlayer8List,t.kfPlayer4List,[t.kfPlayer2Data]]:[t.kfPlayer64List.slice(this._curGroup*this.MAX>>1,this._curGroup*this.MAX+this.MAX>>1),t.kfPlayer32List.slice(this._curGroup*this.MAX>>2,this._curGroup*this.MAX+this.MAX>>2),t.kfPlayer16List.slice(this._curGroup*this.MAX>>3,this._curGroup*this.MAX+this.MAX>>3),t.kfPlayer8List.slice(this._curGroup*this.MAX>>4,this._curGroup*this.MAX+this.MAX>>4)]:[t.player16List,t.player8List,t.player4List,[t.player2Data]];for(var i=0,s=0,n=e;s<n.length;s++){var o=n[s];if(o&&this._linkGroupList[i].length>0)for(var a=0,r=0,l=o;r<l.length;r++){var h=l[r];h&&(0==PeakedHelp.findPlayerIndexById(h.winId,h.playerList)?PeakedHelp.setImgGroupSource(this._linkGroupList[i][2*a],"line_light"):1==PeakedHelp.findPlayerIndexById(h.winId,h.playerList)&&PeakedHelp.setImgGroupSource(this._linkGroupList[i][2*a+1],"line_light"),a++)}i++}},e.prototype.onTouchPlayer=function(t){var e=t.target;if(e.name){var i=e.name.split("_");if(Actor.myName==i[0]&&+i[1]==Actor.actorID)return void ViewManager.ins().open(RoleWin);var s=PeakedHelp.findPlayerDtById(+i[1]);s?ReadPlayerCT.ins().sendFindPlayer(i[1],s.serverId):ReadPlayerCT.ins().sendFindPlayer(i[1])}},e.prototype.onTouchBtn=function(t){var e=t.target.parent,i=e.name,s=i.split("_");switch(e.currentState){case"view":ViewManager.ins().open(PeakViewBattleReportWin,+s[0],+s[1],this._curGroup);break;case"bet":ViewManager.ins().open(PeakBetWin,+s[0],+s[1],this._curGroup);break;case"beted":}},e.prototype.onTouch=function(t){switch(t.target){case this.finals:var e=this.championNameLabel.name.split("_");if(Actor.myName==e[0]&&+e[1]==Actor.actorID)return void ViewManager.ins().open(RoleWin);var i=PeakedHelp.findPlayerDtById(+e[1]);i?ReadPlayerCT.ins().sendFindPlayer(e[1],i.serverId):ReadPlayerCT.ins().sendFindPlayer(e[1]);break;case this.vewChampScore:"查看比分"==this.vewChampScore.text?ViewManager.ins().open(PeakViewBattleReportWin,4,1,this._curGroup):"决赛支持"==this.vewChampScore.text&&ViewManager.ins().open(PeakBetWin,4,1,this._curGroup);break;case this.myRecord:ViewManager.ins().open(PeakMyBattleRecordWin,this._curGroup);break;case this.myBet:ViewManager.ins().open(PeakMyBetRecordWin);break;case this.topRank:ViewManager.ins().open(PeakTopRankWin)}},e.prototype.onChargeTab=function(t){switch(this.clearGroupSelect(),t.target){case this.groupBtn0:this._curGroup=0,this.groupBtnSelect0.visible=!0,this.upKf16Data();break;case this.groupBtn1:this._curGroup=1,this.groupBtnSelect1.visible=!0,this.upKf16Data();break;case this.groupBtn2:this._curGroup=2,this.groupBtnSelect2.visible=!0,this.upKf16Data();break;case this.groupBtn3:this._curGroup=3,this.groupBtnSelect3.visible=!0,this.upKf16Data()}},e.prototype.refRedpoint=function(){this.topRankRedpoint.visible=PeakedRedpoint.ins().redpoint2>0},e.prototype.clearLink=function(){for(var t=0;t<this.MAX;t++)this._linkGroupList[this.PK_GROUP_0][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_0][t],"line_black"),this._linkGroupList[this.PK_GROUP_1][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_1][t],"line_black"),this._linkGroupList[this.PK_GROUP_2][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_2][t],"line_black"),this._linkGroupList[this.PK_GROUP_3][t]&&PeakedHelp.setImgGroupSource(this._linkGroupList[this.PK_GROUP_3][t],"line_black")},e.prototype.clearPlayer=function(){for(var t=1;t<=this.MAX;t++)this["player"+(t-1)].text="",this["player"+(t-1)].name=""},e.prototype.clearGroupSelect=function(){this.groupBtnSelect0.visible=!1,this.groupBtnSelect1.visible=!1,this.groupBtnSelect2.visible=!1,this.groupBtnSelect3.visible=!1},e.prototype.updateMc=function(){this.psdmc||(this.psdmc=new MovieClip),this.psdmc.parent||this.psdGroup.addChild(this.psdmc),this.pstmc||(this.pstmc=new MovieClip),this.pstmc.parent||this.pstGroup.addChild(this.pstmc),this.psdmc.isPlaying||this.psdmc.playFile(RES_DIR_EFF+"peakSeasonDragon",-1),this.pstmc.isPlaying||this.pstmc.playFile(RES_DIR_EFF+"peakSeasonTxt",-1)},e.prototype.cleanMc=function(){this.psdmc&&DisplayUtils.removeFromParent(this.psdmc),this.pstmc&&DisplayUtils.removeFromParent(this.pstmc)},__decorate([callLater],e.prototype,"upStateData",null),__decorate([callLater],e.prototype,"upKf16Data",null),__decorate([callLater],e.prototype,"up16Data",null),e}(BaseView);__reflect(SixteenPanel.prototype,"SixteenPanel"),window.SixteenPanel=SixteenPanel;var WorshipChampionPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.praiseGroup0.touchChildren=!1,this.praiseGroup1.touchChildren=!1,this.praiseGroup2.touchChildren=!1,this.bodyMc0=new MovieClip,this.bodyMc0.visible=!1,this.wefbodyMc0=new MovieClip,this.wefbodyMc0.visible=!1,this.eBodyMCGroup0.addChild(this.wefbodyMc0),this.eBodyMCGroup0.addChild(this.bodyMc0),this.wingMc0=new MovieClip,this.wingMc0.visible=!1,this.eWingMCGroup0.addChild(this.wingMc0),this.bodyMc1=new MovieClip,this.bodyMc1.visible=!1,this.wefbodyMc1=new MovieClip,this.wefbodyMc1.visible=!1,this.eBodyMCGroup1.addChild(this.wefbodyMc1),this.eBodyMCGroup1.addChild(this.bodyMc1),this.wingMc1=new MovieClip,this.wingMc1.visible=!1,this.eWingMCGroup1.addChild(this.wingMc1),this.bodyMc2=new MovieClip,this.bodyMc2.visible=!1,this.wefbodyMc2=new MovieClip,this.wefbodyMc2.visible=!1,this.eBodyMCGroup2.addChild(this.wefbodyMc2),this.eBodyMCGroup2.addChild(this.bodyMc2),this.wingMc2=new MovieClip,this.wingMc2.visible=!1,this.eWingMCGroup2.addChild(this.wingMc2),this.addTouchEvent(this.shipBtn,this.onTouch),this.addTouchEvent(this.praiseGroup0,this.onTouch),this.addTouchEvent(this.praiseGroup1,this.onTouch),this.addTouchEvent(this.praiseGroup2,this.onTouch)},e.prototype.addDisplay=function(){this.observe(Actor.ins().postChip,this.upData),this.observe(PeakedSys.ins().postWorship,this.upData),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.isEff=!1,this.initData(),this.upData()},e.prototype.initData=function(){if(PeakedSys.ins().kfPlayer2Data&&PeakedSys.ins().kfPlayer2Data.winId&&PeakedSys.ins().kfStatus>=KF_PeakStatus.Knockout&&PeakedSys.ins().kfStatusIsEnd){var t=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);t&&ReadPlayerCT.ins().sendFindPlayer(t.roleId,t.serverId),this.shipBtn.enabled=!0,this.chipLabel.visible=!0,this.countLabel.visible=!0}else this.shipBtn.enabled=!1,this.chipLabel.visible=!1,this.countLabel.visible=!1;for(var e=0;3>e;e++)this["praiseGroup"+e].visible=!1;this.name0.text="暂无",this.chipLabel.text="荣耀：+"+GlobalConfig.PeakRaceBase.mobaiChips,this.titleMc||(this.titleMc=ObjectPool.pop("MovieClip"),this.titleMc.x=this.titleMcGroup.x,this.titleMc.y=this.titleMcGroup.y),this.titleGroup.addChild(this.titleMc);var i=RES_DIR_EFF+"Title1qiang";this.titleMc.playFile(i,-1)},e.prototype.upData=function(){var t=GlobalConfig.PeakRaceBase;t.mobaiNum||(t.mobaiNum=10);var e=PeakedSys.ins().worshipNum<t.mobaiNum?ColorUtil.GREEN_COLOR_N:ColorUtil.RED,i="膜拜：|C:"+e+"&T:"+PeakedSys.ins().worshipNum+"/"+t.mobaiNum;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.isEff&&this.playYHEff()},e.prototype.playYHEff=function(){this.yanHuaMc&&(DisplayUtils.removeFromParent(this.yanHuaMc),this.yanHuaMc=null),this.yanHuaMc=new MovieClip,this.yanHuaMc.x=270,this.yanHuaMc.y=335,this.addChildAt(this.yanHuaMc,this.numChildren+1),this.yanHuaMc.playFile(RES_DIR_EFF+"FireWork",2),this.isEff=!1},e.prototype.onTouch=function(t){switch(t.target){case this.shipBtn:if(PeakedSys.ins().worshipNum>=GlobalConfig.PeakRaceBase.mobaiNum)return void TipsCT.ins().showTips("今日膜拜次数已用完！");if(!PeakedSys.ins().kfPlayer2Data.winId)return void TipsCT.ins().showTips("当前没有可膜拜的冠军！");this.isEff=!0,PeakedSys.ins().sendWorship();break;case this.praiseGroup0:case this.praiseGroup1:case this.praiseGroup2:var e=PeakedHelp.findPlayerDtById(PeakedSys.ins().kfPlayer2Data.winId);e&&ReadPlayerCT.ins().sendFindPlayer(e.roleId,e.serverId)}},e.prototype.openOtherPlayerView=function(t){if(this.otherPlayerData=t,this._openOtherWin){var e=ViewManager.ins().open(RRoleWin,t);e.hideEx(1),this._openOtherWin=!1}else{this.startShowZhanling(),this._openOtherWin=!0;for(var i=0;i<t.roleData.length;i++){this["praiseGroup"+i].visible=!0;var s=t.roleData[i],n=s.getZhuangBanNG(),o=void 0,a=n[0],r=n[1],l=s.getEquipByIndex(0),h=l.item.configID,p=s.getEquipByIndex(2),u=p.item.configID;this["weaponImg"+i].source=null,this["bodyImg"+i].source=null,this["name"+i].text="S."+t.serverId+t.name;var d=GlobalConfig.ClientGlobalConfig.useManRes?0:s.sex;if(h>0){var c=GlobalConfig.EquipConfig[h].appearance;c&&c.indexOf("[job]")>-1&&(c=c.replace("[job]",s.job+"")),this["weaponImg"+i].source=c+"_"+d+"_c_png"}if(u>0){var c=GlobalConfig.EquipConfig[u].appearance;c&&c.indexOf("[job]")>-1&&(c=c.replace("[job]",s.job+"")),this["bodyImg"+i].source=c+"_"+s.sex+"_c_png",o=!0}if(o||(this["bodyImg"+i].source="body000_"+s.sex+"_c_png"),r>0){var f=this.getZhuangbanById(r);f.useMc>0?(this["weaponImg"+i].visible=!1,this["wefbodyMc"+i].visible=!0,this["wefbodyMc"+i].playFile(RES_DIR_DRESS+f.res+"_"+d+"_c_m",-1)):(this["weaponImg"+i].visible=!0,this["wefbodyMc"+i].visible=!1,this["weaponImg"+i].source=f.res+"_"+d+"_c_png")
}if(a>0){var f=this.getZhuangbanById(a);f.useMc>0?(this["bodyImg"+i].visible=!1,this["bodyMc"+i].visible=!0,this["bodyMc"+i].playFile(RES_DIR_DRESS+f.res+"_"+s.sex+"_c_m",-1)):(this["bodyMc"+i].visible=!1,this["bodyImg"+i].visible=!0,this["bodyImg"+i].source=f.res+"_"+s.sex+"_c_png")}var g=this["wingImg"+i],y=this["wingMc"+i];this["wingImg"+i].source=null,g.visible=!0,y.visible=!1;var v=s.wingsData,m=n[2];if(m>0){var f=this.getZhuangbanById(m);f.useMc?y.playFile(RES_DIR_DRESS+f.res+"_c_m",-1):g.source=f.res+"_png",y.visible=f.useMc>0,g.visible=!y.visible}else v.openStatus&&(g.source=GlobalConfig.WingLevelConfig[v.lv].appearance+"_png");(!n||n[0]<=0)&&this.setEffect(s.getEquipByIndex(2).item.configID,"bPos"+i+"_",s.sex,this["bodyEffect"+i],this["bodyEff"+i]),(!n||n[1]<=0)&&this.setEffect(s.getEquipByIndex(0).item.configID,"wPos"+i+"_",s.sex,this["weaponEffect"+i],this["weaponEff"+i])}}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.setEffect=function(t,e,i,s,n){n||(n=new MovieClip);var o=GlobalConfig.EquipWithEffConfig[t+"_"+i];o?(n.scaleX=n.scaleY=o.scaling,n.parent||s.addChild(n),n.x=this[e+i].x+o.offX,n.y=this[e+i].y+o.offY,n.playFile(RES_DIR_EFF+o.inShowEff,-1)):n.parent&&n.parent.removeChild(n)},e.prototype.showZhanling=function(t){var e=t.zhanlingID,i=t.zhanlingLevel;if(!(0>i)){this.warfileName=GlobalConfig.ZhanLingBase[e].appearance,this.warMc||(this.warMc=new MovieClip,this.warMc.x=400,this.warMc.y=220,this.praiseGroup0.addChildAt(this.warMc,0),this.warMc.playFile(RES_DIR_MONSTER+this.warfileName+"_4s",-1),this.warMc.touchEnabled=!1);var s=GlobalConfig.ZhanLingConfig.anchorOffset[0]||[];this.warMc.anchorOffsetX=s[0]||0,this.warMc.anchorOffsetY=s[1]||0,Timer.stop(this.startShowZhanling,this),Timer.start(200,1,this.playZhanLingAttack,this)}},e.prototype.playZhanLingAttack=function(){var t=this;if(this.warMc){var e=RES_DIR_MONSTER+this.warfileName+"_4"+EntityAction.ATTACK;this.warMc.playFile(e,1,function(){var e=RES_DIR_MONSTER+t.warfileName+"_4"+EntityAction.STAND;t.warMc.playFile(e,-1,null,!1),Timer.stop(t.playZhanLingAttack,t),Timer.start(2800,1,t.hideZhanling,t)},!1)}},e.prototype.hideZhanling=function(){var t=this;this.warMc&&egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){DisplayUtils.removeFromParent(t.warMc),t.warMc=null,Timer.stop(t.hideZhanling,t),Timer.start(7e3,1,t.startShowZhanling,t)})},e.prototype.startShowZhanling=function(){},e}(BaseView);__reflect(WorshipChampionPanel.prototype,"WorshipChampionPanel"),window.WorshipChampionPanel=WorshipChampionPanel;var PeakBetWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BetSkin",e.numLabel.restrict="0-9",e.numLabel.maxChars=8,e.arrow0.visible=!1,e.arrow1.visible=!1,e.aPlayerGroup=e.face0.parent,e.aPlayerGroup.touchChildren=!1,e.bPlayerGroup=e.face1.parent,e.bPlayerGroup.touchChildren=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.tipGroup,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.betBtn,this.onTouch),this.addTouchEvent(this.maxBtn,this.onTouch),this.addTouchEvent(this.aPlayerGroup,this.onTouch),this.addTouchEvent(this.bPlayerGroup,this.onTouch),this.addChangeEvent(this.numLabel,this.changeInput);var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s);if(o){var a=o.playerList[0];this.face0.source=a?"yuanhead"+a.job+a.sex:"",this.name0.text=a?a.playerName:"---",this.select0.name=a?a.roleId+"":"";var r=o.playerList[1];this.face1.source=r?"yuanhead"+r.job+r.sex:"",this.name1.text=r?r.playerName:"---",this.select1.name=r?r.roleId+"":""}this.select0.visible=this.select1.visible=!1;var l=Actor.chip,h=PeakedSys.ins().isKf()?GlobalConfig.PeakRaceCrossTime[PeakedSys.ins().kfStatus+1].maxBett:GlobalConfig.PeakRaceTime[PeakedSys.ins().bfStatus+1].maxBett;this._maxNum=l>h?h:l,this.changeInput(null)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.tipGroup,this.onTouch),this.removeTouchEvent(this.bgClose,this.onTouch),this.removeTouchEvent(this.betBtn,this.onTouch),this.removeTouchEvent(this.maxBtn,this.onTouch),this.addChangingEvent(this.numLabel,this.changeInput)},e.prototype.changeInput=function(t){var e=parseInt(this.numLabel.text);null==t&&(e=this._maxNum),0>e||!e?e=0:e>this._maxNum&&(e=this._maxNum),this.numLabel.text=e+""},e.prototype.onTouch=function(t){switch(t.target){case this.tipGroup:case this.bgClose:ViewManager.ins().close(this);break;case this.betBtn:var i=parseInt(this.numLabel.text);if(this._curId){if(0>=i)return void TipsCT.ins().showTips("荣耀不够");PeakedSys.ins().isKf()?PeakedSys.ins().sendKFBet(this._curId,i):PeakedSys.ins().sendBet(this._curId,i),ViewManager.ins().close(e)}else TipsCT.ins().showTips("请先选择需要支持的玩家");break;case this.maxBtn:this.changeInput(null);break;case this.aPlayerGroup:this.select0.name&&(this.select0.visible=!0,this.select1.visible=!1,this.arrow0.visible=!0,this.arrow1.visible=!1,this._curId=parseInt(this.select0.name));break;case this.bPlayerGroup:this.select1.name&&(this.select1.visible=!0,this.select0.visible=!1,this.arrow0.visible=!1,this.arrow1.visible=!0,this._curId=parseInt(this.select1.name))}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s);return o&&o.playerList.length>1?!0:o&&1==o.playerList.length?(TipsCT.ins().showTips("人数不足，无法支持！"),!1):(TipsCT.ins().showTips("本轮轮空,无法支持！"),!1)},e}(BaseEuiView);__reflect(PeakBetWin.prototype,"PeakBetWin"),window.PeakBetWin=PeakBetWin,ViewManager.ins().reg(PeakBetWin,LayerManager.UI_Popup);var PeakMyBattleRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="MyRecordSkin",this.list.itemRenderer=PeakMyBattleRecordItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.addTouchEvent(this.tipGroup,this.onClose),this.addTouchEvent(this.list,this.onTouchList);var i=[];PeakedSys.ins();PeakedSys.ins().isKf()?(i=PeakedSys.ins().myKFBattleReportList,i=PeakedHelp.countKFMyRecordData()):i=PeakedSys.ins().myBattleReportList,this.list.dataProvider=new eui.ArrayCollection(i),DisplayUtils.scrollerToBottom(this.scrollerList)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){if(t.target instanceof eui.Label&&t.target.parent instanceof PeakMyBattleRecordItemRender){var e=t.target.parent.data;e&&ReadPlayerCT.ins().sendFindPlayer(e.roleId)}},e}(BaseEuiView);__reflect(PeakMyBattleRecordWin.prototype,"PeakMyBattleRecordWin"),window.PeakMyBattleRecordWin=PeakMyBattleRecordWin,ViewManager.ins().reg(PeakMyBattleRecordWin,LayerManager.UI_Popup);var PeakMyBetRecordWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MyBetRecordSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=PeakMyBetItemRender},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.addTouchEvent(this.tipGroup,this.onClose),this.observe(PeakedSys.ins().postKFBetInfo,this.updata),this.updata()},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.updata=function(){var t=[],e=0,i=0,s=PeakedSys.ins().isKf()?PeakedSys.ins().kfBetInfo:PeakedSys.ins().betInfo;if(s)for(var n=0,o=s;n<o.length;n++){var a=o[n];e+=a.batNum,t.push(a),PeakedHelp.statusIsOver(a.status,PeakedSys.ins().isKf())&&(PeakedHelp.checkIsWinById(a.playerId,a.status)?i+=a.batNum:i-=a.batNum)}var r=i>0?"，|C:"+ColorUtil.GREEN+"&T:获利："+i+"|":"|C:"+ColorUtil.RED+"&T:损失："+-i+"荣耀|";0==i&&(r="");var l="你已经支持"+t.length+"场比赛，支持总额: |C:"+ColorUtil.GREEN+"&T:"+e+"|荣耀"+r;this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1(l),t.sort(PeakedHelp.sortBetFun),this.eList.dataProvider=new eui.ArrayCollection(t),DisplayUtils.scrollerToBottom(this.scrollerList)},e}(BaseEuiView);__reflect(PeakMyBetRecordWin.prototype,"PeakMyBetRecordWin"),window.PeakMyBetRecordWin=PeakMyBetRecordWin,ViewManager.ins().reg(PeakMyBetRecordWin,LayerManager.UI_Popup);var PeakTopRankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SupportRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){this.list.itemRenderer=PeakTopRankItemRender,this._listDt=new eui.ArrayCollection,this.list.dataProvider=this._listDt},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PeakedSys.ins().postSignUp,this.onSingUp),this.observe(PeakedSys.ins().postTopRank,this.upList),this.observe(PeakedSys.ins().postKFTopRank,this.upList),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.tipGroup,this.onTouch),this.addTouchEvent(this.list,this.onTouch),this.onSingUp()},e.prototype.onSingUp=function(){PeakedSys.ins().isKf()?PeakedSys.ins().sendKFTopRank():PeakedSys.ins().sendTopRank()},e.prototype.upList=function(){PeakedSys.ins().isKf()?this._listDt.replaceAll(PeakedSys.ins().kfTopRankInfoList):this._listDt.replaceAll(PeakedSys.ins().topRankInfoList)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.tipGroup:ViewManager.ins().close(this);break;default:if(t.target.parent instanceof PeakTopRankItemRender){var e=t.target.parent.data;t.target instanceof eui.Button?PeakedSys.ins().isKf()?PeakedSys.ins().sendKFToLikes(e.playerId):PeakedSys.ins().sendToLikes(e.playerId):t.target instanceof eui.Label&&ReadPlayerCT.ins().sendFindPlayer(e.playerId,e.servId)}}},e}(BaseEuiView);__reflect(PeakTopRankWin.prototype,"PeakTopRankWin"),window.PeakTopRankWin=PeakTopRankWin,ViewManager.ins().reg(PeakTopRankWin,LayerManager.UI_Popup);var PeakViewBattleReportWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="WarReportSkin",this.list.itemRenderer=PeakViewBattleReportItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose);var i=t[0],s=t[1],n=PeakedSys.ins().isKFSixteen(),o=PeakedSys.ins().isKf()?PeakedHelp.getKFPlayerData(i,s,t[2],n):PeakedHelp.getPlayerData(i,s),a=[],r=0,l=0,h=GlobalConfig.PeakRaceBase.promWin;if(h||(h=3),o)if(0==o.playerList.length)this.AnameTxt.text="无选手",this.BnameTxt.text="无选手";else{o.playerList[0]&&(this.AnameTxt.text=o.playerList[0].playerName),o.playerList[1]?this.BnameTxt.text=o.playerList[1].playerName:this.BnameTxt.text="轮空";for(var p=PeakedHelp.statusIsOverByGroup(i),u=0;5>u;u++){var d=void 0;if(o.reportList[u])d={},d.winer=PeakedHelp.findPlayerDtById(o.reportList[u]).playerName,d.round=u+1,o.reportList[u]==o.playerList[0].roleId?r++:l++;else if(p)continue;if(a[u]=d,r>=h||l>=h)break}}else this.AnameTxt.text="无选手",this.BnameTxt.text="无选手";o&&0==o.reportList.length&&!o.playerList[1]&&(r=h),this.score.text=r+"."+l,this.list.dataProvider=new eui.ArrayCollection(a)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PeakViewBattleReportWin.prototype,"PeakViewBattleReportWin"),window.PeakViewBattleReportWin=PeakViewBattleReportWin,ViewManager.ins().reg(PeakViewBattleReportWin,LayerManager.UI_Popup);var CollectWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="CollectSkin",e.progressBar.labelFunction=function(t,e){return""},e}return __extends(e,t),e.prototype.childrenCreated=function(){this.progressBar.value=0,this.progressBar.visible=!1,this.bgmc=new MovieClip,this.bgmc.playFile(RES_DIR_EFF+"ProgressEff1",-1),this.bgmc.scaleX=1.25,this.effGroup.height=50,this.effGroup.scrollEnabled=!0,this.effGroup.addChild(this.bgmc)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.state.text=Actor.myName+" 正在采集中...",egret.Tween.removeTweens(this.effGroup),this.effGroup.scaleX=0,egret.Tween.get(this.effGroup).to({scaleX:1},1e3*t[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.Tween.removeTweens(this.effGroup)},e}(BaseEuiView);__reflect(CollectWin.prototype,"CollectWin"),window.CollectWin=CollectWin,ViewManager.ins().reg(CollectWin,LayerManager.UI_Popup);var ReliveWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e.skinName="ReliveSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.remainM=t[0];var i=t[1];i&&(this.killTips.textFlow=(new egret.HtmlTextParser).parser("你被"+StringUtils.addColor(""+i,"#23C42A")+"击败")),this.reliveTimesTxt.text=this.remainM+"秒",Timer.has(this.refushLabel,this)||Timer.start(1e3,this.remainM,this.refushLabel,this,this.overTime,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒",this.remainM<=0&&this.overTime()},e.prototype.overTime=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ReliveWin.prototype,"ReliveWin"),window.ReliveWin=ReliveWin,ViewManager.ins().reg(ReliveWin,LayerManager.UI_Popup);var ServerSwitchIngWin=function(t){function e(){var e=t.call(this)||this;return e.symbolStrs=[".","..","..."],e._tick=0,e.skinName="KFSwitchServerSkin",e.progressBar.maximum=20,e.progressBar.value=0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._tick=0,Timer.has(this.onTime,this)||Timer.start(100,0,this.onTime,this)},e.redClose=function(){var t=ViewManager.ins().getView(e);t&&t.redClose()},e.prototype.redClose=function(){this.progressBar.value=this.progressBar.maximum,Timer.has(this.closeWin,this)||Timer.start(1e3,1,this.closeWin,this)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.onTime=function(){this._tick+=1,this.switchLabel.text=KFServerSys.ins().isKFServ?"正在前往跨服...":"正在回到本服...",this.progressBar.value=this._tick,this._tick>20&&Timer.stop(this.onTime,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this),this.progressBar.value=0},e}(BaseEuiView);__reflect(ServerSwitchIngWin.prototype,"ServerSwitchIngWin"),window.ServerSwitchIngWin=ServerSwitchIngWin,ViewManager.ins().reg(ServerSwitchIngWin,LayerManager.UI_Tips);var SmallMapPanel=function(t){function e(e,i){void 0===e&&(e=200);var s=t.call(this)||this;return s._fixedMaxNum=0,s._limit_width=200,s._limit_height=0,s.R_Scale=.58,s.MOVE_DELAY=300,s.flagRes=["wj_gray_flag_icon","wj_green_flag_icon","wj_red_flag_icon"],s.entityRes=["wj_green_point","wj_blue_point"],e&&(s._limit_width=e),i&&(s._limit_height=i),s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.signList=[],this.initUI()},e.prototype.onMapComplete=function(t){this._limit_width?this.R_Scale=this._limit_width/this.mapBg.width:this._limit_height&&(this.R_Scale=this._limit_height/this.mapBg.height),this.mapBg.width*=this.R_Scale,this.mapBg.height*=this.R_Scale,this.frameImg.width=this.mapBg.width,this.frameImg.height=this.mapBg.height,this.initFixedP()},e.prototype.open=function(t){this._curSceneType=t,this.observe(GameLogic.ins().postCreateOtherEntity,this.calcPlayMainEntityList),this.calcPlayMainEntityList(),this.refreshCoordinate(),Timer.start(this.MOVE_DELAY,0,this.refreshCoordinate,this)},e.prototype.close=function(){this.signList=[],Timer.stop(this.refreshCoordinate,this)},e.prototype.initUI=function(){switch(this._fixedList=[],this._curSceneType){case SmallSceneType.WJBattle:this._fixedMaxNum=3;for(var t=0;t<this._fixedMaxNum;t++){this._fixedList[t]=new eui.Image,this._fixedList[t].source=this.flagRes[0],this._fixedList[t].anchorOffsetX=this._fixedList[t].width>>1,this._fixedList[t].anchorOffsetY=this._fixedList[t].height;var e=GlobalConfig.WujiBaseConfig.flagPoint[t];this._fixedList[t].x=e.x*GameMap.CELL_SIZE/10*this.R_Scale,this._fixedList[t].y=e.y*GameMap.CELL_SIZE/10*this.R_Scale,this.addChild(this._fixedList[t])}}this.mapBg=new eui.Image,this.mapBg.source="map/"+GameMap.getFileName()+"/small.jpg",this.mapBg.addEventListener(egret.Event.COMPLETE,this.onMapComplete,this),this.addChildAt(this.mapBg,0)},e.prototype.initFixedP=function(){switch(this._curSceneType){case SmallSceneType.WJBattle:for(var t=0;t<this._fixedMaxNum;t++){var e=GlobalConfig.WujiBaseConfig.flagPoint[t];this._fixedList[t].x=e.x*GameMap.CELL_SIZE/10*this.R_Scale,this._fixedList[t].y=e.y*GameMap.CELL_SIZE/10*this.R_Scale}}},e.prototype.refreshCoordinate=function(){},e.prototype.calcPlayMainEntityList=function(){var t={},e={},i=EntityManager.ins().getAllEntity();for(var s in i){var n=i[s];if(n&&n.infoModel){if(n.infoModel.type!=EntityType.Role)continue;var o=n.infoModel;e[o.name]||(e[o.name]=[]),e[o.name].push(n)}}for(var a in e){var r=e[a];r.sort(function(t,e){return t.infoModel.job<e.infoModel.job?-1:t.infoModel.job>e.infoModel.job?1:0});var l=r[0];t[l.infoModel.handle]=l}return this._entityList=t,t},e}(BaseView);__reflect(SmallMapPanel.prototype,"SmallMapPanel");var SmallSceneType;!function(t){t[t.WJBattle=0]="WJBattle"}(SmallSceneType||(SmallSceneType={})),window.SmallMapPanel=SmallMapPanel;var KFSmyjBossCT=function(t){function e(){var e=t.call(this)||this;return e.devilRuinsInfo=[],e.callBossInfo=[],e.isInit=0,e.bossAlertList=[],e.sysId=PackageID.DevilRuins,e.regNetMsg(2,e.postResult),e.regNetMsg(3,e.postBelong),e.regNetMsg(4,e.postInit),e.regNetMsg(5,e.postMonState),e.regNetMsg(8,e.postElert),e.regNetMsg(12,e.postBossNotice),e.regNetMsg(13,e.postBelongTimes),e.regNetMsg(14,e.postHudun),e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType==FbCT.FB_TYPE_SMYJ?Timer.has(e.update,e)||Timer.start(1e3,0,e.update,e):Timer.stop(e.update,e)}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.update=function(){var t,i,s=EntityManager.ins().getAllEntity(),n=SubRoles.lookAtTar,o=GameMap.CELL_SIZE*GlobalConfig.DevilRuinsBase.space;this.monsId=0;for(var a in s)if(t=s[a],i=t.infoModel,i&&i.type==EntityType.Monster&&i.getAtt(AttributeType.atHp)>0){var r=GlobalConfig.MonstersConfig[i.configID];if(!r)continue;if(4==r.type||3==r.type)continue;if(!n)continue;var l=MathUtils.getDistanceByObject(n,t),h=this.getHandleNum(t.infoModel.configID);if(!h)return;var p=GlobalConfig.DevilRuinsBossConfig[this.fbKind][h[1]];if(o>=l&&p.showBelong)this.monsId=i.configID,this.handle=i.handle,ViewManager.ins().open(BossBelongPanel);else{var u=Object.keys(GlobalConfig.DevilRuinsBossConfig).length;if(this.fbKind>=u)return;var d=this.getHandleNum(i.configID);if(d){var c=this.devilRuinsInfo[d[0]-1].monData[d[1]-1].handle;c&&c==Actor.handle&&e.ins().sendCancel(d[0],d[1])}}}!this.monsId&&ViewManager.ins().isShow(BossBelongPanel)&&ViewManager.ins().close(BossBelongPanel),!ViewManager.ins().isShow(BossBelongPanel)&&ViewManager.ins().isShow(BossBloodPanel)&&ViewManager.ins().close(BossBloodPanel)},e.prototype.postInit=function(t){this.isInit=0;t.readBoolean();this.belongTimes=t.readByte(),this.bossBelongTimes=t.readByte(),this.buyTimes=t.readByte(),this.helpTimes=t.readByte();var e=t.readByte();this.devilRuinsInfo=[],this.callBossInfo=[];for(var i=0;e>i;i++)if(i==e-1){for(var s={monNum:t.readByte(),monData:[]},n=0;n<s.monNum;n++){var o={isLive:t.readByte(),caller:t.readString(),bossId:t.readInt(),handle:0,x:0,y:0};s.monData.push(o)}this.callBossInfo.push(s)}else{for(var a={monNum:t.readByte(),monData:[]},n=0;n<a.monNum;n++){var o={isLive:t.readByte(),times:t.readInt(),handle:t.readDouble()};a.monData.push(o)}this.devilRuinsInfo.push(a)}},e.prototype.postBelong=function(t){this.fbKind=t.readByte();var e=t.readByte(),i=t.readDouble(),s=Object.keys(GlobalConfig.DevilRuinsBossConfig).length;this.fbKind==s?this.callBossInfo[0].monData[e-1].handle=i:this.devilRuinsInfo[this.fbKind-1].monData[e-1].handle=i},e.prototype.postResult=function(t){for(var e=t.readByte(),i=t.readByte(),s=[],n=0;i>n;n++){var o={type:t.readByte(),id:t.readInt(),count:t.readInt()};s.push(o)}switch(this.winner=t.readString(),e){case 2:ResultManager.ins().create(FbCT.FB_TYPE_SMYJ,s,1,this.winner,FbCT.FB_TYPE_SMYJ);break;case 1:ResultManager.ins().create(FbCT.FB_TYPE_SMYJ,s,1,this.winner)}},e.prototype.postMonState=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=Object.keys(GlobalConfig.DevilRuinsBossConfig).length;if(this.bossId=0,e==n){var o=t.readString(),a=t.readInt();this.callBossInfo[0].monData[i-1].isLive=s,this.callBossInfo[0].monData[i-1].caller=o,this.callBossInfo[0].monData[i-1].bossId=a,this.winner=o,o==Actor.myName&&s&&(this.bossId=i)}else this.devilRuinsInfo[e-1].monData[i-1].isLive=s,this.devilRuinsInfo[e-1].monData[i-1].times=t.readInt()},e.prototype.postElert=function(t){var e=t.readString(),i=GlobalConfig.DevilRuinsBase.actorRebornCd;if(ViewManager.ins().open(KFBossReliveWin,i,null,e),KFServerSys.ins().isKF){var s=0==this.isInit?Actor.yb:Actor.yb-GlobalConfig.DevilRuinsBase.rebornCost;Actor.ins().postYbChange(s)}},e.prototype.postBossNotice=function(t){this.bossAlertList=[];for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte();this.bossAlertList.push(s)}},e.prototype.postBelongTimes=function(t){this.belongTimes=t.readByte(),this.buyTimes=this.buyTimes+1},e.prototype.postHudun=function(t){this.fbKind=t.readByte(),this.bossIndex=t.readByte(),this.hudunType=t.readByte(),this.hunHp=t.readInt(),this.maxHp=t.readInt()},e.prototype.sendInter=function(t,e){var i=this.getBytes(1);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendCancel=function(t,e){var i=this.getBytes(7);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendRevive=function(){this.sendBaseProto(9)},e.prototype.sendCallBoss=function(){this.sendBaseProto(10)},e.prototype.sendBossSetting=function(){var t=this.bossAlertList?this.bossAlertList.length:0,e=this.getBytes(12);e.writeByte(t);for(var i=0;t>i;i++)e.writeByte(this.bossAlertList[i]);this.sendToServer(e)},e.prototype.sendBelongTimes=function(){this.sendBaseProto(13)},e.prototype.isOpen=function(){return ZsCT.ins().lv>=GlobalConfig.DevilRuinsBase.limitZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.DevilRuinsBase.openDay},e.prototype.getBossId=function(t){var e=GlobalConfig.DevilRuinsBossConfig;for(var i in e)for(var s in e[i])if(e[i][s].bossSort==t)return[Number(i),Number(s)]},e.prototype.callBossOpen=function(){var t=new Date(GameServer.serverTime),e=t.getDay();e=e>0?e:7;var i=t.getHours(),s=GlobalConfig.DevilRuinsBase.callBossTime;return e==s[0]&&i>=s[1]&&i<s[2]},e.prototype.getIndex=function(t){var e=GlobalConfig.DevilRuinsBossConfig,i=Object.keys(e).length;for(var s in e[i])if(e[i][s].bossId==t)return[i,Number(s)]},e.prototype.setBossSetting=function(t){if(!isNaN(t)){var e=this.bossAlertList.indexOf(t);-1!=e?this.bossAlertList.splice(e,1):this.bossAlertList.push(t)}},e.prototype.getBossRemindByIndex=function(t){return-1!=this.bossAlertList.indexOf(t)},e.prototype.getHandleNum=function(t){var e=GlobalConfig.DevilRuinsBossConfig[this.fbKind];for(var i in e)if(e[i].bossId==t)return[this.fbKind,Number(i)]},e.prototype.getBelongHandle=function(t){var e=GlobalConfig.DevilRuinsBossConfig,i=Object.keys(GlobalConfig.DevilRuinsBossConfig).length;for(var s in e[this.fbKind])if(e[this.fbKind][s].bossId==t)return this.fbKind==i?this.callBossInfo[0].monData[Number(s)-1].handle:this.devilRuinsInfo[this.fbKind-1].monData[Number(s)-1].handle},e.prototype.isShowBelong=function(){var t=GlobalConfig.DevilRuinsBossConfig[this.fbKind],e=0;for(var i in t)t[i].bossId==this.monsId&&(e=Number(i));if(!t[e]||!t[e].bossBelongCondiction)return!1;var s=t[e].bossBelongCondiction[0],n=SubRoles.ins().subRolesLen,o=0,a=s?s[2]:0;if(s)for(var i=0;n>i;i++){var r=SmmzCT.ins().getSmInfoByRoleIdSmId(i,s[0]).itemIds;for(var l in r){var h=GlobalConfig.ShenmoEquipConfig[r[l]].quality;s[1]<=h&&o++}}return a>o},e.prototype.getAttackHandle=function(t,e){var i,s,n=EntityManager.ins().getAllEntity(),o=SubRoles.lookAtTar;for(var a in n)if(i=n[a],s=i.infoModel,s&&s.type==EntityType.Monster&&s.getAtt(AttributeType.atHp)>0){var r=GlobalConfig.MonstersConfig[s.configID];if(!r)continue;if(4==r.type||3==r.type)continue;if(!o)continue;var l=GlobalConfig.DevilRuinsBossConfig[t][e];if(l&&l.bossId==s.configID)return s.handle}},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postBelong",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postMonState",null),__decorate([post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postBossNotice",null),__decorate([post()],e.prototype,"postBelongTimes",null),__decorate([post()],e.prototype,"postHudun",null),e}(BaseSystem);__reflect(KFSmyjBossCT.prototype,"KFSmyjBossCT"),System.KFSmyjBossCT=function(){return KFSmyjBossCT.ins()},window.KFSmyjBossCT=KFSmyjBossCT;var KFSmyjBossItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFSmyjBossItemSkin",e}return __extends(e,t),e.prototype.init=function(t){this.fbKind=t-1},e.prototype.skinComplete=function(){var t=GlobalConfig.DevilRuinsBase;this.x=t.clientPos[this.fbKind][0],this.y=t.clientPos[this.fbKind][1],this.head.source=t.headImg[this.fbKind],this.desc.text=t.chapterNames[this.fbKind],this.touchEnabled=!0,this.touchChildren=!1,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){this.observe(KFSmyjBossCT.ins().postMonState,this.update),this.update()},e.prototype.onClick=function(t){ViewManager.ins().open(KFSmyjBossMapWin,this.fbKind)},e.prototype.update=function(){if(this.skin)for(var t=KFSmyjBossCT.ins().devilRuinsInfo,e=0;e<t[this.fbKind].monNum;e++)this["red"+e].filters=t[this.fbKind]&&0==t[this.fbKind].monData[e].isLive?FilterUtil.ARRAY_GRAY_FILTER:null},e}(BaseView);__reflect(KFSmyjBossItem.prototype,"KFSmyjBossItem"),window.KFSmyjBossItem=KFSmyjBossItem;var KFSmyjBossMapWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFSmyjBossMap",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.DevilRuinsBase;this.title.source=i.titleImg[t[0]],this.bg.source=i.bgImg[t[0]],this.update(t[0])},e.prototype.update=function(t){this.fields=[];var e=GlobalConfig.DevilRuinsBossConfig[t+1];for(var i in e){var s=new KFSmyjLevelItem;s.init(t,Number(i)-1),this.eGruop.addChild(s),this.fields.push(s)}},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(KFSmyjBossMapWin.prototype,"KFSmyjBossMapWin"),window.KFSmyjBossMapWin=KFSmyjBossMapWin,ViewManager.ins().reg(KFSmyjBossMapWin,LayerManager.UI_Popup);var KFSmyjBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFSmyjBoss",e.panel=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.buyTimes.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.buyTimes.text+"</u>"),this.remind.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.remind.text+"</u>"),this.eScroller.addEventListener(egret.Event.RESIZE,this.init,this),this.initFields(),this.ins=KFSmyjBossCT.ins()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KFSmyjBossCT.ins().postInit,this.update),this.observe(KFSmyjBossCT.ins().postBelongTimes,this.update),this.observe(KFSmyjBossCT.ins().postMonState,this.init),this.update()},e.prototype.init=function(){this.initPanel();var t=KFSmyjBossCT.ins();if(t.bossId){var e=t.callBossInfo[0].monData[t.bossId-1];this.eScroller.viewport.scrollH=e.x/2,this.eScroller.viewport.scrollV=e.y/2}},e.prototype.close=function(){Timer.stopAll(this),this.eScroller.removeEventListener(egret.Event.RESIZE,this.init,this)},e.prototype.update=function(){this.helpTimes.text=this.ins.helpTimes+"",this.bossTimes.text=this.ins.belongTimes+""},e.prototype.initFields=function(){this.fields=[];var t=GlobalConfig.DevilRuinsBossConfig,e=Object.keys(t).length;for(var i in t)if(Number(i)>=e){this.callBoss=new eui.Image;var s=GlobalConfig.DevilRuinsBase.clientPos[e-1];this.callBoss.source=GlobalConfig.DevilRuinsBase.headImg[e-1],this.callBoss.x=s[0],this.callBoss.y=s[1],this.eMCGroup.addChild(this.callBoss)}else{var n=new KFSmyjBossItem;n.init(Number(i)),this.eMCGroup.addChild(n),this.fields.push(n)}this.initPanel()},e.prototype.initPanel=function(){var t=this;this.clearBossMCs();var e=KFSmyjBossCT.ins(),i=e.callBossInfo;if(i&&i[0]){var s=function(e){if(i[0].monData[e].isLive){var s;if(n.panel[e]||(n.panel[e]=new KFSmyjCallBossItem),s=n.panel[e],i[0].monData[e].x||i[0].monData[e].y)n.panel[e].x=i[0].monData[e].x,n.panel[e].y=i[0].monData[e].y;else{var o=GlobalConfig.DevilRuinsBase.bossPos[e];n.panel[e].x=o[0],n.panel[e].y=o[1],i[0].monData[e].x=o[0],i[0].monData[e].y=o[1]}n["mc"+e]||(n["mc"+e]=new MovieClip,n["mc"+e].x=n.panel[e].x+50,n["mc"+e].y=n.panel[e].y+100,n.eMCGroup.addChild(n["mc"+e])),n["mc"+e].playFile(RES_DIR_EFF+(""+GlobalConfig.DevilRuinsBase.eff),1),n.panel[e].setData(i[0].monData[e].bossId);var a=egret.Tween.get(n["mc"+e]);a.wait(800).call(function(){t.eMCGroup.addChild(s)},n)}},n=this;for(var o in i[0].monData)s(o)}},e.prototype.clearBossMCs=function(){for(var t in this.panel){var e=this.panel[t];e.clear()}},e.prototype.onClick=function(t){var e=this;if(t.target instanceof KFSmyjCallBossItem){var i=this.ins.getIndex(t.target.bossId);return void ViewManager.ins().open(KFSmyjCallBossWin,i)}switch(t.target){case this.buyTimes:var s=GlobalConfig.DevilRuinsBase,n="";this.ins.buyTimes>=s.dayMaxCanBuyBelongCount?TipsCT.ins().showTips("今日购买次数已达到上限"):this.ins.belongTimes<=0?(n="确定花费<font color='#FFB82A'>"+s.buyBelongCountCost+"元宝</font>购买1次神魔遗迹归属次数吗？\n今日可购买:"+this.ins.buyTimes+"/"+s.dayMaxCanBuyBelongCount,WarnWin.show(n,function(){Actor.yb<s.buyBelongCountCost?TipsCT.ins().showTips("元宝数量不足"):e.ins.sendBelongTimes()},this)):TipsCT.ins().showTips("今日归属次数为0时才可购买，当前购买次数"+this.ins.buyTimes+"/"+s.dayMaxCanBuyBelongCount);break;case this.remind:ViewManager.ins().open(KFSmyjRemindWin);break;case this.callBoss:ViewManager.ins().open(KFSmyjCallBossWin)}},e}(BaseView);__reflect(KFSmyjBossPanel.prototype,"KFSmyjBossPanel"),window.KFSmyjBossPanel=KFSmyjBossPanel;var KFSmyjCallBossItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfSmyjCallBossItemSkin",e.mc=new MovieClip,e.mc.scaleX=-1,e.mc.scaleY=1,e.boss.addChild(e.mc),e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.setData=function(t){this.bossId=t;var e=GlobalConfig.MonstersConfig[this.bossId];this.bossName.text=e.name,this.mc.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)},e.prototype.clear=function(){this.mc.stop(),DisplayUtils.removeFromParent(this)},e}(BaseView);__reflect(KFSmyjCallBossItem.prototype,"KFSmyjCallBossItem"),window.KFSmyjCallBossItem=KFSmyjCallBossItem;var KFSmyjCallBossWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfSmyjCallBossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.mc=new MovieClip,this.Boss.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.observe(KFSmyjBossCT.ins().postInit,this.update),t[0]){this.eGroup0.visible=!1,this.eGroup1.visible=this.caller.visible=!0,this.isCall.text="召唤者",this.fbKind=t[0][0],this.index=t[0][1];var i=GlobalConfig.DevilRuinsBossConfig[this.fbKind][this.index],s=GlobalConfig.MonstersConfig[i.bossId];
this.mc.scaleX=-1,this.mc.scaleY=1,this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_3s"),-1),this.eBossLab0.text=s.name;var n=KFSmyjBossCT.ins().callBossInfo[0].monData[this.index-1];this.caller.text=n.caller,this.itemList0.dataProvider=new eui.ArrayCollection(i.reward);var o=GlobalConfig.DevilRuinsDescConfig[this.index],a=Object.keys(o).length,r=Math.floor(Math.random()*a+1);this.eBossLab2.text=o[r].desc,this.update()}else{this.eGroup1.visible=this.caller.visible=!1,this.eGroup0.visible=!0,this.isCall.text="";var o=GlobalConfig.DevilRuinsBase;this.itemList.dataProvider=new eui.ArrayCollection(o.callBossReward);var l=o.callBossCost[0],h=l.id;this.icon1.source=GlobalConfig.ItemConfig[h].icon+"_png";var p=ItemUtil.isEquip(GlobalConfig.ItemConfig[h])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;this.costNum=BagCT.ins().getBagGoodsCountById(p,h);var u="";u=this.costNum>=l.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+this.costNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+l.count+"</font> "),this.timeCB(),Timer.has(this.timeCB,this)||Timer.start(1e3,0,this.timeCB,this),this.mc.playFile(RES_DIR_EFF+"smly_csm",-1)}},e.prototype.timeCB=function(){this.eBossLab1.visible=!KFSmyjBossCT.ins().callBossOpen(),this.call.visible=!this.eBossLab1.visible},e.prototype.update=function(){this.bossTimes.text=KFSmyjBossCT.ins().bossBelongTimes+""},e.prototype.onClick=function(t){switch(t.target){case this.eCloseRect:ViewManager.ins().close(e);break;case this.call:var i=GlobalConfig.DevilRuinsBase.callBossCost[0];this.costNum>=i.count?(KFSmyjBossCT.ins().sendCallBoss(),ViewManager.ins().close(e)):TipsCT.ins().showTips("召唤材料不足");break;case this.challenge:KFSmyjBossCT.ins().sendInter(this.fbKind,this.index)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.timeCB,this)},e}(BaseEuiView);__reflect(KFSmyjCallBossWin.prototype,"KFSmyjCallBossWin"),window.KFSmyjCallBossWin=KFSmyjCallBossWin,ViewManager.ins().reg(KFSmyjCallBossWin,LayerManager.UI_Popup);var KFSmyjLevelItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFSmyjLevelItemSkin",e}return __extends(e,t),e.prototype.init=function(t,e){this.fbKind=t,this.index=e},e.prototype.skinComplete=function(){var t=GlobalConfig.DevilRuinsBossConfig[this.fbKind+1][this.index+1];this.x=t.comBossPos[0],this.y=t.comBossPos[1],this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){var t=GlobalConfig.DevilRuinsBossConfig[this.fbKind+1][this.index+1],e=GlobalConfig.MonstersConfig[t.bossId];this.head.source="monhead"+e.head+"_png",this.eNameLab.text=e.name,this.itemList.dataProvider=new eui.ArrayCollection(t.reward);var i=t.bossBelongCondiction[0],s=GlobalConfig.ShenmoBaseConfig,n=SubRoles.ins().subRolesLen;if(this.curNum=0,this.needNum=i?i[2]:0,i){for(var o=0;n>o;o++){var a=SmmzCT.ins().getSmInfoByRoleIdSmId(o,i[0]).itemIds;for(var r in a){var l=GlobalConfig.ShenmoEquipConfig[a[r]].quality;i[1]<=l&&this.curNum++}}this.eNameLab0.text="三角色穿戴"+this.curNum+"/"+i[2]+"件"+s.qualityName[i[1]]+s.smName[i[0]],this.eNameLab0.textColor=this.curNum<i[2]?ColorUtil.RED_COLOR_N:ColorUtil.GREEN_COLOR_N}this.belong.visible=this.curNum<this.needNum,this.update(),Timer.has(this.update,this)||Timer.start(1e3,0,this.update,this)},e.prototype.update=function(){var t=KFSmyjBossCT.ins().devilRuinsInfo[this.fbKind].monData[this.index],e=DateUtils.formatMiniDateTime(t.times);t.isLive||t.times&&e-GameServer.serverTime<0?(this.info.text="",this.head.filters=null):(this.info.text=DateUtils.getFormatBySecond((e-GameServer.serverTime)/1e3,DateUtils.TIME_FORMAT_3),this.head.filters=FilterUtil.ARRAY_GRAY_FILTER);for(var i=0;i<this.itemList.numElements;i++){var s=this.itemList.getVirtualElementAt(i);s.isShowName(!1)}},e.prototype.onClick=function(t){var i=this;if(t.target.parent instanceof e)if(this.curNum<this.needNum){var s="当前所选挑战的BOSS无法获得归属奖励，是否进入？";WarnWin.show(s,function(){GameMap.fbType==FbCT.FB_TYPE_SMYJ?i.checkHandle():KFSmyjBossCT.ins().sendInter(i.fbKind+1,i.index+1)},this)}else GameMap.fbType==FbCT.FB_TYPE_SMYJ?this.checkHandle():KFSmyjBossCT.ins().sendInter(this.fbKind+1,this.index+1)},e.prototype.checkHandle=function(){var t=KFSmyjBossCT.ins().getAttackHandle(this.fbKind+1,this.index+1);if(t)GameLogic.ins().postChangeAttrPoint(t);else{var e=GlobalConfig.DevilRuinsBossConfig[this.fbKind+1][this.index+1].pos,i=e[0],s=e[1],n=GameMap.CELL_SIZE;GameMap.moveTo(i*n,s*n)}ViewManager.ins().close(KFSmyjBossMapWin)},e.prototype.removeDisplay=function(){Timer.stop(this.update,this)},e}(BaseView);__reflect(KFSmyjLevelItem.prototype,"KFSmyjLevelItem"),window.KFSmyjLevelItem=KFSmyjLevelItem;var KFSmyjRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e._lastX=0,e._lastY=0,e.skinName="KFSmyjRemindInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastX=t.stageX,this._lastY=t.stageY,this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(t){MathUtils.getDistance(this._lastX,this._lastY,t.stageX,t.stageY)>20&&(this._move=!0)},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.MonstersConfig[this.data.bossId];this.bossName.text=t.name;var e=this.data.bossBelongCondiction[0];this.levelShow.text=GlobalConfig.ShenmoBaseConfig.smName[e[0]],this.levelShow0.text=GlobalConfig.ShenmoBaseConfig.qualityName[e[1]],this.levelShow0.textColor=ItemBase.QUALITY_COLOR[e[1]];for(var i=SubRoles.ins().subRolesLen,s=0,n=0;i>n;n++){var o=SmmzCT.ins().getSmInfoByRoleIdSmId(n,e[0]);o&&s++}s<e[2]?(this.checkBoxs.visible=!1,this.txt.visible=!0):(this.checkBoxs.visible=!0,this.txt.visible=!1,this.checkBoxs.selected=KFSmyjBossCT.ins().getBossRemindByIndex(this.data.bossSort),this.checkBoxs.name=this.data.bossSort+"")}},e}(BaseItemRender);__reflect(KFSmyjRemindItem.prototype,"KFSmyjRemindItem"),window.KFSmyjRemindItem=KFSmyjRemindItem;var KFSmyjRemindWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFSmyjRemindSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){var t=GlobalConfig.DevilRuinsBossConfig,e=Object.keys(t).length,i=[];for(var s in t)for(var n in t[s])t[s][n].fbKind!=e&&i.push(t[s][n]);this.list0.dataProvider=new eui.ArrayCollection(i)},e.prototype.onClick=function(t){if(t.target instanceof eui.CheckBox){var i=parseInt(t.target.name);KFSmyjBossCT.ins().setBossSetting(i)}else switch(t.target){case this.bgClose:ViewManager.ins().close(e)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];KFSmyjBossCT.ins().sendBossSetting()},e}(BaseEuiView);__reflect(KFSmyjRemindWin.prototype,"KFSmyjRemindWin"),window.KFSmyjRemindWin=KFSmyjRemindWin,ViewManager.ins().reg(KFSmyjRemindWin,LayerManager.UI_Popup);var KingAreaCT=function(t){function e(){var e=t.call(this)||this;return e.kingBossInfo=[],e.sysId=PackageID.Guanqia,e.regNetMsg(58,e.postInit),e.regNetMsg(59,e.postElert),e.regNetMsg(60,e.postResult),e.regNetMsg(61,e.doBelongChange),e.regNetMsg(62,e.postHelpResult),e.regNetMsg(63,e.postUpdateInfo),e.observe(BossCT.ins().postBossAppear,function(){GameMap.fbType==FbCT.FB_TYPE_KING&&ViewManager.ins().open(BossBelongPanel)}),e.observe(BossCT.ins().postBossDisappear,function(){GameMap.fbType==FbCT.FB_TYPE_KING&&ViewManager.ins().close(BossBelongPanel)}),e.observe(GameLogic.ins().postEnterMap,function(){GameMap.fbType!=FbCT.FB_TYPE_KING&&(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(KFBossReliveWin))}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){var e=t.readShort();this.kingBossInfo=[];for(var i=0;e>i;i++){var s=t.readByte(),n={state:t.readByte(),times:DateUtils.formatMiniDateTime(t.readInt())};this.kingBossInfo[s-1]=n}this.belongTimes=t.readShort(),this.helpTimes=t.readShort(),this.enterCD=1e3*t.readUnsignedInt()+egret.getTimer()},e.prototype.doBelongChange=function(t){var e=t.readDouble(),i=t.readDouble(),s=t.readString();BossCT.ins().postBelongChange(i,e,s)},e.prototype.postResult=function(t){for(var e=t.readShort(),i=[],s=0;e>s;s++){var n={type:t.readByte(),id:t.readInt(),count:t.readInt()};i.push(n),0==i[s].type&&1!=i[s].id&&2!=i[s].id&&i[s].id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),i[s]])}var o=t.readString();this.belongTimes=t.readShort();var a=function(){ResultManager.ins().create(FbCT.FB_TYPE_KING,i,1,o)};DropHelp.start(),DropHelp.addCompleteFunc(a,this)},e.prototype.postElert=function(t){var e=t.readInt(),i=t.readDouble();e>0&&ViewManager.ins().open(KFBossReliveWin,e,i)},e.prototype.postHelpResult=function(t){for(var e=t.readString(),i=t.readShort(),s=[],n=0;i>n;n++){var o={type:t.readByte(),id:t.readInt(),count:t.readInt()};s.push(o)}this.helpTimes=t.readShort(),ResultManager.ins().create(FbCT.FB_TYPE_KING,s,1,e)},e.prototype.postUpdateInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s=t.readByte();this.kingBossInfo[s-1].state=t.readByte(),this.kingBossInfo[s-1].times=DateUtils.formatMiniDateTime(t.readInt())}},e.prototype.sendInter=function(t){var e=this.getBytes(58);e.writeByte(t),this.sendToServer(e)},e.prototype.sendRevive=function(){this.sendBaseProto(59)},e.prototype.sendCleanBelong=function(t){var e=this.getBytes(60);e.writeByte(t),this.sendToServer(e)},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postHelpResult",null),__decorate([post()],e.prototype,"postUpdateInfo",null),e}(BaseSystem);__reflect(KingAreaCT.prototype,"KingAreaCT"),System.KingAreaCT=function(){return KingAreaCT.ins()},window.KingAreaCT=KingAreaCT;var KingEquipCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Equip,e.regNetMsg(51,e.postEquipUpdate),e.regNetMsg(52,e.postInit),e.regNetMsg(53,e.postUpgrade),e.regNetMsg(54,e.postKingHeart),e.regNetMsg(55,e.postJuLing),e.regNetMsg(56,e.postPower),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendWear=function(t,e,i){var s=this.getBytes(51);s.writeDouble(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postEquipUpdate=function(t){var e=t.readByte(),i=SubRoles.ins().getSubRoleByIndex(e),s=t.readByte(),n=new ItemData;n.parser(t),i.kingEquipItemData[s]=n},e.prototype.sendOff=function(t,e,i){var s=this.getBytes(52);s.writeByte(t),s.writeByte(e),s.writeInt(i),this.sendToServer(s)},e.prototype.postInit=function(t){var e=t.readByte();this.kingInfos=[];for(var i=0;e>i;i++){var s=t.readByte();this.kingInfos[s]={roleId:s,power:t.readNumber(),posInfos:this.parserPosInfo(t,s)}}},e.prototype.parserPosInfo=function(t,e){for(var i=[],s=t.readByte(),n=0;s>n;n++){var o=t.readByte();i[o]={pos:o,mergeLv:t.readShort(),kingLv:t.readByte(),lv:t.readByte(),jlInfos:this.parserJLInfo(t,o,e)}}return i},e.prototype.parserJLInfo=function(t,e,i){for(var s=[],n=t.readByte(),o=0;n>o;o++){var a=t.readByte();s[a]={roleId:i,pos:e,JLPos:a,lv:t.readShort()}}return s},e.prototype.sendUpgrade=function(t,e,i,s){var n=this.getBytes(53);n.writeByte(t),n.writeByte(e),n.writeByte(i),n.writeInt(s),this.sendToServer(n)},e.prototype.postUpgrade=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=t.readShort();1==e?this.kingInfos[i].posInfos[s].lv=n:this.kingInfos[i].posInfos[s].mergeLv=n},e.prototype.sendKingHeart=function(t,e){var i=this.getBytes(54);i.writeByte(e),i.writeByte(t),this.sendToServer(i)},e.prototype.postKingHeart=function(t){var e=t.readByte(),i=t.readByte();this.getKingPosInfo(e,i).kingLv=t.readByte()},e.prototype.sendJuLing=function(t,e,i){var s=this.getBytes(55);s.writeByte(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postJuLing=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=t.readShort(),o=this.getKingJLInfo(e,i,s);o&&(o.lv=n)},e.prototype.postPower=function(t){var e=this.getKingInfoByRoleId(t.readByte());e.power=t.readNumber()},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.KingEquipBaseConfig,i="";return GameServer.serverOpenDay+1<e.opendays?i="第"+e.opendays+"天开启":ZsCT.ins().lv<e.zslv&&(i=e.zslv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.findBestEquipByPos=function(t){var e,i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_45),s=0;for(var n in i){var o=i[n];ItemUtil.getSubType(o.itemConfig)==t&&o.configID>s&&(s=o.configID,e=o)}return e},e.getSuitStageByRoleId=function(t){var e=t.kingEquipItemData,i=[];for(var s in e){var n=GlobalConfig.KingEquipLvConfig[e[s].configID];i.push(n?n.stage:0)}return i.sort(Algorithm.sortDesc),i},e.getItemIdByPosstage=function(t,e){return 4e5+100*t+e},e.prototype.getKingInfoByRoleId=function(t){return this.kingInfos[t]},e.prototype.getKingPosInfo=function(t,e){var i=this.getKingInfoByRoleId(t);return i?i.posInfos[e]:null},e.prototype.getKingJLInfo=function(t,e,i){var s=this.getKingPosInfo(t,e);return s?s.jlInfos[i]:null},e.prototype.checkJLOpen=function(t){var i=e.getJuLingConf(t.pos,t.JLPos,1);if(!i.unlock)return!0;var s=this.getKingJLInfo(t.roleId,t.pos,i.unlock[0]);return s.lv>=i.unlock[1]},e.prototype.getJLTotalAttrs=function(t,i,s){void 0===s&&(s=-1);var n=this.getKingPosInfo(t,i),o=[];for(var a in n.jlInfos){var r=n.jlInfos[a].lv;if(s==+a){if(!e.getJuLingConf(i,+a,r+1))return null;r++}r>0&&(o=AttributeData.AttrAddition(o,AttributeData.getAttrFromCfg(e.getJuLingConf(i,+a,r))))}return o},e.prototype.getJLTotalLv=function(t,e){var i=this.getKingPosInfo(t,e),s=0;for(var n in i.jlInfos)s+=i.jlInfos[n].lv;return s},e.getJuLingConf=function(t,e,i){return GlobalConfig.JuLingConf[t][e][i]},e.POSMAX=12,__decorate([post()],e.prototype,"postEquipUpdate",null),__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postUpgrade",null),__decorate([post()],e.prototype,"postKingHeart",null),__decorate([post()],e.prototype,"postJuLing",null),__decorate([post()],e.prototype,"postPower",null),e}(BaseSystem);__reflect(KingEquipCT.prototype,"KingEquipCT"),System.KingEquipCT=function(){return KingEquipCT.ins()},window.KingEquipCT=KingEquipCT;var KingEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.rolePoints=[],e.posReds=[],e.stageReds=[],e.JLReds=[],e.heartReds=[],e.mergeReds=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,KingEquipCT.ins().postInit,KingEquipCT.ins().postEquipUpdate,KingEquipCT.ins().postUpgrade,KingEquipCT.ins().postJuLing,KingEquipCT.ins().postKingHeart,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.rolePoints.length;e++)this.rolePoints[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){if(this.posRed=this.stageRed=this.JLRed=this.heartRed=!1,!KingEquipCT.ins().checkOpen()||!KingEquipCT.ins().kingInfos)return!1;for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.postItemPosReds(t);i&&(this.posRed=!0);var s=this.postItemStageReds(t);s&&(this.stageRed=!0);var n=this.postItemJLReds(t);n&&(this.JLRed=!0);var o=this.postItemHeartReds(t);o&&(this.heartRed=o);var a=this.postItemMergeReds(t);a&&(this.mergeRed=a),this.rolePoints[t]=i||s||n||o||a}else this.rolePoints[t]=!1}return!0},e.prototype.postItemPosReds=function(t){this.posReds[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);for(var s in i.kingEquipItemData){var n=i.kingEquipItemData[s],o=KingEquipCT.findBestEquipByPos(+s),a=!!o&&o.configID>n.configID;this.posReds[t][s]=a,a&&(e=a)}return e},e.prototype.postItemStageReds=function(t){this.stageReds[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);for(var s in i.kingEquipItemData){var n=i.kingEquipItemData[s];if(this.stageReds[t][+s]=!1,n&&n.itemConfig){var o=GlobalConfig.KingEquipLvConfig[n.configID];if(o.toid>0){var a=GlobalConfig.KingEquipLvConfig[o.toid];if(!(a.zslv&&ZsCT.ins().lv<a.zslv[0])){var r=!0;for(var l in o.consume){var h=o.consume[l],p=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,h.id);if(p<h.count){r=!1;break}}r&&(this.stageReds[t][+s]=e=!0)}}}}return e},e.prototype.postItemJLReds=function(t){this.JLReds[t]=[];var e=!1,i=KingEquipCT.ins().getKingInfoByRoleId(t);for(var s in i.posInfos){var n=i.posInfos[s];this.JLReds[t][+s]=!1;var o=GlobalConfig.KingEquipBaseConfig.consume[n.pos>5?1:0];for(var a in n.jlInfos){var r=n.jlInfos[a],l=KingEquipCT.getJuLingConf(+s,+a,r.lv+1);if(l){var h=l.consume,p=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o);p>=h&&(this.JLReds[t][+s]=e=!0)}}}return e},e.prototype.postItemHeartReds=function(t){this.heartReds[t]=[];var e=!1,i=KingEquipCT.ins().getKingInfoByRoleId(t);for(var s in i.posInfos){var n=i.posInfos[s];if(this.heartReds[t][+s]=!1,GlobalConfig.KingHeart[+s]){var o=GlobalConfig.KingHeart[+s][n.kingLv+1];if(o){var a=o.consume[0],r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,a.id);r>=a.count&&(this.heartReds[t][+s]=e=!0)}}}return e},e.prototype.postItemMergeReds=function(t){this.mergeReds[t]=[];var e=!1,i=KingEquipCT.ins().getKingInfoByRoleId(t),s=SubRoles.ins().getSubRoleByIndex(t);for(var n in i.posInfos){var o=i.posInfos[n];this.mergeReds[t][+n]=!1;var a=GlobalConfig.FuseConfig[+n][o.mergeLv+1];if(a&&s.kingEquipItemData[n].configID>0){var r=a.consume[0],l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,r.id);l>=r.count&&(this.mergeReds[t][+n]=e=!0)}}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postItemPosReds",null),__decorate([post()],e.prototype,"postItemStageReds",null),__decorate([post()],e.prototype,"postItemJLReds",null),__decorate([post()],e.prototype,"postItemHeartReds",null),__decorate([post()],e.prototype,"postItemMergeReds",null),e}(BaseSystem);__reflect(KingEquipRedPoint.prototype,"KingEquipRedPoint"),System.KingEquipRedPoint=function(){return KingEquipRedPoint.ins()},window.KingEquipRedPoint=KingEquipRedPoint;var KingAreaItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipFieldItemSkin",e.mc=new MovieClip,e.door.addChild(e.mc),e.mc1=new MovieClip,e.dynamicBorder.addChild(e.mc1),Timer.has(e.update,e)||Timer.start(1e3,0,e.update,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;!t||Object.keys(t).length<=0||(this.list.dataProvider=new eui.ArrayCollection(t.rewards),this.level.text=t.vip+"转",this.bossName.text=t.bossName+"",this.fbName.source=t.fbName+"",this.border.source=this.staticDoor.source="",t.eff&&this.mc.playFile(RES_DIR_EFF+(""+t.eff),-1),t.img&&(this.border.source=t.img+""),t.borderEff&&this.mc1.playFile(RES_DIR_EFF+(""+t.borderEff),-1),t.doorImg&&(this.staticDoor.source=t.doorImg+""),this.update())},e.prototype.update=function(){var t,e;ZsCT.ins().lv>=this.data.vip?KingAreaCT.ins().kingBossInfo[this.data.id-1].state?(t=9830144,e="点击挑战"):(t=16759085,e=DateUtils.getFormatBySecond((KingAreaCT.ins().kingBossInfo[this.data.id-1].times-GameServer.serverTime)/1e3,DateUtils.TIME_FORMAT_3)+"后重生"):(t=16711680,e="暂未开启"),this.timeTxt.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+e)},e}(BaseItemRender);__reflect(KingAreaItem.prototype,"KingAreaItem"),window.KingAreaItem=KingAreaItem;var KingAreaPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="KingEquipFieldSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KingAreaCT.ins().postInit,this.update),this.observe(KingAreaCT.ins().postUpdateInfo,this.update),this.observe(KingAreaCT.ins().postHelpResult,this.updateHelp),this.observe(KingAreaCT.ins().postResult,this.updateBelong),this.update(),this.updateHelp()},e.prototype.update=function(){if(this.skin){var t=GlobalConfig.KingBossConfig,e=[];for(var i in t)e.push(t[i]);this.eList.dataProvider=new eui.ArrayCollection(e);var s=GlobalConfig.KingFuBenBaseConfig.coupon,n=BagCT.ins().getBagItemById(s);this.eJIcon.source=GlobalConfig.ItemConfig[s].icon+"_png",this.eJCount.text=n?n.count+"":"0",this.updateBelong()}},e.prototype.updateHelp=function(){this.eHelpTimes.text=KingAreaCT.ins().helpTimes+""},e.prototype.updateBelong=function(){this.eBossTimes.text=KingAreaCT.ins().belongTimes+""},e.prototype.onClick=function(t){if(t.target.parent instanceof KingAreaItem&&t.target instanceof eui.Group){var e=t.target.parent.data;if(!(ZsCT.ins().lv>=e.vip))return void TipsCT.ins().showTips(e.vip+"转可开启");var i=(KingAreaCT.ins().enterCD-egret.getTimer())/1e3>>0;if(i>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+i+"秒后可以进入！");KingAreaCT.ins().sendInter(e.id),KingAreaCT.ins().fbId=e.id}},e}(BaseView);__reflect(KingAreaPanel.prototype,"KingAreaPanel"),window.KingAreaPanel=KingAreaPanel;var KingEquipHeartWin=function(t){function e(){var e=t.call(this)||this;return e.isEnough=!1,e.isEnoughLv=!1,e._sn_="KingEquipSuitTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleId=t[0],this.pos=t[1],this.observe(KingEquipCT.ins().postKingHeart,this.update),this.update()},e.prototype.update=function(){var t=KingEquipCT.ins().getKingPosInfo(this.roleId,this.pos),e=GlobalConfig.KingHeart[this.pos][t.kingLv],i=GlobalConfig.KingHeart[this.pos][t.kingLv+1],s=!i;this.eCur.text=s||!e?"":AttributeData.getExtAttStrByType(e.exattr[0]),this.eNext.text=s?"":AttributeData.getExtAttStrByType(i.exattr[0]),this.eNextImg.visible=!s,this.eFullAtt.text=s?AttributeData.getExtAttStrByType(e.exattr[0]):"",this.eMax.visible=s;var n=KingEquipCT.ins().getJLTotalLv(this.roleId,this.pos);this.isEnoughLv=!!i&&n>=i.finshcondition;var o=s||n>=i.finshcondition?ColorUtil.GREEN:ColorUtil.RED,a=s?e.finshcondition:i.finshcondition;if(this.eTips.textFlow=TextFlowMaker.generateTextFlow1("该王者装备部位聚灵总等级达到|C:"+ColorUtil.GREEN+"&T:"+a+"|级(|C:"+o+"&T:"+n+"|/"+a+")|"),this.eBtn.visible=!s,s)this.costGroup0.visible=!1;else{var r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.consume[0].id);this.isEnough=r>=i.consume[0].count,this.eCost.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this.isEnough?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+r+"/"+i.consume[0].count),this.eIcon.source=GlobalConfig.ItemConfig[i.consume[0].id].icon+"_png"}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:this.isEnoughLv?this.isEnough?KingEquipCT.ins().sendKingHeart(this.roleId,this.pos):TipsCT.ins().showTips("材料不足"):TipsCT.ins().showTips("聚灵总等级不足")}},e}(BaseEuiView);__reflect(KingEquipHeartWin.prototype,"KingEquipHeartWin"),window.KingEquipHeartWin=KingEquipHeartWin,ViewManager.ins().reg(KingEquipHeartWin,LayerManager.UI_Popup);var KingEquipInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.equips=[],e._curRole=0,e._sn_="KingEquipRoleSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=0;t<KingEquipCT.POSMAX;t++)this.equips[t]=this["equip"+t],this.equips[t].pos=t,this.equips[t].touchEnabled=!0;this.addTouchEvent(this,this.onClick),this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eEff.addChild(this.bodyMc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KingEquipCT.ins().postEquipUpdate,this.update),this.observe(KingEquipCT.ins().postPower,this.updatePower),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.update=function(){this.updateMC(),this.updatePower(),this.updateItems()},e.prototype.updateMC=function(){var t=KingEquipCT.getSuitStageByRoleId(SubRoles.ins().getSubRoleByIndex(this._curRole)),e=GlobalConfig.KingSuitConf[KingEquipCT.POSMAX],i=e[t[t.length-1]],s=i&&i.effId>0?i.effId:GlobalConfig.KingSuitConf[KingEquipCT.POSMAX][1].effId,n=SubRoles.ins().getSubRoleByIndex(this._curRole);this.bodyMc.playFile(RES_DIR_EFF+("KingShowDress_"+n.sex+"_"+s),-1)},e.prototype.updatePower=function(){var t=KingEquipCT.ins().getKingInfoByRoleId(this._curRole);this.ePowerPanel.setPower(t?t.power:0)},e.prototype.updateItems=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole);for(var e in this.equips){var i=this.equips[e].pos;this.equips[e].data=[t.kingEquipItemData[i]]}},e.prototype.onClick=function(t){if(t.target instanceof KingEquipItem){var e=t.target.data[0],i=KingEquipCT.findBestEquipByPos(t.target.pos);return void(i&&(!e||!e.itemConfig||i.configID>e.configID)?KingEquipCT.ins().sendWear(i.handle,this._curRole,t.target.pos):e&&e.itemConfig&&ViewManager.ins().open(KingEquipTipsWin,e.configID,SubRoles.ins().getSubRoleByIndex(this._curRole)))}switch(t.target){case this.eSuitBtn:var s=SubRoles.ins().getSubRoleByIndex(this._curRole);ViewManager.ins().open(KingEquipSuitWin,s.sex)}},e.prototype.updateRed=function(){for(var t in this.equips){var e=this.equips[t].pos;this.equips[t].setRed(KingEquipRedPoint.ins().posReds[this._curRole][e]||KingEquipRedPoint.ins().mergeReds[this._curRole][e])}},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.update(),this.updateRed())},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(KingEquipInfoPanel.prototype,"KingEquipInfoPanel"),window.KingEquipInfoPanel=KingEquipInfoPanel;var KingEquipIntensifyPanel=function(t){function e(){var e=t.call(this)||this;return e.equips=[],e.quItems=[],e.attrs=[],e.arrows=[],e.addAttrs=[],e._curRole=0,e.curPos=0,e.curJLPos=0,e._sn_="KingEquipIntensifySkin",e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=0;t<KingEquipCT.POSMAX;t++)this.equips[t]=this["equip"+t],this.equips[t].pos=t,this.equips[t].selected=this.curPos==t;for(var t=0;5>t;t++)this.quItems[t]=this["quItem"+t];for(var t=0;4>t;t++)this.attrs[t]=this["attr"+t],this.arrows[t]=this["arrow"+t],this.addAttrs[t]=this["addAttr"+t];this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KingEquipCT.ins().postJuLing,this.updateJuLing),this.observe(KingEquipCT.ins().postKingHeart,this.updateKingHeart),this.observe(KingEquipCT.ins().postPower,this.updatePower),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.updateRed),this.update()},e.prototype.updateJuLing=function(){this.update(),this.quItems[this.curJLPos].playEff()},e.prototype.update=function(){this.updatePower(),this.updateItems(),this.updateJuLin(),this.updateKingHeart(),this.updateRed()},e.prototype.updatePower=function(){this.ePowerPanel.setPower(KingEquipCT.ins().kingInfos[this._curRole].power)},e.prototype.updateItems=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole);for(var e in this.equips){var i=this.equips[e].pos;this.equips[e].data=[t.kingEquipItemData[i],this._curRole]}},e.prototype.updateJuLin=function(){var t=KingEquipCT.ins().getKingPosInfo(this._curRole,this.curPos);for(var e in this.quItems){var i=this.quItems[e],s=t.jlInfos[+e];i.data=s,i.selected=s.JLPos==this.curJLPos}var n=KingEquipCT.ins().getKingJLInfo(this._curRole,this.curPos,this.curJLPos);this.updateCost(n),this.updateAttr(),this.updateZZ()},e.prototype.updateCost=function(t){var e=t.lv>0&&!KingEquipCT.getJuLingConf(this.curPos,this.curJLPos,t.lv+1);if(this.eCostGroup.visible=!e,this.eCostGroup.visible){var i=KingEquipCT.getJuLingConf(this.curPos,this.curJLPos,t.lv+1),s=i.consume,n=GlobalConfig.KingEquipBaseConfig.consume[this.curPos>5?1:0],o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n);this.eIcon.source=GlobalConfig.ItemConfig[n].icon+"_png",this.eCostLab.textFlow=TextFlowMaker.generateTextFlow("|C:"+(o>=s?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+o+"/"+s)}},e.prototype.updateAttr=function(){for(var t=KingEquipCT.ins().getJLTotalAttrs(this._curRole,this.curPos),e=KingEquipCT.ins().getJLTotalAttrs(this._curRole,this.curPos,this.curJLPos),i=!e,s=0;4>s;s++)t[s]?this.attrs[s].text=AttributeData.getAttStrByType1(t[s]):this.attrs[s].text=!i&&e[s]?AttributeData.getAttrStrByType(e[s].type)+"+0":"",this.addAttrs[s].text=!i&&e[s]?e[s].value+"":"",this.arrows[s].visible=!i&&!!e[s]},e.prototype.updateKingHeart=function(){var t=KingEquipCT.ins().getKingPosInfo(this._curRole,this.curPos);this.eBmpLab.text=t.kingLv>=0?t.kingLv+"":""},e.prototype.updateZZ=function(){this.eZZ.rotation=GlobalConfig.KingEquipBaseConfig.rotations[this.curJLPos]},e.prototype.onClick=function(t){if(t.target instanceof KingEquipItem)return void(this.curPos!=t.target.pos&&(this.equips[this.curPos].selected=!1,t.target.selected=!0,this.curPos=t.target.pos,this.updateJuLin(),this.updateKingHeart()));if(t.target instanceof KingEquipJuLinItem)return void(this.curJLPos!=t.target.data.JLPos&&(this.quItems[this.curJLPos].selected=!1,t.target.selected=!0,this.curJLPos=t.target.data.JLPos,this.updateJuLin()));switch(t.target){case this.eBtn:this.onClickBtn();break;case this.eUpBtn2:ViewManager.ins().open(KingEquipHeartWin,this._curRole,this.curPos)}},e.prototype.onClickBtn=function(){var t=KingEquipCT.ins().getKingJLInfo(this._curRole,this.curPos,this.curJLPos);if(!KingEquipCT.ins().checkJLOpen(t))return void TipsCT.ins().showTips("未解锁");var e=KingEquipCT.getJuLingConf(this.curPos,this.curJLPos,t.lv+1);return e?void KingEquipCT.ins().sendJuLing(this._curRole,this.curPos,this.curJLPos):void TipsCT.ins().showTips("聚灵已满")},e.prototype.updateRed=function(){for(var t in this.equips){var e=this.equips[t].pos;this.equips[t].setRed(KingEquipRedPoint.ins().JLReds[this._curRole][e])}this.eRp.visible=KingEquipRedPoint.ins().heartReds[this._curRole][this.curPos]},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&this.update()},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(KingEquipIntensifyPanel.prototype,"KingEquipIntensifyPanel"),window.KingEquipIntensifyPanel=KingEquipIntensifyPanel;var KingEquipItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipSeletctSkin",e.touchChildren=!1,e.touchEnabled=!0,e.mc=new MovieClip,e.mc.touchEnabled=!1,e.mc.hitTestEnabled=!1,e.eEffg.addChild(e.mc),e.eEffg.touchEnabled=!1,e.eEffg.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(null!=this.pos){var t=GlobalConfig.FuseConfig[this.pos][1];this.sTips=!t.zslv||ZsCT.ins().lv>=t.zslv[0]?"":t.zslv[0]+"转解锁",this.eIcon.source=""==this.sTips?"wzzbtb_"+(this.pos+1):"wz_locked"}var e=this.data[0],i=this.data[1];return this.eNumLab.text=null==i?"":KingEquipCT.ins().getJLTotalLv(i,this.pos)+"",e&&e.itemConfig?(this.mc.playFile(RES_DIR_EFF+("KingEquip_v"+e.configID%10),-1),void(this.eIcon.source=e.itemConfig.icon+"_png")):(this.mc.stop(),void(this.mc.visible=!1))},e.prototype.setRed=function(t){this.eRp.visible=t},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(t){this._pos=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(KingEquipItem.prototype,"KingEquipItem"),window.KingEquipItem=KingEquipItem;var KingEquipJuLinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipItemSkin",e.touchChildren=!1,e.touchEnabled=!0,e.mc=new MovieClip,e.eEffGroup.addChild(e.mc),e}return __extends(e,t),e.prototype.dataChanged=function(){if(!this.data)return this.mc.stop(),void(this.mc.visible=!1);var t=this.data;this.eLabel.text=t.lv+"";var e=KingEquipCT.ins().checkJLOpen(t);this.eIcon1.visible=!e,this.filters=e?null:FilterUtil.ARRAY_GRAY_FILTER,e?this.mc.playFile(RES_DIR_EFF+("wz_jl_"+t.JLPos),-1):(this.mc.stop(),this.mc.visible=!1)},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t},enumerable:!0,configurable:!0}),e.prototype.playEff=function(){var t=new MovieClip;this.eEffGroup1.addChild(t),t.playFile(RES_DIR_EFF+"UpEff1",1)},e}(BaseItemRender);__reflect(KingEquipJuLinItem.prototype,"KingEquipJuLinItem"),window.KingEquipJuLinItem=KingEquipJuLinItem;var KingEquipMainWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="KingEquipMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.eTab,this.onTabTouch),this.panelArr=[this.eInfoPanel,this.eUpgradePanel,this.eIntensifyPanel,this.eAraePanel],this.eTab.validateNow()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.roleSelect,this.onChange),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.updateRed),this.updateRed()},e.prototype.onTabTouch=function(t){return this.panelArr[this.eTab.selectedIndex]==this.eAraePanel?void this.roleSelect.hideRole():(this.roleSelect.openRole(),this.roleSelect.visible=!0,void this.updateRoleRed())},e.prototype.updateRed=function(){for(var t=0;t<this.eViewStack.numElements;t++){var e=!1;switch(this.eViewStack.getElementAt(t)){case this.eInfoPanel:e=KingEquipRedPoint.ins().posRed||KingEquipRedPoint.ins().mergeRed;break;case this.eUpgradePanel:e=KingEquipRedPoint.ins().stageRed;break;case this.eIntensifyPanel:e=KingEquipRedPoint.ins().JLRed||KingEquipRedPoint.ins().heartRed;break;default:e=!1}this.eTab.getElementAt(t)&&(this.eTab.getElementAt(t).eRp.visible=e)}this.updateRoleRed()},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){this.eInfoPanel.curRole=this.eUpgradePanel.curRole=this.eIntensifyPanel.curRole=t},e.prototype.updateRoleRed=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);i&&this.roleSelect.showRedPoint(e,KingEquipRedPoint.ins().rolePoints[e])}},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseEuiView);__reflect(KingEquipMainWin.prototype,"KingEquipMainWin"),window.KingEquipMainWin=KingEquipMainWin,ViewManager.ins().reg(KingEquipMainWin,LayerManager.UI_Main);var KingEquipMergeRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipUpRendererSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];if(!e||e instanceof Array)this.eLab.text="灵魂锁链 Lv."+t.leve;else{var i=e;this.eIcon.source=SkillCT.ins().getSkillIdIcon(i);var s=GlobalConfig.SkillsConfig[i];this.eLab.text=SkillUtil.getName(s)+" Lv."+t.leve}}},e}(BaseItemRender);__reflect(KingEquipMergeRenderer.prototype,"KingEquipMergeRenderer"),window.KingEquipMergeRenderer=KingEquipMergeRenderer;var KingEquipMergeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KingEquipUpSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eListL.itemRenderer=KingEquipMergeRenderer,this.eListR.itemRenderer=KingEquipMergeRenderer},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.role=t[1],this.observe(KingEquipCT.ins().postUpgrade,this.update),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemUtil.getSubType(t);this.sTitle="wz_rh_title"+e,this.posInfo=KingEquipCT.ins().getKingPosInfo(this.role.index,e);var i=GlobalConfig.FuseConfig[e][this.posInfo.mergeLv+1];this.posInfo.mergeLv<=0?this.currentState="one":i?this.currentState="two":this.currentState="max",this.updateView(e,i)},e.prototype.updateView=function(t,e){var i=GlobalConfig.FuseConfig[t][this.posInfo.mergeLv],s=e?e:i,n=GlobalConfig.ItemConfig[s.consume[0].id];this.eItemLeft.setData(n);var o=AttributeFormat.FORMAT_1();o.wordColor=null,o.attrColor=null;var a=i&&i.attrs?i.attrs:[];this.ePowerL.setPower(BagCT.getAttrPower(a)),this.eAttrL.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(a,o)),this.sLabL="至尊属性LV."+i.leve+"\n为王者装备注入至尊之力\n部位属性提升至"+MathUtils.toInteger((i.percent+1e4)/100)+"%";var r=[];if(i.soulLinkIds?r.push([i,i.soulLinkIds]):i.type&&i.soulLinkType&&r.push([i]),i.preSkillId&&r.push([i,i.preSkillId]),this.eListL.dataProvider=new eui.ArrayCollection(r),a=e?e.attrs:[],this.epowerR.setPower(BagCT.getAttrPower(a)),this.eAttrR.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(a,o)),this.isEnough=!1,e){var l=e.consume[0];this.eCostIcon.source=GlobalConfig.ItemConfig[l.id].icon+"_png";var h=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,l.id);this.isEnough=h>=l.count,this.eCurLab.textFlow=TextFlowMaker.generateTextFlow("|C:"+(h>=l.count?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+h+"/"+l.count),this.sLabR="至尊属性LV."+e.leve+"\n为王者装备注入至尊之力\n部位属性提升至"+MathUtils.toInteger((e.percent+1e4)/100)+"%",r=[],e.soulLinkIds?r.push([e,e.soulLinkIds]):e.type&&e.soulLinkType&&r.push([e]),e.preSkillId&&r.push([e,e.preSkillId]),this.eListR.dataProvider=new eui.ArrayCollection(r)}},e.prototype.updateRed=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemUtil.getSubType(t);this.eRp.visible=KingEquipRedPoint.ins().mergeReds[this.role.index][e]},e.prototype.onClick=function(t){if(t.target instanceof KingEquipMergeRenderer){var e=t.target.data[0],i=t.target.data[1],s="灵魂锁链Lv."+e.leve,n="";if(i)if(i instanceof Array)for(var o in i)""!=n&&(n+="\n"),n+=GlobalConfig.GWSkillReviseConfig[i[o]].desc;else{var a=i,r=GlobalConfig.SkillsConfig[a];s=SkillUtil.getName(r)+("Lv."+e.leve),n=SkillUtil.getDesc(r)}else{var l=e.type,h=e.soulLinkType;if(1==l[0])for(var o in h)""!=n&&(n+="\n"),n+="王者|C:0xffff00&T:"+GlobalConfig.KingEquipBaseConfig.posNames[h[o]]+"|基础属性 +"+(l[1]/100).toFixed(1)+"%";else if(2==l[0])for(var o in h)""!=n&&(n+="\n"),n+=AttributeData.getAttrStrByType(h[o])+" +"+(l[1]/100).toFixed(1)+"%"}return void ViewManager.ins().open(YupeiSkillTipsWin,s,n)}switch(t.target){case this.eBtn:if(!this.isEnough)return void TipsCT.ins().showTips(" 材料不足");var p=GlobalConfig.ItemConfig[this.itemId],u=ItemUtil.getSubType(p);KingEquipCT.ins().sendUpgrade(2,this.role.index,u,this.itemId)}},__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(KingEquipMergeWin.prototype,"KingEquipMergeWin"),window.KingEquipMergeWin=KingEquipMergeWin,ViewManager.ins().reg(KingEquipMergeWin,LayerManager.UI_Main);var KingEquipSuitItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipRoleTipsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.sTitle=t.count+"件套";var e="";for(var i in t.attrs)e+=AttributeData.getExtAttStrByType(t.attrs[i],0)+"\n";if(t.percent){var s=["","雷霆装备","霸业装备","主宰装备","心魔装备"];e+=s[t.percent[0]]+"全属性+"+(t.percent[1]/1e4).toFixed(2)+"%"}this.sLab=e}},e}(BaseItemRender);__reflect(KingEquipSuitItemRenderer.prototype,"KingEquipSuitItemRenderer"),window.KingEquipSuitItemRenderer=KingEquipSuitItemRenderer;var KingEquipSuitWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tabSelect=0,e._sn_="KingEquipRoleTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eTab.dataProvider=new eui.ArrayCollection(GlobalConfig.KingEquipBaseConfig.suitNames),this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=KingEquipSuitItemRenderer,this.eList.dataProvider=this.listDP,this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eEff.addChild(this.bodyMc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.sex=t[0]||0,this.addChangeEvent(this.eTab,this.onchange),this.addTouchEvent(this,this.onClick),this.update()},e.prototype.update=function(){this.ePowerPanel.setPower(GlobalConfig.KingEquipBaseConfig.suitPowers[this.tabSelect]),this.updateMC(),this.updateList()},e.prototype.updateMC=function(){var t=GlobalConfig.KingSuitConf[KingEquipCT.POSMAX][this.tabSelect+1];this.bodyMc.playFile(RES_DIR_EFF+("KingShowDress_"+this.sex+"_"+t.effId),-1)},e.prototype.updateList=function(){var t=[],e=GlobalConfig.KingSuitConf;for(var i in e){var s=e[i];for(var n in s){var o=s[n],a=o.stage;t[a]||(t[a]=[]),t[a].push(o)}}this.listDP.source=CommonUtils.objectToArray(t[this.tabSelect+1])},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.onchange=function(){this.tabSelect=this.eTab.selectedIndex,this.update()},e}(BaseEuiView);__reflect(KingEquipSuitWin.prototype,"KingEquipSuitWin"),window.KingEquipSuitWin=KingEquipSuitWin,ViewManager.ins().reg(KingEquipSuitWin,LayerManager.UI_Main);var KingEquipTipRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="KingEquipTipsRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.SkillsConfig[t];this.eIcon.source=SkillCT.ins().getSkillIdIcon(t),this.eName.text=SkillUtil.getName(e),this.eLv.text="Lv"+t%1e3,this.eDesc.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(e))}},e}(BaseItemRender);__reflect(KingEquipTipRenderer.prototype,"KingEquipTipRenderer"),window.KingEquipTipRenderer=KingEquipTipRenderer;var KingEquipTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KingEquipTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=KingEquipTipRenderer,this.addTouchEvent(this,this.onClick),this.scrollMaxHeight=930-this.eScroller.top-this.eScroller.bottom},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.role=t[1],this.update(),this.eScroller.height>this.scrollMaxHeight&&(this.eScroller.height=this.scrollMaxHeight)},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemUtil.getType(t)==ItemType.TYPE_46,i=ItemUtil.getSubType(t),s=GlobalConfig.FuseConfig[i][1];this.role&&(this.posInfo=KingEquipCT.ins().getKingPosInfo(this.role.index,i));var n=this.posInfo?this.posInfo.mergeLv:0,o=ItemUtil.getQuality(t);this.eQuali.source=o>0?"quali"+o:"",this.eNameLabel.textColor=ItemBase.QUALITY_COLOR[o],this.eNameLabel.text=t.name,this.eItemIcon.setData(t),this.eTips.visible=!e,this.eType.text=GlobalConfig.KingEquipBaseConfig.posNames[i],this.eLv.text=e?"1级":""+(t.zsLevel||0)+"转";var a=e?s.attrs:ItemUtil.getBaseAttrData(t),r=BagCT.getAttrPower(a);this.eScore.text=r+"",this.ePower.setPower(r);var l=AttributeFormat.FORMAT_1();if(l.wordColor=null,l.attrColor=null,this.eAttr0.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(a,l)),this.posInfo){var h=KingEquipCT.ins().getJLTotalAttrs(this.role.index,i);h&&0!=h.length?this.eAttr1.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(h,l)):DisplayUtils.removeFromParent(this.eJuLing)}else DisplayUtils.removeFromParent(this.eJuLing);e?this.eExAttr.text="为王者装备注入至尊之力，部位基础属\n性提升至"+(MathUtils.toInteger(s.percent/100)+100)+"%":DisplayUtils.removeFromParent(this.eExAttrs),this.updateMerge(i,n),e?DisplayUtils.removeFromParent(this.eSuit):this.updateSuit(),this.updataSkill(i,e?1:n),this.updataBtn(i),this.updateRed(i)},e.prototype.updateMerge=function(t,e){if(0==e)return void DisplayUtils.removeFromParent(this.eMergeGroup);var i=AttributeFormat.FORMAT_1();i.wordColor=null,i.attrColor=null;var s=GlobalConfig.FuseConfig[t][e];this.eMergeAttr.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(s.attrs,i))},e.prototype.updateSuit=function(){var t=GlobalConfig.KingEquipLvConfig[this.itemId].stage,e=this.posInfo?KingEquipCT.getSuitStageByRoleId(this.role):[],i=GlobalConfig.KingSuitConf,s="",n="",o=AttributeFormat.FORMAT_1();o.wordColor=null,o.attrColor=null,o.isInserte=7;var a=0,r=0;if(e.length>0)for(var l in e)e[l]>=t&&r++;else r=1;var h=0,p=["","雷霆装备","霸业装备","主宰装备","心魔装备"];for(var l in i){var u=i[l][t],d=Math.max(e[+l-1],0)==u.stage;h=Math.max(h,u.count);var c="|C:"+(d?ColorUtil.GREEN:ColorUtil.GRAY)+"&T:【"+u.count+"】";for(var f in u.attrs)c+="\n  "+AttributeData.getAttStrByType1(u.attrs[f],o);for(var f in u.exattr)c+="\n  "+AttributeData.getExtAttStrByType(u.exattr[f],0,":");u.percent&&(c+="\n  "+p[u.percent[0]]+"全属性+"+u.percent[1]/100+"%"),a++,a%2==0?n+=""+(n.length>0?"\n":"")+c+"|":s+=""+(s.length>0?"\n":"")+c+"|"}this.eLeftLab.textFlow=TextFlowMaker.generateTextFlow(s),this.eRightLab.textFlow=TextFlowMaker.generateTextFlow(n),this.eSuitTitle.textFlow=TextFlowMaker.generateTextFlow(this.eSuitTitle.text+"|C:"+(r>=h?ColorUtil.GREEN:ColorUtil.RED)+"&T:("+r+"/"+h+")|")},e.prototype.updataSkill=function(t,e){if(void 0===e&&(e=0),0==e)return void DisplayUtils.removeFromParent(this.eZhizun);var i=GlobalConfig.FuseConfig[t][e],s=[];i.soulLinkIds?s.push([i,i.soulLinkIds]):i.type&&i.soulLinkType&&s.push([i]),i.preSkillId&&s.push([i,i.preSkillId]),this.eHideTitle.text=s.length>0?"隐藏属性":"融合后开启隐藏属性",this.eHideTitle.textAlign=s.length>0?"left":"center",this.eList.dataProvider=new eui.ArrayCollection(s),this.eList.validateNow()},e.prototype.updataBtn=function(t){return this.posInfo?void 0:void DisplayUtils.removeFromParent(this.eBtnGroup)},e.prototype.updateRed=function(t){var e=!1;this.role&&this.role.isMy&&(e=KingEquipRedPoint.ins().mergeReds[this.role.index][t]),this.eRp.visible=e},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eOffBtn:var e=GlobalConfig.ItemConfig[this.itemId],i=ItemUtil.getSubType(e);KingEquipCT.ins().sendOff(this.role.index,i,this.itemId),ViewManager.ins().close(this);break;case this.eMBtn:ViewManager.ins().open(KingEquipMergeWin,this.itemId,this.role),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(KingEquipTipsWin.prototype,"KingEquipTipsWin"),window.KingEquipTipsWin=KingEquipTipsWin,ViewManager.ins().reg(KingEquipTipsWin,LayerManager.UI_Popup);var KingEquipUpgradePanel=function(t){function e(){var e=t.call(this)||this;return e.equips=[],e._curRole=0,e.curPos=0,e.tabSelect=0,e._sn_="KingEquipShowSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=0;t<KingEquipCT.POSMAX;t++)this.equips[t]=this["equip"+t],this.equips[t].pos=t,this.equips[t].selected=this.curPos==t;this.eTab.dataProvider=new eui.ArrayCollection(GlobalConfig.KingEquipBaseConfig.tabNames),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.eTab,this.onchange),this.observe(KingEquipCT.ins().postEquipUpdate,this.update),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.update=function(){this.updateItems(),this.updateView()},e.prototype.updateItems=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole);for(var e in this.equips){var i=this.equips[e].pos;this.equips[e].data=[t.kingEquipItemData[i]]}},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=t.kingEquipItemData[this.curPos],i=KingEquipCT.getItemIdByPosstage(this.curPos,this.tabSelect+1),s=GlobalConfig.ItemConfig[i],n=GlobalConfig.KingEquipLvConfig[i];this.eItemIcon1.setData(s),this.eItemLab1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e.itemConfig&&e.configID==i?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+(e.itemConfig&&e.configID==i?1:0)+"|/1");var o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.consume[0].id);this.eItemIcon2.setData(GlobalConfig.ItemConfig[n.consume[0].id]),this.eItemLab2.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(o>=n.consume[0].count?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+o+"|/"+n.consume[0].count),o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.consume[1].id),this.eItemIcon0.setData(GlobalConfig.ItemConfig[n.consume[1].id]),this.eItemLab0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(o>=n.consume[1].count?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+o+"|/"+n.consume[1].count),this.eItemIcon.setData(GlobalConfig.ItemConfig[n.toid]),this.eUpBtn.visible=!(e.itemConfig&&e.configID>i)},e.prototype.onchange=function(){this.tabSelect=this.eTab.selectedIndex,this.update()},e.prototype.onClick=function(t){if(t.target instanceof KingEquipItem)return void(this.curPos!=t.target.pos&&(this.equips[this.curPos].selected=!1,t.target.selected=!0,this.curPos=t.target.pos,this.update()));if(t.target instanceof ItemIcon&&t.target.config)return void GlobalFun.showDetail(t.target.config);switch(t.target){case this.eUpBtn:this.onClickUpBtn()}},e.prototype.onClickUpBtn=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=t.kingEquipItemData[this.curPos],i=KingEquipCT.getItemIdByPosstage(this.curPos,this.tabSelect+1),s=GlobalConfig.KingEquipLvConfig[i];if(!e.itemConfig||e.configID<i)return void TipsCT.ins().showTips("请穿戴指定装备");for(var n in s.consume){var o=s.consume[n],a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o.id);if(a<o.count)return void TipsCT.ins().showTips("进阶道具不足")}if(s.toid>0){var r=GlobalConfig.KingEquipLvConfig[s.toid];if(r.zslv&&ZsCT.ins().lv<r.zslv[0])return void TipsCT.ins().showTips("转生等级不足")}KingEquipCT.ins().sendUpgrade(1,this._curRole,this.curPos,i)},e.prototype.updateRed=function(){for(var t in this.equips){var e=this.equips[t].pos;this.equips[t].setRed(KingEquipRedPoint.ins().stageReds[this._curRole][e])}},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&this.update()},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(KingEquipUpgradePanel.prototype,"KingEquipUpgradePanel"),window.KingEquipUpgradePanel=KingEquipUpgradePanel;var LegendTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RexueTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.mc=new MovieClip},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.data=t[1],this.update()},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemUtil.getQuality(t);this.quali.source=e>0?"quali"+e:"";var i=GlobalConfig.EquipConfig[t.id],s=0;i.baseAttr1&&(s+=BagCT.getAttrPower([i.baseAttr1]));var n=s+BagCT.getAttrPower(ItemUtil.getBaseAttrData(t));this.powerPanel.setPower(n);var o=ItemUtil.getSubType(t);0==o?this.dress.addChild(this.mc):this.dress0.addChild(this.mc),this.eImg.visible=0!=o,this.sName="dress_name_"+(0==o?101501:121501)+"_png";var a=SubRoles.ins().getSubRoleByIndex(0).sex,r=GlobalConfig.EquipWithEffConfig[t.id+"_"+a];this.mc.playFile(RES_DIR_EFF+r.inShowEff,-1),this.sPos=ThunderCT.equipNames[ItemUtil.getSubType(t)],this.sLv=t.zsLevel+"转",this.sJob=Role.getJobNameByJob(ItemUtil.getJob(t)),this._bottomY=0,this.updateImgGrp(),this.addAttrTips("装备属性"),this.addAttrTips("热血属性")},e.prototype.addAttrTips=function(t){var e=new eui.Label;e.size=20,e.bold=!0,e.x=24,e.y=this._bottomY+10,e.touchEnabled=!1,e.text=t,this.content.addChild(e);var i=new eui.Label;i.size=18,i.x=46,i.y=e.y+24,i.touchEnabled=!1,this.content.addChild(i);var s="",n=GlobalConfig.ItemConfig[this.itemId];switch(t){case"装备属性":i.textColor=e.textColor=10458221,s=AttributeData.getAttStr(ItemUtil.getBaseAttrData(n),1,1,": ",!1,!0);break;case"热血属性":i.textColor=e.textColor=16776960;var o=GlobalConfig.EquipConfig[n.id];s=AttributeData.getAttStrByType(o.baseAttr1,1,"+")}i.textFlow=TextFlowMaker.generateTextFlow(s),this._bottomY=i.y+i.height},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateImgGrp=function(){var t=this.itemId;t&&-1!=GlobalConfig.HotBloodAwakeConf.legendEquip.indexOf(t)||DisplayUtils.removeFromParent(this.eImgGrp)},e}(BaseEuiView);__reflect(LegendTipsWin.prototype,"LegendTipsWin"),window.LegendTipsWin=LegendTipsWin,ViewManager.ins().reg(LegendTipsWin,LayerManager.UI_Popup);var ActivityType45Data=function(t){function e(e){var i=t.call(this,e)||this;return i.awardInfo=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.awardInfo=[];for(var e=t.readByte(),i=0;e>i;i++){for(var s=t.readByte(),n=[],o=0;s>o;o++){var a=new RewardData;a.parser(t);var r={award:a,renum:t.readInt()};n.push(r)}this.awardInfo.push(n)}},e.prototype.postRewardResult1=function(t){for(var e=t.readShort(),i=[],s=0;e>s;s++){var n={type:t.readByte(),id:t.readInt(),count:t.readInt()};i.push(n)}ViewManager.ins().isShow(FudaiResultWin)?Activity.ins().postHuntResult(i):(ViewManager.ins().open(FudaiResultWin,i),Activity.ins().postHuntResult(i))},e.prototype.getAwardNum=function(){var t=0;for(var e in this.awardInfo)for(var i in this.awardInfo[e])t+=this.awardInfo[e][i].renum;return t},e.prototype.getAwardNum1=function(){for(var t=0,e=0;e<this.awardInfo.length&&!(e>1);e++)for(var i in this.awardInfo[e])t+=this.awardInfo[e][i].renum;return t},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},__decorate([post()],e.prototype,"postRewardResult1",null),e}(ActivityBaseData);__reflect(ActivityType45Data.prototype,"ActivityType45Data"),window.ActivityType45Data=ActivityType45Data;var LegendTowerRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,LegendTowerCT.ins().postEnroll,LegendTowerCT.ins().postInit,LegendTowerCT.ins().postPeriod,LegendTowerCT.ins().postRank,LegendTowerCT.ins().postAwardRecord,LegendTowerCT.ins().postScore),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=LegendTowerCT.ins(),e=GlobalConfig.LegendTowerCreditRewardConfig[t.rewards];return 1!=t.periodType||t.isEnroll?3==t.periodType&&t.isEnroll?this.redPoint=!0:4==t.periodType&&e&&t.myScore>=e.credit?this.redPoint=!0:void(this.redPoint=!1):this.redPoint=!0},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(LegendTowerRedPoint.prototype,"LegendTowerRedPoint"),System.LegendTowerRedPoint=function(){return LegendTowerRedPoint.ins()},window.LegendTowerRedPoint=LegendTowerRedPoint;var LegendAwardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemSkin",e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.LegendTowerCreditRewardConfig[this.data],e=t.rewards[0].id;this.count.text=""+t.rewards[0].count;var i=GlobalConfig.ItemConfig[e];this.itemIcon.imgIcon.source=i.icon+"_png",this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(i),this.nameTxt.text=t.credit+"积分"}},e}(BaseItemRender);__reflect(LegendAwardItem.prototype,"LegendAwardItem"),window.LegendAwardItem=LegendAwardItem;var LegendBossItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="QunxiongBossItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1],i=this.data[2],s=GlobalConfig.MonstersConfig[e].name;this.awardslist.dataProvider=new eui.ArrayCollection(i),this.typeLabel.text=StringUtils.NumberToChinese(t)+"层守护   "+s}},e}(BaseItemRender);__reflect(LegendBossItem.prototype,"LegendBossItem"),window.LegendBossItem=LegendBossItem;var LegendBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongBossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.update()},e.prototype.update=function(){var t=GlobalConfig.LegendTowerChapterConfig,e=[],i=[];for(var s in t)if(t[s].rewards)for(var n in t[s].npcsInfo)t[s].npcsInfo[n].isGuardBoss&&(i.push(t[s].npcsInfo[n].monId),e.push([parseInt(s),t[s].npcsInfo[n].monId,t[s].rewards]));for(var o=e.length,a=0;o>a;a++){this["boss"+a].data=e[a];var r=i[a];this.mc=new MovieClip,this.mc.scaleX=this.mc.scaleY=GlobalConfig.LegendTowerBaseConfig.scale,this.mc.playFile(RES_DIR_MONSTER+(GlobalConfig.MonstersConfig[r].avatar+"_4s"),-1),this["monsterGroup"+a].addChild(this.mc)}},e}(BaseView);__reflect(LegendBossPanel.prototype,"LegendBossPanel"),window.LegendBossPanel=LegendBossPanel;var LegendLayerRewardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="QunxiongLayerItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.awardslist.dataProvider=new eui.ArrayCollection(t.rewards),this.typeLabel.text="第"+StringUtils.NumberToChinese(t.index)+"层"},e}(BaseItemRender);__reflect(LegendLayerRewardItem.prototype,"LegendLayerRewardItem"),window.LegendLayerRewardItem=LegendLayerRewardItem;var LegendLayerRewardPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongLayerRewardsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.update()},e.prototype.update=function(){for(var t=GlobalConfig.LegendTowerChapterRankRewardConfig,e=[],i=Object.keys(t).length;i>0;i--)e.push(t[i]);this.curServList.dataProvider=new eui.ArrayCollection(e)},e}(BaseView);__reflect(LegendLayerRewardPanel.prototype,"LegendLayerRewardPanel"),window.LegendLayerRewardPanel=LegendLayerRewardPanel;var LegendRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="QunxiongRankItemSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(null!=this.data)for(var t in this.data){var e=this[t];e&&this.updateValue(e,t,this.data[t])}this.visible=null!=this.data},e.prototype.updateValue=function(t,e,i){switch(e){case RankDataType.DATA_VIP:return;case RankDataType.DATA_MONTH:return void(t.visible=1==i);case RankDataType.DATA_LEVEL:i+="级";break;case RankDataType.DATA_COUNT:if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var s=GlobalConfig.KnighthoodConfig[i];i=s.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var s=GlobalConfig.TrainLevelConfig[i];i=s.trainlevel+"等"+s.trainName}else Rank.ins().curType==RankDataType.TYPE_XIAYI&&(i="魅力值:"+i);break;case RankDataType.DATA_WEIWANG:i=WeiWangCC.ins().getWeiWangCfg(i).res}t instanceof eui.Label?("number"==typeof i&&(i=CommonUtils.overLength(i)),t.text=e in RankItemRenderer.dataFormat?RankItemRenderer.dataFormat[e].replace("{value}",i):i):t instanceof eui.Image&&(t.source=e in RankItemRenderer.dataFormat?RankItemRenderer.dataFormat[e].replace("{value}",i):i)},e}(BaseItemRender);__reflect(LegendRankItem.prototype,"LegendRankItem"),window.LegendRankItem=LegendRankItem;var LegendRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="QunxiongRankItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eRank.text=t.rank+"",this.eName.text=t.name,this.eServer.text=t.serverId+"区",this.eScore.text=t.score+""}},e}(BaseItemRender);__reflect(LegendRankItemRender.prototype,"LegendRankItemRender"),window.LegendRankItemRender=LegendRankItemRender;var LegendRankPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canClick=!1,e.topThreeId=[],e._sn_="QunxiongRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=LegendTowerCT.ins(),this.ranks=[this.rank0,this.rank1,this.rank2],this.listDP=new eui.ArrayCollection,this.eList.dataProvider=this.listDP,this.ins.sendRankInfo()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postRank,this.update),this.observe(this.ins.postAwardRecord,this.updateAward),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.addTouchEvent(this,this.onClick),this.update()},e.prototype.update=function(){if(!this.ins.isTop){var t=this.ins.legendInfos.concat();this.topThreeId=[];for(var e=0;e<this.ranks.length;e++)this.ranks[e].data=null,t&&t[e]&&(ReadPlayerCT.ins().sendFindPlayer(t[e].actorId,t[e].serverId),this.topThreeId.push(t[e].actorId));this.state.visible=0==t.length,this.firstGroup.visible=!this.state.visible;var i=t&&t.length>0?t.shift():null;this.eRank.text=i?i.rank+"":"",this.eName.text=i?i.name:"",this.sServer.text=i?i.serverId+"区":"",this.eScore.text=i?i.score+"":"",this.listDP.source=t;var s="";this.ins.myRank>0?(s=ColorUtil.GREEN_COLOR,this.eMyRank.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+this.ins.myRank+"</font>")):(s=ColorUtil.RED_COLOR,this.eMyRank.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">未参赛</font>")),this.eMymark.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+this.ins.myScore+"</font>"),this.updateAward()}},e.prototype.updateAward=function(){var t=GlobalConfig.LegendTowerCreditRewardConfig[this.ins.rewards];if(this.redPoint.visible=this.award.visible=this.awardNum.visible=!!t,t){var e="";this.ins.myScore>=t.credit?(e=ColorUtil.GREEN_COLOR,this.redPoint.visible=this.canClick=!0):(this.redPoint.visible=this.canClick=!1,e=ColorUtil.RED_COLOR),this.awardNum.textFlow=TextFlowMaker.generateTextFlow("积分<font color="+e+">"+this.ins.myScore+"/"+t.credit+"</font>")}},e.prototype.onClick=function(t){switch(t.target){case this.award:this.canClick?this.ins.sendAward(this.ins.rewards):TipsCT.ins().showTips("积分不足")}},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.ranks.length;e++)this.topThreeId[e]==t.id&&(this.ranks[e].data={otherPlayerData:t})},e}(BaseView);__reflect(LegendRankPanel.prototype,"LegendRankPanel"),window.LegendRankPanel=LegendRankPanel;var LegendRewardItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="QunxiongRewardsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.awardslist.dataProvider=new eui.ArrayCollection(t.rewards),t.rankRange&&(t.rankRange[0]==t.rankRange[1]?this.typeLabel.text="第"+t.rankRange[0]+"名":this.typeLabel.text="第"+t.rankRange[0]+"名-第"+t.rankRange[1]+"名")},e}(BaseItemRender);__reflect(LegendRewardItem.prototype,"LegendRewardItem"),window.LegendRewardItem=LegendRewardItem;var LegendRewardPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongRewardsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.update()},e.prototype.update=function(){var t=GlobalConfig.LegendTowerRankRewardConfig,e=[];for(var i in t)e.push(t[i]);this.curServList.dataProvider=new eui.ArrayCollection(e)},e}(BaseView);__reflect(LegendRewardPanel.prototype,"LegendRewardPanel"),window.LegendRewardPanel=LegendRewardPanel;var LegendScoreItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleScoreRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.rank<=3;this.rankImg.source=e?"paihang"+t.rank:null,this.rank.text=e?"":t.rank+"",this.nameLabel.text=t.name,this.nameGuild.text=t.guildName,this.score.text=t.score+""
},e}(BaseItemRender);__reflect(LegendScoreItem.prototype,"LegendScoreItem"),window.LegendScoreItem=LegendScoreItem;var LegendScoreRankWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BattleScoreRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=LegendTowerCT.ins(),this.list.itemRenderer=LegendScoreItem,this._arrayCllect=new eui.ArrayCollection,this.list.dataProvider=this._arrayCllect},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postRank,this.update),this.update()},e.prototype.update=function(){if(!this.ins.isTop){for(var t=[],e=0;30>e;e++)this.ins.legendInfos[e]&&t.push(this.ins.legendInfos[e]);this._arrayCllect.source=t}this.myScore.text=this.ins.myScore+"",this.myRank.text="我的排名："+this.ins.myRank},e}(BaseView);__reflect(LegendScoreRankWin.prototype,"LegendScoreRankWin"),window.LegendScoreRankWin=LegendScoreRankWin;var LegendScoreWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongScoreSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(LegendScoreWin.prototype,"LegendScoreWin"),window.LegendScoreWin=LegendScoreWin,ViewManager.ins().reg(LegendScoreWin,LayerManager.UI_Popup);var LegendTowerPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongSignupSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=LegendTowerCT.ins();var t=[];for(var e in GlobalConfig.LegendTowerCreditRewardConfig)t.push(e);this.awardslist.dataProvider=new eui.ArrayCollection(t),this.eDescLab.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.LegendTowerBaseConfig.rule),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postEnroll,this.update),this.observe(this.ins.postPeriod,this.update),this.update()},e.prototype.update=function(){if(this.skin){this.redPoint.visible=this.enroll.visible=!1,this.eTimeLab.visible=!0;var t=this.ins.openTime,e=this.ins.endTime,i=t-GameServer.serverTime;if(1==this.ins.periodType){var s=DateUtils.getFormatBySecond(Math.round(t/1e3),DateUtils.TIME_FORMAT_13);this.eTimeLab.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+s+"开启活动</font>"),this.eBtn.label="报  名",this.ins.isEnroll?(this.eBtn.visible=!1,this.enroll.visible=!0):this.redPoint.visible=this.eBtn.visible=!0}else if(3==this.ins.periodType){var n=Math.round((e-GameServer.serverTime)/1e3),s=void 0;s=n>0?DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_1):"00:00:00",this.eTimeLab.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.RED_COLOR+">活动结束 "+s+"</font>"),this.eBtn.label=this.ins.isEnroll?"开始闯塔":"未报名",this.eBtn.enabled=!!this.ins.isEnroll,this.eBtn.visible=!0,this.redPoint.visible=this.eBtn.enabled}else{if(2==this.ins.periodType){var s=DateUtils.getFormatBySecond(Math.round(i/1e3),DateUtils.TIME_FORMAT_1);this.eTimeLab.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+s+"后开始</font>")}else this.eTimeLab.visible=!1;this.eBtn.label=this.ins.isEnroll?"开始闯塔":"未报名",this.eBtn.enabled=!1}}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:1==this.ins.periodType?this.ins.sendUpStage():3==this.ins.periodType&&this.ins.sendEnter();break;case this.rule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[58].text)}},e.prototype.close=function(){Timer.stopAll(this)},e}(BaseView);__reflect(LegendTowerPanel.prototype,"LegendTowerPanel"),window.LegendTowerPanel=LegendTowerPanel;var LegendTowerUI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canClick=!1,e._sn_="QunxiongBattleSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=LegendTowerCT.ins(),this.jump.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.jump.text+"</u>"),this.progressBar0.labelFunction=function(t,e){return""},this.progressBar0.value=0,this.progressBar0.visible=!1,this.bgmc=new MovieClip,this.bgmc.playFile(RES_DIR_EFF+"ProgressEff1",-1),this.bgmc.scaleX=1.25,this.effGroup0.height=50,this.effGroup0.scrollEnabled=!0,this.effGroup0.addChild(this.bgmc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postLayer,this.update),this.observe(this.ins.postSoulNum,this.updateSoul),this.observe(this.ins.postRank,this.updateScore),this.observe(this.ins.postScore,this.updateAward),this.observe(this.ins.postAwardRecord,this.update),this.observe(this.ins.postDieNum,this.updateUI),this.observe(this.ins.postSumDieNum,this.updateUI),this.observe(this.ins.postResult,this.updateUI),this.observe(GameLogic.ins().postChangeTarget,this.updateCollect),this.observe(GameLogic.ins().postRemoveEntity,this.updateCollect),this.observe(GameLogic.ins().postCreateOtherEntity,this.updateCollect),this.observe(this.ins.postUpdateFlag,this.updateCollect),this.addTouchEvent(this,this.onClick),this.update(),this.checkTime(),Timer.start(1e3,0,this.checkTime,this)},e.prototype.removeDisplay=function(){egret.Tween.removeTweens(this.effGroup0),Timer.stopAll(this)},e.prototype.checkTime=function(){this.assignPer.visible=!0,this.bigTimeGroup.visible=!1;var t=Math.floor((GameServer.serverTime-this.ins.openTime)/1e3),e=GlobalConfig.LegendTowerBaseConfig,i=t%e.conveyTime,s=e.conveyTime-i;this.campLeftTime0.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_10),s<=e.countdown&&s>0&&(this.bigTimeGroup.visible=!this.bossId||this.isBossDie,this.countDown.text=s+"")},e.prototype.update=function(){this.layerName.text="群雄塔"+this.ins.layer+"层";var t=GlobalConfig.LegendTowerChapterConfig[this.ins.layer+1];this.bigTimeGroup.visible=this.assignPer.visible=this.nextLayer.visible=this.nextNum.visible=!!t,t&&(this.nextNum.text=GlobalConfig.LegendTowerChapterConfig[this.ins.layer].nextChapterSoulPoint+"灵魂"),this.updateUI(),this.updateSoul(),this.updateAward(),this.updateScore(),this.updateCollect()},e.prototype.updateCollect=function(){this["catch"].visible=this.buff.visible=!1;var t=SubRoles.lookAtTar.x,e=SubRoles.lookAtTar.y,i=this.ins.buffData.length;egret.Tween.removeTweens(this.effGroup0),this.effGroup0.scaleX=0;for(var s=0;i>s;s++){var n=this.ins.buffData[s].buffHandle,o=EntityManager.ins().getEntityByHandle(n),a=GlobalConfig.LegendTowerBaseConfig.space;if(o&&Math.abs(t-o.x)<a&&Math.abs(e-o.y)<a)if(this.ins.attackHandle=this.monsHandle=n,this.ins.buffData[s].belongHandle&&Actor.handle==this.ins.buffData[s].belongHandle){var r=EntityManager.ins().getEntityBymasterhHandle(this.ins.buffData[s].belongHandle);this.buff.visible=!1,this["catch"].visible=!0,this.state0.text=r.infoModel.name+" 正在采集中...",egret.Tween.removeTweens(this.effGroup0),egret.Tween.get(this.effGroup0).to({scaleX:1},1e3*this.ins.buffData[s].times)}else{var l=o.infoModel.configID;this.buff.visible=!0,this["catch"].visible=!1;var h=GlobalConfig.MonstersConfig[l];this.roleHead.source="monhead"+h.head+"_png",this.roleName.text=""+h.name}}},e.prototype.updateUI=function(){var t=GlobalConfig.LegendTowerChapterConfig,e=t[this.ins.layer].npcsInfo;e&&e[0]&&e[0].isGuardBoss&&(this.bossId=e[0].monId);var i=EntityManager.ins().getEntityByMonsterId(this.bossId),s=0==i.length?0:i[0].getRealHp()>0?i.length:0;if(this.soulGruop.visible=this.rankInfo.visible=!s,this.bossHead.visible=!!this.bossId&&!s,this.bossId){var n=GlobalConfig.MonstersConfig[this.bossId];this.monhead.source="monhead"+n.head+"_png";var o=this.ins.sumDieNum,a=t[this.ins.layer].refreshBossDeadTimes;this.bossHp.text=o+"/"+a,this.boss.maximum=a,this.boss.value=o,this.bossHead.visible=a>o,this.isBossDie=o>=a&&!s,s?ViewManager.ins().open(BossBelongPanel):(ViewManager.ins().isShow(BossBelongPanel)&&ViewManager.ins().close(BossBelongPanel),ViewManager.ins().isShow(BossBloodPanel)&&ViewManager.ins().close(BossBloodPanel))}this.reviveGroup.visible=t[this.ins.layer].canFall>0,this.revive.text=this.ins.dieNum+"/"+t[this.ins.layer].maxRebornTime},e.prototype.updateScore=function(){this.num3.text=this.ins.myScore+"",this.rank3.text=this.ins.myRank+"";for(var t=this.ins.legendInfos,e=0;3>e;e++)t[e]?(this["name"+e].text=t[e].name,this["num"+e].text=t[e].score+""):this["name"+e].text=this["num"+e].text="";this.updateAward()},e.prototype.updateSoul=function(){this.curNum.text=this.ins.soulNum+"灵魂"},e.prototype.updateAward=function(){var t=GlobalConfig.LegendTowerCreditRewardConfig[this.ins.rewards];if(t){var e="";this.ins.myScore>=t.credit?(e=ColorUtil.GREEN_COLOR,this.redPoint.visible=this.canClick=!0):(e=ColorUtil.RED_COLOR,this.redPoint.visible=this.canClick=!1),this.scoreTxt2.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+this.ins.myScore+"/"+t.credit+"</font>")}},e.prototype.onClick=function(t){switch(t.target){case this.giftBtn:this.canClick?this.ins.sendAward(this.ins.rewards):TipsCT.ins().showTips("积分不足");break;case this.jump:this.ins.sendRankInfo(),ViewManager.ins().open(LegendScoreWin);break;case this.buff:this.monsHandle&&(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameLogic.ins().postChangeAttrPoint(this.monsHandle))}},e}(BaseEuiView);__reflect(LegendTowerUI.prototype,"LegendTowerUI"),window.LegendTowerUI=LegendTowerUI,ViewManager.ins().reg(LegendTowerUI,LayerManager.UI_Main);var LegendTowerWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QunxiongMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.viewStack.selectedIndex=0,this.tab.dataProvider=this.viewStack},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LegendTowerCT.ins().checkOpen(!0)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tab.selectedIndex=this.viewStack.selectedIndex=isNaN(t[0])?0:t[0],this.setOpenIndex(this.tab.selectedIndex),this.addChangeEvent(this.tab,this.onTabTouch),this.observe(LegendTowerCT.ins().postInit,this.update),this.observe(LegendTowerCT.ins().postPeriod,this.update),this.observe(LegendTowerCT.ins().postEnroll,this.update),this.observe(LegendTowerRedPoint.ins().postRedPoint,this.updateRed),this.update(),this.updateTime(),Timer.start(1e3,0,this.updateTime,this),this.updateRed()},e.prototype.setOpenIndex=function(t){this.oldIndex=t},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.updateRed=function(){this.redPoint0.visible=LegendTowerRedPoint.ins().redPoint,this.redPoint1.visible=!1},e.prototype.updateTime=function(){(LegendTowerCT.ins().periodType==period_Status.SignEnd||LegendTowerCT.ins().periodType==period_Status.OnGoing)&&this.eSignPanel.update()},e.prototype.update=function(){this.eRankPanel.visible=LegendTowerCT.ins().periodType==period_Status.Over,this.eSignPanel.visible=!this.eRankPanel.visible},e.prototype.close=function(){Timer.stopAll(this)},e}(BaseEuiView);__reflect(LegendTowerWin.prototype,"LegendTowerWin"),window.LegendTowerWin=LegendTowerWin,ViewManager.ins().reg(LegendTowerWin,LayerManager.UI_Main);var HandleTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="HandleTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GameServer.serverOpenDay+1,s=t[0].configID,n=GlobalConfig.KuangYuanConfig[s];this.desc.text=n.name,this.desc.textColor=n.color;var o=1;for(var a in n.rewards)i>=+a&&(o=+a);var r=[].concat(n.rewards[o]);n.rewardItem&&n.rewardItem[o]&&(r=r.concat(n.rewardItem[o]));for(var l=0,h=0,p=t[0].beRob;h<p.length;h++){var u=p[h];u.win&&(l+=1)}for(var d=[],a=0;a<r.length;a++){var c=r[a].count;if(l&&a<n.rewards.length){var f=Math.ceil(r[a].count*n.robPrecent/100)*l;c-=f}var g={type:r[a].type,count:c,id:r[a].id};d.push(g)}this.reward.dataProvider=new eui.ArrayCollection(d)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(e);break;case this.btn:Mine.ins().sendIntoMine(),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(HandleTipsWin.prototype,"HandleTipsWin"),window.HandleTipsWin=HandleTipsWin,ViewManager.ins().reg(HandleTipsWin,LayerManager.Main_View);var Mine=function(t){function e(){var e=t.call(this)||this;return e.mineStartTime=0,e.mineEndTime=0,e.hasNewRecord=!1,e.info=[],e.canFree=!1,e.sysId=PackageID.Mine,e.regNetMsg(1,e.postMineBaseInfo),e.regNetMsg(2,e.postRefresh),e.regNetMsg(3,e.postStartMine),e.regNetMsg(4,e.postInitScene),e.regNetMsg(6,e.postMineRecord),e.regNetMsg(7,e.doReqResult),e.regNetMsg(8,e.postFightBackResult),e.regNetMsg(9,e.postEnemyAppear),e.regNetMsg(11,e.postSceneUpdate),e.regNetMsg(13,e.postRobResult),e.regNetMsg(15,e.postFinished),e.regNetMsg(16,e.postRecordHasUpdate),e.regNetMsg(17,e.postRoleInfo),e.regNetMsg(18,e.postHelpInfo),e.regNetMsg(19,e.postResult),e.regNetMsg(20,e.postHelpResult),e.observe(GameLogic.ins().postEnterMap,e.onEnterMap),e.observe(e.postInitScene,function(){Timer.start(2e3,1,function(){GameMap.sceneInMine()&&e.fightActId&&e.fightId&&e.fightIndex&&e.sendHelpFight(e.fightActId,e.fightIndex)},e)}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onEnterMap=function(){GameMap.sceneInMine()&&this.hasNewRecord&&!this.finishedData&&ViewManager.ins().open(MineRecordWin)},e.openCheck=function(t){var e=GlobalConfig.CaiKuangConfig.openServerDay;if(e>GameServer.serverOpenDay+1)return t&&TipsCT.ins().showTips("开服第"+e+"天开启"),!1;var i=GlobalConfig.CaiKuangConfig.openLevel,s=Actor.level>=i;return s?s:(t&&TipsCT.ins().showTips(i+"级开启"),!1)},e.redpointCheck=function(){var t=this.openCheck();if(!t)return t;var i=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;return e.ins().finishedData||e.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+i&&e.ins().isOverTime()||e.ins().hasNewRecord?t:!1},e.prototype.isOverTime=function(){return e.ins().mineEndTime?GameServer.serverTime>e.ins().mineEndTime?!0:!1:!0},e.prototype.postRedPoint=function(){return e.redpointCheck()?1:0},e.prototype.postMineFightState=function(t){return t},e.prototype.postMineBaseInfo=function(t){this.mineCount=t.readShort(),this.robCount=t.readShort(),this.mineId=t.readInt(),this.mineFreshCount=t.readInt(),this.mineQuaCount=t.readInt(),this.mineEndTime=DateUtils.formatMiniDateTime(t.readInt()),this.mineId||(this.finishedData=null),this.canFree=0==t.readByte(),e.ins().postRedPoint()},e.prototype.postRefresh=function(t){this.mineId=t.readInt(),this.mineFreshCount=t.readInt();var i=t.readInt();if(i>this.mineQuaCount){var s=GlobalConfig.KuangYuanConfig[e.ins().mineId],n=Math.floor(s.maxTimes/s.baseTime);TipsCT.ins().showTips("升级失败，祝福值+"+n)}this.mineQuaCount=i},e.prototype.postStartMine=function(t){this.mineCount=t.readShort(),e.ins().postRedPoint()},e.prototype.postInitScene=function(t){MineData.ins().parser(t)},e.prototype.postMineRecord=function(t){var i=t.readShort();this.mineRecords=this.mineRecords||[],this.mineRecords.length=i;for(var s=0;i>s;s++)this.mineRecords[s]=this.mineRecords[s]||new MineRecord,this.mineRecords[s].parser(t);this.hasNewRecord=!1,e.ins().postRedPoint()},e.prototype.doReqResult=function(t){var e=t.readBoolean();e?MineFight.ins().start({type:0,id:this.robData.configID,actorID:this.robData.actorID}):TipsCT.ins().showTips("不可掠夺")},e.prototype.postFightBackResult=function(t){for(var e=t.readBoolean(),i=t.readInt(),s=0,n=this.mineRecords;s<n.length;s++){var o=n[s];if(o.index==i){o.isBeatHim=e?1:0;break}}},e.prototype.postEnemyAppear=function(t){var e=new MineEnemyModel;return e.parser(t),e},e.prototype.postSceneUpdate=function(t){var e=ObjectPool.pop("MineSceneInfo");e.parser(t),e.handler(),e.destroy()},e.prototype.postRobResult=function(t){this.robCount=t.readShort()},e.prototype.postFinished=function(t){this.mineStartTime=0,this.mineEndTime=0,this.finishedData={},this.finishedData.configID=t.readShort(),this.finishedData.beRob=[];for(var i=t.readShort(),s=0;i>s;s++){var n={};n.name=t.readString(),n.win=t.readBoolean(),this.finishedData.beRob.push(n)}this.observe(GameLogic.ins().postEnterMap,this.openRobWin),this.openRobWin(),e.ins().postRedPoint()},e.prototype.openRobWin=function(){GameMap.sceneInMine()&&!MineFight.ins().isFighting&&this.finishedData?ViewManager.ins().open(MineRobWin,this.finishedData):GameMap.sceneInMain()&&!MineFight.ins().isFighting&&this.finishedData?ViewManager.ins().open(HandleTipsWin,this.finishedData):!GameMap.sceneInMain()&&ViewManager.ins().isShow(HandleTipsWin)&&ViewManager.ins().close(HandleTipsWin)},e.prototype.postRecordHasUpdate=function(t){return this.hasNewRecord=!0,e.ins().postRedPoint(),1},e.prototype.postRoleInfo=function(t){var e=t.readDouble();return e},e.prototype.postHelpInfo=function(t){if(this.helpInfo=t.readString(),this.helpInfo){var i=new GuildMessageInfo;i.content=this.helpInfo,i.type=1,Guild.ins().guildMessageInfoData.addItem(i),ChatCT.ins().insertAllChatMsg(i),ChatCT.ins().postNewChatMsg(i),i.cd=60,this.info.push(i)}e.ins().sendGetRecord(),!Timer.has(this.updateTime,this)&&this.info.length>0&&Timer.start(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){for(var t in this.info)!this.info[t].cd&&Guild.ins().guildMessageInfoData.getItemIndex(this.info[t])>=0&&(Guild.ins().guildMessageInfoData.removeItemAt(Guild.ins().guildMessageInfoData.getItemIndex(this.info[t])),this.info.splice(this.info.indexOf(this.info[t]),1));0==this.info.length&&Timer.stop(this.updateTime,this)},e.prototype.postResult=function(t){var e,i=t.readString(),s=t.readShort(),n=GameServer.serverOpenDay+1,o=GlobalConfig.KuangYuanConfig[s],a=1;for(var r in o.rewards)n>=+r&&(a=+r);o.rewardItem&&(e=o.rewardItem[a]);var l=o.rewards[a],h=[];for(var p in l){var u={type:l[p].type,count:Math.ceil(l[p].count*o.revengePrecent/100),id:l[p].id};h.push(u)}for(var d in e){var u={type:e[d].type,count:e[d].count,id:e[d].id};h.push(u)}ResultManager.ins().create(5e4,1,h,null,null,null,i),this.sendGetRecord()},e.prototype.postHelpResult=function(t){var e=t.readByte();e||MineFight.ins().start({type:2,id:this.fightId,index:this.fightIndex,actId:this.fightActId})},e.prototype.sendIntoMine=function(){this.sendBaseProto(1)},e.prototype.sendRefresh=function(t){if(!t)return void this.sendBaseProto(2);var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendStart=function(){this.sendBaseProto(3)},e.prototype.sendGetAward=function(t){void 0===t&&(t=!1);var e=this.getBytes(5);e.writeShort(t?1:0),this.sendToServer(e)},e.prototype.sendGetRecord=function(){this.sendBaseProto(6)},e.prototype.sendRob=function(t){this.robData=t;var e=t.actorID,i=this.getBytes(7);i.writeInt(e),this.sendToServer(i)},e.prototype.sendFightBack=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.sendFightBackResult=function(t,e){var i=this.getBytes(10);i.writeInt(t?1:0),i.writeInt(e),this.sendToServer(i)},e.prototype.sendQuickFinish=function(){this.sendBaseProto(12)},e.prototype.sendRobResult=function(t,e,i){var s=this.getBytes(13);s.writeInt(t?1:0),this.sendToServer(s)},e.prototype.sendSceneChange=function(t){var e=this.getBytes(14);e.writeShort(t?1:0),this.sendToServer(e)},e.prototype.sendGetRolePower=function(t){var e=this.getBytes(17);e.writeInt(t),this.sendToServer(e)},e.prototype.sendCaveHelp=function(t,e){var i=this.getBytes(18);i.writeString(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendHelpFight=function(t,e){var i=this.getBytes(19);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendHelpRevenge=function(t,e,i){var s=this.getBytes(20);s.writeByte(t?1:0),s.writeInt(e),s.writeInt(i),this.sendToServer(s)},e.prototype.sendOnekeyBtn=function(t){var e=this.getBytes(21);e.writeByte(t),this.sendToServer(e)},e.prototype.openCheck=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;return this.mineCount>=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t?(TipsCT.ins().showCenterTips("|C:0xff0000&T:今日挖掘次数已满|"),!1):this.mineStartTime?(TipsCT.ins().showCenterTips("|C:0xff0000&T:正在挖矿中，请耐心等候|"),!1):!0},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postMineFightState",null),__decorate([post()],e.prototype,"postMineBaseInfo",null),__decorate([post()],e.prototype,"postRefresh",null),__decorate([post()],e.prototype,"postStartMine",null),__decorate([post()],e.prototype,"postInitScene",null),__decorate([post()],e.prototype,"postMineRecord",null),__decorate([post()],e.prototype,"postFightBackResult",null),__decorate([post()],e.prototype,"postEnemyAppear",null),__decorate([post()],e.prototype,"postSceneUpdate",null),__decorate([post()],e.prototype,"postRobResult",null),__decorate([post()],e.prototype,"postFinished",null),__decorate([post()],e.prototype,"postRecordHasUpdate",null),__decorate([post()],e.prototype,"postRoleInfo",null),__decorate([post()],e.prototype,"postHelpInfo",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postHelpResult",null),e}(BaseSystem);__reflect(Mine.prototype,"Mine"),System.Mine=function(){return Mine.ins()},window.Mine=Mine;var MineData=function(t){function e(){var e=t.call(this)||this;return e.isShowTransfer=!0,e.mines=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.parser=function(t){this.index=t.readShort(),this.isExitUp=!!t.readShort(),this.isExitDown=!!t.readShort();var e=t.readShort();this.removeAll();for(var i=0;e>i;i++)this.mines[i]=ObjectPool.pop("MineModel"),this.mines[i].parser(t),this.checkIsMyMine(this.mines[i]),this.updateMineConfig(this.mines[i]);this.resetRole(),this.createTransfer(),this.createEntity(),this.showAwardWin()},e.prototype.showAwardWin=function(){Mine.ins().finishedData&&ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)},e.prototype.resetRole=function(){EntityManager.ins().resetRole();for(var t=SubRoles.ins().subRolesLen,e=1;t>e;e++){var i=SubRoles.ins().roles[e],s=EntityManager.ins().getEntityByHandle(i.handle);s&&(s.visible=!1)}},e.prototype.createTransfer=function(){if(this.isShowTransfer){GlobalConfig.CaiKuangConfig.transPos;if(this.isExitUp){var t=EntityManager.ins().getTransferById(0);t?(t.infoModel.index=this.index-1,t.updateModel()):this.addTransfer(0,this.index-1)}else EntityManager.ins().removeTransferById(0);if(this.isExitDown){var t=EntityManager.ins().getTransferById(1);t?(t.infoModel.index=this.index+1,t.updateModel()):this.addTransfer(1,this.index+1)}else EntityManager.ins().removeTransferById(1)}},e.prototype.showTransfer=function(t){this.isShowTransfer=t,t?this.createTransfer():(EntityManager.ins().removeTransferById(0),EntityManager.ins().removeTransferById(1))},e.prototype.addTransfer=function(t,e){var i=GlobalConfig.CaiKuangConfig.transPos,s=new TransferModel;s.configID=t,s.index=e;var n=i[s.configID];s.x=n.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),s.y=n.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),EntityManager.ins().createEntity(s)},e.prototype.createEntity=function(){for(var t=0,e=this.mines;t<e.length;t++){var i=e[t];GameLogic.ins().createEntityByModel(i)}Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){for(var t=0,e=this.mines;t<e.length;t++){var i=e[t],s=EntityManager.ins().getMineByIndex(i.index);s&&s.updateTime()}},e.prototype.getMineByIndex=function(t,e){for(var i=0,s=this.mines;i<s.length;i++){var n=s[i];if(n.index==t)return e&&e!=n.actorID?null:n}},e.prototype.add=function(t){this.remove(t.index),e.ins().mines.push(t),this.checkIsMyMine(t),this.updateMineConfig(t),GameLogic.ins().createEntityByModel(t)},e.prototype.updateMineConfig=function(t){var e=GlobalConfig.CaiKuangConfig.kuangPos,i=e[t.index-1];t.x=i.x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),t.y=i.y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),t.dir=i.d},e.prototype.checkIsMyMine=function(t){return t.actorID==Actor.actorID?(this.myMine=t.clone(this.myMine),Mine.ins().mineStartTime=this.myMine.startTime,Mine.ins().mineEndTime=this.myMine.endTime,!0):!1},e.prototype.getIsCanAtk=function(t){return t.actorID==Actor.actorID?!1:e.ins().getMineByIndex(t.index,t.actorID)?t.isBeFight?!1:t.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount?!1:t.beFightActorID.indexOf(Actor.actorID)>=0?!1:Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount?!1:!0:!1},e.prototype.remove=function(t){for(var e in this.mines){var i=this.mines[e];if(i.index==t){this.mines.splice(parseInt(e),1),EntityManager.ins().removeMineByIndex(t);break}}},e.prototype.removeAll=function(){for(;this.mines.length;){var t=this.mines.pop();EntityManager.ins().removeMineByIndex(t.index)}Timer.stopAll(this)},e}(BaseClass);__reflect(MineData.prototype,"MineData"),window.MineData=MineData;var MineEnemyModel=function(){function t(){this.subRole=[],this.hejiLvl=0,this.weiWang=0}return t.prototype.parser=function(t){this.lv=t.readShort(),this.zsLv=t.readShort(),this.name=t.readString();for(var e=t.readShort(),i=0;e>i;i++){var s=this.subRole[i]=new Role;s.parser(t),s.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData,this.fireRing.parser(t),this.hejiLvl=t.readInt(),this.weiWang=t.readInt(),MineFight.ins().createEnemy(this)},t.prototype.getJobRoles=function(){var t=[].concat(this.subRole);return t.sort(function(t,e){return t.job<e.job?-1:1}),t},t}();__reflect(MineEnemyModel.prototype,"MineEnemyModel"),window.MineEnemyModel=MineEnemyModel;var MineFight=function(t){function e(){var e=t.call(this)||this;return e.isFighting=0,e.range=4,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(t){if(!this.isFighting){this.isFighting=1,this.handles=[],this._data=t;var e=EntityManager.ins().getAllEntity(),i=SubRoles.lookAtTar;for(var s in e){var n=e[s].infoModel;n&&(0==t.type&&n.type==EntityType.Mine&&n.actorID==t.actorID||e[s]!=i&&(e[s].visible=!1))}this.setShowUI(!1),SkillCT.ins().setHejiCD(6e3),this.enemyPoints=this.getEnemyPoint(),this.startPos={x:i.x,y:i.y};for(var o=DirUtil.get8DirBy2Point(this.startPos,{x:GameMap.grip2Point(this.enemyPoints[0][0]),y:GameMap.grip2Point(this.enemyPoints[0][1])}),a=0;a<SubRoles.ins().subRolesLen;a++){var r=EntityManager.ins().getJobMainRole(a);if(!r)break;if(0==a)r.x=this.startPos.x,r.y=this.startPos.y;else{var l=GameMap.getPosRangeRandom(this.startPos.x,this.startPos.y,DirUtil.dirOpposit(o),a);r.x=GameMap.grip2Point(l[0]),r.y=GameMap.grip2Point(l[1])}r.dir=o,r.visible=!0,r.AI_STATE=AI_State.Stand,this.playTransferEffect(r),this.handles.push(r.infoModel.handle),RoleAI.ins().add(r)}}},e.prototype.stop=function(){if(this.isFighting){this.isFighting=0,this._model=null,HejiUseMgr.ins().unregister(this),Timer.stopAll(this);var t=EntityManager.ins().getAllEntity();for(var e in t)t[e].infoModel&&t[e].infoModel.type!=EntityType.Monster&&(t[e].visible=!0);for(var i=0;i<this.handles.length;i++){var e=this.handles[i];EntityManager.ins().removeByHandle(e)}this.resetRole(),this.setShowUI(!0),RoleAI.ins().stop(),RoleAI.ins().clearAIList(),GameMap.sceneInMine()&&Mine.ins().finishedData&&ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)}},e.prototype.resetRole=function(){MineData.ins().resetRole();var t=SubRoles.ins().getSubRoleByIndex(0),e=EntityManager.ins().getEntityByHandle(t.handle);e.x=this.startPos.x,e.y=this.startPos.y,e.AI_STATE=AI_State.Stand},e.prototype.fightEnd=function(t){Mine.ins().fightActId=null,Mine.ins().fightIndex=null,Mine.ins().fightId=null,t?this.fightWin():this.fightFail()},e.prototype.fightWin=function(){var t=this,e=this._data.id,i=GlobalConfig.KuangYuanConfig[e],s=this.getAward(i);s=this.getCountAward(s);for(var n=0,o=s;n<o.length;n++){var a=o[n];0!=a.type&&Encounter.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,a)}var r=EntityManager.ins().getAllEntity(),l=function(t){var e=r[t].infoModel;return e?0==h._data.type&&e.type==EntityType.Mine&&e.actorID==h._data.actorID?(egret.Tween.get(r[t]).to({alpha:0},1e3).call(function(){r[t].visible=!1,r[t].alpha=1}),"break"):void 0:"continue"},h=this;for(var p in r){var u=l(p);if("break"===u)break}var d=function(){t.sendToServer(!0),Timer.start(1e3,1,t.stop,t);for(var e=EntityManager.ins().getEntityByTeam(Team.My),i=0,s=e;i<s.length;i++){var n=s[i];n.stopMove(),n instanceof CharRole?t.playTransferEffect(n):EntityManager.ins().removeByHandle(n.infoModel.handle)}SoundUtil.play(SoundEnum.SCENE)};DropHelp.addCompleteFunc(d,this),DropHelp.start()},e.prototype.fightFail=function(){var t=this;this.sendToServer(!1),Encounter.ins().postFightResult(0),Timer.start(2e3,1,function(){t.stop()},this),2==this._data.type&&ResultManager.ins().create(5e4,0,null)},e.prototype.sendToServer=function(t){0==this._data.type?Mine.ins().sendRobResult(t,this._data.id,this._data.actorID):2==this._data.type?Mine.ins().sendHelpRevenge(t,this._data.index,this._data.actId):Mine.ins().sendFightBackResult(t,this._data.index)},e.prototype.setShowUI=function(t){GameMap.sceneInMine()&&(MineData.ins().showTransfer(t),Mine.ins().postMineFightState(t?1:0))},e.prototype.getIsFightBack=function(){return 1==this._data.type},e.prototype.getRoles=function(){return this._model?this._model.subRole:null},e.prototype.getSkillLvl=function(){return this._model?this._model.hejiLvl:0},e.prototype.getIsWeiShe=function(t){if(!this._model)return!1;var e=this._model;return t?Actor.weiWang>e.weiWang:Actor.weiWang<e.weiWang},e.prototype.getWeiSheHurt=function(t){if(!this.getIsWeiShe(t))return 0;var e=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG),i="";i=t?Actor.myName:this._model&&this._model.subRole[0].name;var s=0;if(e)for(var n=0;3>n;n++){var o=e.getDataList(n);if(o&&o.player==i){s=o.pos;break}}return GlobalConfig.PrestigeBase.rankDeterDam[s-1]||GlobalConfig.PrestigeBase.normalDeterDam},e.prototype.createEnemy=function(t){this._model=t;var e=t.getJobRoles(),i=SubRoles.lookAtTar;HejiUseMgr.ins().register(this);for(var s=0;s<e.length;s++){var n=e[s];n.masterHandle=10*n.masterHandle,n.type=EntityType.Role;var o=this.enemyPoints[s]||GameMap.getPosRangeRandom(i.x,i.y,i.dir,this.range+s);o?(n.x=GameMap.grip2Point(o[0]),n.y=GameMap.grip2Point(o[1])):(n.x=i.x,n.y=i.y),n.dir=DirUtil.dirOpposit(i.dir);var a=GameLogic.ins().createEntityByModel(n,Team.WillEntity);a.dir=DirUtil.dirOpposit(i.dir),a.AI_STATE=AI_State.Stand,a.updateNeiGong(),this.playTransferEffect(a),this.handles.push(n.handle),RoleAI.ins().add(a)}RoleAI.ins().start()},e.prototype.playTransferEffect=function(t){var e=new MovieClip;e.playFile(RES_DIR_SKILLEFF+"208",1),t.addChild(e),t.playAction(EntityAction.ATTACK)},e.prototype.getAward=function(t){var e=GameServer.serverOpenDay+1,i=1;for(var s in t.rewards)e>=+s&&(i=+s);for(var n=t.rewards[i],o=[],a=t.robPrecent,s=0;s<n.length;s++){var r=new RewardData;r.type=n[s].type,r.id=n[s].id,r.count=Math.ceil(n[s].count*a/100),1==this._data.type&&(r.count*=2),o.push(r)}return o},e.prototype.getCountAward=function(t){for(var e=[],i=0,s=t;i<s.length;i++)for(var n=s[i];n.count>0;){var o=new RewardData;o.type=n.type,o.id=n.id,o.count=n.count>10?10:n.count,e.push(o),n.count-=10}return e},e.prototype.getEnemyPoint=function(){for(var t=SubRoles.lookAtTar,e=GameMap.point2Grip(t.x),i=GameMap.point2Grip(t.y),s=[],n=0,o=0,a=Math.random()>.5,r=0;8>r;r++){for(var l=a?r:7-r,h=this.range;h<this.range+3;h++){var p=GameMap.getPosRangeByDir(e,i,l,h);p[2]&&(s[l]=s[l]||[],s[l].push(p))}if(s[l]&&s[l].length>=3)return s[l]}for(var r=0;r<s.length;r++)s[r]&&s[r].length>o&&(o=s[r].length,n=r);return s[n]},e}(BaseClass);__reflect(MineFight.prototype,"MineFight"),window.MineFight=MineFight;var MineRecord=function(t){function e(){return null!==t&&t.apply(this,arguments)||this
}return __extends(e,t),e.prototype.parser=function(t){if(this.index=t.readShort(),this.type=t.readByte(),this.time=DateUtils.formatMiniDateTime(t.readInt()),this.type==e.TYPE_BEROB){this.configID=t.readByte(),this.fighterActorID=t.readInt(),this.fighterName=t.readString(),this.fighterIsWin=t.readByte(),this.isBeatHim=t.readByte(),this.fighterJob=t.readByte(),this.fighterSex=t.readByte(),this.fighterPower=t.readInt();var i=DateUtils.formatMiniDateTime(t.readInt());this.waitTimes=Math.floor((i-GameServer.serverTime)/1e3),Timer.has(this.resetCD,this)||Timer.start(1e3,0,this.resetCD,this)}else this.configID=t.readByte(),this.robActorID=t.readInt(),this.robMasterName=t.readString(),this.robIsWin=t.readByte()},e.prototype.resetCD=function(){this.waitTimes>0?this.waitTimes--:Timer.stop(this.resetCD,this)},e.TYPE_BEROB=1,e.TYPE_ROB=2,e}(egret.HashObject);__reflect(MineRecord.prototype,"MineRecord"),window.MineRecord=MineRecord;var MineSceneUpdate;!function(t){t[t.fighting=1]="fighting",t[t.finished=2]="finished",t[t.addNew=3]="addNew",t[t.scene=4]="scene",t[t.updateMine=5]="updateMine",t[t.userInfo=6]="userInfo"}(MineSceneUpdate||(MineSceneUpdate={}));var MineSceneInfo=function(){function t(){}return t.prototype.parser=function(t){this.index=t.readShort(),this.type=t.readShort(),this.type==MineSceneUpdate.fighting?this.state=t.readByte():this.type==MineSceneUpdate.addNew?(this.mine=ObjectPool.pop("MineModel"),this.mine.parser(t)):this.type==MineSceneUpdate.scene?(this.sceneIndex=t.readShort(),this.isExitUp=!!t.readShort(),this.isExitDown=!!t.readShort()):this.type==MineSceneUpdate.updateMine?this.actorId=t.readInt():this.type==MineSceneUpdate.userInfo&&(this.mine=MineData.ins().getMineByIndex(this.index),this.mine&&this.mine.parser(t))},t.prototype.handler=function(){if(this.type==MineSceneUpdate.fighting){var t=MineData.ins().getMineByIndex(this.index);if(t){t.isBeFight=1==this.state;var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateTitleState()}}else if(this.type==MineSceneUpdate.finished)MineData.ins().remove(this.index);else if(this.type==MineSceneUpdate.addNew)MineData.ins().add(this.mine);else if(this.type==MineSceneUpdate.scene)MineData.ins().isExitUp=this.isExitUp,MineData.ins().isExitDown=this.isExitDown,MineData.ins().index=this.sceneIndex,MineData.ins().createTransfer();else if(this.type==MineSceneUpdate.updateMine){var t=MineData.ins().getMineByIndex(this.index);if(t){t.beFightActorID.push(this.actorId);var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateTitleState()}}else if(this.type==MineSceneUpdate.userInfo){var e=EntityManager.ins().getMineByIndex(this.index);e&&e.updateModel()}},t.prototype.destroy=function(){this.mine=null,ObjectPool.push(this)},t}();__reflect(MineSceneInfo.prototype,"MineSceneInfo"),window.MineSceneInfo=MineSceneInfo;var MineChoseWorkerRender=function(t){function e(){var e=t.call(this)||this;return e.costNum=0,e.skinName="ChoseWorkerItemSkin",e.eGuideArrow.lab.text="首次免费升级",e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.addTouchEvent(this.upBtn,this.onClick)},e.prototype.onClick=function(){if(Mine.ins().openCheck()){if(Actor.yb<this.costNum)return void TipsCT.ins().showTips("元宝数量不足");var t=Mine.ins().mineId||1;Mine.ins().sendOnekeyBtn(t),ViewManager.ins().close(MineChoseWorkerWin)}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.nameTxt.text=e.name,this.nameTxt.textColor=e.color;var i=GameServer.serverOpenDay+1,s=1;for(var n in e.rewards)i>=+n&&(s=+n);var o=e.rewards[s],a=[].concat(o);if(e.rewardItem&&e.rewardItem[s]){var r=e.rewardItem[s];a=a.concat(r),this.label.visible=!0,this.noRobBg.visible=!0}else this.label.visible=!1,this.noRobBg.visible=!1;this.reward.dataProvider=new eui.ArrayCollection(a);var l=GlobalConfig.NpcBaseConfig[e.npcId];if(this.worker.source=l.icon,this.selectedImg.visible=e.id==(Mine.ins().mineId||1),this.arrow.visible=!!this.selectedImg.visible,this.costGroup.visible=!(e.cost||0==e.cost||this.arrow.visible),this.costNum=0,DisplayUtils.removeFromParent(this.eYbGroup),this.costGroup.visible){for(var h=GlobalConfig.KuangYuanConfig,p=Object.keys(h).length,u=Mine.ins().mineId||1;p>u;u++)h[u]&&h[u].cost&&(this.costNum=this.costNum+h[u].cost);this.ybNum.text=this.costNum+"",this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+"BtnPrompt10",-1),this.mc.x=this.upBtn.width/2,this.mc.y=this.upBtn.height/2,this.upBtn.addChild(this.mc),Mine.ins().canFree&&(this.ybNum.parent.addChildAt(this.eYbGroup,1),this.ybNum.text="0",this.ybNum1.text=this.costNum+"",this.costNum=0)}this.eGuideArrow.visible=this.costGroup.visible&&Mine.ins().canFree},e}(BaseItemRender);__reflect(MineChoseWorkerRender.prototype,"MineChoseWorkerRender"),window.MineChoseWorkerRender=MineChoseWorkerRender;var MineChoseWorkerWin=function(t){function e(){var e=t.call(this)||this;return e._cost=0,e.skinName="ChoseWorkerSin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.record.itemRenderer=MineChoseWorkerRender},e.prototype.open=function(){this.observe(Mine.ins().postRefresh,this.update),this.addTouchEvent(this.advance,this.onTap),this.addTouchEvent(this.start,this.onTap),this.initList(),this.update()},e.prototype.updateBtn=function(){this.start.label=Mine.ins().isOverTime()?"雇佣开采":"挖矿中..."},e.prototype.onTap=function(t){var e=this,i=t.currentTarget;if(i==this.advance){if(!Mine.ins().openCheck())return;if(this.isMaxLevel())return void TipsCT.ins().showCenterTips("已满级");var s=this.checkBox.selected?1:2;if(this.checkBox.selected){var n=BagCT.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id);if(!n||n.count<GlobalConfig.CaiKuangConfig.needItem.count)return void TipsCT.ins().showTips("|C:0xff0000&T:道具不足")}else if(Actor.yb<this._cost)return void TipsCT.ins().showTips("元宝不足");Mine.ins().sendRefresh(s)}else if(i==this.start){if(!Mine.ins().openCheck())return;if(!this.isMaxLevel())return void WarnWin.show("当前不是最高品质，是否确认挖矿？",function(){Mine.ins().sendStart(),e.checkBox.selected=!1,ViewManager.ins().close(e)},this);Mine.ins().sendStart(),ViewManager.ins().close(this)}},e.prototype.initList=function(){var t=GlobalConfig.KuangYuanConfig,e=[];for(var i in t)e.push(t[i]);this.record.dataProvider=new eui.ArrayCollection(e),this._lastMineId=Mine.ins().mineId},e.prototype.update=function(){var t=GlobalConfig.CaiKuangConfig.refreshCost,e=t.length,i=Mine.ins().mineFreshCount,s=i>=e?t[e-1]:t[i];this._cost=s,this.yuanbaoNum.text=""+s;var n=BagCT.ins().getBagItemById(GlobalConfig.CaiKuangConfig.needItem.id),o=65280;(!n||n.count<GlobalConfig.CaiKuangConfig.needItem.count)&&(o=16711680);var a=n?n.count+"":"0";this.num1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+a),this.needlabel.text="/"+GlobalConfig.CaiKuangConfig.needItem.count;var r=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0,l=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+r,h=Mine.ins().mineCount;if(h>=l?this.countTxt.textFlow=TextFlowMaker.generateTextFlow1("今日采矿次数：|C:0xff0000&T:"+(l-h)+"/"+l+"|"):this.countTxt.textFlow=TextFlowMaker.generateTextFlow1("今日采矿次数：|C:0x00ff00&T:"+(l-h)+"/"+l+"|"),Mine.ins().mineId){var p=GlobalConfig.KuangYuanConfig[Mine.ins().mineId];this.expBar0.maximum=p.maxTimes,this.expBar0.value=Math.ceil(p.maxTimes/p.baseTime*Mine.ins().mineQuaCount)}else this.expBar0.maximum=10,this.expBar0.value=0;this.isMaxLevel()&&(this.expBar0.maximum=10,this.expBar0.value=0),this._lastMineId!=Mine.ins().mineId&&(this.record.dataProvider.refresh(),this._lastMineId=Mine.ins().mineId),this.updateBtn()},e.prototype.isMaxLevel=function(){var t=Mine.ins().mineId+1;return GlobalConfig.KuangYuanConfig[t]?!1:!0},e.prototype.close=function(){},e.openCheck=function(){return Mine.ins().mineId||Mine.ins().sendRefresh(),MineData.ins().mines.length>=GlobalConfig.CaiKuangConfig.maxKuangCount?(TipsCT.ins().showCenterTips("|C:0xff0000&T:当前矿洞已满，请前往别的矿洞|"),!1):!0},e}(BaseEuiView);__reflect(MineChoseWorkerWin.prototype,"MineChoseWorkerWin"),window.MineChoseWorkerWin=MineChoseWorkerWin,ViewManager.ins().reg(MineChoseWorkerWin,LayerManager.UI_Main);var MineDoneRecordRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="DoneRecordItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.name,i=this.data.win,s=GlobalConfig.KuangYuanConfig[Mine.ins().finishedData.configID],n=s.color;i?this.des0.textFlow=TextFlowMaker.generateTextFlow1(e+"掠夺了我的|C:"+n+"&T:"+s.name+"|"):this.des0.textFlow=TextFlowMaker.generateTextFlow1(e+"掠夺我的|C:"+n+"&T:"+s.name+"|失败")},e}(BaseItemRender);__reflect(MineDoneRecordRender.prototype,"MineDoneRecordRender"),window.MineDoneRecordRender=MineDoneRecordRender;var MinePanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this.go,this.onTap),this.observe(Mine.ins().postRedPoint,this.updateRedPoint),this.update()},e.prototype.update=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0,e=GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t,i=Mine.ins().mineCount;this.workNum.text="挖掘次数："+(e-i)+"/"+e;var s=GlobalConfig.CaiKuangConfig.maxRobCount,n=Mine.ins().robCount;this.plunderNum.text="掠夺次数："+(s-n)+"/"+s,this.redPoint.visible=Mine.redpointCheck()},e.prototype.updateRedPoint=function(t){this.redPoint.visible=!!t},e.prototype.onTap=function(t){return 1==KfArenaSys.ins().macthState?void TipsCT.ins().showTips("跨服竞技场匹配中暂不能操作"):void(FbCT.ins().checkInFB()||Mine.ins().sendIntoMine())},e}(BaseView);__reflect(MinePanel.prototype,"MinePanel"),window.MinePanel=MinePanel;var MineRecordRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlunderRecordItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;if(e){var i=GlobalConfig.KuangYuanConfig[e.configID],s=i.color;this.time.text=DateUtils.getFormatBySecond(e.time/1e3>>0,DateUtils.TIME_FORMAT_2),this.done.visible=this.help.visible=this.revenge.visible=!1,this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.help.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),e.type==MineRecord.TYPE_BEROB?e.fighterIsWin?(this.des.textFlow=TextFlowMaker.generateTextFlow1("|C:0x18a5eb&T:"+e.fighterName+"|掠夺了我的|C:"+s+"&T:"+i.name+"|"),e.isBeatHim>0?(this.done.visible=!0,this.done.text="已复仇",this.revenge.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.help.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)):e.waitTimes>0?(this.done.visible=!0,this.done.text="请求帮助中..."+e.waitTimes):(this.help.visible=this.revenge.visible=!0,this.help.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.revenge.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this))):this.des.textFlow=TextFlowMaker.generateTextFlow1("|C:0x18a5eb&T:"+e.fighterName+"|掠夺我的|C:"+s+"&T:"+i.name+"|失败"):e.robIsWin?this.des.textFlow=TextFlowMaker.generateTextFlow1("我成功掠夺了|C:0x18a5eb&T:"+e.robMasterName+"|的|C:"+s+"&T:"+i.name+"|"):this.des.textFlow=TextFlowMaker.generateTextFlow1("我掠夺|C:0x18a5eb&T:"+e.robMasterName+"|的|C:"+s+"&T:"+i.name+"|失败")}},e.prototype.onTap=function(){ViewManager.ins().open(MineRobWin,this.data)},e.prototype.onClick=function(){var t=this;this.revenge.touchEnabled=!1;var e=this.data,i=GlobalConfig.KuangYuanConfig[e.configID],s=i.color,n="|C:0x18a5eb&T:"+e.fighterName+"|掠夺了我的|C:"+s+"&T:"+i.name+"|，请各路大侠帮我报仇雪恨！";if(e.waitTimes>0)return void TipsCT.ins().showTips(e.waitTimes+"秒后才能进行邀请");var o="|C:0x16B2FF&T:"+Actor.myName+"|："+n+"|E:8,"+Actor.actorID+","+e.fighterActorID+","+e.index+","+e.configID+","+e.isBeatHim+",&U:&C:65280&T:点击协助";Mine.ins().helpInfo=o,Mine.ins().sendCaveHelp(o,e.index),TipsCT.ins().showTips("协助信息已发送"),Timer.start(3e3,1,function(){t.revenge.touchEnabled=!0},this)},e}(BaseItemRender);__reflect(MineRecordRender.prototype,"MineRecordRender"),window.MineRecordRender=MineRecordRender;var MineRecordWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlunderRecordSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.record.itemRenderer=MineRecordRender,this.record.dataProvider=this.listDP=new eui.ArrayCollection},e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.observe(Mine.ins().postMineRecord,this.update),Mine.ins().sendGetRecord(),this.update(),Timer.has(this.update,this)||Timer.start(1e3,0,this.update,this)},e.prototype.update=function(){this.listDP.replaceAll(Mine.ins().mineRecords)},e.prototype.onTap=function(){ViewManager.ins().close(this)},e.prototype.close=function(){Timer.stop(this.update,this)},e}(BaseEuiView);__reflect(MineRecordWin.prototype,"MineRecordWin"),window.MineRecordWin=MineRecordWin,ViewManager.ins().reg(MineRecordWin,LayerManager.UI_Popup);var MineRobWin=function(t){function e(){var e=t.call(this)||this;return e._stateIndex=0,e._states=["plunder","revenge","done"],e.skinName="HandleSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.robaward.itemRenderer=ItemBase,this.awardList.itemRenderer=ItemBase,this.recordList.itemRenderer=MineDoneRecordRender,this.addTouchEvent(this.handleBtn,this.onTap),this.addTouchEvent(this["double"],this.onTap)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(Mine.ins().postRoleInfo,this.updateInfo),this._data=t[0],this.update()},e.prototype.updateInfo=function(t){0==this._stateIndex?this.power.text=""+t:1==this._stateIndex&&(this.enemyPower.text=""+t)},e.prototype.update=function(){this._data instanceof MineRecord?(this._stateIndex=1,Mine.ins().sendGetRolePower(this._data.fighterActorID)):this._data instanceof MineModel?(this._stateIndex=0,Mine.ins().sendGetRolePower(this._data.actorID)):this._stateIndex=2,this.currentState=this._states[this._stateIndex];var t=GlobalConfig.KuangYuanConfig[this._data.configID];if(0==this._stateIndex){var e=this._data;this.Title.textColor=t.color,this.Title.text=t.name+"（可掠夺）",this.owner.text=e.name,this.power.text=e.power+"",this.gang.text=e.guildName||"无";var i=GlobalConfig.CaiKuangConfig.maxRobCount;this.workNum.text="剩余次数："+(i-Mine.ins().robCount)+"/"+i,this.awardList.dataProvider=new eui.ArrayCollection(this.getAward(t))}else if(1==this._stateIndex){var e=this._data;this.enemy.text=e.fighterName,this.enemyPower.text=e.fighterPower+"",this.myFace0.source="head_"+e.fighterJob+e.fighterSex,this.time.text=DateUtils.getFormatBySecond(e.time/1e3>>0,DateUtils.TIME_FORMAT_2),this.robaward.dataProvider=new eui.ArrayCollection(this.getAward(t))}else{this.getAwardTxt(t);var s=GlobalConfig.NpcBaseConfig[t.npcId];this.worker.source=s.icon,this.nameTxt.text=t.name,this.nameTxt.textColor=t.color,this.cost.text=GlobalConfig.CaiKuangConfig.doubleCost+"",Mine.ins().finishedData.beRob.length?this.noRob.visible=!1:this.noRob.visible=!0,this.recordList.dataProvider=new eui.ArrayCollection(Mine.ins().finishedData.beRob)}},e.prototype.getAward=function(t){var e=GameServer.serverOpenDay+1,i=1;for(var s in t.rewards)e>=+s&&(i=+s);for(var n=t.rewards[i],o=[],a=t.robPrecent,s=0;s<n.length;s++){var r=new RewardData;r.type=n[s].type,r.id=n[s].id,r.count=Math.ceil(n[s].count*a/100),o.push(r)}return o},e.prototype.getAwardTxt=function(t){var e=GameServer.serverOpenDay+1,i=1;for(var s in t.rewards)e>=+s&&(i=+s);var n=[].concat(t.rewards[i]);t.rewardItem&&t.rewardItem[i]&&(n=n.concat(t.rewardItem[i]));for(var o=0,a=0,r=Mine.ins().finishedData.beRob;a<r.length;a++){var l=r[a];l.win&&(o+=1)}for(var h="",p="",s=0;s<n.length;s++){if(0==n[s].type)h+=RewardData.getCurrencyName(n[s].id);else{var u=GlobalConfig.ItemConfig[n[s].id];h+=u.name}if(h+="x"+n[s].count+"\n",o&&s<t.rewards.length){var d=Math.ceil(n[s].count*t.robPrecent/100)*o;p+="-"+d+"\n"}}this.reward.text=h,this.minus.text=p},e.prototype.onTap=function(t){var i=this,s=t.currentTarget;if(s==this.bgClose)2!=this._stateIndex&&ViewManager.ins().close(this);else if(s==this.handleBtn){if(1==this._stateIndex){if(!KfArenaSys.ins().checkIsMatching())return;var n=window.h5gamecn;urlParam.smsg&&n&&n.sendSocialMsg&&RES.getResByUrl("https://ltm.fenzhihuyu.cn/master/service/getOpenid.jsp?actorid="+this._data.fighterActorID+"&serverid="+urlParam.srvid,function(t){"success"==t.result?n.sendSocialMsg({type:3,frd:t.openid,content:"你竟然敢动我的矿，准备迎接我复仇的怒火吧！",callback:function(){console.log("玩吧复仇消息回调")}}):console.error(t.result,t.resultMsg)},this,"json"),Mine.ins().sendFightBack(this._data.index),MineFight.ins().start({type:1,id:this._data.configID,index:this._data.index})}else if(0==this._stateIndex){if(!KfArenaSys.ins().checkIsMatching())return;if(!e.openCheck(this._data))return;Mine.ins().sendRob(this._data)}else Mine.ins().sendGetAward(),ViewManager.ins().close(HandleTipsWin);ViewManager.ins().close(this),ViewManager.ins().close(MineRecordWin)}else if(s==this["double"]){if(Actor.yb<GlobalConfig.CaiKuangConfig.doubleCost)return void TipsCT.ins().showTips("元宝不足",function(){ViewManager.ins().close(i),FbCT.ins().sendExitFb()});Mine.ins().sendGetAward(!0),ViewManager.ins().close(this),ViewManager.ins().close(MineRecordWin),ViewManager.ins().close(HandleTipsWin)}},e.prototype.close=function(){},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];if(i instanceof MineModel){if(i.actorID==Actor.actorID)return!1;if(Mine.ins().robCount>=GlobalConfig.CaiKuangConfig.maxRobCount)return TipsCT.ins().showCenterTips("|C:0xff0000&T:今日掠夺次数已用完|"),!1;if(i.beFightActorID.indexOf(Actor.actorID)>=0)return TipsCT.ins().showCenterTips("|C:0xff0000&T:当前矿工已被自己掠夺过|"),!1;if(!MineData.ins().getMineByIndex(i.index,i.actorID))return TipsCT.ins().showCenterTips("矿工已消失"),!1;if(i.beFightActorID.length>=GlobalConfig.CaiKuangConfig.maxBeRobCount)return TipsCT.ins().showCenterTips("当前矿工已被掠夺完"),!1;if(i.isBeFight)return TipsCT.ins().showCenterTips("当前矿工正在被别人掠夺"),!1}return!0},e}(BaseEuiView);__reflect(MineRobWin.prototype,"MineRobWin"),window.MineRobWin=MineRobWin,ViewManager.ins().reg(MineRobWin,LayerManager.UI_Popup);var MineScenePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="WaKuangFbSkin",e}return __extends(e,t),e.prototype.open=function(){this.quickFinish.textFlow=[{text:"快速完成",style:{underline:!0}}],this.addTouchEvent(this.quickFinish,this.onTap),this.addTouchEvent(this.xiangqing,this.onTap),this.addTouchEvent(this.wakuang,this.onTap),this.observe(Mine.ins().postMineBaseInfo,this.updateBase),this.observe(Mine.ins().postInitScene,this.updateScene),this.observe(Mine.ins().postSceneUpdate,this.updateScene),this.observe(Mine.ins().postRecordHasUpdate,this.recordHasUpdate),this.observe(Mine.ins().postMineRecord,this.recordHasUpdate),this.observe(Mine.ins().postMineFightState,this.updateScene),this.observe(Mine.ins().postStartMine,this.MineRedPoint),this.observe(Mine.ins().postFinished,this.MineRedPoint),this.updateScene()},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.quickFinish?this.openQuick():e==this.xiangqing?ViewManager.ins().open(MineRecordWin):e==this.wakuang&&ViewManager.ins().open(MineChoseWorkerWin)},e.prototype.openQuick=function(){var t=Math.floor((1e3*this._totalTime+Mine.ins().mineStartTime-GameServer.serverTime)/1e3),e=Math.ceil(t/60),i=GlobalConfig.CaiKuangConfig.quickCost*e;if(!(0>=i)){if(Actor.yb<i)return void TipsCT.ins().showTips("元宝不足");var s="确定消耗<font color='#FFB82A'>"+i+"元宝</font>快速完成挖矿？";WarnWin.show(s,function(){Mine.ins().sendQuickFinish()},this)}},e.prototype.updateBase=function(){var t=MineData.ins().myMine;if(MineFight.ins().isFighting?this.recordGroup.visible=!1:this.recordGroup.visible=!0,this.wakuangGroup.visible=this.recordGroup.visible,!Mine.ins().isOverTime()&&t){this.myGroup.visible=!0;var e=GlobalConfig.KuangYuanConfig[t.configID];this._totalTime=e.needTime,this.addTime()}else this.removeTime(),this.myGroup.visible=!1},e.prototype.updateScene=function(){var t=MineData.ins();this.nameTxt.text="中州矿洞"+t.index,this.workerNum.text="矿工："+t.mines.length+"人",this.recordHasUpdate(Mine.ins().hasNewRecord),this.MineRedPoint(),this.updateBase()},e.prototype.recordHasUpdate=function(t){this.redPoint.visible=!!t},e.prototype.MineRedPoint=function(){var t=Recharge.ins().franchise?GlobalConfig.PrivilegeData.addKuangCount:0;this.redPoint1.visible=Mine.ins().mineCount<GlobalConfig.CaiKuangConfig.maxOpenKuangCount+t&&Mine.ins().isOverTime()},e.prototype.addTime=function(){Timer.has(this.timeHandler,this)||Timer.start(1e3,0,this.timeHandler,this)},e.prototype.timeHandler=function(){var t=Math.floor((Mine.ins().mineEndTime-GameServer.serverTime)/1e3);t>=0&&(this.time.text="（"+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3)+"）")},e.prototype.removeTime=function(){Timer.stop(this.timeHandler,this)},e}(BaseEuiView);__reflect(MineScenePanel.prototype,"MineScenePanel"),window.MineScenePanel=MineScenePanel,ViewManager.ins().reg(MineScenePanel,LayerManager.UI_Main);var MoJianCT=function(t){function e(){var e=t.call(this)||this;return e.taskID=0,e.taskProgress=0,e.firstRec=!0,e.sysId=PackageID.MoJian,e.regNetMsg(1,e.postTask),e.regNetMsg(3,e.postRoleDatas),e.regNetMsg(4,e.postPoolDatas),e.regNetMsg(5,e.postAction),e.regNetMsg(6,e.postLevelUp),e.regNetMsg(7,e.postSkillId),e.regNetMsg(8,e.postItemPuton),e.regNetMsg(9,e.postMerge),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postTask=function(t){this.taskID=t.readInt(),this.taskProgress=t.readInt(),this.taskState=t.readInt(),1!=this.taskState||this.firstRec||ViewManager.ins().open(MoJianTaskRewardWin,{itemID:GlobalConfig.MoJianTask[this.taskID].itemId,des:"恭喜获得"}),this.firstRec=!1},e.prototype.sendTaskEvent=function(){this.sendBaseProto(2)},e.prototype.postRoleDatas=function(t){if(this.taskState!=e.STATE_COMPLETE){var i=Object.keys(GlobalConfig.MoJianTask).length,s=GlobalConfig.MoJianTask[i];this.taskID=s.taskIdx,this.taskState=DemonCir.STATE_COMPLETE}var n=t.readInt();this.roleMoJianData||(this.roleMoJianData=[]),this.roleMoJianData.length=n;for(var o=0;n>o;o++){var a=this.roleMoJianData[o];a?a.parser(t):(a=new MoJianRoleData(t),this.roleMoJianData[a.roleID]=a)}this.postChangePower()},e.prototype.sendPoolDatas=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.postPoolDatas=function(t){var e=t.readUnsignedByte(),i=this.getRoleMoJianDataByID(e);if(this.postChangePower(),i){var s=i.poolLv;return i.poolLv=t.readUnsignedInt(),i.poolStage=t.readUnsignedInt(),i.poolLv>s?1:0}},e.prototype.sendAction=function(t,e){var i=this.getBytes(5);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postAction=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=this.getRoleMoJianDataByID(e),n=this.getMoJianData(e,i);return t.position--,n?n.parser(t):n=new MoJianData(t),s.moJianData[i-1]=n,this.postChangePower(),i},e.prototype.sendLevelUp=function(t,e){var i=this.getBytes(6);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postLevelUp=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=this.getMoJianData(e,i);s.level=t.readUnsignedInt(),this.postChangePower()},e.prototype.sendSkillId=function(t,e,i){var s=this.getBytes(7);s.writeByte(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postSkillId=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=this.getMoJianData(e,i);s.moJianSkill=t.readUnsignedByte()},e.prototype.sendItemPuton=function(t,e,i,s){var n=this.getBytes(8);n.writeByte(t),n.writeByte(e),n.writeInt(i),n.writeByte(s),this.sendToServer(n)},e.prototype.postItemPuton=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=this.getMoJianData(e,i);s.setItemIdByPos(t.readUnsignedInt(),t.readUnsignedByte()),this.postChangePower()},e.prototype.sendMerge=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postMerge=function(t){for(var e=t.readUnsignedShort(),i=0;e>i;i++)return t.readUnsignedInt();return 0},e.prototype.postChangePower=function(){},e.prototype.checkOpen=function(){return ZsCT.ins().lv<GlobalConfig.MoJianSysConf.openzhuanshenglv?!1:!(GameServer.serverOpenDay<GlobalConfig.MoJianSysConf.openserverday-1)},e.prototype.checkActived=function(){var t=CommonUtils.getObjectLength(GlobalConfig.MoJianTask),e=GlobalConfig.MoJianTask[t];return this.checkOpen()?this.taskID<e.taskIdx?!1:this.taskState==DemonCir.STATE_COMPLETE:!1},e.prototype.getRoleMoJianDataByID=function(t){return this.roleMoJianData&&this.roleMoJianData.length?this.roleMoJianData[t]:null},e.prototype.getMoJianData=function(t,e){var i=this.getRoleMoJianDataByID(t);return i?i.getMoJianDatabById(e):null},e.MoJianItemTips=function(t,i,s,n){void 0===i&&(i=null),void 0===s&&(s=0),void 0===n&&(n=!1);var o=GlobalConfig.MoJianEquip[t];if(o){var a=i?i.getMoJianDatabById(s):null,r=o.level,l=BagCT.getAttrPower(o.attrs),h=o.level?""+GlobalConfig.MoJianSysConf.lvNames[r-1]:"无级别",p={left:"部位:\n等级:",right:GlobalConfig.MoJianSysConf.equipPosNames[o.pos-1]+"\n"+h},u=[];u.push({title:"基础属性:",attr:o.attrs});var d=GlobalConfig.MoJianEquipStarSuitConf[r];if(d){for(var c=0,f="",g=GlobalConfig.MoJianSysConf.equipPosNames.length,y=0;g>y;y++){var v=a?a.getItemIdByPos(y+1):0,m=v>0?GlobalConfig.MoJianEquip[v].level:0,T=m>=r?65280:16711680,C="|C:"+T+"&T:"+GlobalConfig.MoJianSysConf.equipPosNames[y];g>y+1&&(C+=" "),f+=C,m>=r&&c++}var I="";for(var y in d){var w=c>=d[y].count,T=w?65280:16711680,b=(w?d[y].count:c)+"/"+d[y].count;if(d[y].attrs&&(I+="|C:"+T+"&T:("+b+") "+AttributeData.getAttStr(d[y].attrs,4,1,"：")),d[y].skill){var S=d[y].skill[0];I+="\n",I+=1==S.id?"|C:"+T+"&T:("+b+") 魔剑之力触发概率上升"+S.trigger/100+"%":"|C:"+T+"&T:("+b+") 魔剑反噬触发概率降低"+S.trigger/100+"%"}}u.push({title:"|C:0xe27dff&T:"+GlobalConfig.MoJianSysConf.lvNames[r-1]+" • 五行融汇|",attr:[],colorName:0,colorValue:0,others:{suitdesc:f,exdesc:I}})}ViewManager.ins().open(EquipTipsBase,BagCT.BAG_TYPE_OTHTER,t,l,l,p,u,n?function(){e.ins().sendItemPuton(i.roleID,s,0,o.pos)}:null,"卸 下")}},e.isMoJian=function(t){for(var e in GlobalConfig.MoJianBase)if(GlobalConfig.MoJianBase[e].actItem.id==t)return!0;return!1},e.POS_MAX=5,e.STATE_TASK=0,e.STATE_CAN_GET=1,e.STATE_GOT=2,e.STATE_COMPLETE=3,__decorate([post()],e.prototype,"postTask",null),__decorate([post()],e.prototype,"postRoleDatas",null),__decorate([post()],e.prototype,"postPoolDatas",null),__decorate([post()],e.prototype,"postAction",null),__decorate([post()],e.prototype,"postLevelUp",null),__decorate([post()],e.prototype,"postSkillId",null),__decorate([post()],e.prototype,"postItemPuton",null),__decorate([post()],e.prototype,"postMerge",null),__decorate([post()],e.prototype,"postChangePower",null),e}(BaseSystem);__reflect(MoJianCT.prototype,"MoJianCT"),System.MoJianCT=function(){return MoJianCT.ins()},window.MoJianCT=MoJianCT;var MoJianFBCT=function(t){function e(){var e=t.call(this)||this;return e.count=0,e.haveReward=0,e.sysId=PackageID.Guanqia,e.regNetMsg(44,e.fbInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.checkOpen=function(t){var e=GlobalConfig.MoJianFubenBaseConfig,i=e.openZsLevel,s=e.openDay,n="";return GameServer.serverOpenDay+1<s&&(n="开服"+s+"天"),ZsCT.ins().lv<i&&(n&&(n+="并"),n+="达到"+i+"转开启"),t&&n&&TipsCT.ins().showTips(n),!n},e.prototype.fbInfo=function(t){this.count=t.readByte(),this.haveReward=t.readByte()},e.prototype.sendEnter=function(){this.sendBaseProto(44)},e.prototype.sendGet=function(t){var e=this.getBytes(45);e.writeByte(t),this.sendToServer(e)},__decorate([post()],e.prototype,"fbInfo",null),e}(BaseSystem);__reflect(MoJianFBCT.prototype,"MoJianFBCT"),System.MoJianFBCT=function(){return MoJianFBCT.ins()},window.MoJianFBCT=MoJianFBCT;var MoJianFBRP=function(t){function e(){var e=t.call(this)||this;return e.rp=!1,e.associated(e.postRP,MoJianFBCT.ins().fbInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRP=function(){var t=this.rp,e=MoJianFBCT.ins(),i=e.count,s=e.haveReward;return this.rp=MoJianFBCT.checkOpen()&&(!!i||!!s),t!=this.rp},__decorate([post()],e.prototype,"postRP",null),e}(BaseSystem);__reflect(MoJianFBRP.prototype,"MoJianFBRP"),System.MoJianFBRP=function(){return MoJianFBRP.ins()},window.MoJianFBRP=MoJianFBRP;var MoJianRedPoint=function(t){function e(){var e=t.call(this)||this;return e.taskPoint=!1,e.roleTabs=[],e.poolPoint=[],e.jianActPoint=[],e.jianPoint=[],e.jianItemPoint=[],e.associated(e.postRedPoint,e.postTaskPoint,e.postRoleRedPoint),e.associated(e.postTaskPoint,MoJianCT.ins().postTask,MoJianCT.ins().postRoleDatas,ZsCT.ins().postZsData),e.associated(e.postRoleRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,MoJianCT.ins().postRoleDatas,MoJianCT.ins().postPoolDatas,MoJianCT.ins().postAction,MoJianCT.ins().postLevelUp),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postTaskPoint=function(){this.taskPoint=MoJianCT.ins().checkOpen()&&(0==MoJianCT.ins().taskID||1==MoJianCT.ins().taskState)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=this.taskPoint;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.postPoolPoint(t),s=this.postJianPoint(t);this.postJianItemPoint(t);var n=this.postJianActPoint(t);this.roleTabs[t]=this.poolPoint[t]||i||s||n}else this.roleTabs[t]=!1}return!0},e.prototype.postPoolPoint=function(t){if(this.poolPoint[t]=!1,!MoJianCT.ins().checkActived())return!1;var e=!1,i=MoJianCT.ins().getRoleMoJianDataByID(t),s=GlobalConfig.JianChiLeveL[i.poolStage][i.poolLv+1];if(s||GlobalConfig.JianChiLeveL[i.poolStage+1]&&(s=GlobalConfig.JianChiLeveL[i.poolStage+1][0]),s){var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.MoJianSysConf.expItemId);n>=s.cost&&(this.poolPoint[t]=e=!0)}return e},e.prototype.postJianPoint=function(t){if(this.jianPoint[t]=[],!MoJianCT.ins().checkActived())return!1;for(var e=!1,i=MoJianCT.ins().getRoleMoJianDataByID(t),s=GlobalConfig.MoJjianLevel,n=0;n<i.moJianData.length;n++){var o=i.moJianData[n];if(o){var a=s[o.id][o.level+1];if(a&&i.poolStage>=a.jianchiLimit){var r=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,a.count.id);r>=a.count.count&&(e=!0),this.jianPoint[t][o.id]=r>=a.count.count}else this.jianPoint[t][o.id]=!1}}return e},e.prototype.postJianItemPoint=function(t){if(this.jianItemPoint[t]=[],!MoJianCT.ins().checkActived())return!1;for(var e=!1,i=MoJianCT.ins().getRoleMoJianDataByID(t),s=(GlobalConfig.MoJjianLevel,[]),n=1;n<=MoJianCT.POS_MAX;n++){var o=BagCT.ins().getMoJianItemsByPos(n);s.push(o.length>0?o[0].configID:0)}for(var n=0;n<i.moJianData.length;n++){var a=i.moJianData[n];if(this.jianItemPoint[t][n+1]=!1,a)for(var r=1;r<=MoJianCT.POS_MAX;r++){var l=GlobalConfig.MoJianSysConf.equipOpen[r-1],h=a.getItemIdByPos(r);if(i.poolStage>=l&&s[r-1]>h){this.jianItemPoint[t][a.id]=!0,e=!0;break}}}return e},e.prototype.postJianActPoint=function(t){if(this.jianActPoint[t]=[],!MoJianCT.ins().checkActived())return!1;var e=!1;for(var i in GlobalConfig.MoJianBase){var s=GlobalConfig.MoJianBase[i],n=s.id,o=MoJianCT.ins().getMoJianData(t,n);if(o)this.jianActPoint[t][n]=!1;else{var a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.actItem.id);this.jianActPoint[t][n]=a>=s.actItem.count,a>=s.actItem.count&&(e=!0)}}return e},__decorate([post()],e.prototype,"postTaskPoint",null),__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postPoolPoint",null),__decorate([post()],e.prototype,"postJianPoint",null),__decorate([post()],e.prototype,"postJianItemPoint",null),__decorate([post()],e.prototype,"postJianActPoint",null),e}(BaseSystem);__reflect(MoJianRedPoint.prototype,"MoJianRedPoint"),System.MoJianRedPoint=function(){return MoJianRedPoint.ins()
},window.MoJianRedPoint=MoJianRedPoint;var MojianEquipIcon=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.betterItemId=0,e}return __extends(e,t),e.prototype.setPos=function(t){this.pos=t},e.prototype.skinComplete=function(){this.touchChildren=!1,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){},e.prototype.onClick=function(t){this.betterItemId>0?this.eOpenTip.visible?TipsCT.ins().showTips(this.eOpenTip.text):MoJianCT.ins().sendItemPuton(this.roleId,this.jianId,this.betterItemId,this.pos):MoJianCT.MoJianItemTips(this.itemId,this.moJianRoleData,this.jianId,0!=this.itemId)},e.prototype.update=function(t,e){this.jianId=e,this.moJianRoleData=t,this.roleId=t.roleID;var i=t.getMoJianDatabById(e);this.itemId=i.getItemIdByPos(this.pos);var s=BagCT.ins().getMoJianItemsByPos(this.pos);if(this.betterItemId=s.length>0&&s[0].configID>this.itemId?s[0].configID:0,0==this.itemId){this.eItemIcon.source="mojian_zbwx"+this.pos+"_png";var n=GlobalConfig.MoJianSysConf.equipOpen[this.pos-1];this.eOpenTip.visible=t.poolStage<n,this.eOpenTip.text="剑池"+n+"阶开启",this.eAddImg.visible=!this.eOpenTip.visible&&s.length>0}else this.eItemIcon.source=this.itemId+"_png",this.eOpenTip.visible=!1,this.eAddImg.visible=!1;this.redPoint.visible=!this.eOpenTip.visible&&s.length>0&&s[0].configID>this.itemId},e}(BaseView);__reflect(MojianEquipIcon.prototype,"MojianEquipIcon"),window.MojianEquipIcon=MojianEquipIcon;var MoJianFbPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mj=MoJianFBCT.ins(),e.cfg=GlobalConfig.MoJianFubenBaseConfig,e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.items=[this.itemIcon,this.itemIcon0,this.itemIcon1],this.names=[this.eName,this.eName0,this.eName1],this.golds=[this.gold0,this.gold1,this.gold2],this.btnGets=[this.btnGet0,this.btnGet1,this.btnGet2],this.btnSD.visible=!1,this.addTouchEvent(this.btnChallenge,function(){return t.mj.sendEnter()});var e=function(e){i.addTouchEvent(i.btnGets[e],function(){GlobalFun.checkMoney(t.cfg.recPrice[e])&&t.mj.sendGet(+e+1)});var s=GlobalConfig.ItemConfig[i.cfg.recItem[e]];i.addTouchEvent(i.items[e],function(){ViewManager.ins().open(ItemDetailedWin,0,s.id)}),i.items[e].setData(s),i.names[e].text=s.name,i.names[e].textColor=ItemUtil.getQualityColor(s),i.golds[e].setPrice(i.cfg.recPrice[e]),0==+e&&(i.lbFree.visible=!i.cfg.recPrice[e],i.golds[e].visible=!i.lbFree.visible)},i=this;for(var s in this.items)e(s)},e.prototype.addDisplay=function(){this.observe(this.mj.fbInfo,this.updateInfo,!0)},e.prototype.updateInfo=function(){this.eGift.visible=!!this.mj.haveReward,this.lbTime.text="  "+this.mj.count,this.btnChallenge.enabled=!!this.mj.count},e}(BaseView);__reflect(MoJianFbPanel.prototype,"MoJianFbPanel"),window.MoJianFbPanel=MoJianFbPanel;var MoJianHeChengWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.leftItemId=0,e.rightItemId=0,e._sn_="Mojianhecheng",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.list,this.onSelect),this.list.itemRenderer=ItemBaseNoTap,this.bagListDt=new eui.ArrayCollection,this.list.dataProvider=this.bagListDt,this.itemList0.itemRenderer=ItemBase,this.eScroller.touchEnabled=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(MoJianCT.ins().postMerge,this.onResult),this.update()},e.prototype.onResult=function(t){t&&0!=t&&(this.leftItemId=this.rightItemId=0,this.eLeftName.text="",this.eRightName.text="",this.update(),this.eResultIcon.source=t+"_png",this.eResultName.text=GlobalConfig.ItemConfig[t].name)},e.prototype.onSelect=function(t){if(t&&t.item){var e=t.item;this.putOn(e.configID)}},e.prototype.putOn=function(t){for(var e in this.bagItems)if(this.bagItems[e].configID==t&&this.bagItems[e].count<=0)return;if(0==this.leftItemId)this.leftItemId=t,this.eLeftName.text=GlobalConfig.ItemConfig[t].name;else{if(0!=this.rightItemId)return;this.rightItemId=t,this.eRightName.text=GlobalConfig.ItemConfig[t].name}this.updateResultList(),this.updateBagItem(),this.updateItemIcon()},e.prototype.putDown=function(t){t?(this.leftItemId=0,this.eLeftIcon.source="tongyongadd2",this.eLeftName.text=""):(this.rightItemId=0,this.eRightIcon.source="tongyongadd2",this.eRightName.text=""),this.updateBagItem(),this.updateResultList()},e.prototype.updateItemIcon=function(){this.eLeftIcon.source=0==this.leftItemId?"tongyongadd2":this.leftItemId+"_png",this.eRightIcon.source=0==this.rightItemId?"tongyongadd2":this.rightItemId+"_png",this.eResultIcon.source="gwmix_random",this.eResultName.text="随机物品"},e.prototype.update=function(){this.updateBagItem(),this.updateItemIcon(),this.updateResultList()},e.prototype.updateBagItem=function(){if(0==this.leftItemId&&0==this.rightItemId)this.bagItems=BagCT.ins().getMoJianItems();else{var t=Math.max(this.leftItemId,this.rightItemId),e=GlobalConfig.MoJianEquip[t].level,i=BagCT.ins().getMoJianItemsByLv(e);this.bagItems=[];for(var s in i)this.bagItems.push(i[s].copy());for(var s=this.bagItems.length-1;s>=0;s--)this.bagItems[s].configID==this.leftItemId&&this.bagItems[s].count--,this.bagItems[s].configID==this.rightItemId&&this.bagItems[s].count--,this.bagItems[s].count<=0&&this.bagItems.splice(s,1)}this.noItemDesc.visible=0==this.bagItems.length,this.bagListDt.source=this.bagItems,this.list.scrollH=0,this.onChange()},e.prototype.updateResultList=function(){if(this.eResultGroup.visible=0!=this.leftItemId&&0!=this.rightItemId,0!=this.leftItemId&&0!=this.rightItemId){var t=Math.max(this.leftItemId,this.rightItemId),e=GlobalConfig.MoJianEquip[t].level,i=GlobalConfig.MoJianFusionConfig[e];this.itemList0.dataProvider=new eui.ArrayCollection(i.showItems)}},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.eLeftGroup:case this.eRightGroup:this.putDown(t.target==this.eLeftGroup);break;case this.upBtn:0==this.leftItemId||0==this.rightItemId?TipsCT.ins().showTips("材料不足"):MoJianCT.ins().sendMerge(this.leftItemId,this.rightItemId);break;case this.leftButton:this.onLeft();break;case this.rightButton:this.onRight()}},e.prototype.onLeft=function(){var t=96,e=0;e=this.list.scrollH-t,e=96*Math.round(e/96),0>e&&(e=0),this.list.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=96,e=0;e=this.list.scrollH+t,e=96*Math.round(e/96),e>this.bagListDt.length*t-5*t&&(e=this.bagListDt.length*t-5*t),this.list.scrollH=e,this.onChange()},e.prototype.onChange=function(){var t=96;this.leftButton.visible=this.list.scrollH>0,this.rightButton.visible=this.list.scrollH<(this.bagListDt.length-5)*t},__decorate([callLater],e.prototype,"onResult",null),e}(BaseEuiView);__reflect(MoJianHeChengWin.prototype,"MoJianHeChengWin"),window.MoJianHeChengWin=MoJianHeChengWin,ViewManager.ins().reg(MoJianHeChengWin,LayerManager.UI_Main);var MoJianIcon=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof Array){this.moJianId=this.data[0],this.roleId=this.data[1],this.select.visible=this.selected,this.icon.source="mojian_tb"+this.moJianId+"_png";var t=MoJianCT.ins().getRoleMoJianDataByID(this.roleId);this.state.visible=t?!t.getMoJianDatabById(this.moJianId):!0,this.icon.filters=this.state.visible?FilterUtil.ARRAY_GRAY_FILTER:[],this.setRed(!1)}},e.prototype.setSelect=function(t){this.select.visible=t},e.prototype.setRed=function(t){this.redPoint.visible=t},e}(BaseItemRender);__reflect(MoJianIcon.prototype,"MoJianIcon"),window.MoJianIcon=MoJianIcon;var MojianOverViewItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MojianOverViewItem",e.eList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.lbName.text=GlobalConfig.MoJianSysConf.lvNames[t[0].level-1]+"晶魄";var e=[];for(var i in t)e.push(t[i].id);e.sort(this.sort),this.eList.dataProvider=new eui.ArrayCollection(e);var s=null;GlobalConfig.MoJianEquipStarSuitConf[t[0].level]&&(s=GlobalConfig.MoJianEquipStarSuitConf[t[0].level][5]),s?this.eDesc.text="镶嵌5件后，魔剑之力触发概率+"+s.skill[0].trigger/100+"%":this.eDesc.text="无"}},e.prototype.sort=function(t,e){return GlobalConfig.MoJianEquip[t].pos<GlobalConfig.MoJianEquip[e].pos?-1:1},e}(BaseItemRender);__reflect(MojianOverViewItemRender.prototype,"MojianOverViewItemRender"),window.MojianOverViewItemRender=MojianOverViewItemRender;var MojianOverViewWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MojianOverViewSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=MojianOverViewItemRender,this.cfgs=[];for(var t in GlobalConfig.MoJianEquip){var e=GlobalConfig.MoJianEquip[t],i=e.level-1;this.cfgs[i]||(this.cfgs[i]=[]),this.cfgs[i].push(e)}this.cfgs.sort(this.sort),this.eList.dataProvider=new eui.ArrayCollection(this.cfgs)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e.prototype.sort=function(t,e){return t[0].level>e[0].level?-1:1},e}(BaseEuiView);__reflect(MojianOverViewWin.prototype,"MojianOverViewWin"),window.MojianOverViewWin=MojianOverViewWin,ViewManager.ins().reg(MojianOverViewWin,LayerManager.UI_Popup);var MoJianPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasEnough=!1,e.curMoJianId=0,e.curSkillId=1,e.jianMCs=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.nowAttrCenter=this.nowAttr.horizontalCenter,this.initStar(),this.link.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.link.text+"</u>");var t=new MovieClip;t.playFile(RES_DIR_EFF+"mojian_xuechi",-1),this.eXueChiGroup.addChild(t),this.curJianEff=new MovieClip,this.curJianEff.playFile(RES_DIR_EFF+"mojian_xuanze",-1),this.curJianEff.visible=!1;for(var i=1;i<=e.MAX;i++){var s=new MovieClip;this["eJianEff"+i].addChild(s),this.jianMCs.push(s)}this.eBtn.visible=this.eAttrGroup.visible=!0,this.eBtn1.visible=this.eSkillGroup.visible=!1,this.showSkill=this.eSkillGroup.visible,this.selectMoJian(1)},e.prototype.addDisplay=function(){this.observe(MoJianCT.ins().postPoolDatas,this.updateLevel),this.observe(MoJianCT.ins().postAction,this.update),this.observe(MoJianCT.ins().postSkillId,this.selectSkill),this.observe(MoJianCT.ins().postChangePower,this.updatePower),this.observe(MoJianRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updatePower(),this.updateRed()},e.prototype.updateRed=function(){if(this.skin)if(this.redPoint.visible=MoJianRedPoint.ins().poolPoint[this.curRoleId],this.showSkill)this.redPoint1.visible=this.redPoint2.visible=this.redPoint3.visible=!1;else{var t=MoJianRedPoint.ins().jianItemPoint[this.curRoleId],e=MoJianRedPoint.ins().jianPoint[this.curRoleId];this.redPoint1.visible=t&&t[1]||e&&e[1],this.redPoint2.visible=t&&t[2]||e&&e[2],this.redPoint3.visible=t&&t[3]||e&&e[3]}},e.prototype.selectMoJian=function(t){this.curMoJianId!=t&&(this.curMoJianId=t,this.curJianEff.visible=this.showSkill,DisplayUtils.removeFromParent(this.curJianEff),this["eSelectEff"+t]&&this["eSelectEff"+t].addChild(this.curJianEff),this.selectSkill())},e.prototype.selectSkill=function(t){void 0===t&&(t=0);var e=MoJianCT.ins().getMoJianData(this.curRoleId,this.curMoJianId);if(e){this.curSkillId=0==t?e.moJianSkill:t;for(var i=0;3>i;i++)this["select"+i].visible=this.curSkillId==i+1,this["eSkillBtn"+i].filters=e.moJianSkill==i+1?[]:FilterUtil.ARRAY_GRAY_FILTER;this.eSelectBtn.enabled=this.curSkillId!=e.moJianSkill}this.updateSkillUI(t)},e.prototype.onClick=function(t){switch(t.target){case this.eJian1:case this.eJian2:case this.eJian3:var e=t.target.data;if(!e)return;this.selectMoJian(e),this.showSkill||ViewManager.ins().open(MoJianUpLevelWin,e,this.curRoleId);break;case this.lvupBtn:this.hasEnough?MoJianCT.ins().sendPoolDatas(this.curRoleId):TipsCT.ins().showTips("材料不足");break;case this.link:WarnCT.ins().setBuyGoodsWarn(GlobalConfig.MoJianSysConf.expItemId,1);break;case this.eBtn:this.eBtn.visible=this.eAttrGroup.visible=!1,this.eBtn1.visible=this.eSkillGroup.visible=!0,this.showSkill=this.eSkillGroup.visible,this.curJianEff.visible=!0,this.updateRed();break;case this.eBtn1:this.eBtn.visible=this.eAttrGroup.visible=!0,this.eBtn1.visible=this.eSkillGroup.visible=!1,this.showSkill=this.eSkillGroup.visible,this.curJianEff.visible=!1,this.updateRed();break;case this.eSkillBtn0:this.selectSkill(1);break;case this.eSkillBtn1:this.selectSkill(2);break;case this.eSkillBtn2:this.selectSkill(3);break;case this.eSelectBtn:MoJianCT.ins().sendSkillId(this.curRoleId,this.curMoJianId,this.curSkillId)}},Object.defineProperty(e.prototype,"curRole",{set:function(t){this.curRoleId=t,this.update(),this.updateRed()},enumerable:!0,configurable:!0}),e.prototype.update=function(){if(this.skin){var t=MoJianCT.ins().getRoleMoJianDataByID(this.curRoleId);t&&(this.updateLevel(0),this.updateMoJian(t),this.selectSkill())}},e.prototype.updateMoJian=function(t){for(var i=1;i<=e.MAX;i++){var s=t.getMoJianDatabById(i),n=this.jianMCs[i-1];if(s)n.playFile(RES_DIR_EFF+("Mojian_wq"+s.id),-1),n.visible=!0;else{n.stop(),n.visible=!1;var o=GlobalConfig.MoJianBase[i],a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o.actItem.id);this["eJiHuo"+i].source=a>=o.actItem.count?"kejihuo":"zl_state_0"}this["eJiHuo"+i].visible=null==s,this["eJian"+i].data=i}},e.prototype.updateLevel=function(t){void 0===t&&(t=0);var e=MoJianCT.ins().getRoleMoJianDataByID(this.curRoleId);e&&(this.lv.text=TextFlowMaker.getCStr(e.poolStage)+"阶",this.updateStar(e,t),this.updateAttr(e),this.updatePower())},e.prototype.updatePower=function(){var t=MoJianCT.ins().getRoleMoJianDataByID(this.curRoleId);t?this.power.setPower(t.getPower()):this.power.setPower(0)},e.prototype.initStar=function(){this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0),this.starList.parent||this.starGroup.addChild(this.starList)},e.prototype.updateStar=function(t,e){void 0===e&&(e=0),this.starList&&t&&this.starList.setStarNum(t.poolLv,e)},e.prototype.updateAttr=function(t){if(t&&GlobalConfig.JianChiLeveL[t.poolStage]){var e=GlobalConfig.JianChiLeveL[t.poolStage];if(e){var i=e[t.poolLv],s=e[t.poolLv+1];if(!s){var n=GlobalConfig.JianChiStageConfig[t.poolStage+1];n&&(s=GlobalConfig.JianChiLeveL[t.poolStage+1][0])}var o="";for(var a in i.attr)o+=AttributeData.getAttStrByType(i.attr[a],.5,"：")+"\n";""!=o&&(this.nowAttr.text=o);var r=!s;if(r)this.nowAttr.horizontalCenter=0;else{o="";for(var a in s.attr)o+=AttributeData.getAttStrByType(s.attr[a],.5,"：")+"\n";this.nextAttr.text=o,this.nowAttr.horizontalCenter=this.nowAttrCenter;var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.MoJianSysConf.expItemId);this.hasEnough=l>=s.cost;var h=this.hasEnough?ColorUtil.GREEN:ColorUtil.RED;o='<font color="'+h+'">'+l+"</font>/"+s.cost,this.costCount.textFlow=(new egret.HtmlTextParser).parser(o),this.costImg.source=GlobalConfig.MoJianSysConf.expItemId+"_png"}this.eIsFull.visible=r,this.lvupBtn.label=10==this.starList.starNum?"升 阶":"养 剑",this.link.visible=this.eItemGroup.visible=!r&&10!=this.starList.starNum,this.lvupBtn.visible=this.arrow.visible=this.nextAttr.visible=!r}}},e.prototype.updateSkillUI=function(t){void 0===t&&(t=0);var e=MoJianCT.ins().getMoJianData(this.curRoleId,this.curMoJianId),i=GlobalConfig.MoJianBase[this.curMoJianId];if(e){this.eSkillName.text=i.skillName,this.eSkillName.textColor=16757760;for(var s=GlobalConfig.MoJjianLevel[e.id][e.level],n=0,o=0,a=0,r=0,l=0,h=0,p=void 0,u=void 0,d=0;d<s.skill.length;d++)1==s.skill[d].addType?(p=s.skill[d],n+=p.rate,r+=p.attrs[0].value):2==s.skill[d].addType&&(u=s.skill[d],o+=u.rate,h+=u.attrs[0].value);for(var c=GlobalConfig.MoJianStrategy[e.id][t>0?t:e.moJianSkill],d=0;d<c.skill.length;d++)1==c.skill[d].addType?(n=n*c.skill[d].rate/1e4,a=r*c.skill[d].attrsRate/1e4):2==c.skill[d].addType&&(o*=c.skill[d].rate/1e4,l=h*c.skill[d].attrsRate/1e4);for(var f=e.getActSuitCfgs(),d=0;d<f.length;d++)f[d].skill&&f[d].skill[0]&&(1==f[d].skill[0].id?n+=f[d].skill[0].trigger:2==f[d].skill[0].id&&(o+=f[d].skill[0].trigger));var g=i.actBuff.replace("%s",n/100+"%").replace("%d",a/100+"%").replace("%t",p.sec+""),y=i.actDebuff.replace("%s",o/100+"%").replace("%d",l/100+"%").replace("%t",u.sec+"");this.eBuffLab.textFlow=TextFlowMaker.generateTextFlow(g),this.eDebuffLab.textFlow=TextFlowMaker.generateTextFlow(y)}else this.eSkillName.text=i.skillName+"(未激活)",this.eSkillName.textColor=ColorUtil.GRAY_COLOR2,this.eBuffLab.textFlow=TextFlowMaker.generateTextFlow(i.buff),this.eDebuffLab.textFlow=TextFlowMaker.generateTextFlow(i.debuff);this.eSkillTip.visible=!e,this.eSkillBtnGroup.visible=!this.eSkillTip.visible},e.MAX=3,__decorate([callLater],e.prototype,"updateRed",null),__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateLevel",null),e}(BaseEuiView);__reflect(MoJianPanel.prototype,"MoJianPanel"),window.MoJianPanel=MoJianPanel;var MoJianTaskItemIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.taskId>0&&this.setTaskId(this.taskId)},e.prototype.setTaskId=function(t){this.taskId=t,this.skin&&(this.itemIcon.source=GlobalConfig.MoJianTask[t].itemId+"_png",this.updateTask())},e.prototype.updateTask=function(){if(this.skin){var t=MoJianCT.ins().taskID;this.taskId<t?this.doneImg.visible=!0:this.taskId==t?this.doneImg.visible=MoJianCT.ins().taskState>=MoJianCT.STATE_GOT:this.doneImg.visible=!1,this.curTask.visible=this.taskId==t,this.taskBg.visible=!this.curTask.visible}},e}(BaseView);__reflect(MoJianTaskItemIcon.prototype,"MoJianTaskItemIcon"),window.MoJianTaskItemIcon=MoJianTaskItemIcon;var MoJianTaskPanel=function(t){function e(){var e=t.call(this)||this;return e.state=0,e._sn_="MojianTaskSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(MoJianCT.ins().postTask,this.updateTask),this.observe(MoJianRedPoint.ins().postTaskPoint,this.updateRed),this.addTouchEvent(this,this.onTouch),this.updateTask(),this.step1.setTaskId(1),this.step2.setTaskId(2),this.step3.setTaskId(3)},e.prototype.removeDisplay=function(){},e.prototype.updateRed=function(){this.redPoint.visible=MoJianRedPoint.ins().taskPoint},e.prototype.updateTask=function(){var t,i,s,n,o=MoJianCT.ins().taskID,a=GlobalConfig.MoJianTask[0==o?1:o],r=GlobalConfig.ItemConfig[a.itemId].name;if(0==o)t=a.taskRequire1,i=a.taskInfo1,s="",n="查看密语",this.state=e.PHASE1;else{var l=MoJianCT.ins().taskState;l==MoJianCT.STATE_TASK?(t=a.taskRequire2,i=a.taskInfo2,s="需要"+r+"（|C:16711680&T:"+MoJianCT.ins().taskProgress+"|/"+a.target+"）",n="前往挑战",this.state=e.PHASE2):l==MoJianCT.STATE_CAN_GET||l==MoJianCT.STATE_GOT?(t=a.taskRequire3,i=a.taskInfo3,this.state=e.PHASE3,s="需要"+r+"（"+MoJianCT.ins().taskProgress+"/"+a.target+"）",n="献祭"):(t=a.taskRequire4,i=a.taskInfo4,s="",n="完成",this.state=e.PHASE4)}this.taskRequire.textFlow=TextFlowMaker.generateTextFlow(t),this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(i),this.taskschedule.textFlow=TextFlowMaker.generateTextFlow(s),this.goBtn.label=n,this.updateRed(),this.step1.updateTask(),this.step2.updateTask(),this.step3.updateTask()},e.prototype.onTouch=function(t){if(t.target==this.goBtn)if(this.state==e.PHASE1)MoJianCT.ins().sendTaskEvent();else if(this.state==e.PHASE2){var i=GlobalConfig.MoJianTask[MoJianCT.ins().taskID],s=i.controlTarget[2];s?ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1],s):ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1]),ViewManager.ins().close(RuneWin)}else this.state==e.PHASE3&&MoJianCT.ins().sendTaskEvent()},e.PHASE1=0,e.PHASE2=1,e.PHASE3=2,e.PHASE4=3,e}(BaseEuiView);__reflect(MoJianTaskPanel.prototype,"MoJianTaskPanel"),window.MoJianTaskPanel=MoJianTaskPanel,ViewManager.ins().reg(MoJianTaskPanel,LayerManager.UI_Main);var MoJianTaskRewardWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(DCTaskRewardWin);__reflect(MoJianTaskRewardWin.prototype,"MoJianTaskRewardWin"),ViewManager.ins().reg(MoJianTaskRewardWin,LayerManager.UI_Main),window.MoJianTaskRewardWin=MoJianTaskRewardWin;var MoJianTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MojiantipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.mc=new MovieClip,this.dress.addChild(this.mc)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ItemConfig[t[0]];return null!=i},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.update()},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.itemId];this.itemname.text=t.name;var e;for(var i in GlobalConfig.MoJianBase)GlobalConfig.MoJianBase[i].actItem.id==t.id&&(e=GlobalConfig.MoJianBase[i]);if(e){this.mc.playFile(RES_DIR_EFF+e.tipsEff,-1),this.dressName.source="mojian_mc"+e.id+"_png";var s=GlobalConfig.MoJjianLevel[e.id][1];this.powerPanel.setPower(BagCT.getAttrPower(s.attrs)+s.expower),this.description.textFlow=TextFlowMaker.generateTextFlow1(t.desc)}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(MoJianTipsWin.prototype,"MoJianTipsWin"),window.MoJianTipsWin=MoJianTipsWin,ViewManager.ins().reg(MoJianTipsWin,LayerManager.UI_Popup);var MoJianUpLevelWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actIsEnough=!1,e.lvUpIsEnough=!1,e._sn_="MojianUpLevelSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=MoJianIcon,this.addTouchEvent(this,this.onClick),this.link.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.link.text+"</u>"),this.link0.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.link0.text+"</u>"),this.jianMc=new MovieClip,this.eJianGroup2.addChild(this.jianMc),this.items=[this.eItem0,this.eItem1,this.eItem2,this.eItem3,this.eItem4];for(var t=0;t<this.items.length;t++)this.items[t].setPos(t+1);this.nowAttrLabH=this.nowAttr0.horizontalCenter},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curJianId=t[0],this.curRoleId=t[1],this.observe(MoJianCT.ins().postAction,this.updateAction),this.observe(MoJianCT.ins().postLevelUp,this.updateLvUI),this.observe(MoJianCT.ins().postItemPuton,this.updateLvUI),this.observe(MoJianRedPoint.ins().postRoleRedPoint,this.updateRed),this.roleSelect.setCurRole(this.curRoleId),this.addChangeEvent(this.roleSelect,this.switchRole),this.updateView(),this.updateList(),this.updateRed()},e.prototype.removeDisplay=function(){this.eJian2Img&&egret.Tween.removeTweens(this.eJian2Img)},e.prototype.updateRed=function(){this.redPoint.visible=MoJianRedPoint.ins().jianPoint[this.curRoleId][this.curJianId]},e.prototype.onClick=function(t){if(t.target instanceof MoJianIcon)return void this.setSelectMoJian(t.target.moJianId);switch(t.target){case this.eMoCiewBtn:ViewManager.ins().open(MojianOverViewWin);break;case this.openStatusBtn0:if(this.actIsEnough)MoJianCT.ins().sendAction(this.curRoleId,this.curJianId);else{var e=GlobalConfig.MoJianBase[this.curJianId];TipsCT.ins().showTips(GlobalConfig.ItemConfig[e.actItem.id].name+"不足")}break;case this.link:var i=GlobalConfig.MoJianBase[this.curJianId];ViewManager.ins().open(ShopGoodsWarn).setData(i.actItem.id);break;case this.link0:var s=MoJianCT.ins().getMoJianData(this.curRoleId,this.curJianId),n=GlobalConfig.MoJjianLevel[s.id][s.level+1];n&&ViewManager.ins().open(ShopGoodsWarn).setData(n.count.id);break;case this.eMergeBtn:ViewManager.ins().open(MoJianHeChengWin);break;case this.lvupBtn0:this.lvUpIsEnough?MoJianCT.ins().sendLevelUp(this.curRoleId,this.curJianId):TipsCT.ins().showTips("材料不足")}},e.prototype.updateAction=function(t){var e=this;if(!this.hasAction){this.eJianImg.visible=!0,this.eJian2Img.visible=!0,this.eJian2Img.alpha=0;var i=egret.Tween.get(this.eJian2Img);i.to({alpha:1},500).call(function(){Activationtongyong.show(0,GlobalConfig.MoJianBase[t].name,"",!0,null,"Mojian_wq"+t,null,1),e.updateView(),e.updateList()},this)}},e.prototype.updateView=function(){var t=MoJianCT.ins().getRoleMoJianDataByID(this.curRoleId),e=t.getMoJianDatabById(this.curJianId);this.hasAction=null!=e,this.eJiHuoGroup.visible=!this.hasAction,this.eLevelUpGroup.visible=this.hasAction,this.eJianImg.source="mojian_hs"+this.curJianId+"_png",this.eJianImg.visible=!0,this.eJian2Img.source="mojian_"+this.curJianId+"_png",this.eJian2Img.alpha=0,this.updateAct(),this.updateLvUI()},e.prototype.updateList=function(){var t=[];for(var e in GlobalConfig.MoJianBase)t.push([GlobalConfig.MoJianBase[e].id,this.curRoleId]);this.eList.dataProvider=new eui.ArrayCollection(t),this.eList.selectedIndex=this.curJianId-1},e.prototype.setSelectMoJian=function(t){if(this.curJianId!=t){var e=this.eList.getElementAt(this.curJianId-1);e.setSelect(!1),this.curJianId=t,e=this.eList.getElementAt(this.curJianId-1),e.setSelect(!0),this.updateView()}},e.prototype.updateAct=function(){if(!this.hasAction){this.jianMc.visible=!1,this.jianMc.stop();var t=GlobalConfig.MoJianBase[this.curJianId],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.actItem.id);this.actIsEnough=e>=t.actItem.count;var i=this.actIsEnough?ColorUtil.GREEN:ColorUtil.RED,s='<font color="'+i+'">'+e+"</font>/"+t.actItem.count;this.costCount.textFlow=(new egret.HtmlTextParser).parser(s),this.costImg.source=t.actItem.id+"_png",this.eBuffLab.textFlow=TextFlowMaker.generateTextFlow(t.buff),this.eDebuffLab.textFlow=TextFlowMaker.generateTextFlow(t.debuff)}},e.prototype.switchRole=function(){this.curRoleId!=this.roleSelect.getCurRole()&&(this.curRoleId=this.roleSelect.getCurRole(),this.updateView())},e.prototype.updateLvUI=function(){if(this.hasAction){var t=MoJianCT.ins().getRoleMoJianDataByID(this.curRoleId),e=t.getMoJianDatabById(this.curJianId);this.nameImg.source="mojian_mc"+e.id+"_png",this.lv.text=TextFlowMaker.getCStr(e.level)+"阶",this.jianMc.playFile(RES_DIR_EFF+("Mojian_wq"+e.id),-1),this.jianMc.visible=!0,this.updateItems(t),this.updateAttr(t)}},e.prototype.updateAttr=function(t){if(this.hasAction){var e=t.getMoJianDatabById(this.curJianId),i=GlobalConfig.MoJjianLevel[e.id][e.level+1],s=null==i,n=!s&&t.poolStage<i.jianchiLimit;if(this.link0.visible=this.lvupBtn0.visible=this.eCostGroup.visible=this.arrow0.visible=!s&&!n,this.eIsMaxLab.visible=s||n,this.eIsMaxLab.text=s?"已达到最大等级":"需要剑池达到"+i.jianchiLimit+"阶",this.nextAttr0.textFlow=s||n?null:TextFlowMaker.generateTextFlow(this.getAttrStr(e.id,e.level+1)),this.nowAttr0.textFlow=TextFlowMaker.generateTextFlow(this.getAttrStr(e.id,e.level)),this.nowAttr0.horizontalCenter=s||n?0:this.nowAttrLabH,!s&&!n){var o=i?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.count.id):0;this.lvUpIsEnough=o>=i.count.count;var a=this.lvUpIsEnough?ColorUtil.GREEN:ColorUtil.RED,r='<font color="'+a+'">'+o+"</font>/"+i.count.count;this.costCount0.textFlow=(new egret.HtmlTextParser).parser(r),this.costImg0.source=i.count.id+"_png"}}},e.prototype.getAttrStr=function(t,e){var i="",s=GlobalConfig.MoJjianLevel[t][e];if(s){for(var n in s.attrs){var o=s.attrs[n];switch(o.type){case 2:i+="魔剑晶魄生命提升:"+o.value/100+"%\n";break;case 4:i+="魔剑晶魄攻击提升:"+o.value/100+"%\n";break;case 5:i+="魔剑晶魄物防提升:"+o.value/100+"%\n";break;case 6:i+="魔剑晶魄魔防提升:"+o.value/100+"%\n"}}i+=s.skillDesc}return i},e.prototype.updateItems=function(t){for(var e in this.items)this.items[e].update(t,this.curJianId)},__decorate([callLater],e.prototype,"updateRed",null),__decorate([callLater],e.prototype,"updateAction",null),__decorate([callLater],e.prototype,"updateLvUI",null),e}(BaseEuiView);__reflect(MoJianUpLevelWin.prototype,"MoJianUpLevelWin"),window.MoJianUpLevelWin=MoJianUpLevelWin,ViewManager.ins().reg(MoJianUpLevelWin,LayerManager.UI_Main);var MoJianData=function(){function t(t){this.itemIds=[],this.parser(t)}return t.prototype.parser=function(t){this.id=t.readByte(),this.level=t.readUnsignedInt(),this.moJianSkill=t.readByte();var e=t.readUnsignedInt();this.itemIds=[];for(var i=0;e>i;i++)this.itemIds.push(t.readUnsignedInt())},t.prototype.getItemIdByPos=function(t){return t>0?this.itemIds[t-1]:0},t.prototype.setItemIdByPos=function(t,e){this.itemIds[e-1]=t},t.prototype.getActSuitCfgs=function(){var t=[],e=[];for(var i in this.itemIds){var s=this.itemIds[i];if(0!=s){var n=GlobalConfig.MoJianEquip[s];t.push(n.level)}else t.push(0)}t.sort(Algorithm.sortDesc);for(var o=GlobalConfig.MoJianEquipStarSuitConf,i=0;i<t.length;i++){var a=t[i],r=o[a]&&o[a][i+1]?o[a][i+1]:null;r&&e.push(r)}return e},t.prototype.getPower=function(){var t=GlobalConfig.MoJjianLevel[this.id][this.level],e=t.expower?t.expower:0,i=[];for(var s in this.itemIds){var n=this.itemIds[s];if(0!=n){var o=GlobalConfig.MoJianEquip[n];i.push(o.level);var a=[];for(var r in o.attrs){var l=new AttributeData,h=o.attrs[r];l.type=h.type,l.value=0,a.push(l);for(var p in t.attrs)if(h.type==t.attrs[p].type){l.value=h.value*(1+t.attrs[p].value/1e4);break}}e+=BagCT.getAttrPower(a),e+=o.expower?o.expower:0}else i.push(0)}i.sort(Algorithm.sortDesc);for(var u=GlobalConfig.MoJianEquipStarSuitConf,s=0;s<i.length;s++){var d=i[s],c=u[d]&&u[d][s+1]?u[d][s+1]:null;c&&(e+=c.power?c.power:0,e+=BagCT.getAttrPower(c.attrs))}return e},t}();__reflect(MoJianData.prototype,"MoJianData"),window.MoJianData=MoJianData;var MoJianRoleData=function(){function t(t){this.parser(t)}return t.prototype.parser=function(t){this.roleID=t.readInt();var e=t.readInt();this.moJianData||(this.moJianData=[]);for(var i=0;e>i;i++){var s=t.readByte();t.position--;var n=this.moJianData[s-1];n?n.parser(t):(n=new MoJianData(t),this.moJianData[s-1]=n)}this.poolLv=t.readInt(),this.poolStage=t.readInt()},t.prototype.getMoJianDatabById=function(t){return this.moJianData[t-1]},t.prototype.jianIsAction=function(t){return!this.getMoJianDatabById(t)},t.prototype.getPower=function(){var t=0;t+=BagCT.getAttrPower(GlobalConfig.JianChiStageConfig[this.poolStage].attr),t+=BagCT.getAttrPower(GlobalConfig.JianChiLeveL[this.poolStage][this.poolLv].attr);for(var e in this.moJianData)t+=this.moJianData[e].getPower();return t},t}();__reflect(MoJianRoleData.prototype,"MoJianRoleData"),window.MoJianRoleData=MoJianRoleData;var OfficalPostCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.OfficalPost,e.regNetMsg(1,e.postInit),e.regNetMsg(2,e.postUpLevel),e.regNetMsg(3,e.postAward),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){var e=t.readByte();this.offData=[];for(var i=0;e>i;i++){var s={id:t.readByte(),stage:t.readShort(),level:t.readShort(),power:t.readUnsignedInt(),award:t.readByte()};this.offData.push(s)}},e.prototype.postUpLevel=function(t){var e=t.readByte();this.offData[e].stage=t.readShort(),this.offData[e].level=t.readShort(),this.offData[e].power=t.readUnsignedInt(),this.offData[e].award=t.readByte()},e.prototype.postAward=function(t){var e=t.readByte();this.offData[e].award=t.readByte()},e.prototype.sendUpLevel=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.sendAward=function(t){var e=this.getBytes(3);e.writeByte(t),this.sendToServer(e)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.OfficialPostBaseConfig;return GameServer.serverOpenDay+1<e.openday?(t&&TipsCT.ins().showTips("第"+e.openday+"天开启"),!1):ZsCT.ins().lv<e.zslevel?(t&&TipsCT.ins().showTips("角色"+e.zslevel+"转开启"),!1):!0},e.prototype.getRoleDataByRole=function(t){return this.offData&&0!=this.offData.length?this.offData[t]:void 0},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postUpLevel",null),__decorate([post()],e.prototype,"postAward",null),e
}(BaseSystem);__reflect(OfficalPostCT.prototype,"OfficalPostCT"),System.OfficalPostCT=function(){return OfficalPostCT.ins()},window.OfficalPostCT=OfficalPostCT;var OfficalPostRedPoint=function(t){function e(){var e=t.call(this)||this;return e.rolePoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,OfficalPostCT.ins().postInit,OfficalPostCT.ins().postUpLevel,OfficalPostCT.ins().postAward,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.rolePoints.length;e++)this.rolePoints[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){if(!OfficalPostCT.ins().checkOpen())return!1;for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.postAwardPoints(t),s=this.postItemPoints(t);this.rolePoints[t]=i||s}else this.rolePoints[t]=!1}return!0},e.prototype.postAwardPoints=function(t){var e=OfficalPostCT.ins().getRoleDataByRole(t);if(!e)return!1;var i=GlobalConfig.OfficialPostReward[e.stage];return!(!i||e.award)},e.prototype.postItemPoints=function(t){var e=OfficalPostCT.ins().getRoleDataByRole(t);if(!e)return!1;var i=GlobalConfig.OfficialPostLevel[e.stage][e.level].cost;if(!i)return!1;var s=i[0].id,n=ItemUtil.isEquip(GlobalConfig.ItemConfig[s])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,o=BagCT.ins().getBagGoodsCountById(n,s);return o>=i[0].count},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postAwardPoints",null),__decorate([post()],e.prototype,"postItemPoints",null),e}(BaseSystem);__reflect(OfficalPostRedPoint.prototype,"OfficalPostRedPoint"),System.OfficalPostRedPoint=function(){return OfficalPostRedPoint.ins()},window.OfficalPostRedPoint=OfficalPostRedPoint;var OfficalPostItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuanZhiItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data[0];if(t){this.get.visible=t.stage==this.data[1],this.post.text=StringUtils.NumberToChinese(t.stage)+"阶",this.award.dataProvider=new eui.ArrayCollection(t.rewards);var e=GlobalConfig.OfficialPostTitle[t.stage][this.data[2]];e&&(this.title.text=e.postName)}},e}(BaseItemRender);__reflect(OfficalPostItem.prototype,"OfficalPostItem"),window.OfficalPostItem=OfficalPostItem;var OfficalPostRewardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuanZhiFengLu",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleId=t[0],this.roleData=OfficalPostCT.ins().getRoleDataByRole(this.roleId),this.update()},e.prototype.update=function(){var t=this.roleData.stage,e=GlobalConfig.OfficialPostReward;e[t-1]||e[t]?e[t-1]&&e[t+1]?t-=1:e[t+1]||(t-=2):t+=1;for(var i=[],s=t+3;s>t;t++)i.push([e[t],this.roleData.stage,this.roleId]);this.eList.dataProvider=new eui.ArrayCollection(i)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(e);break;case this.get:this.roleData.stage?this.roleData.award?TipsCT.ins().showTips("当天俸禄已经领取"):OfficalPostCT.ins().sendAward(this.roleId):TipsCT.ins().showTips("请提升官职等级")}},e}(BaseEuiView);__reflect(OfficalPostRewardWin.prototype,"OfficalPostRewardWin"),window.OfficalPostRewardWin=OfficalPostRewardWin,ViewManager.ins().reg(OfficalPostRewardWin,LayerManager.UI_Popup);var OfficaPostPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curRoleId=0,e._sn_="GuanZhi",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.getItem.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItem.text+"</u>"),this.ins=OfficalPostCT.ins(),this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.switchRole)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRoleId=t[0]||0,this.roleSelect.setCurRole(this.curRoleId),this.observe(OfficalPostCT.ins().postInit,this.update),this.observe(OfficalPostCT.ins().postUpLevel,this.update),this.observe(BagCT.ins().postItemCountChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(OfficalPostRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=OfficalPostRedPoint.ins().rolePoints[e];this.roleSelect.showRedPoint(e,i)}var s=OfficalPostRedPoint.ins();this.red0.visible=s.postAwardPoints(this.curRoleId),this.red1.visible=s.postItemPoints(this.curRoleId)},e.prototype.update=function(){if(this.skin&&this.ins.getRoleDataByRole(this.curRoleId)){this.mc||(this.mc=new MovieClip),this.title.addChild(this.mc);var t=this.ins.getRoleDataByRole(this.curRoleId),e=GlobalConfig.OfficialPostLevel;t.stage==Object.keys(e).length-1&&t.level==Object.keys(e[Object.keys(e).length-1]).length?this.currentState="4":this.currentState="2",this.updatePower(),this.updateRed();var i=e[t.stage][t.level],s=e[t.stage][t.level+1];!s&&e[t.stage+1]&&(s=e[t.stage+1][1],s||(s=e[1][1])),this.desc.text="当前已是最高级称号";var n=!s;if(!n){for(var o=s.level,a=GlobalConfig.OfficialPostLevel[s.stage],r=Object.keys(a).length-o,l=0;r>l&&!a[o].tids;l++)o++;var h=OfficalPostCT.ins().offData[this.curRoleId].id;if(e[t.stage+1]||!e[t.stage+1]&&e[t.stage][o]){var p=GlobalConfig.OfficialPostTitle[s.stage][h];this.desc.text=StringUtils.NumberToChinese(s.stage)+"阶"+StringUtils.NumberToChinese(o)+"级激活称号"+p.postName,this.mc.playFile(RES_DIR_EFF+p.postImg,-1)}else if(e[t.stage][o]){var p=GlobalConfig.OfficialPostTitle[t.stage][h];this.mc.playFile(RES_DIR_EFF+p.postImg,-1)}else{var p=GlobalConfig.OfficialPostTitle[t.stage][h];this.mc.playFile(RES_DIR_EFF+p.postImg,-1)}this.nextName.text="下阶["+StringUtils.NumberToChinese(s.stage)+"阶"+StringUtils.NumberToChinese(s.level)+"级]",this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(s.attr,0,1,"+")),this.itemId=i.cost[0].id,this.icon.source=GlobalConfig.ItemConfig[this.itemId].icon+"_png";var u=ItemUtil.isEquip(GlobalConfig.ItemConfig[this.itemId])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;this.itemNum=BagCT.ins().getBagGoodsCountById(u,this.itemId),this.needNum=i.cost[0].count;var d="";d=this.itemNum>=this.needNum?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.cost.textFlow=TextFlowMaker.generateTextFlow("<font color="+d+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.needNum+"</font> ")}if(n){var h=OfficalPostCT.ins().offData[this.curRoleId].id,p=GlobalConfig.OfficialPostTitle[t.stage][h];this.mc.playFile(RES_DIR_EFF+p.postImg,-1)}this.curName.text="当前["+StringUtils.NumberToChinese(t.stage)+"阶"+StringUtils.NumberToChinese(t.level)+"级]",this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i.attr,0,1,"+"))}},e.prototype.switchRole=function(){this.curRoleId=this.roleSelect.getCurRole(),this.update()},e.prototype.updatePower=function(){var t=this.ins.getRoleDataByRole(this.curRoleId);this.powerPanel.setPower(t.power)},e.prototype.onClick=function(t){switch(t.target){case this.getItem:WarnCT.ins().setBuyGoodsWarn(this.itemId,1);break;case this.upLevel:if(this.needNum>this.itemNum)return void TipsCT.ins().showTips("|C:0xF3311E&T:"+GlobalConfig.ItemConfig[this.itemId].name+"数量不足|");OfficalPostCT.ins().sendUpLevel(this.curRoleId);break;case this.award:ViewManager.ins().open(OfficalPostRewardWin,this.curRoleId)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(OfficaPostPanel.prototype,"OfficaPostPanel"),window.OfficaPostPanel=OfficaPostPanel,ViewManager.ins().reg(OfficaPostPanel,LayerManager.UI_Main);var PlayFunShow;!function(t){t[t.topMain=1]="topMain",t[t.leftGroup=2]="leftGroup",t[t.rightGroup=4]="rightGroup",t[t.downGroup=8]="downGroup",t[t.topGroup=16]="topGroup",t[t.rightGroup2=32]="rightGroup2"}(PlayFunShow||(PlayFunShow={}));var PlayFun=function(t){function e(){var e=t.call(this)||this;return e.btnSelect=!1,e.showTipsObj=null,e.observe(BossCT.ins().postBossData,e.publicBossRelive),e.observe(FbCT.ins().postAddEnergy,e.updateAutoPk),e.observe(GameLogic.ins().postEnterMap,e.showGroup),e.observe(FbCT.ins().postGuanqiaInfo,e.showGroup),e}return __extends(e,t),e.prototype.showGroup=function(){var t=GameMap.fubenID;if(!CityCC.ins().isCity){var i=win.openList.length;if(!(t&&GameMap.fbType!=FbCT.FB_TYPE_GUANQIABOSS||i))return ViewManager.ins().open(PlayFunView),void(GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS||(FbCT.ins().guanqiaID>=1e5?this.postShowViews(PlayFunShow.topMain|PlayFunShow.downGroup|PlayFunShow.leftGroup):this.postShowViews(e.showAll)));ViewManager.ins().close(PlayFunView)}},e.ins=function(){return t.ins.call(this)},e.prototype.closeAuto=function(){e.ins().btnSelect=this.btnSelect=!1,this.updateAutoPk()},e.prototype.openAuto=function(){e.ins().btnSelect=this.btnSelect=!0,this.updateAutoPk()},e.prototype.publicBossRelive=function(t){var e=t[0],i=t[1],s=t[2],n=ViewManager.ins().getView(PlayFunView);n&&n.publicBossRelive(e,i,s)},e.prototype.upDataWillBoss=function(t){var e=ViewManager.ins().getView(PlayFunView);e&&e.upDataWillBoss(t)},e.prototype.updateAutoPk=function(){if(!FbCT.ins().bossIsChallenged){var t=FbCT.ins().energy,i=FbCT.ins().currentEnergy;e.ins().btnSelect&&i>=t?BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?(e.ins().btnSelect=this.btnSelect=!1,TipsCT.ins().showTips("背包剩余空位不足，请先清理"),this.removePkArrowTips()):FbCT.ins().guanqiaID<GlobalConfig.InstanceBaseConfig.maxCheckPoint?this.addPkArrowTips():(TipsCT.ins().showCenterTips("当前已达最大关卡"),this.removePkArrowTips()):this.removePkArrowTips()}},e.prototype.postShowViews=function(t,e){return void 0===e&&(e=!1),[t,e]},e.prototype.addPkArrowTips=function(){var t=this;this.showTipsObj||(this.showTipsObj={},TipsCT.ins().showTaskTips("能量已满，即将自动挑战关卡BOSS"),egret.Tween.get(this.showTipsObj).wait(1500).call(function(){e.ins().btnSelect&&(GameLogic.ins().startPkBoss(),t.removePkArrowTips())}))},e.prototype.removePkArrowTips=function(){this.showTipsObj&&(egret.Tween.removeTweens(this.showTipsObj),this.showTipsObj=null)},e.prototype.postFlyToIcon=function(t,e){return{dis:t,ruleClaStr:e}},e.showAll=PlayFunShow.topMain|PlayFunShow.leftGroup|PlayFunShow.rightGroup|PlayFunShow.downGroup|PlayFunShow.topGroup|PlayFunShow.rightGroup2,__decorate([post()],e.prototype,"postShowViews",null),__decorate([post()],e.prototype,"postFlyToIcon",null),e}(BaseSystem);__reflect(PlayFun.prototype,"PlayFun"),System.PlayFun=function(){return PlayFun.ins()},window.PlayFun=PlayFun;var PlayFunView=function(t){function e(){var e=t.call(this)||this;return e.ruleList={},e.ruleParent={},e.ruleIdList={},e.ruleId={},e.ruleEff={},e.taskEffTypes=[],e.particlePlayer=[],e._sn_="PlayFunSkin",e.lastEnergy=-1,e.touchEnabled=!1,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 2==CityCC.ins().attStatue&&0==CityCC.ins().cityBossId||GameMap.sceneInMain()},e.prototype.skinComplete=function(){this.showViewList={},this.showViewList[PlayFunShow.topMain]=this.topMain,this.showViewList[PlayFunShow.leftGroup]=this.leftGroup,this.showViewList[PlayFunShow.rightGroup]=this.rightGroup,this.showViewList[PlayFunShow.downGroup]=this.downGroup,this.showViewList[PlayFunShow.topGroup]=this.topGroup,this.showViewList[PlayFunShow.rightGroup2]=this.rightGroup2,this.rulePos={0:this.downGroup,1:this.iconGroup1,2:this.leftGroup,3:this.rightGroup,4:this.rightGroup2,5:this.iconGroup5},this.guanQicMc=new MovieClip,this.guanQicMc.touchEnabled=!1,this.expBallMc=new MovieClip,this.expBallMc.x=80,this.expBallMc.y=86,this.expBallMc.touchEnabled=!1,this.guanQiaLineMc=new MovieClip,this.guanQiaLineMc.x=83,this.guanQiaLineMc.y=107,this.guanQiaLineMc.touchEnabled=!1,this.taskAsseptMc=new MovieClip,this.taskAsseptMc.x=140,this.taskAsseptMc.y=-50,this.taskAsseptMc.touchEnabled=!1,this.taskComMc=new MovieClip,this.taskComMc.x=140,this.taskComMc.y=-80,this.taskComMc.touchEnabled=!1,this.guanqiaBar.slideDuration=0,this.publicBossRelive(!1),this.eExclusiveMC=new MovieClip,this.eExclusiveEff.addChild(this.eExclusiveMC),RuleIconBase.update=this.updateRule.bind(this),RuleIconBase.updateShow=this.updateRuleAndSort.bind(this),this.initRuleList(),this.eBg.visible=!LocationProperty.isOPPO},e.prototype.initRuleList=function(){var t=GlobalConfig.PlayFunConfig;for(var e in t){var i=t[e],s=egret.getDefinitionByName(i.cls);s?this.addRuleList(new s(i.id)):console.error("功能入口配置错误，id:"+e+" cls:"+i.cls)}this.groupGuanqia.touchEnabled=!1,this.addRuleList(new GuangqiaIconRule(0,this.groupGuanqia)),this.addRuleList(new TaskTraceIconRule(0,this.taskTraceBtn)),this.hejiRule=new HejiIconRule(0,this.hejiguide),this.addRuleList(this.hejiRule)},e.prototype.addRuleList=function(t){if(this.ruleList[t.hashCode]=t,t.id&&(this.ruleIdList[t.id]=t,this.ruleId[t.getConfig().cls]=t.id),t.tar&&t.tar.parent)this.ruleParent[t.hashCode]=t.tar.parent,t.tar.parent.removeChild(t.tar);else{var e=GlobalConfig.PlayFunConfig[t.id];this.ruleParent[t.hashCode]=this.rulePos[e.pos]}},e.prototype.updateGroup=function(){FbCT.ins().guanqiaID>=1e5?this.showViews([PlayFunShow.topMain|PlayFunShow.downGroup|PlayFunShow.leftGroup,!1]):this.showViews([PlayFun.showAll,!1])},e.prototype.showViews=function(t){for(var e=t[0],i=t[1],s=1;PlayFunShow[s];){var n=(e&s)==s;this.showView(s,i?!n:n),s*=2}},e.prototype.showView=function(t,e){this.showViewList&&this.showViewList[t]&&(this.showViewList[t].visible=e)},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeGuanQiaEnergy(),this.removeRuleEvent(),this.hongbao&&this.hongbao.removeChildren(),DisplayUtils.removeFromParent(this._flowerShowItem),RuleIconBase.update=null,RuleIconBase.updateShow=null},e.prototype.hideBtn=function(){this.iconGroup1.visible=!this.btn_toolbar.selected,this.iconGroup5.visible=!this.iconGroup1.visible,this.updateToolbarRed()},e.prototype.addRuleEvent=function(){for(var t in this.ruleList){var e=this.ruleList[t];e.addShowEvents(),e.isShow&&(e.addRedEvents(),ResourceMgr.ins().reloadContainer(e.tar))}},e.prototype.removeRuleEvent=function(){for(var t in this.ruleList){var e=this.ruleList[t];e.removeEvents()}},e.prototype.updateRules=function(){Timer.has(this.startUpdateRule,this)||Timer.start(60,1,this.startUpdateRule,this)},e.prototype.startUpdateRule=function(){var t=!1;for(var e in this.ruleList){var i=this.ruleList[e],s=this.updateShow(i);s&&(t=!0),!s&&i.isShow&&this.updateRule(i)}t&&this.sortBtnList()},e.prototype.updateRuleAndSort=function(t){var e=this;Timer.start(100,1,function(){e.updateShow(t)&&e.sortBtnList(t)},this)},e.prototype.updateShow=function(t){var e,i=t.checkShowIcon();if(KFServerSys.ins().isLinkingKF&&(i=!1),t.isShow=i,i){t.addRedEvents(),e=t.getTar(),e.addEventListener(egret.TouchEvent.TOUCH_TAP,t.tapExecute,t);var s=this.ruleParent[t.hashCode];s&&s.addChild(e),ResourceMgr.ins().reloadContainer(e),this.updateRule(t)}else t.removeRedEvents(),e=t.tar,e&&(e.removeEventListener(egret.TouchEvent.TOUCH_TAP,t.tapExecute,t),DisplayUtils.removeFromParent(e),DisplayUtils.removeFromParent(this.ruleEff[e.hashCode]));return this.updateToolbarRed(),!0},e.prototype.updateToolbarRed=function(){for(var t=this.btn_toolbar.selected?this.iconGroup1:this.iconGroup5,e=!1,i=0;i<t.numChildren;i++){var s=t.getChildAt(i);if(s.redPoint&&s.redPoint.visible){e=!0;break}}this.eRp.visible=e},e.prototype.updateRule=function(t){var e=0,i=t.getTar(),s=t.getEffName(e);if(s)if(this.ruleEff[i.hashCode]&&this.ruleEff[i.hashCode].parent)this.getEff(i.hashCode,s);else{var n=this.getEff(i.hashCode,s);n.x=t.effX,n.y=t.effY,i.addChildAt(n,100)}else DisplayUtils.removeFromParent(this.ruleEff[i.hashCode]);i.redPoint&&(e=t.checkShowRedPoint(),i.addChild(i.redPoint),i.redPoint.visible=e),this.updateToolbarRed()},e.prototype.getEff=function(t,e){return this.ruleEff[t]=this.ruleEff[t]||new MovieClip,e&&this.ruleEff[t].playFile(RES_DIR_EFF+e,-1),this.ruleEff[t]},e.prototype.onChange=function(t){if(FbCT.ins().guanqiaID<=10)TipsCT.ins().showTips("通关到第10关开启"),this.autoPkBoss.selected=PlayFun.ins().btnSelect=!1;else if(this.autoPkBoss.selected){if(!KfArenaSys.ins().checkIsMatching())return void(this.autoPkBoss.selected=PlayFun.ins().btnSelect=!1);BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?(TipsCT.ins().showTips("背包剩余空位不足，请先清理"),this.autoPkBoss.selected=PlayFun.ins().btnSelect=!1):FbCT.ins().guanqiaID<FbCT.AUTO_GUANQIA?(TipsCT.ins().showTips("|C:0xff0000&T:挑战至"+FbCT.AUTO_GUANQIA+"关开启"),this.autoPkBoss.selected=PlayFun.ins().btnSelect=!1):FbCT.ins().guanqiaID>=GlobalConfig.InstanceBaseConfig.maxCheckPoint?(TipsCT.ins().showCenterTips("当前已达最大关卡"),this.autoPkBoss.selected=PlayFun.ins().btnSelect=!1):(this.GuanQiacleanEff(),PlayFun.ins().openAuto())}else PlayFun.ins().closeAuto();t.stopPropagation(),t.stopImmediatePropagation()},e.prototype.guanqiaChange=function(){this.maskImg.visible=FbCT.ins().guanqiaID<=15||FbCT.ins().guanqiaID>=1e5},e.prototype.onTaskTrace=function(t){var e=TaskCT.ins().taskTrace;if(e&&0==e.state){var i=TaskCT.ins().getAchieveConfById(e.id);if(!i)return;switch(i.control){case GuideType.ChallengeBoss:case GuideType.AutoPk:if(!KfArenaSys.ins().checkIsMatching())return;if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return;FbCT.ins().currentEnergy<FbCT.ins().energy&&this.showTaskTips("能量未满无法挑战，请继续清怪。"),i.control==GuideType.AutoPk&&Hint.ins().postKillBoss(i);break;case GuideType.KillDeer:var s="正在完成清怪任务，还差|C:0xf8b141&T:"+(i.target-e.value)+"|个。";this.showTaskTips(s)}}},e.prototype.guanqiaBtnClick=function(t){return FbCT.ins().guanqiaID>=GlobalConfig.InstanceBaseConfig.maxCheckPoint?void TipsCT.ins().showCenterTips("当前已达最大关卡"):void(KfArenaSys.ins().checkIsMatching()&&(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):FbCT.ins().currentEnergy>=FbCT.ins().energy&&(this.GuanQiacleanEff(),FbCT.ins().autoPk(),FbCT.ins().firstAutoGuilder=FbCT.ins().guanqiaID==FbCT.AUTO_GUANQIA-1)))},e.prototype.showTaskTips=function(t){TipsCT.ins().showTaskTips(t)},e.prototype.addDisplay=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(this.addTouchEvent(this.btn_toolbar,this.onTap),this.addTouchEvent(this.autoPkBoss,this.onChange),this.addTouchEvent(this.taskTraceBtn,this.onTaskTrace),this.addTouchEvent(this.guanqiaBtn,this.onTaskTrace),this.addTouchEvent(this.guanqiaBtn,this.guanqiaBtnClick),this.addTouchEvent(this.newBossRelive,this.onTap),this.addTouchEvent(this.eExclusiveFBBtn,this.onTap),this.observe(GameLogic.ins().postEnterMap,this.postEnterMap),this.observe(FbCT.ins().postGuanqiaInfo,this.upDataGuanQiaInfo),this.observe(TaskCT.ins().postUpdteTaskTrace,this.changeTaskTrace),this.observe(TaskCT.ins().postUpdteTaskTrace,this.updateTaskState),this.observe(FbCT.ins().postGuanKaIdChange,this.guanqiaChange),this.observe(GameApp.ins().postZeroInit,this.updateRules),this.observe(GameLogic.ins().postSubRoleChange,this.initData),this.observe(Actor.ins().postGoldChange,this.initData),this.observe(Actor.ins().postYbChange,this.initData),this.observe(Actor.ins().postPowerChange,this.initData),this.observe(GameLogic.ins().postExpMc,this.addExpFlyMc),this.observe(FbCT.ins().postAddEnergy,this.upDataGuanqia),this.observe(FbCT.ins().postPlayWarm,this.warmWord),this.observe(VipCT.ins().postUpdateVipData,this.initData),this.observe(PlayFun.ins().postShowViews,this.showViews),this.observe(PlayFun.ins().postFlyToIcon,this.flyToIcon),this.observe(FbCT.ins().postTeamFbFlowarRecords,this.updateFlower),this.observe(FbCT.ins().postAutoPk,this.GuanQiaEffLogic),this.observe(FbCT.ins().postAutoPk2,this.GuanQiaEffLogic),this.observe(ExclusiveFBCT.ins().postFBTips,this.showExclusiveTips),this.initData(),this.updateGroup(),this.upDataGuanQiaInfo(),this.addRuleEvent(),this.updateRules(),this.upDataWillBoss(Encounter.ins().willBossID),this.changeTaskTrace(),HBSystem.ins().updateHongBao(),urlParam.backicon){var s=new eui.Image;s.source=urlParam.backicon,s.right=0,s.top=300,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=window.showBackIcon;t&&t()},this),this.addChild(s)}this.ifAddIcon("showBackHall","backhudicon_png",function(){WarnWin.show("是否返回游戏大厅",function(){window.h5gamecn&&window.h5gamecn.logout&&window.h5gamecn.logout()},t,null,t,"normal")}),LocationProperty.isWanBaWX||this.ifAddIcon("sstd","wbshoucang",function(){ViewManager.ins().open(Wanbatc)}),window.h5gamecn&&window.h5gamecn.checkWanBaAct&&window.h5gamecn.checkWanBaAct(function(e){e&&t.ifAddIcon("svgft","wbtequan",function(){PfActivity.ins().sendWanBaGift(3)},300)}),this.snowEff(),this.hideBtn(),this.autoPkBoss.selected=PlayFun.ins().btnSelect},e.prototype.ifAddIcon=function(t,e,i,s){if(void 0===s&&(s=100),urlParam[t]){var n=new eui.Image;n.source=e,n.right=0,n.top=s,n.addEventListener(egret.TouchEvent.TOUCH_TAP,i,this),this.addChild(n)}},e.prototype.aniShadow=function(){var t=this;this.warmImage.source="",this.warmImage.source="black02_png",this.warmImage.visible=!0;var e=egret.Tween.get(this.warmImage);this.warmImage.alpha=.23,e.to({alpha:1},300).wait(2200).to({alpha:0},350).call(function(){egret.Tween.removeTweens(t.warmImage)}),this.levelNum.text="t"+FbCT.ins().guanqiaID+"g",this.alphaGroup.alpha=.2,egret.Tween.removeTweens(this.alphaGroup),egret.Tween.get(this.alphaGroup,{loop:!0}).to({alpha:1},625).to({alpha:.2},625),Timer.start(3500,1,this.removeShadow,this)},e.prototype.GuanQiaEffLogic=function(){var t=this;if(this.guanqiaBtn&&0==FbCT.ins().showAutoPk){if(FbCT.ins().showAutoPk=1,!this.arrow){this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击挑战关卡",this.addChild(this.arrow);var e=this.guanqiaBtn.localToGlobal();this.globalToLocal(e.x,e.y,e),this.arrow.x=e.x,this.arrow.y=e.y+this.guanqiaBtn.height/2,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"NoviceEff",-1),this.groupGuanqia.addChild(this.eff),this.eff.x=this.guanqiaBtn.x+this.guanqiaBtn.width/2,this.eff.y=this.guanqiaBtn.y+this.guanqiaBtn.height/2),egret.Tween.get(this.arrow,{loop:!0}).to({x:this.arrow.x+40},1e3).to({x:this.arrow.x},1e3),egret.Tween.get(this,{loop:!1}).wait(5e3).call(function(){FbCT.ins().showAutoPk=-1,DisplayUtils.removeFromParent(t.eff),DisplayUtils.removeFromParent(t.arrow),t.arrow&&egret.Tween.removeTweens(t.arrow),t.arrow=null,t.eff=null})}}else if(this.pkBossBtnGroup&&0==FbCT.ins().showAutoPk2&&(FbCT.ins().showAutoPk2=1,!this.arrow)){this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击自动挑战关卡",this.addChild(this.arrow);var e=this.pkBossBtnGroup.localToGlobal();this.globalToLocal(e.x,e.y,e),this.arrow.x=e.x,this.arrow.y=e.y+this.pkBossBtnGroup.height/2,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"NoviceEff",-1),this.groupGuanqia.addChild(this.eff),this.eff.x=this.pkBossBtnGroup.x+this.pkBossBtnGroup.width/2,this.eff.y=this.pkBossBtnGroup.y+this.pkBossBtnGroup.height/2),egret.Tween.get(this.arrow,{loop:!0}).to({x:this.arrow.x+40},1e3).to({x:this.arrow.x},1e3),egret.Tween.get(this,{loop:!1}).wait(5e3).call(function(){FbCT.ins().showAutoPk2=-1,DisplayUtils.removeFromParent(t.eff),DisplayUtils.removeFromParent(t.arrow),t.arrow&&egret.Tween.removeTweens(t.arrow),t.arrow=null,t.eff=null})}},e.prototype.upDataWillBoss=function(t){t?(this.willBossPrompt=this.willBossPrompt||new MovieClip,this.willBossPrompt.playFile(RES_DIR_EFF+"zaoyuBoss",-1),this.willBossPrompt.y=500,this.willBossPrompt.x=330,this.willBossPrompt.touchEnabled=!0,this.addTouchEvent(this.willBossPrompt,this.onTap),this.addChild(this.willBossPrompt)):this.willBossPrompt&&(DisplayUtils.removeFromParent(this.willBossPrompt),this.removeTouchEvent(this.willBossPrompt,this.onTap))},e.prototype.publicBossRelive=function(t,e,i){if(void 0===e&&(e=""),void 0===i&&(i=0),this.reliveBossLab&&(t||!e||e==this.reliveBossLab.name)){var s=BossCT.ins().checkBossIconShow(),n=t&&s&&GameMap.sceneInMain();PlayFun.ins().newBossRelive=this.newBossRelive.visible=n,this.reliveBossLab.name=t?e:"1",n&&(this.reliveBossLab.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(""+e,"#35e62d")+"刷新了！"),this.bossTypeNumber=i)}},e.prototype.updateTaskState=function(){var t=TaskCT.ins().taskTrace;t&&(1==t.state?this.taskAsseptMc.parent?this.taskEffTypes.indexOf(1)<0&&this.taskEffTypes.push(1):this.taskComMc.parent||this.addTaskEffectIndex(1):0==t.state&&0==t.value&&(this.taskComMc.parent?this.taskEffTypes.indexOf(0)<0&&this.taskEffTypes.push(0):this.taskAsseptMc.parent||this.addTaskEffectIndex(0)))},e.prototype.addTaskEffectIndex=function(t){var e=this;0==t?(this.taskTraceBtn.addChild(this.taskAsseptMc),this.taskAsseptMc.playFile(RES_DIR_EFF+"ValueEff6",1,function(){egret.callLater(function(){e.taskEffTypes.length&&e.addTaskEffectIndex(e.taskEffTypes.shift())},e)}),SoundUtil.play(SoundEnum.TASK),this.taskAsseptMc.y=-50):1==t&&(this.taskTraceBtn.addChild(this.taskComMc),this.taskComMc.playFile(RES_DIR_EFF+"MissionFinish",1,function(){egret.callLater(function(){e.taskEffTypes.length&&e.addTaskEffectIndex(e.taskEffTypes.shift())},e)}),this.taskComMc.y=-80)},e.prototype.upDataGuanQiaInfo=function(){this.groupGuanqia.visible=FbCT.ins().guanqiaID<=1e5,this.upDataGuanqia(),this.updateExclusiveFBBtn()},e.prototype.postEnterMap=function(){this.upDataGuanqia(),this.snowEff()},e.prototype.upDataGuanqia=function(){var t=FbCT.ins().guanqiaID;t>=0&&GameMap.sceneInMain()?(this.upDataExpMcBall(FbCT.ins().currentEnergy,FbCT.ins().energy),FbCT.ins().energy&&FbCT.ins().currentEnergy>=FbCT.ins().energy?this.guanQicMc&&!this.guanQicMc.parent&&(this.guanQicMc.playFile(RES_DIR_EFF+"PassBtn",-1),this.guanqiaEff0.addChild(this.guanQicMc),this.guanqiaEff0.touchEnabled=this.guanQicMc.touchEnabled=this.guanQicMc.hitTestEnabled=!1):(FbCT.ins().energy>0&&this.lastEnergy!=FbCT.ins().currentEnergy&&-1!=this.lastEnergy&&this.playGuanQiaDoorMc(),DisplayUtils.removeFromParent(this.guanQicMc)),this.lastEnergy=FbCT.ins().currentEnergy):(DisplayUtils.removeFromParent(this.guanQicMc),this.lastEnergy=-1),this.pkBossBtnGroup.visible=t>=FbCT.AUTO_GUANQIA},e.prototype.removeGuanQiaEnergy=function(){DisplayUtils.removeFromParent(this.guanQicMc),FbCT.ins().currentEnergy=0},e.prototype.upDataExpMcBall=function(t,e){this.setGuanQiaBar(t,e)},e.prototype.sortRule=function(t,e){var i=GlobalConfig.PlayFunConfig[t.id],s=GlobalConfig.PlayFunConfig[e.id];return i.sort<s.sort?-1:1},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.newBossRelive:var i=void 0,s=void 0;switch(this.bossTypeNumber){case 1:case 7:i=1,s=6;break;case 2:i=1,s=0;break;case 4:i=1,s=3;break;case 5:case 6:i=1,s=4;break;case 8:i=1,s=2;break;case 3:case 9:i=4}i&&(ViewManager.ins().open(BossWin,i,s),BossCT.ins().postBossData(!1));break;case this.willBossPrompt:ViewManager.ins().open(BossWin,1);break;case this.btn_toolbar:this.hideBtn();break;case this.eExclusiveFBBtn:ViewManager.ins().open(ExclusiveFBWin)}},e.prototype.changeTaskTrace=function(){var t=TaskCT.ins().taskTrace;if(t){this.taskTraceBtn.visible=!0;var e=TaskCT.ins().getAchieveConfById(t.id);if(!e)return void console.log("任务配置"+t.id+"不存在！");switch(79==e.type?this.taskTraceAwards.textFlow=TextFlowMaker.generateTextFlow("|C:0x40df38&T:"+e.desc+"|"):this.taskTraceAwards.text=""+e.desc,t.state){case 0:var i=e.target,s=t.value;79==e.type&&(s=0,i=1),36==e.type&&(s-=1,i-=1),this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0xf3311e&T: ("+s+"/"+i+")|"),0==t.value&&GameGuider.stopTaskEffect(),GameGuider.startTaskEffect();break;case 1:this.taskTraceName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&T: (已完成)|"),GameGuider.stopTaskEffect(),GameGuider.startTaskEffect();break;case 2:this.taskTraceBtn.visible=!1}var n=egret.Tween.get(this.taskTraceAwards);n.to({x:this.taskTraceAwards.x+100,alpha:0},200).to({x:0},200).to({x:61,alpha:1},200);var o=egret.Tween.get(this.taskTraceName);o.to({x:this.taskTraceName.x+100,alpha:0},200).to({x:0},200).to({x:61,alpha:1},200)}else this.taskTraceBtn.visible=!1,GameGuider.stopTaskEffect()},e.prototype.playGuanQiaDoorMc=function(){this.eyesMc||(this.eyesMc=new MovieClip),this.eyesMc.parent||this.guanqiaEff1.addChild(this.eyesMc),this.eyesMc.x=-2,this.eyesMc.y=-6,this.guanqiaEff1.touchChildren=this.guanqiaEff1.touchEnabled=this.eyesMc.touchEnabled=this.eyesMc.hitTestEnabled=!1,this.eyesMc.playFile(RES_DIR_EFF+"PassBtnEye",1)},e.prototype.warmWord=function(t){var e=this;t?(GameMap.sceneInMain()&&(this.bossWarmMc=this.bossWarmMc||new MovieClip,this.bossWarmMc.touchEnabled=!1,this.mcGroup.addChildAt(this.bossWarmMc,0),this.mcGroup.visible=!0,this.aniShadow(),this.bossWarmMc.playFile(RES_DIR_EFF+"BossEff1",2,function(){e.removeShadow()}),this.removeGuanQiaEnergy()),this.rightGroup2.visible=this.rightGroup.visible=!1):(this.mcGroup.visible=!1,egret.Tween.removeTweens(this.alphaGroup),this.bossWarmMc&&(DisplayUtils.removeFromParent(this.bossWarmMc),this.bossWarmMc=null),this.rightGroup2.visible=this.rightGroup.visible=!0)},e.prototype.sortBtnList=function(t){void 0===t&&(t=null);var e=-1;if(t){var i=GlobalConfig.PlayFunConfig[t.id];if(!i)return;e=i.pos}var s={};-1==e?(s[0]=[],s[1]=[[],[],[]],s[2]=[],s[3]=[],s[4]=[],s[5]=[[],[],[]]):1!=e&&5!=e?s[e]=[]:s[e]=[[],[],[]];var n=GlobalConfig.PlayFunConfig,o=this.ruleIdList;for(var a in n){var r=o[a];if(r&&r.isShow){var i=n[a],l=i.pos;(-1==e||e==l)&&(1==l||5==l?s[l][i.layer-1].push(r):s[l].push(r))}}for(var h in s)if("1"==h||"5"==h)for(var p in s[h])s[h][p].sort(this.sortRule);else s[h].sort(this.sortRule);var u,d,c=80,f=80,g=10,y=0,v=0,m=0,T=0;if(-1==e||1==e){d=s[1];for(var C=0;C<d.length;C++){C>T&&(T=C,v=0);for(var h=0;h<d[C].length;h++)u=d[C][h].tar,u.parent.setChildIndex(u,0),g=0==T?c+10:10,u.x=g+v*c,u.y=y+T*f,v+=1,v>5&&(T+=1,v=0)}}if(-1==e||5==e){d=s[5],v=0,m=0,T=0;for(var C=0;C<d.length;C++){C>T&&(T=C,v=0);for(var h=0;h<d[C].length;h++)u=d[C][h].tar,u.parent.setChildIndex(u,0),g=0==T?c+10:10,u.x=g+v*c,u.y=y+T*f,v+=1,v>5&&(T+=1,v=0)}}if(-1==e||2==e){v=0,m=0,d=s[2];for(var h=0;h<d.length;h++){var r=d[h];u=r.tar,u.parent.setChildIndex(u,m),m+=1,r.getConfig().noMove||(u.left=10,u.top=557-75*v,v++)}}if(-1==e||3==e){v=0,m=0,d=s[3];for(var h=0;h<d.length;h++){var r=d[h];u=r.tar,u.parent.setChildIndex(u,m),m+=1,r.getConfig().noMove||(u.right=0,u.bottom=300+65*v,v++)}}if(-1==e||0==e){m=0,d=s[0];for(var h=0;h<d.length;h++)u=d[h].tar,u.parent.setChildIndex(u,m),m+=1}},e.prototype.removeShadow=function(){this.warmImage.visible=!1,this.mcGroup.visible=!1,egret.Tween.removeTweens(this.alphaGroup),Timer.stop(this.removeShadow,this)},e.prototype.setGuanQiaBar=function(t,e){var i=t,s=e;i>=s&&(i=s),this.guanqiaBar.value=i,this.guanqiaBar.maximum=s,this.guanqiaBar.labelFunction=function(){return""}},e.prototype.addExpFlyMc=function(t){var e=this;if(GameMap.fbType!=FbCT.FB_TYPE_EXP){if(!FbCT.ins().checkGuanqiaIconShow())return void FbCT.ins().postAddEnergy();var i=new eui.Image;i.source="point",i.anchorOffsetX=20,i.anchorOffsetY=20;var s=ViewManager.gamescene.map,n=this.localToGlobal();s.globalToLocal(n.x,n.y,n),i.x=t.x-n.x,i.y=t.y-n.y,this.addChild(i);var o=this.groupGuanqia.x+60,a=this.groupGuanqia.y+60,r=egret.Tween.get(i);r.to({x:o,y:a,alpha:.5},600).call(function(){FbCT.ins().postAddEnergy(),e.removeChild(i),egret.Tween.removeTweens(i)},this);var l=egret.Tween.get(i,{loop:!0});l.to({rotation:i.rotation+360},800)}},e.prototype.GuanQiacleanEff=function(){FbCT.ins().showAutoPk=-1,FbCT.ins().showAutoPk2=-1,DisplayUtils.removeFromParent(this.eff),DisplayUtils.removeFromParent(this.arrow),this.arrow&&egret.Tween.removeTweens(this.arrow),this.arrow=null,this.eff=null},e.prototype.updateFlower=function(){return this._flowerShowItem?(this._flowerShowItem.parent||this.flower.addChild(this._flowerShowItem),void this._flowerShowItem.showEffect()):(this._flowerShowItem=new FlowerShowItem,void this.flower.addChild(this._flowerShowItem))
},e.prototype.removeFlowerItem=function(){DisplayUtils.removeFromParent(this._flowerShowItem)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.snowEff=function(){var t=GlobalConfig.ClientGlobalConfig.openParticles;if(!urlParam.isMiniGame&&t&&t.length>0){for(;this.particlePlayer.length>0;){var e=this.particlePlayer.pop();e.stop(!0),DisplayUtils.removeFromParent(e)}for(var i=0;i<t.length;i++){var e=new ParticlePlayer;e.playFile(RES_DIR_FEATHER+t[i]),this.eXueGroup.addChild(e),this.particlePlayer.push(e)}}},e.prototype.updateExclusiveFBBtn=function(){this.eExclusiveFBBtn.visible=OpenSystem.ins().checkSysOpen(SystemType.EXCLUSIVE)&&ExclusiveFBCT.ins().hascanEnterFB(),this.eExclusiveFBBtn.visible?(this.eExclusiveMC.visible=!0,this.eExclusiveMC.playFile(RES_DIR_EFF+"CirclePrompt",-1)):(this.eExclusiveMC.stop(),this.eExclusiveMC.visible=!1)},e.prototype.showExclusiveTips=function(t){if(!(this.eExclusiveGroup.numChildren>0)&&t>0){var e=new ExclusiveFBTips;this.eExclusiveGroup.addChild(e),e.id=t,this.tweenExclusiveTips()}},e.prototype.tweenExclusiveTips=function(){var t=this,e=this.eExclusiveGroup.bottom,i=egret.Tween.get(this.eExclusiveGroup);i.to({bottom:e+50},1e3).to({alpha:0,bottom:e+100},1e3).call(function(){t.eExclusiveGroup.removeChildren(),t.eExclusiveGroup.alpha=1,t.eExclusiveGroup.bottom=e,t.updateExclusiveFBBtn()})},e.prototype.flyToIcon=function(t){var e=t.dis,i=t.ruleClaStr,s=this.ruleId[i],n=this.ruleIdList[s],o=new egret.RenderTexture;o.drawToTexture(e);var a=new eui.Image;a.texture=o,a.x=e.x,a.y=e.y,this.addChild(a),Timer.start(100,1,function(){var t=0,e=0;if(n&&n.checkShowIcon()&&n.tar){var i=n.tar.localToGlobal();t=i.x+n.tar.width/2,e=i.y+n.tar.height/2}var s=egret.Tween.get(a);s.to({scaleX:0,scaleY:0,x:t,y:e},300).call(function(){DisplayUtils.removeFromParent(a)})},this)},e}(BaseEuiView);__reflect(PlayFunView.prototype,"PlayFunView"),ViewManager.ins().reg(PlayFunView,LayerManager.Main_View),window.PlayFunView=PlayFunView;var ZhiYin=function(t){function e(){var e=t.call(this)||this;return e.observe(FbCT.ins().postGuanqiaInfo,e.check),e}return __extends(e,t),e.prototype.check=function(){var t=FbCT.ins(),e=t.guanqiaID,i=t.postGuanKaIdChange,s=Setting.ins().getValue(ClientSet.guide);if(e>=30&&!s){if(!this.arrow){this.arrow=new GuideArrow,this.arrow.currentState="right",this.arrow.lab.text="点击打开设置";var n=ViewManager.ins().getView(UIView2);if(!n)return;n.addChild(this.arrow);var o="horizontalCenter";this.arrow[o]=-100,this.arrow.y=50,egret.Tween.get(this.arrow,{loop:!0}).to((a={},a[o]=this.arrow[o]-40,a),1e3).to((r={},r[o]=this.arrow[o],r),1e3)}}else(e>30||s)&&(this.arrow=null,this.removeObserve(i,this.check));var a,r},e}(BaseSystem);__reflect(ZhiYin.prototype,"ZhiYin"),System.ZhiYin=function(){return ZhiYin.ins()},window.ZhiYin=ZhiYin;var ActivityForeshowModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getFunsShowAwardById=function(t){var e=GlobalConfig.NewFuncNoticeConfig[t];return e?(this.funcShowAward>>t&1)>0?2:this.checkOpen(e)&&GameServer.serverOpenDay+1>=e.recDay&&ZsCT.ins().lv>=e.zhuanshengLv?1:0:0},e.prototype.getForeshow=function(){var t=[];for(var e in GlobalConfig.NewFuncNoticeConfig){var i=GlobalConfig.NewFuncNoticeConfig[e];(this.funcShowAward>>i.id&1)>0||this.checkOpen(i)&&t.push(i)}return t.sort(this.sortFunc),t.length>0?t:null},e.prototype.sortFunc=function(t,e){return t.startDay>e.startDay?-1:t.startDay<e.startDay?1:0},e.prototype.checkOpen=function(t){if(!t)return!1;var e=FbCT.ins().guanqiaID,i=t.chapter?1e4>e&&e>=t.chapter:!0;return Actor.level>=t.openLv&&GameServer.serverOpenDay+1>=t.startDay&&i},e}(BaseClass);__reflect(ActivityForeshowModel.prototype,"ActivityForeshowModel"),window.ActivityForeshowModel=ActivityForeshowModel;var ActivityExIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,BagCT.ins().postItemAdd,BagCT.ins().postItemChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.HFACTIVITY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(!s.pageStyle&&s.timeType==ActivityDataFactory.TimeType_Total&&s.isOpenActivity())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(!i.pageStyle&&i.timeType==ActivityDataFactory.TimeType_Total&&i.isOpenActivity()&&i.canReward()&&i.specialState())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityExWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ActivityExIconRule.prototype,"ActivityExIconRule"),window.ActivityExIconRule=ActivityExIconRule;var ActivityFBIconRule=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.ACTIVITYFB,e}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setRepeat(),e},e.prototype.setRepeat=function(){var t=Activity.ins().getActivityDataById(this.actID);if(!(t&&t.endTime>0))return void Timer.stopAll(this);Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this);var e=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3),i="";e>0&&(i=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_1)),this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+i+"</font>")},e.prototype.tapExecute=function(){ViewManager.ins().openBySkin(ComActivityWin,"ActivityWinSkin1",this.pageStyle),e.firstTap&&(e.firstTap=!1,this.update())},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.firstTap=!0,e}(ComActivityIconRule);__reflect(ActivityFBIconRule.prototype,"ActivityFBIconRule"),window.ActivityFBIconRule=ActivityFBIconRule;var ActivityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return GameServer.serverOpenDay<7?e&&(e.icon="zjmkaifu"):e&&(e.icon="zjmhuodong"),e},e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(GameServer.serverOpenDay<7?this.tar&&(this.tar.icon="zjmkaifu"):this.tar&&(this.tar.icon="zjmhuodong"),!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(!s.pageStyle&&s.timeType!=ActivityDataFactory.TimeType_Fixed&&s.timeType!=ActivityDataFactory.TimeType_Total&&s.isOpenActivity()&&!s.getHide())return!0}t=PActivity.ins().activityData;for(var i in t){var s=t[i];if(s.isOpenActivity()&&!s.getHide()&&s.pageStyle!=ActivityPageStyle.HAPPYSEVENDAY&&s.pageStyle!=ActivityPageStyle.NewGuideTask)return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(!i.pageStyle&&i.timeType!=ActivityDataFactory.TimeType_Fixed&&i.timeType!=ActivityDataFactory.TimeType_Total&&i.isOpenActivity()&&i.canReward())return 1}t=PActivity.ins().activityData;for(var e in t){var i=t[e];if(i.isOpenActivity()&&i.canReward()&&i.pageStyle!=ActivityPageStyle.HAPPYSEVENDAY&&i.pageStyle!=ActivityPageStyle.NewGuideTask)return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ActivityIconRule.prototype,"ActivityIconRule"),window.ActivityIconRule=ActivityIconRule;var AuctionIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[ZsCT.ins().postZsData],s.updateMessage=[Auction.ins().postListData,Auction.ins().postAuctionResult,Auction.ins().postBuyResult,Auction.ins().postUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return Auction.ins().isAuctionOpen()?!0:!1},e.prototype.checkShowRedPoint=function(){return Auction.ins().checkRed()&&this.firstTap?1:0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(AuctionWin),Auction.ins().sendGetList(0),this.firstTap&&(Auction.ins().checkRed()||(this.firstTap=!1),this.update())},e}(RuleIconBase);__reflect(AuctionIconRule.prototype,"AuctionIconRule"),window.AuctionIconRule=AuctionIconRule;var BangDingIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.canShow=!1,s.showMessage=[Actor.ins().postLevelChange,PfActivity.ins().postBangingInfo,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[],s.getShowIcon(),s}return __extends(e,t),e.prototype.getShowIcon=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,s;return __generator(this,function(n){switch(n.label){case 0:return(t=window.isShowBindPhone)?(e=this,[4,new Promise(function(e){t(e)})]):[2];case 1:return e.canShow=n.sent(),(i=window.checkBindPhone)?(s=PfActivity.ins(),[4,new Promise(function(t){i(t)})]):[2];case 2:return s.hasBang=n.sent(),PfActivity.ins().sendBangingReward(0),this.updateShow(),[2]}})})},e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:this.canShow&&0==PfActivity.ins().bangDingRewardState&&OpenSystem.ins().checkSysOpen(SystemType.BANGDING)},e.prototype.tapExecute=function(){ViewManager.ins().open(BangDingWin)},e}(RuleIconBase);__reflect(BangDingIconRule.prototype,"BangDingIconRule"),window.BangDingIconRule=BangDingIconRule;var BattleIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[Actor.ins().postLevelChange,BattleCC.ins().postOpenInfo,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);if(this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),BattleCC.ins().isOpen)this._timeTxt.text="进行中";else{var i=BattleCC.ins().getOpenLeftTime();i>0&&(this._time=i,this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}return e},e.prototype.checkShowIcon=function(){if(Timer.stopAll(this),!OpenSystem.ins().checkSysOpen(SystemType.BATTLE))return!1;if(BattleCC.ins().isOpen)return!0;var t=BattleCC.ins().getOpenLeftTime();return t>0?(this._time=t,this.tar&&!Timer.has(this.setRepeat,this)&&Timer.start(1e3,0,this.setRepeat,this),!0):!1},e.prototype.setRepeat=function(){this._time--,this._time>0?this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4):(this._timeTxt.text="进行中",Timer.stopAll(this))},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(LadderWin,3),this.update()},e}(RuleIconBase);__reflect(BattleIconRule.prototype,"BattleIconRule"),window.BattleIconRule=BattleIconRule;var BBSIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return urlParam.appid==PlatFormID.QQ_BROWSER},e.prototype.tapExecute=function(){window.openTopicCircle()},e}(RuleIconBase);__reflect(BBSIconRule.prototype,"BBSIconRule"),window.BBSIconRule=BBSIconRule;var BeastIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData,BeastCT.ins().postBeastInfo],s.updateMessage=[BeastRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return BeastCT.ins().checkOpen()},e.prototype.checkShowRedPoint=function(){return BeastRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BeastMainWin)},e}(RuleIconBase);__reflect(BeastIconRule.prototype,"BeastIconRule"),window.BeastIconRule=BeastIconRule;var BlueHallRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[BlueHallRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isFromQQBLUE},e.prototype.checkShowRedPoint=function(){return BlueHallRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BlueHallWin)},e}(RuleIconBase);__reflect(BlueHallRule.prototype,"BlueHallRule"),window.BlueHallRule=BlueHallRule;var BlueVipRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[BlueVipRedPoint.ins().postRedPoint,Actor.postPFVipInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isFromQQBLUE},e.prototype.checkShowRedPoint=function(){return BlueVipRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BlueVipWin)},e}(RuleIconBase);__reflect(BlueVipRule.prototype,"BlueVipRule"),window.BlueVipRule=BlueVipRule;var BossFirstKillRule=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.BOSSFIRSTKILL,e}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setRepeat(),e},e.prototype.setRepeat=function(){var t=Activity.ins().getActivityDataById(this.actID);if(!(t&&t.endTime>0))return void Timer.stopAll(this);Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this);var e=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3),i="";e>0&&(i=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_1)),this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+i+"</font>")},e.prototype.tapExecute=function(){ViewManager.ins().open(OSATarget57Panel,this.actID,this.pageStyle,ActivityType.Normal),e.firstTap&&(e.firstTap=!1,this.update())},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.firstTap=!0,e}(ComActivityIconRule);__reflect(BossFirstKillRule.prototype,"BossFirstKillRule"),window.BossFirstKillRule=BossFirstKillRule;var BossIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,TaskCT.ins().postUpdteTaskTrace,GameLogic.ins().postEnterMap],s.updateMessage=[BossCT.ins().postWorldBoss,BossCT.ins().postWorldNotice,BossCT.ins().postBossData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return BossCT.ins().checkBossIconShow()},e.prototype.checkShowRedPoint=function(){return PlayFun.ins().newBossRelive||FbCT.isCanChallenge()||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_QMBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_WORLDBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_HOMEBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_SHENYU)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_DARKBOSS)||KFBossRedpoint.ins().redpoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BossWin),BossCT.ins().postBossData(!1)},e.OpenTaskIndex=41,e}(RuleIconBase);__reflect(BossIconRule.prototype,"BossIconRule"),window.BossIconRule=BossIconRule;var BossRevelryIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(47)&&GameServer.serverOpenDay<7},e.prototype.getEffName=function(){return this.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):""},e.prototype.tapExecute=function(){ViewManager.ins().open(Boss_RevelryWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(BossRevelryIconRule.prototype,"BossRevelryIconRule"),window.BossRevelryIconRule=BossRevelryIconRule;var BossRevelryRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[CityCC.ins().postBossRevelryState],s.updateMessage=[CityCC.ins().postBossRevelryState],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.desc=new eui.Label,this.desc.horizontalCenter=0,this.desc.size=14,this.desc.width=120,this.desc.textAlign="center",this.desc.textColor=3532333,this.desc.text="BOSS已刷新",this.desc.y=75,e.addChild(this.desc),e},e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOSSREVELRY)&&CityCC.ins().checkIsOpen()},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):""},e.prototype.tapExecute=function(){var t=0,e=0,i=Activity.ins().activityData,s=Object.keys(i);if(s.length)for(var n in i){var o=i[n],a=GlobalConfig.ActivityBtnConfig[o.id];a&&a.showType==StateShowType.TYPE_13&&0==a.type&&(t=o.pageStyle,e=o.id)}t?ViewManager.ins().openBySkin(ComActivityWin,"ActivityWinSkin",t,e):ViewManager.ins().open(ActivityWin,e),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(BossRevelryRule.prototype,"BossRevelryRule"),window.BossRevelryRule=BossRevelryRule;var CDkeyIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[FuLiCT.ins().postMoneyInfoChange,NoticeCT.ins().postGameNotice,DailyCheckIn.ins().postCheckInData,Activity.ins().postSevendayIsAwards,Recharge.ins().postFranchiseInfo,Activity.ins().postActivityIsGetAwards,FangpianRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FULI)&&!LocationProperty.isIosTS},e.prototype.checkShowRedPoint=function(){return DailyCheckIn.ins().showRedPoint()||Activity.ins().getSevenDayStast()||Recharge.ins().franchise&&Recharge.ins().franchiseget||Activity.ins().checkNoticeRed()?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(FuliWin),this.update()},e}(RuleIconBase);__reflect(CDkeyIconRule.prototype,"CDkeyIconRule"),window.CDkeyIconRule=CDkeyIconRule;var CDRechargeRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.CDRECHARGE))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.CDRECHARGE&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.CDRECHARGE&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(CDRechargeWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(CDRechargeRule.prototype,"CDRechargeRule"),window.CDRechargeRule=CDRechargeRule;var ChatMessageIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ChatWin)},e}(RuleIconBase);__reflect(ChatMessageIconRule.prototype,"ChatMessageIconRule"),window.ChatMessageIconRule=ChatMessageIconRule;var CityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return GameMap.sceneInMain()&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){return OpenSystem.ins().checkSysOpen(SystemType.CITY)&&GameMap.sceneInMain()?Encounter.ins().isEncounter()?void TipsCT.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|"):void(CityCC.ins().enterCD<1?CityCC.ins().sendEnter():TipsCT.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城")):void 0},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(CityIconRule.prototype,"CityIconRule"),window.CityIconRule=CityIconRule;var CityMonsterIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.processMc=new MovieClip,s.showMessage=[Actor.ins().postLevelChange,GameApp.ins().postZeroInit,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[CityCC.ins().postBossInfo,CityCC.ins().postCityBossId],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.monHead=e.monHead,this.process=e.process,this.processGroup=e.processGroup,this.processMc.parent||this.processGroup.addChild(this.processMc),this.processMc.isPlaying||this.processMc.playFile(RES_DIR_EFF+"MonsterEff1",-1),e},e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:(this.updateIcon(),GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(SystemType.CITYMONSTER)&&!KFBossSys.ins().fieldisOpen)},e.prototype.checkShowRedPoint=function(){this.updateIcon();var t=CityCC.ins().cityBossId&&CityCC.ins().getCityBossConfig(CityCC.ins().cityBossId);return t?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(BossWin,3)},e.prototype.getEffName=function(t){},e.prototype.updateIcon=function(){var t=CityCC.ins().cityBossId;if(0!=t&&CityCC.ins().getCityBossConfig(t))this.curAngle=360;else{var e=CityCC.ins().getMaxKillNumBoss(),i=e[0],s=e[1];t=i,this.curAngle=MathUtils.toInteger(360*s)}this.isShow&&this.processMc&&this.processMc.playFile(RES_DIR_EFF+"MonsterEff1",-1),GlobalConfig.MonstersConfig[t]&&this.monHead&&(this.monHead.source="monhead"+GlobalConfig.MonstersConfig[t].head+"_png")},Object.defineProperty(e.prototype,"curAngle",{set:function(t){this.processMc&&this.processMc.drawAngle(t)},enumerable:!0,configurable:!0}),e}(RuleIconBase);__reflect(CityMonsterIconRule.prototype,"CityMonsterIconRule"),window.CityMonsterIconRule=CityMonsterIconRule;var CollectionIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){return urlParam.appid==PlatFormID.QQ_BROWSER||urlParam.appid==PlatFormID.XIN_LANG},e.prototype.tapExecute=function(){window.sendToDesktop()},e}(RuleIconBase);__reflect(CollectionIconRule.prototype,"CollectionIconRule"),window.CollectionIconRule=CollectionIconRule;var ActivityType48Data=function(t){function e(e){var i=t.call(this,e)||this;return i.discountInfos={},i.update(e),i}return __extends(e,t),e.prototype.update=function(t){for(var e=t.readShort(),i=0;e>i;i++){var s={id:t.readInt(),discount:t.readDouble(),price:t.readInt(),num:t.readInt()};this.discountInfos[s.id]=s}},e.prototype.canBuyNum=function(t){var e=GlobalConfig.ActivityType48Config[this.id][t];return Math.max(0,e.max-(this.discountInfos[t]?this.discountInfos[t].num:0))},e.prototype.getCurDiscount=function(t){return null==this.discountInfos[t]?0:this.discountInfos[t].discount},e.prototype.getCurPrice=function(t){return null==this.discountInfos[t]?0:this.discountInfos[t].price},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType48Config[this.id];for(var e in t)if(this.canBuyNum(t[e].index)>0)return!0;return!1},e.prototype.isOpenActivity=function(){var t=GlobalConfig.ActivityType48Config[this.id],e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t&&0>e&&i>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType48Data.prototype,"ActivityType48Data"),window.ActivityType48Data=ActivityType48Data;var ComActivityIconRule10=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity10,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule10.prototype,"ComActivityIconRule10"),window.ComActivityIconRule10=ComActivityIconRule10;var ComActivityIconRule11=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity11,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule11.prototype,"ComActivityIconRule11"),window.ComActivityIconRule11=ComActivityIconRule11;var ComActivityIconRule12=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity12,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule12.prototype,"ComActivityIconRule12"),window.ComActivityIconRule12=ComActivityIconRule12;var ComActivityIconRule30=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity30,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule30.prototype,"ComActivityIconRule30"),window.ComActivityIconRule30=ComActivityIconRule30;var ComActivityIconRule31=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity31,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule31.prototype,"ComActivityIconRule31"),window.ComActivityIconRule31=ComActivityIconRule31;var ComActivityIconRule32=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity32,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule32.prototype,"ComActivityIconRule32"),window.ComActivityIconRule32=ComActivityIconRule32;var ComActivityIconRule33=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity33,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule33.prototype,"ComActivityIconRule33"),window.ComActivityIconRule33=ComActivityIconRule33;var ComActivityIconRule34=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity34,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule34.prototype,"ComActivityIconRule34"),window.ComActivityIconRule34=ComActivityIconRule34;var ComActivityIconRule35=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity35,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule35.prototype,"ComActivityIconRule35"),window.ComActivityIconRule35=ComActivityIconRule35;var ComActivityIconRule36=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity36,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule36.prototype,"ComActivityIconRule36"),window.ComActivityIconRule36=ComActivityIconRule36;var ComActivityIconRule37=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity37,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule37.prototype,"ComActivityIconRule37"),window.ComActivityIconRule37=ComActivityIconRule37;var ComActivityIconRule38=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity38,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule38.prototype,"ComActivityIconRule38"),window.ComActivityIconRule38=ComActivityIconRule38;var ComActivityIconRule39=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity39,e}return __extends(e,t),e}(ComActivityIconRule);__reflect(ComActivityIconRule39.prototype,"ComActivityIconRule39"),window.ComActivityIconRule39=ComActivityIconRule39;var ContestRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ContestCT.ins().postContestStatus,ZsCT.ins().postZsLv],s.updateMessage=[ContestRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return ContestCT.ins().checkOpen()},e.prototype.checkShowRedPoint=function(){return ContestRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(ContestWin)},e}(RuleIconBase);__reflect(ContestRule.prototype,"ContestRule"),window.ContestRule=ContestRule;var ContinuityRule=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageStyle=ActivityPageStyle.Activity3_13,e}return __extends(e,t),e.prototype.tapExecute=function(){ViewManager.ins().openBySkin(ComActivityWin,"HideActWinSkin",this.pageStyle),this.update()},e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(this.systemId))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==this.pageStyle&&s.isOpenActivity()&&!s.getHide()){this.actID=+i;var n=Activity.ins().getActivityDataById(this.actID),o=GlobalConfig.ActivityType3Config[this.actID];for(var a in o)if(0==(n.recrod>>+a&1))return!0}}return!1},e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setRepeat(),e},e.prototype.setRepeat=function(){var t=Activity.ins().getActivityDataById(this.actID);if(!(t&&t.endTime>0))return void Timer.stopAll(this);Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this);
var e=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3),i="";e>0&&(i=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_1)),this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+i+"</font>")},e}(ComActivityIconRule);__reflect(ContinuityRule.prototype,"ContinuityRule"),window.ContinuityRule=ContinuityRule;var CorssGuildBattleRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[CrossGuildBattleCT.ins().postStatus],s.updateMessage=[VipCT.ins().postOpenServerVip,CrossGuildBattleRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=75,e},e.prototype.checkShowIcon=function(){return CrossGuildBattleCT.ins().checkOpen()&&CrossGuildBattleCT.ins().stageFullType>Battle_FullStatus.None&&CrossGuildBattleCT.ins().stageFullType<Battle_FullStatus.Over},e.prototype.checkShowRedPoint=function(){return this.alertText.text=CrossGuildBattleCT.ins().getStatusName(),CrossGuildBattleRedPoint.ins().redPoint?1:0},e.prototype.getEffName=function(t){var e=CrossGuildBattleCT.ins();return 2==e.checkType()&&e.fbCanEnter&&e.checkMyGuild()&&e.checkMine()?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(CrossGuildBattleWin)},e}(RuleIconBase);__reflect(CorssGuildBattleRule.prototype,"CorssGuildBattleRule"),window.CorssGuildBattleRule=CorssGuildBattleRule;var CumulativeRechargeRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,TaskCT.ins().postUpdteTaskTrace,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards,CumRechargeCT.ins().postLifelongAward],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isTSServer?!1:LocationProperty.isIosTS?!1:OpenSystem.ins().checkSysOpen(SystemType.CUMULRECHARGE)?(0==Setting.ins().getValue(ClientSet.gmActivity)&&(ViewManager.ins().open(GMActivityWin),this.updateArrow(!0)),!0):!1},e.prototype.checkShowRedPoint=function(){return CumRechargeCT.ins().dailyRp()||CumRechargeCT.ins().totalRp()?1:0},e.prototype.updateArrow=function(t){if(t){var e=this.getTar();if(!e)return;this.arrow||(this.arrow=new GuideArrow,this.arrow.currentState="right",this.arrow.lab.text="点击打开",this.arrow.x=70,this.arrow.y=35,egret.Tween.get(this.arrow,{loop:!0}).to({x:30},1e3).to({x:70},1e3)),e.addChild(this.arrow)}else this.arrow&&(egret.Tween.removeTweens(this.arrow),DisplayUtils.removeFromParent(this.arrow))},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(CumulativeRechargeWin),e.firstTap&&(e.firstTap=!1,this.update(),this.updateArrow(!1))},e.firstTap=!0,e}(RuleIconBase);__reflect(CumulativeRechargeRule.prototype,"CumulativeRechargeRule"),window.CumulativeRechargeRule=CumulativeRechargeRule;var DartIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[CrossDartCT.ins().postOpenNotice,GameServer.ins().postServerOpenDay,Guild.ins().postGuildInfo,Guild.ins().postUpBuilding,ZsCT.ins().postZsData],s.updateMessage=[DartRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return CrossDartCT.ins().checkOpen()&&CrossDartCT.ins().openState==CrossDartCT.STATE_MOVE},e.prototype.checkShowRedPoint=function(){return CrossDartCT.ins().checkOpen()&&DartRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(CrossDartWin)},e}(RuleIconBase);__reflect(DartIconRule.prototype,"DartIconRule"),window.DartIconRule=DartIconRule;var DemonCirIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[DemonCir.ins().postTask,DemonCir.ins().postRoleDatas,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return!DemonCir.ins().checkOpen()||DemonCir.ins().checkActived()?!1:!0},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(RuneWin,0,0,!0),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(DemonCirIconRule.prototype,"DemonCirIconRule"),window.DemonCirIconRule=DemonCirIconRule;var DesktopIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postGameDesktop,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&!!PfActivity.ins().isShowGameDesktop},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){PfActivity.ins().saveGameDesktop()},e}(RuleIconBase);__reflect(DesktopIconRule.prototype,"DesktopIconRule"),window.DesktopIconRule=DesktopIconRule;var DevilBossRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,DevildomSys.ins().postBossInfo,DevildomSys.ins().postInfo,DevildomSys.ins().postShowIcon],s.updateMessage=[Actor.ins().postLevelChange],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,this.alertText.text="",e.addChild(this.alertText),this.alertText.y=75,this.updateShow(),e},e.prototype.updateShow=function(){if(t.prototype.updateShow.call(this),this.tar){var e=DevildomSys.ins();this.alertText.text="",e.openTime>0?this.alertText.text=DateUtils.getFormatBySecond(e.openTime,DateUtils.TIME_FORMAT_5,4):!e.bossState&&e.killedState[e.bossId]?(this.alertText.textColor=15937822,this.alertText.text="魔主已击杀"):!e.bossState&&e.killedState[e.bossId]&&(this.alertText.textColor=3532333,this.alertText.text="魔主降临")}},e.prototype.canShow=function(){var t=DevildomSys.ins();if(t.isOpen()){var e=GlobalConfig.DevilBossConfig,i=[];for(var s in t.killedState)i[s]=!(e[s].isBoss||t.killedState[s]||t.historyId&&t.historyId!=Number(s));var n=!t.bossState&&!!t.killedState&&!t.killedState[t.bossId];return i.indexOf(!0)>-1||n}},e.prototype.checkShowIcon=function(){return(this.canShow()||DevildomSys.ins().isInit)&&DevildomSys.ins().isOpen()},e.prototype.checkShowRedPoint=function(){return this.canShow()&&DevildomSys.ins().isOpen()},e.prototype.tapExecute=function(){ViewManager.ins().open(DevilInvadeWin)},e}(RuleIconBase);__reflect(DevilBossRule.prototype,"DevilBossRule"),window.DevilBossRule=DevilBossRule;var ExpGoldIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=s.updateMessage=[VipCT.ins().postUpdateVipAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return 0==(VipCT.ins().state>>2&1)},e.prototype.checkShowRedPoint=function(){var t=0==(VipCT.ins().state>>2&1)&&Actor.vip>=3;return t?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(Vip3Win),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ExpGoldIconRule.prototype,"ExpGoldIconRule"),window.ExpGoldIconRule=ExpGoldIconRule;var FashionLeasingRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._activityID=0,s.showMessage=[Activity.ins().postActivityIsGetAwards],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.size=14,this._timeTxt.width=120,this._timeTxt.textAlign="center",this._timeTxt.textColor=3532333,this._timeTxt.horizontalCenter=0,e.addChild(this._timeTxt),this._timeTxt.y=75,this.setState(),e},e.prototype.setState=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}},e.prototype.setRepeat=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12))}else Timer.stopAll(this)},e.prototype.checkShowIcon=function(){var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length||!OpenSystem.ins().checkSysOpen(SystemType.FASHIONLEASING))return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.FASHIONLEASING&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,this.setState(),!0}return!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(FashionLeasingWin,this._activityID)},e}(RuleIconBase);__reflect(FashionLeasingRule.prototype,"FashionLeasingRule"),window.FashionLeasingRule=FashionLeasingRule;var FbBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,TaskCT.ins().postUpdteTaskTrace,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[FbRedPoint.ins().postFb],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FB)},e.prototype.checkShowRedPoint=function(){return FbRedPoint.ins().fb?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(FbWin)},e}(RuleIconBase);__reflect(FbBtnIconRule.prototype,"FbBtnIconRule"),window.FbBtnIconRule=FbBtnIconRule;var FengceIconRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:OpenSystem.ins().checkSysOpen(SystemType.FENGCE)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(FengceActivityWin)},e}(RuleIconBase);__reflect(FengceIconRule.prototype,"FengceIconRule"),window.FengceIconRule=FengceIconRule;var FirstRechargeIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.isShowTips=!1,s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx,Recharge.ins().postRecharge1Data],s.updateMessage=[Recharge.ins().postUpdateRecharge,Recharge.ins().postUpdateRechargeEx,Actor.ins().postExp,TipsCT.ins().postFirstRechargeTips,Recharge.ins().postRecharge1Data],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(this.tar&&this.tar.hasEventListener(egret.Event.ENTER_FRAME)&&this.tar.removeEventListener(egret.Event.ENTER_FRAME,this.timeCB,this),LocationProperty.isIosTS)return!1;if(urlParam.nofr)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE))return!1;if(!Recharge.ins().isOpenIosRecharge)return!1;if(Recharge.ins().getCurDailyRechargeIsAllGet())return!1;if(this.tar){var t=Recharge.ins().getRechargeData(0);2!=t.num?this.tar.icon="zjmshouchong":t.isAwards?this.tar.icon="zjmlibao":this.tar.icon="zjmshouchong2"}return!0},e.prototype.createTar=function(){t.prototype.createTar.call(this);var e=Recharge.ins().getRechargeData(0);return 2!=e.num?this.tar.icon="zjmshouchong":e.isAwards?this.tar.icon="zjmlibao":this.tar.icon="zjmshouchong2",this.tar},e.prototype.checkShowRedPoint=function(){var t=Recharge.ins().getRechargeData(0);if(!t.num){var e=Setting.ins().getValue(ClientSet.diedFirstTime2),i=Setting.ins().getValue(ClientSet.recharge2),s=Setting.ins().getValue(ClientSet.recharge1),n=!1;e&&e>0&&!i?(Setting.ins().setValue(ClientSet.recharge2,DieGuide.Show),n=!0):Actor.level>=30&&!s&&(Setting.ins().setValue(ClientSet.recharge1,DieGuide.Show),n=!0),n&&this.showImage()}var o=Recharge.ins().getRechargeData(0),a=o.firstRewardStateByDay(o.firstPayDay());return 1==a&&2!=o.num?1:0},e.prototype.showTips=function(){var t=Recharge.ins().getRechargeData(0);if((!t||0==t.num)&&TipsCT.ins().TipsTime>GameServer.serverTime){if(this.tar.hasEventListener(egret.Event.ENTER_FRAME)||this.tar.addEventListener(egret.Event.ENTER_FRAME,this.timeCB,this),this.isShowTips)return;this.isShowTips=!0;var e=this.group||new eui.Group;e.y=-82,e.touchThrough=!0,e.touchEnabled=!1,e.touchChildren=!1,this.group=e,this.tar.addChild(e);var i=this.tips||new eui.Image;i.source="kfTixing_png",this.tips=i,this.group.addChild(i);var s=this.tipsTimer||new eui.Label;this.tipsTimer=s,s.text="",s.size=15,s.y=45,s.horizontalCenter=-8,s.textColor=16703053,this.group.addChild(s),this.group.x=-7,this.group.y=-60}else this.isShowTips=!1,DisplayUtils.removeFromParent(this.tips),this.tips=null,DisplayUtils.removeFromParent(this.tipsTimer),this.tipsTimer=null,this.tar&&this.tar.hasEventListener(egret.Event.ENTER_FRAME)&&this.tar.removeEventListener(egret.Event.ENTER_FRAME,this.timeCB,this)},e.prototype.timeCB=function(){var t=(TipsCT.ins().TipsTime-GameServer.serverTime)/1e3;this.tipsTimer&&(this.tipsTimer.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_17)),TipsCT.ins().TipsTime>GameServer.serverTime||Timer.stop(this.timeCB,this)},e.prototype.showImage=function(){var t=this.v||new eui.Image;t.source="swyd_firstrecharge_png",t.x=70,t.y=-75,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapExecute,this),this.v=t,this.tar.addChild(t)},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){DisplayUtils.removeFromParent(this.v);var t=Recharge.ins().getRechargeData(0);2==t.num?ViewManager.ins().open(Recharge2Win):ViewManager.ins().open(Recharge1Win)},e}(RuleIconBase);__reflect(FirstRechargeIconRule.prototype,"FirstRechargeIconRule"),window.FirstRechargeIconRule=FirstRechargeIconRule;var FocusIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,PfActivity.ins().postGuanZhu,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.FOCUS)&&0==PfActivity.ins().focusState},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.tapExecute=function(){ViewManager.ins().open(FocusWin)},e}(RuleIconBase);__reflect(FocusIconRule.prototype,"FocusIconRule"),window.FocusIconRule=FocusIconRule;var FriendsIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange],s.updateMessage=[Friends.ins().postFriendChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:Actor.level>=70},e.prototype.checkShowRedPoint=function(){var t=0;if(Object.keys(Friends.ins().newMsg).length>0)for(var e in Friends.ins().newMsg){var i=Friends.ins().newMsg[e];if(1==i){t++;break}}return Friends.ins().appList.length>0&&t++,t},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.FriendLimit.sysLv){var t=GlobalConfig.FriendLimit.sysLv>1e3?(GlobalConfig.FriendLimit.sysLv/1e3>>0)+"转":"",e=GlobalConfig.FriendLimit.sysLv>1e3?GlobalConfig.FriendLimit.sysLv%1e3+"级":GlobalConfig.FriendLimit.sysLv+"级";TipsCT.ins().showTips(""+t+e+"开启好友功能")}else ViewManager.ins().open(FriendBgWin)},e}(RuleIconBase);__reflect(FriendsIconRule.prototype,"FriendsIconRule"),window.FriendsIconRule=FriendsIconRule;var FunctionOpenIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,GameApp.ins().postZeroInit,GameLogic.ins().postFunsShow],s.updateMessage=[GameLogic.ins().postFunsShow],s}return __extends(e,t),e.prototype.checkShowIcon=function(){this.cfgs=ActivityForeshowModel.ins().getForeshow();var t=null!=this.cfgs;if(t){for(var e in this.cfgs)if(2!=ActivityForeshowModel.ins().getFunsShowAwardById(this.cfgs[e].id))return!0;t=!1}return t},e.prototype.updateInfo=function(){this.cfgs&&(this.iconDisplay.source=this.cfgs[0].icon,this.setLessTimer(),Timer.start(1e3,0,this.setLessTimer,this))},e.prototype.setLessTimer=function(){if(this.cfgs){var t=DateUtils.formatMiniDateTime(GameServer._serverZeroTime),e=24*(this.cfgs[0].recDay-1)*60*60*1e3-(GameServer.serverTime-t);e=e>0?e:0;var i=DateUtils.getFormatBySecond(e/1e3);this.alertText.text=""+i,0==e&&(this.alertText.text="",Timer.stop(this.setLessTimer,this))}},e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=75,this.iconDisplay=e.iconDisplay,this.updateInfo(),e},e.prototype.checkShowRedPoint=function(){for(var t in this.cfgs)if(1==ActivityForeshowModel.ins().getFunsShowAwardById(this.cfgs[t].id))return 1;return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(FuncShowWin,this.cfgs),e.firstTap&&(e.firstTap=!1)},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.firstTap=!0,e}(RuleIconBase);__reflect(FunctionOpenIconRule.prototype,"FunctionOpenIconRule"),window.FunctionOpenIconRule=FunctionOpenIconRule;var GodWeaponIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsLv,Actor.ins().postLevelChange,GameApp.ins().postZeroInit],s.updateMessage=[GodWeaponRedPoint.ins().postGodWeapon],s}return __extends(e,t),e.prototype.checkShowRedPoint=function(){var t=GodWeaponRedPoint.ins().godWeaponRed?1:0;return t},e.prototype.checkShowIcon=function(){return Actor.level>=GlobalConfig.GodWeaponBaseConfig.noticeOpenLv&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:!1},e.prototype.tapExecute=function(){ViewManager.ins().open(GodWeaponWin)},e}(RuleIconBase);__reflect(GodWeaponIconRule.prototype,"GodWeaponIconRule"),window.GodWeaponIconRule=GodWeaponIconRule;var GodWeaponRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsLv,Actor.ins().postLevelChange,GameApp.ins().postZeroInit,GodWeaponCC.ins().postUpdateInfo],s.updateMessage=[GodWeaponRedPoint.ins().postGodWeapon,GodWeaponRedPoint.ins().postGwSb],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=GlobalConfig.GodWeaponBaseConfig,e=t.zhuanshengLevel,i=t.openDay;if(ZsCT.ins().lv>=e&&GameServer.serverOpenDay>=i)for(var s=1;3>=s;s++)if(!GodWeaponCC.ins().weaponIsActive(s))return!0;return!1},e.prototype.checkShowRedPoint=function(){return GodWeaponRedPoint.ins().gwSbRed},e.prototype.tapExecute=function(){ViewManager.ins().open(ForgeWin,0,0,!0)},e}(RuleIconBase);__reflect(GodWeaponRule.prototype,"GodWeaponRule"),window.GodWeaponRule=GodWeaponRule;var GuangqiaIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.canChallen=!1,s.showMessage=[GameLogic.ins().postEnterMap,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,TaskCT.ins().postUpdteTaskTrace,FbCT.ins().postAutoPk,FbCT.ins().postAutoPk2],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return FbCT.ins().checkGuanqiaIconShow()&&GameMap.sceneInMain()},e.prototype.upDateGuanqiaWroldReward=function(){var t=FbCT.ins().getWorldGuanQia();return FbCT.ins().isReceiveBox(t)?1:0},e.prototype.getEffName=function(t){var e="";return e},e.prototype.tapExecute=function(){},e}(RuleIconBase);__reflect(GuangqiaIconRule.prototype,"GuangqiaIconRule"),window.GuangqiaIconRule=GuangqiaIconRule;var GuideTaskIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,ZsCT.ins().postZsData,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[PActivity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,BagCT.ins().postItemAdd,BagCT.ins().postItemChange,BagCT.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.NEWGUIDETASK))return!1;var t=PActivity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.NewGuideTask&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=PActivity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.NewGuideTask&&i.isOpenActivity()&&i.canReward())return 1}return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(GuideTaskWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(GuideTaskIconRule.prototype,"GuideTaskIconRule"),window.GuideTaskIconRule=GuideTaskIconRule;var GuildFBRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData,GuildFBCT.ins().postInfo,GuildFBCT.ins().postCheckOpenTime],s.updateMessage=[GuildFBRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.size=14,this._timeTxt.width=120,this._timeTxt.textAlign="center",this._timeTxt.textColor=3532333,this._timeTxt.horizontalCenter=0,e.addChild(this._timeTxt),this._timeTxt.y=75,this.setState(),e},e.prototype.setState=function(){this.setRepeat(),GuildFBCT.ins().isOpenTime&&(Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))},e.prototype.setRepeat=function(){if(GuildFBCT.ins().isOpenTime){var t=DateUtils.SECOND_PER_DAY-DateUtils.getTodayPassedSecond();t>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12))}else Timer.stopAll(this)},e.prototype.checkShowIcon=function(){return GuildFBCT.checkOpen()&&GuildFBCT.ins().isOpenTime},e.prototype.checkShowRedPoint=function(){return GuildFBRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(GuildFBWin)},e}(RuleIconBase);__reflect(GuildFBRule.prototype,"GuildFBRule"),egret.registerClass(GuildFBRule,"GuildFBRule"),window.GuildFBRule=GuildFBRule;var GuildIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.isInit=!0,s.showMessage=[Actor.ins().postLevelChange],s.updateMessage=[GuildRedPoint.ins().postHanghui],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=!LocationProperty.isIosTS&&Actor.level>=GlobalConfig.GuildConfig.openLevel;return t&&this.isInit&&(this.isInit=!1,Guild.ins().sendConCount()),t},e.prototype.checkShowRedPoint=function(){if(!Guild.ins().guildID&&Actor.level<80&&!this.rule3cz&&e.firstTap){var t=this.rule3cz||new eui.Image;t.source="yd_guild_png",t.x=-50,t.y=70,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapExecute,this),this.tar.addChild(t),this.rule3cz=t}return GuildRedPoint.ins().hanghui},e.prototype.tapExecute=function(){Actor.level>=GlobalConfig.GuildConfig.openLevel?(3==this.id&&(DisplayUtils.removeFromParent(this.rule3cz),e.firstTap=!1),void 0==Guild.ins().guildID||0==Guild.ins().guildID?ViewManager.ins().open(GuildApplyWin):ViewManager.ins().open(GuildMap)):TipsCT.ins().showTips(GlobalConfig.GuildConfig.openLevel+"级开启")},e.firstTap=!0,e}(RuleIconBase);__reflect(GuildIconRule.prototype,"GuildIconRule"),window.GuildIconRule=GuildIconRule;var GuildWarIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GuildWar.ins().postGuildWarStarInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return!LocationProperty.isIosTS&&1==GuildWar.ins().getModel().getIsShowGuildWarBtn()},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){return void 0==Guild.ins().guildID||0==Guild.ins().guildID?void TipsCT.ins().showTips("|C:0xf3311e&T:加入公会后才能参与沙城争霸活动|"):(GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),void ViewManager.ins().open(GuildWarMainWin))},e}(RuleIconBase);__reflect(GuildWarIconRule.prototype,"GuildWarIconRule"),window.GuildWarIconRule=GuildWarIconRule;var GuildWarRedBagIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[GuildRedPoint.ins().postRedBag],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(RedBagWin)},e}(RuleIconBase);__reflect(GuildWarRedBagIconRule.prototype,"GuildWarRedBagIconRule"),window.GuildWarRedBagIconRule=GuildWarRedBagIconRule;var HappySevenDayIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s._activityID=0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.HAPPYSEVENDAY))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=40,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){var t=GlobalConfig.ActivityConfig[this._activityID];t&&"SpringDayWin"==t.pageSkin?ViewManager.ins().open(HappySevenDayWin2,this._activityID,ActivityPageStyle.HAPPYSEVENDAY,ActivityType.Normal):ViewManager.ins().open(HappySevenDayWin,this._activityID,ActivityPageStyle.HAPPYSEVENDAY,ActivityType.Normal),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(HappySevenDayIconRule.prototype,"HappySevenDayIconRule"),window.HappySevenDayIconRule=HappySevenDayIconRule;var HejiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;s.showMessage=[TaskCT.ins().postUpdteTaskTrace];var n=SubRoles.ins().getSubRoleByIndex(0);s.guangquan=i.guangquan,s.questNumber=i.questNumber,s.skillName=i.skillName,s.Img=i.Img,s.bgimg=i.bgimg,s.imggroup=i.imggroup,s.eff=i.eff,s.skillName.source="8000"+n.job+"_png",s.questNumber.text="0",s.Img.source="7"+n.job+"000_png",s.bgimg.source="7"+n.job+"000b_png",s.mc=new MovieClip,s.eff.addChild(s.mc),s.prossY=0;var o=s.Img.localToGlobal();s.imggroup.globalToLocal(o.x,o.y,o),s.masksp=new egret.Sprite;var a=new egret.Shape;a.graphics.beginFill(16777215),a.graphics.drawRect(o.x,o.y,s.Img.width,s.Img.height),a.graphics.endFill(),s.prossY=o.y+s.Img.height,s.masksp.y=s.prossY,s.masksp.addChild(a),s.imggroup.addChild(s.masksp),s.Img.mask=s.masksp;var r=s.updatekStep();return s.updatePross(r),s}return __extends(e,t),e.prototype.checkShowIcon=function(){return TaskCT.ins().taskTrace?FbCT.ins().pkGqboss?!1:TaskCT.ins().taskTrace.id>=TargetWin.TASKID?(this.mc.parent&&DisplayUtils.removeFromParent(this.mc),!1):!0:!1},e.prototype.updatekStep=function(t){if(!TaskCT.ins().taskTrace)return 0;if(TaskCT.ins().taskTrace.id>=TargetWin.TASKID)return 0;var e=function(e){if(TaskCT.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[e].taskId){var s=GlobalConfig.AchievementTaskConfig[e].index,n=s;t&&(n=s+1),i.questNumber.text=TargetWin.TASKID%100-n+1+"";var o=i;return t?(i.showEff(function(){o.updatePross(s)}),{value:s>0?s:0}):{value:1>=s?0:s}}},i=this;for(var s in GlobalConfig.AchievementTaskConfig){var n=e(s);if("object"==typeof n)return n.value}return 0},e.prototype.showEff=function(t){var e=ViewManager.ins().getView(PlayFunView);if(e){var i=e.taskTraceName,s=i.localToGlobal();e.globalToLocal(s.x,s.y,s),this.jumpmc||(this.jumpmc=new MovieClip,this.jumpmc.playFile(RES_DIR_EFF+"pulse2",-1)),this.jumpmc.parent||e.addChild(this.jumpmc),this.jumpmc.x=s.x+e.taskTraceBtn.width/2,this.jumpmc.y=s.y,s=e.hejiguide.localToGlobal(),e.globalToLocal(s.x,s.y,s);var n=this;egret.Tween.get(this.jumpmc).to({x:s.x+e.hejiguide.width/2,y:s.y+e.hejiguide.height/2},600).call(function(){n.mc.parent||n.eff.addChild(n.mc),n.mc.playFile(RES_DIR_EFF+"CircleEff1",1,function(){DisplayUtils.removeFromParent(n.mc)}),egret.Tween.removeTweens(n.jumpmc),DisplayUtils.removeFromParent(n.jumpmc),t&&"function"==typeof t&&t()})}},e.prototype.updatePross=function(t){if(this.masksp){var e=t,i=TargetWin.TASKID%100,s=e/i;s=s>=1?1:s,this.masksp.y=this.prossY-Math.abs(this.prossY)*s}},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(TargetWin,TargetWin.HEJI),Artifact.ins().showGuide=-2e3},e.prototype.getEffName=function(t){},e}(RuleIconBase);__reflect(HejiIconRule.prototype,"HejiIconRule"),window.HejiIconRule=HejiIconRule;var KFArenaRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[ZsCT.ins().postZsData,KfArenaSys.ins().postMacthState,KfArenaSys.ins().postOpenKfArena],s.updateMessage=[KfArenaRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),this.setState(),e},e.prototype.setRepeat=function(){this._time-egret.getTimer()>0?this._timeTxt.text=DateUtils.getFormatBySecond((this._time-egret.getTimer())/1e3>>0,DateUtils.TIME_FORMAT_5,4):(KfArenaSys.ins().isStartIng=1,1==KfArenaSys.ins().macthState?this._timeTxt.text="匹配中":this._timeTxt.text="进行中",Timer.stopAll(this))},e.prototype.checkShowIcon=function(){var t=KfArenaSys.ins().isOpen();return this.setState(),t},e.prototype.setState=function(){var t=KfArenaSys.ins().isOpen();if(t&&this.tar)if(1==KfArenaSys.ins().macthState)this._timeTxt.text="匹配中";else if(1==KfArenaSys.ins().isStartIng)this._timeTxt.text="进行中";else{var e=KfArenaSys.ins().getOpenLeftTime();e>0&&(this._time=1e3*e+egret.getTimer(),this._timeTxt.text=DateUtils.getFormatBySecond((this._time-egret.getTimer())/1e3>>0,DateUtils.TIME_FORMAT_5,4),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}},e.prototype.checkShowRedPoint=function(){return KfArenaRedPoint.ins().redpoint},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(KfArenaWin,KfArenaWin.Page_Select_Macth)},e}(RuleIconBase);__reflect(KFArenaRule.prototype,"KFArenaRule"),window.KFArenaRule=KFArenaRule;var KFIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameServer.ins().postServerOpenDay,ZsCT.ins().postZsData],s.updateMessage=[Actor.ins().postLevelChange,DevildomRedPoint.ins().postRedPoint,KfArenaRedPoint.ins().postRedPoint,DartRedPoint.ins().postRedPoint,PeakedRedpoint.ins().postRedPoint,CrossGuildBattleRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return KFBossSys.ins().fieldisOpen},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"kfzhanchang"},e.prototype.checkShowRedPoint=function(){return(1==DevildomRedPoint.ins().redPoint||DevildomRedPoint.ins().bossRedPoint)&&DevildomSys.ins().isOpen()||0!=KfArenaRedPoint.ins().redpoint||DartRedPoint.ins().redPoint||0!=PeakedRedpoint.ins().redpoint||CrossGuildBattleRedPoint.ins().redPoint},e.prototype.tapExecute=function(){ViewManager.ins().open(KFBattleWin)
},e}(RuleIconBase);__reflect(KFIconRule.prototype,"KFIconRule"),window.KFIconRule=KFIconRule;var KingEquipRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.init,ZsCT.ins().postZsData,KingEquipCT.ins().postInit],s.updateMessage=[KingEquipRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return KingEquipCT.ins().checkOpen()},e.prototype.checkShowRedPoint=function(){return KingEquipRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(KingEquipMainWin)},e}(RuleIconBase);__reflect(KingEquipRule.prototype,"KingEquipRule"),window.KingEquipRule=KingEquipRule;var LabaIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.LABA))return!1;var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.LABA){if(i.type==ActivityDataType._41){var s=OpenSystem.ins().checkSysOpen(SystemType.INVESTMENT);return!Setting.ins().getValue(ClientSet.firstTouZi)&&s&&(Setting.ins().setValue(ClientSet.firstTouZi,1),this.tapExecute()),s}if(i.isOpenActivity()&&!i.getHide())return!0}}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.LABA&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){OpenSystem.ins().checkSysOpen(SystemType.LABA)&&(ViewManager.ins().open(LabaWin),e.firstTap&&(e.firstTap=!1,this.update()))},e.firstTap=!0,e}(RuleIconBase);__reflect(LabaIconRule.prototype,"LabaIconRule"),window.LabaIconRule=LabaIconRule;var LadderBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameLogic.ins().postEnterMap,Actor.ins().postLevelChange,FbCT.ins().postGuanKaIdChange,TaskCT.ins().postUpdteTaskTrace],s.updateMessage=[Ladder.ins().postTadderChange,Encounter.ins().postEncounterDataChange,Mine.ins().postRedPoint,KFBattleRedPoint.ins().postRedPoint,FbCT.ins().postShowRedChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return FbCT.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel&&!Encounter.ins().isGuiding},e.prototype.checkShowRedPoint=function(){var t=Encounter.ins().isHasRed();return t?t:Ladder.ins().checkRedShow()?1:Mine.redpointCheck()?1:(Ladder.ins().isCanReward||Ladder.ins().isOpen?Ladder.ins().challgeNum>0:!1)?1:PlayWayRedPoint.ins().redPoint?1:0},e.prototype.getEffName=function(t){},e.prototype.tapExecute=function(){ViewManager.ins().open(LadderWin,0)},e}(RuleIconBase);__reflect(LadderBtnIconRule.prototype,"LadderBtnIconRule"),window.LadderBtnIconRule=LadderBtnIconRule;var LegendTowerRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData,LegendTowerCT.ins().postInit,LegendTowerCT.ins().postEnroll,LegendTowerCT.ins().postPeriod],s.updateMessage=[LegendTowerCT.ins().postInit,LegendTowerCT.ins().postEnroll,LegendTowerCT.ins().postPeriod],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setState(),e},e.prototype.setState=function(){var t=LegendTowerCT.ins();t.checkOpen()&&this.tar&&(4==t.periodType?this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.RED+">已结束</font>"):3==t.periodType?this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">进行中</font>"):Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))},e.prototype.setRepeat=function(){var t=LegendTowerCT.ins().openTime-GameServer.serverTime,e=DateUtils.getFormatBySecond(Math.round(t/1e3),DateUtils.TIME_FORMAT_1);t>0?this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+e+"\n后开始</font>"):Timer.stopAll(this)},e.prototype.checkShowIcon=function(){return this.setState(),LegendTowerCT.ins().checkOpen()&&LegendTowerCT.ins().openType==open_Status.Open&&LegendTowerCT.ins().periodType>period_Status.None},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return LegendTowerCT.ins().checkOpen()&&LegendTowerCT.ins().openType==open_Status.Open&&LegendTowerCT.ins().periodType>period_Status.None?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(LegendTowerWin)},e}(RuleIconBase);__reflect(LegendTowerRule.prototype,"LegendTowerRule"),window.LegendTowerRule=LegendTowerRule;var LimitCheapieRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._activityID=0,s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.size=14,this._timeTxt.width=120,this._timeTxt.textAlign="center",this._timeTxt.textColor=3532333,this._timeTxt.horizontalCenter=0,e.addChild(this._timeTxt),this._timeTxt.y=75,this.setState(),e},e.prototype.setState=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}},e.prototype.setRepeat=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12))}else Timer.stopAll(this)},e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.LIMITCHEAPIE))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.LIMITCHEAPIE&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,this.setState(),!0}return!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitCheapieWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(LimitCheapieRule.prototype,"LimitCheapieRule"),window.LimitCheapieRule=LimitCheapieRule;var LimitedGiftRule=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasPAct=!0,e.systemId=SystemType.LIMITEDGIFT,e.pageStyle=ActivityPageStyle.LIMITEDGIFT,e}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setRepeat(),e},e.prototype.setRepeat=function(){if(!(this.actList.length>0))return void Timer.stopAll(this);this.actList.sort(Algorithm.sortAsc),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this);var t=Math.floor((DateUtils.formatMiniDateTime(this.actList[0])-GameServer.serverTime)/1e3),e="";t>0&&(e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1)),this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+e+"</font>")},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return null},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitedGiftWin)},e.ids=[],e}(ComActivityIconRule);__reflect(LimitedGiftRule.prototype,"LimitedGiftRule"),window.LimitedGiftRule=LimitedGiftRule;var LimitedGiftRule2=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasPAct=!0,e.systemId=SystemType.PActivity55,e.pageStyle=ActivityPageStyle.PActivity55,e}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setRepeat(),e},e.prototype.setRepeat=function(){if(!(this.actList.length>0))return void Timer.stopAll(this);this.actList.sort(Algorithm.sortAsc),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this);var t=Math.floor((DateUtils.formatMiniDateTime(this.actList[0])-GameServer.serverTime)/1e3),i="";t>0&&(i=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1)),this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+i+"</font>"),e.x=this.tar&&this.tar.x?this.tar.x:0,e.y=this.tar&&this.tar.y?this.tar.y:0,e.height=this.tar&&this.tar.height?this.tar.height:0,e.width=this.tar&&this.tar.width?this.tar.width:0},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitedGiftWin2)},e.x=0,e.y=0,e.height=0,e.width=0,e}(ComActivityIconRule);__reflect(LimitedGiftRule2.prototype,"LimitedGiftRule2"),window.LimitedGiftRule2=LimitedGiftRule2;var LimitGiftRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._activityID=0,s.firstTap=!0,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.size=14,this._timeTxt.width=120,this._timeTxt.textAlign="center",this._timeTxt.textColor=3532333,this._timeTxt.horizontalCenter=0,e.addChild(this._timeTxt),this._timeTxt.y=75,this.setState(),e},e.prototype.setState=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}},e.prototype.setRepeat=function(){var t=Activity.ins().activityData[this._activityID];if(t&&this.tar){var e=t.getLeftTime();e>=0&&(this._timeTxt.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_12))}else Timer.stopAll(this)},e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.LIMITGIFT))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.LIMITGIFT&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,this.setState(),!0}return!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitGiftWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(LimitGiftRule.prototype,"LimitGiftRule"),window.LimitGiftRule=LimitGiftRule;var LimitTaskIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,ZsCT.ins().postZsData,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[TaskCT.ins().postUpdteLimitTaskData],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=75,0==TaskCT.ins().limitTaskState?this.alertText.text="点击开放":(this.runTime(),Timer.start(1e3,0,this.runTime,this)),e},e.prototype.runTime=function(){var t=TaskCT.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);t>=0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):(this.alertText.text="活动结束",Timer.stop(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.LIMITTASK))return!1;if(LocationProperty.isTSServer)return!1;var t=GlobalConfig.LimitTimeConfig[TaskCT.ins().currTaskListsId];if(!t)return!1;if(TaskCT.ins().limitTaskEndTime>0)if(TaskCT.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)<0){if(!GlobalConfig.LimitTimeConfig[TaskCT.ins().currTaskListsId+1])return ViewManager.ins().close(LimitTaskView),!1}else if(!GlobalConfig.LimitTimeConfig[TaskCT.ins().currTaskListsId+1]&&8==TaskCT.ins().limitTaskCount)return this.updateShow(),Timer.start(1500,1,function(){ViewManager.ins().close(LimitTaskView)},this),!1;return-1!=TaskCT.ins().limitTaskState&&TaskCT.ins().limitTaskEndTime>0?!0:!0},e.prototype.checkShowRedPoint=function(){return TaskCT.ins().getLimitTaskRed()},e.prototype.tapExecute=function(){ViewManager.ins().open(LimitTaskView)},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e}(RuleIconBase);__reflect(LimitTaskIconRule.prototype,"LimitTaskIconRule"),window.LimitTaskIconRule=LimitTaskIconRule;var LoginIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.txt=new eui.Label,s.txt.text="次日领取",s.txt.textColor=3532333,s.txt.horizontalCenter=0,s.txt.y=75,s.txt.size=14,s.showMessage=[Activity.ins().postSevendayIsAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this),i=GlobalConfig.LoginRewardsConfig[Activity.ins().dayNum];return i&&i.nextIcon&&e&&(e.icon=i.nextIcon),e&&this.tar.addChild(this.txt),e},e.prototype.checkShowIcon=function(){var t=GlobalConfig.LoginRewardsConfig[Activity.ins().dayNum];return OpenSystem.ins().checkSysOpen(SystemType.FULI)&&!LocationProperty.isIosTS&&t&&null!=t.nextIcon&&""!=t.nextIcon},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(FuliWin,1)},e}(RuleIconBase);__reflect(LoginIconRule.prototype,"LoginIconRule"),window.LoginIconRule=LoginIconRule;var MaBiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,VipCT.ins().postUpdateVipAwards,VipCT.ins().postUpdataExp,VipCT.ins().postUpdateVipData,FbCT.ins().postGuanKaIdChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[VipCT.ins().postUpdataExp,Actor.ins().postExp],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:Recharge.ins().isOpenIosRecharge?OpenSystem.ins().checkSysOpen(SystemType.MABI)&&!(VipCT.ins().state>>2&1)&&(Actor.vip>=2||Actor.level>=80):!1},e.prototype.checkShowRedPoint=function(){if(!this.v){var t=Recharge.ins().getRechargeData(0),e=Setting.ins().getValue(ClientSet.diedFirstTime2),i=Setting.ins().getValue(ClientSet.vip);if(t.num&&e&&e>0&&Actor.vip<3&&!i){var s=this.v||new eui.Image;s.source="swyd_vip_png",s.x=70,s.y=-15,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapExecute,this),this.tar.addChild(s),this.v=s,Setting.ins().setValue(ClientSet.vip,DieGuide.Show)}}return Actor.vip>=3?1:0},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){this.firstTap=!1,DisplayUtils.removeFromParent(this.v),ViewManager.ins().open(Vip3MWin,3)},e}(RuleIconBase);__reflect(MaBiIconRule.prototype,"MaBiIconRule"),window.MaBiIconRule=MaBiIconRule;var MailIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[MailCT.ins().postMailData,MailCT.ins().postGetItemFromMail,MailCT.ins().postMailDetail],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isIosTS)return!1;var t=MailCT.ins().getUnreadMail();return 0>=t?!1:!0},e.prototype.checkShowRedPoint=function(){return MailCT.ins().mailData?1:0},e.prototype.blink=function(){var t=egret.Tween.get(this.tar);t.to({alpha:0},500).to({alpha:1},500).call(this.blink.bind(this))},e.prototype.tapExecute=function(){ViewManager.ins().open(FriendBgWin,4)},e}(RuleIconBase);__reflect(MailIconRule.prototype,"MailIconRule"),window.MailIconRule=MailIconRule;var MallIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange],s.updateMessage=[ShopRedPoint.ins().postShopRedPoint,IronShopRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.MALL)&&!LocationProperty.isIosTS&&!LocationProperty.isTSServer},e.prototype.checkShowRedPoint=function(){return ShopRedPoint.ins().shopRedPoint||!ShopRedPoint.ins().nfirstLogin||IronShopRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(ShopWin),ShopRedPoint.ins().nfirstLogin=!0,this.update()},e}(RuleIconBase);__reflect(MallIconRule.prototype,"MallIconRule"),window.MallIconRule=MallIconRule;var MoJianRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[MoJianCT.ins().postTask,MoJianCT.ins().postRoleDatas,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return MoJianCT.ins().checkOpen()&&!MoJianCT.ins().checkActived()},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(RuneWin,0,0,!1,!0),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(MoJianRule.prototype,"MoJianRule"),window.MoJianRule=MoJianRule;var MonthCardIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,ExpGoldCT.ins().postExpUpdate,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return CardWin.openCheck()},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(CardWin,0),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(MonthCardIconRule.prototype,"MonthCardIconRule"),window.MonthCardIconRule=MonthCardIconRule;var NewWorldBossIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=s.updateMessage=[BossCT.ins().postNewBossOpen],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=75,BossCT.ins().newWorldBossData.startTime?(this.runTime(),Timer.has(this.runTime,this)||Timer.start(1e3,0,this.runTime,this)):this.alertText.text="活动结束",e},e.prototype.runTime=function(){var t=Math.floor((BossCT.ins().newWorldBossData.startTime-GameServer.serverTime)/1e3);t>=0?this.alertText.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12):1e3*GlobalConfig.NewWorldBossBaseConfig.bossTime+BossCT.ins().newWorldBossData.startTime>GameServer.serverTime?this.alertText.text="":(this.alertText.text="活动结束",Timer.stop(this.runTime,this),this.updateShow())},e.prototype.checkShowIcon=function(){if(LocationProperty.isIosTS)return!1;if(Actor.level<55)return!1;if(!GameServer.serverOpenDay)return!1;var t=BossCT.ins().newWorldBossData.isOpen;return t&&this.tar&&BossCT.ins().newWorldBossData.startTime&&(Timer.has(this.runTime,this)||Timer.start(1e3,0,this.runTime,this)),t},e.prototype.checkShowRedPoint=function(){return GameServer.serverTime>BossCT.ins().newWorldBossData.startTime&&1e3*GlobalConfig.NewWorldBossBaseConfig.bossTime+BossCT.ins().newWorldBossData.startTime>GameServer.serverTime?1:0},e.prototype.getEffName=function(){return this.checkShowRedPoint()?(this.effX=38,this.effY=38,"CirclePrompt"):""},e.prototype.tapExecute=function(){ViewManager.ins().open(BossWin,3,1)},e}(RuleIconBase);__reflect(NewWorldBossIconRule.prototype,"NewWorldBossIconRule"),window.NewWorldBossIconRule=NewWorldBossIconRule;var NextNoticeRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData],s.updateMessage=[],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=GlobalConfig.UpdateRemindConfig;if(!t.appearTime||!t.disappearTime)return!1;if(1e3*ZsCT.ins().lv+Actor.level<t.appearLv)return!1;if(GameServer.serverOpenDay+1<t.serverDayLimit)return!1;var e=GameServer.serverTime;return DateUtils.formatStrTimeToMs(t.appearTime)<=e&&e<DateUtils.formatStrTimeToMs(t.disappearTime)?!0:void 0},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(UpdateRemindWin,GlobalConfig.UpdateRemindConfig.lotteryNotice)},e}(RuleIconBase);__reflect(NextNoticeRule.prototype,"NextNoticeRule"),window.NextNoticeRule=NextNoticeRule;var OpenSerVipRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[VipCT.ins().postOpenServerVip],s.updateMessage=[VipCT.ins().postOpenServerVip],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.alertText=new eui.Label,this.alertText.size=14,this.alertText.width=120,this.alertText.textAlign="center",this.alertText.textColor=3532333,this.alertText.horizontalCenter=0,e.addChild(this.alertText),this.alertText.y=75,e},e.prototype.checkShowIcon=function(){var t=VipCT.ins().openVip;return t&&t.isAct&&1!=t.status},e.prototype.checkShowRedPoint=function(){var t=VipCT.ins().openVip;if(t){var e=GlobalConfig.VipOpenServerConfig.days;this.alertText.text=t.day>=e?"":"再登录"+(e-t.day)+"天"}return 1==VipCT.ins().getOpenSerVipStatus()?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(OpenSerVipWin)},e}(RuleIconBase);__reflect(OpenSerVipRule.prototype,"OpenSerVipRule"),window.OpenSerVipRule=OpenSerVipRule;var PActivityIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;var t=this.getConfig(),e=t.param||[],i=Activity.ins().activityData,s=Object.keys(i);if(!s.length)return!1;for(var n in i){var o=i[n];if(e.indexOf(o.id)>-1&&o.timeType!=ActivityDataFactory.TimeType_Total&&o.isOpenActivity()&&!o.getHide())return this.actId=o.id,!0}i=PActivity.ins().activityData;for(var n in i){var o=i[n];if(e.indexOf(o.id)>-1&&o.isOpenActivity()&&!o.getHide())return this.actId=o.id,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=this.getConfig(),e=t.param||[],i=Activity.ins().activityData;for(var s in i){var n=i[s];if(e.indexOf(n.id)>-1&&n.timeType!=ActivityDataFactory.TimeType_Total&&n.isOpenActivity()&&n.canReward())return 1}i=PActivity.ins().activityData;for(var s in i){var n=i[s];if(e.indexOf(n.id)>-1&&n.isOpenActivity()&&n.canReward())return 1}return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ActivityWin,this.actId)},e}(RuleIconBase);__reflect(PActivityIconRule.prototype,"PActivityIconRule"),window.PActivityIconRule=PActivityIconRule;var PaoDianIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s._time=0,s.showMessage=[Actor.ins().postLevelChange,PaoDianCC.ins().postOpenInfo,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);if(this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.width=70,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,this._timeTxt.textColor=65280,e.addChild(this._timeTxt),PaoDianCC.ins().isOpen)this._timeTxt.text="进行中";else{var i=PaoDianCC.ins().getOpenLeftTime();i>0&&(this._time=i,this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4),Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this))}return e},e.prototype.checkShowIcon=function(){if(Timer.stopAll(this),!OpenSystem.ins().checkSysOpen(SystemType.PAODIAN))return!1;if(PaoDianCC.ins().isOpen)return!0;var t=PaoDianCC.ins().getOpenLeftTime();return t>0?(this._time=t,Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this),!0):!1},e.prototype.setRepeat=function(){this._time--,this._time>0?this._timeTxt&&(this._timeTxt.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)):(this._timeTxt&&(this._timeTxt.text="进行中"),Timer.stopAll(this))},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(LadderWin,3),this.update()},e}(RuleIconBase);__reflect(PaoDianIconRule.prototype,"PaoDianIconRule"),window.PaoDianIconRule=PaoDianIconRule;var PartnerIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.updateMessage=[Actor.ins().postLevelChange,GameLogic.ins().postSubRoleChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return SubRoles.ins().subRolesLen<3},e.prototype.checkShowRedPoint=function(){var t=SubRoles.ins().subRolesLen,e=GlobalConfig.NewRoleConfig[t];if(!e)return 0;var i=e.zsLevel?ZsCT.ins().lv:Actor.level,s=e.zsLevel?e.zsLevel:e.level;return i>=s||Actor.vip>=e.vip?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(NewRoleWin)},e}(RuleIconBase);__reflect(PartnerIconRule.prototype,"PartnerIconRule"),window.PartnerIconRule=PartnerIconRule;var PeakedIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,SpecialRing.ins().postActiveRing,GameApp.ins().postZeroInit,ZsCT.ins().postZsLv,PeakedSys.ins().postState],s.updateMessage=[PeakedRedpoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:PeakedSys.ins().isOpen()&&(PeakedSys.ins().bfStatus>BF_PeakStatus.None&&PeakedSys.ins().bfStatus<=BF_PeakStatus.Over||PeakedSys.ins().kfStatus>KF_PeakStatus.None&&PeakedSys.ins().kfStatus<=KF_PeakStatus.Over)},e.prototype.checkShowRedPoint=function(){return PeakedRedpoint.ins().redpoint},e.prototype.tapExecute=function(){ViewManager.ins().open(PeakedMainWin)},e}(RuleIconBase);__reflect(PeakedIconRule.prototype,"PeakedIconRule"),window.PeakedIconRule=PeakedIconRule;var PHappySevenDayIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s._activityID=0,s.showMessage=[PActivity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.HAPPYSEVENDAY))return!1;var t=PActivity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,!0}return!1},e.prototype.checkShowRedPoint=function(){var t=PActivity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.HAPPYSEVENDAY&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=40,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(HappySevenDayWin,this._activityID,ActivityPageStyle.HAPPYSEVENDAY,ActivityType.Personal),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(PHappySevenDayIconRule.prototype,"PHappySevenDayIconRule"),window.PHappySevenDayIconRule=PHappySevenDayIconRule;var ProveIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postVerify,PfActivity.ins().postProveInfo],s.updateMessage=[PfActivity.ins().postProveInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return PfActivity.ins().proveState&&PfActivity.ins().giftState==ProveGiftType.UNGET},e.prototype.checkShowRedPoint=function(){return PfActivity.ins().giftState==ProveGiftType.GET?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(ProveWin)},e}(RuleIconBase);__reflect(ProveIconRule.prototype,"ProveIconRule"),window.ProveIconRule=ProveIconRule;var QQMemberRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;s.showMessage=[PfActivity.ins().postQQZoneAward];var n=LocationProperty.QQZoneChannel;return s.hasCfg()&&PfActivity.ins().sendQQZoneAward(n,1),s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=LocationProperty.QQZoneChannel;if(this.hasCfg()){var e=0==PfActivity.ins().getQQZoneAwardState(t);return e&&ViewManager.ins().open(QQMemberWin),e}return!1},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.tapExecute=function(){ViewManager.ins().open(QQMemberWin)},e.prototype.hasCfg=function(){var t=LocationProperty.QQZoneChannel;return""!=t&&null!=GlobalConfig.TencentSpaceGiftBagConf[t]},e}(RuleIconBase);__reflect(QQMemberRule.prototype,"QQMemberRule"),window.QQMemberRule=QQMemberRule;var RankIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:OpenSystem.ins().checkSysOpen(SystemType.RANK)},e.prototype.checkShowRedPoint=function(){return OpenSystem.ins().checkSysOpen(SystemType.RANK)?0:Rank.ins().canPraiseInAll()?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(RankingWin)},e}(RuleIconBase);__reflect(RankIconRule.prototype,"RankIconRule"),window.RankIconRule=RankIconRule;var RexueDideRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData,GameServer.ins().postServerOpenDay],s.updateMessage=[],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return RexueDideCT.ins().checkOpen()},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(RexueDideWin)},e}(RuleIconBase);__reflect(RexueDideRule.prototype,"RexueDideRule"),window.RexueDideRule=RexueDideRule;var RingIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;
return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,SpecialRing.ins().postActiveRing,SpecialRing.ins().postGetSpicelRingInfo],s.updateMessage=[SpecialRing.ins().postActiveRing,BagCT.ins().postItemDel,BagCT.ins().postItemAdd],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=OpenSystem.ins().checkSysOpen(SystemType.RING);if(t){var e=Object.keys(GlobalConfig.ActorExRingConfig).length;t=SpecialRing.ins().ringActiNum<e}return t},e.prototype.checkShowRedPoint=function(){var t=SpecialRing.ins().checkHaveUpRing();return t?1:0},e.prototype.getEffName=function(){},e.prototype.tapExecute=function(){SpecialRing.ins().checkRingOpen()?ViewManager.ins().open(RingInfoView):TipsCT.ins().showTips("激活神器 烈焰神戒 后开启")},e}(RuleIconBase);__reflect(RingIconRule.prototype,"RingIconRule"),window.RingIconRule=RingIconRule;var RoleOpenRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[Actor.ins().postLevelChange,VipCT.ins().postUpdataExp,VipCT.ins().postUpdateVipData,FbCT.ins().postGuanKaIdChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.ROLEOPEN)&&Actor.vip<2&&Actor.level<80},e.prototype.getEffName=function(t){return this.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){this.firstTap=!1,ViewManager.ins().open(NewRoleWin)},e}(RuleIconBase);__reflect(RoleOpenRule.prototype,"RoleOpenRule"),window.RoleOpenRule=RoleOpenRule;var RuneIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=RuneConfigMgr.ins().getOtherCfg();return ZsCT.ins().lv>=t.zsLevel},e.prototype.getEffName=function(){},e.prototype.tapExecute=function(){var t=RuneConfigMgr.ins().getOtherCfg(),e=ZsCT.ins().lv>=t.zsLevel;return e?void ViewManager.ins().open(RuneWin):void TipsCT.ins().showTips(t.zsLevel+"转开启图腾系统")},e}(RuleIconBase);__reflect(RuneIconRule.prototype,"RuneIconRule"),window.RuneIconRule=RuneIconRule;var SeckillRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[CumRechargeCT.ins().postOneSeckill,Actor.ins().postLevelChange,ZsCT.ins().postZsData,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange],s.updateMessage=[],s}return __extends(e,t),e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.checkShowIcon=function(){if(!OpenSystem.ins().checkSysOpen(SystemType.SECKILL))return!1;var t=GlobalConfig.OneYuanGiftConfig;return 1e3*ZsCT.ins().lv+Actor.level<t.openLv?!1:GameServer.serverOpenDay+1<t.openDay?!1:CumRechargeCT.ins().seckill?void 0:!0},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.tapExecute=function(){ViewManager.ins().open(SeckillWin)},e}(RuleIconBase);__reflect(SeckillRule.prototype,"SeckillRule"),window.SeckillRule=SeckillRule;var ShareIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.isOpen=!1,s.showMessage=[PfActivity.ins().postInviteInfoUpdate,Actor.ins().postLevelChange],s.updateMessage=[PfActivity.ins().postInviteInfoUpdate],platform.setShareCallback(function(t){t&&(console.warn("分享成功"),PfActivity.ins().sendWeiXinInviteGift(),ViewManager.ins().isShow(YqWin)&&ViewManager.ins().close(YqWin))}),s.getShare(),s}return __extends(e,t),e.prototype.getShare=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=this,[4,platform.isOpenShare()];case 1:return t.isOpen=e.sent(),this.updateShow(),[2]}})})},e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:this.isOpen&&OpenSystem.ins().checkSysOpen(SystemType.SHARE)&&PfActivity.ins().wxInviteCount<3},e.prototype.checkShowRedPoint=function(){var t=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;Timer.stopAll(this);var e=0>=t?1:0;return e||Timer.start(t,1,this.updateTime,this),e},e.prototype.updateTime=function(){this.update()},e.prototype.tapExecute=function(){platform.showShare(),ViewManager.ins().open(YqWin)},e}(RuleIconBase);__reflect(ShareIconRule.prototype,"ShareIconRule"),window.ShareIconRule=ShareIconRule;var ShenQiIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,TaskCT.ins().postUpdteTaskTrace,Artifact.ins().postNewArtifactInit,Artifact.ins().postNewArtifactUpdate,Artifact.ins().postGuide],s}return __extends(e,t),e.prototype.checkShowIcon=function(){this.updateInfo();var t=OpenSystem.ins().checkSysOpen(SystemType.SHENQIGUIDE)&&!FbCT.ins().pkGqboss&&FbCT.ins().guanqiaID<340&&FbCT.ins().guanqiaID>1;return t},e.prototype.updateInfo=function(){var t,e=FbCT.ins().getCurrentReward(),i=FbCT.ins().getNextReward();e?(t=e[0],FbCT.ins().getMapReward(),this.pretips&&this.pretips==t.id||(this.pretips=t.id,TipsCT.ins().showItemTips(t.id))):i&&(t=i[0],this.eNum&&(this.eNum.font="num_xvip_4_fnt",this.eNum.text=FbCT.ins().getNextNeedChapter()+"")),t&&this.tar&&this.setReward(t)},e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this.labelInfo=e.labelInfo,this.imgInfo=e.imgInfo,this.imgName=e.imgName,this.imgItem=e.imgItem,this.eNum=e.eNum,this.groupEff=e.groupEff,this.updateInfo(),e},e.prototype.checkShowRedPoint=function(){for(var t=Artifact.ins().getMaxIndex(),e=1,i=1;t>=i;i++){var s=Artifact.ins().getNewArtifactBy(i);if(e=i,!s.open){for(var n=0;8>n;n++){var o=s.record>>n&1,a=s.exitRecord>>n&1&&0==o;if(a)return 1}break}}for(var r=GlobalConfig.ImbaConf[e],l=Artifact.ins().getNewArtifactBy(e),h=0,i=0;i<r.jigsawId.length;i++){var p=l.record>>i&1;if(1!=p){h=r.jigsawId[i];break}}return!h&&(l.open?0:1)},e.prototype.tapExecute=function(){FbCT.ins().getCurrentReward()&&FbCT.ins().getMapReward(),this.checkShowRedPoint()?ViewManager.ins().open(LiLianWin,1):ViewManager.ins().open(TargetWin,TargetWin.SEHNQI)},e.prototype.setReward=function(t){var e=Artifact.ins().getConfByChipId(t.id);e&&(this.imgName.source=e.imgName,this.imgItem.source=e.img,this.imgInfo.source=e.simpleDesc,this.labelInfo.text=e.buttonDesc)},e.prototype.getEffName=function(t){return egret.getTimer()-Artifact.ins().showGuide<3e3?(this.effX=this.groupEff.x,this.effY=this.groupEff.y,"NoviceEff"):void 0},e}(RuleIconBase);__reflect(ShenQiIconRule.prototype,"ShenQiIconRule"),window.ShenQiIconRule=ShenQiIconRule;var SuperVipIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[VipCT.ins().postSuperVipData,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.SUPERVIP)},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(SuperVipWin)},e}(RuleIconBase);__reflect(SuperVipIconRule.prototype,"SuperVipIconRule"),window.SuperVipIconRule=SuperVipIconRule;var TaskTraceIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.currentEff="",s.showMessage=[TaskCT.ins().postUpdteTaskTrace,Actor.ins().postLevelChange,GameLogic.ins().postEnterMap],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=TaskCT.ins().getTaskState()&&!FbCT.ins().pkGqboss;return t},e.prototype.getEffName=function(t){var e,i=TaskCT.ins().taskTrace;if(i)switch(i.state){case 0:e="Briefing",this.effX=130,this.effY=32;break;case 1:e="CircleEff2",this.effX=136,this.effY=32}if(this.currentEff!=e){var s=ViewManager.ins().getView(PlayFunView);s&&s.ruleEff[this.tar.hashCode]&&(DisplayUtils.removeFromParent(s.ruleEff[this.tar.hashCode]),s.ruleEff[this.tar.hashCode]=null)}return this.currentEff=e,e},e.prototype.tapExecute=function(){var t=TaskCT.ins().taskTrace;if(0==t.state)GameGuider.taskGuidance(t.id,1),GuideUtils.ins().updateByClick();else{if(FbCT.ins().guanqiaID>=1e5)return;TaskCT.ins().sendGetAchieve(t.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(t),TaskCT.ins().getAchieveConfById(t.id+1)||TipsCT.ins().showTips("已完成所有任务!");var e=ViewManager.ins().getView(PlayFunView);e.hejiRule.updatekStep(!0)}this.update()},e}(RuleIconBase);__reflect(TaskTraceIconRule.prototype,"TaskTraceIconRule"),window.TaskTraceIconRule=TaskTraceIconRule;var ThanksIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,Activity.ins().postActivityIsGetAwards,Recharge.ins().postUpdateRechargeEx],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,BagCT.ins().postItemAdd,BagCT.ins().postItemChange,BagCT.ins().postItemDel],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.THANKS))return!1;var t=Recharge.ins().getRechargeData(0);if(!t||0==t.num)return!1;var e=Activity.ins().activityData,i=Object.keys(e);if(!i.length)return!1;for(var s in e){var n=e[s];if(n.pageStyle==ActivityPageStyle.THANKS&&n.isOpenActivity())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==ActivityPageStyle.THANKS&&i.isOpenActivity()&&i.canReward()&&i.specialState())return 1}return 0},e.prototype.getEffName=function(t){return e.firstTap?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ThanksGivingWin),e.firstTap&&(e.firstTap=!1),this.update()},e.firstTap=!0,e}(RuleIconBase);__reflect(ThanksIconRule.prototype,"ThanksIconRule"),window.ThanksIconRule=ThanksIconRule;var TreasureIconRule=function(t){function e(e,i){void 0===i&&(i=null);var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsLv,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,GameServer.ins().postServerOpenDay],s.updateMessage=[BagCT.ins().postItemAdd,BagCT.ins().postHuntStore,Heirloom.ins().postHuntBoxInfo],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return LocationProperty.isIosTS?!1:OpenSystem.ins().checkSysOpen(SystemType.TREASURE)},e.prototype.checkShowRedPoint=function(){return Setting.ins().getValue(ClientSet.firstClickTreasure)!=new Date(GameServer.serverTime).getDate()?1:Boolean(BagCT.ins().getHuntGoods(0).length)||Boolean(BagCT.ins().getHuntGoods(1).length)||Rune.ins().getIsGetBox()||Heirloom.ins().isHeirloomHuntOpen()&&(Boolean(BagCT.ins().getHuntGoods(2).length)||Heirloom.ins().getIsGetBox())||RuneRedPointMgr.ins().checkCanExchange()||BeastRedPoint.ins().treasureRedPoint||Hunt.ins().checkHuntRed(10)||Hunt.ins().checkRuneRed(10)||Hunt.ins().checkChuanshiRed(10)?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(TreasureHuntWin);var t=new Date(GameServer.serverTime).getDate();Setting.ins().getValue(ClientSet.firstClickTreasure)!=t&&(Setting.ins().setValue(ClientSet.firstClickTreasure,t),this.update())},e}(RuleIconBase);__reflect(TreasureIconRule.prototype,"TreasureIconRule"),window.TreasureIconRule=TreasureIconRule;var TreasureRoomRule=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasPAct=!0,e.systemId=SystemType.TREASUREROOM,e.pageStyle=ActivityPageStyle.TREASUREROOM,e}return __extends(e,t),e.prototype.checkShowRedPoint=function(){return 1},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(TreasureRoomWin)},e}(ComActivityIconRule);__reflect(TreasureRoomRule.prototype,"TreasureRoomRule"),window.TreasureRoomRule=TreasureRoomRule;var TxShiPinRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=window.OPEN_DATA;return t&&t.qua?"AND"!=t.qua.os?!1:"QQLive"!=t.qua.app?!1:OpenSystem.ins().checkSysOpen(SystemType.TXSHIPIN):!1},e.prototype.tapExecute=function(){ViewManager.ins().open(TxShiPinWin)},e}(RuleIconBase);__reflect(TxShiPinRule.prototype,"TxShiPinRule"),window.TxShiPinRule=TxShiPinRule;var VipGiftIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[Actor.ins().postLevelChange,VipCT.ins().postVipGiftBuy,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData,CumRechargeCT.ins().postOneSeckill],s.updateMessage=[VipCT.ins().postUpdateVipData,VipCT.ins().postVipGiftBuy,Recharge.ins().postUpdateRechargeEx,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.VIPGIFT))return!1;if(!Recharge.ins().isOpenIosRecharge)return!1;if(!CumRechargeCT.ins().seckill)return!1;for(var t=Object.keys(GlobalConfig.VipGiftConfig).length,e=VipCT.ins().vipGiftState,i=1;t>=i;i++)if(e[i-1]){var s=GlobalConfig.VipGiftConfig[i].hfTimes;if(s=s?s:0,GameServer._hefuCount>=s&&(0==(1&e[i-1].state)||!VipCT.ins().getVipCashGiftIsBuy(i)))return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Actor.vip;for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e],s=i.hfTimes;if(s=s?s:0,t>=i.vipLv&&GameServer._hefuCount>=s&&(VipCT.ins().getVipGiftRedPoint(+e)||VipCT.ins().getVipCashGiftRedPoint(+e)))return 1}return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(VipGiftWin)},e}(RuleIconBase);__reflect(VipGiftIconRule.prototype,"VipGiftIconRule"),window.VipGiftIconRule=VipGiftIconRule;var WanBaPrivilegeRule=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=window.OPEN_DATA;return t&&t.qua?"SQ"!=t.qua.app?!1:!LocationProperty.isWanBaWX:!1},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(WanBaVipPrivilegeWin)},e}(RuleIconBase);__reflect(WanBaPrivilegeRule.prototype,"WanBaPrivilegeRule"),window.WanBaPrivilegeRule=WanBaPrivilegeRule;var WarOrderRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[WarOrderCT.ins().postInfo,Actor.ins().postLevelChange,ZsCT.ins().postZsData,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,WarOrderRedPoint.ins().postRedPoint],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.WARORDER)?WarOrderCT.ins().checkOpen():!1},e.prototype.checkShowRedPoint=function(){return WarOrderRedPoint.ins().redPoint?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(WarOrderWin)},e}(RuleIconBase);__reflect(WarOrderRule.prototype,"WarOrderRule"),window.WarOrderRule=WarOrderRule;var WeekActiveIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[GameApp.ins().postZeroInit,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[GameApp.ins().postZeroInit,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return!1;var t=Activity.ins(),e=t.activityData;for(var i in e){var s=e[i];if(s.pageStyle==ActivityPageStyle.TOTALRECHARGE&&s.timeType!=ActivityDataFactory.TimeType_Total&&s.isOpenActivity()&&!s.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(!i.pageStyle&&i.timeType!=ActivityDataFactory.TimeType_Total&&i.isOpenActivity()&&i.canReward())return 1}return 0},e.prototype.getEffName=function(){return this.checkShowRedPoint()?(this.effX=38,this.effY=40,"CirclePrompt"):""},e.prototype.tapExecute=function(){ViewManager.ins().open(WeekActiveWin)},e}(RuleIconBase);__reflect(WeekActiveIconRule.prototype,"WeekActiveIconRule"),window.WeekActiveIconRule=WeekActiveIconRule;var XinMoRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[ZsCT.ins().postZsData],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return XinMoCT.ins().checkOpen()},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(XinMoWin),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(XinMoRule.prototype,"XinMoRule"),window.XinMoRule=XinMoRule;var YBZhuanPanIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.usePageSytle=ActivityPageStyle.YBZHUANPAN,s.showMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postLevelChange,FbCT.ins().postGuanqiaInfo,FbCT.ins().postGuanKaIdChange,ZsCT.ins().postZsData],s.updateMessage=[Activity.ins().postActivityIsGetAwards,Actor.ins().postYbChange],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(!LocationProperty.isTSServer){if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.CHRISTMAS))return!1;var t=Activity.ins().activityData,e=Object.keys(t);if(!e||!e.length)return!1;for(var i in t){var s=t[i];if(s.pageStyle==this.usePageSytle&&s.isOpenActivity()&&!s.getHide())return this._activityID=+i,!0}return!1}},e.prototype.checkShowRedPoint=function(){var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==this.usePageSytle&&i.isOpenActivity()&&i.canReward()&&!i.getHide())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(HappySevenDayWin,this._activityID,this.usePageSytle,ActivityType.Normal),this.firstTap&&(this.firstTap=!1,this.update())},e}(RuleIconBase);__reflect(YBZhuanPanIconRule.prototype,"YBZhuanPanIconRule"),window.YBZhuanPanIconRule=YBZhuanPanIconRule;var YqBtnIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[PfActivity.ins().postInviteInfoUpdate],s}return __extends(e,t),e.prototype.checkShowIcon=function(){var t=!0;return PfActivity.ins().wxInviteCount>=3&&(t=!1),t&&e.isShowIcon},e.prototype.tapExecute=function(){ViewManager.ins().open(YqWin)},e.isShowIcon=!1,e}(RuleIconBase);__reflect(YqBtnIconRule.prototype,"YqBtnIconRule"),window.YqBtnIconRule=YqBtnIconRule;var ZhanLingIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.firstTap=!0,s.showMessage=[GameApp.ins().postZeroInit,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s.updateMessage=[GameApp.ins().postZeroInit,Actor.ins().postYbChange,Recharge.ins().postUpdateRecharge,Recharge.ins().postRechargeTotalDay,Recharge.ins().postUpdateRechargeEx,Activity.ins().postActivityIsGetAwards,PActivity.ins().postActivityIsGetAwards],s}return __extends(e,t),e.prototype.checkShowIcon=function(){if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return!1;var t=PActivity.ins().activityData;for(var e in t)if(PActivity.ins().getZhanlingActivity(e)){var i=t[e];if(i.isOpenActivity()&&!i.getHide())return!0}return!1},e.prototype.checkShowRedPoint=function(){var t=PActivity.ins().activityData;for(var e in t)if(PActivity.ins().getZhanlingActivity(e)){var i=t[e];if(i.isOpenActivity()&&i.canReward())return 1}return 0},e.prototype.getEffName=function(t){return this.firstTap||t?(this.effX=38,this.effY=38,"CirclePrompt"):void 0},e.prototype.tapExecute=function(){ViewManager.ins().open(ZhanLingACTWin),this.firstTap=!1,this.update()},e}(RuleIconBase);__reflect(ZhanLingIconRule.prototype,"ZhanLingIconRule"),window.ZhanLingIconRule=ZhanLingIconRule;var ZsStoreIconRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ZsCT.ins().postZsStoreInfo,ZsCT.ins().postBuyResult,ZsCT.ins().postShowIconRule],s.updateMessage=[],s}return __extends(e,t),e.prototype.createTar=function(){var e=t.prototype.createTar.call(this);return this._timeTxt=new eui.Label,this._timeTxt.horizontalCenter=0,this._timeTxt.y=75,this._timeTxt.textAlign="center",this._timeTxt.text="",this._timeTxt.size=14,e.addChild(this._timeTxt),this.setState(),e},e.prototype.setState=function(){Timer.has(this.setRepeat,this)||Timer.start(1e3,0,this.setRepeat,this)},e.prototype.setRepeat=function(){var t=DateUtils.getFormatBySecond((ZsCT.ins().storeOverTime-GameServer.serverTime)/1e3,DateUtils.TIME_FORMAT_1);ZsCT.ins().storeOverTime>GameServer.serverTime?this._timeTxt&&(this._timeTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+ColorUtil.GREEN_COLOR+">"+t+"</font>")):Timer.stopAll(this)},e.prototype.checkShowIcon=function(){return!1},e.prototype.checkShowRedPoint=function(){return ZsCT.ins().hasGoods()?1:0},e.prototype.tapExecute=function(){ViewManager.ins().open(ZsStoreWin)},e}(RuleIconBase);__reflect(ZsStoreIconRule.prototype,"ZsStoreIconRule"),window.ZsStoreIconRule=ZsStoreIconRule;var FuncdianItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="funcdianSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){},e}(BaseItemRender);__reflect(FuncdianItem.prototype,"FuncdianItem"),window.FuncdianItem=FuncdianItem;var FuncShowWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.select=0,e.isTopLevel=!0,e._sn_="funcShowSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eListDP=new eui.ArrayCollection,this.eListDP2=new eui.ArrayCollection,this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+"BtnPrompt3",-1),this.eMCGroup.visible=!1,this.eMCGroup.addChild(this.mc)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t&&t.length>0?!0:!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cfgs=t[0],this.observe(GameLogic.ins().postFunsShow,this.updateView),this.changePage(this.select)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.leftBtn:this.changePage(this.select-1);break;case this.rightBtn:this.changePage(this.select+1);break;case this.eBtn:1==this.awardStatus?GameLogic.ins().sendFunsShowAward(this.cfgs[this.select].id):TipsCT.ins().showTips("功能还未开启")}},e.prototype.changePage=function(t){t>=this.cfgs.length?this.select=this.cfgs.length-1:0>=t?this.select=0:this.select=t,this.rightBtn.visible=this.select<this.cfgs.length-1,this.leftBtn.visible=this.select>0,this.updateView()},e.prototype.updateView=function(){if(this.cfgs){var t=this.cfgs[this.select];this.sTitle=t.title,this.sBigImg=t.pic,this.eListDP.source=CommonUtils.objectToArray(t.showReward),this.eListDP2.source=CommonUtils.objectToArray(this.cfgs);var e=t.dec.replace("$sd$",t.recDay+"").replace("$sd$",t.recDay+"").replace("$d$","|C:"+(GameServer.serverOpenDay+1>=t.recDay?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+Math.min(t.recDay,GameServer.serverOpenDay+1)+"|").replace("$lv$","|C:"+(ZsCT.ins().lv>=t.zhuanshengLv?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+t.zhuanshengLv+"|");this.sTips=TextFlowMaker.generateTextFlow(e),this.awardStatus=ActivityForeshowModel.ins().getFunsShowAwardById(t.id),this.eBtn.visible=2!=this.awardStatus,this.eMCGroup.visible=1==this.awardStatus,this.eGet.visible=2==this.awardStatus}},e}(BaseEuiView);__reflect(FuncShowWin.prototype,"FuncShowWin"),window.FuncShowWin=FuncShowWin,ViewManager.ins().reg(FuncShowWin,LayerManager.UI_Main);var PowerEquipCT=function(t){function e(){var e=t.call(this)||this;return e.decomposeIds=[],e.sysId=PackageID.Equip,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getStageFormItemId=function(t){var e=GlobalConfig.MasterEquipConf;for(var i in e)if(e[i].itemId==t)return e[i].stage;return 0},e.prototype.getPosFormItemId=function(t){var e=GlobalConfig.MasterEquipConf;for(var i in e)if(e[i].itemId==t)return e[i].pos},e.prototype.getCostNum=function(t,e,i){var s=[],n=GlobalConfig.MasterEquipQuenchingConf;for(var o in n)for(var a in n[o])for(var r in n[o][a])if(t==n[o][a][r].slot&&e==n[o][a][r].pos&&n[o][a][r].leve>i)return s.push(n[o][a][r].consume[0].type),s.push(n[o][a][r].consume[0].id),s.push(n[o][a][r].consume[0].count),s;return null},e.prototype.getSealConfByPosLv=function(t,e){return GlobalConfig.MasterEquipSealConf[t][e]},e.prototype.getSkillsformStageAndCout=function(t,e){var i=this.getStagesByRole(t,e),s=GlobalConfig.MasterEquipStarSuitConf,n=[],o=i[0]?i[0]:0;for(var a in s)if(s[a].stage==o){var r=this.getSuitSkill(s[a],t);r&&n.indexOf(r.skill)<0&&(n=n.concat(r.skill))}return n},e.prototype.getSuitSkill=function(t,i){for(var s in t.cond){var n=e.ins().getItemIdFormSuit(+s,t.cond[s]);if(!n||!i.powerEquipItemData||!i.powerEquipItemData[s])return;var o=i.powerEquipItemData[s].itemConfig;if(!o)return;var a=e.ins().getStageFormItemId(o.id);if(a<t.cond[s])return}return t},e.prototype.getStagesByRole=function(t,i){var s=GlobalConfig.MasterEquipStarSuitConf[i],n=[];if(!t||!s||!t.powerEquipItemData)return n;for(var o in s.cond){var a=t.powerEquipItemData[o],r=0;a&&a.itemConfig&&(r=e.ins().getStageFormItemId(a.itemConfig.id)),n.push(r)}return n.sort(Algorithm.sortAsc),n},e.prototype.getItemIdFormSuit=function(t,e){var i=GlobalConfig.MasterEquipConf;for(var s in i)if(i[s].pos==t&&i[s].stage==e)return i[s].itemId;return 0},e.prototype.getMasterSuitByRole=function(t){var e=[];if(!t)return e;var i=GlobalConfig.MasterEquipStarSuitConf;for(var s in i)i[s].stage==t&&e.push(i[s]);return e},e}(BaseSystem);__reflect(PowerEquipCT.prototype,"PowerEquipCT"),System.PowerEquipCT=function(){return PowerEquipCT.ins()},window.PowerEquipCT=PowerEquipCT;var PowerEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.totalRedPoint=!1,e.powerEquipRedPoint=[],e.totalroleRedPoint=[],e.roleRedPoint1=[],e.roleRedPoint2=[],e.roleRedPoint3=[],e.roleEquipRedPoint=[],e.quenchEquipRedPoint=[],e.upEquipRedPoint=[],e.powerEquipRedPoint=[!1,!1,!1,!1],e.totalroleRedPoint=[e.roleRedPoint1,e.roleRedPoint2,e.roleRedPoint3,PowerEquipAwakeRedPoint.ins().roleRedPoint],e.associated(e.postTotalRedPointFun,e.postPowerEquipFun),e.associated(e.postPowerEquipFun,e.postDecomposeEquip,e.postRolePowerEquipFun,e.postQuenchEquipFun,e.postUpEquipFun),e.associated(e.postRolePowerEquipFun,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init,EquipCT.ins().postPowerEquipUpdate,EquipCT.ins().postPowerEquipQucheUpDate,EquipCT.ins().postPowerEquip),e.associated(e.postQuenchEquipFun,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init,EquipCT.ins().postPowerEquipUpdate,EquipCT.ins().postPowerEquipQucheUpDate,EquipCT.ins().postPowerEquip),e.associated(e.postUpEquipFun,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init,EquipCT.ins().postPowerEquipUpdate,EquipCT.ins().postPowerEquipQucheUpDate,EquipCT.ins().postPowerEquip),e.associated(e.postDecomposeEquip,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init,EquipCT.ins().postPowerEquipUpdate,EquipCT.ins().postPowerEquipQucheUpDate,EquipCT.ins().postPowerEquip),e}return __extends(e,t),e.prototype.postTotalRedPointFun=function(){this.totalRedPoint=!1;for(var t=0;3>t;t++)if(this.powerEquipRedPoint[t]){this.totalRedPoint=!0;break}return!0},e.prototype.postPowerEquipFun=function(){return!0},e.prototype.postRolePowerEquipFun=function(){this.powerEquipRedPoint[0]=!1;for(var t=0;3>t;t++){this.roleRedPoint1[t]=!1;var e=SubRoles.ins().getSubRoleByIndex(t);if(this.roleEquipRedPoint[t]=[!1,!1,!1,!1,!1,!1,!1,!1],e)for(var i=0;i<e.powerEquipItemData.length;i++){var s=BagCT.ins().getPowerEquipByPos(i),n=e.powerEquipItemData[i];if(0!=n.configID)for(var o=ItemUtil.calculateBagItemScore(n),a=0;a<s.length;a++){var r=ItemUtil.calculateBagItemScore(s[a]);r>o&&(this.roleRedPoint1[t]=!0,this.powerEquipRedPoint[0]=!0,this.roleEquipRedPoint[t][i]=!0)}else s.length>0&&(this.roleEquipRedPoint[t][i]=!0,this.roleRedPoint1[t]=!0,this.powerEquipRedPoint[0]=!0)}}return!0},e.prototype.postQuenchEquipFun=function(){this.powerEquipRedPoint[1]=!1;for(var t=0;3>t;t++){this.roleRedPoint2[t]=!1,this.quenchEquipRedPoint[t]=[];var e=SubRoles.ins().getSubRoleByIndex(t);if(e)for(var i=GlobalConfig.MasterEquipBaseConf.costid,s=BagCT.ins().getBagGoodsCountById(0,i),n=GlobalConfig.MasterEquipBaseConf.posLimit,o=0;o<e.powerEquipDate.length;o++){this.quenchEquipRedPoint[t][o]=[!1,!1,!1];for(var a=0;a<e.powerEquipDate[o].length;a++){var r=e.powerEquipDate[o][a],l=this.getCostNum(o,a+1,r);if(0==r)if(0!=a){var h=e.powerEquipDate[o][a-1];this.quenchEquipRedPoint[t][o][a]=s>=l[2]&&n[a+1]<=h}else this.quenchEquipRedPoint[t][o][a]=s>=l[2];else{if(r>=GlobalConfig.MasterEquipBaseConf.maxlevel)continue;if(l&&!this.quenchEquipRedPoint[t][o][a])if(0!=a){var p=e.powerEquipDate[o][a-1];this.quenchEquipRedPoint[t][o][a]=s>=l[2]&&n[a+1]<=p}else this.quenchEquipRedPoint[t][o][a]=s>=l[2]}this.roleRedPoint2[t]||(this.roleRedPoint2[t]=this.quenchEquipRedPoint[t][o][a]),this.powerEquipRedPoint[1]||(this.powerEquipRedPoint[1]=this.quenchEquipRedPoint[t][o][a])}}}return!0},e.prototype.postUpEquipFun=function(){this.powerEquipRedPoint[2]=!1;for(var t=0;3>t;t++){this.roleRedPoint3[t]=!1,this.upEquipRedPoint[t]=[!1,!1,!1,!1,!1,!1,!1,!1];var e=SubRoles.ins().getSubRoleByIndex(t);if(e)for(var i=GlobalConfig.MasterEquipConf,s=0;s<e.powerEquipItemData.length;s++){var n=e.powerEquipItemData[s],o=void 0;if(i[n.configID]&&i[n.configID].toid>0&&(o=i[n.configID]),o){var a=o.consume,r=a?!0:!1;if(r)for(var l=0;l<a.length;l++){var h=a[l].count,p=ItemUtil.isEquip(GlobalConfig.ItemConfig[a[l].id])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,u=BagCT.ins().getBagGoodsCountById(p,a[l].id);r&&(r=u>=h)}this.upEquipRedPoint[t][s]=r,this.roleRedPoint3[t]||(this.roleRedPoint3[t]=r),this.powerEquipRedPoint[2]||(this.powerEquipRedPoint[2]=r)}else this.upEquipRedPoint[t][s]=!1}}return!0},e.prototype.postDecomposeEquip=function(){var t=BagCT.ins().getPowerEquips();return t.length>0?this.powerEquipRedPoint[3]=!0:this.powerEquipRedPoint[3]=!1,!0},e.prototype.getCostNum=function(t,e,i){var s=[],n=GlobalConfig.MasterEquipQuenchingConf;for(var o in n)for(var a in n[o])for(var r in n[o][a])if(t==n[o][a][r].slot&&e==n[o][a][r].pos&&n[o][a][r].leve>i)return s.push(n[o][a][r].consume[0].type),s.push(n[o][a][r].consume[0].id),s.push(n[o][a][r].consume[0].count),s;return null},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postTotalRedPointFun",null),__decorate([post()],e.prototype,"postPowerEquipFun",null),__decorate([post()],e.prototype,"postRolePowerEquipFun",null),__decorate([post()],e.prototype,"postQuenchEquipFun",null),__decorate([post()],e.prototype,"postUpEquipFun",null),__decorate([post()],e.prototype,"postDecomposeEquip",null),e}(BaseSystem);__reflect(PowerEquipRedPoint.prototype,"PowerEquipRedPoint"),System.PowerEquipRedPoint=function(){return PowerEquipRedPoint.ins()},window.PowerEquipRedPoint=PowerEquipRedPoint;var PowerEquipDecomposeSkinPanel=function(t){function e(){var e=t.call(this)||this;
return e._sn_="PowerEquipDecomposeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.itemTap)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];PowerEquipCT.ins().decomposeIds=[],this.observe(EquipCT.ins().postPowerEquipDecompose,this.updateView),this.updateView()},e.prototype.removeDisplay=function(){PowerEquipCT.ins().decomposeIds=[]},e.prototype.updateView=function(){this.decomposeBtn0.touchEnabled=!0,this.itemList0.itemRenderer=PowerEquipSeletctItem,this.itemData1=BagCT.ins().getPowerEquips(),this.itemData1.sort(BagCT.ins().sort2),this.itemList0.dataProvider=new eui.ArrayCollection(this.itemData1);var t=GlobalConfig.MasterEquipBaseConf.item;this.suipianNow0.text=BagCT.ins().getBagGoodsCountById(0,t[0]).toString(),this.curLab0.text=BagCT.ins().getBagGoodsCountById(0,t[1]).toString(),this.materialLab0.text=BagCT.ins().getBagGoodsCountById(0,t[2]).toString(),this.suipianAdd0.text="",this.addLab0.text="",this.addMaterialLab0.text="",this.getAllDecomPostNum()},e.prototype.itemTap=function(t){if(t.target instanceof PowerEquipSeletctItem)return t.target.selectItem(),void this.getAllDecomPostNum();if(t.target==this.decomposeBtn0)if(PowerEquipCT.ins().decomposeIds.length>0){this.decomposeBtn0.touchEnabled=!1;for(var e=0;e<this.itemList0.numChildren;e++){var i=this.itemList0.getChildAt(e);i.playBoomEff()}egret.Tween.get(this).wait(300).call(function(){EquipCT.ins().sendPowerEquipDecompose(PowerEquipCT.ins().decomposeIds)})}else TipsCT.ins().showTips("请点击选择所需分解的装备")},e.prototype.getAllDecomPostNum=function(){var t={},e=GlobalConfig.MasterEquipBaseConf.item;for(var i in e)t[e[i]+""]=0;for(var i in this.itemData1){var s=this.itemData1[i];if(-1!=PowerEquipCT.ins().decomposeIds.indexOf(s.handle)){var n=GlobalConfig.MasterEquipConf[s.configID].output;for(var o in n)t[n[o].id]+=n[o].count}}t[e[0]]>0?this.suipianAdd0.text="+"+t[e[0]]:this.suipianAdd0.text="",t[e[1]]>0?this.addLab0.text="+"+t[e[1]]:this.addLab0.text="",t[e[2]]>0?this.addMaterialLab0.text="+"+t[e[2]]:this.addMaterialLab0.text=""},__decorate([callLater],e.prototype,"updateView",null),e}(BaseView);__reflect(PowerEquipDecomposeSkinPanel.prototype,"PowerEquipDecomposeSkinPanel"),window.PowerEquipDecomposeSkinPanel=PowerEquipDecomposeSkinPanel;var PowerEquipIntensifySkinPanel=function(t){function e(){var e=t.call(this)||this;return e.currRoleId=0,e.selectPos=0,e.quenchId=1,e.barbc=new ProgressBarEff,e.canGrowUp="",e._sn_="PowerEquipIntensifySkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.barbc.setMcRes("ProgressEff6","ProgressEff7"),this.barbc.setWidth(292),this.barbc.x=-10,this.barbc.y=-20,this.barbc.bgimg.visible=!1,this.barGroup.addChildAt(this.barbc,0),this.barbc.reset()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PowerEquipRedPoint.ins().postTotalRedPointFun,this.updateQuechView),this.updateQuechView()},e.prototype.updateQuechView=function(){if(this.role){this.setRedPoint();for(var t=0;t<this.role.powerEquipItemData.length;t++)this.setItem(t,t==this.selectPos);this.canGrowUp="",this.countLabel0.text="";var e=PowerEquipCT.ins().powerEquipLevel,i=PowerEquipCT.ins().powerEquipGodLevel;this.powerEquipValue.text="主宰"+StringUtils.NumberToChinese(e)+"级";for(var s=CommonUtils.getObjectLength(GlobalConfig.MasterLevelConf),t=s;t>0;t--){var n=GlobalConfig.MasterLevelConf[t];(e==s||e<n.level)&&this.barbc.setMaxValue(n.godpower)}if(this.barbc.setValue(i),this.barbc.setLbValueText(i+"/"+this.barbc.getMaxValue()),!(this.selectPos<0)){var o=0;if(0!=this.role.powerEquipDate.length){for(var t=0;t<this.role.powerEquipDate[this.selectPos].length;t++){var a=this["quItem"+t];a.eLabel.text=this.role.powerEquipDate[this.selectPos][t],o+=this.role.powerEquipDate[this.selectPos][t],a.select.visible=t==this.quenchId-1}for(var t=0;10>=t;t++)o>=10*t&&(this.used2.text=""+t);var r=this.role.powerEquipDate[this.selectPos][this.quenchId-1],l=PowerEquipCT.ins().getCostNum(this.selectPos,this.quenchId,r),h=!1;void 0==l&&(h=!0,l=PowerEquipCT.ins().getCostNum(this.selectPos,this.quenchId,r-1));var p=l[2]?l[2]:0,u=BagCT.ins().getBagGoodsCountById(0,l[1]),d=p>u?"|C:0xf3311e&T:"+u+"|":"|C:0x35E62D&T:"+u+"|",c=h?"已满级":d+"/"+p;this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(c);var f,g,y=GlobalConfig.MasterEquipBaseConf.posLimit,v=GlobalConfig.MasterEquipQuenchingConf,m=this.role.powerEquipDate[this.selectPos][this.quenchId-2],T=["魂","精","魄"];y[this.quenchId]>m&&(this.canGrowUp="主宰之"+T[this.quenchId-2]+"达到"+y[this.quenchId]+"级可淬炼"),""==this.canGrowUp&&(this.canGrowUp=u>=p?"":"材料不足"),""==this.canGrowUp&&(this.canGrowUp=h?"已满级":""),this.redPoint.visible=""==this.canGrowUp&&0!=this.role.powerEquipItemData[this.selectPos].configID;for(var t in v)for(var C in v[t])for(var I in v[t][C])if(this.selectPos==v[t][C][I].slot&&this.quenchId==v[t][C][I].pos&&v[t][C][I].leve==r&&(f=v[t][C][I].attrs),this.selectPos==v[t][C][I].slot&&this.quenchId==v[t][C][I].pos&&v[t][C][I].leve>r){g=v[t][C][I].attrs;break}if(f){this.cursor0.visible=!h,this.fullAtt0.visible=h,this.curAtt0.visible=!h,this.nextAtt0.visible=!h;var w=g?this.curAtt0:this.fullAtt0;w.height=0,w.text="";for(var t=0;t<f.length;t++){var b=AttributeData.getAttrStrByType(f[t].type);w.text+=b+":"+f[t].value+"\n",w.height+=20}}else{if(!g)return;this.cursor0.visible=!1,this.fullAtt0.visible=!0,this.curAtt0.visible=!0;var w=g?this.curAtt0:this.fullAtt0;w.height=0,w.text="";for(var t=0;t<g.length;t++){var b=AttributeData.getAttrStrByType(g[t].type);w.text+=b+":0\n",w.height+=20}}if(g){this.nextAtt0.visible=!0,this.cursor0.visible=!0,this.fullAtt0.visible=!1,this.nextAtt0.height=0,this.nextAtt0.text="";for(var t=0;t<g.length;t++){var b=AttributeData.getAttrStrByType(g[t].type);this.nextAtt0.text+=b+":"+g[t].value+"\n",this.nextAtt0.height+=20}}}}}},e.prototype.setItem=function(t,e){void 0===e&&(e=!1);var i=this["equip"+t];if(null!=i){var s=this.role.powerEquipItemData[t],n=s.itemConfig;if(i.select.visible=e,i.data=s.itemConfig,0==s.configID?(i.itemIcon.imgIcon.source=t>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[t],this.equipName.text=""):i.data=s.itemConfig,e){if(this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source=i.itemIcon.imgIcon.source,this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(n),void 0==n)return;this.equipName.text=n.name,this.equipName.textColor=i.level.textColor}}},e.prototype.setRedPoint=function(){var t=PowerEquipRedPoint.ins().quenchEquipRedPoint[this.currRoleId],e=this.quItem0;e.icon.source="zhzuai_h_png",e.redPoint.visible=!1;var i=this.quItem1;i.icon.source="zhzuai_j_png",i.redPoint.visible=!1;var s=this.quItem2;s.icon.source="zhzuai_p_png",s.redPoint.visible=!1;for(var n=0;n<t.length;n++){var o=this["equip"+n];o.redPoint.visible=!1;for(var a=0;a<t[n].length;a++)t[n][a]&&(o.redPoint.visible=!0);n==this.selectPos&&(e.redPoint.visible=t[n][0],i.redPoint.visible=t[n][1],s.redPoint.visible=t[n][2])}return!0},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[52].text);break;case this.up2:return void ViewManager.ins().open(PowerEquipSealTipWin,this.currRoleId,this.selectPos);case this.quItem0:this.quenchId=1;break;case this.quItem1:this.quenchId=2;break;case this.quItem2:this.quenchId=3;break;case this.equip0:this.selectPos=0;break;case this.equip1:this.selectPos=1;break;case this.equip2:this.selectPos=2;break;case this.equip3:this.selectPos=3;break;case this.equip4:this.selectPos=4;break;case this.equip5:this.selectPos=5;break;case this.equip6:this.selectPos=6;break;case this.equip7:this.selectPos=7;break;case this.upGradeBtn1:""==this.canGrowUp?EquipCT.ins().sendPowerEquipRefine(this.currRoleId,this.selectPos,this.quenchId):TipsCT.ins().showTips("|C:0xf3311e&T:"+this.canGrowUp+"|")}t.target!=this.upGradeBtn1&&this.updateQuechView()},e.prototype.setRoleId=function(t){this.currRoleId=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currRoleId),this.skin&&this.updateQuechView()},e}(BaseView);__reflect(PowerEquipIntensifySkinPanel.prototype,"PowerEquipIntensifySkinPanel"),window.PowerEquipIntensifySkinPanel=PowerEquipIntensifySkinPanel;var PowerEquipItem=function(t){function e(){var e=t.call(this)||this;return e._curRole=-1,e.skinName="EquipItem",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.framkEff=new MovieClip,this.addChildAt(this.framkEff,1),this.addChildAt(this.level,2),this.framkEff.visible=!1,this.framkEff.x=this.itemIcon.x+40,this.framkEff.y=this.itemIcon.y+38,this.itemIcon.imgJob.visible=!1,this.select.visible=!1,this.touchEnabled=!0,this.touchChildren=!1},e.prototype.dataChanged=function(){if(this.setImgBg(0),this.itemConfig=this.data,this.itemConfig){this.setName(this.itemConfig.name),this.setItemImg(this.itemConfig.icon+"_png");var t=ItemUtil.getQuality(this.itemConfig);this.setImgBg(t),this.level.textColor=ItemBase.QUALITY_COLOR[t],this.itemIcon.setTag("zz_jj"+GlobalConfig.MasterEquipConf[this.itemConfig.id].stage)}else this.setName(""),this.itemIcon.setTag("");this.showEff(this.getHasEquip())},e.prototype.openEquipsTips=function(){},e.prototype.showPower=function(){this.openEquipsTips()},e.prototype.setCurRole=function(t){this._curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.getHasEquip=function(){return null!=this.data},e.prototype.showEff=function(t){this.framkEff.visible=t;var e=ItemUtil.getEffName(this.itemConfig);""!=e?this.framkEff.playFile(RES_DIR_EFF+e,-1):this.framkEff.visible=!1},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e.prototype.setImgBg=function(t){this.itemIcon.imgBg.source="quality"+t},e.prototype.setName=function(t){this.level.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.hideName=function(){this.level.visible=!1},e}(BaseItemRender);__reflect(PowerEquipItem.prototype,"PowerEquipItem"),window.PowerEquipItem=PowerEquipItem;var PowerEquipMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentRoleID=0,e.currenIndex=0,e._sn_="PowerEquipMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.name="主宰"},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currentRoleID=0,this.currenIndex=0,this.addChangeEvent(this.roleSelect,this.switchRole),this.addChangeEvent(this.tab,this.onTabTouch),this.setSelectedIndex(0),this.upDateView(),this.observe(PowerEquipRedPoint.ins().postTotalRedPointFun,this.upDateView),this.observe(PowerEquipAwakeRedPoint.ins().postRedPoint,this.upDateView)},e.prototype.upDateView=function(){this.setRedPoint()},e.prototype.switchRole=function(){this.currentRoleID=this.roleSelect.getCurRole(),this.eSelectViewStack.selectedChild.setRoleId(this.currentRoleID)},e.prototype.onTabTouch=function(t){this.setSelectedIndex(this.tab.selectedIndex)},e.prototype.setSelectedIndex=function(t){this.currenIndex=t,this.eSelectViewStack.selectedChild instanceof PowerEquipDecomposeSkinPanel?this.roleSelect.hideRole():(this.roleSelect.openRole(),this.eSelectViewStack.selectedChild.setRoleId(this.currentRoleID)),this.setRedPoint()},e.prototype.setRedPoint=function(){this.redPoint0.visible=this.redPoint1.visible=this.redPoint2.visible=this.redPoint3.visible=this.redPoint4.visible=!1;var t=SubRoles.ins().subRolesLen;if(this.currenIndex<4)for(var e=0;t>e;e++)this.roleSelect.showRedPoint(e,PowerEquipRedPoint.ins().totalroleRedPoint[this.currenIndex][e]);return this.redPoint0.visible=PowerEquipRedPoint.ins().powerEquipRedPoint[0],this.redPoint1.visible=PowerEquipRedPoint.ins().powerEquipRedPoint[1],this.redPoint2.visible=PowerEquipRedPoint.ins().powerEquipRedPoint[2],this.redPoint4.visible=PowerEquipRedPoint.ins().powerEquipRedPoint[3],this.redPoint3.visible=PowerEquipAwakeRedPoint.ins().postRedPoint(),!0},e}(BaseEuiView);__reflect(PowerEquipMainWin.prototype,"PowerEquipMainWin"),window.PowerEquipMainWin=PowerEquipMainWin,ViewManager.ins().reg(PowerEquipMainWin,LayerManager.UI_Main);var PowerEquipRoleSkinPanel=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e.currRoleId=0,e.equips=[],e._sn_="PowerEquipRoleSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this._wefbodyMc=new MovieClip,this._wefbodyMc.visible=!1,this._bodyMc=new MovieClip,this._bodyMc.visible=!1,this.wingMc=new MovieClip,this.wingMc.visible=!1,this.eBodyMCGroup1.addChild(this.wingMc),this.eBodyMCGroup1.addChild(this._wefbodyMc),this.eBodyMCGroup1.addChild(this._bodyMc);for(var t=0;t<EquipPos.DZI;t++)this.equips[t]=this["item"+t];this.skill_0.touchThrough=!0,this.skill_0.touchChildren=!1,this.skill_1.touchThrough=!0,this.skill_1.touchChildren=!1,this.skill_2.touchThrough=!0,this.skill_2.touchChildren=!1,this.barbc.setMcRes("ProgressEff6","ProgressEff7"),this.barbc.setWidth(292),this.barbc.x=-10,this.barbc.y=-20,this.barbc.bgimg.visible=!1,this.barGroup.addChildAt(this.barbc,0),this.barbc.reset(),this.addTouchEvent(this,this.OnSelect)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemAdd,this.updateView),this.observe(BagCT.ins().postItemDel,this.updateView),this.observe(BagCT.ins().postItemChange,this.updateView),this.observe(BagCT.ins().postItemCountChange,this.updateView),this.observe(PowerEquipRedPoint.ins().postTotalRedPointFun,this.updateView),this.updateView()},e.prototype.updateView=function(){for(var t=0,e=0;e<EquipPos.DZI;e++){var i=this.role.powerEquipItemData[e].itemConfig;this.equips[e].setCurRole(this.currRoleId),this.equips[e].data=i,void 0==i||0==i.id?this.equips[e].setItemImg(e>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[e]):t+=ItemUtil.calculateBagItemScore(this.role.powerEquipItemData[e])}this.setRedPoint();var s=PowerEquipCT.ins().powerEquipLevel,n=PowerEquipCT.ins().powerEquipGodLevel;this.powerEquipValue.text="主宰"+StringUtils.NumberToChinese(s)+"级";for(var o=CommonUtils.getObjectLength(GlobalConfig.MasterLevelConf),e=o;e>0;e--){var a=GlobalConfig.MasterLevelConf[e];(s==o||s<a.level)&&this.barbc.setMaxValue(a.godpower)}this.barbc.setValue(n),this.barbc.setLbValueText(n+"/"+this.barbc.getMaxValue()),this.setRoleEquip(this.currRoleId,this.bodyImg1,this.weaponImg1),this.setWing();for(var r=SubRoles.ins().getSubRoleByIndex(this.currRoleId),e=0;3>e;e++){var l=PowerEquipCT.ins().getSkillsformStageAndCout(r,e+1);this["blackImg"+e].visible=l.length<=0}},e.prototype.setRoleEquip=function(t,e,i){e.source=null,i.source=null;var s,n=SubRoles.ins().getSubRoleByIndex(t),o=n.getEquipByIndex(0).item.configID,a=n.getZhuangBanNG(),r=a[0],l=a[1],h=n.getEquipByIndex(0),p=h.item.configID,u=n.getEquipByIndex(2),d=u.item.configID,c=GlobalConfig.ClientGlobalConfig.useManRes?0:n.sex;if(p>0){var f=GlobalConfig.EquipConfig[p].appearance;f&&f.indexOf("[job]")>-1&&(f=f.replace("[job]",n.job+"")),i.source=GlobalConfig.EquipWithEffConfig[o+"_"+n.sex]?null:f+"_"+c+"_c_png"}if(d>0){var f=GlobalConfig.EquipConfig[d].appearance;f&&f.indexOf("[job]")>-1&&(f=f.replace("[job]",n.job+"")),e.source=f+"_"+n.sex+"_c_png",s=!0}if(s||(e.source="body000_"+n.sex+"_c_png"),l>0){var g=this.getZhuangbanById(l);g.useMc>0?(i.visible=!1,this._wefbodyMc.visible=!0,this._wefbodyMc.playFile(RES_DIR_DRESS+g.res+"_"+c+"_c_m",-1)):(this._wefbodyMc.visible=!1,i.visible=!0,i.source=this.getZhuangbanById(l).res+"_"+c+"_c_png")}else this._wefbodyMc.visible=!1,i.visible=!0,this.setWeaponEffect(this.currRoleId,"wsef",this._wefbodyMc);if(r>0){var g=this.getZhuangbanById(r);g.useMc>0?(e.visible=!1,this._bodyMc.visible=!0,this._bodyMc.playFile(RES_DIR_DRESS+g.res+"_"+n.sex+"_c_m",-1)):(this._bodyMc.visible=!1,e.visible=!0,e.source=g.res+"_"+n.sex+"_c_png")}else this._bodyMc.visible=!1,e.visible=!0,this.setWeaponEffect(this.currRoleId,"bodyEffect",this._bodyMc,2)},e.prototype.setWing=function(t,e){void 0===t&&(t=this.currRoleId),void 0===e&&(e=this.wingImg1),e.source=null,this.godWingEff=new MovieClip,this.godWingEff1=new MovieClip,this.wingEffGrp1.removeChildren(),this.wingEffGrp1.removeChildren();var i=SubRoles.ins().getSubRoleByIndex(t).wingsData,s=WingCT.ins().getGodWing(t),n=s.getSuitSum();if(n>=WingCT.GodWingMaxSlot){var o=s.getSuitLevel(),a=GlobalConfig.GodWingSuitConfig[o];this.godWingEff.parent||(this.wingEffGrp1.addChild(this.godWingEff),this.wingEffGrp1.addChild(this.godWingEff1)),a.suiteff&&a.lv>=2?(this.godWingEff.visible=!0,this.godWingEff.playFile(RES_DIR_EFF+a.suiteff,-1),this.godWingEff1.visible=!0,this.godWingEff1.playFile(RES_DIR_EFF+a.suiteff,-1)):(this.godWingEff.visible=!1,this.godWingEff1.visible=!1)}var r=SubRoles.ins().getSubRoleByIndex(t).getZhuangBanNG()[2];if(r>0){var l=this.getZhuangbanById(r);l.useMc?this.wingMc.playFile(RES_DIR_DRESS+l.res+"_c_m",-1):e.source=l.res+"_png",this.wingMc.visible=l.useMc>0}else i.openStatus?(e.source=GlobalConfig.WingLevelConfig[i.lv].appearance+"_png",this.wingMc.visible=!1):e.source=""},e.prototype.setWeaponEffect=function(t,e,i,s){void 0===s&&(s=0);var n=SubRoles.ins().getSubRoleByIndex(t),o=n.getEquipByIndex(s).item.configID,a=GlobalConfig.EquipWithEffConfig[o+"_"+n.sex],r=n.getZhuangBanNG(),l=i;if(a&&(0==s&&r[1]<=0||2==s&&r[0]<=0)){if(void 0==a)return void(l.visible=!1);l.visible=!0,l.playFile(RES_DIR_EFF+a.inShowEff,-1)}},e.prototype.OnSelect=function(t){if(t.target instanceof PowerEquipItem){var e=this.equips.indexOf(t.target),i=t.target;if(i.getHasEquip()){var s=this.role.powerEquipItemData[e];ViewManager.ins().open(EquipDetailedWin,ItemType.TYPE_33,s.handle,s.configID,s,this.role,this.currRoleId,e)}else ViewManager.ins().open(RoleChooseEquipWin,this.currRoleId,e,ItemType.TYPE_33)}else switch(t.target){case this.skill_0:ViewManager.ins().open(PowerEquipSkillTipWin,this.currRoleId,0);break;case this.skill_1:ViewManager.ins().open(PowerEquipSkillTipWin,this.currRoleId,1);break;case this.skill_2:ViewManager.ins().open(PowerEquipSkillTipWin,this.currRoleId,2);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[52].text)}},e.prototype.setRoleId=function(t){this.currRoleId=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currRoleId),this.skin&&(this.setRoleEquip(this.currRoleId,this.bodyImg1,this.weaponImg1),this.updateView())},e.prototype.setRedPoint=function(){for(var t=PowerEquipRedPoint.ins().roleEquipRedPoint[this.currRoleId],e=0;e<t.length;e++)this.equips[e].setRedPoint(t[e]);return!0},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e}(BaseView);__reflect(PowerEquipRoleSkinPanel.prototype,"PowerEquipRoleSkinPanel"),window.PowerEquipRoleSkinPanel=PowerEquipRoleSkinPanel;var PowerEquipSealTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currRoleid=0,e.currPos=0,e._sn_="PowerEquipSuitTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.name="主宰",this.addTouchEvent(this.bgClose,this.closeView)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currRoleid=t[0],this.currPos=t[1],this.role=SubRoles.ins().getSubRoleByIndex(this.currRoleid);for(var i=GlobalConfig.MasterEquipBaseConf.ratioLevel,s=0,n=0;n<this.role.powerEquipDate[this.currPos].length;n++)s+=this.role.powerEquipDate[this.currPos][n];var o=Math.floor(s/i);if(this.eCurrGroup.visible=!0,this.eNextGroup.visible=!0,0==o){var a=PowerEquipCT.ins().getSealConfByPosLv(this.currPos,1),r=a.skill?a.skill[0]:0;DisplayUtils.removeFromParent(this.eCurrGroup),this.state1.text="未激活",this.state1.textColor=ColorUtil.RED,this.name1.text="主宰封印1级",this.content1.text="主宰淬炼达到"+i+"级激活（"+s+"/"+i+"）";var l="";if(r>0){var h=GlobalConfig.SkillsConfig[r];l=SkillUtil.getDesc(h)}this.attr1.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getExAttrNameByAttrbute(a.ex_attrs[0],!0,"")+"\n"+l)}else{var a=PowerEquipCT.ins().getSealConfByPosLv(this.currPos,o),r=a.skill?a.skill[0]:0;this.state0.text="已激活",this.state0.textColor=ColorUtil.GREEN,this.name0.text="主宰封印"+o+"级",this.content0.text="主宰淬炼达到"+o*i+"级激活（"+s+"/"+o*i+"）";var l="";r>0&&(l=SkillUtil.getDesc(GlobalConfig.SkillsConfig[r])),this.attr0.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getExAttrNameByAttrbute(a.ex_attrs[0],!0,"")+"\n"+l),a=PowerEquipCT.ins().getSealConfByPosLv(this.currPos,o+1),a?(r=a.skill?a.skill[0]:0,this.state1.text="未激活",this.state1.textColor=ColorUtil.RED,this.name1.text="主宰封印"+(o+1)+"级",this.content1.text="主宰淬炼达到"+(o+1)*i+"级激活（"+s+"/"+(o+1)*i+"）",l="",r>0&&(l=SkillUtil.getDesc(GlobalConfig.SkillsConfig[r])),this.attr1.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getExAttrNameByAttrbute(a.ex_attrs[0],!0,"")+"\n"+l)):DisplayUtils.removeFromParent(this.eNextGroup)}},e.prototype.closeView=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PowerEquipSealTipWin.prototype,"PowerEquipSealTipWin"),window.PowerEquipSealTipWin=PowerEquipSealTipWin,ViewManager.ins().reg(PowerEquipSealTipWin,LayerManager.UI_Tips);var PowerEquipSeletctItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PowerEquipSeletctSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.eff=new MovieClip,this.eff.visible=!1,this.eEffG.addChild(this.eff),this.boomEff=new MovieClip,this.boomEff.visible=!1,this.eEffG.addChild(this.boomEff),this.touchChildren=!1},e.prototype.dataChanged=function(){if(this.itemdate=this.data,this.imgIcon.touchEnabled=!0,this.touchChildren=!1,this.imgBg.source="quality0",void 0!=this.itemdate){this.eEquipMask.visible=!1,this.select.visible=!1,this.itemdate=this.data,this.itemConfig=this.itemdate.itemConfig,this.imgIcon.source=this.itemConfig.icon+"_png",this.tag.visible=!0,this.tag.source="zz_jj"+GlobalConfig.MasterEquipConf[this.itemConfig.id].stage,this.imgIcon.visible=!0;var t=ItemUtil.getEffName(this.itemConfig);""!=t&&this.eff.playFile(RES_DIR_EFF+t,-1),this.eff.visible=""!=t,this.eff.x=38,this.eff.y=38,this.equipName.visible=!0,this.equipName.text=this.itemConfig.name,this.equipName.width=100,this.powerValue=ItemUtil.calculateBagItemScore(this.itemdate);var e=ItemUtil.getQuality(this.itemConfig);this.imgBg.source="quality"+e,this.equipName.textColor=ItemBase.QUALITY_COLOR[e],this.eSelectIcon.visible=this.getIsSelect(),this.setArrowIcon()}},e.prototype.setArrowIcon=function(){var t=PowerEquipCT.ins().getPosFormItemId(this.itemConfig.id);this.arrowIcon.visible=!1;for(var e=0;3>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i){var s=i.powerEquipItemData[t].configID;if(void 0==s||0==s)return void(this.arrowIcon.visible=!0);var n=ItemUtil.calculateBagItemScore(i.powerEquipItemData[t]),o=ItemUtil.calculateBagItemScore(this.itemdate);this.arrowIcon.visible=o>n}}},e.prototype.getIsSelect=function(){return-1!=PowerEquipCT.ins().decomposeIds.indexOf(this.itemdate.handle)},e.prototype.playBoomEff=function(){this.eSelectIcon.visible&&(this.boomEff.visible=!0,this.boomEff.playFile(RES_DIR_EFF+"BoomEff",1),this.boomEff.x=38,this.boomEff.y=38)},e.prototype.selectItem=function(){var t=PowerEquipCT.ins().decomposeIds.indexOf(this.itemdate.handle);-1==t?(PowerEquipCT.ins().decomposeIds.push(this.itemdate.handle),this.eSelectIcon.visible=!0):(PowerEquipCT.ins().decomposeIds.splice(t,1),this.eSelectIcon.visible=!1)},e}(BaseItemRender);__reflect(PowerEquipSeletctItem.prototype,"PowerEquipSeletctItem"),window.PowerEquipSeletctItem=PowerEquipSeletctItem;var PowerEquipShowSkinPanel=function(t){function e(){var e=t.call(this)||this;return e.barbc=new ProgressBarEff,e.currRoleId=0,e.curSelectPos=0,e.canGrowUp=!1,e._sn_="PowerEquipShowSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onThouch),this.growEff=new MovieClip,this.growEff.visible=!1,this.eEffGroup.addChild(this.growEff),this.barbc.setMcRes("ProgressEff6","ProgressEff7"),this.barbc.setWidth(292),this.barbc.x=-10,this.barbc.y=-20,this.barbc.bgimg.visible=!1,this.barGroup.addChildAt(this.barbc,0),this.barbc.reset(),this.framkEff=new MovieClip,this.itemIcon.addChild(this.framkEff),this.framkEff.visible=!1,this.framkEff.x=38,this.framkEff.y=38,this.attributes0.curScore.textColor=14668213,this.attributes0.nextScore.textColor=3066402},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curSelectPos=0,this.updateView(),this.observe(PowerEquipRedPoint.ins().postTotalRedPointFun,this.updateView)},e.prototype.updateView=function(){if(this.role){this.canGrowUp=!1,this.setRedPoint();for(var t=0;t<this.role.powerEquipItemData.length;t++)this.setItem(t);this.eNeedGroup2.visible=!1;for(var t=0;3>t;t++){var e=this["need"+t];e.clearAll()}var i=PowerEquipCT.ins().powerEquipLevel,s=PowerEquipCT.ins().powerEquipGodLevel;this.powerEquipValue.text="主宰"+StringUtils.NumberToChinese(i)+"级";for(var n=CommonUtils.getObjectLength(GlobalConfig.MasterLevelConf),t=n;t>0;t--){var o=GlobalConfig.MasterLevelConf[t];(i==n||i<o.level)&&this.barbc.setMaxValue(o.godpower)}this.barbc.setValue(s),this.barbc.setLbValueText(s+"/"+this.barbc.getMaxValue());var a,r=this.role.powerEquipItemData[this.curSelectPos],l=GlobalConfig.MasterEquipConf,h=!1;for(var t in l)r.configID==l[t].itemId&&(l[t].toid>0&&l[t].grow>0?a=l[t]:l[t].grow||(h=!0));this.eCostItemGroup.visible=void 0!=a;var p=r.itemConfig;this.redPoint.visible=!1,this.eLab.visible=this.labelMax.visible=!1;var u=this.attributes0,d=this.attributes,c=this.itemIcon,f=this.itemIcon0;if(this.eGroweffImage.visible=this.eNextLable.visible=this.eFramkImage.visible=a?!0:!1,a){this.playeEffGroupEff(),f.visible=!0,u.visible=!0,d.visible=!1,f.imgIcon.source=p.icon+"_png",f.imgJob.visible=!1;var g=ItemUtil.getQuality(p);f.imgBg.source="quality"+g,this.eNextLable.text=p.name,this.eNextLable.textColor=ItemBase.QUALITY_COLOR[g];var y=GlobalConfig.ItemConfig[a.toid];c.imgIcon.source=y.icon+"_png",g=ItemUtil.getQuality(y),c.imgBg.source="quality"+g,c.imgJob.visible=!1,this.showEff(!0,y),this.eCurrlLabe.text=y.name,this.eCurrlLabe.textColor=ItemBase.QUALITY_COLOR[g];for(var v=a.consume,m=!0,t=0;t<v.length;t++){var T=v[t].count,C=ItemUtil.isEquip(GlobalConfig.ItemConfig[v[t].id])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,I=BagCT.ins().getBagGoodsCountById(C,v[t].id),e=this["need"+t];m&&(m=I>=T),e.data=v[t].id,e.isShowJob(!1),e.setCount(v[t].count.toString()),e.filters=I>=T?null:FilterUtil.ARRAY_GRAY_FILTER}this.eNeedGroup2.visible=v.length>2,this.redPoint.visible=m,this.canGrowUp=m,u.arrow1.visible=!1,u.arrow2.visible=!1,u.arrow3.visible=!1,u.arrow4.visible=!1,u.curBaseAttr.visible=!1,u.nameAttr.visible=!1,u.nextBaseAttr.visible=!1;var w=ItemUtil.getBaseAttrData(p);u.curScore.text="";for(var t=0;t<w.length;t++){var b=AttributeData.getAttrStrByType(w[t].type);u.curScore.text+=b+":"+w[t].value+"\n"}u.nextScore.text="";for(var S=ItemUtil.getBaseAttrData(y),t=0;t<S.length;t++){var b=AttributeData.getAttrStrByType(S[t].type);u.nextScore.text+=b+":"+S[t].value+"\n"}}else if(this.growEff.visible=!1,u.visible=!1,d.visible=!0,d.score.text="",d.eScoreLabel.visible=!1,d.nameAttr.visible=!1,d.randAttr.visible=!1,d.baseAttr.visible=!1,this.labelMax.visible=h,this.eLab.visible=!h,f.visible=!1,c.imgJob.visible=!1,void 0==p)this.eCurrlLabe.text="",this.showEff(!1),c.imgBg.source="quality0",c.imgIcon.source=this.curSelectPos>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[this.curSelectPos];else{this.eCurrlLabe.text=p.name,this.eCurrlLabe.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(p)],c.imgIcon.source=p.icon+"_png",c.imgBg.source="quality"+ItemUtil.getQuality(p),this.showEff(!0,p),d.score.x=102;for(var w=ItemUtil.getBaseAttrData(p),t=0;t<w.length;t++){var b=AttributeData.getAttrStrByType(w[t].type);d.score.text+=b+":"+w[t].value+"\n"}}}},e.prototype.showEff=function(t,e){if(void 0===e&&(e=null),this.framkEff.visible=t,t){var i=ItemUtil.getEffName(e);""!=i&&this.framkEff.playFile(RES_DIR_EFF+i,-1)}else this.framkEff.stop()},e.prototype.onThouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[52].text);break;case this.executeBtn:return void(this.canGrowUp?EquipCT.ins().sendPowerEquipUp(this.currRoleId,this.curSelectPos):TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|"));case this.equip0:this.curSelectPos=0;break;case this.equip1:this.curSelectPos=1;break;case this.equip2:this.curSelectPos=2;break;case this.equip3:this.curSelectPos=3;break;case this.equip4:this.curSelectPos=4;break;case this.equip5:this.curSelectPos=5;break;case this.equip6:this.curSelectPos=6;break;case this.equip7:this.curSelectPos=7}this.updateView()},e.prototype.setItem=function(t,e){void 0===e&&(e=!1);var i=this["equip"+t];if(null!=i){var s=this.role.powerEquipItemData[t];i.select.visible=t==this.curSelectPos,i.data=s.itemConfig,0==s.configID&&i.setItemImg(t>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[t])}},e.prototype.playeEffGroupEff=function(){this.growEff.playFile(RES_DIR_EFF+"ProgressEff6",-1),this.growEff.visible=!0,this.growEff.x=this.eEffGroup.width/2,this.growEff.y=this.eEffGroup.height/2,this.growEff.scaleX=this.eEffGroup.width/466,this.growEff.scaleY=this.eEffGroup.height/16,this.eEffGroup.scaleX=0;var t=1e3*this.eEffGroup.width/160,e=egret.Tween.get(this.eEffGroup);e.to({scaleX:1},t)},e.prototype.setRoleId=function(t){this.currRoleId=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currRoleId),this.skin&&this.updateView()},e.prototype.setRedPoint=function(){for(var t=PowerEquipRedPoint.ins().upEquipRedPoint[this.currRoleId],e=0;e<t.length;e++){var i=this["equip"+e];i.redPoint.visible=t[e]}return!0},e}(BaseView);__reflect(PowerEquipShowSkinPanel.prototype,"PowerEquipShowSkinPanel"),window.PowerEquipShowSkinPanel=PowerEquipShowSkinPanel;var PowerEquipSkillTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillIndex=0,e.currRoleId=0,e._sn_="ThunderSkillTipSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.name="主宰",this.addTouchEvent(this.bgClose,this.onSelect),this.skillEff=new MovieClip,this.skill.addChild(this.skillEff)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currRoleId=t[0],this.skillIndex=t[1],this.otherRole=t[2],this.upDateView()},e.prototype.upDateView=function(){this.skillEff.playFile(RES_DIR_EFF+GlobalConfig.MasterEquipBaseConf.skilleff[this.skillIndex],-1);var t=GlobalConfig.SkillsConfig[GlobalConfig.MasterEquipBaseConf.skill[this.skillIndex]],e=GlobalConfig.SkillsDescConfig[t.desc];this.skillName.text=SkillUtil.getName(t),this.curskillDescDetail.textFlow=TextFlowMaker.generateTextFlow1(e.desc);var i=this.otherRole||SubRoles.ins().getSubRoleByIndex(this.currRoleId),s=PowerEquipCT.ins().getStagesByRole(i,this.skillIndex+1),n=GlobalConfig.MasterEquipStarSuitConf,o=PowerEquipCT.ins().getMasterSuitByRole(s[0]);this.setInfo(!!s[0],o[this.skillIndex]?o[this.skillIndex]:n[this.skillIndex+1]),this.suitStatus_N.visible=!1,this.curskillDescTitle_N.text="",this.curskillDescDetail_N.text="";var a=PowerEquipCT.ins().getMasterSuitByRole(s[0]+1);s[0]&&a.length?this.setInfo(!1,a[this.skillIndex],"_N"):(this.anigroup.height=700,this.anigroup.$children[0].height=700)},e.prototype.setInfo=function(t,e,i){void 0===i&&(i="");var s=this.otherRole||SubRoles.ins().getSubRoleByIndex(this.currRoleId);this["suitStatus"+i].visible=!0;var n=Object.keys(e.cond).length;this["curskillDescTitle"+i].text=t?"技能已激活":"穿戴"+n+"件"+e.stage+"阶主宰装备可激活",this["curskillDescTitle"+i].textColor=t?327210:15978507;for(var o=0;8>o;o++){var a=this["curskillDesc"+o+i];if(e.cond[o]){var r=s.powerEquipItemData[o].itemConfig,l=r?PowerEquipCT.ins().getStageFormItemId(r.id):0;a.textColor=l>=e.cond[o]?327210:11645079}else DisplayUtils.removeFromParent(a)}var h=GlobalConfig.SkillsConfig[e.skill[0]];this["curskillDescDetail"+i].textFlow=TextFlowMaker.generateTextFlow1(SkillUtil.getDesc(h)),this.skillName.text=SkillUtil.getName(h)
},e.prototype.onSelect=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PowerEquipSkillTipWin.prototype,"PowerEquipSkillTipWin"),window.PowerEquipSkillTipWin=PowerEquipSkillTipWin,ViewManager.ins().reg(PowerEquipSkillTipWin,LayerManager.UI_Tips);var PowerEquipSuitItem=function(t){function e(){var e=t.call(this)||this;return e._sn_="masterSuitItemSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.data&&this.skin){for(var t=this.data[0],e=this.data[1],i=Object.keys(t.cond).length,s=0,n=0;8>n;n++)if(t.cond[n]){var o=PowerEquipCT.ins().getItemIdFormSuit(+n,t.cond[n]);if(!o)break;var a=ColorUtil.GRAY;if(e&&e.powerEquipItemData&&e.powerEquipItemData[n]){var r=e.powerEquipItemData[n].itemConfig;if(r){var l=PowerEquipCT.ins().getStageFormItemId(r.id);l>=t.cond[n]&&(s++,a=ColorUtil.GREEN)}}var h="|C:"+a+"&T:"+GlobalConfig.ItemConfig[o].name+"|";this["attr"+n].textFlow=TextFlowMaker.generateTextFlow1(h)}else DisplayUtils.removeFromParent(this["attr"+n]);var p=ColorUtil.RED,u=ColorUtil.GRAY;s>=i&&(p=ColorUtil.GREEN,u=ColorUtil.GREEN);var d="|C:0xff00ff&T:主宰套装|"+("|C:"+p+"&T:  ("+s+"/"+i+")|");if(this.mTitle.textFlow=TextFlowMaker.generateTextFlow1(d),t.attrs){var h="|C:"+u+"&T:"+AttributeData.getAttStr1(t.attrs,null)+"|";this.attr.textFlow=TextFlowMaker.generateTextFlow1(h)}else DisplayUtils.removeFromParent(this.attr);var c=GlobalConfig.SkillsConfig[t.skill[0]].desc,f=GlobalConfig.SkillsDescConfig[c];this.title.textFlow=TextFlowMaker.generateTextFlow1("|C:"+u+"&T:"+f.name+"|"),this.desc.textFlow=TextFlowMaker.generateTextFlow1(f.desc),this.desc.textColor=u,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source=f.icon?f.icon:""}},e}(BaseItemRender);__reflect(PowerEquipSuitItem.prototype,"PowerEquipSuitItem"),window.PowerEquipSuitItem=PowerEquipSuitItem;var PowerEquipAwakeCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Equip,e.regNetMsg(50,e.postPowerEquipAwakeLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postPowerEquipAwakeLevel=function(t){var e=t.readByte(),i=SubRoles.ins().getSubRoleByIndex(e);i&&(i.powerEquipAwakeLv[t.readByte()]=t.readShort())},e.prototype.sendUpAwake=function(t,e){var i=this.getBytes(50);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.getPosName=function(t){var e="",i=(t+1)%2;return e=0==i?"寒冰":"烈火"},e.getPosStage=function(t,e){if(t){for(var i=[],s=0;s<t.powerEquipAwakeLv.length;s++)(s+1)%2==e&&i.push(t.powerEquipAwakeLv[s]);return i}},e.equipNames=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子"],__decorate([post()],e.prototype,"postPowerEquipAwakeLevel",null),e}(BaseSystem);__reflect(PowerEquipAwakeCT.prototype,"PowerEquipAwakeCT"),System.PowerEquipAwakeCT=function(){return PowerEquipAwakeCT.ins()},window.PowerEquipAwakeCT=PowerEquipAwakeCT;var PowerEquipAwakeRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleRedPoint=[],e.roleEquipRedPoint=[],e.associated(e.postRedPoint,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemChange,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init,EquipCT.ins().postPowerEquipUpdate,EquipCT.ins().postPowerEquip,PowerEquipAwakeCT.ins().postPowerEquipAwakeLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){this.redPoint=!1;for(var t=this.redPoint,e=PowerEquipCT.ins().powerEquipLevel,i=0;3>i;i++){this.roleRedPoint[i]=!1;var s=SubRoles.ins().getSubRoleByIndex(i);if(this.roleEquipRedPoint[i]=[!1,!1,!1,!1,!1,!1,!1,!1],s)for(var n=0;n<s.powerEquipAwakeLv.length;n++){var o=s.powerEquipAwakeLv[n],a=GlobalConfig.MasterEquipAwakeConf[n],r=s.powerEquipItemData[n];if(0!=r.configID&&a&&a[o+1]&&a[o+1].consumeList[0]){var l=ItemUtil.isEquip(GlobalConfig.ItemConfig[a[o+1].consumeList[0].id])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,h=BagCT.ins().getBagGoodsCountById(l,a[o+1].consumeList[0].id);h>=a[o+1].consumeList[0].count&&a[o+1].levelLimit<=e&&(this.roleRedPoint[i]=!0,this.redPoint=!0,this.roleEquipRedPoint[i][n]=!0)}}}return t!=this.redPoint},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(PowerEquipAwakeRedPoint.prototype,"PowerEquipAwakeRedPoint"),System.PowerEquipAwakeRedPoint=function(){return PowerEquipAwakeRedPoint.ins()},window.PowerEquipAwakeRedPoint=PowerEquipAwakeRedPoint;var PowerEquipAwakePanel=function(t){function e(){var e=t.call(this)||this;return e.currRoleId=0,e.selectPos=0,e.barbc=new ProgressBarEff,e._sn_="PowerEquipUpSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.barbc.setMcRes("ProgressEff6","ProgressEff7"),this.barbc.setWidth(292),this.barbc.x=-10,this.barbc.y=-20,this.barbc.bgimg.visible=!1,this.barGroup.addChildAt(this.barbc,0),this.barbc.reset(),this.oldHorizontalCenter=this.attrGroup2.horizontalCenter,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getTreasureBtn.text+"</u>"),this.starList0=new UpStarList(5),this.starGroup0.addChild(this.starList0),this.starList1=new UpStarList(5),this.starGroup1.addChild(this.starList1),this.starList0.horizontalCenter=this.starList1.horizontalCenter=0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(EquipCT.ins().postPowerEquip,this.updateView),this.observe(PowerEquipAwakeCT.ins().postPowerEquipAwakeLevel,this.updateView),this.observe(PowerEquipAwakeRedPoint.ins().postRedPoint,this.setRedPoint),this.updateView()},e.prototype.cleanEff=function(){for(var t=0;t<this.role.powerEquipItemData.length;t++)this["mc"+t]&&(DisplayUtils.removeFromParent(this["mc"+t]),this["mc"+t]=null),this["eff"+t]&&(DisplayUtils.removeFromParent(this["eff"+t]),this["eff"+t]=null),this["line"+t]&&(DisplayUtils.removeFromParent(this["line"+t]),this["line"+t]=null)},e.prototype.updateEff=function(t,e){var i=this["equip"+t],s=GlobalConfig.MasterEquipAwakeConf[e];(t+1)%2==e&&s&&(this["mc"+t]||(this["mc"+t]=new MovieClip,this["mc"+t].x=39,this["mc"+t].y=40,i.addChildAt(this["mc"+t],i.getChildIndex(i.select)),this["mc"+t].playFile(RES_DIR_EFF+s[0].eff,-1)),this["eff"+t]||(this["eff"+t]=new MovieClip,this["eff"+t].scaleX=1.4,this["eff"+t].scaleY=.3,this["eff"+t].rotation=90,this["eff"+t].x=0==e?-10:85,this["eff"+t].y=38,i.addChildAt(this["eff"+t],i.getChildIndex(i.select)),this["eff"+t].playFile(RES_DIR_EFF+s[1].eff,-1)))},e.prototype.addEff=function(t,e,i){var s=Math.floor(t/100),n=Math.floor(e/100),o=GlobalConfig.MasterEquipAwakeConf[i];if(o&&!this["line"+i]){this["line"+i]=new MovieClip,this["line"+i].x=0==i?420:95;var a=GlobalConfig.MasterEquipAwakeConf;a[s]&&a[s][n]&&a[s][n].effPos&&(this["line"+i].y=a[s][n].effPos),this["line"+i].height=100,this["line"+i].scaleY=(e-t)/70,this.bodyGroup.addChildAt(this["line"+i],1),this["line"+i].playFile(RES_DIR_EFF+o[1].eff,-1)}},e.prototype.updateView=function(){if(this.skin&&this.role){this.setRedPoint();for(var t=0;t<this.role.powerEquipItemData.length;t++)this.setItem(t,t==this.selectPos);var e=PowerEquipCT.ins().powerEquipLevel,i=PowerEquipCT.ins().powerEquipGodLevel;this.powerEquipValue.text="主宰"+StringUtils.NumberToChinese(e)+"级";for(var s=CommonUtils.getObjectLength(GlobalConfig.MasterLevelConf),t=s;t>0;t--){var n=GlobalConfig.MasterLevelConf[t];(e==s||e<n.level)&&this.barbc.setMaxValue(n.godpower)}if(this.barbc.setValue(i),this.barbc.setLbValueText(i+"/"+this.barbc.getMaxValue()),!(this.selectPos<0)){this.cleanEff();var o=this.role.powerEquipAwakeLv[this.selectPos],a=GlobalConfig.MasterEquipAwakeConf[this.selectPos],r=PowerEquipAwakeCT.equipNames[this.selectPos],l=PowerEquipAwakeCT.getPosName(this.selectPos),h=(this.selectPos+1)%2==0?2:1,p=a[o],u=a[o+1],d="",c="",f="",g="";this.rightAttr.text=this.leftAttr.text="";var y=1==h?1:0,v=PowerEquipAwakeCT.getPosStage(this.role,y),m=PowerEquipAwakeCT.getPosName(1==h?0:1);if(p){this.title0.text=o+"阶"+l+r,this.starList0.setStarNum(o),d+=AttributeData.getAttStr(p.attrs,0,1,"："),d+="\n"+AttributeData.getAttStr(p.exattr,0,1,"："),this.attr2.text=d;var T=0;for(var t in v){var C=1==h?2*parseInt(t)+1:2*(parseInt(t)+1);this["suitpart"+t].visible=!0,this["suitpart"+t].text=o+"阶"+PowerEquipAwakeCT.equipNames[C-1],this["suitpart"+t].textColor=v[t]==o?3535360:9144715,v[t]==o&&T++}this.isElert=o>0&&4==T,this.equipName.text=StringUtils.NumberToChinese(o)+"阶"+m+"套装("+T+"/4)",this.leftAttr.visible=!0;var I=GlobalConfig.MasterEquipAwakeSuitConf[1][o];if(I){for(var w in I){var b=9144715;T>=parseInt(w)&&(b=2==parseInt(w)?1656278:3==parseInt(w)?16319085:16220977),f+="\n|C:"+b+"&T:"+o+"阶"+w+"件套装：\n",I[w].attrs&&(f+=this.getDesc(I[w].attrs,parseInt(w))),I[w].exattr&&(f+=this.getDesc(I[w].exattr,parseInt(w))),f+="|"}this.leftAttr.textFlow=TextFlowMaker.generateTextFlow1(f)}else this.leftAttr.textFlow=TextFlowMaker.generateTextFlow1("\n|C:0x8B898B&T:无套装效果|")}if(u){if(a&&a[o+1]&&a[o+1].levelLimit>e)this.redPoint0.visible=this.executeBtn1.enabled=!1,this.costLabel.text="觉醒下阶需要主宰"+StringUtils.NumberToChinese(a[o+1].levelLimit)+"级",this.cur1.text="",this.cost.source="";else{this.executeBtn1.enabled=!!this.role.powerEquipItemData[this.selectPos].configID,this.costLabel.text="消耗：",this.cost.source=u.consumeList[0].id+"_png";var S=u.consumeList[0];this.itemId=S.id,this.cost.source=S.id+"_png";var B=ItemUtil.isEquip(GlobalConfig.ItemConfig[S.id])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,R=BagCT.ins().getBagGoodsCountById(B,S.id),_="";R>=S.count?(_=ColorUtil.GREEN_COLOR,this.isCost=!0,this.redPoint0.visible=0!=this.role.powerEquipItemData[this.selectPos].configID):(_=ColorUtil.RED_COLOR,this.redPoint0.visible=this.isCost=!1),this.cur1.textFlow=TextFlowMaker.generateTextFlow("<font color="+_+">"+R+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+S.count+"</font> ")}this.starList1.setStarNum(o+1),this.title1.text=o+1+"阶"+l+r,c+=AttributeData.getAttStr(u.attrs,0,1,"："),c+="\n"+AttributeData.getAttStr(u.exattr,0,1,"："),this.attr3.text=c;var T=0;for(var P in v){var k=1==h?2*parseInt(P)+1:2*(parseInt(P)+1),x=parseInt(P)+4;this["suitpart"+x].visible=!0,this["suitpart"+x].text=o+1+"阶"+PowerEquipAwakeCT.equipNames[k-1],this["suitpart"+x].textColor=v[P]==o+1?3535360:9144715,v[P]==o+1&&T++}this.equipName0.text=StringUtils.NumberToChinese(o+1)+"阶"+m+"套装("+T+"/4)",this.rightAttr.visible=!0;var I=GlobalConfig.MasterEquipAwakeSuitConf[1][o+1];if(I){for(var w in I){var b=9144715;T>=parseInt(w)&&(b=2==parseInt(w)?1656278:3==parseInt(w)?16319085:16220977),g+="\n|C:"+b+"&T:"+(o+1)+"阶"+w+"件套装：\n",I[w].attrs&&(g+=this.getDesc(I[w].attrs,parseInt(w))),I[w].exattr&&(g+=this.getDesc(I[w].exattr,parseInt(w))),g+="|"}this.rightAttr.textFlow=TextFlowMaker.generateTextFlow1(g)}else this.rightAttr.textFlow=TextFlowMaker.generateTextFlow1("\n|C:0x8B898B&T:无套装效果|")}this.leftGroup.horizontalCenter=this.attrGroup2.horizontalCenter=u?this.oldHorizontalCenter:0,this.rightGroup.visible=this.upGrupGroup.visible=this.getTreasureBtn.visible=this.arrow0.visible=this.attrGroup0.visible=!!u,this.topLevel.visible=!u;var E=1,M=0,D=PowerEquipAwakeCT.getPosStage(this.role,E),A=Math.max.apply(null,D),G=PowerEquipAwakeCT.getPosStage(this.role,M),L=Math.max.apply(null,G);if(A){var T=0,F=[];for(var t in D){var O=2*parseInt(t)+1;D[t]==A&&(T++,F.push(O-1))}this.playEff(F,E)}if(L){var F=[];for(var P in G){var U=2*(parseInt(P)+1);G[P]==L&&F.push(U-1)}this.playEff(F,M)}}}},e.prototype.getDesc=function(t,e){var i="";for(var s in t){var n=AttributeData.getAttrStrByType(t[s].type),o=(t[s].value/100).toFixed(1)+"%";i+=(4>e?"主宰装备":"")+(""+n)+"+"+o+"\n"}return i},e.prototype.playEff=function(t,e){if(t.length>1){var i=[];for(var s in t)this.updateEff(t[s],e),i.push(this["equip"+t[s]].y);var n=Math.max.apply(null,i),o=Math.min.apply(null,i);n&&(o||0==o)&&this.addEff(o,n,e)}},e.prototype.setItem=function(t,e){void 0===e&&(e=!1);var i=this["equip"+t];if(null!=i){var s=this.role.powerEquipItemData[t],n=s.itemConfig;if(i.select.visible=e,i.data=s.itemConfig,0==s.configID?(i.itemIcon.imgIcon.source=t>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[t],this.equipName.text=""):i.data=s.itemConfig,e){if(void 0==n)return void(this.title0.textColor=this.title1.textColor=16767295);this.equipName.text=n.name,this.title0.textColor=this.title1.textColor=i.level.textColor}}},e.prototype.setRedPoint=function(){for(var t=PowerEquipAwakeRedPoint.ins().roleEquipRedPoint[this.currRoleId],e=0;e<t.length;e++)this["equip"+e].setRedPoint(t[e]);return!0},e.prototype.onTouch=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[52].text);break;case this.equip0:this.selectPos=0;break;case this.equip1:this.selectPos=1;break;case this.equip2:this.selectPos=2;break;case this.equip3:this.selectPos=3;break;case this.equip4:this.selectPos=4;break;case this.equip5:this.selectPos=5;break;case this.equip6:this.selectPos=6;break;case this.equip7:this.selectPos=7;break;case this.getTreasureBtn:WarnCT.ins().setBuyGoodsWarn(this.itemId,1);break;case this.executeBtn1:if(!this.isCost)return void TipsCT.ins().showTips("消耗材料不足");this.isElert?HuntWarnBuyWin.showBuyWarn("PowerEquipAwakePanel",this.huntWarnFun.bind(this),"觉醒为高阶装备可能会失去套装属性导致战力下降，是否继续觉醒？"):PowerEquipAwakeCT.ins().sendUpAwake(this.currRoleId,this.selectPos)}(t.target==this.executeBtn1||t.target instanceof PowerEquipItem)&&this.updateView()},e.prototype.huntWarnFun=function(){PowerEquipAwakeCT.ins().sendUpAwake(this.currRoleId,this.selectPos)},e.prototype.setRoleId=function(t){this.currRoleId=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currRoleId),this.skin&&this.updateView()},e}(BaseView);__reflect(PowerEquipAwakePanel.prototype,"PowerEquipAwakePanel"),window.PowerEquipAwakePanel=PowerEquipAwakePanel;var UpStarList=function(t){function e(e){var i=t.call(this)||this;i.list=[],i._starNum=e,i.list=[];for(var s=0;s<i._starNum;s++)i.img=new eui.Image,i.img.x=20*s,i.addChild(i.img),i.list.push(i.img);return i}return __extends(e,t),e.prototype.setStarNum=function(t){for(var e="",i=0;i<this._starNum;i++)this.list[i].source=e;if(t){var s=Math.floor((t-1)/this._starNum);switch(s){case 0:e="zhuzaijxxx_png";break;case 1:e="zhuzaijxyl_png";break;case 2:e="zhuzaijxzs_png"}var n=t%this._starNum;t%this._starNum==0&&(n=this._starNum);for(var i=0;n>i;i++)this.list[i].source=e}},e}(BaseView);__reflect(UpStarList.prototype,"UpStarList"),window.UpStarList=UpStarList;var PunchAwakeCT=function(t){function e(){var e=t.call(this)||this;return e.awakeData=[],e.power=0,e.isActive=!1,e.sysId=PackageID.Skill,e.regNetMsg(15,e.postInit),e.regNetMsg(16,e.postUpLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){if(this.isActive=!0,this.awakeData=[],this.isActive){for(var e=t.readByte(),i=0;e>i;i++){var s={pos:i,level:t.readShort()};this.awakeData.push(s)}this.power=t.readInt()}},e.prototype.postUpLevel=function(t){this.awakeData[t.readByte()-1].level=t.readShort(),this.power=t.readInt()},e.prototype.sendUpLevel=function(t){var e=this.getBytes(15);e.writeByte(t),this.sendToServer(e)},e.prototype.getSuitNum=function(){var t=[];for(var e in this.awakeData)t.push(this.awakeData[e].level);return t.sort(this.sort),t[0]},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t,e)},e.prototype.getSumNum=function(t){var e=0;for(var i in this.awakeData)this.awakeData[i].level>=t&&e++;return e},e.prototype.getCfgStage=function(t){var e=0,i=GlobalConfig.RunesawareSystemSuitConfig;for(var s in i){if(t<Number(s)){e=Number(s);break}e=Number(s)}return e},e.prototype.getNameByPos=function(t){return GlobalConfig.RunesAwareSystemBaseConfig.posName[t]},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postUpLevel",null),e}(BaseSystem);__reflect(PunchAwakeCT.prototype,"PunchAwakeCT"),System.PunchAwakeCT=function(){return PunchAwakeCT.ins()},window.PunchAwakeCT=PunchAwakeCT;var PunchAwakeRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemChange,PunchAwakeCT.ins().postUpLevel,PunchAwakeCT.ins().postInit),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){if(SkillCT.ins().checkHejiOpen()){var t=PunchAwakeCT.ins();if(t.awakeData[0]){this.redPoint=!1;for(var e in t.awakeData){var i=t.awakeData[e].level,s=GlobalConfig.RunesawareLevelConfig[Number(e)+1][i+1];if(s&&s.consumes&&s.consumes[0]){var n=s.consumes[0].id,o=ItemUtil.isEquip(GlobalConfig.ItemConfig[n])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,a=BagCT.ins().getBagGoodsCountById(o,n);if(a>=s.consumes[0].count)return this.redPoint=!0}}return this.redPoint}}},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(PunchAwakeRedPoint.prototype,"PunchAwakeRedPoint"),System.PunchAwakeRedPoint=function(){return PunchAwakeRedPoint.ins()},window.PunchAwakeRedPoint=PunchAwakeRedPoint;var PunchAwakeItemTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="AwakeTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.itemIcon.imgJob.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=PunchAwakeCT.ins(),s=i.getSuitNum()||0,n=i.getCfgStage(s),o=i.getSumNum(n),a=GlobalConfig.RunesawareSystemSuitConfig,r=0,l="";for(var h in i.awakeData)l+="|C:"+(i.awakeData[h].level>=n?327210:8026746)+"&T:"+i.getNameByPos(Number(h))+"|   ";this.curName.textFlow=TextFlowMaker.generateTextFlow1(l);for(var p in a[n]){var u=o<a[n][p].count?8026746:327210,d=o<a[n][p].count?8026746:11645079;this["desc"+r].textColor=d,this["desc"+r].textFlow=TextFlowMaker.generateTextFlow1("|C:"+u+"&T:["+StringUtils.NumberToChinese(n)+"阶]| "+p+"件套："+a[n][p].desc.replace("%s",d+"")),r++}var c=GlobalConfig.ItemConfig[t[0]];this.itemIcon.setData(c),this.nameLabel.text=c.name,this.nameLabel.textColor=ItemUtil.getQualityColor(c);var f=t[0]-372014,g=0,y=GlobalConfig.RunesawareLevelConfig[f];y&&(g+=BagCT.getAttrPower(y[1].attrs)),this.power.text="评分:"+g*SubRoles.ins().subRolesLen},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PunchAwakeItemTipsWin.prototype,"PunchAwakeItemTipsWin"),window.PunchAwakeItemTipsWin=PunchAwakeItemTipsWin,ViewManager.ins().reg(PunchAwakeItemTipsWin,LayerManager.UI_Popup);var PunchAwakeMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="PunchAwakeMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.roleSelect.hideRole(),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.onTabTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SkillCT.ins().postSkillUpgradeAll,this.updateRed),this.observe(PunchAwakeRedPoint.ins().postRedPoint,this.updateRed),this.updateRed();var i=t[0]||0;this.viewStack.selectedIndex=this.tab.selectedIndex=i,this.setOpenIndex(i)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.onTabTouching=function(t){return e.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.eTitle.source="biaoti_heji"}this.lastSelect!=t?this.lastSelect=t:this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.updateRed()},e.checkIsOpen=function(t){switch(t){case 0:if(!SkillCT.ins().checkHejiOpen())return TipsCT.ins().showTips("激活神器 火龙之心 后开启"),!1}return!0},e.prototype.updateRed=function(){var t=SkillCT.ins().canHejiEquip()||SkillCT.ins().canExchange()||SkillCT.ins().canSolve()||SkillCT.ins().canAcitve();this.redPoint1.visible=t||SkillCT.ins().getPunchForge().getRedPoint(),this.redPoint2.visible=PunchAwakeRedPoint.ins().postRedPoint()},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var s=t[0]||0;return e.checkIsOpen(s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().open(SkillWin)},e}(BaseEuiView);__reflect(PunchAwakeMainWin.prototype,"PunchAwakeMainWin"),window.PunchAwakeMainWin=PunchAwakeMainWin,ViewManager.ins().reg(PunchAwakeMainWin,LayerManager.UI_Main);var PunchAwakePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="PunchAwake",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=PunchAwakeCT.ins(),this.addTouchEvent(this,this.onClick),this.boss.touchEnabled=!1,this.costGroup.touchEnabled=!0,this.costGroup.touchChildren=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PunchAwakeCT.ins().postInit,this.updateUI),this.observe(PunchAwakeCT.ins().postUpLevel,this.updateUI),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.select=0,this.updateUI();var i=this.boss.x,s=this.boss.y,n=egret.Tween.get(this.boss);this.boss.scaleX=this.boss.scaleY=1.2,this.boss.x=50,this.boss.y=s+100,n.to({scaleX:1,scaleY:1,x:i,y:s},600,egret.Ease.backOut);for(var o,a=Object.keys(GlobalConfig.RunesawareLevelConfig).length,r=0;a>r;r++){o=this["item"+r];var l=o.x,h=o.y;o.x=i+80,o.y=s+100,o.scaleX=o.scaleY=.6,egret.Tween.removeTweens(o);var p=egret.Tween.get(o);p.to({x:l,y:h,scaleX:1,scaleY:1},600,egret.Ease.backOut)}},e.prototype.updateUI=function(){this.powerPanel.setPower(this.ins.power);var t=this.ins.getSuitNum()||0,e=this.ins.getCfgStage(t),i=this.ins.getSumNum(e),s=GlobalConfig.RunesawareSystemSuitConfig,n=0;for(var o in s[e]){var a=i<s[e][o].count?8026746:327210,r=i<s[e][o].count?8026746:11645079;this["icon"+n].filters=i<s[e][o].count?FilterUtil.ARRAY_GRAY_FILTER:null,this["desc"+n].textColor=r,this["desc"+n].textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:["+StringUtils.NumberToChinese(e)+"阶]| "+o+"件套："+s[e][o].desc.replace("%s",r+"")),n++}this.update()},e.prototype.update=function(){for(var t,e=Object.keys(GlobalConfig.RunesawareLevelConfig).length,i=0;e>i;i++)t=this["item"+i],t.data=[i,this.select];var s=this.ins.isActive?this.ins.awakeData[this.select].level:0,n=GlobalConfig.RunesawareLevelConfig[this.select+1][s+1];if(n&&n.consumes&&n.consumes[0]){this.itemId=n.consumes[0].id,this.icon.source=GlobalConfig.ItemConfig[this.itemId].icon+"_png";var o=ItemUtil.isEquip(GlobalConfig.ItemConfig[this.itemId])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;this.itemNum=BagCT.ins().getBagGoodsCountById(o,this.itemId),this.needNum=n.consumes[0].count;var a=this.itemNum>=this.needNum?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR;this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+a+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.needNum+"</font> "),this.awakeBtn.enabled=this.itemNum>=this.needNum}this.awakeBtn.visible=this.costGroup.visible=!!n,this.isMax.visible=!n},e.prototype.onClick=function(t){switch(t.target instanceof RuneAwakeItem&&(this.select=t.target.data[0],this.update()),t.target){case this.attrBtn:ViewManager.ins().open(PunchEquipAttrWin,1);break;case this.suitBtn:ViewManager.ins().open(PunchAwakeTipsWin);break;case this.awakeBtn:this.ins.sendUpLevel(this.select+1);break;case this.costGroup:ViewManager.ins().open(PunchAwakeItemTipsWin,this.itemId)}},e}(BaseView);__reflect(PunchAwakePanel.prototype,"PunchAwakePanel"),window.PunchAwakePanel=PunchAwakePanel;var PunchAwakeTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="PunchAwakeSkillTips",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=PunchAwakeCT.ins(),s=i.getSuitNum()||0,n=i.getCfgStage(s),o=i.getCfgStage(n),a=i.getSumNum(n),r=Object.keys(GlobalConfig.RunesAwareSystemBaseConfig.posName).length,l=GlobalConfig.RunesawareSystemSuitConfig,h=0;for(var p in l){h=Number(p);break}var u="";for(var d in i.awakeData)u+="|C:"+(i.awakeData[d].level>=n?327210:8026746)+"&T:"+i.getNameByPos(Number(d))+"|   ";this.curName.textFlow=TextFlowMaker.generateTextFlow1(u);var c="",f=GlobalConfig.RunesawareSystemSuitConfig[n];for(var g in f){var y=a<Number(g)?8026746:327210,v=a<Number(g)?8026746:11645079;c+="|C:"+y+"&T:["+StringUtils.NumberToChinese(n)+"阶] ||C:"+v+"&T:觉醒"+g+"件套激活属性\n"+f[g].desc.replace("%s",v+"")+"|\n\n"}if(this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(c),h>s)this.currentState="unactive",this.curState.text="\n			当前套装效果("+a+"/"+r+")";else if(n==o)this.currentState="max",this.curState.text=n+"阶套装效果("+a+"/"+r+")";else{this.currentState="active";var m=i.getSumNum(s);this.curState.text=s+"阶套装效果("+m+"/"+r+")",this.nextState.text=n+"阶套装效果("+a+"/"+r+")";var T="",C=GlobalConfig.RunesawareSystemSuitConfig[s];for(var d in C)T+="|C:0x04FE2A&T:["+StringUtils.NumberToChinese(s)+"阶]| |C:0xB1B097&T:觉醒"+d+"件套激活属性\n"+C[d].desc.replace("%s","11645079")+"|\n\n";this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(T);var I="",w="";for(var d in i.awakeData)w+="|C:0x04FE2A&T:"+i.getNameByPos(Number(d))+"|   ",I+="|C:"+(i.awakeData[d].level>=n?327210:8026746)+"&T:"+i.getNameByPos(Number(d))+"|   ";this.curName.textFlow=TextFlowMaker.generateTextFlow1(w),this.nextName.textFlow=TextFlowMaker.generateTextFlow1(I);var b="",S=GlobalConfig.RunesawareSystemSuitConfig[n];for(var g in S){var y=a<Number(g)?8026746:327210,v=a<Number(g)?8026746:11645079;b+="|C:"+y+"&T:["+StringUtils.NumberToChinese(n)+"阶] ||C:"+v+"&T:觉醒"+g+"件套激活属性\n"+S[g].desc.replace("%s",v+"")+"|\n\n"}this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(b)}},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PunchAwakeTipsWin.prototype,"PunchAwakeTipsWin"),window.PunchAwakeTipsWin=PunchAwakeTipsWin,ViewManager.ins().reg(PunchAwakeTipsWin,LayerManager.UI_Popup);var RuneAwakeItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="PunchAwakeItem",e.mc=new MovieClip,e.eff.addChild(e.mc),e.eff.touchEnabled=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=PunchAwakeCT.ins(),e=this.data[0];this.select.visible=e==this.data[1];var i=t.awakeData[e]?t.awakeData[e].level:0;this.level.text=i+"阶",this.awakeEquip.icon="awakeitem"+(e+1),this.awakeEquip.filters=this.eff.filters=i?null:FilterUtil.ARRAY_GRAY_FILTER,this.mc.playFile(RES_DIR_EFF+(""+GlobalConfig.RunesAwareSystemBaseConfig.posEff[e]),-1),this.redPoint.visible=!1;var s=GlobalConfig.RunesawareLevelConfig[e+1][i+1];if(s&&s.consumes&&s.consumes[0]){var n=s.consumes[0].id,o=ItemUtil.isEquip(GlobalConfig.ItemConfig[n])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,a=BagCT.ins().getBagGoodsCountById(o,n);this.redPoint.visible=a>=s.consumes[0].count}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseItemRender);__reflect(RuneAwakeItem.prototype,"RuneAwakeItem"),window.RuneAwakeItem=RuneAwakeItem;var RareAnimalCT=function(t){function e(){var e=t.call(this)||this;return e.helpNum=0,e.passNum=0,e.cdCount=0,e.isBackShow=!1,e.sysId=PackageID.Guanqia,e.regNetMsg(48,e.postInit),e.regNetMsg(49,e.postFbInfo),e.regNetMsg(51,e.postTeamNum),e.regNetMsg(52,e.postEnterTeam),e.regNetMsg(53,e.postQuit),e.regNetMsg(54,e.postTeamInfo),e.regNetMsg(55,e.postFbResult),e.regNetMsg(56,e.postInvite),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.fbType=t.readUnsignedByte(),this.passNum=t.readUnsignedByte(),this.helpNum=t.readUnsignedByte()},e.prototype.postFbInfo=function(t){this.fbTime=GameServer.serverTime+1e3*t.readUnsignedInt(),this.attackTimes=t.readUnsignedByte(),this.vocation=t.readUnsignedByte()},e.prototype.postTeamNum=function(t){this.teamID=t.readUnsignedInt(),this.teamID?ViewManager.ins().open(RareAnimalTeamWin,this.fbType,this.teamID):ViewManager.ins().close(RareAnimalTeamWin)},e.prototype.postEnterTeam=function(t){switch(t.readUnsignedByte()){case 0:ViewManager.ins().open(RareAnimalTeamWin,this.fbType,t.readUnsignedInt());break;case 1:TipsCT.ins().showTips("在副本内不能进入");break;case 2:TipsCT.ins().showTips("已经在别的队伍");break;case 3:TipsCT.ins().showTips("队伍已解散");break;case 4:TipsCT.ins().showTips("队伍已经满人")}},e.prototype.postQuit=function(t){switch(t.readUnsignedByte()){case 1:break;case 2:TipsCT.ins().showTips("您被队长踢出队伍");break;case 3:TipsCT.ins().showTips("队长解散了队伍")}ViewManager.ins().close(RareAnimalTeamWin)},e.prototype.postTeamInfo=function(t){this.teamID=t.readInt();var e=t.readByte();this.tfMembers||(this.tfMembers=[]),this.tfMembers.length=e,this.isTFCaptain=!1;for(var i,s=0;e>s;s++)i=this.tfMembers[s],i||(i=new TeamFuBenRoleVo,this.tfMembers[s]=i),i.parse(t),i.roleID==Actor.actorID&&1==i.position&&(this.isTFCaptain=!0)},e.prototype.postFbResult=function(t){t.readUnsignedInt(),t.readUnsignedByte();this.attackTimes=t.readUnsignedByte();var e=t.readUnsignedByte();this.teamInfo=[],this.teamInfo.length=e;for(var i,s=0;e>s;s++)i=new TeamFuBenRoleVo,this.teamInfo[s]=i,i.roleID=t.readInt(),i.position=t.readByte();ViewManager.ins().open(RareAnimalResultWin,this.fbType,this.attackTimes,this.teamInfo)},e.prototype.resetCD=function(){this.cdCount>0?this.cdCount--:Timer.stop(this.resetCD,this)},e.prototype.postInvite=function(t){var e=(t.readUnsignedInt(),t.readString());this.helpInfo=e,ChatCT.ins().postSysChatMsg(new ChatSystemData(3,e)),Timer.stop(this.resetCD,this);var i=Math.floor((1e3*t.readUnsignedInt()+1e3*DateUtils.SECOND_2020-GameServer.serverTime)/1e3);this.cdCount=i,Timer.start(1e3,i+1,this.resetCD,this)},e.prototype.sendEnterFB=function(){this.sendBaseProto(48)},e.prototype.sendAward=function(t,e,i){var s=this.getBytes(50);s.writeByte(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.sendCreatTeam=function(){this.sendBaseProto(51)},e.prototype.sendEnterTeam=function(t){var e=this.getBytes(52);e.writeUnsignedInt(t),this.sendToServer(e)},e.prototype.sendQuitTeam=function(){this.sendBaseProto(53)},e.prototype.sendQuitMember=function(t){var e=this.getBytes(54);e.writeUnsignedInt(t),this.sendToServer(e)},e.prototype.sendInvite=function(t){var e=this.getBytes(56);e.writeString(t),this.sendToServer(e)},e.prototype.sendUpdate=function(){this.sendBaseProto(57)},e.prototype.checkOpen=function(t){var e=GlobalConfig.AnimalsBaseConfig,i="";return GameServer.serverOpenDay+1<e.openDays?i="开服"+e.openDays+"天开启":ZsCT.ins().lv<e.zhuanShengLv&&(i+="角色等级达到"+e.zhuanShengLv+"转开启"),t&&i&&TipsCT.ins().showTips(i),!i},e.prototype.getAwardNum=function(t){var e,i=GlobalConfig.AnimalsBaseConfig.attacks;for(var s in i)i[s]<=t&&(e=Number(s)+1);return e},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postFbInfo",null),__decorate([post()],e.prototype,"postTeamNum",null),__decorate([post()],e.prototype,"postEnterTeam",null),__decorate([post()],e.prototype,"postQuit",null),__decorate([post()],e.prototype,"postTeamInfo",null),__decorate([post()],e.prototype,"postFbResult",null),__decorate([post()],e.prototype,"postInvite",null),e}(BaseSystem);__reflect(RareAnimalCT.prototype,"RareAnimalCT"),System.RareAnimalCT=function(){return RareAnimalCT.ins()},window.RareAnimalCT=RareAnimalCT;var RareAnimalFbUI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YsFbFightSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=RareAnimalCT.ins(),this.teamGroup.touchEnabled=this.teamGroup.touchChildren=!1,this.deadGroup.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postFbInfo,this.updateUI),this.addTouchEvent(this,this.onClick),Timer.has(this.update,this)||Timer.start(1e3,0,this.update,this),this.update(),this.updateUI()
},e.prototype.removeDisplay=function(){Timer.stop(this.update,this)},e.prototype.updateUI=function(){this.awardName.text=1==this.ins.vocation?"通关宝箱":"协助宝箱";var t=GlobalConfig.AnimalsBaseConfig;this.fbName.text=this.ins.fbType?t.fbName[this.ins.fbType-1]:t.fbName[6],this.attackNum.source=t.fbWordImg[this.ins.attackTimes-1];for(var e in t.attacks){var i=Number(e)+1;this["Trea"+i].visible=!1,this["lab"+i].visible=this["Num"+i].visible=!1,t.attacks[e]<=this.ins.attackTimes?this["Trea"+i].visible=!0:(this["lab"+i].visible=this["Num"+i].visible=!0,this["lab"+i].text="第"+t.attacks[e]+"波");var s=t.attacks[i];if(s){this["bar"+i].maximum=100;var n=s-t.attacks[e],o=this.ins.attackTimes-t.attacks[e];t.attacks[e]<=this.ins.attackTimes?this["bar"+i].value=Math.floor(o/n*100):this["bar"+i].value=0}}},e.prototype.update=function(){this.deadGroup.visible=SubRoles.lookAtTar.action==EntityAction.DIE;var t,e,i,s=EntityManager.ins().getAllEntity(),n=[],o=[];for(var a in s)if(t=s[a],i=t.infoModel,i&&i.type==EntityType.Role&&(e=i,e.masterHandle!=Actor.handle)){var r=n.indexOf(e.masterHandle);-1==r?(n.push(e.masterHandle),o[o.length]=[t]):o[r].push(t)}this.teamGroup.visible=o.length>0;for(var l,h=o.length,a=0;2>a;a++)if(l=this["member"+(a+1)],h>=a+1){l.visible=!0,l.data=o[a];var p=!0;for(var u in l.data){var d=l.data[u];if(d.action!=EntityAction.DIE){p=!1;break}}l.roleHead.filters=p?FilterUtil.ARRAY_GRAY_FILTER:null}else l.visible=!1;var c=(this.ins.fbTime-GameServer.serverTime)/1e3,f=c>0?c:0;this.times.text=DateUtils.getFormatBySecond(f,DateUtils.TIME_FORMAT_10)},e.prototype.onClick=function(t){t.target},e}(BaseEuiView);__reflect(RareAnimalFbUI.prototype,"RareAnimalFbUI"),window.RareAnimalFbUI=RareAnimalFbUI,ViewManager.ins().reg(RareAnimalFbUI,LayerManager.UI_Main);var RareAnimalItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="YsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data[1]){var t=this.data[1]-1,e=GlobalConfig.AnimalsBaseConfig;this.dayName.text=e.fbName[this.data[0]],this.awardName.text=e.awardName[t];var i=GlobalConfig.AnimalsRewardConfig[this.data[0]][t+1];this.eList.dataProvider=new eui.ArrayCollection(i.rewards)}},e}(BaseItemRender);__reflect(RareAnimalItem.prototype,"RareAnimalItem"),window.RareAnimalItem=RareAnimalItem;var RareAnimalPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YsFiveElementsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ins=RareAnimalCT.ins(),this.rule.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.rule.text+"</u>"),this.showMore.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.showMore.text+"</u>"),this.ins.sendUpdate()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.addTouchEvent(this,this.onClick),this.update()},e.prototype.update=function(){var t=GlobalConfig.AnimalsBaseConfig;this.eImg.source=t.fbImg[this.ins.fbType],this.passNum.text="通关奖励次数："+this.ins.passNum,this.helpNum.text="协助奖励次数："+this.ins.helpNum;var e=GlobalConfig.AnimalsRewardConfig[this.ins.fbType];e||(e=GlobalConfig.AnimalsRewardConfig[1]);var i=Object.keys(e).length,s=[];s.push([this.ins.fbType,i]),this.eList.dataProvider=new eui.ArrayCollection(s),this.eRp.visible=DailyFbRedPoint.ins().rareRed;var n=new Date(GameServer.serverTime).getDay(),o=0>n-1?6:n-1,a=n+1==7?0:n+1;this.name0.source=t.fbNameImg[o],this.name0.filters=FilterUtil.ARRAY_GRAY_FILTER,this.day0.text="周"+DateUtils.WEEK_CN[o],this.name1.source=t.fbNameImg[n],this.day1.text="周"+DateUtils.WEEK_CN[n],this.name2.source=t.fbNameImg[a],this.day2.text="周"+DateUtils.WEEK_CN[a],this.name2.filters=FilterUtil.ARRAY_GRAY_FILTER},e.prototype.onClick=function(t){switch(t.target){case this.rule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[60].text);break;case this.showMore:ViewManager.ins().open(RareAnimalShowWin);break;case this.challenge:if(!this.ins.passNum)return void TipsCT.ins().showTips("今日可通关次数为0");ViewManager.ins().open(RareAnimalTeamWin,this.ins.fbType,0)}},e}(BaseView);__reflect(RareAnimalPanel.prototype,"RareAnimalPanel"),window.RareAnimalPanel=RareAnimalPanel;var RareAnimalResultWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YsResultSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.fbType=t[0],this.attacks=t[1],this.level=RareAnimalCT.ins().getAwardNum(t[1]),this.img.source=GlobalConfig.AnimalsBaseConfig.awardImg[this.level-1];var i,s=[];this.isHelp=!1;for(var n=!1,o=0;o<t[2].length;o++)2==t[2][o].position?(i=t[2].splice(o,1)[0],s.push(i),i.roleID==Actor.actorID&&(this.isHelp=!0),o--):1==t[2][o].position&&t[2][o].roleID==Actor.actorID&&(n=!0);this.currentState=this.isHelp?"helper":"leader";var a=GlobalConfig.AnimalsRewardConfig[this.fbType][this.level];if(this.isHelp)this.eList0.dataProvider=new eui.ArrayCollection([a.rewards[2]]);else{this.eList0.dataProvider=new eui.ArrayCollection([a.rewards[1]]),this.eList1.dataProvider=new eui.ArrayCollection([a.rewards[0]]),this.desc.text="消耗元宝额外领取(价值"+a.value+"元宝)",this.cost.text=a.needYbCount+"";var r="";for(var o in a.awardName)r+=a.awardName[o]+"   ";this.award.text=r}},e.prototype.onClick=function(t){switch(t.target){case this.freeGet:this.isHelp?RareAnimalCT.ins().sendAward(1,this.attacks,2):RareAnimalCT.ins().sendAward(1,this.attacks,1),ViewManager.ins().close(this);break;case this.ybGet:var e=GlobalConfig.AnimalsRewardConfig[this.fbType][this.level];if(Actor.yb<e.needYbCount)return void TipsCT.ins().showTips("元宝不足");RareAnimalCT.ins().sendAward(2,this.attacks,1),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(RareAnimalResultWin.prototype,"RareAnimalResultWin"),window.RareAnimalResultWin=RareAnimalResultWin,ViewManager.ins().reg(RareAnimalResultWin,LayerManager.UI_Popup);var RareAnimalShowWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YsMoreExhibition",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.AnimalsRewardConfig[RareAnimalCT.ins().fbType],s=[];for(var n in i)s.push([RareAnimalCT.ins().fbType,Number(n)]);s.sort(this.sort),this.eList.dataProvider=new eui.ArrayCollection(s)},e.prototype.sort=function(t,e){return Algorithm.sortDesc(t[1],e[1])},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(RareAnimalShowWin.prototype,"RareAnimalShowWin"),window.RareAnimalShowWin=RareAnimalShowWin,ViewManager.ins().reg(RareAnimalShowWin,LayerManager.UI_Popup);var RareAnimalTeamWin=function(t){function e(){var e=t.call(this)||this;return e.room=0,e.skinName="YsTeamSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ins=RareAnimalCT.ins(),this.addTouchEvent(this,this.onClick),this.observe(RareAnimalCT.ins().postTeamNum,this.createSuccess),this.observe(RareAnimalCT.ins().postTeamInfo,this.onRoomInfoChange),this.type=t[0],this.room=t[1],this.update(),this.onRoomInfoChange(),ViewManager.ins().open(ChatMainUI)},e.prototype.close=function(){ViewManager.ins().close(ChatMainUI)},e.prototype.createSuccess=function(){this.room=this.ins.teamID,this.onRoomInfoChange()},e.prototype.onRoomInfoChange=function(){if(this.room){for(var t,e=this.ins.tfMembers?this.ins.tfMembers.length:0,i=[this.member1,this.member2],s=0;e>s;s++)1==this.ins.tfMembers[s].position?this.leader.data={vo:this.ins.tfMembers[s],type:1,configID:1}:(t=i.shift(),t.data={vo:this.ins.tfMembers[s],type:1,configID:1});e=i.length;for(var s=0;e>s;s++)i[s].data={vo:null,type:1,configID:1};i.length=0,i=null,this.member1.visible=null!=this.member1.data,this.member2.visible=null!=this.member2.data,this.leader.visible=null!=this.leader.data}},e.prototype.update=function(){var t=GlobalConfig.AnimalsRewardConfig[this.type],e=Object.keys(t).length,i=[];i.push([this.type,e]),this.eList.dataProvider=new eui.ArrayCollection(i),this.leader.visible=this.member1.visible=this.member2.visible=!1,this.room<=0&&this.ins.sendCreatTeam()},e.prototype.onClick=function(t){var i=this;switch(t.target){case this.closeBtn:WarnWin.show("是否退出房间",function(){i.ins.sendQuitTeam(),ViewManager.ins().close(i)},this);break;case this.challenge:if(!KfArenaSys.ins().checkIsMatching())return;if(!this.ins.isTFCaptain)return void TipsCT.ins().showTips("队长才能开启进入副本");this.ins.sendEnterFB(),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(RareAnimalTeamWin.prototype,"RareAnimalTeamWin"),window.RareAnimalTeamWin=RareAnimalTeamWin,ViewManager.ins().reg(RareAnimalTeamWin,LayerManager.UI_Popup);var RexueDideCT=function(t){function e(){var e=t.call(this)||this;return e.overTime=0,e._tick=[],e.sysId=PackageID.RexueDide,e.regNetMsg(1,e.postOverTime),e.regNetMsg(2,e.postTickInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postOverTime=function(t){this.overTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.sendTick=function(t,e){var i=this.getBytes(1);i.writeInt(t),i.writeInt(e?1:0),this.sendToServer(i)},e.prototype.postTickInfo=function(t){this._tick=[];for(var e=t.readUnsignedInt(),i=0;e>i;i++){var s=t.readInt();this._tick[s]=t.readInt()}},e.prototype.sendInfo=function(){this.sendBaseProto(3)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.AuxiliaryBaseConfig,i="";return GameServer.serverOpenDay+1<e.openDay?i="开服"+e.openDay+"天开启":ZsCT.ins().lv<e.zsLv&&(i=e.zsLv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},Object.defineProperty(e.prototype,"isAct",{get:function(){return this.overTime>GameServer.serverTime},enumerable:!0,configurable:!0}),e.prototype.getTickById=function(t){return this._tick[t]>0},e.prototype.clearTick=function(){this._tick.length>0&&(this._tick=[])},e.checkEnoughTimeById=function(t,i,s){var n=GlobalConfig.AuxiliaryBaseConfig.multiply[t-1];if(!(0>=i)){if(!e.ins().isAct||!e.ins().getTickById(t)||i>=n||t==RexueID.PublicBoss)return void s();var o=WarnWin.show("剩余次数仅剩<font color="+ColorUtil.GREEN+">"+i+"次</font>，无法"+n+"倍挑战",function(){s()},this);o.setBtnLabel((n>2&&i>1?i+"倍":"单次")+"挑战","取消")}},__decorate([post()],e.prototype,"postOverTime",null),__decorate([post()],e.prototype,"postTickInfo",null),e}(BaseSystem);__reflect(RexueDideCT.prototype,"RexueDideCT");var RexueID;!function(t){t[t.WorldBoss=1]="WorldBoss",t[t.PublicBoss=2]="PublicBoss",t[t.ShenyuBoss=4]="ShenyuBoss",t[t.GwBoss=5]="GwBoss",t[t.XcBoss=8]="XcBoss",t[t.KuafuBoss=9]="KuafuBoss"}(RexueID||(RexueID={})),window.RexueID=RexueID,window.RexueDideCT=RexueDideCT,System.RexueDideCT=function(){return RexueDideCT.ins()};var RexueDideItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="RexueDideItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.id>0){var t=this.data.id,e=this.data.lv,i=GlobalConfig.AuxiliaryConfig[t];this.eIcon.source=i.icon,this.sName=i.name,this.sDesc=i.desc;var s=ZsCT.ins().lv>=e;this.sTips=s?"":e+"转开启",this.eCheckBox.enabled=RexueDideCT.ins().isAct&&s,this.eCBGroup.touchEnabled=!this.eCheckBox.enabled,this.eCheckBox.selected=RexueDideCT.ins().getTickById(i.id)}},e.prototype.showTips=function(){RexueDideCT.ins().isAct?this.data&&this.data.lv>0&&ZsCT.ins().lv<this.data.lv&&TipsCT.ins().showTips(this.data.lv+"转开启"):TipsCT.ins().showTips("未开通热血助手")},e}(BaseItemRender);__reflect(RexueDideItemRender.prototype,"RexueDideItemRender"),window.RexueDideItemRender=RexueDideItemRender;var RexueDideWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="RexueDideSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=RexueDideItemRender,this.eList.dataProvider=this.listDP,RexueDideCT.ins().sendInfo()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(RexueDideCT.ins().postOverTime,this.update),this.addTouchEvent(this,this.onClick),this.update()},e.prototype.removeDisplay=function(){Timer.has(this.updateTime,this)&&Timer.stop(this.updateTime,this)},e.prototype.update=function(){this.updateList(),this.updateTime(),this.updateBtn(),RexueDideCT.ins().isAct&&(Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this))},e.prototype.updateBtn=function(){this.eBtn.label=GlobalConfig.AuxiliaryBaseConfig.money/100+"元"+(RexueDideCT.ins().isAct?"续费":"开通")},e.prototype.updateTime=function(){RexueDideCT.ins().isAct||RexueDideCT.ins().clearTick();var t=Math.max(0,RexueDideCT.ins().overTime-GameServer.serverTime);this.eTips.textFlow=TextFlowMaker.generateTextFlow(RexueDideCT.ins().isAct?"已开通热血助手，剩余时间|C:"+ColorUtil.GREEN+"&T:"+DateUtils.getFormatBySecond(t/1e3,DateUtils.TIME_FORMAT_5,3)+"|":"|C:"+ColorUtil.RED+"&T:暂未开通热血助手|，开通后有效期"+GlobalConfig.AuxiliaryBaseConfig.lastingdays+"日")},e.prototype.updateList=function(){var t=[],e=GlobalConfig.AuxiliaryBaseConfig.condition;for(var i in e){var s=e[i],n=GlobalConfig.AuxiliaryConfig[+i];n&&GameServer.serverOpenDay+1>=s.open&&t.push({id:+i,open:s.open,lv:s.level,sortId:n.sort})}t.sort(this.sort),this.listDP.replaceAll(t)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sortId,e.sortId)},e.prototype.onClick=function(t){if(t.target instanceof eui.CheckBox&&t.target.parent.parent.parent instanceof RexueDideItemRender){var e=t.target.parent.parent.parent.data.id||0;return void(e>0&&RexueDideCT.ins().sendTick(e,t.target.selected))}if(t.target instanceof eui.Group&&t.target.parent.parent instanceof RexueDideItemRender)return void t.target.parent.parent.showTips();switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:Recharge.ins().showReCharge(GlobalConfig.AuxiliaryBaseConfig.money,ShowRechargeType.Type_Rexue)}},e}(BaseEuiView);__reflect(RexueDideWin.prototype,"RexueDideWin"),window.RexueDideWin=RexueDideWin,ViewManager.ins().reg(RexueDideWin,LayerManager.UI_Main);var SeckillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="OneSeckill",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.effect=new MovieClip,this.eff.touchEnabled=this.eff.touchChildren=this.effect.touchEnabled=!1,this.eff.addChild(this.effect),this.bodyMc=new MovieClip,this.bodyMc.playFile(RES_DIR_BODY+"903_0_2a",-1),this.eBodyGrp.addChild(this.bodyMc),this.weaponMc=new MovieClip,this.weaponMc.playFile(RES_DIR_WEAPON+"904_0_2a",-1),this.eWeaponGrp.addChild(this.weaponMc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CumRechargeCT.ins().postOneSeckill,this.update),this.update()},e.prototype.removeDisplay=function(){this.itemGroup&&egret.Tween.removeTweens(this.itemGroup)},e.prototype.update=function(){var t=GlobalConfig.OneYuanGiftConfig;this.item.data=t.awards[0];var e=t.awards.slice(1);this.reward.dataProvider=new eui.ArrayCollection(e),t.downEff&&this.effect.playFile(RES_DIR_EFF+t.downEff,-1),this.redPoint.visible=this.goUpBtn.visible=!CumRechargeCT.ins().seckill;var i=this.itemGroup.verticalCenter;egret.Tween.get(this.itemGroup,{loop:!0}).to({verticalCenter:i-10},750).to({verticalCenter:this.itemGroup.verticalCenter},750)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.goUpBtn:var e=GlobalConfig.OneYuanGiftConfig.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.OneYuanGiftConfig.ybcount,ShowRechargeType.Type_OneYuanGift):Recharge.ins().sendPayOrder(e)}},e}(BaseEuiView);__reflect(SeckillWin.prototype,"SeckillWin"),window.SeckillWin=SeckillWin,ViewManager.ins().reg(SeckillWin,LayerManager.UI_Popup);var AttrPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SsEquipAttrItem",e}return __extends(e,t),e.prototype.setDate=function(t,e,i,s,n){this.currentState=t?"max":"normal";var o=AttributeFormat.FORMAT_1();o.wordColor=null,o.attrColor=null,this.sCurLv="Lv."+e,this.sNextLv="Lv."+s,this.sCurAtt=i?AttributeData.getAttStr(i,2,1,"",!0):"",this.sNextAtt=n?AttributeData.getAttStr(n,2,1,"",!0):""},e}(BaseView);__reflect(AttrPanel.prototype,"AttrPanel"),window.AttrPanel=AttrPanel;var ShieldCT=function(t){function e(){var e=t.call(this)||this;return e.data={},e.powers=[],e.sysId=PackageID.Equip,e.regNetMsg(30,e.postInitData),e.regNetMsg(32,e.postUpdateData),e.regNetMsg(33,e.postTotalpower),e.regNetMsg(34,e.postStreng),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInitData=function(t){for(var e=t.readUnsignedByte(),i=0;e>i;i++){var s=t.readUnsignedByte();this.powers[s]=t.readUnsignedInt();var n=t.readUnsignedByte();this.data[s]=this.data[s]||[];for(var o=0;n>o;o++){var a=t.readUnsignedByte();this.data[s][a]={itemId:t.readInt(),power:t.readInt(),strengVal:t.readInt(),strengLv:t.readInt(),pos:a}}}},e.prototype.sendEquip=function(t,e,i){var s=this.getBytes(31);s.writeDouble(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postUpdateData=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),s=this.data[e][i];s.itemId=t.readInt(),s.power=t.readUnsignedInt(),this.sendTotalpower(e)},e.prototype.sendStreng=function(t,e,i){var s=this.getBytes(34);s.writeByte(t),s.writeInt(e),s.writeInt(i.length);for(var n=0;n<i.length;n++)s.writeInt(i[n].configID),s.writeInt(i[n].count);this.sendToServer(s)},e.prototype.sendTotalpower=function(t){var e=this.getBytes(33);e.writeByte(t),this.sendToServer(e)},e.prototype.postTotalpower=function(t){this.powers[t.readUnsignedByte()]=t.readUnsignedInt()},e.prototype.postStreng=function(t){var e=(t.readBoolean(),t.readUnsignedByte()),i=t.readUnsignedInt(),s=this.data[e][i];s.strengVal=t.readUnsignedInt(),s.strengLv=t.readUnsignedInt(),s.power=t.readUnsignedInt(),this.sendTotalpower(e)},e.prototype.sendCompose=function(t){var e=this.getBytes(35);e.writeInt(t),this.sendToServer(e)},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.AegisBaseConfig,i="";return GameServer.serverOpenDay+1<e.openserverday?i="第"+e.openserverday+"天开启":ZsCT.ins().lv<e.openzhuanshenglv&&(i=e.openzhuanshenglv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getSkieldInfosByRoleId=function(t){return this.data[t]},e.prototype.getSkieldInfoByRoleIdPos=function(t,e){return this.data[t]?this.data[t][e]:null},e.getQualityLabByItemId=function(t){var e=GlobalConfig.ItemConfig[t],i=GlobalConfig.AegisEquipConfig[t];return e&&i?""+ColorUtil.COLOR_STR[ItemUtil.getQuality(e)]+i.star+"星":""},e.getQualityLabByStage=function(t){for(var e in GlobalConfig.AegisEquipConfig){var i=GlobalConfig.AegisEquipConfig[e];if(i.stage==t)return this.getQualityLabByItemId(i.itemId)}return""},e.getShieldType=function(t){return GlobalConfig.AegisEquipConfig[t]?ItemUtil.getSubType(GlobalConfig.ItemConfig[t])<4?ShieldType.One:ShieldType.Two:0},e.getShieldTypeName=function(t){var e=["","四凶神石","四灵神石"];return e[this.getShieldType(t)]},e.prototype.getStagesByRole=function(t,i){var s=[];if(!i)return s;var n=this.getSkieldInfosByRoleId(i.index);if(!n)return s;for(var o=0;o<n.length;o++){var a=n[o],r=GlobalConfig.AegisEquipConfig[a.itemId];null==r||0!=t&&e.getShieldType(a.itemId)!=t||s.push(r.stage)}return s.sort(Algorithm.sortDesc),s},e.getSuitConfigByType=function(t){return GlobalConfig.AegisSuitConfig[t]},e.getSkillConfigByJob=function(t){return GlobalConfig.AegisSkillConfig[t]},e.getSkillAllByJob=function(t){var e=this.getSkillConfigByJob(t),i=[];for(var s in e){var n=e[s];for(var o in n){var a=n[o];a.job==t&&a.skill>0&&i.push(a)}}return i},e.getActivationSkillCfg=function(t){var i=this.getSkillConfigByJob(t.job),s=e.ins().getStagesByRole(0,t),n=[];for(var o in i){var a=i[o];for(var r in a){var l=a[r];s[l.count-1]>=l.stage&&n.push(l)}}return n},e.getActivationSkillId=function(t){var e=this.getActivationSkillCfg(t),i=[];for(var s in e)e[s].skill>0&&i.push(e[s]);return i},e.isCanMergeById=function(t){for(var e=!0,i=GlobalConfig.AegisCompose[t],s={},n=0,o=i.material;n<o.length;n++){var a=o[n],r=a.id;s[r]?s[r]+=a.count:s[r]=a.count}for(var a in s){var r=+a,l=ItemUtil.isEquip(GlobalConfig.ItemConfig[r])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;if(BagCT.ins().getBagGoodsCountById(l,r)<s[a]){e=!1;break}}return e},e.getMergeEquipByType=function(t){var e=[],i=GlobalConfig.AegisCompose;for(var s in i)i[s].mixId[1]==t&&e.push({type:MergeType.Shield,id:i[s].id});return e},e.isShieldCanMerge=function(){var t=GlobalConfig.AegisCompose;for(var e in t)if(this.isCanMergeById(t[e].id))return!0;return!1},e.isShieldCanMergeByIdIndex=function(t){var e=GlobalConfig.AegisCompose;for(var i in e)if(e[i].mixId[1]==t&&this.isCanMergeById(e[i].id))return!0;return!1},__decorate([post()],e.prototype,"postInitData",null),__decorate([post()],e.prototype,"postUpdateData",null),__decorate([post()],e.prototype,"postTotalpower",null),__decorate([post()],e.prototype,"postStreng",null),e}(BaseSystem);__reflect(ShieldCT.prototype,"ShieldCT");var ShieldType;!function(t){t[t.One=1]="One",t[t.Two=2]="Two"}(ShieldType||(ShieldType={})),System.ShieldCT=function(){return ShieldCT.ins()},window.ShieldCT=ShieldCT;var ShieldRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.rolePoints=[],e.itemPoints=[],e.forgePoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,ShieldCT.ins().postInitData,ShieldCT.ins().postUpdateData,ZsCT.ins().postZsData,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){for(var t=this.redPoint,e=0;e<this.rolePoints.length;e++)this.rolePoints[e]?this.redPoint=!0:this.redPoint=!1;return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.postItemPoint(t),s=this.postForgePoint(t);this.rolePoints[t]=i||s}else this.rolePoints[t]=!1}return!0},e.prototype.postItemPoint=function(t){this.itemPoints[t]=[];var e=!1;if(!ShieldCT.ins().checkOpen())return e;for(var i=ShieldCT.ins().getSkieldInfosByRoleId(t),s=i?i.length:0,n=0;s>n;n++){var o=n;this.itemPoints[t][o]=!1;var a=i[o],r=a&&0!=a.itemId&&GlobalConfig.AegisEquipConfig[a.itemId]?GlobalConfig.AegisEquipConfig[a.itemId].stage:0,l=BagCT.ins().getBagGoodsByTypeAndSubType(ItemType.TYPE_34,o);for(var h in l){var p=GlobalConfig.AegisEquipConfig[l[h].configID].stage;if(p>r){this.itemPoints[t][o]=!0,e=!0;break}}}return e},e.prototype.postForgePoint=function(t){this.forgePoints[t]=[];var e=!1;if(!ShieldCT.ins().checkOpen())return e;for(var i=ShieldCT.ins().getSkieldInfosByRoleId(t),s=i?i.length:0,n=BagCT.ins().getBagGoodsByType(ItemType.TYPE_34),o=0;s>o;o++){var a=o;this.forgePoints[t][a]=!1;var r=i[a],l=GlobalConfig.AegisStrengthenStageConfig[a][r.strengLv+1];if(l&&(this.exp=Math.round(l.consumeExp-r.strengVal)),this.exp){var h=0;for(var p in n){var u=BagCT.ins().getBagGoodsCountById(0,n[p].configID),d=GlobalConfig.AegisEquipConfig[n[p].configID].releaseExp;h+=d*u}h>=this.exp&&ShieldCT.ins().getSkieldInfoByRoleIdPos(t,a).itemId&&(this.forgePoints[t][a]=!0,e=!0)}}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postItemPoint",null),__decorate([post()],e.prototype,"postForgePoint",null),e}(BaseSystem);__reflect(ShieldRedPoint.prototype,"ShieldRedPoint"),System.ShieldRedPoint=function(){return ShieldRedPoint.ins()},window.ShieldRedPoint=ShieldRedPoint;var ShieldEquipForgeItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="shenshouEquipItem",e.mc=new MovieClip,e.mc.x=45,e.mc.y=40,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.itemData=this.data[0],this.selectFrame.visible=this.data[1];var t=this.itemData.itemConfig;this.sName=t.name,this.nameTxt.textColor=ItemUtil.getQualityColor(t),this.sQuality="quality"+ItemUtil.getQuality(t),this.sImg=t.icon+"_png",this.sLv=this.itemData.count+""}else this.sQuality="quality0",this.sLv=this.sImg=this.sName="",this.selectFrame.visible=!1,this.itemData=null},e.prototype.playEff=function(){this.data&&(this.mc.playFile(RES_DIR_EFF+"BoomEff",1),this.addChild(this.mc),this.selectFrame.visible=!1)},e}(BaseItemRender);__reflect(ShieldEquipForgeItem.prototype,"ShieldEquipForgeItem"),window.ShieldEquipForgeItem=ShieldEquipForgeItem;var ShieldEquipForgeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.filterList=[],e._sn_="ShieldEquipForgeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.ins=ShieldCT.ins(),this.exp.labelDisplay.visible=!1,this.maxExpTxt.name=this.maxExpTxt.text,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.role=t[0],this.pos=t[1],this.observe(this.ins.postStreng,this.update),this.observe(BagCT.ins().postItemCountChange,this.updateList),this.observe(BagCT.ins().postItemDel,this.updateList),this.observe(BagCT.ins().postItemAdd,this.updateList),this.update()},e.prototype.update=function(){this.updateList(),this.updateInfo()},e.prototype.updateInfo=function(){var t=this.ins.getSkieldInfoByRoleIdPos(this.role.index,this.pos);this.itemIcon.data=t.itemId;var e=GlobalConfig.ItemConfig[t.itemId];this.equipName.text=e.name,this.equipName.textColor=ItemUtil.getQualityColor(e);var i=t.strengLv,s=GlobalConfig.AegisStrengthenStageConfig[this.pos][i],n=GlobalConfig.AegisStrengthenStageConfig[this.pos][i+1],o=s&&!n;if(o){this.maxExpTxt.text=this.maxExpTxt.name;var a=Math.round(s.consumeExp);this.exp.maximum=a,this.exp.value=a,this.eBtn.label="已满级",this.eBtn.enabled=!1}else{var a=Math.round(n.consumeExp);this.maxExpTxt.text=t.strengVal+"/"+a,this.exp.maximum=a,this.exp.value=Math.min(t.strengVal,a),this.eBtn.label="熔  炼",this.eBtn.enabled=!0}this.powerPanel.setPower(t.power),this.attrPanel.setDate(o,i,s.strengthenAttr,i+1,n?n.strengthenAttr:null),this.maxExpTxt.visible!=this.exp.labelDisplay.visible,this.sLv="Lv."+t.strengLv},e.prototype.updateList=function(){for(var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_34),e=[],i=0;8>i;i++){for(var s=-1,n=0;n<SubRoles.ins().subRolesLen;n++){var o=this.ins.getSkieldInfoByRoleIdPos(n,i);s=o&&o.itemId>0?-1==s?GlobalConfig.AegisEquipConfig[o.itemId].stage:Math.min(s,GlobalConfig.AegisEquipConfig[o.itemId].stage):0}e.push(s)}var a=[];this.nowList=[];var r=12;for(var i in t){var s=GlobalConfig.AegisEquipConfig[t[i].configID].stage,l=GlobalConfig.AegisEquipConfig[t[i].configID].releaseExp,h=ItemUtil.getSubType(t[i].itemConfig);if(s<=e[h]&&l>0){var p=this.filterList.indexOf(t[i])<=-1;if(a.push([t[i],p]),p&&this.nowList.push(t[i]),a.length>=r)break}}a.sort(this.sort),a.length=Math.max(r,a.length),this.eListDP.source=a},e.prototype.sort=function(t,e){return t.point<e.point?-1:t.point>e.point?1:0},e.prototype.onClick=function(t){if(t.target instanceof ShieldEquipForgeItem){var e=this.filterList.indexOf(t.target.itemData);return-1>=e?this.filterList.push(t.target.itemData):this.filterList.splice(e,1),void this.updateList()}switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:this.nowList.length?this.ins.sendStreng(this.role.index,this.pos,this.nowList):TipsCT.ins().showCenterTips("当前没有可分解的装备")}},__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(ShieldEquipForgeWin.prototype,"ShieldEquipForgeWin"),window.ShieldEquipForgeWin=ShieldEquipForgeWin,ViewManager.ins().reg(ShieldEquipForgeWin,LayerManager.UI_Popup);var ShieldEquipItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="EquipItem",e.touchEnabled=!0,e.touchChildren=!1,e.level.visible=e.select.visible=!1,e.EquipEffect=new MovieClip,e.EquipEffect.touchEnabled=!1,e.EquipEffect.x=40,e.EquipEffect.y=40,e.addChildAt(e.EquipEffect,e.getChildIndex(e.redPoint)),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId],i=ItemUtil.getEffName(e);this.itemIcon.setData(e),t.itemId>0&&i.length>0?(this.EquipEffect.visible=!0,this.EquipEffect.playFile(RES_DIR_EFF+i,-1)):(this.EquipEffect.visible=!1,this.EquipEffect.stop()),(!t||t.itemId<=0)&&(this.itemIcon.imgBg.source="Shield_"+t.pos+"_png")}},e}(BaseItemRender);__reflect(ShieldEquipItem.prototype,"ShieldEquipItem"),window.ShieldEquipItem=ShieldEquipItem;var ShieldEquipTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="AegisEquipTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.itemCfg=GlobalConfig.ItemConfig[i],this.role=t[1],this.eBtnL.visible=this.eBtnR.visible=null!=this.role,this.redPoint.visible=this.eBtnR.visible&&ShieldRedPoint.ins().forgePoints[this.role.index][ItemUtil.getSubType(this.itemCfg)],this.redPoint1.visible=this.eBtnR.visible&&ShieldRedPoint.ins().itemPoints[this.role.index][ItemUtil.getSubType(this.itemCfg)],this.update()},e.prototype.update=function(){var t=ItemUtil.getQuality(this.itemCfg);this.nameLabel.text=this.itemCfg.name,this.nameLabel.textColor=ItemUtil.getQualityColor(this.itemCfg),this.itemIcon.setData(this.itemCfg);var e=GlobalConfig.EquipConfig[this.itemCfg.id],i=0;e.baseAttr1&&(i+=BagCT.getAttrPower([e.baseAttr1]));var s=i+BagCT.getAttrPower(ItemUtil.getBaseAttrData(this.itemCfg));this.score.text="评分："+s,this.powerPanel.setPower(s),this.quali.source=t>0?"quali"+t:"",this.type.text=ShieldCT.getShieldTypeName(this.itemCfg.id),this.lv.text=ShieldCT.getQualityLabByItemId(this.itemCfg.id);var n=ItemUtil.getBaseAttrData(this.itemCfg),o=AttributeFormat.FORMAT_1();o.wordColor=null,o.attrColor=null,this.attrs.text=AttributeData.getAttStr1(n,o),this._bottomY=this.attrs.y+this.attrs.height,this.addAttrTips(),this.addSuitTips()},e.prototype.addSuitTips=function(){var t=new eui.Label;t.size=20,t.bold=!0,t.x=24,t.y=this._bottomY+10,t.touchEnabled=!1,this.forgeGroup.addChild(t);var e=new eui.Label;e.size=18,e.x=46,e.y=t.y+24,e.touchEnabled=!1,this.forgeGroup.addChild(e);for(var i="",s=ShieldCT.getShieldType(this.itemCfg.id),n=this.role?ShieldCT.ins().getStagesByRole(s,this.role):[],o=GlobalConfig.AegisEquipConfig[this.itemCfg.id].stage,a=0,r=0;r<n.length;r++)n[r]>=o&&a++;var l="|C:0xff00ff&T:"+ShieldCT.getQualityLabByItemId(this.itemCfg.id)+(1==s?"凶":"灵")+"石套装||C:0x"+(a>=4?"35e62d":"565656")+"&T:("+Math.max(1,a)+"/4)|";t.textFlow=TextFlowMaker.generateTextFlow(l);var h=ShieldCT.getSuitConfigByType(s)[o];for(var r in h){var p=h[r];i+="|C:0x"+(o==n[p.count-1]?"ff00ff":"565656")+"&T:"+p.count+"件套：";for(var u=0;u<p.attrs.length;u++)i+=0==u?"":"  　　　",i+=AttributeData.getAttStrByType(p.attrs[u],.5," ")+"\n";i+="|"}e.textFlow=TextFlowMaker.generateTextFlow(i),this._bottomY=e.y+e.height},e.prototype.addAttrTips=function(){var t=new eui.Label;t.size=20,t.bold=!0,t.x=24,t.y=this._bottomY+10,t.touchEnabled=!1,this.forgeGroup.addChild(t);var e=new eui.Label;if(e.size=18,e.x=46,e.y=t.y+24,e.touchEnabled=!1,this.forgeGroup.addChild(e),GlobalConfig.EquipConfig[this.itemCfg.id]&&GlobalConfig.EquipConfig[this.itemCfg.id].baseAttr1){var i=AttributeData.getAttStrByType(GlobalConfig.EquipConfig[this.itemCfg.id].baseAttr1,.5," ");e.textFlow=TextFlowMaker.generateTextFlow("|C:0xffbc00&T:"+i+"|"),t.textFlow=TextFlowMaker.generateTextFlow("|C:0xffbc00&T:特殊属性|"),this._bottomY=e.y+e.height
}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtnL:ViewManager.ins().open(ShieldEquipForgeWin,this.role,ItemUtil.getSubType(this.itemCfg)),ViewManager.ins().close(this);break;case this.eBtnR:ViewManager.ins().open(RoleChooseEquipWin,this.role.index,ItemUtil.getSubType(this.itemCfg),ItemType.TYPE_34),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShieldEquipTipsWin.prototype,"ShieldEquipTipsWin"),window.ShieldEquipTipsWin=ShieldEquipTipsWin,ViewManager.ins().reg(ShieldEquipTipsWin,LayerManager.UI_Popup);var ShieldPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eItems=[],e.curRoleId=0,e._sn_="ShieldRoleSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=0;8>t;t++)this.eItems.push(this["eItem"+t]),this.eItems[t].pos=t;this.addTouchEvent(this,this.onClick),this.ins=ShieldCT.ins(),this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+"Shieldeff",-1),this.eMCGroup.visible=!1,this.eMCGroup.addChild(this.mc),this.eIcon.filters=FilterUtil.ARRAY_GRAY_FILTER},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInitData,this.update),this.observe(this.ins.postUpdateData,this.update),this.observe(this.ins.postTotalpower,this.updatePower),this.observe(ShieldRedPoint.ins().postRoleRedPoint,this.updateRed),this.update()},e.prototype.update=function(){this.skin&&(this.updateItems(),this.updateRed())},e.prototype.updateRed=function(){for(var t=this.eItems.length,e=0;t>e;e++){var i=this.eItems[e];i.redPoint.visible=ShieldRedPoint.ins().itemPoints[this.curRoleId][e]||ShieldRedPoint.ins().forgePoints[this.curRoleId][e]||!1}},e.prototype.updateItems=function(){for(var t=this.eItems.length,e=0;t>e;e++){var i=this.eItems[e],s=this.ins.getSkieldInfoByRoleIdPos(this.curRoleId,e);i.data=s}this.updatePower(),this.updateName()},e.prototype.updatePower=function(){this.powerPanel.setPower(this.ins.powers[this.curRoleId]||0)},e.prototype.updateName=function(){var t=ShieldCT.getActivationSkillId(SubRoles.ins().getSubRoleByIndex(this.curRoleId));this.sName=0==t.length?"神盾之力":t[t.length-1].skillName,this.eMCGroup.visible=t.length>0,this.eIcon.visible=!this.eMCGroup.visible},e.prototype.onClick=function(t){if(t.target instanceof ShieldEquipItem){var e=t.target.data;return void(e&&0!=e.itemId?ViewManager.ins().open(ShieldEquipTipsWin,e.itemId,SubRoles.ins().getSubRoleByIndex(this.curRoleId)):ViewManager.ins().open(RoleChooseEquipWin,this.curRoleId,t.target.pos,ItemType.TYPE_34))}switch(t.target){case this.eShieldGroup:ViewManager.ins().open(ShieldSkillWin,SubRoles.ins().getSubRoleByIndex(this.curRoleId))}},Object.defineProperty(e.prototype,"curRole",{set:function(t){this.curRoleId=t,this.update()},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(ShieldPanel.prototype,"ShieldPanel"),window.ShieldPanel=ShieldPanel;var ShieldSkillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRAbilityItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.sSkillImg=t.skillIcon+"_png",this.sDescFlow=TextFlowMaker.generateTextFlow1(t.skillDesc.length>0?t.skillDesc:" "),this.sName=t.skillName;for(var e=SubRoles.ins().getSubRoleByJob(t.job),i=ShieldCT.ins().getStagesByRole(0,e),s=0,n=i.length;n>=0;n--)if(i[n]>=t.stage){s=n+1;break}var o=ShieldCT.getQualityLabByStage(t.stage),a=o.indexOf("金色")>-1?16776960:o.indexOf("红色")>-1?15937822:o.indexOf("橙色")>-1?16750153:13746831;this.nameTxt.textColor=a;var r="镶嵌"+o+"以上神石 ("+Math.min(s,t.count)+"/"+t.count+")",l=s<t.count?11645079:a;this.stateLabel.text=r,this.stateLabel.textColor=l}},e}(BaseItemRender);__reflect(ShieldSkillItem.prototype,"ShieldSkillItem"),window.ShieldSkillItem=ShieldSkillItem;var ShieldSkillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ShieldSkillSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.role=t[0],this.update()},e.prototype.update=function(){this.eListDP.source=ShieldCT.getSkillAllByJob(this.role.job)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShieldSkillWin.prototype,"ShieldSkillWin"),window.ShieldSkillWin=ShieldSkillWin,ViewManager.ins().reg(ShieldSkillWin,LayerManager.UI_Popup);var ShowImgCT=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"view",{get:function(){return this._view&&this._view.parent||(ViewManager.ins().open(ShowImgView),this._view=ViewManager.ins().getView(ShowImgView)),this._view},enumerable:!0,configurable:!0}),e.prototype.showImg=function(t,e){void 0===t&&(t="meltYuanBao_png"),void 0===e&&(e={horizontalCenter:77.5,y:0}),this.view.img=t,this.view.targetPos=e,DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showImg)},e.prototype.showMoveImg=function(t,e,i,s){void 0===t&&(t="meltYuanBao_png"),void 0===e&&(e=0),void 0===i&&(i=7),void 0===s&&(s=0),DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showMoveImg,[t,e,i,s])},e}(BaseSystem);__reflect(ShowImgCT.prototype,"ShowImgCT"),System.ShowImgCT=function(){return ShowImgCT.ins()},window.ShowImgCT=ShowImgCT;var ShowImgView=function(t){function e(){var e=t.call(this)||this;return e.list=[],e.touchChildren=!1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.showMoveImg=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,s,n,o,a,r,l;return __generator(this,function(h){switch(h.label){case 0:e=0,h.label=1;case 1:return e<t[2]?(i=new eui.Image,s=StageUtils.ins().getWidth()/2-20,n=StageUtils.ins().getHeight()/2-35,i.x=s,i.y=n,i.scaleX=i.scaleY=.6,i.source=t[0],i.alpha=0,this.addChild(i),this.list.unshift(i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this),egret.Tween.removeTweens(i),o=100-250*Math.random()+s,a=50-150*Math.random()+n,r=300*Math.random(),l=egret.Tween.get(i),l.wait(r).to({x:o,y:a,alpha:1},200).wait(300),[4,this.playMove(i,o,a,t[1],t[3],r+300)]):[3,4];case 2:h.sent(),h.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},e.prototype.playMove=function(t,e,i,s,n,o){var a=this,r=Bezier.pop({x:e,y:i},{x:StageUtils.ins().getWidth()/2+60,y:s});r.display=t,r.ease=egret.Ease.circInOut,r.centerPoint={x:e+n,y:i-100},r.start(1300,function(){Bezier.push(r),a.removeChild(t)},this,o)},e.prototype.showImg=function(){for(var t=this,e=function(e){var s=new eui.Image,n=StageUtils.ins().getHeight()/2-35;s.horizontalCenter=0,s.y=n,s.scaleX=s.scaleY=.6,s.source=i.img,s.alpha=0,i.addChild(s),i.list.unshift(s),s.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.removeTipsItem,i),egret.Tween.removeTweens(s);var o=egret.Tween.get(s);o.wait(300*Math.random()).to({horizontalCenter:50-130*Math.random(),y:50-100*Math.random()+n,alpha:1},200).wait(300).to(i.targetPos,1e3,egret.Ease.circInOut).to({alpha:0},100).call(function(){t.removeChild(s)})},i=this,s=0;7>s;s++)e(s)},e.prototype.removeTipsItem=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this),e.left=0/0,e.bottom=0/0;var i=this.list.indexOf(e);this.list.splice(i,1),ObjectPool.push(e)},e}(BaseEuiView);__reflect(ShowImgView.prototype,"ShowImgView"),window.ShowImgView=ShowImgView,ViewManager.ins().reg(ShowImgView,LayerManager.UI_Tips);var SmmzCT=function(t){function e(){var e=t.call(this)||this;return e.roleSmInfos=[],e.smExp=0,e.changeNums={},e.sysId=PackageID.Smmz,e.regNetMsg(1,e.postInfo),e.regNetMsg(2,e.postPutOn),e.regNetMsg(3,e.postItemUpStar),e.regNetMsg(4,e.postSmSoulLvUp),e.regNetMsg(5,e.postBreakDown),e.regNetMsg(6,e.postSmLvUp),e.regNetMsg(7,e.postChangeCB),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){var e=t.readByte();this.roleSmInfos=[];for(var i=0;e>i;i++){var s=t.readByte();this.roleSmInfos[s]={smInfos:this.parserSmInfo(s,t)}}this.smExp=t.readInt(),this.parserChangeInfo(t)},e.prototype.parserSmInfo=function(t,e){for(var i={},s=e.readByte(),n=0;s>n;n++){var o=e.readByte();i[o]={roleId:t,smId:o,itemIds:this.parserSMItems(e),smSoulLv:e.readShort(),smSoulAdd:e.readShort(),smSoulPower:e.readInt(),smLv:e.readShort(),smPower:e.readInt(),smItemPower:e.readInt()}}return i},e.prototype.parserSMItems=function(t){for(var e={},i=t.readByte(),s=0;i>s;s++)e[t.readByte()]=t.readInt();return e},e.prototype.parserChangeInfo=function(t){this.changeNums={};for(var e=t.readByte(),i=0;e>i;i++){var s=t.readByte(),n=t.readShort();this.changeNums[s]={};for(var o=0;n>o;o++)this.changeNums[s][t.readShort()]=t.readInt()}},e.prototype.sendPutOn=function(t,e,i){var s=this.getBytes(2);s.writeByte(t),s.writeByte(e),s.writeInt(i),this.sendToServer(s)},e.prototype.postPutOn=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=this.getSmInfoByRoleIdSmId(e,i);n.itemIds[s]=t.readInt(),n.smSoulAdd=t.readShort(),n.smItemPower=t.readInt(),n.smSoulPower=t.readInt();var o=1==t.readByte();if(o){var a=t.readShort();this.changeNums[i]={};for(var r=0;a>r;r++)this.changeNums[i][t.readShort()]=t.readInt()}else delete this.changeNums[i]},e.prototype.sendItemUpStar=function(t,e,i){var s=this.getBytes(3);s.writeByte(t),s.writeByte(e),s.writeByte(i),this.sendToServer(s)},e.prototype.postItemUpStar=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte(),n=this.getSmInfoByRoleIdSmId(e,i);n.itemIds[s]=t.readInt(),n.smItemPower=t.readInt()},e.prototype.sendSmSoulLvUp=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postSmSoulLvUp=function(t){var e=t.readByte(),i=t.readByte(),s=this.getSmInfoByRoleIdSmId(e,i);s.smSoulLv=t.readShort(),s.smSoulPower=t.readInt()},e.prototype.sendBreakDown=function(t){if(t&&!(t.length<=0)){var e=this.getBytes(5),i=t.length;e.writeShort(t.length);for(var s=0;i>s;s++)e.writeInt(t[s]);this.sendToServer(e)}},e.prototype.postBreakDown=function(t){this.smExp=t.readInt()},e.prototype.sendSmLvUp=function(t,e){var i=this.getBytes(6);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postSmLvUp=function(t){var e=t.readByte(),i=t.readByte(),s=this.getSmInfoByRoleIdSmId(e,i);s.smLv=t.readShort(),this.smExp=t.readInt(),s.smPower=t.readInt()},e.prototype.sendChange=function(t,e){var i=this.getBytes(7);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postChangeCB=function(t){this.changeNums[t.readByte()][t.readShort()]=t.readInt()},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ShenmoBaseConfig,i="";return GameServer.serverOpenDay+1<e.openday?i="第"+e.openday+"天开启":ZsCT.ins().lv<e.zslevel&&(i=e.zslevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getRoleSmInfoByRoleId=function(t){return this.roleSmInfos[t]},e.prototype.getSmInfoByRoleIdSmId=function(t,e){var i=this.getRoleSmInfoByRoleId(t);return i?i.smInfos[e]:null},e.prototype.getSoulLvUpMax=function(t){var e=GlobalConfig.ShenmoSoulSkillConfig[t],i=0;for(var s in e)e[s].costItemId&&(i=e[s].level+1);return i},e.prototype.sortSmInfoQuality=function(t){var e=[];if(t){for(var i in t.itemIds){var s=GlobalConfig.ShenmoEquipConfig[t.itemIds[i]];e.push(s.quality)}e.sort(Algorithm.sortDesc)}return e},e.prototype.findBetterItem=function(t,e,i){var s,n=this.getSmInfoByRoleIdSmId(t,e),o=n.itemIds[i]||0,a=BagCT.ins().getBagGoodsByType(ItemType.TYPE_41),r=GlobalConfig.ShenmoEquipConfig;for(var l in a){var h=r[a[l].configID];h.shenmoIdx==e&&h.pos==i&&(!s||h.itemId>s.itemId)&&(s=h)}return s&&o>0&&o>=s.itemId?0:s?s.itemId:0},e.prototype.checkMarketOpen=function(t){return!!this.changeNums[t]},e.prototype.getQualityLabByItemId=function(t){var e=GlobalConfig.ShenmoEquipConfig[t],i=GlobalConfig.ShenmoBaseConfig.qualityName[e.quality];return"|C:"+ItemBase.QUALITY_COLOR[e.quality]+"&T:"+(i+e.starLevel+"星")+"|"},e.prototype.getBagSmItemBySmIdPos=function(t,e){var i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_41),s=GlobalConfig.ShenmoEquipConfig,n=[];for(var o in i){var a=s[i[o].configID];a.shenmoIdx==t&&a.pos==e&&n.push(i[o])}return n.sort(this.sort),n},e.prototype.sort=function(t,e){return t.configID<e.configID?1:t.configID>e.configID?-1:0},e.EQUIP_POS_MAX=6,__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postPutOn",null),__decorate([post()],e.prototype,"postItemUpStar",null),__decorate([post()],e.prototype,"postSmSoulLvUp",null),__decorate([post()],e.prototype,"postBreakDown",null),__decorate([post()],e.prototype,"postSmLvUp",null),__decorate([post()],e.prototype,"postChangeCB",null),e}(BaseSystem);__reflect(SmmzCT.prototype,"SmmzCT"),System.SmmzCT=function(){return SmmzCT.ins()},window.SmmzCT=SmmzCT;var SmRedPoint=function(t){function e(){var e=t.call(this)||this;return e.rolePoints=[],e.smPoints=[],e.smSoulPoints=[],e.itemPoints=[],e.itemUpPoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,SmmzCT.ins().postInfo,SmmzCT.ins().postSmSoulLvUp,SmmzCT.ins().postItemUpStar,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.rolePoints.length;e++)this.rolePoints[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){if(!SmmzCT.ins().checkOpen())return!1;for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){this.smPoints[t]=[];var i=SmmzCT.ins().getRoleSmInfoByRoleId(t),s=i?i.smInfos:null;for(var n in s){var o=s[n].smId;this.smPoints[t][o]=!1}var a=this.postItemPoints(t),r=this.postItemUpPoints(t),l=this.postSmSoulPoints(t);this.rolePoints[t]=a||r||l}else this.rolePoints[t]=!1}return!0},e.prototype.postItemPoints=function(t){var e=!1;this.itemPoints[t]=[];var i=SmmzCT.ins(),s=i.getRoleSmInfoByRoleId(t);if(!s)return e;for(var n in s.smInfos){var o=s.smInfos[n];this.itemPoints[t][o.smId]=[];for(var a=1;a<=SmmzCT.EQUIP_POS_MAX;a++){var r=i.findBetterItem(t,o.smId,a);r>0&&(this.smPoints[t][o.smId]=e=!0),this.itemPoints[t][o.smId][a]=r>0}}return e},e.prototype.postItemUpPoints=function(t){var e=!1;this.itemUpPoints[t]=[];var i=SmmzCT.ins(),s=i.getRoleSmInfoByRoleId(t);if(!s)return e;for(var n in s.smInfos){var o=s.smInfos[n];this.itemUpPoints[t][o.smId]=[];for(var a=1;a<=SmmzCT.EQUIP_POS_MAX;a++)if(this.itemUpPoints[t][o.smId][a]=!1,o.itemIds[a]){var r=GlobalConfig.ShenmoEquipConfig[o.itemIds[a]];if(r&&r.costItem){var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,r.costItem[0].id);l>=r.costItem[0].count&&(this.smPoints[t][o.smId]=this.itemUpPoints[t][o.smId][a]=e=!0)}}}return e},e.prototype.postSmSoulPoints=function(t){var e=!1;this.smSoulPoints[t]=[];var i=SmmzCT.ins(),s=i.getRoleSmInfoByRoleId(t);if(!s)return e;for(var n in s.smInfos){var o=s.smInfos[n];this.smSoulPoints[t][o.smId]=!1;var a=i.getSoulLvUpMax(o.smId);if(o.smSoulLv<a){var r=GlobalConfig.ShenmoSoulSkillConfig[o.smId][o.smSoulLv],l=!0;for(var h in r.costItemId){var p=r.costItemId[h],u=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,p.id);if(u<p.count){l=!1;break}}r.costItemId&&l&&(this.smPoints[t][o.smId]=this.smSoulPoints[t][o.smId]=e=!0)}}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postItemPoints",null),__decorate([post()],e.prototype,"postItemUpPoints",null),__decorate([post()],e.prototype,"postSmSoulPoints",null),e}(BaseSystem);__reflect(SmRedPoint.prototype,"SmRedPoint"),System.SmRedPoint=function(){return SmRedPoint.ins()},window.SmRedPoint=SmRedPoint;var SmEquipForgeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SmTreasureForgeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.eList.itemRenderer=ShieldEquipForgeItem,this.eList.dataProvider=this.eListDP,this.exp.labelDisplay.visible=!1,this.maxExpTxt.name=this.maxExpTxt.text},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.smInfo=t[0],this.addTouchEvent(this,this.onClick),this.observe(SmmzCT.ins().postBreakDown,this.onBreakDown),this.observe(SmmzCT.ins().postSmLvUp,this.updateView),this.update()},e.prototype.onBreakDown=function(){for(var t=this.eList.numChildren;t--;)this.eList.getChildAt(t).playEff();this.update()},e.prototype.update=function(){this.updateView(),this.updateList()},e.prototype.updateView=function(){this.eIcon.source="Smlyhaed"+this.smInfo.smId,this.ePower.setPower(this.smInfo.smPower),this.sName=GlobalConfig.ShenmoBaseConfig.smName[this.smInfo.smId];var t=GlobalConfig.ShenmoLevelConfig[this.smInfo.smId][this.smInfo.smLv],e=GlobalConfig.ShenmoLevelConfig[this.smInfo.smId][this.smInfo.smLv+1],i=!(t.needExp>0),s=Math.round(t.needExp);if(i)this.maxExpTxt.text=this.maxExpTxt.name,this.exp.maximum=s,this.exp.value=s,this.eLvUpBtn.label="已满级",this.eLvUpBtn.enabled=!1;else{var n=SmmzCT.ins().smExp;this.maxExpTxt.text=n+"/"+s,this.exp.maximum=s,this.exp.value=Math.min(n,s),this.eLvUpBtn.label="升   级",this.eLvUpBtn.enabled=!0}this.attrPanel.setDate(i,this.smInfo.smLv,t.attr,this.smInfo.smLv+1,e?e.attr:null)},e.prototype.updateList=function(){for(var t=SmmzCT.ins(),e=BagCT.ins().getBagGoodsByType(ItemType.TYPE_41),i=SmmzCT.EQUIP_POS_MAX,s=[],n=[],o=1;i>=o;o++){for(var a=-1,r=0;r<SubRoles.ins().subRolesLen;r++){var l=t.getSmInfoByRoleIdSmId(r,this.smInfo.smId);a=l&&l.itemIds[o]>0?-1==a?l.itemIds[o]:Math.min(a,l.itemIds[o]):0}if(s.push(a),a>0){var h=GlobalConfig.ShenmoEquipConfig[a];h.costItem&&h.costItem.length>0&&n.push(h.costItem[0].id)}}var p=[];this.nowList=[];var u=12;for(var d in e){if(p.length>=u)break;var a=e[d].configID,c=e[d].copy();c.count=1;var h=GlobalConfig.ShenmoEquipConfig[a],o=h.pos;if(h.shenmoIdx==this.smInfo.smId&&a<=s[o-1]&&-1==n.indexOf(a))for(var r=0;r<e[d].count&&(p.push([c,!1]),this.nowList.push(a),!(p.length>=u));r++);}p.sort(this.sort),p.length=Math.max(u,p.length),this.eListDP.source=p},e.prototype.sort=function(t,e){return t.configID<e.configID?-1:t.configID>e.configID?1:0},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eDepartBtn:this.nowList.length?SmmzCT.ins().sendBreakDown(this.nowList):TipsCT.ins().showCenterTips("当前没有可分解的材料");break;case this.eLvUpBtn:var e=GlobalConfig.ShenmoLevelConfig[this.smInfo.smId][this.smInfo.smLv];e.needExp<=SmmzCT.ins().smExp?SmmzCT.ins().sendSmLvUp(this.smInfo.roleId,this.smInfo.smId):TipsCT.ins().showCenterTips("经验不足")}},__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(SmEquipForgeWin.prototype,"SmEquipForgeWin"),window.SmEquipForgeWin=SmEquipForgeWin,ViewManager.ins().reg(SmEquipForgeWin,LayerManager.UI_Popup);var SmItemTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="SmTreasureTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.starList=new StarList(0),this.starGroup.addChild(this.starList),this.starList.horizontalCenter=0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.smInfo=t[1]||null,this.addTouchEvent(this,this.onClick),this.observe(SmmzCT.ins().postPutOn,this.updateView),this.observe(SmmzCT.ins().postItemUpStar,this.updateView),this.observe(SmRedPoint.ins().postRoleRedPoint,this.updateRed),this.updateView(),this.updateRed()},e.prototype.updateView=function(){this.eBtnGroup.visible=!!this.smInfo;var t=GlobalConfig.ItemConfig[this.itemId],e=GlobalConfig.ShenmoEquipConfig[this.itemId];this.pos=e.pos,this.smInfo&&(this.itemId=this.smInfo.itemIds[this.pos],t=GlobalConfig.ItemConfig[this.itemId],e=GlobalConfig.ShenmoEquipConfig[this.itemId]),this.sName=t.name,this.nameLabel.textColor=ItemBase.QUALITY_COLOR[e.quality],this.eQuality.source="quali"+e.quality,this.eQualityName.text=GlobalConfig.ShenmoBaseConfig.qualityName[e.quality],this.eQualityName.textColor=ItemBase.QUALITY_COLOR[e.quality],this.eIcon.source=t.icon+"_png",this.ePower.setPower(BagCT.getAttrPower(e.attr));var i=AttributeFormat.FORMAT_2();i.wordColor=16777164,i.isInserte=7,this.eAttrLab.textFlow=TextFlowMaker.generateTextFlow(AttributeData.getAttStr1(e.attr,i));var s=this.getSuitAttStr();if(s.length>0?(this.eSuitGroup.addChild(this.eSuitTitle),this.eSuitGroup.addChild(this.eSuitAttr),this.eSuitAttr.textFlow=TextFlowMaker.generateTextFlow(s),this.eAttrGroup.addChild(this.eLineUp),this.eBtnGroup.addChild(this.eLineDown)):(this.eSuitGroup.removeChildren(),DisplayUtils.removeFromParent(this.eLineUp),DisplayUtils.removeFromParent(this.eLineDown)),this.eSuitTitle.textColor=ItemBase.QUALITY_COLOR[e.quality],this.starList.setlistLength(GlobalConfig.ShenmoBaseConfig.qualityStar[e.quality],e.starLevel),this.smInfo){if(this.eCostLab.text=e.costItem?"消耗 "+GlobalConfig.ItemConfig[e.costItem[0].id].name+" x"+e.costItem[0].count:"",e.costItem){var n=GlobalConfig.ShenmoEquipConfig[e.costItem[0].id];this.eCostLab.textColor=ItemBase.QUALITY_COLOR[n.quality]}this.eStarBtn.enabled=!!e.costItem}},e.prototype.updateRed=function(){var t=GlobalConfig.ShenmoEquipConfig[this.itemId].pos;this.eRed1.visible=!!this.smInfo&&SmRedPoint.ins().itemUpPoints[this.smInfo.roleId][this.smInfo.smId][t],this.eRed2.visible=!!this.smInfo&&SmRedPoint.ins().itemPoints[this.smInfo.roleId][this.smInfo.smId][t]},e.prototype.getSuitAttStr=function(){var t="",e=GlobalConfig.ShenmoEquipConfig[this.itemId],i=GlobalConfig.ShenmoEquipSuitConfig[e.shenmoIdx][e.quality],s=GlobalConfig.ShenmoBaseConfig,n=ItemBase.QUALITY_COLOR[e.quality],o=AttributeFormat.getFormat(),a=SmmzCT.ins().sortSmInfoQuality(this.smInfo);o.isInserte=7;for(var r in i){var l=i[r];""!=t&&(t+="\n");var h=a[l.count-1]>=e.quality;o.wordColor=o.attrColor=h?10458221:ColorUtil.GRAY,t+="|C:"+n+"&T:"+s.qualityName[e.quality]+l.count+"件套|",t+=""+(l.attr&&l.attr.length>0?"\n":"")+("|C:"+o.wordColor+"&T:"+AttributeData.getAttStr1(l.attr,o)+"|"),l.soulSkillLevelAdd>0&&(t+="\n|C:"+(h?n:ColorUtil.GRAY)+"&T:"+s.smSoulName[e.shenmoIdx]+" 技能等级+"+l.soulSkillLevelAdd+"|")}return t},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eStarBtn:var e=GlobalConfig.ShenmoEquipConfig[this.itemId];if(e.costItem&&e.costItem[0]){var i=e.costItem[0],s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.id);if(s<i.count)return void TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:材料不足|");SmmzCT.ins().sendItemUpStar(this.smInfo.roleId,this.smInfo.smId,this.pos)}break;case this.eChangeBtn:ViewManager.ins().open(RoleChooseEquipWin,this.smInfo.roleId,this.pos,ItemType.TYPE_41,this.smInfo)}},__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(SmItemTipsWin.prototype,"SmItemTipsWin"),window.SmItemTipsWin=SmItemTipsWin,ViewManager.ins().reg(SmItemTipsWin,LayerManager.UI_Popup);var SmListItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="SmTreasureHeadSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];this.eIcon.source="Smlyhaed"+t,this.eRed.visible=SmRedPoint.ins().smPoints[e][t]}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eSelect.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(SmListItemRenderer.prototype,"SmListItemRenderer"),window.SmListItemRenderer=SmListItemRenderer;var SmMainPanel=function(t){function e(){var e=t.call(this)||this;return e._roleId=0,e._sn_="SmTreasureSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=SmListItemRenderer,this.eList.dataProvider=this.listDP,this.items=[this.eItem0,this.eItem1,this.eItem2,this.eItem3,this.eItem4,this.eItem5],this.mc=new MovieClip,this.eEffGroup.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(SmmzCT.ins().postPutOn,this.update),this.observe(SmmzCT.ins().postItemUpStar,this.update),this.observe(SmmzCT.ins().postSmSoulLvUp,this.update),this.observe(SmRedPoint.ins().postRoleRedPoint,this.updateRed),this.eList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.curSMId=1},e.prototype.update=function(){this.updateView()},e.prototype.updateList=function(){var t=[];for(var e in GlobalConfig.ShenmoEquipSuitConfig)t.push([+e,this._roleId]);this.listDP.replaceAll(t)},e.prototype.updateView=function(){if(this.skin){var t=SmmzCT.ins().getSmInfoByRoleIdSmId(this._roleId,this._curSMId);if(t){for(var e=this.items.length,i=1;e>=i;i++)this.items[i-1].setData(i,t.itemIds[i]||0);this.powerPanel.setPower(t.smItemPower+t.smSoulPower+t.smPower);var s=GlobalConfig.ShenmoLevelConfig[t.smId][t.smLv];this.eAttr.textFlow=TextFlowMaker.generateTextFlow(this.getAttStr(s.attr)),this.mc.playFile(RES_DIR_EFF+("smmz_"+this._curSMId),-1),this.eEffGroup.filters=t.smSoulLv>0?null:FilterUtil.ARRAY_GRAY_FILTER,this.eChangeBtn.visible=!!GlobalConfig.ShenmoStoreItemConfig[this._curSMId],this.updateList(),this.updateRed()}}},e.prototype.updateRed=function(){for(var t=1;t<=this.items.length;t++)this.items[t-1].setRed((SmRedPoint.ins().itemPoints.length>0?SmRedPoint.ins().itemPoints[this._roleId][this._curSMId][t]:!1)||(SmRedPoint.ins().itemUpPoints.length>0?SmRedPoint.ins().itemUpPoints[this._roleId][this._curSMId][t]:!1));this.eRed.visible=SmRedPoint.ins().smSoulPoints[this._roleId][this._curSMId],this.updateList()},e.prototype.getAttStr=function(t){if(t){var e=AttributeFormat.getFormat();e.wordColor=this.eAttr.textColor,e.attrColor=this.eAttr.textColor;var i=0,s="";if(!t)return s;for(var n in t)i++,s+=i%2==0?AttributeData.getAttStrByType1(t[n],e)+"\n":StringUtils.complementByChar(AttributeData.getAttStrByType1(t[n],e),20,"  ");return s}},e.prototype.onClickMenu=function(t){this.curSMId=this.eList.selectedItem[0];var e=this.eList.selectedItem;e&&e[0]>0&&(this.curSMId=e[0])},e.prototype.onClick=function(t){if(t.target instanceof SmTreasureItem)if(t.target.itemId>0){var e=SmmzCT.ins().getSmInfoByRoleIdSmId(this._roleId,this._curSMId);GlobalFun.showDetail(GlobalConfig.ItemConfig[t.target.itemId],e)}else{var i=SmmzCT.ins().findBetterItem(this._roleId,this._curSMId,t.target.pos);i>0&&SmmzCT.ins().sendPutOn(this._roleId,this._curSMId,i)}else{var s=SmmzCT.ins().getSmInfoByRoleIdSmId(this._roleId,this._curSMId);switch(t.target){case this.eEffGroup:ViewManager.ins().open(SmSoulTipsWin,s,this._roleId);break;case this.eBreakBtn:ViewManager.ins().open(SmEquipForgeWin,s);break;case this.eChangeBtn:ViewManager.ins().open(SmMarketWin,s);break;case this.eLeftBtn:this.onLeft();break;case this.eRightBtn:this.onRight()}}},e.prototype.onLeft=function(){var t=120,e=this.eList.scrollH-t;e=Math.round(e/t)*t,0>e&&(e=0),this.eList.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=120,e=this.eList.scrollH+t;e=120*Math.round(e/120),e>this.eList.contentWidth-this.eList.width&&(e=this.eList.contentWidth-this.eList.width),this.eList.scrollH=e,this.onChange()},e.prototype.onChange=function(){this.eList.scrollH<60?(this.eLeftGroup.visible=!1,this.eRightgroup.visible=!0):this.eList.scrollH>=this.eList.contentWidth-this.eList.width-60?(this.eLeftGroup.visible=!0,this.eRightgroup.visible=!1):(this.eLeftGroup.visible=!0,this.eRightgroup.visible=!0)},e.prototype.setRoleId=function(t){this._roleId=t,this.updateView()},Object.defineProperty(e.prototype,"curSMId",{set:function(t){this._curSMId!=t&&(this._curSMId=t,this.eList.selectedIndex=t-1,this.updateView())},enumerable:!0,configurable:!0}),__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateList",null),__decorate([callLater],e.prototype,"updateRed",null),e}(BaseView);__reflect(SmMainPanel.prototype,"SmMainPanel"),window.SmMainPanel=SmMainPanel;var SmMarketItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChipMarketItemSkin",e.usage.text="",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.ItemConfig[t.goods[0].id],i=GlobalConfig.ItemConfig[t.costItem[0].id];this.item.data=e.id,this.itemName.text=e.name,this.moneyIcon.source=i.icon+"_png",this.money.text=t.costItem[0].count+"";var s=t.dayLimit>0?"每日限购: ":t.weekLimit>0?"每周限购":t.foreverLimit>0?"永久限购":"",n=t.dayLimit||t.weekLimit||t.foreverLimit||0,o=SmmzCT.ins().changeNums[t.shenmoIdx][t.itemIdx];this.myTimes.text=0==n?"":s+" "+Math.max(n-o,0)+"/"+n,this.buyBtn.enabled=0==n||n>o}},e.prototype.onClick=function(){var t=this.data,e=GlobalConfig.ItemConfig[t.costItem[0].id],i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.id);i>=t.costItem[0].count?SmmzCT.ins().sendChange(t.shenmoIdx,t.itemIdx):TipsCT.ins().showTips("材料不足,无法兑换")},e}(BaseItemRender);__reflect(SmMarketItemRenderer.prototype,"SmMarketItemRenderer"),window.SmMarketItemRenderer=SmMarketItemRenderer;var SmMarketWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="SmTreasureMarketSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];return i&&SmmzCT.ins().checkMarketOpen(i.smId)?!0:(TipsCT.ins().showTips("需要佩戴珍品"+GlobalConfig.ShenmoBaseConfig.smName[i.smId]+"一套后开启"),!1)},e.prototype.skinComplete=function(){this.eListDP=new eui.ArrayCollection,this.elist.itemRenderer=SmMarketItemRenderer,this.elist.dataProvider=this.eListDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.smInfo=t[0],this.addTouchEvent(this,this.onClick),this.observe(SmmzCT.ins().postChangeCB,this.update),this.update()},e.prototype.update=function(){this.updateView(),this.updateList()},e.prototype.updateView=function(){var t=GlobalConfig.ShenmoStoreItemConfig[this.smInfo.smId][1];this.eIcon.source=GlobalConfig.ItemConfig[t.costItem[0].id].icon+"_png";var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.costItem[0].id);this.sItemNum=e+""},e.prototype.updateList=function(){var t=GlobalConfig.ShenmoStoreItemConfig[this.smInfo.smId];this.eListDP.source=CommonUtils.objectToArray(t)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof SmMarketItemRenderer)return void t.target.parent.onClick();switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(SmMarketWin.prototype,"SmMarketWin"),window.SmMarketWin=SmMarketWin,ViewManager.ins().reg(SmMarketWin,LayerManager.UI_Popup);var SmSoulTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="SmTreasureSkillTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.mc=new MovieClip,this.ModelGroup.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.smInfo=t[0],this.roleId=t[1],this.addTouchEvent(this,this.onClick),this.observe(SmmzCT.ins().postSmSoulLvUp,this.update),this.observe(SmRedPoint.ins().postRoleRedPoint,this.updateRed),this.update(),this.mc.playFile(RES_DIR_EFF+("smmz_"+this.smInfo.smId),-1)},e.prototype.update=function(){var t=this.smInfo.smSoulLv+this.smInfo.smSoulAdd,e=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][t];this.currentState=10==e.shenmoIdx?"2":"1",this.updateView(),this.updateRed()},e.prototype.updateRed=function(){this.eRed.visible=SmRedPoint.ins().smSoulPoints[this.roleId][this.smInfo.smId]},e.prototype.updateView=function(){var t=this.smInfo.smSoulLv+this.smInfo.smSoulAdd,e=SmmzCT.ins().getSoulLvUpMax(this.smInfo.smId),i=t>0;i||(t=1);var s=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][1],n=SubRoles.ins().getSubRoleByIndex(this.roleId),o=n.job,a=0;
if(this.Bg.source="",s.skillIds&&s.skillIds[o-1]>0?(a=s.skillIds[o-1],this.Bg.source="smmz_skill"+o+"_jpg"):s.passiveskillIds&&(a=s.passiveskillIds[o-1]>0?s.passiveskillIds[o-1]:s.passiveskillIds[0]),a>0){var r=GlobalConfig.SkillsConfig[a];if(r){var l=SkillUtil.getName(r)||"";this.eAttr1.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(r)),this.eSkillName.textFlow=TextFlowMaker.generateTextFlow("|C:0xA5A37E&T:"+l+"|"+(i?" "+t+"级":" |C:0xf3311e&T:未激活|"))}}var h=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][t];this.eAttr.textFlow=TextFlowMaker.generateTextFlow(this.getAttStr(h.attr));var p=GlobalConfig.ShenmoBaseConfig.smName[this.smInfo.smId],u=GlobalConfig.ShenmoBaseConfig.smSoulName[this.smInfo.smId];if(this.sSuitTips=i?"":"集齐一套珍品以上"+p+"遗物 或 提升"+u+"等级可激活",this.eBtn.label=i?"进  阶":"激  活",this.eCost.visible=this.eBtn.visible=this.smInfo.smSoulLv<e,this.eCost.visible){var d=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][this.smInfo.smSoulLv],c=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,d.costItemId[0].id),f=d.costItemId[0].count;this.eCost.textFlow=TextFlowMaker.generateTextFlow("消耗 "+GlobalConfig.ItemConfig[d.costItemId[0].id].name+" |C:"+(c>=f?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+c+"/"+f)}this.ePower.setPower(this.smInfo.smSoulPower),this.eSuitAttr.textFlow=TextFlowMaker.generateTextFlow(this.getSkillStr(o))},e.prototype.getSkillStr=function(t){var e="",i=this.smInfo.smSoulLv+this.smInfo.smSoulAdd;i-1>0&&(e+=this.getSkillStrByLv(i-1,i,t)+"|S:5&T:\n\n|"),i>0&&(e+=this.getSkillStrByLv(i,i,t)+"|S:5&T:\n\n|");var s=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][i+1];return s&&(e+=""+this.getSkillStrByLv(i+1,i,t)),e},e.prototype.getSkillStrByLv=function(t,e,i){var s=e>=t,n=s?ColorUtil.GREEN:ColorUtil.GRAY,o="|C:"+n+"&T:"+StringUtils.complementByChar(""+GlobalConfig.ShenmoBaseConfig.smSoulName[this.smInfo.smId]+t+"级: ",14,"  "),a=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][t],r=a.attr;if(!r)return o;var l=0;for(var h in r){var p=r[h],u=AttributeData.getAttStrByType1(p);l++,o+=l%2==0?"|C:"+n+"&T:"+u+"|\n"+StringUtils.complementByChar("",12,"  "):"|C:"+n+"&T:"+StringUtils.complementByChar(u,16,"  ")+"|"}var d=0;if(a.skillIds&&a.skillIds[i-1]>0?d=a.skillIds[i-1]:a.passiveskillIds&&(d=a.passiveskillIds[i-1]>0?a.passiveskillIds[i-1]:a.passiveskillIds[0]),d>0){var c=GlobalConfig.SkillsConfig[d];c&&(o+=1>=t?"|C:"+(s?ColorUtil.RED:n)+"&T:激活神魔技-"+SkillUtil.getName(c)+"|":"|C:"+(s?ColorUtil.RED:n)+"&T:"+SkillUtil.getDesc(c)+"|")}return o},e.prototype.getAttStr=function(t){if(t){var e=AttributeFormat.FORMAT_2(),i=0,s="";if(!t)return s;for(var n in t)i++,s+=i%2==0?AttributeData.getAttStrByType1(t[n],e)+"\n":StringUtils.complementByChar(AttributeData.getAttStrByType1(t[n],e),20,"  ");return s}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:var e=GlobalConfig.ShenmoSoulSkillConfig[this.smInfo.smId][this.smInfo.smSoulLv];for(var i in e.costItemId){var s=e.costItemId[i];if(!s)return;var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.id);n<s.count&&TipsCT.ins().showTips("材料不足!")}SmmzCT.ins().sendSmSoulLvUp(this.smInfo.roleId,this.smInfo.smId)}},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateRed",null),__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(SmSoulTipsWin.prototype,"SmSoulTipsWin"),window.SmSoulTipsWin=SmSoulTipsWin,ViewManager.ins().reg(SmSoulTipsWin,LayerManager.UI_Popup);var SmTreasureItem=function(t){function e(){var e=t.call(this)||this;return e._sn_="SmTreasureItemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchEnabled=!0,this.touchChildren=!1,this.starList=new StarList(0),this.starGroup.addChild(this.starList),this.starList.horizontalCenter=0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.pos>=0&&this.itemId>0&&this.setData(this.pos,this.itemId)},e.prototype.setData=function(t,e){if(this.pos=t,this.itemId=e,this.skin){var i=GlobalConfig.ItemConfig[e];this.sName=i?i.name:"",this.sImg=i?i.icon+"_png":"";var s=GlobalConfig.ShenmoEquipConfig[e];this.eBg.filters=this.itemId>0?null:FilterUtil.ARRAY_GRAY_FILTER,s&&(this.starList.setlistLength(GlobalConfig.ShenmoBaseConfig.qualityStar[s.quality],s.starLevel),this.nameTxt.textColor=ItemBase.QUALITY_COLOR[s.quality]),this.starList.visible=!!s}},e.prototype.setRed=function(t){this.skin&&(this.eRed.visible=t)},e}(BaseView);__reflect(SmTreasureItem.prototype,"SmTreasureItem"),window.SmTreasureItem=SmTreasureItem;var SpiritBossCT=function(t){function e(){var e=t.call(this)||this;return e.sfData=[],e.challenge=0,e.juanTimes=1,e.bossIndex=0,e.lastSpirit=!1,e.isOpen=!1,e.isInit=0,e.sysId=PackageID.SpiritBoss,e.regNetMsg(2,e.postResult),e.regNetMsg(3,e.postFlag),e.regNetMsg(4,e.postInit),e.regNetMsg(5,e.postMonState),e.regNetMsg(6,e.postReTimes),e.regNetMsg(7,e.postPower),e.regNetMsg(9,e.postItemId),e.regNetMsg(11,e.postElert),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(BossCT.ins().postBossAppear,function(){e.isSPIRIT&&0!=GameLogic.ins().currAttackHandle&&ViewManager.ins().open(BossBelongPanel)}),e.observe(BossCT.ins().postBossDisappear,function(){e.isSPIRIT&&ViewManager.ins().close(BossBelongPanel)}),e.observe(GameLogic.ins().postEnterMap,function(){e.isSPIRIT?e.postEnterSpirit():e.lastSpirit&&e.postQuiSpirit()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.isInit=0,this.sfData=[],this.isOpen=t.readBoolean(),this.challenge=t.readByte(),this.juanTimes=t.readByte();for(var e=t.readByte(),i=1;e>=i;i++){for(var s={monNum:t.readByte(),monData:[]},n=1;n<=s.monNum;n++){var o=GlobalConfig.SpiritForbiddenLandBossConfig[i][n],a={state:t.readByte(),times:t.readInt(),belongHandle:0,bossId:o.bossId,x:o.pos[0],y:o.pos[1]};s.monData.push(a)}this.sfData.push(s)}},e.prototype.postResult=function(t){for(var e=t.readByte(),i=t.readByte(),s=[],n=0;i>n;n++){var o={type:t.readByte(),id:t.readInt(),count:t.readInt()};s.push(o)}switch(e){case 3:ViewManager.ins().open(GuileWarReliveWin,4);break;case 2:ResultManager.ins().create(FbCT.FB_TYPE_SPIRIT,s,1,this.winner);break;case 1:ResultManager.ins().create(FbCT.FB_TYPE_SPIRIT,s,1);break;case 0:var a="很遗憾，您本次没有很获得任何收益；\n请再接再厉";ResultManager.ins().create(FbCT.FB_TYPE_SPIRIT,0,0,a)}},e.prototype.postFlag=function(t){var e=t.readByte(),i=t.readByte();this.sfData[e-1].monData[i-1].state=t.readByte(),this.sfData[e-1].monData[i-1].belongHandle=t.readDouble(),this.layerNum=e},e.prototype.postMonState=function(t){var e=t.readByte(),i=t.readByte(),s=t.readByte();if(this.sfData[e-1].monData[i-1].state=s,this.sfData[e-1].monData[i-1].times=t.readInt(),0==s){this.bossIndex=i,this.creatModel(e,i);var n=GlobalConfig.SpiritForbiddenLandBossConfig[e][i].bossId,o=""+GlobalConfig.MonstersConfig[n].name,a=this.sfData[e-1].monData[i-1].belongHandle,r=EntityManager.ins().getEntityBymasterhHandle(a);if(r)return this.winner=r.infoModel.name,[o,this.winner]}},e.prototype.postReTimes=function(t){this.challenge=t.readByte()},e.prototype.postPower=function(t){this.power=t.readInt()},e.prototype.postItemId=function(t){this.challenge=t.readByte(),this.juanTimes=t.readByte()},e.prototype.postElert=function(t){var e=t.readDouble(),i=GlobalConfig.SpiritForbiddenLandBaseConfig.deadRebornTime;if(ViewManager.ins().open(KFBossReliveWin,i,e),KFServerSys.ins().isKF){var s=0==this.isInit?Actor.yb:Actor.yb-GlobalConfig.SpiritForbiddenLandBaseConfig.rebornPrice;Actor.ins().postYbChange(s)}},e.prototype.sendUpInter=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendUpItemId=function(){this.sendBaseProto(9)},e.prototype.sendUpBelongMon=function(t,e){var i=this.getBytes(10);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(12)},Object.defineProperty(e.prototype,"isSPIRIT",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_SPIRIT},enumerable:!0,configurable:!0}),e.prototype.postEnterSpirit=function(){if(this.lastSpirit=!0,ViewManager.ins().open(KFBossSceneWin),this.showView(!0),this.layerNum)for(var t=0;5>t;t++)0==this.sfData[this.layerNum-1].monData[t].state&&(this.bossIndex=t+1,this.creatModel(this.layerNum,t+1))},e.prototype.postQuiSpirit=function(){this.showView(!1),ViewManager.ins().close(KFBossSceneWin),this.lastSpirit=!1},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.SpiritSystemBaseConfig,i="";return(GameServer.serverOpenDay+1<e.openserverday||ZsCT.ins().lv<e.zslv)&&(i="开服"+e.openserverday+"天且角色"+e.zslv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getCdByType=function(t){if(0==GameMap.fubenID)return 0;for(var e=GlobalConfig.SpiritForbiddenLandBaseConfig,i=0;i<e.fbIds.length;i++)if(e.fbIds[i]==GameMap.fubenID&&4==t)return e.maxPowerEixtTime;return 0},e.prototype.showView=function(t){if(t){var i=e.ins().getBelongHandle(BossCT.ins().monsterID);ViewManager.ins().isShow(BossBelongPanel)||0==GameLogic.ins().currAttackHandle||GameLogic.ins().currAttackHandle!=i||ViewManager.ins().open(BossBelongPanel)}else ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(TargetListPanel)},e.prototype.onCreateEntity=function(t){if(t&&this.isSPIRIT){var i=e.ins().getBelongHandle(BossCT.ins().monsterID);0!=GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==i&&this.showView(!0)}},e.prototype.creatModel=function(t,e){var i=new EntityModel;i.type=EntityType.MuBei;var s=GlobalConfig.SpiritForbiddenLandBossConfig[t][e];if(s){i.x=s.pos[0]*GameMap.CELL_SIZE,i.y=s.pos[1]*GameMap.CELL_SIZE;var n=EntityManager.ins().createEntity(i);GameLogic.ins().addEntity(n)}},e.prototype.getTargetBelong=function(){var t=GameLogic.ins().currAttackHandle,e=EntityManager.ins().getEntityByHandle(t);if(e)for(var i=0;3>i;i++)for(var s=0;5>s;s++)if(e.infoModel.configID==this.sfData[i].monData[s].bossId)return this.sfData[i].monData[s].belongHandle;return 0},e.prototype.getBossNum=function(t){for(var e=0;3>e;e++)for(var i=0;5>i;i++)if(t==this.sfData[e].monData[i].belongHandle)return[e+1,i+1];return[0,0]},e.prototype.getBelongHandle=function(t){if(0==this.sfData.length)return 0;for(var e=0;3>e;e++)for(var i=0;5>i;i++)if(t==this.sfData[e].monData[i].bossId)return this.sfData[e].monData[i].belongHandle;return 0},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postFlag",null),__decorate([post()],e.prototype,"postMonState",null),__decorate([post()],e.prototype,"postReTimes",null),__decorate([post()],e.prototype,"postPower",null),__decorate([post()],e.prototype,"postItemId",null),__decorate([post(),post()],e.prototype,"postElert",null),__decorate([post()],e.prototype,"postEnterSpirit",null),__decorate([post()],e.prototype,"postQuiSpirit",null),e}(BaseSystem);__reflect(SpiritBossCT.prototype,"SpiritBossCT"),System.SpiritBossCT=function(){return SpiritBossCT.ins()},window.SpiritBossCT=SpiritBossCT;var SpiritBossItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="GuildSoulsLandMonsterItem",e.mc=new MovieClip,e.boss.addChild(e.mc),e.touchEnabled=e.touchChildren=!1,e.bg.visible=e.des.visible=!1,e}return __extends(e,t),e.prototype.setData=function(t,e){this.cfg=GlobalConfig.SpiritForbiddenLandBossConfig[t][e];var i=this.cfg.bossId,s=GlobalConfig.MonstersConfig[i];if(SpiritBossCT.ins().isOpen){var n=SpiritBossCT.ins().sfData[t-1].monData[e-1];this.mc.once(egret.Event.CHANGE,this.updateHeight,this),this.buff.text="",n.state?this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_4s"),-1):this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_4d"),1,null,!1)}else this.mc.once(egret.Event.CHANGE,this.updateHeight,this),this.buff.text="",this.mc.playFile(RES_DIR_MONSTER+(s.avatar+"_4s"),-1)},e.prototype.updateTime=function(t){t>=0?this.buff.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1)+"复活":this.buff.text="00:00:00复活"},e.prototype.updateHeight=function(){this.mc.y=this.mc.height/3,this.mc.scaleX=this.mc.scaleY=GlobalConfig.SpiritForbiddenLandBaseConfig.scale},e.prototype.clear=function(){this.mc.stop(),this.mc.removeEventListener(egret.Event.CHANGE,this.updateHeight,this),DisplayUtils.removeFromParent(this),Timer.stop(this.updateTime,this)},e}(BaseItemRender);__reflect(SpiritBossItem.prototype,"SpiritBossItem"),window.SpiritBossItem=SpiritBossItem;var SpiritBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bossPanels=[],e._sn_="KFsljdBossSkin",e.chTimes=0,e.area=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.addTouchEvent(this.awardslist,this.onClickList),this.eBuy.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eBuy.text+"</u>")},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SpiritBossCT.ins().postInit,this.update),this.observe(SpiritBossCT.ins().postMonState,this.update),this.observe(SpiritBossCT.ins().postItemId,this.update),this.observe(SpiritBossCT.ins().postReTimes,this.update);for(var i=GlobalConfig.SpiritForbiddenLandBaseConfig.zsConstrain,s=0;s<i.length;s++)ZsCT.ins().lv>=i[s][0]&&ZsCT.ins().lv<=i[s][1]&&(this.area=s);for(var n=0;3>n;n++)this["fb"+(n+1)].label="禁地"+StringUtils.NumberToChinese(n+1)+"层\n("+i[n][0]+"转-"+i[n][1]+"转)";this.eBuy.visible=!1,this.updateAward(),Timer.has(this.updateDesc,this)||Timer.start(1e3,0,this.updateDesc,this)},e.prototype.close=function(){Timer.stop(this.updateDesc,this)},e.prototype.updateAward=function(){var t=GlobalConfig.SpiritForbiddenLandBossConfig[this.area+1][1].passAwards;this.awardslist.dataProvider=new eui.ArrayCollection(t);for(var e=0;3>e;e++)this["fb"+(e+1)].icon=1==e?"btn_middle_dark":"btn_border_dark";this["fb"+(this.area+1)].icon=1==this.area?"btn_middle_light":"btn_border_light",this.update()},e.prototype.update=function(){this.updateMc(),this.chTimes=SpiritBossCT.ins().challenge,this.eNumLab.text=this.chTimes+"次";var t=BagCT.ins().getBagItemById(GlobalConfig.SpiritForbiddenLandBaseConfig.specialId);this.eBuy.visible=!(this.chTimes>0||t),this.showJuan(t)},e.prototype.updateMc=function(){this.clearBossMCs();for(var t=0;5>t;t++){var e=void 0;this.bossPanels[t]||(this.bossPanels[t]=new SpiritBossItem),e=this.bossPanels[t],this.bossPanels[t].setData(this.area+1,t+1);var i=GlobalConfig.SpiritForbiddenLandBossConfig[this.area+1][t+1].showPos;e.x=i[0],e.y=i[1],this.bossGroup.addChild(e)}},e.prototype.updateDesc=function(){for(var t in this.bossPanels){var e=this.bossPanels[t],i=SpiritBossCT.ins().sfData[this.area].monData[t];if(!i.state){var s=(DateUtils.formatMiniDateTime(i.times)-GameServer.serverTime)/1e3;e.updateTime(s)}}},e.prototype.clearBossMCs=function(){for(var t in this.bossPanels){var e=this.bossPanels[t];e.clear()}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.onClickList=function(t){var e=this.awardslist.dataProvider.getItemAt(this.awardslist.selectedIndex);if(e){var i=SpiritEquipCT.ins().getItemInfo(e.id);i&&(ViewManager.ins().close(ItemDetailedWin),ViewManager.ins().open(SpiritTipWin,i[0],i[1]))}},e.prototype.onClick=function(t){var e=this;switch(t.target){case this.fb1:case this.fb2:case this.fb3:var i=[this.fb1,this.fb2,this.fb3];this.area=Number(i.indexOf(t.target)),this.updateAward();break;case this.challengeBtn:if(!SpiritBossCT.ins().isOpen)return;if(!KfArenaSys.ins().checkIsMatching())return;var s=GlobalConfig.SpiritForbiddenLandBaseConfig,n="",o=BagCT.ins().getBagItemById(s.specialId);ZsCT.ins().lv<s.zsConstrain[this.area][0]?TipsCT.ins().showTips("转生等级不足"):this.chTimes<=0&&!o?TipsCT.ins().showTips("挑战次数不足"):this.chTimes<=0&&o?(n="确定使用1个<font color='#FFB82A'>圣灵禁地</font>道具兑换一次挑战次数？\n",WarnWin.show(n,function(){BagCT.ins().registerUseItemFunc(o.configID,function(){ViewManager.ins().close(BossWin),s&&!e.joinPulbicChallenge(s)}),SpiritBossCT.ins().juanTimes>=s.addTimeConstrain?TipsCT.ins().showTips("|C:0xff0000&T:次数不足"):SpiritBossCT.ins().sendUpItemId()},this)):(RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,SpiritBossCT.ins().challenge,function(){SpiritBossCT.ins().sendUpInter(e.area+1)}),SpiritBossCT.ins().layerNum=this.area+1);break;case this.eBuy:if(!this.showTips())return}},e.prototype.showTips=function(){var t=this,e=GlobalConfig.SpiritForbiddenLandBaseConfig,i="";if(this.chTimes>0)return!0;var s=SpiritBossCT.ins().juanTimes;return this.chTimes<=0&&s>=e.addTimeConstrain?void TipsCT.ins().showTips("|C:0xff0000&T:购买次数不足"):Actor.yb<e.buyPrice?(TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1):(i="确定花费<font color='#FFB82A'>"+e.buyPrice+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+s+"/"+e.addTimeConstrain),WarnWin.show(i,function(){(!e||t.joinPulbicChallenge(e))&&SpiritBossCT.ins().sendUpItemId()},this),!1)},e.prototype.joinPulbicChallenge=function(t){var e=this;return t?FbCT.ins().checkInFB()?!1:(ZsCT.ins().lv>=t.zsConstrain[this.area][0]?RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,SpiritBossCT.ins().challenge,function(){SpiritBossCT.ins().sendUpInter(e.area+1)}):TipsCT.ins().showTips("|C:0xf3311e&T:转生等级不足|"),!0):!1},e}(BaseView);__reflect(SpiritBossPanel.prototype,"SpiritBossPanel"),window.SpiritBossPanel=SpiritBossPanel;var SpiritBossTargetItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbTargetSkin",e.touchEnabled=!0,e.touchChildren=!1,e.landpoint.visible=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.bossId,e=this.data.state,i=this.data.handle,s=this.data.cfg;this.landpoint.text="禁地之力+"+s.killlandpoint;var n=GlobalConfig.MonstersConfig[t];if(this.roleName.text=n.name,this.roleHead.source="monhead"+n.head+"_png",this.roleHead.filters=null,0==e){this.roleHead.filters=FilterUtil.ARRAY_GRAY_FILTER;var o=this.data.times,a=(DateUtils.formatMiniDateTime(o)-GameServer.serverTime)/1e3;0>a&&(a=0),this.roleName.text=DateUtils.getFormatBySecond(a,DateUtils.TIME_FORMAT_1)+"复活"}GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==i?(this.addAttEffect(),this.targetName.visible=!0,this.targetSelect.visible=!0):(this.removeAttEffect(),this.targetName.visible=!1,this.targetSelect.visible=!1)}},e.prototype.addAttEffect=function(){this.attEffect||(this.attEffect=new MovieClip,this.attEffect.x=49,this.attEffect.y=28,this.attEffect.playFile(RES_DIR_EFF+"BattlEff2",-1),this.addChild(this.attEffect))},e.prototype.removeAttEffect=function(){this.attEffect&&(DisplayUtils.removeFromParent(this.attEffect),this.attEffect=null)},e}(BaseItemRender);__reflect(SpiritBossTargetItem.prototype,"SpiritBossTargetItem"),window.SpiritBossTargetItem=SpiritBossTargetItem;var SpiritBossUI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFsljdUISkin",e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(SpiritBossCT.ins().postPower,this.update),this.observe(SpiritBossCT.ins().postMonState,this.update),this.observe(SpiritBossCT.ins().postElert,this.update),this.observe(SpiritBossCT.ins().postFlag,this.update),this.observe(SpiritBossCT.ins().postResult,this.update),this.observe(SpiritBossCT.ins().postInit,this.update),this.observe(BagCT.ins().postItemCountChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.update(),Timer.start(1e3,0,this.update,this)},e.prototype.close=function(){Timer.stop(this.update,this)},e.prototype.onTouch=function(t){switch(t.target){case this.target4:case this.target1:case this.target2:case this.target3:case this.target5:t.target.data&&t.target.data.handle>0&&(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameLogic.ins().postChangeAttrPoint(t.target.data.handle))}},e.prototype.update=function(){this.power.text=SpiritBossCT.ins().power+"/"+GlobalConfig.SpiritForbiddenLandBaseConfig.maxforbiddenPower;for(var t=SpiritBossCT.ins().layerNum,e=[],i=1;6>i;i++){var s=GlobalConfig.SpiritForbiddenLandBossConfig[t][i],n=SpiritBossCT.ins().sfData[t-1].monData[i-1],o=n.bossId,a=n.state,r=n.times,l=EntityManager.ins().getEntityByMonsterId(o),h=l.length>0?l[0].infoModel.handle:0;e.push({bossId:o,state:a,handle:h,times:r,cfg:s})}for(var p,u=e.length,d=1;6>d;d++)p=this["target"+d],u>=d?(this.teamFbTarget.addChild(p),p.data=e[d-1]):DisplayUtils.removeFromParent(p)},e}(BaseEuiView);__reflect(SpiritBossUI.prototype,"SpiritBossUI"),window.SpiritBossUI=SpiritBossUI,ViewManager.ins().reg(SpiritBossUI,LayerManager.UI_Main);var SpiritEquipCT=function(t){function e(){var e=t.call(this)||this;return e.spiritData=[],e.sysId=PackageID.SpiritEquip,e.regNetMsg(1,e.postInit),e.regNetMsg(2,e.postUpActive),e.regNetMsg(3,e.postUpStage),e.regNetMsg(4,e.postUpLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.spiritData=[];for(var e=0;3>e;e++)for(var i=0;4>i;i++){var s={isAct:t.readByte(),stage:t.readInt(),level:t.readInt(),power:t.readInt()};this.spiritData.push(s)}},e.prototype.postUpActive=function(t){this.type=t.readByte(),this.index=t.readByte();var e=this.changeNum(this.type,this.index);this.spiritData[e].power=t.readInt(),this.spiritData[e].isAct=1},e.prototype.postUpStage=function(t){this.type=t.readByte(),this.index=t.readByte();var e=this.changeNum(this.type,this.index);this.spiritData[e].stage=t.readInt(),this.spiritData[e].power=t.readInt()},e.prototype.postUpLevel=function(t){this.type=t.readByte(),this.index=t.readByte();var e=this.changeNum(this.type,this.index);this.spiritData[e].level=t.readInt(),this.spiritData[e].power=t.readInt()},e.prototype.sendUpActive=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUpStage=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUpLevel=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.changeNum=function(t,e){return 4*(t-1)+e-1},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.SpiritSystemBaseConfig,i="";return(GameServer.serverOpenDay+1<e.openserverday||ZsCT.ins().lv<e.zslv)&&(i="开服"+e.openserverday+"天且角色"+e.zslv+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getItemInfo=function(t){for(var e=0;3>e;e++)for(var i=0;4>i;i++)if(GlobalConfig.SpiritSystemActivateConfig[e+1][i+1].consumeItems[0].id==t)return[e,i]},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postUpActive",null),__decorate([post()],e.prototype,"postUpStage",null),__decorate([post()],e.prototype,"postUpLevel",null),e}(BaseSystem);__reflect(SpiritEquipCT.prototype,"SpiritEquipCT"),System.SpiritEquipCT=function(){return SpiritEquipCT.ins()},window.SpiritEquipCT=SpiritEquipCT;var SpiritEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemChange,SpiritEquipCT.ins().postUpStage,SpiritEquipCT.ins().postInit,SpiritEquipCT.ins().postUpActive,SpiritEquipCT.ins().postUpLevel),e.ins=SpiritEquipCT.ins(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){if(0!=this.ins.spiritData.length){for(var t=0;3>t;t++)for(var e=0;4>e;e++)if(this.upStageRed(t+1,e+1)||this.upLevelRed(t+1,e+1))return void(this.redPoint=!0);this.redPoint=!1}},e.prototype.upStageRed=function(t,e){if(this.ins.spiritData&&0!=t&&0!=e){var i=this.ins.changeNum(t,e),s=this.ins.spiritData[i],n=GlobalConfig.SpiritSystemUpgradeConfig[t][e][s.stage+1];if(s.isAct>0&&n){var o=n.consumeItems[0].id,a=ItemUtil.isEquip(GlobalConfig.ItemConfig[o])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,r=BagCT.ins().getBagGoodsCountById(a,o);if(r>=n.consumeItems[0].count)return!0}return!1}},e.prototype.upLevelRed=function(t,e){if(this.ins.spiritData&&0!=t&&0!=e){var i=this.ins.changeNum(t,e),s=this.ins.spiritData[i],n=GlobalConfig.SpiritSystemUpLevelConfig[t][e][s.level+1];if(n){var o=n.consumeItems[0].id,a=n.consumeItems[0].count;if(0==s.isAct){var r=GlobalConfig.SpiritSystemActivateConfig[t][e];o=r.consumeItems[0].id,a=r.consumeItems[0].count}var l=ItemUtil.isEquip(GlobalConfig.ItemConfig[o])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,h=BagCT.ins().getBagGoodsCountById(l,o);if(h>=a)return!0}return!1}},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(SpiritEquipRedPoint.prototype,"SpiritEquipRedPoint"),System.SpiritEquipRedPoint=function(){return SpiritEquipRedPoint.ins()},window.SpiritEquipRedPoint=SpiritEquipRedPoint;var SpiritAdvanceWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SpiritEquipAdvance",e}return __extends(e,t),e.prototype.skinComplete=function(){this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this,this.onClick),this.starList=new StarList(6),this.starList.horizontalCenter=0,this.starGroup.addChild(this.starList),this.model||(this.model=new MovieClip),this.model.parent||this.eff.addChild(this.model),this.oldHorizontalCenter=this.nowAttr.horizontalCenter,this.itemIcon.imgJob.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SpiritEquipCT.ins().postUpStage,this.doUpdate),this.sInfo=t[0];var i=t[1];this.type=i.quality,this.index=i.kind,this.sCfg=GlobalConfig.SpiritSystemUpgradeConfig[this.type][this.index],this.des.source=i.show.name,this.model.playFile(RES_DIR_EFF+i.show.eff,-1);var s=this.sCfg[this.sInfo.stage].talentIndex;this.nameTxt.text=GlobalConfig.SpiritSystemTalentEffConfig[s].desc.name,this.itemIcon.imgIcon.source=GlobalConfig.SpiritSystemTalentEffConfig[s].desc.icon,this.update()},e.prototype.update=function(){this.powerPanel.setPower(this.sInfo.power);var t=this.sCfg[this.sInfo.stage],e=this.sCfg[this.sInfo.stage+1],i=!e,s=AttributeFormat.FORMAT_1();s.wordColor=null,s.attrColor=null;var n="",o="",a=t.talentIndex,r=GlobalConfig.SpiritSystemTalentEffConfig[a],l="",h=AttributeData.getAttrStrByType(r.attrsrate[0].type);if(l+=""+h+("+"+r.attrsrate[0].value/100+"%"),n+="|C:0x35E62D&T:Lv"+this.sInfo.stage+"：||C:0x9F946D&T:"+l+"|",!i){var p=e.talentIndex,u=GlobalConfig.SpiritSystemTalentEffConfig[p],d="",c=AttributeData.getAttrStrByType(u.attrsrate[0].type);d+=""+c+("+"+u.attrsrate[0].value/100+"%"),o+="|C:0x35E62D&T:Lv"+(this.sInfo.stage+1)+"：||C:0x9F946D&T:"+d+"|",this.itemId=e.consumeItems[0].id,this.icon1.source=GlobalConfig.ItemConfig[this.itemId].icon+"_png";var f=ItemUtil.isEquip(GlobalConfig.ItemConfig[this.itemId])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;this.num=BagCT.ins().getBagGoodsCountById(f,this.itemId),this.need=e.consumeItems[0].count;var g="";g=this.num>=this.need?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+g+">"+this.num+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+e.consumeItems[0].count+"</font> ")}this.skillDes.textFlow=TextFlowMaker.generateTextFlow1(""+n+"\n"+o),this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr1(t.attrs,s)),this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(i?"":AttributeData.getAttStr1(e.attrs,s)),this.nowAttr.horizontalCenter=i?0:this.oldHorizontalCenter,this.costGroup.visible=this.getItemTxt.visible=this.oneKeyChange.visible=this.arrow.visible=!i,this.max.visible=i,this.updateStar(),this.upRed.visible=SpiritEquipRedPoint.ins().upStageRed(this.type,this.index)},e.prototype.doUpdate=function(){this.update(),this.updateStar(1)},e.prototype.updateStar=function(t){void 0===t&&(t=0);var e=Math.floor(this.sInfo.stage%6);if(this.sInfo.stage){var i=e;i||(e=6)}this.starList.setStarNum(e,t)},e.prototype.onClick=function(t){switch(t.target){case this.eClose:ViewManager.ins().close(this);break;case this.getItemTxt:WarnCT.ins().setBuyGoodsWarn(this.itemId,1),ViewManager.ins().close(this);break;case this.oneKeyChange:this.num>=this.need?SpiritEquipCT.ins().sendUpStage(this.type,this.index):TipsCT.ins().showTips("道具不足")}},e}(BaseEuiView);__reflect(SpiritAdvanceWin.prototype,"SpiritAdvanceWin"),window.SpiritAdvanceWin=SpiritAdvanceWin,ViewManager.ins().reg(SpiritAdvanceWin,LayerManager.UI_Popup);var SpiritBtnItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="SpiritEquipBtn",e.choice.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;if(t.item){this.img.source=t.item.icon,this.des.source=t.item.desc;var e=SpiritEquipCT.ins().changeNum(this.data.quality,this.data.kind),i=SpiritEquipCT.ins().spiritData[e];this.count.text=""+i.level,0==i.isAct&&(this.img.filters=FilterUtil.ARRAY_GRAY_FILTER),this.upRed.visible=SpiritEquipRedPoint.ins().upLevelRed(this.data.quality,this.data.kind)||SpiritEquipRedPoint.ins().upStageRed(this.data.quality,this.data.kind)}}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.choice.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(SpiritBtnItem.prototype,"SpiritBtnItem"),window.SpiritBtnItem=SpiritBtnItem;var SpiritEquipPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SpiritEquipSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eTScoller.touchEnabled=!1,this.eTScoller.touchChildren=!0,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.model=new MovieClip,this.eff.addChild(this.model),this.addTouchEvent(this,this.onClick),this.btn.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.eTab.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange1,this),this.addTouchEvent(this.skill0,this.onSkillEvent0)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SpiritEquipCT.ins().postInit,this.update),this.observe(SpiritEquipCT.ins().postUpActive,this.update),this.observe(SpiritEquipCT.ins().postUpLevel,this.update),this.observe(SpiritEquipCT.ins().postUpStage,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.eTab.selectedIndex=0,this.btn.selectedIndex=0,this.update();for(var i=0;i<this.cfg.skill.length;i++)this.addTouchEvent(this.skill1,this.onSkillEvent1)},e.prototype.update=function(){for(var t=[],e=1;4>e;e++)t.push(e);this.eTab.dataProvider=new eui.ArrayCollection(t);var i=GlobalConfig.SpiritSystemActivateConfig[this.eTab.selectedIndex+1],s=[];for(var e in i)s.push(i[e]);this.btn.dataProvider=new eui.ArrayCollection(s),this.showUI()},e.prototype.showUI=function(){var t=this;this.oneKeyChange.label="升 级";var e=4*this.eTab.selectedIndex+this.btn.selectedIndex;this.sInfo=SpiritEquipCT.ins().spiritData[e],this.cfg=GlobalConfig.SpiritSystemActivateConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1];var i=this.sInfo.stage;this.level.text="Lv."+this.sInfo.level,this.des.source=this.cfg.show.name,this.model.playFile(RES_DIR_EFF+this.cfg.show.eff,-1),this.model.filters=null;var s=[],n=GlobalConfig.SpiritSystemUpgradeConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1][0].talentIndex;s.push({id0:n,num0:e}),this.skill0.dataProvider=new eui.ArrayCollection(s);for(var o=[],a=0;a<this.cfg.skill.length;a++){var r=this.cfg.skill[a].id;GlobalConfig.SpiritSystemSkillEffConfig[r];o.push({id1:r,cfg1:this.cfg,num1:e})}this.skill1.dataProvider=new eui.ArrayCollection(o);var l=this.sInfo.level,h=GlobalConfig.SpiritSystemUpLevelConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1][l+1],p=!h;if(!p){this.itemId=h.consumeItems[0].id,this.need=h.consumeItems[0].count,0==this.sInfo.isAct&&(this.oneKeyChange.label="激 活",this.model.filters=FilterUtil.ARRAY_GRAY_FILTER,this.itemId=this.cfg.consumeItems[0].id,this.need=this.cfg.consumeItems[0].count),this.icon.source=GlobalConfig.ItemConfig[this.itemId].icon+"_png";
var u=ItemUtil.isEquip(GlobalConfig.ItemConfig[this.itemId])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;this.num=BagCT.ins().getBagGoodsCountById(u,this.itemId);var d="";d=this.num>=this.need?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+d+">"+this.num+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.need+"</font> ")}this.costGroup.visible=this.getItemTxt.visible=this.oneKeyChange.visible=!p,this.max.visible=p,this.powerPanel.setPower(this.sInfo.power),this.upRed.visible=SpiritEquipRedPoint.ins().upLevelRed(this.eTab.selectedIndex+1,this.btn.selectedIndex+1),this.rankRed.visible=SpiritEquipRedPoint.ins().upStageRed(this.eTab.selectedIndex+1,this.btn.selectedIndex+1),this.arr=[];var c=[2,4,5,6];c.forEach(function(e){t.arr.push({type:e,value:0})});for(var f=GlobalConfig.SpiritSystemUpLevelConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1][l],g=GlobalConfig.SpiritSystemUpgradeConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1][i],a=0;4>a;a++){this["attr"+a].text="",this["addAttr"+a].text="";var y=!1;if(f&&f.attrs[a]&&f.attrs[a].value>=0){if(!p){y=!0;var v=h.attrs[a].value,m=f.attrs[a].value;this.cfg.attrs&&(v+=this.cfg.attrs[a].value,m+=this.cfg.attrs[a].value),g&&g.attrs[a]&&g.attrs[a].value&&(v+=g.attrs[a].value,m+=g.attrs[a].value),this["addAttr"+a].text=0==this.sInfo.isAct?""+m:""+v}var T=f.attrs[a].value,C=AttributeData.getAttrStrByType(f.attrs[a].type);this.cfg.attrs&&(T+=this.cfg.attrs[a].value),g&&g.attrs[a]&&g.attrs[a].value&&(T+=g.attrs[a].value),this["attr"+a].text=0==this.sInfo.isAct?AttributeData.getAttStrByType1(this.arr[a]):""+C+"+"+T}this["arrow"+a].visible=y}},e.prototype.onListChange=function(t){this.btn.selectedIndex=t.itemIndex},e.prototype.onListChange1=function(t){this.eTab.selectedIndex=t.itemIndex},e.prototype.onSkillEvent0=function(t){var e=GlobalConfig.SpiritSystemUpgradeConfig[this.eTab.selectedIndex+1][this.btn.selectedIndex+1][this.sInfo.stage].talentIndex;ViewManager.ins().open(SpiritSkillTipWin,e,0,this.sInfo,this.cfg)},e.prototype.onSkillEvent1=function(t){if(t.target.itemIndex>=0){var e=this.cfg.skill[t.target.itemIndex].id;return void ViewManager.ins().open(SpiritSkillTipWin,0,e,this.sInfo,this.cfg)}},e.prototype.onClick=function(t){if(t.target instanceof SpiritBtnItem)t.target.itemIndex==this.btn.selectedIndex&&this.showUI();else if(t.target instanceof SpiritTabItem&&t.target.itemIndex==this.eTab.selectedIndex)return void this.update();switch(t.target){case this.eff:if(0==this.sInfo.isAct)return;ViewManager.ins().open(SpiritAdvanceWin,this.sInfo,this.cfg);break;case this.getItemTxt:WarnCT.ins().setBuyGoodsWarn(this.itemId,1);break;case this.oneKeyChange:0==this.sInfo.isAct&&this.num>=this.need?SpiritEquipCT.ins().sendUpActive(this.eTab.selectedIndex+1,this.btn.selectedIndex+1):1==this.sInfo.isAct&&this.num>=this.need?SpiritEquipCT.ins().sendUpLevel(this.eTab.selectedIndex+1,this.btn.selectedIndex+1):TipsCT.ins().showTips("道具不足");break;case this.icon:ItemUtil.getType(GlobalConfig.ItemConfig[this.itemId])==ItemType.TYPE_38?ViewManager.ins().open(SpiritTipWin,this.eTab.selectedIndex,this.btn.selectedIndex):ViewManager.ins().open(ItemDetailedWin,0,this.itemId,this.num)}},e}(BaseView);__reflect(SpiritEquipPanel.prototype,"SpiritEquipPanel"),window.SpiritEquipPanel=SpiritEquipPanel;var SpiritSkillsItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="ItemIconSkin",e.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.cfg1,e=this.data.id0,i=this.data.id1,s=GlobalConfig.SpiritSystemTalentEffConfig[e],n=GlobalConfig.SpiritSystemSkillEffConfig[i];if(s&&(this.imgIcon.source=s.desc.icon,this.blackImg1.visible=0==SpiritEquipCT.ins().spiritData[this.data.num0].isAct),n){this.imgIcon.source=n.desc.icon;for(var o=SpiritEquipCT.ins().spiritData[this.data.num1],a=0;a<t.skill.length;a++)t.skill[a].id==i&&(this.blackImg1.visible=t.skill[a].open>o.level)}}},e}(BaseItemRender);__reflect(SpiritSkillsItem.prototype,"SpiritSkillsItem"),window.SpiritSkillsItem=SpiritSkillsItem;var SpiritSkillTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZhanlingSkillTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.otherClose)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.tfid=t[0],this.skillid=t[1],this.sInfo=t[2],this.cfg=t[3];var i={name:"",desc:"",lock:""},s={name:"",desc:"",lock:""},n="",o=AttributeFormat.FORMAT_1();if(o.wordColor=null,o.attrColor=null,this.skillid){n="unactive";for(var a=this.cfg.skill,r=this.sInfo.level,l=0;l<a.length;l++)if(this.cfg.skill[l].id==this.skillid){var h=GlobalConfig.SpiritSystemSkillEffConfig[a[l].id];r<a[l].open?i.lock=a[l].open+"级":n="max",i.name=h.desc.name,i.desc=h.desc.des;break}}else if(this.tfid){var p=this.cfg.quality,u=this.cfg.kind,d=this.sInfo.stage,c=GlobalConfig.SpiritSystemUpgradeConfig[p][u],f=CommonUtils.getObjectLength(c),g=c[d].talentIndex,y=GlobalConfig.SpiritSystemTalentEffConfig[g];if(i.name=y.desc.name,y.attrsrate){i.desc&&(i.desc+="\n");var v=AttributeData.getAttrStrByType(y.attrsrate[0].type),m=""+v+("+"+y.attrsrate[0].value/100+"%");i.desc+="|C:0xff00ff&T:"+m+"|"}if(0==this.sInfo.isAct)n="unactive",i.lock="激活皮肤后";else if(d>=f-1)n="max";else{n="active";var T=c[d+1].talentIndex,C=GlobalConfig.SpiritSystemTalentEffConfig[T];if(s.name=C.desc.name,C.attrsrate){s.desc&&(s.desc+="\n");var v=AttributeData.getAttrStrByType(C.attrsrate[0].type),m=""+v+("+"+C.attrsrate[0].value/100+"%");s.desc+="|C:0xff00ff&T:"+m+"|"}s.lock="|C:0xFFFFCC&T:升级条件：|||C:0xF3311E&T:"+(d+1)+"阶",this.lock1.text=""}}this.currentState=n,this.validateNow(),this.skillName0.textFlow=TextFlowMaker.generateTextFlow1(i.name),this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow1(i.desc),i.lock?this.condition0.textFlow=TextFlowMaker.generateTextFlow1(i.lock):DisplayUtils.removeFromParent(this.condition0.parent),s.name&&("active"==n?(this.skillName1.textFlow=TextFlowMaker.generateTextFlow1(s.name),this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow1(s.desc),s.lock?this.condition1.textFlow=TextFlowMaker.generateTextFlow1(s.lock):DisplayUtils.removeFromParent(this.condition1.parent)):DisplayUtils.removeFromParent(this.nextGroup))},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(SpiritSkillTipWin.prototype,"SpiritSkillTipWin"),window.SpiritSkillTipWin=SpiritSkillTipWin,ViewManager.ins().reg(SpiritSkillTipWin,LayerManager.UI_Popup);var SpiritTabItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="SpiritEquipItem",e.eRect.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data>0){this.btn.source="spiritBtn"+this.data;var t=GlobalConfig.SpiritSystemUpLevelConfig[this.data][1][1].consumeItems[0].id,e=ItemUtil.isEquip(GlobalConfig.ItemConfig[t])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,i=BagCT.ins().getBagGoodsCountById(e,t);this.count.text=""+i;for(var s=0;4>s;s++){if(SpiritEquipRedPoint.ins().upLevelRed(this.data,s+1)||SpiritEquipRedPoint.ins().upStageRed(this.data,s+1)){this.upRed.visible=!0;break}this.upRed.visible=!1}}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.eRect.visible=!t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(SpiritTabItem.prototype,"SpiritTabItem"),window.SpiritTabItem=SpiritTabItem;var SpiritTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBTipItemsSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChanged=function(){if(this.data){var t=this.data.cfg,e=this.data.id,i=GlobalConfig.SpiritSystemSkillEffConfig[e];this.skillIcon1.source=i.desc.icon;for(var s=0,n=0;n<t.skill.length;n++)if(t.skill[n].id==e){s=t.skill[n].open;break}var o={name:"",desc:""};o.name=i.desc.name,o.desc=i.desc.des,this.desc.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00FF00&T:"+s+"级|强力技能|C:0xff00ff&T:【"+o.name+"】|\n"+o.desc)}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){},e}(BaseItemRender);__reflect(SpiritTipsItem.prototype,"SpiritTipsItem"),window.SpiritTipsItem=SpiritTipsItem;var SpiritTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZhanlingZBTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.itemname.visible=this.itemDesc.visible=this.gainListGroup.visible=!1,this.skillList.itemRenderer=SpiritTipsItem,this.addTouchEndEvent(this,this.otherClose)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],s=t[1],n=GlobalConfig.SpiritSystemActivateConfig[i+1][s+1];this.zhanlingName.source=n.show.name,this.model||(this.model=new MovieClip),this.model.parent||this.zhanling.addChild(this.model),this.model.name!=RES_DIR_EFF+n.show.eff&&this.model.playFile(RES_DIR_EFF+n.show.eff,-1);var o=GlobalConfig.ItemConfig[n.consumeItems[0].id],a=ItemUtil.getQuality(o);this.quali.source=a>0?"quali"+a:"";var r=GlobalConfig.SpiritSystemUpgradeConfig[i+1][s+1][0],l=r.talentIndex,h=GlobalConfig.SpiritSystemTalentEffConfig[l],p="";if(h.attrsrate)for(var u=0;u<h.attrsrate.length;u++){var d=AttributeData.getAttrStrByType(h.attrsrate[u].type);p+="|C:0xffff00&T:"+d+"|"+("|C:0xff00ff&T:+"+h.attrsrate[u].value/100+"%|")+"    "}this.skillIcon0.source=h.desc.icon,this.desc.textFlow=TextFlowMaker.generateTextFlow1("|C:0x9F946D&T:激活或提升本身器天赋：||C:0xffff00&T:【"+h.desc.name+"】\n"+p);for(var c=[],u=0;u<n.skill.length;u++){var f=n.skill[u].id;c.push({id:f,cfg:n})}this.skillList.dataProvider=new eui.ArrayCollection(c);var g=BagCT.getAttrPower(n.attrs);this.powerPanel.setPower(g)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(SpiritTipWin.prototype,"SpiritTipWin"),window.SpiritTipWin=SpiritTipWin,ViewManager.ins().reg(SpiritTipWin,LayerManager.UI_Popup);var SubscribeRule=function(t){function e(e,i){var s=t.call(this,e,i)||this;return s.showMessage=[ShareCT.ins().postSubscribe],s.updateMessage=[ShareCT.ins().postSubscribe],s}return __extends(e,t),e.prototype.checkShowIcon=function(){return!ShareCT.ins().subReward&&ShareCT.ins().subscribeOpen},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return this.effX=38,this.effY=38,"CirclePrompt"},e.prototype.tapExecute=function(){ViewManager.ins().open(SubscribeWin)},e}(RuleIconBase);__reflect(SubscribeRule.prototype,"SubscribeRule"),window.SubscribeRule=SubscribeRule;var SubscribeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="DingyueSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.addTouchEvent(this,this.onClick);var e=GlobalConfig.WeiXiGuanZhuConst;this.templateId=e.subscribeID,this.elist.dataProvider=new eui.ArrayCollection(e.subscribeAwards),this.addEvent(egret.TouchEvent.TOUCH_BEGIN,this.btn,function(){window.platform.getSubscribe(t.templateId)})},e.prototype.onClick=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(s){switch(s.label){case 0:switch(e=t.target){case this.bgClose:return[3,1];case this.btn:return[3,2]}return[3,4];case 1:return ViewManager.ins().close(this),[3,4];case 2:return window.platform.getKeepSubscribe?[4,window.platform.getKeepSubscribe(this.templateId)]:[2];case 3:return i=s.sent(),i[1]||ShareCT.ins().subReward||(ShareCT.ins().sendSubscribe(),ViewManager.ins().close(this)),[3,4];case 4:return[2]}})})},e}(BaseEuiView);__reflect(SubscribeWin.prototype,"SubscribeWin"),window.SubscribeWin=SubscribeWin,ViewManager.ins().reg(SubscribeWin,LayerManager.UI_Popup);var TitleTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="TitleTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.titleMc=new MovieClip,this.titleEffGroup.addChild(this.titleMc),this.eBtn.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0];var i;t&&t[0]instanceof ItemData?(i=this.data.itemConfig,this.eBtn.visible=!0):isNaN(this.data)?1==this.data.type&&(i=GlobalConfig.ItemConfig[this.data.id]):i=GlobalConfig.ItemConfig[this.data],this.update(i)},e.prototype.update=function(t){if(t){var e=Title.getTitleCfgByItemId(t.id),i=ItemUtil.getQuality(t);this.itemname.text=t.name,this.itemname.textColor=ItemUtil.getQualityColor(t);var s=BagCT.getAttrPower(e.attrs);this.powerPanel.setPower(3*s),this.quali.source=i>0?"quali"+i:"";var n=["|C:0xfbf8ee&T:普通|","|C:0x00ff3c&T:稀有|","|C:0x066eba&T:珍贵|","|C:0xd200ff&T:国器|","|C:0xf45601&T:无双|"];this.quality.textFlow=TextFlowMaker.generateTextFlow1(n[e.rare]),e.img?this.sTitleIcon=RES_DIR_CHENGHAO+e.img:this.sTitleIcon="",e.eff&&this.titleMc.playFile(RES_DIR_EFF+e.eff,-1);var o=AttributeFormat.FORMAT_1();o.wordColor=null,o.attrColor=null,this.sAttr=this.sTitle="";var a=4,r="";for(var l in e.sysadd){var h=Title.ins().attrDesc(e.sysadd[l]);r+=h.h+h.t,this.sTitle="特殊属性",this.sAttr=r}if(e.attrs.length>a){for(var p="",u=0;u<e.attrs.length;u++)a>u?(p+=AttributeData.getAttStrByType1(e.attrs[u],o),a-1>u&&(p+=StringUtils.repeatStr("\n",o.emptyLine+1))):(r+=AttributeData.getAttStrByType1(e.attrs[u],o),u<e.attrs.length-1&&(r+=StringUtils.repeatStr("\n",o.emptyLine+1)));this.attrs.text=p,this.sTitle="特殊属性",this.sAttr=r}else this.attrs.text=AttributeData.getAttStr1(e.attrs,o);this.description.textFlow=TextFlowMaker.generateTextFlow(t.desc)}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:this.data instanceof ItemData&&BagCT.ins().sendUseItem(this.data.configID,1);case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(TitleTipsWin.prototype,"TitleTipsWin"),window.TitleTipsWin=TitleTipsWin,ViewManager.ins().reg(TitleTipsWin,LayerManager.UI_Popup);var OpenSerVipItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ThreeActorRewardItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.day.text=t+"天",this.dayup.visible=VipCT.ins().openVip&&VipCT.ins().openVip.day>=t}},e}(BaseItemRender);__reflect(OpenSerVipItem.prototype,"OpenSerVipItem"),window.OpenSerVipItem=OpenSerVipItem;var OpenSerVipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ThreeActorRewardSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList0.itemRenderer=OpenSerVipItem,this.eList1.itemRenderer=OpenSerVipItem,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(VipCT.ins().postOpenServerVip,this.updateList),this.updateList()},e.prototype.updateList=function(){for(var t=GlobalConfig.VipOpenServerConfig.days,e=Math.floor(t/2),i=[],s=[],n=1;t>=n;n++)e>=n?i.push(n):s.push(n);if(this.eList0.dataProvider=new eui.ArrayCollection(i),this.eList1.dataProvider=new eui.ArrayCollection(s),VipCT.ins().openVip){var o=VipCT.ins().openVip.day;this.eRp.visible=this.openBtn.enabled=o>=t&&0==VipCT.ins().openVip.status,this.openBtn.label=o>=t?0==VipCT.ins().openVip.status?"可领取":"已领取":t-o+"天后可领取"}},e.prototype.onClick=function(t){switch(t.target){case this.openBtn:VipCT.ins().sendOpenServerVip()}},e}(BaseEuiView);__reflect(OpenSerVipWin.prototype,"OpenSerVipWin"),window.OpenSerVipWin=OpenSerVipWin,ViewManager.ins().reg(OpenSerVipWin,LayerManager.UI_Main);var Vip3Win=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="Vip3Skin",this.artifactEff=new MovieClip,this.artifactEff.x=233,this.artifactEff.y=335;var e=.178,i=.556*this.height;this.qualityEff1=new MovieClip,this.qualityEff1.x=this.width*e,this.qualityEff1.y=i,this.qualityEff2=new MovieClip,this.qualityEff2.x=.5*this.width,this.qualityEff2.y=i,this.qualityEff3=new MovieClip,this.qualityEff3.x=this.width*(1-e),this.qualityEff3.y=i,this.closeBtn1Eff=new MovieClip,this.closeBtn1Eff.x=this.closeBtn1.x+this.closeBtn1.width/2-2,this.closeBtn1Eff.y=this.closeBtn1.y+this.closeBtn1.height/2+2,this.closeBtn1Eff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.qualityEff1.playFile(RES_DIR_EFF+"ValueEff5",-1),this.addChild(this.qualityEff1),this.qualityEff2.playFile(RES_DIR_EFF+"ValueEff5",-1),this.addChild(this.qualityEff2),this.qualityEff3.playFile(RES_DIR_EFF+"ValueEff5",-1),this.addChild(this.qualityEff3),this.closeBtn1Eff.playFile(RES_DIR_EFF+"BtnPrompt-cz",-1),this.addChild(this.closeBtn1Eff),Actor.vip<3?this.sureBtn.visible=!1:(this.sureBtn.visible=!0,this.closeBtn1.visible=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.closeBtn1:ViewManager.ins().open(RechargeWin);break;case this.sureBtn:ViewManager.ins().open(VipWin),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(Vip3Win.prototype,"Vip3Win"),window.Vip3Win=Vip3Win,ViewManager.ins().reg(Vip3Win,LayerManager.UI_Main);var VipCT=function(t){function e(){var e=t.call(this)||this;return e.weekState=0,e.vipGiftState=[],e.vipCashGiftState=0,e.sysId=PackageID.Vip,e.regNetMsg(1,e.postUpdateVipData),e.regNetMsg(2,e.postUpdataExp),e.regNetMsg(3,e.postUpdateVipAwards),e.regNetMsg(4,e.postUpdateWeekAwards),e.regNetMsg(5,e.postVipGiftBuy),e.regNetMsg(6,e.postSuperVipInfo),e.regNetMsg(7,e.postOpenServerVip),e.regNetMsg(8,e.postCashGiftData),e}return __extends(e,t),e.prototype.initLogin=function(){this.initVipCfg()},e.prototype.initVipCfg=function(){this.vipcfgs=[];var t=urlParam.appid,e=GlobalConfig.VipConfig;for(var i in e)if(e[i].appid)for(var s in e[i].appid)e[i].appid[s]+""==t&&(this.vipcfgs[e[i].level]=e[i]);if(0==this.vipcfgs.length)for(var i in e)e[i].appid||(this.vipcfgs[e[i].level]=e[i]);this.vipMaxLevel=this.vipcfgs.length-1},e.ins=function(){return t.ins.call(this)},e.prototype.getVipCfg=function(t){return this.vipcfgs[t]},e.prototype.vipIsMax=function(t){return t>=this.vipMaxLevel},e.prototype.postSuperVipData=function(t){return t},e.prototype.sendGetAwards=function(t){var e=this.getBytes(1);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetWeekAwards=function(){this.sendBaseProto(4)},e.prototype.sendGetVipGift=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.sendGetSuperVipInfo=function(){this.sendBaseProto(6)},e.prototype.postUpdateVipData=function(t){Actor.vip=t.readShort(),this.exp=t.readInt(),this.state=t.readInt(),this.weekState=t.readShort();var e=t.readShort();this.vipGiftState=[];for(var i=0;e>i;i++){var s=t.readUnsignedInt(),n=t.readByte(),o={id:s,state:n};this.vipGiftState.push(o)}},e.prototype.postUpdataExp=function(t){var e=t.readShort();this.exp=t.readInt(),this.weekState=t.readShort(),e>Actor.vip&&(Actor.vip=e)},e.prototype.postUpdateVipAwards=function(t){this.state=t.readInt()},e.prototype.postUpdateWeekAwards=function(t){var e=t.readBoolean();e&&(this.weekState=0)},e.prototype.postVipGiftBuy=function(t){for(var e=t.readShort(),i=0;e>i;i++)for(var s=t.readUnsignedInt(),n=t.readByte(),o=0;o<this.vipGiftState.length;o++)s==this.vipGiftState[o].id&&(this.vipGiftState[o].state=n)},e.prototype.postSuperVipInfo=function(t){this.superVip=this.superVip||[];for(var e=2,i=0;e>i;i++)this.superVip[i]=Math.floor(t.readInt()/100)},e.prototype.sendOpenServerVip=function(){this.sendBaseProto(7)},e.prototype.postOpenServerVip=function(t){this.openVip={isAct:1==t.readByte(),day:t.readUnsignedShort(),status:t.readByte()}},e.prototype.postCashGiftData=function(t){this.vipCashGiftState=t.readInt()},e.prototype.getOpenSerVipStatus=function(){var t=e.ins().openVip,i=GlobalConfig.VipOpenServerConfig;return t?1==t.status?2:t.isAct&&t.day>=i.days&&Actor.vip>=i.vipLevel&&SubRoles.ins().subRolesLen>=i.roleCount?1:0:0},e.prototype.getSuperVipState=function(){if(this.superVip)for(var t in GlobalConfig.SuperVipConfig){var e=GlobalConfig.SuperVipConfig[t],i=+t-1;if(e.money<=(this.superVip[i]||0))return!0}return!1},e.prototype.getVipState=function(){for(var t=!1,e=0;e<Actor.vip;e++)if(void 0!=this.state&&0==(this.state>>e&1))return t=!0;return t&&OpenSystem.ins().checkSysOpen(SystemType.VIP_ENTRY)&&!LocationProperty.isIosTS},e.prototype.getVipGiftCanBuy=function(t){var e=GlobalConfig.VipGiftConfig[t];return Actor.vip>=e.vipLv},e.prototype.getVipGiftIsBuy=function(t){return 1==(1&this.vipGiftState[t-1].state)},e.prototype.getVipCashGiftIsBuy=function(t){return 0!=(this.vipCashGiftState>>t&1)},e.prototype.getVipGiftRedPoint=function(t){var e=GlobalConfig.VipGiftConfig[t];return Actor.vip>=e.vipLv?this.getVipGiftCanBuy(t)&&!this.getVipGiftIsBuy(t)&&e.needYb<=Actor.yb:!1},e.prototype.getVipCashGiftRedPoint=function(t){var e=GlobalConfig.VipGiftConfig[t];return Actor.vip>=e.vipLv?this.getVipGiftCanBuy(t)&&!this.getVipCashGiftIsBuy(t):!1},e.prototype.getVipIndex=function(t){for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e].hfTimes;if(i=i?i:0,i==t)return GlobalConfig.VipGiftConfig[e]}return null},e.prototype.checkVipSuccess=function(t){var i=!0;for(var s in GlobalConfig.VipGiftConfig){var n=GlobalConfig.VipGiftConfig[s].hfTimes;if(n=n?n:0,n==t){var o=GlobalConfig.VipGiftConfig[s].id;if(!this.getVipGiftIsBuy(o)||!e.ins().getVipCashGiftIsBuy(o)){i=!1;break}}}return i},e.prototype.getVipPage=function(){var t=[];for(var e in GlobalConfig.VipGiftConfig){var i=GlobalConfig.VipGiftConfig[e].hfTimes;i=i?i:0,GameServer._hefuCount>=i&&-1==t.indexOf(i)&&t.push(i)}return t},e.getVipStr=function(t,e){return void 0===t&&(t=Actor.vip),void 0===e&&(e=!1),(t>=11?"SVIP":"VIP")+(e?t>10?t-10:t:"")},e.getVipNum=function(t){return void 0===t&&(t=Actor.vip),t>10?t-10:t},e.isSVIP=function(t){return void 0===t&&(t=Actor.vip),t>10},__decorate([post()],e.prototype,"postSuperVipData",null),__decorate([post()],e.prototype,"postUpdateVipData",null),__decorate([post()],e.prototype,"postUpdataExp",null),__decorate([post()],e.prototype,"postUpdateVipAwards",null),__decorate([post()],e.prototype,"postUpdateWeekAwards",null),__decorate([post()],e.prototype,"postVipGiftBuy",null),__decorate([post()],e.prototype,"postSuperVipInfo",null),__decorate([post()],e.prototype,"postOpenServerVip",null),__decorate([post()],e.prototype,"postCashGiftData",null),e}(BaseSystem);__reflect(VipCT.prototype,"VipCT"),System.VipCT=function(){return VipCT.ins()},window.VipCT=VipCT;var VipWin=function(t){function e(){var e=t.call(this)||this;e.barbc=new ProgressBarEff,e._curLv=0,e._sn_="VipSkin",e.isTopLevel=!0,e.VipConfig=[];var i=urlParam.appid,s=GlobalConfig.VipConfig;for(var n in s)for(var o in s[n].appid)s[n].appid&&s[n].appid[o]+""==i&&(e.VipConfig[s[n].level]=s[n]);if(0==e.VipConfig.length)for(var n in s)s[n].appid||(e.VipConfig[s[n].level]=s[n]);return e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS||LocationProperty.isTSServer?!1:!0},e.prototype.skinComplete=function(){this.tequan.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.tequan.text+"</u>"),this.barbc.setMcRes("ProgressEff6","ProgressEff7"),this.barbc.setWidth(252),this.barbc.x=-10,this.barbc.y=-20,this.barbc.bgimg.visible=!1,this.barGroup.addChildAt(this.barbc,0),this.list.itemRenderer=ItemBase,this.addTouchEvent(this,this.onTap),this.mc2=new MovieClip,this.mc2.playFile(RES_DIR_EFF+"vipeff1",-1),this.eff1.addChild(this.mc2)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.observe(VipCT.ins().postUpdataExp,this.changeExpBar),this.observe(VipCT.ins().postUpdateVipAwards,this.changeAwards),this.observe(VipCT.ins().postUpdateVipData,this.changeAwards),this.observe(VipCT.ins().postUpdateWeekAwards,this.changeAwards),this.barbc.reset(),this.changeExpBar(),this.changeAwards(),this._curLv=t[0]?t[0]:this.getVipLevel(),this._curLv){var i=this.VipConfig[this._curLv];this.showVipInfo(i)}},e.prototype.getVipLevel=function(){if(Actor.vip)for(var t=0;t<Actor.vip;t++)if(!(VipCT.ins().state>>t&1))return t+1;var e=this.VipConfig.length-1;return Actor.vip>=e-1?e:Actor.vip+1},e.prototype.onTap=function(t){var i;switch(t.target){case this.tequan:ViewManager.ins().open(ViptipsWin,this.VipConfig[this._curLv].description);break;case this.closeBtn:ViewManager.ins().close(e);break;case this.topUpBtn:ViewManager.ins().close(e);var s=Recharge.ins().getRechargeData(0);s&&0!=s.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win);break;case this.leftBtn:i=this.VipConfig[--this._curLv],this.showVipInfo(i);break;case this.rightBtn:i=this.VipConfig[++this._curLv],this.showVipInfo(i);break;case this.suerBtn:if(i=this.VipConfig[this._curLv],Actor.vip<i.level){ViewManager.ins().close(e);var n=Recharge.ins().getRechargeData(0);n&&0!=n.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}else{for(var o=0,a=i.awards,r=a.length,l=0;r>l;l++)1==a[l].type&&a[l].id<2e5&&o++;BagCT.ins().getSurplusCount()>=o?VipCT.ins().sendGetAwards(this._curLv):TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|")}}},e.prototype.showVipInfo=function(t){t?this.setAwards(t):this._curLv=Actor.vip,this.changeBtn()},e.prototype.changeExpBar=function(){var t=Actor.vip,e=VipCT.ins(),i=this.VipConfig[t],s=0,n=e.exp;i&&(s=t);var o=this.VipConfig[s+1],a=0,r="";o?(this.vipValue0.text=VipCT.getVipNum(s)+"",this.vipValue1.text=VipCT.getVipNum(s+1)+"",a=o.needYb-n,r="再充值|C:0xFFAA24&T:"+a+("元宝|成为"+VipCT.getVipStr(t+1,!0)),this.barbc.setData(n,o.needYb)):(this.vipValue1.text=this.vipValue0.text=VipCT.getVipNum(s)+"",r=VipCT.getVipStr()+"等级已满",this.barbc.setData(Math.min(n,i.needYb),i.needYb),this.barbc.setLbValueText(n+"/"+i.needYb)),this.titleLabel.textFlow=TextFlowMaker.generateTextFlow(r);var l=VipCT.isSVIP(s);this.eLeft.source=l?"sviptxt_png":"viptxt_png",this.eRight.source=VipCT.isSVIP(o?s+1:s)?"sviptxt_png":"viptxt_png",this.eIcon.source=l?"sviphuizhang":"viphuizhang",i=this.VipConfig[this._curLv],this.showVipInfo(i)},e.prototype.changeAwards=function(){var t;if(this._curLv=Actor.vip,this._curLv>=0){for(var e=0;e<this._curLv;e++)if(!this.getRemindByIndex(e)||this.checkWeekReward(e))return t=this.VipConfig[e+1],this._curLv=e+1,this.setAwards(t||this.VipConfig[--this._curLv]),void this.changeBtn();t=this.VipConfig[++this._curLv],this.setAwards(t||this.VipConfig[--this._curLv]),this.changeBtn()}},e.prototype.setAwards=function(t){this.list.dataProvider=new eui.ArrayCollection(t.awards),this.vipImg.source=t.vipImg,this.vipLabImg.source="lab"+t.vipImg,this.vipValue.text=VipCT.getVipNum()+"",this.viprect.text=this._curLv+"",this.viplevel.text=VipCT.getVipNum(this._curLv)+"",this.eVipTips.source=VipCT.isSVIP(this._curLv)?"biaoti_svip_png":"biaoti_vip_png",this.suerBtn.enabled=!1,this.mc&&DisplayUtils.removeFromParent(this.mc),this.getRemindByIndex(t.level-1)?(this.suerBtn.enabled=!1,this.suerBtn.label="已领取"):Actor.vip>=t.level?(this.suerBtn.enabled=!0,this.suerBtn.label="领取",this.mc=this.mc||new MovieClip,this.mc.x=75,this.mc.y=27,this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.suerBtn.addChild(this.mc)):(this.suerBtn.enabled=!0,this.suerBtn.label="充值")},e.prototype.getRemindByIndex=function(t){var e=VipCT.ins(),i=e.state;return Actor.vip<=0?!1:1==(i>>t&1)},e.prototype.checkWeekReward=function(t){return Actor.vip<=0?!1:t+1==Actor.vip&&1==VipCT.ins().weekState},e.prototype.changeBtn=function(){this._curLv>1?(this.leftBtn.visible=!0,this.rightBtn.visible=!0,this._curLv>=CommonUtils.getObjectLength(this.VipConfig)&&(this.rightBtn.visible=!1)):this._curLv<=1&&(this.leftBtn.visible=!1,this.rightBtn.visible=!0)},e}(BaseEuiView);__reflect(VipWin.prototype,"VipWin"),window.VipWin=VipWin,ViewManager.ins().reg(VipWin,LayerManager.UI_Main);var SuperVipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="gsvipSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.copy,this.onTap)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.copy:this.copyQQ()}},e.prototype.copyQQ=function(){window.platform.setClipboardData(this.qqtxt.text,function(){TipsCT.ins().showCenterTips("QQ号复制成功")})},e.openCheck=function(){return OpenSystem.ins().checkSysOpen(SystemType.SUPERVIP)},e}(BaseEuiView);__reflect(SuperVipWin.prototype,"SuperVipWin"),window.SuperVipWin=SuperVipWin,ViewManager.ins().reg(SuperVipWin,LayerManager.UI_Popup);var Vip3MWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="Vip3Skin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.pay,this.onTouchBtn),this.addTouchEvent(this.closeBtn,this.onTouchBtn),this.addTouchEvent(this.closeBtn0,this.onTouchBtn);var i=t[0];this.init(i),urlParam.showDiamond&&(this.chargeValue.text="1000钻石")},e.prototype.init=function(t){for(var e=VipCT.ins().getVipCfg(t),i=0;3>i;i++){this["gift"+i].data=e.awards[i+1].id;var s=this.getPower(e.awards[i+1].id,i);this["power"+i].setPower(s)}this.pay.label=Actor.vip<3?"充值":"领取",this.setIconEff()},e.prototype.setIconEff=function(){this.mc||(this.mc=new MovieClip),this.mc.parent||this.mcGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"tjiemb",-1);var t=0,e=GlobalConfig.ExRing0Config[1];t=BagCT.getAttrPower(e.attrAward),t+=e.power,this.powerPanel.setPower(t)},e.prototype.getPower=function(t,e){var i=0,s=GlobalConfig.EquipConfig[t];if(!s)return i;var n=["hp","atk","def","res"],o=[],a=0;t:for(var r in s)for(var l in n)if(n[l]==r&&s[r]){var h=s[r];if(void 0==h||0==h)continue;var p=Role.getAttrTypeByName(r),u=new AttributeData,d="";if(d+=AttributeData.getAttrStrByType(p)+":",d+=s[r],u.type=p,u.value=s[r],o.push(u),a?1==a&&(this["att"+e].text=d):this["at"+e].text=d,a++,a>1)break t}return i=Math.floor(BagCT.getAttrPower(o))},e.prototype.onTouchBtn=function(t){switch(t.target){case this.pay:this.onBtn();break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onBtn=function(){if(Actor.vip<3){var t=Recharge.ins().getRechargeData(0);return t&&0!=t.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win),void ViewManager.ins().close(this)}ViewManager.ins().open(VipWin,3),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(Vip3MWin.prototype,"Vip3MWin"),window.Vip3MWin=Vip3MWin,ViewManager.ins().reg(Vip3MWin,LayerManager.UI_Popup);var VipGiftBtnRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipGiftBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.source=t.img,this.viptxt.text="v"+t.vipLv;var e=VipCT.ins().getVipGiftRedPoint(t.id)||VipCT.ins().getVipCashGiftRedPoint(t.id);e?(this.mc||(this.mc=new MovieClip,this.mc.x=39,this.mc.y=39),this.mc.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.addChild(this.mc)):(DisplayUtils.removeFromParent(this.mc),this.mc=null),this.redPoint.visible=e},e}(BaseItemRender);__reflect(VipGiftBtnRender.prototype,"VipGiftBtnRender"),window.VipGiftBtnRender=VipGiftBtnRender;var VipGiftItemView=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipGiftItem2Skin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.eList0.itemRenderer=ItemBase,this.eList1.itemRenderer=ItemBase
},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curId=t[0]||1,this.updateData(),this.close(),this.addTouchEvent(this,this.onClick),this.observe(VipCT.ins().postVipGiftBuy,this.updateData)},e.prototype.close=function(){},e.prototype.onClick=function(t){var e=GlobalConfig.VipGiftConfig[this.curId];switch(t.target){case this.eGetBtn0:if(Actor.vip<e.vipLv)return void TipsCT.ins().showTips(VipCT.getVipStr(e.vipLv)+"等级不足");if(Actor.yb<e.needYb)return void TipsCT.ins().showTips("元宝不足");if(BagCT.ins().getSurplusCount()<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请先清理背包|");VipCT.ins().sendGetVipGift(this.curId);break;case this.eGetBtn1:if(Actor.vip<e.vipLv)return void TipsCT.ins().showTips(VipCT.getVipStr(e.vipLv)+"等级不足");if(BagCT.ins().getSurplusCount()<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请先清理背包|");var i=e.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(e.money,ShowRechargeType.Type_Vipgift,this.curId+""):Recharge.ins().sendPayOrder(i)}},e.prototype.updateData=function(){var t=GlobalConfig.VipGiftConfig[this.curId];this.eList0.dataProvider=new eui.ArrayCollection(t.awards),this.eList1.dataProvider=new eui.ArrayCollection(t.rewards),this.ggtxt.source=t.adImg,this.eName0.source=t.nameImg[0],this.tu0.source=t.bgImg[0],this.eName1.source=t.nameImg[1],this.tu1.source=t.bgImg[1],this.eGetBtn0.visible=VipCT.ins().getVipGiftCanBuy(this.curId)&&!VipCT.ins().getVipGiftIsBuy(this.curId),this.eGetBtn0.label=t.needYb+"元宝",this.eGetBtn1.visible=VipCT.ins().getVipGiftCanBuy(this.curId)&&!VipCT.ins().getVipCashGiftIsBuy(this.curId),this.eGetBtn1.label=t.money/GlobalConfig.ClientGlobalConfig.rate+"¥",this.eRp0.visible=VipCT.ins().getVipGiftRedPoint(this.curId),this.eRp1.visible=VipCT.ins().getVipCashGiftRedPoint(this.curId),this.already0.visible=VipCT.ins().getVipGiftIsBuy(this.curId),this.already1.visible=VipCT.ins().getVipCashGiftIsBuy(this.curId),this.already1.visible&&(Actor.vip>t.vipLv?this.already1.text="已购买":this.already1.text=this.getVipTips(t.vipLv+1)),this.sBack0=t.backTips?t.backTips[0]:"",this.sBack1=t.backTips?t.backTips[1]:"",this.eTipsIcon0.visible=""!=this.sBack0,this.eTipsIcon1.visible=""!=this.sBack1},e.prototype.getVipTips=function(t){var e=urlParam.appid,i=GlobalConfig.VipConfig,s=[];for(var n in i)for(var o in i[n].appid)i[n].appid&&i[n].appid[o]+""==e&&(s[i[n].level]=i[n]);if(0==s.length)for(var n in i)i[n].appid||(s[i[n].level]=i[n]);return s[t]?"在充值"+(s[t].needYb-VipCT.ins().exp)/GlobalConfig.ClientGlobalConfig.rate+"元即可达到VIP"+t+"级":""},e}(BaseView);__reflect(VipGiftItemView.prototype,"VipGiftItemView"),window.VipGiftItemView=VipGiftItemView;var VipGiftPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var s=t.call(this)||this;return s.curIndex=e[0]?e[0]:0,s.skinName="VipGift"+s.curIndex+"Skin",s}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curIndex=t[0]?t[0]:0,this.tabIndex=t[1]?t[1]:0,this.menuList.itemRenderer=VipGiftBtnRender,this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.menuList,this.onTouchMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.observe(VipCT.ins().postVipGiftBuy,this.onUpdate),this.observe(VipCT.ins().postCashGiftData,this.onUpdate),this.roleSelect.hideRole(),this.updateMenu(),this.setDefault()},e.prototype.onTouchMenu=function(t){SoundUtil.play(SoundEnum.WINDOW),this.setGiftId(t.item.id)},e.prototype.onChange=function(){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.menuList.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.updateMenu=function(){var t=GlobalConfig.VipGiftConfig,e=[];for(var i in t){var s=t[i].hfTimes?t[i].hfTimes:0;this.curIndex==s&&e.push(t[i])}e.sort(function(t,e){return t.id<e.id?-1:1}),this.menuList.dataProvider=new eui.ArrayCollection(e),this.menuList.validateNow()},e.prototype.setDefault=function(){var t=this,e=this.tabIndex||0,i=Object.keys(GlobalConfig.VipGiftConfig).length;for(var s in GlobalConfig.VipGiftConfig){var n=GlobalConfig.VipGiftConfig[s].hfTimes;n=n?n:0,n==this.curIndex&&(e||(e=GlobalConfig.VipGiftConfig[s].id),i=+s)}for(var o=VipCT.ins().vipGiftState,a=i,r=e?e:1;i>=r;r++)if(0==(1&o[r-1].state)||!VipCT.ins().getVipCashGiftIsBuy(r)){a=r;break}this.setGiftId(a),e=e?e:1;var l=a-e;this.menuList.selectedIndex=l,egret.callLater(function(){var e=92*l;e>t.menuList.contentWidth-t.menuScroller.width&&(e=t.menuList.contentWidth-t.menuScroller.width),t.menuList.scrollH=e,t.onChange()},this)},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.onUpdate=function(){for(var t=this.menuList.dataProvider,e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e));var i=this.vipGiftItem.curId;VipCT.ins().getVipGiftIsBuy(i)==VipCT.ins().getVipCashGiftIsBuy(i)?this.setDefault():this.setGiftId(i)},e.prototype.setGiftId=function(t){this.vipGiftItem.open(t)},e.prototype.close=function(){this.vipGiftItem.close(),this.menuList.dataProvider=new eui.ArrayCollection},e}(BaseView);__reflect(VipGiftPanel.prototype,"VipGiftPanel"),window.VipGiftPanel=VipGiftPanel;var VipGiftWin=function(t){function e(){var e=t.call(this)||this;return e.VipPanelList=[],e.isTopLevel=!0,e._sn_="VipGiftMainSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!LocationProperty.isIosTS},e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addTouchEvent(this.closeBtn,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(VipCT.ins().postVipGiftBuy,this.updateRedPoint),this.curIndex=t[0]?t[0]:0,this.tabIndex=t[1]?t[1]:0,this.checkIndex(),this.create(),this.updateView()},e.prototype.checkIndex=function(){var t=VipCT.ins().getVipPage();if(VipCT.ins().checkVipSuccess(t[this.curIndex]))for(var e=0;e<t.length;e++)if(this.curIndex!=e){var i=t[e];if(!VipCT.ins().checkVipSuccess(i)){this.curIndex=e;break}}},e.prototype.updateView=function(){this.VipPanelList[this.curIndex].open(this.curIndex,this.tabIndex),this.tab.selectedIndex=this.viewStack.selectedIndex=this.curIndex,this.updateRedPoint();for(var t=VipCT.ins().getVipPage(),e=0;e<t.length;e++){var i=t[e],s=VipCT.ins().checkVipSuccess(i);s&&(DisplayUtils.removeFromParent(this.VipPanelList[e]),DisplayUtils.removeFromParent(this["redPoint"+e]))}},e.prototype.updateRedPoint=function(){for(var t=VipCT.ins().getVipPage(),e=0;e<t.length;e++){var i=t[e];this["redPoint"+e].visible=!1;for(var s in GlobalConfig.VipGiftConfig){var n=GlobalConfig.VipGiftConfig[s].hfTimes?GlobalConfig.VipGiftConfig[s].hfTimes:0;if(i==n&&(this["redPoint"+e].visible=VipCT.ins().getVipGiftRedPoint(GlobalConfig.VipGiftConfig[s].id)||VipCT.ins().getVipCashGiftRedPoint(GlobalConfig.VipGiftConfig[s].id),this["redPoint"+e].visible))break}}},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){this.VipPanelList[t].open(this.hfcount[t])},e.prototype.checkIsOpen=function(t){return t>GameServer._hefuCount?(TipsCT.ins().showTips("本服未到"+t+"次合服"),!1):!0},e.prototype.create=function(){this.viewStack.removeChildren(),this.redPointGroup.removeChildren(),this.hfcount=VipCT.ins().getVipPage();for(var t=0;t<this.hfcount.length;t++){var e=new VipGiftPanel(this.hfcount[t]);if(e){e.top=0,e.left=0,e.bottom=0,e.right=0;var i=VipCT.ins().getVipIndex(this.hfcount[t]);i&&(e.name=i.pageName?i.pageName:""),this.VipPanelList[t]=e,this.viewStack.addChild(this.VipPanelList[t]),this.redPointGroup.addChild(this["redPoint"+t]),this["redPoint"+t].visible=!1}}},e}(BaseEuiView);__reflect(VipGiftWin.prototype,"VipGiftWin"),ViewManager.ins().reg(VipGiftWin,LayerManager.UI_Main),window.VipGiftWin=VipGiftWin;var ViptipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ViptipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.depictLabel.textFlow=TextFlowMaker.generateTextFlow(t[0])},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ViptipsWin.prototype,"ViptipsWin"),window.ViptipsWin=ViptipsWin,ViewManager.ins().reg(ViptipsWin,LayerManager.UI_Popup);var VipBossTabItemRender=function(t){function e(){var e=t.call(this)||this;return e.isStartTime=!1,e.skinName="BtnTab14Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.VipBossConfig[t.id];this.eFace.source=e.icon;var i=GlobalConfig.WorldBossConfig[e.boss];this.eName.text=GlobalConfig.MonstersConfig[i.bossId].name+(i.zsLevel>0?"·"+i.zsLevel+"转":""),this.eName.textColor=Actor.vip>=i.belongRewardVipLimit?ColorUtil.GREEN:ColorUtil.RED,this.eVipValue.text=i.belongRewardVipLimit+"";var s=2==t.bossState&&t.isDie;this.eKillImg.visible=s,s&&(this.updateTime(),this.isStartTime||(Timer.start(100,0,this.updateTime,this),this.isStartTime=!0)),this.eName.visible=!s,this.eTime.visible=s}},e.prototype.updateTime=function(){var t=this.data,e=t.relieveTime-egret.getTimer();this.eTime.text=DateUtils.getFormatBySecond(Math.floor(e/1e3),1)+"后重生",0>=e&&(this.eTime.visible=!1,BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_QMBOSS),Timer.stop(this.updateTime,this),this.isStartTime=!1)},e}(BaseItemRender);__reflect(VipBossTabItemRender.prototype,"VipBossTabItemRender"),window.VipBossTabItemRender=VipBossTabItemRender;var VipBossWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="VipBossPanelSkin3",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossGroup.addChild(this.bossImage),this.tabListDP=new eui.ArrayCollection,this.eTabList.itemRenderer=VipBossTabItemRender,this.eTabList.dataProvider=this.tabListDP,this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=ItemBase,this.eList.dataProvider=this.listDP,this.updateTab(),this.addTouchEvent(this,this.onClick),this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange),this.eTabList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BossCT.ins().postWorldBoss,this.updateTab);var i=GlobalConfig.VipBossConfig;for(var s in i){var n=i[s];this.eTabList.selectedIndex=n.id-1,this.updateView(n);break}},e.prototype.removeDisplay=function(){this.eTabList&&this.eTabList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this)},e.prototype.onClick=function(t){var e=0;switch(t.target){case this.challengeBtn:var i=this.eTabList.selectedItem,s=GlobalConfig.WorldBossConfig[i.id];BossCT.ins().sendChallengWorldBoss(i.id,s.type);break;case this.setting:ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_VIPBOSS);break;case this.leftBtn0:e=this.eTabList.scrollH-408,e=102*Math.round(e/102),0>e&&(e=0),this.eTabList.scrollH=e,this.onChange();break;case this.rightBtn0:e=this.eTabList.scrollH+408,e=102*Math.round(e/102),e>this.eTabList.contentWidth-this.listScroller.width&&(e=this.eTabList.contentWidth-this.listScroller.width),this.eTabList.scrollH=e,this.onChange()}},e.prototype.onClickMenu=function(t){var e=this.eTabList.dataProvider.getItemAt(t.itemIndex);this.updateView(GlobalConfig.VipBossConfig[e.id])},e.prototype.updateView=function(t){var e=GlobalConfig.WorldBossConfig[t.boss],i=GlobalConfig.MonstersConfig[e.bossId];this.bossImage.playFile(RES_DIR_MONSTER+(i.avatar+"_3s"),-1),this.listDP.source=e.showReward,this.challengeNum.text=BossCT.ins().worldBossBelongTime[BossCT.BOSS_SUBTYPE_VIPBOSS]+"";var s,n=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_VIPBOSS];for(var o in n)n[o].id==t.boss&&(s=parseInt(o));var a=n[s];a&&(this.challengeBtn.enabled=!(2==a.bossState&&a.isDie))},e.prototype.updateTab=function(){var t=[];BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_VIPBOSS]&&(t=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_VIPBOSS].slice()),t.sort(this.sort),this.tabListDP.source=t},e.prototype.sort=function(t,e){var i=GlobalConfig.VipBossConfig[t.id],s=GlobalConfig.VipBossConfig[e.id];return i.id<s.id?-1:i.id>s.id?1:0},e.prototype.onChange=function(){this.leftBtn0.visible=!1,this.rightBtn0.visible=!1,this.eTabList.scrollH<51?(this.leftBtn0.visible=!1,this.rightBtn0.visible=!0):this.eTabList.scrollH>=this.eTabList.contentWidth-this.eTabList.width-51?(this.leftBtn0.visible=!0,this.rightBtn0.visible=!1):(this.leftBtn0.visible=!0,this.rightBtn0.visible=!0),this.rightRed0.visible=this.rightBtn0.visible,this.leftRed0.visible=this.leftBtn0.visible},e}(BaseEuiView);__reflect(VipBossWin.prototype,"VipBossWin"),ViewManager.ins().reg(VipBossWin,LayerManager.UI_Main),window.VipBossWin=VipBossWin;var WarOrderCT=function(t){function e(){var e=t.call(this)||this;return e.hasLegendOrd=!1,e.hasConvertNums=[],e.taskInfos=[],e.attainment=[],e.sysId=PackageID.WarOrder,e.regNetMsg(1,e.postAllRewardInfo),e.regNetMsg(2,e.postBuyInfo),e.regNetMsg(3,e.postTaskExp),e.regNetMsg(5,e.postConvertInfo),e.regNetMsg(6,e.postTaskInfo),e.regNetMsg(7,e.postRewardInfo),e.regNetMsg(8,e.postInfo),e.regNetMsg(9,e.postAction),e.regNetMsg(10,e.postInitAttainment),e.regNetMsg(11,e.postAttainment),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendAllReward=function(){this.sendBaseProto(1)},e.prototype.postAllRewardInfo=function(t){var i=GlobalConfig.LegendaryMakeRewardConfig[e.ins().season],s=t.readShort(),n=this.LegendRewardState,o=this.rewardState;this.LegendRewardState=[],this.rewardState=[];for(var a=[],r=0;s>r;r++){var l=t.readShort();this.LegendRewardState[l]=1==t.readByte(),this.rewardState[l]=1==t.readByte(),o&&o.length>0&&(this.LegendRewardState[l]&&!n[l]&&(a=a.concat(i[l].payreward)),this.rewardState[l]&&!o[l]&&(a=a.concat(i[l].averagereward)))}a.length>0&&ViewManager.ins().open(WarOrderGetRewardWin,a)},e.prototype.sendBuy=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.postBuyInfo=function(t){this.lv=t.readUnsignedInt()},e.prototype.sendGetTaskExp=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.postTaskExp=function(t){this.exp=t.readInt(),this.legendExp=t.readInt(),this.lv=t.readInt();var e=t.readInt();this.taskInfos[e]&&(this.taskInfos[e].hasGet=!0)},e.prototype.sendCheckTaskExp=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.postConvertInfo=function(t){this.hasConvertNums=[];for(var e=t.readShort(),i=0;e>i;i++)this.hasConvertNums[t.readInt()]=t.readInt()},e.prototype.sendConvertInfo=function(){this.sendBaseProto(5)},e.prototype.sendTaskInfo=function(){this.sendBaseProto(6)},e.prototype.postTaskInfo=function(t){var e=t.readShort();this.taskInfos=[];for(var i=0;e>i;i++){var s=i+1;this.taskInfos[s]={id:s,hasGet:1==t.readByte(),progress:t.readInt()}}},e.prototype.sendReward=function(t){var e=this.getBytes(7);e.writeByte(t),this.sendToServer(e)},e.prototype.postRewardInfo=function(t){var e=1==t.readByte(),i=1==t.readByte(),s=t.readShort();this.LegendRewardState[s]=e,this.rewardState[s]=i},e.prototype.sendChange=function(t){var e=this.getBytes(8);e.writeShort(t),this.sendToServer(e)},e.prototype.postInfo=function(t){this.lv=t.readInt(),this.season=t.readInt(),this.hasLegendOrd=1==t.readByte(),this.legendExp=t.readInt(),this.exp=t.readInt(),this.overTime=DateUtils.formatMiniDateTime(t.readUnsignedInt()),this.postAllRewardInfo(t),this.checkOpen()&&(e.ins().sendTaskInfo(),e.ins().sendConvertInfo())},e.prototype.postAction=function(t){this.hasLegendOrd=1==t.readByte()},e.prototype.postInitAttainment=function(t){if(this.round=t.readByte(),0!=this.round){var e=t.readByte();this.attainment=[];for(var i=0;e>i;i++){var s=t.readString();this.attainment[s]={level:t.readInt(),state:t.readByte()}}}},e.prototype.sendAward=function(t){var e=this.getBytes(11);e.writeString(t),this.sendToServer(e)},e.prototype.postAttainment=function(t){if(this.round=t.readByte(),0!=this.round){var e=t.readString();this.attainment[e]={level:t.readInt(),state:t.readByte()}}},e.prototype.postOpenTab=function(t){return t},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e="";return(!this.overTime||this.overTime<GameServer.serverTime)&&(e="未开启"),t&&""!=e&&TipsCT.ins().showTips(e),""==e},e.prototype.getRewardStateById=function(t){return this.rewardState[t]||!1},e.prototype.getLegendRewardState=function(t){return this.LegendRewardState[t]||!1},e.prototype.hasCanGetReward=function(){for(var t=1;t<=this.lv;t++)if(!this.getRewardStateById(t)||this.hasLegendOrd&&!this.getLegendRewardState(t))return!0;return!1},e.prototype.getTaskRewardStateById=function(t){var e=this.taskInfos[t],i=GlobalConfig.LegendaryMakeTaskConfig[this.season][t];return e&&e.hasGet?2:e&&i&&e.progress>=i.target?1:0},__decorate([post()],e.prototype,"postAllRewardInfo",null),__decorate([post()],e.prototype,"postBuyInfo",null),__decorate([post()],e.prototype,"postTaskExp",null),__decorate([post()],e.prototype,"postConvertInfo",null),__decorate([post()],e.prototype,"postTaskInfo",null),__decorate([post()],e.prototype,"postRewardInfo",null),__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postAction",null),__decorate([post()],e.prototype,"postInitAttainment",null),__decorate([post()],e.prototype,"postAttainment",null),__decorate([post()],e.prototype,"postOpenTab",null),e}(BaseSystem);__reflect(WarOrderCT.prototype,"WarOrderCT");var WarOrderTabId;!function(t){t[t.Task=1]="Task",t[t.Reward=2]="Reward",t[t.convert=3]="convert"}(WarOrderTabId||(WarOrderTabId={})),window.WarOrderTabId=WarOrderTabId,System.WarOrderCT=function(){return WarOrderCT.ins()},window.WarOrderCT=WarOrderCT;var WarOrderRedPoint=function(t){function e(){var e=t.call(this)||this;return e.changePoints=[],e.associated(e.postRedPoint,WarOrderCT.ins().postAllRewardInfo,WarOrderCT.ins().postRewardInfo,WarOrderCT.ins().postAction,WarOrderCT.ins().postTaskInfo,WarOrderCT.ins().postTaskExp,WarOrderCT.ins().postInfo,WarOrderCT.ins().postBuyInfo,WarOrderCT.ins().postInitAttainment,WarOrderCT.ins().postAttainment,WarOrderCT.ins().postConvertInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.postRewardPoint(),this.postTaskPoints(),this.postChangePoints(),this.redPoint=this.rewardPoint||this.taskPoint,t!=this.redPoint},e.prototype.postRewardPoint=function(){this.rewardPoint=WarOrderCT.ins().hasCanGetReward()},e.prototype.postTaskPoints=function(){var t=WarOrderCT.ins(),e=this.taskPoint;this.taskPoint=!1;var i=GlobalConfig.LegendaryMakeTaskConfig;if(WarOrderCT.ins().season)for(var s in i[WarOrderCT.ins().season])if(this.taskPoint=1==t.getTaskRewardStateById(i[WarOrderCT.ins().season][s].id),this.taskPoint)break;if(!this.taskPoint){var n=GlobalConfig.LegendaryMakeBaseConfig.showPos[WarOrderCT.ins().round],o=GlobalConfig.LegendaryMakeAchievementConfig[WarOrderCT.ins().round];if(o)for(var a=Object.keys(o).length,s=1;a>=s;s++){var r=n[s],l=WarOrderCT.ins().attainment[r];if(this.taskPoint=!!(l&&l.state&&o[r]&&o[r][l.level+1]),this.taskPoint)break}}return e!=this.taskPoint},e.prototype.postChangePoints=function(){this.changePoint=!1,this.changePoints=[];var t=GlobalConfig.LegendaryMakeExchangeConfig[WarOrderCT.ins().season];if(t)for(var e in t){var i=t[e],s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.prop.id),n=WarOrderCT.ins().hasConvertNums[i.index]||0,o=i.maxcount;s>=i.prop.count&&(o>0?o>n:!0)?this.changePoint=this.changePoints[i.index]=!0:this.changePoints[i.index]=!1}},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRewardPoint",null),__decorate([post()],e.prototype,"postTaskPoints",null),__decorate([post()],e.prototype,"postChangePoints",null),e}(BaseSystem);__reflect(WarOrderRedPoint.prototype,"WarOrderRedPoint"),System.WarOrderRedPoint=function(){return WarOrderRedPoint.ins()},window.WarOrderRedPoint=WarOrderRedPoint;var WarOrderActionWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenbuySkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick);var t=GlobalConfig.LegendaryMakeBaseConfig.eff;t&&this.eff&&(this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+GlobalConfig.LegendaryMakeBaseConfig.eff,-1),this.eff.addChild(this.mc)),this.eList.itemRenderer=ItemBase;var e=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season],i={};for(var s in e){var n=e[s].payreward;for(var o in n){var a=n[o].id;i[a]?i[a].count+=n[o].count:i[a]=RewardData.objectToRewardData(n[o])}}this.eList.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(i))},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postAction,this.udpateAction),this.sTips=GlobalConfig.LegendaryMakeBaseConfig.openmoney/GlobalConfig.ClientGlobalConfig.rate+"Y"},e.prototype.udpateAction=function(){WarOrderCT.ins().hasLegendOrd&&ViewManager.ins().close(this)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:var e=GlobalConfig.LegendaryMakeBaseConfig.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.LegendaryMakeBaseConfig.openmoney,ShowRechargeType.Type_WarOrder):Recharge.ins().sendPayOrder(e)}},e}(BaseEuiView);__reflect(WarOrderActionWin.prototype,"WarOrderActionWin"),window.WarOrderActionWin=WarOrderActionWin,ViewManager.ins().reg(WarOrderActionWin,LayerManager.UI_Popup);var WarOrderBuyLvWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenbuyLevel",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=ItemBase,this.eList.dataProvider=this.listDP,this.curLv=WarOrderCT.ins().lv,this.eBuyBtn.label=""},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateLv(CommonUtils.getObjectLength(GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season])>this.curLv?1:0)},e.prototype.updateLv=function(t){if(this.addLv!=t){if(this.addLv=t,this.addLv<=0)return this.listDP.source=[],this.countTxt.text="0",this.sTips.text="",void(this.eBuyBtn.enabled=!1);this.countTxt.text=this.addLv+"";for(var e=[],i=0,s=1;s<=this.addLv;s++){var n=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season][this.curLv+s];e=e.concat(n.averagereward),WarOrderCT.ins().hasLegendOrd&&(e=e.concat(n.payreward)),i+=n.needcount}this.sTips.text=this.addLv<=0?"":"传奇战令升至"+(this.curLv+this.addLv)+"级，可立即解锁"+e.length+"件奖励",this.listDP.source=e,this.eBuyBtn.yuanbao.text=i+"",Actor.yb>=i?(this.eBuyBtn.yuanbao.textColor=ColorUtil.GREEN,this.eBuyBtn.enabled=!0):(this.eBuyBtn.yuanbao.textColor=ColorUtil.RED,this.eBuyBtn.enabled=!1)}},e.prototype.onClick=function(t){var e=1;switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBuyBtn:WarOrderCT.ins().sendBuy(this.addLv),ViewManager.ins().close(this);break;case this.eSubBtn10:e=10;case this.eSubBtn:this.updateLv(Math.max(this.addLv-e,0));break;case this.eAddBtn10:e=10;case this.eAddBtn:this.updateLv(Math.min(this.addLv+e,CommonUtils.getObjectLength(GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season])-this.curLv))}},e}(BaseEuiView);__reflect(WarOrderBuyLvWin.prototype,"WarOrderBuyLvWin"),window.WarOrderBuyLvWin=WarOrderBuyLvWin,ViewManager.ins().reg(WarOrderBuyLvWin,LayerManager.UI_Popup);var WarOrderConvertItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="LegenTokenConvertItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.itemIcon.data=t.item;var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.prop.id);this.money.text=""+t.prop.count,this.money.textColor=e>=t.prop.count?ColorUtil.GREEN:ColorUtil.RED,this.buyBtn.enabled=e>=t.prop.count;var i=GlobalConfig.ItemConfig[t.item.id];this.itemName.text=i.name,this.itemName.textColor=ItemUtil.getQualityColor(i);var s=WarOrderCT.ins().hasConvertNums[t.index]||0,n=t.maxcount||0;this.eLab.visible=n>0;var o=s>=n&&n>0?"0xf3311e":"0x9f946d";this.eLab.textFlow=TextFlowMaker.generateTextFlow1("限购：|C:"+o+"&T:"+Math.max(0,n-s)+"|/"+n),this.eRp.visible=WarOrderRedPoint.ins().changePoints[t.index]}},e.prototype.onClick=function(){var t=this.data,e=WarOrderCT.ins().hasConvertNums[t.index]||0;!t.maxcount||e<t.maxcount&&t.maxcount>0?WarOrderCT.ins().sendChange(t.index):TipsCT.ins().showTips("兑换次数不足")},e}(BaseItemRender);__reflect(WarOrderConvertItemRender.prototype,"WarOrderConvertItemRender"),window.WarOrderConvertItemRender=WarOrderConvertItemRender;var WarOrderConvertPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenConvert",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.dataProvider=this.listDP,this.eList.itemRenderer=WarOrderConvertItemRender,this.addTouchEvent(this,this.onClick),WarOrderCT.ins().sendConvertInfo()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemCountChange,this.updateList),this.observe(BagCT.ins().postItemDel,this.updateList),this.observe(BagCT.ins().postItemAdd,this.updateList),this.observe(WarOrderCT.ins().postConvertInfo,this.updateList),this.observe(WarOrderCT.ins().postInfo,this.updateList),this.observe(WarOrderRedPoint.ins().postChangePoints,this.updateList),this.updateList()},e.prototype.removeDisplay=function(){},e.prototype.updateList=function(){this.listDP.replaceAll(CommonUtils.objectToArray(GlobalConfig.LegendaryMakeExchangeConfig[WarOrderCT.ins().season]))},e.prototype.onClick=function(t){return t.target instanceof eui.Button&&t.target.parent instanceof WarOrderConvertItemRender?void t.target.parent.onClick():void 0},__decorate([callLater],e.prototype,"updateList",null),e}(BaseView);__reflect(WarOrderConvertPanel.prototype,"WarOrderConvertPanel"),window.WarOrderConvertPanel=WarOrderConvertPanel;var WarOrderGetRewardWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="CongratulationsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ItemBase},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.eList.dataProvider=new eui.ArrayCollection(t[0])},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WarOrderGetRewardWin.prototype,"WarOrderGetRewardWin"),window.WarOrderGetRewardWin=WarOrderGetRewardWin,ViewManager.ins().reg(WarOrderGetRewardWin,LayerManager.UI_Popup);var WarOrderInforPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenInfor",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eGetLab.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eGetLab.text+"</u>"),this.getExp.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getExp.text+"</u>"),this.getLevel.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getLevel.text+"</u>"),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postAction,this.update),this.observe(WarOrderCT.ins().postTaskExp,this.update),this.observe(WarOrderCT.ins().postInfo,this.update),this.observe(WarOrderCT.ins().postTaskInfo,this.update),this.update()},e.prototype.update=function(){this.expcount.text="Lv."+WarOrderCT.ins().lv,this.eGetLab.visible=!WarOrderCT.ins().hasLegendOrd&&WarOrderCT.ins().legendExp>0,this.updateExp()},e.prototype.updateExp=function(){var t=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season][WarOrderCT.ins().lv+1],e=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season][WarOrderCT.ins().lv],i=WarOrderCT.ins().lv>0&&!t;if(i)this.eProgressImg.scaleX=1,this.sProgressLab=e.exp+"/"+e.exp,this.eLab.text="";else{this.eProgressImg.scaleX=Math.min(t.exp,WarOrderCT.ins().exp)/t.exp,this.sProgressLab=""+WarOrderCT.ins().exp+(WarOrderCT.ins().legendExp>0?"+"+WarOrderCT.ins().legendExp:"")+"/"+t.exp;var s=WarOrderCT.ins().exp+WarOrderCT.ins().legendExp>t.exp?"，可提升等级":"";this.eLab.text=WarOrderCT.ins().legendExp>0?"当前传奇战令已累计"+WarOrderCT.ins().legendExp+"经验"+s:""}},e.prototype.onClick=function(t){switch(t.target){case this.eGetLab:ViewManager.ins().open(WarOrderActionWin);break;case this.getExp:WarOrderCT.ins().postOpenTab(WarOrderTabId.Task);break;case this.getLevel:ViewManager.ins().open(WarOrderBuyLvWin)}},e.prototype.enterFrame=function(){var t=Math.floor((WarOrderCT.ins().overTime-GameServer.serverTime)/1e3);this.sTime=t>=0?DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3):""},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(WarOrderInforPanel.prototype,"WarOrderInforPanel"),window.WarOrderInforPanel=WarOrderInforPanel;var WarOrderInforPanel2=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenInfor2",e}return __extends(e,t),e.prototype.skinComplete=function(){this.getMoney.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getMoney.text+"</u>"),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemCountChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.update()},e.prototype.update=function(){this.sNum=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.LegendaryMakeBaseConfig.itemId)+""},e.prototype.onClick=function(t){switch(t.target){case this.getMoney:WarOrderCT.ins().postOpenTab(WarOrderTabId.Reward)}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(WarOrderInforPanel2.prototype,"WarOrderInforPanel2"),window.WarOrderInforPanel2=WarOrderInforPanel2;var WarOrderPreviewWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenbuyPreview",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=ItemBase,this.eList0.itemRenderer=ItemBase},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postAction,this.updateBtn);var i=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season],s=[],n=[];for(var o in i)s.push(i[o].averagereward),n.push(i[o].payreward);this.eList.dataProvider=new eui.ArrayCollection(s),this.eList0.dataProvider=new eui.ArrayCollection(s),this.updateBtn()},e.prototype.updateBtn=function(){this.eBtn.visible=!WarOrderCT.ins().hasLegendOrd
},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:ViewManager.ins().open(WarOrderActionWin)}},e}(BaseEuiView);__reflect(WarOrderPreviewWin.prototype,"WarOrderPreviewWin"),window.WarOrderPreviewWin=WarOrderPreviewWin,ViewManager.ins().reg(WarOrderPreviewWin,LayerManager.UI_Popup);var WarOrderRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="LegenTokenRewardItem",e.listDP=new eui.ArrayCollection,e.eList.itemRenderer=ItemBase,e.eList.dataProvider=e.listDP,e.listDP1=new eui.ArrayCollection,e.eList1.itemRenderer=ItemBase,e.eList1.dataProvider=e.listDP1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=[],i=WarOrderCT.ins().getRewardStateById(t.level);for(var s in t.averagereward){var n=RewardData.objectToRewardData(t.averagereward[s]);i&&(n.isRedPoint=2),e.push(n)}this.listDP.source=e,e=[],i=WarOrderCT.ins().getLegendRewardState(t.level);for(var s in t.payreward){var n=RewardData.objectToRewardData(t.payreward[s]);i&&(n.isRedPoint=2),e.push(n)}this.listDP1.source=e,this.sLv=t.level+"级",this.blackImg.visible=WarOrderCT.ins().lv<t.level,this.blackImg1.visible=this.blackImg.visible||!WarOrderCT.ins().hasLegendOrd}},e}(BaseItemRender);__reflect(WarOrderRewardItemRender.prototype,"WarOrderRewardItemRender"),window.WarOrderRewardItemRender=WarOrderRewardItemRender;var WarOrderRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenReward",e}return __extends(e,t),e.prototype.skinComplete=function(){this.viewListDP=new eui.ArrayCollection,this.listView.itemRenderer=WarOrderRewardItemRender,this.listView.dataProvider=this.viewListDP,this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=ItemBase,this.eList.dataProvider=this.listDP,this.listDP1=new eui.ArrayCollection,this.eList1.itemRenderer=ItemBase,this.eList1.dataProvider=this.listDP1,this.eMCGrp=new eui.Group,this.eActBtn.addChild(this.eMCGrp),this.eMCGrp.horizontalCenter=this.eMCGrp.verticalCenter=0,this.eMCGrp.touchChildren=this.eMCGrp.touchEnabled=!1,this.mc=new MovieClip,this.eMCGrp.addChild(this.mc),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postAction,this.update),this.observe(WarOrderCT.ins().postBuyInfo,this.update),this.observe(WarOrderCT.ins().postTaskExp,this.update),this.observe(WarOrderCT.ins().postInfo,this.update),this.observe(WarOrderCT.ins().postAllRewardInfo,this.update),this.observe(WarOrderRedPoint.ins().postRewardPoint,this.updateRed),this.addEvent(egret.Event.CHANGE,this.eScroller,this.onChangeScroller),this.update(),this.updateRed()},e.prototype.removeDisplay=function(){},e.prototype.updateRed=function(){this.redPoint.visible=WarOrderRedPoint.ins().rewardPoint},e.prototype.update=function(){this.eLockImg.visible=!WarOrderCT.ins().hasLegendOrd,this.updateBtn(),this.updateList()},e.prototype.updateBtn=function(){WarOrderCT.ins().hasLegendOrd?(this.mc.stop(),DisplayUtils.removeFromParent(this.eActBtn)):(this.eBtnGroup.addChildAt(this.eActBtn,0),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1))},e.prototype.updateList=function(){var t=CommonUtils.objectToArray(GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season]);t.pop(),this.viewListDP.source=t,this.listView.validateNow(),this.initScroller(t),this.onChangeScroller()},e.prototype.initScroller=function(t){var e=0,i=0;for(var s in t)WarOrderCT.ins().getRewardStateById(t[s].level)&&e++,i++;var n=this.listView.getChildAt(0).height,o=this.eScroller.height,a=e*n;e>i-o/n&&(a=this.eScroller.viewport.contentHeight-this.eScroller.viewport.height),this.eScroller.viewport.scrollV=a},e.prototype.onChangeScroller=function(){var t=this.listView.getChildAt(0).height,e=this.eScroller.height,i=this.eScroller.viewport.scrollV;if(e>0&&t>0){var s=10*Math.ceil(((i+e)/t+1)/10);this.updateTopItem(s)}},e.prototype.updateTopItem=function(t){t=Math.max(1,t),t=Math.min(this.viewListDP.length+1,t);var e=GlobalConfig.LegendaryMakeRewardConfig[WarOrderCT.ins().season][t];if(e){this.sTopLv=e.level+"级";var i=WarOrderCT.ins().getRewardStateById(e.level),s=[];for(var n in e.averagereward){var o=RewardData.objectToRewardData(e.averagereward[n]);i&&(o.isRedPoint=2),s.push(o)}this.listDP.source=s,s=[],i=WarOrderCT.ins().getLegendRewardState(e.level);for(var n in e.payreward){var o=RewardData.objectToRewardData(e.payreward[n]);i&&(o.isRedPoint=2),s.push(o)}this.listDP1.source=s}},e.prototype.onClick=function(t){switch(t.target){case this.eActBtn:ViewManager.ins().open(WarOrderActionWin);break;case this.eAllBtn:WarOrderCT.ins().hasCanGetReward()&&WarOrderCT.ins().sendAllReward();break;case this.eShowBtn:ViewManager.ins().open(WarOrderPreviewWin)}},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateList",null),__decorate([callLater],e.prototype,"updateTopItem",null),e}(BaseView);__reflect(WarOrderRewardPanel.prototype,"WarOrderRewardPanel"),window.WarOrderRewardPanel=WarOrderRewardPanel;var WarOrderTaskItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="LegenTokenTaskItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=WarOrderCT.ins().taskInfos[t.id];if(e){this.pName.text=t.taskName,this.eBtn.visible=!0;var i=Math.min(t.target,e.progress),s=i>=t.target?"0x35E62D":"0xFF0000";this.eLab.textFlow=TextFlowMaker.generateTextFlow1("(|C:"+s+"&T:"+i+"|/"+t.target+")"),this.eIcon.source=t.icon,this.eItem.data=t.rewardItem,this.eName.source=t.isLegend?"LegenToken_task1":"LegenToken_task0",this.getImg.visible=this.eRp.visible=!1,this.eBtn.label="领取";var n=WarOrderCT.ins().getTaskRewardStateById(t.id);switch(n){case 2:this.getImg.visible=!0,this.eBtn.visible=!1;break;case 1:this.eRp.visible=!0;break;case 0:this.eBtn.label="前往"}}}},e.prototype.onClick=function(){var t=this.data,e=WarOrderCT.ins().getTaskRewardStateById(t.id);1==e?WarOrderCT.ins().sendGetTaskExp(t.id):t.turn&&ViewManager.ins().open(t.turn[0],t.turn[1],t.turn[2])},e}(BaseItemRender);__reflect(WarOrderTaskItemRender.prototype,"WarOrderTaskItemRender"),window.WarOrderTaskItemRender=WarOrderTaskItemRender;var WarOrderTaskPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenTask",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=WarOrderTaskItemRender,this.eList.dataProvider=this.listDP,this.addTouchEvent(this,this.onClick);for(var t=Object.keys(GlobalConfig.LegendaryMakeAchievementConfig[WarOrderCT.ins().round]).length,e=1;t>=e;e++)this["icon"+e].name=+e,this.addTouchEvent(this["icon"+e],this.onTap);WarOrderCT.ins().sendTaskInfo()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postTaskExp,this.update),this.observe(WarOrderCT.ins().postTaskInfo,this.update),this.observe(WarOrderCT.ins().postAttainment,this.updateBtn),this.observe(WarOrderCT.ins().postInitAttainment,this.updateBtn),this.update()},e.prototype.removeDisplay=function(){},e.prototype.update=function(){this.updateList(),Object.keys(WarOrderCT.ins().attainment).length>0&&this.updateBtn()},e.prototype.onTap=function(t){var e=GlobalConfig.LegendaryMakeBaseConfig.showPos[WarOrderCT.ins().round],i=GlobalConfig.LegendaryMakeAchievementConfig[WarOrderCT.ins().round];if(t.target.name){var s=e[t.target.name],n=WarOrderCT.ins().attainment[s];if(n)if(n.state)WarOrderCT.ins().sendAward(s);else if(i[s]){var o=i[s][n.level+1];o&&WarnWin.show(""+o.warnTxt,null,this,null,null,"sure")}}},e.prototype.updateBtn=function(){for(var t=GlobalConfig.LegendaryMakeAchievementConfig[WarOrderCT.ins().round],e=GlobalConfig.LegendaryMakeBaseConfig.showPos[WarOrderCT.ins().round],i=Object.keys(t).length,s=1;i>=s;s++){var n=e[s],o=WarOrderCT.ins().attainment[n];this["icon"+s].redPoint.visible=!!o&&!!o.state,this["icon"+s].level.text=t[n]&&t[n][o.level+1]?o.level+"":"",this["icon"+s].iconDisplay.source=o&&t[n]?o.level?t[n][o.level].icon:t[n][o.level+1].icon:""}},e.prototype.updateList=function(){var t=CommonUtils.objectToArray(GlobalConfig.LegendaryMakeTaskConfig[WarOrderCT.ins().season]);t.sort(this.sort),this.listDP.source=t},e.prototype.sort=function(t,e){var i=WarOrderCT.ins().getTaskRewardStateById(t.id),s=WarOrderCT.ins().getTaskRewardStateById(e.id);return 2==i&&2!=s?1:2!=i&&2==s?-1:1==i&&1!=s?-1:1!=i&&1==s?1:Algorithm.sortAsc(t.id,e.id)},e.prototype.onClick=function(t){return t.target instanceof eui.Button&&t.target.parent instanceof WarOrderTaskItemRender?void t.target.parent.onClick():void 0},e}(BaseView);__reflect(WarOrderTaskPanel.prototype,"WarOrderTaskPanel"),window.WarOrderTaskPanel=WarOrderTaskPanel;var WarOrderWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="LegenTokenSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WarOrderCT.ins().postOpenTab,this.postOpenTab),this.observe(WarOrderCT.ins().postAction,this.postOpenTab),this.observe(WarOrderRedPoint.ins().postRedPoint,this.updateRed),this.observe(WarOrderRedPoint.ins().postTaskPoints,this.updateRed),this.observe(WarOrderRedPoint.ins().postChangePoints,this.updateRed),this.viewStack.selectedIndex=0,this.updateRed()},e.prototype.updateRed=function(){this.redPoint0.visible=WarOrderRedPoint.ins().rewardPoint,this.redPoint1.visible=WarOrderRedPoint.ins().taskPoint,this.redPoint2.visible=WarOrderRedPoint.ins().changePoint},e.prototype.postOpenTab=function(t){this.viewStack.selectedIndex=this.tab.selectedIndex=t-1},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseEuiView);__reflect(WarOrderWin.prototype,"WarOrderWin"),window.WarOrderWin=WarOrderWin,ViewManager.ins().reg(WarOrderWin,LayerManager.UI_Main);var XinMoCT=function(t){function e(){var e=t.call(this)||this;return e.xinMoDatas=[],e.assayTimes=0,e.sysId=PackageID.XinMo,e.regNetMsg(1,e.postInit),e.regNetMsg(2,e.postUpStage),e.regNetMsg(3,e.postUpLevel),e.regNetMsg(4,e.postIdentify),e.regNetMsg(5,e.postUseDan),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInit=function(t){this.xinMoDatas=[];for(var e={power:t.readInt(),stage:t.readInt(),exp:t.readInt(),moDatas:[],promote:[],assayTime:0,dans:[]},i=0;4>i;i++){var s={level:t.readShort(),star:t.readByte()};e.moDatas.push(s)}e.promote=[t.readBoolean(),t.readBoolean(),t.readBoolean(),t.readBoolean()],e.assayTime=t.readShort(),this.assayTimes=e.assayTime,e.dans=[{itemId:GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1.id,use:t.readShort()},{itemId:GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.id,use:t.readShort()},{itemId:GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.id,use:t.readShort()}],this.xinMoDatas.push(e)},e.prototype.postUpStage=function(t){var e=t.readInt(),i=t.readInt(),s=t.readInt();this.xinMoDatas[0].power=e,this.xinMoDatas[0].stage=i,this.xinMoDatas[0].exp=s},e.prototype.postUpLevel=function(t){var e=t.readInt(),i=t.readByte(),s=t.readShort(),n=t.readByte(),o=t.readBoolean();this.xinMoDatas[0].power=e,this.xinMoDatas[0].moDatas[i-1].level=s,this.xinMoDatas[0].moDatas[i-1].star=n,this.xinMoDatas[0].promote[i-1]=o},e.prototype.postIdentify=function(t){this.assayTimes=t.readInt();for(var e=t.readShort(),i=[],s=0;e>s;s++){var n={};n.handle=t.readDouble(),i.push(n)}return i},e.prototype.postUseDan=function(t){var e=t.readInt(),i=t.readInt(),s=t.readInt(),n=t.readShort(),o=i-this.xinMoDatas[0].exp;o&&TipsCT.ins().showTips("|C:0x00ff00&T:心魔经验+"+o+"|"),this.xinMoDatas[0].power=e,this.xinMoDatas[0].exp=i,s==GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1.id?this.xinMoDatas[0].dans[0].use=n:s==GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.id?this.xinMoDatas[0].dans[1].use=n:s==GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.id&&(this.xinMoDatas[0].dans[2].use=n)},e.prototype.sendUpStage=function(){this.sendBaseProto(2)},e.prototype.sendUpLevel=function(t){var e=this.getBytes(3);e.writeByte(t),this.sendToServer(e)},e.prototype.sendIdentify=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.sendUseDan=function(t,e){void 0===e&&(e=1);var i=this.getBytes(5);i.writeInt(t),i.writeShort(e),this.sendToServer(i)},e.prototype.getPrimaryTimes=function(){return this.xinMoDatas[0]?GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1.time-this.xinMoDatas[0].dans[0].use:0},e.prototype.getNormalTimes=function(){return this.xinMoDatas[0]?GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.time-this.xinMoDatas[0].dans[1].use:0},e.prototype.getAdvancedTimes=function(){return this.xinMoDatas[0]?GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.time-this.xinMoDatas[0].dans[2].use:0},e.prototype.isCanExchange=function(){var t;return this.getPrimaryTimes()>0&&(t=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1.id),t>0)?!0:this.getNormalTimes()>0&&(t=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.id),t>0)?!0:this.getAdvancedTimes()>0&&(t=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.id),t>0)?!0:!1},e.prototype.checkOpen=function(){return ZsCT.ins().lv<GlobalConfig.DemonsSystemBaseConfig.zslv?!1:!(GameServer.serverOpenDay<GlobalConfig.DemonsSystemBaseConfig.openserverday-1)},e.prototype.isAssay=function(){var t=GlobalConfig.DemonsSystemBaseConfig.equipidentifyitemid,i=ItemUtil.isEquip(GlobalConfig.ItemConfig[t])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,s=BagCT.ins().getBagGoodsCountById(i,t),n=GlobalConfig.DemonsIdentifyTimeConfig[e.ins().assayTimes];if(!n){var o=Object.keys(GlobalConfig.DemonsIdentifyTimeConfig);n=GlobalConfig.DemonsIdentifyTimeConfig[o.length-1]}return n.itemcount<=s},e.prototype.getCfg=function(t){var e;switch(t){case 1:return e=GlobalConfig.DemonsKillMonsterLevelConfig;case 2:return e=GlobalConfig.DemonsEyeLevelConfig;case 3:return e=GlobalConfig.DemonsIdentifyLevelConfig;case 4:return e=GlobalConfig.DemonsSnatchTreasureLevelConfig}},e.prototype.isCanUp=function(t){var e=this.xinMoDatas[0].moDatas[t].level,i=this.xinMoDatas[0].moDatas[t].star,s=this.getCfg(t+1),n=s[e][i];if(s[e][i+1]){var o=s[e][i+1],a=GlobalConfig.DemonsSystemBaseConfig.appendesConsumeItemId[t],r=ItemUtil.isEquip(GlobalConfig.ItemConfig[a])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,l=BagCT.ins().getBagGoodsCountById(r,a),h=o.itemcount;if(l>=h)return!0}else if(this.xinMoDatas[0].stage>=n.breakdemonslv){var a=n.breakconsume[0].id,r=ItemUtil.isEquip(GlobalConfig.ItemConfig[a])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,l=BagCT.ins().getBagGoodsCountById(r,a),h=n.breakconsume[0].count;if(l>=h)return!0}return!1},__decorate([post()],e.prototype,"postInit",null),__decorate([post()],e.prototype,"postUpStage",null),__decorate([post()],e.prototype,"postUpLevel",null),__decorate([post()],e.prototype,"postIdentify",null),__decorate([post()],e.prototype,"postUseDan",null),e}(BaseSystem);__reflect(XinMoCT.prototype,"XinMoCT");var MoType;!function(t){t[t.Bedevil=0]="Bedevil",t[t.Heart=1]="Heart",t[t.Assay=2]="Assay",t[t.Treasure=3]="Treasure"}(MoType||(MoType={})),System.XinMoCT=function(){return XinMoCT.ins()},window.XinMoCT=XinMoCT;var XinMoRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemChange,XinMoCT.ins().postUpStage,XinMoCT.ins().postInit),e.ins=XinMoCT.ins(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){this.assRed(),this.sysRed()},e.prototype.sysRed=function(){if(this.ins.xinMoDatas[0]){var t=GlobalConfig.DemonsSystemLevelConfig[this.ins.xinMoDatas[0].stage+1];return t?void(this.redPoint1=this.ins.xinMoDatas[0].exp>=t.exp||this.ins.isCanUp(0)||this.ins.isCanUp(1)||this.ins.isCanUp(2)||this.ins.isCanUp(3)):this.redPoint1=!1}},e.prototype.assRed=function(){var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_37);this.redPoint2=this.ins.isAssay()&&t.length>0},__decorate([post()],e.prototype,"postRedPoint",null),e}(BaseSystem);__reflect(XinMoRedPoint.prototype,"XinMoRedPoint"),System.XinMoRedPoint=function(){return XinMoRedPoint.ins()},window.XinMoRedPoint=XinMoRedPoint;var GetExpWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoEXPSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){var t=new RewardData;t.type=0,t.id=0,t.count=0,this.item0.data=t;for(var e=0;3>e;e++)this["item"+e].isShowName(!1)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(XinMoCT.ins().postUseDan,this.updateView),this.observe(Shop.ins().postBuyResult,this.updateView),this.observe(Shop.ins().postBuyCount,this.updateView),this.updateView()},e.prototype.buy=function(t,i){var s=this["priceIcon"+t].getPrice();if(Actor.yb<s)TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this);else{var n=CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",i);e.buyGoods(n.id)}},e.buyGoods=function(t){Shop.ins().shopData.checkBuyGoodsId(t)&&ViewManager.ins().open(BuyWin,t)},e.prototype.updateView=function(){this.updateItem(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1,0,XinMoCT.ins().getPrimaryTimes()),this.updateItem(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2,1,XinMoCT.ins().getNormalTimes()),this.updateItem(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3,2,XinMoCT.ins().getAdvancedTimes())},e.prototype.updateItem=function(t,e,i){if(0==e){var s=GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1,n=GlobalConfig.ItemConfig[s.id];this.item0.data=s.id;var o=BagCT.ins().getBagGoodsCountById(0,s.id);this.yeli0.text=s.value.toString(),this.name0.text=n.name+" 剩余："+o+"个",this.priceIcon0.visible=!1,i>0?(this.toDay0.textColor=65280,this.redPoint0.visible=this.btn0.enabled=o>0):(this.toDay0.textColor=16711680,this.redPoint0.visible=this.btn0.enabled=!1),this.toDay0.text=i.toString()}else{var n=GlobalConfig.ItemConfig[t.id];this["item"+e].data=t.id,this["toDay"+e].text=i.toString(),i>0?this["toDay"+e].textColor=65280:this["toDay"+e].textColor=16711680,this["yeli"+e].text=t.value.toString();var o=BagCT.ins().getBagGoodsCountById(0,t.id);o>0?(this["name"+e].text=n.name+" 剩余："+o+"个",this["priceIcon"+e].visible=!1,this["redPoint"+e].visible=i>0,this["btn"+e].label="立即使用",this["btn"+e].enabled=i>0):i>0?(this["name"+e].text=n.name,this["priceIcon"+e].visible=!0,this["priceIcon"+e].setPrice(CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",t.id).price),this["redPoint"+e].visible=!1,this["btn"+e].label="购买",this["btn"+e].enabled=!0):(this["name"+e].text=n.name+" 剩余："+o+"个",this["priceIcon"+e].visible=!1,this["redPoint"+e].visible=0,this["btn"+e].label="立即使用",this["btn"+e].enabled=!1)}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.btn0:XinMoCT.ins().sendUseDan(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem1.id);break;case this.btn1:"购买"==this.btn1.label?this.buy(1,GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.id):XinMoCT.ins().sendUseDan(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem2.id);break;case this.btn2:"购买"==this.btn2.label?this.buy(2,GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.id):XinMoCT.ins().sendUseDan(GlobalConfig.DemonsSystemBaseConfig.demonslevelitem3.id)}},e}(BaseEuiView);__reflect(GetExpWin.prototype,"GetExpWin"),window.GetExpWin=GetExpWin,ViewManager.ins().reg(GetExpWin,LayerManager.UI_Popup);var IdentifyItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="PowerEquipSeletctSkin",e.eEffG.visible=!1,e.select.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.itemConfig;this.sName=t.name,this.equipName.textColor=ItemUtil.getQualityColor(t),this.sQuality="quality"+ItemUtil.getQuality(t),this.sImg=t.icon+"_png",this.sLv=this.data.count+""}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.select.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(IdentifyItem.prototype,"IdentifyItem"),window.IdentifyItem=IdentifyItem;var IdentifyOptItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.skinName="ItemSkin",e.count.visible=e.nameTxt.visible=e.itemIcon.imgIcon.visible=e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(!this.data)return void(this.nameTxt.visible=this.itemIcon.imgIcon.visible=this.itemIcon.imgBg.visible=!1);this.nameTxt.visible=this.itemIcon.imgIcon.visible=this.itemIcon.imgBg.visible=!0;var t=this.data.itemConfig;this.itemIcon.setData(t),this.nameTxt.text=t.name,this.nameTxt.textColor=ItemUtil.getQualityColor(t)},e}(BaseItemRender);__reflect(IdentifyOptItem.prototype,"IdentifyOptItem"),window.IdentifyOptItem=IdentifyOptItem;var IdentifyPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="XinMoIdentifySkin",e.eListDP=new eui.ArrayCollection,e.list.dataProvider=e.eListDP,e.getMC=new MovieClip,e.getMC.x=45,e.getMC.y=35,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.observe(XinMoCT.ins().postIdentify,this.onUpEquip),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.update()},e.prototype.onListChange=function(t){this.list.selectedIndex=t.itemIndex},e.prototype.update=function(){var t=GlobalConfig.DemonsSystemBaseConfig.equipidentifyitemid;this.icon1.source=GlobalConfig.ItemConfig[t].icon+"_png";var e=ItemUtil.isEquip(GlobalConfig.ItemConfig[t])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,i=BagCT.ins().getBagGoodsCountById(e,t),s="",n=GlobalConfig.DemonsIdentifyTimeConfig[XinMoCT.ins().assayTimes+1];if(!n){var o=Object.keys(GlobalConfig.DemonsIdentifyTimeConfig);n=GlobalConfig.DemonsIdentifyTimeConfig[o.length-1]}s=i>=n.itemcount?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+i+"</font>/"+n.itemcount),this.updateList()},e.prototype.updateList=function(){for(var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_37),e=[],i=0;i<t.length;i++)e.push(t[i]),e.sort(this.equipSort);this.eListDP.replaceAll(e),this.costGroup0.visible=this.btnChallenge.enabled=this.eListDP.length>0&&this.item2.data,BagCT.ins().getBagGoodsCountById(0,this.assayId)<=0&&(this.costGroup0.visible=this.btnChallenge.enabled=!1,this.assayId=null,this.list.selectedIndex=null)},e.prototype.equipSort=function(t,e){var i=ItemUtil.getQuality(t.itemConfig),s=ItemUtil.getQuality(e.itemConfig);return s>i?1:i>s?-1:t.configID>e.configID?1:t.configID<e.configID?-1:0},e.prototype.onClick=function(t){switch(t.target instanceof IdentifyItem&&t.target.itemIndex==this.list.selectedIndex&&(this.assayId=t.target.data._configID,this.item2.data=t.target.data,this.itemid=this.item2.data._configID,this.costGroup0.visible=this.btnChallenge.enabled=this.item2.data),t.target){case this.btnChallenge:XinMoCT.ins().isAssay()?(console.log(this.assayId),XinMoCT.ins().sendIdentify(this.assayId)):TipsCT.ins().showTips("材料不足");break;case this.item2:if(t.target instanceof IdentifyOptItem){if(!this.item2.data)return;GlobalConfig.EquipConfig[this.itemid]?ViewManager.ins().open(XinmoTips,this.item2.data):ViewManager.ins().open(ItemDetailedWin,0,this.itemid)}}},e.prototype.onUpEquip=function(t){this.getMC.playFile(RES_DIR_EFF+"UpEff1",1),this.item2.addChild(this.getMC);for(var e=0;e<t.length;e++){var i=BagCT.ins().getBagGoodsByHandle(0,t[e].handle);this.item2.data=i,this.itemid=i?i.configID:0}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(IdentifyPanel.prototype,"IdentifyPanel"),window.IdentifyPanel=IdentifyPanel;var MoLevelImage=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._value=1,e}return __extends(e,t),e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){0>=t&&(t=1),this._value=t,this.skin&&this.update()},e.prototype.addDisplay=function(){this.update()},e.prototype.update=function(){var t=this._value;this.moStage.text="魔"+StringUtils.NumberToChinese(t)+"重"},e}(BaseView);__reflect(MoLevelImage.prototype,"MoLevelImage"),window.MoLevelImage=MoLevelImage;var XinMoPanel=function(t){function e(){var e=t.call(this)||this;e.barbc=new ProgressBarEff,e.skinName="XinMoPanelSkin",e.ins=XinMoCT.ins(),e.barbc=new ProgressBarEff,e.barbc.setWidth(525),e.barGroup.addChild(e.barbc),e.bodyMc=new MovieClip,e.bodyEff.addChild(e.bodyMc),e.labelEffect=new MovieClip,e.labelEffect.scaleX=.7,e.labelEffect.scaleY=.5,e.labelEffect.touchEnabled=!1,e.link.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.link.text+"</u></a>"),e.addTouchEvent(e,e.onClick),e.checkBtn0.type=MoType.Bedevil,e.checkBtn1.type=MoType.Assay,e.checkBtn2.type=MoType.Heart,e.checkBtn3.type=MoType.Treasure,e.oldHorizontalCenter=e.curAtt.horizontalCenter;var i=SubRoles.ins().getSubRoleByIndex(0);return 0==i.sex?e.bodyMc.playFile(RES_DIR_EFF+"xinmomaneff",-1):e.bodyMc.playFile(RES_DIR_EFF+"xinmowomaneff",-1),e.txt_wanfa.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+e.txt_wanfa.text),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(this.ins.postInit,this.update),this.observe(this.ins.postUseDan,this.update),this.observe(this.ins.postUpStage,this.update),this.observe(this.ins.postUpLevel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.update()},e.prototype.update=function(){if(this.ins.xinMoDatas[0]){var t=GlobalConfig.DemonsSystemLevelConfig[this.ins.xinMoDatas[0].stage],e=[],i=[2,4,5,6,97,98];i.forEach(function(t){e.push({type:t,value:0})});var s=GlobalConfig.DemonsSystemLevelConfig[this.ins.xinMoDatas[0].stage+1];this.nextBodyCfg=s?s:null;var n=!this.nextBodyCfg;this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(0!=t.attrs.length?t.attrs:e,0,1,"：")),this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(n?"":AttributeData.getAttStr(this.nextBodyCfg.attrs,0,1,"：")),this.curAtt.horizontalCenter=n?0:this.oldHorizontalCenter,this.group.visible=this.arrowImg.visible=this.barbc.visible=!n,this.maxTxt.visible=n,XinMoCT.ins().isCanExchange()?this.addLabelEffect():this.removeLabelEffect(),this.stairImg.visible=this.ins.xinMoDatas[0].stage>0,this.stairImg.setValue(this.ins.xinMoDatas[0].stage),this.powerPanel.setPower(this.ins.xinMoDatas[0].power),this.expBarChange(),this.redPoint0.visible=this.ins.isCanUp(0),this.redPoint1.visible=this.ins.isCanUp(1),this.redPoint2.visible=this.ins.isCanUp(2),this.redPoint3.visible=this.ins.isCanUp(3)}},e.prototype.addLabelEffect=function(){var t=this;egret.callLater(function(){DisplayUtils.removeFromParent(t.labelEffect),t.labelEffect.x=t.link.x+t.link.width/2,t.labelEffect.y=t.link.y+t.link.height/2,null==t.labelEffect.parent&&t.link.parent.addChild(t.labelEffect),t.labelEffect.playFile(RES_DIR_EFF+"BtnPrompt1",-1)},this)},e.prototype.removeLabelEffect=function(){this.labelEffect.stop(),DisplayUtils.removeFromParent(this.labelEffect)},e.prototype.expBarChange=function(){var t=GlobalConfig.DemonsSystemLevelConfig[this.ins.xinMoDatas[0].stage+1],e=t?t.exp:GlobalConfig.DemonsSystemLevelConfig[this.ins.xinMoDatas[0].stage].exp;this.barbc.setData(this.ins.xinMoDatas[0].exp?this.ins.xinMoDatas[0].exp:0,e),this.redPoint.visible=this.isExpEnough=this.ins.xinMoDatas[0].exp>=e},e.prototype.onClick=function(t){switch(t.target){case this.link:ViewManager.ins().open(GetExpWin);break;case this.checkBtn0:case this.checkBtn1:case this.checkBtn2:case this.checkBtn3:ViewManager.ins().open(XinMoSkillWin,t.target.type,this.ins.xinMoDatas[0].moDatas);break;case this.getBtn:this.isExpEnough?XinMoCT.ins().sendUpStage():TipsCT.ins().showTips("心魔经验不足");break;case this.txt_wanfa:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[56].text)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(XinMoPanel.prototype,"XinMoPanel"),window.XinMoPanel=XinMoPanel;var XinMoSkillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isMax=!1,e._sn_="XinMoSkillSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.starList=new StarList(5),this.starList.horizontalCenter=0,this.starGroup.addChild(this.starList),this.oldHorizontalCenter=this.curAtt0.horizontalCenter,this.addTouchEvent(this,this.onClick),this.iconMc=new MovieClip,this.iconEff.addChild(this.iconMc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.xmData=t[1],this.icon0.visible=!1;var i=GlobalConfig.DemonsSystemBaseConfig.eff[this.type];this.iconMc.playFile(RES_DIR_EFF+i,-1),this.abilityName.text=GlobalConfig.DemonsSystemBaseConfig.name[this.type],this.observe(XinMoCT.ins().postUpLevel,this.update),this.update()},e.prototype.update=function(){var t=this.xmData[this.type].level,e=this.xmData[this.type].star,i=XinMoCT.ins().getCfg(this.type+1);if(this.nowCfg=null,this.nextCfg=null,this.nowCfg=i[t][e],this.expendLabel1.text="消耗：",i[t][e+1]){this.upGradeBtn1.label="进化",this.nextCfg=i[t][e+1];var s=GlobalConfig.DemonsSystemBaseConfig.appendesConsumeItemId[this.type];this.icon1.source=GlobalConfig.ItemConfig[s].icon+"_png";var n=ItemUtil.isEquip(GlobalConfig.ItemConfig[s])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,o=BagCT.ins().getBagGoodsCountById(n,s),a="";a=o>=this.nextCfg.itemcount?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+a+">"+o+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.nextCfg.itemcount+"</font> ")}else if(i[t+1])if(this.nextCfg=i[t+1][0],this.upGradeBtn1.label="突破",XinMoCT.ins().xinMoDatas[0].stage>=this.nowCfg.breakdemonslv){var s=this.nowCfg.breakconsume[0].id;this.icon1.source=GlobalConfig.ItemConfig[s].icon+"_png";var n=ItemUtil.isEquip(GlobalConfig.ItemConfig[s])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,o=BagCT.ins().getBagGoodsCountById(n,s),a="";a=o>=this.nowCfg.breakconsume[0].count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow("<font color="+a+">"+o+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this.nowCfg.breakconsume[0].count+"</font> ")}else this.countLabel1.text=this.icon1.source="",this.expendLabel1.textFlow=TextFlowMaker.generateTextFlow("达到心魔"+StringUtils.NumberToChinese(this.nowCfg.breakdemonslv)+"重（<font color="+ColorUtil.RED_COLOR+">"+XinMoCT.ins().xinMoDatas[0].stage+"</font>/"+this.nowCfg.breakdemonslv+"） ");else this.isMax=!0;var r=!this.nextCfg,l=[],h=[2,4,5,6];if(h.forEach(function(t){l.push({type:t,value:0})}),0!=t||this.isMax)if(!this.isMax&&i[t+1])if(0==this.nextCfg.excattrs.length&&0==this.nowCfg.excattrs.length)this.nextGroup.visible=!1,this.curAtt.text=""+GlobalConfig.DemonsSystemBaseConfig.desc[this.type],this.curAttr.text="";else{this.nextGroup.visible=!0,this.curAtt.text="当前：",this.nextAtt.text="下阶：";var p=this.nowCfg.excattrs,u=i[t+1][0].excattrs,d=AttributeData.getAttrStrByType(p[0].type);if(92==p[0].type)this.curAttr.text=d+p[0].value,this.nextAttr.text=d+u[0].value;else if(94==p[0].type){var o=(p[0].value/100).toFixed(1)+"%",c=(u[0].value/100).toFixed(1)+"%";this.curAttr.text=d+o,this.nextAttr.text=d+c}else this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(p,0)),this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(u,0))
}else if(this.nextGroup.visible=!1,0==this.nowCfg.excattrs.length)this.curAtt.text=""+GlobalConfig.DemonsSystemBaseConfig.desc[this.type],this.curAttr.text="";else{this.curAtt.text="当前：";var p=this.nowCfg.excattrs,d=AttributeData.getAttrStrByType(p[0].type);if(92==p[0].type)this.curAttr.text=d+p[0].value;else if(94==p[0].type){var o=(p[0].value/100).toFixed(1)+"%";this.curAttr.text=d+o}else this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(p,0))}else if(this.nextGroup.visible=!1,0==this.nextCfg.excattrs.length)this.curAtt.text=""+GlobalConfig.DemonsSystemBaseConfig.desc[this.type],this.curAttr.text="";else{this.curAtt.text="下阶：";var p=i[t+1][0].excattrs,d=AttributeData.getAttrStrByType(p[0].type);if(92==p[0].type)this.curAttr.text=d+p[0].value;else if(94==p[0].type){var o=(p[0].value/100).toFixed(1)+"%";this.curAttr.text=d+o}else this.curAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(p,0))}this.curAtt0.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(0!=this.nowCfg.baseattrs.length?this.nowCfg.baseattrs:l,0,1,"：")),this.nextAtt0.textFlow=TextFlowMaker.generateTextFlow1(r?"":AttributeData.getAttStr(this.nextCfg.baseattrs,0,1,"：")),this.curAtt0.horizontalCenter=r?0:this.oldHorizontalCenter,this.upGradeBtn1.visible=this.costGroup0.visible=this.arrowImg0.visible=!r,this.max.visible=!this.upGradeBtn1.visible,this.stageImg.visible=t>0,this.stageImg.setValue(t),this.updateStar()},e.prototype.updateStar=function(t){void 0===t&&(t=0);var e=this.xmData[this.type].star;this.starList.setStarNum(e,t)},e.prototype.onClick=function(t){switch(t.target){case this.colorCanvas:ViewManager.ins().close(this);break;case this.upGradeBtn1:var e=this.xmData[this.type].level,i=this.xmData[this.type].star,s=XinMoCT.ins().getCfg(this.type+1);if(s[e][i+1]){var n=GlobalConfig.DemonsSystemBaseConfig.appendesConsumeItemId[this.type],o=ItemUtil.isEquip(GlobalConfig.ItemConfig[n])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,a=BagCT.ins().getBagGoodsCountById(o,n),r=this.nextCfg.itemcount;if(r>a)return void TipsCT.ins().showTips("材料不足")}else{if(!(XinMoCT.ins().xinMoDatas[0].stage>=this.nowCfg.breakdemonslv))return void TipsCT.ins().showTips("升级条件不足");var n=this.nowCfg.breakconsume[0].id,o=ItemUtil.isEquip(GlobalConfig.ItemConfig[n])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER,a=BagCT.ins().getBagGoodsCountById(o,n),r=this.nowCfg.breakconsume[0].count;if(r>a)return void TipsCT.ins().showTips("材料不足")}XinMoCT.ins().sendUpLevel(this.type+1)}},e}(BaseEuiView);__reflect(XinMoSkillWin.prototype,"XinMoSkillWin"),window.XinMoSkillWin=XinMoSkillWin,ViewManager.ins().reg(XinMoSkillWin,LayerManager.UI_Popup);var XinMoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.roleSelect.hideRole()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(XinMoRedPoint.ins().postRedPoint,this.updateRed),this.observe(XinmoEquipRedPoint.ins().postXinmoEquipFun,this.updateRed),this.updateRed(),this.addTouchEvent(this.tab,this.onClick),t[0]?(this.lastSelect=t[0],this.selectedIndex(this.lastSelect)):this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.setSelectedIndex=function(t){this.selectedIndex(this.viewStack.selectedIndex),this.updateRed()},e.prototype.selectedIndex=function(t){void 0!=this.lastSelect&&this.viewStack.getElementAt(this.lastSelect).close&&this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=t,this.viewStack.getElementAt(this.lastSelect).open&&this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.updateRed=function(){this.redPoint3.visible=!1,this.redPoint1.visible=XinMoRedPoint.ins().redPoint1,this.redPoint4.visible=XinMoRedPoint.ins().redPoint2,this.redPoint2.visible=XinmoEquipRedPoint.ins().totalRedPoint},e.prototype.onClick=function(t){return 2==t.currentTarget.selectedIndex?(ViewManager.ins().open(XinMoEquipMain),ViewManager.ins().close(this),void t.preventDefault()):void 0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(XinMoWin.prototype,"XinMoWin"),window.XinMoWin=XinMoWin,ViewManager.ins().reg(XinMoWin,LayerManager.UI_Main);var XinMoEquipCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Equip,e.regNetMsg(42,e.intInfo),e.regNetMsg(43,e.GCreplaceXmEquip),e.regNetMsg(44,e.GCIntensify),e.regNetMsg(45,e.GCEnchant),e.regNetMsg(48,e.GCMyLevel),e.regNetMsg(47,e.GCMyPower),e.regNetMsg(49,e.GCUpgrade),e}return __extends(e,t),e.prototype.intInfo=function(t){this.xmEquipInfo=[];for(var e=t.readByte(),i=0;e>i;i++){for(var s={rolePower:t.readInt(),equipArr:[],equipFm:[]},n=t.readByte(),o=0;n>o;o++){var a={stage:t.readInt(),lv:t.readInt(),itemid:t.readInt(),fmType:t.readByte()};s.equipArr.push(a)}for(var r=0;4>r;r++){var l={mjLv:t.readShort()};s.equipFm.push(l)}this.xmEquipInfo.push(s)}},e.prototype.CGreplaceXmEquip=function(t,e,i){var s=this.getBytes(43);s.writeByte(e),s.writeByte(i),s.writeDouble(t),this.sendToServer(s)},e.prototype.GCreplaceXmEquip=function(t){var e=t.readShort(),i=t.readShort(),s=new ItemData;s.parser(t),this.xmEquipInfo[e].equipArr[i].itemid=t.readInt(),SubRoles.ins().getSubRoleByIndex(e).xinmoEquipItemData[i]=s},e.prototype.CGIntensify=function(t,e){var i=this.getBytes(44);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.GCIntensify=function(t){var e=t.readByte(),i=t.readInt(),s=t.readByte(),n=t.readInt();this.xmEquipInfo[e].rolePower=i,this.xmEquipInfo[e].equipArr[s].lv=n},e.prototype.CGEnchant=function(t,e){var i=this.getBytes(45);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.GCEnchant=function(t){var e=t.readByte(),i=t.readInt(),s=t.readByte(),n=t.readByte();this.xmEquipInfo[e].rolePower=i,this.xmEquipInfo[e].equipArr[s].fmType=n,SubRoles.ins().getSubRoleByIndex(e).xinmoEquipItemData[s].extAtt[1].value=n;var o=this.getFmStata(SubRoles.ins().getSubRoleByIndex(e).xinmoEquipItemData[s]);return n>0?(TipsCT.ins().showTips("|C:0x00ff00&T:附魔成功|"),o):void TipsCT.ins().showTips("|C:0xf3311e&T:附魔失败|")},e.prototype.CGForging=function(t,e,i,s,n){var o=this.getBytes(46);o.writeByte(t),o.writeInt(e),o.writeByte(i),0==i?o.writeDouble(s):o.writeInt(s),o.writeByte(n.length);for(var a in n)o.writeDouble(n[a]);this.sendToServer(o)},e.prototype.CGMyLevel=function(t,e){var i=this.getBytes(48);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.GCMyLevel=function(t){var e=t.readByte(),i=t.readInt(),s=t.readByte(),n=t.readShort();this.xmEquipInfo[e].rolePower=i,this.xmEquipInfo[e].equipFm[s-1].mjLv=n},e.prototype.CGUpgrade=function(t,e){var i=this.getBytes(49);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.GCUpgrade=function(t){var e=t.readByte(),i=t.readByte(),s=t.readInt(),n=t.readShort();this.xmEquipInfo[e].rolePower=s,this.xmEquipInfo[e].equipArr[i].stage=n},e.prototype.GCMyPower=function(t){var e=t.readByte();this.xmEquipInfo[e].rolePower=t.readInt()},e.ins=function(){return t.ins.call(this)},e.prototype.opentips=function(){var t=GlobalConfig.ItemConfig[361001];ViewManager.ins().open(XinmoTips,36,"",361001,t)},e.prototype.getDemonsEquipSystemStrengthConfig=function(t,e,i){var s=t[e][i];return s?s:!1},e.prototype.getFmStata=function(t){for(var e=[],i=0;4>i;i++){var s=t.extAtt[1].value>>i&1;e.push(s)}return e},e.prototype.getFmCount=function(t){for(var e=0,i=0;4>i;i++)(t.extAtt[1].value>>i&1)>0&&e++;return e},e.prototype.getDemonsEquipSystemMonsterForgeConfig=function(){var t=[],e=GlobalConfig.DemonsEquipSystemMonsterForgeConfig;for(var i in e)t.push(e[i].forgeid);return t},e.prototype.getDemonsEquipcfg=function(t){var e=[];for(var i in t)e.push(t[i]);return e},e.prototype.getDemonsEquipSystemStampEffectConfig=function(t,e){for(var i=[],s=GlobalConfig.DemonsEquipSystemStampEffectConfig[t],n=4>=e?1:2,o=1;5>o;o++)i.push(s[o*n-1][o]);return i},e.prototype.getMyEquipNum=function(t){var e=this.xmEquipInfo[t].equipArr,i=0;for(var s in e)0!=e[s].itemid&&i++;return i},e.prototype.getUseEquip=function(t){for(var e=[],i=0;3>i;i++)if(SubRoles.ins().getSubRoleByIndex(i)){var s=SubRoles.ins().getSubRoleByIndex(i).xinmoEquipItemData;for(var n in s)s[n].configID==t&&e.push(s[n])}var o=BagCT.ins().getXMPowerEquipById(t,ItemType.TYPE_36);if(o&&o.length>0)for(var a in o)e.push(o[a]);return e},e.prototype.getIsUseEquip=function(t,e){for(var i=0;3>i;i++)if(SubRoles.ins().getSubRoleByIndex(i)){var s=SubRoles.ins().getSubRoleByIndex(i).xinmoEquipItemData;for(var n in s)if(s[n].configID==e&&s[n].handle==t)return i+1}return 0},e.prototype.ForgeEquipFun=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(t),i=0;i<e.xinmoEquipItemData.length;i++){var s=this.xmEquipInfo[t].equipArr?this.xmEquipInfo[t].equipArr[i]:void 0,n=s?s.lv:0;if(this.getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,i,n+1)){var o=this.getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,i,n).strengthconsumeitems,a=o[0].count,r=BagCT.ins().getBagGoodsCountById(0,o[0].id);if(r>a)return i}}return 0},e.prototype.EnchantEquipFun=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(t),i=0;i<e.xinmoEquipItemData.length;i++){var s=this.xmEquipInfo[t].equipArr?this.xmEquipInfo[t].equipArr[i]:void 0,n=s?s.stage:0;if(0!=s.itemid&&GlobalConfig.DemonsEquipSystemStampResetConfig[n]){var o=GlobalConfig.DemonsEquipSystemStampResetConfig[n].consumelist,a=o[0].count,r=BagCT.ins().getBagGoodsCountById(0,o[0].id);if(r>a)return i}}return 0},e.prototype.isUpgrade=function(t,e){var i=10,s=this.xmEquipInfo[t].equipArr[e];return s.stage*i+10<=s.lv},__decorate([post()],e.prototype,"intInfo",null),__decorate([post()],e.prototype,"GCreplaceXmEquip",null),__decorate([post()],e.prototype,"GCIntensify",null),__decorate([post()],e.prototype,"GCEnchant",null),__decorate([post()],e.prototype,"GCMyLevel",null),__decorate([post()],e.prototype,"GCUpgrade",null),__decorate([post()],e.prototype,"GCMyPower",null),e}(BaseSystem);__reflect(XinMoEquipCT.prototype,"XinMoEquipCT"),System.XinMoEquipCT=function(){return XinMoEquipCT.ins()},window.XinMoEquipCT=XinMoEquipCT;var XinmoEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.totalRedPoint=!1,e.XinmoEquipRedPoint=[],e.totalroleRedPoint=[],e.roleRedPoint1=[],e.roleRedPoint2=[],e.roleRedPoint3=[],e.forgeRedPoint=!1,e.stageRedPoints=[],e.stagePosRedPoints=[],e.roleEquipRedPoint=[],e.forgeEquipRedPoint=[],e.enchantEquipRedPoint=[],e.printEquipRedPoint=[],e.XinmoEquipRedPoint=[!1,!1,!1,!1],e.totalroleRedPoint=[e.roleRedPoint1,e.roleRedPoint2,e.roleRedPoint3],e.associated(e.postTotalRedPointFun,e.postXinmoEquipFun),e.associated(e.postXinmoEquipFun,e.postRoleXinmoEquipFun,e.postForgeEquipFun,e.postEnchantEquipFun,e.postForgeRedPoint),e.associated(e.postRoleXinmoEquipFun,XinMoEquipCT.ins().intInfo,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,XinMoEquipCT.ins().GCreplaceXmEquip,XinMoEquipCT.ins().GCMyLevel,XinMoEquipCT.ins().GCIntensify),e.associated(e.postForgeEquipFun,XinMoEquipCT.ins().intInfo,XinMoEquipCT.ins().GCreplaceXmEquip,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,XinMoEquipCT.ins().GCIntensify),e.associated(e.postEnchantEquipFun,XinMoEquipCT.ins().intInfo,XinMoEquipCT.ins().GCreplaceXmEquip,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,XinMoEquipCT.ins().GCEnchant),e.associated(e.postEquipMy,XinMoEquipCT.ins().intInfo,XinMoEquipCT.ins().GCreplaceXmEquip,XinMoEquipCT.ins().GCEnchant),e.associated(e.postForgeRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,XinMoCT.ins().postInit),e}return __extends(e,t),e.prototype.postTotalRedPointFun=function(){this.totalRedPoint=this.forgeRedPoint;for(var t=0;3>t;t++)if(this.XinmoEquipRedPoint[t]){this.totalRedPoint=!0;break}return!0},e.prototype.postXinmoEquipFun=function(){return!0},e.prototype.postRoleXinmoEquipFun=function(){this.XinmoEquipRedPoint[0]=!1;for(var t=0;3>t;t++){this.roleRedPoint1[t]=!1;var e=SubRoles.ins().getSubRoleByIndex(t);if(this.roleEquipRedPoint[t]=[!1,!1,!1,!1,!1,!1,!1,!1],e){for(var i=0;i<e.xinmoEquipItemData.length;i++){var s=BagCT.ins().getXMPowerEquipByPos(i,ItemType.TYPE_36),n=e.xinmoEquipItemData[i];if(0!=n.configID)for(var o=ItemUtil.calculateBagItemScore(n),a=0;a<s.length;a++){var r=ItemUtil.calculateBagItemScore(s[a]);r>o&&(this.roleRedPoint1[t]=!0,this.XinmoEquipRedPoint[0]=!0,this.roleEquipRedPoint[t][i]=!0)}else s.length>0&&(this.roleEquipRedPoint[t][i]=!0,this.roleRedPoint1[t]=!0,this.XinmoEquipRedPoint[0]=!0)}if(this.printEquipRedPoint[t]=[!1,!1,!1,!1],!XinMoEquipCT.ins().xmEquipInfo)return;for(var i=0;4>i;i++){var l=XinMoEquipCT.ins().xmEquipInfo[t].equipFm[i].mjLv;if(GlobalConfig.DemonsEquipSystemStampLevelConfig[i+1][l+1]){var h=GlobalConfig.DemonsEquipSystemStampLevelConfig[i+1][l].consumeitems,p=h[0].count,u=BagCT.ins().getBagGoodsCountById(0,h[0].id);u>p&&(this.printEquipRedPoint[t][i]=!0,this.roleRedPoint1[t]=!0,this.XinmoEquipRedPoint[0]=!0)}}}}return!0},e.prototype.postForgeEquipFun=function(){this.XinmoEquipRedPoint[1]=!1;for(var t=0;3>t;t++){this.roleRedPoint2[t]=!1;var e=SubRoles.ins().getSubRoleByIndex(t);if(this.forgeEquipRedPoint[t]=[!1,!1,!1,!1,!1,!1,!1,!1],e){if(!XinMoEquipCT.ins().xmEquipInfo)return;for(var i=0;i<e.xinmoEquipItemData.length;i++){var s=XinMoEquipCT.ins().xmEquipInfo[t].equipArr?XinMoEquipCT.ins().xmEquipInfo[t].equipArr[i]:void 0,n=s?s.lv:0;if(XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,i,n+1)){var o=XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,i,n).strengthconsumeitems,a=o[0].count,r=BagCT.ins().getBagGoodsCountById(0,o[0].id);r>a&&(this.forgeEquipRedPoint[t][i]=!0,this.roleRedPoint2[t]=!0,this.XinmoEquipRedPoint[1]=!0)}}}}return!0},e.prototype.postEnchantEquipFun=function(){this.XinmoEquipRedPoint[2]=!1;for(var t=0;3>t;t++){this.roleRedPoint3[t]=!1;var e=SubRoles.ins().getSubRoleByIndex(t);if(this.enchantEquipRedPoint[t]=[!1,!1,!1,!1,!1,!1,!1,!1],e){if(!XinMoEquipCT.ins().xmEquipInfo)return;for(var i=0;i<e.xinmoEquipItemData.length;i++){var s=XinMoEquipCT.ins().xmEquipInfo[t].equipArr?XinMoEquipCT.ins().xmEquipInfo[t].equipArr[i]:void 0;if(0!=s.itemid){var n=GlobalConfig.DemonsEquipSystemEquipConfig[s.itemid].stage;if(GlobalConfig.DemonsEquipSystemStampResetConfig[n]&&GlobalConfig.DemonsEquipSystemStampResetConfig[n+1]){var o=GlobalConfig.DemonsEquipSystemStampResetConfig[n].consumelist,a=o[0].count,r=BagCT.ins().getBagGoodsCountById(0,o[0].id);r>a&&(this.enchantEquipRedPoint[t][i]=!0,this.roleRedPoint3[t]=!0,this.XinmoEquipRedPoint[2]=!0)}}}}}return!0},e.prototype.postForgeRedPoint=function(){this.stageRedPoints=[],this.stagePosRedPoints=[],this.forgeRedPoint=!1;for(var t=[],e=XinMoCT.ins().xinMoDatas[0]?XinMoCT.ins().xinMoDatas[0].stage:Number.MAX_VALUE,i=0;3>i;i++){var s=SubRoles.ins().getSubRoleByIndex(i);if(!s)break;for(var n in s.xinmoEquipItemData){var o=s.xinmoEquipItemData[n].configID;o>0&&t.push(o)}}var a=0,r=GlobalConfig.DemonsEquipMergeTotal;for(var n in r)this.stageRedPoints.push(!1),this.stagePosRedPoints.push([]),a=Math.max(a,r[n].id);var l=BagCT.ins().getBagGoodsByType(ItemType.TYPE_36),h={};for(var n in l){var p=l[n];h[p.configID]?h[p.configID]++:h[p.configID]=1}for(var o in h){var u=GlobalConfig.ItemConfig[o],d=ItemUtil.getSubType(u),c=+o%1e3-1;if(!(c>=a||r[c+1].limit>e)&&(h[o]>2&&(this.stageRedPoints[c]=!0,this.stagePosRedPoints[c][d]=!0,this.forgeRedPoint=!0),2==h[o]))for(var f in t)t.indexOf(+o)>-1&&(this.stageRedPoints[c]=!0,this.stagePosRedPoints[c][d]=!0,this.forgeRedPoint=!0)}return!0},e.prototype.postEquipMy=function(){this.equipMyNum=[[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e)for(var i=0;i<e.xinmoEquipItemData.length;i++)for(var s=XinMoEquipCT.ins().getFmStata(e.xinmoEquipItemData[i]),n=0;4>n;n++)this.equipMyNum[t][n]+=s[n]}return!0},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postTotalRedPointFun",null),__decorate([post()],e.prototype,"postXinmoEquipFun",null),__decorate([post()],e.prototype,"postRoleXinmoEquipFun",null),__decorate([post()],e.prototype,"postForgeEquipFun",null),__decorate([post()],e.prototype,"postEnchantEquipFun",null),__decorate([post()],e.prototype,"postForgeRedPoint",null),__decorate([post()],e.prototype,"postEquipMy",null),e}(BaseSystem);__reflect(XinmoEquipRedPoint.prototype,"XinmoEquipRedPoint"),System.XinmoEquipRedPoint=function(){return XinmoEquipRedPoint.ins()},window.XinmoEquipRedPoint=XinmoEquipRedPoint;var XinMoEquipCastItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReinComposeItemSkin",e.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,e.onChange,e),e.group.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onListChange,e),e.init(),e.redPoint.visible=!1,e}return __extends(e,t),e.prototype.init=function(){this.list.itemRenderer=XinMoEquipCastMenuItem,this._tabListData=new eui.ArrayCollection,this.list.dataProvider=this._tabListData},e.prototype.onListChange=function(){this.isClick=!this.isClick;var t=this.parent.parent.parent;if(t){t.onClickMenu(void 0);for(var e=0;e<t.list1.dataProvider.length;e++){for(var i=t.list1.getVirtualElementAt(e),s=0;s<i.list.dataProvider.length;s++){var n=i.list.getVirtualElementAt(s);n.chosen.visible=!1}i._tabListData.source=[],i._tabListData.refresh()}if(!this.isClick)return void t._tabListData.refresh();this._tabListData.source=XinMoEquipCT.ins().getDemonsEquipcfg(GlobalConfig.DemonsEquipMergeConfig[t.list1.selectedIndex+1]),this._tabListData.refresh()}},e.prototype.onChange=function(){for(var t=0;t<this.list.dataProvider.length;t++){var e=this.list.getVirtualElementAt(t);e.chosen.visible=!1}this.list.getElementAt(this.list.selectedIndex).chosen.visible=!0},e.prototype.dataChanged=function(){this.rein_equips.source=this.data.btn_source;var t=this.data.limit,e=XinMoCT.ins().xinMoDatas.length>0&&XinMoCT.ins().xinMoDatas[0].stage>=t;if(this.touchChildren=this.touchEnabled=e,this.sLimit=e?"":"心魔"+t+"重开启",this.isClick){this.isClick=!1,this._tabListData.source=[],this._tabListData.refresh();var i=this.parent.parent.parent;if(!i)return;var s=XinMoEquipCT.ins().getDemonsEquipcfg(GlobalConfig.DemonsEquipMergeTotal);i._tabListData.refresh(),i._tabListData.source=s}this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.redPoint.visible=XinmoEquipRedPoint.ins().stageRedPoints[this.data.id-1]},e.prototype.openEquipsTips=function(){},e}(BaseItemRender);__reflect(XinMoEquipCastItem.prototype,"XinMoEquipCastItem"),window.XinMoEquipCastItem=XinMoEquipCastItem;var XinMoEquipCastMenuItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ReinComposeLvItemSKin",e.addTouchEvent(e,e.onClick),e.init(),e.redPoint.visible=!1,e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChanged=function(){this.lv.text=this.data.btn_name;var t=GlobalConfig.ItemConfig[this.data.itemID],e=ItemUtil.getSubType(t);this.redPoint.visible=XinmoEquipRedPoint.ins().stagePosRedPoints[this.data.stage-1][e]},e.prototype.openEquipsTips=function(){},e.prototype.onClick=function(t){var e=ViewManager.ins().getView(XinMoEquipMain).XinMoEquipCastSkinPanl;e.onClickMenu(this.data.itemID)},e}(BaseItemRender);__reflect(XinMoEquipCastMenuItem.prototype,"XinMoEquipCastMenuItem"),window.XinMoEquipCastMenuItem=XinMoEquipCastMenuItem;var XinMoEquipCastSelect=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoEquipCastSelectSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.itemList1.itemRenderer=XinmoEquipItem,this.itemList1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectIndex,this),this.itemList1.dataProvider=new eui.ArrayCollection(this.dataList)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.Init(t)},e.prototype.Init=function(t){var e=this,i=t[0],s=BagCT.ins().getXMPowerEquipById(i,ItemType.TYPE_36);t[1]>0&&(s=XinMoEquipCT.ins().getUseEquip(i));for(var n in t[2])if(t[2][n])for(var o in s)s[o].handle==t[2][n].handle&&s.splice(Number(o),1);this.dataList=s,this.itemList1.dataProvider=new eui.ArrayCollection(this.dataList),setTimeout(function(){e.setUseInfo()},200)},e.prototype.setUseInfo=function(){for(var t=this.itemList1.dataProvider.length,e=0;t>e;e++){var i=this.itemList1.getVirtualElementAt(e);i.setUseRole()}},e.prototype.onSelectIndex=function(t){var e=t.itemIndex;ViewManager.ins().open(XinmoTips,this.dataList[e],-1),ViewManager.ins().close(this)},e.prototype.onTouch=function(t){switch(t.target){case this.colorCanvas:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(XinMoEquipCastSelect.prototype,"XinMoEquipCastSelect"),window.XinMoEquipCastSelect=XinMoEquipCastSelect,ViewManager.ins().reg(XinMoEquipCastSelect,LayerManager.UI_Popup);var XinMoEquipCastSkinPanl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoEquipCastSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.list1.itemRenderer=XinMoEquipCastItem,this._tabListData=new eui.ArrayCollection,this.list1.dataProvider=this._tabListData},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(XinmoEquipRedPoint.ins().postForgeRedPoint,this.update),this.update(),this.configId=void 0,this.init()},e.prototype.onClickMenu=function(t){if(void 0==t)return void this.init();this.configId=t,this.init();var e=GlobalConfig.DemonsEquipSystemMonsterForgeConfig[this.configId];this.item2.data=GlobalConfig.ItemConfig[t],this.auto(),this.item5.data={count:0,id:360120,type:1};for(var i=1;4>i;i++)this["itemName"+i].visible=!0;this.itemName1.text=this.item1.data?"":GlobalConfig.ItemConfig[e.material[0].id].name,this.itemName2.text=this.item3.data?"":GlobalConfig.ItemConfig[e.material[1].id].name,this.itemName3.text=this.item4.data?"":GlobalConfig.ItemConfig[e.material[2].id].name;var s=BagCT.ins().getBagGoodsCountById(0,e.material[3].id),n=e.material[3].count,o=s>=n?"0x35E62D":"0xf3311e",a="|C:"+o+"&T:"+s+"|/"+n+"|";this.itemCount.textFlow=TextFlowMaker.generateTextFlow1(a),this.itemCount.visible=!0},e.prototype.update=function(){this._tabListData.source=XinMoEquipCT.ins().getDemonsEquipcfg(GlobalConfig.DemonsEquipMergeTotal)},e.prototype.init=function(){for(var t=1;5>t;t++)this["item"+t].data=void 0;for(var e=1;4>e;e++)this["itemName"+e].visible=!1;this.item2.data=null,this.item5.clearAll();var i=!!this.configId;this.mix3add1.visible=i,this.mix3add3.visible=i,this.mix3add4.visible=i,this.itemCount.visible=!1},e.prototype.setClickState=function(t){var e=GlobalConfig.DemonsEquipSystemMonsterForgeConfig[this.configId];1==this.indexNum&&(this.item1.data=t,this.mix3add1.visible=!1,this.itemName1.text=""),this.indexNum>1&&e&&(this["item"+this.indexNum].data=t,this["mix3add"+this.indexNum].visible=!1,this["itemName"+(this.indexNum-1)].text="")},e.prototype.setRoleId=function(t){},e.prototype.onClick=function(t){var e=GlobalConfig.DemonsEquipSystemMonsterForgeConfig[this.configId],i=[this.item1.data,this.item3.data,this.item4.data];switch(t.target){case this.item1:if(!e)return void this.showNotice();ViewManager.ins().open(XinMoEquipCastSelect,e.material[0].id,2,i),this.indexNum=1;break;case this.item2:this.item2.data&&ViewManager.ins().open(XinmoTips,this.item2.data);break;case this.item3:if(!e)return void this.showNotice();ViewManager.ins().open(XinMoEquipCastSelect,e.material[1].id,0,i),this.indexNum=3;break;case this.item4:if(!e)return void this.showNotice();ViewManager.ins().open(XinMoEquipCastSelect,e.material[2].id,0,i),this.indexNum=4;break;case this.upGradeBtn1:if(!e)return void this.showNotice();this.CGForging();break;case this.eAutoCB:this.auto()}},e.prototype.showNotice=function(){TipsCT.ins().showTips("|C:0xf3311e&T:请选择装备|")},e.prototype.CGForging=function(){if(this.item2&&this.item2.data){var t=GlobalConfig.DemonsEquipSystemMonsterForgeConfig[this.configId].material,e=BagCT.ins().getBagGoodsCountById(0,t[3].id),i=t[3].count;if(!this.item1.data||!this.item3.data||!this.item4.data||i>e)return void TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|");var s=XinMoEquipCT.ins().getIsUseEquip(this.item1.data.handle,this.item1.data.configID),n=s>0?s-1:0,o=s>0?1:0,a=s>0?this.item1.data.configID:this.item1.data.handle,r=[this.item3.data.handle,this.item4.data.handle];XinMoEquipCT.ins().CGForging(n,this.item2.data.id,o,a,r),this.init(),this.removeitem()}},e.prototype.removeitem=function(){for(var t=ViewManager.ins().getView(XinMoEquipMain).XinMoEquipCastSkinPanl,e=0;e<t.list1.dataProvider.length;e++){for(var i=t.list1.getVirtualElementAt(e),s=0;s<i.list.dataProvider.length;s++){var n=i.list.getVirtualElementAt(s);n.chosen.visible=!1}i._tabListData.source=[],i._tabListData.refresh(),t._tabListData.refresh()}},e.prototype.auto=function(){if(this.eAutoCB.selected){var t=this.item2.data;if(t){for(var e=[this.item1,this.item3,this.item4],i=[this.mix3add1,this.mix3add3,this.mix3add4],s=[this.itemName1,this.itemName2,this.itemName3],n=GlobalConfig.DemonsEquipSystemMonsterForgeConfig[t.id].material,o={},a=0;3>a;a++){var r=n[a].id;null==o[r]?o[r]=n[a].count:o[r]+=n[a].count}for(var l=[],a=0;3>a;a++)if(SubRoles.ins().getSubRoleByIndex(a)){var h=SubRoles.ins().getSubRoleByIndex(a).xinmoEquipItemData;for(var p in h)if(o[h[p].configID]){l.push(h[p]);break}if(l.length>0)break}for(var a in o)l=l.concat(BagCT.ins().getXMPowerEquipById(+a,ItemType.TYPE_36));for(var a=0;3>a;a++){var u=n[a];for(var d in l){var c=l[d];if(u.id==c.configID){i[a].visible=!1,s[a].text="",e[a].data=c,l.splice(+d,1);break}}}}}},e}(BaseView);__reflect(XinMoEquipCastSkinPanl.prototype,"XinMoEquipCastSkinPanl"),window.XinMoEquipCastSkinPanl=XinMoEquipCastSkinPanl;var XinMoEquipEnchantSkinPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equips=[],e.indexNum=0,e._sn_="XinMoEquipEnchantSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick);for(var t=0;t<EquipPos.DZI;t++)this.equips[t]=this["equip"+t];this.enchantEffc0=new MovieClip,this.enchantEffc1=new MovieClip,this.enchantEffc2=new MovieClip,this.enchantEffc3=new MovieClip},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(XinMoEquipCT.ins().GCEnchant,this.update),this.observe(XinMoEquipCT.ins().GCEnchant,this.playEnchantEff),this.update()},e.prototype.update=function(){for(var t=0;t<EquipPos.DZI;t++){var e=this.role.xinmoEquipItemData[t];this.equips[t].setCurRole(this.curRole),this.equips[t].data=e,(void 0==e.itemConfig||0==e.itemConfig.id)&&this.equips[t].setItemImg(t>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[t])}this.setClickState(),this.setRedPoint()},e.prototype.setRedPoint=function(){for(var t=XinmoEquipRedPoint.ins().enchantEquipRedPoint[this.curRole],e=0;e<t.length;e++)this.equips[e].setRedPoint(t[e]);return!0},e.prototype.setRoleId=function(t){this.curRole=t,this.role=SubRoles.ins().getSubRoleByIndex(this.curRole),this.indexNum=XinMoEquipCT.ins().EnchantEquipFun(this.curRole),this.skin&&this.update()},e.prototype.initView=function(){this.equipName.text="",this.itemIcon.imgIcon.source=this.indexNum>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[this.indexNum],this.itemIcon.imgBg.source="quality0",this.itemIcon.imgJob.visible=!1;for(var t=0;4>t;t++)this["fm"+t].visible=!1;for(var t=0;t<this.equips.length;t++)this.equips[t].select.visible=!1},e.prototype.setClickState=function(){this.initView();var t=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr?XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr[this.indexNum]:void 0;if(t&&0!=t.itemid){var e=GlobalConfig.ItemConfig[t.itemid];this.itemIcon.imgIcon.source="",this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(e),0!=t.itemid&&(this.equipName.text=e.name,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source=this.equips[this.indexNum].itemIcon.imgIcon.source),this.equips[this.indexNum].select.visible=!0;var i=GlobalConfig.DemonsEquipSystemEquipConfig[t.itemid].stage,s=XinMoEquipCT.ins().getFmStata(this.role.xinmoEquipItemData[this.indexNum]);for(var n in s)this["fm"+n].visible=0!=s[n];this.fmCount=XinMoEquipCT.ins().getFmCount(this.role.xinmoEquipItemData[this.indexNum]);var o=GlobalConfig.DemonsEquipSystemStampResetConfig[i].consumelist,a=!0,r=o[0].count;this.icon0.source=o[0].id+"_png";var l=BagCT.ins().getBagGoodsCountById(0,o[0].id),h=r>l?"|C:0xf3311e&T:"+l+"|":"|C:0x35E62D&T:"+l+"|",p=a?h+"/"+r:"已满级";this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(p)}},e.prototype.playEnchantEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0]&&void 0!=t)for(var i=0;4>i;i++){var s=this["fm"+i];t[0][i]>0&&(this["enchantEffc"+i].playFile(RES_DIR_EFF+"UpEff1",1),this.yjGroup.addChild(this["enchantEffc"+i]),this["enchantEffc"+i].x=s.x+s.width/2,this["enchantEffc"+i].y=s.y+s.height/2)}},e.prototype.onClick=function(t){var e=this,i=this.equips.indexOf(t.target);switch(i>-1&&(this.indexNum=i,this.setClickState()),t.target){case this.upGradeBtn1:var s="当前装备已有"+this.fmCount+"个魔印\n附魔结果不可逆转，是否继续附魔？";if(this.fmCount>2){var n=WarnWin.show(s,function(){e.Intensify()},this);return void n.setBtnLabel("附魔")}this.Intensify()}},e.prototype.Intensify=function(){var t=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr?XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr[this.indexNum]:void 0;if(t&&0!=t.itemid){var e=GlobalConfig.DemonsEquipSystemEquipConfig[t.itemid].stage,i=GlobalConfig.DemonsEquipSystemStampResetConfig[e].consumelist,s=i[0].count,n=BagCT.ins().getBagGoodsCountById(0,i[0].id);return s>n?void TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|"):void XinMoEquipCT.ins().CGEnchant(this.curRole,this.indexNum)}},e}(BaseView);__reflect(XinMoEquipEnchantSkinPanel.prototype,"XinMoEquipEnchantSkinPanel"),window.XinMoEquipEnchantSkinPanel=XinMoEquipEnchantSkinPanel;var XinMoEquipForgeSkinpanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equips=[],e.indexNum=0,e._sn_="XinMoEquipForgeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick);for(var t=0;t<EquipPos.DZI;t++)this.equips[t]=this["equip"+t];this.itemIcon.imgJob.visible=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.observe(XinMoEquipCT.ins().GCIntensify,this.update),this.observe(XinMoEquipCT.ins().GCUpgrade,this.update)},e.prototype.update=function(){for(var t=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr,e=0;e<EquipPos.DZI;e++){var i=this.role.xinmoEquipItemData[e];this.equips[e].setCurRole(this.curRole),this.equips[e].data=i,this.equips[e].plus.text="+"+t[e].lv,(void 0==i.itemConfig||0==i.itemConfig.id)&&this.equips[e].setItemImg(e>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[e])}this.setClickState(),this.setRedPoint()},e.prototype.setRoleId=function(t){this.curRole=t,this.role=SubRoles.ins().getSubRoleByIndex(this.curRole),this.indexNum=XinMoEquipCT.ins().ForgeEquipFun(this.curRole),this.skin&&this.update()},e.prototype.setClickState=function(){for(var t=0;t<this.equips.length;t++)this.equips[t].select.visible=t==this.indexNum;var e=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr?XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr[this.indexNum]:void 0,i=e?e.lv:0,s=GlobalConfig.ItemConfig[e.itemid];this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(s),0!=e.itemid?(this.equipName.text=s.name,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source=this.equips[this.indexNum].itemIcon.imgIcon.source):(this.equipName.text="",this.itemIcon.imgIcon.source=this.indexNum>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[this.indexNum]);
var n=XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,i).levelattrs,o=XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,i+1).levelattrs,a=!!o;this.cursor0.visible=this.curAtt0.visible=this.nextAtt0.visible=a,this.fullAtt0.visible=!a;var r=o?this.curAtt0:this.fullAtt0;r.height=0,r.text="";for(var l=o?o.length:n.length,t=0;l>t;t++){var h=n[t]?AttributeData.getAttrStrByType(n[t].type):AttributeData.getAttrStrByType(o[t].type),p=n[t]?n[t].value:0;r.text+=h+":"+p+"\n",r.height+=20}this.nextAtt0.height=0,this.nextAtt0.text="";GlobalConfig.DemonsEquipSystemUpgradeConfig[this.indexNum][e.stage].levelequiprate;if(this.jjTitle.text=GlobalConfig.DemonsEquipSystemUpgradeConfig[this.indexNum][e.stage].levelequiprateshow,this.jjLv.text=e.stage,o){for(var t=0;t<o.length;t++){var h=AttributeData.getAttrStrByType(o[t].type);this.nextAtt0.text+=h+":"+o[t].value+"\n",this.nextAtt0.height+=20}this.upGradeBtn1.label="强化",this.upGradeBtn1.currentState="up",this.upGradeBtn1.touchEnabled=!0}else this.upGradeBtn1.label="已满级",this.upGradeBtn1.currentState="disabled",this.upGradeBtn1.touchEnabled=!1;var u=XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,i).strengthconsumeitems.length>0?XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,i).strengthconsumeitems:XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,i-1).strengthconsumeitems,d=u[0].count,c=BagCT.ins().getBagGoodsCountById(0,u[0].id),f=d>c?"|C:0xf3311e&T:"+c+"|":"|C:0x35E62D&T:"+c+"|";this.icon0.source=u[0].id+"_png";var g=o?f+"/"+d:"已满级";this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(g)},e.prototype.onClick=function(t){var e=this.equips.indexOf(t.target);switch(e>-1&&(this.indexNum=e,this.setClickState()),t.target){case this.checkBtn0:ViewManager.ins().open(XinMoEvoSkinWin,this.indexNum,this.curRole);break;case this.upGradeBtn1:this.Intensify()}},e.prototype.setRedPoint=function(){for(var t=XinmoEquipRedPoint.ins().forgeEquipRedPoint[this.curRole],e=0;e<t.length;e++)this.equips[e].setRedPoint(t[e]);return!0},e.prototype.Intensify=function(){var t=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr?XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipArr[this.indexNum]:void 0,e=t?t.lv:0,i=XinMoEquipCT.ins().getDemonsEquipSystemStrengthConfig(GlobalConfig.DemonsEquipSystemStrengthConfig,this.indexNum,e).strengthconsumeitems;for(var s in i){var n=i[s].count,o=BagCT.ins().getBagGoodsCountById(0,i[s].id);if(n>o)return void TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|")}XinMoEquipCT.ins().CGIntensify(this.curRole,this.indexNum)},e}(BaseView);__reflect(XinMoEquipForgeSkinpanel.prototype,"XinMoEquipForgeSkinpanel"),window.XinMoEquipForgeSkinpanel=XinMoEquipForgeSkinpanel;var XinmoEquipItem=function(t){function e(){var e=t.call(this)||this;return e._curRole=-1,e.skinName="XinmoEquipItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.framkEff=new MovieClip,this.addChildAt(this.framkEff,2),this.framkEff.visible=!1,this.framkEff.x=this.itemIcon.x+40,this.framkEff.y=this.itemIcon.y+38,this.itemIcon.imgJob.visible=!1,this.select.visible=!1,this.touchEnabled=!0,this.touchChildren=!1;for(var t=0;4>t;t++)this["yjIcon"+t].visible=!1},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.setImgBg(0),this.data)var e=this.data.configID?this.data.configID:this.data.id;if(this.data&&e){this.itemConfig=GlobalConfig.ItemConfig[e],this.setName(this.itemConfig.name),this.setItemImg(this.itemConfig.icon+"_png");var i=ItemUtil.getQuality(this.itemConfig);this.setImgBg(i),this.level.textColor=ItemBase.QUALITY_COLOR[i],this.itemIcon.setTag("zz_jj"+(GlobalConfig.DemonsEquipSystemEquipConfig[this.itemConfig.id].stage+1))}else{this.setName(""),this.itemIcon.setTag(""),this.setItemImg("");for(var s=0;4>s;s++)this["yjIcon"+s].visible=!1}this.showEff(this.getHasEquip()),this.setMyIcon()},e.prototype.setMyIcon=function(){if(this.data&&this.data.extAtt)for(var t=XinMoEquipCT.ins().getFmStata(this.data),e=0;e<t.length;e++)this["yjIcon"+e].visible=0!=t[e];else for(var i=0;4>i;i++)this["yjIcon"+i].visible=!1},e.prototype.setUseRole=function(){var t=XinMoEquipCT.ins().getIsUseEquip(this.data.handle,this.data.configID);if(t>0){this.useRole.visible=!0;var e=SubRoles.ins().getSubRoleByIndex(t-1),i=Role.getJobNameByJob(e.job);this.useRole.text=i+"\n穿戴中"}else this.useRole.visible=!1},e.prototype.openEquipsTips=function(){},e.prototype.showPower=function(){this.openEquipsTips()},e.prototype.setCurRole=function(t){this._curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.getHasEquip=function(){return null!=this.data&&0!=this.data.configID},e.prototype.showEff=function(t){this.framkEff.visible=t;var e=ItemUtil.getEffName(this.itemConfig);""!=e?this.framkEff.playFile(RES_DIR_EFF+e,-1):this.framkEff.visible=!1},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e.prototype.setImgBg=function(t){this.itemIcon.imgBg.source="quality"+t},e.prototype.setName=function(t){this.level.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.hideName=function(){this.level.visible=!1},e}(BaseItemRender);__reflect(XinmoEquipItem.prototype,"XinmoEquipItem"),window.XinmoEquipItem=XinmoEquipItem;var XinMoEquipMain=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoEquipMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.roleSelect,this.switchRole),this.addChangeEvent(this.tab,this.onTabTouch),this.panelArr=[this.XinMoEquipRoleSkinPanel,this.XinMoEquipForgeSkinpanel,this.XinMoEquipEnchantSkinPanel,this.XinMoEquipCastSkinPanl],this.switchRole()},e.prototype.onTabTouch=function(t){return this.panelArr[this.tab.selectedIndex]==this.XinMoEquipCastSkinPanl?void this.roleSelect.hideRole():(this.roleSelect.openRole(),this.roleSelect.visible=!0,this.panelArr[this.tab.selectedIndex].setRoleId(this.currentRoleID),void this.setRedPoint())},e.prototype.switchRole=function(){this.currentRoleID=this.roleSelect.getCurRole(),this.panelArr[this.eSelectViewStack.selectedIndex].setRoleId(this.roleSelect.getCurRole()),this.setRedPoint()},e.prototype.setRedPoint=function(){this.redPoint0.visible=this.redPoint1.visible=this.redPoint2.visible=this.redPoint3.visible=!1;var t=SubRoles.ins().subRolesLen;if(this.currentRoleID<3)for(var e=0;t>e;e++)this.roleSelect.showRedPoint(e,XinmoEquipRedPoint.ins().totalroleRedPoint[this.tab.selectedIndex]?XinmoEquipRedPoint.ins().totalroleRedPoint[this.tab.selectedIndex][e]:!1);return this.redPoint0.visible=XinmoEquipRedPoint.ins().XinmoEquipRedPoint[0],this.redPoint1.visible=XinmoEquipRedPoint.ins().XinmoEquipRedPoint[1],this.redPoint2.visible=XinmoEquipRedPoint.ins().XinmoEquipRedPoint[2],this.redPoint3.visible=XinmoEquipRedPoint.ins().forgeRedPoint,!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=t[0]?t[0]:0,s=0,n=this.panelArr;s<n.length;s++){var o=n[s];o.setRoleId(i)}this.roleSelect.setCurRole(i),this.observe(XinmoEquipRedPoint.ins().postTotalRedPointFun,this.setRedPoint)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.XinMoEquipRoleSkinPanel&&this.XinMoEquipRoleSkinPanel.bodyMc&&this.XinMoEquipRoleSkinPanel.bodyMc.stop(),ViewManager.ins().open(XinMoWin)},e}(BaseEuiView);__reflect(XinMoEquipMain.prototype,"XinMoEquipMain"),window.XinMoEquipMain=XinMoEquipMain,ViewManager.ins().reg(XinMoEquipMain,LayerManager.UI_Main);var XinMoEquipRoleSkinPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curRole=0,e.equips=[],e._sn_="XinMoEquipRoleSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.yjs=[this.yj1,this.yj2,this.yj3,this.yj4];for(var t=0;t<EquipPos.DZI;t++)this.equips[t]=this["item"+t];this.bodyMc=new MovieClip,this.bodyEff1.addChild(this.bodyMc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.observe(XinMoEquipCT.ins().GCreplaceXmEquip,this.update),this.observe(XinMoEquipCT.ins().GCMyLevel,this.update),this.observe(XinMoEquipCT.ins().GCMyPower,this.update),this.observe(XinmoEquipRedPoint.ins().postEquipMy,this.update)},e.prototype.update=function(){for(var t=0;t<EquipPos.DZI;t++){var e=this.role.xinmoEquipItemData[t];this.equips[t].setCurRole(this.curRole),this.equips[t].data=e,(void 0==e.itemConfig||0==e.itemConfig.id)&&this.equips[t].setItemImg(t>EquipPos.DZI?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[t])}var i=XinMoEquipCT.ins().xmEquipInfo[this.curRole].rolePower;this.powerPanel.setPower(i),this.setMy(),this.setRedPoint();var s=SubRoles.ins().getSubRoleByIndex(this.curRole);0==s.sex?this.bodyMc.playFile(RES_DIR_EFF+"xinmomaneff",-1):this.bodyMc.playFile(RES_DIR_EFF+"xinmowomaneff",-1)},e.prototype.setRoleId=function(t){this.curRole=t,this.role=SubRoles.ins().getSubRoleByIndex(this.curRole),this.skin&&this.update()},e.prototype.setMy=function(){for(var t=XinmoEquipRedPoint.ins().equipMyNum[this.curRole],e=1;5>e;e++)this["yjTxt"+e].text=t[e-1]+"/8"},e.prototype.setRedPoint=function(){for(var t=XinmoEquipRedPoint.ins().roleEquipRedPoint[this.curRole],e=0;e<t.length;e++)this.equips[e].setRedPoint(t[e]);for(var i=XinmoEquipRedPoint.ins().printEquipRedPoint[this.curRole],s=0;4>s;s++)this["redPoint"+s].visible=i[s];return!0},e.prototype.onClick=function(t){if(t.target instanceof XinmoEquipItem){var e=this.equips.indexOf(t.target),i=t.target;if(i.getHasEquip()){var s=this.role.xinmoEquipItemData[e];ViewManager.ins().open(XinmoTips,s,1,this.curRole,e)}else ViewManager.ins().open(RoleChooseEquipWin,this.curRole,e,ItemType.TYPE_36)}else switch(t.target){case this.yj1:case this.yj2:case this.yj3:case this.yj4:var e=this.yjs.indexOf(t.target);ViewManager.ins().open(XinMoImprintSkinWin,e,this.curRole)}},e}(BaseView);__reflect(XinMoEquipRoleSkinPanel.prototype,"XinMoEquipRoleSkinPanel"),window.XinMoEquipRoleSkinPanel=XinMoEquipRoleSkinPanel;var XinMoEvoSkinWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoEvoSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.param=t;var i=XinMoEquipCT.ins().xmEquipInfo[t[1]].equipArr?XinMoEquipCT.ins().xmEquipInfo[t[1]].equipArr[t[0]]:void 0,s=GlobalConfig.DemonsEquipSystemUpgradeConfig[t[0]][i.stage+1],n=!!s;this.nextAtt0.visible=n,this.curAtt0.visible=n,this.curAtt0.visible=n,this.fullAtt0.visible=!n;var o=s?this.curAtt0:this.fullAtt0;o.height=20,o.text="";var a=XinMoEquipCT.ins().isUpgrade(t[1],t[0]),r=a?"0x35E62D":"0xf3311e",l=10*i.stage+10;n||(r="0xB1B097",l=10*i.stage);var h="装备强化等级达到"+l+"级(|C:"+r+"&T:"+i.lv+"|/"+l+")|";this.upGradeBtn1.currentState=a?"up":"disabled",this.upGradeBtn1.touchEnabled=a,this.title.textFlow=TextFlowMaker.generateTextFlow1(h),o.text=GlobalConfig.DemonsEquipSystemUpgradeConfig[t[0]][i.stage].levelequiprateshow,this.nextAtt0.height=20,this.nextAtt0.text="",s?(this.nextAtt0.text=s.levelequiprateshow,this.upGradeBtn1.label="进化",this.upGradeBtn1.currentState="up",this.upGradeBtn1.touchEnabled=!0,this.lab1.text="进化"+i.stage+"阶",this.lab2.text="进化"+(i.stage+1)+"阶",this.nextimg.visible=!0,this.ismax.visible=!1):(this.upGradeBtn1.label="已满级",this.upGradeBtn1.currentState="disabled",this.upGradeBtn1.touchEnabled=!1,this.lab2.visible=!1,this.lab1.visible=this.lab1.visible=this.nextimg.visible=!1,this.ismax.visible=!0),a||(this.upGradeBtn1.currentState="disabled",this.upGradeBtn1.touchEnabled=!1);var p=GlobalConfig.DemonsEquipSystemUpgradeConfig[t[0]][i.stage].stageconsumeitems.length>0?GlobalConfig.DemonsEquipSystemUpgradeConfig[t[0]][i.stage].stageconsumeitems:GlobalConfig.DemonsEquipSystemUpgradeConfig[t[0]][i.stage-1].stageconsumeitems,u=p[0].count,d=BagCT.ins().getBagGoodsCountById(0,p[0].id);this.icon1.source=p[0].id+"_png";var c=u>d?"|C:0xf3311e&T:"+d+"|":"|C:0x35E62D&T:"+d+"|",f=s?c+"/"+u:"已满级";this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1(f)},e.prototype.onTouch=function(t){switch(t.target){case this.colorCanvas:ViewManager.ins().close(this);break;case this.upGradeBtn1:this.Intensify()}},e.prototype.Intensify=function(){var t=XinMoEquipCT.ins().xmEquipInfo[this.param[1]].equipArr?XinMoEquipCT.ins().xmEquipInfo[this.param[1]].equipArr[this.param[0]]:void 0,e=GlobalConfig.DemonsEquipSystemUpgradeConfig[this.param[0]][t.stage].stageconsumeitems;for(var i in e){var s=e[i].count,n=BagCT.ins().getBagGoodsCountById(0,e[i].id);if(s>n)return void TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|")}XinMoEquipCT.ins().CGUpgrade(this.param[1],this.param[0]),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(XinMoEvoSkinWin.prototype,"XinMoEvoSkinWin"),window.XinMoEvoSkinWin=XinMoEvoSkinWin,ViewManager.ins().reg(XinMoEvoSkinWin,LayerManager.UI_Popup);var XinMoImprintItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="XinMoImprintItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChanged=function(){var t=this.data[0],e=GlobalConfig.DemonsEquipSystemStampEffectConfig[t.type][t.level+4][t.effectkind],i=this.data[1];this.nametxt=GlobalConfig.DemonsEquipStampEffectConfig[t.effectkind].nametxt;var s=["修罗印记","原始印记","婆罗印记","天魔印记"],n=XinMoEquipCT.ins().xmEquipInfo[i].equipFm[t.type-1].mjLv,o=XinmoEquipRedPoint.ins().equipMyNum[i][t.type-1],a=o>=t.count&&n>=t.level,r=a?"0x00FF00":"0xf3311e",l=r,h=a?"0x00FF00":"0xB1B097",p="|C:"+h+"&T:穿戴"+s[t.type-1]+"装备||C:"+l+"&T:"+o+"||C:"+h+"&T:/"+t.count+"件激活|";this.sStateFlow1=TextFlowMaker.generateTextFlow1(p),this.sStateFlow2=TextFlowMaker.generateTextFlow1(t.level+" 级"+s[t.type-1]+":  |C:"+r+"&T:"+this.getStr(t)+"|"),this.sDescFlow=TextFlowMaker.generateTextFlow1(e.level+" 级"+s[e.type-1]+":  |C:"+l+"&T:"+this.getStr(e)+"|");var u=s[t.type-1]+t.level+"级解锁";this.sStateFlow3=TextFlowMaker.generateTextFlow1(u),this.isLock=n<t.level,this.group.visible=!this.isLock},e.prototype.getStr=function(t){var e="",i=t.effect,s=t.effectrateshow;for(var n in i)e+=AttributeData.getAttrStrByType(i[n].type)+"+"+i[n].value;return s&&(e+=s),e},e}(BaseItemRender);__reflect(XinMoImprintItem.prototype,"XinMoImprintItem"),window.XinMoImprintItem=XinMoImprintItem;var XinMoImprintSkinWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoImprintSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.list0.itemRenderer=XinMoImprintItem,this._tabListData=new eui.ArrayCollection,this.list0.dataProvider=this._tabListData},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0]+1,this.curRole=t[1],this.update(),this.observe(XinMoEquipCT.ins().GCMyLevel,this.update)},e.prototype.update=function(){var t=["修罗印记","原始印记","婆罗印记","天魔印记"];this.abilityName.text=t[this.type-1];var e=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipFm[this.type-1].mjLv;this.lv.text=e+"级",this.myImg.source="XinMoyinji"+this.type+"_png";var i=XinmoEquipRedPoint.ins().equipMyNum[this.curRole][this.type-1];this.myStata.text=i+"/8";var s=XinMoEquipCT.ins().getDemonsEquipSystemStampEffectConfig(this.type,1),n=[];for(var o in s)n.push([s[o],this.curRole]);this._tabListData.source=n,this.list0.dataProviderRefreshed(),GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][e+1]||(this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1("已满级"));var a=GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][e].consumeitems.length>0?GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][e].consumeitems:GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][e-1].consumeitems,r=a[0].count;this.icon1.source=a[0].id+"_png";var l=BagCT.ins().getBagGoodsCountById(0,a[0].id),h=r>l?"|C:0xf3311e&T:"+l+"|":"|C:0x35E62D&T:"+l+"|",p=GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][e+1]?h+"/"+r:"已满级";this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1(p)},e.prototype.onTouch=function(t){switch(t.target){case this.colorCanvas:ViewManager.ins().close(this);break;case this.upGradeBtn1:this.MyLevel()}},e.prototype.MyLevel=function(){var t=XinMoEquipCT.ins().xmEquipInfo[this.curRole].equipFm[this.type-1].mjLv;if(GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][t+1]){var e=GlobalConfig.DemonsEquipSystemStampLevelConfig[this.type][t].consumeitems,i=e[0].count,s=BagCT.ins().getBagGoodsCountById(0,e[0].id);return i>s?void TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|"):void XinMoEquipCT.ins().CGMyLevel(this.curRole,this.type)}},e}(BaseEuiView);__reflect(XinMoImprintSkinWin.prototype,"XinMoImprintSkinWin"),window.XinMoImprintSkinWin=XinMoImprintSkinWin,ViewManager.ins().reg(XinMoImprintSkinWin,LayerManager.UI_Popup);var XinmoTips=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinmoTipsSkin",e._bottomY2=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t[0]instanceof ItemData){this.itemConfig=t[0],this.configID=t[0].configID;var i=t[1]>=0;this.changeBtn0.visible=i,this.changeBtn.visible=i,this.changeBtn1.visible=!i,this.pos=t[3],this.rolecurl=t[2],this.isCast=!i,void 0==t[2]&&void 0==t[1]&&(this.changeBtn0.visible=!1,this.changeBtn.visible=!1,this.changeBtn1.visible=!1)}else this.configID=t[0].id,this.changeBtn0.visible=!1,this.changeBtn.visible=!1,this.changeBtn1.visible=!1;this.itemIcon.data=t[0],this.itemIcon.hideName(),this.setMyIcon(),this.setData(GlobalConfig.ItemConfig[this.configID])},e.prototype.setData=function(t){var e=t.id,i=GlobalConfig.DemonsEquipSystemEquipConfig[e].pos;this.type.text=Role.getEquipNameByType(i),this.nameLabel.text=t.name,this.lv.text=GlobalConfig.DemonsEquipSystemEquipConfig[e].stage+1+"阶";var s=GlobalConfig.EquipConfig[e],n=[];this._bottomY2+=0;var o=this.createLabel(this.forgeGroup,"",10458221,"left",45);for(var a in Role.translate)if(!isNaN(s[a])&&s[a]){var r="";r+=AttributeData.getAttrStrByType(Role.getAttrTypeByName(a))+"  ",r+=s[a];var l=new AttributeData;l.type=Role.getAttrTypeByName(a),l.value=s[a],n.push(l),o.text+=r+"\n",o.height+=20,this._bottomY2+=20}var h=[];if(s.baseAttr1&&h.push(s.baseAttr1),s.baseAttr2&&h.push(s.baseAttr2),h)for(var p in h){var u=AttributeData.getAttrStrByType(h[p].type);o.text+=u+":"+h[p].value+"\n",o.height+=20,this._bottomY2+=20}this.yjGroup.y=this._bottomY2+40;var d=Math.floor(BagCT.getAttrPower(n));this.score.text="评分："+d,this.powerPanel.setPower(d),this.background.height=this.powerPanel.y+this.powerPanel.height+this._bottomY2+52+this.yjGroup.height,this.bgGroup.y=this.background.y+this.background.height},e.prototype.setMyIcon=function(){if(this.itemConfig&&this.itemConfig.extAtt)for(var t=XinMoEquipCT.ins().getFmStata(this.itemConfig),e=0;e<t.length;e++)this["yjIcon"+e].source=0!=t[e]?"XinMoyinji"+(e+1)+"_png":"XinMoyinji"+(e+1)+"b_png";else for(var i=0;4>i;i++)this["yjIcon"+i].source="XinMoyinji"+(i+1)+"b_png"},e.prototype.createLabel=function(t,e,i,s,n){var o=new eui.Label;return o.size=18,o.width=250,o.fontFamily="Arial",o.textColor=13746831,o.text=e,o.anchorOffsetX=0,o.anchorOffsetY=0,o.textAlign=s,o.textColor=i,t.addChild(o),o.y=this._bottomY2+=9,this._bottomY2=o.y+o.height,o.x+=n,o},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.changeBtn0:XinMoEquipCT.ins().CGreplaceXmEquip(0,this.rolecurl,this.pos),ViewManager.ins().close(this);break;case this.changeBtn:ViewManager.ins().open(RoleChooseEquipWin,this.rolecurl,this.pos,ItemType.TYPE_36),ViewManager.ins().close(this);break;case this.changeBtn1:this.onClick()}},e.prototype.onClick=function(){if(this.isCast){var t=ViewManager.ins().getView(XinMoEquipMain);if(!t)return;var e=t.XinMoEquipCastSkinPanl;if(!e)return;e.setClickState(this.itemConfig)}else XinMoEquipCT.ins().CGreplaceXmEquip(this.configID,this.rolecurl,this.pos);ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(XinmoTips.prototype,"XinmoTips"),window.XinmoTips=XinmoTips,ViewManager.ins().reg(XinmoTips,LayerManager.UI_Popup);var XinMoFbCT=function(t){function e(){var e=t.call(this)||this;return e.bagCount=0,e.handleData=[],e.sysId=PackageID.Xmhj,e.regNetMsg(1,e.intInfo),e.regNetMsg(2,e.postFb),e.regNetMsg(3,e.updateLucky),e.regNetMsg(5,e.updateBag),e.regNetMsg(6,e.endAlert),e.regNetMsg(9,e.GCscenChange),e.regNetMsg(12,e.GCLuckChange),e.regNetMsg(14,e.postHandle),e.regNetMsg(15,e.postScreenMon),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"isXMHJ",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_XMHJ},enumerable:!0,configurable:!0}),e.prototype.getBelongHandle=function(){var t=this.getHandleNum(GameLogic.ins().currAttackHandle);return(t||0==t)&&this.handleData[t]?this.handleData[t].belongHandle:0},e.prototype.getHandleNum=function(t){if(0==this.handleData.length)return 0;for(var e=0;e<this.handleData.length;e++)if(t==this.handleData[e].monsHandle)return e},e.prototype.intInfo=function(t){this.allInfo=[],this.xmBag=[],this.luckynumarr==[];var e=t.readByte();if(e&&e>0)for(var i=0;e>i;i++)this.allInfo[i]=[t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readByte(),t.readInt()];var s=t.readShort();if(s&&s>0){for(var i=0;s>i;i++){var n={id:t.readInt(),count:t.readInt(),type:1};this.xmBag.push(n)}this.bagCount=0;for(var i in this.xmBag)this.bagCount+=this.xmBag[i].count}this.luckyNum=t.readInt(),this.luckynumarr=[t.readByte(),t.readByte(),t.readByte()]},e.prototype.postHandle=function(t){var e=t.readByte(),i=t.readDouble(),s=t.readDouble(),n=this.getHandleNum(i);e==this.sceneNo&&(n||0==n)&&this.handleData&&this.handleData[n]&&(this.handleData[n].belongHandle=s)},e.prototype.postScreenMon=function(t){var e=(t.readByte(),t.readByte());this.handleData=[];for(var i=0;e>i;i++){var s={monsHandle:t.readDouble(),belongHandle:t.readDouble()};this.handleData.push(s)}},e.prototype.sendFb=function(t){var e=this,i=GlobalConfig.DemonsDreamlandChapterConfig[t+1].level,s=XinMoCT.ins().xinMoDatas[0].stage;return i>s?void TipsCT.ins().showTips("需要心魔等级达到"+i+"级"):void WarnWin.show("您所前往的地图过于凶险\n 死亡后会损失收益,请了解规则后再进入 \n 是否确定立即前往?",function(){var i=e.getBytes(2);i.writeInt(t+1),e.sendToServer(i)},this)},e.prototype.postFb=function(t){var e=t.readByte();switch(e){case 0:this.sceneNo=t.readShort(),this.addOutEff();break;case 1:TipsCT.ins().showTips("开服条件不满足");break;case 2:TipsCT.ins().showTips("转生等级不够");break;case 3:var i=GlobalConfig.DemonsDreamlandBaseConfig.opentime[0][0],s=GlobalConfig.DemonsDreamlandBaseConfig.opentime[1][0];TipsCT.ins().showTips("幻境副本在"+i+"点-"+s+"点开启");break;case 4:TipsCT.ins().showTips("元宝不够（无法兑换回城卷轴）")}},e.prototype.uselucky=function(t,e){var i=this.isUseLuck(t);if(!i)return void TipsCT.ins().showTips("幸运值已达到上限");var s=this.getBytes(3);s.writeInt(t),s.writeInt(e),this.sendToServer(s)},e.prototype.updateLucky=function(t){this.luckyNum=t.readInt();var i=t.readInt(),s=t.readByte(),n=e.ins().getxmcfg();for(var o in n)n[o].id==i&&(this.luckynumarr[o]+=s)},e.prototype.endAlert=function(t){for(var e=t.readByte(),i=t.readShort(),s=[],n=0;i>n;n++){var o={id:t.readInt(),type:1,count:t.readInt()};s.push(o)}switch(this.bagCount=0,e){case 1:ResultManager.ins().create(FbCT.FB_TYPE_XMHJ,1,s,"获得奖励如下：");break;case 2:var a=t.readString();ViewManager.ins().open(XinMoFbDead,s,a);break;case 3:var r="很遗憾，您本次没有很获得任何收益；\n 魔域凶险万分，请再接再厉";ResultManager.ins().create(FbCT.FB_TYPE_XMHJ,0,0,r)}},e.prototype.CGrebuild=function(){this.sendBaseProto(8)},e.prototype.CGscenChange=function(){this.sendBaseProto(9)},e.prototype.GCscenChange=function(t){return this.sceneNo=t.readByte(),this.addOutEff(),this.sceneNo},e.prototype.GCLuckChange=function(t){this.luckyNum=t.readInt()},e.prototype.useBackstamps=function(t){var e=t?1:0,i=this.getBytes(10);i.writeByte(e),this.sendToServer(i)},e.prototype.updateBag=function(t){var e=t.readByte(),i=t.readShort(),s=[];if(i&&i>0){for(var n=0;i>n;n++){var o=t.readInt(),a={id:o,count:t.readInt(),type:1};s[o]?s[o].count+=a.count:s[o]=a,DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),a])}DropHelp.start()}this.updateXmBag(e,s)},e.prototype.updateXmBag=function(t,e){if(1==t){for(var i in this.xmBag)e[this.xmBag[i].id]&&(this.xmBag[i].count+=e[this.xmBag[i].id].count,e[this.xmBag[i].id].count=0);if(e.length>0)for(var s in e)e[s].count>0&&this.xmBag.push(e[s])}else if(2==t)for(var n in e)e[this.xmBag[n].id]&&(this.xmBag[n].count-=e[this.xmBag[n].id].count);this.bagCount=0;for(var i in this.xmBag)this.bagCount+=this.xmBag[i].count},e.prototype.getxmcfg=function(){var t=[],e=GlobalConfig.DemonsDreamlandElixirConfig;for(var i in e)t.push(e[i]);return t},e.prototype.isUseLuck=function(t){var i=GlobalConfig.DemonsDreamlandBaseConfig.luckyValue,s=GlobalConfig.DemonsDreamlandElixirConfig[t].luckval+e.ins().luckyNum;return i>=s},e.prototype.addOutEff=function(){var t=GlobalConfig.DemonsDreamlandSceneConfig[this.sceneNo].transPos;for(var e in t){var i=t[e][0]*GameMap.CELL_SIZE,s=t[e][1]*GameMap.CELL_SIZE;GameLogic.ins().addOutEff(i,s)}},__decorate([post()],e.prototype,"intInfo",null),__decorate([post()],e.prototype,"postHandle",null),__decorate([post()],e.prototype,"postScreenMon",null),__decorate([post()],e.prototype,"postFb",null),__decorate([post()],e.prototype,"updateLucky",null),__decorate([post()],e.prototype,"endAlert",null),__decorate([post()],e.prototype,"GCscenChange",null),__decorate([post()],e.prototype,"GCLuckChange",null),__decorate([post()],e.prototype,"updateBag",null),e}(BaseSystem);__reflect(XinMoFbCT.prototype,"XinMoFbCT"),System.XinMoFbCT=function(){return XinMoFbCT.ins()},window.XinMoFbCT=XinMoFbCT;var WarnXmhjWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="warnXmhjSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.notBtn:ViewManager.ins().close(this);break;case this.sureBtn:XinMoFbCT.ins().useBackstamps(1),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WarnXmhjWin.prototype,"WarnXmhjWin"),window.WarnXmhjWin=WarnXmhjWin,ViewManager.ins().reg(WarnXmhjWin,LayerManager.UI_Popup);var XinMoBack=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoBackSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setInfo()},e.prototype.setInfo=function(){var t=GlobalConfig.DemonsDreamlandBaseConfig.backbookid,e=GlobalConfig.ItemConfig[t],i={id:t,count:1,type:ItemUtil.getType(e)},s=BagCT.ins().getBagGoodsCountById(0,t);this.pay=GlobalConfig.DemonsDreamlandBaseConfig.backbookprice+"元宝",0>=s?this.hasback=!1:this.hasback=!0,this.nohasback=!this.hasback,this.item0.data=i},e.prototype.onTouch=function(t){switch(t.target){case this.colorCanvas:case this.closeBtn:ViewManager.ins().close(this);break;case this.sure:this.nohasback&&Actor.yb<GlobalConfig.DemonsDreamlandBaseConfig.backbookprice&&(TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this)),XinMoFbCT.ins().useBackstamps(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(XinMoBack.prototype,"XinMoBack"),window.XinMoBack=XinMoBack,ViewManager.ins().reg(XinMoBack,LayerManager.UI_Popup);var XinMoFbDead=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoFbDeadSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.itemList1.itemRenderer=ItemBase},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t[0]&&(this.itemList1.dataProvider=new eui.ArrayCollection(t[0]),this.content.text="你被"+t[1]+"击杀了，掉落了：",Timer.stop(this.refushLabel,this),this.remainM=5,this.reliveTimesTxt.text=this.remainM+"秒",Timer.start(1e3,5,this.refushLabel,this),this.price.setText(GlobalConfig.DemonsDreamlandBaseConfig.rebornyuanbao.toString()))},e.prototype.close=function(){Timer.stop(this.refushLabel,this)},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒",this.remainM<=0&&this.overTime()},e.prototype.overTime=function(){Timer.stop(this.refushLabel,this),ViewManager.ins().close(this),FbCT.ins().sendExitFb()},e.prototype.onTouch=function(t){switch(t.target){case this.exitBtn:FbCT.ins().sendExitFb(),ViewManager.ins().close(this);break;case this.rebuildBtn:Actor.yb<GlobalConfig.DemonsDreamlandBaseConfig.rebornyuanbao&&(TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this)),XinMoFbCT.ins().CGrebuild(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(XinMoFbDead.prototype,"XinMoFbDead"),window.XinMoFbDead=XinMoFbDead,ViewManager.ins().reg(XinMoFbDead,LayerManager.UI_Popup);var XinMoFbPreview=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoFbPreviewSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch),this.itemList0.itemRenderer=ItemBase},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.abilityName.text=t[0],this.itemList0.dataProvider=new eui.ArrayCollection(t[1])},e.prototype.onTouch=function(t){switch(t.target){case this.colorCanvas:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(XinMoFbPreview.prototype,"XinMoFbPreview"),window.XinMoFbPreview=XinMoFbPreview,ViewManager.ins().reg(XinMoFbPreview,LayerManager.UI_Popup);var XinMoFbUI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoFbUISkin",e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.updateHeadIcon(),this.observe(GameLogic.ins().postHpChange,this.updateHead),this.update(),Timer.start(1e3,0,this.update,this),this.observe(XinMoFbCT.ins().updateLucky,this.update),this.observe(XinMoFbCT.ins().GCLuckChange,this.update),this.observe(XinMoFbCT.ins().GCscenChange,this.onGCscenChange),this.observe(XinMoFbCT.ins().postFb,this.onGCscenChange),this.observe(XinMoFbCT.ins().updateBag,this.update),this.observe(BagCT.ins().postItemCountChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.initHp(),this.updateTips()},e.prototype.close=function(){Timer.stop(this.update,this)},e.prototype.onGCscenChange=function(){this.updateTips(),this.update()},e.prototype.updateTips=function(){this.sTips=GlobalConfig.DemonsDreamlandSceneConfig[XinMoFbCT.ins().sceneNo].sceneTips},e.prototype.onTouch=function(t){switch(t.target){case this.target4:case this.target1:case this.target2:case this.target3:case this.target5:t.target.data&&t.target.data.infoModel&&(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameLogic.ins().postChangeAttrPoint(t.target.data.infoModel.handle));break;case this.checkBtn0:ViewManager.ins().open(XinMoBack);break;case this.checkBtn1:ViewManager.ins().open(XinMoFbPreview,"临时背包",XinMoFbCT.ins().xmBag)}},e.prototype.updateluck=function(){this.hpbar0.maximum=GlobalConfig.DemonsDreamlandBaseConfig.luckyValue,this.hpbar0.value=XinMoFbCT.ins().luckyNum
},e.prototype.update=function(){this.updateluck();var t=GlobalConfig.DemonsDreamlandBaseConfig.backbookid,e=BagCT.ins().getBagGoodsCountById(0,t),i=0>=e?"|C:0xf3311e&T:"+e+"|":"|C:0x35E62D&T:"+e+"|";this.backNum.textFlow=TextFlowMaker.generateTextFlow1(i),XinMoFbCT.ins().bagCount>0?(this.bagNum.text=XinMoFbCT.ins().bagCount.toString(),this.redimg.visible=!0,this.bagNum.visible=!0):(this.redimg.visible=!1,this.bagNum.visible=!1);var s,n,o=EntityManager.ins().getAllEntity(),a=[],r=SubRoles.lookAtTar,l=8*GameMap.CELL_SIZE;for(var h in o)if(s=o[h],n=s.infoModel,n&&n.type==EntityType.Monster&&n.getAtt(AttributeType.atHp)>0){var p=GlobalConfig.MonstersConfig[n.configID];if(!p)continue;if(4==p.type||3==p.type)continue;if(!r)continue;var u=MathUtils.getDistanceByObject(r,s);!n.masterHandle&&a.length<6&&l>=u&&a.push(s)}for(var d,c=a.length,h=1;6>h;h++)d=this["target"+h],c>=h?(this.teamFbTarget.addChild(d),d.data=a[h-1]):DisplayUtils.removeFromParent(d);var f=BossCT.ins().monsterID;if(ViewManager.ins().isShow(BossBloodPanel)&&f){var g=EntityManager.ins().getEntityByMonsterId(f);for(var h in g)g[h].infoModel.handle==GameLogic.ins().currAttackHandle&&ViewManager.ins().open(BossBelongPanel)}else ViewManager.ins().isShow(BossBelongPanel)&&ViewManager.ins().close(BossBelongPanel)},e.prototype.updateHead=function(t){var e=t[0],i=t[1],s=t[2];if(e instanceof CharRole&&i!=s){var n=e.infoModel,o=this["bloodBar"+n.index];if(o){var a=n.getAtt(AttributeType.atHp),r=n.getAtt(AttributeType.atMaxHp);o.maximum=100,o.value=100*a/r;var l=this["player"+(n.index+1)+"touxiang"];0==a?(l.filters=FilterUtil.ARRAY_GRAY_FILTER,this["time"+(n.index+1)]=GlobalConfig.GuardGodWeaponConf.recoverCD):(l.filters=null,this["time"+(n.index+1)]=0,this["CountDown"+(n.index+1)].visible=!1)}}},e.prototype.initHp=function(){for(var t=0;3>t;t++){var e=this["bloodBar"+t],i=SubRoles.ins().getSubRoleByIndex(t);if(i){var s=i.getAtt(AttributeType.atHp),n=i.getAtt(AttributeType.atMaxHp);e.maximum=100,e.value=Math.floor(100*s/n)}else e.visible=!1}},e.prototype.updateHeadIcon=function(){for(var t=0;3>t;t++){var e=this["player"+(t+1)+"touxiang"],i=SubRoles.ins().getSubRoleByIndex(t);i?e.source="yuanhead"+i.job+i.sex:e.visible=!1}},e}(BaseEuiView);__reflect(XinMoFbUI.prototype,"XinMoFbUI"),window.XinMoFbUI=XinMoFbUI,ViewManager.ins().reg(XinMoFbUI,LayerManager.UI_Main);var XinMoFbWin=function(t){function e(){var e=t.call(this)||this;return e.indexnum=0,e.skinName="XinMoFbSkin",e.itemList0.itemRenderer=ItemBase,e.addTouchEvent(e,e.onClick),e.txt_wanfa.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+e.txt_wanfa.text),e.txt_getluck.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+e.txt_getluck.text),e.update(),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.observe(XinMoFbCT.ins().updateLucky,this.update),this.setClickShow()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.update=function(){this.setnum(),this.setList(),this.luckyNum=XinMoFbCT.ins().luckyNum,this.luckyReply=GlobalConfig.DemonsDreamlandBaseConfig.luckyReply},e.prototype.setList=function(){var t=GlobalConfig.DemonsDreamlandDropConfig[this.indexnum+1].drops;this.itemList0.dataProvider=new eui.ArrayCollection(t)},e.prototype.setnum=function(){for(var t=XinMoFbCT.ins().allInfo[this.indexnum],e=0;e<t.length;e++)this["tex"+e]&&(this["tex"+e].text=t[e]);this.hpbar0.maximum=GlobalConfig.DemonsDreamlandBaseConfig.luckyValue,this.hpbar0.value=XinMoFbCT.ins().luckyNum},e.prototype.onClick=function(t){switch(t.target){case this.bg0:case this.bg1:case this.bg2:var e=[this.bg0,this.bg1,this.bg2];this.indexnum=Number(e.indexOf(t.target)),this.setClickShow(),this.update();break;case this.txt_wanfa:ViewManager.ins().open(ZsBossRuleSpeak,55);break;case this.txt_getluck:ViewManager.ins().open(XinMoLuckWin);break;case this.btnChallenge:XinMoFbCT.ins().sendFb(this.indexnum)}},e.prototype.setClickShow=function(){for(var t=0;3>t;t++)this["chosen"+t].visible=!1;this.bgimg.source="XinMoFbbg"+(this.indexnum+1)+"_jpg",this["chosen"+this.indexnum].visible=!0},e}(BaseView);__reflect(XinMoFbWin.prototype,"XinMoFbWin"),window.XinMoFbWin=XinMoFbWin;var XinMoLuckWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XinMoLuckSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(XinMoFbCT.ins().updateLucky,this.update),this.observe(Shop.ins().postBuyResult,this.update),this.setInfo()},e.prototype.update=function(){this.setInfo()},e.prototype.setInfo=function(){for(var t=XinMoFbCT.ins().getxmcfg(),e=0;3>e;e++){this["yeli"+e].text=t[e].luckval;var i=BagCT.ins().getBagItemById(t[e].id),s=GlobalConfig.ItemConfig[t[e].id],n={id:t[e].id,count:1,type:ItemUtil.getType(s)};n&&(this["item"+e].data=n),this["redPoint"+e].visible=!1;var o=XinMoFbCT.ins().luckynumarr,a=t[e].limitcount-o[e],r=this["priceIcon"+e];this["toDay"+e].text=a,this["btn"+e].touchEnabled=!0,this["btn"+e].currentState="up";var l=i?i.count:0;if(r.visible=!1,0==e&&(this["txt_has"+e].text="剩余"+l+"个"),l>0)this["redPoint"+e].visible=XinMoFbCT.ins().isUseLuck(t[e].id),this["btn"+e].label="使用",this["txt_has"+e].visible=!0,this["txt_has"+e].text="剩余"+l+"个";else if(0!=e){r.visible=!0;var h=ItemStoreConfig.getStoreByItemID(t[e].id);r.setText(h.price+""),r.setType(MoneyConst.yuanbao),this["txt_has"+e].visible=!1,this["btn"+e].label="购买"}else this["btn"+e].currentState="disabled",this["btn"+e].touchEnabled=!1;1>a&&(this["btn"+e].currentState="disabled",this["btn"+e].touchEnabled=!1,this["redPoint"+e].visible=!1)}},e.prototype.onTouch=function(t){var e=XinMoFbCT.ins().getxmcfg();switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.btn0:XinMoFbCT.ins().uselucky(e[0].id,1);break;case this.btn1:this.sendLuck(e[1].id);break;case this.btn2:this.sendLuck(e[2].id)}},e.prototype.sendLuck=function(t){var e=BagCT.ins().getBagItemById(t),i=ItemStoreConfig.getStoreByItemID(t),s=e?e.count:0;if(s>0)XinMoFbCT.ins().uselucky(t,1);else{if(Actor.yb<i.price)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");this.luckid=t,HuntWarnBuyWin.showBuyWarn("XinMoLuckWin"+t+"-1",this.sendBuy.bind(this),"是否消耗"+i.price+"元宝购买"+GlobalConfig.ItemConfig[t].name)}},e.prototype.sendBuy=function(){var t=ItemStoreConfig.getStoreByItemID(this.luckid);Shop.ins().sendBuy(1,[[t.id,1]])},e}(BaseEuiView);__reflect(XinMoLuckWin.prototype,"XinMoLuckWin"),window.XinMoLuckWin=XinMoLuckWin,ViewManager.ins().reg(XinMoLuckWin,LayerManager.UI_Popup);var AddYBItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="AddyuanbaoItem",e.desc.textFlow=(new egret.HtmlTextParser).parser("<u>"+e.desc.text+"</u>"),e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&this.data.length>0&&(this.eTips.textFlow=TextFlowMaker.generateTextFlow(this.data))},e}(BaseItemRender);__reflect(AddYBItemRender.prototype,"AddYBItemRender"),window.AddYBItemRender=AddYBItemRender;var AddYBWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.closeTime=0,e._sn_="AddyuanbaoSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=AddYBItemRender,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.actData=t[0],this.updateTips()},e.prototype.updateTips=function(){if(this.closeTime=GameServer.serverTime+3e3,this.actData&&this.actData.tips){var t=this.actData.tips.concat();this.skin&&(this.listDP.source=t.reverse())}},e.prototype.enterFrame=function(){this.closeTime>0&&GameServer.serverTime>=this.closeTime&&(this.actData.tips=[],ViewManager.ins().close(this))},e.prototype.onClick=function(t){t.target instanceof eui.Label&&ViewManager.ins().open(SmeltEquipTotalWin)},e}(BaseEuiView);__reflect(AddYBWin.prototype,"AddYBWin"),window.AddYBWin=AddYBWin,ViewManager.ins().reg(AddYBWin,LayerManager.Main_View);var ZsStoreItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZsStoreItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){},e.prototype.onClick=function(){},e}(BaseItemRender);__reflect(ZsStoreItemRender.prototype,"ZsStoreItemRender"),window.ZsStoreItemRender=ZsStoreItemRender;var ZsStoreWin=function(t){function e(){var e=t.call(this)||this;return e.storeId=0,e._sn_="ZsStoreSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!1},e}(BaseEuiView);__reflect(ZsStoreWin.prototype,"ZsStoreWin"),window.ZsStoreWin=ZsStoreWin,ViewManager.ins().reg(ZsStoreWin,LayerManager.UI_Main);