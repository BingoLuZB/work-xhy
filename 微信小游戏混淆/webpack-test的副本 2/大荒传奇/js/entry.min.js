function sendHttp(t,e,n){var r=this;return void 0===e&&(e=egret.HttpResponseType.TEXT),void 0===n&&(n=egret.HttpMethod.GET),new Promise(function(i){var o=new egret.HttpRequest;o.responseType=e,o.open(t,n),o.once(egret.Event.COMPLETE,function(t){i(o&&o._xhr&&o._xhr.status&&404==o._xhr.status?null:o.response)},r),o.once(egret.IOErrorEvent.IO_ERROR,function(){i(null)},r),o.send()})}function cImg(t,e){var n=new eui.Image;return n.source="entry/"+t,e.addChild(n),n}function urlLoad(t,e){var n=this;return new Promise(function(r){RES.getResByUrl(t,function(t,e){t&&r(t)},n,e)})}function isLocation(){return location&&location.href?location.href.indexOf("192.168.201")>=0||location.href.indexOf("192.168.0")>=0||location.href.indexOf("127.0.0.1")>=0||location.href.indexOf("localhost")>=0||location.href.indexOf("cq.api.com")>=0||location.href.indexOf("10.10.1")>=0||location.href.indexOf("10.10.4")>=0:!1}function textSecCheck(t,e){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(r){return[2,new Promise(function(r){return __awaiter(n,void 0,void 0,function(){var n,i,o,a,a;return __generator(this,function(s){switch(s.label){case 0:return n="","7000178"!=urlParam.appid?[3,2]:[4,Http.get("https://pass.h5eco.com/pass_a/jdk/psma/7000178p/7000178/uicFilter?passOpenId="+urlParam.openId+"&text="+t+"&text_scene="+e)];case 1:return n=s.sent(),[3,4];case 2:return[4,Http.get("https://ltm.fenzhihuyu.cn/master/user/pass/textSecCheck.json?appId="+urlParam.appid+"&text="+t)];case 3:n=s.sent(),s.label=4;case 4:return i=1,o=t,"7000178"==urlParam.appid?("error"==n||(a=JSON.parse(n),i=+a.text_result_list_[0].check_ret_,o=a.text_result_list_[0].result_text_),r({ret:i,result_text:o})):(i=2,a=JSON.parse(n),a&&a.data&&a.data.data&&0==a.data.code&&(i=a.data.data.security?0:1,o=a.data.data.text),r({ret:i,result_text:o})),console.log("textSecCheck",i,o),[2]}})})})]})})}function setLocationDef(t,e,n){n&&(_locationFun[t]=n);var r=getLocation(t);r?n&&n(r):setLocation(t,e)}function setLocation(t,e){var n=urlParam.actorid?urlParam.actorid+"":"";!n&&location.origin&&(n=location.origin+location.pathname),localStorage.setItem(""+n+t,e),_locationFun[t]&&_locationFun[t](e)}function getLocation(t,e){var n=urlParam.actorid?urlParam.actorid+"":"";!n&&location.origin&&(n=location.origin+location.pathname);var r=localStorage.getItem(""+n+t);switch(e){case LocationValue.Boolean:return"true"===r;case LocationValue.Number:return+r;default:return r}}function removeFromParent(t){t&&t.parent&&t.parent.removeChild(t)}var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{l(r.next(t))}catch(e){o(e)}}function s(t){try{l(r["throw"](t))}catch(e){o(e)}}function l(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}l((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,o=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},entry;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;n.cb=t,n.inputs=[],n.horizontalCenter=0,n.verticalCenter=0;var r=getLocation(urlParam.loginSys+"account"),i=getLocation(urlParam.loginSys+"pass"),o=getLocation(urlParam.loginSys+"autoLogin");return o&&r&&i?(n.login(r,i,!0),n):(n.createUI(),n)}return __extends(n,e),n.prototype.createUI=function(){var t=cImg("tongyonglabbg.png",this);t.top=t.left=t.right=t.bottom=0,t.scale9Grid=new egret.Rectangle(63,31,3,3),t.width=400,t.height=300;var e=new eui.Label;e.size=20,e.horizontalCenter=0,e.top=30,e.text="登录",this.addChild(e);var n=new eui.Group;n.verticalCenter=n.horizontalCenter=0;var r=new eui.VerticalLayout;r.gap=10,n.layout=r,this.addChild(n);var i=getLocation(urlParam.loginSys+"account"),o=getLocation(urlParam.loginSys+"pass");this.inputs.push(this.input(n,"账号",i)),this.inputs.push(this.input(n,"密码",o)),this.btn()},n.prototype.btn=function(){var e=this,n=new eui.Group,r=new eui.HorizontalLayout;r.gap=50,n.layout=r,n.horizontalCenter=0,n.bottom=30,this.addChild(n);var i=new t.SerAreaItem;i.data="注册登录",i.text.size=30,i.text.horizontalCenter=0,i.scaleX=i.scaleY=.5,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.login(e.inputs[0].text,e.inputs[1].text)},this),n.addChild(i);var o=new t.SerAreaItem;o.data="快速登录",o.text.size=30,o.text.horizontalCenter=0,o.scaleX=o.scaleY=.5,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.randReg()},this),n.addChild(o)},n.prototype.login=function(e,n,r){return __awaiter(this,void 0,void 0,function(){var i,o,a,s,l=this;return __generator(this,function(c){switch(c.label){case 0:return WaitWin.show(),[4,Http.post(urlParam.loginSys+"reg","account="+e+"&pass="+n)];case 1:if(i=c.sent(),WaitWin.hide(),!i)return t.Tips.show("无法连接网络",["确定"],[function(){r&&l.createUI()}]),[2];if(o=JSON.parse(i),o.err)return t.Tips.show(o.err,["确定"],[function(){}]),[2];o.create&&(a=new egret.RenderTexture,a.drawToTexture(this.parent),a.saveToFile("image/png",o.openId+".png")),setLocation(urlParam.loginSys+"account",e),setLocation(urlParam.loginSys+"pass",n),setLocation(urlParam.loginSys+"autoLogin","1");for(s in o)urlParam[s]=o[s];return t.Tips.showTxt("登录成功!"+(o.create?"账号已截图保存":""),this.parent,this.cb),this.parent&&this.parent.removeChild(this),[2]}})})},n.prototype.randReg=function(){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return WaitWin.show(),[4,Http.post(urlParam.loginSys+"reg2")];case 1:if(e=a.sent(),WaitWin.hide(),!e)return t.Tips.show("无法连接网络",["确定"],[function(){}]),[2];if(n=JSON.parse(e),n.err)return t.Tips.show(n.err,["确定"],[function(){}]),[2];setLocation(urlParam.loginSys+"account",n.account),setLocation(urlParam.loginSys+"pass",n.pass),setLocation(urlParam.loginSys+"autoLogin","1"),this.inputs[0].text=n.account,this.inputs[1].text=n.pass,n.create&&(r=new egret.RenderTexture,r.drawToTexture(this.parent),r.saveToFile("image/png",n.openId+".png"));for(i in n)urlParam[i]=n[i];return this.touchEnabled=this.touchChildren=!1,t.Tips.showTxt("登录成功!"+(n.create?"账号已截图保存":""),this.parent,function(){o.cb(),o.parent&&o.parent.removeChild(o)}),[2]}})})},n.prototype.input=function(t,e,n){var r=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign="middle",r.layout=i,t.addChild(r);var o=new eui.Label;o.size=20,o.horizontalCenter=0,o.top=10,o.text=e,r.addChild(o);var a=new eui.Group;r.addChild(a);var s=cImg("dk.png",a);s.scaleY=s.scaleX=.8;var l=new eui.TextInput;return l.skinName='<e:Skin class="skins.TextInputSkin" states="normal,disabled,normalWithPrompt,disabledWithPrompt" xmlns:e="http://ns.egret.com/eui">\n	<e:Rect height="100%" width="100%" fillColor="0xffffff" fillAlpha="0"/>\n 	<e:EditableText id="textDisplay" verticalCenter="0" left="10" right="10"\n	                textColor.disabled="0xff0000" width="100%" height="24" size="20"  textColor="0xffffff" textAlign="center"/>\n	<e:Label id="promptDisplay" verticalCenter="0" left="10" right="10"\n	                textColor="0xa9a9a9" width="100%" height="24" size="20" touchEnabled="false" includeIn="normalWithPrompt,disabledWithPrompt"/>\n</e:Skin>',l.verticalCenter=0,l.right=l.left=0,l.text=n,a.addChild(l),l},n}(eui.Component);t.LoginWin=e,__reflect(e.prototype,"entry.LoginWin")}(entry||(entry={}));var entry;!function(t){var e=function(){function t(){}return t.show=function(t,e,n){var r=this;if(!this.isShow){this.isShow=!0;var i=egret.MainContext.instance.stage,o=new eui.UILayer,a=new eui.Rect;a.left=a.top=a.right=a.bottom=0,a.fillColor=0,a.alpha=.8,o.addChild(a);var s=new eui.Group;s.height=300,s.width=400,s.horizontalCenter=s.verticalCenter=0;var l=cImg("tongyongkuang3bg.png",s);l.top=l.left=l.right=l.bottom=0,l.scale9Grid=new egret.Rectangle(11,11,8,8),l=cImg("tongyongkuang3tou.png",s),l.right=l.left=0;var c=new eui.Label;c.text="提  示",c.size=24,c.textColor=10855294,c.horizontalCenter=0,c.top=11,s.addChild(c);var u=new eui.Label;u.size=18,u.textColor=11645079,u.text=t,u.lineSpacing=5,u.verticalCenter=-10,u.horizontalCenter=0,u.textAlign=egret.HorizontalAlign.CENTER,s.addChild(u);var h=new eui.Group,d=new eui.HorizontalLayout;d.gap=20,h.layout=d,h.top=230,h.bottom=20,h.horizontalCenter=0,s.addChild(h);var p=function(t){var a=new eui.Group,s=new eui.Image;s.source="entry/btn40.png",s.left=s.top=s.right=s.bottom=0,a.addChild(s);var l=new eui.Label;l.text=e[t],l.size=20,l.textColor=11645079,l.verticalCenter=l.horizontalCenter=0,a.addChild(l),a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.scaleX=a.scaleY=.9},g),a.addEventListener(egret.TouchEvent.TOUCH_END,function(){a.scaleX=a.scaleY=1},g),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.removeChild(o),n[t](),r.isShow=!1},g),h.addChild(a)},g=this;for(var f in e)p(f);o.addChild(s),i.addChild(o)}},t.showTxt=function(t,e,n){var r=new eui.Label;r.horizontalCenter=0,r.verticalCenter=0,r.text=t,r.size=24,e.addChild(r);var i=egret.Tween.get(r);i.wait(500).to({verticalCenter:-150,alpha:0},1e3).call(function(){r.parent&&r.parent.removeChild(r),n&&n()})},t.isShow=!1,t}();t.Tips=e,__reflect(e.prototype,"entry.Tips")}(entry||(entry={}));var GameByteArray=function(t){function e(){var e=t.call(this)||this;return e.endian=egret.Endian.LITTLE_ENDIAN,e}return __extends(e,t),e.prototype.readString=function(){var t=this.readUTF();return this.position+=1,t},e.prototype.readNumber=function(){var t=new uint64(this),e=t.toString();return+e},e.prototype.writeNumber=function(t){var e=uint64.stringToUint64(t.toString());this.writeInt64(e)},e.prototype.writeInt64=function(t){this.writeUnsignedInt(t._lowUint),this.writeUnsignedInt(t._highUint)},e.prototype.writeString=function(t){this.writeUTF(t),this.writeByte(0)},e.prototype.writeCmd=function(t,e){this.writeByte(t),this.writeByte(e)},e.prototype.readInts=function(t){for(var e=[],n=0;t>n;n++)e.push(this.readInt());return e},e.prototype.writeInts=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var i=r[n];this.writeInt(i)}},e}(egret.ByteArray);__reflect(GameByteArray.prototype,"GameByteArray"),window.GameByteArray=GameByteArray;var Timer=function(){function t(){}return t.start=function(t,e,n,r){for(var i=this,o=[],a=4;a<arguments.length;a++)o[a-4]=arguments[a];return new Promise(function(a){var s=r.hashCode,l=i.list[s]=i.list[s]||{},c=egret.setInterval(function(){e--,0==e&&(i.clear(c,s),a()),n.call.apply(n,[r].concat(o))},i,t);l[c]=n})},t.stop=function(t,e){var n=e.hashCode,r=this.list[n];if(r)for(var i in r)r[i]==t&&this.clear(+i,n)},t.has=function(t,e){var n=e.hashCode,r=this.list[n];if(!r)return!1;for(var i in r)if(r[i]==t)return!0},t.stopAll=function(t){var e=t.hashCode,n=this.list[e];if(n)for(var r in n)this.clear(+r,e)},t.clear=function(t,e){egret.clearInterval(t);var n=this.list[e];n&&(delete n[t],Object.keys(n).length||delete this.list[e])},t.list={},t}();__reflect(Timer.prototype,"Timer"),window.Timer=Timer;var Encrypt=function(){function t(){}return t.encode=function(e,n,r){if(void 0===n&&(n=0),void 0===r&&(r=0),n>=e.length)return 0;var i=r?n+r:e.length;i>e.length&&(i=e.length),e.position=n;for(var o=n;i>o;++o){var a=e.readByte();a^=t.sKeyBuff[o%4],e.position--,e.writeByte(a)}return i-n},t.decode=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=0),t.encode(e,n,r)},t.getCRC16=function(t,e){return void 0===e&&(e=0),CRC16.update(t,0,e)},t.getCRC16ByPos=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=0),CRC16.update(t,e,n)},t.getCheckKey=function(){var e=new egret.ByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.writeUnsignedInt(t.sKey);var n=CRC16.update(e);return n},t.getSelfSalt=function(){return t.sSelfSalt},t.getTargetSalt=function(){return t.sTargetSalt},t.setTargetSalt=function(e){t.sTargetSalt=e,t.makeKey()},t.makeSalt=function(){var t=new Date;return Math.random()*t.getTime()},t.makeKey=function(){t.sKey=(t.sSelfSalt^t.sTargetSalt)+8254;for(var e=0;4>e;++e)t.sKeyBuff[e]=(t.sKey&255<<(e<<3))>>(e<<3)},t.sSelfSalt=t.makeSalt(),t.sKeyBuff=new Array(4),t}();__reflect(Encrypt.prototype,"Encrypt");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasTheme=!1,e}return __extends(e,t),e.prototype.createChildren=function(){e.ins=this,this.layout=new eui.BasicLayout,RES.registerVersionController({init:function(){return new Promise(function(t){return t()})},getVirtualUrl:getUrl}),egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.setMaxLoadingThread(200),egret.ImageLoader.crossOrigin="anonymous",eui.Label.default_fontFamily="微软雅黑",this.start()},e.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var t,n=this;return __generator(this,function(r){switch(r.label){case 0:return win.init(),[4,RES.loadConfig("resource/entry.res.json","resource/")];case 1:return r.sent(),t=new eui.Image("entry/"+platform.getSceneBg()),t.horizontalCenter=t.verticalCenter=0,this.addChild(t),RES.getResByUrl("entry/first.mp3").then(function(t){n.stage.once(egret.TouchEvent.TOUCH_TAP,function(){t.play(0,1).volume=0},n,!0)}),[4,window.platform.sdkInit()];case 2:return r.sent(),[4,e.startLogin()];case 3:return r.sent(),[2]}})})},e.startLogin=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,window.platform.login()];case 1:return n.sent(),platform.report("1.调用platform login成功"),[4,this.enterGameMain(0,!0)];case 2:return n.sent()?[2]:(e.ins.removeChildren(),urlParam.openId||urlParam.loginSys?(t=new entry.Scene,e.ins.addChild(t),[2]):[3,3]);case 3:return[4,e.ins.loadTheme()];case 4:return n.sent(),[4,win.open(EntryWin).complete()];case 5:n.sent(),n.label=6;case 6:return this.enterGameMain(0,!0),[2]}})})},e.enterGameMain=function(t,n,r){return void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!0),__awaiter(this,void 0,void 0,function(){var n,i,o,a,s,l,c,u,h,d;return __generator(this,function(p){switch(p.label){case 0:return n=urlParam.openId,i=urlParam.srvid,!r||isNaN(+i)?[3,2]:[4,window.platform.getServerInfo(+i,t)];case 1:p.sent(),p.label=2;case 2:return o=urlParam.wss,n&&o&&i?(s=Socket.ins(),[4,s.connect()]):(a="登录失败，参数 "+JSON.stringify({openId:n+"",wss:o+"",srvid:i+""}),console.warn(a),[2,!1]);case 3:return p.sent(),window.platform.report("2.Socket连接成功"),[4,s.login()];case 4:return p.sent(),window.platform.report("3.服务器登陆成功"),[4,s.getRoleCount()];case 5:switch(l=p.sent(),c=l.roleNum,u=l.roleArr,e.ins.removeChildren(),win.closeAll(),window.platform.report("4.获取角色列表成功"),h=c){case 0:return[3,6];case 1:return[3,9]}return[3,13];case 6:return[4,win.open(CreateRole).closeAwait()];case 7:return p.sent(),win.open(LoadingScene),[4,e.ins.startLoad()];case 8:return p.sent(),[3,15];case 9:return urlParam.actorid=u[0].id,s.isReconnect?[4,e.ins.enterGame()]:[3,11];case 10:return p.sent(),[2];case 11:return win.open(LoadingScene),[4,e.ins.startLoad()];case 12:return p.sent(),[3,15];case 13:return Timer.start(1e3,1,e.ins.openLoadView,e.ins),d=win.open(SelectRole),d.setRoleDatas(u),[4,Promise.all([d.closeAwait(),e.ins.startLoad()])];case 14:return p.sent(),Timer.stop(e.ins.openLoadView,e.ins),[3,15];case 15:return[4,e.ins.LoadFinish(urlParam.actorid)];case 16:return p.sent(),[2,!0]}})})},e.prototype.openLoadView=function(){win.open(LoadingScene)},e.prototype.startLoad=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return window.platform.report("8.开始加载"),this.updateLoad(20,"加载版本文件"),isNaN(urlParam.gv)?[3,2]:[4,RES.getResByUrl("ver.json")];case 1:verData=e.sent(),e.label=2;case 2:return this.updateLoad(40,"加载资源文件"),[4,RES.loadConfig("default.res.json","resource/")];case 3:return e.sent(),window.platform.report("9.加载default.res成功"),this.updateLoad(60,"加载预先项"),[4,RES.loadGroup("preload",0)];case 4:return e.sent(),window.platform.report("11.加载预先项成功"),this.updateLoad(80,"加载主题文件"),[4,this.loadTheme()];case 5:return e.sent(),window.platform.report("12.加载主题文件"),this.updateLoad(100,"加载游戏主程序"),egret.getDefinitionByName("GameApp")?[3,7]:[4,window.platform.loadJs("main.min.js")];case 6:e.sent(),e.label=7;case 7:return 1201!=+urlParam.srvid&&1202!=+urlParam.srvid?[3,9]:[4,new Promise(function(e){Timer.start(2e3,1,function(){e()},t)})];case 8:e.sent(),e.label=9;case 9:return window.platform.report("13.入游戏必要资源加载完成"),[2]}})})},e.prototype.updateLoad=function(t,n){for(var r=0,i=e.loadProgress;r<i.length;r++){var o=i[r];o(t,n)}e.curLP=t,e.curStr=n},e.prototype.LoadFinish=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return egret.getDefinitionByName("GameApp")?(e.loadProgress.length=0,[4,window.GameApp.ins().init()]):[3,3];case 1:return t.sent(),dragonBones.EgretFactory.factory.clear(),this.removeChildren(),[4,this.enterGame()];case 2:t.sent(),window.platform.report("14.成功进入游戏"),win.closeAll(),t.label=3;case 3:return[2]}})})},e.prototype.enterGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Socket.ins().sendEnter(urlParam.actorid)];case 1:return t.sent(),[2]}})})},e.prototype.loadTheme=function(){var t=this;if(!this.hasTheme)return this.hasTheme=!0,new Promise(function(e,n){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return egret.Capabilities.runtimeType!=egret.RuntimeType.WEB&&egret.Capabilities.runtimeType!=egret.RuntimeType.RUNTIME2?[3,2]:[4,new Promise(function(t){loadSingleScript(getUrl("default.thm.js"),t)})];case 1:n.sent(),n.label=2;case 2:return t=new eui.Theme("resource/default.thm.json",this.stage),t.addEventListener(eui.UIEvent.COMPLETE,e,this),window.platform.report("10.加载default.thm成功"),[2]}})})})},e.loadProgress=[],e.curLP=0,e.curStr="",e}(eui.UILayer);__reflect(Main.prototype,"Main"),window.Main=Main,window.entry=entry;var System={};window.System=System;var cls=eui.Component.prototype;cls.defaultRect=!0,cls.rectClose=!0,cls.rectText=!1,cls.closeAwait=function(){var t=this;return new Promise(function(e){return t.closeAwaitCb=e})};var tf=cls.initializeUIValues;cls.initializeUIValues=function(){tf.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.atStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.rfStage,this),this.addEventListener(egret.Event.COMPLETE,this.skinCom,this)},cls.atStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.visible?this._sn_?[4,this.dynamicSkin(this._sn_)]:[3,2]:[2];case 1:t.sent(),this.skinName!=this._sn_&&this.skinName!=window[this._sn_]&&(this.skinName&&console.warn(egret.getQualifiedClassName(this),this.skinName+"重置了皮肤"+this._sn_+",会触发2次skinComplete,考虑删除_sn_，由exml控制"),this.skinName=this._sn_),t.label=2;case 2:return this.stage?(this.beforOpen&&this.beforOpen.apply(this,this.$param),this.addDisplay&&this.addDisplay.apply(this,this.$param),this.time1s&&Timer.start(1e3,-1,this.time1s,this),delete this.$param,this.enterFrame&&this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),[2]):[2]}})})},cls.rfStage=function(){this.enterFrame&&this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.removeDisplay&&this.removeDisplay(),Timer.stopAll(this),window.delMsgs&&window.delMsgs(this),window.MessageCenter&&window.MessageCenter.ins().removeAll(this),this.closeAwaitCb&&this.closeAwaitCb()},cls.skinCom=function(){this.invalidateState(),this.skinComplete&&this.skinComplete()};var tf1=cls.$setVisible;cls.$setVisible=function(t){var e=this.$visible;if(tf1.call(this,t),this.parent&&!e&&t){if(this.parent instanceof eui.ViewStack&&this.parent.selectedIndex!=this.parent.getChildIndex(this))return;this.atStage()}this.parent&&e&&!t&&this.rfStage()},cls.dynamicSkin=function(t,e){var n=this;return new Promise(function(e){return __awaiter(n,void 0,void 0,function(){var n,r,i,o,a,s,l;return __generator(this,function(c){switch(c.label){case 0:return t?(n=egret.getDefinitionByName(t),n?[2,this.parent&&e()]:[4,RES.getResByUrl("res/skinJson/"+t+".json",null,RES.ResourceItem.TYPE_JSON)]):[2,e()];case 1:r=c.sent(),i=r.yl||tempYl[t],tempYl[t]=i,delete r.yl,window[t]||window.JSONParseClass.addSkin(r,t),o=[];for(a in i)o.push(a);s=0,c.label=2;case 2:return s<o.length?(l=o[s],window[l]?[3,4]:(l.indexOf(".exml")>=0&&console.log(t),[4,this.dynamicSkin(l)])):[3,5];case 3:c.sent(),c.label=4;case 4:return s++,[3,2];case 5:return this.parent&&e(),[2]}})})})};var tempYl={};eui.DataGroup.prototype.itemToRendererClass=function(t){var e,n=this.$DataGroup;return n[7]&&(e=n[7](t)),e||(e=n[6],"string"==typeof e&&(e=egret.getDefinitionByName(e))),e||(e=eui.ItemRenderer),e.$hashCode||(e.$hashCode=egret.$hashCount++),e},eui.List.prototype.h_left_right=function(){var t=this.contentWidth-this.width;return[0<this.scrollH,this.scrollH<t]},eui.List.prototype.v_up_down=function(){var t=this.contentHeight-this.height;return[0<this.scrollV,this.scrollV<t]},eui.List.prototype.scrollToSelectH=function(){var t=this;egret.setTimeout(function(){egret.Tween.removeTweens(t),egret.Tween.get(t).wait(100).to({scrollH:t.contentWidth/t.numElements*t.selectedIndex},1200,egret.Ease.backInOut).call(function(){t.parent instanceof eui.Scroller&&t.parent.dispatchEventWith(eui.UIEvent.CHANGE_END)})},this,300)},eui.List.prototype.scrollToSelectV=function(){var t=this;egret.setTimeout(function(){egret.Tween.removeTweens(t),egret.Tween.get(t).wait(100).to({scrollV:t.contentHeight/t.numElements*t.selectedIndex},1200,egret.Ease.backInOut).call(function(){t.parent instanceof eui.Scroller&&t.parent.dispatchEventWith(eui.UIEvent.CHANGE_END)})},this,300)},eui.List.prototype.toPageH=function(t){var e=this;void 0===t&&(t=1);var n=this.contentWidth-this.width,r=Math.max(Math.min(this.scrollH+this.width*t,n),0);egret.Tween.removeTweens(this),egret.Tween.get(this).to({scrollH:r},200).call(function(){e.parent instanceof eui.Scroller&&e.parent.dispatchEventWith(eui.UIEvent.CHANGE_END)})};var tabCls=eui.TabBar.prototype,tabInit=tabCls.initializeUIValues;tabCls.initializeUIValues=function(){tabInit.call(this),this.addEventListener(egret.Event.CHANGING,function(t){var e=this.dataProvider;if(e instanceof eui.ViewStack){var n=egret.getQualifiedClassName(this.dataProvider.getChildAt(this.selectedIndex));win.openCheck(egret.getDefinitionByName(n))||t.preventDefault()}},this)};var entry;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e.top=85,e.bottom=85,e.horizontalCenter=0,e.width=550;var n=cImg("xfbg.png",e);n.scale9Grid=new egret.Rectangle(45,25,450,100),n.left=n.right=20,n.top=0,n.bottom=-5,e.bk2(),e.bk1(),e.ggd(),e.setLab();var r=cImg("Isee_Btn.png",e);return r.horizontalCenter=0,r.bottom=35,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},e),e}return __extends(e,t),e.prototype.setLab=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return t=new eui.Label,t.touchEnabled=!1,t.size=20,t.left=50,t.right=50,t.top=100,t.textColor=11645079,[4,window.platform.getNotice()];case 1:return e=n.sent(),t.textFlow=e?(new egret.HtmlTextParser).parser(e):null,this.addChild(t),[2]}})})},e.prototype.bk1=function(){var t=cImg("bk1.png",this);t.scale9Grid=new egret.Rectangle(98,0,5,1),t.left=0,t.right=20,t=cImg("bk1.png",this),t.scaleX=-1,t.right=0},e.prototype.bk2=function(){var t=cImg("bk2.png",this);t.bottom=0,t.left=9,t.top=20,t.right=20,t.scale9Grid=new egret.Rectangle(85,0,5,5),t=cImg("bk2.png",this),t.scale9Grid=new egret.Rectangle(85,0,5,5),t.scaleX=-1,t.right=9,t.bottom=0,t.top=20},e.prototype.ggd=function(){var t=new eui.Group,e=new eui.HorizontalLayout;e.gap=0,t.layout=e,t.horizontalCenter=0,this.addChild(t);var n=cImg("ggd.png",t);n=cImg("ggd.png",t),n.scaleX=-1,n=cImg("ggt.png",this),n.horizontalCenter=0,n.top=15},e}(eui.Component);t.Notice=e,__reflect(e.prototype,"entry.Notice")}(entry||(entry={}));var Platform=function(){function t(){this.curReport="1.调用platform login成功"}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.sdkInit=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.loadJs=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e){window.loadSingleScript(RES.getVirtualUrl(t),e)})]})})},t.prototype.getServerInfo=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s;return __generator(this,function(l){switch(l.label){case 0:return e=e||0,n=urlParam.openId,(r=urlParam.apiRoot)?(a=(o=JSON).parse,[4,Http.post(r+"y4/use",JSON.stringify({srvid:t,openId:n,idx:e}))]):[3,2];case 1:i=a.apply(o,[l.sent()]);for(s in i)urlParam[s]=i[s];l.label=2;case 2:return this.reportSelectServer(),[2]}})})},t.prototype.getServerList=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o,a;return __generator(this,function(s){switch(s.label){case 0:return e=urlParam.openId,n=urlParam.apiRoot,r=urlParam.apptype,a=(o=JSON).parse,[4,Http.post(n+"y4/list",JSON.stringify({openId:e,apptype:r,page:t}))];case 1:return i=a.apply(o,[s.sent()]),[2,i[t].reverse()]}})})},t.prototype.pay=function(t,e,n,r,i,o,a){return void 0===n&&(n=""),void 0===r&&(r=0),void 0===i&&(i=""),void 0===o&&(o=""),void 0===a&&(a=""),__awaiter(this,void 0,void 0,function(){var s,l,c,u,h,d,p;return __generator(this,function(g){switch(g.label){case 0:return s=urlParam.openId,l=urlParam.apiRoot,c=urlParam.appid,u=urlParam.apptype,h=urlParam.actorid,n?[3,2]:[4,Http.post(l+"y4/order",JSON.stringify({openId:s,actorid:h,serverId:urlParam.srvid,money:e,yb:t,funcid:r,apptype:u,appid:c}))];case 1:if(d=g.sent(),!d)return[2];p=JSON.parse(d).order,n=p,g.label=2;case 2:return this.paySDK(e,n,i,o,a),[2]}})})},t.prototype.paySDK=function(t,e,n,r,i){alert("对应平台的未接入支付接口")},t.prototype.getNotice=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i;return __generator(this,function(o){switch(o.label){case 0:return t=urlParam.appid,e=urlParam.apiRoot,i=(r=JSON).parse,[4,Http.post(e+"y4/notice",JSON.stringify({appid:t}))];case 1:return n=i.apply(r,[o.sent()]),[2,n.notice]}})})},t.prototype.isOpenShare=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!1]})})},t.prototype.setShareCallback=function(t){},t.prototype.showShare=function(){},t.prototype.getSubscribe=function(t){},t.prototype.share=function(t){console.warn("Platform.share 不存在")},t.prototype.checkStrApi=function(t,e){return void 0===e&&(e=0),__awaiter(this,void 0,void 0,function(){var n,r,i,o;return __generator(this,function(a){switch(a.label){case 0:return n=urlParam.reportRoot,!n||isLocation()?[2,t]:(t=encodeURIComponent(t),o=(i=JSON).parse,[4,Http.get(n+"fw?word="+t+"&isname="+e)]);case 1:return r=o.apply(i,[a.sent()]),r&&r.result?[2,r.word]:[2,""]}})})},t.prototype.checkChat=function(t,e,n,r){return void 0===e&&(e=0),void 0===n&&(n=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e){e({result:"success",content:t})})]})})},t.prototype.checkStr=function(t,e,n,r){var i=this;return void 0===e&&(e=0),void 0===n&&(n=0),new Promise(function(o){return __awaiter(i,void 0,void 0,function(){var i,a;return __generator(this,function(s){switch(s.label){case 0:return 1==e&&window.ChatCT&&!window.ChatCT.ins().isCanSpeak()?(o({result:"",content:""}),[2]):[4,this.checkStrApi(t,2==e||3==e?1:0)];case 1:if(t=s.sent(),""==t)return Tips.show("名称无效，名称中包含非法字符或长度不合法",["确定"],[function(){}]),[2];s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this.checkChat(t,e,n,r)];case 3:return i=s.sent(),[3,5];case 4:return a=s.sent(),""!=a&&Tips.show(a,["确定"],[function(){}]),[3,5];case 5:return!i||"self"!=i.result&&"success"!=i.result||o(i),[2]}})})})},t.prototype.ocsc=function(t){console.warn("Platform.ocsc 不存在")},t.prototype.createInnerAudioContext=function(){return miniSDK?miniSDK.createInnerAudioContext():void 0},t.prototype.startRecord=function(){return console.warn("Platform.startRecord 不存在"),null},t.prototype.stopRecord=function(){return console.warn("Platform.stopRecord 不存在"),null},t.prototype.shareVedio=function(t){console.warn("Platform.shareVedio 不存在")},t.prototype.getOpenCheck=function(){return console.warn("Platform.getOpenCheck 不存在"),!1},t.prototype.getContact=function(){console.warn("Platform.getContact 不存在")},t.prototype.hideContact=function(t){console.warn("Platform.hideContact 不存在")},t.prototype.showContact=function(t){console.warn("Platform.showContact 不存在")},t.prototype.onShow=function(t){console.warn("Platform.onShow 不存在")},t.prototype.setClipboardData=function(t,e){console.warn("Platform.setClipboardData 不存在")},t.prototype.report=function(t){this.curReport=t;var e=urlParam.openId,n=urlParam.reportRoot,r=urlParam.srvid,i=urlParam.isnew,o=urlParam.actorid,a=urlParam.apptype,s=urlParam.appid;n&&(Http.post(n+"backlog/log?type=client",JSON.stringify({flag:t,srvid:r,openId:e,isnew:!!i,actorid:o,apptype:a,appid:s})),platform.reportIsnew("report "+JSON.stringify({flag:t,srvid:r,openId:e,isnew:!!i,actorid:o,apptype:a,appid:s}))),console.log("report",t),"1.调用platform login成功"==t&&this.reportLogin(),"7.创角成功"==t&&this.reportCreateRole()},t.prototype.reportError=function(t){console.log(t)},t.prototype.reportIsnew=function(t){},t.prototype.getGameVersion=function(){return""},t.prototype.getLoadBg=function(){return"loadBg.jpg"},t.prototype.getSceneBg=function(){return"bg.jpg"},t.prototype.reportLogin=function(){},t.prototype.reportCreateRole=function(){},t.prototype.reportLevelup=function(){},t.prototype.reportSelectServer=function(){},t}();__reflect(Platform.prototype,"Platform"),window.platform?window.platform.__proto__=new Platform:window.platform=new Platform;var entry;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.left=t.top=t.right=t.bottom=0,t.createUI(),t}return __extends(n,e),n.prototype.createUI=function(){return __awaiter(this,void 0,void 0,function(){var e,n,r,i,o,a,s,l,c,u,h,d,p,g=this;return __generator(this,function(f){switch(f.label){case 0:return e=urlParam.last,n=e.idx,r=e.status,i=e.entryname,o=cImg(platform.getSceneBg(),this),o.horizontalCenter=0,o.verticalCenter=0,a=new eui.Label,a.text=platform.getGameVersion(),a.size=15,a.stroke=1,a.textColor=6645093,a.horizontalCenter=0,a.lineSpacing=5,a.textAlign=egret.HorizontalAlign.CENTER,this.addChild(a),a.bottom=0,urlParam.loginSys?[4,new Promise(function(e){g.addChild(new t.LoginWin(e))
})]:[3,2];case 1:f.sent(),s=cImg("dengchu.png",this),s.left=50,s.top=50,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){setLocation(urlParam.loginSys+"autoLogin",""),g.removeChildren(),g.createUI()},this),f.label=2;case 2:return l=cImg("gg.png",this),l.right=50,l.top=100,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){g.addChild(g.notice)},this),c=new eui.Group,cImg("dfbg.png",c),u=new eui.Label,u.text=i||n+"区",u.size=24,u.right=310,u.bottom=22,u.textColor=13222933,c.addChild(u),h=new eui.Label,h.textFlow=(new egret.HtmlTextParser).parse("<u>点击换区</u>"),h.left=310,h.bottom=24,h.textColor=65280,h.size=23,c.addChild(h),c.horizontalCenter=0,c.bottom=274,this.addChild(c),c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){g.addChild(new t.SelectServer)},this),d=cImg("start.png",this),d.horizontalCenter=0,d.bottom=130,d.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){d.scaleX=d.scaleY=.9},this),d.addEventListener(egret.TouchEvent.TOUCH_END,function(){d.scaleX=d.scaleY=1},this),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){return __awaiter(g,void 0,void 0,function(){var e,n,r,i;return __generator(this,function(o){return urlParam.loginSys,e=urlParam.last,n=e.status,r=e.srvid,i=e.idx,n&&0!=n&&3!=n?(this.touchEnabled=!1,this.touchChildren=!1,urlParam.srvid=r+"",Main.enterGameMain(i,!0),[2]):(t.Tips.showTxt("当前服务器正在维护",this),[2])})})},this),urlParam.showBackHall&&(p=cImg("btnBackhall.png",this),p.left=5,p.top=50,p.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=window.logout;e&&e({confirm:!0})},this)),this.notice=new t.Notice,this.addChild(this.notice),[2]}})})},n.prototype.sparkTween=function(){for(var t=this,e=0;15>e;e++)setTimeout(function(){return t.randomSpark()},1e3*Math.random()+1500);setTimeout(function(){return t.sparkTween()},1500)},n.prototype.randomSpark=function(){var t=cImg("gg.png",this);t.x=300*Math.random()+500,t.rotation=180*Math.random(),t.touchEnabled=!1;var e=.7+.3*Math.random();t.scaleX=t.scaleY=e,t.y=-50+200*Math.random()+700;var n=egret.Tween.get(t);n.to({x:480*Math.random(),y:500*Math.random()},3500).call(function(){t.parent.removeChild(t),egret.Tween.removeTweens(t)})},n}(eui.Component);t.Scene=e,__reflect(e.prototype,"entry.Scene")}(entry||(entry={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){return __awaiter(this,void 0,void 0,function(){function i(t){e.call(r,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(r))}var a=this;return __generator(this,function(n){return"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(r,generateEUI)},this):"undefined"!=typeof generateEUI2?(RES.destroyRes("resource/gameEui.json"),RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),i(t),egret.callLater(function(){e.call(r,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON)):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)),[2]})})},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]),window.textSecCheck=textSecCheck;var CreateRole=function(t){function e(){var n=t.call(this)||this;return n.defaultRect=!1,n.sexBtn=[],n.job=0,n.sex=1,n.dice=new eui.Image,n.start=new eui.Image,n.role=new eui.Image,e.input=new eui.EditableText,n.left=n.top=n.right=n.bottom=0,n.initUI(),n}return __extends(e,t),e.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i=this;return __generator(this,function(o){switch(o.label){case 0:return this.start.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.start.scaleX=i.start.scaleY=.9},this),this.start.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.start.scaleX=i.start.scaleY=1},this),this.start.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickStart,this),t=this,[4,urlLoad("entry/c120eaf.json",RES.ResourceItem.TYPE_SHEET)];case 1:return t.ss=o.sent(),this.start.source=this.ss.getTexture("createrole_start"),e=cImg("createbg1.jpg",this),e.verticalCenter=e.horizontalCenter=0,e=new eui.Image,e.source=this.ss.getTexture("createrole_biaoti"),e.verticalCenter=-300,e.horizontalCenter=-220,this.addChild(e),urlParam.showBackHall&&(n=cImg("btnBackhall.png",this),n.left=5,n.top=50,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=window.logout;t&&t({confirm:!0})},this)),this.role.source="entry/xl_cr_1"+this.sex+".png",this.role.horizontalCenter=0,this.role.verticalCenter=20,this.addChild(this.role),this.createSex(),r=new eui.Group,r.horizontalCenter=0,r.verticalCenter=360,this.createInput(r),this.addChild(r),r=new eui.Group,r.horizontalCenter=0,r.verticalCenter=450,r.addChild(this.start),this.addChild(r),this.randomName(),this.sparkTween(),window.platform.report("5.进入创角"),[2]}})})},e.prototype.onClickStart=function(){return __awaiter(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,r,u=this;return __generator(this,function(h){switch(h.label){case 0:return window.platform.report("6.点击创角"),[4,platform.checkStr(e.input.text,2)];case 1:return(t=h.sent().content)?(i=Socket.ins(),[4,i.createActor(e.input.text,this.sex,this.job+1)]):(n=new eui.Label,n.horizontalCenter=0,n.bottom=250,n.text="名称无效，名称中包含非法字符或长度不合法",n.size=24,this.addChild(n),r=egret.Tween.get(n),r.wait(1e3).to({bottom:300,alpha:0},1e3).call(function(){u.removeChild(n)}),[2]);case 2:return o=h.sent(),a=o.error,s=o.id,l=["","sql错误","用户没登陆","游戏服务没准备好","角色上一次保存数据是否出现异常","客户端选择角色的常规错误","角色名称重复","角色不存在","错误的性别","随机生成的名字已经分配完","客户端上传的角色阵营参数错误","客户端上传的角色职业参数错误","名称无效，名称中包含非法字符或长度不合法","如果玩家是帮主，不能删除该角色，需要玩家退帮","已经登陆到其他服务器","已经超过最大可建角色数量","已经创建角色","本服注册人数已满，请尝试新区"],a?(c=new eui.Label,c.horizontalCenter=0,c.bottom=250,c.text=l[Math.abs(a)],c.size=24,this.addChild(c),r=egret.Tween.get(c),r.wait(1e3).to({bottom:300,alpha:0},1e3).call(function(){u.removeChild(c)}),[2]):(this.start.touchEnabled=!1,window.platform.report("7.创角成功"),urlParam.actorid=s,win.close(this),[2])}})})},e.prototype.createSex=function(){var t=this,e=new eui.Group;e.horizontalCenter=0,e.verticalCenter=25,this.addChild(e);for(var n=["man","woman"],r=function(r){var o=i.sexBtn[r]=new eui.Image;o.source=i.ss.getTexture("createrole_"+(r!=i.sex?"":"select")+n[r]),o.horizontalCenter=0==r?-200:200,e.addChild(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.sex=r;for(var e=0;e<t.sexBtn.length;e++)t.sexBtn[e].source=t.ss.getTexture("createrole_"+(e!=t.sex?"":"select")+n[e]);t.role.source="entry/xl_cr_"+(t.job+1)+t.sex+".png"},i)},i=this,o=0;2>o;o++)r(o)},e.prototype.createInput=function(t){var n=new eui.Image;n.source=this.ss.getTexture("createrole_input"),t.addChild(n);var r=e.input;r.textAlign=egret.HorizontalAlign.CENTER,r.maxChars=6,r.width=140,r.textColor=13746831,r.height=r.size=22,r.horizontalCenter=0,r.verticalCenter=0,t.addChild(r),this.dice.source=this.ss.getTexture("createrole_any"),this.dice.horizontalCenter=125,this.dice.verticalCenter=0,this.dice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),t.addChild(this.dice),t.touchChildren=!0,t.touchEnabled=!1,e.input.addEventListener(egret.FocusEvent.FOCUS_IN,e.textInOn,this)},e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.addEvent=function(t,e,n){return e?void e.addEventListener(t,n,this):void console.error("不存在绑定对象")},e.textInOn=function(){0==e.input.text.length&&(e.input.text="")},e.prototype.randomName=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,Socket.ins().getName(this.sex)];case 1:return t=n.sent().name,e.input.text=t,[2]}})})},e.prototype.sparkTween=function(){for(var t=this,e=0;15>e;e++)setTimeout(function(){t.randomSpark()},1e3*Math.random()+1500);setTimeout(function(){t.stage&&t.sparkTween()},1500)},e.prototype.randomSpark=function(){var t=new eui.Image;t.source=this.ss.getTexture("cr_3"),t.x=300*Math.random()+500,t.rotation=180*Math.random(),t.touchEnabled=!1,this.addChild(t);var e=.3*Math.random()+.7;t.scaleX=t.scaleY=e,t.y=300*Math.random()-50+700;var n=egret.Tween.get(t);n.to({x:480*Math.random(),y:500*Math.random()},3500).call(function(){t.parent&&t.parent.removeChild(t),egret.Tween.removeTweens(t)})},e}(eui.Component);__reflect(CreateRole.prototype,"CreateRole");var LoadingScene=function(t){function e(){var e=t.call(this)||this;e.layoutNum=-1,e.left=e.top=e.right=e.bottom=0;var n=platform.getLoadBg();switch(urlParam.appid){case"7000178":n="bg-pc.jpg";break;case"7000008":n="loadBg_xl.jpg"}var r=cImg(n,e);if(r.horizontalCenter=r.verticalCenter=0,urlParam.showBackHall){var i=cImg("btnBackhall.png",e);i.left=5,i.top=50,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=window.logout;e&&e({confirm:!0})},e)}var o="7000169"==urlParam.appid||"7000182"==urlParam.appid||"7000181"==urlParam.appid,a=o?120:0,s=new eui.Group;s.horizontalCenter=0,s.bottom=72+a,e.addChild(s),e.pg=new eui.ProgressBar,e.pg.thumb=cImg("thumb.png",e.pg),e.pg.slideDuration=0,e.pg.horizontalCenter=0,e.pg.thumb.height=20,e.pg.y=20,s.addChild(e.pg),e.pg.value=Main.curLP,e.light=cImg("light.png",e.pg),e.light.x=0,e.light.height=20,e.light.visible=!1;var l=cImg("progressBg.png",s);l.horizontalCenter=0,Main.loadProgress.push(function(t,n){e.pg.value=t,e.loadText.text=n,e.light.visible=!0,e.light.x=550*t/100-95});var c=new eui.Label;urlParam.isMiniGame||(c.textFlow=(new egret.HtmlTextParser).parse("<u>若长时间加载不成功，点击这里重载</u>")),c.textColor=65280,c.horizontalCenter=0,c.bottom=30+a,c.size=20,e.addChild(c),c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){location.reload()},e);var u=new eui.Label;u.size=14,u.horizontalCenter=0,u.bottom=120+a,u.textColor=2137888,u.text=Main.curStr,e.addChild(u),e.loadText=u;var h=["说好的天荒地老，我不加完你不准走","玛法大陆的BOSS正在准备宝物掉落","服装商人正在准备商品","服务器正在装载海量元宝掉落","客服小姐姐已经准备好为您服务"],d=0,p=new eui.Label;p.horizontalCenter=0,p.bottom=150+a,p.size=18,p.textColor=14800309,p.left=p.right=0,p.text=h[d%5],p.textAlign=egret.HorizontalAlign.CENTER,e.addChild(p);var g=new eui.Label;g.horizontalCenter=0,g.bottom=150+a,g.size=18,g.textColor=14800309,g.left=g.right=0,g.textAlign=egret.HorizontalAlign.CENTER,g.text=h[(d+1)%5],g.visible=!1,e.addChild(g);var f,v,m=function(){if(e.parent){g.visible=!0,f||(f=p.getBounds(),p.scrollRect=f.clone()),v||(v=g.getBounds(),g.scrollRect=v.clone(),g.scrollRect.y=-g.scrollRect.height-3);var t=egret.Tween.get(p.scrollRect);t.to({height:0,y:p.scrollRect.height},500);var n=egret.Tween.get(g.scrollRect);n.to({y:0},500).wait(200).call(function(){p.text=h[d%5],p.scrollRect=f.clone(),g.text=h[(d+1)%5],g.scrollRect=v.clone(),g.scrollRect.y=-g.scrollRect.height-3}),d++,setTimeout(m,2e3)}};if(setTimeout(m,2e3),1201==+urlParam.srvid||1202==+urlParam.srvid){var w=new eui.Label;w.text=platform.getGameVersion(),w.size=20,w.stroke=1,w.textColor=14540731,w.horizontalCenter=0,w.lineSpacing=5,w.textAlign=egret.HorizontalAlign.CENTER,e.addChild(w),w.bottom=160}return e}return __extends(e,t),e.prototype.setProgress=function(t,e){this.pg.value=t,this.loadText.text='游戏正在"'+e+'"，请稍后'},e}(eui.Component);__reflect(LoadingScene.prototype,"LoadingScene");var PackageID;!function(t){t[t.Default=0]="Default",t[t.Guanqia=1]="Guanqia",t[t.Skill=2]="Skill",t[t.Bag=3]="Bag",t[t.Equip=4]="Equip",t[t.Encounter=5]="Encounter",t[t.Wing=6]="Wing",t[t.strongthen=7]="strongthen",t[t.Mail=8]="Mail",t[t.Task=9]="Task",t[t.Boss=10]="Boss",t[t.Gem=11]="Gem",t[t.JingMai=12]="JingMai",t[t.Zs=13]="Zs",t[t.Zhuling=14]="Zhuling",t[t.Tupo=15]="Tupo",t[t.Shop=16]="Shop",t[t.Ring=17]="Ring",t[t.Ranking=18]="Ranking",t[t.Vip=19]="Vip",t[t.Notice=20]="Notice",t[t.LoongSoul=21]="LoongSoul",t[t.TreasureHunt=22]="TreasureHunt",t[t.Train=23]="Train",t[t.FbChallenge=24]="FbChallenge",t[t.Activity=25]="Activity",t[t.Artifact=26]="Artifact",t[t.Recharge=27]="Recharge",t[t.ExpGold=28]="ExpGold",t[t.CDKey=29]="CDKey",t[t.Chat=30]="Chat",t[t.ZhuZaiEquip=31]="ZhuZaiEquip",t[t.ZsBoss=32]="ZsBoss",t[t.pfActivity=33]="pfActivity",t[t.Ladder=34]="Ladder",t[t.Miji=35]="Miji",t[t.moneyTree=36]="moneyTree",t[t.Guild=37]="Guild",t[t.Title=38]="Title",t[t.GuildFB=39]="GuildFB",t[t.GuildWar=40]="GuildWar",t[t.GuildRobber=41]="GuildRobber",t[t.GuildStore=42]="GuildStore",t[t.WarSpirit=43]="WarSpirit",t[t.Dress=44]="Dress",t[t.GuildBoss=46]="GuildBoss",t[t.Friends=47]="Friends",t[t.Mine=49]="Mine",t[t.Rune=50]="Rune",t[t.NeiGong=51]="NeiGong",t[t.Box=52]="Box",t[t.Book=53]="Book",t[t.DailyCheckIn=54]="DailyCheckIn",t[t.Heirloom=55]="Heirloom",t[t.Weapons=56]="Weapons",t[t.Millionaire=57]="Millionaire",t[t.City=58]="City",t[t.ThreeHeroes=59]="ThreeHeroes",t[t.GodWeapon=60]="GodWeapon",t[t.Battle=61]="Battle",t[t.PaoDian=62]="PaoDian",t[t.GodWeaponItem=63]="GodWeaponItem",t[t.Samsara=64]="Samsara",t[t.WJBattle=65]="WJBattle",t[t.WeiWang=66]="WeiWang",t[t.PKCompetition=67]="PKCompetition",t[t.PActivity=68]="PActivity",t[t.HeartMethod=69]="HeartMethod",t[t.JadeNew=70]="JadeNew",t[t.LyMark=71]="LyMark",t[t.KFBoss=72]="KFBoss",t[t.Shenshou=73]="Shenshou",t[t.Hungu=74]="Hungu",t[t.Devildom=75]="Devildom",t[t.Auction=76]="Auction",t[t.KfArena=77]="KfArena",t[t.DemonCir=78]="DemonCir",t[t.LianJi=79]="LianJi",t[t.MoJian=80]="MoJian",t[t.CrossDart=83]="CrossDart",t[t.Contest=84]="Contest",t[t.CrossGuildBattle=85]="CrossGuildBattle",t[t.Xmhj=86]="Xmhj",t[t.XinMo=87]="XinMo",t[t.SpiritEquip=88]="SpiritEquip",t[t.SpiritBoss=89]="SpiritBoss",t[t.LegendTower=90]="LegendTower",t[t.RexueDide=91]="RexueDide",t[t.WarOrder=92]="WarOrder",t[t.ExCard=93]="ExCard",t[t.DevilRuins=94]="DevilRuins",t[t.Smmz=95]="Smmz",t[t.OfficalPost=96]="OfficalPost",t[t.Beast=98]="Beast",t[t.QiongQi=99]="QiongQi",t[t.Login=255]="Login"}(PackageID||(PackageID={})),window.PackageID=PackageID;var PackageMap=window.PackageMap=[],Socket=function(t){function e(){var e=t.call(this)||this;return e._lastReceiveTime=0,e.pid=0,e.isReconnect=!1,e.isShowTip=!0,e.PACK_HANDLER=[],e.brackIndex=-1,egret.startTick(e.update,e),e.newSocket(),e.recvPack=new GameByteArray,e._packets=[],e}return __extends(e,t),e.ins=function(){return e._ins||(e._ins=new e),e._ins},e.prototype.getSocket=function(){return this._socket},e.prototype.newSocket=function(){this._socket&&this.removeEvent(),this._socket=new egret.WebSocket,this._socket.type=egret.WebSocket.TYPE_BINARY,this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)},e.prototype.setDispatch=function(t){t?this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this):this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onSocketRead,this)},e.prototype.removeEvent=function(){this.setDispatch(!1),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.connectError,this)},e.prototype.connect=function(t){var e=this;return void 0===t&&(t=urlParam.wss),new Promise(function(n){e._socket.once(egret.Event.CONNECT,function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.verify()];case 1:return t.sent(),n(!0),[2]}})})},e),console.log("connect to "+t+(new Date).getTime()),e._socket.connectByUrl(t)})},e.prototype.verify=function(){var t=this;return new Promise(function(e){t._socket.once(egret.ProgressEvent.SOCKET_DATA,function(){t.sendKeyToServer(),e(!0)},t);var n=new GameByteArray;n.writeUnsignedInt(0),t._socket.writeBytes(n),t._socket.flush()})},e.prototype.sendKeyToServer=function(){var t=new GameByteArray;this._socket.readBytes(t),t.position=0;var e=t.readUnsignedInt();Encrypt.setTargetSalt(e),t.position=0,t.writeShort(0),this._socket.writeBytes(t,0,2),console.log("connect ok!")},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n){t._socket.once(egret.ProgressEvent.SOCKET_DATA,function(){var r=t.getSocketRead("255, 1");if(r){platform.reportIsnew("login "+r.bytes);var i=r.readByte();0==i?n(!0):alert("Connect failed:"+e.LONGIN_ERROR_CODE[i])}},t),t.sendCheckAccount()})]})})},e.prototype.onSocketClose=function(t){platform.reportIsnew("onSocketClose"),window.KFServerSys&&window.KFServerSys.ins().closeSocket(),this.showReLoginWin()},e.prototype.close=function(){this._socket&&(this.removeEvent(),this._socket.close())},e.prototype.connectError=function(){platform.reportIsnew("connectError"),this.reLogin()},e.prototype.sendToServer=function(t){if(this._socket.writeBytes(t),t.position=4,urlParam.proto){var e=t.readUnsignedByte(),n=t.readUnsignedByte();this.showLog("client:"+PackageMap.indexOf(e)+"-"+n+"  ("+e+"-"+n+")")}return this.recycleByte(t),!0},e.prototype.getSocketRead=function(t){var e=new GameByteArray;this._socket.readBytes(e);try{e.readUnsignedByte(),e.readUnsignedByte()}catch(n){return platform.reportError("getSocketRead Error:"+(e?e.bytes:"")+"-tips:"+t+"-isMiniGame"+urlParam.isMiniGame),null}return e},e.prototype.onSocketRead=function(t){var e=new GameByteArray;this._lastReceiveTime=egret.getTimer(),this._socket.readBytes(e,e.length),window.lastByte=e,this._packets.push(e)},e.prototype.update=function(t){this.brackIndex>=0&&(this._packets.splice(0,this.brackIndex+1),this.brackIndex=-1);for(var e=0,n=this._packets;e<n.length;e++){var r=n[e];this.brackIndex++,this.processRecvPacket(r),this.recycleByte(r)}return this.brackIndex=-1,this._packets.length=0,!1},e.prototype.showReLoginWin=function(){if(!this.isShowTip)return void(Timer.has(this.reLogin,this)||Timer.start(3e3,1,this.reLogin,this));if(window.ViewManager&&window.WarnWin){var t=window.ViewManager,e=window.WarnWin;t.ins().isShow(e)||e.show("网络已断开，点击确定重新连接",this.reLogin,this,this.reLogin,this,"sure")}},e.prototype.reLogin=function(){this.isReconnect=!0,Timer.has(this.reLoginCB,this)||Timer.start(2e3,1,this.reLoginCB,this)},e.prototype.reLoginCB=function(){this.close(),Timer.has(this.onClose,this)||Timer.start(1500,1,this.onClose,this)},e.prototype.onClose=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return t=urlParam.srvid,e=urlParam.gv,isNaN(+t)?[3,2]:[4,window.platform.getServerInfo(+t)];case 1:n.sent(),n.label=2;case 2:if(e==urlParam.gv)this.reconnect();else{if(urlParam.isMiniGame)return window.wx.getUpdateManager().applyUpdate(),[2];location.reload()}return[2]}})})},e.prototype.reconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.isReconnect=!0,this.newSocket(),[4,this.connect()];case 1:return t.sent(),[4,this.login()];case 2:return t.sent(),[4,Main.ins.enterGame()];case 3:return t.sent(),[2]}})})},e.prototype.sendCheckAccount=function(){var t=this.getBytes();t.writeCmd(255,1),t.writeInt(+urlParam.srvid),t.writeString(urlParam.openId),t.writeString(urlParam.openKey||"mzgame"),t.writeString(urlParam.appid||""),t.writeString(urlParam.apptype||""),t.writeString(urlParam.appid||""),t.writeString(urlParam.apptype||""),this.sendToServer(t)},e.prototype.createActor=function(t,e,n){var r=this;return new Promise(function(i){r._socket.once(egret.ProgressEvent.SOCKET_DATA,function(){var t=r.getSocketRead("255, 2");if(t){platform.reportIsnew("createActor "+t.bytes);var e=t.readInt(),n=t.readByte();i({error:n,id:e})}},r);var o=r.getBytes();o.writeCmd(255,2),o.writeUTF(t),o.writeByte(0),o.writeByte(1),o.writeByte(e),o.writeByte(n),r.sendToServer(o)})},e.prototype.getRoleCount=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e){t._socket.once(egret.ProgressEvent.SOCKET_DATA,function(){var n=t.getSocketRead("255, 4");if(n){var r,i=(n.readInt(),n.readByte()),o=0;switch(i){case 0:break;case 1:o=n.readInt(),r=[];for(var a=0;o>a;a++){var s=new SelectRoleData(n);r.push(s)}}urlParam.roleCount=o,platform.reportIsnew("getRoleCount:"+o+" "+n.bytes),e({roleNum:o,roleArr:r})}},t);var n=t.getBytes();n.writeCmd(255,4),t.sendToServer(n)})]})})},e.prototype.sendEnter=function(t){var e=this;return new Promise(function(n){var r=function(){var t=e.getSocketRead("255,5");t&&(platform.reportIsnew("sendEnter "+t.bytes),window.RoleMgr.ins().postEnterGame(t)&&(e._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,r,e),e.setDispatch(!0),n(!0)))};e._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,r,e);var i=e.getBytes();i.writeByte(255),i.writeByte(5),i.writeInt(t),i.writeUTF(urlParam.pfVip||""),i.writeByte(0),i.writeUTF(urlParam.pfVipSuper||""),i.writeByte(0),i.writeUTF(urlParam.pfVipYear||""),i.writeByte(0),i.writeUTF(urlParam.pfVipLv||""),i.writeByte(0),e.sendToServer(i)})},e.prototype.getName=function(t){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(n){return[2,new Promise(function(n){e._socket.once(egret.ProgressEvent.SOCKET_DATA,function(){var t=e.getSocketRead("255, 6");if(t){var r=t.readByte();if(r)return console.warn("随机名字错误! -- "+r),void platform.reportIsnew("getName 随机名字错误 "+r);var i=(t.readByte(),t.readUTF());platform.reportIsnew("getName "+i),n({name:i})}},e);var r=e.getBytes();r.writeCmd(255,6),r.writeByte(t),e.sendToServer(r)})]})})},e.prototype.processRecvPacket=function(t){var e=t.readUnsignedByte(),n=t.readUnsignedByte();this.dispatch(e,n,t)},e.prototype.dispatch=function(t,e,n){var r=t;if(255!=t&&(t=PackageMap.length?PackageMap.indexOf(t):t),!this.PACK_HANDLER[t]||!this.PACK_HANDLER[t][e])return void this.showLog("未处理服务器协议： "+t+" - "+e+"   ("+r+"-"+e+")");this.showLog("server : "+t+" - "+e+"  ("+r+"-"+e+")");var i=this.PACK_HANDLER[t][e];i[0].call(i[1],n)},e.prototype.recycleByte=function(t){ObjectPool.push(t)},e.prototype.getBytes=function(){var t=ObjectPool.pop(e.CLASSNAME);return t.clear(),t.writeUnsignedInt(this.pid++),t},e.prototype.registerSTCFunc=function(t,e,n,r){if(this.PACK_HANDLER[t]){if(this.PACK_HANDLER[t][e])return void console.error("重复注册协议接口"+t+"-"+e)}else this.PACK_HANDLER[t]=[];this.PACK_HANDLER[t][e]=[n,r]},e.prototype.showLog=function(t){urlParam.proto&&console.warn(t)},e.LONGIN_ERROR_CODE=["","密码错误","没有这个账号","账号已登录，请刷新页面，最长需等待3分钟后重新登录","服务器忙","服务器维护中","Session服务器出错，可能数据库没连接好","不存在这个服务器","账号已纳入防沉迷系统，是否需要进行身份证信息填写？"],e.CLASSNAME=egret.getQualifiedClassName(GameByteArray),e}(egret.HashObject);__reflect(Socket.prototype,"Socket"),window.Socket=Socket;var uint64=function(){function t(t){this._lowUint=0,this._highUint=0,this.value=t}return t.prototype.isEqual=function(t){return t?this._lowUint==t._lowUint&&this._highUint==t._highUint:!1},t.prototype.isGreaterThan=function(e){if(e instanceof t)return this._highUint>e._highUint||this._highUint==e._highUint&&this._lowUint>e._lowUint;var n=new t;return"string"==typeof e?(n.value=e,this.isGreaterThanOrEqual(n)):"number"==typeof e?(n.value=e.toString(),this.isGreaterThanOrEqual(n)):void 0},t.prototype.isGreaterThanOrEqual=function(e){if(e instanceof t)return this._highUint>e._highUint||this._highUint==e._highUint&&this._lowUint>=e._lowUint;var n=new t;return"string"==typeof e?(n.value=e,this.isGreaterThanOrEqual(n)):"number"==typeof e?(n.value=e.toString(),this.isGreaterThanOrEqual(n)):void 0},Object.defineProperty(t.prototype,"isZero",{get:function(){return 0==this._lowUint&&0==this._highUint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGreaterThanZero",{get:function(){return this._lowUint>0||this._highUint>0},enumerable:!0,configurable:!0}),t.prototype.writeByte=function(t){t.writeUnsignedInt(this._lowUint),t.writeUnsignedInt(this._highUint)},t.prototype.setValue=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this._lowUint=t,this._highUint=e},Object.defineProperty(t.prototype,"value",{set:function(e){e instanceof egret.ByteArray?(this._lowUint=e.readUnsignedInt(),this._highUint=e.readUnsignedInt()):"string"==typeof e&&t.stringToUint64(e,10,this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueByString",{set:function(t){},enumerable:!0,configurable:!0}),t.prototype.leftMove=function(e,n){void 0===n&&(n=null),n=n||this;var r=t.LeftMoveMask[e],i=r&this._lowUint;i>>>=32-e,n._lowUint=this._lowUint<<e,n._highUint=this._highUint<<e,n._highUint=n._highUint|i},t.prototype.add=function(e,n){void 0===n&&(n=null),n=n||this;var r=this._lowUint+e._lowUint;n._highUint=this._highUint+e._highUint,r>=t.MaxLowUint?(n._highUint++,n._lowUint=r-t.MaxLowUint):n._lowUint=r},t.prototype.subtraction=function(e,n){void 0===n&&(n=null),n=n||this;var r=this._lowUint-e._lowUint;n._highUint=this._highUint-e._highUint,0>r?(n._highUint--,n._lowUint=r+t.MaxLowUint):n._lowUint=r},t.prototype.scale=function(e,n){void 0===n&&(n=null),n=n||this;var r=this._lowUint*e;n._highUint=this._highUint*e,n._highUint+=Math.floor(Math.abs(r/t.MaxLowUint)),n._lowUint=r%t.MaxLowUint},t.prototype.toString=function(e){void 0===e&&(e=10);for(var n,r,i,o="",a=this._lowUint,s=this._highUint;0!=s||0!=a;)n=s%e,i=n*t.MaxLowUint+a,r=i%e,o=r+o,s=(s-n)/e,a=(i-r)/e;return o.length?o:"0"},t.stringToUint64=function(e,n,r){void 0===n&&(n=10),void 0===r&&(r=null),r=r||new t;for(var i,o,a=0,s=0,l=e.length,c=0;l>c;c++)o=parseInt(e.charAt(c)),i=a*n+o,s=s*n+Math.floor(i/t.MaxLowUint),a=i%t.MaxLowUint;return r.setValue(a,s),r},t.LeftMoveMask=[0,2147483648,1073741824,536870912,268435456,134217728,67108864,33554432,16777216,8388608,4194304,2097152,1048576,524288,262144,131072,65536,32768,16384,8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1],t.MaxLowUint=4294967296,t}();__reflect(uint64.prototype,"uint64");var CRC16=function(){function t(){}return t.update=function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=0,o=0;0==r&&(r=e.length),e.position=n;for(var a=n;r>a;++a)o=255&t.CRCBitReflect(e.readByte(),8)^i>>8&16777215,o&=255,i=t.CRCTable[o]^i<<8&4294967040;return 65535&(0^t.CRCBitReflect(i,16))},t.makeCRCTable=function(){for(var e=0,n=new Array(256),r=0;256>r;++r){e=r<<8&4294967040;for(var i=0;8>i;++i)e=32768&e?e<<1&4294967294^t.POLYNOMIAL:e<<1&4294967294;n[r]=e}return n},t.CRCBitReflect=function(e,n){var r=0,i=0;n--;for(var o=0;n>=o;++o)i=n-o,1&e&&(r|=1<<i&t.DropBits[i]),e=e>>1&2147483647;return r},t.POLYNOMIAL=4129,t.CRCTable=t.makeCRCTable(),t.DropBits=[4294967295,4294967294,4294967292,4294967288,4294967280,4294967264,4294967232,4294967168,4294967040,4294966784,4294966272,4294965248,4294963200,4294959104,4294950912,4294934528],t}();__reflect(CRC16.prototype,"CRC16");var EntryWin=function(t){function e(){var e=t.call(this)||this;return e.rectClose=!1,e._sn_="localentryskin",e}return __extends(e,t),e.prototype.skinComplete=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i,i,o=this;return __generator(this,function(a){switch(a.label){case 0:return t=window,e=t.serverList,n=t.resList,e?[3,2]:[4,RES.getResByUrl("list.json")];case 1:r=a.sent(),n=r.resList,e=r.serverList,a.label=2;case 2:for(i in e)e[i]={name:e[i],value:i};for(i in n)n[i]={name:n[i],value:i};return this.eSs.bindData(e,+getLocation("eSs")),this.eRs.bindData(n,+getLocation("eRs")),this.eCs.bindData(n,+getLocation("eCs")),this.eCs.visible=!urlParam.isMiniGame,this.skillEditor.visible=this.cz.visible=this.fps.visible=isLocation(),this.fps.selected=getLocation("fps",LocationValue.Boolean),this.checkFPS(),this.addChangeEvent(this.eSs,this.changeClient),this.addChangeEvent(this.eRs,this.changeClient),this.addChangeEvent(this.eCs,this.changeClient),this.addChangeEvent(this.fps,function(){setLocation("fps",o.fps.selected+""),o.checkFPS()}),this.addTouchEvent(this.skillEditor,function(){location.href="http://192.168.0.160/skill/index.html?resURL="+o.eRs.selectItem.name.split("|").pop()}),this.addTouchEvent(this.cz,function(){location.href="http://192.168.0.21:8999/"}),this.input.text=getLocation("user"),this.addTouchEvent(this.enterBtn,function(){var t=o.eSs.selectItem.name.split("|");urlParam.root=o.eRs.selectItem.name.split("|").pop(),urlParam.wss=t.pop(),urlParam.srvid=t.pop(),urlParam.openId=o.input.text,urlParam.fps=""+o.fps.selected,setLocation("user",urlParam.openId),!urlParam.isMiniGame&&isLocation()&&isNaN(urlParam.ev)?loadSingleScript(o.eCs.selectItem.name.split("|").pop()+"main.min.js",function(){o.resolve()}):o.resolve(),win.close(o)}),[2]}})})},e.prototype.changeClient=function(){setLocation("eSs",this.eSs.selectItem.value+""),setLocation("eRs",this.eRs.selectItem.value+""),setLocation("eCs",this.eCs.selectItem.value+"")},e.prototype.checkFPS=function(){var t=document.getElementById("egret-fps-panel");t&&(t.style.visibility=this.fps.selected?"visible":"hidden")},e.prototype.complete=function(){var t=this;return new Promise(function(e){t.resolve=e})},e.prototype.addChangeEvent=function(t,e){var n=this;t&&t instanceof eui.TabBar?this.addEvent(egret.TouchEvent.CHANGE,t,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.call.apply(e,[n].concat(t))}):this.addEvent(egret.TouchEvent.CHANGE,t,e)},e.prototype.addEvent=function(t,e,n){return e?void e.addEventListener(t,n,this):void console.error("不存在绑定对象")},e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e}(eui.Component);__reflect(EntryWin.prototype,"EntryWin");var SelectRole=function(t){function e(){var e=t.call(this)||this;e.defaultRect=!1,e.left=e.top=e.right=e.bottom=0;var n=cImg("black.jpg",e);n.top=n.left=n.right=n.bottom=0,n.scale9Grid=new egret.Rectangle(2,2,3,3),e.addChild(n);var r=new eui.Group;r.width=420,r.height=600,r.verticalCenter=r.horizontalCenter=0,e.addChild(r),n=cImg("tongyongkuang3bg.png",r),n.top=n.left=n.right=n.bottom=0,n.scale9Grid=new egret.Rectangle(11,11,8,8),n=cImg("tongyongkuang3tou.png",r),n.right=n.left=0,n=cImg("biaoti_hfxj.png",r),n.horizontalCenter=0,n.top=11,r.addChild(n);var i=new eui.Group;i.bottom=6,i.horizontalCenter=0,i.scaleX=.737;var o=new eui.HorizontalLayout;o.gap=0,i.layout=o;var a=cImg("bantoumingkuang3.png",e);i.addChild(a),a=cImg("bantoumingkuang3.png",e),a.scaleX=-1,i.addChild(a),r.addChild(i);var s=new eui.Group;cImg("btn2.png",s);var l=new eui.Label;l.verticalCenter=0,l.horizontalCenter=0,l.text="进入游戏",l.textColor=14540731,l.size=20,s.addChild(l),s.horizontalCenter=0,s.bottom=20,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){s.scaleX=s.scaleY=.9},e),s.addEventListener(egret.TouchEvent.TOUCH_END,function(){s.scaleX=s.scaleY=1},e),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){for(var t=e.list.numChildren,n=0;t>n;n++){var r=e.list.getChildAt(n);if(r.selected){urlParam.actorid=r.data.id,win.close(e);break}}},e),r.addChild(s);var c=new eui.Scroller;return c.left=10,c.top=48,c.right=10,c.bottom=100,r.addChild(c),e.list=new eui.List,e.list.itemRenderer=SelectRoleItem,c.viewport=e.list,c.addChild(e.list),e.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){for(var n=e.list.numChildren,r=0;n>r;r++){var i=e.list.getChildAt(r);i.selected=i.data==t.item,i.dataChanged()}},e),e}return __extends(e,t),e.prototype.setRoleDatas=function(t){this.list.dataProvider=new eui.ArrayCollection(t),this.list.selectedIndex=0},e}(eui.Component);__reflect(SelectRole.prototype,"SelectRole");var SelectRoleItem=function(t){function e(){var e=t.call(this)||this;e.head=new eui.Image,e.nameLab=new eui.Label,e.levelLab=new eui.Label,e.powerLab=new eui.Label,e.vipLab=new eui.BitmapLabel,e.vLab=new eui.BitmapLabel,e.selectImg=new eui.Image,e.height=100;var n=cImg("tongyonglabbg.png",e);n.top=n.left=n.right=n.bottom=0,n.scale9Grid=new egret.Rectangle(63,31,3,3),n=cImg("touxiangkuang0.png",e),n.width=n.height=70,n.left=25,n.verticalCenter=0,n.scale9Grid=new egret.Rectangle(6,6,3,3),e.head.verticalCenter=0,e.head.left=30,e.addChild(e.head);var r=new eui.Group;r.verticalCenter=0,r.left=120;var i=new eui.VerticalLayout;return i.gap=2,r.layout=i,e.addChild(r),e.nameLab.textColor=15978507,e.nameLab.size=20,e.nameLab.bold=!0,r.addChild(e.nameLab),e.levelLab.textColor=11645079,e.levelLab.size=18,r.addChild(e.levelLab),e.powerLab.textColor=11645079,e.powerLab.size=18,r.addChild(e.powerLab),e.selectImg.source="entry/xuanzhongkuang2.png",e.selectImg.top=e.selectImg.left=e.selectImg.right=e.selectImg.bottom=0,e.selectImg.scale9Grid=new egret.Rectangle(6,6,4,4),e.addChild(e.selectImg),r=new eui.Group,r.horizontalCenter=115,r.verticalCenter=0,e.addChild(r),e.vLab.text="v",r.addChild(e.vLab),e.vipLab.verticalCenter=5,e.vipLab.left=30,r.addChild(e.vipLab),e.loadFnt(),e
}return __extends(e,t),e.prototype.dataChanged=function(){this.head.source="entry/head_"+this.data.roleClass+this.data.sex+".png",this.nameLab.text=this.data.name,this.levelLab.text="等级: "+this.data.zsLevel+"转"+this.data.level+"级",this.powerLab.text="战力: "+this.data.power,this.selectImg.visible=this.selected,this.vipLab.visible=this.vLab.visible=!!this.data.vipLevel,this.vipLab.text=this.data.vipLevel+""},e.prototype.loadFnt=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return t=this.vLab,e=this.vipLab,[4,urlLoad("entry/vt.fnt",RES.ResourceItem.TYPE_FONT)];case 1:return t.font=e.font=n.sent(),[2]}})})},e}(eui.ItemRenderer);__reflect(SelectRoleItem.prototype,"SelectRoleItem");var SelectRoleData=function(){function t(t){this.id=t.readInt(),this.name=t.readUTF(),t.readByte(),this.roleClass=t.readInt(),this.zsLevel=t.readInt(),this.level=t.readInt(),this.power=t.readDouble(),this.vipLevel=t.readInt(),this.sex=t.readInt()}return t}();__reflect(SelectRoleData.prototype,"SelectRoleData");var entry;!function(t){var e=function(e){function n(){var t=e.call(this)||this;t.ac=new eui.ArrayCollection,t.top=85,t.bottom=110,t.horizontalCenter=0,t.width=550;var n=cImg("xfbg.png",t);n.scale9Grid=new egret.Rectangle(290,90,2,2),n.top=n.left=n.right=n.bottom=0;var r=cImg("xft.png",t),i=cImg("xft.png",t);i.scaleX=-1,r.horizontalCenter=-142,i.horizontalCenter=142,r.top=i.top=-20;var o=cImg("xffnt.png",t);o.horizontalCenter=0,o.top=-5,t.createSerItem(),t.createSerArea();var a=cImg("greenjewel.png",t);a.bottom=35,a.horizontalCenter=-180,a=cImg("biaoti_xinfu.png",t),a.bottom=37,a.horizontalCenter=-140,a=cImg("redjewel.png",t),a.bottom=35,a.horizontalCenter=-40,a=cImg("biaoti_huobao.png",t),a.bottom=37,a.horizontalCenter=0,a=cImg("grayjewel.png",t),a.bottom=35,a.horizontalCenter=100,a=cImg("biaoti_weihu.png",t),a.bottom=37,a.horizontalCenter=140;var s=cImg("tuichubtn.png",t);return s.right=15,s.bottom=10,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.parent.removeChild(t)},t),t}return __extends(n,e),n.prototype.createSerArea=function(){var e=new eui.Group;this.addChild(e),e.left=15,e.top=80,e.right=310,e.bottom=70;var n=new eui.Scroller;n.top=n.bottom=15,n.horizontalCenter=0,e.addChild(n),this.tab=new eui.List,this.tab.itemRenderer=t.SerAreaItem;var r=new eui.VerticalLayout;r.gap=10,this.tab.layout=r,n.addChild(this.tab),n.viewport=this.tab;for(var i=20,o=urlParam.page,a=[],s=0;o>s;s++)a.push([i*s+1+"-"+(s+1)*i+"区",s+1]);a.push(["最近登录",0]),this.tab.dataProvider=new eui.ArrayCollection(a.reverse()),this.tab.addEventListener(egret.Event.CHANGE,this.updateList,this),this.tab.selectedIndex=0,this.updateList()},n.prototype.updateList=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return t=this.tab.selectedItem[1],t>=0?[4,window.platform.getServerList(t)]:[3,2];case 1:e=n.sent(),this.ac.source=e,n.label=2;case 2:return[2]}})})},n.prototype.createSerItem=function(){var e=this,n=new eui.Group;this.addChild(n),n.left=215,n.top=60,n.right=15,n.bottom=90;var r=cImg("xfg.png",n);r.top=r.left=r.right=r.bottom=0,r.scale9Grid=new egret.Rectangle(11,11,2,2);var i=new eui.Scroller;i.top=i.bottom=15,i.horizontalCenter=0,n.addChild(i);var o=new eui.List;o.itemRenderer=t.ServerItem;var a=new eui.VerticalLayout;a.gap=10,o.layout=a,i.addChild(o),i.viewport=o,o.dataProvider=this.ac,o.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(n){return __awaiter(e,void 0,void 0,function(){var e,r,i,a,s,l=this;return __generator(this,function(c){switch(c.label){case 0:return urlParam.loginSys?(WaitWin.show(),[4,Http.post(urlParam.loginSys+"use","openId="+urlParam.openId+"&id="+n.item.id)]):[3,2];case 1:if(e=c.sent(),r=JSON.parse(e),r.err)return WaitWin.hide(),t.Tips.show(r.err,["确定"],[function(){}]),[2];for(i in r)urlParam[i]=r[i];return Main.enterGameMain(),[2];case 2:return n.item.status&&3!=n.item.status?(o.touchEnabled=!1,o.touchChildren=!1,this.touchChildren=!1,WaitWin.show(),urlParam.srvid=n.item.srvid+"",Main.enterGameMain(n.item.idx,!0),[2]):(a=new eui.Label,a.horizontalCenter=0,a.bottom=250,a.text="当前服务器正在维护",a.size=24,this.addChild(a),s=egret.Tween.get(a),s.wait(1e3).to({bottom:300,alpha:0},1e3).call(function(){l.removeChild(a)}),[2])}})})},this)},n}(eui.Component);t.SelectServer=e,__reflect(e.prototype,"entry.SelectServer")}(entry||(entry={}));var entry;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.img=cImg("xf1.png",e),e.text=new eui.Label,e.text.size=22,e.text.textColor=9484749,e.text.stroke=1,e.text.left=50,e.text.verticalCenter=0,e.addChild(e.text),e}return __extends(e,t),e.prototype.dataChanged=function(){this.img.source="entry/xf1.png",this.text.text=this.data[0]},Object.defineProperty(e.prototype,"selected",{set:function(t){this.img.source="entry/xf"+(+t+1)+".png"},enumerable:!0,configurable:!0}),e.prototype.getPage=function(){return this.data[1]},e}(eui.ItemRenderer);t.SerAreaItem=e,__reflect(e.prototype,"entry.SerAreaItem")}(entry||(entry={}));var entry;!function(t){var e=function(t){function e(){var e=t.call(this)||this;e.icon=new eui.Image,e.iconLab=new eui.Image,e.width=282,e.height=56;var n=cImg("dk.png",e);return n.top=n.left=n.right=n.bottom=0,e.dk=n,e.text=new eui.Label,e.text.verticalCenter=e.text.horizontalCenter=0,e.text.size=22,e.text.textColor=11119009,e.text.stroke=1,e.addChild(e.text),e.icon.verticalCenter=0,e.icon.horizontalCenter=-100,e.addChild(e.icon),e.iconLab.verticalCenter=0,e.iconLab.horizontalCenter=100,e.addChild(e.iconLab),e}return __extends(e,t),e.prototype.dataChanged=function(){urlParam.loginSys?this.text.text=this.data.id+1+"区":this.text.text=this.data?this.data.entryname:"传奇"+this.itemIndex+"区";var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this.dk.filters=this.data.status?[e]:[],this.data.status&&3!=this.data.status?1==this.data.status?(this.icon.source="entry/greenjewel.png",this.iconLab.source="entry/biaoti_xinfu.png"):2==this.data.status?(this.icon.source="entry/redjewel.png",this.iconLab.source="entry/biaoti_huobao.png"):(this.icon.source="",this.iconLab.source=""):(this.icon.source="entry/grayjewel.png",this.iconLab.source="entry/biaoti_weihu.png")},e}(eui.ItemRenderer);t.ServerItem=e,__reflect(e.prototype,"entry.ServerItem")}(entry||(entry={}));var Tips=entry.Tips,ShiMingRenZhengWin=function(t){function e(){var e=t.call(this)||this;return e.num=1,e.initUI(),e.init(),e}return __extends(e,t),e.prototype.initUI=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r;return __generator(this,function(i){return this.horizontalCenter=0,this.verticalCenter=0,t=new eui.Group,t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t),e=cImg("createbg1.jpg",t),e.horizontalCenter="0",e.verticalCenter="0",e=cImg("shimingrenzheng_1.png",t),e.horizontalCenter="0",e.verticalCenter="0",e.width=400,e.height=500,e.scale9Grid=new egret.Rectangle(5,7,30,42),n=new eui.Label,n.text="实名注册",n.textColor=0,n.width=400,n.size=24,n.fontFamily="SimHei",n.textAlign="center",n.horizontalCenter="0",n.verticalCenter="-213",t.addChild(n),n=new eui.Label,n.text="您的账号尚未进行实名注册。按照文化部《网络游戏管理暂行办法》的相关要求，网络游戏用户需要使用有效身份证进行实名注册才可进行充值。",n.textColor=0,n.width=380,n.height=122,n.size=22,n.bold=!0,n.fontFamily="SimHei",n.horizontalCenter="10",n.verticalCenter="-105",t.addChild(n),n=new eui.Label,n.text="*身份信息只能提交一次不可修改，请谨慎填写；",n.textColor=7499631,n.width=353,n.size=16,n.bold=!0,n.fontFamily="SimHei",n.horizontalCenter="-3.5",n.verticalCenter="-48",t.addChild(n),n=new eui.Label,n.text="*此信息属于个人隐私，本平台承诺绝不公告，编辑或透露给第三方",n.textColor=7499631,n.width=353,n.size=16,n.bold=!0,n.fontFamily="SimHei",n.horizontalCenter="-3.5",n.verticalCenter="-14",t.addChild(n),this.eNameInput=new eui.EditableText,this.eNameInput.width=350,this.eNameInput.height=30,this.eNameInput.textColor=6513507,this.nameStr=this.eNameInput.text="请输入您的真实姓名",this.eNameInput.verticalCenter=73,this.eNameInput.horizontalCenter=1,this.eNameInput.size=22,this.eNameInput.textAlign=egret.HorizontalAlign.CENTER,t.addChild(this.eNameInput),r=new eui.Rect,r.width=350,r.height=1,r.fillColor=10854303,r.verticalCenter=89.5,r.horizontalCenter=1,t.addChild(r),this.eIDInput=new eui.EditableText,this.eIDInput.width=350,this.eIDInput.height=30,this.eIDInput.textColor=6513507,this.eIDInput.size=22,this.IDStr=this.eIDInput.text="请输入您的身份证号码",this.eIDInput.verticalCenter=127,this.eIDInput.horizontalCenter=1,this.eIDInput.textAlign=egret.HorizontalAlign.CENTER,t.addChild(this.eIDInput),r=new eui.Rect,r.width=350,r.height=1,r.fillColor=10854303,r.verticalCenter=143.5,r.horizontalCenter=1,t.addChild(r),this.eBtn=cImg("shimingrenzheng_2.png",t),this.eBtn.horizontalCenter=0,this.eBtn.verticalCenter=195,n=new eui.Label,n.text="立即认证",n.textColor=0,n.width=200,n.height=50,n.size=20,n.fontFamily="SimHei",n.textAlign="center",n.verticalAlign="middle",n.touchEnabled=!1,n.horizontalCenter=0,n.verticalCenter=195,t.addChild(n),[2]})})},e.prototype.init=function(){this.addTouchEvent(this.eBtn,this.onClick),this.eNameInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.nameInOn,this),this.eIDInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.IdInOn,this)},e.prototype.nameInOn=function(){this.eNameInput.text==this.nameStr&&(this.eNameInput.text="")},e.prototype.IdInOn=function(){this.eIDInput.text==this.IDStr&&(this.eIDInput.text="")},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:this.num<=0?Tips.show("您今日的验证次数已用完，请明日再来。",["确定"],[function(){}]):this.checkId()}},e.prototype.checkId=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,r,i,o,a=this;return __generator(this,function(s){switch(s.label){case 0:return t=urlParam?urlParam.appid:"",e=urlParam?urlParam.openId:"",n=urlParam?urlParam.openKey:"",[4,Http.get("https://ltm.fenzhihuyu.cn/master/user/pass/verify.json?appId="+t+"&openId="+e+"&openKey="+n+"&name="+this.eNameInput.text+"&idcard="+this.eIDInput.text)];case 1:if(r=s.sent(),!r)return Tips.show("您的认证信息有误，请重新填写",["确定"],[function(){}]),[2];if(i=JSON.parse(r),i&&0==i.data.code)switch(this.num=i.data.data.remainAuthCount,o=i.data.data.realNameAuthResult){case 1:Tips.show("验证成功，祝您游戏愉快。",["确定"],[function(){a.resolve()}]);break;case 2:Tips.show("根据《国家新闻出版署关于防止未成年人沉迷\n网络游戏的通知》要求您的年龄不足18周岁不\n符合我们游戏进入要求，您将无法进入游戏！\n剩余"+this.num+"次",["确定"],[function(){}]),this.eNameInput.text==this.nameStr,this.eIDInput.text=this.IDStr;break;default:Tips.show("您的认证信息有误，请重新填写\n剩余"+this.num+"次",["确定"],[function(){}])}else Tips.show("您的认证信息有误，请重新填写",["确定"],[function(){}]);return[2]}})})},e.prototype.complete=function(){var t=this;return new Promise(function(e){t.resolve=e})},e.prototype.addEvent=function(t,e,n){return e?void e.addEventListener(t,n,this):void console.error("不存在绑定对象")},e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e}(eui.Component);__reflect(ShiMingRenZhengWin.prototype,"ShiMingRenZhengWin");var _locationFun={};window.setLocationDef=setLocationDef,window.setLocation=setLocation,window.getLocation=getLocation;var LocationValue;!function(t){t[t.String=0]="String",t[t.Number=1]="Number",t[t.Boolean=2]="Boolean"}(LocationValue||(LocationValue={})),window.LocationValue=LocationValue;var DropDown2=function(t){function e(){var e=t.call(this)||this;return e.skinName="DropDownSkin2",e.init(),e}return __extends(e,t),e.prototype.bindData=function(t,e){void 0===e&&(e=0),this.data={listData:t,def:e},this.eL&&this.setData()},e.prototype.init=function(){var t=this;this.currentState="up",this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.eL.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.name=e.item.name,t.dispatchEventWith(egret.Event.CHANGE)},this),this.eL.itemRenderer=DropDownItemRender2},e.prototype.onTap=function(t){var e=this;this.currentState="up"==this.currentState?"down":"up",this.stage&&("down"==this.currentState?egret.callLater(function(){return e.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e)},this):(t.stopPropagation(),egret.callLater(function(){return e.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e)},this)))},e.prototype.setData=function(){var t=this.data,e=t.listData,n=t.def;this.eL.dataProvider=new eui.ArrayCollection(e),this.eL.selectedIndex=n,this.name=e[n].name},e.prototype.addDisplay=function(){this.data&&this.setData()},e.prototype.removeDisplay=function(){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},Object.defineProperty(e.prototype,"selectItem",{get:function(){return this.eL.selectedItem},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(DropDown2.prototype,"DropDown2"),window.DropDown2=DropDown2;var DropDownItemRender2=function(t){function e(){var e=t.call(this)||this;return e._sn_="DropDownItemSkin2",e}return __extends(e,t),e}(eui.ItemRenderer);__reflect(DropDownItemRender2.prototype,"DropDownItemRender2"),window.DropDownItemRender2=DropDownItemRender2;var ExternalInterFace=function(){function t(){}return t.call=function(t,e,n){n&&egret.ExternalInterface.addCallback(t,n),egret.ExternalInterface.call(t,e)},t}();__reflect(ExternalInterFace.prototype,"ExternalInterFace");var Http=function(){function t(){}return t.get=function(t,e){return void 0===e&&(e=!1),this.request(t,null,e)},t.post=function(t,e,n){return void 0===n&&(n=!1),this.request(t,e,n,egret.HttpMethod.POST)},t.request=function(t,e,n,r,i){var o=this;return void 0===n&&(n=!1),void 0===r&&(r=egret.HttpMethod.GET),void 0===i&&(i=egret.HttpResponseType.TEXT),new Promise(function(a){var s=new egret.HttpRequest;s.responseType=i,s.open(t,r),s.once(egret.Event.COMPLETE,function(t){a(s.response)},o),s.once(egret.IOErrorEvent.IO_ERROR,function(t){n||a(void 0)},o),s.send(e)})},t}();__reflect(Http.prototype,"Http"),window.Http=Http;var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];t._content[e]||(t._content[e]=[]);var i=t._content[e];if(i.length){var o=i.pop();return o}var a=egret.getDefinitionByName(e);a||console.warn(e);var s=new(a.bind.apply(a,[void 0].concat(n)));return s.ObjectPoolKey=e,s},t.popWithExtraKey=function(e,n){t._content[e]||(t._content[e]=[]);var r,i=t._content[e];if(i.length)for(var o=0;o<i.length;o++)if(i[o].extraKey==n){r=i[o],i.splice(o,1);break}if(!r){var a=egret.getDefinitionByName(e);r=new a(n),r.extraKey=n,r.ObjectPoolKey=e}return r},t.push=function(e){if(null==e)return!1;var n=e.ObjectPoolKey;return!t._content[n]||t._content[n].indexOf(e)>-1?!1:(t._content[n].push(e),!0)},t.clear=function(){t._content={}},t.clearClass=function(e,n){void 0===n&&(n=null);for(var r=t._content[e];r&&r.length;){var i=r.pop();n&&i[n](),i=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,n){var r=t._content[e];if(null!=r){var i=0,o=r.length;for(i;o>i;i++)r[i][n]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool"),window.ObjectPool=ObjectPool;var RES_RESOURCE=window.RES_RESOURCE="resource",RES_DIR=window.RES_DIR="res",MAP_DIR=window.MAP_DIR="map",RES_DIR_BLOOD=RES_DIR+"/blood/",RES_DIR_IMG=window.RES_DIR_IMG=RES_DIR+"/img/",RES_DIR_CHENGHAO=window.RES_DIR_CHENGHAO=RES_DIR+"/chenghao/",RES_DIR_BODY=window.RES_DIR_BODY=RES_DIR+"/model/body/",RES_DIR_EFF=window.RES_DIR_EFF=RES_DIR+"/eff/",RES_DIR_ITEM=RES_DIR+"/item/",RES_DIR_MONSTER=window.RES_DIR_MONSTER=RES_DIR+"/model/body/",RES_DIR_SKILL=window.RES_DIR_SKILL=RES_DIR+"/skill/",RES_DIR_SKILLEFF=window.RES_DIR_SKILLEFF=RES_DIR+"/skilleff/",RES_DIR_WARSPIRIT=RES_DIR+"/warspirit/",RES_DIR_WEAPON=window.RES_DIR_WEAPON=RES_DIR+"/model/weapon/",RES_DIR_WING=window.RES_DIR_WING=RES_DIR+"/model/wing/",RES_DIR_CITY=window.RES_DIR_CITY=RES_DIR+"/city/",RES_DIR_DRESS=window.RES_DIR_DRESS=RES_RESOURCE+"/image/role/",RES_DIR_FEATHER=window.RES_DIR_FEATHER=RES_DIR+"/feather/",AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var _a=RES.host,save=_a.save,remove=_a.remove;RES.gpuMemory=0,RES.picDic={},RES.host.save=function(t,e){save(t,e),t.type==RES.ResourceItem.TYPE_IMAGE&&(RES.picDic[t.name]||(RES.picDic[t.name]=e,RES.gpuMemory+=e.$bitmapWidth*e.$bitmapHeight*4))},RES.host.remove=function(t){var e=RES.host.get(t);remove(t),t.type==RES.ResourceItem.TYPE_IMAGE&&RES.picDic[t.name]&&(delete RES.picDic[t.name],RES.gpuMemory-=e.$bitmapWidth*e.$bitmapHeight*4)};var ResourceMgr=function(t){function e(){var e=t.call(this)||this;return e.setValue(200),e}return __extends(e,t),e.ins=function(){return this._ins||(this._ins=new e),this._ins},e.prototype.destroyRes=function(t){if(!(RES.gpuMemory<1024*t*1024))for(var e in RES.picDic){var n=RES.picDic[e];if(this.checkCanDestroy(n)){if(e.indexOf(MAP_DIR)>=0)continue;if(!~e.indexOf("png")){this.destroy(e);continue}if(~e.indexOf(".")){var r=e.split("/").pop(),i=r.replace(".png","_json");if(RES.getResourceInfo(i)){this.destroy(i);continue}if(i=i.replace(".png",".fnt"),RES.getResourceInfo(i)){console.log("字体--- ",e);continue}}var o=e.replace(".png",".fnt");if(RES.getResourceInfo(o))continue;this.destroy(e)}}},e.prototype.destroy=function(t){RES.destroyRes(t)},e.prototype.checkCanDestroy=function(t){if(!t)return!1;var e=t.bitmapData;if(!e)return!1;var n=e.hashCode;if(!n)return!1;var r=egret.BitmapData._displayList[n],i=window.MovieClip?window.MovieClip.displayList[n]:[];return!(r&&r.length||i&&i.length)},e.prototype.reloadContainer=function(t){for(var e=t.numChildren,n=0;e>n;n++){var r=t.getChildAt(n);if(r instanceof eui.Image){var i=r.source;r.source=null,r.source=i}else r instanceof egret.DisplayObjectContainer&&this.reloadContainer(r)}},e.prototype.setValue=function(t){Timer.stopAll(this),Timer.start(5e3,0,this.destroyRes,this,t)},e}(egret.HashObject);__reflect(ResourceMgr.prototype,"ResourceMgr"),ResourceMgr.ins(),window.ResourceMgr=ResourceMgr;var LayoutNum;!function(t){t[t.bottom=-1]="bottom",t[t.center=0]="center",t[t.top=1]="top"}(LayoutNum||(LayoutNum={}));var win=function(){function t(){}return t.setTop=function(t){this.topLayer.top=this.centerLayer.top=this.bottomLayer.top=t,this.topLayer.bottom=this.centerLayer.bottom=this.bottomLayer.bottom=0},t.init=function(){var t=egret.MainContext.instance.stage;this.root.touchEnabled=!1,t.addChild(this.root),this.bottomLayer.name="bottomLayer",this.bottomLayer.touchEnabled=!1,this.root.addChild(this.bottomLayer),this.centerLayer.name="centerLayer",this.centerLayer.touchEnabled=!1,this.root.addChild(this.centerLayer),this.topLayer.name="topLayer",this.topLayer.touchEnabled=!1,this.root.addChild(this.topLayer)},t.openCheck=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!0),t=this.changeStr(t);var r=t.openCheck,i=!r||r.apply(void 0,e);if(Array.isArray(i)){var o=i;if(i=o.shift(),n){var a=t.showTips;a?a.apply(void 0,o):window.TipsCT.ins().showTips(o[0])}}return i},Object.defineProperty(t,"hasTop",{get:function(){return this._hasTop},enumerable:!0,configurable:!0}),t.changeStr=function(t){if("string"==typeof t){var e=window.Win2Str[t];return e}return t},t.openbyskin=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=this.openCheck(t,n);t=this.changeStr(t);var o=this.getFlag(t);return i?this.$wins[o]?this.$wins[o]:this.createView(t,o,e,n):void 0},t.open=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.openCheck(t,e);t=this.changeStr(t);var i=this.getFlag(t);return r?this.$wins[i]?this.$wins[i]:this.createView(t,i,void 0,e):void 0},t.createView=function(t,e,n,r){var i=new t;return n&&(i._sn_=n),i.$param=r,i[this.flagStr]=e,this.$wins[e]=i,this.$winRoot[e]=this.$openView(i),this.openList.push(e),i},t.close=function(t,e){return void 0===e&&(e=!0),__awaiter(this,void 0,void 0,function(){var n,r,i,o,a,s;return __generator(this,function(l){switch(l.label){case 0:return(t=this.changeStr(t))?(n=this.getFlag(t),r=this.$winRoot[n],i=this.$wins[n],o=this.openList.indexOf(n),~o&&this.openList.splice(o,1),a=i&&i.closeEff,a?[4,i.closeEff(r)]:[3,2]):[2];case 1:a=l.sent(),l.label=2;case 2:removeFromParent(r),delete this.$wins[n],delete this.$winRoot[n];for(s in this.$wins)this.$wins[s].defaultRect&&(e=!1),this.$wins[s].otherWinClose&&this.$wins[s].otherWinClose(i);return e&&this._hasTop&&(this._hasTop=!1,this.openCall&&this.openCall()),[2]}})})},t.openOrClose=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t=this.changeStr(t)){var r=this.getFlag(t);this.$wins[r]?this.close(t):this.open.apply(this,[t].concat(e))}},t.openCloseUpdate=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.openCheck(t,e,!1);if(r){t=this.changeStr(t);var i=this.getFlag(t),o=this.$wins[i];o?o.skin?o.addDisplay.apply(o,e):o.$param=e:this.createView(this.changeStr(t),i,void 0,e)}else this.close(t)},t.get=function(t){if(t=this.changeStr(t)){var e=this.getFlag(t);return this.$wins[e]}},t.$openView=function(e){var n=new eui.UILayer;n.touchEnabled=!1;for(var r in this.$wins)this.$wins[r].otherWinOpen&&this.$wins[r].otherWinOpen(e);if(e.defaultRect){var i=new eui.Image;i.source="win_json.win_r",i.left=i.top=i.right=i.bottom=0,i.scale9Grid=new egret.Rectangle(2,2,12,12),i.alpha=0,egret.Tween.get(i).to({alpha:1},300),n.addChild(i);var o=new eui.Group;if(o.touchEnabled=!1,n.addChild(o),e.rectClose&&i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.close(e)},this),e.rectText){var a=new eui.VerticalLayout;a.gap=38,a.horizontalAlign=egret.HorizontalAlign.CENTER,o.layout=a;var s=new eui.Label;s.horizontalCenter=0,s.size=22,s.textColor=9342606,s.text="点击空白处关闭",s.touchEnabled=!1,o.addChild(e),o.addChild(s)}else o.addChild(e),e.top=e.bottom=o.top=o.bottom=0;e.openEff?(o.horizontalCenter=o.verticalCenter=0,e.openEff(o)):o.horizontalCenter=o.verticalCenter=0,this._hasTop||(this._hasTop=!0,this.closeCall&&this.closeCall())}else e.left=e.top=e.right=e.bottom=0,n.addChild(e);return-1==e.layoutNum?this.bottomLayer.addChild(n):1==e.layoutNum?this.topLayer.addChild(n):this.centerLayer.addChild(n),n},t.closeAll=function(){for(var t in this.$wins){var e=this.$wins[t];e.destroy&&e.destroy(),this.close(e)}this.$wins={},this.$winRoot={}},t.getFlag=function(t){return t[this.flagStr]||(t[this.flagStr]=++this.flag),t[this.flagStr]},t.closeLast=function(t){void 0===t&&(t=1);for(var e=this.openList.length,n=e-1;n>=0;n--){var r=this.$wins[this.openList[n]];if(0==t)return void this.close(r);if(1==t&&r.defaultRect)return void this.close(r);if(2==t&&!r.defaultRect)return void this.close(r)}},t.closeTopLevel=function(){for(var t in this.$wins)this.$wins[t].defaultRect&&this.close(this.$wins[t])},t.flag=0,t.$wins={},t.$winRoot={},t.flagStr="winflag",t._hasTop=!1,t.root=new eui.UILayer,t.bottomLayer=new eui.UILayer,t.centerLayer=new eui.UILayer,t.topLayer=new eui.UILayer,t.openList=[],t}();__reflect(win.prototype,"win"),window.win=win;var WaitWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.layoutNum=1,e.rectClose=!1,e}return __extends(e,t),e.show=function(){win.open(e)},e.hide=function(){win.close(e)},e.prototype.addDisplay=function(){var t=new eui.Group;t.name="showWait",t.bottom=t.top=t.left=t.right=0,this.addChild(t);var e=new eui.Image;e.source="entry/qq.png",e.scaleX=e.scaleY=1.5,e.$onRemoveFromStage=function(){egret.Tween.removeTweens(e)},e.verticalCenter=e.horizontalCenter=0;var n=egret.Tween.get(e,{loop:!0});n.to({rotation:360},1e3),t.addChild(e)},e.prototype.openEff=function(t){},e}(eui.Component);__reflect(WaitWin.prototype,"WaitWin");