function post(t){return function(e,i,n){var s=n.value,o=""+MessageCenter.msgIndex++,a=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=typeof e,r=s.call.apply(s,["object"==a?this:e].concat(i));return("boolean"!=typeof r||r)&&MessageCenter.ins().dispatch(t?"-"+o:o,r),r};return a.funcallname=o,n.value=a,n}}function callLater(t,e,i){var n=i.value,s="$"+e+"CL",o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];delete this[s],n.call.apply(n,[this].concat(t))},a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this[s]||(egret.callLater.apply(egret,[o,this].concat(t)),this[s]=!0)};return i.value=a,i}function callDelay(t){return function(e,i,n){var s=n.value,o="$isDelay"+i,a=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this[o]=!1,s.call.apply(s,[this].concat(t))},r=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this[o]||(this[o]=!0,egret.setTimeout.apply(egret,[a,this,t].concat(e)))};return n.value=r,n}}function gm(t){var e=GameLogic.ins().getBytes(0);e.writeString(t),GameLogic.ins().sendToServer(e)}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__decorate=this&&this.__decorate||function(t,e,i,n){var s,o=arguments.length,a=3>o?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(a=(3>o?s(a):o>3?s(e,i,a):s(e,i))||a);return o>3&&a&&Object.defineProperty(e,i,a),a},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(s,o){function a(t){try{l(n.next(t))}catch(e){o(e)}}function r(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(a,r)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;l;)try{if(s=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(n){i=[6,n],o=0}finally{s=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,o,a,r,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},BaseView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.associated=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=!1,o=function(){s=!1,t.call(e)},a=function(){s||(s=!0,Timer.start(60,1,o,e))},r=0,l=i;r<l.length;r++){var h=l[r];this.observe(h,a)}},e.prototype.observe=function(t,e,i){MessageCenter.addListener(t,e,this,i)},e.prototype.removeObserve=function(){MessageCenter.ins().removeAll(this)},e.prototype.addTouchEvent=function(t,e,i){var n=this;if(void 0===i&&(i=!1),this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e),i){var s=function(){egret.Tween.get(t).wait(300).call(function(){Timer.start(150,-1,e,n)})},o=function(){egret.Tween.removeTweens(t),Timer.stop(e,n)};this.addEvent(egret.TouchEvent.TOUCH_BEGIN,t,s),this.addEvent(egret.TouchEvent.TOUCH_END,t,o),this.addEvent(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t,o),this.addEvent(egret.Event.REMOVED_FROM_STAGE,t,o)}},e.prototype.addTouchEndEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_END,t,e)},e.prototype.addChangeEvent=function(t,e){var i=this;t&&t instanceof eui.TabBar?this.addEvent(egret.TouchEvent.CHANGE,t,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];SoundUtil.play(SoundEnum.WINDOW),e.call.apply(e,[i].concat(t))}):this.addEvent(egret.TouchEvent.CHANGE,t,e)},e.prototype.addChangingEvent=function(t,e){this.addEvent(egret.TouchEvent.CHANGING,t,e)},e.prototype.addEvent=function(t,e,i){return e?void e.addEventListener(t,i,this):void console.error("不存在绑定对象")},e.prototype.removeTouchEvent=function(t,e,i){void 0===i&&(i=!1),t&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this),i&&t&&(egret.Tween.removeTweens(t),Timer.stop(e,this),t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,t,e),t.removeEventListener(egret.TouchEvent.TOUCH_END,t,e),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t,e),t.removeEventListener(egret.Event.REMOVED_FROM_STAGE,t,e))},e}(eui.Component);__reflect(BaseView.prototype,"BaseView"),window.BaseView=BaseView;var BaseEuiLayer=function(t){function e(){var e=t.call(this)||this;return e.percentWidth=100,e.percentHeight=100,e.touchEnabled=!1,e}return __extends(e,t),e}(eui.Group);__reflect(BaseEuiLayer.prototype,"BaseEuiLayer"),window.BaseEuiLayer=BaseEuiLayer;var BaseItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addTouchEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_TAP,t,e)},e.prototype.addTouchEndEvent=function(t,e){this.addEvent(egret.TouchEvent.TOUCH_END,t,e)},e.prototype.addEvent=function(t,e,i){return e?void e.addEventListener(t,i,this):void console.error("不存在绑定对象")},e.prototype.removeTouchEvent=function(t,e){t&&t.removeEventListener(egret.TouchEvent.TOUCH_TAP,e,this)},Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,eui.PropertyEvent.dispatchPropertyEvent(this,eui.PropertyEvent.PROPERTY_CHANGE,"data"),this.skin&&this.dataChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected!=t&&(this._selected=t,this.invalidateState(),this.selectChange())},enumerable:!0,configurable:!0}),e.prototype.setSkin=function(e){t.prototype.setSkin.call(this,e),this.data&&this.dataChanged()},e.prototype.selectChange=function(){},e}(eui.ItemRenderer);__reflect(BaseItemRender.prototype,"BaseItemRender"),window.BaseItemRender=BaseItemRender;var EffectModel=function(){function t(){this.dir=4,this.team=Team.NotAtk}return t}();__reflect(EffectModel.prototype,"EffectModel");var MonsterType;!function(t){t[t.Monster=0]="Monster",t[t.Boss=1]="Boss",t[t.Summon=3]="Summon",t[t.Ring=4]="Ring"}(MonsterType||(MonsterType={}));var BaseClass=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this;return i._instance||(i._instance=new(i.bind.apply(i,[void 0].concat(t)))),i._instance},e}(egret.HashObject);__reflect(BaseClass.prototype,"BaseClass"),window.BaseClass=BaseClass;var BaseSystem=function(t){function e(){var e=t.call(this)||this;return e.initLogin&&e.observe(GameApp.ins().postLoginInit,e.initLogin),e.initZero&&e.observe(GameApp.ins().postZeroInit,e.initZero),e}return __extends(e,t),e.prototype.regNetMsg=function(t,e){Socket.ins().registerSTCFunc(this.sysId,t,e,this)},e.prototype.getGameByteArray=function(){return Socket.ins().getBytes()},e.prototype.getBytes=function(t){var e=this.getGameByteArray(),i=PackageMap.length?PackageMap[this.sysId]:this.sysId;return void 0==i&&(i=255),e.writeCmd(i,t),e},e.prototype.sendBaseProto=function(t){var e=this.getBytes(t);this.sendToServer(e)},e.prototype.sendToServer=function(t){return Socket.ins().sendToServer(t)},e.prototype.observe=function(t,e){MessageCenter.addListener(t,e,this)},e.prototype.removeObserve=function(t,e){return t&&e?void MessageCenter.ins().removeListener(t.funcallname,e,this):void MessageCenter.ins().removeAll(this)},e.prototype.associated=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=!1,o=function(){s=!1,t.call(e)},a=function(){s||(s=!0,Timer.start(60,1,o,e))},r=0,l=i;r<l.length;r++){var h=l[r];this.observe(h,a)}},e}(BaseClass);__reflect(BaseSystem.prototype,"BaseSystem"),window.BaseSystem=BaseSystem;var GuildWarMemberHeadRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberHeadSkin",e.clickEffc=new MovieClip,e.clickEffc.x=52,e.clickEffc.y=37,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.removeAttEffect(),this.haveGuildName(!1),isNaN(this.data))this.data instanceof SelectInfoData&&(this.currentState="panel",this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+"份"),this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name),this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex);else{this.currentState="war";var t=EntityManager.ins().getEntityBymasterhHandle(this.data);if(t){var e=t.infoModel,i=e.guildName?"\n<font color='#6495ed'>"+e.guildName+"</font>":"",n=DevildomSys.ins().isDevildomBattle&&i?e.name+i:e.getNameWithServer2();n.indexOf("\n")>-1&&this.haveGuildName(!0),this.roleName.textFlow=(new egret.HtmlTextParser).parser(n),this.roleHead.source="yuanhead"+e.job+e.sex,GuildWar.ins().getModel().attHandle&&GuildWar.ins().getModel().attHandle==this.data&&this.addAttEffect(),CrossGuildBattleCT.ins().attHandle&&CrossGuildBattleCT.ins().attHandle==this.data&&this.addAttEffect()}else this.roleName.textFlow=(new egret.HtmlTextParser).parser("已死亡")}},e.prototype.addAttEffect=function(){this.attEffect||(this.attEffect=new MovieClip,this.attEffect.x=49,this.attEffect.y=28),this.attEffect.playFile(RES_DIR_EFF+"BattlEff2",-1),this.addChild(this.attEffect)},e.prototype.removeAttEffect=function(){this.attEffect&&(DisplayUtils.removeFromParent(this.attEffect),this.attEffect=null)},e.prototype.showEffect=function(){this.clickEffc.playFile(RES_DIR_EFF+"PromptEff5",1),this.addChild(this.clickEffc)},e.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.clickEffc),DisplayUtils.removeFromParent(this.attEffect)},e.prototype.haveGuildName=function(t){t?(this.namebg.height=45,this.height=110):(this.namebg.height=26,this.height=98)},e}(BaseItemRender);__reflect(GuildWarMemberHeadRender.prototype,"GuildWarMemberHeadRender"),window.GuildWarMemberHeadRender=GuildWarMemberHeadRender;var MessageCenter=function(t){function e(e){var i=t.call(this)||this;return i.flag=0,i.type=e,i.dict={},i.eVec=[],0==i.type&&egret.startTick(i.run,i),i}return __extends(e,t),e.ins=function(){return t.ins.call(this,0)},e.prototype.clear=function(){this.dict={},this.eVec.splice(0)},e.prototype.addListener=function(t,e,i){i.hasLsn=!0;var n=this.dict[t];n?0!=this.flag&&(this.dict[t]=n=n.concat()):this.dict[t]=n=[];for(var s=0,o=n;s<o.length;s++){var a=o[s];if(a[0]==e&&a[1]==i)return}n.push([e,i])},e.prototype.removeListener=function(t,e,i){var n=this.dict[t];if(n){0!=this.flag&&(this.dict[t]=n=n.concat());for(var s=n.length,o=0;s>o;o++)if(n[o][0]==e&&n[o][1]==i){n.splice(o,1);break}0==n.length&&(this.dict[t]=null,delete this.dict[t],i.hasLsn=!1)}},e.prototype.removeAll=function(t,e){if(void 0===e&&(e=null),t.hasLsn){t.hasLsn=!1;for(var i=Object.keys(this.dict),n=0,s=i;n<s.length;n++){var o=s[n];o=e||o;var a=this.dict[o];if(a){0!=this.flag&&(this.dict[o]=a=a.concat());for(var r=a.length,l=r-1;l>=0;l--)a[l][1]==t&&a.splice(l,1);if(0==a.length&&(this.dict[o]=null,delete this.dict[o]),e)break}}}},e.prototype.dispatch=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=0==t.indexOf("-");n&&(t=t.slice(1));var s=ObjectPool.pop("MessageVo");return s.type=t,s.param=e,n?void this.dealMsg(s):void(0==this.type?this.eVec.push(s):1==this.type?this.dealMsg(s):console.log("MessageCenter未实现的类型"))},e.prototype.run=function(t){for(var e=egret.getTimer();this.eVec.length>0&&(this.dealMsg(this.eVec.shift()),!(egret.getTimer()-e>5)););return!1},e.prototype.dealMsg=function(t){var e=this.dict[t.type];if(e&&0!=e.length){this.flag++;for(var i=0,n=e;i<n.length;i++){var s=n[i];s[0].apply(s[1],t.param)}this.flag--,t.dispose(),ObjectPool.push(t)}},e.setFunction=function(t,i,n,s){if(0==n.indexOf(s)&&"function"==typeof i[n]){var o=""+e.msgIndex++,a=i[n],r=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s;return s=t?a.call.apply(a,[this].concat(i)):a.apply(void 0,i),("boolean"!=typeof s||s)&&e.ins().dispatch(o,s),s};return r.funcallname=o,i[n]=r,!0}return!1},e.addListener=function(t,i,n,s){return t.funcallname?(e.ins().addListener(t.funcallname,i,n),s&&i.call(n),!0):(console.warn("MessageCenter.addListener error:"+egret.getQualifiedClassName(n)),!1)},e.splite=".",e.msgIndex=0,e}(BaseClass);__reflect(MessageCenter.prototype,"MessageCenter"),window.MessageCenter=MessageCenter;var MessageVo=function(){function t(){}return t.prototype.dispose=function(){this.type=null,this.param=null},t}();__reflect(MessageVo.prototype,"MessageVo"),window.MessageVo=MessageVo,window.post=post,window.callLater=callLater,window.callDelay=callDelay;var ViewManager=function(t){function e(){var e=t.call(this)||this;return e.closeTopFilters=[],e._regesterInfo={},e._views={},e._hCode2Key={},e._opens=[],e._constView=["GameSceneView","ChatMainUI","UIView2","TipsView","PlayFunView"],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){this.closeAll(),this._views={}},e.prototype.reg=function(t,e){if(null!=t){var i=egret.getQualifiedClassName(t);this._regesterInfo[i]||(this._regesterInfo[i]=[t,e])}},e.prototype.destroy=function(t){var e=this._hCode2Key[t];delete this._views[e],delete this._hCode2Key[t]},e.prototype.getKey=function(t){var e="";if("string"==typeof t)e=t;else if("function"==typeof t)e=egret.getQualifiedClassName(t);else if(t instanceof BaseEuiView)for(var i=Object.keys(this._views),n=0,s=i.length;s>n;n++){var o=i[n];if(this._views[o]==t){e=o;break}}else console.warn("打开界面只支持类名和类名的字符串形式,关闭界面只支持类名和类名的字符串以及类的实例形式,错误编号:"+t);return e},e.prototype.viewOpenCheck=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=!0,s=this._regesterInfo[t];if(null!=s){var o=s[0],a=o.openCheck;null!=a&&(n=a.apply(void 0,e))}return n},e.prototype.open=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.getKey(t);if(!this.viewOpenCheck.apply(this,[n].concat(e)))return null;var s=this.openEasy(n,null,e);return s&&(this.checkOpenView(s),this.setUIEff(n)),s},e.prototype.setUIEff=function(t){if(t){var e=this.getView(t);e&&e.playUIEff()}},e.prototype.openEasy=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null);var n=this.getKey(t),s=this._views[n],o=this._regesterInfo[n];if(!s){if(Assert(o,"ViewManager.openEasy class "+n+" is null!!"))return;s=new o[0],e&&(s._sn_=e),this._views[n]=s,this._hCode2Key[s.hashCode]=n}if(null==s)return console.log("UI_"+n+"不存在"),null;if(s.exclusionWins)for(var a=0,r=s.exclusionWins;a<r.length;a++){var l=r[a];this.closeEasy(l)}s.isShow()||s.isInit()?(s.addToParent(o[1]),s.open.apply(s,i)):s.loadResource(function(){s.$param=i,s.addToParent(o[1])},function(){s.initUI(),s.initData(),s.open.apply(s,i)});var h=this._opens.indexOf(n);return h>=0&&this._opens.splice(h,1),this._opens.push(n),s},e.prototype.openBySkin=function(t,e){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];var s=this.getKey(t);if(!this.viewOpenCheck.apply(this,[s].concat(i)))return null;var o=this.openEasy(s,e,i);return o&&(this.checkOpenView(o),this.setUIEff(s)),o},e.prototype.checkOpenView=function(t){t.isTopLevel&&t.parent!=LayerManager.UI_Popup&&(SoundUtil.play(SoundEnum.WINDOW),GameLogic.ins().postViewOpen(1),this.closeEasy(ChatMainUI),this.closeEasy(ChatWin))},e.prototype.close=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.closeEx(t,e)},e.prototype.closeEx=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var s=this.getView(t);s&&s.closeEx(function(){var n=e.closeEasy(t,i);n&&e.checkCloseView()})},e.prototype.closeLastTopView=function(){for(var t=this._opens.length,e=t-1;e>=0;e--){var i=this.getView(this._opens[e]);if(i&&i.isTopLevel)return this.close(i),!0}return!1},e.prototype.closeEasy=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(!this.isShow(t))return null;var n=this.getKey(t),s=this.getView(n);if(s){var o=this._opens.indexOf(n);o>=0&&this._opens.splice(o,1),s.close.apply(s,e),s.removeFromParent()}return s},e.prototype.checkCloseView=function(){for(var t=!1,e=0,i=this._opens;e<i.length;e++){var n=i[e],s=this.getView(n);if(s&&s.isTopLevel){t=!0;break}}t||(SoundUtil.WINDOW_OPEN=!1,GameLogic.ins().postViewOpen(0))},Object.defineProperty(e,"gamescene",{get:function(){return GameSceneView.ins},enumerable:!0,configurable:!0}),e.prototype.getView=function(t){var e=this.getKey(t);return this._views[e]},e.prototype.closeAll=function(){for(;this._opens.length;)this.closeEasy(this._opens[0],[]);this.destroyAllNotShowView()},e.prototype.closeTopLevel=function(){var t=this.closeTopFilters;this.closeTopFilters=[];for(var e=this._opens.length-1;e>=0;e--){var i=this._opens[e];if(!(t.indexOf(i)>=0)){var n=this.getView(i),s=1e6;isNaN(parseInt(i))||(s=parseInt(i)),n&&n.isTopLevel&&this.closeEasy(i,[])}}this.checkCloseView()},e.prototype.openNum=function(){return this._opens.length},e.prototype.isShow=function(t){return this._opens.indexOf(this.getKey(t))>=0},e.prototype.hasTopView=function(){for(var t=0,e=this._opens;t<e.length;t++){var i=e[t],n=this.getView(i);if(n&&n.isTopLevel)return!0}return!1},e.prototype.destroyAllNotShowView=function(){for(var t in this._hCode2Key){var e=this._hCode2Key[t];if(-1==this._constView.indexOf(e)&&-1==this._opens.indexOf(e)){var i=this.getView(e);i&&i.destoryView&&i.destoryView(!1)}}},e}(BaseClass);__reflect(ViewManager.prototype,"ViewManager"),window.ViewManager=ViewManager;var NpcModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Npc,e}return __extends(e,t),Object.defineProperty(e.prototype,"avatarString",{get:function(){var t=GlobalConfig.NpcBaseConfig[this.configID];return t?t.avatar:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarFileName",{get:function(){var t=this.npcConfig;return 1==t.actType?""+RES_DIR_BODY+t.avatar:""+RES_DIR_MONSTER+t.avatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weaponFileName",{get:function(){var t=this.npcConfig;return t.weapon?""+RES_DIR_WEAPON+t.weapon:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"npcConfig",{get:function(){return GlobalConfig.NpcBaseConfig[this.configID]},enumerable:!0,configurable:!0}),e.prototype.clone=function(t){var e=egret.getQualifiedClassName(this);t=t||ObjectPool.pop(e);for(var i in this)"function"!=typeof this[i]&&"__class__"!=i&&"__types__"!=i&&(t[i]=this[i]);return t},e}(EffectModel);__reflect(NpcModel.prototype,"NpcModel"),window.NpcModel=NpcModel;var LayerManager=function(){function t(){}return t.Game_Bg=new BaseEuiLayer,t.Game_Main=new BaseEuiLayer,t.Main_View=new BaseEuiLayer,t.UI_Main=new BaseEuiLayer,t.UI_Main2=new BaseEuiLayer,t.UI_Popup=new BaseEuiLayer,t.UI_Message=new BaseEuiLayer,t.UI_Tips=new BaseEuiLayer,t}();__reflect(LayerManager.prototype,"LayerManager"),window.LayerManager=LayerManager;var CharEffect=function(t){function e(){var e=t.call(this)||this;return e._bodyContainer=new egret.DisplayObjectContainer,e.titleCantainer=new egret.DisplayObjectContainer,e.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT,e.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE,e._disOrder={},e._mcFileName={},e._dir=4,e._state=EntityAction.STAND,e.addChild(e._bodyContainer),e.titleCantainer.anchorOffsetY=e.myHeight,e.addChild(e.titleCantainer),e}return __extends(e,t),Object.defineProperty(e.prototype,"_body",{get:function(){return this.getMc(0)},enumerable:!0,configurable:!0}),e.prototype.setBodyScale=function(t){this._bodyContainer.scaleX=this._bodyContainer.scaleY=t,this.myHeight=this.myHeight*t,this.typeface*=t,this.titleCantainer.anchorOffsetY=Math.floor(this.myHeight)},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.setConfig=function(t){var e=GlobalConfig.MonstershpConfig[t];e?(this.myHeight=e.hp,this.typeface=e.hp):(this.myHeight=EntityManager.CHAR_DEFAULT_HEIGHT,this.typeface=EntityManager.CHAR_DEFAULT_TYPEFACE),this.titleCantainer.anchorOffsetY=Math.floor(this.myHeight)},e.prototype.updateModel=function(){},Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir!=t&&(this._dir=t,this.loadBody())},enumerable:!0,configurable:!0}),e.prototype.getResDir=function(t){var e=2*(this._dir-4);return 0>e&&(e=0),this._dir-e},e.prototype.playAction=function(t,e){this._state=t,this.playComplete=e,this.loadBody()},e.prototype.loadBody=function(){if(this._body){this._body.stop(),this.loadFile(this._body,this.getFileName(0),0);for(var t in this._disOrder){var e=this._disOrder[t];e!=this._body&&this.loadOther(+t)}this.sortEffect()}},e.prototype.loadOther=function(t){var e=this.getMc(t);e&&(e.stop(),this.loadFile(e,this.getFileName(t),t))},e.prototype.getFileName=function(t){return this._mcFileName[t]},e.prototype.playFile=function(t,e){t.playFile(e,-1,null,!1)},e.prototype.loadFile=function(t,e,i){var n=this;if(e){var s=this.getResDir(i),o=e+"_"+s+this._state;4==i?o=e:t.scaleX=this._dir>4?-1:1,t.playFile(o,this.playCount(),t==this._body?function(){n.playComplete&&n.playComplete(),n.playComplete=null}:null,!1)}},e.prototype.playCount=function(){return-1},e.prototype.addMc=function(t,e){if(this._mcFileName[t]!=e){this._mcFileName[t]=e;var i=this._disOrder[t];return i||(i=ObjectPool.pop("MovieClip"),this._bodyContainer.addChild(i),this._disOrder[t]=i),i==this._body?this.loadBody():this.loadOther(t),this.sortEffect(),i}},e.prototype.removeMc=function(t){if(0!=t){var e=this._disOrder[t];e&&(DisplayUtils.removeFromParent(e),delete this._mcFileName[t],delete this._disOrder[t])}},e.prototype.getMc=function(t){return this._disOrder[t]},e.prototype.sortEffect=function(){var t=e.FRAME_ODER[this._dir],i=0;t.length>0&&(i=t.length);for(var n=0,s=0;i>s;s++){var o=t[s];this._disOrder[o]&&this._disOrder[o].parent&&(this._bodyContainer.addChildAt(this._disOrder[o],n),n+=1)}},Object.defineProperty(e.prototype,"weight",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"team",{get:function(){return this.infoModel.team},enumerable:!0,configurable:!0}),e.prototype.addDisplay=function(){this.shadow=new eui.Image(RES_DIR+"yingzi.png"),this.shadow.alpha=.8,this.addChildAt(this.shadow,0),this.shadow.anchorOffsetX=45,this.shadow.anchorOffsetY=25,this.shadow.scaleX=.5,this.shadow.scaleY=.5},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.shadow),this.shadow=null},e.prototype.clearMc=function(t){var e=this._disOrder[t];e&&(e instanceof MovieClip&&DisplayUtils.removeFromParent(e),delete this._mcFileName[t],delete this._disOrder[t])},e.FRAME_ODER=[[1,3,0,2,4],[0,1,3,2,4],[2,0,1,3,4],[4,2,0,1,3],[4,2,0,1,3],[4,2,0,1,3],[2,0,1,3,4],[0,1,3,2,4]],e}(BaseView);__reflect(CharEffect.prototype,"CharEffect"),window.CharEffect=CharEffect;var ActivityBaseData=function(t){function e(e){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e){},e.prototype.update=function(t){},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){return!1},Object.defineProperty(e.prototype,"rewardState",{get:function(){return 0},enumerable:!0,configurable:!0}),e.prototype.specialState=function(){return!0},e.prototype.getHide=function(){return!1},e}(egret.HashObject);__reflect(ActivityBaseData.prototype,"ActivityBaseData"),window.ActivityBaseData=ActivityBaseData;var ActivityType;!function(t){t[t.Normal=0]="Normal",t[t.Personal=1]="Personal",t[t.Nesting=2]="Nesting"}(ActivityType||(ActivityType={})),window.ActivityType=ActivityType;var BaseEuiView=function(t){function e(){var e=t.call(this)||this;return e._resources=null,e.isTopLevel=!1,e.exclusionWins=[],e._isInit=!1,e.percentHeight=100,e.percentWidth=100,e}return __extends(e,t),e.prototype.addExclusionWin=function(t){-1==this.exclusionWins.indexOf(t)&&this.exclusionWins.push(t)},e.prototype.isInit=function(){return this._isInit},e.prototype.isShow=function(){return null!=this.stage&&this.visible},e.prototype.addToParent=function(t){t.addChild(this)},e.prototype.removeFromParent=function(){DisplayUtils.removeFromParent(this),this.destoryView()},e.prototype.initUI=function(){this._isInit=!0},e.prototype.initData=function(){},e.prototype.destroy=function(){},e.prototype.destoryView=function(t){void 0===t&&(t=!0),Timer.stopAll(this),ViewManager.ins().destroy(this.hashCode)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.loadResource=function(t,e){t(),e()},e.prototype.setVisible=function(t){this.visible=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.anigroup&&UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_IN_SCALE_VER,{time:200})},e.prototype.closeEx=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.parent==LayerManager.UI_Popup&&this.anigroup?UIAnimation.setAnimation(this.anigroup,UIAnimation.ANITYPE_OUT_SCALE_VER,{time:200,func:i,ease:egret.Ease.sineIn}):i()},e}(BaseView);__reflect(BaseEuiView.prototype,"BaseEuiView",["IBaseView"]),window.BaseEuiView=BaseEuiView;var ActivityPanel=function(t){function e(){var e=t.call(this)||this;return e._activityBtnType=-1,e.activityType=ActivityType.Normal,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityBtnType",{get:function(){return this._activityBtnType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t;var e,i;this.activityType==ActivityType.Normal?(e=GlobalConfig.ActivityConfig[t],i=GlobalConfig.ActivityBtnConfig[t]):this.activityType==ActivityType.Personal&&(e=GlobalConfig.PActivityConfig[t],i=GlobalConfig.PActivityBtnConfig[t]),e&&e.tabName&&(this.name=e.tabName),this._activityBtnType=i.type},enumerable:!0,configurable:!0}),e.create=function(t,e){var i,n;if(e==ActivityType.Normal?(i=GlobalConfig.ActivityConfig[t],n=GlobalConfig.ActivityBtnConfig[t]):(i=GlobalConfig.PActivityConfig[t],n=GlobalConfig.PActivityBtnConfig[t]),n&&!n.type){var s=ObjectPool.pop("OSATarget0Panel");return s.activityType=e,s.activityID=t,s}var o,a=41==i.activityType?GlobalConfig.ActivityType41Config[t]:null;return 1==i.activityType?(o=ObjectPool.pop("OSATarget"+i.activityType+"Panel",t),o.activityType=e,o.activityID=t):a&&a.showType>0?(o=ObjectPool.pop("OSATarget"+i.activityType+"Panel"+a.showType),o.activityType=e,o.activityID=t):(o=ObjectPool.pop("OSATarget"+i.activityType+"Panel"),o.activityType=e,o.activityID=t),o},e.prototype.updateData=function(){},e.getActivityTypeFromId=function(t){var e;return GlobalConfig.ActivityBtnConfig[t]?e=GlobalConfig.ActivityBtnConfig[t]:GlobalConfig.PActivityBtnConfig[t]&&(e=GlobalConfig.PActivityBtnConfig[t]),e?e.activityType:ActivityType.Normal},e}(BaseView);__reflect(ActivityPanel.prototype,"ActivityPanel"),window.ActivityPanel=ActivityPanel;var ActivityType10Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.record=t.readInt(),this.yb=t.readInt(),this.index=t.readInt(),this.state=t.readByte();var e=t.readByte();this.noticeArr=[];for(var i=0;e>i;i++)this.noticeArr.push({name:t.readString(),multiple:t.readDouble(),yb:t.readInt()});this.noticeArr.reverse()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return this.activityType==ActivityType.Personal?PActivity.ins().getType10RedPoint(this.id):Activity.ins().getType10RedPoint(this.id)},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getLevel=function(){var t=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType10Config[this.id]:GlobalConfig.ActivityType10Config[this.id],e=Object.keys(t).length,i=this.record+1;return this.record>=e&&(i=0),i},e.prototype.getCondition=function(t){var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType10Config[this.id][t]:GlobalConfig.ActivityType10Config[this.id][t];return e&&this.yb>=e.recharge?!0:!1},e}(ActivityBaseData);__reflect(ActivityType10Data.prototype,"ActivityType10Data"),window.ActivityType10Data=ActivityType10Data;var RedPointBase=function(t){function e(){var e=t.call(this)||this;return e.initTabs(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initTabs=function(){this.isOpen=!1,this.redpoint=!1,this.tabs={},this.toTabs={},this.sumTabs={},this.observe(this.postRedPoint,this.postOpen)},e.prototype.registerTab=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.tabs[t]=!1,this.associated.apply(this,[function(){return e.updateTabRedPoint(t)}].concat(i))},e.prototype.registerOpen=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.associated.apply(this,[this.postOpen].concat(t))},e.prototype.postOpen=function(){var t=this.isOpen;if(this.isOpen=this.getIsOpen(),this.isOpen&&t!=this.isOpen)for(var e=Object.keys(this.tabs),i=0;i<e.length;i++){var n=+e[i];this.updateTabRedPoint(n)}return this.isOpen!=t},e.prototype.postRedPoint=function(){if(!this.isOpen)return this.redpoint?(this.redpoint=!1,!0):!1;var t=this.redpoint;return this.redpoint=this.and(),this.redpoint!=t},e.prototype.postTabs=function(t){return t},e.prototype.getRedPoint=function(t){return this.tabs[t]},e.prototype.updateTabRedPoint=function(t){if(this.isOpen){var e=this.tabs[t];this.tabs[t]=this.getTabRedPoint(t),this.tabs[t]!=e&&this.sendTabs(t)}},e.prototype.sendTabs=function(t){this.postTabs(t);var e=this.toTabs[t];if(e)for(var i=0,n=e;i<n.length;i++){var s=n[i],o=this.tabs[s];this.tabs[s]=this.andTabs(this.sumTabs[s]),this.tabs[s]!=o&&this.postTabs(s)}this.postRedPoint()},e.prototype.and=function(){for(var t in this.tabs)if(this.tabs[t])return!0;return!1},e.prototype.andTabs=function(t){for(var e in t)if(this.getRedPoint(t[e]))return!0;return!1},e.prototype.getTabRedPoint=function(t){return!1},e.prototype.getIsOpen=function(){return!0},__decorate([post()],e.prototype,"postOpen",null),__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postTabs",null),e}(BaseSystem);__reflect(RedPointBase.prototype,"RedPointBase"),window.RedPointBase=RedPointBase;var ActivityType11_2Config=function(){function t(){this.day=0,this.rate=1}return t}();__reflect(ActivityType11_2Config.prototype,"ActivityType11_2Config"),window.ActivityType11_2Config=ActivityType11_2Config;var ActivityType9Config=function(){function t(){}return t
}();__reflect(ActivityType9Config.prototype,"ActivityType9Config");var ExRing0Config=function(){function t(){this.power=0}return t}();__reflect(ExRing0Config.prototype,"ExRing0Config");var ExRingAttrConfig=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.attrAward=[],this.extAttrAward=[],this.upPower=0,this.addPower=0,this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ExRingAttrConfig.prototype,"ExRingAttrConfig");var ItemBase=function(t){function e(){var e=t.call(this)||this;return e.showSpeicalDetail=!0,e.isOpenSelectImg=!1,e.isCurrency=!1,e.showName=!1,e.skinName="ItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.setTag=function(t){this.itemIcon.setTag(t)},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.setItemHeirloomBgImg=function(t,e){e&&(this.itemIcon.imgheirloom.source=e+"_png"),this.itemIcon.imgheirloom.visible=t},e.prototype.setDataByConfig=function(t,e){if(!t)return void platform.reportError("setDataByConfig:"+this.data);this.itemIcon&&"function"==typeof this.itemIcon.setData&&this.itemIcon.setData(t);var i=ItemUtil.getType(t);if(i==ItemType.TYPE_33){var n=GlobalConfig.MasterEquipConf[this.itemConfig.id];n&&this.setTag("zz_jj"+n.stage)}if(i!=ItemType.TYPE_0||248==t.descIndex||this.showName)this.nameTxt.text=e?e:t.name,this.nameTxt.textColor=ItemUtil.getQualityColor(t);else{var s=isNaN(t.zsLevel)?(t.level||1)+"级":t.zsLevel+"转";this.nameTxt.text=s,-1!=BagCT.fitleEquip.indexOf(t.id)&&(this.nameTxt.text="无级别",this.nameTxt.textColor=ItemUtil.getQualityColor(t))}void 0!=this.num&&this.setCount(this.num+""),i==ItemType.TYPE_12&&(this.redPoint.visible=this.getGuildGift(t))},e.prototype.dataChanged=function(){this.clear();var t=!1;if(this.redPoint.visible=!1,this.setTag(""),isNaN(this.data))if(this.data instanceof ItemData){if(this.itemConfig=this.data.itemConfig,!this.itemConfig)return;this.setDataByConfig(this.itemConfig),this.data.count>1?this.setCount(this.data.count+""):this.setCount(""),t=!0;var i=ItemUtil.getType(this.data.itemConfig);i==ItemType.TYPE_36&&this.setMyIcon()}else{if(this.data.showJueban&&(this.itemIcon.jueban.visible=!0),this.data.chance&&(this.chance.visible=!0,this.chance.text=this.data.chance),0==this.data.type){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this.data.id);var n=1;switch(this.data.id){case MoneyConst.yuanbao:n=5;break;case MoneyConst.gold:n=0;break;case MoneyConst.soul:case MoneyConst.chip:n=2;break;case MoneyConst.piece:n=2,this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this.data.id];break;case MoneyConst.godweaponExp:n=2;break;case MoneyConst.dartCarScore:n=3;break;case MoneyConst.dartCarGuildScore:n=5}this.isCurrency=!0,this.itemIcon.imgBg.source="quality"+n,this.nameTxt.text=RewardData.getCurrencyName(this.data.id),this.nameTxt.textColor=e.QUALITY_COLOR[n];var s=this.data.count;void 0!=s&&s>1?this.setCount(s+""):this.setCount("")}else if(1==this.data.type){if(this.itemConfig=GlobalConfig.ItemConfig[this.data.id],!this.itemConfig)return;this.setDataByConfig(this.itemConfig);var s=this.data.count;s>1?this.setCount(s+""):this.setCount("")}else if(6==this.data.type){this.itemConfig=GlobalConfig.ItemConfig[this.data.id],this.setDataByConfig(this.itemConfig);var s=this.data.count;void 0!=s&&s>1?this.setCount(s+""):this.setCount("")}this.redPoint.visible=1==this.data.isRedPoint,this.getImg.visible=2==this.data.isRedPoint}else this.itemConfig=GlobalConfig.ItemConfig[this.data],this.setDataByConfig(this.itemConfig,this.runeName),this.data.showJueban&&(this.itemIcon.jueban.visible=!0);if(this.redPoint.visible||(this.redPoint.visible=this.data.canbeUsed),this.showEquipEffect(),t&&this.itemConfig){if(ItemUtil.getType(this.itemConfig)==ItemType.TYPE_8){var o=!0;this.itemConfig.id==ItemConst.EXP_ITEM&&(o=Actor.level>=65),this.redPoint.visible=this.data&&this.data.count>0&&o,this.itemConfig.id==ItemConst.LEVELUP_ITEM&&(this.redPoint.visible=!0)}else if(ItemUtil.getType(this.itemConfig)==ItemType.TYPE_17)this.redPoint.visible=!0;else if(ItemUtil.getType(this.itemConfig)==ItemType.TYPE_20)this.redPoint.visible=this.data.canbeUsed;else if(ItemUtil.getType(this.itemConfig)==ItemType.TYPE_25)this.redPoint.visible=!0;else if(ItemUtil.getType(this.itemConfig)==ItemType.TYPE_35)this.redPoint.visible=!0;else if(this.itemConfig.id==GlobalConfig.TeamFuBenBaseConfig.itemId)this.redPoint.visible=!0;else{var a=GlobalConfig.ItemComposeConfig[this.itemConfig.id];a&&a.srcCount<=this.data.count&&!a.dropId&&(this.redPoint.visible=!0)}var r=GlobalConfig.OptionalGiftConfig[this.itemConfig.id];r&&(Actor.level<r.options[0].level||ZsCT.ins().lv<r.options[0].zslimit)&&(this.redPoint.visible=!1)}this.setSelect(this.selected),this.dataChangeHandler()},e.prototype.setMyIcon=function(){if(this.data&&this.data.extAtt)for(var t=XinMoEquipCT.ins().getFmStata(this.data),e=0;e<t.length;e++){var i=0==t[e]?!1:!0;this["yjIcon"+e].visible=i}else for(var n=0;4>n;n++)this["yjIcon"+n].visible=!1},e.prototype.dataChangeHandler=function(){},e.prototype.clear=function(){this.itemConfig=null,this.itemIcon&&"function"==typeof this.itemIcon.setData&&this.itemIcon.setData(null),this.count.text="",this.nameTxt.text="",this.nameTxt.textColor=14668213,this.chance.visible=!1,DisplayUtils.removeFromParent(this.EquipEffect),this.equipStar&&(DisplayUtils.removeFromParent(this.equipStar),this.equipStar=null);for(var t=0;4>t;t++)this["yjIcon"+t]&&(this["yjIcon"+t].visible=!1)},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.isShowJob=function(t){this.itemIcon.imgJob.visible=t},e.prototype.onClick=function(t){this.data&&1==this.data.isRedPoint||t.target instanceof e||(this.showCurrency(),this.showDetail())},e.prototype.getItemType=function(){return this.itemConfig?ItemUtil.getType(this.itemConfig):-1},e.prototype.showCurrency=function(){if(this.isCurrency)switch(this.data.id){case MoneyConst.yuanbao:case MoneyConst.feat:case MoneyConst.godweaponExp:ViewManager.ins().open(ItemCurrencyWin,this.data.id,this.data.count)}},e.prototype.showDetail=function(){if(this.itemConfig){if(this.itemConfig.id==GlobalConfig.TeamFuBenBaseConfig.itemId)return void ViewManager.ins().open(FlowerUseTipsWin);switch(ItemUtil.getType(this.itemConfig)){case ItemType.TYPE_0:case ItemType.TYPE_4:case ThunderEquipPanel.TYPE:this.openEquipsTips();break;case ItemType.TYPE_35:ViewManager.ins().open(TitleTipsWin,this.data);break;case ItemType.TYPE_5:ViewManager.ins().open(HejiEquipTipsWin,this.data,!1,!0);break;case ItemType.TYPE_34:ViewManager.ins().open(ShieldEquipTipsWin,this.itemConfig.id);break;case ItemType.TYPE_31:ViewManager.ins().open(ShenjietipsWin,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_38:var t=SpiritEquipCT.ins().getItemInfo(this.itemConfig.id);t&&ViewManager.ins().open(SpiritTipWin,t[0],t[1]);break;case ItemType.TYPE_1:this.data.handle&&GlobalConfig.ItemComposeConfig[this.itemConfig.id]&&!GlobalConfig.ItemComposeConfig[this.itemConfig.id].dropId?ViewManager.ins().open(ItemUseTipsWin,this.data):Dress.ins().isZhuangBanItem(this.itemConfig.id)?ViewManager.ins().open(DressTipsWin,this.itemConfig,null!=this.data.handle):MoJianCT.isMoJian(this.itemConfig.id)?ViewManager.ins().open(MoJianTipsWin,this.itemConfig.id):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_2:this.data.handle?ViewManager.ins().open(ItemUseTipsWin,this.data):this.data.count?ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id);break;case ItemType.TYPE_6:ViewManager.ins().open(RuneTipsWin,0,this.itemConfig.id,this.desc,this.desc2);break;case ItemType.TYPE_9:ViewManager.ins().open(BookTipsWin,this.itemConfig.id,0,this.data.handle);break;case ItemType.TYPE_10:this.data.handle?ViewManager.ins().open(ItemUseTipsWin,this.data):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id);break;case ItemType.TYPE_8:case ItemType.TYPE_47:this.data.handle?ViewManager.ins().open(ItemUseTipsWin,this.data):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id);break;case ItemType.TYPE_20:if(1==this.data.type)ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);else{var e=+this.count.text;this.showSpeicalDetail=!1;for(var i=this.parent;i&&i.parent;)if(i=i.parent,i instanceof BagWin){this.showSpeicalDetail=!0;break}this.showSpeicalDetail?ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:e}):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,e)}break;case ItemType.TYPE_12:this.data.itemConfig&&this.getGuildGift(this.data)?ViewManager.ins().open(ItemUseTipsWin,this.data):ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count},!0);break;case ItemType.TYPE_11:for(var n in GlobalConfig.HeirloomEquipItemConfig){var s=GlobalConfig.HeirloomEquipItemConfig[n];if(s&&s.item==this.itemConfig.id){ViewManager.ins().open(HeirloomEquipTipsWin,null,s.pos-1);break}}break;case ItemType.TYPE_13:case ItemType.TYPE_14:this.showSpeicalDetail=!1;for(var o=this.parent;o&&o.parent;)if(o=o.parent,o instanceof BagWin){this.showSpeicalDetail=!0;break}this.data.type!=ItemType.TYPE_1&&this.showSpeicalDetail?ViewManager.ins().open(ItemUseTipsWin,{itemConfig:this.itemConfig,configID:this.itemConfig.id,count:this.data.count}):ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_15:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data?this.data.count:void 0);break;case ItemType.TYPE_16:var a=GlobalConfig.GodWingItemConfig[this.itemConfig.id];ViewManager.ins().open(GodWingTipsWin,a);break;case ItemType.TYPE_17:this.showSpeicalDetail=!1;for(var r=this.parent;r&&r.parent;)if(r=r.parent,r instanceof BagWin){this.showSpeicalDetail=!0;break}ViewManager.ins().open(this.showSpeicalDetail?TreasureChuanshiGiftWin:ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_19:ViewManager.ins().open(ExtremeEquipTipsWin,ItemUtil.getSubType(this.itemConfig));break;case ItemType.TYPE_21:ZhanLing.ins().ZhanLingItemTips(this.itemConfig.id);break;case ItemType.TYPE_22:ViewManager.ins().open(ZhanlingZBTipWin,this.itemConfig.icon);break;case ItemType.TYPE_23:ViewManager.ins().open(ShenshouEquipTip,0,0,this.itemConfig.id);break;case ItemType.TYPE_24:ViewManager.ins().open(HunguTipsWin,!1,0,this.itemConfig.id);break;case ItemType.TYPE_25:ViewManager.ins().open(ItemUseTipsWin,this.data);break;case ItemType.TYPE_28:ViewManager.ins().open(SoulSuitEquipTipWin,this.data,0,!1);break;case ItemType.TYPE_29:MoJianCT.MoJianItemTips(this.itemConfig.id);break;case ItemType.TYPE_30:var l=WushuangEquipCT.getPos(this.itemConfig.id),h=[];h[l]=[this.itemConfig.id,BagCT.getAttrPower(ItemUtil.getBaseAttrData(this.itemConfig))],ViewManager.ins().open(WushuangEquipTips,h,l);break;case ItemType.TYPE_33:ViewManager.ins().open(EquipDetailedWin,ItemType.TYPE_33,this.data.handle,this.itemConfig.id,this.data);break;case ItemType.TYPE_36:ViewManager.ins().open(XinmoTips,this.data);break;case ItemType.TYPE_37:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this.data.count);break;case ItemType.TYPE_39:ViewManager.ins().open(EquipDetailedWin,ItemType.TYPE_39,this.data.handle,this.itemConfig.id,this.data);break;case ItemType.TYPE_40:ViewManager.ins().open(ExpansionCardWin,this.data,this.itemConfig.id,ItemType.TYPE_40);break;case ItemType.TYPE_41:ViewManager.ins().open(SmItemTipsWin,this.itemConfig.id);break;case ItemType.TYPE_43:ViewManager.ins().open(PunchAwakeItemTipsWin,this.itemConfig.id);break;case ItemType.TYPE_45:case ItemType.TYPE_46:ViewManager.ins().open(KingEquipTipsWin,this.itemConfig.id);break;default:ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id)}}},e.prototype.getGuildGift=function(t){var e=0;if(t instanceof ItemConfig)e=t.level;else if(t instanceof ItemData){var i=GlobalConfig.ItemConfig[t.configID];e=i.level}return Actor.level>=e&&0!=Guild.ins().guildID},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.count.text=t},e.prototype.openEquipsTips=function(){var t=ItemUtil.getSubType(this.itemConfig);if(ItemUtil.getType(this.itemConfig)==ThunderEquipPanel.TYPE)return void ViewManager.ins().open(ThunderEquipTipsWin,0,t,this.data);if(t>=EquipPos.HAT&&t<=EquipPos.SHIELD)ViewManager.ins().open(SamsaraEquipTips,this.itemConfig.id);else if(GlobalConfig.HotBloodAwakeConf.legendEquip.indexOf(this.itemConfig.id)>-1){for(var e=this.parent;e&&e.parent;)if(e=e.parent,e instanceof BagWin)return void ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data);ViewManager.ins().open(LegendTipsWin,this.itemConfig.id,this.data)}else ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data)},e.prototype.isShowName=function(t){this.nameTxt.visible=t},e.prototype.getItemSoure=function(){var t="";return t=0==this.data.type?RewardData.getCurrencyRes(this.data.id):this.itemIcon.config.icon+"_png"},e.prototype.getText=function(){return this.nameTxt.text},e.prototype.getTextColor=function(){return this.nameTxt.textColor},e.prototype.showEquipEffect=function(){if(this.itemConfig||this.data.id==MoneyConst.yuanbao||this.data.id==MoneyConst.dartCarGuildScore){var t=(ItemUtil.getQuality(this.itemConfig),ItemUtil.getType(this.itemConfig)),e=ItemUtil.getEffName(this.itemConfig);if(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.x=44,this.EquipEffect.y=36,this.EquipEffect.hitTestEnabled=!1,this.addChildAt(this.EquipEffect,this.getChildIndex(this.selectFrame)),this.addChildAt(this.nameTxt,this.getChildIndex(this.EquipEffect)+1),this.data.id==MoneyConst.yuanbao||this.data.id==MoneyConst.dartCarGuildScore)e="ValueEff4",this.EquipEffect.x=44,this.EquipEffect.y=38;else if(t==ItemType.TYPE_26){var i=GlobalConfig.LeitingEquipConf[this.itemConfig.id];i&&(this.equipStar||(this.equipStar=new eui.Image,this.addChild(this.equipStar),this.equipStar.left=5,this.equipStar.top=0),this.equipStar.source="leit"+i.level+"x")}""!=e?this.EquipEffect.playFile(RES_DIR_EFF+e,-1):DisplayUtils.removeFromParent(this.EquipEffect)}},e.prototype.clearEffect=function(){DisplayUtils.removeFromParent(this.EquipEffect),this.EquipEffect=null},e.prototype.HideImgBg=function(){this.itemIcon.imgBg.visible=!1},e.prototype.showNum=function(t){this.count.visible=t},e.prototype.setImgBg=function(t){this.itemIcon.imgBg.source="quality"+t},e.prototype.getItemIcon=function(){return this.itemIcon},e.prototype.setSelect=function(t){this.isOpenSelectImg&&(this.selectFrame.visible=t)},e.prototype.hideName=function(){this.nameTxt.visible=!1},e.prototype.setName=function(t){this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e.prototype.setGetImg=function(t){this.getImg.visible=t},e.prototype.setImgBg1=function(t){this.itemIcon.setImgBg1(t)},e.prototype.setJueban=function(t){this.itemIcon.setJueban(t)},e.prototype.setImgBg2=function(t){this.itemIcon.setImgBg2(t)},e.prototype.setJob=function(t){this.itemIcon.imgJob.source="job"+t+"Item"},e.prototype.clearAll=function(){this.clear()},e.QUALITY_COLOR=[14868436,3532333,13779707,16741647,15937822,16767295,5342973,16738740],e.additionRange=15,e}(BaseItemRender);__reflect(ItemBase.prototype,"ItemBase"),window.ItemBase=ItemBase;var BaseScene=function(){function t(){this._layers=new Array}return t.prototype.onEnter=function(){},t.prototype.onExit=function(){ViewManager.ins().closeAll(),this.removeAllLayer()},t.prototype.addLayer=function(t){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().addChild(t),this._layers.push(t)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().addChild(t),this._layers.push(t))},t.prototype.addLayerAt=function(t,e){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().addChildAt(t,e),this._layers.push(t)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().addChildAt(t,e),this._layers.push(t))},t.prototype.removeLayer=function(t){t instanceof BaseSpriteLayer?(StageUtils.ins().getStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1)):t instanceof BaseEuiLayer&&(StageUtils.ins().getUIStage().removeChild(t),this._layers.splice(this._layers.indexOf(t),1))},t.prototype.layerRemoveAllChild=function(t){t instanceof BaseSpriteLayer?t.removeChildren():t instanceof BaseEuiLayer&&t.removeChildren()},t.prototype.removeAllLayer=function(){for(;this._layers.length;){var t=this._layers[0];this.layerRemoveAllChild(t),this.removeLayer(t)}},t}();__reflect(BaseScene.prototype,"BaseScene");var enPropActor;!function(t){t[t.P_WEAPON=40]="P_WEAPON",t[t.P_MOUNT=41]="P_MOUNT",t[t.P_DIZZY_RATE11=42]="P_DIZZY_RATE11",t[t.P_DIZZY_TIME1=43]="P_DIZZY_TIME1",t[t.P_HP_STORE=44]="P_HP_STORE",t[t.P_MP_STORE=45]="P_MP_STORE",t[t.P_SPIRIT=46]="P_SPIRIT",t[t.P_PK_MOD=47]="P_PK_MOD",t[t.P_STRONG_EFFECT=48]="P_STRONG_EFFECT",t[t.P_WING=49]="P_WING",t[t.P_STAGE_EFFECT=50]="P_STAGE_EFFECT",t[t.P_PET_HP_STORE=51]="P_PET_HP_STORE",t[t.PROP_ACTOR_XIUWEI_RENEW_RATE=52]="PROP_ACTOR_XIUWEI_RENEW_RATE",t[t.P_SEX=53]="P_SEX",t[t.P_VOCATION=54]="P_VOCATION",t[t.P_EXP=55]="P_EXP",t[t.P_PK_VALUE=57]="P_PK_VALUE",t[t.P_BAG_GRID=58]="P_BAG_GRID",t[t.P_WEEK_CHARM=59]="P_WEEK_CHARM",t[t.P_BIND_COIN=60]="P_BIND_COIN",t[t.P_COIN=61]="P_COIN",t[t.P_BIND_YB=62]="P_BIND_YB",t[t.P_YB=63]="P_YB",t[t.P_SHENGWANG=64]="P_SHENGWANG",t[t.P_CHARM=65]="P_CHARM",t[t.P_SPIRIT_SLOT=66]="P_SPIRIT_SLOT",t[t.P_RENOWN=67]="P_RENOWN",t[t.P_GUILD_ID=68]="P_GUILD_ID",t[t.P_TEAM_ID=69]="P_TEAM_ID",t[t.P_SOCIAL=70]="P_SOCIAL",t[t.P_GUILD_EXP=71]="P_GUILD_EXP",t[t.P_LUCKY=72]="P_LUCKY",t[t.P_SYS_OPEN=73]="P_SYS_OPEN",t[t.P_ROOT_EXP_POWER=74]="P_ROOT_EXP_POWER",t[t.P_CHANGE_MODEL=75]="P_CHANGE_MODEL",t[t.PROP_BANGBANGTANG_EXP=76]="PROP_BANGBANGTANG_EXP",t[t.P_GIVE_YB=77]="P_GIVE_YB",t[t.P_CRITICAL_STRIKE=78]="P_CRITICAL_STRIKE",t[t.P_EXP_RATE=79]="P_EXP_RATE",t[t.P_DEPOT_GRID=80]="P_DEPOT_GRID",t[t.P_ANGER=81]="P_ANGER",t[t.P_ROOT_EXP=82]="P_ROOT_EXP",t[t.P_ACHIEVEPOINT=83]="P_ACHIEVEPOINT",t[t.P_ZYCONT=84]="P_ZYCONT",t[t.P_QQ_VIP=85]="P_QQ_VIP",t[t.P_WING_ID=86]="P_WING_ID",t[t.P_WING_SCORE=87]="P_WING_SCORE",t[t.P_PET_SCORE=88]="P_PET_SCORE",t[t.PROP_ACTOR_VIPFLAG=89]="PROP_ACTOR_VIPFLAG",t[t.P_CAMP=90]="P_CAMP",t[t.P_PET_SLOT=91]="P_PET_SLOT",t[t.P_HONOR=92]="P_HONOR",t[t.P_QING_YUAN=93]="P_QING_YUAN",t[t.PROP_ACTOR_DUR_KILLTIMES=94]="PROP_ACTOR_DUR_KILLTIMES",t[t.PROP_ACTOR_BASE_FIGHT=95]="PROP_ACTOR_BASE_FIGHT",t[t.P_FIGHT_VALUE=96]="P_FIGHT_VALUE",t[t.P_MAX_RENOWN=97]="P_MAX_RENOWN",t[t.P_RECHARGE=98]="P_RECHARGE",t[t.P_VIP_LEVEL=99]="P_VIP_LEVEL",t[t.P_BEAST_LEVEL=100]="P_BEAST_LEVEL",t[t.P_FOOT_EFFECT=101]="P_FOOT_EFFECT",t[t.P_EQUIP_SCORE=102]="P_EQUIP_SCORE",t[t.P_HAIR_MODEL=103]="P_HAIR_MODEL",t[t.P_BUBBLE=104]="P_BUBBLE",t[t.P_ACTOR_STATE=105]="P_ACTOR_STATE",t[t.P_JINGJIE_TITLE=106]="P_JINGJIE_TITLE",t[t.P_ZHUMOBI=107]="P_ZHUMOBI",t[t.P_WARSPIRIT=108]="P_WARSPIRIT",t[t.P_GUILDFB_SCORE=109]="P_GUILDFB_SCORE",t[t.P_SYS_OPENEX=110]="P_SYS_OPENEX",t[t.P_MAX_ACTOR=111]="P_MAX_ACTOR"}(enPropActor||(enPropActor={}));var AttributeType;!function(t){t[t.atHp=0]="atHp",t[t.atMp=1]="atMp",t[t.atMaxHp=2]="atMaxHp",t[t.atMaxMp=3]="atMaxMp",t[t.atAttack=4]="atAttack",t[t.atDef=5]="atDef",t[t.atRes=6]="atRes",t[t.atCrit=7]="atCrit",t[t.atTough=8]="atTough",t[t.atMoveSpeed=9]="atMoveSpeed",t[t.atAttackSpeed=10]="atAttackSpeed",t[t.atHpEx=11]="atHpEx",t[t.atAtkEx=12]="atAtkEx",t[t.atStunPower=13]="atStunPower",t[t.atStunRes=14]="atStunRes",t[t.atStunTime=15]="atStunTime",t[t.atDamageReduction=16]="atDamageReduction",t[t.atCritHurt=17]="atCritHurt",t[t.atRegeneration=18]="atRegeneration",t[t.atCritEnhance=19]="atCritEnhance",t[t.atPenetrate=20]="atPenetrate",t[t.atRoleDamageEnhance=21]="atRoleDamageEnhance",t[t.atRoleDamageReduction=22]="atRoleDamageReduction",t[t.atDefEx=23]="atDefEx",t[t.atResEx=24]="atResEx",t[t.cruNeiGong=25]="cruNeiGong",t[t.maxNeiGong=26]="maxNeiGong",t[t.neigongAbsorbHurt=27]="neigongAbsorbHurt",t[t.atJob1HpEx=28]="atJob1HpEx",t[t.atJob2HpEx=29]="atJob2HpEx",t[t.atJob3HpEx=30]="atJob3HpEx",t[t.atNeiGongRestore=31]="atNeiGongRestore",t[t.atVamirePro=32]="atVamirePro",t[t.atVamirePen=33]="atVamirePen",t[t.atVamireCd=34]="atVamireCd",t[t.atCursePro=35]="atCursePro",t[t.atCurseCd=36]="atCurseCd",t[t.atAttAddDamPro=37]="atAttAddDamPro",t[t.atAttAddDamVal=38]="atAttAddDamVal",t[t.atBeAttAddHpPro=39]="atBeAttAddHpPro",t[t.atBeAttAddHpVal=40]="atBeAttAddHpVal",t[t.atAttMbAddDamPen=41]="atAttMbAddDamPen",t[t.atHpLtAddBuff=42]="atHpLtAddBuff",t[t.atAttHpLtPenAddDam=43]="atAttHpLtPenAddDam",t[t.atAttHpLtAddDamPen=44]="atAttHpLtAddDamPen",t[t.atJob1AtkEx=45]="atJob1AtkEx",t[t.atJob2AtkEx=46]="atJob2AtkEx",t[t.atJob3AtkEx=47]="atJob3AtkEx",t[t.atJob1DefEx=48]="atJob1DefEx",t[t.atJob2DefEx=49]="atJob2DefEx",t[t.atJob3DefEx=50]="atJob3DefEx",t[t.atJob1ResEx=51]="atJob1ResEx",t[t.atJob2ResEx=52]="atJob2ResEx",t[t.atJob3ResEx=53]="atJob3ResEx",t[t.atAttPerDamPan=54]="atAttPerDamPan",t[t.atYuPeiDeterDam=55]="atYuPeiDeterDam",t[t.atCritEnhanceResist=56]="atCritEnhanceResist",t[t.atHolyDamege=57]="atHolyDamege",t[t.atHolyMaster=58]="atHolyMaster",t[t.atHolyResist=59]="atHolyResist",t[t.atTogetherHolyDamege=60]="atTogetherHolyDamege",t[t.atTogetherHolyMaster=61]="atTogetherHolyMaster",t[t.atTogetherHolyResist=62]="atTogetherHolyResist",t[t.atZhuiMingPro=63]="atZhuiMingPro",t[t.atZhuiMingVal=64]="atZhuiMingVal",t[t.atHuiXinDamage=65]="atHuiXinDamage",t[t.atNeiGongEx=66]="atNeiGongEx",t[t.atDeadLyPro=67]="atDeadLyPro",t[t.atDeadLyMaster=68]="atDeadLyMaster",t[t.atDeadLyResist=69]="atDeadLyResist",t[t.atAddEnemyHp=70]="atAddEnemyHp",t[t.atHurtMyself=71]="atHurtMyself",t[t.atBladeMailPro=72]="atBladeMailPro",t[t.atBladeMailPer=73]="atBladeMailPer",t[t.atDefPen=74]="atDefPen",t[t.atResPen=75]="atResPen",t[t.atDeadLyHurt=76]="atDeadLyHurt",t[t.atDeadLyHurtResist=77]="atDeadLyHurtResist",t[t.atCritHurtResist=78]="atCritHurtResist",t[t.atHunGuPro=79]="atHunGuPro",t[t.atHunGuHurt=80]="atHunGuHurt",t[t.atHunGuCd=81]="atHunGuCd",t[t.atHearthDamege=82]="atHearthDamege",t[t.atHearthHurt=83]="atHearthHurt",t[t.atHearthCount=84]="atHearthCount",t[t.atDblDef=85]="atDblDef",t[t.atMojianVamirePro=86]="atMojianVamirePro",t[t.atStunSelf=87]="atStunSelf",t[t.atAttackSpeedPower=88]="atAttackSpeedPower",t[t.atAttMbReductionDamPen=89]="atAttMbReductionDamPen",t[t.atShanghaiJiaShen=90]="atShanghaiJiaShen",t[t.atHalfHpAddDamage=91]="atHalfHpAddDamage",t[t.atDemonsSystemKillMonster=92]="atDemonsSystemKillMonster",t[t.atDemonsSystemEyeTriRate=93]="atDemonsSystemEyeTriRate",t[t.atDemonsSystemEyeHuntRate=94]="atDemonsSystemEyeHuntRate",t[t.atDemonsSystemIdentify=95]="atDemonsSystemIdentify",t[t.atDemonsSystemSnatchTreasure=96]="atDemonsSystemSnatchTreasure",t[t.atDemonsAtk=97]="atDemonsAtk",t[t.atDemonsDef=98]="atDemonsDef",t[t.atSkillHuntAddRate=99]="atSkillHuntAddRate",t[t.atSkillReduceRate=100]="atSkillReduceRate",t[t.atAddHurtRateToType12Monster=101]="atAddHurtRateToType12Monster",t[t.atAddDefRateToType12Monster=102]="atAddDefRateToType12Monster",t[t.atAddFinalHurtRate=103]="atAddFinalHurtRate",t[t.atAddFinalDefRate=104]="atAddFinalDefRate",t[t.atGoldAtk=105]="atGoldAtk",t[t.atGoldDef=106]="atGoldDef",t[t.atWoodAtk=107]="atWoodAtk",t[t.atWoodDef=108]="atWoodDef",t[t.atWaterAtk=109]="atWaterAtk",t[t.atWaterDef=110]="atWaterDef",t[t.atFireAtk=111]="atFireAtk",t[t.atFireDef=112]="atFireDef",t[t.atEarthAtk=113]="atEarthAtk",t[t.atEarthDef=114]="atEarthDef",t[t.atPenetrateRes=115]="atPenetrateRes",t[t.atCount=116]="atCount"}(AttributeType||(AttributeType={})),window.AttributeType=AttributeType;var CharNpc=function(t){function e(){var e=t.call(this)||this;return e.npcHead=new MineNpcHead,e.npcHead.anchorOffsetY=90,e.npcHead.anchorOffsetX=100,e.npcHead.currentState=e.npcHead.states[0],e.titleCantainer.addChild(e.npcHead),e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?-1:1},e.prototype.updateModel=function(){var t=this.infoModel.npcConfig;this.npcHead.nameTxt.text=t.name,this.npcHead.updateModel(this.infoModel),this.x=this.infoModel.x,this.y=this.infoModel.y,this.setConfig(this.infoModel.avatarString),this.dir=this.infoModel.dir,this.playAction(t.action||EntityAction.STAND),this.addMc(0,this.infoModel.avatarFileName),this.infoModel.weaponFileName&&this.addMc(1,this.infoModel.weaponFileName)},e}(CharEffect);__reflect(CharNpc.prototype,"CharNpc"),window.CharNpc=CharNpc;var CharMonster=function(t){function e(){var e=t.call(this)||this;e.AI_STATE=AI_State.Stand,e.filterDic={},e.publicCD=0,e.nextPatrolTick=0,e.myKill=!1,e.isShowBody=!0,e.canMove=!1,e.moveRange=-1,e.moveLimTime=-1,e.moveMaxTime=-1,e.touchEnabled=!0,e.touchChildren=!1,e.buffList={},e.buffEff={},e.damageOverTimeList={},e.createTweenObj(),e.effs={},e._hpBar=new eui.ProgressBar,e._hpBar.skinName="bloodBarSkin",e._hpBar.anchorOffsetY=0,e._hpBar.labelDisplay.size=14,e._hpBar.visible=!1,e._hpBar.labelDisplay.visible=!1,e._hpBar.labelFunction=function(){return""},e.titleCantainer.addChild(e._hpBar),e._hpBar.anchorOffsetX=e._hpBar.width>>1,e._nameGroup=new eui.Group,e._nameGroup.touchEnabled=!1,e._nameGroup.height=30,e._nameGroup.width=260,e._nameGroup.anchorOffsetY=Math.floor(e._nameGroup.height+2),e._nameGroup.anchorOffsetX=Math.floor(e._nameGroup.width>>1);var i=new eui.HorizontalLayout;return i.horizontalAlign="center",i.verticalAlign="bottom",e._nameGroup.layout=i,e.titleCantainer.addChild(e._nameGroup),e._nameTxt=new eui.Label,e._nameTxt.textAlign="center",e._nameTxt.size=14,e._nameTxt.stroke=1,e._nameTxt.strokeColor=0,e._nameTxt.textColor=15589033,e._nameGroup.addChild(e._nameTxt),e._nameGroup.visible=!1,e}return __extends(e,t),e.prototype.createTweenObj=function(){var t=this;this.dieTweenObj={set alpha(e){t.alpha=e},get alpha(){return t.alpha}},this.moveTweenObj={set x(e){t.x=e>>0},set y(e){t.y=e>>0},get x(){return t.x},get y(){return t.y}}},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t,-1!=GlobalConfig.FlameStamp.monsterId.indexOf(t.configID)?this._lyMark||(this._lyMark=new LyMarkEffect(this._body,t)):this._lyMark&&this.clearLyMark()},enumerable:!0,configurable:!0}),e.prototype.setCharName=function(t){this._nameTxt.textFlow=TextFlowMaker.generateTextFlow(t)},e.prototype.setNameTxtColor=function(t){this._nameTxt.textColor=t},e.prototype.usedLyMarkSkill=function(){this._lyMark&&this._lyMark.usedLyMarkSkill()},e.prototype.playAction=function(e,i){(this._state!=e||this.isAtkAction())&&(this.hasFilter(EntityFilter.hard)&&e!=EntityAction.DIE||e==EntityAction.DIE&&this.infoModel.type==EntityType.Monster&&GlobalConfig.MonstersConfig[this.infoModel.configID]&&4==GlobalConfig.MonstersConfig[this.infoModel.configID].type||t.prototype.playAction.call(this,e,i))},e.prototype.stopMove=function(){this.canMove=!1,egret.Tween.removeTweens(this.moveTweenObj)},Object.defineProperty(e.prototype,"dir",{get:function(){if(this.infoModel){var t=this.infoModel.getDir();return 0>t?this._dir:t}return this._dir},set:function(t){this._dir==t||this.hasFilter(EntityFilter.hard)||this._state!=EntityAction.DIE&&(this._dir=t,this.loadBody())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"action",{get:function(){return this._state},set:function(t){this._state!=EntityAction.DIE&&(this._state=t)},enumerable:!0,configurable:!0}),e.prototype.getResDir=function(t){var e=2*(this._dir-4);0>e&&(e=0);var i=this._dir-e;return this.infoModel&&2!=this.infoModel.dirNum?i:2>i?1:3},Object.defineProperty(e.prototype,"moveSpeed",{get:function(){return this.infoModel?this.infoModel.getAtt(AttributeType.atMoveSpeed)/1e3*GameMap.CELL_SIZE:0},enumerable:!0,configurable:!0}),e.prototype.hram=function(t){this._hpBar.value=Math.min(this._hpBar.value-t,this.infoModel.getAtt(AttributeType.atMaxHp))},e.prototype.getHP=function(){return this._hpBar.value},e.prototype.getRealHp=function(){return this.infoModel.getAtt(AttributeType.atHp)},e.prototype.reset=function(){this._state=EntityAction.STAND,this.AI_STATE=AI_State.Stand,this.dir=4,this._hpBar.slideDuration=500,this.myKill=!1,this.removeAllFilters()},e.prototype.deadDelay=function(){this._hpBar.slideDuration=0,this._hpBar.value=0,this.removeHardStraight();for(var t in this.damageOverTimeList){var i=this.damageOverTimeList[t];this.deleteDamageOverTimer(i)}this.removeAllBuff(),this.atking=!1,this.haloMc&&DisplayUtils.removeFromParent(this.haloMc),e.die(this)},e.die=function(t){return t},e.prototype.clearLyMark=function(){this._lyMark&&(this._lyMark.destruct(),this._lyMark=null)},e.prototype.addHardStraight=function(t){this.isHardStraight=!0,Timer.start(t,1,this.removeHardStraight,this)},e.prototype.removeHardStraight=function(){this.isHardStraight=!1},Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._body.isPlaying},enumerable:!0,configurable:!0}),e.prototype.isAtkAction=function(){return this._state==EntityAction.ATTACK||this._state==EntityAction.CAST},e.prototype.loadBody=function(){this.isShowBody&&t.prototype.loadBody.call(this)},e.prototype.loadOther=function(e){this.isShowBody&&t.prototype.loadOther.call(this,e)},e.prototype.showBodyContainer=function(){this.isShowBody||(this.isShowBody=!0,this.addChildAt(this._bodyContainer,1),this.loadBody(),this.updateTitle(),this._lyMark&&this._lyMark.showBall())},e.prototype.hideBodyContainer=function(){this.isShowBody&&(this.isShowBody=!1,this.removeChild(this._bodyContainer),this.updateTitle(),this._lyMark&&this._lyMark.hideBall())},e.prototype.getIsShowBody=function(){return this.isShowBody},e.prototype.resetStand=function(){this.isAtkAction()&&this.playAction(EntityAction.STAND)},e.prototype.hasEffById=function(t){return this.effs&&!!this.effs[t]},e.prototype.updateBlood=function(t){void 0===t&&(t=!1),this.infoModel&&(this._hpBar.maximum=this.infoModel.getAtt(AttributeType.atMaxHp),(t||!(EntityManager.ins().getTeamCount(Team.WillEntity)>0&&0==GameMap.fubenID))&&(this._hpBar.value=this.infoModel.getAtt(AttributeType.atHp)))},e.prototype.updateTitle=function(){var t=this.infoModel,e=GlobalConfig.MonstersConfig[t.configID],i=e&&e.titleId;if(this.removeTitle(),this.getIsShowBody()&&i&&i>0){var n=GlobalConfig.MonsterTitleConf[i];if(n)if(n.img)null==this._title&&(this._title=new eui.Image,this._title.anchorOffsetX=115,this.titleCantainer.addChild(this._title)),n.anchorOffsetY?this._title.anchorOffsetY=n.anchorOffsetY:this._title.anchorOffsetY=100,this._title.source=RES_DIR_CHENGHAO+n.img;else if(n.eff){null==this._titleMc&&(this._titleMc=ObjectPool.pop("MovieClip"),this._titleMc.anchorOffsetX=0,this.titleCantainer.addChild(this._titleMc));var s=RES_DIR_EFF+n.eff;this.playFile(this._titleMc,s),n.anchorOffsetY?this._titleMc.anchorOffsetY=n.anchorOffsetY:this._titleMc.anchorOffsetY=80}}},e.prototype.removeTitle=function(){this._title&&(this._title.source=""),this._titleMc&&(DisplayUtils.removeFromParent(this._titleMc),this._titleMc=null)},e.prototype.onDead=function(t){this.stopMove(),this.showBlood(!1),this.showName(!1),this.removeTitle(),this.playAction(EntityAction.DIE),t&&Timer.start(300,1,t,this)},Object.defineProperty(e.prototype,"isCanAddBlood",{get:function(){return this._hpBar.value/this._hpBar.maximum<.8},enumerable:!0,configurable:!0}),e.prototype.damageOverTime=function(t){var e=t instanceof egret.Timer?t:t.currentTarget;e.currentCount==e.repeatCount&&this.deleteDamageOverTimer(e)},e.prototype.deleteDamageOverTimer=function(t){for(var e in this.damageOverTimeList)this.damageOverTimeList[e]==t&&(delete this.damageOverTimeList[e],t.stop(),t.removeEventListener(egret.TimerEvent.TIMER,this.damageOverTime,this))
},e.prototype.addEffect=function(t){var e=GlobalConfig.EffectConfig[t];if(e){if(0==e.type){var i=new eui.Image;i.source=e.fileName,this.addChild(i);var n=egret.Tween.get(i);return i.x=i.x-23,void n.to({y:-100},2e3).call(function(){DisplayUtils.removeFromParent(i)})}if(1==e.type){var s=ObjectPool.pop("MovieClip"),o=RES_DIR_EFF+e.fileName;return s.playFile(o),void this.addChild(s)}var a=this.effs[t]||ObjectPool.pop("MovieClip"),r=RES_DIR_SKILLEFF+e.fileName;this.playFile(a,r),this.addChild(a),this.effs[t]=a}},e.prototype.$setX=function(e){return this.haloMc&&(this.haloMc.x=e),t.prototype.$setX.call(this,e)},e.prototype.$setY=function(e){return this.haloMc&&(this.haloMc.y=e),t.prototype.$setY.call(this,e)},e.prototype.addDisplay=function(){t.prototype.addDisplay.call(this),this.settingUpdate(),this.observe(Setting.ins().setValue,this.settingUpdate)},e.prototype.removeDisplay=function(){t.prototype.removeDisplay.call(this),this.shBody(!1),this.shHalo(!1)},e.prototype.settingUpdate=function(){this.shBody(!0),this.shHalo(!0)},e.prototype.shHalo=function(t){if(!t)return DisplayUtils.removeFromParent(this.haloMc),void(this.haloMc=null);var e=this.infoModel.effect;e&&(this.haloMc=this.haloMc||new MovieClip,this.haloMc.x=this.x,this.haloMc.y=this.y,this.playFile(this.haloMc,RES_DIR_EFF+GlobalConfig.EffectConfig[e].fileName),DropHelp.dropContainer.addChildAt(this.haloMc,0))},e.prototype.shBody=function(t){var e=this.infoModel.isClient;if(!this.isMy&&e&&(t=t&&!Setting.ins().getValue(ClientSet.shMonster)),t){var i=this.infoModel.avatarFileName;this.addMc(0,RES_DIR_MONSTER+i)}else this.clearMc(0)},e.prototype.removeEffect=function(t){var e=GlobalConfig.EffectConfig[t];if(e&&0!=e.type){var i=this.effs[t];i&&(DisplayUtils.removeFromParent(i),delete this.effs[t])}},e.prototype.removeAllEffect=function(){for(var t in this.effs){var e=this.effs[t];e&&DisplayUtils.removeFromParent(e)}this.effs={}},e.prototype.hasBuff=function(t){return!!this.buffList[t]},e.prototype.addBuff=function(t){var e=t.effConfig,i=e.group,n=this.buffList[i];if(n&&(2==n.effConfig.overlayType&&(t.multRate=n.multRate+1),this.removeBuff(n)),this.buffList[i]=t,e.effName&&this.isShowBody){var s=this.buffEff[i]||ObjectPool.pop("MovieClip"),o=RES_DIR_SKILLEFF+e.effName;this.playFile(s,o),this.addChild(s),this.buffEff[i]=s}if(e.effID&&this.addEffect(e.effID),4==t.effConfig.type&&t.effConfig.args&&9==t.effConfig.args.i){var a=t.effConfig.duration;this.addHardStraight(a)}this.addGroup(i)},e.prototype.removeBuff=function(t){var e=t.effConfig,i=e.group;if(this.buffList[i]==t&&(t.dispose(),ObjectPool.push(this.buffList[i]),delete this.buffList[i],this.buffEff[i]&&(DisplayUtils.removeFromParent(this.buffEff[i]),delete this.buffEff[i]),e.effID&&this.removeEffect(e.effID),e.unionBuff)){var n=this.buffList[e.unionBuff];n&&this.removeBuff(n)}this.removeGroup(i)},e.prototype.removeAllBuff=function(){for(var t in this.buffList)this.removeBuff(this.buffList[t])},e.prototype.addPaoPao=function(t){this.paoPao||(this.paoPao=new PaoPaoView,this.addChildAt(this.paoPao,100),this.paoPao.open()),this.paoPao.anchorOffsetY=170,this.paoPao.anchorOffsetX=100;var e=this.infoModel.job;this.paoPao.setSpeak(t,e)},Object.defineProperty(e.prototype,"team",{get:function(){return this._infoModel.team},enumerable:!0,configurable:!0}),e.prototype.startPatrol=function(){var t=egret.getTimer();if(t>this.nextPatrolTick){var e=this.getPointCanMove();e&&(GameMap.moveEntity(this,e.x,e.y),this.nextPatrolTick=t+MathUtils.limit(this.moveLimTime,this.moveMaxTime))}},e.prototype.setMoveAtt=function(t){this.moveRange=t[0],this.moveLimTime=t[1][0],this.moveMaxTime=t[1][1]},e.prototype.getPointCanMove=function(){for(var t=0,e=this.moveRange;100>t;){var i=MathUtils.limit(this.x-e>>0,this.x+e>>0),n=MathUtils.limit(this.y-e>>0,this.y+e>>0);if(GameMap.checkWalkableByPixel(i,n)){var s=new egret.Point;return s.x=i,s.y=n,s}t++}return null},e.prototype.playCount=function(){return this._state==EntityAction.RUN||this._state==EntityAction.STAND?-1:1},e.prototype.shakeIt=function(){this.action==EntityAction.STAND&&DisplayUtils.shakeItEntity(this,3,200,1)},e.prototype.showName=function(t){this._nameGroup.visible=t},e.prototype.showBlood=function(t){t&&this.infoModel&&"神兽"==this.infoModel.name||(this._hpBar.visible=t)},Object.defineProperty(e.prototype,"isMy",{get:function(){return this.infoModel.isMy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._infoModel&&this.team==Team.My&&this instanceof CharRole?this.y+32:this.y},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){this.parseModel()},e.prototype.parseModel=function(){var t=this,e=this.infoModel;e.team!=Team.My&&(t.updateBlood(!0),t.setCharName(e.name)),t.setConfig(e.avatar+""),t.updateTitle(),e.movePara&&t.setMoveAtt(e.movePara),t.setBodyScale(e.avatarScale)},e.prototype.addGroup=function(t){var e=EntityFilterUtil.getEntityFilter(t);if(e){this.filterDic[e]=this.filterDic[e]||[];var i=this.filterDic[e].indexOf(t);-1==i&&(this.filterDic[e].push(t),this.updateFilter())}},e.prototype.removeGroup=function(t){var e=EntityFilterUtil.getEntityFilter(t);if(e){var i=this.filterDic[e];if(!i)return;var n=i.indexOf(t);n>=0&&(i.splice(n,1),this.updateFilter())}},e.prototype.updateFilter=function(){var t=EntityFilter.no;this.hasFilter(EntityFilter.hard)?t=EntityFilter.hard:this.hasFilter(EntityFilter.poison)&&(t=EntityFilter.poison),this.curFilter!=t&&this.setFilter(t)},e.prototype.hasFilter=function(t){return!(!this.filterDic[t]||!this.filterDic[t].length)},e.prototype.setFilter=function(t){this.curFilter=t,t?(this.setMcFilter(t),t==EntityFilter.hard?this.setMcFilterPlayOrStop(!1):this.setMcFilterPlayOrStop(!0)):(this.setMcFilter(t),this.setMcFilterPlayOrStop(!0))},e.prototype.setMcFilter=function(t){if("webgl"==egret.Capabilities.renderMode)for(var e in this._disOrder)if(4!=+e){var i=this._disOrder[e];i.filters=t?EntityFilterUtil.buffFilter[t].filters:null}},e.prototype.setMcFilterPlayOrStop=function(t){for(var e in this._disOrder)if(4!=+e){var i=this.getMc(+e);i&&(t?i.play():i.stop())}},e.prototype.removeAllFilters=function(){this.filterDic={},this.curFilter=EntityFilter.no;for(var t in this._disOrder){var e=this._disOrder[t];e.filters=null}},__decorate([post()],e,"die",null),e}(CharEffect);__reflect(CharMonster.prototype,"CharMonster"),window.CharMonster=CharMonster;var GuideViewBase=function(t){function e(){var e=t.call(this)||this;return e.clickCD=!0,e.otherMc=[],e.rect=new egret.Rectangle(1,1,1,1),e.infoGroup=new eui.Group,e.infoGroup.touchEnabled=!1,e.infoGroup.touchChildren=!1,e.addChild(e.infoGroup),e}return __extends(e,t),e.prototype.drawMask=function(){if(!this.shapeMasks){this.shapeMasks=[];for(var t=0;8>t;t++)this.shapeMasks[t]=new eui.Rect,this.shapeMasks[t].touchEnabled=!0,this.shapeMasks[t].alpha=0}var e=this.rect,i=e.x,n=e.width,s=StageUtils.ins().getWidth()-e.right,o=e.y,a=e.height,r=StageUtils.ins().getHeight()-e.bottom;this.drawShape(this.shapeMasks[0],new egret.Rectangle(0,0,i,o)),this.drawShape(this.shapeMasks[1],new egret.Rectangle(e.x,0,n,o)),this.drawShape(this.shapeMasks[2],new egret.Rectangle(e.right,0,s,o)),this.drawShape(this.shapeMasks[3],new egret.Rectangle(0,e.topLeft.y,i,a)),this.drawShape(this.shapeMasks[4],new egret.Rectangle(e.bottomRight.x,e.topLeft.y,s,a)),this.drawShape(this.shapeMasks[5],new egret.Rectangle(0,e.bottomRight.y,i,r)),this.drawShape(this.shapeMasks[6],new egret.Rectangle(e.x,e.bottomRight.y,n,r)),this.drawShape(this.shapeMasks[7],new egret.Rectangle(e.right,e.bottomRight.y,s,r))},e.prototype.drawShape=function(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,this.addChild(t)},e.prototype.onResize=function(){if(this.target){var t=this.target.localToGlobal();return(this.rect.x!=t.x||this.rect.y!=t.y||this.rect.width!=this.target.width||this.rect.height!=this.target.height)&&(this.refurbish(),this.drawMask()),!1}},e.prototype.onClick=function(t){var e=this;if(this.rect.contains(t.stageX,t.stageY)){this.clickCD&&(this.clickCD=!1,egret.callLater(function(){e.dispatchEventWith(egret.Event.CHANGE)},this));for(var i=0;i<this.otherMc.length;i++)egret.Tween.removeTweens(this.otherMc[i]),DisplayUtils.removeFromParent(this.otherMc[i]);this.clicking=!1}else{if(GuideUtils.ins().clickOut(),this.clicking)return;this.clicking=!0,this.otherMc.length=2;for(var n=function(t){s.otherMc[t]||(s.otherMc[t]=new MovieClip),s.otherMc[t].parent||s.addChild(s.otherMc[t]),s.otherMc[t].scaleX=1,s.otherMc[t].scaleY=1,s.otherMc[t].x=s.infoGroup.x,s.otherMc[t].y=s.infoGroup.y;var e=egret.Tween.get(s.otherMc[t]),i=s;e.wait(240*t).call(function(){i.otherMc[t].playFile(RES_DIR_EFF+"PromptEFF1",1,function(){egret.Tween.removeTweens(i.otherMc[t]),DisplayUtils.removeFromParent(i.otherMc[t]),t==i.otherMc.length-1&&(i.clicking=!1)})})},s=this,i=0;i<this.otherMc.length;i++)n(i)}},e.prototype.refurbish=function(){this.show(this.target)},e.prototype.show=function(t){if(null!=t){this.target=t;var e=t.localToGlobal();this.rect.x=e.x,this.rect.y=e.y,this.rect.width=t.width?t.width:60,this.rect.height=t.height?t.height:60,this.drawMask(),this.addChild(this.infoGroup),this.infoGroup.x=e.x+(this.rect.width>>1),this.infoGroup.y=e.y+(this.rect.height>>1);var i=StageUtils.ins().getStage();i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,!0,0),egret.stopTick(this.onResize,this),egret.startTick(this.onResize,this)}},e.prototype.close=function(){this.target=null,this.rect.x=this.rect.y=this.rect.width=this.rect.height=1;var t=StageUtils.ins().getStage();t.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this,!0),egret.stopTick(this.onResize,this)},e}(egret.DisplayObjectContainer);__reflect(GuideViewBase.prototype,"GuideViewBase"),window.GuideViewBase=GuideViewBase;var FilterUtil=function(){function t(){}return Object.defineProperty(t,"grayFilter",{get:function(){return new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"grayFilter1",{get:function(){return new egret.ColorMatrixFilter([.3086,.5,.082,0,0,.3086,.5,.082,0,0,.3086,.5,.082,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_GRAY_FILTER",{get:function(){return[t.grayFilter1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"greenFilter",{get:function(){return new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,100,0,0,1,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"greenFilter1",{get:function(){return new egret.ColorMatrixFilter([.1,0,0,0,0,0,.80078125,0,0,20,0,0,-1,0,0,0,0,0,1,0])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_GREEN_FILTER",{get:function(){return[t.greenFilter1]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"blurFilter",{get:function(){return new egret.BlurFilter(10,10,2)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ARRAY_BLUR_FILTER",{get:function(){return[t.blurFilter]},enumerable:!0,configurable:!0}),t}();__reflect(FilterUtil.prototype,"FilterUtil"),window.FilterUtil=FilterUtil;var ActivityType11Data=function(t){function e(e,i,n,s,o){void 0===o&&(o=ActivityType.Normal);var a=t.call(this,e)||this;return a._rewardInfo=0,a.yunBao=0,a.activityType=o,a.id=i,a.startTime=n,a.endTime=s,a.update(e),a}return __extends(e,t),e.prototype.update=function(t){this._rewardInfo=t.readInt(),this._hiScore=t.readInt();var e=t.readShort();this.yunBao=t.readInt(),this._achieveInfo=[];var i;i=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType11_2Config:GlobalConfig.ActivityType11_2Config,this._achieveInfo.length=Object.keys(i[this.id]).length;var n;for(n=0;e>n;n++)this._achieveInfo[t.readShort()-1]={times:t.readInt(),isGot:t.readBoolean(),hasGetOther:t.readByte(),otherTarget:0,otherState:0};e=this._achieveInfo.length;var s;for(n=0;e>n;n++)this._achieveInfo[n]||(this._achieveInfo[n]={times:0,isGot:!1,hasGetOther:0,otherTarget:0,otherState:0}),s=i[this.id][n+1],this.updateOtherState(s,this._achieveInfo[n])},e.prototype.updateOtherState=function(t,e){var i=e.isGot?2:0,n=0,s=1;if(t.yuanbaoReward&&e.isGot)for(var o in t.yuanbaoReward){if(e.hasGetOther<s){n=+o;break}s++}n>0&&(i=this.yunBao>=n?1:0),e.otherTarget=n,e.otherState=i},Object.defineProperty(e.prototype,"rewardInfo",{get:function(){return this._rewardInfo},enumerable:!0,configurable:!0}),e.prototype.getRewardState=function(t){var e;return e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType11_1Config:GlobalConfig.ActivityType11_1Config,this.hiScore<e[this.id][t].score?0:0==(this.rewardInfo>>t&1)?1:2},Object.defineProperty(e.prototype,"hiScore",{get:function(){return this._hiScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"achieveInfo",{get:function(){return this._achieveInfo},enumerable:!0,configurable:!0}),e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.checkRedPoint=function(){var t,i;this.activityType==ActivityType.Personal?(t=GlobalConfig.PActivityType11_2Config,i=PActivity.ins()):(t=GlobalConfig.ActivityType11_2Config,i=Activity.ins());var n=this.activityType==ActivityType.Personal?GlobalConfig.PActivityConfig[this.id]:GlobalConfig.ActivityConfig[this.id];if("SpringDayWin"==n.pageSkin){var s=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType11_1Config[this.id]:GlobalConfig.ActivityType11_1Config[this.id];for(var o in s){var a=s[o].index;if(1==a&&1==this.getGroupRewardState(a)||a>1&&1==this.getGroupRewardState(a)&&this.getGroupRewardState(a-1)>=1)return!0}for(var o in t[this.id])if(1==this.getTaskState(t[this.id][o].index))return!0}else if(n.pageStyle==ActivityPageStyle.HAPPYSEVENDAY||n.pageStyle==ActivityPageStyle.SPRINGEIGHTDAY||n.pageStyle==ActivityPageStyle.VERSIONCELE||n.pageStyle==ActivityPageStyle.YBZHUANPAN){for(var r=Object.keys(t[this.id]).length,l=void 0,h=void 0,u=this.getCurDay(),o=1;r>=o;o++)if(l=t[this.id][o],h=this.achieveInfo[l.index-1],u>=(l.day||0)&&(!h.isGot&&h.times>=l.target||1==h.otherState))return!0}else if(this.checkPhaseAward())return!0;if(n.pageStyle==ActivityPageStyle.VERSIONCELE){if(e.FIRST_OPEN_SHOP)return!0;if(this.checkPhaseAward())return!0;var p=0;for(var c in i.activityData){var d=i.activityData[c];if(d&&d.pageStyle==ActivityPageStyle.VERSIONCELE&&d.type==ActivityDataType._22&&Activity.ins().getActivityDataById(+c).isOpenActivity()&&!Activity.ins().getActivityDataById(+c).getHide()){if(p=d.id,d.refreshFree)return!0;break}}}return!1},e.prototype.checkPhaseAward=function(){for(var t=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType11_1Config[this.id]:GlobalConfig.ActivityType11_1Config[this.id],e=Object.keys(t).length,i=1;e>=i;i++){if((this._rewardInfo>>i&1)<=0&&this._hiScore>=t[i].score)return!0;if(0==t[i].rewardType&&1==this.getRewardState(t[i].index))return!0}return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getCurDay=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t>=0?0:0>=e?0:Math.ceil(Math.abs(t)/86400)},e.prototype.getCfg2ByGroup=function(t){var e=GlobalConfig.ActivityType11_2Config[this.id],i=[];for(var n in e)e[n].group==t&&i.push(e[n]);return i},e.prototype.getTaskState=function(t){var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType11_2Config[this.id]:GlobalConfig.ActivityType11_2Config[this.id],i=this.achieveInfo[t-1];return i.isGot?2:i.times>=e[t].target?1:0},e.prototype.getGroupTaskFinishNum=function(t){var e=this.getCfg2ByGroup(t),i=0;for(var n in e)switch(this.getTaskState(e[n].index)){case 1:case 2:i++}return i},e.prototype.getGroupRewardState=function(t){if(1==(this.rewardInfo>>t&1))return 2;var e=this.getCfg2ByGroup(t),i=0;for(var n in e)switch(this.getTaskState(e[n].index)){case 1:case 2:i++}return i>=e.length?1:0},e.FIRST_OPEN_SHOP=!0,e}(ActivityBaseData);__reflect(ActivityType11Data.prototype,"ActivityType11Data"),window.ActivityType11Data=ActivityType11Data;var ActivityType1Data=function(t){function e(e){var i=t.call(this,e)||this;return i.awardArr=[],i.rewardsSum=[],i.progress=0,i.readReawards(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.awardNum+=1,this.awardArr.push(e.readInt())},e.prototype.readReawards=function(t){this.awardArr=[],this.awardNum=t.readInt();for(var e=0;e<this.awardNum;e++)this.awardArr.push(t.readInt());this.progress=t.readInt(),this.bossLevel=t.readInt(),this.curVal=t.readInt();for(var i=t.readShort(),n=1;i>=n;n++)this.rewardsSum[n]=t.readShort()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:void 0},e.prototype.getConfig=function(){var t;return t=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType1Config:GlobalConfig.ActivityType1Config},e.prototype.getIns=function(){var t;return t=this.activityType==ActivityType.Personal?PActivity.ins():Activity.ins()},e.prototype.getRewardStateById=function(t){var e=this.getConfig()[this.id][t];switch(e.showType){case ShowType.LEVEL:if(Actor.level<e.level||ZsCT.ins().lv<e.zslevel)return Activity.NotReached;break;case ShowType.WING:if(WingsData.getWingAllLevel()<e.wingLv)return Activity.NotReached;break;case ShowType.ZHUZAO:if(Role.getAllForgeLevelByType(PackageID.Zhuling)<e.zzLv)return Activity.NotReached;break;case ShowType.LONGHUN:if(LongHunData.getLongHunAllLevel()<e.lhLv)return Activity.NotReached;break;case ShowType.BOOK:var i=Book.ins().getBookPowerNumEx();if(i<e.tjPower)return Activity.NotReached;break;case ShowType.EQUIP:if(Math.max(this.progress,BagCT.ins().getEquipsScoreByRolesOfBody())<e.equipPower)return Activity.NotReached;break;case ShowType.XIAOFEI:var n=this.getIns().getActivityDataById(e.Id);if(n.progress<e.consumeYuanbao)return Activity.NotReached;break;case ShowType.RING:var s=0,o=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);if(o&&o.level&&(s=o.level),s<e.huoyanRingLv)return Activity.NotReached;break;case ShowType.SAMSARA:if(Actor.samsaraLv<e.lunhLv)return Activity.NotReached;break;case ShowType.ZHANLING:if(ZhanLingModel.ins().getZhanLingDataByLevel(0)<e.zhanlingLv)return Activity.NotReached;break;case ShowType.YUANSHEN:if(!YuanshenData.ins().isEnough(e.lianjiLv))return Activity.NotReached;break;case ShowType.QiongQi:if(this.bossLevel<e.qiongqiLevel)return Activity.NotReached;break;case ShowType.Heirloom:if(this.curVal<e.heirloomPower)return Activity.NotReached;break;case ShowType.SHENSHOU:if(this.curVal<e.shenshouPower)return Activity.NotReached;break;case ShowType.HEARTMETHOD:if(this.curVal<e.heartmethodLv)return Activity.NotReached;break;case ShowType.ENCOUNTER:if(this.curVal<e.skirmishFame)return Activity.NotReached;break;case ShowType.MOSHEN:if(this.curVal<e.moshenLv)return Activity.NotReached}var a=this.awardArr.indexOf(e.index)>=0;return a?Activity.Geted:Activity.CanGet},e.prototype.checkRedPoint=function(){var t=this.getConfig()[this.id];for(var e in t){var i=t[e],n=this.getRewardStateById(i.index),s=this.rewardsSum[i.index],o=i.total?i.total-s:1;switch(n){case Activity.NotReached:break;case Activity.CanGet:if(o>0)return!0;break;case Activity.Geted:}}return!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;var t=this.getConfig()[this.id];if(!t)return this.isHide;var e=Object.keys(t);return this.awardNum>=e.length?(this.isHide=!0,this.isHide):(this.isHide=!1,this.isHide)},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e}(ActivityBaseData);__reflect(ActivityType1Data.prototype,"ActivityType1Data");var ShowType;!function(t){t[t.LEVEL=0]="LEVEL",t[t.WING=1]="WING",t[t.ZHUZAO=2]="ZHUZAO",t[t.LONGHUN=3]="LONGHUN",t[t.BOOK=5]="BOOK",t[t.EQUIP=6]="EQUIP",t[t.RING=7]="RING",t[t.SAMSARA=8]="SAMSARA",t[t.ZHANLING=9]="ZHANLING",t[t.YUANSHEN=10]="YUANSHEN",t[t.QiongQi=11]="QiongQi",t[t.Heirloom=12]="Heirloom",t[t.SHENSHOU=13]="SHENSHOU",t[t.HEARTMETHOD=14]="HEARTMETHOD",t[t.ENCOUNTER=15]="ENCOUNTER",t[t.MOSHEN=16]="MOSHEN",t[t.XIAOFEI=100]="XIAOFEI"}(ShowType||(ShowType={})),window.ActivityType1Data=ActivityType1Data;var ActivityType36Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.addNum=t.readUnsignedInt(),this.times=t.readUnsignedInt(),this.state=t.readByte()},e.prototype.canReward=function(){return this.times>0},e.prototype.postRewardResult=function(t){t.readShort(),this.rewardIndex=t.readByte()},e.prototype.postlog=function(t){this.logs=[];for(var e=t.readUnsignedShort(),i=0;e>i;i++)this.logs.push([t.readString(),t.readInt()])},e.prototype.getRewardState=function(t){return 1==(this.state>>t&1)},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},__decorate([post()],e.prototype,"postRewardResult",null),__decorate([post()],e.prototype,"postlog",null),e}(ActivityBaseData);__reflect(ActivityType36Data.prototype,"ActivityType36Data"),window.ActivityType36Data=ActivityType36Data;var ActivityType3Data=function(t){function e(e){var i=t.call(this,e)||this;return i.dabiao=[],i.chongzhiNum=0,i.chongzhiTotal=0,i.btn1=!1,i.btn2=!1,i.image1=!1,i.image2=!1,i.actCfg=GlobalConfig.ActivityType3Config,i.updateData(e),i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.recrod=e.readInt()},e.prototype.openDay=function(){var t=this.actCfg[this.id];return t&&t[0]?t[0].day:7},e.prototype.canRewardById=function(t){var e=this.actCfg[this.id][t];if((this.dabiao[t-1]||0)>=e.day){var i=this.recrod>>t&1;return 0==i?1:2}return 0},e.prototype.canReward=function(){var t=this.actCfg[this.id],e=this.recrod,i=-1,n=0;for(var s in t){var o=e>>t[s].index&1;if(1==t[s].type){if(this.dabiao[n]>=t[s].day&&0==o)return!0}else if(2==t[s].type&&t[s].val<=this.chongzhiTotal){if(0==o)return!0}else if(3==t[s].type&&t[s].val<=this.chongzhiNum&&(-1==i&&(i=this.getCurIndex(3)),i==t[s].index&&0==o))return!0;n++}return this.canRewardEx()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.updateData=function(t){var e=t.readShort();this.dabiao=[];for(var i=0;e>i;i++)this.dabiao.push(t.readShort());this.chongzhiNum=t.readInt(),this.chongzhiTotal=t.readInt()},Object.defineProperty(e.prototype,"day7text",{get:function(){var t=this.actCfg[this.id];for(var e in t)1==t[e].type&&(this.rewards1=t[e].rewards,this._day7text="累计"+("<font color='#ffff00'>"+t[e].day+"</font>")+"天，每日充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._day7text},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totaltext",{get:function(){var t=this.actCfg[this.id];for(var e in t)2==t[e].type&&(this.maxTotal=t[e].val,this.rewards2=t[e].rewards,this._totaltext="活动期间累计充值"+("<font color='#ffff00'>"+t[e].val+"</font>")+"元宝可领取");return this._totaltext},enumerable:!0,configurable:!0}),e.prototype.canOnlyReward=function(){var t=this.actCfg[this.id],e=this.recrod;this.btn1=!1,this.btn2=!1,this.image1=!1,this.image2=!1;for(var i in t){var n=e>>t[i].index&1;1==t[i].type&&this.dabiao&&this.dabiao[0]>=t[i].day&&(0==n&&(this.btn1=!0),1==n&&(this.image1=!0)),2==t[i].type&&t[i].val<=this.chongzhiTotal&&(0==n&&(this.btn2=!0),1==n&&(this.image2=!0))}},e.prototype.getDateTime=function(t){var e=t.split(/[-,.,:]/g),i=new Date(+e[0],+e[1]-1,+e[2],+e[3]||0,+e[4]||0);return i.getTime()},e.prototype.isOverTimer=function(t){var e=this.curOpenDay(),i=this.actCfg[this.id][t],n=this.recrod>>i.index&1;return e+1>i.day&&n!=Activity.Geted?!0:!1},e.prototype.curOpenDay=function(){var t=GlobalConfig.ActivityConfig[this.id],e=0;if(0==t.timeType){var i=+t.startTime.split("-")[0];e=GameServer.serverOpenDay-i}else if(1==t.timeType){var i=GameServer.serverTime,n=DateUtils.formatMiniDateTime(this.startTime);e=Math.floor((i-n)/1e3/3600/24)}else if(2==t.timeType){var i=+t.startTime.split("-")[0],n=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);e=n-i}return e},e.prototype.getCurIndex=function(t){var e=this.actCfg[this.id],i=this.curOpenDay(),n={};for(var s in e)n[e[s].type]=1;var o=Object.keys(n);(1==o.length||void 0==t)&&(t=+o[0]);var a,r=[];for(a in e)e[a].type==t&&r.push(e[a]);r.sort(function(t,e){return t.day<e.day?-1:1});for(var l=0,h=r;l<h.length;l++){var u=h[l];if(a=u.index,1==t||2==t){if(i<u.day)return+a}else if(3==t&&i<u.day)return+a}return+a},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRewardStateById=function(t){var e=this.actCfg[this.id][t];switch(e.showType){case Show3Type.TYPE6:case Show3Type.TYPE8:case Show3Type.TYPE9:if(this.chongzhiTotal<e.val)return Activity.NotReached;break;case Show3Type.TYPE7:case Show3Type.TYPE11:if(this.dabiao[t-1]<e.day)return Activity.NotReached}var i=this.recrod>>e.index&1;return i?Activity.Geted:Activity.CanGet},e.prototype.canRewardEx=function(){var t=this.actCfg[this.id];if(t&&t[1]&&t[1].activityID)for(var e=0;e<t[1].activityID.length;e++){var i=Activity.ins().getActivityDataById(t[1].activityID[e]);if(i&&i.canReward())return!0}return!1},e}(ActivityBaseData);__reflect(ActivityType3Data.prototype,"ActivityType3Data");var Show3Type;!function(t){t[t.TYPE1=1]="TYPE1",t[t.TYPE2=2]="TYPE2",t[t.TYPE3=3]="TYPE3",t[t.TYPE4=4]="TYPE4",t[t.TYPE5=5]="TYPE5",t[t.TYPE6=6]="TYPE6",t[t.TYPE7=7]="TYPE7",t[t.TYPE8=8]="TYPE8",t[t.TYPE9=9]="TYPE9",t[t.TYPE10=10]="TYPE10",t[t.TYPE11=11]="TYPE11"}(Show3Type||(Show3Type={})),window.ActivityType3Data=ActivityType3Data;var ActivityType42Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){var e=t.readShort();this.achieveInfo=[];for(var i=0;e>i;i++)this.achieveInfo[t.readShort()]={times:t.readInt(),isGot:t.readBoolean()}},e.prototype.getAchieveInfo=function(t){return this.achieveInfo[t]},e.prototype.getStatus=function(t){var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType42Config[this.id]:GlobalConfig.ActivityType42Config[this.id],i=e[t],n=this.getAchieveInfo(t);return n?n.isGot?2:n.times>=i.target?1:0:0},e.prototype.groupCanReward=function(t){var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType42Config[this.id]:GlobalConfig.ActivityType42Config[this.id];for(var i in e)if(e[i].group==t){var n=this.achieveInfo[e[i].index];if(n&&n.times>=e[i].target&&!n.isGot)return!0}return!1},e.prototype.canReward=function(){var t=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType42Config[this.id]:GlobalConfig.ActivityType42Config[this.id];for(var e in t){var i=this.achieveInfo[t[e].index];if(i&&i.times>=t[e].target&&!i.isGot)return!0}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType42Data.prototype,"ActivityType42Data"),window.ActivityType42Data=ActivityType42Data;var ActivityType5Data=function(t){function e(e){var i=this;if(e)return i=t.call(this,e)||this,i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.updateRecord=function(t){this.recrod=t.readInt()},e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.recrod=e.readInt()},e.prototype.updateData=function(t){this.logTime=t.readInt()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.canReward=function(t){void 0===t&&(t=0),0==t&&(t=this.logTime);var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType5Config[this.id]:GlobalConfig.ActivityType5Config[this.id];for(var i in e){var n=this.recrod>>e[i].index&1;if(0==n&&e[i].day<=this.logTime)return!0}return!1},e.prototype.checkOneDayStatu=function(t){void 0===t&&(t=0),0==t&&(t=this.logTime);var e=this.recrod>>t&1;return 0==e?!0:!1},e.prototype.getCurDay=function(){return this.logTime},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getRewardState=function(t){return this.getCurDay()>=t?0==(this.recrod>>t&1)?1:2:0},e}(ActivityBaseData);__reflect(ActivityType5Data.prototype,"ActivityType5Data"),window.ActivityType5Data=ActivityType5Data;var ActivityType7Data=function(t){function e(e){var i=t.call(this,e)||this;return i.personalRewardsSum=[],i.worldRewardsSum=[],i.exchange=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),n=e.readShort();this.personalRewardsSum[i]=n,this.worldRewardsSum[i]=e.readShort(),this.exchange[i]=e.readShort()},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.personalRewardsSum[i]=t.readShort(),this.worldRewardsSum[i]=t.readShort(),this.exchange[i]=t.readShort();this.bossScore=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return this.activityType==ActivityType.Personal?PActivity.ins().getType7RedPoint(this.id):Activity.ins().getType7RedPoint(this.id)},e.prototype.getAwardState=function(t){var e=this.activityType==ActivityType.Personal?GlobalConfig.PActivityType7Config[this.id][t]:GlobalConfig.ActivityType7Config[this.id][t],i=this.personalRewardsSum[e.index]>=e.count;return i?Activity.Geted:this.bossScore>=e.score?Activity.CanGet:Activity.NotReached},e.prototype.getExchange=function(t,e){void 0===e&&(e=0);var i,n;if(this.activityType==ActivityType.Personal?(i=PActivity.ins().getActivityDataById(this.id),n=GlobalConfig.PActivityType7Config[this.id][t]):(i=Activity.ins().getActivityDataById(this.id),n=GlobalConfig.ActivityType7Config[this.id][t]),!n.items&&0==e)return Activity.NotReached;
var s=Activity.CanGet,o=i.worldRewardsSum[t],a=i.exchange[t],r=i.personalRewardsSum[t];if(0==e)for(var l in n.items){var h=BagCT.ins().getBagItemById(n.items[l].id),u=h?h.count:0;if(u<n.items[l].count){s=Activity.NotReached;break}}else{var h=BagCT.ins().getBagItemById(n.itemId),u=h?h.count:0;u<n.itemCount&&(s=Activity.NotReached)}return s!=Activity.NotReached&&(n.scount&&o>=n.scount&&(s=Activity.Geted),n.count&&r>=n.count&&(s=Activity.Geted),n.dailyCount&&a>=n.dailyCount&&(s=Activity.Geted)),s},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.TYPE_RING=1,e.TYPE_HEFUBOSS=2,e.TYPE_CELEBREATE=5,e.TYPE_LABA=6,e}(ActivityBaseData);__reflect(ActivityType7Data.prototype,"ActivityType7Data"),window.ActivityType7Data=ActivityType7Data;var ActivityType9Data=function(t){function e(e){var i=t.call(this,e)||this;return i.indexsEx=[],i.update(e),i}return __extends(e,t),e.prototype.getIns=function(){var t;return t=this.activityType==ActivityType.Personal?PActivity.ins():Activity.ins()},e.prototype.update=function(t){this.record=t.readInt(),this.count=t.readInt();var e=t.readByte();this.indexs=[];for(var i=0;e>i;i++)this.indexs.push(t.readByte());this.indexs.length&&(this.indexsEx=this.indexs),e=t.readByte(),this.noticeArr=[];for(var i=0;e>i;i++)this.noticeArr.push({name:t.readString(),itemId:t.readUnsignedInt()});this.noticeArr.reverse()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return this.getIns().getType9RedPoint(this.id)},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getLastTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3);return e},e.prototype.getStateByIndex=function(t){var e=this.record>>t&1;return e},e}(ActivityBaseData);__reflect(ActivityType9Data.prototype,"ActivityType9Data"),window.ActivityType9Data=ActivityType9Data;var TipsItem=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="TipsSkin",e.lab.stroke=1,e.lab.strokeColor=0,e}return __extends(e,t),e.prototype.setIndex=function(t){this.index=t},Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width,this.bg.visible=!1,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1,this.addToEvent||(this.addToEvent=!0,Timer.start(1200,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),e.prototype.removeFromParent=function(){this.addToEvent=!1,DisplayUtils.removeFromParent(this),egret.Tween.removeTweens(this),ObjectPool.push(this)},e}(BaseView);__reflect(TipsItem.prototype,"TipsItem"),window.TipsItem=TipsItem;var ComActivityWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.selectIndex=0,e._sn_="",e.isTopLevel=!0,e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!LocationProperty.isIosTS},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.addTouchEvent(this,this.onTouch),this.curPageSytle=t[0],this.updateView(),this.addTouchEvent(this,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(BagCT.ins().postItemAdd,this.refushRedPoint),this.observe(BagCT.ins().postItemChange,this.refushRedPoint),this.observe(BagCT.ins().postItemDel,this.refushRedPoint),this.menuList&&(this.menuList.itemRenderer=ComActivityBtnRenderer,this.addChangeEvent(this.menuList,this.onClickMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange)),this.selectIndex=0,t&&t.length){var i=t[0],n=0;for(var s in this._datas){if(t[1]&&this._datas[s].id==t[1]){this.selectIndex=n;break}if(this._datas[s].id==i){this.selectIndex=n;break}n++}}SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex].open&&this.activityPanelList[this.selectIndex].open(),this.menuList&&(this.menuList.selectedIndex=this.selectIndex),this.viewStack.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.onChange()},e.prototype.removeDisplay=function(){this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close&&this.activityPanelList[this.selectIndex].close()},e.prototype.updateView=function(){this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];var t=Activity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==this.curPageSytle&&i.isOpenActivity()&&!i.getHide()){var n=Activity.ins().getbtnInfo(e);n||(n=new ActivityBtnConfig,n.id=i.id,n.activityType=i.activityType),this._datas.push(n)}}this._datas.sort(this.sort);var s=0;for(var e in this._datas){var o=this._datas[e].id,a=ActivityPanel.create(o,this._datas[e].activityType);a&&(a.top=0,a.left=0,a.bottom=0,a.right=0,this.activityPanelList[s]=a,this.viewStack.addChild(this.activityPanelList[s]),s++)}this.dataArr=new eui.ArrayCollection(this._datas),this.menuList&&(this.menuList.dataProvider=this.dataArr)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.onChange();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.onChange();break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.onChange=function(){if(this.menuList&&this.leftBtn){this.menuList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>88*(this.menuList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.leftRed.visible=this.rightRed.visible=!1;var t=this.menuList.dataProvider.length;if(5>=t)this.leftBtn.visible=!1,this.rightBtn.visible=!1;else{var e=Math.floor(this.menuList.scrollH/82)+4;if(this.leftBtn.visible)for(var i=0;e-5>=i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.leftRed.visible=!0;break}if(this.rightBtn.visible)for(var i=e+1;t>i;i++)if(Activity.ins().getActivityDataById(this._datas[i].id).canReward()){this.rightRed.visible=!0;break}}}},e.prototype.onClickMenu=function(t){this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close&&this.activityPanelList[this.selectIndex].close(),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].open&&this.activityPanelList[this.selectIndex].open(),this.viewStack.selectedIndex=this.selectIndex,this.menuList.selectedIndex=this.selectIndex,Activity.ins().setPalyEffListById(this.activityPanelList[this.selectIndex].activityID,!0),this.refushRedPoint())},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this._datas),this.menuList&&(this.menuList.dataProvider=this.dataArr)},__decorate([callLater],e.prototype,"refushRedPoint",null),e}(BaseEuiView);__reflect(ComActivityWin.prototype,"ComActivityWin"),window.ComActivityWin=ComActivityWin,ViewManager.ins().reg(ComActivityWin,LayerManager.UI_Main);var OSATarget0Panel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getClsStr=function(t){var e={1:"OSATarget0Panel1",2:"OSATarget0Panel2",3:"OSATarget0Panel3",4:"OSA3HeroesPanel",5:"HefuXunbaoPanel",6:"HefuAncientBossPanel",7:"HefuLCZBPanel",8:"OSATarget0Panel8",9:"OSATarget0Panel9",10:"OSATarget0Panel10",11:"OSATarget0Panel4",12:"OSATarget0Panel5",13:"BossRevelryPanel"};return e[t.showType]||"OSATarget0Panel1"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.cruPanel&&(this.cruPanel.close&&this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),!this.cruPanel||this.cruPanel.activityID!=this.activityID){var i=GlobalConfig.ActivityBtnConfig[this.activityID],n=egret.getDefinitionByName(this.getClsStr(i));this.cruPanel=new n(this.activityID),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID}this.cruPanel.open&&this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget0Panel.prototype,"OSATarget0Panel"),window.OSATarget0Panel=OSATarget0Panel;var OSATarget0Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42Recharge",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.content.useVirtualLayout=!0,this.content.itemRenderer=OSATargetDays42ItemRender,this.bigReward.itemRenderer=OSATargetDays42ItemRender2},e.prototype.open=function(){this.content.dataProvider?this.updateData():this.updateList(),this.observe(Recharge.ins().postRechargeTotalDay,this.updateData)},e.prototype.updateList=function(){var t=[],e=[],i=new RewardData;i.count=0,i.id=2,i.type=0;var n={id:999,awardList:[i],sum:0};e.push(n);var s=new RewardData;s.count=0,s.id=401612,s.type=1;var o={id:999,awardList:[s],sum:0};e.push(o);var a=Recharge.ins().getRechargeList();for(var r in a){var l=a[r];t.push(l),n.sum||(n.sum=l.sum),i.id=l.awardList[0].id,i.type=l.awardList[0].type,i.count+=l.awardList[0].count,o.sum||(o.sum=l.sum),l.awardList[1]&&401612==l.awardList[1].id&&(s.id=l.awardList[1].id,s.type=l.awardList[1].type,s.count+=l.awardList[1].count),1==l.bigReward&&e.push(l)}t.sort(this.sort),e.sort(this.sort2),this.content.dataProvider=new eui.ArrayCollection(t.splice(0,4)),this.delayUpdate(t),this.bigReward.dataProvider=new eui.ArrayCollection(e);var h=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=h.acDesc,this.title.source=h.title},e.prototype.delayUpdate=function(t){var e=this.content.dataProvider;e.addItem(t.shift()),t.length&&this.delayUpdate(t)},e.prototype.sort=function(t,e){var i=Recharge.ins().rechargeTotal.hasGetDays,n=i.indexOf(t.id),s=i.indexOf(e.id);return n>=0&&0>s?1:0>n&&s>=0?-1:Algorithm.sortAsc(t.id,e.id)},e.prototype.sort2=function(t,e){return Algorithm.sortDesc(t.id,e.id)},e.prototype.close=function(){this.removeObserve()},e.prototype.updateData=function(){var t=this.content.dataProvider;t.source.sort(this.sort);for(var e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e));t=this.bigReward.dataProvider;for(var e=0;e<t.length;e++)t.itemUpdated(t.getItemAt(e))},__decorate([callLater],e.prototype,"delayUpdate",null),e}(BaseView);__reflect(OSATarget0Panel2.prototype,"OSATarget0Panel2"),window.OSATarget0Panel2=OSATarget0Panel2;var OSATarget29RankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="NumberPlayItemSkin",e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof RankDataLuckyNum){var t=["零","一","二","三"];if(this.rank.text=this.data.pos<4?t[this.data.pos]+"等奖":"参与奖",this.eName.text=this.data.name,null!=this.data.actId){var e=GlobalConfig.ActivityType29Config[this.data.actId];e&&(this.data.pos<4?this.reward.dataProvider=new eui.ArrayCollection(e.rankReward[this.data.pos-1]):this.reward.dataProvider=new eui.ArrayCollection(e.joinReward))}}},e}(BaseItemRender);__reflect(OSATarget29RankItemRender.prototype,"OSATarget29RankItemRender"),window.OSATarget29RankItemRender=OSATarget29RankItemRender;var OSATarget3BigRewardItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.setData(t.Id,t.index),this.setSelect(this.selected)}},e.prototype.setData=function(t,e){this.reward.touchEnabled=!1;var i=GlobalConfig.ActivityType3Config[t][e],n=Activity.ins().getActivityDataById(t);this.days.text=""+(1==i.type?"连充":"累充")+n.dabiao[e-1]+"/"+i.day+"天",this.reward.data=i.rewards[0],this.reward.isShowName(!1),this.state.visible=1==(n.recrod>>e&1),this.redPoint.visible=!this.state.visible&&n.dabiao[e-1]>=i.day},e.prototype.setSelect=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(OSATarget3BigRewardItemRender.prototype,"OSATarget3BigRewardItemRender"),window.OSATarget3BigRewardItemRender=OSATarget3BigRewardItemRender;var WorldBossRankItemData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.roleName=t.readString(),this.value=t.readDouble()},t.prototype.parser1=function(t){this.roleName=t.readString(),this.value=t.readInt()},Object.defineProperty(t.prototype,"name",{get:function(){var t=this.roleName+":"+CommonUtils.overLength(this.value);return t},enumerable:!0,configurable:!0}),t}();__reflect(WorldBossRankItemData.prototype,"WorldBossRankItemData"),window.WorldBossRankItemData=WorldBossRankItemData;var EntityModel=function(t){function e(){var e=t.call(this)||this;return e.isElite=!1,e.attributeData=[],e.attributeExData=[],e.killNum=0,e.isMy=!1,e.weaponsId=0,e.isWander=!1,e.lyMarkLv=0,e.lyMarkSkills=[],e.isClient=!1,e.changeNum=0,e.type=EntityType.Monster,e}return __extends(e,t),e.prototype.parser=function(t){if(this.parserBase(t),this.type!=EntityType.CollectionMonst){this.parserAtt(t);for(var e=t.readShort(),i=0;e>i;i++)t.readInt();this.parserLyMark(t)}},e.prototype.parserLyMark=function(t){this.lyMarkLv=t.readShort(),this.lyMarkSkills=[];var e=t.readByte();this.lyMarkSkills.length=e;for(var i=0;e>i;i++)this.lyMarkSkills[i]=t.readShort()},e.prototype.parserBase=function(t){this.type=t.readShort(),this.handle=t.readDouble(),this.configID=t.readInt();var e=GlobalConfig.MonstersConfig[this.configID];e&&(this.effect=e.effect),this.masterHandle=t.readDouble(),this.x=t.readInt(),this.y=t.readInt()},Object.defineProperty(e.prototype,"masterHandle",{get:function(){return this._masterHandle},set:function(t){this._masterHandle=t,this.isMy=this.checkHandleIsMy(t)},enumerable:!0,configurable:!0}),e.prototype.checkHandleIsMy=function(t){if(t==Actor.handle)return!0;for(var e=SubRoles.ins().roles,i=0,n=e;i<n.length;i++){var s=n[i];if(s.handle==t)return!0}return!1},e.prototype.parserAtt=function(t,e){void 0===e&&(e=!1);for(var i=t.readShort(),n=0;i>n;n++){var s=0==n||2==n?this.changeNum?this.changeNum:0:this.getAtt(n);this.setAtt(n,t.readDouble());var o=0!=n&&2!=n||0!=s?this.getAtt(n)-s:0;if(e&&-1==AttributeData.FILTER_BASE_DATA_ID.lastIndexOf(n)){if(0>=o)continue;if(2>n||n>6){var a=o>0?"35e62d":"f3311e",r=new AttributeData(n,o);if(!AttributeData.getAttrStrByType(r.type))continue;var l="|C:0x"+a+"&T:"+AttributeData.getAttStrByType(r,0)+"|";GodWeaponCC.ins().gwshowTips||n==AttributeType.atMp||n==AttributeType.atAttackSpeedPower||TipsCT.ins().showTips(l);continue}TipsCT.ins().showAttrTips(n,o)}}},e.prototype.parserExtAtt=function(t,e){void 0===e&&(e=!1);for(var i=t.readShort(),n=0;i>n;n++){var s=this.getExAtt(n);if(this.setExAtt(n,t.readInt()),e&&s!=this.getExAtt(n)&&-1==AttributeData.FILTER_EXTDATA_ID.lastIndexOf(n)){var o=this.getExAtt(n)-s;if(0>=o)continue;var a=o>0?"35e62d":"f3311e",r=new AttributeData(n,o),l="|C:0x"+a+"&T:"+AttributeData.getExtAttStrByType(r,0)+"|";TipsCT.ins().showTips(l)}}},e.prototype.getAtt=function(t){return this.attributeData[t]||0},e.prototype.setAtt=function(t,e){(2==t||0==t&&this.attributeData[t]!=e)&&(this.changeNum=this.attributeData[t]),this.attributeData[t]=e},e.prototype.getExAtt=function(t){return this.attributeExData[t]||0},e.prototype.setExAtt=function(t,e){this.attributeExData[t]=e},Object.defineProperty(e.prototype,"avatarFileName",{get:function(){return this.avatar.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weaponFileName",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatar",{get:function(){return this._avatar||GlobalConfig.MonstersConfig[this.configID].avatar},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name||GlobalConfig.MonstersConfig[this.configID].name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),e.prototype.getServerName=function(){return this._servShowId},e.prototype.getNameWithServer=function(){return this._servShowId&&KFServerSys.ins().isKF?this.name+("S"+this._servShowId):this.name},e.prototype.getDir=function(){var t=GlobalConfig.MonstersConfig[this.configID];if(!t)return-1;var e=GlobalConfig.MonstersConfig[this.configID].dir;return isNaN(e)?-1:e},Object.defineProperty(e.prototype,"dirNum",{get:function(){var t=GlobalConfig.MonstersConfig[this.configID];return t&&(this._dirNum=0/0,t.dirNum)?t.dirNum:this._dirNum?this._dirNum:2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"avatarScale",{get:function(){var t=this._scale||GlobalConfig.MonstersConfig[this.configID].scale;return t?t/100:1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movePara",{get:function(){return GlobalConfig.YouDangConfig[this.wandertime]&&this.wanderrange?[this.wanderrange,GlobalConfig.YouDangConfig[this.wandertime].fileName]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return GlobalConfig.MonstersConfig[this.configID].level},set:function(t){this._lv=t},enumerable:!0,configurable:!0}),e.prototype.setPos=function(t,e){this.x=t,this.y=e},e}(NpcModel);__reflect(EntityModel.prototype,"EntityModel"),window.EntityModel=EntityModel;var WorldBossHeadRender=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isAddEff=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.haveGuildName(!1),this.isAddEff=!1;var t=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(t&&t instanceof CharRole&&!t.isMy){var e=t.infoModel;Guild.ins().guildID&&e.guildID==Guild.ins().guildID&&!this.checkBqPd()&&GameMap.fbType!=FbCT.FB_TYPE_Legend?this.sameHanghui.visible=!0:this.sameHanghui.visible=!1}else this.sameHanghui.visible=!1;if(this.data instanceof CharMonster)this.currentState="war",this.updateChar(this.data);else if(isNaN(this.data))this.data instanceof SelectInfoData&&(this.currentState="panel",this.num.textFlow=(new egret.HtmlTextParser).parser(this.data.num+"份"),this.roleName.textFlow=(new egret.HtmlTextParser).parser(this.data.data.name),this.roleHead.source="yuanhead"+this.data.data.job+this.data.data.sex);else if(this.currentState="war",this.data){var i=EntityManager.ins().getEntityByHandle(this.data)||EntityManager.ins().getEntityBymasterhHandle(this.data);if(i)this.updateChar(i);else if(KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle==this.data){var n=GlobalConfig.MonstersConfig[GlobalConfig.CrossBossBase.flagId];if(n&&this.checkMonHead(n)){var s=KFBossSys.ins().flagCD-egret.getTimer(),o=DateUtils.getFormatBySecond(s/1e3);0>=s?(o="",this.haveGuildName(!1)):this.haveGuildName(!0);var a=n.name+"\n|C:"+ColorUtil.RED+"&T:"+o+"|";this.roleName.textFlow=TextFlowMaker.generateTextFlow1(a),this.roleHead.source="monhead"+n.head+"_png",this.addAttEffect()}}else if(KfArenaSys.ins().isKFArena&&KfArenaSys.ins().flagHandle==this.data){var n=GlobalConfig.MonstersConfig[GlobalConfig.CrossArenaBase.flagBossId];if(n&&this.checkMonHead(n)){var s=KfArenaSys.ins().flagCD-egret.getTimer(),o="|C:"+ColorUtil.RED+"&T:"+DateUtils.getFormatBySecond(s/1e3)+"|";0>=s?KfArenaSys.ins().firstCollect?(o="",this.haveGuildName(!1)):(o="|C:"+ColorUtil.GREEN+"&T:(首采翻倍)|",this.haveGuildName(!0)):this.haveGuildName(!0);var a=n.name+"\n"+o;this.roleName.textFlow=TextFlowMaker.generateTextFlow1(a),this.roleHead.source="monhead"+n.head+"_png",this.addAttEffect()}}}else{var r=GlobalConfig.MonstersConfig[BossCT.ins().monsterID];r&&this.checkMonHead(r)&&(this.roleName.textFlow=(new egret.HtmlTextParser).parser(r.name),this.roleHead.source="monhead"+r.head+"_png",this.addAttEffect())}this.isAddEff||this.removeAttEffect()},e.prototype.checkBqPd=function(){return 7003==GameMap.mapID||7004==GameMap.mapID||5211==GameMap.mapID||5212==GameMap.mapID||5213==GameMap.mapID||5214==GameMap.mapID?!0:!1},e.prototype.checkMonHead=function(t){return Assert(t.head,"怪物头像不存在，id:"+t.id+",name:"+t.name+",fbType:"+GameMap.fbType+",fbId:"+GameMap.fubenID+",last:"+GameMap.lastFbTyp+","+GameMap.lastFbId+",parent:"+(this.parent&&this.parent.name))?!1:!0},e.prototype.updateChar=function(t){if(t instanceof CharRole){var e=t.infoModel;if(GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS){var i=e.name;if(e.type==EntityType.LadderPlayer){var n=i.split("\n");i=n[1]?n[1]:n[0],i=StringUtils.replaceStr(i,"0xffffff",this.roleName.textColor+"")}this.roleName.textFlow=TextFlowMaker.generateTextFlow1(i)}else{var s=e.guildName?"\n|C:0x6495ed&T:"+e.guildName+"|":"",o=DevildomSys.ins().isDevildomBattle&&s?e.name+s:e.getNameWithServer2();o.indexOf("\n")>-1&&this.haveGuildName(!0),this.roleName.textFlow=TextFlowMaker.generateTextFlow1(o)}if(Assert(e.job,"任务职业不存在，id:"+e.configID+",name:"+e.name))return;this.roleHead.source="yuanhead"+e.job+e.sex,this.checkIsCurrAttack(e.handle)&&this.addAttEffect()}else{var a=t;if(a.infoModel.type==EntityType.Monster||KFBossSys.ins().isKFBossBattle&&a.infoModel.type==EntityType.CollectionMonst){var r=GlobalConfig.MonstersConfig[a.infoModel.configID];if(Assert(r,"怪物配置找不到 id:"+a.infoModel.configID))return;if(!this.checkMonHead(r))return;this.roleName.textFlow=(new egret.HtmlTextParser).parser(r.name),this.roleHead.source="monhead"+r.head+"_png",this.checkIsCurrAttack(a.infoModel.handle)&&this.addAttEffect()}}},e.prototype.checkIsCurrAttack=function(t){var e=EntityManager.ins().getRootMasterHandle(GameLogic.ins().currAttackHandle);return e==EntityManager.ins().getRootMasterHandle(t)},e.prototype.addAttEffect=function(){t.prototype.addAttEffect.call(this),this.isAddEff=!0},e}(GuildWarMemberHeadRender);__reflect(WorldBossHeadRender.prototype,"WorldBossHeadRender"),window.WorldBossHeadRender=WorldBossHeadRender;var ChatDataBase=function(){function t(){}return t}();__reflect(ChatDataBase.prototype,"ChatDataBase"),window.ChatDataBase=ChatDataBase;var DartCarItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoCarriageSkin",e.mc=new MovieClip,e.eMcGroup.addChild(e.mc),e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){if(!this.data)return this.eCarGroup.visible=!1,void this.mc.stop();this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),MessageCenter.addListener(CrossDartCT.ins().postUpdateCar,this.updateInfo,this);var t=this.data;this.eCarGroup.x=10*Math.random()*(Math.random()>.5?1:-1),this.eCarGroup.y=50*Math.random(),this.eCarGroup.visible=!0,this.mc.playFile(RES_DIR_EFF+("biaoche0"+t.carLv),-1,null,!1),this.updateInfo()},e.prototype.updateInfo=function(){if(!this.data)return this.eCarGroup.visible=!1,void this.mc.stop();var t=this.data;this.eLab.text=t.carLv+"级镖车",this.eLab.textColor=CrossDartCT.getCarColor(t.carLv),this.eLabGuild.text=t.serverID+"区  "+t.guildName,this.eLabPeople.text="镖师:"+t.hasNum+"/"+t.totalNum,this.eTimes.text="可击破:"+t.canPlunderNum+"次"},e.prototype.onRmove=function(){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),MessageCenter.ins().removeAll(this)},e}(BaseItemRender);__reflect(DartCarItem.prototype,"DartCarItem"),window.DartCarItem=DartCarItem;var FbCT=function(t){function e(){var e=t.call(this)||this;return e.fbModel={},e._groupID=1,e._guanqiaID=-1,e.rewards=[],e.eliteRewards=[],e.maxLen=0,e.guanqiaReward=0,e.worldReward=0,e.worldGuanQias=[],e.worldGuanQiaHasReceive=[],e.currentEnergy=0,e.canChallengGuanQia=!0,e.encounterPos=[],e.expMonterCount=0,e.expMonterCountKill=0,e.isQuite=!0,e.guideBossKill=0,e.showAni=!0,e.showAutoPk=-1,e.showAutoPk2=-1,e.firstAutoGuilder=!1,e.fbExpTotal=0,e.tfRoomID=0,e.tfPassID=0,e._tfInviteTime=0,e.showTfRed=!0,e.fbRings={buyTime:0,challengeTime:0,canTakeAwardId:0},e.guanqiaMonster=[],e.fbConfig={},e.mijingFingfen=4,e.mijingUseTime=0,e.fbFirstLogs={},e.pkGqboss=!1,e.canClick=!0,e.exp=0,e.fbDataList=[],e.initPos=!0,e.sysId=PackageID.Guanqia,e.regNetMsg(4,e.doRoleAllDie),e.regNetMsg(10,e.postFbInfoInit),e.regNetMsg(11,e.postUpDataInfo),e.regNetMsg(13,e.postFbTime),e.regNetMsg(14,e.doBossBoxNum),e.regNetMsg(16,e.postFbExpInfo),e.regNetMsg(17,e.postFbExpTotal),e.regNetMsg(18,e.doGuideFbAliveTime),e.regNetMsg(21,e.postFbRingInfo),e.regNetMsg(1,e.postGuanqiaInfo),e.regNetMsg(2,e.doWaveData),e.regNetMsg(3,e.doBossResult),e.regNetMsg(5,e.doGuanqiaReward),e.regNetMsg(6,e.doGuanqiaWroldReward),e.regNetMsg(12,e.doOfflineReward),e.regNetMsg(24,e.postGuardLeftTime),e.regNetMsg(25,e.postGuardInfo),e.regNetMsg(27,e.postGuardUseSkill),e.regNetMsg(28,e.postGuardCopyInfo),e.regNetMsg(29,e.postBossDrop),e.regNetMsg(30,e.postCreateTFRoomSuccess),e.regNetMsg(31,e.postEnterTFRoomSuccess),e.regNetMsg(32,e.exitTFRoom),e.regNetMsg(33,e.postFTRoomChange),e.regNetMsg(34,e.postFTRoomPassInfo),e.regNetMsg(35,e.doTeamFuBenEnd),e.regNetMsg(36,e.doTeamFuBenRelive),e.regNetMsg(37,e.postTeamFuBenRank),e.regNetMsg(38,e.postTeamFbFlowarRecords),e.regNetMsg(39,e.teamFbSysInviteInfo),e.regNetMsg(40,e.postGuardWeaponLogs),e.regNetMsg(43,e.postFbChat),e.regNetMsg(46,e.monsterDrop),e.regNetMsg(47,e.postFbLog),e.observe(GameLogic.ins().postEnterMap,e.onChangeScene),e.observe(GameLogic.ins().postHpChange,e.recordKill),e.observe(GameLogic.ins().postExpMc,e.postAddEnergy),e}return __extends(e,t),Object.defineProperty(e.prototype,"rCount",{get:function(){return this.fbConfig.rCount||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"goldEff",{get:function(){return this.fbConfig.goldEff||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"expEff",{get:function(){return this.fbConfig.expEff||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zyPos",{get:function(){return this.fbConfig.zyPos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"energy",{get:function(){return this.fbConfig.energy||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveEnergy",{get:function(){return this.fbConfig.waveEnergy||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveMonsterCount",{get:function(){return this.fbConfig.waveMonsterCount||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"waveMonsterId",{get:function(){return this.fbConfig.waveMonsterId||[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outPos",{get:function(){return this.fbConfig.outPos||{x:0,y:0,a:0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rPos",{get:function(){return this.fbConfig.rPos||[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eliteMonsterId",{get:function(){return this.fbConfig.eliteMonsterId||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wanderpercent",{get:function(){return void 0==this.fbConfig.wanderpercent?5e3:this.fbConfig.wanderpercent},enumerable:!0,configurable:!0}),e.prototype.getBossDrop=function(t,e){var i=this.getBytes(29);i.writeByte(t),i.writeDouble(e),this.sendToServer(i)},e.prototype.postTeamFuBenRank=function(t){this.tfPassRanks=[];for(var e,i,n=t.readByte(),s=0;n>s;s++){e={configID:t.readInt(),members:[]},i=t.readByte();for(var o=0;i>o;o++)e.members.push({position:t.readByte(),roleName:t.readString()});this.tfPassRanks.push(e)}},e.prototype.postGuardLeftTime=function(t){GuardWeaponModel.ins().leftTime=t.readUnsignedInt()},e.prototype.challengeGuard=function(){var t=this.getBytes(24);this.sendToServer(t)},e.prototype.callGuardBoss=function(){var t=this.getBytes(26);this.sendToServer(t)},e.prototype.guardUseSkill=function(t){var e=this.getBytes(27);e.writeByte(t),this.sendToServer(e)},e.prototype.postGuardInfo=function(t){var e=t.readByte();GuardWeaponModel.ins().challengeTimes=e,GuardWeaponModel.ins().isShowSweep=1==t.readByte()},e.prototype.postGuardUseSkill=function(t){return t.readByte()},e.prototype.postGuardCopyInfo=function(t){var e=GuardWeaponModel.ins().guardCopyInfo||new GuardCopyInfo;e.parser(t.readByte(),t.readInt(),t.readByte(),t.readInt(),t.readByte(),t.readInt()),GuardWeaponModel.ins().guardCopyInfo=e},e.prototype.recordKill=function(t){var e=t[0],i=t[1];e instanceof CharRole||0>=i&&(this.expMonterCountKill+=1)},e.prototype.initLogin=function(){this.fbDataList.length=0;for(var t in GlobalConfig.DailyFubenConfig){var e=GlobalConfig.DailyFubenConfig[t];e.bossId||this.fbDataList.push(e.id)}},e.ins=function(){return t.ins.call(this)},e.prototype.onChangeScene=function(){this.rewards=[],this.eliteRewards=[],this.expMonterCountKill=0,this.expMonterCount=0,this.chatCampDtList||(this.chatCampDtList=new eui.ArrayCollection),this.chatCampDtList.removeAll(),this.tfRoomID||ViewManager.ins().close(TeamFbRoomWin),ViewManager.ins().close(TeamFbResultWin),GameMap.fbType==e.FB_TEAM?ViewManager.ins().open(TeamFbFightWin):ViewManager.ins().close(TeamFbFightWin),GameMap.fbType==e.FB_TYPE_XMHJ?ViewManager.ins().open(XinMoFbUI):ViewManager.ins().close(XinMoFbUI),GameMap.fbType==e.FB_TYPE_SPIRIT?ViewManager.ins().open(SpiritBossUI):ViewManager.ins().close(SpiritBossUI),GameMap.fbType==e.FB_TYPE_Legend?ViewManager.ins().open(LegendTowerUI):ViewManager.ins().close(LegendTowerUI),GameMap.fbType==e.FB_TYPE_RAREANIMAL?ViewManager.ins().open(RareAnimalFbUI):ViewManager.ins().close(RareAnimalFbUI)},e.prototype.getFbDataById=function(t){return this.fbModel[t]},e.prototype.autoPk=function(){var t=this;if(GameMap.sceneInMain()&&this.canClick)return Encounter.ins().isEncounter()?void TipsCT.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|"):void(SubRoles.lookAtTar&&(RoleAI.ins().stop(),RoleAI.ins().clearAIList(),this.postPlayWarm(1),this.sendPKBoss(),this.canClick=!1,Timer.start(1e3,1,function(){t.canClick=!0},this),this.pkGqboss=!0))},e.prototype.postAddEnergy=function(){this.currentEnergy+=Math.ceil(this.waveEnergy/this.waveMonsterCount),this.currentEnergy>this.energy&&(this.currentEnergy=this.energy)},e.prototype.postPlayWarm=function(t){return t},e.prototype.hasCount=function(){for(var t in GlobalConfig.DailyFubenConfig){var e=GlobalConfig.DailyFubenConfig[t],i=this.fbModel[e.id];if(i&&!e.bossId){var n=this.fbModel[i.fbID].getCount();if(n>0)return!0;if(DieGuide.ins().dieFbRedPoint(this.fbModel[i.fbID].getResetCount(),e.id))return!0}}return!1},e.prototype.doRoleAllDie=function(t){ResultManager.ins().create(GameMap.fbType,0)},e.prototype.postFbInfoInit=function(t){for(var e,i=t.readShort(),n=0;i>n;n++)e=new FbModel,e.parser(t),this.fbModel[e.fbID]=e},e.prototype.sendCallBossPlay=function(t){var e=this.getBytes(12);
e.writeInt(t),this.sendToServer(e)},e.prototype.sendChallenge=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.postUpDataInfo=function(t){var e=t.readInt();t.position-=4,this.fbModel[e].parser(t)},e.prototype.sendAddCount=function(t,e){void 0===e&&(e=0);var i=this.getBytes(11);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postFbTime=function(t){return this.curFbID=t.readInt(),this.curFbLeftTime=t.readInt(),[this.curFbID,this.curFbLeftTime]},e.prototype.doBossBoxNum=function(t){this.bossCallNum=t.readShort()},e.prototype.postFbExpInfo=function(t){return this.fbExp=this.fbExp||{},this.fbExp.useTime=t.readByte(),this.fbExp.sdTime=t.readByte(),this.fbExp.cid=t.readByte(),this.fbExp.sid=t.readByte(),this.fbExp.hasGetFree=1==t.readByte(),this.fbExp},e.prototype.postFbExpTotal=function(t){return this.fbExpTotal=t.readInt(),this.fbExpTotal},e.prototype.fbExpRed=function(){var t=CommonUtils.getObjectLength(GlobalConfig.ExpConfig);return Actor.level>=t?!1:Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv&&(this.fbExp.useTime<GlobalConfig.ExpFubenBaseConfig.freeCount+(GlobalConfig.ExpFubenBaseConfig.vipCount[Actor.vip]||0)||this.fbExp.cid||this.fbExp.sid)?!0:!1},e.prototype.sendIntoGuideFb=function(t){var e=this.getBytes(18);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGuideFbAttacker=function(){this.sendBaseProto(19)},e.prototype.sendGuideFbAlive=function(){this.sendBaseProto(20)},e.prototype.doGuideFbAliveTime=function(t){BossCT.ins().postRemainTime(t)},e.prototype.postFbRingInfo=function(t){this.fbRings.buyTime=t.readShort(),this.fbRings.challengeTime=t.readShort(),this.fbRings.canTakeAwardId=t.readShort()},e.prototype.sendRingSweep=function(t,e){var i=this.getBytes(41);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendShSweep=function(t){var e=this.getBytes(42);e.writeByte(t),this.sendToServer(e)},Object.defineProperty(e.prototype,"guanqiaID",{get:function(){return this._guanqiaID},set:function(t){if(this._guanqiaID!=t){this._guanqiaID=t,this.bossIsChallenged=!1;for(var e in GlobalConfig.WorldRewardConfig)if(this._guanqiaID<=GlobalConfig.WorldRewardConfig[e].needLevel){this._groupID=GlobalConfig.WorldRewardConfig[e].groupId;break}this.postGuanKaIdChange()}this.encounterPos=[];for(var i in this.zyPos)this.encounterPos.push(parseInt(i))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupID",{get:function(){return this._groupID},enumerable:!0,configurable:!0}),e.prototype.isReceiveBox=function(t){return-1!=this.worldGuanQias.indexOf(t)},e.prototype.isGetReceiveBox=function(t){return-1!=this.worldGuanQiaHasReceive.indexOf(t)},e.prototype.isShowBossPK=function(){return-1!=this.guanqiaID},e.prototype.getRewardsPop=function(){return this.rewards},e.prototype.getMapReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){if(!this.isGetReceiveBox(t)&&GlobalConfig.WorldRewardConfig[t].needLevel<this.guanqiaID)return void this.sendGuanqiaWroldReward(t);t++}},e.prototype.getCurrentReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var e=GlobalConfig.WorldRewardConfig[t];if(!this.isGetReceiveBox(t)&&this.guanqiaID>e.needLevel&&this.guanqiaID<1e5)return e.rewards;t++}return null},e.prototype.getNextReward=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel)return e.rewards;t++}return null},e.prototype.getNextNeedChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel)return e.needLevel-this.guanqiaID+1;t++}return 0},e.prototype.getDiffChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel){var i=GlobalConfig.WorldRewardConfig[t-1];return e.needLevel-(i?i.needLevel:0)}t++}return 0},e.prototype.getNewChapter=function(){for(var t=1;GlobalConfig.WorldRewardConfig[t];){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel){var i=t-1;return i=i?i:1,GlobalConfig.WorldRewardConfig[i]}t++}return null},e.prototype.getChipByGuanQia=function(){for(var t in GlobalConfig.WorldRewardConfig){var e=GlobalConfig.WorldRewardConfig[t];if(this.guanqiaID<=e.needLevel)return e.rewards[0].id}return 0},e.prototype.postGuanqiaInfo=function(t){var i=this.guanqiaID;if(this.guanqiaID=t.readInt(),this.firstAutoGuilder&&this.guanqiaID==e.AUTO_GUANQIA&&(this.firstAutoGuilder=!1,this.setAutoPk2()),this.goldEffLast=t.readInt(),this.expEffLast=t.readInt(),this.fbConfig=JSON.parse(t.readString()),-1!=i&&this.guanqiaID!=i&&(this.currentEnergy=0,ViewManager.ins().open(EffectivenessTip)),this.guanqiaMonster=JSON.parse(t.readString()),0==GameMap.fubenID){if(this.guanqiaID>1e5){var n=SubRoles.lookAtTar;n&&RoleAI.ins().remove(n)}else GameLogic.ins().createGuanqiaMonster();RoleAI.ins().start()}},e.prototype.postGuanKaIdChange=function(){},e.prototype.sendGetReward=function(t){var e=this.getBytes(1);e.writeByte(t?1:0),this.sendToServer(e)},e.prototype.sendPKBoss=function(){var t=this,e=this.getBytes(2),i=SubRoles.lookAtTar;Timer.start(500,1,function(){e.writeInt(Math.floor(i.x)),e.writeInt(Math.floor(i.y)),t.sendToServer(e)},this)},e.prototype.doWaveData=function(t){this.exp=t.readInt();for(var e=t.readInt(),i=[],n=0;e>n;n++){var s=new WaveDropData;s.parser(t),i.push(s)}var o=t.readByte();o>0?(this.eliteRewards.push(i),this.eliteRewards.length>5&&this.eliteRewards.shift(),GameLogic.ins().createGuanqiaMonster(!1,!0)):this.rewards=this.rewards.concat(i)},e.prototype.postBossDrop=function(t){for(var e=this,i=t.readByte(),n=t.readDouble(),s=t.readByte(),o=0;s>o;o++){var a=new RewardData;a.type=t.readInt(),a.id=t.readInt(),a.count=t.readInt(),0==a.type&&1!=a.id&&2!=a.id&&a.id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),a])}DropHelp.start(),Timer.start(600,1,function(){e.getBossDrop(i,n)},this)},e.prototype.tempFunc=function(){var t=SubRoles.lookAtTar;if(!t)return void Timer.stop(this.tempFunc,this);var e=Math.floor(t.x/GameMap.CELL_SIZE),i=Math.floor(t.y/GameMap.CELL_SIZE),n=this.outPos.x,s=this.outPos.y;e==n&&i==s&&(Timer.stop(this.tempFunc,this),GameLogic.ins().removeOutEff(),this.initPos=!1,this.pkGqboss=!1,this.sendExitFb())},e.prototype.sendGetBossReward=function(){this.sendBaseProto(3)},e.prototype.sendExitFb=function(){this.sendBaseProto(4)},e.prototype.sendGetAward=function(){this.sendBaseProto(5)},e.prototype.doGuanqiaReward=function(t){this.guanqiaReward=t.readShort()+1,this.postZhangJieAwardChange(),this.postGuanKaIdChange(),this.postGuanqiaWroldReward()},e.prototype.postZhangJieAwardChange=function(){},e.prototype.sendGuanqiaWroldReward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.doGuanqiaWroldReward=function(t){var e=t.readInt(),i=0,n=0;this.worldGuanQias=[],this.worldGuanQiaHasReceive=[];for(var s=0;e>s;s++)i=t.readInt(),n=s+1,0==i?this.worldGuanQias.push(n):1==i&&this.worldGuanQiaHasReceive.push(n),(0==i||1==i)&&(this.worldReward=n);this.postGuanqiaWroldReward()},e.prototype.postGuanqiaWroldReward=function(){},e.prototype.doOfflineReward=function(t){var e=[];e[0]=t.readInt(),e[1]=t.readInt(),e[2]=t.readInt(),e[3]=t.readInt(),e[4]=t.readInt();for(var i=t.readInt(),n=[],s=0;i>s;s++){var o={};o.type=t.readInt(),o.exp=t.readInt(),o.gold=t.readInt(),n.push(o)}e[5]=n,i=t.readByte();for(var a=[],s=0;i>s;s++){var r={};r.id=t.readByte(),r.count=t.readInt(),a.push(r)}ViewManager.ins().open(OfflineRewardWin,e,a)},e.prototype.getWorldGuanQia=function(){return this.worldGuanQias.length>0?this.worldGuanQias[this.worldGuanQias.length-1]:0},e.prototype.sendKillMonster=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.sendChallengeExpFb=function(){this.sendBaseProto(14)},e.prototype.sendSaodang=function(){var t=this.getBytes(15);this.sendToServer(t)},e.prototype.sendGetAwardMul=function(t,e){var i=this.getBytes(16);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendChallengeFbRing=function(t){var e=this.getBytes(22);e.writeShort(t),this.sendToServer(e)},e.prototype.sendFbRingTakeAward=function(t){var e=this.getBytes(23);e.writeShort(t),this.sendToServer(e)},e.prototype.checkGuanqiaIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.CHALLENGE)},e.prototype.postExpFly=function(t,e,i){return void 0===e&&(e=1),void 0===i&&(i=10),[t,e,i]},e.prototype.getExpFbId=function(){var t=GlobalConfig.ExpFubenConfig,e=Actor.level,i=0;for(var n in t){if(t[n].slv>e)break;i=+n}return i},e.prototype.checkInFB=function(){return GameMap.fbType==e.FB_TYPE_GUANQIABOSS||this.pkGqboss?!1:0==GameMap.fubenID||CityCC.ins().isCity?!1:(TipsCT.ins().showCenterTips("|C:0xf3311e&T:正在挑战副本中，请稍后再试|"),!0)},e.prototype.checkInFB2=function(){var t=this.checkInFB();return t||GameMap.fbType!=e.FB_TYPE_GUANQIABOSS&&!this.pkGqboss?t:(TipsCT.ins().showCenterTips("|C:0xf3311e&T:当前正在挑战关卡中|"),!0)},e.prototype.createMonster=function(t){var i=this.guanqiaMonster[t],n=e.createModel(i);return n.name=i.name,n._avatar=+i.avatar,n._scale=i.scale,n.wanderrange=i.wanderrange,n.wandertime=i.wandertime,n.effect=i.effect,n._dirNum=i.dirNum,n},e.createModel=function(t){var e=new EntityModel;return e.type=EntityType.Monster,e.configID=t.id,e.setAtt(AttributeType.atHp,t.hp),e.setAtt(AttributeType.atMaxHp,t.hp),e.setAtt(AttributeType.atAttack,t.atk),e.setAtt(AttributeType.atDef,t.def),e.setAtt(AttributeType.atRes,t.res),e.setAtt(AttributeType.atCrit,t.crit),e.setAtt(AttributeType.atTough,t.tough),e.setAtt(AttributeType.atMoveSpeed,t.ms||1e3),e.setAtt(AttributeType.atAttackSpeed,t.as||1e3),e.setAtt(AttributeType.atPenetrate,t.penetRate||0),e},e.getPersonalBossFbIds=function(){var t=[];for(var e in GlobalConfig.DailyFubenConfig){var i=GlobalConfig.DailyFubenConfig[e];i&&i.bossId&&t.push(i)}return t.sort(function(t,e){return t.sort<e.sort?-1:1}),t},e.isCanChallenge=function(){for(var t=this.getPersonalBossFbIds(),i=0,n=t;i<n.length;i++){var s=n[i];if(e.ins().getFbDataById(s.id)){var o=e.ins().getFbDataById(s.id).getCount();if(o>0)if(s.monthcard){if(Recharge.ins().monthDay>0)return!0}else if(s.privilege){if(Recharge.ins().getIsForeve())return!0}else if(s.specialCard){if(Recharge.ins().franchise)return!0}else if(s.zsLevel>0){if(ZsCT.ins().lv>=s.zsLevel)return!0}else if(Actor.level>=s.levelLimit)return!0}}return!1},e.prototype.setAutoPk=function(){-1==this.showAutoPk&&(this.showAutoPk=0,this.postAutoPk())},e.prototype.postAutoPk=function(){},e.prototype.setAutoPk2=function(){-1==this.showAutoPk2&&(this.showAutoPk2=0,this.postAutoPk2())},e.prototype.postAutoPk2=function(){},e.prototype.sendCreateTFRoom=function(){var t=this.getBytes(30);this.sendToServer(t)},e.prototype.postCreateTFRoomSuccess=function(t){this.tfRoomID=t.readInt();var e=t.readInt();this.tfRoomID?ViewManager.ins().open(TeamFbRoomWin,1,e,this.tfRoomID):ViewManager.ins().close(TeamFbRoomWin)},e.prototype.sendEnterTFRoom=function(t){var e=this.getBytes(31);e.writeInt(t),this.sendToServer(e)},e.prototype.postEnterTFRoomSuccess=function(t){switch(t.readByte()){case 0:var e=t.readInt();this.tfRoomID=t.readInt(),ViewManager.ins().open(TeamFbRoomWin,1,e,this.tfRoomID);break;case 1:TipsCT.ins().showTips("每周"+DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]]+GlobalConfig.TeamFuBenBaseConfig.closeTime[1]+"后不能挑战");break;case 2:TipsCT.ins().showTips("在副本内不能进入");break;case 3:TipsCT.ins().showTips("已经在别的房间");break;case 4:TipsCT.ins().showTips("要进入的房间不存在");break;case 5:TipsCT.ins().showTips("当前通关的层级不够");break;case 6:TipsCT.ins().showTips("配置错误,不存在该房间配置");break;case 7:TipsCT.ins().showTips("房间已经满人")}},e.prototype.sendExitTFRoom=function(){this.sendBaseProto(32)},e.prototype.exitTFRoom=function(t){switch(t.readByte()){case 1:break;case 2:TipsCT.ins().showTips("您被队长踢出房间");break;case 3:TipsCT.ins().showTips("队长解散了房间")}ViewManager.ins().close(TeamFbRoomWin),this.tfRoomID=0},e.prototype.sendBeginTF=function(){this.sendBaseProto(33)},e.prototype.postFTRoomChange=function(t){this.tfRoomID=t.readInt();var e=t.readByte();this.tfMembers||(this.tfMembers=[]),this.tfMembers.length=e,this.isTFCaptain=!1;for(var i,n=0;e>n;n++)i=this.tfMembers[n],i||(i=new TeamFuBenRoleVo,this.tfMembers[n]=i),i.parse(t),i.roleID==Actor.actorID&&1==i.position&&(this.isTFCaptain=!0)},e.prototype.sendOutTFRoom=function(t){var e=this.getBytes(34);e.writeInt(t),this.sendToServer(e)},e.prototype.sendExitTFFb=function(t){var e=this.getBytes(35);e.writeByte(t),this.sendToServer(e)},e.prototype.postFTRoomPassInfo=function(t){this.tfPassID=t.readInt(),this._tfInviteTime=t.readInt()},e.prototype.getTfInviteCD=function(){return Math.floor((1e3*this._tfInviteTime+1e3*DateUtils.SECOND_2020-GameServer.serverTime)/1e3)},e.prototype.isTeamFBOpen=function(){return ZsCT.ins().lv>=GlobalConfig.TeamFuBenBaseConfig.needZsLv&&GameServer.serverOpenDay+1>=GlobalConfig.TeamFuBenBaseConfig.openDay},e.prototype.doTeamFuBenEnd=function(t){var e=t.readInt(),i=t.readByte(),n=t.readByte(),s=[];s.length=n;for(var o,a=0;n>a;a++)o=new TeamFuBenRoleVo,s[a]=o,o.roleID=t.readInt(),o.position=t.readByte(),o.roleName=t.readString(),o.job=t.readByte(),o.sex=t.readByte();ViewManager.ins().open(TeamFbResultWin,e,i,s)},e.prototype.doTeamFuBenRelive=function(t){BossCT.ins().killerHandler=t.readDouble(),BossCT.ins().reliveTime=t.readInt(),BossCT.ins().reliveTime>0?(BossCT.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.sendTFRank=function(){this.sendBaseProto(36)},e.prototype.doBossResult=function(t){for(var i=this,n=t.readBoolean(),s=t.readShort(),o=t.readShort(),a=[],r=0;o>r;r++){var l=new RewardData;l.parser(t),a.push(l)}if(n){for(var h=SubRoles.ins().subRolesLen,u=void 0,p=0;h>p;p++)u=EntityManager.ins().getMainRole(p),u&&u.resetStand();for(var c=0;c<a.length;c++){var l=a[c];if(0==l.type&&1!=l.id&&2!=l.id&&l.id!=MoneyConst.rune||s==e.FB_TYPE_GUARD_WEAPON||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),l]),1==l.type){var d=GlobalConfig.ItemConfig[l.id],g=ItemUtil.getType(d);if(7==g){var f=new ItemData;f.configID=l.id,TipsCT.ins().showGoodEquipTips(f)}}}var v=function(){GameMap.fbType!=e.FB_TYPE_EXP&&i.sendGetBossReward();var t=null;if((s==e.FB_TYPE_TIAOZHAN&&SkyLevelModel.ins().getIsopenNext||GameMap.fbType==e.FB_TYPE_PERSONAL)&&(t=function(){i.pkGqboss=!1,s==e.FB_TYPE_PERSONAL?ViewManager.ins().open(BossWin,0):i.isQuite&&ViewManager.ins().open(FbWin,1)}),s==e.FB_TYPE_GUIDEBOSS&&4e4==GameMap.fubenID){var n=i.guideBossKill,o=void 0,r=void 0,l=void 0,h=void 0;n?(o=Actor.myName,r=SubRoles.ins().roles[0].job,l=SubRoles.ins().roles[0].sex):(o=i.guideBossPlayerName,r=i.guideBossPlayerJob,l=i.guideBossPlayerSex),h="yuanhead"+r+l,ResultManager.ins().create(s,!0,a,"",null,[n,o,h])}else if(GameMap.fbType==e.FB_TYPE_EXP)Timer.start(800,1,function(){ViewManager.ins().open(ExpFbResultWin)},i);else if(GameMap.fbType==e.FB_TYPE_LIEYAN)Timer.start(800,1,function(){ViewManager.ins().open(FireResultWin,a&&a.length>0?a[0].count:0)},i);else if(GameMap.fbType==e.FB_TYPE_DEMON)Timer.start(800,1,function(){ViewManager.ins().open(DemonCircleResultWin,1,a)},i);else if(GameMap.fbType==e.FB_TYPE_THUNDER)Timer.start(800,1,function(){ViewManager.ins().open(ThunderResultWin,1,a)},i);else if(GameMap.fbType==e.FB_TYPE_MIJING||GameMap.fbType==e.FB_TYPE_LABA);else if(GameMap.fbType==e.FB_TYPE_XUANWU);else if(s!=e.FB_TYPE_GUANQIABOSS)a.length?Timer.start(800,1,function(){ResultManager.ins().create(s,1,a,"获得奖励如下：",t)},i):(i.pkGqboss=!1,i.sendExitFb());else if(i.outPos.x&&i.outPos.y){var u=i.outPos.x*GameMap.CELL_SIZE,p=i.outPos.y*GameMap.CELL_SIZE;i.outPos.hasOwnProperty("a")&&1==i.outPos.a&&GameLogic.ins().addOutEff(u,p);for(var c=SubRoles.ins().subRolesLen,d=0;c>d;d++){var g=EntityManager.ins().getMainRole(d);g&&GameMap.moveEntity(g,u,p)}Timer.start(1e3,0,i.tempFunc,i)}else i.initPos=!0,i.pkGqboss=!1,GameMap.fbType==s&&i.sendExitFb()};DropHelp.addCompleteFunc(v,this),DropHelp.start()}else this.pkGqboss=!1,GameMap.fbType==e.FB_TYPE_GUANQIABOSS&&PlayFun.ins().closeAuto(),ResultManager.ins().create(s,0);GameMap.fbType==e.FB_TYPE_GUANQIABOSS&&Hint.ins().postKillBossEx(this.guanqiaID)},e.prototype.sendTfFlower=function(t,e){var i=this.getBytes(37);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postTeamFbFlowarRecords=function(t){var e=t.readInt();this.tfFlowerRecords||(this.tfFlowerRecords=[]);for(var i=0;e>i;i++)this.tfFlowerRecords.push({roleName:t.readString(),count:t.readInt()});for(;this.tfFlowerRecords.length>10;)this.tfFlowerRecords.shift()},e.prototype.clearTfFlowerRecords=function(){this.tfFlowerRecords=[]},e.prototype.sendTfSysInvite=function(t){var e=this.getBytes(38);e.writeString(t),this.sendToServer(e)},e.prototype.teamFbSysInviteInfo=function(t){ChatCT.ins().postSysChatMsg(new ChatSystemData(3,t.readString()))},e.prototype.checkTFRed=function(){return this.isTeamFBOpen()?this.showTfRed:!1},e.prototype.postShowRedChange=function(t){this.showTfRed=t},e.prototype.sendGuardWeaponLogs=function(){this.sendBaseProto(40)},e.prototype.postGuardWeaponLogs=function(t){for(var e=t.readByte(),i=[],n=0;e>n;n++){var s=t.readInt(),o=t.readString(),a=t.readString(),r=t.readString();i.push({noticeId:s,roleName:o,monsterName:a,itemName:r})}return i},e.prototype.postFbChat=function(t){var e=new ChatCampData;e.readData(t),this.chatCampDtList.addItem(e),ChatCT.ins().postNewChatMsg(e)},e.prototype.sendFbChat=function(t,e){var i=this.getBytes(43);i.writeShort(t),i.writeString(e),this.sendToServer(i)},e.prototype.isFBChatChannle=function(){return KfArenaSys.ins().isKFArena},e.prototype.monsterDrop=function(t){for(var e=(t.readDouble(),t.readByte()),i=0;e>i;i++){var n=new RewardData;n.type=t.readInt(),n.id=t.readInt(),n.count=t.readInt(),0==n.type&&1!=n.id&&2!=n.id&&n.id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),n])}DropHelp.start()},e.prototype.sendFbLog=function(t){var e=this.getBytes(47);e.writeInt(t),this.sendToServer(e)},e.prototype.postFbLog=function(t){this.fbFirstLogs[t.readInt()]=1==t.readByte()},e.ckeckMonthCardBoss=function(t){var i=GlobalConfig.DailyFubenConfig[t];return 1!=i.monthcard?!1:(0==e.ins().fbFirstLogs[i.id]||Recharge.ins().monthDay>0)&&e.ins().getFbDataById(i.id).getCount()>0},e.ckeckSpecialCardBoss=function(t){var i=GlobalConfig.DailyFubenConfig[t];return 1!=i.specialCard?!1:Recharge.ins().franchise>0&&e.ins().getFbDataById(i.id).getCount()>0},e.FB_TYPE_GUANQIABOSS=1,e.FB_TYPE_CITY=20,e.FB_TYPE_TIAOZHAN=9,e.FB_TYPE_ZHUANSHENGBOSS=10,e.FB_TYPE_ALLHUMENBOSS=7,e.FB_TYPE_PERSONAL=6,e.FB_TYPE_HOMEBOSS=17,e.FB_TYPE_MATERIAL=2,e.FB_TYPE_EXP=16,e.FB_TYPE_GUILD_BOSS=15,e.FB_TYPE_GUILD_WAR=14,e.FB_TYPE_MIJING=21,e.FB_ID_JINGYAN=3005,e.FB_ID_MINE=99999,e.FB_TYPE_GUIDEBOSS=18,e.FB_TYPE_NEW_WORLD_BOSS=19,e.FB_TYPE_LIEYAN=23,e.FB_TYPE_GOD_WEAPON=26,e.FB_TYPE_GOD_WEAPON_TOP=27,e.FB_TYPE_PEAKED=30,e.FB_TYPE_DARK_BOSS=36,e.FB_TYPE_HIDE_BOSS=37,e.FB_TYPE_HUN_SHOU=38,e.FB_TEAM=35,e.FB_TYPE_DEMON=41,e.FB_TYPE_STARBOSS=42,e.FB_TYPE_THUNDER=43,e.FB_TYPE_XUANWU=44,e.FB_TYPE_CDBOSS=45,e.FB_TYPE_37BOSS=46,e.FB_TYPE_MOJIAN=50,e.FB_TYPE_SOULS=51,e.FB_TYPE_XMHJ=52,e.FB_TYPE_SPIRIT=53,e.FB_TYPE_Legend=54,e.FB_TYPE_SMYJ=55,e.FB_TYPE_RAREANIMAL=56,e.FB_TYPE_KING=57,e.FB_TYPE_GUILDFB=58,e.FB_TYPE_EXCLUSIVE=61,e.FB_TYPE_ACTIVITY=62,e.FB_TYPE_FIRE_RING=24,e.FB_TYPE_PEAK=30,e.FB_TYPE_GUARD_WEAPON=29,e.FB_TYPE_LABA=31,e.FB_TYPE_KF_BOSS=32,e.FB_TYPE_DEVILDOM_BOSS=39,e.FB_TYPE_KF_ARENA=40,e.FB_TYPE_DARTCAR=47,e.FB_TYPE_KF_BOSS2=48,e.FB_TYPE_CONTEST=49,e.AUTO_GUANQIA=16,e.TEAM_FB_WIN_REFLASH_PANEL="TEAM_FB_WIN_REFLASH_PANEL",e.TF_SIMLPE_HEIGHT=149,e.TF_EXPAND_HEIGHT=298,__decorate([post()],e.prototype,"postTeamFuBenRank",null),__decorate([post()],e.prototype,"postGuardLeftTime",null),__decorate([post()],e.prototype,"postGuardInfo",null),__decorate([post()],e.prototype,"postGuardUseSkill",null),__decorate([post()],e.prototype,"postGuardCopyInfo",null),__decorate([post()],e.prototype,"postAddEnergy",null),__decorate([post()],e.prototype,"postPlayWarm",null),__decorate([post()],e.prototype,"postFbInfoInit",null),__decorate([post()],e.prototype,"postUpDataInfo",null),__decorate([post()],e.prototype,"postFbTime",null),__decorate([post()],e.prototype,"postFbExpInfo",null),__decorate([post()],e.prototype,"postFbExpTotal",null),__decorate([post()],e.prototype,"postFbRingInfo",null),__decorate([post()],e.prototype,"postGuanqiaInfo",null),__decorate([post()],e.prototype,"postGuanKaIdChange",null),__decorate([post()],e.prototype,"postZhangJieAwardChange",null),__decorate([post()],e.prototype,"postGuanqiaWroldReward",null),__decorate([post()],e.prototype,"postExpFly",null),__decorate([post()],e.prototype,"postAutoPk",null),__decorate([post()],e.prototype,"postAutoPk2",null),__decorate([post()],e.prototype,"postCreateTFRoomSuccess",null),__decorate([post()],e.prototype,"postEnterTFRoomSuccess",null),__decorate([post()],e.prototype,"postFTRoomChange",null),__decorate([post()],e.prototype,"postFTRoomPassInfo",null),__decorate([post()],e.prototype,"postTeamFbFlowarRecords",null),__decorate([post()],e.prototype,"postShowRedChange",null),__decorate([post()],e.prototype,"postGuardWeaponLogs",null),__decorate([post()],e.prototype,"postFbChat",null),__decorate([post()],e.prototype,"postFbLog",null),e}(BaseSystem);__reflect(FbCT.prototype,"FbCT"),System.FbCT=function(){return FbCT.ins()},window.FbCT=FbCT;var EquipPos;!function(t){t[t.WEAPON=0]="WEAPON",t[t.HEAD=1]="HEAD",t[t.CLOTHES=2]="CLOTHES",t[t.NECKLACE=3]="NECKLACE",t[t.Wrist=4]="Wrist",t[t.BRACELET=5]="BRACELET",t[t.RING=6]="RING",t[t.SHOE=7]="SHOE",t[t.DZI=8]="DZI",t[t.HAT=9]="HAT",t[t.VIZARD=10]="VIZARD",t[t.CLOAK=11]="CLOAK",t[t.SHIELD=12]="SHIELD",t[t.MAX=13]="MAX"}(EquipPos||(EquipPos={})),window.EquipPos=EquipPos;var FuliActBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",DisplayUtils.removeFromParent(e.mc),e.mc=null,e}return __extends(e,t),e.prototype.dataChanged=function(){this.iconDisplay.source=this.data.icon;var t=!1;switch(this.data.type){case 1:t=DailyCheckIn.ins().showRedPoint();break;case 2:t=Activity.ins().getSevenDayStast();break;case 3:t=Activity.ins().checkNoticeRed();break;case 4:t=!1;break;case 5:t=FangpianRedPoint.ins().redPoint;break;case 6:t=!1;break;case 7:t=Recharge.ins().franchise&&Recharge.ins().franchiseget?!0:!1}t?(this.mc||(this.mc=new MovieClip,this.mc.x=35,this.mc.y=36),this.mc.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.addChild(this.mc)):(DisplayUtils.removeFromParent(this.mc),this.mc=null),this.redPoint.visible=t},e}(BaseItemRender);__reflect(FuliActBtnRenderer.prototype,"FuliActBtnRenderer"),window.FuliActBtnRenderer=FuliActBtnRenderer;var GwFubenView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canSweep=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this._ary=new eui.ArrayCollection,this.checkRank.touchEnabled=!0,this.checkRank.textFlow=(new egret.HtmlTextParser).parser("<u>查看排行</u>"),this.addTouchEvent(this.checkRank,this.touchHandler),this.addTouchEvent(this.challenge,this.touchHandler),this.addTouchEvent(this.sweep,this.touchHandler)},e.prototype.addDisplay=function(){this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView),this.observe(GodWeaponCC.ins().postRankInfo,this.updateRank),this.observe(BagCT.ins().postItemCountChange,this.useToItem),this.list.dataProvider=this._ary,this.list.itemRenderer=GwFubenGridRender,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),GodWeaponCC.ins().requestFubenInfo()},e.prototype.removeDisplay=function(){this._selectData=null},e.prototype.updateView=function(){GodWeaponCC.ins().requestRanInfo(),this._ary.replaceAll(GodWeaponCC.ins().fubenInfoData.listData);var t=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;this.countText.text="今日剩余次数： "+t,this.list.selectedIndex=0,this._selectData=this.list.selectedItem,this.rpImg0.visible=this.rpImg.visible=GodWeaponCC.ins().fubenInfoData.hadChallengeNum>0},e.prototype.updateRank=function(){var t=GodWeaponCC.ins().rankInfoDataAry,e=t.length;this.rank.visible=0!=e;for(var i,n=0;3>n;n++)i=t[n],i?(this.getRankImg(n+1).visible=!0,this.getPlayName(n+1).visible=!0,this.getPlayRank(n+1).visible=!0,this.getPlayTime(n+1).visible=!0,this.getPlayName(n+1).text=i.nameStr,this.getPlayRank(n+1).text=i.floorNum+"层",this.getPlayTime(n+1).text=i.getgetTimeStr()):(this.getPlayName(n+1).visible=!1,this.getPlayRank(n+1).visible=!1,this.getPlayTime(n+1).visible=!1,this.getRankImg(n+1).visible=!1)},e.prototype.useToItem=function(){this._isUser?(this._isUser=!1,this._selectData&&GodWeaponCC.ins().joinFuben(this._selectData.gridNum)):this.canSweep&&(this.canSweep=!1,GodWeaponCC.ins().sendSweepGW())},e.prototype.getRankImg=function(t){return this["rank"+t+"Img"]},e.prototype.getPlayName=function(t){return this["player"+t+"Name"]},e.prototype.getPlayRank=function(t){return this["player"+t+"Rank"]},e.prototype.getPlayTime=function(t){return this["player"+t+"Time"]},e.prototype.touchHandler=function(t){switch(t.target){case this.challenge:if(!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips(!0))return;this._selectData&&GodWeaponCC.ins().joinFuben(this._selectData.gridNum);break;case this.checkRank:ViewManager.ins().open(GwMijingRankView);break;case this.sweep:var e=GodWeaponCC.ins().fubenInfoData.listData,i=!1;for(var n in e)if(1==e[n].curPoint){if(i=!0,!this.showTips(!1))return;return void GodWeaponCC.ins().sendSweepGW()}i||TipsCT.ins().showTips("请通过关卡并获得S评分")}},e.prototype.onTouchList=function(){this._selectData=this.list.selectedItem},e.prototype.showTips=function(t){var e=this,i=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;if(i>0)return!0;var n="",s=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.GodWeaponBaseConfig.fubenItem);return s?(n="确定使用1个<font color='#FFB82A'>"+s.itemConfig.name+"</font>增加挑战次数？\n",WarnWin.show(n,function(){e._isUser=t,e.canSweep=!t,BagCT.ins().sendUseItem(s.configID,1)},this)):TipsCT.ins().showTips("|C:0xf3311e&T:今日剩余次数不足|"),!1},e}(BaseView);__reflect(GwFubenView.prototype,"GwFubenView");var GwFubenGridRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._ary=new eui.ArrayCollection,this.list.dataProvider=this._ary,this.list.itemRenderer=MijingItemBase},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this._thisData=this.data,this.storeyCount.text="第"+this._thisData.gridNum+"层";var e=this._thisData.config.award[1].concat();e=e.concat(this._thisData.config.firstAward.concat());for(var i=[],n=0;n<e.length;n++){var s=new MijinglistData;s.data=e[n],s.index=n+1,s.start=this._thisData.config.award[1].length,s.floorNum=this._thisData.gridNum,i.push(s)}this._ary.replaceAll(i),0!=this._thisData.curPoint?(this.rankImg.visible=!0,this.rankbg.visible=!0,this.rankImg.source="godweapon_rank"+this._thisData.curPoint):(this.rankImg.visible=!1,this.rankbg.visible=!1),this.choose.visible=this.selected,this.rank.visible=!this.selected}},e.prototype.invalidateState=function(){t.prototype.invalidateState.call(this),this.choose.visible=this.selected,this.rank.visible=!this.selected},e}(BaseItemRender);__reflect(GwFubenGridRender.prototype,"GwFubenGridRender");var MijingItemBase=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data)if(this._thisdata=this.data,this.itemIcon.imgJob.visible=!1,0==this._thisdata.data.type){this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(this._thisdata.data.id);var e=1;switch(this._thisdata.data.id){case MoneyConst.yuanbao:e=5;break;case MoneyConst.gold:e=0;break;case MoneyConst.soul:e=2;break;case MoneyConst.piece:e=2,this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[this._thisdata.data.id];break;case MoneyConst.godweaponExp:e=2}var i=this._thisdata.data.count;if(void 0!=i&&i>1?this.setCount(i+""):this.setCount(""),this._thisdata.index<=this._thisdata.start)this.nameTxt.text=RewardData.getCurrencyName(this._thisdata.data.id),this.itemIcon.imgBg.source="quality"+e,this.nameTxt.textColor=ItemBase.QUALITY_COLOR[e];else{this.nameTxt.text="S通关奖励";var n=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=!1;for(var s=0;s<n.listData.length;s++)if(this._thisdata.floorNum==n.listData[s].gridNum){1==n.listData[s].curPoint&&(this.getImg.visible=!0);break}this._thisdata.floorNum<=10?(this.nameTxt.textColor=ItemBase.QUALITY_COLOR[3],this.itemIcon.imgBg.source="quality3"):(this.nameTxt.textColor=ItemBase.QUALITY_COLOR[4],this.itemIcon.imgBg.source="quality4")}}else{if(this.itemConfig=GlobalConfig.ItemConfig[this._thisdata.data.id],!this.itemConfig)return;var e=ItemUtil.getQuality(this.itemConfig);this.nameTxt.textColor=ItemBase.QUALITY_COLOR[e],this.itemIcon.imgBg.source="quality"+e;var i=this._thisdata.data.count;if(i>1?this.setCount(i+""):this.setCount(""),this.itemIcon.imgIcon.source=this.itemConfig.icon+"_png",this._thisdata.index<=this._thisdata.start)this.nameTxt.text=this.itemConfig.name;else{this.nameTxt.text="S通关奖励";var n=GodWeaponCC.ins().fubenInfoData;this.getImg.visible=!1;for(var s=0;s<n.listData.length;s++)if(this._thisdata.floorNum==n.listData[s].gridNum){1==n.listData[s].curPoint&&(this.getImg.visible=!0);break}}}},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.count.text=t},e.prototype.onClick=function(){this.showDetail()},e.prototype.showDetail=function(){0!=this._thisdata.data.type&&ViewManager.ins().open(ItemDetailedWin,0,this.itemConfig.id,this._thisdata.data.count)},e}(BaseItemRender);__reflect(MijingItemBase.prototype,"MijingItemBase");var MijinglistData=function(){function t(){}return t}();__reflect(MijinglistData.prototype,"MijinglistData"),window.GwFubenView=GwFubenView;var RankDataBase=function(){function t(){}return t.prototype.parser=function(t,e){var i=this;e.forEach(function(e){i[e]=t[RankDataType.readFunc[e]]()})},t}();__reflect(RankDataBase.prototype,"RankDataBase"),window.RankDataBase=RankDataBase;var Recharge=function(t){function e(){var e=t.call(this)||this;return e._rechargeData=[],e.flag=0,e.forevetCard=0,e.rechargeTotal={totalDay:0,hasGetDays:[]},e.rechargeTotal2={totalDay:0,hasGetDays:[]},e._isOpenIosRecharge=!1,e.recharge_type=0,e.franchiseflag=0,e.franchiseget=0,e.firstBuy=0,e.sysId=PackageID.Recharge,e.regNetMsg(1,e.postRecharge1Data),e.regNetMsg(2,e.changeRecharge1Data),e.regNetMsg(4,e.doPayOrder),e.regNetMsg(6,e.getRecharge2Data),e.regNetMsg(7,e.changeRecharge2Data),e.regNetMsg(8,e.postUpDataItem),e.regNetMsg(9,e.postRechargeTotalDay),e.regNetMsg(20,e.postGetMonthDay),e.regNetMsg(22,e.postGetWeekDay),e.regNetMsg(11,e.postFranchiseInfo),e.regNetMsg(12,e.postMuchDayRecReward),e.regNetMsg(23,e.postRechargeTotalDay2),e.observe(Actor.init,e.updateIosRecharge),e.observe(Actor.ins().postLevelChange,e.updateIosRecharge),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"isOpenIosRecharge",{get:function(){return!urlParam.isWXiOS||3!=+urlParam.apptype||this._isOpenIosRecharge||urlParam.debugTS?!0:!1},set:function(t){this._isOpenIosRecharge=t},enumerable:!0,configurable:!0}),e.prototype.getRechargeData=function(t){return void 0===t&&(t=-1),-1==t?this._rechargeData:this._rechargeData[t]||new RechargeData
},e.prototype.getCurRechargeConfig=function(){var t=this.getRechargeData(0),e=CommonUtils.getObjectLength(GlobalConfig.DailyRechargeConfig);if(t.day<=e)return GlobalConfig.DailyRechargeConfig[t.day];var i=t.day-e;return e=CommonUtils.getObjectLength(GlobalConfig.LoopRechargeConfig),i=i%e||e,GlobalConfig.LoopRechargeConfig[i]},e.prototype.getCurDailyRechargeIsAllGet=function(){for(var t=e.ins().getRechargeData(0),i=e.ins().getCurRechargeConfig(),n=CommonUtils.getObjectLength(i),s=0;n>s;s++){var o=t.isAwards>>s&1;if(!o)return!1}return!0},e.prototype.sendGetAwards=function(t,e){var i=this.getBytes(0==t?2:7);i.writeShort(e),this.sendToServer(i)},e.prototype.postRecharge1Data=function(t){this.recharge(t,0)},e.prototype.changeRecharge1Data=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.postUpdateRechargeEx=function(t){return{type:t}},e.prototype.postUpdateRecharge=function(t){return t},e.prototype.getDayReward=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.getRecharge2Data=function(t){},e.prototype.changeRecharge2Data=function(t){var i=this.getRechargeData(1);i&&(i.change(t),e.ins().postUpdateRecharge(1))},e.prototype.getRechargeTotalAward=function(t){var e=this.getBytes(8);e.writeShort(t),this.sendToServer(e)},e.prototype.recharge=function(t,i){if(this._rechargeData[i]||(this._rechargeData[i]=new RechargeData),this._rechargeData[i].parser(t,i),0==i){var n=e.ins().getCurDailyRechargeIsAllGet();n&&ViewManager.ins().close(Recharge2Win)}e.ins().postUpdateRechargeEx(i),this.recharge_type=i},e.prototype.postUpDataItem=function(t){this.costList=t.readInt()},e.prototype.postRechargeTotalDay=function(t){this.rechargeTotal={},this.rechargeTotal.hasGetDays=[];for(var e=t.readShort(),i=0;e>i;i++)this.rechargeTotal.hasGetDays.push(t.readShort());this.rechargeTotal.totalDay=t.readShort()},e.prototype.postGetMonthDay=function(t){var e=t.readUnsignedInt();e>0?this.monthDay=e:this.monthDay=0,e>0&&(this.flag=2),this.forevetCard=t.readInt(),!Setting.ins().getValue(ClientSet.firstMonthCard)&&(this.monthDay>0||this.getIsForeve())&&Setting.ins().setValue(ClientSet.firstMonthCard,1)},e.prototype.getOrderByIndex=function(t){return void 0===t&&(t=0),this.costList>>t&1},Object.defineProperty(e.prototype,"monthDay",{get:function(){return this._monthDay},set:function(t){this._monthDay!=t&&(this._monthDay=t,Timer.stop(this.downTime,this),this._monthDay>0&&Timer.start(1e3,this._monthDay,this.downTime,this))},enumerable:!0,configurable:!0}),e.prototype.downTime=function(){this._monthDay-=1},e.prototype.postGetWeekDay=function(t){var e=t.readUnsignedInt();e>0?this._weekDay=1e3*e+egret.getTimer():this._weekDay=0},Object.defineProperty(e.prototype,"weekDay",{get:function(){return this._weekDay-egret.getTimer()},enumerable:!0,configurable:!0}),e.prototype.doPayOrder=function(t){var e=t.readInt(),i=t.readString(),n=t.readInt(),s=t.readInt(),o=t.readShort(),a=t.readString();if(-1==s)return console.warn("请求游戏服务器充值订单号返回yb错误",s),void TipsCT.ins().showTips("无法充值");if(200!=e&&console.warn("请求游戏服务器充值订单号失败",e,i,s),GlobalConfig.ClientGlobalConfig.oldRecharge)platform.pay(s,n,i,o,"","",a);else{var r=this.getCfgByRid(s);r?platform.pay(r.ybCount,n,i,o,r.itemName||"",r.desc||"",r.ybCount+""):console.warn("请求游戏服务器充值订单号返回rid错误",s)}},e.prototype.showReCharge=function(t,e,i){void 0===e&&(e=ShowRechargeType.Type_Normal),void 0===i&&(i="");var n=this.getCashByYb(t),s=this.getBytes(4);s.writeInt(n),s.writeInt(t),s.writeShort(e),s.writeString(i),this.sendToServer(s)},e.prototype.sendPayOrder=function(t){var e=this.getCashByRid(t);if(-1==e)return void console.log("充值配置RechargeConfig不存在");var i=this.getBytes(4);i.writeInt(e),i.writeInt(t),i.writeShort(0),i.writeString(""),this.sendToServer(i)},e.prototype.getCashByYb=function(t){var e=this.getRechargeCfgByYB(t);return e?e.cash:t/GlobalConfig.ClientGlobalConfig.rate*100},e.prototype.getCashByRid=function(t){var e=GlobalConfig.RechargeConfig[t];return e?e.cash:-1},e.prototype.getCfgByRid=function(t){var e=GlobalConfig.RechargeConfig[t];return e?e:null},e.prototype.getRechargeCfgByYB=function(t){var e=urlParam&&urlParam.apptype&&!isNaN(parseInt(urlParam.apptype))?parseInt(urlParam.apptype):1;if(!isNaN(e)){var i=GlobalConfig.RechargeItemsConfig;for(var n in i){var s=i[n],o=s.appType;if(t==s.amount&&-1!=o.indexOf(e))return s}}return null},e.getChannelMulti=function(){return GlobalConfig.ChongZhiBaseConfig.channelMultiRecharge[+urlParam.appid]||1},e.prototype.updateIosRecharge=function(){if(window.isOpenIosRecharge){var t={vip:Actor.vip,level:Actor.level,openRecharge:!1};window.isOpenIosRecharge(t,function(t){e.ins().isOpenIosRecharge=t,console.log("是否打开ios充值",e.ins().isOpenIosRecharge)})}},e.prototype.getIsForeve=function(){return 2==e.ins().forevetCard},e.prototype.sendGetFranchise=function(){this.sendBaseProto(10)},e.prototype.postFranchiseInfo=function(t){var e=t.readUnsignedInt();e>0?this.franchise=e:this.franchise=0,this.franchiseget=t.readByte(),this.firstBuy=t.readUnsignedByte(),HotBloodCT.ins().checkHotBlood()},Object.defineProperty(e.prototype,"franchise",{get:function(){return this._franchise},set:function(t){this._franchise!=t&&(this._franchise=t,Timer.stop(this.franchiseTime,this),this._franchise>0&&Timer.start(1e3,this._franchise,this.franchiseTime,this))},enumerable:!0,configurable:!0}),e.prototype.franchiseTime=function(){this._franchise-=1,this._franchise<=0&&HotBloodCT.ins().checkHotBlood()},e.prototype.getRechargeList=function(){var t=GlobalConfig.RechargeDaysAwardsConfig,i=[],n={},s={};for(var o in t)n[t[o].sum]||(n[t[o].sum]=[]),s[t[o].sum]||(s[t[o].sum]=0),e.ins().rechargeTotal.hasGetDays.indexOf(t[o].id)>=0&&s[t[o].sum]++,n[t[o].sum].push(t[o]);for(var o in s){if(i.length)break;if(!(s[o]>=CommonUtils.getObjectLength(n[o])))for(var a in n[o])i.push(n[o][a])}return i},e.prototype.sendMuchDayRecReward=function(){this.sendBaseProto(11)},e.prototype.postMuchDayRecReward=function(t){this.mRecNum=t.readInt(),this.mReward=t.readByte(),this.mDayNum=t.readShort()},e.prototype.getRechargeList2=function(){var t=GlobalConfig.LuxuryRechargeDaysAward,i=[],n={},s={};for(var o in t)n[t[o].sum]||(n[t[o].sum]=[]),s[t[o].sum]||(s[t[o].sum]=0),e.ins().rechargeTotal2.hasGetDays.indexOf(t[o].id)>=0&&s[t[o].sum]++,n[t[o].sum].push(t[o]);for(var o in s){if(i.length)break;if(!(s[o]>=CommonUtils.getObjectLength(n[o])))for(var a in n[o])i.push(n[o][a])}return i},e.prototype.postRechargeTotalDay2=function(t){this.rechargeTotal2={},this.rechargeTotal2.hasGetDays=[];for(var e=t.readShort(),i=0;e>i;i++)this.rechargeTotal2.hasGetDays.push(t.readShort());this.rechargeTotal2.totalDay=t.readShort()},e.prototype.getRechargeTotalAward2=function(t){var e=this.getBytes(24);e.writeShort(t),this.sendToServer(e)},__decorate([post()],e.prototype,"postRecharge1Data",null),__decorate([post()],e.prototype,"postUpdateRechargeEx",null),__decorate([post()],e.prototype,"postUpdateRecharge",null),__decorate([post()],e.prototype,"postUpDataItem",null),__decorate([post()],e.prototype,"postRechargeTotalDay",null),__decorate([post()],e.prototype,"postGetMonthDay",null),__decorate([post()],e.prototype,"postGetWeekDay",null),__decorate([post()],e.prototype,"postFranchiseInfo",null),__decorate([post()],e.prototype,"postMuchDayRecReward",null),__decorate([post()],e.prototype,"postRechargeTotalDay2",null),e}(BaseSystem);__reflect(Recharge.prototype,"Recharge");var ShowRechargeType;!function(t){t[t.Type_Normal=0]="Type_Normal",t[t.Type_WeekCard=1]="Type_WeekCard",t[t.Type_MonthCard=2]="Type_MonthCard",t[t.Type_SpecialCard=3]="Type_SpecialCard",t[t.Type_Cardgift=4]="Type_Cardgift",t[t.Type_TOUZI41=5]="Type_TOUZI41",t[t.Type_JackPot=6]="Type_JackPot",t[t.Type_Rexue=7]="Type_Rexue",t[t.Type_WarOrder=8]="Type_WarOrder",t[t.Type_Treasure=9]="Type_Treasure",t[t.Type_DailyGift=10]="Type_DailyGift",t[t.Type_Vipgift=11]="Type_Vipgift",t[t.Type_OneYuanGift=12]="Type_OneYuanGift",t[t.Type_Pactivity55=13]="Type_Pactivity55",t[t.Type_FirstRecharge=14]="Type_FirstRecharge"}(ShowRechargeType||(ShowRechargeType={})),window.ShowRechargeType=ShowRechargeType;var RechargeData=function(){function t(){}return t.prototype.parser=function(t,e){this.day=t.readShort()+1,this._firstPayday=t.readShort()+1,this.curDayPay=t.readInt(),this._num=t.readInt(),this.isAwards=t.readInt()},t.prototype.change=function(t){this._num=t.readInt(),this.isAwards=t.readInt()},t.prototype.firstPayDay=function(){return this.day-this._firstPayday},Object.defineProperty(t.prototype,"num",{get:function(){if(this._firstPayday>0){for(var t=CommonUtils.getObjectLength(GlobalConfig.FirstRechargeClientConfig),e=1;t>=e;e++)if(0==(this._num>>e&1))return 1;return 2}return 0},enumerable:!0,configurable:!0}),t.prototype.firstRewardStateByDay=function(t){return this._firstPayday>0?(t++,0==(this._num>>t&1)?1:2):0},t.checkOpenWin=function(){var t=Recharge.ins().getRechargeData(0);t&&0!=t.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)},t}();__reflect(RechargeData.prototype,"RechargeData"),System.Recharge=function(){return Recharge.ins()},window.Recharge=Recharge;var RuleIconBase=function(t){function e(e,i){void 0===i&&(i=null);var n=t.call(this)||this;return n.isShow=!1,n.isDelayUpdateShow=!1,n.isDelayUpdate=!1,n.id=e,n.tar=i,n}return __extends(e,t),e.prototype.getTar=function(){return this.tar?this.tar:this.createTar()},e.prototype.createTar=function(){var t=GlobalConfig.PlayFunConfig[this.id],e=t.iconCls?egret.getDefinitionByName(t.iconCls):eui.Button,i=new e;i.skinName=t.iconSkin?t.iconSkin:"MainButtonSkin";var n=t.icon;if(t.actIcon)for(var s in t.actIcon){var o=Activity.ins().activityData[s]||PActivity.ins().activityData[s];if(o&&o.isOpenActivity()){n=t.actIcon[s];break}}if(n&&(i.icon=n),t.iconParam)for(var a in t.iconParam)i[a]=t.iconParam[a];return this.tar=i,i.name=egret.getQualifiedClassName(this),i},e.prototype.getConfig=function(){return GlobalConfig.PlayFunConfig[this.id]},e.prototype.delayUpdateShow=function(){this.isDelayUpdateShow||(this.isDelayUpdateShow=!0,Timer.start(100,1,this.updateShow,this))},e.prototype.updateShow=function(){this.isDelayUpdateShow=!1,e.updateShow&&e.updateShow(this)},e.prototype.delayUpdate=function(){this.isDelayUpdate||(this.isDelayUpdate=!0,Timer.start(100,1,this.update,this))},e.prototype.update=function(){this.isDelayUpdate=!1,e.update&&e.update(this)},e.prototype.checkShowIcon=function(){return!0},e.prototype.checkShowRedPoint=function(){return 0},e.prototype.getEffName=function(t){return null},e.prototype.tapExecute=function(){},e.prototype.addShowEvents=function(){if(this.showMessage)for(var t=0,e=this.showMessage;t<e.length;t++){var i=e[t];MessageCenter.addListener(i,this.delayUpdateShow,this)}},e.prototype.addRedEvents=function(){if(this.updateMessage)for(var t=0,e=this.updateMessage;t<e.length;t++){var i=e[t];MessageCenter.addListener(i,this.delayUpdate,this)}},e.prototype.removeRedEvents=function(){if(this.updateMessage)for(var t=0,e=this.updateMessage;t<e.length;t++){var i=e[t];MessageCenter.ins().removeListener(i.funcallname,this.delayUpdate,this)}},e.prototype.removeEvents=function(){MessageCenter.ins().removeAll(this)},e}(egret.HashObject);__reflect(RuleIconBase.prototype,"RuleIconBase"),window.RuleIconBase=RuleIconBase;var ShenshouEquipItem=function(t){function e(){var e=t.call(this)||this;return e.equipName=["","血瞳","魔躯","妖尾","圣角","鬼爪"],e.touchChildren=!1,e.touchChildren=!1,e.skinName="shenshouEquipItem",e}return __extends(e,t),e.prototype.setPosData=function(t,e){var i=GlobalConfig.ShenShouBase[t].minLevel[e-1];this.imgBg.source="quality0",this.nameTxt.text=GlobalConfig.ShenShouConfig.qualityName[i]+this.equipName[e],this.nameTxt.textColor=ItemBase.QUALITY_COLOR[0],this.imgIcon.source="ss_equip"+(e-1),this.equipLv.text="",this.data=null},e.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data],this.nameTxt.text=this.itemConfig.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.itemConfig),this.imgBg.source="quality"+ItemUtil.getQuality(this.itemConfig),this.imgIcon.source=this.itemConfig.icon+"_png";var t=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=t>0?"+"+t:""}},e}(BaseItemRender);__reflect(ShenshouEquipItem.prototype,"ShenshouEquipItem"),window.ShenshouEquipItem=ShenshouEquipItem;var PublicBossInfo=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.hp=t.readShort(),this.people=t.readShort(),this.reliveTime=1e3*t.readInt()+egret.getTimer(),this.challengeing=t.readBoolean()},Object.defineProperty(t.prototype,"isDie",{get:function(){return(this.reliveTime-egret.getTimer())/1e3>0},enumerable:!0,configurable:!0}),t}();__reflect(PublicBossInfo.prototype,"PublicBossInfo"),window.PublicBossInfo=PublicBossInfo;var RoleAI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiList={},e.zhanlingTime=0,e.zhanlingdelayTime=0,e.isFindDrop=!1,e.isLog=!1,e}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.init=function(){this.stop(),this.skillCD={},this.attrCD={},this.attrValue={},this.inited=!0},e.prototype.start=function(){this.isStartAtk=!1,GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY),this.teamAction={},this.starting||(this.inited||this.init(),this.addAITimer())},e.prototype.togglePause=function(){},e.prototype.stop=function(){this.inited&&this.stopAITimer(),this.skillCD={};for(var t in this.curSkill)this.curSkill[t]&&ObjectPool.push(this.curSkill[t]);this.curSkill={},this.curTarget={},this.lastTarget={},this.skillCastType={},this.skillTargetType={},this.hashHpObj={},this.attrCD={},this.attrValue={}},e.prototype.clearTarget=function(t){if(t&&t.infoModel){var e=t.infoModel.handle;delete this.skillCD[e];var i=this.curSkill[e];i&&ObjectPool.push(i),delete this.curSkill[e],delete this.curTarget[e],delete this.lastTarget[e],delete this.skillCastType[e],delete this.skillTargetType[e];for(var n in this.curTarget)this.curTarget[n]==t&&delete this.curTarget[n];for(var n in this.lastTarget)n+""==e+""&&delete this.lastTarget[n]}},e.prototype.clearAIList=function(){this.aiList={}},e.prototype.clear=function(){this.stop(),this.clearAIList(),this.isFindDrop=!1,Timer.stopAll(this)},e.prototype.destruct=function(){this.skillCD={},this.stop()},Object.defineProperty(e.prototype,"starting",{get:function(){return Timer.has(this.startAI,this)},enumerable:!0,configurable:!0}),e.prototype.canAddToAi=function(){return GameMap.sceneInMain()},e.prototype.add=function(t){this.aiList[t.infoModel.handle]=t},e.prototype.remove=function(t){this.clearTarget(t),delete this.aiList[t.infoModel.handle]},e.prototype.getAIList=function(){return this.aiList},e.prototype.startAI=function(){var t=this.aiList,e=SubRoles.lookAtTar,i=0;for(var n in t){var s=t[n],o=void 0,a=s instanceof CharRole,r=s.infoModel.handle,l=s.buffList,h=!1;for(var u in l){if(s.AI_STATE==AI_State.Die)break;var p=l[u];if((2==p.effConfig.type||1==p.effConfig.type)&&p.isExecute()){p.step++;var c=this.hramedDie(s,p.value);c&&(s.AI_STATE=AI_State.Die),this.showHram(c,1,s,p.source,p.value,"buff伤害"+p.effConfig.id),p.step>=p.count&&s.removeBuff(p)}p.canRemove()?s.removeBuff(p):p.isCanotHit()&&(h=!0)}if(!h&&s.AI_STATE!=AI_State.Die&&!s.isHardStraight){if(s.infoModel.team==Team.My&&SkillCT.ins().hejiLevel>0&&SkillCT.ins().hejiEnable&&s.infoModel instanceof Role){if(e&&s.infoModel.handle==e.infoModel.handle){o=this.curTarget[r];var d=SkillCT.ins().getHejiSkillId();if(SkillCT.ins().fieldUse&&0!=d.id&&o&&o.team!=Team.My&&o.AI_STATE!=AI_State.Die){var g=EntityManager.ins().screeningTargetByPos(s,!1,d.affectCount,d.castRange,this.aiList);if(g.length){this.useSkill(s,o,d),ExSkillAiLogic.ins().checkHJTrigger(s,[o]),SkillCT.ins().fieldUse=!1;var f=GlobalConfig.EffectsConfig[d.selfEff[0]]?GlobalConfig.EffectsConfig[d.selfEff[0]]:null;if(f)for(var v=SubRoles.ins().subRolesLen,y=0;v>y;y++){var m=EntityManager.ins().getMainRole(y);if(m){var p=ObjectPool.pop("EntityBuff");p.effConfig=f,p.addTime=egret.getTimer(),p.endTime=p.addTime+f.duration,p.count=f.duration/f.interval>>0,p.step=0,p.source=m,m.addBuff(p),m.stopMove(),m!=e&&m.playAction(EntityAction.STAND),m.AI_STATE=AI_State.Stand}}continue}}}}else if(s.infoModel.team==Team.WillEntity&&HejiUseMgr.ins().canUse()){o=this.curTarget[r];var T=HejiUseMgr.ins().getMaster();if(o&&o.team==Team.My&&T==s){var d=HejiUseMgr.ins().getSkillData();if(d&&o.AI_STATE!=AI_State.Die){var g=EntityManager.ins().screeningTargetByPos(s,!1,d.affectCount,d.castRange,this.aiList);if(g.length){this.useSkill(s,o,d),HejiUseMgr.ins().useSuccess();var f=GlobalConfig.EffectsConfig[d.selfEff[0]]?GlobalConfig.EffectsConfig[d.selfEff[0]]:null;if(f)for(var C=HejiUseMgr.ins().getRoles(),v=C.length,b=0;v>b;b++){var m=EntityManager.ins().getEntityByHandle(C[b].handle);if(m){var p=ObjectPool.pop("EntityBuff");p.effConfig=f,p.addTime=egret.getTimer(),p.endTime=p.addTime+f.duration,p.count=f.duration/f.interval>>0,p.step=0,p.source=m,m.addBuff(p),m.stopMove(),m!=T&&m.playAction(EntityAction.STAND),m.AI_STATE=AI_State.Stand}}continue}}}}if(t[r]){var I=1e6/(s.infoModel.getAtt(AttributeType.atAttackSpeed)*(1+s.infoModel.getAtt(AttributeType.atAttackSpeedPower)/1e4));if(a){if(s.publicCD&&egret.getTimer()-s.publicCD<=Math.floor(I))continue}else if(s.publicCD&&egret.getTimer()-s.publicCD<=Math.floor(I))continue;if(!this.isFindDrop||s.team!=Team.My||!e||s.infoModel.handle!=e.infoModel.handle)switch(s.AI_STATE){case AI_State.Stand:this.screeningSkill(r);var w=!1,S=!1;if(this.curSkill[r]||(w=!0),!w&&this.checkCanScreeningTarget(s,this.curSkill[r],this.curTarget[r])&&(s.team==Team.WillEntity?this.screeningTarget(s,9):this.screeningTarget(s)),s.team==Team.My&&s!=e&&e&&MathUtils.getDistance(s.x,s.y,e.x,e.y)>250){var _=this.curTarget[e.infoModel.handle];_&&_.AI_STATE!=AI_State.Die&&this.curSkill[r]&&this.curSkill[r].targetType==TargetType.Enemy&&_.team!=Team.My?this.curTarget[r]=_:S=!0}if(w||S){if(s.team==Team.My&&s!=e&&e){var B=e;if(s.infoModel.masterHandle){var D=EntityManager.ins().getEntityByHandle(s.infoModel.masterHandle);D&&(B=D)}var x=EntityManager.ins().getTeamCount(Team.My),R=[1,-1];2==x&&(R=[0]);var E=DirUtil.getGridByDir(isNaN(B.dir+R[i])?0:R[i]);i+=1,GameMap.moveEntity(s,B.x+E.x,B.y+E.y)}continue}if(!this.curTarget[r])continue;this.tryUseSkill(s)?s.AI_STATE=AI_State.Atk:(s.team==Team.My||s.team==Team.WillEntity||s.team==Team.Faker||this.teamAction[s.team])&&(GameMap.moveEntity(s,this.curTarget[r].x,this.curTarget[r].y),s.AI_STATE=AI_State.Run);break;case AI_State.Run:if(o=this.curTarget[r],s.team==Team.My&&(FbCT.ins().canChallengGuanQia=!0),!o||o.AI_STATE==AI_State.Die){s.stopMove(),s.playAction(EntityAction.STAND),s.AI_STATE=AI_State.Stand,delete this.curTarget[r];continue}if(s.team==Team.Faker){var A=Encounter.ins().wildPersonList[s.infoModel.masterHandle];if(!A)continue;var P=s.infoModel.killNum,k=MathUtils.getDistance(s.x,s.y,A.backX,A.backY);if(1==A.actionType&&P>=A.killNum){k<GameMap.CELL_SIZE?(EntityManager.ins().removeByHandle(s.infoModel.masterHandle),Encounter.ins().RunAwary(s.infoModel.masterHandle),Encounter.ins().sendCleanWildPeople(A.index)):GameMap.moveEntity(s,A.backX,A.backY);continue}}this.tryUseSkill(s)&&(s.stopMove(),s.AI_STATE=AI_State.Atk),s.action==EntityAction.STAND&&(s.AI_STATE=AI_State.Stand);break;case AI_State.Atk:if(this.isStartAtk||GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK),this.isStartAtk=!0,o=this.curTarget[r],!o||o.AI_STATE==AI_State.Die){s.AI_STATE=AI_State.Stand,delete this.curTarget[r];continue}if(this.teamAction[o.team]=!0,s.atking)continue;var d=this.curSkill[r];if(!d)continue;this.skillCD[r][d.id]=egret.getTimer(),this.skillCastType[r]=d.castType,this.skillTargetType[r]=d.targetType,s.atking=!0,s.team==Team.My&&(FbCT.ins().canChallengGuanQia=!1),s.publicCD=egret.getTimer(),GameLogic.skyBallCheck(s),this.useSkill(s,o,d),delete this.curSkill[r];break;case AI_State.Patrol:var M=s.infoModel.configID,f=FbCT.ins().guanqiaMonster[M];s.infoModel.isWander&&f&&f.attrange?(this.screeningTarget(s,f.attrange),this.curTarget[s.infoModel.handle]?s.AI_STATE=AI_State.Stand:s.startPatrol()):s.startPatrol()}}}}},e.prototype.checkShowZhanling=function(){if(this.zhanlingTime=egret.getTimer(),GameMap.sceneInMain()){var t=ZhanLingModel.ins().ZhanLingSkinId;if(ZhanLingModel.ins().getZhanLingDataById(0)){var e=SubRoles.lookAtTar;if(e){var i=ZhanLingModel.ins().getZhanLingDataById(0).level;e.showZhanling(t,i),ExSkillAiLogic.ins().checkWarSpiritBubbleTrigger()}}}},e.prototype.checkCanScreeningTarget=function(t,e,i){if(!i||!i.parent||i.AI_STATE==AI_State.Die)return!0;var n=t.infoModel.handle;return void 0==this.skillCastType[n]&&void 0==this.skillTargetType[n]?!0:this.skillCastType[n]!=e.castType||this.skillTargetType[n]!=e.targetType?!0:!1},e.prototype.useSkill=function(t,e,i){var n,s,o,a,r=this,l=i.selfEff?GlobalConfig.EffectsConfig[i.selfEff[0]]:null,h=3==i.castType?t:e,u=0,p=!1,c=t.infoModel;t.team==Team.My&&(s=Artifact.ins().getReviseBySkill(i.id),s&&(u=s.crit||0),a=GodWeaponCC.ins().getReviseBySkill(i.id),a&&(o=a[0]),o&&(u=o.crit));var d=i.affectCount;if(s&&s.affectCount&&(d+=s.affectCount),o&&o.affectCount&&(d+=o.affectCount),4==i.castType){n=EntityManager.ins().screeningTargetByPos(t,!0,0,Number.MAX_VALUE,this.aiList);for(var g=0;g<n.length;g++)if(n[g].isCanAddBlood){n[0]=n[g];break}}else n=2!=i.castType&&i.targetType==TargetType.Enemy?EntityManager.ins().screeningTargetByPos(h,!1,d,i.affectRange,this.aiList):d>1?EntityManager.ins().screeningTargetByPos(h,h.team==e.team,d,i.affectRange,this.aiList):[e],0==n.length&&(n=[e]);i.preId&&GlobalConfig.FlameStamp.skillId.indexOf(i.preId)>=0&&(p=!0);for(var f=!1,v=n.length=Math.min(n.length,d),y=[],m=0;v>m;m++){var T=n[m],C=T.infoModel,b=!1,I=0==m;if(T.team!=t.team){var w=void 0;(GameLogic.triggerAttr(t,AttributeType.atStunPower)||90005==i.id)&&(w=ObjectPool.pop("EntityBuff"),w.effConfig=GlobalConfig.EffectsConfig[51001],w.value=c.getAtt(AttributeType.atStunTime),w.addTime=egret.getTimer(),w.endTime=w.addTime+w.value,T.addBuff(w),T.stopMove(),T.AI_STATE=AI_State.Stand),GameLogic.triggerExAttr(t,5)&&(w=ObjectPool.pop("EntityBuff"),w.effConfig=GlobalConfig.EffectsConfig[52001],w.addTime=egret.getTimer(),w.endTime=w.effConfig.args.d?c.getExAtt(7):w.effConfig.duration,T.addBuff(w),t.addPaoPao(3),b=!0),GameLogic.triggerExAttr(t,12)}var S=SkillCT.ins().isHejiSkill(i.configID),_=!1,B=!1,D=!1,x=!1,R=!1,E=!1,A=!1,P=void 0,k=void 0,M=0;if(3!=i.calcType&&(x=GameLogic.triggerMiss(t,T)),x)M=0;else{if(M=this.damageBaseCalculation(t,T,i),3!=i.calcType){D=GameLogic.triggerExAttr(t,28),D&&(M*=c.getExAtt(29)/1e4,M+=c.getExAtt(30),t.addPaoPao(21)),_=GameLogic.triggerCrit(t,T,u);var L=t.hasBuff(SkillConst.EFF_SKY_BALL);L&&(t.addPaoPao(6),_=!0);var G=0,F=1;if(_){f=!0;var N=c.getAtt(AttributeType.atCritEnhance);o&&o.critDamage&&(N+=o.critDamage);var W=c.getExAtt(54);C.getAtt(AttributeType.atHp)/C.getAtt(AttributeType.atMaxHp)<=W/1e4&&(N+=c.getExAtt(55)),F+=N/1e4,G+=c.getAtt(AttributeType.atCritHurt)}var O={};O[AttributeType.atDeadLyPro]=GameLogic.calculateRealAttribute(t,AttributeType.atDeadLyPro,t),A=GameLogic.triggerAttr(t,AttributeType.atDeadLyPro,O),A&&(F+=.5+(c.getAtt(AttributeType.atDeadLyMaster)-C.getAtt(AttributeType.atDeadLyResist))/1e4),O={},O[AttributeType.atHunGuPro]=GameLogic.calculateRealAttribute(t,AttributeType.atHunGuPro,t),P=this.tryTriggerHungu(t),P&&(F+=c.getAtt(AttributeType.atHunGuHurt)/1e4),k=this.tryTriggerHeart(t),k&&(F+=c.getAtt(AttributeType.atHearthHurt)/1e4,G+=c.getAtt(AttributeType.atHearthDamege)),M=M*F+G,b&&(M*=1+c.getExAtt(6)/1e4),I||i.targetType!=TargetType.Enemy||(M*=C.type==EntityType.Role?i.herdPlayerRate/100:i.herdMonRate/100),t.isMy&&c.type==EntityType.Role&&e.infoModel.type==EntityType.Role&&(Encounter.ins().isEncounter()?EncounterFight.ins().getIsWeiShe(t.isMy)&&(R=!0):MineFight.ins().isFighting&&MineFight.ins().getIsWeiShe(t.isMy)&&(R=!0)),M=this.damageBuff(t,T,M),M+=c.getAtt(AttributeType.atHolyDamege)*(1+c.getAtt(AttributeType.atHolyMaster)/1e4-C.getAtt(AttributeType.atHolyResist)/1e4),E=GameLogic.triggerAttr(t,AttributeType.atZhuiMingPro),E&&(M+=c.getAtt(AttributeType.atZhuiMingVal)),M*=1-c.getAtt(AttributeType.neigongAbsorbHurt)/1e4}M>>=0,t.team==T.team&&M>0&&(M=0)}T instanceof CharRole||T.AI_STATE==AI_State.Patrol&&(T.stopMove(),T.playAction(EntityAction.STAND),T.AI_STATE=AI_State.Stand);var U=this.hramedDie(T,M);U&&(T.AI_STATE=AI_State.Die,ExSkillAiLogic.ins().checkDieTrigger(t,[T]));var H=0;if(t.team==Team.My&&(S?H=16:x?H=4:(B&&(H|=8),_&&(H|=2)),R&&(H|=64),E&&(H|=256),A&&(H|=512),i.isLianJi&&(H=1024)),t.team!=T.team&&5==i.calcType){for(var V=M/5>>0,q=V*MathUtils.limit(0,.05)>>0,Y=V*MathUtils.limit(0,.05)>>0,j=[V-q,V+q,V-Y,V+Y,M-4*V],Z=[],z=0;z<j.length;z++)Z.push({isDie:U,damageType:32,ttarget:T,hramValue:j[z]});y.push(Z)}else if(y.push([{isDie:U,damageType:H,ttarget:T,hramValue:M}]),t.team!=T.team&&GameLogic.triggerAttr(t,AttributeType.atAttPerDamPan)){U=this.hramedDie(T,M>>1),t.addPaoPao(20);var X=y[y.length-1];X.push({isDie:U,damageType:32,ttarget:T,hramValue:M>>1})}T.myKill=T.myKill||t.isMy,(t.isMy||t.team==Team.WillEntity)&&(T.showBlood(!0),T.showName(!0)),T.isMy&&(t.showBlood(!0),t.showName(!0))}var J=GameMap.fbType,K=GameMap.fubenID,Q=0;return GameLogic.ins().playSkillEff(i,t,n,function(u){if(GameMap.fbType==J&&K==GameMap.fubenID){for(var c=0,d=0;d<n.length;d++){var g=n[d],f=(g.infoModel,y[d][y[d].length-1].isDie);h==g&&(c=y[d][0].damageType);for(var v=0,m=0;m<y[d].length;m++){var T=y[d][m];v+=T.hramValue,r.showHram(T.isDie,T.damageType,g,t,T.hramValue,i.name)}if(t.team==Team.My&&g.team==Team.WillEntity&&EncounterFight.ins().willEntityFightTeam!=Team.My){EncounterFight.ins().willEntityFightTeam=Team.My;for(var C=EntityManager.ins().getEntityByTeam(Team.WillEntity),b=0,I=C;b<I.length;b++){var w=I[b];r.curTarget[w.infoModel.handle]=null,r.lastTarget[w.infoModel.handle]=null}}if(g.shakeIt(),!f){var S=i.tarEff;h!=g&&g.infoModel.type==EntityType.Role&&(S=i.otarEff||S);for(var _=0;S&&_<S.length;_++){var B=r.getArgs(S[_],s,o),D=EntityBuff.createBuff(S[_],t,B);t.isMy?g.addBuff(D):t.addBuff(D)}s&&r.addTargetReviseSkillEffect(g,t,s),o&&r.addTargetReviseSkillEffect(g,t,o),a&&a[1]&&r.addTargetReviseSkillEffect(g,t,a[1]),g instanceof CharRole&&r.tryUseWingSkill(g,i,!0),r.tryUsePassiveSkill(t,g,!0,y[d][0].damageType),r.tryUseWeaponSkill(g,i,!0),r.tryTriggerMijiBuqu(g)}r.showBuffHarm(t,g,i,v)}if(l)for(var _=0;i.selfEff&&_<i.selfEff.length;_++){var B=r.getArgs(i.selfEff[_],s,o),D=EntityBuff.createBuff(i.selfEff[_],t,B);t.addBuff(D)}if(s&&r.addSelfReviseSkillEffect(t,s),o&&r.addSelfReviseSkillEffect(t,o),a&&a[1]&&r.addSelfReviseSkillEffect(t,a[1]),t instanceof CharRole&&r.tryUseWingSkill(t,i,!1),r.tryUsePassiveSkill(t,h,!1,c),r.tryTriggerHeirloomSkill(t,n,y),p&&r.tryUseYlPassiveSkill(t,h,i),80002==i.configID&&r.petTryUsePassiveSkill(t,!1),i.otherSkills){var x=i.otherSkills.concat(),R=new SkillData(x[Q]);return R.preId=i.configID,r.useSkill(t,e,R),void(Q+=1)}}}),!SoundUtil.WINDOW_OPEN&&i.sound&&t.team==Team.My&&SoundUtil.play(i.sound),t.AI_STATE=AI_State.Stand,t.atking=!1,f&&c.getExAtt(59)&&this.checkTriggerAttr(t,1,60,1),this.repel(t,e,i),[i,t,e]},e.prototype.repel=function(t,e,i){if(i&&i.repelDistance){e.stopMove(),e.playAction(EntityAction.STAND);var n=e.infoModel.handle;delete this.curTarget[n];var s=MathUtils.getAngle(MathUtils.getRadian2(t.x,t.y,e.x,e.y)),o=MathUtils.getDirMove(s,i.repelDistance);o.x=e.x+o.x,o.y=e.y+o.y;var a=BresenhamLine.isAbleToThrough(GameMap.point2Grip(e.x),GameMap.point2Grip(e.y),GameMap.point2Grip(o.x),GameMap.point2Grip(o.y));0==a[0]&&(a[1]>3&&console.error("通过格子超过3个，检查是否有异常"+a[2]+","+a[3],o),GameMap.point2Grip(e.x)==a[2]&&GameMap.point2Grip(e.y)==a[3]?(o.x=e.x,o.y=e.y):(o.x=GameMap.grip2Point(a[2]),o.y=GameMap.grip2Point(a[3]))),o.x=Math.max(Math.min(o.x,GameMap.MAX_WIDTH),0),o.y=Math.max(Math.min(o.y,GameMap.MAX_HEIGHT),0);var r=o.x-e.x,l=o.y-e.y,h=Math.sqrt(r*r+l*l)/(t.moveSpeed/1e3),u=GlobalConfig.EffectsConfig[i.tarEff[0]].duration;if(e.addHardStraight(u),h>0){var p=egret.Tween.get(e.moveTweenObj);p.to({x:o.x,y:o.y},h)}if(1==i.teleport&&(i&&i.actionType&&t.playAction(i.actionType),t.stopMove(),h>0)){var p=egret.Tween.get(t.moveTweenObj);p.to({x:t.x-(e.x-o.x),y:t.y-(e.y-o.y)},h).call(function(){t.stopMove(),t.resetStand()}),t.addHardStraight(h)}}},e.prototype.checkTriggerAttr=function(t,e,i,n,s){if(void 0===n&&(n=1),void 0===s&&(s=0),Math.random()<n){var o=t.infoModel,a=o.handle,r=this.attrCD[a]=this.attrCD[a]||{},l=e+"_"+i,h=s?s:0==e?o.getAtt(i):o.getExAtt(i),u=r[l]||0,p=egret.getTimer();if(u&&h>p-u)return;r[l]=p;var c=this.attrValue[a]=this.attrValue[a]||{};c[l]=1}},e.prototype.getIsTriggerAttr=function(t,e,i,n){void 0===n&&(n=0);var s=t.infoModel,o=this.attrValue[s.handle];if(o){var a=e+"_"+i,r=o[a];return o[a]=n,r}return 0},e.prototype.addSelfReviseSkillEffect=function(t,e){if(e.selfEff)for(var i in e.selfEff){var n=e.selfEff[i],s=GlobalConfig.EffectsConfig[n];if(s){var o=this.getArgs(n,e,null),a=EntityBuff.createBuff(n,t,o);t.addBuff(a)}}},e.prototype.addTargetReviseSkillEffect=function(t,e,i){if(i.targetEff)for(var n in i.targetEff){var s=i.targetEff[n],o=GlobalConfig.EffectsConfig[s];if(o){var a=this.getArgs(s,i,null),r=EntityBuff.createBuff(s,e,a);t.addBuff(r)}}},e.prototype.tryUsePassiveSkill=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=0);var s=i?e:t,o=i?t:e;if(s instanceof CharRole){var a=this.getCanUseSkillList(s,!1);if(!a||0==a.length)return;for(var r=[],l=0,h=a;l<h.length;l++){var u=h[l],p=u.config.passive;if(!(p.p1&&s.infoModel.getAtt(AttributeType.atHp)/s.infoModel.getAtt(AttributeType.atMaxHp)>p.p1/1e4))switch(p.cond){case 0:i||GameLogic.triggerValue(p.rate)&&r.push(u);break;case 1:i&&GameLogic.triggerValue(p.rate)&&r.push(u);break;case 2:i||2!=(2&n)||GameLogic.triggerValue(p.rate)&&r.push(u);break;case 3:i&&2==(2&n)&&GameLogic.triggerValue(p.rate)&&r.push(u)}}if(!r.length)return;for(var c=0,d=r;c<d.length;c++){var g=d[c],f=void 0;if(g.targetType!=TargetType.Enemy)f=s;else if(o&&o.infoModel.getAtt(AttributeType.atHp)>0)f=o;else{var v=EntityManager.ins().screeningTargetByPos(s,!1,0,g.affectRange,this.aiList);f=v&&v[0]}if(f){var y=s.infoModel.handle;this.skillCD[y]=this.skillCD[y]||{},this.skillCD[y][g.id]=egret.getTimer(),this.useSkill(s,f,g)}}}},e.prototype.tryUseWarSpiritSkill=function(t,e,i){var n=ObjectPool.pop("SkillData");n.configID=e;var s;if(n.targetType!=TargetType.Enemy)s=t;else{var o=EntityManager.ins().screeningTargetByPos(t,!1,0,n.affectRange,this.aiList);s=o[0]}if(s){var a=t.infoModel.handle;this.skillCD[a]=this.skillCD[a]||{},this.skillCD[a][n.id]=egret.getTimer(),this.useSkill(t,s,n)}},e.prototype.tryUseWingSkill=function(t,e,i){var n=this.checkWingEffect(t,e,i);if(n.length)for(var s=0,o=n;s<o.length;s++){var a=o[s],r=ObjectPool.pop("SkillData");r.configID=a;var l=void 0;if(r.targetType!=TargetType.Enemy)l=t;else{var h=EntityManager.ins().screeningTargetByPos(t,!1,0,r.affectRange,this.aiList);l=h[0]}if(l){var u=t.infoModel.handle;this.skillCD[u]=this.skillCD[u]||{},this.skillCD[u][r.id]=egret.getTimer(),this.useSkill(t,l,r)}}},e.prototype.checkWingEffect=function(t,e,i){void 0===i&&(i=!1);var n=t.infoModel.wingSkillData,s=[];if(e.isPassive)return s;for(var o=this.skillCD[t.infoModel.handle],a=0,r=n;a<r.length;a++){var l=r[a],h=ObjectPool.pop("SkillData");h.configID=l,o&&o[h.id]&&egret.getTimer()-o[h.id]<h.cd||(0!=h.config.passive.cond||i?1==h.config.passive.cond&&i&&GameLogic.triggerValue(h.config.passive.rate)&&s.push(l):GameLogic.triggerValue(h.config.passive.rate)&&s.push(l))}return s},e.prototype.tryUseYlPassiveSkill=function(t,e,i){var n=t.infoModel;if(n.lyMarkLv&&n.lyMarkSkills)for(var s=0;s<n.lyMarkSkills.length;s++){var o=n.lyMarkSkills[s]||0;if(o){var a=GlobalConfig.FlameStampEffect[s+1][o];if(a.effId){var r=GlobalConfig.EffectsConfig[a.effId];if(r.probabilityBuff&&GameLogic.triggerValue(r.probabilityBuff)){var l=EntityBuff.createBuff(a.effId,t);
e.addBuff(l)}}if(a.selfEffId){var r=GlobalConfig.EffectsConfig[a.selfEffId];if(r.probabilityBuff&&GameLogic.triggerValue(r.probabilityBuff)){var l=EntityBuff.createBuff(a.selfEffId,t);t.addBuff(l)}}}}},e.prototype.tryTriggerHeirloomSkill=function(t,e,i){var n=null,s=80004,o=6666601,a=-1,r=0,l=t.infoModel.handle;for(var h in e){var u=e[h],p=u.infoModel.handle;if(t.team!=u.team&&(-1==a&&(a=0,(!this.skillCD[l]||!this.skillCD[l][o]||egret.getTimer()-this.skillCD[l][o]>=5e3)&&GameLogic.triggerAttr(t,AttributeType.atVamirePro)&&(a=1,this.skillCD[l]=this.skillCD[l]||{},this.skillCD[l][o]=egret.getTimer())),u instanceof CharRole&&!t.hasBuff(s)&&!n&&(!this.skillCD[p]||!this.skillCD[p][s]||egret.getTimer()-this.skillCD[p][s]>=5e3)&&GameLogic.triggerAttr(u,AttributeType.atCursePro))){var c=u.infoModel.heirloom.getInfoBySolt(2).lv,d=[80004,80005,80006,80007][c-1];n=ObjectPool.pop("EntityBuff"),n.effConfig=GlobalConfig.EffectsConfig[d],n.value=n.effConfig.args.a,n.addTime=egret.getTimer(),n.endTime=n.addTime+n.effConfig.duration,t.addBuff(n),u.addPaoPao(13),this.skillCD[p]=this.skillCD[p]||{},this.skillCD[p][s]=egret.getTimer()}}if(1==a){t.addPaoPao(14);for(var g=0,f=i;g<f.length;g++){var v=f[g];0==r&&(r=Math.floor(t.infoModel.getAtt(AttributeType.atVamirePen)/1e4*v[0].hramValue))}this.hramedDie(t,-r),this.showHram(!1,1,t,t,-r)}},e.prototype.tryUseWeaponSkill=function(t,e,i){if(t.AI_STATE!=AI_State.Die&&!(t.getRealHp()<=0)&&i){var n=GameLogic.triggerAttr(t,AttributeType.atBeAttAddHpPro);if(n){t.addPaoPao(16);var s=t.infoModel.getAtt(AttributeType.atBeAttAddHpVal);this.hramedDie(t,-s),this.showHram(!1,1,t,t,-s)}if(t.infoModel.getAtt(AttributeType.atHpLtAddBuff)&&t.infoModel.getAtt(AttributeType.atHp)/t.infoModel.getAtt(AttributeType.atMaxHp)<t.infoModel.getAtt(AttributeType.atHpLtAddBuff)/1e4){var o=this.skillCD[t.infoModel.handle],a=GlobalConfig.EffectsConfig[t.infoModel.getExAtt(40)];if(o&&o[40]&&egret.getTimer()-o[40]<t.infoModel.getExAtt(41))return;t.addPaoPao(18);var r=ObjectPool.pop("EntityBuff");r.effConfig=a,r.value=r.effConfig.args.a,r.addTime=egret.getTimer(),r.endTime=r.addTime+r.effConfig.duration,t.addBuff(r),this.skillCD[t.infoModel.handle]=this.skillCD[t.infoModel.handle]||{},this.skillCD[t.infoModel.handle][40]=egret.getTimer()}}},e.prototype.tryTriggerMijiBuqu=function(t){var e=t.infoModel;if(e.getExAtt(63)&&e.getAtt(AttributeType.atHp)/e.getAtt(AttributeType.atMaxHp)*1e4<e.getExAtt(62)){this.checkTriggerAttr(t,1,61,1);var i=this.getIsTriggerAttr(t,1,61);if(i){var n=EntityBuff.createBuff(e.getExAtt(63),t);t.addBuff(n),t.addPaoPao(23)}}},e.prototype.tryTriggerHungu=function(t){var e=t.infoModel,i=e.getAtt(AttributeType.atHunGuPro);if(i){this.checkTriggerAttr(t,0,AttributeType.atHunGuCd,i/1e4);var n=this.getIsTriggerAttr(t,0,AttributeType.atHunGuCd);return n&&BubbleFactory.ins().playBubbleEffect(24),n}},e.prototype.tryTriggerHeart=function(t){var e=t.infoModel;if(e.getAtt(AttributeType.atHearthCount)){var i=e.job,n=1e3;switch(i){case JobConst.ZhanShi:n*=15;break;case JobConst.FaShi:n*=17;break;case JobConst.DaoShi:n*=19}this.checkTriggerAttr(t,0,AttributeType.atHearthCount,1,n);var s=this.getIsTriggerAttr(t,0,AttributeType.atHearthCount);return s&&BubbleFactory.ins().playBubbleEffect(25),s}},e.prototype.petTryUsePassiveSkill=function(t,e){void 0===e&&(e=!0);var i=t.infoModel.masterHandle,n=EntityManager.ins().getEntityByHandle(i);if(n&&n.infoModel&&n.infoModel.getExAtt(47)){for(var s=36e3+n.infoModel.getExAtt(47),o=[new SkillData(s)],a=[],r=0,l=o;r<l.length;r++){var h=l[r];0!=h.config.passive.cond||e?1==h.config.passive.cond&&e&&GameLogic.triggerValue(h.config.passive.rate)&&a.push(h):GameLogic.triggerValue(h.config.passive.rate)&&a.push(h)}if(!a.length)return;for(var u=0,p=a;u<p.length;u++){var c=p[u],d=void 0;if(c.targetType!=TargetType.Enemy)d=t;else{var g=EntityManager.ins().screeningTargetByPos(t,!1,0,c.affectRange,this.aiList);d=g[0]}if(d){var f=t.infoModel.handle;this.skillCD[f]=this.skillCD[f]||{},this.skillCD[f][c.id]=egret.getTimer(),this.useSkill(t,d,c)}}}},e.prototype.showBuffHarm=function(t,e,i,n){var s=GameLogic.calculateRealAttribute(e,AttributeType.atAddEnemyHp,t);s>0&&(s=-s,this.hramedDie(t,s),t instanceof CharRole&&this.showHram(!1,0,t,t,s));var o=GameLogic.calculateRealAttribute(t,AttributeType.atHurtMyself,e);if(o){var a=Math.floor(n*o/1e4),r=this.hramedDie(t,a);this.showHram(r,0,t,e,a)}},e.prototype.hramedDie=function(t,e){var i=t.infoModel.getAtt(AttributeType.atHp)-e;if(0>e){var n=t.infoModel.getAtt(AttributeType.atMaxHp);i=i>n?n:i}return t.infoModel.setAtt(AttributeType.atHp,i),t.infoModel.getAtt(AttributeType.atHp)<=0},e.prototype.showHram=function(t,i,n,s,o,a){var r=this;if(void 0===a&&(a=""),n&&n.infoModel)if(this.trace(n.infoModel.handle+" -- 受到"+o+", 当前剩余血量:"+n.getHP()+"	--"+a),n.hram(o),GameLogic.ins().postEntityHpChange(n,s,i,o),t){if(n.removeAllFilters(),n.stopMove(),n.myKill&&!(n instanceof CharRole)){var l=TaskCT.ins().taskTrace;if(l){var h=TaskCT.ins().getAchieveConfById(l.id);!h||h.type!=e.SEND_TASK_TYPE&&h.type!=e.SEND_TASK_TYPE2||FbCT.ins().sendKillMonster(n.infoModel.configID)}}if(!n.hasBuff(52001)&&GameLogic.triggerExAttr(n,3)){n.AI_STATE=AI_State.Stand,n.removeAllBuff();var u=n.infoModel.getAtt(AttributeType.atMaxHp)*n.infoModel.attributeExData[4]/1e4;n.infoModel.setAtt(AttributeType.atHp,u),n.hram(-u),this.trace("复活后剩余血量"+n.getHP()),n.addPaoPao(7)}else if(this.trace(n.infoModel.handle+" -- 死亡，等待删除形象"),s&&s.team==Team.My&&this.checkPlayDieSound(n),Timer.start(500,1,function(){if(r.trace(n.infoModel.handle+" -- 删除"),EntityManager.ins().removeByHandle(n.infoModel.handle,!1,n.myKill&&n.infoModel.type==EntityType.Monster),n.infoModel.type==EntityType.Role){var t=EntityManager.ins().getEntityBymasterhHandle(n.infoModel.masterHandle);if(!t){var e=EntityManager.ins().getMasterList(n.infoModel.masterHandle);if(e&&e.length)for(var i=0,o=e;i<o.length;i++){var a=o[i];EntityManager.ins().removeByHandle(a.infoModel.handle)}}}if(delete r.hashHpObj[n.hashCode],n.onDead(function(){n.deadDelay(),r.clearTarget(n);var t=egret.Tween.get(n.dieTweenObj);t.wait(1e3).to({alpha:0},1e3).call(function(){DisplayUtils.removeFromParent(n)})}),n.team==Team.Monster){var l=EntityManager.ins().getTeamCount(Team.Monster);l<=FbCT.ins().rCount&&FbCT.ins().guanqiaID<1e5&&GameLogic.ins().createGuanqiaMonster(!1)}r.checkAIend(s,n)},this),n.team==Team.Monster){var p=EntityManager.ins().getTeamCount(Team.Monster);if(p<=FbCT.ins().rCount&&GameLogic.ins().createGuanqiaMonster(!1),s.team==Team.My){var c=SubRoles.lookAtTar,d=n.infoModel.configID==FbCT.ins().eliteMonsterId;if(c&&(d||s.infoModel.handle==c.infoModel.handle)&&0==GameMap.fubenID){var g=Math.floor(n.x/GameMap.CELL_SIZE),f=Math.floor(n.y/GameMap.CELL_SIZE),v=void 0;if(d?v=FbCT.ins().eliteRewards.shift():(v=FbCT.ins().getRewardsPop(),FbCT.ins().rewards=[]),v&&v.length>0){for(var y=0;y<v.length&&8>y;y++)Encounter.ins().postCreateDrop(g,f,v[y].drops[0]);var m=function(){FbCT.ins().sendGetReward(d)};DropHelp.addCompleteFunc(m,this),DropHelp.start()}FbCT.ins().exp>0&&(!v||0==v.length)&&(FbCT.ins().sendGetReward(d),FbCT.ins().exp=0)}var T=EntityManager.ins().screeningTargetByPos(s,!1,0,Number.MAX_VALUE,this.aiList);if(!T||0==T.length)for(var C=EntityManager.ins().getEntityByTeam(Team.My),b=0,I=C;b<I.length;b++){var w=I[b];w.playAction(EntityAction.STAND)}}for(var S in this.curTarget)if(this.curTarget[S]==n){var w=EntityManager.ins().getEntityByHandle(S);w&&w.infoModel&&++w.infoModel.killNum;break}if(s.team==Team.Faker){var _=Encounter.ins().wildPersonList[s.infoModel.masterHandle],B=s.infoModel.killNum++;_&&1==_.actionType&&B>=_.killNum&&GameMap.moveEntity(s,_.backX,_.backY)}}}else n.AI_STATE!=AI_State.Die&&o>0,ExSkillAiLogic.ins().checkHPTrigger(n,s)},e.prototype.checkAIend=function(t,e){var i=EntityManager.ins().getTeamCount(e.team);if(!i&&null!=t){switch(t.team){case Team.My:switch(e.team){case Team.Monster:this.trace("开始捡东西");break;case Team.WillBoss:Encounter.ins().sendResult(!0),this.trace("遭遇boss成功");break;case Team.WillEntity:if(this.trace("遭遇敌人成功"),!EntityManager.ins().getTeamCount(Team.My))return;GameMap.sceneInMine()?MineFight.ins().fightEnd(!0):EncounterFight.ins().sendFightResult(1);break;case Team.Faker:var n=Encounter.ins().wildPersonList[e.infoModel.masterHandle];n&&Encounter.ins().sendWildPeopleResult(n.index,1)}Encounter.ins().isGuiding&&(Encounter.ins().isGuiding=!1,Encounter.ins().postEncounterDataChange()),EntityManager.ins().resetRole();break;case Team.WillBoss:Encounter.ins().sendResult(!1),this.trace("遭遇boss失败");break;case Team.WillEntity:if(this.trace("遭遇敌人失败"),!EntityManager.ins().getTeamCount(Team.WillEntity))return;GameMap.sceneInMine()?MineFight.ins().fightEnd(!1):EncounterFight.ins().sendFightResult(0);break;case Team.Faker:var s=Encounter.ins().wildPersonList[t.infoModel.masterHandle];Encounter.ins().sendWildPeopleResult(s.index,0);break;case Team.Monster:EntityManager.ins().resetRole()}this.getPickAI()}},e.prototype.checkPlayDieSound=function(t){var e,i=t.infoModel?t.infoModel.configID:0;!SoundUtil.WINDOW_OPEN&&i&&(e=FbCT.ins().guanqiaMonster[i],e=e||GlobalConfig.MonstersConfig[i],e&&e.sound&&SoundUtil.play(e.sound))},e.prototype.getPickAI=function(){this.inited&&!Encounter.ins().isEncounter()&&this.stopAITimer()},e.prototype.getTeamCount=function(t){var e=0;for(var i in this.aiList){var n=this.aiList[i];n.team==t&&(e+=1)}return e},e.prototype.stopAITimer=function(){Timer.stop(this.startAI,this),Timer.stop(this.startZhanLing,this)},e.prototype.addAITimer=function(){Timer.has(this.startAI,this)||(Timer.start(e.AI_UPDATE_TIME,0,this.startAI,this),this.addZhanLingTimer())},e.prototype.addZhanLingTimer=function(){this.zhanlingTime=egret.getTimer(),this.zhanlingdelayTime=egret.getTimer(),Timer.start(1e3,0,this.startZhanLing,this)},e.prototype.getArgs=function(t,e,i){var n=GlobalConfig.EffectsConfig[t],s=0,o=0,a=0;if(e&&e.args)for(var r=0,l=e.args;r<l.length;r++){var h=l[r];8==h.type&&h.vals[0]==n.group&&(s+=h.vals[2]||0,o+=h.vals[4]||0,a+=h.vals[1]||0),6==h.type&&(s+=h.vals[0]||0)}if(i&&i.args)for(var u=0,p=i.args;u<p.length;u++){var h=p[u];8==h.type&&h.vals[0]==n.group&&(s+=h.vals[2]||0,o+=h.vals[4]||0,a+=h.vals[1]||0),6==h.type&&(s+=h.vals[0]||0)}return{a:s,b:0,c:o,time:a}},e.prototype.skillEffValue=function(t,e,i){var n=0,s=0,o=0;if(i&&(s=i.a||0,o=i.c||0),e){if(e.args)switch(e.type){case 1:n=t.infoModel.getAtt(e.args.b)*(e.args.a+s)+(e.args.c||0)+o;break;case 2:n=t.infoModel.getAtt(e.args.b)*(e.args.a+s)+(e.args.c||0)+o,n=-n;break;case 3:case 7:n=t.infoModel.getAtt(e.args.b)*(e.args.a+s)+(e.args.c||0)+o;break;case 4:if(2==e.args.i)n=t.infoModel.getAtt(e.args.b)*(e.args.a+s)+(e.args.c||0)+o;else{var a=e.args.c?(e.args.c||0)+o:1+o;n=t.infoModel.getAtt(e.args.b)*a}}n>>=0}return n},e.prototype.checkTeamDistan=function(t,e,i){void 0===i&&(i=5);var n=MathUtils.getDistance(t.x,t.y,e.x,e.y);return n<i*GameMap.CELL_SIZE},e.prototype.tryUseSkill=function(t){var e=t.infoModel.handle,i=this.curSkill[e],n=this.curTarget[e];if(!i)return!1;var s=MathUtils.getDistance(t.x,t.y,n.x,n.y);return s<i.castRange*GameMap.CELL_SIZE},e.prototype.screeningSkill=function(t){var e=this.aiList[t];if(this.skillCD[t]=this.skillCD[t]||{},e.team==Team.My){var i=SubRoles.lookAtTar;if(i&&i!=e&&!this.checkTeamDistan(e,i,10))return void(this.curSkill[t]=null)}var n=this.curSkill[t];if(n&&egret.getTimer()-this.skillCD[t][n.id]<n.cd&&(this.curSkill[t]=null),!this.curSkill[t]){var s=this.getCanUseSkillList(e);if(s){var o,a=0,r=s[a];if(o=r&&r.tarEff?GlobalConfig.EffectsConfig[r.tarEff[0]]:null,o&&5==o.type&&e.hasBuff(o.group)&&(r=s[++a]),o=r&&r.tarEff?GlobalConfig.EffectsConfig[r.tarEff[0]]:null,o&&2==o.type&&(EntityManager.ins().checkCanAddBlood(e.team)||(r=s[++a])),r&&25e3==r.id){var l=this.curTarget[e.infoModel.handle];l&&l.AI_STATE!=AI_State.Die||(l=e),(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(l,r.affectRange,2,l.team!=e.team))&&(r=s[++a])}r&&13e3==r.id&&(Encounter.ins().isEncounter()||MineFight.ins().isFighting||!EntityManager.ins().checkCount(e,r.affectRange,2))&&(r=s[++a]),this.curSkill[t]=r}}},e.prototype.getCanUseSkillList=function(t,e){void 0===e&&(e=!0);var i=[];if(t instanceof CharRole&&t.infoModel){if(Assert(t.infoModel.skillsData,"角色技能为空，isMy:"+t.isMy+",fbType:"+GameMap.fbType+",fubenId:"+GameMap.fubenID))return;if(i=t.infoModel.skillsData.concat(),t.team==Team.My){var n=GodWeaponCC.ins().getJobGWNewSkill(t.infoModel.job);n&&(i=i.concat(n));var s=t.infoModel.index,o=JadeNew.ins().getJadeDataByID(s);o&&(i=i.concat(o.getSkillList())),i=i.concat(t.infoModel.getThunderSkillList()),i=i.concat(t.infoModel.getLegendSkill()),i=i.concat(t.infoModel.getPowerEquipSkill())}else{var o=t.infoModel.jadeData;o&&(i=i.concat(o.getSkillList()))}i=i.concat(ExtremeEquipModel.ins().getZhiZunSkills(t.infoModel))}else if(t.team==Team.My)if(SpecialRing.ins().isFireRing(t.infoModel.handle)){var a=SpecialRing.ins().getRingSkill();if(a){var r=ObjectPool.pop("SkillData");r.configID=a,i.push(r)}if(a=LyMark.ins().getCurSkillID()){var r=ObjectPool.pop("SkillData");r.specialCD=LyMark.ins().getCurSkillCD(),r.configID=a,i.push(r)}}else{var r=ObjectPool.pop("SkillData");r.configID=80001;var n=GodWeaponCC.ins().getReviseBySkill(35e3);n&&n.length&&(r.configID=80002),i.push(r)}else{var r=ObjectPool.pop("SkillData");r.configID=50001,i.push(r)}if(i&&0!=i.length){var l=t.infoModel.handle;this.skillCD[l]=this.skillCD[l]||{};var h=i.length;if(0!=h){for(var u=[],p=0;h>p;p++)if(i[p].canUse&&e!=i[p].isPassive){var c=0;if(t.team==Team.My){var d=Artifact.ins().getReviseBySkill(i[p].id);d&&d.cd&&(c+=d.cd);var n=GodWeaponCC.ins().getReviseBySkill(i[p].id),g=void 0;n&&(g=n[0]),g&&g.cd&&(c+=g.cd)}egret.getTimer()-this.skillCD[l][i[p].id]<i[p].cd-c||u.push(i[p])}return u.sort(this.sortFunc),u}}},e.prototype.damageBaseCalculation=function(t,e,i){var n,s=0,o=0,a=0,r=JobConst.None,l=(JobConst.None,!1),h=!1,u=t.infoModel,p=0,c=0,d=0,g=0,f=0;if(t.team==Team.My){var v=Artifact.ins().getReviseBySkill(i.id);if(v&&(p=v.a||0,c=v.b||0,g=v.d||0,v.selfEff))for(var y in v.selfEff)n=t.buffList[v.selfEff[y]],n&&3==n.effConfig.type&&(f+=n.value);var m=GodWeaponCC.ins().getReviseBySkill(i.id),T=void 0;if(m&&(T=m[0]),T&&(p+=T.a||0,c+=T.b||0,g+=T.d||0,T.selfEff))for(var y in T.selfEff)n=t.buffList[T.selfEff[y]],n&&3==n.effConfig.type&&(f+=n.value)}if(i.preId&&GlobalConfig.FlameStamp.skillId.indexOf(i.preId)>=0){var C=u.lyMarkLv||0;if(C){var b=GlobalConfig.FlameStampLevel[C];b&&(p+=b.bulletDamage.a,c+=b.bulletDamage.b)}var I=u.lyMarkSkills||[];if(C=I[6]||0){var b=GlobalConfig.FlameStampEffect[7][C];b.bulletDamage&&(p+=b.bulletDamage.a||0,c+=b.bulletDamage.b||0)}}if(l=t instanceof CharRole?!0:!1,h=e instanceof CharRole?!0:!1,s=l&&r?r==JobConst.ZhanShi?GameLogic.calculateRealAttribute(e,AttributeType.atDef,t):GameLogic.calculateRealAttribute(e,AttributeType.atRes,t):GameLogic.calculateRealAttribute(e,AttributeType.atDef,t),o=s*(1-u.getAtt(AttributeType.atPenetrate)/1e4),3==i.calcType){if(i.args){var w=0;if(t.team==Team.My)for(var S=SubRoles.ins().subRolesLen,_=0;S>_;_++){var B=SubRoles.ins().getSubRoleByIndex(_);B&&(w+=B.getAtt(AttributeType.atAttack))}else if(t.team==Team.WillEntity)for(var D=HejiUseMgr.ins().getRoles(),S=D.length,_=0;S>_;_++){var B=D[_];B&&(w+=B.getAtt(AttributeType.atAttack))}w=Math.max(w-o,.05*w);var x=i.args.b?i.args.b+c:0+c;a=w*(i.args.a+p)+x+d,a=Math.max(a,.05*w),a=e instanceof CharRole?Math.floor(a*(1+u.getExAtt(22)/1e4)):Math.floor(a*(1+u.getExAtt(21+g)/1e4)),a=Math.floor(a*(1-u.getExAtt(20)/1e4));var R=GameLogic.calculateRealAttribute(t,AttributeType.atRoleDamageEnhance,t);R-=GameLogic.calculateRealAttribute(e,AttributeType.atRoleDamageReduction,t),R-=GameLogic.calculateRealAttribute(e,AttributeType.atDamageReduction,t),a=Math.floor(a*(1+R/1e4)),a+=u.getAtt(AttributeType.atTogetherHolyDamege)*(1+u.getAtt(AttributeType.atTogetherHolyMaster)/1e4-e.infoModel.getAtt(AttributeType.atTogetherHolyResist)/1e4)}}else if(i.targetType==TargetType.Enemy&&i.args){for(var E=0,A=Math.floor(i.id/1e3)%100,_=0;_<skillConst.baseSkillIndex.length;_++)A==skillConst.baseSkillIndex[_]&&(E=u.getExAtt(27));var w=u.getAtt(AttributeType.atAttack),P=GameLogic.calculateRealAttribute(t,AttributeType.atAttack,t);if(80002==i.configID){var k=this.gePetSkillAdd(t);P+=Math.floor(w*k/1e4)}var M=GameLogic.triggerAttr(t,AttributeType.atAttAddDamPro),L=0;M&&(L=u.getAtt(AttributeType.atAttAddDamVal),t.addPaoPao(15));var G=0;e.hasBuff(51001)&&u.getAtt(AttributeType.atAttMbAddDamPen)&&(G=u.getAtt(AttributeType.atAttMbAddDamPen),t.addPaoPao(17));var F=0;u.getAtt(AttributeType.atAttHpLtPenAddDam)&&e.infoModel.getAtt(AttributeType.atHp)/e.infoModel.getAtt(AttributeType.atMaxHp)<u.getAtt(AttributeType.atAttHpLtPenAddDam)/1e4&&(F=u.getAtt(AttributeType.atAttHpLtAddDamPen),this.hashHpObj[e.hashCode]||(t.addPaoPao(19),this.hashHpObj[e.hashCode]=1));var N=0;u.type==EntityType.Role&&e.infoModel.type==EntityType.Role&&(Encounter.ins().isEncounter()?N=EncounterFight.ins().getWeiSheHurt(t.isMy):MineFight.ins().isFighting&&(N=MineFight.ins().getWeiSheHurt(t.isMy)));var W=0;if(u.getExAtt(56)){var O=u.getAtt(AttributeType.atHp)/u.getAtt(AttributeType.atMaxHp)*1e4;O<u.getExAtt(56)&&(W=Math.floor((u.getExAtt(56)-O)/u.getExAtt(57))*u.getExAtt(58))}u.getExAtt(59)&&this.getIsTriggerAttr(t,1,60)&&(W+=u.getExAtt(59));var x=i.args.b?i.args.b+c:c;h&&i.args.c&&(d+=i.args.c*e.infoModel.getAtt(AttributeType.atHp)),P=Math.max(P-o,.05*P),a=P*(i.args.a+E+p)+x+d+L,a=Math.floor(a*(1+(g+G+F+N+W)/1e4));var R=GameLogic.calculateRealAttribute(t,AttributeType.atRoleDamageEnhance,t);R-=GameLogic.calculateRealAttribute(e,AttributeType.atRoleDamageReduction,t),R-=GameLogic.calculateRealAttribute(e,AttributeType.atDamageReduction,t),a=Math.floor(a*(1+R/1e4)),a=Math.max(a,.05*w)}var U=(105-10*Math.random())/100;return a*=U,Math.floor(a)},e.prototype.gePetSkillAdd=function(t){var e=t.infoModel.masterHandle,i=EntityManager.ins().getEntityByHandle(e);if(i&&i.infoModel&&i.infoModel.getExAtt(48)){var n=i.infoModel.getExAtt(48),s=0,o=EntityManager.ins().getTeamCount(t.team);return t.team==Team.My?s=SubRoles.ins().subRolesLen+1-o:t.team==Team.WillEntity&&(Encounter.ins().isEncounter()?s=EncounterFight.ins().getRoles().length+1-o:MineFight.ins().isFighting&&(s=MineFight.ins().getRoles().length+1-o)),n*s}return 0},e.prototype.damageBuff=function(t,e,i){t instanceof CharMonster&&(t.team==Team.Monster||t.team==Team.WillBoss)&&"神兽"!=t.infoModel.name&&(i=0);var n=e.buffList[19001];if(n){var s=n.effConfig,o=Math.floor(i*s.args.a);n.value-=o,n.value<=0&&e.removeBuff(n),i=i-o+(n.value<0?-n.value:0)}if(n=e.buffList[60002]){var s=n.effConfig,o=Math.floor(i*(s.args.c/1e4));i-=o}if(n=e.buffList[60004],n&&(i=0),e instanceof CharRole&&e.infoModel&&e.infoModel.exRingsData&&1==e.infoModel.exRingsData[1]){var a=e.infoModel.getAtt(AttributeType.atMp);if(a>0){var r=a-i;e.infoModel.setAtt(AttributeType.atMp,r>0?r:0),i=i-a>=0?i-a:0}}return n=e.buffList[80001],n&&i>0&&(i-=n.value,i=i>0?i:0),i},e.prototype.sortFunc=function(t,e){var i=t.job,n=GlobalConfig.SkillsSorderConfig[i];if(!n)return 0;var s=n.skillorder,o=s.length,a=s.length;for(var r in s)s[r]==t.id&&(o=+r),s[r]==e.id&&(a=+r);return Algorithm.sortAsc(o,a)},e.prototype.screeningTarget=function(t,e,i){void 0===e&&(e=Number.MAX_VALUE),void 0===i&&(i=!1);var n=t.infoModel.handle,s=this.curSkill[n],o=0;if(s&&(o=s.targetType),i||(i=o==TargetType.Friendly),!i&&this.lastTarget[n]){var a=EntityManager.ins().getEntityByHandle(this.lastTarget[n]);if(a&&a.parent&&a.AI_STATE!=AI_State.Die)return void(this.curTarget[n]=a)}var r=EntityManager.ins().screeningTargetByPos(t,i,0,e,this.aiList);switch(t.team){case Team.My:var l=this.checkMySubInList(r,!1,Team.Faker);this.curTarget[n]=l;break;case Team.Faker:var a=this.checkMySubInList(r);this.curTarget[n]=a;break;default:this.curTarget[n]=r?r[0]:null}!i&&this.curTarget[n]&&(this.lastTarget[n]=this.curTarget[n].infoModel.handle)},e.prototype.checkMySubInList=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=Team.My);for(var n=0;n<t.length;n++)if(e){if(t[n].team==i)return t[n]}else if(t[n].team!=i)return t[n];return null},e.prototype.trace=function(t){this.isLog&&console.warn(t)},e.prototype.startZhanLing=function(){this.zhanlingdelayTime&&egret.getTimer()-this.zhanlingdelayTime>GlobalConfig.ZhanLingConfig.delayTime&&(this.zhanlingdelayTime=0,this.checkShowZhanling()),egret.getTimer()-this.zhanlingTime>1e4&&this.checkShowZhanling()},e.AI_UPDATE_TIME=100,e.SEND_TASK_TYPE=68,e.SEND_TASK_TYPE2=110,__decorate([post()],e.prototype,"useSkill",null),e}(BaseClass);__reflect(RoleAI.prototype,"RoleAI");var Team;!function(t){t[t.My=0]="My",t[t.Monster=1]="Monster",t[t.WillEntity=2]="WillEntity",t[t.WillBoss=3]="WillBoss",t[t.NotAtk=4]="NotAtk",t[t.Faker=5]="Faker"}(Team||(Team={}));var TargetType;!function(t){t[t.Friendly=1]="Friendly",t[t.Enemy=2]="Enemy",t[t.My=3]="My"}(TargetType||(TargetType={}));var AI_State;!function(t){t[t.Stand=0]="Stand",t[t.Run=1]="Run",t[t.Atk=2]="Atk",t[t.Die=3]="Die",t[t.Patrol=4]="Patrol"}(AI_State||(AI_State={})),window.Team=Team,window.TargetType=TargetType,window.AI_State=AI_State,window.RoleAI=RoleAI;var BresenhamLine=function(){function t(){}return t.isAbleToThrough=function(t,e,i,n){var s=0,o=0,a=0,r=0,l=0,h=0,u=0,p=0,c=0,d=0,g=0,f=0,v=0,y=0;for(this.throughCheckResult||(this.throughCheckResult=new Array(4)),this.throughCheckResult[0]=0,this.throughCheckResult[1]=0,f=(n-e)/(i-t),v=n-f*i,l=i>t?1:-1,h=n>e?1:-1,s=t>>0,o=e>>0,a=i>>0,r=n>>0,u=a-s,u=(u^u>>31)-(u>>31),p=s,d=o,this.throughCheckResult[2]=p,this.throughCheckResult[3]=d,y=0;u>y;y++){for(p+=l,g=f*p+v,c=g>>0;d!=c;){if(d+=h,!GameMap.checkWalkable(p,d))return this.throughCheckResult;this.throughCheckResult[2]=p,this.throughCheckResult[3]=d}if(!GameMap.checkWalkable(p,c))return this.throughCheckResult;this.throughCheckResult[2]=p,this.throughCheckResult[3]=c}for(;d!=r;){if(d+=h,!GameMap.checkWalkable(p,d))return this.throughCheckResult;this.throughCheckResult[2]=p,this.throughCheckResult[3]=d}return this.throughCheckResult[0]=1,this.throughCheckResult},t.tileLine=function(t,e,i,n){for(var s=(n-e)/(i-t),o=n-s*i,a=i>t?1:-1,r=Math.abs(i-t),l=[],h=0;r>h;++h){var u=t+h*a>>0,p=s*u+o>>0;l.push(u),l.push(p)}return l},t.getPointOnLine=function(t,e,i,n,s){var o=0,a=0,r=0,l=0;return r=i-t,l=n-e,o=Math.sqrt(r*r+l*l),a=o+s,[Math.round(t+r*a/o),Math.round(e+l*a/o)]},t.shortenPath=function(e,i,n,s){var o,a=e,r=i,l=n[n.length-2],h=n[n.length-1],u=0,p=0;n.length>=4&&(a=n[n.length-4],r=n[n.length-3]),u=l-a,p=h-r,u*u+p*p>s*s?(o=t.getPointOnLine(a,r,l,h,-s),n[n.length-2]=o[0],n[n.length-1]=o[1]):n.length-=2},t}();__reflect(BresenhamLine.prototype,"BresenhamLine"),window.BresenhamLine=BresenhamLine;var AttributeData=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.type=t,this.value=e}return t.AttrAddition=function(e,i){if(!e||e.length<=0)return i?i.concat():null;if(!i||i.length<=0)return e?e.concat():null;for(var n=e.concat(i),s=[],o=n.length,a={},r=0;o>r;r++)void 0==a[n[r].type]&&(a[n[r].type]=0),a[n[r].type]+=n[r].value;for(var l in a)s.push(new t(+l,+a[l]));return s},t.AttrDel=function(e,i){for(var n=[],s=0;s<e.length;s++){var o=new t;o.type=0!=e[s].type?e[s].type:i[s].type,o.value=e[s].value-i[s].value,n.push(o)}return n},t.AttrMultiply=function(e,i){for(var n=[],s=0;s<e.length;s++){var o=new t;o.type=0!=e[s].type?e[s].type:i[s].type,o.value=e[s].value*(1+i[s].value/1e4),n.push(o)}return n},t.transformAttr=function(e){var i=[];for(var n in e){var s=new t;s.type=e[n].type,s.value=e[n].value,i.push(s)}for(var o=0;o<i.length-1;o++)for(var a=0;a<i.length-o-1;a++)if(i[a]<i[a+1]){var r=i[a+1];i[a+1]=i[a],i[a]=r}return i},t.getAttStr=function(e,i,n,s,o,a,r,l){void 0===i&&(i=4),void 0===n&&(n=1),void 0===s&&(s="+"),void 0===o&&(o=!1),void 0===a&&(a=!0);var h="";if(!e)return h;var u=0;if(e instanceof t)return this.getAttStrByType(e,i,s,o,a);if(!(e instanceof Array)){var p=[];for(var c in this.translate)if(!isNaN(e[c])){var d=new t;d.type=parseInt(this.translate[c]),d.value=e[c],p.push(d)}return this.getAttStr(p,i,n,s,o)}for(var g=e,f=g.length-1,v=0;v<g.length;v++)if(0!=g[v].type)if(g[v].type!=AttributeType.atHpEx&&g[v].type!=AttributeType.atAtkEx&&g[v].type!=AttributeType.atDamageReduction&&g[v].type!=AttributeType.atDefEx&&g[v].type!=AttributeType.atResEx){if(h+=this.getAttStrByType(g[v],i,s,o,a),r&&r.attr_add&&(h+="+"+Math.floor(g[v].value*(r.attr_add/100))),l&&(h+=l),f+u>v)for(var y=0;n>y;y++)h+="\n"}else u=-1;if(0>u){var m=h.lastIndexOf("\n");h=h.substring(0,m)}return h},t.getAttStr1=function(t,e){for(var i="",n=0;n<t.length;n++)i+=this.getAttStrByType1(t[n],e),n<t.length-1&&(i+=StringUtils.repeatStr("\n",e.emptyLine+1));return i},t.getAttStrByType1=function(e,i){void 0===i&&(i=null);var n=t.getAttrStrByType(e.type);i&&i.isInserte>0&&2==n.length&&(n=t.inserteBlank(n,i.isInserte));var s=e.type,o="";if(o=s==AttributeType.atCrit?e.value/100+"%":s==AttributeType.atTogetherHolyDamege||s==AttributeType.atHolyDamege?e.value.toString():s>=AttributeType.atHpEx?s==AttributeType.atStunTime?e.value/1e3+"秒":s==AttributeType.atAtkEx?e.value/100+"%":s==AttributeType.atStunPower||s==AttributeType.atStunRes||s==AttributeType.atHolyMaster||s==AttributeType.atHolyResist||s==AttributeType.atSkillHuntAddRate||s==AttributeType.atSkillReduceRate?(e.value/100).toFixed(1)+"%":s==AttributeType.atCritHurt||s==AttributeType.atRegeneration||s==AttributeType.atGoldAtk||s==AttributeType.atGoldDef||s==AttributeType.atWoodAtk||s==AttributeType.atWoodDef||s==AttributeType.atWaterAtk||s==AttributeType.atWaterDef||s==AttributeType.atFireAtk||s==AttributeType.atFireDef||s==AttributeType.atEarthAtk||s==AttributeType.atEarthDef||s==AttributeType.atDeadLyHurt||s==AttributeType.atZhuiMingVal||s==AttributeType.atCritHurtResist||s==AttributeType.atDeadLyHurtResist?(e.value>>0)+"":(e.value/100>>0)+"%":e.value.toString(),!i)return n+"+"+o;var a=StringUtils.addColor(n+i.sign,i.wordColor);i.isShowAttName&&(a=StringUtils.complementByChar(a,i.intervals));var r=a+StringUtils.addColor(o,i.attrColor);return r},t.getAttStrByType=function(e,i,n,s,o){void 0===i&&(i=4),void 0===n&&(n="+"),void 0===s&&(s=!0),void 0===o&&(o=!0);var a="";switch(o&&(a=s?StringUtils.complementByChar(t.getAttrStrByType(e.type),8*i):t.getAttrStrByType(e.type)),e.type){case AttributeType.atCrit:case AttributeType.atZhuiMingPro:a+=n+e.value/100+"%";break;case AttributeType.atStunTime:a+=n+e.value/1e3+"秒";break;case AttributeType.atJob1HpEx:case AttributeType.atJob2HpEx:case AttributeType.atJob3HpEx:case AttributeType.atHp:case AttributeType.atMp:case AttributeType.atMaxHp:case AttributeType.atMaxMp:case AttributeType.atAttack:case AttributeType.atDef:case AttributeType.atRes:case AttributeType.atMoveSpeed:case AttributeType.atAttackSpeed:case AttributeType.atRegeneration:case AttributeType.maxNeiGong:case AttributeType.atNeiGongRestore:case AttributeType.atJob1AtkEx:case AttributeType.atJob2AtkEx:case AttributeType.atJob3AtkEx:case AttributeType.atJob1DefEx:case AttributeType.atJob2DefEx:case AttributeType.atJob3DefEx:case AttributeType.atJob1ResEx:case AttributeType.atJob2ResEx:case AttributeType.atJob3ResEx:case AttributeType.atHolyDamege:case AttributeType.atTogetherHolyDamege:case AttributeType.atZhuiMingVal:case AttributeType.atCritHurt:case AttributeType.atDeadLyHurt:case AttributeType.atDeadLyHurtResist:case AttributeType.atCritHurtResist:case AttributeType.atHearthDamege:case AttributeType.atDblDef:case AttributeType.atDemonsSystemKillMonster:case AttributeType.atDemonsAtk:case AttributeType.atDemonsDef:case AttributeType.atGoldAtk:case AttributeType.atGoldDef:case AttributeType.atWoodAtk:case AttributeType.atWoodDef:case AttributeType.atWaterAtk:case AttributeType.atWaterDef:case AttributeType.atFireAtk:case AttributeType.atFireDef:case AttributeType.atEarthAtk:case AttributeType.atEarthDef:a+=n+e.value;break;default:a+=n+(e.value/100).toFixed(1)+"%"}return e.type==AttributeType.atYuPeiDeterDam&&(a="|C:0xFF0000&T:"+a+"|"),a},t.getExtAttStrByType=function(e,i,n,s,o){void 0===i&&(i=4),void 0===n&&(n="+"),void 0===s&&(s=!1),void 0===o&&(o=!0);var a="";return o&&(a=StringUtils.complementByChar(t.getExtAttrStrByType(e.type),8*i)),a+=4==e.type||3==e.type||12==e.type||5==e.type||31==e.type||32==e.type||33==e.type||16==e.type||17==e.type||18==e.type||19==e.type||20==e.type||26==e.type||21==e.type||22==e.type||14==e.type||15==e.type||15==e.type||6==e.type||90==e.type||91==e.type||92==e.type||93==e.type?n+e.value/100+"%":7==e.type?n+e.value/1e3+"秒":2==e.type?"":n+e.value},t.inserteBlank=function(t,e,i){void 0===i&&(i=1);for(var n=t.length,s="";e--;)s+=" ";var o="";switch(i){case 0:o=s+t;break;case 1:o=t.slice(0,n/2)+s+t.slice(n/2);break;case 2:o=t+s}return o},t.getAttrInfoByItemData=function(e,i){void 0===i&&(i=null);var n=GlobalConfig.EquipConfig[e.configID],s="",o=0;for(var a in this.translate)if(n[a]&&!(n[a]<=0)){s+=t.getAttrStrByType(this.translate[a])+": "+n[a];for(var r=0,l=0;l<e.att.length;l++)o=e.att[l].type,this.translate[a]==o&&(r+=e.att[l].value);if(r)s+=" +"+r;else if(i&&ItemUtil.getType(e.itemConfig)==ThunderEquipPanel.TYPE){for(var h=GlobalConfig.LeitingEquipConf,u=[],p=0,l=8;12>l;l++){var c=i.thunderData[l];c.configID&&(u[l-8]=1,h[c.configID].level>p&&(p=h[c.configID].level))}4==Object.keys(u).length&&p&&(s+=" +"+n[a]*GlobalConfig.LeitingEquipBaseConf.trimSuitAttrAdd[p-3][1]/1e4);var d=GlobalConfig.LeiTingSoulLevel[e.configID];if(d){var g=ThunderCT.getThundersAwakeLv(i,ItemUtil.getSubType(e.itemConfig));if(g>0){var f=d[g].attrs;for(var l in f)if(this.translate[a]==f[l].type){s+=" +"+f[l].value;break}}}}s+="\n"}return s},t.getAttrStrByType=function(t){var e="";switch(t){case AttributeType.atHp:e="当前生命";break;case AttributeType.atMp:e="当前魔法";break;case AttributeType.atMaxHp:e="生命";break;case AttributeType.atMaxMp:e="魔法";break;case AttributeType.atAttack:e="攻击";break;case AttributeType.atDef:e="物防";break;case AttributeType.atRes:e="魔防";break;case AttributeType.atCrit:e="暴击";break;case AttributeType.atTough:e="抗暴";break;case AttributeType.atMoveSpeed:e="移速";break;case AttributeType.atAttackSpeed:e="攻速";break;case AttributeType.atHpEx:e="生    命";break;case AttributeType.atAtkEx:e="攻    击";break;case AttributeType.atStunPower:e="麻痹几率";break;case AttributeType.atStunRes:e="麻痹抵抗";break;case AttributeType.atStunTime:e="麻痹时间";break;case AttributeType.atDamageReduction:e="伤害减免";break;case AttributeType.atCritHurt:e="暴击增伤";break;case AttributeType.atRegeneration:e="回血";break;case AttributeType.atCritEnhance:e="暴击伤害加强";break;case AttributeType.atRoleDamageEnhance:e="pvp伤害加深";break;case AttributeType.atRoleDamageReduction:e="[全制]受到所有职业伤害减少";break;case AttributeType.atDefEx:e="物理防御";break;case AttributeType.atResEx:e="法术防御";break;case AttributeType.atJob1HpEx:e="战士生命";break;case AttributeType.atJob2HpEx:e="法师生命";break;case AttributeType.atJob3HpEx:e="道士生命";break;case AttributeType.atNeiGongRestore:e="间隔3秒恢复内功值";break;case AttributeType.cruNeiGong:e="当前内功值";break;case AttributeType.maxNeiGong:e="内功值";break;case AttributeType.neigongAbsorbHurt:e="伤害吸收";break;case AttributeType.atJob1AtkEx:e="战士攻击";break;case AttributeType.atJob2AtkEx:e="法师攻击";break;case AttributeType.atJob3AtkEx:e="道士攻击";break;case AttributeType.atJob1DefEx:e="战士防御";break;case AttributeType.atJob2DefEx:e="法师防御";break;case AttributeType.atJob3DefEx:e="道士防御";break;case AttributeType.atJob1ResEx:e="战士魔防";break;case AttributeType.atJob2ResEx:e="法师魔防";break;case AttributeType.atJob3ResEx:e="道士魔防";break;case AttributeType.atYuPeiDeterDam:e="伤害加深";break;case AttributeType.atCritEnhanceResist:e="暴击伤害减免";break;case AttributeType.atHolyDamege:e="神圣伤害";break;case AttributeType.atHolyMaster:e="神圣精通";break;case AttributeType.atTogetherHolyDamege:e="合击神圣伤害";break;case AttributeType.atZhuiMingVal:e="无影伤害";break;case AttributeType.atHuiXinDamage:e="暴击加强";break;case AttributeType.atNeiGongEx:e="内功加成";break;case AttributeType.atDeadLyPro:e="致命一击";break;case AttributeType.atDeadLyMaster:e="致命增伤";break;case AttributeType.atDeadLyResist:e="致命减伤";
break;case AttributeType.atBladeMailPer:e="反伤";break;case AttributeType.atDefPen:e="物防穿透";break;case AttributeType.atResPen:e="魔防穿透";break;case AttributeType.atDeadLyHurt:e="致命一击伤害";break;case AttributeType.atDeadLyHurtResist:e="致命一击减伤";break;case AttributeType.atCritHurtResist:e="暴击减伤";break;case AttributeType.atHearthDamege:e="夺命追伤";break;case AttributeType.atDblDef:e="物防魔防";break;case AttributeType.atMojianVamirePro:e="魔剑吸血";break;case AttributeType.atStunSelf:e="麻痹自身";break;case AttributeType.atAttackSpeedPower:e="攻击速度倍率";break;case AttributeType.atAttMbReductionDamPen:e="麻痹减伤增加";break;case AttributeType.atShanghaiJiaShen:e="伤害加深";break;case AttributeType.atPenetrate:e="无视双防";break;case AttributeType.atDemonsSystemKillMonster:e="三角色攻击心魔BOSS伤害提升";break;case AttributeType.atDemonsSystemEyeHuntRate:e="三角色有几率秒杀心魔BOSS生命";break;case AttributeType.atDemonsSystemIdentify:e="提升鉴定获得高级稀有装备概率";break;case AttributeType.atDemonsSystemSnatchTreasure:e="提升心魔BOSS稀有道具掉落概率";break;case AttributeType.atDemonsAtk:e="心魔攻击";break;case AttributeType.atDemonsDef:e="心魔防御";break;case AttributeType.atSkillHuntAddRate:e="技能伤害增加";break;case AttributeType.atSkillReduceRate:e="技能伤害减免";break;case AttributeType.atAddHurtRateToType12Monster:e="对怪物伤害增加";break;case AttributeType.atAddDefRateToType12Monster:e="受怪物伤害减少";break;case AttributeType.atAddFinalHurtRate:e="最终伤害加深";break;case AttributeType.atAddFinalDefRate:e="最终伤害减免";break;case AttributeType.atHolyResist:e="神圣减免";break;case AttributeType.atGoldAtk:e="金攻击";break;case AttributeType.atGoldDef:e="金防御";break;case AttributeType.atWoodAtk:e="木攻击";break;case AttributeType.atWoodDef:e="木防御";break;case AttributeType.atWaterAtk:e="水攻击";break;case AttributeType.atWaterDef:e="水防御";break;case AttributeType.atFireAtk:e="火攻击";break;case AttributeType.atFireDef:e="火防御";break;case AttributeType.atEarthAtk:e="土攻击";break;case AttributeType.atEarthDef:e="土防御";break;case AttributeType.atPenetrateRes:e="穿透抵抗"}return e},t.getExtAttrStrByType=function(t){var e="";switch(t){case 0:e="反伤概率";break;case 1:e="反伤比率";break;case 2:e="攻击无视反伤效果，增加自身2%攻击力";break;case 3:e="神佑触发 概率";break;case 4:e="神佑复活万分比";break;case 5:e="死咒触发概率";break;case 6:e="死咒增加伤害";break;case 7:e="死咒效果展示时间";break;case 8:e="暴击率";break;case 9:e="AllCrit暴击触发后，持续的时间, 单位:秒";break;case 10:e="受到X次攻击时必定闪避";break;case 11:e="攻击X次必定产生暴击（暴击）";break;case 12:e="治疗戒指,攻击时候补血的概率";break;case 13:e="治疗戒指,攻击的时候补血数";break;case 14:e="[怒战]对战士伤害增加";break;case 15:e="[怒法]对法师伤害增加";break;case 16:e="[怒道]对道士伤害增加";break;case 17:e="[制战]受到战士伤害减少";break;case 18:e="[制法]受到法师伤害减少";break;case 19:e="[制道]受到道士伤害减少";break;case 20:e="合击受到的伤害减少";break;case 21:e="合击技能对怪物伤害";break;case 22:e="合击技能对玩家伤害";break;case 23:e="怒气恢复速度";break;case 24:e="伤害增加固定值";break;case 25:e="伤害减免固定值";break;case 26:e="闪避";break;case 27:e="基础及能额外系数加成";break;case 28:e="多重暴击几率";break;case 29:e="幸运一击的伤害加深";break;case 30:e="幸运一击的固定伤害加深";break;case 31:e="战士伤害";break;case 32:e="法师伤害";break;case 33:e="道士伤害";break;case 34:e="幸运一击的冷却时间";break;case 35:e="治疗戒指,攻击的时候补血的冷却时间";break;case 42:e="命中";break;case 67:e="连击对怪物的伤害加成";break;case 68:e="连击对所有角色的伤害加成";break;case 69:e="连击攻击恢复怒气加成";break;case 70:e="连击对战士的伤害加成";break;case 71:e="连击对法师的伤害加成";break;case 72:e="连击对道士的伤害加成";break;case 78:e="受到连击技能【劈星斩】的伤害减少";break;case 79:e="受到连击技能【断魂剑】的伤害减少";break;case 80:e="受到连击技能【风雷杀】的伤害减少";break;case 81:e="受到连击技能【乾坤一击】的伤害减少";break;case 90:e="合击技能伤害提升";break;case 91:e="合击怒气值概率提升";break;case 92:e="合击怒气值提升";break;case 93:e="合击暴击概率提升"}return e},t.getExAttrNameByAttrbute=function(e,i,n,s){void 0===i&&(i=!1),void 0===n&&(n="："),void 0===s&&(s=void 0);var o=t.getExtAttrStrByType(e.type),a="";if(i)switch(e.type){case 31:case 32:case 33:case 17:case 18:case 19:case 20:case 21:case 22:case 8:case 42:case 26:case 78:case 79:case 80:case 81:a=e.value/100+"%";break;default:a+=e.value}return void 0!=s?o=""+o+n+"|C:"+s+"&T:"+a+"|":o+=n+a,o},t.getEEquipAttrStrByType=function(t){var e="";switch(t){case 0:e="武器基础属性";break;case 1:e="头盔基础属性";break;case 2:e="衣服基础属性";break;case 3:e="项链基础属性";break;case 4:e="手镯基础属性";break;case 5:e="腰带基础属性";break;case 6:e="戒指基础属性";break;case 7:e="鞋子基础属性"}return e},t.getAttrStrAdd=function(e,i,n){void 0===n&&(n=Actor.vip);var s=[];if(n>=i){var o=VipCT.ins().getVipCfg(i),a=o.attrAddition.percent||0;e.forEach(function(e){var i=new t;i.type=e.type,i.value=e.value*(100+a)/100>>0,s.push(i)})}else s=e;return s},t.getAttrNameByAttrbute=function(e,i,n,s,o){void 0===i&&(i=!1),void 0===n&&(n="："),void 0===s&&(s=!1),void 0===o&&(o=void 0);var a=t.getAttrStrByType(e.type);s&&(a=t.inserteBlank(a,7));var r="";if(i)switch(e.type){case AttributeType.atCrit:case AttributeType.atTough:r=e.value/100+"%";break;default:r=e.value+""}return void 0!=o?a=""+a+n+"|C:"+o+"&T:"+r+"|":a+=n+r,a},t.getPercentAttr=function(e,i){for(var n=[],s=0;s<e.length;s++){var o=new t;o.type=e[s].type,o.value=Math.floor(e[s].value*(1+i)),n.push(o)}return n},t.sortAttribute=function(t,e){return Algorithm.sortAsc(t.type,e.type)},t.copyAttrbute=function(e){var i=new t;return i.type=e.type,i.value=e.value,i},t.addAttrToList=function(e,i){if(!e[i.type]){var n=new t;n.type=i.type,n.value=0,e[i.type]=n}var s=e[i.type];s.value+=i.value},t.combineAtts=function(e){if(!e||!e.length)return null;for(var i=[],n=e.length,s={},o=0;n>o;o++)void 0==s[e[o].type]&&(s[e[o].type]=0),s[e[o].type]+=e[o].value;for(var a in s)i.push(new t(+a,+s[a]));return i},t.getAttrFromCfg=function(e){var i=[];for(var n in t.translate)if(!(null==e[n]||e[n]<0)){var s=new t;s.type=parseInt(t.translate[n]),s.value=e[n],i.push(s)}return i},t.FILTER_EXTDATA_ID=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,35,37,38,39],t.FILTER_BASE_DATA_ID=[18,20],t.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},t.exRelate={2:AttributeType.atHpEx,4:AttributeType.atAtkEx,5:AttributeType.atDefEx,6:AttributeType.atResEx},t}();__reflect(AttributeData.prototype,"AttributeData"),window.AttributeData=AttributeData;var AttributeFormat=function(){function t(){this.intervals=4,this.emptyLine=0,this.sign="+",this.spaceCount=0,this.isShowAttName=1,this.isInserte=0,this.wordColor=t.DEFAULT_COLOR,this.attrColor=t.DEFAULT_COLOR}return t.getFormat=function(e,i,n,s,o,a,r){void 0===e&&(e=4),void 0===i&&(i=0),void 0===n&&(n="+"),void 0===s&&(s=0),void 0===o&&(o=1),void 0===a&&(a=this.DEFAULT_COLOR),void 0===r&&(r=this.DEFAULT_COLOR);var l=new t;return l.intervals=e,l.emptyLine=i,l.sign=n,l.spaceCount=s,l.isShowAttName=o,l.wordColor=a,l.attrColor=r,l},t.FORMAT_1=function(){return this.getFormat(0,0,"：")},t.FORMAT_2=function(){var t=this.FORMAT_1();return t.attrColor=3532333,t},t.DEFAULT_COLOR=14668213,t}();__reflect(AttributeFormat.prototype,"AttributeFormat"),window.AttributeFormat=AttributeFormat;var Keyboard=function(){function t(){}return t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.KC_1=49,t.KC_2=50,t.KC_3=51,t.KC_4=52,t.KC_5=53,t.KC_6=54,t.KC_7=55,t.KC_8=56,t.KC_9=57,t.KC_0=48,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.SPACE=32,t.BRACE_L=219,t.BACKSLASH=220,t.BRACE_R=221,t.BACK_QUOTE=192,t.ENTER=13,t.KC_BACKSPACE=8,t.KC_TAB=9,t.KC_ENTER=13,t.KC_SHIFT=16,t.KC_CONTROL=17,t.KC_ESCAPE=27,t.KC_SPACE=32,t.KC_WINDOWS=91,t.KC_MENU=93,t}();__reflect(Keyboard.prototype,"Keyboard");var Bezier=function(){function t(t,e){this._fromPoint=t,this._toPoint=e}return t.pop=function(e,i){var n=null;return this._pool.length?(n=this._pool.pop(),n.fromPoint=e,n.toPoint=i):n=new t(e,i),n},t.push=function(t){t&&(t.display=null,t.ease=null,t.fromPoint=null,t.toPoint=null,t.centerPoint=null,this._pool.push(t))},Object.defineProperty(t.prototype,"fromPoint",{set:function(t){this._fromPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toPoint",{set:function(t){this._toPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{set:function(t){this._display=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ease",{set:function(t){this._ease=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerPoint",{set:function(t){this._centerPoint=t},enumerable:!0,configurable:!0}),t.prototype.start=function(t,e,i,n){var s=this;void 0===n&&(n=0),egret.Tween.get(this).wait(n).to({factor:1},t,this._ease).call(function(){egret.Tween.removeTweens(s),e&&e.call(i)})},Object.defineProperty(t.prototype,"factor",{get:function(){return 0},set:function(t){this._display.x=(1-t)*(1-t)*this._fromPoint.x+2*t*(1-t)*this._centerPoint.x+t*t*this._toPoint.x,this._display.y=(1-t)*(1-t)*this._fromPoint.y+2*t*(1-t)*this._centerPoint.y+t*t*this._toPoint.y},enumerable:!0,configurable:!0}),t._pool=[],t}();__reflect(Bezier.prototype,"Bezier"),window.Bezier=Bezier;var EntityHideBody=function(t){function e(){var e=t.call(this)||this;return e.isOpen=!1,e.isShow=!1,e.showHandles=[],e.showNum=3,e.storageKey="hide_fbtype_",e.lastAtkHandle=0,e.lastFbID=0,e.observe(GameLogic.ins().postRemoveEntity,e.onRemoveEntity),e.observe(GameLogic.ins().postAtkTarget,e.onChangeTarget),e.observe(BossCT.ins().postRemainTime,e.onRoleDie),e.observe(CityCC.ins().postRemainTime,e.onRoleDie),e.observe(DevildomSys.ins().postRevive,e.onRoleDie),e.observe(KFBossSys.ins().postRevive,e.onRoleDie),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.changeScene=function(){this.lastFbID!=GameMap.fubenID&&(this.lastFbID=GameMap.fubenID,this.isOpen=this.getIsOpen(),this.showHandles.length=0,this.lastAtkHandle=0,this.isOpen&&(this.isShow=!SysSetting.ins().getBool(this.storageKey+GameMap.fbType)),GameMap.fbType==FbCT.FB_TYPE_SPIRIT&&(this.isOpen=!0),this.isOpen?ViewManager.ins().open(ShieldWin):ViewManager.ins().close(ShieldWin))},e.prototype.onCreateEntity=function(t){this.isOpen&&(t.isMy||t.type!=EntityType.Role||this.updateShowHandles(t.masterHandle,!0)&&this.sendHandlesToServer())},e.prototype.setShowState=function(t){this.isShow=t,this.showOrHideEntitys(this.isShow),this.sendHandlesToServer(),SysSetting.ins().setBool(this.storageKey+GameMap.fbType,!t)},e.prototype.checkIsShowBody=function(t){if(!this.isOpen)return!0;if(!this.isShow)return!1;var e=EntityManager.ins().getRootMasterHandle(t);return e?this.showHandles.indexOf(e)>=0:!0},e.prototype.onRemoveEntity=function(t){var e=(t[0],t[1]);this.isOpen&&!e.isMy&&e instanceof CharRole&&this.updateShowHandles(e.infoModel.masterHandle,!1)&&(this.sendHandlesToServer(),this.searchNewHandle())},e.prototype.updateShowHandles=function(t,e){if(e&&this.showHandles.length>=this.showNum)return!1;var i=this.showHandles.indexOf(t);if(e){if(-1==i)return this.showHandles.push(t),!0}else if(i>=0)return this.showHandles.splice(i,1),!0;return!1},e.prototype.onChangeTarget=function(){if(this.isOpen&&GameLogic.ins().currAttackHandle!=this.lastAtkHandle){var t=GameLogic.ins().currAttackHandle,e=this.lastAtkHandle;if(this.lastAtkHandle=t,this.isShow||(e&&this.hideEntity(e),t&&this.showEntity(t),this.sendHandlesToServer()),t&&!(this.showHandles.indexOf(t)>=0)){if(this.showHandles.length>=this.showNum){var i=this.showHandles.shift();this.hideEntity(i)}this.showHandles.push(t),this.showEntity(t),this.sendHandlesToServer()}}},e.prototype.onRoleDie=function(){if(this.isOpen){var t=this.lastAtkHandle;this.lastAtkHandle=0,this.isShow||t&&(this.hideEntity(t),this.sendHandlesToServer())}},e.prototype.searchNewHandle=function(){var t=EntityManager.ins().getAllEntity();for(var e in t){var i=t[e].infoModel;if(i&&!i.isMy&&i.type==EntityType.Role&&this.updateShowHandles(i.masterHandle,!0)){this.showEntity(i.masterHandle);break}}},e.prototype.showOrHideEntitys=function(t){for(var e=this.showHandles,i=0,n=e;i<n.length;i++){var s=n[i];t?this.showEntity(s):this.hideEntity(s)}},e.prototype.showEntity=function(t){for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,n=e;i<n.length;i++){var s=n[i];s.showBodyContainer()}},e.prototype.hideEntity=function(t){for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,n=e;i<n.length;i++){var s=n[i];s.hideBodyContainer()}},e.prototype.sendHandlesToServer=function(){var t=this.isShow?this.showHandles:this.lastAtkHandle?[this.lastAtkHandle]:[];GameLogic.ins().sendGetOtherAttr(t)},e.prototype.getIsOpen=function(){return!!GlobalConfig.ScenesConfig[GameMap.mapID].hideBodyEff},__decorate([callDelay(200)],e.prototype,"sendHandlesToServer",null),e}(BaseSystem);__reflect(EntityHideBody.prototype,"EntityHideBody"),window.EntityHideBody=EntityHideBody;var EntityManager=function(t){function e(){var e=t.call(this)||this;return e.entityList={},e.transferList={},e.mineList={},e._masterList={},e.distances=[],e.listCount=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getAllEntity=function(){return this.entityList},e.prototype.resetRole=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i.name=Actor.myName,this.getEntityByHandle(i.handle)){var n=this.getEntityByHandle(i.handle);n.infoModel.setAtt(AttributeType.atHp,i.getAtt(AttributeType.atMaxHp)),n.infoModel.setAtt(AttributeType.atMp,i.getAtt(AttributeType.atMaxMp)),n.updateBlood(!0)}else i.setPos(DropHelp.tempDropPoint.x*GameMap.CELL_SIZE,DropHelp.tempDropPoint.y*GameMap.CELL_SIZE),console.log("--------------所有角色重置----------------"),i.setAtt(AttributeType.atHp,i.getAtt(AttributeType.atMaxHp)),i.setAtt(AttributeType.atMp,i.getAtt(AttributeType.atMaxMp)),GameLogic.ins().createEntityByModel(i,Team.My)}},e.prototype.addList=function(t){if(t.infoModel.handle||(t.infoModel.handle=t.hashCode),this.entityList[t.infoModel.handle]!=t){if(this.entityList[t.infoModel.handle]=t,t.infoModel.masterHandle){var e=t.infoModel.masterHandle;this._masterList[e]||(this._masterList[e]=[]),this._masterList[e].push(t)}t.infoModel.type==EntityType.Mine&&(this.mineList[t.infoModel.index]=t);var i=this.listCount[t.team]||0;this.listCount[t.team]=++i}},e.prototype.addTransfer=function(t){this.transferList[t.infoModel.configID]=t,SkillEffPlayer.bottomLayer.addChild(t)},e.prototype.removeTransferById=function(t){var e=this.transferList[t];e&&(delete this.transferList[t],DisplayUtils.removeFromParent(e))},e.prototype.getTransferById=function(t){return this.transferList[t]},e.prototype.getMineByIndex=function(t){return this.mineList[t]},e.prototype.removeMineByIndex=function(t){var e=this.mineList[t];e&&(delete this.mineList[t],e.infoModel&&this.removeByHandle(e.infoModel.handle))},e.prototype.createEntity=function(t,e){switch(t.type){case EntityType.Role:case EntityType.LadderPlayer:var i=t;e&&null!=e[0]?i.team=e[0]:t.masterHandle&&t.masterHandle==Actor.handle?i.team=Team.My:i.team=Team.WillEntity;var n=ObjectPool.pop("CharRole");if(n.reset(),i.masterHandle==Actor.handle){for(var s=void 0,o=SubRoles.ins().subRolesLen,a=0;o>a;a++)if(a==i.configID){s=a;break}SubRoles.ins().getSubRoleByIndex(s)&&(i=SubRoles.ins().getSubRoleByIndex(s).mergeData(i))}n.infoModel=i,n.x=i.x,n.y=i.y,this.addList(n),RoleAI.ins().canAddToAi()&&RoleAI.ins().add(n);var r=!0;if(i.team!=Team.My){if(!EntityShowMgr.ins().checkShowHandle(i.masterHandle))return n.hideBodyContainer(),n.updateModel(),null;r=EntityHideBody.ins().checkIsShowBody(i.masterHandle)}return r?n.showBodyContainer():n.hideBodyContainer(),n.updateModel(),n;case EntityType.Monster:case EntityType.CollectionMonst:e&&null!=e[0]?t.team=e[0]:t.masterHandle&&0!=t.masterHandle?t.isMy?t.team=Team.My:t.team=Team.WillEntity:t.team=Team.Monster;var l=ObjectPool.pop("CharMonster");l.reset(),l.infoModel=t,l.x=t.x,l.y=t.y,this.addList(l),RoleAI.ins().canAddToAi()&&RoleAI.ins().add(l);var r=!0;if(l.team!=Team.My&&t.masterHandle){var h=this.getRootMasterHandle(t.masterHandle),u=this.getMasterList(h);if(u)for(var p=0,c=u;p<c.length;p++){var d=c[p];if(l!=d&&!d.parent)return l.hideBodyContainer(),l.updateModel(),null}t.team==Team.WillEntity&&(r=EntityHideBody.ins().checkIsShowBody(t.masterHandle))}return r?l.showBodyContainer():l.hideBodyContainer(),l.updateModel(),l;case EntityType.DropItem:var g=ObjectPool.pop("CharItem2");return g.setData(t.itemData),g.x=t.x,g.y=t.y,g.infoModel=t,this.addList(g),g.addRoatEffect(),g.addFloatEffect(),g;case EntityType.MuBei:var f=ObjectPool.pop("CharImage");return f.infoModel=t,f.setData(SpiritBossCT.ins().bossIndex),this.addList(f),f;case EntityType.Transfer:var v=ObjectPool.pop("CharTransfer");return v.infoModel=t,this.addTransfer(v),v.updateModel(),v;case EntityType.Npc:var y=ObjectPool.pop("CharNpc");return y.infoModel=t,this.addList(y),y.updateModel(),y;case EntityType.Mine:var m=ObjectPool.pop("CharMiner");return m.infoModel=t,this.addList(m),m.updateModel(),m}return null},e.prototype.removeAll=function(){for(var t in this.entityList)this.removeByHandle(t);for(var t in this.transferList)this.removeTransferById(t);EncounterFight.ins().stop(),this.entityList={},this._masterList={},this.transferList={},this.listCount=[]},e.prototype.hideOtherEntity=function(t){this.isHideOther=t;for(var e in this.entityList)this.entityList[e].team==Team.WillEntity&&(t?DisplayUtils.removeFromParent(this.entityList[e]):GameLogic.ins().addEntity(this.entityList[e]))},e.prototype.getEntityRelationHandle=function(t){for(var e=this.getRootMasterHandle(t),i=this.getMasterList(e),n=[].concat(i||[]),s=0,o=n;s<o.length;s++){var a=o[s],r=a.infoModel;if(r&&r.job==JobConst.DaoShi){var l=this.getMasterList(r.handle);l&&(n=n.concat(l));break}}return n},e.prototype.removeByHandle=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1);var n=this.entityList[t];if(n){var s=n.infoModel.masterHandle;if(s){for(var o=this._masterList[s],a=0;o&&a<o.length;a++)if(o[a]==n){o.splice(a,1);break}o&&0==o.length&&delete this._masterList[s]}delete this.entityList[t];for(var a in this.entityList)this.entityList[a].infoModel.masterHandle&&this.entityList[a].infoModel.masterHandle==t&&this.removeByHandle(this.entityList[a].infoModel.handle);var r=this.listCount[n.team]||0;return this.listCount[n.team]=--r,n instanceof CharMonster&&n.stopMove(),egret.Tween.removeTweens(n),e&&DisplayUtils.removeFromParent(n),RoleAI.ins().remove(n),DropHelp.tempDropPoint.x=Math.floor(n.x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y=Math.floor(n.y/GameMap.CELL_SIZE),(GameMap.sceneInMain()||GameMap.fbType==FbCT.FB_TYPE_EXP)&&n.infoModel.type==EntityType.Monster&&i&&GameLogic.ins().postExpMc(n),n.infoModel.type==EntityType.Mine&&delete this.mineList[n.infoModel.index],n}},e.prototype.getEntityByHandle=function(t){return this.entityList[t]},e.prototype.getMasterList=function(t){return this._masterList[t]},Object.defineProperty(e.prototype,"masterList",{get:function(){return this._masterList},enumerable:!0,configurable:!0}),e.prototype.getRootMasterHandle=function(t){var e=this.getEntityByHandle(t);return e&&e.infoModel&&e.infoModel.masterHandle>0&&e.infoModel.masterHandle!=t?this.getRootMasterHandle(e.infoModel.masterHandle):t},e.prototype.getMainRole=function(t){return this.getEntityByHandle(SubRoles.ins().getSubRoleByIndex(t).handle)},e.prototype.getJobMainRole=function(t){var e,i=0;for(var n in SubRoles.ins().jobDic){if(i==t){e=SubRoles.ins().jobDic[n];break}i++}return this.getEntityByHandle(e.handle)},e.prototype.getMyOtherRolePos=function(t){var e=this.getEntityByTeam(Team.My),i=0,n={};for(var s in e){var o=e[s];if(o!=t){var a=[1,-1];2==e.length&&(a=[0]);var r=DirUtil.getGridByDir(t.dir+a[i]!=null?a[i]:0);i+=1,n[o.infoModel.handle]={x:t.x+r.x,y:t.y+r.y}}}return n[t.infoModel.handle]={x:t.x,y:t.y},n},e.prototype.getTeamCount=function(t){return MineFight.ins().isFighting||Encounter.ins().isEncounter()?RoleAI.ins().getTeamCount(t):this.listCount[t]||0},e.prototype.checkCount=function(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var s=0;for(var o in this.entityList){var a=this.entityList[o];if((!n&&a.team!=t.team||n&&a.team==t.team)&&MathUtils.getDistanceX2ByObject(t,a)<=Math.pow(e*GameMap.CELL_SIZE,2)&&(s++,s>=i))break}return s>=i},e.prototype.checkCanAddBlood=function(t){var e=!1;for(var i in this.entityList)this.entityList[i].team==t&&this.entityList[i].isCanAddBlood&&(e=!0);return e},e.prototype.getEntityBymasterhHandle=function(t){for(var e in this.entityList)if(this.entityList[e].infoModel&&this.entityList[e].infoModel.masterHandle&&this.entityList[e].infoModel.masterHandle==t&&this.entityList[e].infoModel.type!=EntityType.Monster)return this.entityList[e];return null},e.prototype.getEntitysBymasterhHandle=function(t,e){void 0===e&&(e=-1);var i=[];for(var n in this.entityList){if(i.length>=3)return i;this.entityList[n].infoModel&&this.entityList[n].infoModel.masterHandle&&this.entityList[n].infoModel.masterHandle==t&&(-1==e||e==this.entityList[n].infoModel.type)&&i.push(this.entityList[n])}return i},e.prototype.getEntityByTeam=function(t){void 0===t&&(t=Team.My);var e=[];for(var i in this.entityList)this.entityList[i].infoModel&&this.entityList[i].infoModel.team==t&&e.push(this.entityList[i]);return e},e.prototype.getEntityByMonsterId=function(t){var e=[];if(void 0==t)return e;for(var i in this.entityList)this.entityList[i].infoModel&&this.entityList[i].infoModel.configID==t&&e.push(this.entityList[i]);return e},e.prototype.screeningTargetByPos=function(t,e,i,n,s){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=Number.MAX_VALUE),void 0===s&&(s=this.entityList);var o=MathUtils.getDistanceX2ByObject,a=n;n!=Number.MAX_VALUE&&(a=n*GameMap.CELL_SIZE*(n*GameMap.CELL_SIZE)),this.distances.length=0;var r;for(var l in s){var h=s[l];if((!e||h.team==t.team)&&(e||h.team!=t.team)&&(t.team!=Team.My||h.team!=Team.Faker)&&(t.team!=Team.Faker||h.team==Team.Monster||h.team==Team.Faker)&&(h instanceof CharRole||h.team==Team.Monster||h.team==Team.WillBoss)&&h.AI_STATE!=AI_State.Die){if(Encounter.ins().isEncounter())if(Team.My==t.team){if(Team.WillEntity!=h.team||e){if(Team.My!=h.team||!e)continue}else if(!Encounter.ins().checkIsEncounter(EncounterFight.ins().encounterIndex,h.infoModel))continue}else if(Team.WillEntity==t.team)if(e&&Team.WillEntity==h.team);else if(e||EncounterFight.ins().willEntityFightTeam!=h.team)continue;r=o(t,h),r>a||this.distances.push({priority:r,target:h})}}this.distances.sort(this.sortFunc);var u=[],p=0;p=i?Math.min(this.distances.length,i):this.distances.length;for(var c=0;p>c;c++)u[c]=this.distances[c].target;return u},e.prototype.sortFunc=function(t,e){return t.priority>e.priority?1:t.priority<e.priority?-1:0},e.CHAR_DEFAULT_HEIGHT=118,e.CHAR_DEFAULT_TYPEFACE=110,__decorate([post()],e.prototype,"resetRole",null),e}(BaseClass);__reflect(EntityManager.prototype,"EntityManager"),window.EntityManager=EntityManager;var BitmapNumber=function(t){function e(){var e=t.call(this)||this;return e._imgPool=[],e._containerPool=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createNumPic=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s,o=this.getContainer(),a=t.toString(),r=0;for(r;r<a.length;r++)s=this.getSingleNumPic(a.charAt(r),e),o.addChild(s);return this.repositionNumPic(o,i,n),o},e.prototype.desstroyNumPic=function(t){this.clearContainer(t),t.parent&&t.parent.removeChild(t),this._containerPool.push(t)},e.prototype.changeNum=function(t,e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=0);var o=e.toString();if(t.numChildren>o.length)for(;t.numChildren>o.length;)this.recycleBM(t.getChildAt(t.numChildren-1));var a,r=0;for(r;r<o.length;r++)r>=t.numChildren&&t.addChild(this.getBitmap()),a=o.charAt(r),a="."==a?"dot":a,t.getChildAt(r).texture=this.getTexture(a,i);this.repositionNumPic(t,n,s)},e.prototype.repositionNumPic=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n,s=0,o=0;for(s;s<t.numChildren;s++)n=t.getChildAt(s),n.x=o-e,o=n.x+n.width},e.prototype.clearContainer=function(t){for(;t.numChildren;)this.recycleBM(t.getChildAt(t.numChildren-1))},e.prototype.recycleBM=function(t){t&&t.parent&&(t.parent.removeChild(t),t.texture=null,this._imgPool.push(t))},e.prototype.getContainer=function(){return this._containerPool.length?this._containerPool.shift():new egret.DisplayObjectContainer},e.prototype.getSingleNumPic=function(t,e){"."==t&&(t="dot");var i=this.getBitmap();return i.texture=this.getTexture(t,e),i},e.prototype.getTexture=function(t,e){return RES.getRes(e+t+"_png")},e.prototype.getBitmap=function(){return this._imgPool.length?this._imgPool.shift():new egret.Bitmap},e}(BaseClass);__reflect(BitmapNumber.prototype,"BitmapNumber");var MovieClip=function(t){function e(){var e=t.call(this)||this;return e.rate=1,e.pixelHitTest=!1,e.hitTestEnabled=!0,e._mcFactory=new egret.MovieClipDataFactory,e}return __extends(e,t),e.create=function(t,i,n,s){void 0===i&&(i=1),void 0===n&&(n=null),void 0===s&&(s=!0);var o=new e;return o.playFile(t,i,n,s),o},e.createCenterGruop=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=null),void 0===n&&(n=!0);var s=new eui.Group;return s.horizontalCenter=s.verticalCenter=0,s.addChild(this.create(t,e,i,n)),s},e.prototype.$hitTest=function(e,i){var n=t.prototype.$hitTest.call(this,e,i);return n&&this.pixelHitTest&&!this.hitTestPoint(e,i,!0)?null:this.hitTestEnabled?n:null},e.prototype.playFile=function(t,i,n,s){var o=this;void 0===i&&(i=1),void 0===n&&(n=null),void 0===s&&(s=!0),this.time=egret.getTimer(),this._compFun=n,this.playCount=i,this.remove=s,Timer.stop(this.playComp,this);var a=t.split("|"),r=a[0],l=a[1];return this.name==r&&this.texture&&this.texture.bitmapData?void this.createBody(l):(this.name=r,e.removeCount(this),this.jsonData=null,this.texture=null,RES.getResByUrl(this.name+".json",function(t,e){e.indexOf(o.name)<0||!t||(o.jsonData=t,o.createBody(l))},this,RES.ResourceItem.TYPE_JSON),void RES.getResByUrl(this.name+".png",function(t,i){i.indexOf(o.name)<0||!t||(o.texture=t,o.texture.bitmapData?e.addCount(o):RES.destroyRes(o.name+".png"),o.createBody(l))},this,RES.ResourceItem.TYPE_IMAGE))},e.prototype.$onAddToStage=function(i,n){t.prototype.$onAddToStage.call(this,i,n),e.addCount(this)},e.prototype.$onRemoveFromStage=function(){t.prototype.$onRemoveFromStage.call(this),e.removeCount(this)},e.prototype.createBody=function(t){if(this.jsonData&&this.texture){this.visible=!0,void 0!=this.angle&&this.drawAngle(this.angle),this._mcFactory.clearCache(),this._mcFactory.mcDataSet=this.jsonData,this._mcFactory.texture=this.texture;var i=this.name.split("/"),n=t||i.pop();if(this.movieClipData=this._mcFactory.generateMovieClipData(n),this.name in e.originalRate||(e.originalRate[this.name]=this.movieClipData.frameRate),this.frameRate=e.originalRate[this.name]*this.rate>>0,this.gotoAndPlay(1,this.playCount),this.playCount>0){var s=egret.getTimer()-this.time;s=this.playTime*this.playCount-s,s>0?Timer.start(s,1,this.playComp,this):this.playComp()}this.dispatchEventWith(egret.Event.CHANGE)}},e.prototype.playComp=function(){this.stage&&this._compFun&&(this._compFun(),this._compFun=null),this.remove&&DisplayUtils.removeFromParent(this)},Object.defineProperty(e.prototype,"playTime",{get:function(){return this.movieClipData?1/this.frameRate*this.totalFrames*1e3:0},enumerable:!0,configurable:!0}),e.addCount=function(t){if(t.stage&&t.texture&&t.texture.bitmapData){var i=t.texture.bitmapData.hashCode;if(!e.displayList[i])return void(e.displayList[i]=[t]);var n=e.displayList[i];n.indexOf(t)<0&&n.push(t)}},e.removeCount=function(t){if(t.texture&&t.texture.bitmapData){var i=t.texture.bitmapData.hashCode;if(e.displayList[i]){var n=e.displayList[i],s=n.indexOf(t);s>=0&&n.splice(s,1),0==n.length&&delete e.displayList[i]}}},e.prototype.drawAngle=function(t){if(this.angle=t,this.jsonData&&this.texture&&this.texture.bitmapData){var e=Object.keys(this.jsonData.res);if(e&&e.length){var i=this.jsonData.res[e[0]].w,n=new egret.CustomFilter(baseVertex,cdshader_mc,{time:t/360,PI:Math.PI,w:this.texture.bitmapData.width,h:this.texture.bitmapData.height,frameW:i});this.filters=[n]}}},e.prototype.drawRect=function(t){var e=new egret.CustomFilter(baseVertex,cdshader_mc_rect,{value:t});this.filters=[e]},e.originalRate={},e.displayList=egret.createMap(),e}(egret.MovieClip);__reflect(MovieClip.prototype,"MovieClip"),window.MovieClip=MovieClip;var MovieEui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.stage&&this.name&&this.addChild(MovieClip.createCenterGruop(this.name,-1))},e.prototype.removeDisplay=function(){this.removeChildren()},Object.defineProperty(e.prototype,"data",{set:function(t){this.name=t,this.reshow()},enumerable:!0,configurable:!0}),e.prototype.reshow=function(){this.removeDisplay(),this.addDisplay()},e}(BaseView);__reflect(MovieEui.prototype,"MovieEui"),window.MovieEui=MovieEui;var EntityShowMgr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MAX_SHOW_NUM=3,e.MAX_EFFECT_NUM=3,e.isOpen=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.changeScene=function(){this.isOpen=EntityHideBody.ins().isOpen&&GameMap.fbType!=FbCT.FB_TYPE_KF_ARENA,GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS?this.MAX_SHOW_NUM=5:this.MAX_SHOW_NUM=3},e.prototype.hideFurtherOtherRole=function(){if(!(this.countShowNum()<this.MAX_SHOW_NUM)){var t=SubRoles.lookAtTar;if(t){var e,i=0,n=StageUtils.ins().getHeight()>>1,s=n*n,o=EntityManager.ins().getAllEntity();for(var a in o){var r=o[a];if(r.parent&&r.infoModel&&r.team!=Team.My&&r.infoModel.type==EntityType.Role){var l=MathUtils.getDistanceX2ByObject(t,r);if(l>s){e=r.infoModel.handle;break}l>i&&(i=l,e=r.infoModel.handle)}}this.hideByHandle(e)}}},e.prototype.showNearSomeOne=function(){if(this.isOpen&&!(this.countShowNum()>=this.MAX_SHOW_NUM)){var t=SubRoles.lookAtTar;if(t){var e,i=Number.MAX_VALUE,n=StageUtils.ins().getWidth()>>1,s=n*n,o=EntityManager.ins().getAllEntity();for(var a in o){var r=o[a];if(!r.parent&&r.infoModel&&r.team!=Team.My&&r.infoModel.type==EntityType.Role){var l=MathUtils.getDistanceX2ByObject(t,r);if(s>l){e=r.infoModel.handle;break}i>l&&(i=l,e=r.infoModel.handle)}}this.showByHandle(e)}}},e.prototype.showHideSomeOne=function(t){this.isOpen&&(this.hideFurtherOtherRole(),this.showByHandle(t))},e.prototype.hideByHandle=function(t){if(!(GameLogic.ins().currAttackHandle==t||this.countShowNum()<this.MAX_SHOW_NUM))for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,n=e;i<n.length;i++){var s=n[i];DisplayUtils.removeFromParent(s),s.hideBodyContainer()}},e.prototype.showByHandle=function(t){if(this.isOpen&&!(this.countShowNum()>=this.MAX_SHOW_NUM))for(var e=EntityManager.ins().getEntityRelationHandle(t),i=0,n=e;i<n.length;i++){var s=n[i];GameLogic.ins().addEntity(s),s.showBodyContainer()}},e.prototype.checkShowSkillEffect=function(){return this.isOpen?this.countShowNum()<this.MAX_EFFECT_NUM:!0},e.prototype.checkShowHandle=function(t){if(!this.isOpen)return!0;var e=EntityManager.ins(),i=e.getRootMasterHandle(t);return i&&this.countShowNum()>=this.MAX_SHOW_NUM?e.masterList[i]&&e.masterList[i].length&&e.masterList[i][0].parent?!0:!1:!0},e.prototype.countShowNum=function(){var t=0;if(EntityHideBody.ins().isOpen)return t;var e=EntityManager.ins().masterList;for(var i in e){var n=e[i];n&&n.length&&n[0].parent&&n[0].team!=Team.My&&n[0].infoModel&&n[0].infoModel.type==EntityType.Role&&(t+=1)}return t},e}(BaseClass);__reflect(EntityShowMgr.prototype,"EntityShowMgr"),window.EntityShowMgr=EntityShowMgr;var EntityType;!function(t){t[t.Actor=0]="Actor",t[t.Role=1]="Role",t[t.Monster=2]="Monster",t[t.Snpc=3]="Snpc",t[t.LadderPlayer=4]="LadderPlayer",t[t.CollectionMonst=5]="CollectionMonst",t[t.DropItem=6]="DropItem",t[t.MuBei=7]="MuBei",t[t.Npc=100]="Npc",t[t.Transfer=101]="Transfer",t[t.Mine=102]="Mine"}(EntityType||(EntityType={})),window.EntityType=EntityType;var ErrorLog=function(){function t(){this.stackObj={stack:""}}return t.ins=function(){return this._ins=this._ins||new t,this._ins},t.prototype.show=function(t){var e=function(){DisplayUtils.removeFromParent(this),this.removeTouchEvent(this.notBtn,e)},i=new BaseView;i.skinName="ErrorSkin",i.notBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e,i),i.lab.text=t,StageUtils.ins().getUIStage().addChild(i)
},t.Assert=function(e,i){return e?!1:(i+=t.ins().getErrorStackInfo(),urlParam.isLocation&&t.ins().show(i),t.httpLog&&!urlParam.isLocation&&ReportData?ReportData.report("error",""+i):console.log(i),!0)},t.prototype.getErrorStackInfo=function(){var e="";try{Error.captureStackTrace(this.stackObj,t.Assert),e="----"+this.stackObj.stack,this.stackObj.stack=""}catch(i){e=""}return e},t.httpLog=!0,t}();__reflect(ErrorLog.prototype,"ErrorLog");var Assert=window.Assert=ErrorLog.Assert,ProgressBarEff=function(t){function e(){var e=t.call(this)||this;return e.isFisrt=!0,e.maxValue=0,e.value=0,e.isPer=!1,e.isPlayMc=!0,e.group=new eui.Group,e.bgmc=new MovieClip,e.xianmc=new MovieClip,e.bordermc=new MovieClip,e.lbvalue=new eui.Label,e.offSetX=33,e.mcWidth=460,e.bgWidth=525,e.bgimg=new eui.Image,e.bgmcRes="ProgressEff5",e.xianmcRes="ProgressEff2",e.oldMaxValue=0,e.oldValue=0,e.iniUi(),e}return __extends(e,t),e.prototype.setMcRes=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),""!=t&&(this.bgmcRes=t,this.bgmc.playFile(RES_DIR_EFF+this.bgmcRes,-1)),""!=e&&(this.xianmcRes=e,this.xianmc.playFile(RES_DIR_EFF+this.xianmcRes,-1))},e.prototype.iniUi=function(){this.touchEnabled=this.touchChildren=!1,this.group.x=44,this.group.y=22,this.group.width=0,this.group.height=50,this.group.scrollEnabled=!0,this.bgmc.playFile(RES_DIR_EFF+this.bgmcRes,-1),this.bgmc.x=233,this.bgmc.y=9,this.group.addChild(this.bgmc),this.addChild(this.group),this.xianmc.playFile(RES_DIR_EFF+this.xianmcRes,-1),this.xianmc.x=this.group.x+this.group.width-this.offSetX,this.xianmc.y=20,this.xianmc.scrollRect=new egret.Rectangle(-15,-12,50,19),this.addChild(this.xianmc),this.bgimg.x=14,this.bgimg.y=13,this.bgimg.source="jingyantiao1",this.bgimg.scale9Grid=new egret.Rectangle(54,0,13,37),this.bgimg.width=this.bgWidth,this.addChild(this.bgimg),this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2,this.lbvalue.y=22,this.lbvalue.size=16,this.lbvalue.width=200,this.lbvalue.textAlign="center",this.lbvalue.textColor=16772040,this.lbvalue.fontFamily="黑体",this.addChild(this.lbvalue)},e.prototype.setData=function(t,e,i){this.value=t,this.maxValue=e,i&&(this.isPer=i),this.setui()},e.prototype.setWidth=function(t){this.bgWidth=t,this.bgimg.width=this.bgWidth,this.lbvalue.x=this.bgimg.x+(this.bgimg.width-200)/2;var i=t/e.DEFAULT_WIDTH;this.bgmc.scaleX=i,this.bgmc.x=233*i,this.mcWidth=e.DEFAULT_MC_WIDTH*i},e.prototype.setValue=function(t){this.value=t,this.setui()},e.prototype.getValue=function(){return this.value},e.prototype.getMaxValue=function(){return this.maxValue},e.prototype.reset=function(){this.xianmc.playFile(RES_DIR_EFF+this.xianmcRes,-1),this.bgmc.playFile(RES_DIR_EFF+this.bgmcRes,-1),this.isFisrt=!0,this.oldValue=this.oldMaxValue=this.value=this.maxValue=0},e.prototype.setMaxValue=function(t){this.maxValue=t,this.setui()},e.prototype.setui=function(){var t=this;egret.Tween.removeTweens(this.group);if(0==this.maxValue?(this.value=100,this.maxValue=100,this.lbvalue.visible=!1):this.lbvalue.visible=!0,(this.maxValue>this.oldMaxValue&&0!=this.oldMaxValue||0==this.maxValue||this.value<this.oldValue)&&!this.isFisrt){var e=this.oldMaxValue/this.oldMaxValue*this.mcWidth,i=(this.value/this.oldMaxValue*this.mcWidth,30),n=this.group.x,s=this.group.width,o=egret.Tween.get(this.group,{onChange:function(){t.group.width>=t.mcWidth-3||t.group.width<3?t.xianmc.visible=!1:t.xianmc.visible=!0,t.xianmc.x=n+s-t.offSetX}});o.to({width:e},150+i).call(function(){var e=egret.Tween.get(t.group),n=t.value/t.maxValue*t.mcWidth;t.group.width=0,t.oldValue=t.value,t.oldMaxValue=t.maxValue,e.to({width:n},150+i).call(function(){t.xianmc.x=t.group.x+n-t.offSetX})})}else{this.oldValue=this.value;var a=0;if(this.value<=0)a=0;else{var r=this.value>this.maxValue?this.maxValue:this.value;a=r/this.maxValue*this.mcWidth}var o=egret.Tween.get(this.group,{onChange:function(){t.group.width>=t.mcWidth-3||t.group.width<3?t.xianmc.visible=!1:t.xianmc.visible=!0,t.xianmc.x=t.group.x+t.group.width-t.offSetX}});o.to({width:a},200).call(function(){t.oldMaxValue=t.maxValue})}return this.lbvalue.text=this.value+"/"+this.maxValue,this.isPer&&(this.lbvalue.text=Math.floor(this.value/this.maxValue*100)+"%"),this.isFisrt?void(this.isFisrt=!1):void 0},e.prototype.max=function(){this.maxValue=0,this.setui(),this.lbvalue.visible=!0,this.lbvalue.text=""},e.prototype.setLbValueText=function(t){this.setui(),this.lbvalue.visible=!0,this.lbvalue.text=t},e.DEFAULT_WIDTH=525,e.DEFAULT_MC_WIDTH=460,e}(egret.DisplayObjectContainer);__reflect(ProgressBarEff.prototype,"ProgressBarEff"),window.ProgressBarEff=ProgressBarEff;var ParticlePlayer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.playFile=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=!0),this.compFun=e,this.remove=i,this.name==t&&this.system&&this.jsonData?(this.addChild(this.system),this.system.addEventListener(egret.Event.COMPLETE,this.playComp,this),void this.system.start(this.jsonData.duration)):(this.name=t,RES.getResByUrl(this.name+".json",this.loadJson,this,RES.ResourceItem.TYPE_JSON),void RES.getResByUrl(this.name+".png",this.loadPng,this,RES.ResourceItem.TYPE_IMAGE))},e.prototype.loadJson=function(t,e){var i=e.split(".")[0];this.name==i&&t&&(this.jsonData=t,this.createBody())},e.prototype.loadPng=function(t,e){var i=e.split(".")[0];this.name==i&&t&&(this.texture=t,this.createBody())},e.prototype.createBody=function(){this.jsonData&&this.texture&&(this.system&&(this.system.stop(!0),this.removeChild(this.system)),this.system=new particle.GravityParticleSystem(this.texture,this.jsonData),this.system.addEventListener(egret.Event.COMPLETE,this.playComp,this),this.addChild(this.system),this.system.touchEnabled=!1,this.touchEnabled=!1,this.touchChildren=!1,this.system.start(this.jsonData.duration))},e.prototype.playComp=function(){this.system.removeEventListener(egret.Event.COMPLETE,this.playComp,this),this.stage&&this.compFun&&this.compFun(),this.remove&&DisplayUtils.removeFromParent(this)},e.prototype.stop=function(t){this.system&&this.system.stop(t)},e}(egret.DisplayObjectContainer);__reflect(ParticlePlayer.prototype,"ParticlePlayer"),particle.GravityParticleSystem.prototype.$hitTest=function(){return null},window.ParticlePlayer=ParticlePlayer;var UIAnimation=function(){function t(){}return t.setAnimation=function(e,i,n){if(!t.checkObj(e))return void(n&&"function"==typeof n.func&&n.func());var s,o=egret.getQualifiedClassName(e);switch(o){case"eui.Button":s=e;break;case"eui.ToggleButton":s=e;break;case"eui.Image":s=e;break;case"eui.Group":s=e;break;case"eui.Rect":s=e;break;case"eui.TabBar":s=e;break;default:s=e}if(s){egret.Tween.removeTweens(s);var a=0/0,r=0/0,l=0/0,h=0/0,u=0/0,p=0/0,c=0/0,d=0/0,g=0/0,f=0/0,v=0/0,y=0/0,m=0/0,T=0/0,C=0/0,b=0/0,I=0/0,w=0/0,S=0/0,_=0/0,B=0/0,D=0/0;switch(i){case t.ANITYPE_FADEIN_LEFT_HOR:isNaN(s.left)||(r=s.left-t.diff,c=s.left),isNaN(s.horizontalCenter)||(l=s.horizontalCenter-t.diff,d=s.horizontalCenter),isNaN(s.right)||(h=s.right+t.diff,g=s.right),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.x)||(a=s.x-t.diff,p=s.x),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_FADEIN_RIGHT_HOR:isNaN(s.left)||(r=s.left+t.diff,c=s.left),isNaN(s.horizontalCenter)||(l=s.horizontalCenter+t.diff,d=s.horizontalCenter),isNaN(s.right)||(h=s.right-t.diff,g=s.right),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.x)||(a=s.x+t.diff,p=s.x),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_FADEIN_UP_VER:isNaN(s.top)||(y=s.top-t.diff,I=s.top),isNaN(s.verticalCenter)||(m=s.verticalCenter-t.diff,w=s.verticalCenter),isNaN(s.bottom)||(T=s.bottom+t.diff,S=s.bottom),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.y)||(v=s.y-t.diff,b=s.y),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_FADEIN_DOWN_VER:isNaN(s.top)||(y=s.top+t.diff,I=s.top),isNaN(s.verticalCenter)||(m=s.verticalCenter+t.diff,w=s.verticalCenter),isNaN(s.bottom)||(T=s.bottom-t.diff,S=s.bottom),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.y)||(v=s.y+t.diff,b=s.y),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_IN_LEFT_HOR:isNaN(s.left)||(r=s.left-s.width,c=s.left),isNaN(s.horizontalCenter)||(l=s.horizontalCenter-s.width,d=s.horizontalCenter),isNaN(s.right)||(h=s.right+s.width,g=s.right),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.x)||(a=s.x-s.width,p=s.x),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_IN_RIGHT_HOR:isNaN(s.left)||(r=s.left+s.width,c=s.left),isNaN(s.horizontalCenter)||(l=s.horizontalCenter+s.width*t.hroWidh,d=s.horizontalCenter),isNaN(s.right)||(h=s.right-s.width*t.hroWidh,g=s.right),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.x)||(a=s.x+s.width*t.hroWidh,p=s.x),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_IN_UP_VER:isNaN(s.top)||(y=s.top-s.height,I=s.top),isNaN(s.verticalCenter)||(m=s.verticalCenter-s.height,w=s.verticalCenter),isNaN(s.bottom)||(T=s.bottom+s.height,S=s.bottom),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.y)||(v=s.y-s.height,b=s.y),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_IN_DOWN_VER:isNaN(s.top)||(y=s.top+s.height,I=s.top),isNaN(s.verticalCenter)||(m=s.verticalCenter+s.height,w=s.verticalCenter),isNaN(s.bottom)||(T=s.bottom-s.height,S=s.bottom),isNaN(s.alpha)||(B=0,D=s.alpha),isNaN(s.y)||(v=s.y+s.height,b=s.y),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_OUT_LEFT_HOR:isNaN(s.left)||(r=s.left,c=s.left-s.width),isNaN(s.horizontalCenter)||(l=s.horizontalCenter,d=s.horizontalCenter-s.width),isNaN(s.right)||(h=s.right,g=s.right+s.width),isNaN(s.alpha)||(B=s.alpha,D=0),isNaN(s.x)||(a=s.x,p=s.x-s.width),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_OUT_RIGHT_HOR:isNaN(s.left)||(r=s.left+s.width,c=s.left),isNaN(s.horizontalCenter)||(l=s.horizontalCenter,d=s.horizontalCenter+s.width*t.hroWidh),isNaN(s.right)||(h=s.right,g=s.right-s.width*t.hroWidh),isNaN(s.alpha)||(B=s.alpha,D=0),isNaN(s.x)||(a=s.x,p=s.x+s.width*t.hroWidh),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_OUT_UP_VER:isNaN(s.top)||(y=s.top,I=s.top-s.height),isNaN(s.verticalCenter)||(m=s.verticalCenter,w=s.verticalCenter-s.height),isNaN(s.bottom)||(T=s.bottom,S=s.bottom+s.height),isNaN(s.alpha)||(B=s.alpha,D=0),isNaN(s.y)||(v=s.y,b=s.y-s.height),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_OUT_DOWN_VER:isNaN(s.top)||(y=s.top,I=s.top+s.height),isNaN(s.verticalCenter)||(m=s.verticalCenter,w=s.verticalCenter+s.height),isNaN(s.bottom)||(T=s.bottom,S=s.bottom-s.height),isNaN(s.alpha)||(B=s.alpha,D=0),isNaN(s.y)||(v=s.y,b=s.y+s.height),isNaN(s.scaleX)||(u=s.scaleX,f=s.scaleX),isNaN(s.scaleY)||(C=s.scaleY,_=s.scaleY);break;case t.ANITYPE_IN_SCALE_VER:isNaN(s.scaleX)||(u=.5,f=s.scaleX),isNaN(s.scaleY)||(C=.5,_=s.scaleY);break;case t.ANITYPE_OUT_SCALE_VER:isNaN(s.scaleX)||(u=s.scaleX,f=0),isNaN(s.scaleY)||(C=s.scaleY,_=0)}a=a?a:s.x,r=r?r:s.left,l=l?l:s.horizontalCenter,h=h?h:s.right,u=u?u:s.scaleX,p=p?p:s.x,c=c?c:s.left,d=d?d:s.horizontalCenter,g=g?g:s.right,f=0==f?f:s.scaleX,v=v?v:s.y,y=y?y:s.top,m=m?m:s.verticalCenter,T=T?T:s.bottom,C=C?C:s.scaleY,b=b?b:s.y,I=I?I:s.top,w=w?w:s.verticalCenter,S=S?S:s.bottom,_=0==_?_:s.scaleY,B=0==B?B:s.alpha,D=0==D?D:1,t.aniStartEUI(s,{sx:a,sxleft:r,sxhro:l,sxright:h,ex:p,exleft:c,exhro:d,exright:g,sy:v,sytop:y,syver:m,sybot:T,ey:b,eytop:I,eyver:w,eybot:S,salpha:B,ealpha:D,sxscaleX:u,exscaleX:f,syscaleY:C,eyscaleY:_},n)}},t.aniStartEUI=function(e,i,n){e.x=i.sx,e.left=i.sxleft,e.horizontalCenter=i.sxhro,e.right=i.sxright,e.y=i.sy,e.top=i.sytop,e.verticalCenter=i.syver,e.bottom=i.sybot,e.alpha=i.salpha,e.scaleX=i.sxscaleX,e.scaleY=i.syscaleY;var s=egret.Tween.get(e),o=n&&n.time?n.time:t.time,a=n&&n.ease?n.ease:t.Egret_Ease;s.to({x:i.ex,left:i.exleft,horizontalCenter:i.exhro,right:i.exright,y:i.ey,top:i.eytop,verticalCenter:i.eyver,bottom:i.eybot,alpha:i.ealpha,scaleX:i.exscaleX,scaleY:i.eyscaleY},o,a).call(function(){e.x=i.ex,e.left=i.exleft,e.horizontalCenter=i.exhro,e.right=i.exright,e.y=i.ey,e.top=i.eytop,e.verticalCenter=i.eyver,e.bottom=i.eybot,e.alpha=i.ealpha,e.scaleX=i.exscaleX,e.scaleY=i.eyscaleY,t.cleanObj(e),egret.Tween.removeTweens(e),n&&"function"==typeof n.func&&n.func()})},t.checkObj=function(e){return t.aniMap[e.hashCode]?!1:(t.aniMap[e.hashCode]=e,!0)},t.cleanObj=function(e){t.aniMap[e.hashCode]&&delete t.aniMap[e.hashCode]},t.ANITYPE_FADEIN_LEFT_HOR=1,t.ANITYPE_FADEIN_RIGHT_HOR=2,t.ANITYPE_FADEIN_UP_VER=3,t.ANITYPE_FADEIN_DOWN_VER=4,t.ANITYPE_IN_LEFT_HOR=5,t.ANITYPE_IN_RIGHT_HOR=6,t.ANITYPE_IN_UP_VER=7,t.ANITYPE_IN_DOWN_VER=8,t.ANITYPE_OUT_LEFT_HOR=9,t.ANITYPE_OUT_RIGHT_HOR=10,t.ANITYPE_OUT_UP_VER=11,t.ANITYPE_OUT_DOWN_VER=12,t.ANITYPE_IN_SCALE_VER=13,t.ANITYPE_OUT_SCALE_VER=14,t.diff=50,t.time=200,t.Egret_Ease=egret.Ease.backInOut,t.aniMap={},t.hroWidh=1.5,t}();__reflect(UIAnimation.prototype,"UIAnimation");var ActivityBtnConfig=function(){function t(){}return t}();__reflect(ActivityBtnConfig.prototype,"ActivityBtnConfig"),window.ActivityBtnConfig=ActivityBtnConfig;var SkillEffPlayer=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"urlSkill",{get:function(){return""+RES_DIR_SKILL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"urlSkillEff",{get:function(){return""+RES_DIR_SKILLEFF},enumerable:!0,configurable:!0}),e.playConfigs=function(t,i){var n=this;if(!this.setTimeout)return void console.warn("SkillEffPlayer.setTimeout未设置");for(var s=function(s){var a=t[s];a=SkillEffConfig.initValue(a),o.setTimeout(a.delay/i.rate,function(){if(a.type>50){var t=n["type"+a.type];return void(t&&t.call(n,i,a))}var s=new MovieClip;s.rate=a.playSpeed*(a.isRate?i.rate:1);var o=e.urlSkillEff+a.effectId+(a.isDir?DirUtil.get5DirBy8Dir(i.initParam.dir):""),r=o+i.append;if(s.playFile(r,a.playCount),s.x=a.x,s.y=a.y,i.offset&&(s.x+=i.offset.x,s.y+=i.offset.y),"string"==typeof a.rotation){var l=a.rotation+"",h=l.split("|"),u=+h[0],p=+h[1]-+h[0];s.rotation=Math.random()*p+u}else s.rotation=a.rotation;s.scaleX=a.scaleX*(a.isDir&&DirUtil.isScaleX(i.initParam.dir)?-1:1),s.scaleY=a.scaleY,s.alpha=a.alpha,s.anchorOffsetX=a.cx,s.anchorOffsetY=a.cy;var c=a.layer;if(a.dirPos.length&&a.dirPos[i.initParam.dir]){var d=a.dirPos[i.initParam.dir];isNaN(d.x)||(s.x+=d.x),isNaN(d.y)||(s.y+=d.y),isNaN(d.layer)||(c=d.layer),isNaN(d.rotation)||(s.rotation+=d.rotation),isNaN(d.scaleX)||(s.scaleX=d.scaleX),isNaN(d.scaleY)||(s.scaleY=d.scaleY),isNaN(d.cx)||(s.anchorOffsetX=d.cx),isNaN(d.cy)||(s.anchorOffsetY=d.cy)}if(a.isRot&&i.target){var g=a.isInit?{x:i.initParam.tar[0].x,y:i.initParam.tar[0].y}:i.target[0],f=MathUtils.getAngle(MathUtils.getRadian2(i.source.x,i.source.y,g.x,g.y));s.rotation=f+s.rotation}i.mc=s;var v=n["layer"+c];v&&v.call(n,i);var y=n["type"+a.type];if(y&&y.call(n,i,a),a.tween.length>0)for(var m=egret.Tween.get(s),T=0;T<a.tween.length;T+=2){var C=a.tween[T];m.to(C,a.tween[T+1].time)}},o)},o=this,a=0;a<t.length;a++)s(a)},e.play=function(t,e,i,n,s,o,a){var r=this;void 0===i&&(i=[]),void 0===n&&(n=null),void 0===s&&(s=1),void 0===o&&(o=null),void 0===a&&(a="");var l=""+this.urlRoot+this.urlSkill+t+".json";RES.getResByUrl(l,function(l){if(!l)return void console.log("没有这个技能 -- "+t);var h=new EffParam;h.initParam={dir:e.dir,x:e.x,y:e.y,tar:[]};for(var u=0;i&&u<i.length;u++)h.initParam.tar.push({dir:i[u].dir,x:i[u].x,y:i[u].y});h.source=e,h.target=i,h.hitFun=n,h.rate=s,h.offset=o,h.append=a,r.playConfigs(l,h)},this,RES.ResourceItem.TYPE_JSON)},e.type1=function(t,e){var i=this,n=t.target,s=t.source,o=t.mc,a=t.hitFun,r=e.isInit?{x:t.initParam.tar[0].x,y:t.initParam.tar[0].y}:n[0],l=egret.Tween.get(o),h=e.dis||MathUtils.getDistanceByObject(s,r);e.sDis&&(h+=e.sDis);var u=MathUtils.getAngle(MathUtils.getRadian2(s.x,s.y,r.x,r.y))+e.range;if(e.sDis){var p=MathUtils.getDirMove(u,e.sDis);o.x+=p.x,o.y+=p.y}var c=MathUtils.getDirMove(u,h,o.x,o.y);l.to({x:c.x,y:c.y},h/e.moveSpeed*1e3).call(function(){DisplayUtils.removeFromParent(o),e.hit&&a&&a(e.probability),e.exEff&&i.play(e.exEff,s,n,a,1,null,t.append)})},e.type96=function(t,e){if(!this.shake)return void console.warn("SkillEffPlayer.shake未设置");var i=t.source;this.shake(i,e.range,e.time,e.playCount,e.probability)},e.type97=function(t,e){var i=t.target,n=t.source;if(0==GameMap.fbType){i[0].stopMove();var s=e.dis||MathUtils.getDistanceByObject(n,i[0]),o=MathUtils.getAngle(MathUtils.getRadian2(n.x,n.y,i[0].x,i[0].y)),a=MathUtils.getDirMove(o,s,i[0].x,i[0].y),r=BresenhamLine.isAbleToThrough(GameMap.point2Grip(i[0].x),GameMap.point2Grip(i[0].y),GameMap.point2Grip(a.x),GameMap.point2Grip(a.y));if(0==r[0]&&(GameMap.point2Grip(i[0].x)==r[2]&&GameMap.point2Grip(i[0].y)==r[3]?(a.x=i[0].x,a.y=i[0].y):(a.x=GameMap.grip2Point(r[2]),a.y=GameMap.grip2Point(r[3]))),a.x=Math.max(Math.min(a.x,GameMap.MAX_WIDTH),0),a.y=Math.max(Math.min(a.y,GameMap.MAX_HEIGHT),0),s=MathUtils.getDistanceByObject(i[0],a),!(0>=s)){var l=egret.Tween.get(i[0].moveTweenObj);l.to({x:a.x,y:a.y},s/e.moveSpeed*1e3)}}},e.type98=function(t,e){var i=t.target,n=t.source;if(0==GameMap.fbType){n.stopMove();var s=e.dis||MathUtils.getDistanceByObject(n,i[0]),o=MathUtils.getAngle(MathUtils.getRadian2(n.x,n.y,i[0].x,i[0].y)),a=MathUtils.getDirMove(o,s,i[0].x,i[0].y),r=BresenhamLine.isAbleToThrough(GameMap.point2Grip(i[0].x),GameMap.point2Grip(i[0].y),GameMap.point2Grip(a.x),GameMap.point2Grip(a.y));if(0==r[0]&&(GameMap.point2Grip(i[0].x)==r[2]&&GameMap.point2Grip(i[0].y)==r[3]?(a.x=i[0].x,a.y=i[0].y):(a.x=GameMap.grip2Point(r[2]),a.y=GameMap.grip2Point(r[3]))),a.x=Math.max(Math.min(a.x,GameMap.MAX_WIDTH),0),a.y=Math.max(Math.min(a.y,GameMap.MAX_HEIGHT),0),s=MathUtils.getDistanceByObject(i[0],a),!(0>=s)){a=MathUtils.getDirMove(o,s,n.x,n.y);var l=egret.Tween.get(n.moveTweenObj);l.to({x:a.x,y:a.y},s/e.moveSpeed*1e3)}}},e.type99=function(t,e){var i=t.hitFun;i&&i(e.probability)},e.layer0=function(t){var e=t.source,i=t.mc;return i.x+=e.x,i.y+=e.y,this.bottomLayer?void this.bottomLayer.addChild(i):void console.warn("SkillEffPlayer.bottomLayer未设置")},e.layer1=function(t){var e=t.source,i=t.mc;e.addChildAt(i,0)},e.layer2=function(t){var e=t.source,i=t.mc;e.addChild(i)},e.layer3=function(t){var e=t.source,i=t.mc;return i.x+=e.x,i.y+=e.y,this.topLayer?void this.topLayer.addChild(i):void console.warn("SkillEffPlayer.topLayer未设置")},e.layer4=function(t){var e=t.target,i=t.mc;return i.x+=e[0].x,i.y+=e[0].y,this.bottomLayer?void this.bottomLayer.addChild(i):void console.warn("SkillEffPlayer.bottomLayer未设置")},e.layer5=function(t){var e=t.target,i=t.mc;e[0].addChildAt(i,0)},e.layer6=function(t){var e=t.target,i=t.mc;e[0].addChild(i)},e.layer7=function(t){var e=t.target,i=t.mc;return i.x+=e[0].x,i.y+=e[0].y,this.topLayer?void this.topLayer.addChild(i):void console.warn("SkillEffPlayer.topLayer未设置")},e.layer8=function(t){return this.fixedLayer?void this.fixedLayer.addChild(t.mc):void console.warn("SkillEffPlayer.topLayer未设置")},e.urlRoot="",e}(BaseClass);__reflect(SkillEffPlayer.prototype,"SkillEffPlayer");var EffParam=function(){function t(){this.append="",this.rate=1}return t}();__reflect(EffParam.prototype,"EffParam");var SkillEffConfig=function(){function t(){this.type=0,this.delay=0,this.layer=3,this.x=0,this.y=0,this.effectId=0,this.playSpeed=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.isDir=0,this.moveSpeed=100,this.playCount=1,this.dis=0,this.sDis=0,this.alpha=1,this.isRot=0,this.hit=0,this.cx=0,this.cy=0,this.range=0,this.time=0,this.isRate=0,this.isInit=0,this.probability=1,this.exEff="",this.dirPos=[],this.tween=[]}return t.initValue=function(t){return t.__proto__=this.o,t},t.o=new t,t}();__reflect(SkillEffConfig.prototype,"SkillEffConfig");var ActivityType1Config=function(){function t(){}return t}();__reflect(ActivityType1Config.prototype,"ActivityType1Config");var ActivityType24Config=function(){function t(){}return t}();__reflect(ActivityType24Config.prototype,"ActivityType24Config"),window.ActivityType24Config=ActivityType24Config;var ActivityType2Config=function(){function t(){}return t}();__reflect(ActivityType2Config.prototype,"ActivityType2Config"),window.ActivityType2Config=ActivityType2Config;var ActivityType3Config=function(){function t(){this.day=1}return t}();__reflect(ActivityType3Config.prototype,"ActivityType3Config"),window.ActivityType3Config=ActivityType3Config;var ActivityType7Config=function(){function t(){}return t}();__reflect(ActivityType7Config.prototype,"ActivityType7Config"),window.ActivityType7Config=ActivityType7Config;var MapGrid=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e._poolNodes=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"numCols",{get:function(){return this._numCols},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numRows",{get:function(){return this._numRows},enumerable:!0,configurable:!0}),e.prototype.getNode=function(t,e){return this._nodes[t]?this._nodes[t][e]:void 0},e.prototype.isWalkableTile=function(t,e){return 0>t||t>=this._numCols||0>e||e>=this._numRows?!1:this._nodes[t][e].walkable},e.prototype.destruct=function(){this.clearNodes()},e.prototype.initMapInfo=function(t,e){this._nodes&&this.clearNodes(),this._numRows=t.maxY,this._numCols=t.maxX,this._nodes=[];for(var i,n=0;n<this._numCols;n++){this._nodes[n]=[];for(var s=0;s<this._numRows;s++)i=this.getGridNode(),i.flags=t.grids[n*this._numRows+s],this._nodes[n][s]=i}e&&this._nodes.reverse()},e.prototype.clearNodes=function(){for(var t in this._nodes)this._poolNodes=this._poolNodes.concat(this._nodes[t]),this._nodes[t].length=0;this._nodes.length=0},e.prototype.getGridNode=function(){return this._poolNodes.pop()||new MapGridNode},e.prototype._trace=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];null!=this.debugTrace&&this.debugTrace.apply(null,t)},e}(egret.Sprite);__reflect(MapGrid.prototype,"MapGrid");var ActorExRing2Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing2Config.prototype,"ActorExRing2Config");var ActorExRing3Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing3Config.prototype,"ActorExRing3Config");var ActorExRing4Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing4Config.prototype,"ActorExRing4Config");var ActorExRing5Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing5Config.prototype,"ActorExRing5Config");var ActorExRing6Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin=""}return t}();__reflect(ActorExRing6Config.prototype,"ActorExRing6Config");var ActorExRing7Config=function(){function t(){this.level=0,this.costItem=0,this.cost=0,this.upPower=0,this.addPower=0,this.bjRate=0,this.bjAddPower=0,this.attrAward=[],this.extAttrAward=[],this.judgeup=0,this.SpecialRingSkin="",this.summonerSkillId=0,this.summonerAttr=[]}return t}();__reflect(ActorExRing7Config.prototype,"ActorExRing7Config"),window.ActorExRing7Config=ActorExRing7Config;var ActorExRingAbilityConfig=function(){function t(){this.id=0,this.ringLv=0,this.abilityName="",this.abilityDesc="",this.abilityIcon=""}return t}();__reflect(ActorExRingAbilityConfig.prototype,"ActorExRingAbilityConfig");var ActorExRingBookConfig=function(){function t(){this.id=0,this.level=0,this.itemId=0,this.num=0,this.attr=[],this.bookAttrPer=[],this.skillName="",this.skillDesc="",this.skillIcon="",this.exPower=0}return t}();__reflect(ActorExRingBookConfig.prototype,"ActorExRingBookConfig");var ActorExRingCommon=function(){function t(){this.MaxOutNum=[],this.actImbaId=0}return t}();__reflect(ActorExRingCommon.prototype,"ActorExRingCommon");var ActorExRingConfig=function(){function t(){this.id=0,this.openDay=0,this.openVip=0,this.openYb=0,this.name="",this.effid=0,this.explain="",this.mtCombat=0,this.needLevel=0,this.needZs=0,this.monsterId=0,this.order=0,this.icon="",this.avatarFileName=0,this.wexplain="",this.useYb=0,this.skillGridYb=0}return t}();__reflect(ActorExRingConfig.prototype,"ActorExRingConfig");var BubbleConfig=function(){function t(){this.bubbleid=0,this.news="",this.type=0}return t}();__reflect(BubbleConfig.prototype,"BubbleConfig");var DailyFubenConfig=function(){function t(){this.ybRec=0,this.monthcard=0,this.privilege=0,this.specialCard=0,this.sweepLevel=0,this.sort=0}return t}();__reflect(DailyFubenConfig.prototype,"DailyFubenConfig");var DefineEff=function(){function t(){this.effid=0,this.souce=""}return t}();__reflect(DefineEff.prototype,"DefineEff");var DemonCirLevel=function(){function t(){this.count=0,this.expower=0}return t}();__reflect(DemonCirLevel.prototype,"DemonCirLevel");var DemonCirSkill=function(){function t(){this.expower=0}return t}();__reflect(DemonCirSkill.prototype,"DemonCirSkill");var EquipConfig=function(){function t(){this.stoneId=0,this.stoneNum=0,this.moneyNum=0,this.equipRate=0,this.moneyType=0,this.exPower=0}return t}();__reflect(EquipConfig.prototype,"EquipConfig");var GuideArrow=function(t){function e(){var e=t.call(this)||this;return e.skinName="guideArrowSkin",e.touchEnabled=!1,e.touchChildren=!1,e}return __extends(e,t),e.prototype.removeDisplay=function(){egret.Tween.removeTweens(this.parent),egret.Tween.removeTweens(this)},e.prototype.update=function(){var t=GuideUtils.ins().curCfg;if(t){if(!t.tips||""==t.tips)return void(this.visible=!1);egret.Tween.removeTweens(this.parent),this.parent.x=0,this.visible=!0,1==t.direction?(this.currentState="right",egret.Tween.get(this.parent,{loop:!0}).to({x:40},1e3).to({x:0},1e3)):(this.currentState="left",egret.Tween.get(this.parent,{loop:!0}).to({x:-40},1e3).to({x:0},1e3)),this.lab.text=t.tips}},e}(BaseView);__reflect(GuideArrow.prototype,"GuideArrow"),window.GuideArrow=GuideArrow;var ExRing1Config=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ExRing0Config);__reflect(ExRing1Config.prototype,"ExRing1Config");var GuideMaskBackgroud=function(t){function e(){var e=t.call(this)||this;return e._stageWidth=0,e._stageHeight=0,e._bgs=new Array,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.init=function(t,e){this._stageWidth=t,this._stageHeight=e},e.prototype.draw=function(t){this.cacheAsBitmap=!1,this._deductRec=t,this.removeAllChild();var e=Math.max(t.x,0),i=Math.max(t.y,0),n=Math.min(t.x+t.width,this._stageWidth),s=Math.min(t.y+t.height,this._stageHeight);this.addBg(0,0,this._stageWidth,i),this.addBg(0,i,e,t.height),this.addBg(n,i,this._stageWidth-n,t.height),this.addBg(0,s,this._stageWidth,this._stageHeight-s),this.width=this._stageWidth,this.height=this._stageHeight,this.cacheAsBitmap=!0},e.prototype.destroy=function(){this.removeChildren(),this._bgs=[]},e.prototype.removeAllChild=function(){for(;this.numChildren;){var t=this.removeChildAt(0);this._bgs.push(t)}},e.prototype.addBg=function(t,e,i,n){var s;this._bgs.length?(s=this._bgs.pop(),s.graphics.clear()):s=new egret.Shape,s.graphics.beginFill(0,.5),s.graphics.drawRect(t,e,i,n),s.graphics.endFill(),this.addChild(s)},e.prototype.hitTest=function(t,e,i){return this._deductRec&&this._deductRec.contains(t,e)?null:this},e}(egret.Sprite);__reflect(GuideMaskBackgroud.prototype,"GuideMaskBackgroud"),window.GuideMaskBackgroud=GuideMaskBackgroud;var ExRingExtendAttrConfig=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.summonerSkillId=0,e.summonerAiId=0,e}return __extends(e,t),e}(ExRingAttrConfig);__reflect(ExRingExtendAttrConfig.prototype,"ExRingExtendAttrConfig");var FbChallengeConfig=function(){function t(){this.id=0,this.group=0,this.layer=0,this.zsLevelLimit=0,this.levelLimit=0,this.fbId=0,this.describe="",this.showIcon=0,this.equipPos=0,this.reward=[],this.dayReward=[],this.lotteryCount=0}return t}();__reflect(FbChallengeConfig.prototype,"FbChallengeConfig");var FbChallengeLotteryConfig=function(){function t(){this.groupc=[]}return t}();__reflect(FbChallengeLotteryConfig.prototype,"FbChallengeLotteryConfig");var FbChNameConfig=function(){function t(){this.group=0,this.name=""}return t}();__reflect(FbChNameConfig.prototype,"FbChNameConfig");var FeatsStore=function(){function t(){}return t}();__reflect(FeatsStore.prototype,"FeatsStore"),window.FeatsStore=FeatsStore;var FriendLimit=function(){function t(){this.sysLv=50,this.chatLv=50,this.blackListLv=50,this.addFriendLv=50,this.vipLv=1,this.friendListLen=50,this.chatsListLen=50,this.applyListLen=50,this.blacklistLen=50,this.contentLimit=50}return t}();__reflect(FriendLimit.prototype,"FriendLimit");var FuwenTreasureConfig=function(){function t(){this.huntOnce=500,this.huntTenth=4980}return t}();__reflect(FuwenTreasureConfig.prototype,"FuwenTreasureConfig");var GainWay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"gainName",{get:function(){return this[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"winName",{get:function(){return this[1]?this[1]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"page",{get:function(){return this[2]?this[2]:0},enumerable:!0,configurable:!0}),e}(Array);__reflect(GainWay.prototype,"GainWay");var GlobalConfig=function(){function t(){}return t.init=function(){if(!this.config){var t=this.config=RES.getRes("cfg1_json");if(t){var e=function(t,i,n){if(0==n)t.__proto__=i;else for(var s in t)e(t[s],i,n-1)};for(var i in t){var n=t[i],s=n.len;delete n.len;var o=egret.getDefinitionByName(i);o&&e(n,new o,s),this[i]=n}RES.destroyRes("cfg1_json")}}},t}();__reflect(GlobalConfig.prototype,"GlobalConfig"),window.GlobalConfig=GlobalConfig;var GodWingItemConfig=function(){function t(){}return t}();__reflect(GodWingItemConfig.prototype,"GodWingItemConfig"),window.GodWingItemConfig=GodWingItemConfig;var GodWingLevelConfig=function(){function t(){}return t}();__reflect(GodWingLevelConfig.prototype,"GodWingLevelConfig"),window.GodWingLevelConfig=GodWingLevelConfig;var GodWingSuitConfig=function(){function t(){}return t}();__reflect(GodWingSuitConfig.prototype,"GodWingSuitConfig"),window.GodWingSuitConfig=GodWingSuitConfig;var GuildBossConfig=function(){function t(){this.dayTimes=0,this.notOpenDayOfWeek=0,this.effid=0,this.radisLv=0}return t}();__reflect(GuildBossConfig.prototype,"GuildBossConfig");var GuildBossHpAwardsConfig=function(){function t(){this.srank=0,this.erank=0,this.mail_head="",this.mail_content=""}return t}();__reflect(GuildBossHpAwardsConfig.prototype,"GuildBossHpAwardsConfig");var GuildBossInfoConfig=function(){function t(){this.id=0,this.fbId=0,this.enterAwards=0}return t}();__reflect(GuildBossInfoConfig.prototype,"GuildBossInfoConfig");var HeartMethodBaseConfig=function(){function t(){this.serverDay=0,this.zsLv=0,this.starMax=0}return t}();__reflect(HeartMethodBaseConfig.prototype,"HeartMethodBaseConfig");var HeartMethodConfig=function(){function t(){this.id=0}return t}();__reflect(HeartMethodConfig.prototype,"HeartMethodConfig");var HeirloomEquipConfig=function(){function t(){this.slot=0,this.lv=0,this.expend={id:0,count:0},this.attr=[],this.icon=0,this.name="",this.image="",this.model="",this.skillicon="",this.skillname="",this.skilldesc="",this.attr_add=0
}return t}();__reflect(HeirloomEquipConfig.prototype,"HeirloomEquipConfig");var HunGuConf=function(){function t(){this.openzhuanshenglv=0,this.openserverday=0,this.showzhuanshenglv=0,this.equipCount=0,this.hunyuCount=0}return t}();__reflect(HunGuConf.prototype,"HunGuConf");var HunGuEquip=function(){function t(){this.id=0,this.stage=0}return t}();__reflect(HunGuEquip.prototype,"HunGuEquip");var HunGuSuit=function(){function t(){this.id=0,this.count=0,this.stage=0,this.expower=0,this.specialAttrs=0}return t}();__reflect(HunGuSuit.prototype,"HunGuSuit");var HunYuEquip=function(){function t(){this.id=0,this.level=0}return t}();__reflect(HunYuEquip.prototype,"HunYuEquip");var ItemConfig=function(){function t(){this.bagType=0}return t}();__reflect(ItemConfig.prototype,"ItemConfig"),window.ItemConfig=ItemConfig;var ItemStoreConfig=function(){function t(){}return t.getStoreByItemID=function(t){var e=GlobalConfig.ItemStoreConfig;for(var i in e){var n=e[i];if(n.itemId==t)return n}return null},t}();__reflect(ItemStoreConfig.prototype,"ItemStoreConfig"),window.ItemStoreConfig=ItemStoreConfig;var KnighthoodBasicConfig=function(){function t(){this.perLevel=0,this.actImbaId=0}return t}();__reflect(KnighthoodBasicConfig.prototype,"KnighthoodBasicConfig");var KnighthoodConfig=function(){function t(){this.effid=0}return t}();__reflect(KnighthoodConfig.prototype,"KnighthoodConfig");var TaskIdConfig=function(){function t(){this.achieveId=0,this.taskId=0}return t}();__reflect(TaskIdConfig.prototype,"TaskIdConfig");var KnighthoodStageConfig=function(){function t(){this.stage=0,this.type=""}return t}();__reflect(KnighthoodStageConfig.prototype,"KnighthoodStageConfig");var LimitTimeConfig=function(){function t(){this.id=0,this.time=0,this.openLevel=0,this.openZhuan=0}return t}();__reflect(LimitTimeConfig.prototype,"LimitTimeConfig");var LimitTimeTaskConfig=function(){function t(){this.id=0,this.name="",this.desc="",this.target=0,this.control=0}return t}();__reflect(LimitTimeTaskConfig.prototype,"LimitTimeTaskConfig");var LoongSoulStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(LoongSoulStageConfig.prototype,"LoongSoulStageConfig");var MiJiSkillConfig=function(){function t(){}return t.getSkillIDByItem=function(t){var e=GlobalConfig.MiJiSkillConfig;for(var i in e)if(e[i].item==t)return e[i].id;return-1},t}();__reflect(MiJiSkillConfig.prototype,"MiJiSkillConfig");var MonstersConfig=function(){function t(){this.type=0,this.attrange=0,this.wanderrange=0,this.dirNum=2}return t}();__reflect(MonstersConfig.prototype,"MonstersConfig");var MonthSignConfig=function(){function t(){this.month=0,this.day=0,this.rewards=null,this.dayLabel=0,this.vipLabel=0}return t}();__reflect(MonthSignConfig.prototype,"MonthSignConfig");var NeiGongBaseConfig=function(){function t(){this.openLevel=10,this.maxLevel=20,this.maxStage=0,this.levelPerStage=0,this.openGuanqia=10}return t}();__reflect(NeiGongBaseConfig.prototype,"NeiGongBaseConfig");var NeiGongStageConfig=function(){function t(){this.stage=0,this.level=0,this.totalExp=0,this.costMoney=0,this.addExp=0,this.attribute=[],this.tips=0}return t}();__reflect(NeiGongStageConfig.prototype,"NeiGongStageConfig");var OpenSystemConfig=function(){function t(){this.id=0,this.openzs=0,this.openlevel=0,this.opencheck=0}return t}();__reflect(OpenSystemConfig.prototype,"OpenSystemConfig");var PActivity2Config=function(){function t(){}return t}();__reflect(PActivity2Config.prototype,"PActivity2Config"),window.PActivity2Config=PActivity2Config;var PActivity3Config=function(){function t(){this.day=1}return t}();__reflect(PActivity3Config.prototype,"PActivity3Config"),window.PActivity3Config=PActivity3Config;var PActivity9Config=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ActivityType9Config);__reflect(PActivity9Config.prototype,"PActivity9Config");var PActivityBtnConfig=function(){function t(){}return t}();__reflect(PActivityBtnConfig.prototype,"PActivityBtnConfig"),window.PActivityBtnConfig=PActivityBtnConfig,window.ActivityType11_2Config=ActivityType11_2Config;var PeakRaceCrossTime=function(){function t(){}return t}();__reflect(PeakRaceCrossTime.prototype,"PeakRaceCrossTime"),window.PeakRaceCrossTime=PeakRaceCrossTime;var PeakRaceTime=function(){function t(){}return t}();__reflect(PeakRaceTime.prototype,"PeakRaceTime"),window.PeakRaceTime=PeakRaceTime;var RoleConfig=function(){function t(){this.level=0,this.job=0,this.hp=0,this.mp=0,this.atk=0,this.def=0,this.res=0,this.crit=0,this.tough=0,this.as=0,this.ms=0,this.acrit=0}return t}();__reflect(RoleConfig.prototype,"RoleConfig");var RuneAttrTypeConfig=function(){function t(){this.type=0}return t}();__reflect(RuneAttrTypeConfig.prototype,"RuneAttrTypeConfig");var RuneConverConfig=function(){function t(){this.id=0,this.checkpoint=0,this.conversion=0}return t}();__reflect(RuneConverConfig.prototype,"RuneConverConfig");var RuneLockPosConfig=function(){function t(){this.pos=0,this.lockLv=0}return t}();__reflect(RuneLockPosConfig.prototype,"RuneLockPosConfig");var RuneNameConfig=function(){function t(){this.type=0,this.runeName=""}return t}();__reflect(RuneNameConfig.prototype,"RuneNameConfig");var RuneOtherConfig=function(){function t(){this.zsLevel=0,this.maxEquip=0,this.maxQuality=0,this.maxDecompose=5}return t}();__reflect(RuneOtherConfig.prototype,"RuneOtherConfig");var ScenesConfig=function(){function t(){this.turn=0,this.autoPunch=0}return t}();__reflect(ScenesConfig.prototype,"ScenesConfig");var ShieldStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(ShieldStageConfig.prototype,"ShieldStageConfig");var SkillsConfig=function(){function t(){}return t}();__reflect(SkillsConfig.prototype,"SkillsConfig"),window.SkillsConfig=SkillsConfig;var TianTiDanConfig=function(){function t(){}return t}();__reflect(TianTiDanConfig.prototype,"TianTiDanConfig");var TogetherHitConfig=function(){function t(){this.level=0}return t}();__reflect(TogetherHitConfig.prototype,"TogetherHitConfig");var TogetherHitEquipExchangeConfig=function(){function t(){this.id=0,this.exchangeAmount=0,this.level=0,this.zsLevel=0}return t}();__reflect(TogetherHitEquipExchangeConfig.prototype,"TogetherHitEquipExchangeConfig");var TogetherHitEquipQmConfig=function(){function t(){this.num=0,this.lv=0,this.zslv=0,this.desc=""}return t}();__reflect(TogetherHitEquipQmConfig.prototype,"TogetherHitEquipQmConfig");var TrainLevelConfig=function(){function t(){this.trainName="",this.img=""}return t}();__reflect(TrainLevelConfig.prototype,"TrainLevelConfig");var VipConfig=function(){function t(){this.boss1buy=0,this.boss2buy=0}return t}();__reflect(VipConfig.prototype,"VipConfig");var WeaponSoulConfig=function(){function t(){this.id=1,this.name="",this.actcond=[],this.inside=[],this.outside=[],this.pic=[],this.icon=""}return t}();__reflect(WeaponSoulConfig.prototype,"WeaponSoulConfig");var WeaponSoulItemAttr=function(){function t(){this.id=0,this.attr=[]}return t}();__reflect(WeaponSoulItemAttr.prototype,"WeaponSoulItemAttr");var WeaponSoulPosConfig=function(){function t(){this.id=0,this.level=0,this.costItem=0,this.costNum=0,this.showlv=0}return t}();__reflect(WeaponSoulPosConfig.prototype,"WeaponSoulPosConfig");var WeaponSoulSuit=function(){function t(){this.id=0,this.lv=0,this.attr=[],this.ex_attr=[],this.skillname="",this.skillicon="",this.skilldesc=""}return t}();__reflect(WeaponSoulSuit.prototype,"WeaponSoulSuit");var WingLevelConfig=function(){function t(){this.exp=0,this.pasSkillId=0}return t}();__reflect(WingLevelConfig.prototype,"WingLevelConfig");var WorldBossBaseConfig=function(){function t(){this.refreshHour=0,this.refreshMinute=0,this.levelUpTime=0,this.challengeCd=0,this.convertRate=0,this.maxGold=0,this.clearCdCost=[],this.lotteryTime=0,this.dayCount=[],this.buyCountPrice=[],this.rebornItem=0}return t}();__reflect(WorldBossBaseConfig.prototype,"WorldBossBaseConfig");var WorldBossConfig=function(){function t(){this.zsLevel=0,this.level=0,this.fbid=0,this.bossId=0,this.shield=0,this.vip=0,this.samsaraLv=0,this.lianjiLv=0}return t}();__reflect(WorldBossConfig.prototype,"WorldBossConfig");var XueyuStageConfig=function(){function t(){this.stage=0,this.icon="",this.normalCost=0,this.attr=[],this.normalCostTip=0}return t}();__reflect(XueyuStageConfig.prototype,"XueyuStageConfig");var ZhiZunEquipLevel=function(){function t(){this.ex_power=0}return t}();__reflect(ZhiZunEquipLevel.prototype,"ZhiZunEquipLevel"),window.ZhiZunEquipLevel=ZhiZunEquipLevel;var ZhiZunLinkLevel=function(){function t(){this.ex_power=0}return t}();__reflect(ZhiZunLinkLevel.prototype,"ZhiZunLinkLevel");var ZhulingCostConfig=function(){function t(){this.level=1,this.itemId=1,this.count=1}return t}();__reflect(ZhulingCostConfig.prototype,"ZhulingCostConfig");var ItemConst;!function(t){t[t.RENAME=450001]="RENAME",t[t.EXP_ITEM=200137]="EXP_ITEM",t[t.GUANYIN_ITEM=600005]="GUANYIN_ITEM",t[t.LEVELUP_ITEM=200155]="LEVELUP_ITEM",t[t.GOLD_BRICK=200164]="GOLD_BRICK",t[t.TREASURE_ITEM=200165]="TREASURE_ITEM",t[t.TREASURE_RUNE=200166]="TREASURE_RUNE",t[t.PUBLICBOSS=200156]="PUBLICBOSS",t[t.WORLDBOSS=200157]="WORLDBOSS",t[t.FIRE_FB=202e3]="FIRE_FB",t[t.GODWING_ITEM=601e3]="GODWING_ITEM",t[t.THANKS_ITEM=0]="THANKS_ITEM",t[t.SHENYUBOSS=200995]="SHENYUBOSS",t[t.WEIWANG_ITEM=200318]="WEIWANG_ITEM",t[t.GODWEAPON_ITEM=200333]="GODWEAPON_ITEM",t[t.JINGJIN=200332]="JINGJIN"}(ItemConst||(ItemConst={})),window.ItemConst=ItemConst;var ItemType;!function(t){t[t.TYPE_0=0]="TYPE_0",t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6",t[t.TYPE_7=7]="TYPE_7",t[t.TYPE_8=8]="TYPE_8",t[t.TYPE_9=9]="TYPE_9",t[t.TYPE_10=10]="TYPE_10",t[t.TYPE_11=11]="TYPE_11",t[t.TYPE_12=12]="TYPE_12",t[t.TYPE_13=13]="TYPE_13",t[t.TYPE_14=14]="TYPE_14",t[t.TYPE_15=15]="TYPE_15",t[t.TYPE_16=16]="TYPE_16",t[t.TYPE_17=17]="TYPE_17",t[t.TYPE_18=18]="TYPE_18",t[t.TYPE_19=19]="TYPE_19",t[t.TYPE_20=20]="TYPE_20",t[t.TYPE_21=21]="TYPE_21",t[t.TYPE_22=22]="TYPE_22",t[t.TYPE_23=23]="TYPE_23",t[t.TYPE_24=24]="TYPE_24",t[t.TYPE_25=25]="TYPE_25",t[t.TYPE_26=26]="TYPE_26",t[t.TYPE_27=27]="TYPE_27",t[t.TYPE_28=28]="TYPE_28",t[t.TYPE_29=29]="TYPE_29",t[t.TYPE_30=30]="TYPE_30",t[t.TYPE_31=31]="TYPE_31",t[t.TYPE_32=32]="TYPE_32",t[t.TYPE_33=33]="TYPE_33",t[t.TYPE_34=34]="TYPE_34",t[t.TYPE_35=35]="TYPE_35",t[t.TYPE_36=36]="TYPE_36",t[t.TYPE_37=37]="TYPE_37",t[t.TYPE_38=38]="TYPE_38",t[t.TYPE_39=39]="TYPE_39",t[t.TYPE_40=40]="TYPE_40",t[t.TYPE_41=41]="TYPE_41",t[t.TYPE_42=42]="TYPE_42",t[t.TYPE_43=43]="TYPE_43",t[t.TYPE_44=44]="TYPE_44",t[t.TYPE_45=45]="TYPE_45",t[t.TYPE_46=46]="TYPE_46",t[t.TYPE_47=47]="TYPE_47"}(ItemType||(ItemType={})),window.ItemType=ItemType;var JobConst;!function(t){t[t.None=0]="None",t[t.ZhanShi=1]="ZhanShi",t[t.FaShi=2]="FaShi",t[t.DaoShi=3]="DaoShi"}(JobConst||(JobConst={})),window.JobConst=JobConst;var MoneyConst;!function(t){t[t.exp=0]="exp",t[t.gold=1]="gold",t[t.yuanbao=2]="yuanbao",t[t.fame=3]="fame",t[t.soul=4]="soul",t[t.wing=5]="wing",t[t.feat=7]="feat",t[t.rune=9]="rune",t[t.piece=10]="piece",t[t.punch1=11]="punch1",t[t.punch2=12]="punch2",t[t.godweaponExp=13]="godweaponExp",t[t.weiWang=14]="weiWang",t[t.chip=15]="chip",t[t.shoushenExp=16]="shoushenExp",t[t.dartCarScore=20]="dartCarScore",t[t.dartCarGuildScore=21]="dartCarGuildScore"}(MoneyConst||(MoneyConst={})),window.MoneyConst=MoneyConst;var skillConst=function(){function t(){}return t.baseSkillIndex=[11,21,31],t}();__reflect(skillConst.prototype,"skillConst");var SystemType;!function(t){t[t.FIRSTCHARGE=1]="FIRSTCHARGE",t[t.ACTIVITY=2]="ACTIVITY",t[t.RANK=3]="RANK",t[t.MALL=4]="MALL",t[t.FULI=5]="FULI",t[t.MONTHCARD=6]="MONTHCARD",t[t.TREASURE=7]="TREASURE",t[t.WORLDMAP=8]="WORLDMAP",t[t.RING=9]="RING",t[t.MIJI=10]="MIJI",t[t.BOSS=11]="BOSS",t[t.FB=12]="FB",t[t.ONEKEY=13]="ONEKEY",t[t.CHALLENGE=14]="CHALLENGE",t[t.SHENQIGUIDE=15]="SHENQIGUIDE",t[t.BOOK=16]="BOOK",t[t.WEAPONS=17]="WEAPONS",t[t.GUILD=18]="GUILD",t[t.VIPGIFT=19]="VIPGIFT",t[t.LIMITTASK=20]="LIMITTASK",t[t.FOCUS=21]="FOCUS",t[t.SHARE=22]="SHARE",t[t.FENGCE=23]="FENGCE",t[t.DAILYGIFT=24]="DAILYGIFT",t[t.QUICKDROP=25]="QUICKDROP",t[t.MABI=26]="MABI",t[t.NEWEQUIP=27]="NEWEQUIP",t[t.CITYMONSTER=28]="CITYMONSTER",t[t.DOUBLEELEVEN=29]="DOUBLEELEVEN",t[t.GODWEAPON=30]="GODWEAPON",t[t.SUPERVIP=31]="SUPERVIP",t[t.CITY=32]="CITY",t[t.THANKS=33]="THANKS",t[t.HFACTIVITY=34]="HFACTIVITY",t[t.DOUBLE_TWELVE=35]="DOUBLE_TWELVE",t[t.DOUBLE_TWELVE_RECHARGE=36]="DOUBLE_TWELVE_RECHARGE",t[t.BATTLE=37]="BATTLE",t[t.PAODIAN=38]="PAODIAN",t[t.CHRISTMAS=39]="CHRISTMAS",t[t.NEWYEAR=40]="NEWYEAR",t[t.HAPPYSEVENDAY=41]="HAPPYSEVENDAY",t[t.CELEBRATION=42]="CELEBRATION",t[t.CHAT=43]="CHAT",t[t.ZHIZUN=44]="ZHIZUN",t[t.LABA=45]="LABA",t[t.SPRINGBEGIN=46]="SPRINGBEGIN",t[t.ZHANLING=47]="ZHANLING",t[t.WXGAMESHARE=48]="WXGAMESHARE",t[t.WXGAMEGUANZHU=49]="WXGAMEGUANZHU",t[t.VIP_ENTRY=50]="VIP_ENTRY",t[t.KAIMENHONG=51]="KAIMENHONG",t[t.SANBA=52]="SANBA",t[t.LONGTAITOU=53]="LONGTAITOU",t[t.VERSIONCEL=54]="VERSIONCEL",t[t.PROVE=55]="PROVE",t[t.QINGMING=56]="QINGMING",t[t.FIGHT=57]="FIGHT",t[t.ROLEOPEN=58]="ROLEOPEN",t[t.BANGDING=59]="BANGDING",t[t.TXSHIPIN=60]="TXSHIPIN",t[t.NEWGUIDETASK=61]="NEWGUIDETASK",t[t.FASHIONLEASING=62]="FASHIONLEASING",t[t.REXUEDIED=63]="REXUEDIED",t[t.BOSSREVELRY=64]="BOSSREVELRY",t[t.INVESTMENT=65]="INVESTMENT",t[t.LIMITGIFT=66]="LIMITGIFT",t[t.LIMITCHEAPIE=67]="LIMITCHEAPIE",t[t.TREASUREROOM=68]="TREASUREROOM",t[t.CDRECHARGE=69]="CDRECHARGE",t[t.CUMULRECHARGE=70]="CUMULRECHARGE",t[t.EXCLUSIVE=71]="EXCLUSIVE",t[t.SECKILL=72]="SECKILL",t[t.WARORDER=73]="WARORDER",t[t.LIMITEDGIFT=74]="LIMITEDGIFT",t[t.BOSSFIRSTKILL=75]="BOSSFIRSTKILL",t[t.PActivity55=76]="PActivity55"}(SystemType||(SystemType={})),window.SystemType=SystemType;var BossUIBtnItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="worldBossAtbtn",e}return __extends(e,t),e}(eui.Component);__reflect(BossUIBtnItem.prototype,"BossUIBtnItem"),window.BossUIBtnItem=BossUIBtnItem;var DefeatItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DefeatItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this);var t="|U&S:"+this.jump.size+"&C:"+this.jump.textColor+"&T:"+this.jump.text+"|";this.jump.textFlow=TextFlowMaker.generateTextFlow1(t)},e.prototype.onClick=function(t){switch(t.target){case this.openRole0:case this.jump:this.showDetail()}},e.prototype.showDetail=function(){this.cfg&&(ViewManager.ins().isShow(MaterialResultWin)?ViewManager.ins().close(MaterialResultWin):ViewManager.ins().isShow(TongResultWin)?ViewManager.ins().close(TongResultWin):ViewManager.ins().isShow(CityResultWin)?ViewManager.ins().close(CityResultWin):ViewManager.ins().isShow(NewWorldBossResultPanel)?ViewManager.ins().close(NewWorldBossResultPanel):ViewManager.ins().isShow(BossResultWin)?ViewManager.ins().close(BossResultWin):ViewManager.ins().isShow(PersonalResultWin)?ViewManager.ins().close(PersonalResultWin):ViewManager.ins().close(ResultWin),"VipWin"==this.cfg.gainWay[1]?ViewManager.ins().open(this.cfg.gainWay[1],Actor.vip+1):ViewManager.ins().open(this.cfg.gainWay[1],this.cfg.gainWay[2]))},e.prototype.dataChanged=function(){if(!isNaN(this.data)){this.cfg=null;var t=void 0;for(var e in GlobalConfig.DeathgainWayConfig)if(t=GlobalConfig.DeathgainWayConfig[e],t.level==this.data){this.cfg=t;break}if(this.cfg){if(14==this.cfg.level){var i=Recharge.ins().getRechargeData(0);i&&0!=i.num||(this.cfg=GlobalConfig.DeathgainWayConfig[20])}this.icon.source=this.cfg.itemId,this.iconName.text=this.cfg.gainWay[0],this.desc.visible=!1,this.up.visible=this.desc.visible}16==this.data&&(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.jump.parent.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.mc.touchEnabled=!1),this.mc.x=this.jump.x+18,this.mc.y=this.jump.y+9,this.mc.scaleX=this.mc.scaleY=.4,this.icon.scaleX=this.icon.scaleY=.55)}},e}(BaseItemRender);__reflect(DefeatItem.prototype,"DefeatItem"),window.DefeatItem=DefeatItem;var DropDown=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.skinName="DropDownSkin",this.touchEnabled=!0,this.currentState="up",this.addChangeEvent(this.list,this.listSelect),this.addTouchEvent(this,this.onTap),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this),this.dataPro=new eui.ArrayCollection,this.list.itemRenderer=DropDownListItem,this.list.dataProvider=this.dataPro},e.prototype.listSelect=function(t){this.value.text=this.list.selectedItem.name},e.prototype.removeStage=function(t){this.stage&&this.removeTouchEvent(this.stage,this.onTap)},e.prototype.onTap=function(t){this.currentState="up"==this.currentState?"down":"up",t.stopPropagation(),this.stage&&("down"==this.currentState?this.addTouchEvent(this.stage,this.onTap):this.removeTouchEvent(this.stage,this.onTap))},e.prototype.setData=function(t){this.dataPro.replaceAll(t)},e.prototype.setSelectedIndex=function(t){this.list.selectedIndex=t},e.prototype.getSelectedIndex=function(){return this.list.selectedIndex},e.prototype.setLabel=function(t){this.value.text=t},e.prototype.getLabel=function(){return this.value.text},e.prototype.setEnabled=function(t){this.list.touchEnabled=t,this.list.touchChildren=t},e.prototype.getEnabled=function(){return this.list.touchEnabled},e.prototype.destructor=function(){this.list.removeEventListener(egret.Event.CHANGE,this.listSelect,this),this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this),this.removeStage()},e}(BaseView);__reflect(DropDown.prototype,"DropDown");var DropDownListItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.nameLbl.text=this.data.name},e}(BaseItemRender);__reflect(DropDownListItem.prototype,"DropDownListItem"),window.DropDown=DropDown;var EncounterInfoItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuInfoItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.currentState="have",this.eName.text=""+t.name,this.eLv.text=""+(t.zsLv?t.zsLv+"转":"")+t.lv+"级",this.eFace.source="head_"+t.subRole[0].job+t.subRole[0].sex,this.eHbg.source="touxiangkuang"+t.subRole[0].sex,EncounterFight.ins().encounterIndex!=t.index?this.eBtn.label="挑 战":this.eBtn.label="挑战中",t.treasureId&&(this.mibao.visible=!0)}else this.currentState="none"},e}(BaseItemRender);__reflect(EncounterInfoItem.prototype,"EncounterInfoItem"),window.EncounterInfoItem=EncounterInfoItem;var EquipTipsBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="UsualEquipTipsSkin",e}return __extends(e,t),e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.func&&this.changeBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.func,this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.itemType=t[0],this.id=t[1],this.sco=t[2],this.power=t[3],this.desc=t[4],this.attrs=t[5],this.func=t[6],this.changeBtn.label=t[7]?t[7]:this.changeBtn.label;var i=t[8],n=t[9];this.func?this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.func,this):this.setHideButton();var s=GlobalConfig.ItemConfig[this.id];this.itemIcon.setData(s),this.itemIcon.setTag(i);var o=ItemUtil.getQuality(s);this.quali.source=o>0?"quali"+o:"",this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemUtil.getQualityColor(s)+"&T:"+(n?n:s.name)),this.score.text="评分："+this.sco,this.typeName.textFlow=TextFlowMaker.generateTextFlow1(this.desc.left),this.typeValue.textFlow=TextFlowMaker.generateTextFlow1(this.desc.right),this.powerPanel.setPower(this.power);for(var a=0;a<this.attrs.length;a++){var r=new EquipTipsItemBase;r.data={title:this.attrs[a].title,attributeData:this.attrs[a].attr,colorName:this.attrs[a].colorName,colorValue:this.attrs[a].colorValue,others:this.attrs[a].others},this.content.addChild(r)}},e.prototype.setHideButton=function(){this.changeBtn.visible=!1},e}(BaseEuiView);__reflect(EquipTipsBase.prototype,"EquipTipsBase"),window.EquipTipsBase=EquipTipsBase,ViewManager.ins().reg(EquipTipsBase,LayerManager.UI_Popup);var EquipTipsItemBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="UsualEquipTipsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.title,e=this.data.colorName,i=this.data.colorValue,n=this.data.attributeData,s=this.data.others,o="",a="";s&&s.suitdesc||DisplayUtils.removeFromParent(this.desc1);for(var r=0;r<n.length;r++)o+=AttributeData.getAttrStrByType(n[r].type)+": \n",a+=n[r].type==AttributeType.atMaxHp||n[r].type==AttributeType.atAttack||n[r].type==AttributeType.atDef||n[r].type==AttributeType.atRes?n[r].value:n[r].value/100+"%",a+="\n";if(o){var l=o.lastIndexOf("\n");o=o.substring(0,l)}if(a){var l=a.lastIndexOf("\n");a=a.substring(0,l)}if(s&&s.exdesc){var h=s.exdesc.split("+");1==h.length?o+=h[0]:(o+="\n"+h[0]+":",a+="\n"+h[1])}this.attrType.textFlow=TextFlowMaker.generateTextFlow1(t),this.attrName.textFlow=TextFlowMaker.generateTextFlow1(e?"|C:"+e+"&T:"+o:""+o),this.attrValue.textFlow=TextFlowMaker.generateTextFlow1(i?"|C:"+i+"&T:"+a:""+a),this.desc1&&this.desc1.parent&&(this.suit.textFlow=TextFlowMaker.generateTextFlow1(s.suitdesc))}},e}(BaseItemRender);__reflect(EquipTipsItemBase.prototype,"EquipTipsItemBase"),window.EquipTipsItemBase=EquipTipsItemBase;var FbItem=function(t){function e(){var e=t.call(this)||this;return e.isDouble=0,e.skinName="DailyFbItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.item.isShowName(!1),this.starValue=0},e.prototype.starSaoDang=function(t){return void 0===t&&(t=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isDouble=t,this.barGaroup.visible=!0,this.isDouble?(this.doublePrice.visible=!1,this.barGaroup.x=this.doublePrice.x):(this.price.visible=!1,this.barGaroup.x=this.price.x),this.bar.labelFunction=function(){return"扫荡中"},[4,Timer.start(50,20,this.refushBar,this)];case 1:return e.sent(),this.overPlay(),[2]}})})},e.prototype.refushBar=function(){this.isDouble?this.doubleChallengeBtn.enabled=!1:this.challengeBtn.enabled=!1,this.starValue+=7,this.bar.value=this.starValue},e.prototype.overPlay=function(){0!=this.starValue&&(this.barGaroup.visible=!1,this.isDouble?(this.doublePrice.visible=!0,this.doubleChallengeBtn.enabled=!0):(this.price.visible=!0,this.challengeBtn.enabled=!0),this.starValue=0,FbCT.ins().sendAddCount(this.data,this.isDouble))},e.prototype.dataChanged=function(){if(this.doubleActivityId=GlobalConfig.DailyFubenConfig[this.data].doubleActivity||null,this.doubleActivityId){var t=void 0;for(var e in this.doubleActivityId)if(t=Activity.ins().getActivityDataById(this.doubleActivityId[e]),null!=t)break;var i=0,n=0;t&&(i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3),n=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3)),i>0&&0>n&&(this["double"].visible=!0)}else this["double"].visible=!1;this.bg.source=this.data+"bg";var s=GlobalConfig.DailyFubenConfig[this.data];if(this.item.data=s.showItem,this.levelRequire.text="",s.zsLevel>0){var o=s.zsLevel+"转开启",a=ZsCT.ins().lv>=s.zsLevel;this.currentState=a?"canChallenge":"noChallenge",this.validateNow(),this.levelRequire.text=a?"":o}else this.currentState=Actor.level>=s.levelLimit?"canChallenge":"noChallenge",this.validateNow(),this.levelRequire.text=s.levelLimit+"级开启";this.levelRequire.visible=!0;var r=FbCT.ins().getFbDataById(this.data),l=r.getCount(),h=l>0?"#40D016":"#DFD1B5";this.redPoint.visible=l>0;var u=r.getResetCount();l>0?this.count.textFlow=(new egret.HtmlTextParser).parser('今日挑战次数：<font color="'+h+'">1次</font>'):(this.count.textFlow=(new egret.HtmlTextParser).parser('今日可扫荡次数：<font color="'+h+'">'+u+"次</font>"),this.redPoint.visible=DieGuide.ins().dieFbRedPoint(u,this.data)),this.price.visible=0==l&&"canChallenge"==this.currentState,Recharge.ins().franchise&&r.isPass?this.challengeBtn.label=l?"快速挑战":"扫  荡":ZsCT.ins().lv>=s.sweepLevel&&r.isPass?this.challengeBtn.label=l?"快速挑战":"扫  荡":this.challengeBtn.label=l?"挑  战":"扫  荡",this.challengeBtn.name=l?"":"add",this.challengeBtn.enabled=!0,this.doublePrice.visible=this.doubleChallengeBtn.visible=!1,this.doubleChallengeBtn.name="double";var p=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];this.challengeBtn.filters=[],this.count.verticalCenter=-45,this.count.right=20;var c=r.getNextVip(),d=0,g=0,f=GlobalConfig.MonthCardConfig.sweepPrecent/100,v=Recharge.ins().monthDay>0?1-f:1;if(0==l){if(0>=u)switch(c){case-1:this.count.text="今日扫荡次数已经用完",this.count.verticalCenter=0,this.count.right=50,this.challengeBtn.visible=!1,this.price.visible=!1,this.doublePrice.visible=!1,this.levelRequire.visible=!1;break;default:Actor.vip<c?(this.count.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor(""+VipCT.getVipStr(c,!0),14942722)+"可额外扫荡1次"),this.challengeBtn.filters=[new egret.ColorMatrixFilter(p)],this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=!1):(this.count.text=VipCT.getVipStr(c,!0)+"可额外扫荡1次",this.doubleChallengeBtn.enabled=this.challengeBtn.enabled=!0)}d=Math.floor(s.buyPrice[r.vipBuyCount]*v),this.price.setPrice(d),u>0&&s.buyDoublePrice&&(Actor.level>=s.levelLimit&&(this.doublePrice.visible=this.doubleChallengeBtn.visible=!0),s.buyDoublePrice&&(g=s.buyDoublePrice[r.vipBuyCount]*v,this.doublePrice.setPrice(g)))}else"canChallenge"==this.currentState&&(this.challengeBtn.visible=!0)},e}(BaseItemRender);__reflect(FbItem.prototype,"FbItem"),window.FbItem=FbItem;var ForgeZhuItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CastingZBItemSkin",e}return __extends(e,t),e.prototype.updateItem=function(t,e,i,n,s){void 0===s&&(s=!0),this.add.visible=i>0;var o=GlobalConfig.StoneOpenConfig[e];if(Actor.level>=o.openLv){var a=ForgeCT.ins().getStoneLevelCostConfigByLv(i+1),r=0;a&&(r=a.soulNum),this.state.visible=n>=r,i>=80&&(this.state.visible=!1),this.num0.source="lv_"+(i>99?Math.floor(i/100):i>9?Math.floor(i/10):i)+"_png",this.num1.source=""+(i>99?"lv_"+Math.floor(i/10%10)+"_png":i>9?"lv_"+i%10+"_png":""),this.num2.source=""+(i>99?"lv_"+i%100%10+"_png":""),t?this.setItemImg(t.icon+"_png"):this.setItemImg("xb_"+(e+10).toString()),this.unlock.visible=!1,this.openLv.visible=!1}else this.state.visible=!1,this.unlock.visible=!0,this.openLv.visible=!0,this.add.visible=!1,this.setItemImg("xb_"+(e+10)),this.openLv.text=o.openLv+"";this.num1.visible=this.num0.visible=this.num2.visible=this.add.visible,s||(this.state.visible=!1)},e.prototype.hideAdd=function(){this.add.visible=!1,this.num0.visible=!1,this.num1.visible=!1,this.num2.visible=!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemIcon.imgJob.visible=!1},e.prototype.setItemImg=function(t){this.itemIcon.imgIcon.source=t},e.prototype.dataChanged=function(){this.updateItem(this.data.item,this.data.pos,this.data.lv,this.data.itemNum)},e}(BaseItemRender);__reflect(ForgeZhuItem.prototype,"ForgeZhuItem"),window.ForgeZhuItem=ForgeZhuItem;var GuildInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.isInit=!1,e.userGuild=Guild.ins(),e}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){this.checkJoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.checkJoin.text+"</u></a>"),this.checkJoin.touchEnabled=!0,this.list.itemRenderer=GuildMemberItem1Render,this.eff=new MovieClip,this.eff.x=this.checkJoin.x+40,this.eff.y=this.checkJoin.y+10,this.isInit=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isInit||this.initUI(),this.addTouchEvent(this.checkJoin,this.onLinkApply),this.addTouchEvent(this.cityBtn,this.onTap),this.addTouchEvent(this.conBtn,this.onTap),this.addTouchEvent(this.rename,this.onTap),this.observe(Guild.ins().postGuildInfo,this.updateGuild),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(Guild.ins().postChangeNotice,this.updateGuild),this.observe(Guild.ins().postGuildMoney,this.updateGuild),this.observe(Guild.ins().postApplyInfos,this.updateApplys),this.observe(Guild.ins().postJoinGuild,this.updateApplys),this.observe(Guild.ins().postGuildMembers,this.updateMember),this.observe(Guild.ins().postConCount,this.updateRedPoint),this.updateApplys(),this.updateMyInfo(),this.updateGuild(),this.updateMember()},e.prototype.updateRedPoint=function(){this.redPoint.visible=Guild.ins().hasDonate()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.conBtn:ViewManager.ins().open(GuildConWin);break;case this.cityBtn:ViewManager.ins().open(GuildNoticeWin);break;case this.rename:ViewManager.ins().open(GuildChangeNameView)}},e.prototype.updateMyInfo=function(){this.myCon.text=this.userGuild.myCon+"",this.checkJoin.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU,this.cityBtn.visible=this.userGuild.myOffice>=GuildOffice.GUILD_FUBANGZHU},e.prototype.updateGuild=function(){this.guildName.text=this.userGuild.guildName,this.guildLevel.text=this.userGuild.guildLv.toString(),this.guildMoney.text=this.userGuild.money.toString(),this.notice.text=this.userGuild.notice,this.rename.visible=Guild.ins().changeNameNum&&this.userGuild.myOffice>=GuildOffice.GUILD_BANGZHU},e.prototype.updateMember=function(){var t=GlobalConfig.GuildConfig,e=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0,i=e?GlobalConfig.GuildConfig.affairMember[e-1]:0;this.guildMember.text=this.userGuild.getMemberNum()+"/"+(t.maxMember[Guild.ins().guildLv-1]+i),this.list.dataProvider=new eui.ArrayCollection(this.userGuild.getGuildMembers(1))},e.prototype.onLinkApply=function(){ViewManager.ins().open(GuildApplyListWin)},e.prototype.updateApplys=function(){this.userGuild.hasApplys()?(this.checkJoin.parent.addChildAt(this.eff,this.getChildIndex(this.checkJoin)),this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.scaleX=.7,this.eff.scaleY=.7):DisplayUtils.removeFromParent(this.eff)},e}(BaseView);__reflect(GuildInfoPanel.prototype,"GuildInfoPanel"),window.GuildInfoPanel=GuildInfoPanel;var GuildListPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildListItem2Render},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Guild.ins().postGuildList,this.updateList),this.updateList(),this.pageChange(0)},e.prototype.pageChange=function(t){this.curPage!=t&&t>=0&&t<Guild.ins().pageMax&&(this.curPage=t,Guild.ins().sendGuildList(this.curPage,6))},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().guildListInfos)},e}(BaseView);__reflect(GuildListPanel.prototype,"GuildListPanel"),window.GuildListPanel=GuildListPanel;var GuildManagePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.buildList.itemRenderer=GuildBuildItemRender,this.messageList.itemRenderer=GuildEventItenRender},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||TipsCT.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){this.addTouchEvent(this.buildList,this.onListTouch),this.observe(Guild.ins().postUpBuilding,this.updateList),this.observe(Guild.ins().postManageList,this.update),this.observe(Guild.ins().postGuildMoney,this.update),Guild.ins().sendManageList(),this.updateList()
},e.prototype.update=function(){this.messageList.dataProvider=new eui.ArrayCollection(Guild.ins().records)},e.prototype.updateList=function(){this.index=this.buildScroller.viewport.scrollV,this.buildList.dataProvider=new eui.ArrayCollection([GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG,GuildBuilding.GUILD_COMMENT,GuildBuilding.GUILD_SHOP]),this.refushBar()},e.prototype.refushBar=function(){Timer.stop(this.refushBarList,this),Timer.start(100,1,this.refushBarList,this)},e.prototype.refushBarList=function(){Timer.stop(this.refushBarList,this),this.buildScroller.viewport.scrollV=this.index},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap(t.target)}},e}(BaseView);__reflect(GuildManagePanel.prototype,"GuildManagePanel"),window.GuildManagePanel=GuildManagePanel;var GuildMemberPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildMemberItem2Render,this.dataArr=new eui.ArrayCollection,this.list.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.quitBtn,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(Guild.ins().postGuildMembers,this.updateMember),this.updateMyInfo(),this.updateMember()},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e.prototype.updateMember=function(){var t=Guild.ins().getGuildMembers(1);this.dataArr.replaceAll(t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.quitBtn:if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("战期间,不允许退出公会",function(){},this);if(Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU&&Guild.ins().getMemberNum()>1)return void WarnWin.show("需要先进行禅让，才可退出行会",function(){},this);WarnWin.show("是否确定退出公会，\n退出后贡献值清0。\n公会技能继续生效。",function(){Guild.ins().sendQuitGuild()},this,null,null,"normal","center")}},e.prototype.updateMyInfo=function(){this.office.text=GuildLanguage.guildOffice[Guild.ins().myOffice],this.totalCon.text=Guild.ins().myTotalCon+""},e}(BaseView);__reflect(GuildMemberPanel.prototype,"GuildMemberPanel"),window.GuildMemberPanel=GuildMemberPanel;var GuildTaskPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=GuildTaskItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.list,this.onListTouch),this.list.dataProvider=Guild.ins().guildTaskInfos},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e}(BaseView);__reflect(GuildTaskPanel.prototype,"GuildTaskPanel"),window.GuildTaskPanel=GuildTaskPanel;var GwBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e._lastX=0,e._lastY=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastX=t.stageX,this._lastY=t.stageY,this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(t){MathUtils.getDistance(this._lastX,this._lastY,t.stageX,t.stageY)>20&&(this._move=!0)},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e,i,n=this.data;switch(n.bossType){case BossCT.BOSS_SUBTYPE_XUANWUBOSS:var s=GlobalConfig.XuanWuBossConfig[n.id];t=s.bossId,i=YuanshenData.ins().isInTheRange(s.lianjiLv),e=YuanshenData.getName(s.lianjiLv[0]),this.txt.text="非对应元神等级";break;case BossCT.BOSS_SUBTYPE_TXMY:var o=GlobalConfig.CrossBossConfig[n.id];t=o.bossId,i=KFBossSys.ins().canChallengeTxmy(o.id),e=o.levelLimit[0]/1e3+"转",this.txt.text=o.levelLimit[0]/1e3+"转开启";break;case BossCT.BOSS_SUBTYPE_VIPBOSS:var a=GlobalConfig.WorldBossConfig[n.id];t=a.bossId,e=a.belongRewardVipLimit+"",this.txt.text=VipCT.getVipStr(a.belongRewardVipLimit,!0)+"级开启",i=Actor.vip>=a.belongRewardVipLimit;break;default:var r=GlobalConfig.WorldBossConfig[n.id],l=1e3*ZsCT.ins().lv+Actor.level,h=1e3*r.zsLevel[0]+r.level;i=l>=h,t=r.bossId,r.samsaraLv>0&&(e=r.showName),e=r.zsLevel[0]>0?r.zsLevel[0]+"转-"+r.zsLevel[1]+"转":r.level+"级"}switch(this.checkBoxs.visible=i,this.txt.visible=!i,n.bossType){case BossCT.BOSS_SUBTYPE_TXMY:i&&(this.checkBoxs.selected=BossCT.ins().getBossRemindByIndex(n.bossAlert)),this.checkBoxs.name=n.bossAlert+"";break;default:i&&(this.checkBoxs.selected=BossCT.ins().getBossRemindByIndex(n.id)),this.checkBoxs.name=n.id+""}var u=GlobalConfig.MonstersConfig[t];this.bossName.text=u.name,this.levelShow.text=e},e}(BaseItemRender);__reflect(GwBossRemindItem.prototype,"GwBossRemindItem"),window.GwBossRemindItem=GwBossRemindItem;var HeirloomItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.clear(),this.data){this.data.icon&&(this.lv.visible=this.lvBg.visible=!1);var t=this.data.info;this.itemIcon.setData(t,this.data.pos,this.data.icon,this.data.uplevel),this.itemIcon.effect&&this.addChildAt(this.itemIcon.effect,this.getChildIndex(this.selectIcon)),this.lv.visible=!!t,this.data.icon?(this.lvBg.visible=this.lv.visible=!1,this.skillname=this.data.skillname,this.skilldesc=this.data.skilldesc,this.equipName.visible=!1):(t&&t.lv>0?(this.lv.visible=!0,this.lv.source="heir_0"+t.lv):this.lv.visible=!1,this.lvBg.visible=this.lv.visible),t.name&&(this.equipName.text=t.name),this.data.uplevel&&this.setUpEff()}},e.prototype.cleanEff=function(){this.itemIcon.cleanEff()},e.prototype.setTipsVisible=function(){this.itemIcon.imgRect.visible=!1,this.equipName.visible=!1},e.prototype.clear=function(){this.cleanEff()},e.prototype.setSelectIconVisible=function(t){this.selectIcon.visible=t;var e=this.itemIcon.y;this.itemIcon.imgRect.visible||(e=this.itemIcon.y-1),this.selectIcon.y=e},e.prototype.setUpEff=function(){null==this.upEffect&&(this.upEffect=new MovieClip,this.upEffect.x=this.itemIcon.x+this.itemIcon.width/2,this.upEffect.y=this.itemIcon.y+this.itemIcon.height/2,this.addChild(this.upEffect)),this.upEffect.playFile(RES_DIR_EFF+"promoteeff",1)},e.QUALITY_COLOR=[14868436,3532333,13779707,16741647,15937822,16767295],e}(BaseItemRender);__reflect(HeirloomItem.prototype,"HeirloomItem"),window.HeirloomItem=HeirloomItem;var HeirloomItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomItemIcon",e.imgRect.visible=!0,e}return __extends(e,t),e.prototype.setSkillData=function(t){this.imgRect.visible=!1,this.imgIcon.source=t},e.prototype.setData=function(t,e,i,n){if(void 0===n&&(n=!1),this.imgRect.visible=!0,null!=t&&((i||t.icon)&&(this.imgIcon.source=(i?i:t.icon)+"_png"),t.lv>0&&!i))return this.imgRect.visible=!1,null==this.effect&&(this.effect=new MovieClip,this.effect.x=this.width/2,this.effect.y=this.height/2,this.addChildAt(this.effect,this.getChildIndex(this.imgIcon)+1)),void this.effect.playFile(RES_DIR_EFF+"ValueEff4",-1);if(i)this.imgRect.visible=t.lv<=0;else{var s=GlobalConfig.HeirloomEquipConfig[e+1][1];this.imgIcon.source=s.icon+"_png"}},e.prototype.cleanEff=function(){DisplayUtils.removeFromParent(this.effect),this.effect=null},e}(eui.Component);__reflect(HeirloomItemIcon.prototype,"HeirloomItemIcon"),window.HeirloomItemIcon=HeirloomItemIcon;var HejiPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.effArr=[],e.otherWhite="#D1C28F",e.colorWhite="#f8b141",e.colorGray="#444134",e.otherWhiteN=13746831,e.colorWhiteN=16298305,e.colorGrayN=4473140,e.unActTextArr=["装备3件符文大幅增强对玩家的伤害","装备5件符文大幅增强对怪物的伤害","装备8件符文大幅减少合击冷却时间"],e.jobId=0,e.log="HejiPanel ",e}return __extends(e,t),e.prototype.skinComplete=function(){this.log+="skinComplete ",this.HejiSkillMc1=new MovieClip,this.HejiSkillMc1.x=207,this.HejiSkillMc1.y=316,this.Punchpre.addChild(this.HejiSkillMc1),this.HejiSkillMc2=new MovieClip,this.HejiSkillMc2.x=434,this.HejiSkillMc2.y=425,this.Punchpre.addChild(this.HejiSkillMc2),this.preViewText.textFlow=(new egret.HtmlTextParser).parser("<font color = '#23C42A'><u>"+this.preViewText.text+"</u></font>");for(var t=0;8>t;t++)this["itemEff"+t]=new MovieClip,this["itemEff"+t].x=177,this["itemEff"+t].y=174,this["itemEff"+t].rotation=45*t,this["itemEff"+t].touchEnabled=!1,this.effArr.push(this["itemEff"+t]);this.jobId=SubRoles.ins().getSubRoleByIndex(0).job,this.mcSkillID="40"+this.jobId;var e=403+this.jobId;this.targetSkillID=""+e},e.prototype.addDisplay=function(){this.log+="addDisplay ",this.addTouchEvent(this.UplevelBtn1,this.onClick),this.addTouchEvent(this.AttrBtn,this.onClick),this.addTouchEvent(this.punchtogether1,this.onClick),this.addTouchEvent(this.preViewText,this.onClick),this.addTouchEvent(this.skillitem,this.onClick),this.addTouchEvent(this.clickGroup,this.onClick),this.addTouchEvent(this.fenjieBtn,this.onClick),this.addTouchEvent(this.turnPunchForge,this.onClick),this.observe(SkillCT.ins().postHejiUpdate,this.setData),this.observe(SkillCT.ins().postHejiEquipChange,this.setData),this.observe(Actor.ins().postUpdateTogeatter,this.setData),this.observe(Actor.ins().postUpdateTogeatter,this.setRedPoint),this.observe(FbCT.ins().postGuanKaIdChange,this.setRedPoint),this.observe(BagCT.ins().postItemAdd,this.addItem),this.observe(BagCT.ins().postItemDel,this.setRedPoint),this.resetData(),this.setData(),this.setRedPoint()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeAllEffect(),Timer.stopAll(this),this.log+="removeDisplay "},e.prototype.resetData=function(){this.validateNow();for(var t=1;9>t;t++)this["item"+t].data=null},e.prototype.addItem=function(){this.refushPanelInfo(),this.setRedPoint()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.UplevelBtn1:FbCT.ins().guanqiaID<SkillCT.ACTIVE_LEVEL?TipsCT.ins().showTips("通关到第"+SkillCT.ACTIVE_LEVEL+"关开启"):(this.Activation.visible=SkillCT.ins().hejiLevel<=0,SkillCT.ins().sendGrewUpHejiSkill());break;case this.AttrBtn:ViewManager.ins().open(PunchEquipAttrWin);break;case this.punchtogether1:ViewManager.ins().open(PunchExchangeWin);break;case this.skillitem:ViewManager.ins().open(PunchSkillTipsWin);break;case this.preViewText:ViewManager.ins().open(PunchExtShowWin);break;case this.fenjieBtn:ViewManager.ins().open(PunchResWin);break;case this.turnPunchForge:this.Activation.visible=!1,this.Punchpre.visible=!1,this.Punch.visible=!1,this.PunchForge.visible=!0}},e.prototype.setRedPoint=function(){this.redPointEx.visible=SkillCT.ins().canExchange(),this.redPointSo.visible=SkillCT.ins().canSolve(),this.redPointAct.visible=SkillCT.ins().canAcitve(),this.redPointPf.visible=SkillCT.ins().getPunchForge().getRedPoint()},e.prototype.playSkillAnmi=function(){var t=this,e=egret.Tween.get(this.Punchpre);return this.HejiSkillMc1?(this.HejiSkillMc1.parent||this.Punchpre.addChild(this.HejiSkillMc1),this.HejiSkillMc1.playFile(""+RES_DIR_SKILLEFF+this.mcSkillID,1,null,!0),void e.wait(1500).call(function(){t.HejiSkillMc2.parent||t.Punchpre.addChild(t.HejiSkillMc2),t.HejiSkillMc2.playFile(""+RES_DIR_SKILLEFF+t.targetSkillID,1,null,!0)},this)):(this.log+="playSkillAnmi skinName="+this.skinName+",skin="+!!this.skin+" ",platform.reportError(this.log),void Timer.stopAll(this))},e.prototype.setData=function(){return SkillCT.ins().hejiLevel<=0?(this.Activation.visible=!0,this.Punchpre.visible=!1,this.Punch.visible=!1,this.PunchForge.visible=!1,void(this.activeTipsTxt.text="闯关达到 第"+SkillCT.ACTIVE_LEVEL+"关 即可开启合击技能")):void(Actor.level>=SkillCT.HEJI_SHOW_LEVEL?(this.PunchForge.visible?this.Punch.visible=!1:(this.Punch.visible=!0,this.PunchForge.visible=!1),this.Activation.visible=!1,this.Punchpre.visible=!1,this.setPunchView(),this.setPunch2View(),this.refushPanelInfo(),this.checkShowEff()):this.setPunchpreView())},e.prototype.setPunchpreView=function(){this.log+="setPunchpreView ",Timer.stop(this.playSkillAnmi,this),this.Activation.visible=!1,this.Punch.visible=!1,this.Punchpre.visible=!0,this.PunchForge.visible=!1,this.skillName.source="8000"+this.jobId+"_png";var t=GlobalConfig.TogetherHitConfig[SkillCT.ins().hejiLevel],e=new SkillData(t.skill_id[this.jobId-1]);this.skillIcon.source=e.id+"_png",Timer.start(3e3,0,this.playSkillAnmi,this),this.playSkillAnmi()},e.prototype.checkShowEff=function(){var t=SkillCT.ins().equipListData,e=-1,i=t.length;if(!t||8==t.length){for(var n=0;i>n;n++){var s=t[n];if(!s||!s.itemConfig)return;if(-1==e)e=1e4*(s.itemConfig.zsLevel||0)+s.itemConfig.level;else{var o=1e4*(s.itemConfig.zsLevel||0)+s.itemConfig.level;if(e!=o)return void this.removeAllEffect()}}this.playAllEffect()}},e.prototype.setPunch2View=function(){var t=GlobalConfig.TogetherHitConfig[SkillCT.ins().hejiLevel],e=new SkillData(t.skill_id[this.jobId-1]);this.skillitem.setData(e)},e.prototype.refushPanelInfo=function(){for(var t=[],e=1;9>e;e++){this["item"+e].data=e-1;var i=SkillCT.ins().equipListData[e-1];t=0==t.length?i.att:AttributeData.AttrAddition(t,i.att)}this.powerPanel.setPower(this.countAllAttNum()),this.validateNow(),this.updateForge()},e.prototype.countAllAttNum=function(){var t=SkillCT.ins().equipListData,e=0,i=t.length;if(t&&t.length<=0)return 0;for(var n=0;i>n;n++){var s=t[n];s&&s.configID&&(e+=s.point)}return e*SubRoles.ins().subRolesLen},e.prototype.playAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent||(this.effArr[t].playFile(RES_DIR_EFF+"HeJizbEff",-1),this.EffectGroup.addChild(this["itemEff"+t]))},e.prototype.removeAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent&&DisplayUtils.removeFromParent(this["itemEff"+t])},e.prototype.setPunchView=function(){var t,e=SkillCT.ins().qimingAttrDic,i=0,n=0,s=0,o=0,a="",r="",l="";this.currText3.text="",this.currText5.text="",this.currText8.text="",this.nextText1.text="",this.nextText2.text="",this.nextText3.text="";var h=0,u=0;if(e&&CommonUtils.getObjectLength(e)>0){for(var p in e)for(var c in e[p])i=e[p][c].zslv,n=e[p][c].lv;s=i+1,o=80,t=GlobalConfig.TogetherHitEquipQmConfig[i][n],this.paserText("currText",t,e[1e4*i+n])}else this.currTitleText.text="无",this.currText0.text="",this.currText3.text="",this.currText5.text="",this.currText8.text="",i=0,n=60,s=1,o=80,t=GlobalConfig.TogetherHitEquipQmConfig[i][n],this.paserText("currText",t);for(var d=0;d<SkillCT.ins().equipListData.length;d++){var g=SkillCT.ins().equipListData[d].itemConfig;if(g){var f=g.zsLevel?g.zsLevel:0,v=g.level?g.level:1;f>=i&&v>=n?(r=this.colorWhite,h++):r=this.colorGray,f>=s&&v>=o?(l=this.colorWhite,u++):l=this.colorGray}else r=l=this.colorGray;a+="<font color="+r+">"+Role.hejiPosName[d]+"  </font>"}this.currTitleText.text=i>0?i+"转齐鸣套装 ("+h+"/8)":n+"级齐鸣套装 ("+h+"/8)",this.currText0.textFlow=(new egret.HtmlTextParser).parser(a),this.preViewText.x=this.currTitleText.x+this.currTitleText.textWidth+10},e.prototype.paserText=function(t,e,i){void 0===i&&(i=null);var n={},s=SkillCT.ins().equipListData,o=0,a={};for(var r in s)if(0!=s[r].configID){var l=s[r].itemConfig,h=1e4*(l.zsLevel||0)+l.level;n[h]||(n[h]=0),n[h]+=1,o++,a[h]=ItemUtil.getQualityColor(l)}var u=0;for(var p in n)u=n[p],n[p]=o,o-=u;var c={},d=GlobalConfig.TogetherHitEquipQmConfig;for(var g in d)for(var h in d[g]){for(var f in n)if(Number(f)==1e4*Number(g)+Number(h)){var v=void 0;for(var y in d[g][h]){var m="";if(n[f]>=Number(y))m=Number(g)?"|C:"+a[f]+"&T:"+g+"转"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[g][h][y].desc:"|C:"+a[f]+"&T:"+h+"级"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[g][h][y].desc,c[y]=m,v=TextFlowMaker.generateTextFlow1(m);else if(!c[y]){var T=GlobalConfig.TogetherHitEquipQmConfig;for(var C in T){for(var b in T[C]){m="|C:"+a[f]+"&T:"+b+"级"+y+"件套:|C:"+this.otherWhiteN+"&T:"+d[C][b][y].desc,v=TextFlowMaker.generateTextFlow1(m);for(var I=0,w=v;I<w.length;I++){var S=w[I];S.style&&delete S.style.textColor}this[""+t+y].textColor=this.colorGrayN;break}break}}m&&(this[""+t+y].textFlow=v)}break}break}},e.prototype.updateForge=function(){this.turnPunchForge.visible=SkillCT.ins().getPunchForge().isShowPunchEquipForge()},e}(BaseView);__reflect(HejiPanel.prototype,"HejiPanel"),window.HejiPanel=HejiPanel;var HomeBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(){this._move=!0},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e=this.data,i=GlobalConfig.WorldBossConfig[e.id];for(var n in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[n].boss.lastIndexOf(e.id)){t=GlobalConfig.BossHomeConfig[n];break}var s=!1;t&&Actor.vip>=t.vip?(s=i.zsLevel>0?ZsCT.ins().lv>=i.zsLevel:Actor.level>=i.level,s||(this.txt.text="未满足挑战等级"),this.levelShow.text=i.zsLevel>0?i.zsLevel+"转":i.level+"级"):(s=!1,this.levelShow.text="",this.txt.text="未满足挑战VIP等级"),this.checkBoxs.visible=s,s&&(this.checkBoxs.selected=BossCT.ins().getBossRemindByIndex(e.id)),this.txt.visible=!this.checkBoxs.visible,this.checkBoxs.name=e.id+"";var o=GlobalConfig.MonstersConfig[i.bossId];this.bossName.text=o.name},e}(BaseItemRender);__reflect(HomeBossRemindItem.prototype,"HomeBossRemindItem"),window.HomeBossRemindItem=HomeBossRemindItem;var HonorMarketItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="HonorMarketItemSkin",e.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e),e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t&&t instanceof FeatsStore){this.goodsID=t.goods[0].id;var e=GlobalConfig.ItemConfig[this.goodsID];if(e)if(this.isShowTips=!1,t.shopType==FEATS_SHOP_TYPE.Money?(this.money.text=t.costMoney.count+"",this.moneyIcon.source="ZSchip"):t.shopType==FEATS_SHOP_TYPE.Item&&(this.money.text=t.costItem.count+"",this.moneyIcon.source="204076_png"),this.itemName.text=e.name,this.itemName.textColor=ItemUtil.getQualityColor(e),this.num.text=t.goods[0].count+"",this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e),t.use&&(this.usage.text="（"+t.use+"）"),t.buyType==FEATS_TYPE.forever){this.myTimes.visible=!0;var i=Shop.ins().medalData.exchangeCount[t.index];i=i?i:0;var n=this.myTimes.textColor,s=void 0,o="";t.daycount&&(i>=t.daycount?(s=ColorUtil.RED,o="永久限购:|C:"+s+"&T:"+i+"/"+t.daycount):(s=ColorUtil.GREEN,o="永久限购:|C:"+s+"&T:"+i+"|/|C:"+n+"&T:"+t.daycount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o)}else if(t.buyType==FEATS_TYPE.infinite)this.myTimes.visible=!1;else if(t.buyType==FEATS_TYPE.day){this.myTimes.visible=!0;var i=Shop.ins().medalData.exchangeCount[t.index];i=i?i:0;var n=this.myTimes.textColor,s=void 0,o="";t.daycount&&(i>=t.daycount?(s=ColorUtil.RED,o="每日限购:|C:"+s+"&T:"+i+"/"+t.daycount,this.isShowTips=!0):(s=ColorUtil.GREEN,o="每日限购:|C:"+s+"&T:"+i+"|/|C:"+n+"&T:"+t.daycount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o)}}},e.prototype.onClick=function(){return this.isShowTips?void TipsCT.ins().showTips("|C:16711680&T:今日已无兑换次数，请明日再来"):void(this.data.shopType==FEATS_SHOP_TYPE.Money?ViewManager.ins().open(BuyWin,this.data.index,2):this.data.shopType==FEATS_SHOP_TYPE.Item&&ViewManager.ins().open(BuyWin,this.data.index,3))},e.prototype.showTip=function(){var t,e=GlobalConfig.FeatsStore;for(var i in e)e[i].goods[0].id==this.goodsID&&(t=e[i].goods[0].id);void 0==t&&new Error("竟然没有找到该商品ID");var n=GlobalConfig.ItemConfig[t],s=this.data;ViewManager.ins().open(ItemDetailedWin,0,n.id,s.goods[0].count)},e}(BaseItemRender);__reflect(HonorMarketItemRenderer.prototype,"HonorMarketItemRenderer"),window.HonorMarketItemRenderer=HonorMarketItemRenderer;var GuideUtils=function(t){function e(){var e=t.call(this)||this;return e.step=0,e.part=0,e.wrongCount=0,e.maxWrongCount=2,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){if(!this.isInit){this.isInit=!0,0==Setting.currPart?(this.part=1,this.step=1):(this.part=Setting.currPart,this.step=Setting.currStep),this.cfg=[];var t;for(var e in GlobalConfig.GuideConfig){t=[];for(var i in GlobalConfig.GuideConfig[e])t.push(GlobalConfig.GuideConfig[e][i]);this.cfg.push(t)}if(this.part<=this.cfg.length){var n=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][n].overs}this.part<=this.cfg.length&&MessageCenter.addListener(TaskCT.ins().postUpdteTaskTrace,this.updateByTask,this)}},e.prototype.updateByTask=function(){this.guideOver(),this.update(1)},e.prototype.updateByClick=function(){this.update(2)},e.prototype.updateByAppear=function(){this.update(3)},e.prototype.canShow=function(){return urlParam.noGuide?!1:Assert(this.cfg,"新手引导未初始化就调用 canShow()")?!1:this.part>this.cfg.length?(MessageCenter.ins().removeAll(this),!1):this.view&&this.view.parent?!1:!0},e.prototype.checkShow=function(){if(!this.curCfg)return!1;try{var t=this.getDisplayObj(this.part,this.step);if(!t)return!1}catch(e){return!1}return!0},e.prototype.addTimeHandler=function(){Timer.has(this.timeHandler,this)||Timer.start(50,0,this.timeHandler,this)},e.prototype.removeTimeHandler=function(){Timer.stop(this.timeHandler,this)},e.prototype.timeHandler=function(){this.canShow()?this.checkShow()&&this.show(this.part,this.step):this.removeTimeHandler()},e.prototype.guideOver=function(){var t=TaskCT.ins().taskTrace;if(this.overs&&t&&0==t.state)for(var e=this.overs.length,i=0;e>i;i++){var n=this.overs[i];if(1==n.type&&n.value==t.id)return this.readyForNext(),void this.close()}},e.prototype.update=function(t){if(void 0===t&&(t=0),0!=this.canShow()&&(this.curCfg=this.cfg[this.part-1][this.step-1],this.curCfg&&this.curCfg.start))if(1==t){if(1==this.curCfg.start.type){var i=TaskCT.ins().taskTrace;i.id==this.curCfg.start.value&&0==i.state&&e.ins().show(this.part,this.step)}else if(3==this.curCfg.start.type){var i=TaskCT.ins().taskTrace;i.id==this.curCfg.start.value&&1==i.state&&e.ins().show(this.part,this.step)}}else if(2==t){if(2==this.curCfg.start.type){var i=TaskCT.ins().taskTrace;i.id==this.curCfg.start.value&&0==i.state&&e.ins().show(this.part,this.step)}}else 3==t&&4==this.curCfg.start.type&&e.ins().show(this.part,this.step)},e.prototype.show=function(t,e){var i=this;this.part=t,this.step=e;var n=this.cfg[this.part-1];if(n?this.curCfg=this.cfg[this.part-1][this.step-1]:this.curCfg=null,!this.curCfg)return this.readyForNext(),void this.close();if(!this.checkShow())return this.close(),void this.addTimeHandler();null==this.view&&(this.view=new GuideView),this.view.clickCD=!0,this.view.hasEventListener(egret.Event.CHANGE)||this.view.addEventListener(egret.Event.CHANGE,this.next,this),this.save();var s;try{s=this.getDisplayObj(t,e)}catch(o){return this.wrongCount>=this.maxWrongCount?void this.close():(this.wrongCount++,this.view.close(),console.log("新手引导:"+t+","+e+"出错,重新播放"),void Timer.start(300,1,function(){i.show(t,e-1)},this))}s?(console.log("播放新手引导:"+t+","+e),egret.callLater(function(){i.view.show(s),StageUtils.ins().getStage().addChild(i.view)},this)):(this.readyForNext(),this.close())},e.prototype.clickOut=function(){this.curCfg&&1==this.curCfg.type&&(this.readyForNext(),this.close())},e.prototype.readyForNext=function(){if(this.part++,this.step=1,this.part<=this.cfg.length){var t=this.cfg[this.part-1].length-1;this.overs=this.cfg[this.part-1][t].overs}else this.overs=null;this.curCfg=null},e.prototype.close=function(){this.view&&(DisplayUtils.removeFromParent(this.view),this.view.close(),this.view.removeEventListener(egret.Event.CHANGE,this.next,this),this.wrongCount=0),this.removeTimeHandler()},e.prototype.next=function(){var t=this;egret.callLater(function(){t.show(t.part,t.step+1)},this)},e.prototype.save=function(){1==this.step&&(Setting.ins().setValue(ClientSet.guidePart,this.part+1),Setting.ins().setValue(ClientSet.guideStep,1))},e.prototype.getDisplayObj=function(t,e){var i,n;if(this.cfg[t-1]&&e<=this.cfg[t-1].length){n=this.cfg[t-1][e-1];var s=egret.getDefinitionByName(n.view);s||console.warn(n.view);for(var o=ViewManager.ins().getView(s),a=n.target.split("."),r=0,l=a;r<l.length;r++){var h=l[r];o=~h.indexOf("(")?o[h]():o[h]}i=o}return i},e}(BaseClass);__reflect(GuideUtils.prototype,"GuideUtils"),System.GuideUtils=function(){return GuideUtils.ins()},window.GuideUtils=GuideUtils;var ItemBaseEff4=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showEquipEffect=function(){if(this.itemConfig||this.data.id==MoneyConst.yuanbao||this.data.id==MoneyConst.dartCarGuildScore){var t=ItemUtil.getType(this.itemConfig),e="ValueEff4";if(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.x=44,this.EquipEffect.y=36,this.addChildAt(this.EquipEffect,this.getChildIndex(this.redPoint)),t==ItemType.TYPE_26){var i=GlobalConfig.LeitingEquipConf[this.itemConfig.id];i&&(this.equipStar||(this.equipStar=new eui.Image,this.addChild(this.equipStar),this.equipStar.left=5,this.equipStar.top=0),this.equipStar.source="leit"+i.level+"x")}this.EquipEffect.playFile(RES_DIR_EFF+e,-1)}},e}(ItemBase);__reflect(ItemBaseEff4.prototype,"ItemBaseEff4"),window.ItemBaseEff4=ItemBaseEff4;var ItemBaseNoName=function(t){function e(){var e=t.call(this)||this;return e.isShowName(!1),e}return __extends(e,t),e}(ItemBase);__reflect(ItemBaseNoName.prototype,"ItemBaseNoName"),window.ItemBaseNoName=ItemBaseNoName;var ItemBaseNoTap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onClick=function(){},e}(ItemBase);__reflect(ItemBaseNoTap.prototype,"ItemBaseNoTap"),window.ItemBaseNoTap=ItemBaseNoTap;var ItemBaseNoTapNoDetail=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showDetail=function(){},e.prototype.onClick=function(){},e}(ItemBase);__reflect(ItemBaseNoTapNoDetail.prototype,"ItemBaseNoTapNoDetail"),window.ItemBaseNoTapNoDetail=ItemBaseNoTapNoDetail;var ItemBaseSelect=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{set:function(t){this.selectFrame.visible=t},enumerable:!0,configurable:!0}),e.prototype.showDetail=function(){this.selectFrame.visible&&t.prototype.showDetail.call(this)},e}(ItemBase);__reflect(ItemBaseSelect.prototype,"ItemBaseSelect"),window.ItemBaseSelect=ItemBaseSelect;var ItemBaseTimes=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemTimesSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.item.data=this.data,isNaN(this.data.tag)?this.tagImg.source=null:this.tagImg.source="tag_multi_"+this.data.tag)},e}(BaseItemRender);__reflect(ItemBaseTimes.prototype,"ItemBaseTimes"),window.ItemBaseTimes=ItemBaseTimes;var ItemBossBase=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data.tagIcon&&this.setTag(this.data.tagIcon)},e}(ItemBase);__reflect(ItemBossBase.prototype,"ItemBossBase"),window.ItemBossBase=ItemBossBase;var ItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemIconSkin",e}return __extends(e,t),e.prototype.setTag=function(t){t&&""!=t?(this.tag.visible=!0,this.tag.source=t):this.tag.visible=!1},e.prototype.setData=function(t){if(this.config=t,null!=t){this.setIconfix(t),this.imgIcon.source=t.icon+"_png",this.imgBg.source="quality"+ItemUtil.getQuality(t);var e=ItemUtil.getType(t),i=ItemUtil.getJob(t);this.imgJob.source=(0==e||4==e)&&i&&this.imgJob.visible?"job"+i+"Item":"",GlobalConfig.ClientGlobalConfig.effectItems.indexOf&&GlobalConfig.ClientGlobalConfig.effectItems.indexOf(t.id)>=0?(null==this.effect&&(this.effect=new MovieClip,this.effect.x=35,this.effect.y=35,this.addChildAt(this.effect,2),this.effect.addEventListener(egret.Event.ADDED_TO_STAGE,this.resumePlay,this)),this.effect.playFile(RES_DIR_EFF+"quality_0"+ItemUtil.getQuality(t))):null!=this.effect}else this.imgIcon.source="",this.imgBg.source="quality0",this.imgJob.source="",null!=this.effect},e.prototype.setIconfix=function(t){switch(t.id){case 200136:t.icon=200136}},e.prototype.resumePlay=function(t){this.effect.play(-1)},e.prototype.setActived=function(t){this.actived.visible=t},e.prototype.setImgBg1=function(t){this.imgBg1.visible=!0,this.imgBg.visible=!this.imgBg1.visible,t&&(this.imgBg1.source=t)},e.prototype.setImgBg2=function(t){this.imgBg.source=t?t:""},e.prototype.setJueban=function(t){this.jueban.visible=!0,this.jueban.source=t?t:""},e}(BaseItemRender);__reflect(ItemIcon.prototype,"ItemIcon"),window.ItemIcon=ItemIcon;var ItemShopItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="ItemShopItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId];this.goodsID=t.id;var i="";if(i=t.price>1e5?Math.floor(t.price/1e4)+"万":t.price+"",this.money.text=i,this.itemName.text=e.name,this.itemName.textColor=ItemUtil.getQualityColor(e),this.used.text="（"+t.use+"）",this.used.x=this.itemName.x+this.itemName.width,t.viplv&&Actor.vip<t.viplv)this.num.visible=!0,this.num.text=VipCT.getVipStr(t.viplv,!0)+"可购买";else if(t.vipLimit){var n=Shop.ins().shopData.getHadBuyCountItem(t.itemId),s=0;n&&(s=n.count);var o=t.vipLimit[Actor.vip];this.num.text="今日可购买"+(o-s)+"次",this.num.visible=!0}else this.num.visible=!1;this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e)},e.prototype.showTip=function(){var t,e=GlobalConfig.ItemStoreConfig;for(var i in e)e[i].id==this.goodsID&&(t=e[i].itemId);void 0==t&&new Error("竟然没有找到该商品ID");var n=GlobalConfig.ItemConfig[t];ViewManager.ins().open(ItemDetailedWin,0,n.id,1)},e}(BaseItemRender);__reflect(ItemShopItemRenderer.prototype,"ItemShopItemRenderer"),window.ItemShopItemRenderer=ItemShopItemRenderer;var ItemStage=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.addDisplay()},enumerable:!0,configurable:!0}),e.prototype.convert=function(t){for(var e=0;e<t.length;e++)t[e]=StringUtils.NumberToChinese(Number(t[e]));return t},e.prototype.addDisplay=function(){if(this.data){var t=StringUtils.getStrByRegExp(this.data),e=StringUtils.getStrByRegExp(this.data,/[\u4E00-\u9FA5]+/g),i="",n=[],s=[],o=this.data.indexOf(t[0]),a=this.data.indexOf(e[0]);o>=0&&a>=0?a>o?(n=this.convert(t),s=e):(n=e,s=this.convert(t)):n=-1==o?e:this.convert(t);for(var r=0;r<n.length;r++)i+=n[r],s[r]&&(i+=s[r]);this.lv0&&(this.lv0.text=i)}},e}(BaseView);__reflect(ItemStage.prototype,"ItemStage"),window.ItemStage=ItemStage;var JingMaiPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;
return e.attrVertical=-94,e.cursorLocation=[[132,131],[92,186],[165,177],[138,252],[84,231],[96,316],[152,339],[126,431]],e._curRole=0,e._sn_="JinMaiSkin",e.isclick=!1,e.canClick=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.cursor||(this.cursor=new MovieClip,this.cursor.visible=!1),this.setForgeData(!1))},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.curRole=this.curRole,this.danItemID=GlobalConfig.JingMaiCommonConfig.levelItemid},e.prototype.addDisplay=function(){this.addTouchEvent(this.boostBtn,this.updateDown,!0),this.addTouchEvent(this.bigUpLevelBtn,this.onTap),this.observe(JingMaiCT.ins().postUpdate,this.setForgeData),this.observe(BagCT.ins().postItemAdd,this.setForgeData),this.boostBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this),this.setForgeData(!1)},e.prototype.removeDisplay=function(){this.canClick=!0,this.removeTouchEvent(this.boostBtn,this.updateDown,!1),this.boostBtn&&this.boostBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){var t=this,e=GlobalConfig.JingMaiLevelConfig[this._data.level];!this.isclick&&this.canClick&&e&&(this._data.level%10==0&&this._data.level/10>this._data.stage&&0!=this._data.level?(this.isclick=!0,this.canClick=!1,this.showUpgradeEffect(),Timer.start(1e3,1,function(){JingMaiCT.ins().sendUpgrade(t.curRole),SoundUtil.play(SoundEnum.SKILL_UP),t.canClick=!0},this)):BagCT.ins().getBagGoodsCountById(0,e.itemId)>=e.count?(JingMaiCT.ins().sendBoost(this.curRole),SoundUtil.play(SoundEnum.SKILL_UP)):(this.isclick=!0,WarnCT.ins().setBuyGoodsWarn(e.itemId)))},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.bigUpLevelBtn:var i=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show("确定使用"+i+"提升当前经脉吗？\n说明：\n"+GlobalConfig.JingMaiCommonConfig.levelItemidStage+"阶及以下经脉使用可直升1阶\n其他等阶使用转换为"+GlobalConfig.JingMaiCommonConfig.levelItemChange+"个"+GlobalConfig.ItemConfig[GlobalConfig.JingMaiCommonConfig.itemid].name,function(){JingMaiCT.ins().sendBigUpLevel(e.curRole)},this)}},e.prototype.showUpgradeEffect=function(){for(var t=0;9>=t;t++)this["jinmai_"+t].setLights(4)},e.prototype.setForgeData=function(t){void 0===t&&(t=!0),this._data=SubRoles.ins().getSubRoleByIndex(this.curRole).jingMaiData;var e=GlobalConfig.JingMaiStageConfig[this._data.stage],i=GlobalConfig.JingMaiLevelConfig[this._data.level];this.jinmaiStage.setValue(e.level),this.jinMaiName.text=e.name,this.attr.text=AttributeData.getAttStr(AttributeData.AttrAddition(e.attr,i.attr),.75),this._totalPower=BagCT.getAttrPower(AttributeData.AttrAddition(e.attr,i.attr)),this.powerPanel.setPower(this._totalPower);var n=this._data.level/10-e.stage;if(e.stage<GlobalConfig.JingMaiCommonConfig.stageMax){var s=void 0,o=void 0,a=BagCT.ins().getBagGoodsCountById(0,i.itemId);if(this.redPoint0.visible=a>=i.count,this.img1.visible=!0,this._data.level>0&&this._data.level%10==0&&n?(s=GlobalConfig.JingMaiStageConfig[this._data.stage+1],o=i):(s=e,o=GlobalConfig.JingMaiLevelConfig[this._data.level+1]),0==this.nextAttr.visible&&(this.nextAttr.visible=!0,this.countLabel.x=2,this.countLabel.y=497),this.nextAttr.text=AttributeData.getAttStr(AttributeData.AttrAddition(s.attr,o.attr),0,1,"+",!1,!0),this.boostBtn.visible=!0,this.attr.verticalCenter=this.attrVertical+this.attr.height/2,this.next.visible=!0,this._data.level>0&&this._data.level%10==0&&n)this.boostBtn.label="升  阶",this.countLabel.text="经脉等级已满,可进阶",this.cursor.visible=!1;else{this.boostBtn.label="冲  脉";var r="";r=a>=i.count?"|C:0x35e62d&T:":"|C:0xf3311e&T:",this.countLabel.textFlow=TextFlowMaker.generateTextFlow("消耗经脉丹:"+r+a+"|/"+i.count)}this.cursor.x=this.cursorLocation[this._data.level%8][0],this.cursor.y=this.cursorLocation[this._data.level%8][1]}else this.nextAttr.visible=!1,this.boostBtn.visible=!1,this.next.visible=!1,this.img1.visible=!1,this.countLabel.x=this.nextAttr.x-60,this.countLabel.y=this.nextAttr.y,this.redPoint0.visible=!1,this.cursor.parent&&this.removeChild(this.cursor),this.countLabel.text="经脉已满阶",this.attr.verticalCenter=0;for(var l=0;9>l;l++)this["nadis"+l].source="jingmailine"+(1==n||l+1<this._data.level%10?"1":"2");for(var h,u=!0,l=0;9>=l;l++)h=this["jinmai_"+l],h.item.visible=1==n||l+1<=this._data.level%10,h.bgImg.visible=!h.item.visible,h.item.visible?h.setLights(2):(t&&u&&l-1>=0&&this["jinmai_"+(l-1)].setLights(3),h.setLights(u?1:0),u=!1);var p=BagCT.ins().getBagGoodsCountById(0,this.danItemID);this.bigUpLevelBtn.redPoint&&(this.bigUpLevelBtn.redPoint.visible=p>0),this.bigUpLevelBtn.txt&&(this.bigUpLevelBtn.txt.text=p)},e}(BaseView);__reflect(JingMaiPanel.prototype,"JingMaiPanel"),window.JingMaiPanel=JingMaiPanel,ViewManager.ins().reg(JingMaiPanel,LayerManager.UI_Main);var JimMaiItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="JinMaiItemSkin",e.guang.visible=!1,e}return __extends(e,t),e.prototype.setLights=function(t){var e=this;if(0==t&&this.mc)return this.mc.stop(),void(this.mc.visible=!1);if(null==this.mc&&(this.mc=new MovieClip,this.mc.x=this.mc.y=20,this.addChild(this.mc)),this.mc.visible=!0,this.mc.parent||this.addChild(this.mc),1==t)this.mc.playFile(RES_DIR_EFF+"pulse1",-1);else if(2==t)this.mc.playFile(RES_DIR_EFF+"pulse2",-1);else if(3==t){var i=egret.Tween.get(this);this.mc.playFile(RES_DIR_EFF+"pulse3",1,null,!1),i.wait(800).call(function(){e.mc.playFile(RES_DIR_EFF+"pulse2",-1)})}else 4==t&&this.mc.playFile(RES_DIR_EFF+"pulse3",1,function(){DisplayUtils.removeFromParent(e.mc),e.mc=null},!0)},e}(eui.Component);__reflect(JimMaiItem.prototype,"JimMaiItem"),window.JimMaiItem=JimMaiItem;var LadderStarListView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.skinName="LadderSratListSkin",this.level.anchorOffsetX=10,this.level.anchorOffsetY=14,this.level.x=100,this.level.y=141},e.prototype.setLvAndRank=function(t){if(this.skin){if(void 0==t)return this.dwImg.source="ladder_rank_0",void(this.level.source=null);this.dwImg.source="ladder_rank_"+t.level,t.level>=4||t.showDan<=0||t.showDan>5?this.level.source=null:this.level.source="laddergradnum_"+t.showDan}},e.prototype.updataStarInfo=function(t,e){if(void 0===e&&(e=!0),this.skin){if(t){this.len=Ladder.ins().getStatuByLevel(t.level);for(var i=1;5>=i;i++)this["star"+i].currentState=i>t.showStar?"black":"light"}else this.len=0;this.currentState=this.len+"",this.setLvAndRank(t)}},e.prototype.upStarStatu=function(t,e,i){var n=this;void 0===i&&(i=!1);var s=e,o=i?t:t-1,a=this;0>=o&&(o=1),void 0==this.mc&&(this.mc=new MovieClip);var r=this["star"+o];this.mc.x=r.x+22,this.mc.y=r.y+22,this.addChild(this.mc);var l=this.len;if(i?(--s,this.mc.playFile(RES_DIR_EFF+"MoreStare",1,function(){-1!=a.getChildIndex(a.mc)&&a.removeChild(a.mc),r.currentState="light",l==o&&(r.currentState="black"),s>0&&o<n.len&&n.upStarStatu(++o,s,i)})):(--s,--o,this.mc.playFile(RES_DIR_EFF+"StarMiss",1,function(){if(-1!=a.getChildIndex(a.mc)&&a.removeChild(a.mc),r.currentState="black",0==o){var t=ViewManager.ins().getView(LadderResultWin);t&&t.isShow()&&t.cheackIsChangeLevel(s),n.upSign=!1}}),s=0),i&&o==this.len){var h=ViewManager.ins().getView(LadderResultWin);h&&h.isShow()&&h.cheackIsChangeLevel(s),this.upSign=!0}},e.prototype.showLvUp=function(t){this.numLevel=t},e.prototype.showRankUp=function(t){this.numRank=t,this.rankMc=new MovieClip,this.rankMc.x=100,this.rankMc.y=99,this.rankMc.playFile(RES_DIR_EFF+"RankWar4",1,this.RankChangeCallback.bind(this)),this.addChild(this.rankMc)},e.prototype.showLvDown=function(t){this.numLevel=t,this.level.source="laddergradnum_"+this.numLevel},e.prototype.RankChangeCallback=function(){this.dwImg.source="ladder_rank_"+this.numRank;var t=egret.Tween.get(this.dwImg);this.dwImg.alpha=0,t.to({alpha:1},700)},e}(eui.Component);__reflect(LadderStarListView.prototype,"LadderStarListView"),window.LadderStarListView=LadderStarListView;var LadderStarView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e}(eui.Component);__reflect(LadderStarView.prototype,"LadderStarView"),window.LadderStarView=LadderStarView;var LevelImage=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._value=1,e}return __extends(e,t),e.prototype.getValue=function(){return this._value},e.prototype.setValue=function(t){0>=t&&(t=1),this._value=t,this.skin&&this.update()},e.prototype.addDisplay=function(){this.update()},e.prototype.update=function(){var t=this._value,e=t+"";10>=t?(this.currentState="1",this.num1.source="jieji0"+e+"_png"):20>=t||t%10==0?(this.currentState="2","1"==e.charAt(0)?(this.num21.source="jieji010_png",this.num22.source="jieji0"+e.charAt(1)+"_png"):(this.num21.source="jieji0"+e.charAt(0)+"_png",this.num22.source="jieji010_png")):100>t&&(this.currentState="3",this.num31.source="jieji0"+e.charAt(0)+"_png",this.num32.source="jieji010_png",this.num33.source="jieji0"+e.charAt(1)+"_png")},e}(BaseView);__reflect(LevelImage.prototype,"LevelImage"),window.LevelImage=LevelImage;var MijiItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.addImg.visible=!1,this.itemLock.visible=!1,this.unlearn.visible=!1,null==this.data)this.lock.visible=!0,this.icon.source="",this.setUnlearn(!1);else if(this.data instanceof ItemData)this.lock.visible=!1,this.icon.source=this.data.itemConfig.icon+"_png",this.count.text=this.data.count+"",this.icon.visible=!0;else if(!isNaN(this.data.id)||!isNaN(this.data)){var t=!isNaN(this.data.id);this.lock.visible=!1,this.count.text="";var e=void 0;if(t?(this.itemLock.visible=this.data.isLocked,e=this.data.id):e=this.data,GlobalConfig.MiJiSkillConfig[e]){var i=GlobalConfig.MiJiSkillConfig[e].item,n=GlobalConfig.ItemConfig[i];n&&(this.icon.source=n.icon+"_png"),this.icon.visible=!0}else this.icon.source=""}this.select.visible=!1},e.prototype.setCountLabel=function(t){this.count.textFlow=(new egret.HtmlTextParser).parser("<font color = '#9f946d'>"+(t+1)+"转开启</font>"),this.count.visible=!0},e.prototype.showSelect=function(){this.lock.visible=!1,this.icon.source="",this.addImg.visible=!1,this.select.visible=!0},e.prototype.setSelected=function(t){this.select.visible=t},e.prototype.setUnlearn=function(t){this.unlearn.visible=t},e.prototype.showAdd=function(){this.data=null,this.lock.visible=!1,this.icon.source="",this.addImg.visible=!0,this.redPoint.visible=MijiCT.ins().isMjiSum()},e}(BaseItemRender);__reflect(MijiItem.prototype,"MijiItem"),window.MijiItem=MijiItem;var MijiPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isTween=!1,e._curRole=0,e}return __extends(e,t),e.prototype.setCurRole=function(t){if(this.curRole!=t&&(this.curRole=t,this.isTween)){MijiCT.ins().sendMijiwancheng(this.roleID),this.isTween=!1;for(var e=0;8>e;e++)egret.Tween.removeTweens(this["imageSmall_"+(e+1)])}},e.prototype.setData=function(){for(var t=this,e=MijiCT.ins(),i=!0,n=0;8>n;n++){this["imageMax_"+(n+1)].visible=!1;var s=void 0;if(ErrorLog.Assert(e.miji,"MijiPanel   data.miji is null"))this.mijiBtns[n].data=null;else if(s=e.miji[this.curRole],ErrorLog.Assert(s,"MijiPanel   numList is null  roleId = "+this.curRole))this.mijiBtns[n].data=null;else{var o=s[n]?0!=s[n].id:!1;this["imageMax_"+(n+1)].visible=o,this.mijiBtns[n].data=s[n]?s[n]:null,s[n]||i&&(this.mijiBtns[n].setCountLabel(n),i=!1)}}this.learnLabel.visible=!1,this.learnImg.visible=!1,e.miji[this.curRole].forEach(function(e){e.id>0&&(t.learnLabel.visible=!0,t.learnImg.visible=!0)}),this.powerPanel.setPower(e.getPowerByRole(this.curRole))},e.prototype.updateEff=function(){this.select.addImg.visible?DisplayUtils.removeFromParent(this.mc):this.playEff()},e.prototype.playEff=function(){this.mc||(this.mc=new MovieClip),!this.mc.parent&&this.btnAct&&(this.btnAct.addChildAt(this.mc,1),this.mc.x=this.getBtn.x+this.getBtn.width/2,this.mc.y=this.getBtn.y+this.getBtn.height/2),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1)},e.prototype.playArrow=function(){this.arrow&&(this._arrow||(this._arrow=new GuideArrow2),this._arrow.parent||this.arrow.addChild(this._arrow),this._arrow.x=0,this._arrow.setTips("点击镶嵌秘籍"),this._arrow.setDirection(0))},e.prototype.stopArrow=function(){this._arrow&&this._arrow.removeTweens(),DisplayUtils.removeFromParent(this._arrow),this._arrow=null},e.prototype.setOpenDesc=function(){var t=GlobalConfig.MiJiGridConfig[MijiCT.ins().grid+1];t&&(this.curZsLv.visible=!1)},e.prototype.skinComplete=function(){this.change.textFlow=(new egret.HtmlTextParser).parser("<u>印记置换</u>"),this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7,this.select],this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1"),this.eff.x=278,this.eff.y=500,this.eff.scaleX=.7,this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.change,this.onTap),this.addTouchEvent(this.mijitujian,this.onTap),this.addTouchEvent(this.all,this.onTap),this.addTouchEvent(this.btnLock,this.onTap);for(var t in this.mijiBtns)this.addTouchEvent(this.mijiBtns[t],this.onTap);this.curRole=this.curRole},e.prototype.addDisplay=function(){this.observe(MijiCT.ins().postMijiData,this.updateRedPoint),this.observe(MijiCT.ins().postMijiUpDate,this.learnUpdate),this.observe(MijiCT.ins().postSelectedMiji,this.selectMijiItem),this.observe(MijiCT.ins().postMijiLockInfo,this.setData)},e.prototype.removeDisplay=function(){this.stopArrow()},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.setOpenDesc(),this.setData(),this.select.showAdd())},enumerable:!0,configurable:!0}),e.prototype.selectMijiItem=function(t){this.select.data=t[0],this.curName=t[1],this.updateEff()},e.prototype.onBagUseMiji=function(t){this.playEff(),this.playArrow()},e.prototype.learnUpdate=function(t){var e=this,i=t[0],n=t[1],s=t[2],o=t[3];if(1==o)this.learnUpdateEffect(i,!1,function(){e["imageMax_"+(i+1)].visible=!0;var t=ObjectPool.pop("MovieClip");t.scaleX=t.scaleY=1,t.rotation=0,t.x=t.y=36,t.playFile(RES_DIR_EFF+"faileff",1,function(){ObjectPool.push(t)}),e.mijiBtns[i].addChild(t),TipsCT.ins().showTips("秘籍镶嵌失败")});else{var a=function(){e["imageMax_"+(i+1)].visible=!0,Timer.start(500,1,function(){var t=ObjectPool.pop("MovieClip");t.scaleX=t.scaleY=1,t.rotation=0,t.x=t.y=36,t.playFile(RES_DIR_EFF+"UpEff7",1,function(){ObjectPool.push(t)}),e.mijiBtns[i].addChild(t),e.mijiBtns[i].showSelect(),e.setData();var n=s?",["+GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[s].item].name+"]被替换":"";TipsCT.ins().showTips("秘籍镶嵌完成"+n);var o=Setting.ins().getValue(ClientSet.mijiRedPoint);o||Setting.ins().setValue(ClientSet.mijiRedPoint,1)},e)};n-s==1?a():this.learnUpdateEffect(i,!0,a)}this.updateEff()},e.prototype.learnUpdateEffect=function(t,e,i){var n=this;this.isTween=!0;for(var s=24+t+1,o=function(t){var e=t,o=150*t,r=150;t>7&&16>t?(e=t-8,o=150*t):t>15&&24>t?(e=t-16,o=150*t+100*(t-15),r=250):t>23&&(e=t-24,o=150*t+200*(t-23)+650,r=350);var l=egret.Tween.get(a["imageSmall_"+(e+1)]);l.to({},o).call(function(){var o=egret.Tween.get(n["imageSmall_"+(e+1)]);n["imageSmall_"+(e+1)].visible=!0,t==s-1?o.to({visible:!0},150).call(function(){for(var t=0;8>t;t++)egret.Tween.removeTweens(n["imageSmall_"+(t+1)]),n.isTween=!1;MijiCT.ins().sendMijiwancheng(n.roleID),i()}):o.to({visible:!1},r)})},a=this,r=0;s>r;r++)o(r)},e.prototype.updateRedPoint=function(){this.setOpenDesc(),this.setData()},e.prototype.onTap=function(t){var e=this,i=MijiCT.ins();switch(t.target){case this.getBtn:if(DisplayUtils.removeFromParent(this.mc),this.stopArrow(),!this.select.data){var n=this.mijiBtns.indexOf(this.select);return 8==n?i.grid?void ViewManager.ins().open(MijiLearnWin,this.curRole):void TipsCT.ins().showTips("1转后开启"):void TipsCT.ins().showTips("请选择技能！")}if(MijiCT.ins().hasEquipHigtLvlMiji(this.curRole,this.select.data))return void TipsCT.ins().showTips("已有此类型的高级秘籍");var s=this.select.data+1,o=void 0;s=this.select.data-1,o=MijiCT.ins().hasSpecificSkillOfRole(this.curRole,s);var a="";GlobalConfig.MiJiSkillConfig[s]&&(a=GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[s].item].name),o?WarnWin.show("已镶嵌《"+a+"》,将直接替代《"+a+"》获得《"+this.curName+"》效果",function(){e.roleID=e.curRole,MijiCT.ins().sendMijiLearn(e.curRole,e.select.data),SoundUtil.play(SoundEnum.SKILL_UP),e.select.showAdd()},this):WarnWin.show("镶嵌后获得《"+this.curName+"》,有几率替换已镶嵌秘籍，是否镶嵌？"+(o?"\n<font color='#f3311e'>(已镶嵌《"+a+"》,同类技能仅高级生效)</font>":"\n<font color='#35e62d'>（低级秘籍不会替换高级秘籍）</font>"),function(){e.roleID=e.curRole,MijiCT.ins().sendMijiLearn(e.curRole,e.select.data),SoundUtil.play(SoundEnum.SKILL_UP),e.select.showAdd()},this);break;case this.change:ViewManager.ins().open(MijiZhWin);break;case this.mijitujian:ViewManager.ins().open(MiJiTujianWin);break;case this.all:ViewManager.ins().open(MijiLookWin);break;case this.btnLock:ViewManager.ins().open(MijiLockWin,this.curRole);break;default:var r=this.mijiBtns.indexOf(t.target.parent);if(8==r)return i.grid?void ViewManager.ins().open(MijiLearnWin,this.curRole):void TipsCT.ins().showTips("1转后开启");if(!this.mijiBtns[r]||this.mijiBtns[r].data&&!this.mijiBtns[r].data.id)return;if(!i.grid||r>=i.grid)return void TipsCT.ins().showTips("未开启");ViewManager.ins().open(MijiTipWin,this.mijiBtns[r].data)}},e}(BaseView);__reflect(MijiPanel.prototype,"MijiPanel"),window.MijiPanel=MijiPanel;var PersonalBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listmonthbossId=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.addChild(this.bossImage),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.listmonthboss.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu2,this),this.refreshList(),this.listmonthboss.itemRenderer=PersonalBossItem},e.prototype.addDisplay=function(){this.tempIndex=0,this.addTouchEvent(this.challengeBtn,this.onTap),this.observe(FbCT.ins().postUpDataInfo,this.refreshList),this.list.scrollV=0,this.list.selectedIndex=0;var t=0,e=BossCT.ins().getListData();void 0!=this.select&&(t=this.getIdFromBossId(this.select[0],e[0])),this.currData=this.list.dataProvider.getItemAt(t),this.setWin()},e.prototype.removeDisplay=function(){delete this.select},e.prototype.refreshList=function(){for(var t=BossCT.ins().getListData(),e=t[0],i=t[1],n=t[2],s=e.concat(i,n),o=[],a=s.length-1;a>=0;a--)if(1==s[a].monthcard||1==s[a].specialCard){var r=s[a].id;o.push(s[a]),FbCT.ins().sendFbLog(r),(FbCT.ckeckMonthCardBoss(r)||FbCT.ckeckSpecialCardBoss(r))&&(this.listmonthbossId=o.indexOf(s[a])),s.splice(a,1)}this.listmonthboss.dataProvider=new eui.ArrayCollection(o),this.list.dataProvider=new eui.ArrayCollection(s);var l=0;this.currData=this.list.dataProvider.getItemAt(l),this.setWin()},e.prototype.getIdFromBossId=function(t,e){for(var i=0;i<e.length;i++)if(e[i].bossId==t)return this.list.selectedIndex=i,i;return 0},e.prototype.onClickMenu=function(t){this.listmonthboss.selectedIndex=-1,this.currData=this.list.dataProvider.getItemAt(t.itemIndex),this.setWin()},e.prototype.onClickMenu2=function(t){this.list.selectedIndex=-1,this.currData=this.listmonthboss.dataProvider.getItemAt(t.itemIndex),this.setWin()},e.prototype.setWin=function(){this.config=this.currData;var t=GlobalConfig.MonstersConfig[this.config.bossId];this.eTips.visible=1==this.config.monthcard&&!FbCT.ins().fbFirstLogs[this.config.id];var e;e=this.config.levelLimit||this.config.zsLevel?this.config.zsLevel>0?this.config.zsLevel+"转":this.config.levelLimit+"级":t.level+"级",this.nameTxt.text=t.name+"("+e+")";var i="无";this.rewardList.dataProvider=new eui.ArrayCollection(this.config.showItem),""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),this.config.monthcard&&!Recharge.ins().monthDay?this.stateImage.source="":this.config.specialCard&&!Recharge.ins().franchise?this.stateImage.source="":this.config.zsLevel<=ZsCT.ins().lv&&this.config.levelLimit<=Actor.level?FbCT.ins().getFbDataById(this.currData.id).getCount()>0?this.stateImage.source="zdbosskejisha":this.stateImage.source="zdbossyijisha":this.stateImage.source="";var n,s=1e3*ZsCT.ins().lv+Actor.level,o=1e3*this.config.zsLevel+this.config.levelLimit;this.eDropTips.visible=!1,this.config.monthcard&&(n=!0,this.eDropTips.visible=!0),this.config.specialCard?(this.eDropTips.visible=!0,Recharge.ins().franchise?(this.canChallengeTxt.text="",n=!0):(this.canChallengeTxt.text="至尊特权可挑战",n=!1)):this.config.privilege?Recharge.ins().getIsForeve()?(this.canChallengeTxt.text="",n=!0):(this.canChallengeTxt.text="贵族特权可挑战",n=!1):(n=s>=o,this.canChallengeTxt.text=this.config.zsLevel>0?this.config.zsLevel+"转可挑战":this.config.levelLimit+"级可挑战"),this.challengeBtn.visible=n,this.canChallengeTxt.visible=!n,this.bossImage.playFile(RES_DIR_MONSTER+(t.avatar+"_3s"),-1),this.btnLabel()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(FbCT.ins().checkInFB())return;if(!KfArenaSys.ins().checkIsMatching())return;if(this.config.zsLevel<=ZsCT.ins().lv&&this.config.levelLimit<=Actor.level){if(FbCT.ins().getFbDataById(this.currData.id).getCount()<=0)return void TipsCT.ins().showTips("次数不足，无法挑战");if(this.config.monthcard&&Recharge.ins().monthDay<=0)return void ViewManager.ins().open(MonthbossNoticeWin,this.config);var e=FbCT.ins().fbModel[this.config.id].isPass;Recharge.ins().franchise&&e?(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):FbCT.ins().sendChallenge(this.config.id),ViewManager.ins().close(LimitTaskView)):(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):(!(ZsCT.ins().lv>=this.config.sweepLevel&&e),FbCT.ins().sendChallenge(this.currData.id)),ViewManager.ins().close(LimitTaskView))}else TipsCT.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|")}},e.prototype.btnLabel=function(){var t=FbCT.ins().fbModel[this.config.id].isPass;Recharge.ins().franchise&&t?this.challengeBtn.label="快速挑战":ZsCT.ins().lv>=this.config.sweepLevel&&t?this.challengeBtn.label="快速挑战":this.challengeBtn.label="挑战"},e}(BaseView);__reflect(PersonalBossPanel.prototype,"PersonalBossPanel"),window.PersonalBossPanel=PersonalBossPanel;var PersonRewardRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonRewardRendererSkin",e.itemList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=+this.data.integral+"",this.itemList.dataProvider=new eui.ArrayCollection(this.data.award)},e}(BaseItemRender);__reflect(PersonRewardRenderer.prototype,"PersonRewardRenderer"),window.PersonRewardRenderer=PersonRewardRenderer;var PowerPanel=function(t){function e(){var e=t.call(this)||this;return e.showBg=!0,e.power=0,e}return __extends(e,t),e.prototype.setPower=function(t){this.power=t,this.totalPower&&(this.totalPower.text=t+"")},e.prototype.setBgVis=function(t){this.skin&&(this.bgImg.visible=t,this.flameGroup.visible=t),this.showBg=t},e.prototype.setMcVisible=function(t){this.flameGroup&&(this.flameGroup.visible=t)},e.prototype.skinComplete=function(){this.setBgVis(this.showBg),this.flameMC?this.flameMC.play(-1):(this.flameMC=new MovieClip,this.flameMC.x=76,this.flameMC.y=44,this.flameMC.playFile(RES_DIR_EFF+"PowerFire",-1),this.flameGroup.addChild(this.flameMC)),this.totalPower.text=this.power+""},e}(BaseView);__reflect(PowerPanel.prototype,"PowerPanel"),window.PowerPanel=PowerPanel;var PriceIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="PriceIconSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.priceLabel.textColor=ColorUtil.NORMAL_COLOR},e.prototype.getPrice=function(){return this._price},e.prototype.setPrice=function(t,e){if(void 0===e&&(e=-1),t!=this._price||-1!=e)if(this._price=t,e>=0){var i="";i=e>=t?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.priceLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+e+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t+"</font> ")}else this.priceLabel.text=""+this._price},e.prototype.setText=function(t){this.priceLabel.textFlow=(new egret.HtmlTextParser).parser(t)},e.prototype.setData=function(t){var e="";if(t){var i=t;if(0==i.type)switch(i.id){case MoneyConst.exp:e="exp_png";break;case MoneyConst.gold:e="szjinbi";break;case MoneyConst.yuanbao:e="szyuanbao";break;case MoneyConst.fame:e="fame";break;case MoneyConst.soul:e="soul";break;case MoneyConst.wing:e="yumao_png";break;case MoneyConst.piece:e="500008_png"}else if(1==i.type)switch(i.id){case 200001:e="yumao_png";break;case 200002:e="forge";break;case 200003:e="gem";break;case 200004:e="spirit";break;case 200005:e="vigor";break;case 200006:e="shield"}this._type=i.id,this.setPrice(i.count)}else if(t){var n=t;switch(n.itemConfig.id){case 200001:e="yumao_png";break;case 200002:e="szyuanbao";break;case 200003:e="szyuanbao";break;case 200004:e="szyuanbao";break;case 200005:e="szyuanbao";break;case 200006:e="szyuanbao"}this._type=n.itemConfig.id,this.setPrice(n.count)}this.iconImg.source=e},e.prototype.getType=function(){return this._type},e.prototype.setType=function(t){if(this._type!=t){this._type=t;var e="";switch(this._type){case MoneyConst.exp:e="exp";break;case MoneyConst.gold:e="szjinbi";break;case MoneyConst.yuanbao:e="szyuanbao";break;case MoneyConst.fame:e="fame";break;case MoneyConst.soul:e="soul";break;case MoneyConst.wing:e="yumao_png"}this.iconImg.source=e}},e}(eui.Component);__reflect(PriceIcon.prototype,"PriceIcon"),window.PriceIcon=PriceIcon;var PropGainTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PropGainTipsSkin",this.itemIcon.imgJob.visible=!1,this.gainList.itemRenderer=GainGoodsNoSkinItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2];this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addTouchEndEvent(this,this.otherClose),this.setData(i,n,s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);if(i){var n=!0;if("Recharge2Win"==e[1]){var s=Recharge.ins().getRechargeData(0);s&&0!=s.num||(n=!1,ViewManager.ins().open(Recharge1Win))}n&&GameGuider.guidance(e[1],e[2],e[3]),ViewManager.ins().close(ShopGoodsWarn),ViewManager.ins().close(BookUpWin),ViewManager.ins().close(WeaponPanel),ViewManager.ins().close(WeaponSoulBreakWin),"HeirloomCom"!=e[1]&&ViewManager.ins().close(HeirloomCom),"LadderWin"==e[1]&&ViewManager.ins().close(ForgeWin),"PlayFunView"==e[1]&&ViewManager.ins().close(ShopWin)}}},e.prototype.setData=function(t,e,i){var n="";if(void 0==i){var s=BagCT.ins().getBagGoodsByTypeAndId(t,e);n=s?s.count+"":"0"}else n=i+"";var o=GlobalConfig.ItemConfig[e];if(this.nameLabel.text=o.name,this.nameLabel.textColor=ItemUtil.getQualityColor(o),this.itemIcon.setData(o),this.lv.text=(o.level||1)+"级",this.num.text=n,this.description0.textFlow=TextFlowMaker.generateTextFlow(o.desc),2==ItemUtil.getType(o)){var a=MiJiSkillConfig.getSkillIDByItem(o.id);this.power.text="评分："+GlobalConfig.MiJiSkillConfig[a].pow}else this.power.text="";var r=GlobalConfig.GainItemConfig[e];r?this.gainList.dataProvider=new eui.ArrayCollection(r.gainWay):this.gainList.dataProvider=new eui.ArrayCollection([])},e}(BaseEuiView);__reflect(PropGainTipsWin.prototype,"PropGainTipsWin"),window.PropGainTipsWin=PropGainTipsWin,ViewManager.ins().reg(PropGainTipsWin,LayerManager.UI_Popup);var PubBossRemindItem=function(t){function e(){var e=t.call(this)||this;return e._move=!1,e._lastX=0,e._lastY=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.checkBoxs.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin1,this)},e.prototype.onTouchBegin1=function(t){this._lastX=t.stageX,this._lastY=t.stageY,this._lastSelect=this.checkBoxs.selected,this._move=!1,this.$stage&&(this.$stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.onTouchMove1=function(t){MathUtils.getDistance(this._lastX,this._lastY,t.stageX,t.stageY)>20&&(this._move=!0)},e.prototype.onTouchEnd1=function(){this._move&&(this.checkBoxs.selected=this._lastSelect,this._move=!1),this.$stage&&(this.$stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove1,this),this.$stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd1,this))},e.prototype.dataChanged=function(){var t,e=this.data,i=GlobalConfig.WorldBossConfig[e.id],n=BossCT.isCanChallenge(i);t=i.samsaraLv>0?i.showName:i.zsLevel>0?i.zsLevel+"转":i.level+"级",this.checkBoxs.visible=n,n&&(this.checkBoxs.selected=BossCT.ins().getBossRemindByIndex(e.id)),this.txt.visible=!n,this.checkBoxs.name=e.id+"";var s=GlobalConfig.MonstersConfig[i.bossId];this.bossName.text=s.name,this.levelShow.text=t},e}(BaseItemRender);__reflect(PubBossRemindItem.prototype,"PubBossRemindItem"),window.PubBossRemindItem=PubBossRemindItem;var PunchEquipItem=function(t){function e(){var e=t.call(this)||this;return e.wearData=null,e.skinName="PunchEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var t=SkillCT.ins().equipListData[this.data];if(this.wearData=SkillCT.ins().getWearEquipsData(this.data),this.img.source="",this.addBtn.visible=!0,t&&t.itemConfig){var e=ItemUtil.getSubType(t.itemConfig);this.img.source=""+(t.itemConfig.zsLevel||0)+(t.itemConfig.level||1)+"_"+(e+1)+"_png",this.redPoint.visible=SkillCT.ins().checkIsHaveBestEquip(e)}else this.img.source="",this.redPoint.visible=SkillCT.ins().checkIsHaveBestEquip(this.data)},e.prototype.destruct=function(){this.img.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(){this.wearData&&0!=this.wearData.configID?ViewManager.ins().open(HejiEquipTipsWin,this.wearData,!0):ViewManager.ins().open(HejiEquipTipsWin,this.data,!0)},e}(BaseItemRender);__reflect(PunchEquipItem.prototype,"PunchEquipItem"),window.PunchEquipItem=PunchEquipItem;var PunchEquipItemBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.validateNow(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var t=this.data,e=this.wearData=new ItemData;e.configID=t.id,this.addBtn.visible=!1,this.redPoint.visible=!1,this.img.source="",e&&e.itemConfig?this.img.source=""+(e.itemConfig.zsLevel||0)+e.itemConfig.level+"_"+(ItemUtil.getSubType(e.itemConfig)+1)+"_png":this.img.source=""},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTap=function(){this.wearData&&0!=this.wearData.configID?ViewManager.ins().open(HejiEquipTipsWin,this.wearData,!0):ViewManager.ins().open(PunchEquipChooseWin,this.data,0)},e}(BaseItemRender);__reflect(PunchEquipItemBase.prototype,"PunchEquipItemBase"),window.PunchEquipItemBase=PunchEquipItemBase;
var PunchEquipPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchEquip",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SkillCT.ins().postHejiEquipChange,this.refushPanelInfo),this.refushPanelInfo()},e.prototype.refushPanelInfo=function(){for(var t=[],e=1;9>e;e++){this["item"+e].data=e-1;var i=SkillCT.ins().equipListData[e-1];t=0==t.length?i.att:AttributeData.AttrAddition(t,i.att)}this.powerPanel.setPower(998),this.attrsText.text=AttributeData.getAttStr(t)},e}(BaseEuiView);__reflect(PunchEquipPanel.prototype,"PunchEquipPanel"),window.PunchEquipPanel=PunchEquipPanel,ViewManager.ins().reg(PunchEquipPanel,LayerManager.UI_Main);var RankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(null!=this.data){for(var t in this.data){var e=this[t];e&&this.updateValue(e,t,this.data[t])}this.eFPVipIcon.setVip(PFVipCT.getCurPFVipInfo(this.data.PFVipInfo)),2==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_1",this.t1.source="paihang2",this.pos.visible=!1,this.t1.visible=!0):3==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_2",this.t1.source="paihang3",this.pos.visible=!1,this.t1.visible=!0):4==this.data[RankDataType.DATA_POS]?(this.t3.source="rankcolor_3",this.t1.source="",this.pos.visible=!0,this.t1.visible=!1):(this.t3.source="bantoutiaobg",this.pos.visible=!0,this.t1.visible=!1),this.t10&&(this.t10.visible=this.data.pos<=10),this.vip.visible=this.data.vip>0}this.visible=null!=this.data},e.prototype.updateValue=function(t,i,n){switch(i){case RankDataType.DATA_VIP:return;case RankDataType.DATA_MONTH:return void(t.visible=1==n);case RankDataType.DATA_LEVEL:n+="级";break;case RankDataType.DATA_COUNT:if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var s=GlobalConfig.KnighthoodConfig[n];n=s.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var s=GlobalConfig.TrainLevelConfig[n];n=s.trainlevel+"等"+s.trainName}else Rank.ins().curType==RankDataType.TYPE_XIAYI&&(n="魅力值:"+n);break;case RankDataType.DATA_WEIWANG:n=WeiWangCC.ins().getWeiWangCfg(n).res}t instanceof eui.Label?("number"==typeof n&&(n=CommonUtils.overLength(n)),t.text=i in e.dataFormat?e.dataFormat[i].replace("{value}",n):n):t instanceof eui.Image&&(t.source=i in e.dataFormat?e.dataFormat[i].replace("{value}",n):n)},e}(BaseItemRender);__reflect(RankItemRenderer.prototype,"RankItemRenderer"),window.RankItemRenderer=RankItemRenderer;var RedBagRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RedBagRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.num.text=this.data.robNum,this.nameLabel.text=this.data.robName},e}(BaseItemRender);__reflect(RedBagRenderer.prototype,"RedBagRenderer"),window.RedBagRenderer=RedBagRenderer;var RoleInfoItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleInfoItemSkin",e.iconMc=new MovieClip,e.iconMc.x=45,e.iconMc.y=40,e.iconMc.scaleX=e.iconMc.scaleY=.4,e}return __extends(e,t),e.prototype.setImgSource=function(t,e){var i=t?"tjiehs":"tjiemb";this.iconMc.playFile(RES_DIR_EFF+i,-1),this.iconMc&&!this.iconMc.parent&&this.addChild(this.iconMc);var n=e?[]:FilterUtil.ARRAY_GRAY_FILTER;this.iconMc.filters=n},e.prototype.setLv=function(t){this._lv!=t&&(this._lv=t,0==this._lv?this.lvTxt.text="":this.lvTxt.text="+"+this._lv)},e.prototype.setNameTxt=function(t){this._imgSource!=t&&(this.labelDisplay.text=t)},e.prototype.setBgValue=function(t){this.bgImg.source=t},e.prototype.setRedPointVisibel=function(t){this.redPoint.visible=t},e}(BaseView);__reflect(RoleInfoItem.prototype,"RoleInfoItem"),window.RoleInfoItem=RoleInfoItem;var RoleItem=function(t){function e(){var e=t.call(this)||this;return e._curRole=-1,e._index=-1,e.showTip=!0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.boostLv=new eui.Label,this.boostLv.x=35,this.boostLv.y=55,this.boostLv.textColor=16360197,this.zhulingLv=new eui.Label,this.zhulingLv.x=12,this.zhulingLv.y=55,this.zhulingLv.textColor=4046335,this.tupoLv=new eui.Label,this.tupoLv.x=20,this.tupoLv.y=5,this.tupoLv.textColor=15333897,this.boostLv.size=this.zhulingLv.size=this.tupoLv.size=16,this.boostLv.width=this.zhulingLv.width=this.tupoLv.width=41,this.boostLv.stroke=this.zhulingLv.stroke=this.tupoLv.stroke=1,this.boostLv.strokeColor=this.zhulingLv.strokeColor=this.tupoLv.strokeColor=0,this.boostLv.textAlign=this.tupoLv.textAlign="right",this.addChild(this.boostLv),this.addChild(this.zhulingLv),this.addChild(this.tupoLv),this.mc=new MovieClip,this.mc.x=46,this.mc.y=43},e.prototype.dataChanged=function(){this.playEff(),t.prototype.dataChanged.call(this);var e=this.data.itemConfig;if(this.bless.visible=!1,e){for(var i=this._wings?this._model.wingsData.equipdata:this._model.equipsData,n=void 0,s=0;s<i.length;s++)if(this.data.handle==i[s].item.handle){n=i[s];break}this._wings||(this.boostLv.text=n.strengthen>0?"+"+n.strengthen:"",this.zhulingLv.text=n.zhuling>0?n.zhuling+"":"",this.tupoLv.text=n.tupo>0?n.tupo+"星":"",this.bless.visible=n.bless>0,ItemUtil.getSubType(e)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]&&(this.nameTxt.text=BagCT.ins().getGuanyinLevel(e)))}this.getItemIcon().extreme.visible=!1,this._curRole>=0&&this._index>=EquipPos.WEAPON&&this._index<=EquipPos.SHOE&&(this.getItemIcon().extreme.visible||(this.getItemIcon().extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this._model,this._index)>0)),this._lastData=this.data,this._lastModel=this._model},e.prototype.clear=function(){t.prototype.clear.call(this),this.boostLv.text=this.zhulingLv.text=this.tupoLv.text="",this.playEff()},e.prototype.isShowTips=function(t){this.showTip=t},e.prototype.openEquipsTips=function(){this.showTip&&(this._index>EquipPos.DZI?ViewManager.ins().open(SamsaraEquipTips,this._curRole,this._lastModel,this._index):ViewManager.ins().open(EquipDetailedWin,1,this.data.handle,this.itemConfig.id,this.data,this._model,this._curRole,this._index,8==this._index))},e.prototype.showPower=function(){this.openEquipsTips()},e.prototype.setModel=function(t){this._model=t},e.prototype.getModel=function(){return this._model},e.prototype.setCurRole=function(t){this._curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setIndex=function(t){this._index=t},e.prototype.playEff=function(){this._lastData&&this._lastData!=this.data&&this._model==this._lastModel&&(this.mc.playFile(RES_DIR_EFF+"UpEff1",1),this.addChild(this.mc))},e}(ItemBase);__reflect(RoleItem.prototype,"RoleItem"),window.RoleItem=RoleItem;var RoleItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="RoleShowSkin",e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showRole,e),e.suitEff=new MovieClip,e.suitEff.x=e.suitImg.x,e.suitEff.y=e.suitImg.y,e.suitEff2=new MovieClip,e.suitEff5=new MovieClip,e.suitEff7=new MovieClip,e.suitEff9=new MovieClip,e._weaponEff0=new MovieClip,e._weaponEff0.visible=!1,e.weaponEff.addChild(e._weaponEff0),e._bodyEff0=new MovieClip,e._bodyEff0.visible=!1,e.bodyEff.addChild(e._bodyEff0),e.wingMc=new MovieClip,e.wingMc.visible=!1,e.eWingMCGroup.addChild(e.wingMc),e}return __extends(e,t),e.prototype.dataChanged=function(){if(!(this.data&&this.data.otherPlayerData&&this.data.otherPlayerData instanceof OtherPlayerData))return this.bodyImg.source="body00_png",this.weaponImg.source="",this.wingImg.source="",this.suitEff&&DisplayUtils.removeFromParent(this.suitEff),this.suitEff2&&DisplayUtils.removeFromParent(this.suitEff2),this.suitEff5&&DisplayUtils.removeFromParent(this.suitEff5),void(this.suitEff7&&DisplayUtils.removeFromParent(this.suitEff7));var t=this.data.otherPlayerData,e=t.roleData[this.index];e&&(this.setWing(e.index,this.wingImg),this.setRole(e.index,this.bodyImg,this.weaponImg),this.setRoleEff(e.index))},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var n,s=this.data.otherPlayerData.roleData[t],o=s.getEquipByIndex(0).item.configID,a=s.getZhuangBanNG(),r=a[0],l=a[1],h=s.getEquipByIndex(0),u=h.item.configID,p=s.getEquipByIndex(2),c=p.item.configID,d=GlobalConfig.ClientGlobalConfig.useManRes?0:s.sex;if(u>0){var g=GlobalConfig.EquipConfig[u].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),i.source=GlobalConfig.EquipWithEffConfig[o+"_"+s.sex]?null:g+"_"+d+"_c_png"}if(c>0){var g=GlobalConfig.EquipConfig[c].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),e.source=g+"_"+s.sex+"_c_png",n=!0}if(n||(e.source="body000_"+s.sex+"_c_png"),l>0){var f=this.getZhuangbanById(l);f.useMc>0?(i.visible=!1,this._weaponEff0.visible=!0,this._weaponEff0.playFile(RES_DIR_DRESS+f.res+"_"+d+"_c_m",-1)):(i.visible=!0,this._weaponEff0.visible=!1,i.source=f.res+"_"+d+"_c_png")}if(r>0){var f=this.getZhuangbanById(r);f.useMc>0?(e.visible=!1,this._bodyEff0.visible=!0,this._bodyEff0.playFile(RES_DIR_DRESS+f.res+"_"+s.sex+"_c_m",-1)):(e.visible=!0,this._bodyEff0.visible=!1,e.source=this.getZhuangbanById(r).res+"_"+s.sex+"_c_png")}},e.prototype.setWing=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.wingImg),e.source=null;var i=this.data.otherPlayerData.roleData[t],n=i.wingsData,s=i.getZhuangBanNG()[2];if(e.visible=!0,this.wingMc.visible=!1,s>0){var o=this.getZhuangbanById(s);o.useMc?this.wingMc.playFile(RES_DIR_DRESS+o.res+"_c_m",-1):e.source=o.res+"_png",this.wingMc.visible=o.useMc>0,e.visible=!this.wingMc.visible}else n.openStatus?e.source=GlobalConfig.WingLevelConfig[n.lv].appearance+"_png":e.source=""},e.prototype.setRoleEff=function(t){this.setSuit(t,this.suitImg,this.suitEff),this.setWeaponsSuit(t,"sef",this.soulEff,this.suitEff2),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.showRole=function(t){if(this.data&&this.data.otherPlayerData){ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);var e=ViewManager.ins().open(RRoleWin,this.data.otherPlayerData);e.hideEx(2)}},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var n=this.data.otherPlayerData.roleData[t],s=n.heirloom.getSuitConfig(n);if(s&&!n.hideNeff()){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[s.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.setWeaponsSuit=function(t,e,i,n){var s=this.data.otherPlayerData.roleData[t];n.x=this[e+s.job].x,n.y=this[e+s.job].y,n.rotation=this[e+s.job].rotation,DisplayUtils.removeFromParent(n);var o=s.weapons.weaponsId,a=s.hideWeapons();if(!a&&o){n.parent||i.addChild(n);var r=GlobalConfig.WeaponSoulConfig[o];n.playFile(RES_DIR_EFF+r.inside[s.job-1],-1)}},e.prototype.setWeaponEffect=function(t,e,i,n,s){void 0===s&&(s=0);var o=this.data.otherPlayerData.roleData[t],a=o.getEquipByIndex(s).item.configID,r=GlobalConfig.EquipWithEffConfig[a+"_"+o.sex];DisplayUtils.removeFromParent(n);var l=o.getZhuangBanNG(),h=n;h==this.suitEff5&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):h=this.suitEff9),r&&(0==s&&l[1]<=0||2==s&&l[0]<=0)?(h.x=this[e+o.sex].x+r.offX,h.y=this[e+o.sex].y+r.offY,h.rotation=this[e+o.sex].rotation,h.scaleX=h.scaleY=r.scaling,h.playFile(RES_DIR_EFF+r.inShowEff,-1),i.addChild(h)):DisplayUtils.removeFromParent(h)},e}(BaseItemRender);__reflect(RoleItemRenderer.prototype,"RoleItemRenderer"),window.RoleItemRenderer=RoleItemRenderer;var RoleSelectPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roles=[],e.roleRP=[],e.roleMovie=[],e._curRole=0,e.lastX=0,e.isTouchBegin=!1,e.rolesLength=1,e.hgv=!0,e.noMoveChange=!1,e._sn_="RoleSelectPanelSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.destructor(),this.roles=[this.role0,this.role1,this.role2];for(var t=0;t<this.roles.length;t++)if(this.roles[t].redPoint.visible=this.roleRP[t],t){var e=new MovieClip;e.x=44,e.y=44,e.touchEnabled=!1,this.roleMovie.push(e),this.roles[t].addChild(e)}this.setCurRole(this._curRole),this.updateRole(),this.initData(),this.headGroup.visible=this.hgv,this.addTouchEvent(this.recharge,this.onBtnClick),this.addTouchEvent(this.recharge0,this.onBtnClick),this.addTouchEvent(this,this.onClick),LocationProperty.isIosTS&&(this.recharge.icon="shf_jinbi_png",this.recharge0.icon="shf_yuanbao_png"),LocationProperty.isTSServer&&(this.recharge.icon="shf_jinbi_png",this.recharge0.icon="shf_yuanbao_png"),this.observe(GameLogic.ins().postSubRoleChange,this.updateRole),this.observe(Actor.ins().postLevelChange,this.updateRole),this.observe(VipCT.ins().postUpdateVipData,this.updateRole),this.observe(ZsCT.ins().postZsData,this.updateRole),this.observe(Actor.ins().postGoldChange,this.initData),this.observe(Actor.ins().postYbChange,this.initData),this.parent.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.parent.addEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)},e.prototype.removeDisplay=function(){this.destructor()},e.prototype.skinComplete=function(){},e.prototype.hideTop=function(){this.leftImg.visible=!1,this.rightImg.visible=!1},e.prototype.initData=function(){CommonUtils.labelIsOverLenght(this.goldTxt,Actor.gold),CommonUtils.labelIsOverLenght(this.ybTxt,Actor.yb)},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setCurRole=function(t){this._curRole=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this._curRole)},e.prototype.onBtnClick=function(t){switch(t.currentTarget){case this.recharge0:var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win);break;case this.recharge:Shop.openBuyGoldWin()}},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);e>-1&&this.changeRole(e)},e.prototype.onMove=function(t){if(this.headGroup.visible&&this.parent&&this.parent.touchEnabled&&!this.noMoveChange&&!this.isPass())switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.lastX=t.stageX,this.isTouchBegin=!0;break;case egret.TouchEvent.TOUCH_END:if(!this.isTouchBegin)break;this.isTouchBegin=!1;var e=this._curRole;this.lastX-t.stageX>=100?(e++,e>this.rolesLength&&(e=0),this.changeRole(e)):this.lastX-t.stageX<=-100&&(e--,0>e&&(e=this.rolesLength),this.changeRole(e))}},e.prototype.isPass=function(){var t=ViewManager.ins().getView(ForgeWin);if(t&&t.isNotMove)return!0;var e=ViewManager.ins().getView(AdvanEquipWin);return e?!0:void 0},e.prototype.changeRole=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);e?this.setCurRole(t):(ViewManager.ins().open(NewRoleWin),Assert(this.roles[t],"RoleSelectPanel changeRole value:"+t)||(this.roles[t].selected=!1))},e.prototype.updateRole=function(){var t,e,i=this.roles.length;this.rolesLength=SubRoles.ins().subRolesLen-1;for(var n=0;i>n;n++){if(t=this.roles[n],e=SubRoles.ins().getSubRoleByIndex(n))t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.stageImg.visible=!1,t.stageImg.source="",t.icon="yuanhead"+e.job+e.sex,this.roleMovie[n-1]&&DisplayUtils.removeFromParent(this.roleMovie[n-1]);else{var s=GlobalConfig.NewRoleConfig[n];if(!s){var o=egret.getQualifiedClassName(this.parent);Assert(!1,"角色索引"+n+"不存在，出错类："+o);continue}t.jobImg.visible=!1,t.stageImg.visible=!0,s.zsLevel?ZsCT.ins().lv<s.zsLevel?t.stageImg.source="toujiesuo"+s.zsLevel:t.stageImg.source="toujiesuo":Actor.level<s.level?t.stageImg.source="toujiesuo"+s.level:t.stageImg.source="toujiesuo",s.vip&&Actor.vip>=s.vip&&(t.stageImg.source="toujiesuo"),t.icon=""}this.roleMovie[n-1]&&"toujiesuo"==t.stageImg.source&&t.stageImg.visible&&(this.roleMovie[n-1].playFile(RES_DIR_EFF+"OpenRole2",-1),this.showRedPoint(n,!0))}},e.prototype.showRedPoint=function(t,e){this.roleRP[t]=e,this.roles[t]&&(this.roles[t].redPoint.visible=e)},e.prototype.clearRedPoint=function(){for(var t=0;t<this.roles.length;t++)this.showRedPoint(t,!1)},e.prototype.openRole=function(){this.hgv=!0,this.headGroup&&(this.headGroup.visible=!0)},e.prototype.hideRole=function(){this.hgv=!1,this.headGroup&&(this.headGroup.visible=!1)},e.prototype.destructor=function(){this.parent&&(this.parent.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.parent.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this))},e.prototype.getRoleRedPoint=function(t){return this.roles[t]?this.roles[t].redPoint.visible:!1},e}(BaseView);__reflect(RoleSelectPanel.prototype,"RoleSelectPanel"),window.RoleSelectPanel=RoleSelectPanel;var SkillPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curRole=0,e.curIndex=0,e.specialIsOpen={6:!1,7:!1,8:!1},e.isAllUpGrade=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&this.updateAllSkillItemAndDesc()},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.curRole=this.curRole},e.prototype.addDisplay=function(){this.addTouchEvent(this.allUp,this.onAllUpgrade),this.addTouchEvent(this.tupo,this.popTupo),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.popDetail,this);for(var t=0;8>t;t++){var e=this["skillItem"+(t+1)];this.addTouchEvent(e,this.onSelect)}this.observe(SkillCT.ins().postSkillUpgradeAll,this.grewupAllSkillCB)},e.prototype.onSelect=function(t){switch(t.currentTarget){case this.skillItem1:this.curIndex=0;break;case this.skillItem2:this.curIndex=1;break;case this.skillItem3:this.curIndex=2;break;case this.skillItem4:this.curIndex=3;break;case this.skillItem5:this.curIndex=4;break;case this.skillItem6:this.curIndex=5;break;case this.skillItem7:this.curIndex=6;break;case this.skillItem8:this.curIndex=7}this.updateAllSkillItemAndDesc()},e.prototype.onSingleUpgrade=function(t){this.onSendUpgrade(this.curIndex),SoundUtil.play(SoundEnum.SKILL_UP),this.updateAllSkillItemAndDesc()},e.prototype.onAllUpgrade=function(t){this.onSendUpgrade(0,!0),SoundUtil.play(SoundEnum.SKILL_UP),this.updateAllSkillItemAndDesc()},e.prototype.onSendUpgrade=function(t,e){void 0===e&&(e=!1),SkillCT.ins().sendGrewUpAllSkill(this.curRole,e,t)},e.prototype.updateAllSkillItemAndDesc=function(){DisplayUtils.removeFromParent(this.mc),this.mc=null,this.tupo.red.visible=SkillCT.ins().checkTupoRed(this.curRole)||SkillCT.ins().checkHechengRed(),this.updateAllSkillItem(),this.setSkillItem()},e.prototype.setSpecialSkill=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=GlobalConfig.SkillimbaIcon[t.job],i=e[1],n=e[2],s=e[3],o=i?GodWeaponCC.ins().checkSkillOpen(t.job,Math.floor(i.active[2])):!1,a=n?GodWeaponCC.ins().checkSkillOpen(t.job,Math.floor(n.active[2])):!1,r=s?GodWeaponCC.ins().checkSkillOpen(t.job,Math.floor(s.active[2])):!1;this.specialIsOpen[6]=o,this.specialIsOpen[7]=a,this.specialIsOpen[8]=r,this.setSpecialItem(i,this.skillItem6,o,5),this.setSpecialItem(n,this.skillItem7,a,6),this.setSpecialItem(s,this.skillItem8,r,7)},e.prototype.setSpecialItem=function(t,e,i,n){e.lv.visible=!1,t?(e.big.visible=!0,i?(e.lock.textColor=64865,e.lock.text="开启",e.lock.visible=!1,e.rect.visible=!1):(e.lock.textColor=16580618,e.lock.text="未开启",e.lock.visible=!0,e.rect.visible=!0),e.skillName.y=90,n==this.curIndex?(e.select.visible=!0,i?this.warn.visible=!1:(this.warn.visible=!0,this.warn.text=t.gain),this.icon.source=t.icon+"_png",this.skillName.text=t.name+"",this.skillName.y+=30,this.baseInfo.textFlow=TextFlowMaker.generateTextFlow1(t.desc+""),this.tupoLv.visible=!1,this.tupoProp.visible=!1):e.select.visible=!1,e.icon.source=t.icon+"_png",e.skillName.text=t.name+""):(e.skillName.text="",e.lock.textColor=16580618,e.lock.text="未开启",e.lock.visible=!0,e.rect.visible=!0),e.red.visible=!1},e.prototype.setList=function(t){var e=GlobalConfig.SkillimbaIcon[Math.floor(t.id/1e3)],i=[];for(var n in e){var s=e[n];i.push(s)}this.tupoData=new eui.ArrayCollection(i),this.list.itemRenderer=SkillGodwapenItem,this.list.dataProvider=this.tupoData},e.prototype.updateAllSkillItem=function(){this.setAllCost(),this.isUpGrade=!1,this.setSpecialSkill(),this.isAllUpGrade=!1;for(var t=0;5>t;t++){var e=this["skillItem"+(t+1)],i=SubRoles.ins().getSubRoleByIndex(this.curRole);if(!i)return;5==this.curIndex||6==this.curIndex||7==this.curIndex?(this.list.visible=!1,this.tupo.visible=!1,this.allUp.visible=!1,this.coinIcon0.visible=!1,this.costAll0.visible=!1):(this.list.visible=!0,ZsCT.ins().lv<1?this.tupo.visible=!1:this.tupo.visible=!0,this.allUp.visible=!0,this.coinIcon0.visible=!0,this.costAll0.visible=!0);var n=i.skillsData[t];if(e.big.visible=!1,n.lv<=0?(SkillCT.ins().getSkillLimitLevel()>=GlobalConfig.SkillsOpenConfig[t+1].level?(e.lock.textColor=64865,e.lock.text="开启",e.rect.visible=!1):(e.lock.textColor=16580618,e.lock.text=GlobalConfig.SkillsOpenConfig[t+1].level+"级开启",e.rect.visible=!0,t==this.curIndex&&(this.tupo.visible=!1,this.setList(n),this.warn.visible=!1)),e.lock.visible=!0,e.lv.text=""):(e.lock.visible=!1,e.lv.text="Lv."+n.lv,e.rect.visible=!1,t==this.curIndex&&(this.tupo.visible=!0,this.setList(n),this.warn.visible=!1)),this.redPoint(e,t,n.lv),e.icon.source=n.icon,e.skillName.text=n.name+"",t==this.curIndex)if(this.icon.source=n.icon,this.skillName.text=n.name+"",this.baseInfo.textFlow=TextFlowMaker.generateTextFlow1(n.desc+""),n.tupoLevel){this.tupoLv.visible=!0,this.tupoProp.visible=!0,this.tupoLv.textFlow=TextFlowMaker.generateTextFlow1("突破"+TextFlowMaker.getCStr(n.tupoLevel)+"阶");var s=GlobalConfig.SkillBreakConfig[Math.floor(n.id/1e3)][n.tupoLevel];this.tupoProp.textFlow=TextFlowMaker.generateTextFlow1(s.desc)}else this.tupoLv.visible=!1,this.tupoProp.visible=!1}this.allUp.enabled=this.isAllUpGrade,this.isAllUpGrade?this.mc1||(this.mc1=new MovieClip,this.mc1.x=this.allUp.width/2,this.mc1.y=this.allUp.height/2,this.allUp.addChild(this.mc1),this.mc1.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):(DisplayUtils.removeFromParent(this.mc1),this.mc1=null)},e.prototype.redPoint=function(t,e,i){i||(i=1);var n=GlobalConfig.SkillsUpgradeConfig[i].cost,s=GlobalConfig.SkillsOpenConfig[e+1].level,o=Actor.gold;o>=n&&i<SkillCT.ins().getSkillLimitLevel()&&Actor.level>=s?(t.red.visible=!0,this.isAllUpGrade=!0):t.red.visible=!1},e.prototype.setAllCost=function(){var t=SkillCT.ins().grewupAllSkillsCost(this.curRole);this.costAll0.textColor=Actor.gold>=t?3532333:16580618,this.costAll0.text=t+""},e.prototype.setSkillItem=function(){for(var t=0;5>t;t++){var e=this["skillItem"+(t+1)];e.select.visible=t==this.curIndex}},e.prototype.setRoleId=function(t){this.curRole=t,this.updateAllSkillItemAndDesc()},e.prototype.grewupAllSkillCB=function(t){var e=t[0];if(t[1]==this.curRole){for(var i=SubRoles.ins().getSubRoleByIndex(this.curRole),n=0;n<e.length;n++)e[n].lv&&e[n].lv<i.skillsData[n].lv&&this.grewupTip(e[n],i.skillsData[n],n);this.updateAllSkillItemAndDesc(),DisplayUtils.removeFromParent(this.mc),this.mc=null}},e.prototype.grewupTip=function(t,e,i){var n,s="",o=Math.floor(e.id/1e3),a=Math.floor(o%10);if(e.args)t.args?(n=e.args.b-t.args.b,s=e.name+"增加"+n+"点伤害"):Assert(!1,"SkillPanel.grewupTip() skillold.args is null!!新技能：id("+e.id+"),lv("+e.lv+") 旧技能：id("+t.id+"),lv("+t.lv+")");else if(t.tarEff&&e.tarEff){var r=GlobalConfig.EffectsConfig[t.tarEff[0]],l=GlobalConfig.EffectsConfig[e.tarEff[0]];switch(o){case SHORT_SKILLID.MAGIC:n=Math.ceil(1e3*(l.args.d-r.args.d))/10,s=e.name+"伤害减免增加"+n+"%";break;case SHORT_SKILLID.CURE:n=l.args.c-r.args.c,s=e.name+"增加"+n+"点治疗量";break;case SHORT_SKILLID.POISONING:n=l.args.c-r.args.c,s=e.name+"每秒失去"+n+"点生命";break;case SHORT_SKILLID.ARMOR:n=l.args.c-r.args.c,s=e.name+"增加"+n+"点物防和魔防";break;case SHORT_SKILLID.SUMMON:n=l.args.a-r.args.a,s="神兽等级增加"+n}n=l.args.d-r.args.d}else e.tarEff&&Assert(!1,"SkillPanel.grewupTip() skillold.tarEff is null!!新技能：id("+e.id+"),lv("+e.lv+") 旧技能：id("+t.id+"),lv("+t.lv+")");var h=new MovieClip;h.x+=66,h.y+=40,h.playFile(RES_DIR_EFF+"UpEff1",1),this["skillItem"+a].addChild(h)},e.prototype.popTupo=function(){var t=GlobalConfig.SkillBreakOpenConfig;return ZsCT.ins().lv<t.tupoLevel||GameServer.serverOpenDay<t.openDay?void TipsCT.ins().showTips("开服第"+t.openDay+"天并达到"+t.tupoLevel+"转开启"):void ViewManager.ins().open("SkillBreachPanel",this.curIndex,this.curRole)},e.prototype.popDetail=function(t){var e=this.list.selectedItem;ViewManager.ins().open("SkillTipsgodwapenView",e)},e}(BaseView);__reflect(SkillPanel.prototype,"SkillPanel"),window.SkillPanel=SkillPanel;var SmeltEquipNormalPanel=function(t){function e(){var e=t.call(this)||this;return e.viewIndex=0,e.labelStr="",e._sn_="SmeltMainSkin",e.name="普通装备",e}return __extends(e,t),e.prototype.skinComplete=function(){this.smeltEquips=[],this.smeltEquips.length=BagCT.SmeltMax,this.itemList.itemRenderer=SmeltEquipItem,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo,this.eff=new MovieClip,this.eff.x=78,this.eff.y=30,this.eff.scaleX=1,this.eff.scaleY=1,this.eff.touchEnabled=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.labelStr=this.smeltBtn.label,this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.smeltLable,this.onTap),this.addTouchEvent(this.backbtn,this.onTap),this.setItemData(),this.observe(EquipCT.ins().postSmeltEquipComplete,this.smeltComplete),this.observe(EquipCT.ins().postEquipCheckList,this.setItemList),this.observe(EquipCT.ins().postSmeltEquipComplete,this.smeltShowTips)},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.eff),Timer.stop(this.AutoSmeltEquip,this)},e.prototype.smeltShowTips=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=GlobalConfig.EquipConfig[i.itemId];if(n){var s=GlobalConfig.ItemConfig[n.id];if(s){var o=ItemUtil.getQualityColor(s),a="获得|C:"+o+"&T:"+s.name+" x "+i.count+"|",r=this.smeltBtn.localToGlobal();TipsCT.ins().showEverTips({str:a,x:r.x-25,y:r.y-45})}}}},e.prototype.smeltComplete=function(){for(var t=this.itemList.numChildren;t--;)this.itemList.getChildAt(t).playEff();this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=BagCT.ins().getOutEquips(),this.dataInfo.replaceAll(this.smeltEquips),this.smeltBtn.label!="取消"+this.labelStr.replace(/\s+/g,"")&&this.setBtnLabel()},e.prototype.setItemList=function(t){this.dataInfo.replaceAll(t),this.itemList.dataProvider=this.dataInfo},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:if(Recharge.ins().franchise)this.smeltBtn.label=="取消"+this.labelStr.replace(/\s+/g,"")?(this.setBtnLabel(),Timer.stop(this.AutoSmeltEquip,this)):Timer.has(this.AutoSmeltEquip,this)||(this.smeltBtn.label="取消"+this.labelStr.replace(/\s+/g,""),Timer.start(200,0,this.AutoSmeltEquip,this));else{DisplayUtils.removeFromParent(this.eff);var e=EquipCT.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);e&&SoundUtil.play(SoundEnum.SMELT)}break;case this.itemList:var i=t.target;if(i&&i.data){var n=this.smeltEquips.indexOf(i.data);n>=0&&(this.smeltEquips.splice(n,1),i.data=null)}break;case this.smeltLable:break;case this.backbtn:ViewManager.ins().close(SmeltEquipTotalWin)}},e.prototype.AutoSmeltEquip=function(){DisplayUtils.removeFromParent(this.eff);var t=EquipCT.ins().sendSmeltEquip(this.viewIndex,this.smeltEquips);t?SoundUtil.play(SoundEnum.SMELT):(this.setBtnLabel(),Timer.stop(this.AutoSmeltEquip,this))},e.prototype.setBtnLabel=function(){Recharge.ins().franchise?this.smeltBtn.label="一键"+this.labelStr.replace(/\s+/g,""):this.smeltBtn.label=this.labelStr},e}(BaseView);__reflect(SmeltEquipNormalPanel.prototype,"SmeltEquipNormalPanel"),window.SmeltEquipNormalPanel=SmeltEquipNormalPanel;var SmeltItemList=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof RewardData&&(this.itemConfig=GlobalConfig.ItemConfig[this.data.id],this.num=this.data.count,this.itemIcon.setData(this.itemConfig),this.setCount(this.num+""),this.nameTxt.text=this.itemConfig.name)},e}(ItemBase);__reflect(SmeltItemList.prototype,"SmeltItemList"),window.SmeltItemList=SmeltItemList;var SmeltItemNormalPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.itemDataList=[],this.selectList=[],this.smeltEquips=[],this.smeltEquips.length=9,this.itemList.itemRenderer=SmeltEquipItem,this.getItemList.itemRenderer=SmeltItemList,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo,this.getItemCollection=new eui.ArrayCollection,this.getItemList.dataProvider=this.getItemCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemDataList=t[0],this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.backbtn,this.onTap),this.setItemData(),this.observe(ForgeCT.ins().postMeltItem,this.smeltComplete)},e.prototype.smeltComplete=function(){for(var t=0;t<this.selectList.length;t++)for(var e=0;e<this.itemList.numElements;e++){var i=this.itemList.dataProvider.getItemAt(e);if(i.handle==this.selectList[t].handle){var n=this.itemList.getVirtualElementAt(e);this.itemList.removeChild(n),this.itemDataList[e]&&this.itemDataList.splice(e,1);break}}this.selectList=[],SoundUtil.play(SoundEnum.SMELT),this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=this.updateList(),this.dataInfo.replaceAll(this.smeltEquips),this.updateFJlist()},e.prototype.updateList=function(){for(var t=[],e=0;e<this.smeltEquips.length&&this.itemDataList[e];e++)t.push(this.itemDataList[e]);return t},e.prototype.updateFJlist=function(){var t=[];for(var e in this.selectList){var i=GlobalConfig.RongLuExpConfig[this.selectList[e].configID],n=!1;t:for(var s in t)for(var o in i.reward)if(t[s].id==i.reward[o].id){t[s].count+=i.reward[o].count*this.selectList[e].count,n=!0;break t}if(!n){var a=new RewardData;a.type=i.reward[e].type,a.id=i.reward[e].id,a.count=i.reward[e].count*this.selectList[e].count,t.push(a)}}this.getItemCollection.replaceAll(t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:if(this.selectList.length<=0)return void TipsCT.ins().showTips("未选中需要分解的道具");ForgeCT.ins().sendMeltItem(this.selectList);break;case this.itemList:var e=t.target;if(e&&e.data){var i=this.selectList.indexOf(e.data);-1==i?(e.selectFrame.visible=!0,this.selectList.push(e.data)):(e.selectFrame.visible=!1,this.selectList.splice(i,1))}this.updateFJlist();break;case this.backbtn:ViewManager.ins().close(SmeltItemTotalWin)}},e}(BaseView);__reflect(SmeltItemNormalPanel.prototype,"SmeltItemNormalPanel"),window.SmeltItemNormalPanel=SmeltItemNormalPanel;var SmeltItemTotalWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguRongluSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.equip.open(t[0]),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(SmeltItemTotalWin.prototype,"SmeltItemTotalWin"),window.SmeltItemTotalWin=SmeltItemTotalWin,ViewManager.ins().reg(SmeltItemTotalWin,LayerManager.UI_Popup);var WingAttrWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WingAttrSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.setRoleAttr(this.curRole),this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.closeBtn,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)
},e.prototype.setRoleAttr=function(t){this.wingsData=SubRoles.ins().getSubRoleByIndex(t).wingsData;var e=GlobalConfig.WingLevelConfig[this.wingsData.lv];this.attr.text=AttributeData.getAttStr(e.attr,1)},e}(BaseEuiView);__reflect(WingAttrWin.prototype,"WingAttrWin"),window.WingAttrWin=WingAttrWin,ViewManager.ins().reg(WingAttrWin,LayerManager.UI_Main);var WingPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curRole=0,e._lastLv=0,e._isAutoUp=!1,e.barbc=new ProgressBarEff,e.currViewNum=0,e.lastTimeDown=0,e.rapetNum=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.boostPrice1.setType(MoneyConst.wing),this.barbc.setWidth(525),this.barbc.x=10,this.barbc.y=-15,this.expGroup.addChild(this.barbc),this.mc=new MovieClip,this.mc.x=214,this.mc.y=245,this.wingImg.touchEnabled=!1,this.reliveEff=new MovieClip,this.reliveEff.x=100,this.reliveEff.y=36,this.reliveEff.scaleX=1.3,this.reliveEff.scaleY=1.1,this.skillIconArr=[];for(var t=0;5>t;t++)this.skillIconArr[t]=this["itemicon"+t];this.danItemID=GlobalConfig.WingCommonConfig.levelItemid,this.addTouchEvent(this.openStatusBtn,this.onTap),this.addTouchEvent(this.boostBtn1,this.onTap),this.addTouchEvent(this.checkBoxs,this.isShowUpGradeBtn),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.bigUpLevelBtn,this.onTap),this.addTouchEvent(this.boostBtn0,this.onTap),this.addTouchEvent(this.shenyu,this.onTap),this.addTouchEvent(this.feishengBtn,this.onTap),this.addTouchEvent(this.zizhiBtn,this.onTap),this.addTouchEvent(this.keyin,this.onTap);for(var t=0;5>t;t++)this.addTouchEvent(this.skillIconArr[t],this.skillItemClick);this.curRole=this.curRole},e.prototype.addDisplay=function(){this.observe(WingCT.ins().postBoost,this.showBoost),this.observe(WingCT.ins().postWingUpgrade,this.updateLevel),this.observe(WingCT.ins().postActivate,this.setWingData),this.observe(WingCT.ins().postWingEquip,this.setWingData),this.observe(WingCT.ins().postWingTime,this.setTimeDown),this.observe(BagCT.ins().postItemChange,this.isShowUpGradeBtn),this.observe(BagCT.ins().postItemAdd,this.isShowUpGradeBtn),this.observe(BagCT.ins().postItemDel,this.isShowUpGradeBtn),this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint),this.observe(WingCT.ins().postUseDanSuccess,this.setWingData),this.observe(GodWingRedPoint.ins().postKeYinRedPoint,this.setRedPoint3)},e.prototype.removeDisplay=function(){Timer.stopAll(this),this._isAutoUp&&this.stopAutoUp()},e.prototype.setRedPoint3=function(){this.redPoint3.visible=GodWingRedPoint.ins().keYinRoles[this._curRole]},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.barbc.reset(),this.setWingData(),this.updateLevel(),this.updateRedPoint(),this.setRedPoint3(),this.keyin.visible=this._wingsData.lv>=WingCT.WingMaxLv)},enumerable:!0,configurable:!0}),e.prototype.updateLevel=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole).wingSkillData,e=0,i=0;5>i;i++)if(t[i]&&t[i]>0)this.skillIconArr[i].data=t[i],this["openTxt"+i].text="",e=i+1;else{var n=WingCT.ins().getLevelBySkill(i);this["openTxt"+i].text=n+1+"阶开启";var s=GlobalConfig.WingLevelConfig[n];s&&s.pasSkillId&&(this.skillIconArr[i].data=s.pasSkillId,this.skillIconArr[i].blackImg.visible=!0)}if(5>e){var o=void 0,a=GlobalConfig.WingLevelConfig,r=0;for(var l in a){var s=a[l];if(s&&s.pasSkillId){if(o=s.pasSkillId,r==e)break;r++}}o&&(this.skillIconArr[e].data=o,this.skillIconArr[e].blackImg.visible=!0)}this._isAutoUp&&this.stopAutoUp(),this.setWingData()},e.prototype.updateDans=function(){this.redPoint1.visible=WingCT.ins().canUseFlyUpByRoleID(this.curRole),this.redPoint2.visible=WingCT.ins().canUseAptitudeByRoleID(this.curRole)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.openStatusBtn:Actor.level>=GlobalConfig.WingCommonConfig.openLevel?this.showOpenMovie():TipsCT.ins().showTips("|C:0xf3311e&T:等级不够，无法激活|");break;case this.boostBtn1:this._isAutoUp&&this.stopAutoUp(),this.autoUpStar();break;case this.rightBtn:this.currViewNum++,this.setSeeBtnStatu(),this.setWingView(this.currViewNum);break;case this.leftBtn:this.currViewNum--,this.setSeeBtnStatu(),this.setWingView(this.currViewNum);break;case this.boostBtn0:"停 止"==this.boostBtn0.label?this._isAutoUp&&this.stopAutoUp():(this._isAutoUp=!0,this.boostBtn0.label="停 止",Timer.start(150,0,this.autoUpStar,this));break;case this.bigUpLevelBtn:var i=GlobalConfig.ItemConfig[this.danItemID].name;WarnWin.show("确定使用"+i+"提升翅膀吗？\n说明：\n"+GlobalConfig.ItemConfig[this.danItemID].desc,function(){WingCT.ins().sendBigUpLevel(e.curRole)},this);break;case this.shenyu:ViewManager.ins().open(GodWingWin);break;case this.feishengBtn:ViewManager.ins().open(WingFeishengTipsWin,this.curRole);break;case this.zizhiBtn:ViewManager.ins().open(WingZizhiTipsWin,this.curRole);break;case this.keyin:ViewManager.ins().open(GodWingKeYinPanel,this.curRole)}},e.prototype.skillItemClick=function(t){var e=this.skillIconArr.indexOf(t.currentTarget);if(e>=0){if(!this.skillIconArr[e].skillIcon.visible)return;ViewManager.ins().open(WingSkillTipPanel,WingCT.ins().getWingSkillByIndex(e))}},e.prototype.stopAutoUp=function(){this._isAutoUp=!1,this.boostBtn0.label="一键升阶",Timer.stop(this.autoUpStar,this)},e.prototype.autoUpStar=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=BagCT.ins().getBagGoodsCountById(0,t.itemId);e>=t.itemNum?WingCT.ins().sendBoost(this.curRole,0):this.checkBoxs.selected?Actor.yb>=t.itemNum*t.itemPrice?WingCT.ins().sendBoost(this.curRole,1):this.stopAutoUp():(this.stopAutoUp(),TipsCT.ins().showTips("|C:0xf3311e&T:羽毛不足，可自动消耗元宝升级|"))},e.prototype.notOpenStatus=function(){this.expGroup.visible=!1,this.skillGroup.visible=!1,this.barbc.visible=!1,this.boostBtn0.visible=!1,this.boostBtn1.visible=!1,this.boostPrice1.visible=!1,this.powerPanel.visible=!1,this.openStatusBtn.visible=!0,this.rightBtn.visible=!1,this.leftBtn.visible=!1,this.jihuo.visible=!1,this.weijihuo.visible=!0,this.wing.visible=!0,this.dor1.x=2,this.dor2.x=558,this.shan.visible=!1;var t=GlobalConfig.WingCommonConfig.openLevel>Actor.level;this.jihuolv.visible=t,this.jihuolv.text=GlobalConfig.WingCommonConfig.openLevel+"级开启",this.bigUpLevelBtn.visible=this.redPoint.visible=!1,t||(this.reliveEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.weijihuoeff.addChild(this.reliveEff))},e.prototype.openStatusOpen=function(){this.skillGroup.visible=!0,this.openStatusBtn.visible=!1,this.barbc.visible=!0,this.boostBtn0.visible=!0,this.boostBtn1.visible=!0,this.powerPanel.visible=!0,this.rightBtn.visible=!0,this.leftBtn.visible=!0,this.jihuo.visible=!0,this.weijihuo.visible=!1,this._wingsData.lv>=WingCT.WingMaxLv?(this.arrows.visible=!1,this.nextAttrLabel.text="",this.attrLabel.horizontalCenter=0,this.expGroup.visible=!1,this.maxInfo.visible=!0,this.bigUpLevelBtn.visible=!1):(this.arrows.visible=!0,this.attrLabel.horizontalCenter=-100,this.expGroup.visible=!0,this.maxInfo.visible=!1,this.bigUpLevelBtn.visible=!0),this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==WingCT.WingExpRedPoint,this.shenyu.visible=GameServer.serverOpenDay+1>=GlobalConfig.WingCommonConfig.openDay},e.prototype.showBoost=function(t){var e=this,i=t[0],n=t[1],s=new eui.Label;s.size=20;var o="";s.textColor=3532333,o="翅膀经验 + ",s.x=225,s.y=326,s.text=o+n,this.addChild(s);var a=egret.Tween.get(s);if(a.to({y:s.y-45},500).call(function(){e.removeChild(s)},this),i&&(2==i||3==i||5==i)){var r=new eui.Image("xn_wingup"+i);r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.5;var l=egret.Tween.get(r);l.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(r)},this),this.actEff.addChild(r)}this.expBarChange(),this.updateAtt(),this.isShowUpGradeBtn()},e.prototype.setWingView=function(t){if(this.updateDans(),!(t>WingCT.WingMaxLv||0>t)){var e=GlobalConfig.WingLevelConfig[t];this.wingImg.source=e.appearance+"_png",this.nameTxt.text=e.name}},e.prototype.setWingData=function(){this._wingsData=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData,this.wingImg.source=this._wingsData.getImgSource(),this.currViewNum=this._wingsData.lv,this.setSeeBtnStatu();var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];return this.nameTxt.text=t.name,this.updateDans(),this._wingsData.openStatus?(this.openStatusOpen(),this.expBarChange(),this.updateAtt(),this.isShowUpGradeBtn(),this.setTimeDown(),0==this._lastLv&&(this._lastLv=this._wingsData.lv),void(this._lastLv!=this._wingsData.lv&&(this._lastLv=this._wingsData.lv))):void this.notOpenStatus()},e.prototype.setSeeBtnStatu=function(){this.currViewNum>=WingCT.WingMaxLv||this.currViewNum>=this._wingsData.lv+1?(this.rightBtn.enabled=!1,this.leftBtn.enabled=!0):this.currViewNum<=0?(this.leftBtn.enabled=!1,this.rightBtn.enabled=!0):(this.leftBtn.enabled=!0,this.rightBtn.enabled=!0)},e.prototype.setTimeDown=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];t&&(Timer.stop(this.refushTimeLabel,this),t.clearTime?(this.clearGroup.visible=!0,this._wingsData.clearTime>0?(this.lastTime.text="剩余时间：",this.lastTimeDown=Math.floor((DateUtils.formatMiniDateTime(this._wingsData.clearTime)-GameServer.serverTime)/1e3),this.lastTimeDown=Math.max(0,this.lastTimeDown),this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1),Timer.stop(this.refushTimeLabel,this),Timer.start(1e3,this.lastTimeDown,this.refushTimeLabel,this)):(this.lastTime.text="",this.timeLabel.text="",Timer.stop(this.refushTimeLabel,this))):this.clearGroup.visible=!1,this.noclean.visible=!this.clearGroup.visible)},e.prototype.refushTimeLabel=function(){this.lastTimeDown>0&&(--this.lastTimeDown,this.timeLabel.text=DateUtils.getFormatBySecond(this.lastTimeDown,1))},e.prototype.updateAtt=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=GlobalConfig.WingLevelConfig[this._wingsData.lv+1],i=0;this._totalPower=BagCT.getAttrPower(t.attr);var n=this.getDanAttrs(this._wingsData.lv);if(this._totalPower+=BagCT.getAttrPower(n),this.attrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(n,t.attr),1),this._wingsData&&this._wingsData.exp&&e){for(var s=[],o=e.attr,a=GlobalConfig.WingCommonConfig.tempattr?GlobalConfig.WingCommonConfig.tempattr:1,r=0;r<o.length;r++){var l=new AttributeData;l.type=o[r].type,l.value=Math.ceil(this._wingsData.exp/t.exp*(a*o[r].value)),s.push(l)}this.attrTempLabel.text=AttributeData.getAttStr(s,1,1,"（临时+",!1,!1,null,"）"),i=BagCT.getAttrPower(s),this.attrGroup.horizontalCenter=-143}else this.attrTempLabel.text="",this.attrGroup.horizontalCenter=-100;this._totalPower=this._totalPower+i,this.powerPanel.setPower(this._totalPower),this._wingsData.lv<WingCT.WingMaxLv&&(this.nextAttrLabel.text=AttributeData.getAttStr(AttributeData.AttrAddition(n,e.attr),1))},e.prototype.getDanAttrs=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=GlobalConfig.WingLevelConfig[t],n=i.attr.length,s=[],o=0;n>o;o++)s.push(new AttributeData(i.attr[o].type,Math.floor(i.attr[o].value*GlobalConfig.WingCommonConfig.flyPill/1e4*e.wingsData.flyUpDan)));var a=GlobalConfig.WingCommonConfig.attrPill;n=a.length;for(var o=0;n>o;o++)s.push(new AttributeData(a[o].type,a[o].value*e.wingsData.aptitudeDan));a=GlobalConfig.WingCommonConfig.flyPillAttr,n=a.length;for(var o=0;n>o;o++)s.push(new AttributeData(a[o].type,a[o].value*e.wingsData.flyUpDan));return s},e.prototype.expBarChange=function(){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv],e=t.exp;this.barbc.getMaxValue()!=e?this.barbc.setData(this._wingsData.exp,e):this.barbc.setValue(this._wingsData.exp)},e.prototype.isShowUpGradeBtn=function(){if(this.updateDans(),this._wingsData&&!(this._wingsData.lv>=WingCT.WingMaxLv)){var t=GlobalConfig.WingLevelConfig[this._wingsData.lv];if(this._wingsData.lv>=WingCT.WingMaxLv)this.boostBtn1.visible=!1,this.boostPrice1.visible=!1,this.bigUpLevelBtn.visible=!1;else{this.boostBtn1.visible=!0,this.boostPrice1.visible=!0;var e=BagCT.ins().getBagGoodsCountById(0,this.danItemID);this.bigUpLevelBtn.visible=e>0;var i=BagCT.ins().getBagItemById(t.itemId);i?i.count<t.itemNum&&this.checkBoxs.selected?(this.boostPrice1.setType(MoneyConst.yuanbao),this.boostPrice1.setPrice(t.itemPrice*t.itemNum,Actor.yb)):(this.boostPrice1.setType(MoneyConst.wing),this.boostPrice1.setPrice(t.itemNum,i.count)):this.checkBoxs.selected?(this.boostPrice1.setType(MoneyConst.yuanbao),this.boostPrice1.setPrice(t.itemPrice*t.itemNum,Actor.yb)):(this.boostPrice1.setType(MoneyConst.wing),this.boostPrice1.setPrice(t.itemNum,0))}this.redPoint.visible=this.bigUpLevelBtn.visible&&this._wingsData.lv==WingCT.WingExpRedPoint}},e.prototype.showOpenMovie=function(){var t=this;if(StageUtils.ins().setTouchChildren(!1),DisplayUtils.removeFromParent(this.reliveEff),this.openStatusBtn.visible=!1,!this.flyUpEffect){this.flyUpEffect=new MovieClip;var e=this.flyUpEffect.localToGlobal();e.x=290,e.y=400,this.flyUpEffect.globalToLocal(e.x,e.y,e),this.flyUpEffect.x=e.x,this.flyUpEffect.y=e.y}this.wingeff.addChild(this.flyUpEffect),this.flyUpEffect.playFile(RES_DIR_EFF+"WingOpenEff",-1);var i=new egret.Sprite,n=new egret.Shape;n.graphics.beginFill(16777215),n.graphics.drawRect(0,0,640,640),n.graphics.endFill(),i.anchorOffsetX=0,i.anchorOffsetY=0;var s=i.localToGlobal();s.x=0,s.y=640,i.globalToLocal(s.x,s.y,s),i.x=s.x,i.y=s.y,i.addChild(n),this.wingeff.addChild(i),this.flyUpEffect.mask=i;var o=egret.Tween.get(i);o.to({y:0},1500).call(function(){egret.Tween.removeTweens(t.flyUpEffect),t.flyUpEffect.visible=!1,t.wingeff.removeChild(i),t.wingeff.removeChild(t.flyUpEffect),t.flowReckEffect()})},e.prototype.flowReckEffect=function(){var t=this;this.openEffect||(this.openEffect=new MovieClip,this.openEffect.x=290,this.openEffect.y=400),this.wingeff.addChild(this.openEffect),this.openEffect.playFile(RES_DIR_EFF+"WingOpenEff3",1),Timer.start(500,1,function(){t.wingReff||(t.wingReff=new MovieClip,t.wing.addChild(t.wingReff),t.wingReff.x=80,t.wingReff.y=150,t.wingLeff=new MovieClip,t.wing.addChild(t.wingLeff),t.wingLeff.scaleX=-1,t.wingLeff.x=470,t.wingLeff.y=150),t.wingReff.playFile(RES_DIR_EFF+"WingOpenEff2",1),t.wingLeff.playFile(RES_DIR_EFF+"WingOpenEff2",1),t.shan.visible=!0,t.openEffect.scaleX+=1,t.openEffect.scaleY+=1;egret.Tween.get(t.openEffect,{loop:!1,onChange:function(){var e=egret.Tween.get(t.dor1),i=egret.Tween.get(t.dor2),n=egret.Tween.get(t.shan);e.to({x:-280},500),i.to({x:838},500).call(function(){WingCT.ins().sendActivate(t.curRole)},t),n.to({alpha:0},500),DisplayUtils.removeFromParent(t.openEffect)}})},this)},e.prototype.updateRedPoint=function(){this._wingsData.openStatus?this.redPoint0.visible=GodWingRedPoint.ins().getGodWingRedPoint():this.redPoint0.visible=!1},e}(BaseView);__reflect(WingPanel.prototype,"WingPanel"),window.WingPanel=WingPanel;var ZsBossRuleSpeak=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="HelpTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.otherClose)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.textInfo.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.HelpInfoConfig[i].text),this.textInfo.height=this.textInfo.textHeight,this.background.height=this.textInfo.textHeight+60,this.anigroup.y=(StageUtils.ins().getHeight()-this.background.height)/2},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(ZsBossRuleSpeak.prototype,"ZsBossRuleSpeak"),window.ZsBossRuleSpeak=ZsBossRuleSpeak,ViewManager.ins().reg(ZsBossRuleSpeak,LayerManager.UI_Popup);var ZsPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastZsLevel=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获取修为</u>"),this.eff=new MovieClip,this.eff.x=420,this.eff.y=100,this.eff.touchEnabled=!1,this.eff.scaleX=.6,this.eff.scaleY=.5,this.upLevelEff=new MovieClip,this.upLevelEff.x=284,this.upLevelEff.y=314,this.upLevelEff.scaleX=this.upLevelEff.scaleY=2,this.upLevelEff.touchEnabled=!1,this.maxGroup.touchEnabled=!1,this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.link,this.onTap)},e.prototype.addDisplay=function(){this.observe(ZsCT.ins().postZsData,this.setData),this.observe(Actor.ins().postLevelChange,this.setData),this.setData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.getBtn:var e=ZsCT.ins(),i=GlobalConfig.ZhuanShengLevelConfig[e.lv+1];if(e.exp<i.exp)return void TipsCT.ins().showTips("修为不足");ZsCT.ins().sendZsUpgrade();break;case this.link:ViewManager.ins().open(GainZsWin)}},e.prototype.setData=function(){this.curAtt.lineSpacing=5,this.nextAtt.lineSpacing=5;var t=ZsCT.ins();this.redPoint.visible=t.canUpgrade(),this.curZsLv.text="当前转生等级："+t.lv+"转",this.haveTxt.text=t.exp+"";var e=GlobalConfig.ZhuanShengLevelConfig[t.lv];this.curAtt.text=AttributeData.getAttStr(e,1);var i=[];for(var n in AttributeData.translate)if(!isNaN(e[n])){var s=new AttributeData;s.type=parseInt(AttributeData.translate[n]),s.value=e[n],i.push(s)}var o=SubRoles.ins().subRolesLen;this._totalPower=BagCT.getAttrPower(i)*o,this.powerPanel.setPower(this._totalPower);var a=GlobalConfig.ZhuanShengLevelConfig[t.lv+1];if(a)this.nextAtt.text=AttributeData.getAttStr(a,1),this.useTxt.text=a.exp+"",this.maxGroup.visible=!1,this.normalGroup.visible=!0;else{this.group.visible=!1,this.curAtt.horizontalCenter=0,this.maxTxt.visible=!0,this.arrowImg.visible=!1,this.nextAtt.visible=!1,this.normalGroup.visible=!1,this.maxGroup.visible=!0;for(var r=0;r<i.length&&!(r>=4);r++)this["attr"+r].text=AttributeData.getAttStr(i[r],.5)}-1!=this.lastZsLevel&&this.lastZsLevel!=t.lv?(this.upLevelEff.parent||this.mainGroup.addChild(this.upLevelEff),this.upLevelEff.playFile(RES_DIR_EFF+"Promotion",1)):DisplayUtils.removeFromParent(this.upLevelEff),this.lastZsLevel=t.lv,t.canGet()&&a?(this.eff.parent||this.group.addChild(this.eff),this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.eff)},e}(BaseView);__reflect(ZsPanel.prototype,"ZsPanel"),window.ZsPanel=ZsPanel;var Actor=function(t){function e(){var i=t.call(this)||this;return i.sysId=PackageID.Default,i.regNetMsg(1,e.init),i.regNetMsg(7,i.postExp),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e,"actorID",{get:function(){return this._actorID},set:function(t){urlParam.actorid=t,this._actorID=t},enumerable:!0,configurable:!0}),e.prototype.postExp=function(t){var i=e.level;e.level=t.readInt(),e.exp=t.readInt();var n=t.readInt();if(i<e.level){window.platform.reportLevelup(),this.postLevelChange();var s=SubRoles.lookAtTar;if(!s)return;s.wearTitle();var o=new MovieClip;o.playFile(RES_DIR_EFF+"LevelUp",e.level-i),s.addChild(o)}return n},e.init=function(t){e.handle=t.readDouble(),e.actorID=t.readInt(),GameServer.serverID=t.readInt(),e.myName=t.readUTFBytes(33),e.level=t.readInt(),e.exp=t.readInt(),t.readDouble(),e.gold=t.readNumber(),e.yb=t.readNumber(),e.vip=t.readInt(),e.soul=t.readNumber(),e.bagNum=t.readInt(),e.feats=t.readNumber(),e.runeShatter=t.readNumber(),e.runeExchange=t.readNumber(),e.togeatter1=t.readNumber(),e.togeatter2=t.readNumber(),e.weiWang=t.readInt(),ZsCT.ins().lv=t.readUnsignedInt(),SysSetting.ins().init(),this.postPFVipInfo(),ReportData.report("entergame")},e.postPFVipInfo=function(){e.myPFVipInfo={appId:+urlParam.appid||0,pfVip:+urlParam.pfVip||0,pfVipSuper:+urlParam.pfVipSuper||0,pfVipYear:+urlParam.pfVipYear||0,pfLv:+urlParam.pfVipLv||0}},e.prototype.postGoldChange=function(t){var i=e.gold;if(i==t)return!1;if(i>0){var n=t-i;if(n>0){var s="|C:0xffd93f&T:金币  +"+n+"|";TipsCT.ins().showTips(s)}}e.gold=t},e.prototype.postYbChange=function(t){var i=e.yb;if(i==t)return!1;if(i>0){var n=t-i;if(n>0){var s="|C:0xffd93f&T:元宝  +"+n+"|";TipsCT.ins().showTips(s)}}e.yb=t},e.prototype.postFeatsChange=function(t){var i=e.feats;if(i==t)return!1;if(i>0){var n=t-i;if(n>0){var s="|C:0xffd93f&T:获得"+n+"功勋|";TipsCT.ins().showTips(s)}}e.feats=t},e.prototype.postZsExpChange=function(t){var e="|C:0x00ff00&T:修为+"+t+"|";TipsCT.ins().showTips(e)},e.prototype.postUpdateTogeatter=function(t,i){var n=1==i?e.togeatter1:e.togeatter2;if(n!=t){var s=t-n;if(s>0){var o=RewardData.getCurrencyName(1==i?MoneyConst.punch1:MoneyConst.punch2),a="|C:0xffd93f&T:获得"+s+o+"|";TipsCT.ins().showTips(a)}}return 1==i?e.togeatter1=t:e.togeatter2=t,{value:t,type:i}},e.prototype.postLevelChange=function(){ReportData.report("levelup")},e.prototype.postSoulChange=function(t){var i=e.soul;if(i>0){var n=t-i;if(n>0){var s="获得|C:0xd242fb&T:魂石 x "+n+"|";TipsCT.ins().showTips(s)}}e.soul=t},e.prototype.postPowerChange=function(t){var i=e.power;return i==t?!1:(t>i&&i>0&&TipsCT.ins().showBoostPower(t,i),void(e.power=t))},e.prototype.postWeiWang=function(t){var i=e.weiWang;i>0&&t-i>0&&TipsCT.ins().showTips("|C:0xff00ff&T:获得"+(t-i)+RewardData.getCurrencyName(MoneyConst.weiWang)+"|"),e.weiWang=t},e.prototype.postChip=function(t){var i=e.chip;i>0&&t-i>0&&TipsCT.ins().showTips("|C:0xff00ff&T:获得"+(t-i)+RewardData.getCurrencyName(MoneyConst.chip)+"|"),e.chip=t},e.canZhuanSheng=function(){return e.level>=this.zhuanShengLv},Object.defineProperty(e,"samsaraLv",{get:function(){var t=SamsaraModel.ins().samsaraInfo;return t?t.lv:0},enumerable:!0,configurable:!0}),e.zhuanShengLv=80,e.serverName=0,e.runeShatter=0,e.runeExchange=0,e.togeatter1=0,e.togeatter2=0,e.vip=0,e.power=0,e.gold=0,e.yb=0,e.feats=0,e.weiWang=0,e.chip=0,e.bagNum=0,__decorate([post()],e.prototype,"postExp",null),__decorate([post()],e.prototype,"postGoldChange",null),__decorate([post()],e.prototype,"postYbChange",null),__decorate([post()],e.prototype,"postFeatsChange",null),__decorate([post()],e.prototype,"postZsExpChange",null),__decorate([post()],e.prototype,"postUpdateTogeatter",null),__decorate([post()],e.prototype,"postLevelChange",null),__decorate([post()],e.prototype,"postSoulChange",null),__decorate([post()],e.prototype,"postPowerChange",null),__decorate([post()],e.prototype,"postWeiWang",null),__decorate([post()],e.prototype,"postChip",null),__decorate([post()],e,"init",null),__decorate([post()],e,"postPFVipInfo",null),e}(BaseSystem);__reflect(Actor.prototype,"Actor"),System.Actor=function(){return Actor.ins()},window.Actor=Actor;var MapGridNode=function(){function t(){}return Object.defineProperty(t.prototype,"hidden",{get:function(){return(2&this.flags)>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"walkable",{get:function(){return(1&this.flags)>0},enumerable:!0,configurable:!0}),t.FLAG_WALKABLE=32768,t.FLAG_HIDDEN=16384,t}();__reflect(MapGridNode.prototype,"MapGridNode");var EntityAction;!function(t){t.ATTACK="a",t.CAST="c",t.STAND="s",t.RUN="r",t.DIE="d"}(EntityAction||(EntityAction={})),window.EntityAction=EntityAction;var GuideView=function(t){function e(){var e=t.call(this)||this;return e.rect=new egret.Rectangle(1,1,1,1),e.infoGroup=new eui.Group,e.infoGroup.touchEnabled=!1,e.infoGroup.touchChildren=!1,e.addChild(e.infoGroup),e.mc=new MovieClip,e.infoGroup.addChild(e.mc),e.arrowGroup=new eui.Group,e.infoGroup.addChild(e.arrowGroup),e.arrow=new GuideArrow,e.arrowGroup.addChild(e.arrow),e}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.arrow.update(),this.mc.playFile(RES_DIR_EFF+"NoviceEff",-1)},e}(GuideViewBase);__reflect(GuideView.prototype,"GuideView"),window.GuideView=GuideView;var CharImage=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.item=new eui.Image,e.addChild(e.item),e.itemName=new eui.Label,e.itemName.stroke=1,e.itemName.strokeColor=0,e.itemName.size=14,e.itemName.width=120,e.itemName.textAlign=egret.HorizontalAlign.CENTER,e.addChild(e.itemName),e.item.addEventListener(egret.Event.RESIZE,e.onResize,e),e}return __extends(e,t),e.prototype.onResize=function(){this.item.anchorOffsetX=this.width/2,this.item.anchorOffsetY=this.height},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){var e=this;if(this.x=this._infoModel.x,this.y=this._infoModel.y,t&&SpiritBossCT.ins().isSPIRIT){this.item.source="mubei_png";var i=SpiritBossCT.ins();this.item.x=10,this.item.y=20;var n=i.layerNum;this.itemName.x=this.item.x-60,this.itemName.y=this.item.y-245;var s=i.sfData[n-1].monData[t-1].times;this.item.x=this.itemName.x+60,this.item.y=this.itemName.y+245;var o=(DateUtils.formatMiniDateTime(s)-GameServer.serverTime)/1e3;Timer.start(1e3,o+1,function(){o--,o>0?e.itemName.text=DateUtils.getFormatBySecond(o,DateUtils.TIME_FORMAT_1)+"复活":(o=0,e.itemName.text="00:00:00复活",DisplayUtils.removeFromParent(e))},this)}else this.item.source="",this.itemName.text=""},Object.defineProperty(e.prototype,"weight",{get:function(){return this.y},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(CharImage.prototype,"CharImage"),window.CharImage=CharImage;var CharItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e._itemImg=new eui.Image,e._itemImg.x=-17,e._itemImg.y=-17,e._itemImg.scaleX=e._itemImg.scaleY=.6,e.addChild(e._itemImg),e._roatImg=new eui.Image("point3"),e._roatImg.anchorOffsetX=5,e._roatImg.anchorOffsetY=5,e._roatImg.alpha=0,e.addChild(e._roatImg),e}return __extends(e,t),e.prototype.setData=function(t){t.type?(this._itemImg.source=GlobalConfig.ItemConfig[t.id].icon+"_png",this.addItemEffect(t.id)):t.id==MoneyConst.gold?this._itemImg.source="icgoods117_png":t.id==MoneyConst.yuanbao?this._itemImg.source="icgoods121_png":t.id==MoneyConst.soul?this._itemImg.source="200136_png":t.id==MoneyConst.rune&&(this._itemImg.source="500007_png")},e.prototype.addRoatEffect=function(){this.removeRoatEffect();var t=egret.Tween.get(this._roatImg,{loop:!0});t.to({alpha:1},200).to({rotation:90},1e3).to({alpha:0},200).wait(300)},e.prototype.removeRoatEffect=function(){this._roatImg.alpha=0,this._roatImg.rotation=0,egret.Tween.removeTweens(this._roatImg)},e.prototype.addItemEffect=function(t){var e=GlobalConfig.ItemConfig[t];if(e){var i=ItemUtil.getDropEffName(e);""!=i&&(this._eff||(this._eff=new MovieClip),this._eff.playFile(RES_DIR_EFF+i,-1),this.addChildAt(this._eff,0))}},e.prototype.removeItemEffect=function(){this._eff&&(DisplayUtils.removeFromParent(this._eff),this._eff.stop(),this._eff=null)},e}(egret.DisplayObjectContainer);__reflect(CharItem.prototype,"CharItem"),window.CharItem=CharItem;var CharItem2=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e.item=new CharItem,e.itemName=new CharItemName,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.setData=function(t){this.item.setData(t),this.itemName.setData(t),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)},e.prototype.setItemParent=function(t){this._itemParent=t,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this),this._itemParent.addChild(this)},e.prototype.addRoatEffect=function(){this.item.addRoatEffect()},e.prototype.removeRoatEffect=function(){this.item.removeRoatEffect()},e.prototype.addFloatEffect=function(){egret.Tween.removeTweens(this.item);var t=egret.Tween.get(this.item),e=this.item.y;this.item.y-=100,t.to({y:e},500,egret.Ease.bounceOut)},e.prototype.onAdd=function(t){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),ResourceMgr.ins().reloadContainer(this.item),this._itemParent?(this._itemParent.addChild(this.item),this._itemParent.addChild(this.itemName)):(DropHelp.dropContainer.addChild(this.item),DropHelp.dropNameContainer.addChild(this.itemName))},e.prototype.onRemove=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.item.parent&&this.item.parent.removeChild(this.item),this.itemName.parent&&this.itemName.parent.removeChild(this.itemName),this.removeRoatEffect()},e.prototype.$setX=function(e){return this.itemName.x=e,this.item.x=e,t.prototype.$setX.call(this,e)},e.prototype.$setY=function(e){return this.itemName.y=e,this.item.y=e,t.prototype.$setY.call(this,e)},Object.defineProperty(e.prototype,"team",{get:function(){return this.infoModel.team},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.item.scaleX=1,this.item.scaleY=1,this.itemName.scaleX=1,this.itemName.scaleY=1},e.prototype.destruct=function(){this.item.scaleX=1,this.item.scaleY=1,this.item.removeRoatEffect(),this.item.removeItemEffect(),this.itemName.scaleX=1,this.itemName.scaleY=1,this._itemParent=null,this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)},e}(egret.DisplayObjectContainer);__reflect(CharItem2.prototype,"CharItem2"),window.CharItem2=CharItem2;var CharItemName=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.touchChildren=!1,e._nameTxt=new eui.Label,e._nameTxt.stroke=1,e._nameTxt.strokeColor=0,e._nameTxt.size=14,e._nameTxt.y=-25,e._nameTxt.width=120,e._nameTxt.x=-60,e._nameTxt.textAlign=egret.HorizontalAlign.CENTER,e.addChild(e._nameTxt),e}return __extends(e,t),e.prototype.setData=function(t){if(t.type){if(500007==t.id)this._nameTxt.text=""+t.count;else{var e=GlobalConfig.ItemConfig[t.id].name;t.count>1?this._nameTxt.text=t.count+e:this._nameTxt.text=e}this._nameTxt.textColor=ItemUtil.getQualityColor(GlobalConfig.ItemConfig[t.id])}else t.id==MoneyConst.gold?(this._nameTxt.text=""+t.count,this._nameTxt.textColor=ItemBase.QUALITY_COLOR[0]):t.id==MoneyConst.yuanbao?(this._nameTxt.text=t.count+"元宝",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[5]):t.id==MoneyConst.soul?(this._nameTxt.text=t.count+"魂石",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[2]):t.id==MoneyConst.rune&&(this._nameTxt.text=t.count+"精华",this._nameTxt.textColor=ItemBase.QUALITY_COLOR[1])},e}(egret.DisplayObjectContainer);__reflect(CharItemName.prototype,"CharItemName"),window.CharItemName=CharItemName;var CharMiner=function(t){function e(){var e=t.call(this)||this;return e.npcHead.currentState=e.npcHead.states[1],e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){t.prototype.updateModel.call(this);var e=GlobalConfig.KuangYuanConfig[this.infoModel.configID];this.npcHead.nameTxt.text=this.infoModel.name+"的矿工",this.npcHead.nameTxt.textColor=e.color,this.updateTime(),this.updateTitleState()},e.prototype.updateTime=function(){var t=Math.floor((this.infoModel.endTime-GameServer.serverTime)/1e3);t>=0?this.npcHead.timeTxt.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3):MineData.ins().remove(this.infoModel.index),this.playAction(EntityAction.ATTACK)},e.prototype.updateTitleState=function(){this.npcHead.updateState(this.infoModel)},e}(CharNpc);__reflect(CharMiner.prototype,"CharMiner"),window.CharMiner=CharMiner;var CharModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.parserItemData=function(t){this.itemData=new RewardData,this.itemData.parser(t)},e}(EntityModel);__reflect(CharModel.prototype,"CharModel");var Version;!function(t){t.BUILD_NUMBER="V1.18.9.3.1544-Gane"}(Version||(Version={}));var CharRole=function(t){function e(){var e=t.call(this)||this;return e.ringMc=[],e.zhanLingAttack=!1,e.touchEnabled=!1,e.touchChildren=!1,e.AI_STATE=AI_State.Stand,e.neigongBar=new eui.ProgressBar,e.neigongBar.skinName="bloodyelskin",e.neigongBar.anchorOffsetY=-5,e.neigongBar.labelDisplay.visible=!1,e.neigongBar.labelFunction=function(){return""},e.titleCantainer.addChild(e.neigongBar),e.neigongBar.anchorOffsetX=Math.floor(e.neigongBar.width>>1),e._nameTxt.textColor=16777215,e._nameGroup.visible=!0,e}return __extends(e,t),e.prototype.createTweenObj=function(){var t=this;this.dieTweenObj={set alpha(e){t.alpha=e
},get alpha(){return t.alpha}},this.moveTweenObj={set x(e){t.x=e>>0},set y(e){t.y=e>>0},get x(){return t.x},get y(){return t.y}}},e.prototype.$setX=function(e){var i=t.prototype.$setX.call(this,e);return i&&this.moveCamera(GameMap.mapID,GameMap.fubenID),i},e.prototype.$setY=function(e){var i=t.prototype.$setY.call(this,e);return i&&this.moveCamera(GameMap.mapID,GameMap.fubenID),i},e.prototype.loadOther=function(e){if(this.action==EntityAction.DIE){if(0!=e&&1!=e){var i=this.getMc(e);return void(i&&(i.visible=!1))}}else{var i=this.getMc(e);i&&(i.visible=!0)}(4!=e||!this.zhanLingAttack&&this._state!=EntityAction.ATTACK)&&t.prototype.loadOther.call(this,e)},e.prototype.loadBody=function(){t.prototype.loadBody.call(this),this.ringMc&&this.ringMc.length>0&&this.updateRingMC()},e.prototype.getResDir=function(t){if(4==t)return 3;var e=2*(this._dir-4);if(0>e&&(e=0),GameServer.serverOpenDay<7)return this._dir-e;var i=this._dir-e;return 2>i?1:3},e.prototype.updateBlood=function(e){var i=this;void 0===e&&(e=!1),t.prototype.updateBlood.call(this,e),this._hpBar.value<=0?this.onDead(function(){i.deadDelay()}):this.action==EntityAction.DIE&&this.playAction(EntityAction.STAND)},e.prototype.parseModel=function(){this.updateBlood(!0),this.updateNeiGong(),this.updateTitle(),this.updateNameColor()},e.prototype.updateNameColor=function(){var t=this.infoModel;t.camp>0&&BattleCC.ins().isBattle()?this.setNameTxtColor(t.camp!=BattleCC.ins().camp?16711680:65280):!this.isMy&&t.camp>0&&KfArenaSys.ins().isKFArena?this.setNameTxtColor(t.camp!=KfArenaSys.ins().myCampId?16711680:39423):this.team==Team.WillEntity?this.setNameTxtColor(16776960):this.setNameTxtColor(16777215)},e.prototype.addBuff=function(e){t.prototype.addBuff.call(this,e);var i=e.effConfig;if(0==GameMap.fubenID)switch(i.type){case 5:var n=void 0;if(this.team==Team.My){var s=Artifact.ins().getReviseBySkill(35001),o=GodWeaponCC.ins().getReviseBySkill(35001),a=void 0;o&&(a=o[0]);var r=i.args.a;s&&s.args&&s.args[0]&&(r+=s.args[0].vals[2]),a&&a.args&&a.args[0]&&(r+=a.args[0].vals[2]),n=FbCT.createModel(GlobalConfig.MonstersConfig[r]),n.x=this.x,n.y=this.y,n.masterHandle=this.infoModel.handle,n.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed));var l=0,h=n.getAtt(AttributeType.atAttack);if(s&&s.args&&s.args[0]){var u=s.args[0].vals[3]?s.args[0].vals[3]:1;l+=this.infoModel.getAtt(AttributeType.atAttack)*u}if(a&&a.args&&a.args[0]){var u=a.args[0].vals[3]?a.args[0].vals[3]:1;l+=this.infoModel.getAtt(AttributeType.atAttack)*u}n.setAtt(AttributeType.atAttack,(l>>0)+h)}else n=FbCT.createModel(GlobalConfig.MonstersConfig[i.args.a]),n.x=this.x,n.y=this.y,n.masterHandle=this.infoModel.handle,n.setAtt(AttributeType.atMoveSpeed,this.infoModel.getAtt(AttributeType.atMoveSpeed));GameLogic.ins().createEntityByModel(n,this.team)}},e.prototype.updateNeiGong=function(){if(this.infoModel){var t=this.infoModel.getAtt(AttributeType.maxNeiGong);this.neigongBar.visible=this.checkNeigongVisible(),this.neigongBar.maximum=t,this.neigongBar.value=this.infoModel.getAtt(AttributeType.cruNeiGong),this.neigongBar.visible&&(this.showName(this.neigongBar.visible),this.showBlood(this.neigongBar.visible))}},e.prototype.checkNeigongVisible=function(){var t=this.infoModel.getAtt(AttributeType.maxNeiGong);return 0!=t&&this._state!=EntityAction.DIE},e.prototype.updateTitle=function(){var t=this.infoModel,e=t.title;if(this.removeTitle(),!(this.isMy&&Setting.ins().getValue(ClientSet.shTitle)||!this.isMy&&Setting.ins().getValue(ClientSet.shOtherTitle))&&this.getIsShowBody()&&e>0){var i=GlobalConfig.TitleConf[e];if(i)if(i.img)null==this._title&&(this._title=new eui.Image,this._title.anchorOffsetX=115,this._title.anchorOffsetY=100,this.titleCantainer.addChild(this._title)),this._title.source=RES_DIR_CHENGHAO+i.img;else if(i.eff){null==this._titleMc&&(this._titleMc=ObjectPool.pop("MovieClip"),this._titleMc.anchorOffsetX=0,this._titleMc.anchorOffsetY=80,this.titleCantainer.addChild(this._titleMc));var n=RES_DIR_EFF+i.eff;this.playFile(this._titleMc,n)}}},e.prototype.wearTitle=function(){var t=this.infoModel;if(!t.title){var e,i=GlobalConfig.GuideTitleConfig;null==this._title&&(this._title=new eui.Image,this._title.anchorOffsetX=115,this._title.anchorOffsetY=100,this.titleCantainer.addChild(this._title));for(var n in i){switch(i[n].type){case 1:e=FbCT.ins().guanqiaID>=1e5?0:FbCT.ins().guanqiaID;break;case 2:e=Actor.level;break;case 3:e=ZsCT.ins().lv}if(e<i[n].task)return void(this._title.source=RES_DIR_CHENGHAO+i[n].img);this._title.source=""}}},e.prototype.updateRingMC=function(){for(var t in this.ringMc)this.ringMc[t]&&(null==this.ringMc[t].parent&&this.addChild(this.ringMc[t]),this.ringMc[t].setEffectXY(this.dir))},e.prototype.setCharName=function(e){t.prototype.setCharName.call(this,e),this._nameGroup.visible=!0,this.setVipIcon()},e.prototype.setVipIcon=function(){var t=this.infoModel;return t.getCurFPVipInfo()?(this.eFPVipIcon||(this.eFPVipIcon=new QQVipIcon,this.eFPVipIcon.bottom=0,this._nameGroup.addChildAt(this.eFPVipIcon,0)),t.isMy&&(this.eFPVipIcon.handle=Actor.handle),void this.eFPVipIcon.setVip(t.getCurFPVipInfo())):void(this.eFPVipIcon&&this.eFPVipIcon.setVip(null))},Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){t?this._infoModel=t:console.log("设置infoModel异常,对象为空")},enumerable:!0,configurable:!0}),e.prototype.showNeigong=function(t){this.neigongBar.visible=t&&this.checkNeigongVisible()},e.prototype.showZhanling=function(t,e){var i=GlobalConfig.ZhanLingLevel[0][e];if(i.talentLevel||t){var n=GlobalConfig.ZhanLingBase[t].appearance,s=this.addMc(4,RES_DIR_EFF+n);s&&(s.scaleX=s.scaleY=.75)&&(s.y-=150)&&(s.x+=20)&&(s.alpha=0),this.updateZhanLingOffset(),Timer.stop(this.playZhanLingAttack,this),Timer.start(200,1,this.playZhanLingAttack,this),Timer.stop(this.hideZhanling,this),Timer.start(3e3,1,this.hideZhanling,this)}},e.prototype.updateZhanLingOffset=function(){var t=this.getMc(4),e=GlobalConfig.ZhanLingConfig.anchorOffset;if(e){var i=0==this.dir||4==this.dir?0:1,n=e[i]||[];t.anchorOffsetX=n[0]||0,t.anchorOffsetY=n[1]||0}},e.prototype.playZhanLingAttack=function(){var t=this,e=4,i=this.getMc(e);if(i){var n=this.getFileName(e);this.zhanLingAttack=!0,egret.Tween.get(i).to({scaleX:.5,scaleY:.5,alpha:1},300).call(function(){egret.Tween.get(i).to({scaleX:.55,scaleY:.55},100).call(function(){egret.Tween.get(i).to({scaleX:.5,scaleY:.5},100)})}),i.playFile(n,1,function(){t.zhanLingAttack=!1;var n=t.getFileName(e);i.playFile(n,-1,null,!1)},!1)}},e.prototype.hideZhanling=function(){var t=this,e=this.getMc(4);e&&egret.Tween.get(e).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){t.removeMc(4)})},e.prototype.reset=function(){t.prototype.reset.call(this),this.zhanLingAttack=!1,this.AI_STATE=AI_State.Stand},e.prototype.destruct=function(){this.AI_STATE=AI_State.Stand,this._hpBar.visible=this._nameGroup.visible=!0,this._nameTxt.textColor=16777215;for(var t in this.ringMc)this.ringMc[t]&&(this.ringMc[t].reset(),this.ringMc[t]=null,delete this.ringMc[t])},e.prototype.deadDelay=function(){this._hpBar.slideDuration=0,this._hpBar.value=0,this.neigongBar.slideDuration=0,this.neigongBar.value=this.neigongBar.maximum,this.stopMove(),this.removeHardStraight(),this.removeAllBuff(),this.hideZhanling(),this.neigongBar.visible=!1,this._title&&(this._title.source=""),this._hpBar.visible=this._nameGroup.visible=!1,this.atking=!1,Timer.stopAll(this),CharMonster.die(this)},Object.defineProperty(e.prototype,"nameVisible",{get:function(){return this._nameGroup.visible},enumerable:!0,configurable:!0}),e.prototype.showNameAndHp=function(){this._hpBar.visible=this._nameGroup.visible=!0},e.prototype.showBodyContainer=function(){this.isShowBody||(t.prototype.showBodyContainer.call(this),this.neigongBar.alpha=1)},e.prototype.hideBodyContainer=function(){this.isShowBody&&(t.prototype.hideBodyContainer.call(this),this.neigongBar.alpha=0)},e.prototype.moveCamera=function(t,e){if(this==SubRoles.lookAtTar){t==GameMap.mapID&&e==GameMap.fubenID&&GameLogic.ins().moveCamera();var i="sefety",n={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};!this[i]&&GameMap.checkSafety(n)?(TipsCT.ins().showCenterTips("|C:0x00ff00&T:进入安全区|"),this[i]=!0):this[i]&&!GameMap.checkSafety(n)&&(TipsCT.ins().showCenterTips("|C:0xff0000&T:离开安全区|"),this[i]=!1)}},e.prototype.isSafety=function(){var t={x:GameMap.point2Grip(this.x),y:GameMap.point2Grip(this.y)};return GameMap.checkSafety(t)},e.prototype.onDead=function(t){this.stopMove(),this.playAction(EntityAction.DIE,t)},e.prototype.stopMove=function(){t.prototype.stopMove.call(this),this==SubRoles.lookAtTar&&(egret.callLater(this.stopSoundRun,this),GameLogic.ins().postAdjustMapPos())},e.prototype.stopSoundRun=function(){this==SubRoles.lookAtTar&&this.action!=EntityAction.RUN&&SoundUtil.stop(SoundEnum.RUN)},e.prototype.addDisplay=function(){var e=this;t.prototype.addDisplay.call(this);var i=this.infoModel;if(this.isMy){this.observe(EquipCT.ins().postEquipChange,function(t){var n=t[0],s=t[1];n==i.index&&(2==s&&e.shBody(!0),0==s&&e.shWeapon(!0))}),this.observe(Dress.ins().postDressInfo,function(){e.shBody(!0),e.shWeapon(!0),e.shWing(!0)}),this.observe(WingCT.ins().postWingUpgrade,function(){e.shWing(!0)}),this.observe(Heirloom.ins().postHeirloomInfo,function(t){t==i.index&&e.shHeirloom(!0)});var n=Guild.ins(),s=LiLian.ins();this.associated(function(){i.lilianLv=s.liLianLv,i.guildID=n.guildID,i.guildName=n.guildName,e.setCharName(i.guildAndName)},n.postQuitGuild,n.postGuildInfo,s.postLilianData)}this._hpBar.thumb.source=this.isMy?"boolGreen_png":"boolRed_png",this.setCharName(i.guildAndName),this.shWeapon(!0),this.shHeirloom(!0)},e.prototype.settingUpdate=function(){t.prototype.settingUpdate.call(this),this.shWing(!0),this.updateTitle()},e.prototype.removeDisplay=function(){t.prototype.removeDisplay.call(this),this.shWeapon(!1),this.shHeirloom(!1)},e.prototype.shBody=function(t){if(!t||!this.isShowBody)return void this.clearMc(0);var e=this.infoModel,i=e.equipsData[2].item.configID,n="";e.zhuangbei[0]>0?n=GlobalConfig.ZhuangBanId[e.zhuangbei[0]].res:i>0&&GlobalConfig.EquipConfig[i]&&(n=GlobalConfig.EquipConfig[i].appearance),n=n?n.substring(4):"000",n+="_"+e.sex,this.addMc(0,RES_DIR_BODY+n)},e.prototype.shWeapon=function(t){if(!t||!this.isShowBody)return this.clearMc(1),void this.clearMc(3);var e=this.infoModel,i=e.getEquipByIndex(0).item.configID,n=e.hideWeapons(),s="";if(e.zhuangbei[1]>0?s=GlobalConfig.ZhuangBanId[e.zhuangbei[1]].res:i>0&&GlobalConfig.EquipConfig[i]&&(s=GlobalConfig.EquipConfig[i].appearance),s=s?s.substring(6):"",!s)return this.clearMc(1),void this.clearMc(3);if(s+=GlobalConfig.ClientGlobalConfig.useManRes?"_0":"_"+e.sex,this.addMc(1,RES_DIR_WEAPON+s),!n&&e.weapons&&e.weapons.weaponsId>0){var o=GlobalConfig.WeaponSoulConfig[e.weapons.weaponsId].outside[e.job-1];this.addMc(3,RES_DIR_WEAPON+o)}},e.prototype.shWing=function(t){if(t=t&&(this.isMy&&!Setting.ins().getValue(ClientSet.shWing)||!this.isMy&&!Setting.ins().getValue(ClientSet.shOtherWing)),!t||!this.isShowBody)return void this.removeMc(2);if(!(this.isMy&&Setting.ins().getValue(ClientSet.shWing)||!this.isMy&&Setting.ins().getValue(ClientSet.shOtherWing))){var e=this.infoModel;if(e){var i="";if(e.zhuangbei[2]>0)i=GlobalConfig.ZhuangBanId[e.zhuangbei[2]].res;else if(e.wingsData.openStatus){var n=GlobalConfig.WingLevelConfig[e.wingsData.lv];n&&(i=n.appearance)}i&&"wing"==i.substring(0,4)?this.addMc(2,RES_DIR_WING+i.substring(4)):this.removeMc(2)}}},e.prototype.shHeirloom=function(t){var e=this.infoModel,i="_Heir_";if(!t||!e.heirloom||!this.isShowBody)return DisplayUtils.removeFromParent(this[i]),void(this[i]=null);var n=e.heirloom.getSuitConfig(e);if(!n||!n.weff)return DisplayUtils.removeFromParent(this[i]),void(this[i]=null);var s=this[i]=this[i]||new MovieClip;this.playFile(s,RES_DIR_EFF+n.weff),this.addChild(s)},__decorate([callLater],e.prototype,"moveCamera",null),e}(CharMonster);__reflect(CharRole.prototype,"CharRole"),window.CharRole=CharRole;var CharTransfer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.transferName=new TransferNameHead,e.transferName.anchorOffsetX=40,e.transferName.anchorOffsetY=21,e.titleCantainer.addChild(e.transferName),e.touchEnabled=!0,e.touchChildren=!1,e.titleCantainer.anchorOffsetY=80,e}return __extends(e,t),Object.defineProperty(e.prototype,"infoModel",{get:function(){return this._infoModel},set:function(t){this._infoModel=t},enumerable:!0,configurable:!0}),e.prototype.updateModel=function(){this.x=this.infoModel.x,this.y=this.infoModel.y,this.transferName.updateModel(this.infoModel)},e.prototype.addDisplay=function(){this.mc=this.mc||new MovieClip,this.mc.playFile(this.infoModel.avatarFileName,-1),this.addChild(this.mc)},e}(CharEffect);__reflect(CharTransfer.prototype,"CharTransfer"),window.CharTransfer=CharTransfer;var EntityBuff=function(){function t(){this.multRate=1}return t.prototype.dispose=function(){this.source=null,this.hostsHandle=null,this.multRate=1},t.createBuff=function(e,i,n){var s=GlobalConfig.EffectsConfig[e];Assert(s,"EffectsConfig中 "+e+" 配置为空！！！");var o=RoleAI.ins().skillEffValue(i,s,n),a=n?n.time||0:0;return t.createBaseBuff(e,i,o,s.duration+a)},t.createBaseBuff=function(t,e,i,n){var s=GlobalConfig.EffectsConfig[t];Assert(s,"EffectsConfig中 "+t+" 配置为空！！！");var o=ObjectPool.pop("EntityBuff");if(o.effConfig=s,o.value=i,o.addTime=egret.getTimer(),o.endTime=o.addTime+(n?n:s.duration),o.count=(n?n:s.duration)/s.interval>>0,o.step=0,o.source=e,7==s.type){null==o.hostsHandle&&(o.hostsHandle=[]);var a=EntityManager.ins().getRootMasterHandle(e.infoModel.handle);o.hostsHandle.indexOf(a)<0&&o.hostsHandle.push(a)}return o},t.prototype.isExecute=function(){return egret.getTimer()-this.addTime>this.step*this.effConfig.interval},t.prototype.canRemove=function(){return 5!=this.effConfig.type&&egret.getTimer()>=this.endTime},t.prototype.isCanotHit=function(){return 4==this.effConfig.type&&1==this.effConfig.args.i},t}();__reflect(EntityBuff.prototype,"EntityBuff"),window.EntityBuff=EntityBuff;var EntityFilter;!function(t){t[t.no=0]="no",t[t.hard=1]="hard",t[t.poison=2]="poison"}(EntityFilter||(EntityFilter={}));var EntityFilterUtil=function(){function t(){}return t.getEntityFilter=function(e){var i=EntityFilter.no;return t.isHard(e)?i=EntityFilter.hard:t.isPoison(e)&&(i=EntityFilter.poison),i},t.isHard=function(t){return 51001==t||150065==t},t.isPoison=function(t){return 23001==t||61001==t||150071==t},t.buffFilter={1:{filters:FilterUtil.ARRAY_GRAY_FILTER},2:{filters:FilterUtil.ARRAY_GREEN_FILTER}},t}();__reflect(EntityFilterUtil.prototype,"EntityFilterUtil");var MineModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Mine,e}return __extends(e,t),Object.defineProperty(e.prototype,"npcConfig",{get:function(){var t=GlobalConfig.KuangYuanConfig[this.configID];return GlobalConfig.NpcBaseConfig[t.npcId]},enumerable:!0,configurable:!0}),e.prototype.parser=function(t){this.index=t.readByte(),this.actorID=t.readInt(),this.name=t.readString(),this.power=t.readInt(),this.guildName=t.readString(),this.configID=t.readUnsignedByte(),this.startTime=DateUtils.formatMiniDateTime(t.readInt()),this.endTime=DateUtils.formatMiniDateTime(t.readInt()),this.isBeFight=t.readBoolean();var e=t.readByte();this.beFightActorID=[];for(var i=0;e>i;i++)this.beFightActorID[i]=t.readInt()},e}(NpcModel);__reflect(MineModel.prototype,"MineModel"),window.MineModel=MineModel;var MineNpcHead=function(t){function e(){var e=t.call(this)||this;return e.states=["none","mine"],e.skinName="MineNpcHeadSkin",e.contentGroup.touchEnabled=!1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.updateModel=function(t){var e=t.npcConfig;this.titleGroup.visible=!(!e||!e.title),this.titleImg.source=e?e.title:"",this.icon.source=e?e.headIcon:""},e.prototype.updateState=function(t){t.isBeFight?this.setState(1):MineData.ins().getIsCanAtk(t)?this.setState(2):this.setState(0)},e.prototype.setState=function(t){1==t?this.workerState.source="":2==t?this.workerState.source="kuanggong_title":this.workerState.source="",this.setEff(t)},e.prototype.setEff=function(t){if(1==t){var e=this.getEff();e.playFile(RES_DIR_EFF+"BattlEff1",-1),e.x=this.stateGroup.width>>1,e.y=-20,this.stateGroup.addChild(e)}else DisplayUtils.removeFromParent(this.eff)},e.prototype.getEff=function(){return this.eff=this.eff||new MovieClip,this.eff},e}(eui.Component);__reflect(MineNpcHead.prototype,"MineNpcHead"),window.MineNpcHead=MineNpcHead;var PaoPaoView=function(t){function e(){var e=t.call(this)||this;return e.jobText=[16146438,16146438,2933496,14831353],e.skinName="paopaoSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.x=-this.width/2,this.visible=!1},e.prototype.setSpeak=function(t,e){void 0===e&&(e=1),Timer.stopAll(this),this.start(),this.nameTxt.textColor=this.jobText[e];var i=BubbleFactory.ins().playBubbleEffect(t);i&&(this.nameTxt.text=i,this.nameTxt.x=-this.nameTxt.textWidth>>1,this.visible=!0)},e.prototype.start=function(){Timer.start(1e3,1,this.destruct,this)},e.prototype.destruct=function(){this.parent&&(this.visible=!1)},e}(BaseView);__reflect(PaoPaoView.prototype,"PaoPaoView"),window.PaoPaoView=PaoPaoView;var Role=function(t){function e(){var e=t.call(this)||this;return e.thunderData=[],e.thunderEquipLv=[],e.thunderEquipAwakeLv=[],e.thunderMinLevel=0,e.soulSuitData=[],e.equipAwakeLv=[],e.legenEquipDate=[],e.powerEquipDate=[],e.powerEquipItemData=[],e.powerEquipAwakeLv=[],e.xinmoEquipItemData=[],e.kingEquipItemData=[],e.runeDatas=[],e.wingSkillData=[],e.lilianLv=0,e._mbRing=0,e.hsRing=0,e.deCirShowID=0,e.fpVipInfo={},e.type=EntityType.Role,e}return __extends(e,t),e.getAttrTypeByName=function(t){return this.translate[t]},e.getJobNameByJob=function(t){return this.jobNumberToName[t]},e.getHejiEquipNameByType=function(t){return this.hejiPosName[t]},e.getEquipNameByType=function(t){return this.typeNumberToName[t]},e.getWingEquipNameByType=function(t){return this.typeEquipWingToName[t]},e.getAllForgeLevelByType=function(t){for(var e=0,i=SubRoles.ins().subRolesLen,n=0;i>n;n++)for(var s=SubRoles.ins().getSubRoleByIndex(n).equipsData,o=0;o<EquipCT.FOEGE_MAX;o++)switch(t){case PackageID.strongthen:e+=s[o].strengthen;break;case PackageID.Gem:e+=s[o].gem;break;case PackageID.Zhuling:e+=s[o].zhuling}return e},e.prototype.parser=function(t){this.title=t.readInt(),this.index=t.readInt(),this.job=t.readInt(),this.sex=t.readInt(),this.power=t.readDouble(),this.skillsData=[];var e;for(e=0;5>e;e++){var i=t.readInt();this.skillsData.push(SkillData.getSkillByJob(this.job,e+1,i))}for(e=0;5>e;e++)t.readInt();for(this.yuanshengData=[],this.yuanshenLv=t.readInt(),e=0;6>e;e++)this.yuanshengData.push(t.readBoolean());this.equipsData=[];var n;for(e=0;e<EquipPos.MAX;e++)n=new EquipsData,n.parser(t),this.equipsData.push(n);for(this.exRingsData=[],e=0;4>e;e++)this.exRingsData.push(t.readInt());this.wingsData=new WingsData,this.wingsData.parser(t),this.jingMaiData=new JingMaiData,this.jingMaiData.parser(t),this.loongSoulData=new LongHunData,this.loongSoulData.parser(t),this.parserRune(t),this.parserhHeirloom(t),this.parserhWeapons(t),this.parserThunder(t),this.parserSoulSuit(t),this.powerEquipItemList(t),this.xinmoEquipItemList(t),this.kingEquipItemList(t),this.parserAtt(t),this.parserExAtt(t),this.parseJadeData(t),this.parseShenyuData(t),this.parserThunder2(t),this.parserEquipAwake(t),this.parserLegenEquip(t),this.parserPFVipInfo(t),this.parserZhuangbei(t),this.deCirShowID=t.readInt(),this.setWingSkill()},e.prototype.parserThunder=function(t){for(var e=12,i=null,n=0;e>n;n++)i=new ItemData,i.parser(t),this.thunderData[n]=i;this.calcThunderMinLevel()},e.prototype.parserThunder2=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readUnsignedByte();this.thunderEquipLv[n]=t.readUnsignedByte(),this.thunderEquipAwakeLv[n]=t.readUnsignedByte()}},e.prototype.parserEquipAwake=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readUnsignedByte();this.equipAwakeLv[n]=t.readUnsignedByte()}},e.prototype.parserLegenEquip=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readUnsignedByte();this.legenEquipDate[n]=t.readUnsignedByte()}},e.prototype.calcThunderMinLevel=function(){for(var t=GlobalConfig.LeitingEquipConf,e=0;8>e;e++){var i=this.thunderData[e];if(!i.itemConfig){this.thunderMinLevel=0;break}this.thunderMinLevel?this.thunderMinLevel=Math.min(t[i.configID].level,this.thunderMinLevel):this.thunderMinLevel=t[i.configID].level}},e.prototype.parserSoulSuit=function(t){for(var e=8,i=0;e>i;i++){var n=new ItemData;n.parser(t),this.soulSuitData[i]=n}},e.prototype.powerEquipItemList=function(t){for(var e=8,i=0;e>i;i++){var n=new ItemData;n.parser(t),this.powerEquipItemData[i]=n}},e.prototype.xinmoEquipItemList=function(t){for(var e=8,i=0;e>i;i++){var n=new ItemData;n.parser(t),this.xinmoEquipItemData[i]=n}},e.prototype.kingEquipItemList=function(t){for(var e=12,i=0;e>i;i++){var n=new ItemData;n.parser(t),this.kingEquipItemData[i]=n}},e.prototype.getThunderSkillList=function(){var t=GlobalConfig.LeitingEquipStarSuitConf,e=[];if(this.thunderMinLevel>=3&&t[this.thunderMinLevel])for(var i in t[this.thunderMinLevel][8]){var n=t[this.thunderMinLevel][8].skill;for(var s in n){var o=n[s];o[1]<=this.thunderMinLevel&&e.push(new SkillData(o[0]))}}return e},e.prototype.parserhWeapons=function(t){this.weapons||(this.weapons=new WeaponsData),this.weapons.weaponsId=t.readInt()},e.prototype.parserhHeirloom=function(t){this.heirloom||(this.heirloom=new HeirloomData),this.heirloom.parser(t)},e.prototype.setWingSkill=function(){this.wingSkillData=[];for(var t=0;t<this.wingsData.lv+1;t++){var e=GlobalConfig.WingLevelConfig[t];e&&e.pasSkillId&&this.wingSkillData.push(e.pasSkillId)}},e.prototype.getLegendSkill=function(){var t=this.legenEquipDate[0],e=this.legenEquipDate[2],i=[];for(var n in GlobalConfig.HotBloodStarSuit)for(var s in GlobalConfig.HotBloodStarSuit[n])t>=6&&e>=6&&6==GlobalConfig.HotBloodStarSuit[n][s].level?i.push(new SkillData(GlobalConfig.HotBloodStarSuit[n][s].skill)):t>=4&&e>=4&&4==GlobalConfig.HotBloodStarSuit[n][s].level?i.push(new SkillData(GlobalConfig.HotBloodStarSuit[n][s].skill)):t>=1&&e>=1&&1==GlobalConfig.HotBloodStarSuit[n][s].level&&i.push(new SkillData(GlobalConfig.HotBloodStarSuit[n][s].skill));return i},e.prototype.getPowerEquipSkill=function(){for(var t=[],e=[],i=0;3>i;i++)e=PowerEquipCT.ins().getSkillsformStageAndCout(this,i+1);for(var n=0;n<e.length;n++)t.push(new SkillData(e[n]));return t},e.prototype.parserModel=function(t){var e=t.readShort();this.zhuZaiData=[];for(var i=0;e>i;i++){var n=new ZhuZaiData;n.parser(t),this.zhuZaiData[n.id-1]=n}},e.prototype.parseJadeData=function(t){this.jadeData||(this.jadeData=new JadeDataNew),this.jadeData.parserOther(t)},e.prototype.parseShenyuData=function(t){this.godWingData=new GodWingData,this.godWingData.parser(t)},e.prototype.parserPFVipInfo=function(t){this.fpVipInfo=PFVipCT.parserPFVipInfo(t)},e.prototype.getCurFPVipInfo=function(){return this.fpVipInfo[urlParam.appid]},e.prototype.parserZhuangbei=function(t){this.zhuangbei=[];for(var e=0;3>e;e++)this.zhuangbei.push(t.readInt())},e.prototype.parserRune=function(t){var e=8,i=null;this.runeDatas=[];for(var n=0;e>n;n++)i=new ItemData,i.parser(t),this.runeDatas.push(i)},e.prototype.parseForgeChange=function(t,e){var i=t.readInt();switch(e){case PackageID.strongthen:this.equipsData[i].strengthen=t.readInt();break;case PackageID.Gem:this.equipsData[i].gem=t.readInt();break;case PackageID.Zhuling:this.equipsData[i].zhuling=t.readInt();break;case PackageID.Tupo:this.equipsData[i].tupo=t.readInt();break;case 1100:this.equipsData[i].bless=t.readInt()}return i},e.prototype.parserExAtt=function(t){for(var e=t.readShort(),i=0;e>i;i++)this.setExAtt(i,t.readInt())},e.prototype.parserOtherRole=function(t,e){this.parserAtt(t),this.parserExAtt(t),this._name=t.readString(),e&&(this._servId=t.readInt()),this.job=t.readByte(),this.sex=t.readByte(),this._lv=t.readInt(),this.equipsData=[],this.equipsData[2]=new EquipsData,this.equipsData[2].item=new ItemData,this.equipsData[2].item.configID=t.readInt(),this.equipsData[0]=new EquipsData,this.equipsData[0].item=new ItemData,this.equipsData[0].item.configID=t.readInt(),this.wingsData=new WingsData,this.wingsData.lv=t.readInt(),this.wingsData.openStatus=t.readInt(),this.title=t.readInt(),this.guildID=t.readInt(),this.guildName=t.readString(),this.parserZhuangbei(t),this.lilianLv=t.readInt(),this.weaponsId=t.readShort(),this.parserhHeirloom(t),this.camp=t.readShort(),this.fpVipInfo=PFVipCT.parserPFVipInfo(t),e&&(this._servShowId=t.readUnsignedShort())},Object.defineProperty(e.prototype,"mbRing",{get:function(){return this._mbRing},set:function(t){this._mbRing=t},enumerable:!0,configurable:!0}),e.prototype.getMinEquipIndexByType=function(t){for(var e=0,i=Number.MAX_VALUE,n=0,s=ForgeConst.CAN_FORGE_EQUIP.length,o=0;s>o;++o){var a=ForgeConst.CAN_FORGE_EQUIP[o];switch(t){case ForgeWin.Page_Select_Boost:n=this.equipsData[a].strengthen;break;case ForgeWin.Page_Select_Gem:n=this.equipsData[a].gem;var r=GlobalConfig.StoneOpenConfig[a];if(Actor.level<r.openLv)continue;break;case ForgeWin.Page_Select_ZhuLing:n=this.equipsData[a].zhuling;break;case 3:n=this.equipsData[a].tupo}i>n&&(i=n,e=a)}return e},e.prototype.getEquipForgeTotalLv=function(t){for(var e=0,i=ForgeConst.CAN_FORGE_EQUIP.length;i--;){var n=ForgeConst.CAN_FORGE_EQUIP[i];switch(t){case ForgeWin.Page_Select_Boost:e+=this.getEquipByIndex(n).strengthen;break;case ForgeWin.Page_Select_Gem:e+=this.getEquipByIndex(n).gem;break;case ForgeWin.Page_Select_ZhuLing:e+=this.getEquipByIndex(n).zhuling;break;case 3:e+=this.getEquipByIndex(n).tupo}}return e},e.prototype.getEquipForgeLv=function(t,e){var i=0;switch(e){case ForgeWin.Page_Select_Boost:i+=this.getEquipByIndex(t).strengthen;break;case ForgeWin.Page_Select_Gem:i+=this.getEquipByIndex(t).gem;break;case ForgeWin.Page_Select_ZhuLing:i+=this.getEquipByIndex(t).zhuling;break;case 3:i+=this.getEquipByIndex(t).tupo}return i},e.prototype.getHeirloomSlotPower=function(t){var e=this.heirloom.getInfoBySolt(t),i=BagCT.getAttrPower(e.attr)||0,n=e.attr_add,s=0,o=this.getEquipByIndex(t);if(o.item.itemConfig){s+=o.item.point;for(var a=0;3>a;a++){var r=this.getEquipForgeLv(t,a),l=ForgeCT.ins().getForgeConfigByPos(t,r,a);s+=BagCT.getAttrPower(l.attr)||0}}var h=i+Math.floor(s*(n/100));return h},e.prototype.mergeData=function(t){return this.masterHandle=t.masterHandle,this.handle=t.handle,this.type=t.type,this.x=t.x,this.y=t.y,this.attributeData=t.attributeData,this.attributeExData=t.attributeExData,this.team=t.team,this.lilianLv=t.lilianLv,this.name=t.name,this.guildID=t.guildID,this.guildName=t.guildName,this.isMy=t.isMy,this.title=t.title,t instanceof e&&(this.warLevel=t.warLevel,this.mbRing=t.mbRing,this.hsRing=t.hsRing),this},e.prototype.getEquipDataByPos=function(t){return this.equipsData&&this.equipsData[t]?this.equipsData[t]:null},e.prototype.getForgeTotalPower=function(t){for(var e=0,i=ForgeConst.CAN_FORGE_EQUIP.length;i--;){var n=ForgeConst.CAN_FORGE_EQUIP[i],s=void 0;switch(t){case ForgeWin.Page_Select_Boost:s=this.equipsData[n].strengthen;break;case ForgeWin.Page_Select_ZhuLing:s=this.equipsData[n].zhuling;break;case ForgeWin.Page_Select_Gem:s=this.equipsData[n].gem;break;case 3:s=this.equipsData[n].tupo}if(s>0){var o=ForgeCT.ins().getForgeConfigByPos(n,s,t);e+=Math.floor(BagCT.getAttrPower(o.attr))}}return e},e.prototype.getWeaponTotalPower=function(t){var e=0,i=[];if(t>0)for(var n=GlobalConfig.WeaponSoulConfig[t],s=0;s<n.actcond.length;s++){var o=n.actcond[s],a=this.weapons.getSlotByInfo(o);if(a)for(var r=0;r<a.attr.length;r++){var l=new AttributeData;l.type=a.attr[r].type,l.value=a.attr[r].value,i.push(l)}}else{var h=this.weapons.getInfoData();for(var u in h){var p=h[u];for(var c in p){var d=p[c];if(d&&d.level)for(var r=0;r<d.attr.length;r++){var l=new AttributeData,g=d.attr[r];l.type=g.type,l.value=g.value,i.push(l)}}}}var f=this.weapons.flexibleCount?this.weapons.flexibleCount-1:0,v=GlobalConfig.WeaponSoulItemAttr[f];if(i.length&&v)for(var s=0;s<v.attr.length;s++){for(var y=!1,r=0;r<i.length;r++)if(i[r].type==v.attr[s].type){y=!0,i[r].value+=v.attr[s].value;break}if(!y){var l=new AttributeData,g=v.attr[s];l.type=g.type,l.value=g.value,i.push(l)}}return e+=Math.floor(BagCT.getAttrPower(i))},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),e.prototype.getNameWithServer2=function(){return this._servShowId&&KFServerSys.ins().isKF?this.name+("\nS"+this._servShowId):this.name},Object.defineProperty(e.prototype,"guildAndName",{get:function(){var t,e=this.getNameWithServer(),i="";BattleCC.ins().isBattle()?(i="#00FF00",t=BattleCC.ins().camp):KfArenaSys.ins().isKFArena&&(i="#0099ff",t=KfArenaSys.ins().myCampId);var n=!this.isMy&&this.camp>0&&i?this.camp!=t?"#FF0000":i:null,s=0==this.guildID||void 0==this.guildID?e:"<font color='"+(n?n:this.guildID==GuildWar.ins().getModel().winGuildInfo.guildId?"#ffb243":this.guildID==Guild.ins().guildID?"#5add70":"#2CC2F8")+"}'>"+this.guildName+"</font>\n"+this.name;if(this.lilianLv>0){var o=GlobalConfig.TrainLevelConfig[this.lilianLv];if(o.type>1){var a=ColorUtil.JUEWEI_COLOR[o.type-1]||ColorUtil.JUEWEI_COLOR[ColorUtil.JUEWEI_COLOR.length-1];s+=" <font color="+(n?n:a)+">["+o.trainName+"]</font>"}}return s},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lv",{get:function(){return this._lv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"servId",{get:function(){return this._servId},enumerable:!0,configurable:!0}),e.prototype.getEquipByIndex=function(t){return this.equipsData[t]},e.prototype.hideNeff=function(){var t=!1,e=this.getZhuangBanNG();for(var i in e){var n=GlobalConfig.ZhuangBanId[e[i]];if(n&&1==n.hideNeff){t=!0;break}}return t},e.prototype.hideWeapons=function(){var t=this.getEquipByIndex(0).item.configID,e=!1,i=this.getZhuangBanNG();for(var n in i){var s=GlobalConfig.ZhuangBanId[i[n]];if(s&&1==s.hideWeapon){e=!0;break}}return GlobalConfig.EquipConfig[t]&&GlobalConfig.EquipConfig[t].noWSoulEff>=1&&this.zhuangbei[1]<=0||e},e.prototype.getEquipLen=function(){return this.equipsData.length},e.prototype.getExRingsData=function(t){return this.exRingsData[t]},e.prototype.setExRingsData=function(t,e){this.exRingsData[t]=e},e.prototype.getSoulSuitDataByPos=function(t){return this.soulSuitData&&this.soulSuitData[t]?this.soulSuitData[t]:null},e.prototype.getPowerEquipDataByPos=function(t){return this.powerEquipItemData&&this.powerEquipItemData[t]?this.powerEquipItemData[t]:null},e.prototype.getXinmoEquipDataByPos=function(t){return this.xinmoEquipItemData&&this.xinmoEquipItemData[t]?this.xinmoEquipItemData[t]:null},e.prototype.getZhuangBanNG=function(t){void 0===t&&(t=this.zhuangbei);var e=[0,0,0];if(!t)return e;for(var i=0;3>i;i++){var n=GlobalConfig.ZhuangBanId[t[i]||0];n&&(n.otherId>0&&t.indexOf(n.otherId)>-1?e[i]=n.changeId||0:e[i]=this.zhuangbei[i])}return e},e.jobNumberToName={0:"通用",1:"战士",2:"法师",3:"道士"},e.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},e.typeNumberToName=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子","官印","面甲","护肩","披风","护符"],e.hejiPosName=["乾","巽","坎","艮","坤","震","离","兑"],e.typeEquipWingToName=["翼枢","翼爪","翎羽","彩凤"],e}(EntityModel);__reflect(Role.prototype,"Role"),window.Role=Role;var SubRoles=function(t){function e(){var e=t.call(this)||this;return e.roles=[],e.jobDic=[],e.observe(CharMonster.die,e.changeCamera),e.observe(GameLogic.ins().postHpChange,function(t){var i=t[0],n=t[1],s=t[2];i.isMy&&0==s&&n>0&&e.changeCamera()}),e.associated(function(){e.changeCamera()},GameLogic.ins().postCreateOtherEntity,EntityManager.ins().resetRole,GameLogic.ins().postRemoveEntity),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.changeCamera=function(t){if(void 0===t&&(t=e.lookAtTar),!e.lookAtTar||e.lookAtTar==t){for(var i=this.subRolesLen,n=EntityManager.ins(),s=0;i>s;s++){var o=n.getJobMainRole(s);
if(o&&o.getHP()>0&&o.visible){e.lookAtTar=o;break}}0==GameMap.fbType&&e.lookAtTar.wearTitle()}},e.prototype.doSubRole=function(t){this.roles.length=0,this.jobDic.length=0;for(var e=t.readShort(),i=this.subRolesLen,n=0;e>n;n++){var s=this.roles[n];s||(s=new Role),s.parser(t),this.roles[n]||this.roles.push(s),this.jobDic[s.job]||(this.jobDic[s.job]=s)}i&&i<this.roles.length&&TipsCT.ins().showTips("成功开启新角色")},e.prototype.doSubRoleAtt=function(t){for(var e=t.readInt(),i=0,n=this.roles.length,s=0;n>s;s++){var o=this.getSubRoleByIndex(s);o.index==e&&(o.parserAtt(t,!0),o.power=t.readDouble()),i+=o.power}Actor.ins().postPowerChange(i),GodWeaponCC.ins().gwshowTips&&(GodWeaponCC.ins().roleshowTips&&GodWeaponCC.ins().roleshowTips--,GodWeaponCC.ins().roleshowTips<=0&&(GodWeaponCC.ins().roleshowTips=0,GodWeaponCC.ins().gwshowTips=!1))},e.prototype.doSubRoleExtAtt=function(t){for(var e=!!t.readByte(),i=t.readInt(),n=this.roles.length,s=0;n>s;s++){var o=this.getSubRoleByIndex(s);o.index==i&&o.parserExtAtt(t,e)}},e.prototype.getSubRoleByIndex=function(t){return this.roles[t]},e.prototype.getSubRoleByJob=function(t){for(var e=this.roles.length,i=0;e>i;i++){var n=this.getSubRoleByIndex(i);if(n.job==t)return this.roles[i]}return null},e.prototype.updateRoleByJob=function(t,e){for(var i=this.roles.length,n=0;i>n;n++){var s=this.getSubRoleByIndex(n);s.job==t&&(this.roles[n]=e)}return null},Object.defineProperty(e.prototype,"subRolesLen",{get:function(){return this.roles.length},enumerable:!0,configurable:!0}),e.prototype.getIsMyPlayer=function(t){for(var e=0,i=this.roles;e<i.length;e++){var n=i[e];if(n.handle==t)return!0}return!1},e.prototype.isLockRole=function(){for(var t=3,e=0;t>e;e++){var i=this.getSubRoleByIndex(e);if(!i){var n=GlobalConfig.NewRoleConfig[e];if(!n)continue;if(n.zsLevel){if(ZsCT.ins().lv>=n.zsLevel)return!0}else if(Actor.level>=n.level)return!0;if(n.vip&&Actor.vip>=n.vip)return!0}}return!1},e.MAX_ROLES=3,__decorate([post()],e.prototype,"changeCamera",null),e}(BaseSystem);__reflect(SubRoles.prototype,"SubRoles"),window.SubRoles=SubRoles;var TransferModel=function(t){function e(){var e=t.call(this)||this;return e.type=EntityType.Transfer,e}return __extends(e,t),Object.defineProperty(e.prototype,"avatarFileName",{get:function(){return RES_DIR_EFF+"PortalEff"},enumerable:!0,configurable:!0}),e}(NpcModel);__reflect(TransferModel.prototype,"TransferModel"),window.TransferModel=TransferModel;var TransferNameHead=function(t){function e(){var e=t.call(this)||this;return e.skinName="Trans",e}return __extends(e,t),e.prototype.updateModel=function(t){t.index?(this.visible=!0,this.num.text=t.index+""):this.visible=!1},e}(eui.Component);__reflect(TransferNameHead.prototype,"TransferNameHead"),window.TransferNameHead=TransferNameHead;var GameMap=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.init=function(t){this.grid=this.grid||new MapGrid,this.aStar=this.aStar||new AStar,this.mapZip=t},e.moveEntity=function(t,i,n,s){void 0===s&&(s=!1);var o,a=e.CELL_SIZE,r=Math.floor(t.x/a),l=Math.floor(t.y/a),h=Math.floor(i/a),u=Math.floor(n/a);if(s)o=[new AStarNode(i,n,DirUtil.get8DirBy2Point({x:t.x,y:t.y},{x:i,y:n}))];else if(r==h&&l==u)o=[new AStarNode(h,u,DirUtil.get8DirBy2Point({x:t.x,y:t.y},{x:i,y:n}))];else if(o=this.aStar.getPatch(r,l,h,u),!o)return;GameLogic.ins().postMoveEntity(t,o,!s)},e.getPatch=function(t,e,i,n){var s=this.aStar.getPatch(t,e,i,n);return s},e.moveTo=function(t,i){var n=e.CELL_SIZE,s=Math.floor(t/n),o=Math.floor(i/n);if(SysSetting.ins().setValue("mapClickTx",s),SysSetting.ins().setValue("mapClickTy",o),!this.checkWalkable(s,o))return!1;var a=SubRoles.lookAtTar;if(!a)return!1;if(a.hasFilter(EntityFilter.hard))return TipsCT.ins().showTips("被麻痹，无法移动"),!1;if(a.action==EntityAction.DIE)return!1;var r=Math.floor(a.x/n),l=Math.floor(a.y/n),h=this.aStar.getPatch(r,l,s,o);if(!h||0==h.length)return!1;var u=h[0];return u.nX=t,u.nY=i,GameLogic.ins().sendFindPathToServer(a.infoModel.handle,h,!1),!0},e.checkWalkable=function(t,e){var i=!1,n=this.grid.getNode(t,e);return n?i=n.walkable:console.log("地图:"+this.mapID+"副本:"+this._fubenID+"坐标:"+t+","+e+"出现问题!"),i},e.checkAlpha=function(t,e){var i=!1,n=this.grid.getNode(t,e);return n?i=n.hidden:console.log("地图:"+this.mapID+"副本:"+this._fubenID+"坐标:"+t+","+e+"出现问题!"),i},e.parser=function(t){this.lastFbId=this.fubenID,this.fubenID=t.readInt(),this.mapID=t.readInt(),this.mapX=t.readShort(),this.mapY=t.readShort(),this.lastFbTyp=this.fbType,this.fbType=t.readByte(),this.fbName=t.readString(),this.fbDesc=t.readString();var i=this.getFileName(),n=this.mapZip[i];this.CELL_SIZE=n.title_wh,this.MAX_HEIGHT=n.pixHeight,this.MAX_WIDTH=n.pixWidth,this.COL=n.maxX,this.ROW=n.maxY,this.grid.initMapInfo(n,e.getTurn()),this.aStar.initFromMap(this.grid),this.SafetyZone={};for(var s=GlobalConfig.ScenesConfig[this.mapID],o=0;s.area&&o<s.area.length;o++)for(var a=s.area[o],r=a.attr,l=0;l<r.length;l++)switch(r[l].type){case 0:this.safetyCalculate(a)}},e.safetyCalculate=function(t){for(var i=t.grids,n=Number.MAX_VALUE,s=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MIN_VALUE,r=!1,l=0;l<i.length;l++){for(var h=i[l],u=l+1==i.length?i[0]:i[l+1],p=BresenhamLine.tileLine(h.x,h.y,u.x,u.y),c=0;c<p.length;c+=2){var d=p[c],g=p[c+1];this.SafetyZone[g*e.CELL_SIZE+d]={x:d,y:g},r=!0}n=Math.min(h.x,n),o=Math.max(h.x,o),s=Math.min(h.y,s),a=Math.max(h.y,a)}if(r)for(var l=s;a>=l;l++){for(var f=void 0,v=void 0,y=n;o>=y;y++)if(this.SafetyZone[l*e.CELL_SIZE+y]){f=y;break}for(var y=o;y>=n;y--)if(this.SafetyZone[l*e.CELL_SIZE+y]){v=y;break}if(!isNaN(f)&&!isNaN(v))for(var y=f+1;v>=y;y++)this.SafetyZone[l*e.CELL_SIZE+y]={x:l,y:y}}},e.checkSafety=function(t){return!!this.SafetyZone[t.y*e.CELL_SIZE+t.x]},Object.defineProperty(e,"fubenID",{get:function(){return this._fubenID},set:function(t){this._fubenID=t,t>0&&GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK)},enumerable:!0,configurable:!0}),e.sceneInMain=function(){return 0==e.fbType&&0==e.fubenID},e.sceneInMine=function(){return 0==e.fbType&&0!=e.fubenID},e.canStartAI=function(){return 0==e.fbType},e.getFileName=function(){var t=GlobalConfig.ScenesConfig[this.mapID];return t?t.mapfilename:""},e.getTurn=function(){return GlobalConfig.ScenesConfig[this.mapID].turn},e.autoPunch=function(){return 1==GlobalConfig.ScenesConfig[this.mapID].autoPunch},e.getRectangle=function(t,i,n){var s=t.x+(i-.5)*e.CELL_SIZE,o=t.y+(n-.5)*e.CELL_SIZE;return new egret.Rectangle(s,o,e.CELL_SIZE,e.CELL_SIZE)},e.getIncludeElement=function(t,i,n){var s=[];for(var o in i){var a=e.getRectangle(t,i[o].x,i[o].y);for(var r in n){var l=n[r];l.x>=a.x&&l.y>=a.y&&l.x<a.x+a.width&&l.y<a.y+a.height&&s.push(l)}}return s},e.getPoint=function(t,e,i){var n=Math.floor(t/e)-Math.floor(i/2),s=Math.floor(t%e)-Math.floor(e/2);return new egret.Point(s,n)},e.getTargetIndex=function(t,i,n,s){var o=i.x-t.x+e.CELL_SIZE*(n/2),a=i.y-t.y+e.CELL_SIZE*(s/2),r=Math.floor(o/e.CELL_SIZE),l=Math.floor(a/e.CELL_SIZE);return n*l+r},e.checkWalkableByPixel=function(t,i){var n=Math.floor(t/e.CELL_SIZE),s=Math.floor(i/e.CELL_SIZE);return e.checkWalkable(n,s)},e.getPosRange=function(t,i,n){var s=MathUtils.limitInteger(-n,+n),o=MathUtils.limitInteger(-n,+n);+s!=+n&&(o=Math.random()<.5?-n:n);for(var a=0,r=s,l=o;;){var h=e.checkWalkable(t+r,i+l);if(h)return[t+r,i+l];if(r==n&&n>l?l+=1:l==n&&r>-n?r-=1:r==-n&&l>-n?l-=1:l==-n&&n>r&&(r+=1),r==s&&l==o&&(s==n&&(r=s=n+1),s==-n&&(r=s=-n-1),o==n&&(l=o=n+1),o==-n&&(l=o=-n-1),n+=1),a+=1,a>100)break}return[t,i]},e.getPosRangeByDir=function(t,i,n,s){var o=t,a=i;return(n>=0&&1>=n||7==n)&&(a-=s),n>=3&&5>=n&&(a+=s),n>=1&&3>=n&&(o+=s),n>=5&&7>=n&&(o-=s),[o,a,e.checkWalkable(o,a)]},e.getPosRangeRandom=function(t,i,n,s){void 0===s&&(s=1);var o=e.point2Grip(t),a=e.point2Grip(i),r=[n],l=Math.random();l>.66?(n=0>n-1?7:n-1,r.unshift(n),l>.8?r.push((n+2)%8):r.splice(1,0,(n+2)%8)):l>.33&&(n=n+1>7?0:n+1,r.unshift(n),l>.5?r.push((n-2+8)%8):r.splice(1,0,(n-2+8)%8));for(var h,u=!1,p=0;p<r.length;p++)if(h=e.getPosRangeByDir(o,a,r[p],s),h[2]){u=!0;break}return u||(h=e.getPosRange(o,a,s)),h},e.point2Grip=function(t){return Math.floor(t/e.CELL_SIZE)},e.grip2Point=function(t){return t*e.CELL_SIZE+(e.CELL_SIZE>>1)},e.fbType=0,e.lastFbTyp=0,e.lastFbId=0,e}(BaseClass);__reflect(GameMap.prototype,"GameMap"),window.GameMap=GameMap;var MapView=function(t){function e(){var i=t.call(this)||this;return i.touchEnabled=!0,i.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGridClick,e),i}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(GameLogic.ins().moveCamera,this.syncPos,!0),this.observe(SubRoles.ins().changeCamera,this.syncPos),this.observe(GameLogic.ins().postAdjustMapPos,this.adjustMapPos)},e.prototype.syncPos=function(){if(SubRoles.lookAtTar){var t=SubRoles.lookAtTar,e=t.x,i=t.y;this.lookAt(e,i),this._mapImage.updateHDMap(this)}},e.prototype.initMap=function(){var t=this;this._mapImage=new MapViewBg,this.addChild(this._mapImage),this._dropLayer=new egret.DisplayObjectContainer,this.addChild(this._dropLayer),this._effBottomLayer=new egret.DisplayObjectContainer,this.addChild(this._effBottomLayer),this._entityLayer=new egret.DisplayObjectContainer,this.addChild(this._entityLayer),this._dropNameLayer=new egret.DisplayObjectContainer,this.addChild(this._dropNameLayer),this._effTopLayer=new egret.DisplayObjectContainer,this.addChild(this._effTopLayer),this._bloodLayer=new BloodView,this.addChild(this._bloodLayer),SkillEffPlayer.bottomLayer=this._effBottomLayer,SkillEffPlayer.topLayer=this._effTopLayer,SkillEffPlayer.setTimeout=function(t,e,i){Timer.start(t,1,e,i)},SkillEffPlayer.shake=function(e,i,n,s,o){o=o||1,e==EntityManager.ins().getMainRole(0)&&Math.random()<o&&DisplayUtils.shakeIt(t._mapImage,i,n,s)},DropHelp.init(this._dropLayer,this._dropNameLayer)},e.prototype.addEntity=function(t){this._entityLayer.addChild(t),this._entityLayer.sortableChildren=!0},e.onGridClick=function(t){return{target:t.target,x:t.stageX-t.currentTarget.x,y:t.stageY-t.currentTarget.y}},e.prototype.lookAt=function(t,e){var i=StageUtils.ins().getWidth(),n=StageUtils.ins().getHeight();this.x=this.minValue(t*this.scaleX,i,GameMap.MAX_WIDTH),this.y=this.minValue(e*this.scaleY,n,GameMap.MAX_HEIGHT,60)},e.prototype.minValue=function(t,e,i,n){return void 0===n&&(n=0),-Math.min(Math.max(t-n-(e>>1),0),i-e)},e.prototype.changeMap=function(){e.DRAW_GRID?this.drawGrid():this._shapeContainer&&this._shapeContainer.parent&&this.removeChild(this._shapeContainer),egret.Tween.removeTweens(this);for(var t=GlobalConfig.ScenesConfig[GameMap.mapID],i=0;t.effPos&&i<t.effPos.length;i++)for(var n=t.effPos[i],s=n.pos.length,o=0;s>o;o++){var a=n.pos[o],r=ObjectPool.pop("MovieClip");r.playFile(RES_DIR_EFF+n.eff,-1),r.x=a.x,r.y=a.y,this._effBottomLayer.addChild(r)}this.createNpc(),this.lookAt(GameMap.mapX,GameMap.mapY)},e.prototype.adjustMapPos=function(){this.x=this.x>>0,this.y=this.y>>0},e.prototype.createNpc=function(){var t=GlobalConfig.ScenesConfig[GameMap.mapID];if(t.npc)for(var e=0;e<t.npc.length;e++){var i=new NpcModel;i.configID=t.npc[e].id,i.x=t.npc[e].x*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),i.y=t.npc[e].y*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),i.dir=t.npc[e].d,GameLogic.ins().createEntityByModel(i)}},e.prototype.drawGrid=function(){var t=this._shape||new egret.Shape;this._shapeContainer=this._shapeContainer||new egret.DisplayObjectContainer,this._shapeContainer.cacheAsBitmap=!0,this._shapeContainer.touchEnabled=!1,this._shapeContainer.touchChildren=!1,t.graphics.clear(),t.graphics.lineStyle(.1);for(var e=GameMap.COL,i=GameMap.ROW,n=0;e>n;n++)for(var s=0;i>s;s++){GameMap.checkAlpha(n,s)?t.graphics.beginFill(3532333,.3):GameMap.checkWalkable(n,s)?t.graphics.beginFill(13421772,.3):t.graphics.beginFill(15937822,.3),t.graphics.drawRect(n*GameMap.CELL_SIZE,s*GameMap.CELL_SIZE,GameMap.CELL_SIZE,GameMap.CELL_SIZE),t.graphics.endFill();var o=new eui.Label;o.size=12,o.text=n+","+s,o.x=n*GameMap.CELL_SIZE,o.y=s*GameMap.CELL_SIZE,this._shapeContainer.addChild(o)}this._shapeContainer.addChild(t),this.addChild(this._shapeContainer),this._shape=t},e.prototype.clearAllLayer=function(){this._effBottomLayer.removeChildren(),this._effTopLayer.removeChildren(),this._bloodLayer.removeChildren(),this._entityLayer.removeChildren()},e.DRAW_GRID=!1,__decorate([post()],e,"onGridClick",null),e}(BaseView);__reflect(MapView.prototype,"MapView");var MapViewBg=function(t){function e(){var e=t.call(this)||this;return e.thumbnail=new eui.Image,e._shape=new egret.Shape,e._imageList={},e._poolImages=[],e.turn=0,e.turnOff=0,e._fileDic={},e.imgSize=1024,e.touchChildren=!1,e.touchEnabled=!1,e.shape=[],e.addChild(e.thumbnail),e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(GameLogic.ins().postEnterMap,this.update,!0),this.sw=StageUtils.ins().getWidth(),this.sh=StageUtils.ins().getHeight()},e.prototype.update=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,s;return __generator(this,function(o){switch(o.label){case 0:return(t=GameMap.getFileName())?(e=GameMap.getTurn(),this.mapName==t&&this.turn==e?[2]:(this.mapName!=t&&this.destroyFile(),this.mapName=t,this.turn=e,this.clearHDMap(),i=GameMap.MAX_WIDTH,n=GameMap.MAX_HEIGHT,this.thumbnail.width=i,this.thumbnail.height=n,this.maxImagX=Math.floor(i/this.imgSize),this.maxImagY=Math.floor(n/this.imgSize),i%this.imgSize==0&&this.maxImagX--,n%this.imgSize==0&&this.maxImagY--,this.turnOff=this.turn&&i%this.imgSize?this.imgSize-i%this.imgSize:0,s=this.thumbnail,[4,RES.getResByUrl(""+MAP_DIR+this.mapName+"/small.jpg")])):[2];case 1:return s.source=o.sent(),t!=this.mapName?[2]:(this.thumbnail.scaleX=e?-1:1,this.thumbnail.x=e?i:0,this.updateHDMap(this.parent,!0),[2])}})})},e.prototype.clearHDMap=function(){for(var t in this._imageList)this._poolImages.push(this._imageList[t]);this._imageList={}},e.prototype.destroyFile=function(){for(var t in this._fileDic)RES.destroyRes(t);this._fileDic={}},e.prototype.getImage=function(){return this._poolImages.pop()||new eui.Image},e.prototype.HDMap=function(){for(var t=0;t<=this.maxImagX;t++)for(var e=this.turn?this.maxImagX-t:t,i=0;i<=this.maxImagY;i++){var n=this._imageList[""+t+i];if(t<this.imgX||t>this.imgXCount||i<this.imgY||i>this.imgYCount)n&&(delete this._imageList[""+t+i],this._poolImages.push(n),DisplayUtils.removeFromParent(n));else{var s=""+MAP_DIR+this.mapName+"/image/"+i+"_"+e+".jpg";n||(n=this.getImage(),this._imageList[""+t+i]=n),n.anchorOffsetX=-this.turnOff,this.turn?(n.x=(t+1)*this.imgSize,n.scaleX=-1):(n.scaleX=1,n.x=t*this.imgSize),n.y=i*this.imgSize,n.source=s,n.name=s,this._fileDic[s]=1,n.parent||this.addChild(n)}}},e.prototype.updateHDMap=function(t,e){void 0===e&&(e=!1);var i=1024,n=Math.floor((-t.x+this.turnOff)/i),s=Math.floor(-t.y/i),o=Math.floor((-t.x+this.sw+this.turnOff)/i),a=Math.floor((-t.y+this.sh)/i);(this.imgX!=n||this.imgY!=s||this.imgXCount!=o||this.imgYCount!=a||e)&&(this.imgX=n,this.imgY=s,this.imgXCount=o,this.imgYCount=a,this.HDMap())},e.prototype.drawGrid=function(t,e){this.clearDrawGrid(),this.shapeContainer=this.shapeContainer||new egret.DisplayObjectContainer,this.shapeContainer.cacheAsBitmap=!0,this.shapeContainer.touchEnabled=!1,this.shapeContainer.touchChildren=!1;for(var i=t.x;i<e.x;i++)for(var n=t.y;n<e.y;n++){var s=i*e.x+n,o=this.shape[s];o||(o=this.shape[s]=new egret.Shape),o.graphics.lineStyle(1,16777215),GameMap.checkAlpha(i,n)?o.graphics.beginFill(255,.8):GameMap.checkWalkable(i,n)?o.graphics.beginFill(65280,.8):o.graphics.beginFill(16711680,.8),o.graphics.drawRect(0,0,GameMap.CELL_SIZE,GameMap.CELL_SIZE),o.graphics.endFill(),o.x=i*GameMap.CELL_SIZE,o.y=n*GameMap.CELL_SIZE;var a=new eui.Label;a.size=12,a.text=i+","+n,a.x=i*GameMap.CELL_SIZE,a.y=n*GameMap.CELL_SIZE,a.name="label"+i+","+n,this.shapeContainer.addChild(a),this.shapeContainer.addChild(o)}this.addChild(this.shapeContainer)},e.prototype.clearDrawGrid=function(){if(this.shapeContainer&&this.shape){for(;this.shapeContainer.numChildren>0;)this.shapeContainer.removeChildAt(0);this.shape.length=0}},e}(BaseView);__reflect(MapViewBg.prototype,"MapViewBg");var GameGuider=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.taskGuidance=function(t,e){var i;switch(e){case 0:i=GlobalConfig.DailyConfig[t];break;case 1:i=TaskCT.ins().getAchieveConfById(t),Hint.ins().postAchievementBef(i)}if(i){switch(i.control){case GuideType.OpenWin:var n=i.controlTarget[0];(l=ViewManager.ins()).open.apply(l,[n].concat(i.controlTarget.slice(1)));break;case GuideType.ChallengeBoss:if(FbCT.ins().guanqiaID<GlobalConfig.InstanceBaseConfig.maxCheckPoint){if(this.challengeBoss(),1==e){var s=i;Hint.ins().postKillBoss(s)}}else TipsCT.ins().showCenterTips("当前已达最大关卡");break;case GuideType.ArtifactGuide:Artifact.ins().setGuide();break;case GuideType.AtkMonster:RoleAI.ins().stop();var o=i.controlTarget[0],a=FbCT.ins().rPos[o][0].x*GameMap.CELL_SIZE,r=FbCT.ins().rPos[o][0].y*GameMap.CELL_SIZE;this.tempMainRole=SubRoles.lookAtTar,GameMap.moveEntity(this.tempMainRole,a,r),Timer.start(500,0,this.guideFun,this.ins());break;case GuideType.AutoPk:FbCT.ins().setAutoPk();break;case GuideType.KillDeer:break;case GuideType.GuideFb:if(Encounter.ins().isEncounter())return void TipsCT.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);FbCT.ins().sendIntoGuideFb(i.controlTarget[1])}var l}},e.guideFun=function(){this.tempMainRole.action==EntityAction.STAND&&(RoleAI.ins().start(),Timer.stop(this.guideFun,this.ins()))},e.guidance=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=-1!=t[1]?t[1]:null;ViewManager.ins().open(t[0],i,t[2],t[3])},e.challengeBoss=function(t){return BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void(FbCT.ins().currentEnergy>=FbCT.ins().energy&&(t&&"function"==typeof t&&t(),FbCT.ins().autoPk()))},e.startTaskEffect=function(){urlParam.noGuide||(this.taskEffect||(this.taskEffect=new TaskEffectView),this.taskEffect.start())},e.stopTaskEffect=function(){urlParam.noGuide||this.taskEffect&&this.taskEffect.stop()},e}(BaseClass);__reflect(GameGuider.prototype,"GameGuider"),window.GameGuider=GameGuider;var GuideType;!function(t){t[t.OpenWin=1]="OpenWin",t[t.ChallengeBoss=2]="ChallengeBoss",t[t.ArtifactGuide=3]="ArtifactGuide",t[t.AtkMonster=4]="AtkMonster",t[t.AutoPk=5]="AutoPk",t[t.KillDeer=6]="KillDeer",t[t.GuideFb=7]="GuideFb"}(GuideType||(GuideType={})),window.GuideType=GuideType;var OtherCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.LianJi,e.regNetMsg(19,e.postYBCardTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendPFVipInfo=function(){var t=this.getBytes(13);t.writeInt(+urlParam.appid),t.writeByte(Actor.myPFVipInfo.pfVip),t.writeByte(Actor.myPFVipInfo.pfVipSuper),t.writeByte(Actor.myPFVipInfo.pfVipYear),t.writeShort(Actor.myPFVipInfo.pfLv),this.sendToServer(t)},e.prototype.postYBCardTime=function(t){if(t){this.doubleYBCardTime=DateUtils.formatMiniDateTime(t.readUnsignedInt());var i=Math.max(0,this.doubleYBCardTime-GameServer.serverTime);i>0&&Timer.start(i,1,function(){e.ins().postYBCardTime(null)},this)}},Object.defineProperty(e.prototype,"hasDouble",{get:function(){return this.doubleYBCardTime>0&&this.doubleYBCardTime>GameServer.serverTime},enumerable:!0,configurable:!0}),__decorate([post()],e.prototype,"postYBCardTime",null),e}(BaseSystem);__reflect(OtherCT.prototype,"OtherCT"),System.OtherCT=function(){return OtherCT.ins()},window.OtherCT=OtherCT;var Activationtongyong=function(t){function e(){var e=t.call(this)||this;return e.skinName="activationtongyong",e.isTopLevel=!0,e.bgClose.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.okBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.onTap=function(t){switch(t.currentTarget){case this.okBtn:case this.bgClose:ViewManager.ins().close(e)}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2],o=t[3];this.closeFunc=t[4];var a=t[5],r=t[6],l=t[7]||0;this.title.source=i?"tongyongjihuochenggongp3":"tongyongjihuochenggongp2";var h=RegExpUtil.NonNumericExp.exec(n);if(h){for(var u="",p="",c=0;c<n.length;c++)c>=h.index?p+=n[c]:u+=n[c];var d="";d=Number(u)/10>=1?u+"\n":" "+u+"\n",this.itemname.text=d+p.split("").join("\n")}else this.itemname.text=n.split("").join("\n");this.img.source=s,0!=l?(this.actEffMC||(this.actEffMC=new MovieClip),this.actEffMC.parent||this.eActEff.addChild(this.actEffMC),this.actEffMC.playFile(RES_DIR_EFF+a,-1)):a?(this.imgEff||(this.imgEff=new MovieClip),this.imgEff.parent||this.imgMc.addChild(this.imgEff),this.imgEff.playFile(RES_DIR_EFF+a,-1)):r&&(this.zlEff||(this.zlEff=new MovieClip),this.zlEff.parent||this.zlMc.addChild(this.zlEff),this.zlEff.playFile(RES_DIR_EFF+r,-1)),this.playAnimaiton(o)},e.prototype.close=function(){egret.Tween.removeTweens(this.title),egret.Tween.removeTweens(this.titleBg),egret.Tween.removeTweens(this.img),egret.Tween.removeTweens(this.imgMc),egret.Tween.removeTweens(this.zlMc),egret.Tween.removeTweens(this.tielian),egret.Tween.removeTweens(this.imgAct),this.closeFunc&&this.closeFunc.apply(null),this.closeFunc=null,DisplayUtils.removeFromParent(this.zlEff),DisplayUtils.removeFromParent(this.imgEff),DisplayUtils.removeFromParent(this.mc),this.zlEff=null,this.imgEff=null,this.mc=null},e.prototype.playAnimaiton=function(t){var e=this,i=this.tlpos=this.tlpos||[this.tielian.x,this.tielian.y],n=this.lbgpos=this.lbgpos||[this.lbg.x,this.lbg.y],s=this.rbgpos=this.rbgpos||[this.rbg.x,this.rbg.y],o=this.titleScale=this.titleScale||[this.title.scaleX,this.title.scaleY],a=this.tbgScale=this.tbgScale||[this.titleBg.scaleX,this.titleBg.scaleY],r=this.imgScale=this.imgScale||[this.img.scaleX,this.img.scaleY],l=[0,0];this.imgEff?l=this.imgMcScale=this.imgMcScale||[this.imgMc.scaleX,this.imgMc.scaleY]:this.zlEff&&(l=this.imgMcScale=this.imgMcScale||[this.zlMc.scaleX,this.zlMc.scaleY]),this.bg.visible=!1,this.itemname.visible=!1,this.leftBg.visible=!1,this.buttonBg.visible=!1,this.title.scaleX=0,this.title.scaleY=0,this.titleBg.scaleX=0,this.titleBg.scaleY=0,this.img.scaleX=0,this.img.scaleY=0,this.imgMc.scaleX=0,this.imgMc.scaleY=0,this.tielian.y=2*-this.tielian.height;var h=1,u=egret.Tween.get(this.tielian);u.to({y:i[1]+50},200*h).to({y:i[1]},100*h).call(function(){e.bg.visible=!0;var i=egret.Tween.get(e.title),n=egret.Tween.get(e.titleBg),s=egret.Tween.get(e.img),u=egret.Tween.get(e.imgMc);i.to({scaleX:o[0],scaleY:o[1]},500*h),n.to({scaleX:a[0],scaleY:a[1]},500*h),u.to({scaleX:l[0],scaleY:l[1]},500*h),s.to({scaleX:r[0],scaleY:r[1]},500*h).wait(500).call(function(){e.itemname.visible=!0,e.leftBg.visible=!0,e.buttonBg.visible=!0,e.showPanel(t),e.artifactTween()})}),this.lbg.y=-this.tielian.height,this.rbg.y=-this.tielian.height;var p=egret.Tween.get(this.lbg);p.to({y:n[1]+50},200*h).to({y:n[1]},100*h);var c=egret.Tween.get(this.rbg);c.to({y:s[1]+50},200*h).to({y:s[1]},100*h)},e.prototype.showPanel=function(t){t&&(this.mc=new MovieClip,this.mc.anchorOffsetX=this.Groupeff.anchorOffsetX,this.mc.anchorOffsetY=this.Groupeff.anchorOffsetY,this.Groupeff.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"Projection",-1))},e.prototype.artifactTween=function(){var t=egret.Tween.get(this.imgAct,{loop:!0});t.to({y:this.imgAct.y-20},1e3).to({y:this.imgAct.y},1e3)},e.show=function(t,i,n,s,o,a,r,l){void 0===s&&(s=!0),void 0===o&&(o=null),void 0===l&&(l=0),ViewManager.ins().open(e,t,i,n,s,o,a,r,l),StageUtils.ins().setTouchChildren(!0)},e}(BaseEuiView);__reflect(Activationtongyong.prototype,"Activationtongyong"),window.Activationtongyong=Activationtongyong,ViewManager.ins().reg(Activationtongyong,LayerManager.UI_Main);var Activity=function(t){function e(){var e=t.call(this)||this;return e.activityData={},e.palyEffList=[],e.rankInfoList=[],e.indexCurrDabiao=0,e.nextDayState=0,e.activityId=0,e.hongbaoId=0,e.isSuccee=!1,e.sysId=PackageID.Activity,e.regNetMsg(1,e.doActivityData),e.regNetMsg(2,e.postRewardResult),e.regNetMsg(3,e.doDaBiaoInfo),e.regNetMsg(4,e.isGetAwards),e.regNetMsg(5,e.doRewardStatu),e.regNetMsg(7,e.postChangePage),e.regNetMsg(9,e.postLuckyNumber),e.regNetMsg(10,e.postDownHongBao),e.regNetMsg(11,e.doSevenDayData),e.regNetMsg(12,e.doChangeSevenDayData),e.regNetMsg(21,e.doNextDayLoginData),e.regNetMsg(20,e.doNextDayLoginReward),e.regNetMsg(22,e.postKuaFuRank),e.regNetMsg(6,e.postEnvelopeData),e.regNetMsg(8,e.postRedEnvelopeData),e.regNetMsg(23,e.postActivityAwardLogs),e.regNetMsg(24,e.postActivityBossInfo),e.regNetMsg(32,e.postRewardResult1),e.regNetMsg(33,e.postAddTips),e.regNetMsg(34,e.postAddTips52),e.observe(e.postDownHongBao,e.openHongbaoWin),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.openHongbaoWin=function(){Actor.level>=30&&ViewManager.ins().open(HongBaoWin)},e.prototype.initZero=function(){if(this.activityData)for(var t in this.activityData){var e=+t;if(1e4>e){var i=GlobalConfig.ActivityConfig[t];i&&this.sendChangePage(e)}}},e.prototype.getActivityDataById=function(t){return this.activityData[t]},e.prototype.getPalyEffListById=function(t){return this.palyEffList[t]},e.prototype.setPalyEffListById=function(t,e){this.palyEffList[t]=e},e.prototype.getrankInfoListByIndex=function(t){return this.rankInfoList[t]},e.prototype.doActivityData=function(t){this.activityData={};for(var e=t.readShort(),i=0;e>i;i++){var n=ActivityDataFactory.create(t);n&&(this.activityData[n.id]=n)}this.postActivityIsGetAwards(),ActivityDataFactory.createEx(),this.checkActivityTimer()},e.prototype.postActivityIsGetAwards=function(){},e.prototype.postRewardResult=function(t){this.isSuccee=t.readBoolean();var e=t.readInt(),i=this.getActivityDataById(e);return i&&i instanceof ActivityType26Data?i.postRewardResult(t):i&&i instanceof ActivityType36Data?i.postRewardResult(t):i&&i instanceof ActivityType38Data?i.postHongBaoData(t):i&&i instanceof ActivityType39Data?i.postRewardResult(t):i&&i instanceof ActivityType40Data?i.postRewardResult(t):i.postRewardResult?i.postRewardResult(t):this.getActivityDataById(e).update(t),this.postActivityPanel(e),this.postActivityIsGetAwards(),e},e.prototype.postRewardResult1=function(t){var e=t.readInt(),i=this.getActivityDataById(e);return i&&i instanceof ActivityType45Data&&i.postRewardResult1(t),this.postActivityPanel(e),this.postActivityIsGetAwards(),e},e.prototype.postAddTips=function(t){var e=t.readInt(),i=this.getActivityDataById(e);return i&&i instanceof ActivityType51Data?i.addTips(t):!1},e.prototype.postAddTips52=function(t){var e=t.readInt(),i=this.getActivityDataById(e);i&&i instanceof ActivityType52Data&&i.addTips2(t)},e.prototype.postActivityPanel=function(t){return t},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postHuntResultPlayFunc=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postHuntResultFunc=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendReward=function(t,e,i,n){var s=this.getBytes(2),o=GlobalConfig.ActivityConfig[t];if(o&&o.activityType==ActivityDataType._9)e?(s.writeInt(t),s.writeShort(e)):(s.writeInt(t),s.writeShort(e),s.writeByte(i));else if(!o||o.activityType!=ActivityDataType._11&&o.activityType!=ActivityDataType._23)if(o&&o.activityType==ActivityDataType._22)s.writeInt(t),s.writeShort(e),s.writeShort(i),s.writeInt(n);else if(o&&o.activityType==ActivityDataType._12)i==EnvelopeType.SEND?(s.writeInt(t),s.writeShort(e),s.writeShort(i),n&&s.writeString(n)):i==EnvelopeType.GET&&(s.writeInt(t),s.writeUnsignedShort(e),s.writeShort(i));else if(o&&o.activityType==ActivityDataType._2){s.writeInt(t),s.writeShort(e);var a=i?i:0;s.writeShort(a)}else o&&o.activityType==ActivityDataType._14?s.writeInt(t):o&&o.activityType==ActivityDataType._24?(s.writeInt(t),s.writeShort(e),s.writeShort(i),s.writeInt(n)):(s.writeInt(t),s.writeShort(e),s.writeShort(i),s.writeInt(n));else s.writeInt(t),s.writeShort(e),s.writeShort(i);this.sendToServer(s)},e.prototype.sendLianxuReward=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.sendRewardStatu=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.doRewardStatu=function(t){var e=t.readInt(),i=this.getActivityDataById(e);i?i.updateData(t):(i=new ActivityType5Data(null),this.activityData[e]=i,i.updateData(t)),this.postActivityIsGetAwards()},e.prototype.postChangePage=function(t){var e=ActivityDataFactory.create(t);return e&&(this.activityData[e.id]=e),this.postActivityIsGetAwards(),e?e.id:0},e.prototype.sendChangePage=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.doDaBiaoInfo=function(t){this.dabiaoDecode(t),this.postGetDaBiaoInfo()},e.prototype.postGetDaBiaoInfo=function(){},e.prototype.postLuckyNumber=function(t){var e=t.readUnsignedShort(),i=t.readUnsignedByte(),n=[];if(0==i)return void TipsCT.ins().showTips("没有上期数字");for(var s=0;i>s;s++)n.push(t.readUnsignedShort());var o=this.getActivityDataById(e);o&&o instanceof ActivityType29Data&&(o.luckNums=n)},e.prototype.sendLuckyNumber=function(t){var e=this.getBytes(9);e.writeShort(t),this.sendToServer(e)},e.prototype.postDownHongBao=function(t){this.activityId=t.readInt(),this.hongbaoId=t.readShort()},e.prototype.sendGetHongBao=function(t,e){var i=this.getBytes(2);i.writeInt(e),i.writeShort(1),i.writeShort(t),i.writeInt(t),this.sendToServer(i)},e.prototype.doNextDayLoginData=function(t){this.nextDayState=t.readShort()},e.prototype.doNextDayLoginReward=function(t){var e=t.readShort();e&&(this.nextDayState=2,TipsCT.ins().showTips(StringUtils.addColor("领取奖励成功",15937822)))},e.prototype.sendNextDayReward=function(){var t=this.getBytes(20);this.sendToServer(t)},e.prototype.sendMapToFriend=function(t,e){var i=this.getBytes(23);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendDabiaoInfo=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetDabiaoReward=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.isGetAwards=function(t){this.isGetAward=t.readBoolean()},e.prototype.sendGetSevenDayAwards=function(t){var e=this.getBytes(12);e.writeShort(t),this.sendToServer(e)},e.prototype.doSevenDayData=function(t){this.dayNum=t.readShort(),this.isAwards=t.readInt(),this.postSevendayIsAwards()},e.prototype.doChangeSevenDayData=function(t){var e=t.readBoolean();if(e){t.readShort();this.isAwards=t.readInt(),this.postSevendayAwardCallback()}else TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");this.postSevendayIsAwards()},e.prototype.postSevendayAwardCallback=function(){},e.prototype.postSevendayIsAwards=function(){},e.prototype.postNextDayInfo=function(){},e.prototype.getSevenDayStast=function(){var t;t=this.dayNum>14?14:this.dayNum;for(var e=1;t>=e;e++){var i=GlobalConfig.LoginRewardsConfig[e];if(i&&this.dayNum>=i.day&&0==(this.isAwards>>i.day&1))return!0}return!1},e.prototype.checkNoticeRed=function(){var t=GlobalConfig.WelfareConfig[2],e=this.getActivityDataById(t.activityId?t.activityId:0);return e&&e.canReward()},e.prototype.getSevenDayLogIsVisible=function(){return 0==(this.isAwards>>14&1)},e.prototype.getbtnInfo=function(t){var e=GlobalConfig.ActivityBtnConfig;return e[t]?e[t]:null},e.prototype.isShowRedPointByBtnInfo=function(t){return this.checkAcCanGet(t.id+"")},e.prototype.checkAcCanGet=function(t){var e=this.activityData;for(var i in e)if(i==t&&e[i].isOpenActivity()&&e[i].canReward()&&e[i].specialState())return!0;return!1},e.prototype.checkOtherCharge2CanGet=function(){var t=Recharge.ins().getRechargeData(1),e=GlobalConfig.ChongZhi2Config[t.day/7>=1?2:1][t.day%7];for(var i in e)if(0==(t.isAwards>>e[i].index&1)&&t.num>=e[i].pay)return!0;return!1},e.prototype.dabiaoDecode=function(t){this.isDaBiao=t.readBoolean(),this.indexCurrDabiao=Math.max(t.readInt()-1,0);var e=t.readShort();if(e==RankDataType.TYPE_LEVEL)t.readInt(),t.readInt();
else if(e==RankDataType.TYPE_BAOSHI)this.myDabiaoInfo=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),n=t.readInt();this.myDabiaoInfo=[i,n]}else e==RankDataType.TYPE_LONGHUN?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_XIAOFEI?this.myDabiaoInfo=t.readInt():e==RankDataType.TYPE_HF_XIAOFEI?(this.myDabiaoInfo=t.readInt(),this.myPaiming=t.readInt()):this.myDabiaoInfo=t.readDouble();var s,o=t.readShort();this.rankInfoList=[];for(var a=0;o>a;a++)this.rankInfoList[a]||this.rankInfoList.push(new DabiaoData),s=this.rankInfoList[a],s.prase(t,e)},e.prototype.getisCangetDabiao3=function(t){var e=this.getActivityDataById(t);return e.canOnlyReward?(e.canOnlyReward(),e.btn1||e.btn2):this.checkAcCanGet(t+"")},e.prototype.getisCanBuyXianGou=function(t){var e=!1,i=GlobalConfig.ActivityType2Config[t];if(i)for(var n=0;n<i.length&&!(e=this.getisCanBuyXianGouItem(t,n));n++);return e},e.prototype.getisCanBuyXianGouItem=function(t,e){var i=!1,n=this.activityData[t],s=GlobalConfig.ActivityType2Config[t];if(n&&s){var o=s[e],a=n.buyData[e]||0;if(o&&a){var r=1==o.currencyType?Actor.gold:Actor.yb,l=1==o.currencyType,h=parseInt(r+"")>=o.price,u=o.count-a>0;i=l&&h&&u}}return i},e.prototype.IsHefuXunBaoTimer=function(){if(!GameServer._serverHeZeroTime)return!1;var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),e=t+24*GlobalConfig.TreasureHuntConfig.hefuDay*60*60*1e3,i=GameServer.serverTime;return i>=t&&e>=i},e.prototype.IsBossScoreTitle=function(t,e){var i=GlobalConfig.ActivityType7Config[t],n=this.getActivityDataById(t);for(var s in i){var o=i[s];if(o.title==e&&this.getIsBuy(o)&&n.bossScore>=o.score)return!0}return!1},e.prototype.getIsBuy=function(t){if(t){var e=this.getActivityDataById(t.Id);return t.count&&e.personalRewardsSum[t.index]>=t.count?!1:!(t.scount&&e.worldRewardsSum[t.index]>=t.scount)}return!1},e.prototype.getType7RedPoint=function(t){var i,n=GlobalConfig.ActivityType7Config[t],s=this.getActivityDataById(t);if(n[1].showType==ActivityType7Data.TYPE_LABA)for(var o in n){var a=s.getExchange(n[o].index);if(a==e.CanGet)return!0}else for(var o in n)if(this.getIsBuy(n[o]))if(n[o].itemId){if(i=BagCT.ins().getBagItemById(n[o].itemId),i&&i.count>=n[o].itemCount)return!0}else if(s.bossScore>=n[o].score)return!0;return!1},e.prototype.getCurrentRingAwardIndex=function(t){var e=1;if(t>0)for(;0!=(t>>e&1);)e++;return e},e.prototype.getRingAward=function(t){for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var n in GlobalConfig.ActivityType8Config[e])if(n==t.toString())return GlobalConfig.ActivityType8Config[e][n]}return null},e.prototype.getLastRingAward=function(){var t;for(var e in GlobalConfig.ActivityType8Config){var i=GlobalConfig.ActivityType8Config[e][1];if(i.showType==ActivityType8Data.TYPE_RING)for(var n in GlobalConfig.ActivityType8Config[e])t=GlobalConfig.ActivityType8Config[e][n]}return t},e.prototype.addEvent=function(){MessageCenter.addListener(GameLogic.ins().postEnterMap,this.openRingActivity,this)},e.prototype.removeEvent=function(){MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this)},e.prototype.openRingActivity=function(){0==GameMap.fbType&&(MessageCenter.ins().removeListener(GameLogic.ins().postEnterMap.funcallname,this.openRingActivity,this),ViewManager.ins().open(ActivityWin,201),this.sendChangePage(201))},e.prototype.getType8RedPoint=function(t){var e=!1,i=this.activityData[t];return i&&0==i.record&&(e=!0),e},e.prototype.getType9RedPoint=function(t){var e=!1;if(this.getRollSum(t))e=!0;else{var i=GlobalConfig.ActivityType9Config[t];if(Assert(i,"ActivityType9Config is null!! activityId:"+t))return!1;for(var n in i[0].reward)if(this.isGetRollReward(t,+n)){e=!0;break}}return e},e.prototype.getType10RedPoint=function(t){var e=this.activityData[t],i=GlobalConfig.ActivityType10Config[t][e.getLevel()];return i?e.yb>=i.recharge&&Actor.yb>=i.yuanBao:!1},e.prototype.getType17RedPoint=function(t){var e=this.activityData[t],i=GlobalConfig.ActivityType17_2Config[t];return i?e.score>=i.score:!1},e.prototype.isGetRollReward=function(t,e){var i=this.activityData[t];if(!i)return!1;var n=GlobalConfig.ActivityType9Config[t];return n&&n[0]&&n[0].reward[e].times&&i.count>=n[0].reward[e].times&&!(i.record>>e+1&1)?!0:!1},e.prototype.getRollSum=function(t){var e=GlobalConfig.ActivityType9Config[t];if(e&&e[0]){var i=BagCT.ins().getBagItemById(e[0].item);if(i)return!0}return!1},e.prototype.getIsRollTen=function(t){var e=GlobalConfig.ActivityType9Config[t][0];if(e){var i=0;if(e.item){var n=BagCT.ins().getBagItemById(e.item);if(n&&(i+=n.count),i>=10)return!0}if(i=10-i,e.yb&&Actor.yb>=e.yb*i)return!0}return!1},e.prototype.postKuaFuRank=function(t){var e=t.readInt(),i=t.readByte(),n=t.readInt(),s=this.getActivityDataById(e);s&&s.CleanRandData();for(var o=0;n>o;o++)if(1==i){var a=new KuaFuRankData;a.actorId=t.readInt(),a.rmb=t.readInt(),a.rank=t.readInt(),a.serverName=t.readInt(),a.roleName=t.readString(),a.job=t.readInt(),a.sex=t.readInt(),a.serverId=t.readInt(),s&&s.SetRankData(a)}else if(2==i){var a=new QiongQiRankData;a.rank=t.readInt(),a.actorId=t.readInt(),a.level=t.readInt(),a.serverId=t.readInt(),a.roleName=t.readString(),s&&s.SetQRankData(a)}var r=t.readInt();s&&(s.mycost=r)},e.prototype.sendKuaFuRank=function(t){var e=this.getBytes(22);e.writeInt(t),this.sendToServer(e)},e.prototype.checkLabaBossData=function(){for(var t in this.activityData){var e=this.activityData[t];if(e.pageStyle==ActivityPageStyle.LABA&&e.type==ActivityDataType._20&&e.isOpenActivity())return e}return null},e.prototype.getConfig22_3=function(t){var e=GlobalConfig.ActivityType22_3Config[t];for(var i in e){var n=e[i];for(var s in n)if(n[s].low<=ZsCT.ins().lv&&ZsCT.ins().lv<=n[s].high)return n[s]}return null},e.prototype.sendEnvelopeData=function(t,e){var i=this.getBytes(6);i.writeInt(t),i.writeUnsignedShort(e),this.sendToServer(i)},e.prototype.postEnvelopeData=function(t){var e=t.readInt(),i=this.getActivityDataById(e);if(i instanceof ActivityType12Data){var n=t.readByte();if(n){var s=t.readUnsignedShort(),o=t.readShort(),a=t.readShort(),r=t.readShort(),l=t.readInt(),h=t.readString(),u=t.readString(),p=new EnvelopeData;return p.id=e,p.eId=s,p.job=o,p.sex=a,p.index=r,p.serverId=l,p.name=h,p.desc=u,void this.postEnvelopeDataCall(p)}this.postEnvelopeDataCall(null)}else i instanceof ActivityType36Data?i.postlog(t):(i.update(t),this.postActivityIsGetAwards())},e.prototype.postEnvelopeDataCall=function(t){return t},e.prototype.postRedEnvelopeData=function(t){var e=t.readInt();if(this.activityData[e]&&this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e],n=t.readShort(),s=t.readShort();if(1==n){if(s){var o=new RedEnvelope;o.id=t.readUnsignedShort(),o.timer=t.readInt(),i.envelopeData.push(o)}}else{for(var a=[],r=0;s>r;r++){var o=new RedEnvelope;o.id=t.readUnsignedShort(),o.timer=t.readInt(),a.push(o)}i.envelopeData=a}}},e.prototype.checkActivityTimer=function(){for(var t in this.activityData)if(this.activityData[t]instanceof ActivityType12Data){Timer.has(this.ActivityTimerSecond1,this)||Timer.start(1e3,0,this.ActivityTimerSecond1,this);break}},e.prototype.postGetRedEnvelope=function(t,e,i,n,s){return[t,e,i,n,s]},e.prototype.ActivityTimerSecond1=function(){for(var t=0;t<this._actTimeSecond1.length;){var e=this._actTimeSecond1[t];if(this.activityData[e]){if(!this.activityData[e].isOpenActivity()){if(this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e];i.clearAll()}this._actTimeSecond1.splice(t,1);continue}if(this.activityData[e]instanceof ActivityType12Data){var i=this.activityData[e];i.checkClear()}}t++}},Object.defineProperty(e.prototype,"activityTimers",{get:function(){return this._actTimeSecond1=this._actTimeSecond1?this._actTimeSecond1:[],this._actTimeSecond1},enumerable:!0,configurable:!0}),e.prototype.postActivityAwardLogs=function(t){for(var e=t.readUnsignedShort(),i=[],n=0;e>n;n++){var s=new RewardData;s.type=t.readByte(),s.id=t.readInt(),s.count=t.readInt(),i.push(s)}console.log(i)},e.prototype.postActivityBossInfo=function(t){var e=t.readUnsignedShort(),i=this.getActivityDataById(e);i instanceof ActivityType37Data&&i.updateBossInfo(t)},e.prototype.postWingCharge=function(){return 3},e.prototype.sendType48Discount=function(t,e){var i=this.getBytes(30);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.NotReached=0,e.CanGet=1,e.Geted=2,e.NOKILL=0,e.KILL=1,__decorate([post()],e.prototype,"postActivityIsGetAwards",null),__decorate([post()],e.prototype,"postRewardResult",null),__decorate([post()],e.prototype,"postRewardResult1",null),__decorate([post()],e.prototype,"postAddTips",null),__decorate([post()],e.prototype,"postAddTips52",null),__decorate([post()],e.prototype,"postActivityPanel",null),__decorate([post()],e.prototype,"postHuntResult",null),__decorate([post()],e.prototype,"postHuntResultPlayFunc",null),__decorate([post()],e.prototype,"postHuntResultFunc",null),__decorate([post()],e.prototype,"postChangePage",null),__decorate([post()],e.prototype,"postGetDaBiaoInfo",null),__decorate([post()],e.prototype,"postLuckyNumber",null),__decorate([post()],e.prototype,"postDownHongBao",null),__decorate([post()],e.prototype,"postSevendayAwardCallback",null),__decorate([post()],e.prototype,"postSevendayIsAwards",null),__decorate([post()],e.prototype,"postNextDayInfo",null),__decorate([post()],e.prototype,"postKuaFuRank",null),__decorate([post()],e.prototype,"postEnvelopeData",null),__decorate([post()],e.prototype,"postEnvelopeDataCall",null),__decorate([post()],e.prototype,"postRedEnvelopeData",null),__decorate([post()],e.prototype,"postGetRedEnvelope",null),__decorate([post()],e.prototype,"postActivityAwardLogs",null),__decorate([post()],e.prototype,"postActivityBossInfo",null),__decorate([post()],e.prototype,"postWingCharge",null),e}(BaseSystem);__reflect(Activity.prototype,"Activity");var DabiaoData=function(){function t(){}return t.prototype.prase=function(t,e){if(e==RankDataType.TYPE_XIAOFEI||e==RankDataType.TYPE_HF_XIAOFEI)return this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),void(this.numType=t.readInt());if(this.rankIndex=t.readShort(),this.id=t.readInt(),this.name=t.readString(),this.level=t.readShort(),this.zsLevel=t.readShort(),this.monthCard=t.readShort(),this.vipLv=t.readShort(),RankDataType.TYPE_LEVEL!=e)if(e==RankDataType.TYPE_BAOSHI||e==RankDataType.TYPE_LONGHUN)this.numType=t.readInt();else if(e==RankDataType.TYPE_ZHANLING){var i=t.readInt(),n=t.readInt();this.numType=[i,n]}else this.numType=t.readDouble()},t}();__reflect(DabiaoData.prototype,"DabiaoData"),System.Activity=function(){return Activity.ins()},window.Activity=Activity;var ActivityBtnType=function(){function t(){}return t.LEI_JI_1=1,t.DA_BIAO=2,t.CHONG_JI=3,t.LEI_JI_2=4,t.XIAN_GOU=5,t.QI_XI_XIAN_GOU=6,t.TE_HUI_1=7,t.LEI_JI_3=8,t.TE_HUI_2=9,t.LEI_JI_4=10,t.TE_HUI_3=11,t.ZHONG_QIU=12,t.SHENG_XIA=13,t.GUO_QING_LEI_JI=14,t.GUO_QING_DENG_LU=15,t.GUO_QING_XIAN_GOU=16,t.LEI_JI_DAYS42=10002,t.LEI_JI_EVERYDAY=10003,t.THREE_HEROES=10004,t.HEFU_XUNBAO=10005,t.HEFU_BOSS=10006,t.HEFU_JZLC=10007,t.HEFU_CZZS=10008,t.SANRI_RECHARGE=10017,t}();__reflect(ActivityBtnType.prototype,"ActivityBtnType"),window.ActivityBtnType=ActivityBtnType;var HBSystem=function(t){function e(){var e=t.call(this)||this;return e.observe(Activity.ins().postGetRedEnvelope,e.showHongBaoTips),e.observe(Activity.ins().postRewardResult,e.ActRewardResult),e.observe(Activity.ins().postEnvelopeDataCall,e.showEnvelope),e.observe(Activity.ins().postRedEnvelopeData,e.updateHongBao),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.updateHongBao=function(){var t=ViewManager.ins().getView(PlayFunView);if(t&&t.hongbao&&!(t.hongbao.numElements>0))for(var e=0;e<Activity.ins().activityTimers.length;e++){var i=Activity.ins().activityTimers[e],n=Activity.ins().activityData[i];if(n instanceof ActivityType12Data){if(!n.envelopeData.length)continue;for(var s=n.envelopeData.length-1;s>=0;)if(s=n.envelopeData.length-1,n.envelopeData[s]){var o=n.envelopeData[s].id;if(!n.envelopeData[s].isOverTimer()){var a=new HongBaoShowItem;a.data={actId:i,eId:o},t.hongbao.addChild(a);break}n.popEnvelope(o)}else n.envelopeData.splice(e,1)}}},e.prototype.showHongBaoTips=function(t){var e=t[0],i=t[1],n=t[2],s=(t[3],t[4]),o=Activity.ins().activityData[e];if(o){if(n){var a=new RewardData;a.type=0,a.id=MoneyConst.yuanbao,a.count=n,TipsCT.ins().showGoodRewardTips(a)}i&&o.popEnvelope(i),this.HongBaoResultAni(s)}},e.prototype.HongBaoResultAni=function(t){var e=ViewManager.ins().getView(PlayFunView);if(e&&e.hongbao){var i=e.hongbao.getChildAt(1);i&&i.playAni(t,this.updateHongBao,this)}},e.prototype.ActRewardResult=function(t){-1!=Activity.ins().activityTimers.indexOf(t)&&Activity.ins().activityData[t]instanceof ActivityType12Data&&(Activity.ins().isSuccee||(Activity.ins().activityData[t].isOpenActivity()?TipsCT.ins().showTips("|C:0xff0000&T:红包已过期"):TipsCT.ins().showTips("|C:0xff0000&T:活动已结束")))},e.prototype.showEnvelope=function(t){var e=ViewManager.ins().getView(PlayFunView);if(e&&e.hongbao){if(!t)return TipsCT.ins().showTips("|C:0xff0000&T:红包已过期"),e.hongbao.removeChildren(),void this.updateHongBao();if(Activity.ins().activityData[t.id]instanceof ActivityType12Data){var i=new HongBaoOpenItem;t.desc||(t.desc=GlobalConfig.ActivityType12Config[t.id][t.index].blessWord),i.data={actId:t.id,eId:t.eId,job:t.job,sex:t.sex,name:t.name,text:t.desc,index:t.index},e.hongbao.addChildAt(i,1)}}},e}(BaseSystem);__reflect(HBSystem.prototype,"HBSystem"),System.HBSystem=function(){return HBSystem.ins()},window.HBSystem=HBSystem;var ThreeHeroes=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.ThreeHeroes,e.regNetMsg(1,e.doGotAward),e.regNetMsg(2,e.doAwardInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.doGotAward=function(t){t.readByte()>0&&(this.awardState=e.Geted,this.postInfoChange())},e.prototype.doAwardInfo=function(t){var i=t.readBoolean();this.loginDays=t.readShort(),this.showIcon3DaysLater=t.readBoolean(),ActivityDataFactory.createEx();var n=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(n){var s=Math.floor((n.startTime-GameServer.serverTime)/1e3),o=Math.floor((n.endTime-GameServer.serverTime)/1e3);0>s&&o>0?(Actor.vip>=GlobalConfig.LoginActivateConfig.vipLevel?this.awardState=e.Active:this.awardState=e.NotActive,MessageCenter.addListener(VipCT.ins().postUpdateVipData,this.updateStateByVip,this),MessageCenter.addListener(VipCT.ins().postUpdataExp,this.updateStateByVip,this)):(this.showIcon3DaysLater?this.loginDays>=GlobalConfig.LoginActivateConfig.loginDays?this.awardState=e.CanGet:this.awardState=e.Active:this.awardState=i?e.Geted:e.NotActive,MessageCenter.ins().removeAll(this))}Activity.ins().postActivityIsGetAwards(),this.postInfoChange()},e.prototype.updateStateByVip=function(){var t=Activity.ins().activityData[ActivityBtnType.THREE_HEROES];if(t){var i=Math.floor((t.startTime-GameServer.serverTime)/1e3),n=Math.floor((t.endTime-GameServer.serverTime)/1e3);0>i&&n>0&&(Actor.vip>=GlobalConfig.LoginActivateConfig.vipLevel?this.awardState=e.Active:this.awardState=e.NotActive)}this.postInfoChange()},e.prototype.sendReward=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.postInfoChange=function(){},e.NotActive=0,e.Active=1,e.CanGet=2,e.Geted=3,__decorate([post()],e.prototype,"postInfoChange",null),e}(BaseSystem);__reflect(ThreeHeroes.prototype,"ThreeHeroes"),System.ThreeHeroes=function(){return ThreeHeroes.ins()},window.ThreeHeroes=ThreeHeroes;var BaseSpriteLayer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(BaseSpriteLayer.prototype,"BaseSpriteLayer");var ActivityDataType;!function(t){t[t._0=0]="_0",t[t._1=1]="_1",t[t._2=2]="_2",t[t._3=3]="_3",t[t._4=4]="_4",t[t._5=5]="_5",t[t._6=6]="_6",t[t._7=7]="_7",t[t._8=8]="_8",t[t._9=9]="_9",t[t._10=10]="_10",t[t._11=11]="_11",t[t._12=12]="_12",t[t._13=13]="_13",t[t._14=14]="_14",t[t._15=15]="_15",t[t._16=16]="_16",t[t._17=17]="_17",t[t._18=18]="_18",t[t._19=19]="_19",t[t._20=20]="_20",t[t._21=21]="_21",t[t._22=22]="_22",t[t._23=23]="_23",t[t._24=24]="_24",t[t._25=25]="_25",t[t._26=26]="_26",t[t._27=27]="_27",t[t._28=28]="_28",t[t._29=29]="_29",t[t._30=30]="_30",t[t._31=31]="_31",t[t._32=32]="_32",t[t._33=33]="_33",t[t._34=34]="_34",t[t._35=35]="_35",t[t._36=36]="_36",t[t._37=37]="_37",t[t._38=38]="_38",t[t._39=39]="_39",t[t._40=40]="_40",t[t._41=41]="_41",t[t._42=42]="_42",t[t._43=43]="_43",t[t._44=44]="_44",t[t._45=45]="_45",t[t._46=46]="_46",t[t._47=47]="_47",t[t._48=48]="_48",t[t._49=49]="_49",t[t._50=50]="_50",t[t._51=51]="_51",t[t._52=52]="_52",t[t._53=53]="_53",t[t._54=54]="_54",t[t._55=55]="_55",t[t._56=56]="_56",t[t._57=57]="_57",t[t._58=58]="_58",t[t._59=59]="_59"}(ActivityDataType||(ActivityDataType={})),window.ActivityDataType=ActivityDataType;var ActivityDataFactory=function(){function t(){}return t.create=function(t){var e,i=t.readInt(),n=t.readInt(),s=t.readInt(),o=t.readShort(),a=t.readInt();switch(o){case ActivityDataType._1:e=new ActivityType1Data(t);break;case ActivityDataType._2:e=new ActivityType2Data(t);break;case ActivityDataType._3:e=new ActivityType3Data(t);break;case ActivityDataType._4:e=new ActivityType4Data(t);break;case ActivityDataType._5:e=Activity.ins().getActivityDataById(i),e?e.updateRecord(t):e=new ActivityType5Data(t);break;case ActivityDataType._6:e=new ActivityType6Data(t);break;case ActivityDataType._7:e=new ActivityType7Data(t);break;case ActivityDataType._8:e=new ActivityType8Data(t);break;case ActivityDataType._9:Activity.ins().activityData[i]?(e=Activity.ins().activityData[i],e.update(t)):e=new ActivityType9Data(t);break;case ActivityDataType._10:e=new ActivityType10Data(t);break;case ActivityDataType._11:e=new ActivityType11Data(t,i,n,s);break;case ActivityDataType._12:Activity.ins().activityData[i]?(e=Activity.ins().activityData[i],e.init(t,i)):e=new ActivityType12Data(t,i);break;case ActivityDataType._13:Activity.ins().activityData[i]?(e=Activity.ins().activityData[i],e.init(t)):e=new ActivityType13Data(t);break;case ActivityDataType._14:e=new ActivityType14Data(t);break;case ActivityDataType._17:e=new ActivityType17Data(t);break;case ActivityDataType._18:Activity.ins().activityData[i]?(e=Activity.ins().activityData[i],e.init(t)):e=new ActivityType18Data(t);break;case ActivityDataType._19:e=new ActivityType19Data(t);break;case ActivityDataType._20:e=new ActivityType20Data(t);break;case ActivityDataType._21:e=new ActivityType21Data(t);break;case ActivityDataType._22:e=new ActivityType22Data(t);break;case ActivityDataType._23:e=new ActivityType23Data(t);break;case ActivityDataType._24:e=new ActivityType24Data(t);break;case ActivityDataType._25:e=new ActivityType25Data(t);break;case ActivityDataType._26:e=new ActivityType26Data(t);break;case ActivityDataType._27:e=new ActivityType27Data(t);break;case ActivityDataType._28:e=new ActivityType28Data(t);break;case ActivityDataType._29:e=new ActivityType29Data(t);break;case ActivityDataType._30:e=new ActivityType30Data(t);break;case ActivityDataType._31:e=new ActivityType31Data(t);break;case ActivityDataType._32:e=new ActivityType32Data(t);break;case ActivityDataType._33:e=new ActivityType33Data(t);break;case ActivityDataType._34:e=new ActivityType34Data(t);break;case ActivityDataType._35:e=new ActivityType35Data(t);break;case ActivityDataType._36:e=new ActivityType36Data(t);break;case ActivityDataType._37:e=new ActivityType37Data(t);break;case ActivityDataType._38:e=new ActivityType38Data(t);break;case ActivityDataType._39:e=new ActivityType39Data(t);break;case ActivityDataType._40:e=new ActivityType40Data(t);break;case ActivityDataType._41:e=new ActivityType41Data(t);break;case ActivityDataType._42:e=new ActivityType42Data(t);break;case ActivityDataType._43:e=new ActivityType43Data(t);break;case ActivityDataType._44:e=new ActivityType44Data(t);break;case ActivityDataType._45:e=new ActivityType45Data(t);break;case ActivityDataType._46:e=new ActivityType46Data(t);break;case ActivityDataType._47:e=new ActivityType47Data(t);break;case ActivityDataType._48:e=new ActivityType48Data(t);break;case ActivityDataType._49:e=new ActivityType49Data(t);break;case ActivityDataType._51:e=new ActivityType51Data(t);break;case ActivityDataType._52:e=new ActivityType52Data(t);break;case ActivityDataType._54:e=new ActivityType54Data(t,i);break;case ActivityDataType._55:e=new ActivityType55Data(t,i,n,s);break;case ActivityDataType._56:e=new ActivityType56Data(t);break;case ActivityDataType._57:e=new ActivityType57Data(t,i);break;case ActivityDataType._58:e=new ActivityType58Data(t);break;case ActivityDataType._59:e=new ActivityType59Data(t);break;default:console.log("错误活动类型:"+o);for(var r=0;a>r;r++)t.readByte();return null}if(!e)return null;e.id=i,e.startTime=n,e.endTime=s,e.type=o,e.activityType=ActivityType.Normal;var l=GlobalConfig.ActivityConfig[i];return l&&(e.timeType=l.timeType,e.pageStyle=l.pageStyle,e.pageSkin=l.pageSkin),e},t.createEx=function(){var e,i=GlobalConfig.ActivityBtnConfig,n=DateUtils.formatMiniDateTime(GameServer._serverZeroTime),s=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime);for(var o in i){var a=i[o],r=a.hfTimes||0,l=a.timeType?a.timeType:0;if(!(l&&l==t.TimeType_Total&&r&&r!=GameServer._hefuCount||a.type)){if(e=new ActivityType0Data(null),e.id=a.id,e.type=a.type,e.activityType=ActivityType.Normal,e.timeType=a.timeType,a.pageStyle&&(e.pageStyle=a.pageStyle),a.relyOn){e.relyOn=a.relyOn;for(var h=0;h<a.relyOn.length;h++)if(Activity.ins().activityData[a.relyOn[h]]){e.startTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[a.relyOn[h]].startTime),e.endTime=DateUtils.formatMiniDateTime(Activity.ins().activityData[a.relyOn[h]].endTime);break}}else if(a.timeType==t.TimeType_Normal){var u=a.startTime.split("-"),p=+u[0],c=u[1].split(":"),d=new Date(n);if(d.setDate(d.getDate()+p),d.setHours(+c[0],+c[1],0,0),e.startTime=d.getTime(),a.endTime){u=a.endTime.split("-");var g=+u[0],f=u[1].split(":"),v=new Date(n);v.setDate(v.getDate()+g),v.setHours(+f[0],+f[1],0,0),e.endTime=v.getTime()}else e.endTime=GameServer.serverTime+2592e6}else if(a.timeType==t.TimeType_Fixed)e.startTime=new Date(a.startTime).getTime(),e.endTime=new Date(a.endTime).getTime();else if(a.timeType==t.TimeType_Total){var u=[],g=DateUtils.DAYS_PER_WEEK;switch(a.endTime&&(u=a.endTime.split("-"),g=+u[0]),a.showType){case StateShowType.TYPE_5:e.startTime=s,e.endTime=s+24*GlobalConfig.TreasureHuntConfig.hefuDay*60*60*1e3;break;case StateShowType.TYPE_6:case StateShowType.TYPE_7:case StateShowType.TYPE_8:e.startTime=s,e.endTime=s+g*DateUtils.SECOND_PER_DAY*1e3}}else e.startTime=n,e.endTime=GameServer.serverTime+2592e6;var y=Math.floor((e.endTime-GameServer.serverTime)/1e3);y>0?Activity.ins().activityData[a.id]=e:a.showType==StateShowType.TYPE_4&&ThreeHeroes.ins().showIcon3DaysLater&&(Activity.ins().activityData[a.id]=e)}}},t.TimeType_Normal=0,t.TimeType_Fixed=1,t.TimeType_Total=2,t}();__reflect(ActivityDataFactory.prototype,"ActivityDataFactory"),window.ActivityDataFactory=ActivityDataFactory;var ActivityPageStyle;!function(t){t[t.THANKS=1]="THANKS",t[t.ACTIVITYFB=2]="ACTIVITYFB",t[t.HAPPYSEVENDAY=4]="HAPPYSEVENDAY",t[t.TOTALRECHARGE=5]="TOTALRECHARGE",t[t.LABA=7]="LABA",t[t.YBZHUANPAN=8]="YBZHUANPAN",t[t.Activity10=10]="Activity10",t[t.Activity11=11]="Activity11",t[t.Activity12=12]="Activity12",t[t.SPRINGEIGHTDAY=13]="SPRINGEIGHTDAY",t[t.VERSIONCELE=17]="VERSIONCELE",t[t.FASHIONLEASING=20]="FASHIONLEASING",t[t.NewGuideTask=21]="NewGuideTask",t[t.LIMITGIFT=22]="LIMITGIFT",t[t.LIMITCHEAPIE=23]="LIMITCHEAPIE",t[t.TREASUREROOM=24]="TREASUREROOM",t[t.CDRECHARGE=25]="CDRECHARGE",t[t.CUMULRECHARGE=26]="CUMULRECHARGE",t[t.LIMITEDGIFT=27]="LIMITEDGIFT",t[t.BOSSFIRSTKILL=28]="BOSSFIRSTKILL",t[t.PActivity55=29]="PActivity55",t[t.Activity30=30]="Activity30",t[t.Activity31=31]="Activity31",t[t.Activity32=32]="Activity32",t[t.Activity33=33]="Activity33",t[t.Activity34=34]="Activity34",t[t.Activity35=35]="Activity35",t[t.Activity36=36]="Activity36",t[t.Activity37=37]="Activity37",t[t.Activity38=38]="Activity38",t[t.Activity39=39]="Activity39",t[t.Activity3_13=40]="Activity3_13"}(ActivityPageStyle||(ActivityPageStyle={})),window.ActivityPageStyle=ActivityPageStyle;var ActivityType0Data=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.specialState=function(){var t=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),e=GlobalConfig.ActivityBtnConfig[this.id];if(!e)return!1;if(e.showType==StateShowType.TYPE_6){for(var i=[0,1,3,5],n=0;n<i.length;n++){var s=t+i[n]*DateUtils.MS_PER_DAY,o=new Date(s);o.setHours(20,30,0);var a=t+(i[n]+1)*DateUtils.MS_PER_DAY,r=new Date(a);if(GameServer.serverTime>=o.getTime()&&GameServer.serverTime<r.getTime()){var l=GlobalConfig.CityBossConfig[n+1];if(!l)return!1;var h=l.killBossId,u=CityCC.ins().bossKillNumData;if(u&&void 0!=u[h]&&1!=u[h][1])return!0}}return!1}return e.showType==StateShowType.TYPE_7?GlobalConfig.GuildBattleConst.hefuOpen?GuildWar.ins().getModel().isWatStart:!1:!0},e.prototype.canReward=function(){var t=GlobalConfig.ActivityBtnConfig[this.id];if(!t)return!1;if(t.showType==StateShowType.TYPE_2)return Recharge.ins().rechargeTotal.hasGetDays.length<Recharge.ins().rechargeTotal.totalDay;if(t.showType==StateShowType.TYPE_12)return Recharge.ins().rechargeTotal2.hasGetDays.length<Recharge.ins().rechargeTotal2.totalDay;if(t.showType==StateShowType.TYPE_3){var e=Recharge.ins().getRechargeData(0),i=Recharge.ins().getCurRechargeConfig();for(var n in i){var s=i[n];if(e.curDayPay>=s.pay){var o=e.isAwards>>s.index&1;if(!o)return!0}}}else{if(t.showType==StateShowType.TYPE_4)return ThreeHeroes.ins().awardState==ThreeHeroes.CanGet;if(t.showType==StateShowType.TYPE_7||t.showType==StateShowType.TYPE_6)return!0;if(t.showType==StateShowType.TYPE_7){var a=GlobalConfig.MultiDayRechargeConfig;for(var r in a){var l=a[r];if(Recharge.ins().mDayNum==parseInt(r)&&Recharge.ins().mRecNum>=l.num&&0==Recharge.ins().mReward)return!0}}else if(t.showType==StateShowType.TYPE_13&&1==CityCC.ins().bossState)return!0}if(t&&t.jump&&t.jump[0]==StatePageSysType.RING&&LyMark.ins().checkOpen()&&!LyMark.ins().isMax){var h=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],u=BagCT.ins().getBagItemById(h.costItem),p=u?u.count:0;return p>=h.costCount}return!1},e.prototype.getHide=function(){var t=GlobalConfig.ActivityBtnConfig[this.id];if(!t)return!1;if(this.isHide)return this.isHide;if(t.showType==StateShowType.TYPE_2&&Recharge.ins().rechargeTotal.hasGetDays.length>=CommonUtils.getObjectLength(GlobalConfig.RechargeDaysAwardsConfig)&&(this.isHide=!0),t.showType==StateShowType.TYPE_12)(GameServer.serverOpenDay+1<GlobalConfig.LuxuryRechargeBase.openDay||Actor.level<GlobalConfig.LuxuryRechargeBase.openLevel||Recharge.ins().rechargeTotal2.hasGetDays.length>=CommonUtils.getObjectLength(GlobalConfig.LuxuryRechargeDaysAward))&&(this.isHide=!0);else if(t.showType==StateShowType.TYPE_4)this.isHide=!this.isOpenActivity();else if(t.showType==StateShowType.TYPE_13)this.isHide=GameServer.serverOpenDay>=CityCC.ins().openRevelryDay;else if(t.showType==StateShowType.TYPE_6){var e=[0,1,3,5],i=GlobalConfig.CityBossConfig[e.length];if(i){var n=i.killBossId,s=CityCC.ins().bossKillNumData;s&&void 0!=s[n]&&s[n][1]>=1&&(this.isHide=!0)}}else if(t.showType==StateShowType.TYPE_7){var o=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),e=GlobalConfig.GuildBattleConst.hefuOpen,a=e.length-1,r=o+e[a].day*DateUtils.MS_PER_DAY,l=new Date(r);if(l.setHours(0,0,0),GameServer.serverTime>l.getTime())return!0}return this.isHide},e.prototype.isOpenActivity=function(){var t=Math.floor((this.startTime-GameServer.serverTime)/1e3),e=Math.floor((this.endTime-GameServer.serverTime)/1e3);if(0>t&&e>0)return!0;var i=GlobalConfig.ActivityBtnConfig[this.id];return i&&i.showType==StateShowType.TYPE_4?ThreeHeroes.ins().showIcon3DaysLater:!1},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e}(ActivityBaseData);__reflect(ActivityType0Data.prototype,"ActivityType0Data"),window.ActivityType0Data=ActivityType0Data;var StatePageSysType;!function(t){t[t.WING=1]="WING",t[t.RING=2]="RING"}(StatePageSysType||(StatePageSysType={})),window.StatePageSysType=StatePageSysType;var StateShowType;!function(t){t[t.TYPE_1=1]="TYPE_1",t[t.TYPE_2=2]="TYPE_2",t[t.TYPE_3=3]="TYPE_3",t[t.TYPE_4=4]="TYPE_4",t[t.TYPE_5=5]="TYPE_5",t[t.TYPE_6=6]="TYPE_6",t[t.TYPE_7=7]="TYPE_7",t[t.TYPE_8=8]="TYPE_8",t[t.TYPE_9=9]="TYPE_9",t[t.TYPE_10=10]="TYPE_10",t[t.TYPE_12=12]="TYPE_12",t[t.TYPE_13=13]="TYPE_13"}(StateShowType||(StateShowType={})),window.StateShowType=StateShowType;var DelayOptManager=function(t){function e(){var e=t.call(this)||this;return e.TIME_THRESHOLD=2,e._delayOpts=[],egret.startTick(e.runCachedFun,e),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addDelayOptFunction=function(t,e,i,n,s){this._delayOpts.push({fun:e,funPara:i,thisObj:t,callBack:n,para:s})},e.prototype.clear=function(){this._delayOpts.length=0},e.prototype.runCachedFun=function(t){if(0==this._delayOpts.length)return!1;for(var e,i=egret.getTimer();this._delayOpts.length&&(e=this._delayOpts.shift(),e.funPara?e.fun.call(e.thisObj,e.funPara):e.fun.call(e.thisObj),e.callBack&&(void 0!=e.para?e.callBack.call(e.thisObj,e.para):e.callBack()),!(egret.getTimer()-i>this.TIME_THRESHOLD)););return!1},e}(BaseClass);__reflect(DelayOptManager.prototype,"DelayOptManager"),window.DelayOptManager=DelayOptManager;var SceneManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){var t=this._currScene;t&&(t.onExit(),this._currScene=void 0)},e.prototype.runScene=function(t){if(null==t)return void console.log("runScene:scene is null");var e=this._currScene;e&&e.onExit();var i=new t;i.onEnter(),this._currScene=i},e.prototype.getCurrScene=function(){return this._currScene},e.prototype.getSceneName=function(){return this._currScene?egret.getQualifiedClassName(this._currScene):""},e.CREATE_ROLE="CreateRoleScene",e.MAIN="MainScene",e}(BaseClass);__reflect(SceneManager.prototype,"SceneManager");var ActivityType12Data=function(t){function e(i,n){var s=t.call(this,i)||this;return s.envelopeSum=e.maxEnvelope,s.SecondCount=0,s.init(i,n),s}return __extends(e,t),e.prototype.init=function(t,e){this.score=t.readInt();var i=t.readShort();this.logs=[];for(var n=0;i>n;n++){var s=t.readShort(),o=t.readString(),a=t.readInt();this.logs.push({name:o,serverId:a,index:s})}-1==Activity.ins().activityTimers.indexOf(e)&&Activity.ins().activityTimers.push(e)},e.prototype.update=function(t){var e=t.readUnsignedShort(),i=t.readInt(),n=t.readInt(),s=t.readShort(),o=[],a=SubRoles.ins().getSubRoleByIndex(0);o.push({job:a.job,sex:a.sex,name:Actor.myName,yb:i,gold:n});for(var r=0;s>r;r++){var l=t.readShort(),h=t.readShort(),u=t.readString(),p=t.readInt();Actor.myName!=u&&o.push({job:l,sex:h,name:u,yb:p,gold:0})}Activity.ins().postGetRedEnvelope(this.id,e,i,n,o)},Object.defineProperty(e.prototype,"envelopeData",{get:function(){return this._envelopeData=this._envelopeData?this._envelopeData:[],this._envelopeData},set:function(t){t.sort(this.sortTimer),this._envelopeData=t},enumerable:!0,configurable:!0}),e.prototype.sortTimer=function(t,e){return Algorithm.sortAsc(t.timer,e.timer)},e.prototype.checkClear=function(){this.envelopeData.length>=this.envelopeSum?(this.SecondCount=0,this.clearEnvelopeData(),this.envelopeSum>e.maxEnvelope&&(this.envelopeSum=this.envelopeData.length+e.maxEnvelope)):this.SecondCount>10&&this.envelopeSum>e.maxEnvelope?(this.SecondCount=0,this.envelopeSum=e.maxEnvelope):this.SecondCount>60&&this.envelopeData.length<e.maxEnvelope&&(this.SecondCount=0,this.clearEnvelopeData()),this.SecondCount++
},e.prototype.clearEnvelopeData=function(){for(var t=0;t<this.envelopeData.length;)(!this.envelopeData[t]||this.envelopeData[t].isOverTimer())&&this.envelopeData.splice(t,1),t++},e.prototype.clearAll=function(){this.envelopeData=[],this.envelopeSum=e.maxEnvelope},e.prototype.popEnvelope=function(t){for(var e=0;e<this.envelopeData.length;){if(!this.envelopeData[e]||this.envelopeData[e].id==t){this.envelopeData.splice(e,1);break}e++}},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType12Config[this.id];for(var e in t)if(this.score>=t[e].score)return!0;return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.maxEnvelope=10,e}(ActivityBaseData);__reflect(ActivityType12Data.prototype,"ActivityType12Data");var RedEnvelope=function(){function t(){this.id=0,this.timer=0}return t.prototype.isOverTimer=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.timer)-GameServer.serverTime)/1e3);return 0>=t?!0:!1},t}();__reflect(RedEnvelope.prototype,"RedEnvelope");var EnvelopeData=function(){function t(){this.id=0,this.eId=0,this.job=0,this.sex=0,this.index=0,this.serverId=0,this.name="",this.desc=""}return t}();__reflect(EnvelopeData.prototype,"EnvelopeData"),window.ActivityType12Data=ActivityType12Data;var EnvelopeType;!function(t){t[t.SEND=1]="SEND",t[t.GET=2]="GET"}(EnvelopeType||(EnvelopeType={})),window.EnvelopeType=EnvelopeType;var ActivityType13Data=function(t){function e(e){var i=t.call(this,e)||this;return i.proCount=[0,0,0,0,0,0,0,0],i.awardCount=[0,0,0,0,0,0,0,0],i.count=0,i.playList=[],i.init(e),i}return __extends(e,t),e.prototype.init=function(t){this.count=t.readInt();for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort(),s=t.readShort(),o=this.awardCount[n],a=t.readByte();o!=a&&Activity.ins().postHuntResultFunc(),this.proCount[n]=s,this.awardCount[n]=a}},e.prototype.update=function(t){var e=(t.readShort(),t.readShort());this.playList=[];for(var i=0;e>i;i++){var n=t.readShort();this.proCount[n]=t.readShort(),-1==this.playList.indexOf(n)&&this.playList.push(n)}},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType13Data.prototype,"ActivityType13Data"),window.ActivityType13Data=ActivityType13Data;var ActivityType14Data=function(t){function e(e){var i=t.call(this,e)||this;if(i.lucky=0,i.rewardID=0,i.bigRewardsID=0,i.curIndex=0,i.lucky=e.readShort(),i.rewardID=e.readShort(),ViewManager.ins().isShow(TreasureToGetlWin)){var n=ViewManager.ins().getView(TreasureToGetlWin);n&&n.updateLucky(i.lucky)}return i}return __extends(e,t),e.prototype.postGoods=function(t){var i=t.readShort();e.rewardList||(e.rewardList=[]);for(var n=0;i>n;n++){var s=new RewardData;s.parser(t),this.bigRewardsID=this.isBigRewards(s.id)?s.id:0,0==this.bigRewardsID?(8==e.rewardList.length&&(e.rewardList=[]),e.rewardList.push(s)):0!=e.rewardList.length||ViewManager.ins().isShow(TreasureToGetlWin)||ViewManager.ins().open(TreasureToGetlWin,this.curIndex,this.id)}if(1!=e.rewardList.length||ViewManager.ins().isShow(TreasureToGetlWin)){if(ViewManager.ins().isShow(TreasureToGetlWin)){var o=ViewManager.ins().getView(TreasureToGetlWin);o.update()}}else ViewManager.ins().open(TreasureToGetlWin,this.curIndex,this.id)},e.prototype.isBigRewards=function(t){var e=this.getType14Config();return e?e.itemId.indexOf(t)>=0:!1},e.prototype.update=function(t){this.postGoods(t)},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=this.getType14Config(),e=BagCT.ins().getBagGoodsCountById(0,t.costItem.id);return e>=t.costItem.count},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getType14Config=function(){var t=GlobalConfig.ActivityType14Config[this.id];for(var e in t)if(t[e].index==this.rewardID)return t[e];return t?t[0]:null},__decorate([post()],e.prototype,"postGoods",null),e}(ActivityBaseData);__reflect(ActivityType14Data.prototype,"ActivityType14Data"),window.ActivityType14Data=ActivityType14Data;var ActivityType17Data=function(t){function e(e){var i=t.call(this,e)||this;i.noticeArr=[],i.actStar=[],i.awardIndex=0;for(var n=e.readShort(),s=1;n>=s;s++)i.actStar[s]=e.readShort();var o=e.readShort();i.noticeArr=[];for(var s=0;o>s;s++)i.noticeArr.push({name:e.readString(),index:e.readByte()});return i.noticeArr.reverse(),i.score=e.readInt(),i.curRecharge=e.readInt(),i.overDay=e.readInt(),i.recrod=e.readInt(),i}return __extends(e,t),e.prototype.update=function(t){this.awardIndex=t.readShort(),this.recrod=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType17RedPoint(this.id)},e}(ActivityBaseData);__reflect(ActivityType17Data.prototype,"ActivityType17Data"),window.ActivityType17Data=ActivityType17Data;var ActivityType18Data=function(t){function e(e){var i=t.call(this,e)||this;return i.num=0,i.init(e),i}return __extends(e,t),e.prototype.init=function(t){this.num=t.readInt(),this.recrod=t.readInt();var e=t.readShort();this.logs?this.logs.length=0:this.logs=[];for(var i=0;e>i;i++){var n=[t.readString(),t.readInt()];this.logs.push(n)}this.logs=this.logs.reverse(),this.bestlogs?this.bestlogs.length=0:this.bestlogs=[],e=t.readShort();for(var i=0;e>i;i++){var n=[t.readString(),t.readInt()];this.bestlogs.push(n)}},e.prototype.update=function(t){var e=t.readShort();this.num=t.readInt(),this.recrod=t.readInt();for(var i=t.readShort(),n=[],s=0;i>s;s++)n[s]=[t.readInt(),t.readShort()];var o=0;2==e&&(o=1),ViewManager.ins().isShow(HuntResultWin)?Activity.ins().postHuntResult(o,n,3,this.id):(ViewManager.ins().open(HuntResultWin,o,n,2,this.id),Activity.ins().postHuntResult(o,n,3,this.id))},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getLeftTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),i="";return i=t>=0?"活动未开启":0>=e?"活动已结束":DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,4)},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.getStateByIndex=function(t){var e=this.recrod>>t&1;if(0==e){var i=GlobalConfig.ActivityType18Config[this.id][t];i&&i.dbCount&&i.dbCount<=this.num&&(e=2)}return e},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType18Config[this.id][0].relateActivityId,e=Activity.ins().getActivityDataById(t),i=GlobalConfig.ActivityType13Config[t];for(var n in i){var s=e.awardCount[n],o=e.proCount[n],a=i[n].count;if(0==s&&o/a==1)return!0}return!1},e}(ActivityBaseData);__reflect(ActivityType18Data.prototype,"ActivityType18Data"),window.ActivityType18Data=ActivityType18Data;var ActivityType19Data=function(t){function e(e){var i=t.call(this,e)||this;return i.awardIndex=0,i._data={},i._list=[],i.data={},i.list=[],i}return __extends(e,t),e.prototype.CleanRandData=function(){this._data={},this._list=[],this.data={},this.list=[]},e.prototype.SetRankData=function(t){this._list[t.rank-1]=t,this._data[t.actorId]=t},e.prototype.SetQRankData=function(t){this.list[t.rank-1]=t,this.data[t.actorId]=t},e.prototype.GetRankData=function(){return this._data},e.prototype.GetRankList=function(){return this._list},e.prototype.GetQRankList=function(){return this.list},e.prototype.update=function(t){},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType19Config[this.id][1];if(t.activityID){var e=Activity.ins().getActivityDataById(t.activityID);if(e&&e.canReward())return!0}return!1},e}(ActivityBaseData);__reflect(ActivityType19Data.prototype,"ActivityType19Data"),window.ActivityType19Data=ActivityType19Data;var Algorithm=function(){function t(){}return t.sortAsc=function(t,e){return e>t?-1:t>e?1:0},t.sortDesc=function(t,e){return t>e?-1:e>t?1:0},t.sortAscAttr=function(e,i,n){var s;if(void 0==n)s=t.sortAsc(e,i);else{var o=e[n],a=i[n];s=a>o?-1:o>a?1:0}return s},t.sortDescAttr=function(e,i,n){var s;if(void 0==n)s=t.sortDesc(e,i);else{var o=e[n],a=i[n];s=o>a?-1:a>o?1:0}return s},t.binSearch=function(e,i,n){if(void 0===n&&(n=null),!e||0==e.length)return 0;n||(n=t.sortAsc);for(var s=0,o=e.length-1;o>=s;){var a=o+s>>1,r=e[a];n(r,i)<=0?s=a+1:o=a-1}return s},t.test=function(){for(var e=[],i=10,n=0;i>n;n++){var s=Math.floor(1e5*Math.random()),o=t.binSearch(e,s);e.splice(o,0,s)}e.length!=i&&console.log("test fail!count is "+e.length+", except:"+i);for(var a=0,r=e;a<r.length;a++){var l=r[a];console.log(l)}for(var n=0;n<e.length-1;n++)if(e[n]>e[n+1]){console.log("test fail!index:"+n);break}},t}();__reflect(Algorithm.prototype,"Algorithm"),window.Algorithm=Algorithm;var ActivityType20Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.index=t.readInt()||1,this.timer=t.readInt(),this.timer&&(this.timer=Math.floor(DateUtils.formatMiniDateTime(this.timer)/DateUtils.MS_PER_SECOND)),this.isGoIn=t.readByte()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){if(this.IsEnd())return!1;var t=this.getStartTimer(),e=this.getEndTimer(),i=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return t>i||i>=e?!1:!0},e.prototype.IsEnd=function(){var t=this.getEndTimer(),e=new Date(t*DateUtils.MS_PER_SECOND),i=new Date(GameServer.serverTime);return i.getDate()!=e.getDate()?!0:!1},e.prototype.go2BossFb=function(){return this.isGoIn},e.prototype.getReadyTimer=function(){var t=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-t.duration-t.enterTime},e.prototype.getStartTimer=function(){var t=GlobalConfig.ActivityType20Config[this.id][this.index];return this.timer-t.duration},e.prototype.getEndTimer=function(){return this.timer},e.prototype.getResidueTimer=function(){if(this.IsEnd())return 0;var t=this.getStartTimer(),e=this.getEndTimer(),i=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return i>=t&&e>i?e-i:e-i},e.prototype.getResidueStartTimer=function(){if(this.IsEnd())return 0;var t=this.getStartTimer(),e=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND);return e>=t?0:t-e},e.prototype.getDateTime=function(t){var e=t.split(/[-,.,:]/g),i=new Date(+e[0],+e[1]-1,+e[2],+e[3]||0,+e[4]||0);return i},e}(ActivityBaseData);__reflect(ActivityType20Data.prototype,"ActivityType20Data");var LBBossRankData=function(){function t(){this.rank=0,this.name="",this.damage=0}return t}();__reflect(LBBossRankData.prototype,"LBBossRankData"),window.ActivityType20Data=ActivityType20Data;var ActivityType21Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.update=function(t){},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){return!1},e}(ActivityBaseData);__reflect(ActivityType21Data.prototype,"ActivityType21Data"),window.ActivityType21Data=ActivityType21Data;var ActivityType22Data=function(t){function e(e){var i=t.call(this,e)||this;return i._refreshTime=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.tScore=t.readInt(),this.refreshFree=1==t.readByte(),this._refreshTime=t.readInt(),this._oldTimer=egret.getTimer();var e=t.readShort();this.shopItems=[],this.shopItems.length=e;for(var i=0;e>i;i++)this.shopItems[i]=new SpringBeginShopVo,this.shopItems[i].parser(t);e=t.readShort(),this.scoreItems=[],this.scoreItems.length=e;for(var i=0;e>i;i++)this.scoreItems[i]=new SpringBeginShopVo,this.scoreItems[i].parser2(t);this.limitItems=[],e=t.readShort();for(var n,i=0;e>i;i++)n=new SpringBeginShopVo,n.parser3(t),this.limitItems.push(n)},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getleftTime=function(){if(!this.isOpenActivity())return 0;var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t},e.prototype.checkRedPoint=function(){if(this.refreshFree)return!0;var t=Activity.ins().getConfig22_3(this.id);if(t&&t.score>0&&this.tScore>=t.score)return!0;var e=BagCT.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.id][1].freshItem);return e&&e.count>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getRefreshTime=function(){return this._refreshTime-(egret.getTimer()-this._oldTimer)/1e3},e}(ActivityBaseData);__reflect(ActivityType22Data.prototype,"ActivityType22Data"),window.ActivityType22Data=ActivityType22Data;var ActivityType23Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.leftCount=t.readByte(),this.maxCount=t.readByte(),this.canGet=t.readInt()+""},e.prototype.checkRedPoint=function(){return this.leftCount>0||+this.canGet>0},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getHide=function(){return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType23Data.prototype,"ActivityType23Data"),window.ActivityType23Data=ActivityType23Data;var ActivityType24Data=function(t){function e(e){var i=t.call(this,e)||this;return i.pinTuItems=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){for(var e=t.readByte(),i=0;e>i;i++){for(var n=t.readShort(),s=t.readShort(),o=s,a=0;o>0;)a=1==(1&o)?a+1:a,o=MathUtils.toInteger(o>>1);this.pinTuItems[n]={pintuId:n,position:s,num:a}}},e.prototype.canReward=function(){var t=this.id;for(var e in this.pinTuItems){if(this.activationNumIsMax(this.pinTuItems[e].pintuId))return!0;for(var i=this.pinTuItems[e].pintuId,n=GlobalConfig.ActivityType24Config[t][i],s=n.consume,o=n.count,a=0;o>a;a++)if(!this.isActivation(i,a+1)&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s[a].id)>0)return!0}return!1},e.prototype.isActivation=function(t,e){var i=this.pinTuItems[t].position;return 0!=(i>>e&1)},e.prototype.hasActivationNum=function(t){return this.pinTuItems[t].num},e.prototype.activationNumIsMax=function(t){var e=GlobalConfig.ActivityType24Config[this.id][t];return this.pinTuItems[t].num>=e.count},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getHide=function(){return!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType24Data.prototype,"ActivityType24Data"),window.ActivityType24Data=ActivityType24Data;var ActivityType25Data=function(t){function e(e){var i=t.call(this,e)||this;return i.hasRecharges=[],i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.subType=t.readByte();var e=t.readByte();this.hasRecharges=[];for(var i=0;e>i;i++)this.hasRecharges.push(t.readByte())},e.prototype.hasRecharge=function(){return this.hasRecharges.length>0},e.prototype.hasRechargeById=function(t){return-1!=this.hasRecharges.indexOf(t)},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Recharge.ins().getRechargeData(0);if(!t||0==t.num)return!1;var e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>e&&i>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType25Data.prototype,"ActivityType25Data"),window.ActivityType25Data=ActivityType25Data;var ActivityType26Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.canReward=function(){var t=GlobalConfig.ActivityType26Config[this.id];for(var e in t){var i=t[e].consume,n=!0;for(var s in i)BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i[s].id)<i[s].count&&(n=!1);if(n)return!0}return!1},e.prototype.postRewardResult=function(t){for(var e=(t.readShort(),t.readByte()),i=[],n=0;e>n;n++){var s=new RewardData;s.type=t.readByte(),s.id=t.readInt(),s.count=t.readInt(),i.push(s)}i.length>0&&ViewManager.ins().open(EncounterTreasureTipsView,i)},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType26Data.prototype,"ActivityType26Data"),window.ActivityType26Data=ActivityType26Data;var ActivityType27Data=function(t){function e(e){var i=t.call(this,e)||this;return i.hasGetInfo=[],i.init(e),i}return __extends(e,t),e.prototype.init=function(t,e){this.hasGetInfo=[];for(var i=t.readByte(),n=0;i>n;n++)this.hasGetInfo.push(t.readByte())},e.prototype.update=function(t){t.readShort(),this.rewardIndex=t.readByte()},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType27Data.prototype,"ActivityType27Data"),window.ActivityType27Data=ActivityType27Data;var ActivityType28Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){for(var e=t.readShort(),i=0,n=1;4>=n;n++)i=1==(e>>n&1)?i+1:i;this.pinTuItem={position:e,num:i}},e.prototype.isActivation=function(t){var e=this.pinTuItem.position;return 0!=(e>>t&1)},e.prototype.hasActivationNum=function(){return this.pinTuItem.num},e.prototype.activationNumIsMax=function(){return this.pinTuItem.num>=4},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType28Data.prototype,"ActivityType28Data"),window.ActivityType28Data=ActivityType28Data;var ActivityType29Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.num=t.readUnsignedShort(),this.times=t.readUnsignedByte()},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType29Config[this.id];if(this.num>=t.lotteryMax)return!1;var e=GlobalConfig.ActivityType29Config[this.id].consume,i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.id);return i<e.count?!1:!0},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType29Data.prototype,"ActivityType29Data"),window.ActivityType29Data=ActivityType29Data;var ActivityType2Data=function(t){function e(e){var i=t.call(this,e)||this;return i.buyData=[],i.serverBuyData=[],i.areaBuyData=[],i.areabuyReward=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),n=e.readInt();this.buyData[i]=n,this.serverBuyData[i]=e.readInt(),this.areaBuyData[i]=e.readInt(),this.areabuyReward[i]=e.readInt(),this.areaBuyData[i]=Math.max(this.areaBuyData[i],this.serverBuyData[i])},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.buyData[i]=t.readShort(),this.serverBuyData[i]=t.readShort(),this.areaBuyData[i]=t.readInt(),this.areabuyReward[i]=t.readInt();for(var n=0;e>=n;n++)this.areaBuyData[n]=Math.max(this.areaBuyData[n],this.serverBuyData[n]);this.sumRMB=t.readInt()},e.prototype.canReward=function(){if(Actor.level<e.LimitLevel)return!1;var t=Activity.ins().getActivityDataById(this.id),i=GlobalConfig.ActivityType2Config[this.id],n=!1;for(var s in i){var o=i[s],a=t.buyData[o.index]>=o.count?!0:!1;if(n=this.serverBuyData[o.index]>=o.scount?!0:!1,!a&&t.sumRMB>=o.needRecharge&&Actor.yb>=o.price&&Actor.vip>=o.vip&&!n)return!0;if(a&&o.countReward)for(var r in o.countReward)if(this.getAreaReward(o.index,Number(r)+1))return!0}return!1},e.prototype.isSpecialOpen=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),i=GlobalConfig.ActivityType2Config[this.id][1],n=Number(i.limitTime[0]),s=Number(i.limitTime[1]);return 0>t+3600*n+60*s&&e>0?!0:!1},e.prototype.getSpecialStrikeTimes=function(){var t=GlobalConfig.ActivityType2Config[this.id][1],e=Number(t.limitTime[0]),i=Number(t.limitTime[1]),n=(GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime)-36e5*e-6e4*i)/1e3/240;return n>0?n:0},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;for(var t=GlobalConfig.ActivityType2Config[this.id],e=1;e<this.buyData.length;e++){var i=t[e];if(this.buyData[e]<i.count)return this.isHide=!1,this.isHide;if(i.countReward)for(var n=0;n<i.countReward.length;n++)if(this.getAreaReward(i.index,Number(n)+1)!=Activity.Geted)return this.isHide=!1,this.isHide}return this.isHide=!0,this.isHide},e.prototype.getLeftTime=function(){if(this.endTime){var t=DateUtils.formatMiniDateTime(this.endTime),e=Math.floor((t-GameServer.serverTime)/1e3);return 0>e&&(e=0),e}var i=GlobalConfig.ActivityConfig[this.id],n=0,s=0;if(0==i.timeType){var o=+i.startTime.split("-")[0];s=+i.endTime.split("-")[0]-o,n=GameServer.serverOpenDay-o}else if(1==i.timeType){var o=GameServer.serverTime,a=DateUtils.formatMiniDateTime(this.startTime),r=DateUtils.formatMiniDateTime(this.endTime);n=Math.floor((o-a)/1e3/3600/24),s=Math.round((r-a)/1e3/3600/24)}else if(2==i.timeType){var o=+i.startTime.split("-")[0];s=+i.endTime.split("-")[0]-o;var l=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime))/1e3/3600/24);n=l-o}var h=new Date(GameServer.serverTime),u=s-n;if(0>=u)return 0;var p=new Date(GameServer.serverTime);return p.setDate(h.getDate()+u),p.setHours(0,0,0,0),Math.floor((p.getTime()-GameServer.serverTime)/1e3)},e.prototype.getSpecialOpenLeftTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3),i=GlobalConfig.ActivityType2Config[this.id][1],n=Number(i.limitTime[0]),s=Number(i.limitTime[1]);return t+=3600*n+60*s,0>t&&e>0?t:0},e.prototype.getAreaReward=function(t,e){var i=GlobalConfig.ActivityType2Config[this.id][t];if(this.buyData[t]&&this.buyData[t]>=i.count){if((this.areabuyReward[t]>>e&1)>0)return Activity.Geted;if(this.areaBuyData[t]>=i.countReward[e-1].count)return Activity.CanGet}return Activity.NotReached},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.LimitLevel=50,e}(ActivityBaseData);__reflect(ActivityType2Data.prototype,"ActivityType2Data"),window.ActivityType2Data=ActivityType2Data;var ActivityType30Data=function(t){function e(e){var i=t.call(this,e)||this;return i._rewardInfo=0,i.score=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this._rewardInfo=t.readInt(),this.score=t.readUnsignedShort();var e=t.readUnsignedShort();this.taskInfo=[],this.awardInfo=[];for(var i=this.id>0?this.id:0,n=0;e>n;n++){var s=t.readUnsignedShort();this.taskInfo[s-1]={activityId:i,id:s,times:t.readInt()}}this.taskInfo.sort(this.taskSort),i>0?this.updateAwardInfo():(egret.callLater(this.updateAwardInfo,this),egret.callLater(this.updateTaskInfo,this))},e.prototype.taskSort=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.updateTaskInfo=function(){if(this.id>0)for(var t in this.taskInfo)this.taskInfo[t].activityId=this.id},e.prototype.updateAwardInfo=function(){if(this.id>0){this.awardInfo=[];var t=GlobalConfig.ActivityType30_2Config[this.id];for(var e in t){var i=t[e];this.awardInfo[i.index-1]={activityId:this.id,id:i.index,state:this.getAwardStateById(i.index)}}this.awardInfo.sort(this.awardSort)}},e.prototype.awardSort=function(t,e){return 2==t.state&&2!=e.state?1:2!=t.state&&2==e.state?-1:Algorithm.sortAsc(t.id,e.id)},e.prototype.getAwardStateById=function(t){return(this._rewardInfo>>t&1)>0?2:this.score>=GlobalConfig.ActivityType30_2Config[this.id][t].score?1:0},e.prototype.canReward=function(){for(var t in this.awardInfo){var e=this.awardInfo[t];if(1==e.state)return!0}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType30Data.prototype,"ActivityType30Data"),window.ActivityType30Data=ActivityType30Data;var ActivityType31Data=function(t){function e(e){var i=t.call(this,e)||this;return i.totalPoint=0,i.curTimes=0,i.cd=0,i.score=0,i.reward=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.totalPoint=t.readUnsignedShort(),this.curTimes=t.readUnsignedShort(),this.cd=1e3*t.readInt()+egret.getTimer(),this.score=t.readUnsignedShort(),this.reward=t.readInt()},e.prototype.getAwardStateById=function(t){return(this.reward>>t&1)>0?2:this.score>=GlobalConfig.ActivityType31_1Config[this.id][t].score?1:0
},e.prototype.canReward=function(){if(this.curTimes>0)return!0;var t=GlobalConfig.ActivityType31_1Config[this.id];for(var e in t)if(1==this.getAwardStateById(t[e].index))return!0;return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType31Data.prototype,"ActivityType31Data"),window.ActivityType31Data=ActivityType31Data;var ActivityType32Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.infos=[];for(var e=t.readUnsignedShort(),i=0;e>i;i++){var n={id:t.readUnsignedShort(),roleName:t.readString(),sex:t.readByte(),job:t.readByte(),rewardState:t.readByte(),actId:this.id};this.infos.push(n)}this.id||egret.callLater(this.initInfo,this)},e.prototype.initInfo=function(){for(var t in this.infos)this.infos[t].actId=this.id},e.prototype.canReward=function(){for(var t in this.infos)if(1==this.infos[t].rewardState)return!0;return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType32Data.prototype,"ActivityType32Data"),window.ActivityType32Data=ActivityType32Data;var ActivityType33Data=function(t){function e(e){var i=t.call(this,e)||this;return i.dabiao=[],i.chongzhiNum=0,i.chongzhiTotal=0,i.addTargetNum=0,i.addTargetState=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){var e=t.readShort();this.dabiao=[];for(var i=0;e>i;i++)this.dabiao.push(t.readShort());this.chongzhiNum=t.readInt(),this.chongzhiTotal=t.readInt(),this.recrod=t.readInt(),this.addTargetNum=t.readUnsignedInt(),this.addTargetState=t.readUnsignedInt()},e.prototype.curOpenDay=function(){var t=GameServer.serverTime,e=DateUtils.formatMiniDateTime(this.startTime),i=Math.floor((t-e)/1e3/3600/24);return i},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType33_1Config[this.id][1];if(this.addTargetNum>=t.target&&0==(this.addTargetState>>t.index&1))return!0;for(var e=0;e<this.dabiao.length;e++)if(1==this.dabiao[e]&&0==(this.recrod>>e+1&1))return!0;return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType33Data.prototype,"ActivityType33Data"),window.ActivityType33Data=ActivityType33Data;var ActivityType34Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.goods=[];for(var e=t.readUnsignedShort(),i=0;e>i;i++){var n={id:t.readUnsignedInt(),num:t.readUnsignedShort(),allServerNum:t.readUnsignedInt()};this.goods.push(n)}},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType34Data.prototype,"ActivityType34Data"),window.ActivityType34Data=ActivityType34Data;var ActivityType35Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.state=t.readByte()},e.prototype.canReward=function(){return 1==this.state},e.prototype.isOpenActivity=function(){var t=Recharge.ins().getRechargeData(0);if(!t||0==t.num)return!1;var e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>e&&i>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType35Data.prototype,"ActivityType35Data"),window.ActivityType35Data=ActivityType35Data;var AverageUtils=function(){function t(t){void 0===t&&(t=10),this.nums=[],this.numsLen=0,this.numSum=0,this.maxNum=t}return t.prototype.push=function(t){this.numsLen>this.maxNum&&(this.numsLen--,this.numSum-=this.nums.shift()),this.nums.push(t),this.numSum+=t,this.numsLen++},t.prototype.getValue=function(){return this.numSum/this.numsLen},t.prototype.clear=function(){this.nums.splice(0),this.numsLen=0,this.numSum=0},t}();__reflect(AverageUtils.prototype,"AverageUtils");var ActivityType37Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.updateBossInfo=function(t){var e=t.readUnsignedShort();this.bossInfo=[];for(var i=0;e>i;i++){var n=new WorldBossItemData;n.id=t.readUnsignedShort();t.readInt();n.relieveTime=DateUtils.formatMiniDateTime(t.readInt())-GameServer.serverTime+egret.getTimer(),n.bossState=t.readUnsignedByte(),n.lastWinnerId=t.readUnsignedInt(),n.lastWinnerServerId=t.readUnsignedInt(),this.bossInfo.push(n)}},e.prototype.getBossInfo=function(){return this.bossInfo?this.bossInfo[0]:null},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType37Data.prototype,"ActivityType37Data"),window.ActivityType37Data=ActivityType37Data;var ActivityType38Data=function(t){function e(e){var i=t.call(this,e)||this;return i.currGetTotal=0,i.hasRecharge=!1,i.currVipTotal=0,i.currentNum=0,i.getMoney=0,i.vipGetMoney=0,i.num=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.currData=[],this.currGetTotal=t.readInt(),this.hasRecharge=1==t.readByte(),this.currVipTotal=t.readInt(),this.currentNum=t.readShort();for(var e=0;e<this.currentNum;e++)this.currData.push(t.readString())},e.prototype.canReward=function(){return this.currVipTotal>0&&this.hasRecharge},e.prototype.postHongBaoData=function(t){this.datas=[],t.readShort(),this.getMoney=t.readInt(),this.vipGetMoney=t.readInt(),this.hasRecharge=1==t.readByte(),this.currVipTotal=t.readInt(),this.num=t.readShort();for(var e=0;e<this.num;e++)this.datas.push(t.readString());this.openHongbaoOpenWin()},e.prototype.openHongbaoOpenWin=function(){ViewManager.ins().open(NewHongBaoOpenWin)},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},__decorate([post()],e.prototype,"postHongBaoData",null),e}(ActivityBaseData);__reflect(ActivityType38Data.prototype,"ActivityType38Data"),window.ActivityType38Data=ActivityType38Data;var ActivityType39Data=function(t){function e(e){var i=t.call(this,e)||this;return i.number=0,i.signType=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.number=t.readUnsignedInt()},e.prototype.postRewardResult=function(t){t.readUnsignedShort(),this.signType=t.readUnsignedShort(),this.number=t.readUnsignedInt()},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},Object.defineProperty(e.prototype,"curSignId",{get:function(){return this.number+(this.isFinish()?0:1)},enumerable:!0,configurable:!0}),e.prototype.isFinish=function(){return null==GlobalConfig.ActivityType39Config[this.id][this.number+1]},__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType39Data.prototype,"ActivityType39Data"),window.ActivityType39Data=ActivityType39Data;var ColorUtil=function(){function t(){}return t.mergeARGB=function(t,e,i,n){return t<<24|e<<16|i<<8|n},t.getChannel=function(t,e){switch(e){case this.ALPHA:return t>>24&255;case this.RED:return t>>16&255;case this.GREEN:return t>>8&255;case this.BLUE:return 255&t}return 0},t.numberToString=function(t,e){return void 0===e&&(e="#"),e+t.toString(16)},t.ALPHA=4080082432,t.RED=15937822,t.GREEN=3532333,t.BLUE=255,t.GRAY=9144715,t.NORMAL_COLOR=13746831,t.RED_COLOR_N=15937822,t.GREEN_COLOR_N=3532333,t.GRAY_COLOR2=8618883,t.WHITE_COLOR2=13746831,t.WHITE_COLOR="#D1C28F",t.RED_COLOR="#F3311E",t.GREEN_COLOR="#35E62D",t.GRAY_COLOR="#8B898B",t.COLOR_STR=["白色","绿色","紫色","橙色","红色","金色"],t.ROLENAME_COLOR_YELLOW=16764427,t.ROLENAME_COLOR_GREEN=3532333,t.ROLENAME_COLOR_NORMAL=3532333,t.JUEWEI_COLOR=["#e2dfd4","#35e62d","#81adff","#e27dff","#ff9649","#fc5959","#ffd93f","#ffff00"],t}();__reflect(ColorUtil.prototype,"ColorUtil"),window.ColorUtil=ColorUtil;var ActivityType40Data=function(t){function e(e){var i=t.call(this,e)||this;return i.score=0,i.exchangeNums={},i.job=["","战士","法师","道士"],i.lottery=0,i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.lottery=t.readInt(),this.score=t.readUnsignedInt();var e=t.readUnsignedByte();this.exchangeNums={};for(var i=0;e>i;i++)this.exchangeNums[t.readUnsignedByte()]=t.readUnsignedByte();e=t.readUnsignedByte(),this.logs=[];for(var i=0;e>i;i++){var n=t.readString(),s=t.readInt(),o=(t.readInt(),GlobalConfig.ItemConfig[s]),a=void 0,r=ItemUtil.getQualityColor(o),l=ItemUtil.getType(o);a=0==l?"<font color = '#12b2ff'>"+n+"</font> 获得 <font color='"+r+"'>"+this.makeNameList(o)+"</font>":"<font color = '#12b2ff'>"+n+"</font> 获得 <font color='"+r+"'>"+o.name+"</font>",this.logs.push(a)}},e.prototype.makeNameList=function(t){var e=t.name;return e+=t.zsLevel>0?"("+t.zsLevel+"转 ":"("+t.level+"级 ",e+=this.job[ItemUtil.getJob(t)]+")"},e.prototype.postRewardResult=function(t){var i=t.readUnsignedShort(),n=t.readUnsignedShort();e.RewardResultId[this.id]=n>1?0:i,e.RewardResultItem=null,this.awards=[];for(var s=0;n>s;s++)t.readUnsignedByte(),this.awards[s]=[t.readInt(),t.readInt()],e.RewardResultItem||(e.RewardResultItem=this.awards[s]);e.ShowRoll?Timer.start(n>1?2e3:4e3,1,this.showRewards,this):this.showRewards()},e.prototype.showRewards=function(){(this.awards.length>1||2==GlobalConfig.ActivityType40Config[this.id][1].showType)&&(ViewManager.ins().isShow(HuntResultWin)||ViewManager.ins().open(HuntResultWin,this.awards.length>1?10:0,this.awards,4,this.id),Activity.ins().postHuntResult(this.awards.length>1?10:0,this.awards,4,this.id))},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType40Config[this.id][1],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.itemId);return e>=10?!0:this.scoreReward()||this.lotteryReward()},e.prototype.lotteryReward=function(){var t=GlobalConfig.ActivityType40_1Config[this.id];for(var e in t){var i=t[e];if(i.lotteryCount&&this.exchangeNums[i.index]<i.count&&this.lottery>=i.lotteryCount)return!0}return!1},e.prototype.scoreReward=function(){var t=GlobalConfig.ActivityType40_1Config[this.id];for(var e in t){var i=t[e];if(i.score&&this.exchangeNums[i.index]<i.count&&this.score>=i.score)return!0}return!1},e.prototype.getStateByIndex=function(t){var e=this.exchangeNums[t];if(0==e){var i=GlobalConfig.ActivityType40_1Config[this.id][t];i&&i.lotteryCount&&(e=this.lottery>=i.lotteryCount?1:0)}else e=2;return e},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.RewardResultId=[],e.ShowRoll=!1,__decorate([post()],e.prototype,"postRewardResult",null),e}(ActivityBaseData);__reflect(ActivityType40Data.prototype,"ActivityType40Data"),window.ActivityType40Data=ActivityType40Data;var ActivityType41Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.hasBuy=1==t.readByte()},e.prototype.canReward=function(){var t=GlobalConfig.ActivityType41Config[this.id];if(!t)return!1;var e=TaskCT.ins().getInvestmentAllTask(t.taskid);if(!e||!e.tasks)return!1;for(var i in e.tasks)if(1==e.tasks[i].status)return!0;return!1},e.prototype.getCanGetRewardId=function(){var t=GlobalConfig.ActivityType41Config[this.id],e=TaskCT.ins().getInvestmentAllTask(t.taskid);if(!e||!e.tasks)return 0;for(var i in e.tasks)if(1==e.tasks[i].status)return e.tasks[i].taskIndex;return 0},e.prototype.getCurDay=function(){var t=GlobalConfig.ActivityType41Config[this.id],e=TaskCT.ins().getInvestmentAllTask(t.taskid),i=0;if(!e||!e.tasks)return i;for(var n in e.tasks)switch(e.tasks[n].status){case 1:case 2:i++}return TaskCT.ins().dayNum=i,i},e.prototype.isOpenActivity=function(){if(this.hasBuy)return!0;var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(ActivityBaseData);__reflect(ActivityType41Data.prototype,"ActivityType41Data"),window.ActivityType41Data=ActivityType41Data;var CommonUtils=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getKeyboard=function(t,e){if("7000183"==urlParam.appid&&window.mz){var i=void 0;switch(t){case 0:i=30;break;case 1:i=100;break;case 2:i=GlobalConfig.FriendLimit.contentLimit}window.mz.showKeyboard({defaultValue:e,maxLength:i,multiple:!1,confirmHold:!0,confirmType:!1}),window.mz.onKeyboardConfirm(function(t){GameLogic.ins().postInputText(t.value)})}},e.addLableStrokeColor=function(t,e,i){t.strokeColor=e,t.stroke=i},e.getObjectLength=function(t){var e=0;for(var i in t)e++;return e},e.getObjectByAttr=function(t,e,i){for(var n in t)if(t[n][e]==i)return t[n];return null},e.getObjectByUnionAttr=function(t,e,i){for(var n in t)if(n==e.toString())for(var s in t[n])if(s==i.toString())return t[n][s];return null},e.copyDataHandler=function(t){var e;if(t instanceof Array)e=[];else{if(!(t instanceof Object))return t;e={}}for(var i=Object.keys(t),n=0,s=i.length;s>n;n++){var o=i[n];e[o]=this.copyDataHandler(t[o])}return e},e.objectToArray=function(t){if(t instanceof Object){t=this.copyDataHandler(t);for(var e=[],i=Object.keys(t),n=0,s=i.length;s>n;n++){var o=i[n];t[o]&&e.push(t[o])}return e}return t},e.objectToArrayShallow=function(t){if(t instanceof Object){var e=[];for(var i in t)null!=t[i]&&e.push(t[i]);return e}return t},e.arraySort=function(t,e,i){return void 0===i&&(i=SortType.Asc),t.sort(function(t,n){return e?i==SortType.Asc?Algorithm.sortAsc(t[e],n[e]):Algorithm.sortDesc(t[e],n[e]):i==SortType.Asc?Algorithm.sortAsc(t,n):Algorithm.sortDesc(t,n)}),t},e.lock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=!1},e.unlock=function(){StageUtils.ins().getStage().touchEnabled=StageUtils.ins().getStage().touchChildren=!0},e.labelIsOverLenght=function(t,e){t.text=this.overLength(e)},e.getDimond=function(){var t=this,e=new eui.Group;e.left=0,e.top=35;var i=new eui.Image;i.source="ziyuan_bg_png",e.addChild(i);var n=new eui.Image;n.left=0,n.source="ziyuan_zuanshi_png",e.addChild(n);var s=new eui.Label;return s.right=25,s.verticalCenter=1,window.h5gamecn&&window.h5gamecn.getBalance&&window.h5gamecn.getBalance(function(e){s.text=t.overLengthTwo(+e.balance)}),e.addChild(s),e},e.overLengthTwo=function(t){var e=null;return 1e4>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(100*t)/100,e=t+"亿"):(t/=1e4,t=Math.floor(100*t)/100,e=t+"万"),e},e.overLength=function(t){var e=null;return 1e5>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10,e=t+"万"),e},e.overLengthChange=function(t){var e=null;return 1e4>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10,e=t+"万"),e},e.overLengthNo=function(t){var e=null;return 1e4>t?e=Math.floor(t)+"":t>1e8?(t/=1e8,t=Math.floor(10*t)/10>>0,e=t+"亿"):(t/=1e4,t=Math.floor(10*t)/10>>0,e=t+"万"),e},e}(BaseClass);__reflect(CommonUtils.prototype,"CommonUtils"),window.CommonUtils=CommonUtils;var SortType;!function(t){t[t.Asc=0]="Asc",t[t.Desc=1]="Desc"}(SortType||(SortType={}));var ActivityType43Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){t.readByte(),t.readByte()},e.prototype.canReward=function(){return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e}(ActivityBaseData);__reflect(ActivityType43Data.prototype,"ActivityType43Data"),window.ActivityType43Data=ActivityType43Data;var ActivityType4Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.updateData=function(t){},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.getCostRank=function(t,e){if(!t)return 0;for(var i=0,n=t.numType,s=GlobalConfig.ActivityType4Config[this.id];s[e.idx];){if(n>=s[e.idx].value){i=s[e.idx].ranking,e.idx++,t.rankIndex==Activity.ins().myPaiming&&(this.myPaiming=i);break}e.idx++}return i},e.prototype.getLeftTime=function(){if(this.endTime){var t=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&(t=0),t}return 0},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.getAttrDesc=function(t){switch(t){case RankDataType.TYPE_BAOSHI:return"我的淬炼总等级：";case RankDataType.TYPE_LONGHUN:return"我的龙印总等级：";case RankDataType.TYPE_WING:return"我的翅膀总等阶：";case RankDataType.TYPE_BOOK:return"我的图鉴总战力：";case RankDataType.TYPE_ZS:return"我的总转生：";case RankDataType.TYPE_SCORE:return"我的装备总评分：";case RankDataType.TYPE_HF_XIAOFEI:return"我的消费：";case RankDataType.TYPE_RING:return"我的神戒等级：";case RankDataType.TYPE_YUANSHEN:return"我的元神等级：";case RankDataType.TYPE_HEIRLOOM:return"我的龍装总战力：";case RankDataType.TYPE_SHENSHOU:return"我的神兽总战力：";case RankDataType.TYPE_HEARTMETHOD:return"我的秘籍总星级：";case RankDataType.TYPE_SKIRMISH:return"我的PK排名：";case RankDataType.TYPE_MOSHEN:return"我的魔神总星级：";default:return""}},e.prototype.getMyRank=function(){var t="空",e="20名以后",i=GlobalConfig.ActivityType4Config[this.id][0].rankType;switch(i){case RankDataType.TYPE_BAOSHI:t=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case RankDataType.TYPE_LONGHUN:t=LongHunData.getLongHunAllLevel()+"";break;case RankDataType.TYPE_WING:t=WingsData.getWingAllLevel()+"";break;case RankDataType.TYPE_BOOK:t=Book.ins().getBookPowerNumEx()+"";break;case RankDataType.TYPE_ZS:t=ZsCT.ins().lv+"";break;case RankDataType.TYPE_SCORE:t=BagCT.ins().getEquipsScoreByRolesOfBody()+"";break;case RankDataType.TYPE_HF_XIAOFEI:t=Activity.ins().myDabiaoInfo?Activity.ins().myDabiaoInfo:0,this.myPaiming&&(e=this.myPaiming+"");break;case RankDataType.TYPE_RING:var n=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);t=(n?n.level:0)+"";break;case RankDataType.TYPE_YUANSHEN:t=YuanshenData.ins().yuanShenLv+""}return[t,e]},e.prototype.getRankName=function(t){switch(t){case RankDataType.TYPE_BAOSHI:return"淬炼";case RankDataType.TYPE_LONGHUN:return"龙印";case RankDataType.TYPE_WING:return"翅膀";case RankDataType.TYPE_BOOK:return"图鉴";case RankDataType.TYPE_ZS:return"转生";case RankDataType.TYPE_SCORE:return"装备";case RankDataType.TYPE_HF_XIAOFEI:return"消费";case RankDataType.TYPE_RING:return"神戒";case RankDataType.TYPE_YUANSHEN:return"元神";case RankDataType.TYPE_HEIRLOOM:return"龍装";case RankDataType.TYPE_SHENSHOU:return"神兽";case RankDataType.TYPE_HEARTMETHOD:return"秘籍";case RankDataType.TYPE_SKIRMISH:return"PK";case RankDataType.TYPE_MOSHEN:return"魔神";default:return""}},e.prototype.getTypeDesc=function(t){switch(t){case RankDataType.TYPE_BAOSHI:return"淬炼等级";case RankDataType.TYPE_LONGHUN:return"龙印等级";case RankDataType.TYPE_WING:return"翅膀等阶";case RankDataType.TYPE_BOOK:return"图鉴战力";case RankDataType.TYPE_ZS:return"转生等级";case RankDataType.TYPE_SCORE:return"装备评分";case RankDataType.TYPE_HF_XIAOFEI:return"消费元宝";case RankDataType.TYPE_RING:return"神戒等级";case RankDataType.TYPE_YUANSHEN:return"元神等级";case RankDataType.TYPE_HEIRLOOM:return"龍装战力";case RankDataType.TYPE_SHENSHOU:return"神兽战力";case RankDataType.TYPE_HEARTMETHOD:return"秘籍星级";case RankDataType.TYPE_SKIRMISH:return"PK";case RankDataType.TYPE_MOSHEN:return"魔神星级";default:return""}},e}(ActivityBaseData);__reflect(ActivityType4Data.prototype,"ActivityType4Data"),window.ActivityType4Data=ActivityType4Data;var DateStyle=function(t){function e(e,i,n,s){var o=t.call(this)||this;return o.format=[],o.from=0,o.to=0,o.isFormatNum=!1,o.format=e,o.from=i,o.to=n,o.isFormatNum=s,o}return __extends(e,t),e}(BaseClass);__reflect(DateStyle.prototype,"DateStyle");var DateUtils=function(){function t(){}return t.getFormatTimeByStyle=function(e,i){if(void 0===i&&(i=t.STYLE_1),0>e&&(e=0,console.log("输入参数有误!时间为负数:"+e)),i.from>i.to)return console.log("输入参数有误!to参数必须大于等于from参数,请检查style参数的值"),"";e>>=0;for(var n="",s=i.to;s>=i.from;s--){var o=e/this.mul[s],a="";s!=i.to&&(o%=this.mod[s]),a=i.isFormatNum&&10>o?"0"+(o>>0).toString():(o>>0).toString(),n+=a+i.format[s]}return n},t.getFormatTimeByStyle1=function(e,i){return void 0===i&&(i=t.STYLE_1),this.getFormatTimeByStyle(e/this.MS_PER_SECOND)},t.formatMiniDateTime=function(e){return t.MINI_DATE_TIME_BASE+(2147483647&e)*t.MS_PER_SECOND},t.formatServerTime=function(e){return(e-t.MINI_DATE_TIME_BASE)/t.MS_PER_SECOND},t.getFormatBySecond=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=2);var n="",s=1e3*t;switch(e){case this.TIME_FORMAT_1:n=this.format_1(s);break;case this.TIME_FORMAT_2:n=this.format_2(s);break;case this.TIME_FORMAT_3:n=this.format_3(s);break;case this.TIME_FORMAT_4:n=this.format_4(s);break;case this.TIME_FORMAT_5:n=this.format_5(s,i);break;case this.TIME_FORMAT_6:n=this.format_6(s);break;case this.TIME_FORMAT_7:n=this.format_7(s);break;case this.TIME_FORMAT_8:n=this.format_8(s);break;case this.TIME_FORMAT_9:n=this.format_9(s);break;case this.TIME_FORMAT_10:n=this.format_10(s);break;case this.TIME_FORMAT_11:n=this.format_11(s);break;case this.TIME_FORMAT_12:n=this.format_12(s);break;case this.TIME_FORMAT_13:n=this.format_13(s);break;case this.TIME_FORMAT_14:n=this.format_14(s);break;case this.TIME_FORMAT_15:n=this.format_15(s);break;case this.TIME_FORMAT_16:n=this.format_16(s);break;case this.TIME_FORMAT_17:n=this.format_17(s);break;case this.TIME_FORMAT_18:n=this.format_18(s)}return n},t.getRenainSecond=function(e){var i=e?new Date(e):new Date,n=t.getTodayZeroSecond(i)+86400-i.getTime()/1e3;return n.toFixed(0)},t.getTodayPassedSecond=function(){var t=new Date,e=((Date.now()-new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime())/1e3).toFixed(0);return parseInt(e)},t.getTodayZeroSecond=function(t){var e=t?t:new Date;return parseInt((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()/1e3).toFixed(0))},t.showWeekFirstDay=function(){var t=new Date(GameServer.serverTime),e=t.getDay();e=e?e:7;var i=new Date(t-864e5*(e-1));return i},t.showWeekLastDay=function(){var e=(new Date,t.showWeekFirstDay()),i=new Date(1e3*(e/1e3+518400));return i},t.getCurrentMonthLast=function(){var e=new Date(GameServer.serverTime),i=e.getMonth(),n=++i,s=new Date(e.getFullYear(),n,1);return new Date(s.getTime()-t.MS_PER_DAY)},t.calcWeekFirstDay=function(){var t=new Date,e=t.getDay();e=e>0?e:7;var i=7-e,n=t.getHours(),s=t.getMinutes(),o=t.getSeconds(),a=86400*i*1e3+864e5-(3600*n*1e3+60*s*1e3+1e3*o);return new Date(a)},t.format_1=function(e){var i=0,n="##:##:##";return i=Math.floor(e/t.MS_PER_HOUR),n=n.replace("##",t.formatTimeNum(i)),i&&(e-=i*t.MS_PER_HOUR),i=Math.floor(e/t.MS_PER_MINUTE),n=n.replace("##",t.formatTimeNum(i)),i&&(e-=i*t.MS_PER_MINUTE),i=Math.floor(e/1e3),n=n.replace("##",t.formatTimeNum(i))},t.format_2=function(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),o=e.getHours(),a=e.getMinutes(),r=e.getSeconds();return i+"-"+n+"-"+s+" "+o+":"+a+":"+r},t.format_3=function(t){var e=this.format_1(t),i=e.split(":");return i[1]+":"+i[2]},t.format_4=function(t){return t<this.MS_PER_HOUR?Math.floor(t/this.MS_PER_MINUTE)+"分钟前":t<this.MS_PER_DAY?Math.floor(t/this.MS_PER_HOUR)+"小时前":Math.floor(t/this.MS_PER_DAY)+"天前"},t.format_5=function(t,e){void 0===e&&(e=2);var i="",n=["天","时","分","秒"],s=[],o=Math.floor(t/this.MS_PER_DAY);s.push(o),t-=o*this.MS_PER_DAY;var a=Math.floor(t/this.MS_PER_HOUR);s.push(a),t-=a*this.MS_PER_HOUR;var r=Math.floor(t/this.MS_PER_MINUTE);s.push(r),t-=r*this.MS_PER_MINUTE;var l=Math.floor(t/1e3);s.push(l);for(var h in s)if(s[h]>0&&(i+=this.formatTimeNum(s[h],Number(h))+n[h],e--,0>=e))break;return i},t.format_6=function(t){var e=new Date(t),i=e.getHours(),n=e.getMinutes(),s=e.getSeconds();return this.formatTimeNum(i)+":"+this.formatTimeNum(n)+":"+this.formatTimeNum(s)},t.format_7=function(t){return t<this.MS_PER_HOUR?"<1小时":t<this.MS_PER_DAY?Math.floor(t/this.MS_PER_HOUR)+"小时":Math.floor(t/this.MS_PER_DAY)+"天"},t.format_8=function(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,s=e.getDate(),o=e.getHours(),a=e.getMinutes();return i+"-"+n+"-"+s+" "+o+":"+a},t.format_9=function(t){var e=Math.floor(t/this.MS_PER_HOUR);t-=e*this.MS_PER_HOUR;var i=Math.floor(t/this.MS_PER_MINUTE);t-=i*this.MS_PER_MINUTE;var n=Math.floor(t/1e3);return e+"小时"+i+"分钟"+n+"秒"},t.format_10=function(t){var e=Math.floor(t/this.MS_PER_MINUTE);t-=e*this.MS_PER_MINUTE;var i=Math.floor(t/1e3);return e+"分"+i+"秒"},t.format_11=function(t){var e=Math.floor(t/this.MS_PER_HOUR);t-=e*this.MS_PER_HOUR;var i=Math.floor(t/this.MS_PER_MINUTE);t-=i*this.MS_PER_MINUTE;var n=Math.floor(t/1e3);return e+"时"+i+"分"+n+"秒"},t.format_12=function(e){var i=Math.floor(e/this.MS_PER_HOUR);e-=i*this.MS_PER_HOUR;var n=Math.floor(e/this.MS_PER_MINUTE);e-=n*this.MS_PER_MINUTE;var s=Math.floor(e/1e3);return t.formatTimeNum(i)+":"+t.formatTimeNum(n)+":"+t.formatTimeNum(s)},t.format_13=function(e){var i=new Date(e),n=(i.getFullYear(),i.getMonth()+1),s=i.getDay(),o=i.getDate(),a=i.getHours(),r=i.getMinutes();return n+"月"+o+"日(周"+this.WEEK_CN[s]+") "+t.formatTimeNum(a)+":"+t.formatTimeNum(r)},t.format_14=function(t){var e=new Date(t),i=e.getHours(),n=e.getMinutes();return i+"时"+n+"分"},t.format_15=function(e){var i=new Date(e),n=i.getMonth()+1,s=i.getDate(),o=i.getHours(),a=i.getMinutes();return t.formatTimeNum(n)+"-"+t.formatTimeNum(s)+" "+t.formatTimeNum(o)+":"+t.formatTimeNum(a)},t.format_16=function(e){var i=0,n="##:##:##";return i=Math.floor(e/t.MS_PER_MINUTE),n=n.replace("##",t.formatTimeNum(i)),i&&(e-=i*t.MS_PER_MINUTE),i=Math.floor(e/1e3),n=n.replace("##",t.formatTimeNum(i)),i&&(e-=1e3*i),i=Math.floor(e%1e3),n=n.replace("##",t.formatTimeNum(i))},t.format_17=function(t){var e="",i=["天","时","分","秒",""],n=[],s=Math.floor(t/this.MS_PER_DAY);n.push(s),t-=s*this.MS_PER_DAY;var o=Math.floor(t/this.MS_PER_HOUR);n.push(o),t-=o*this.MS_PER_HOUR;var a=Math.floor(t/this.MS_PER_MINUTE);n.push(a),t-=a*this.MS_PER_MINUTE;var r=Math.floor(t/1e3);n.push(r),t-=1e3*r,n.push(Math.floor(t/10));for(var l in n)(n[l]>0||""!=e)&&(e+=this.formatTimeNum(n[l],Number(l))+i[l]);return e},t.format_18=function(t){var e=new Date(t),i=e.getMonth()+1,n=e.getDate(),s=e.getHours(),o=e.getMinutes(),a=e.getSeconds();return i+"/"+n+" "+this.formatTimeNum(s)+":"+this.formatTimeNum(o)+":"+this.formatTimeNum(a)},t.formatTimeNum=function(t,e){return t>=10?t.toString():0==e?t.toString():"0"+t},t.checkTime=function(t,e){var i=(new Date).getTime(),n=t>i+e*this.MS_PER_DAY;return n},t.formatFullTime=function(t){var e,i,n=new Date(t),s=n.getFullYear(),o=n.getMonth()+1,a=n.getDate(),r=n.getDay(),l=n.getHours();i=10>l?"0"+l:l.toString();var h,u=n.getMinutes();h=10>u?"0"+u:u.toString();var p;switch(r){case 1:p="一";break;case 2:p="二";break;case 3:p="三";break;case 4:p="四";break;case 5:p="五";break;case 6:p="六";break;case 0:p="日"}return e=s+"年"+o+"月"+a+"日（周"+p+"） "+i+":"+h},t.formatStrTimeToMs=function(t){var e=new Date,i=t.split(".");e.setFullYear(+i[0]),e.setMonth(+i[1]-1);var n=i[2].split("-");e.setDate(n[0]);var s=n[1].split(":");return e.setHours(s[0]),e.setMinutes(s[1]),e.setSeconds(0),e.getTime()},t.TIME_FORMAT_1=1,t.TIME_FORMAT_2=2,t.TIME_FORMAT_3=3,t.TIME_FORMAT_4=4,t.TIME_FORMAT_5=5,t.TIME_FORMAT_6=6,t.TIME_FORMAT_7=7,t.TIME_FORMAT_8=8,t.TIME_FORMAT_9=9,t.TIME_FORMAT_10=10,t.TIME_FORMAT_11=11,t.TIME_FORMAT_12=12,t.TIME_FORMAT_13=13,t.TIME_FORMAT_14=14,t.TIME_FORMAT_15=15,t.TIME_FORMAT_16=16,t.TIME_FORMAT_17=17,t.TIME_FORMAT_18=18,t.MS_PER_SECOND=1e3,t.MS_PER_MINUTE=6e4,t.MS_PER_HOUR=36e5,t.MS_PER_DAY=864e5,t.SECOND_PER_HOUR=3600,t.SECOND_PER_DAY=86400,t.SECOND_PER_MONTH=2592e3,t.SECOND_PER_YEAR=31104e3,t.DAYS_PER_WEEK=7,t.YEAR_PER_YEAR=1,t.MONTH_PER_YEAR=12,t.DAYS_PER_MONTH=30,t.HOURS_PER_DAY=24,t.MUNITE_PER_HOUR=60,t.SECOND_PER_MUNITE=60,t.SECOND_PER_SECOND=1,t.SECOND_2020=1577808e3,t.mod=[t.SECOND_PER_MUNITE,t.MUNITE_PER_HOUR,t.HOURS_PER_DAY,t.DAYS_PER_MONTH,t.MONTH_PER_YEAR,t.YEAR_PER_YEAR],t.mul=[t.SECOND_PER_SECOND,t.SECOND_PER_MUNITE,t.SECOND_PER_HOUR,t.SECOND_PER_DAY,t.SECOND_PER_MONTH,t.SECOND_PER_YEAR],t.MINI_DATE_TIME_BASE=Date.UTC(2020,0)+(new Date).getTimezoneOffset()*t.MS_PER_MINUTE,t.TIME_ZONE_OFFSET=8*t.MS_PER_HOUR,t.TO_SECOND=0,t.TO_MINUTE=1,t.TO_HOUR=2,t.TO_DAY=3,t.TO_MONTH=4,t.TO_YEAR=5,t.FORMAT_1=["秒","分","时","天","月","年"],t.FORMAT_2=[":",":",":",":",":",":"],t.WEEK_CN=["日","一","二","三","四","五","六"],t.STYLE_1=new DateStyle(t.FORMAT_1,t.TO_SECOND,t.TO_HOUR,!1),t.STYLE_2=new DateStyle(t.FORMAT_1,t.TO_SECOND,t.TO_DAY,!1),t.STYLE_3=new DateStyle(t.FORMAT_2,t.TO_SECOND,t.TO_HOUR,!0),t.STYLE_4=new DateStyle(t.FORMAT_1,t.TO_SECOND,t.TO_MINUTE,!0),t
}();__reflect(DateUtils.prototype,"DateUtils"),window.DateUtils=DateUtils;var ActivityType6Data=function(t){function e(e){var i=t.call(this,e)||this;return i.rewardsBossSum=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);e.readShort();this.record=e.readInt()},e.prototype.initBuyData=function(t){this.record=t.readInt();for(var e=t.readShort(),i=1;e>=i;i++)this.rewardsBossSum[i]=t.readShort()},e.prototype.canReward=function(){return this.checkRedPoint()},e.prototype.getBossGroup=function(t,e){for(var i=this.getBossGroupIndex(t,e),n=0;n<i.length;n++)if(!i[n])return Activity.NOKILL;return Activity.KILL},e.prototype.getBossGroupIndex=function(t,e){for(var i=[],n=t<<1,s=1;3>=s;s++){var o=Math.floor(n/Math.pow(2,s))%2;i.push(o)}return i},e.prototype.getBossGroupGiftIndex=function(t){var e=Math.floor(this.record/Math.pow(2,t.index))%2;return e?Activity.Geted:Activity.CanGet},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){var t=GlobalConfig.ActivityType6Config[this.id],e=1;for(var i in t){var n=this.getBossGroupGiftIndex(t[i]),s=this.getBossGroup(this.rewardsBossSum[e],t[i]);if(s==Activity.KILL&&n==Activity.CanGet)return!0;e++}return!1},e.prototype.getHide=function(){if(this.isHide)return this.isHide;var t=this.record>>1,e=GlobalConfig.ActivityType6Config[this.id],i=Object.keys(e);return t>=Math.pow(2,i.length)-1?(this.isHide=!0,this.isHide):(this.isHide=!1,this.isHide)},e}(ActivityBaseData);__reflect(ActivityType6Data.prototype,"ActivityType6Data"),window.ActivityType6Data=ActivityType6Data;var DeviceUtils=function(){function t(){}return Object.defineProperty(t,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsQQBrowser",{get:function(){return this.IsHtml5&&-1!=navigator.userAgent.indexOf("MQQBrowser")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsIOS",{get:function(){return 1==urlParam.ios},enumerable:!0,configurable:!0}),Object.defineProperty(t,"IsLiuHai",{get:function(){return t.IsMobile&&GlobalConfig.ClientGlobalConfig.showLiuhaiAppid&&-1!=GlobalConfig.ClientGlobalConfig.showLiuhaiAppid.indexOf(+urlParam.appid)||urlParam.liuhai?55:0},enumerable:!0,configurable:!0}),t}();__reflect(DeviceUtils.prototype,"DeviceUtils");var ActivityType8Data=function(t){function e(e){var i=t.call(this,e)||this;return i.update(e),i}return __extends(e,t),e.prototype.update=function(t){this.record=t.readInt()},e.prototype.canReward=function(){return this.checkRedPoint()||!e.open8Panel},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0?!0:!1},e.prototype.checkRedPoint=function(){return Activity.ins().getType8RedPoint(this.id)},e.prototype.getRemainTime=function(){var t,e=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return t=e>=0?"活动未开启":0>=i?"活动已结束":DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.open8Panel=!1,e.TYPE_RING=1,e}(ActivityBaseData);__reflect(ActivityType8Data.prototype,"ActivityType8Data"),window.ActivityType8Data=ActivityType8Data;var DirUtil=function(){function t(){}return t.get8DirBy2Point=function(t,e){var i=MathUtils.getAngle(MathUtils.getRadian2(t.x,t.y,e.x,e.y));return this.angle2dir(i)},t.get4DirBy2Point=function(t,e){return t.x<e.x?t.y<e.y?3:1:t.y<e.y?5:7},t.dir2angle=function(t){return t*=45,t-=90},t.angle2dir=function(t){return-90>t&&(t+=360),Math.round((t+90)/45)%8},t.dirOpposit=function(t){return 4>t?t+4:t-4},t.get5DirBy8Dir=function(t){return t-this.isScaleX(t)},t.isScaleX=function(t){var e=2*(t-4);return 0>e&&(e=0),e},t.getGridByDir=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i={x:0,y:0});var n=this.dir2angle(this.dirOpposit(t));return MathUtils.getDirMove(n,e*GameMap.CELL_SIZE,i.x,i.y)},t}();__reflect(DirUtil.prototype,"DirUtil"),window.DirUtil=DirUtil;var RewardData=function(){function t(){this.isRedPoint=0}return t.prototype.parser=function(t){this.type=t.readInt(),this.id=t.readInt(),this.count=t.readInt()},t.objectToRewardData=function(e){var i=new t;return i.id=e.id||0,i.type=e.type||0,i.count=e.count||0,i},t.getCurrencyName=function(e){return t.CURRENCY_NAME[e]},t.getCurrencyRes=function(e){return t.CURRENCY_RES[e]},t.CURRENCY_NAME={0:"经验",1:"金币",2:"元宝",3:"声望",4:"魂石",5:"公会贡献",6:"公会资金",7:"功勋",8:"成就",9:"图腾精华",10:"图腾碎片",11:"低级符文碎片",12:"高级符文碎片",13:"神兵经验",14:"威望",15:"筹码",16:"兽神精魄",20:"个人积分",21:"公会积分",99:"元宝"},t.CURRENCY_RES={1:"ZSgold",2:"ZScoin",3:"ZSshengwang",4:"ZSlingpo",0:"result_json.ZSexp",5:"ZSguildgx",6:"ZSguildfund",8:"ZSchengjiu",99:"ZScoin",7:"ZShonor",9:"500007_png",10:"500008_png",11:"hejisuipian",12:"hejisuipian1",13:"ZSexp",14:"ZSprestige",15:"ZSchip",16:"SSExp",20:"kf_yunbiao_gricon",21:"kf_yunbiao_ghicon"},t}();__reflect(RewardData.prototype,"RewardData"),window.RewardData=RewardData;var SpringBeginShopVo=function(){function t(){this.discount=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.itemID=t.readInt(),this.itemCount=t.readShort(),this.price=t.readInt(),this.discount=t.readByte(),this.state=t.readByte(),this.buyCount=t.readByte(),this.buyMax=t.readByte(),this.materialNum=t.readShort()},t.prototype.parser2=function(t){this.id=t.readInt(),this.itemID=t.readInt(),this.itemCount=t.readShort(),this.score=t.readInt()},t.prototype.parser3=function(t){this.itemID=t.readInt(),this.buyCount=t.readByte(),this.buyMax=t.readByte()},t}();__reflect(SpringBeginShopVo.prototype,"SpringBeginShopVo"),window.SpringBeginShopVo=SpringBeginShopVo;var ActivityBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data)if(2==this.data.activityType)this.iconDisplay.source=this.data.icon,this.redPoint.visible=1==CityCC.ins().bossState;else{var t=void 0,e=void 0;egret.is(this.data,"ActivityBtnConfig")?(t=this.data,e=Activity.ins()):egret.is(this.data,"PActivityBtnConfig")&&(t=this.data,e=PActivity.ins()),null!=t?(this.iconDisplay.source=t.icon,this.redPoint.visible=e.isShowRedPointByBtnInfo(t),t.light&&!e.getPalyEffListById(t.id)?(this.mc||(this.mc=new MovieClip,this.mc.x=36,this.mc.y=38),this.mc.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.addChild(this.mc)):DisplayUtils.removeFromParent(this.mc)):this.iconDisplay.source=""}},e}(FuliActBtnRenderer);__reflect(ActivityBtnRenderer.prototype,"ActivityBtnRenderer"),window.ActivityBtnRenderer=ActivityBtnRenderer;var DisplayUtils=function(){function t(){}return t.setShakeOn=function(t){this.openShake=t},t.removeFromParent=function(t){t&&null!=t.parent&&t.parent.removeChild(t)},t.shakeIt=function(e,i,n,s,o){if(void 0===s&&(s=1),void 0===o&&(o=function(){return!0}),this.openShake&&e&&!(1>s)&&o()){var a=[{anchorOffsetX:0,anchorOffsetY:-i},{anchorOffsetX:0,anchorOffsetY:+i},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(e);var r=n/a.length;egret.Tween.get(e).to(a[0],r).to(a[1],r).to(a[2],r).call(function(){t.shakeIt(e,i,n,--s)},this)}},t.shakeItHeji=function(e,i,n,s,o){if(void 0===s&&(s=1),void 0===o&&(o=function(){return!0}),this.openShake&&e&&!(1>s)&&o()){var a=[{anchorOffsetX:.1*+i,anchorOffsetY:+i},{anchorOffsetX:.1*-i,anchorOffsetY:-i},{anchorOffsetX:.1*+i,anchorOffsetY:+i},{anchorOffsetX:.1*-i,anchorOffsetY:-i},{anchorOffsetX:.1*(+i>>1),anchorOffsetY:+i>>1},{anchorOffsetX:.1*(-i>>1),anchorOffsetY:-i>>1},{anchorOffsetX:.1*(+i>>2),anchorOffsetY:+i>>2},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(e);var r=n/a.length;egret.Tween.get(e).to(a[0],r).to(a[1],r).to(a[2],r).to(a[3],r).to(a[4],r).to(a[5],r).to(a[6],r).to(a[7],r).call(function(){t.shakeIt(e,i,n,--s)},this)}},t.shakeItEntity=function(t,e,i,n,s){var o=this;if(void 0===n&&(n=1),void 0===s&&(s=function(){return!0}),this.openShake&&t&&!(1>n)&&s()){var a=[{anchorOffsetX:0,anchorOffsetY:-e},{anchorOffsetX:-e,anchorOffsetY:0},{anchorOffsetX:e,anchorOffsetY:0},{anchorOffsetX:0,anchorOffsetY:e},{anchorOffsetX:0,anchorOffsetY:0}];egret.Tween.removeTweens(t);var r=i/5;egret.Tween.get(t).to(a[0],r).to(a[1],r).to(a[2],r).to(a[3],r).to(a[4],r).call(function(){o.shakeIt(t,e,i,--n)},this)}},t.drawCir=function(t,e,i,n){return null==t&&(t=new egret.Shape),t.graphics.clear(),t.graphics.beginFill(65535,1),t.graphics.moveTo(0,0),t.graphics.lineTo(e,0),t.graphics.drawArc(0,0,e,0,i*Math.PI/180,n),t.graphics.lineTo(0,0),t.graphics.endFill(),t},t.drawrect=function(t,e,i,n){return null==t&&(t=new egret.Shape),t.graphics.clear(),t.graphics.beginFill(65535,1),t.graphics.drawRect(0,0,e,i),t.graphics.endFill(),t},t.getEffectPath=function(t){return RES_DIR_EFF+t},t.scrollerToBottom=function(t){t.viewport.validateNow(),t.viewport.contentHeight>t.height&&(t.viewport.scrollV=t.viewport.contentHeight-t.height)},t.openShake=!0,t}();__reflect(DisplayUtils.prototype,"DisplayUtils"),window.DisplayUtils=DisplayUtils;var ActivityType1ItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActLevelSonSkin",e.list.itemRenderer=ItemBase,e.rewardBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.reward,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);t.zslevel>0?this.level.source="level_"+(8+t.zslevel):this.level.source="level_"+t.level/10,this.currentState=e.getRewardStateById(t.index-1)+"",this.list.dataProvider=new eui.ArrayCollection(t.rewards)},e.prototype.reward=function(t){var e=this.data;BagCT.ins().getSurplusCount()<1&&13==this.data.index?TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):Activity.ins().sendReward(e.Id,e.index)},e}(BaseItemRender);__reflect(ActivityType1ItemRenderer.prototype,"ActivityType1ItemRenderer"),window.ActivityType1ItemRenderer=ActivityType1ItemRenderer;var ActivityType1Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActLevelSkin",e.list.itemRenderer=ActivityType1ItemRenderer,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.date.text="活动未开启":0>=i?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3),this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var n=GlobalConfig.ActivityType1Config[t.id].slice();n.sort(this.sortFunc),this.listData.replaceAll(n)},e.prototype.sortFunc=function(t,e){var i=Activity.ins().getActivityDataById(t.Id),n=i.getRewardStateById(t.index-1),s=i.getRewardStateById(e.index-1);return s>n?-1:n>s?1:t.zslevel<e.zslevel?-1:t.zslevel>e.zslevel?1:t.level<e.level?-1:t.level>e.level?1:0},e}(ActivityPanel);__reflect(ActivityType1Panel.prototype,"ActivityType1Panel"),window.ActivityType1Panel=ActivityType1Panel;var ActivityType24BtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",e.selectIcon.source="BossPingTuChoice_png",e}return __extends(e,t),e.prototype.dataChanged=function(){if(egret.is(this.data,"ActivityType24Config")){for(var t=Activity.ins().activityData[this.data.id],e=this.data.consume,i=!1,n=0;n<e.length;n++)if(!t.isActivation(this.data.subid,n+1)&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e[n].id)>0){i=!0;break}switch(this.redPoint.visible=t.activationNumIsMax(this.data.subid)||i,this.data.subid){case 1:this.iconDisplay.source="ywPingTu_btn_png";break;case 2:this.iconDisplay.source="mjPingTu_btn_png";break;case 3:this.iconDisplay.source="shengyuPingTu_btn_png";break;case 4:this.iconDisplay.source="shenyuPingTu_btn_png";break;case 5:this.iconDisplay.source="kfPingTu_btn_png"}}},e}(BaseItemRender);__reflect(ActivityType24BtnRenderer.prototype,"ActivityType24BtnRenderer"),window.ActivityType24BtnRenderer=ActivityType24BtnRenderer;var ActivityType2Panel=function(t){function e(){var e=t.call(this)||this;return e.type2PanelList=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=GlobalConfig.ActivityConfig[this.activityID];switch(i.openType){case 1:this.type2PanelList[this.activityID+""]||(this.type2PanelList[this.activityID+""]=new Activity2Panel2,this.type2PanelList[this.activityID+""].activityID=this.activityID);break;case 2:this.type2PanelList[this.activityID+""]||(this.type2PanelList[this.activityID+""]=new Activity2Panel1,this.type2PanelList[this.activityID+""].activityID=this.activityID)}this.cruPanel=this.type2PanelList[this.activityID+""],this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(ActivityType2Panel.prototype,"ActivityType2Panel"),window.ActivityType2Panel=ActivityType2Panel;var ActivityType3Panel=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="MoneyActSkin",this.list.itemRenderer=ItemBase,this.list1.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.suerBtn,this.reward),this.addTouchEvent(this.suerBtn0,this.reward),Activity.ins().sendLianxuReward(this.activityID),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.reward),this.removeTouchEvent(this.suerBtn0,this.reward)},e.prototype.updateData=function(){this.sureImg.visible=!1,this.sureImg0.visible=!1,this.activityData=Activity.ins().getActivityDataById(this.activityID);var t=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.date.text="活动未开启":0>=e?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3),this.label.textFlow=(new egret.HtmlTextParser).parser(this.activityData.day7text),this.label1.textFlow=(new egret.HtmlTextParser).parser(this.activityData.totaltext),this.activityData.chongzhiTotal>this.activityData.maxTotal&&(this.activityData.chongzhiTotal=this.activityData.maxTotal),this.label2.text="已达成"+(this.activityData.dabiao?this.activityData.dabiao[0]:0)+"/"+this.activityData.openDay()+"天",this.label3.text="已充值"+this.activityData.chongzhiTotal+"/"+this.activityData.maxTotal+"元宝",this.list.dataProvider=new eui.ArrayCollection(this.activityData.rewards1),this.list1.dataProvider=new eui.ArrayCollection(this.activityData.rewards2),this.activityData.canOnlyReward(),this.activityData.btn1?(this.mc1=this.mc1||new MovieClip,this.mc1.x=50,this.mc1.y=19,this.mc1.playFile(RES_DIR_EFF+"BtnPrompt6",-1),this.suerBtn.addChild(this.mc1)):this.mc1&&DisplayUtils.removeFromParent(this.mc1),this.activityData.btn2?(this.mc2=this.mc2||new MovieClip,this.mc2.x=50,this.mc2.y=19,this.mc2.playFile(RES_DIR_EFF+"BtnPrompt6",-1),this.suerBtn0.addChild(this.mc2)):this.mc2&&DisplayUtils.removeFromParent(this.mc2),this.sureImg0.visible=this.activityData.image1,this.sureImg.visible=this.activityData.image2,this.suerBtn.visible=!this.activityData.image1,this.suerBtn0.visible=!this.activityData.image2},e.prototype.reward=function(t){switch(t.currentTarget){case this.suerBtn:this.activityData.btn1?BagCT.ins().getSurplusCount()>=1?Activity.ins().sendReward(this.activityData.id,1):TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):TipsCT.ins().showTips("|C:0xf3311e&T:未达到活动天数！|");break;case this.suerBtn0:this.activityData.btn2?BagCT.ins().getSurplusCount()>=1?Activity.ins().sendReward(this.activityData.id,2):TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|"):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}},e}(ActivityPanel);__reflect(ActivityType3Panel.prototype,"ActivityType3Panel"),window.ActivityType3Panel=ActivityType3Panel;var ActivityType4ItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActraceSkinson",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.data.ranking>0?this.rankImg.source="rankDabiao_"+this.data.ranking:this.rankImg.source="rankDabiao_"+this.data.rankType+"_"+this.data.ranking,this.list.dataProvider=new eui.ArrayCollection(t.rewards);var e=Activity.ins().getrankInfoListByIndex(this.itemIndex);if(e){this.y=21,this.rankName.text=e.name,this.value.visible=!0;var i=void 0;switch(this.data.rankType){case RankDataType.TYPE_LEVEL:i=e.zsLevel>0?e.zsLevel+"转"+e.level+"级":e.level+"级";break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:i=CommonUtils.overLength(e.numType);break;case RankDataType.TYPE_BAOSHI:i=e.numType+"级"}this.value.text=i}else this.y=33,this.rankName.text="暂无",this.value.visible=!1},e}(BaseItemRender);__reflect(ActivityType4ItemRenderer.prototype,"ActivityType4ItemRenderer"),window.ActivityType4ItemRenderer=ActivityType4ItemRenderer;var ActivityType4Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActRaceSkin",e.list.itemRenderer=ActivityType4ItemRenderer,e.list1.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){this.updateData(),this.addTouchEvent(this.getReward,this.onClick),this.btn_showRank&&this.addTouchEvent(this.btn_showRank,this.onClick),this.btn_showRank0&&this.addTouchEvent(this.btn_showRank0,this.onClick),this.group_Rank&&(this.group_Rank.visible=!1),this.btn_showRank&&this.group_Rank&&(this.btn_showRank.label=this.group_Rank.visible?"查看奖励":"查看排行")},e.prototype.close=function(){this.removeTouchEvent(this.getReward,this.onClick),this.btn_showRank&&this.removeTouchEvent(this.btn_showRank,this.onClick),this.btn_showRank0&&this.removeTouchEvent(this.btn_showRank0,this.onClick),this.removeObserve()},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);if(e>=0)this.date.text="活动未开启";else if(0>=i)this.date.text="活动已结束";else{var n=Math.floor(i/86400),s=Math.floor(i%86400/3600),o=Math.floor(i%3600/60);this.date.text=n+"天"+s+"小时"+o+"分"}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var a=this.getDataList(t.id);this.listData.replaceAll(a);var r=this.getCurRewards();this.list1.dataProvider=new eui.ArrayCollection(r),this.refushBtnStatu();for(var l=0;4>l;l++){var h=a[l],u=Activity.ins().getrankInfoListByIndex[l],p=l+1,c=this["list_item"+p],d=this["label_nname"+p],g=this["label_value"+p],f="暂无",v="";if(u)switch(f=u.name,h.rankType){case RankDataType.TYPE_LEVEL:v=u.zsLevel>0?u.zsLevel+"转"+u.level+"级":u.level+"级";break;case RankDataType.TYPE_POWER:v=CommonUtils.overLength(u.numType);break;case RankDataType.TYPE_WING:v=CommonUtils.overLength(u.numType);break;case RankDataType.TYPE_JOB_ZS:v=CommonUtils.overLength(u.numType);break;case RankDataType.TYPE_JOB_FS:v=CommonUtils.overLength(u.numType);break;case RankDataType.TYPE_JOB_DS:v=CommonUtils.overLength(u.numType);break;case RankDataType.TYPE_BAOSHI:v=u.numType+"级";break;case RankDataType.TYPE_ZHANLING:v=u.numType[0]+"阶"+u.numType[1]+"星";break;case RankDataType.TYPE_LONGHUN:v=u.numType+"级";break;case RankDataType.TYPE_XIAOFEI:v=u.numType+"元宝"}c&&(c.itemRenderer=ItemBase,c.dataProvider=new eui.ArrayCollection(h.rewards)),d&&(d.text=f),g&&(g.text=v)}},e.prototype.refushBtnStatu=function(){for(var t in Activity.ins().activityData){var e=Activity.ins().activityData[t];e&&4==e.type&&e.isOpenActivity()&&Activity.ins().sendDabiaoInfo(e.id)}var i=this.getCurStatus(),n=this.getCurValue();switch(i){case 0:this.dabiaoImg.visible=!1,this.getReward.visible=!1,this.rankName.visible=!0,this.rankDesc.visible=!0,this.rankName.text=Actor.myName;break;case 1:this.rankName.visible=!1,this.rankDesc.visible=!1,this.dabiaoImg.visible=!1,this.getReward.visible=!0;break;case 2:this.rankName.visible=!1,this.rankDesc.visible=!1,this.dabiaoImg.visible=!0,this.getReward.visible=!1;break;default:console.log("达标活动领奖状态不存在:"+i)}switch(this.dabiao.rankType){case RankDataType.TYPE_LEVEL:ZsCT.ins().lv>0?this.rankDesc.text=ZsCT.ins().lv+"转"+Actor.level+"级":this.rankDesc.text=Actor.level+"级";var s=Math.floor(n/1e3),o=n%1e3;this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+(s?s+"转":"")+(o+"级"));break;case RankDataType.TYPE_POWER:case RankDataType.TYPE_WING:case RankDataType.TYPE_JOB_ZS:case RankDataType.TYPE_JOB_FS:case RankDataType.TYPE_JOB_DS:this.rankDesc.text=CommonUtils.overLength(Activity.ins().myDabiaoInfo),this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到战力\n"+n);break;case RankDataType.TYPE_BAOSHI:this.rankDesc.text=Activity.ins().myDabiaoInfo+"级",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+n);break;case RankDataType.TYPE_ZHANLING:var a=Math.floor(n/1e3),r=n%1e3,l=Activity.ins().myDabiaoInfo[0],h=Activity.ins().myDabiaoInfo[1];this.rankDesc.text=l+"阶"+h+"星",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到星阶\n"+(a?a+"阶":"")+(r+"星"));break;case RankDataType.TYPE_LONGHUN:this.rankDesc.text=Activity.ins().myDabiaoInfo+"级",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="达到等级\n"+n);break;case RankDataType.TYPE_XIAOFEI:this.rankDesc.text=Activity.ins().myDabiaoInfo+"元宝",this.label_DabiaoTarget&&(this.label_DabiaoTarget.text="消费\n"+n+"元宝")}},e.prototype.getDataList=function(t){var e=GlobalConfig.ActivityType4Panel[t],i=[];for(var n in e)0==e[n].ranking?this.dabiao=e[n]:i.push(e[n]);return i},e.prototype.onClick=function(t){switch(t.currentTarget){case this.getReward:Activity.ins().sendGetDabiaoReward(this.activityID);break;case this.btn_showRank:case this.btn_showRank0:this.group_Rank&&(this.group_Rank.visible=!this.group_Rank.visible,this.btn_showRank&&(this.btn_showRank.label=this.group_Rank.visible?"查看奖励":"查看排行"))}},e.prototype.getCurValue=function(){var t=0;return t},e.prototype.getCurRewards=function(){var t=[];return t},e.prototype.getCurStatus=function(){var t=0;return t},e}(ActivityPanel);__reflect(ActivityType4Panel.prototype,"ActivityType4Panel"),window.ActivityType4Panel=ActivityType4Panel;var ActivityType5Panel=function(t){function e(){var e=t.call(this)||this;return e.rewardIndex=-1,e.btnMax=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.refushSkin()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.refushSkin(),this.updateData(),this.addTouchEvent(this.sureBtn1,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData);for(var i=1;i<=this.btnMax;i++)this.addTouchEvent(this["btn"+i],this.onClick)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushSkin=function(){this.activityBtnType==ActivityBtnType.ZHONG_QIU?(this.btnMax=7,this.skinName="ActMidLogSkin"):this.activityBtnType==ActivityBtnType.SHENG_XIA?(this.btnMax=5,this.skinName="SunmerLogSkin"):(this.btnMax=10,this.skinName="ActNatLogSkin"),this.list1.itemRenderer=ItemBase},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.date.text="活动未开启":0>=i?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3),this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.refushBtnReward()},e.prototype.refushBtnReward=function(t){void 0===t&&(t=0);var e=Activity.ins().getActivityDataById(this.activityID);0==t&&(t=e.logTime,e.logTime||(t=1)),this.rewardIndex=t;var i=GlobalConfig.ActivityType5Config[this.activityID][this.rewardIndex-1+""];this.list1.dataProvider=new eui.ArrayCollection(i.rewards),this.selectBtn&&(this.selectBtn.currentState="up"),this.selectBtn=this["btn"+t],this.selectBtn.currentState="down",t<=e.logTime?e.checkOneDayStatu(t)?(this.sign.visible=!1,this.sureBtn1.visible=!0):(this.sign.visible=!0,this.sureBtn1.visible=!1):(this.sign.visible=!1,this.sureBtn1.visible=!1)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.sureBtn1:Activity.ins().sendReward(this.activityID,this.rewardIndex);break;case this.btn1:this.refushBtnReward(1);break;case this.btn2:this.refushBtnReward(2);break;case this.btn3:this.refushBtnReward(3);break;case this.btn4:this.refushBtnReward(4);break;case this.btn5:this.refushBtnReward(5);break;case this.btn6:this.refushBtnReward(6);break;case this.btn7:this.refushBtnReward(7);break;case this.btn8:this.refushBtnReward(8);break;case this.btn9:this.refushBtnReward(9);break;case this.btn10:this.refushBtnReward(10)}},e}(ActivityPanel);__reflect(ActivityType5Panel.prototype,"ActivityType5Panel"),window.ActivityType5Panel=ActivityType5Panel;var ActivityWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(void 0!=i&&!(Activity.ins().getActivityDataById(i)&&Activity.ins().getActivityDataById(i).isOpenActivity()||PActivity.ins().getActivityDataById(i)&&PActivity.ins().getActivityDataById(i).isOpenActivity()))return TipsCT.ins().showTips("|C:0xff0000&T:活动未开启"),!1;var n=Object.keys(Activity.ins().activityData),s=Object.keys(PActivity.ins().activityData);if(!n.length&&!s.length)return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1;for(var o in Activity.ins().activityData){var a=Activity.ins().activityData[o];if(a&&!a.pageStyle&&a.timeType!=ActivityDataFactory.TimeType_Fixed&&a.timeType!=ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+o).isOpenActivity())return!0}for(var o in PActivity.ins().activityData){var a=PActivity.ins().activityData[o];if(!PActivity.ins().getZhanlingActivity(o)&&a.isOpenActivity()&&a.pageStyle!=ActivityPageStyle.HAPPYSEVENDAY&&a.pageStyle!=ActivityPageStyle.NewGuideTask)return!0}return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postMuchDayRecReward,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.observe(PActivity.ins().postActivityPanel,this.updatePanel),this.observe(PActivity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(PActivity.ins().postChangePage,this.ChangePageCallBack),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];var i=Activity.ins();e=0;for(var n in i.activityData)if(i.activityData[n]&&!i.activityData[n].pageStyle&&i.activityData[n].timeType!=ActivityDataFactory.TimeType_Fixed&&i.activityData[n].timeType!=ActivityDataFactory.TimeType_Total&&i.getActivityDataById(+n).isOpenActivity()){var s=i.getbtnInfo(n);if(s&&(s.isFaker||s.activityType&&s.activityType==ActivityType.Nesting))continue;ErrorLog.Assert(s,"ActivityWin  data   "+n)||this._datas.push(s)}var o=PActivity.ins();for(var n in o.activityData)if(!o.getZhanlingActivity(n)&&o.getActivityDataById(+n).isOpenActivity()){var s=o.getbtnInfo(n);if(s.activityType&&(s.isFaker||s.activityType&&s.activityType==ActivityType.Nesting))continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.HAPPYSEVENDAY)continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.NewGuideTask)continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.LIMITEDGIFT)continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.PActivity55)continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.BOSSFIRSTKILL)continue;if(o.activityData[n].pageStyle&&o.activityData[n].pageStyle==ActivityPageStyle.Activity3_13)continue;ErrorLog.Assert(s,"PActivityWin  data   "+n)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var a=this._datas[n].id,r=void 0;if(this._datas[n].activityType==ActivityType.Normal?r=Activity.ins().getActivityDataById(+a):this._datas[n].activityType==ActivityType.Personal&&(r=o.getActivityDataById(+a)),r&&r.id==a){var l=r.getHide();if(!l){var h=ActivityPanel.create(a,r.activityType);if(!h)continue;h.top=0,h.left=0,h.bottom=0,h.right=0,this.activityPanelList[e]=h,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[n]),this.actId&&this.actId==a&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var u=92*t;u>this.menuList.contentWidth-this.menuScroller.width&&(u=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=u
}GameServer.serverOpenDay<7?this.title.source="biaoti_kaifuhuodong":this.title.source="biaoti_huodong"},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData&&this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,this.activityPanelList[t].activityType==ActivityType.Normal?Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0):this.activityPanelList[t].activityType==ActivityType.Personal&&PActivity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex;var e,i,n=this.activityPanelList[this.selectIndex].activityType;n==ActivityType.Normal?(e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID],i=GlobalConfig.ActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID]):n==ActivityType.Personal&&(e=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID],i=GlobalConfig.PActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID]),i&&(i.type?e&&(e.activityType==ActivityDataType._3||e.activityType==ActivityDataType._9||e.activityType==ActivityDataType._19?this.setOpenIndex(this.selectIndex):n==ActivityType.Normal?Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID):n==ActivityType.Personal&&PActivity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)):this.setOpenIndex(this.selectIndex))},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:t.activityType>e.activityType?1:-1},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}for(var n in PActivity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(PActivity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(PActivity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ActivityWin.prototype,"ActivityWin"),ViewManager.ins().reg(ActivityWin,LayerManager.UI_Main),window.ActivityWin=ActivityWin;var GiveTreasureMapWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=-1,e._sn_="CDGiveTreasureMapSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.itemList,this.onItemChange),this.addTouchEvent(this.notBtn,this.onClick),this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.challengeBtn,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1];this.listFriend.itemRenderer=FriendHeadItem,this.listFriend.dataProvider=Friends.ins().recentList,this.listFriend.selectedIndex=0,this.itemList.itemRenderer=SelectItem;var s=BagCT.ins().getBagGoodsByType(i),o=[];for(var a in s){var r=s[a].copy();n&&-1==n.indexOf(r.configID)||(r.count=1,o.push(r))}this.itemList.dataProvider=new eui.ArrayCollection(o),this.itemList.selectedIndex=0,this.lastItemId=0,this.setType(0)},e.prototype.onItemChange=function(t){var e=this.itemList.getElementAt(this.lastItemId);e&&e.setSelect(!1),e=this.itemList.getElementAt(t.currentTarget.selectedIndex),e&&(e.setSelect(!0),this.lastItemId=t.currentTarget.selectedIndex)},e.prototype.setType=function(t){if(t!=this.type)switch(this.type=t,t){case 0:this.itemScroller.visible=!0,this.firendScroller.visible=!1,this.challengeBtn.label="选择好友";break;default:this.itemScroller.visible=!1,this.firendScroller.visible=!0,this.challengeBtn.label="赠送"}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.notBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.challengeBtn:var e=this.itemList.selectedItem;if(0==this.type)e&&this.setType(1);else{var i=this.listFriend.selectedItem;i&&e&&(Activity.ins().sendMapToFriend(i.id,e.itemConfig.id),ViewManager.ins().close(this))}}},e}(BaseEuiView);__reflect(GiveTreasureMapWin.prototype,"GiveTreasureMapWin"),ViewManager.ins().reg(GiveTreasureMapWin,LayerManager.UI_Popup),window.GiveTreasureMapWin=GiveTreasureMapWin;var cc_launchX=window.cc_launchX=180,cc_launchY=window.cc_launchY=500,cc_firstX=window.cc_firstX=0,cc_firstY=window.cc_firstY=0,cc_distantX=window.cc_distantX=77,cc_distantY=window.cc_distantY=93,cc_depotX=window.cc_depotX=320,cc_depotY=window.cc_depotY=620,cwaitTime=window.cwaitTime=50,LuckyResultWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HuntResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.buy),this.observe(Activity.ins().postRewardResult,this.updateView),this.activityID=t[0],this.indexs=t[1],this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateView=function(){this.canClicck=!0,this.zwHunt.visible=!0;var t,e;if(GlobalConfig.PActivityBtnConfig[this.activityID]?(e=GlobalConfig.PActivityType9Config,t=PActivity.ins().activityData[this.activityID]):(e=GlobalConfig.ActivityType9Config,t=Activity.ins().activityData[this.activityID]),this.indexs.length>1){var i=e[this.activityID];this.arr=[];for(var n=0;n<this.indexs.length;n++)if(this.indexs[n])for(var s=0;s<i[this.indexs[n]].reward.length;s++)this.arr.push(i[this.indexs[n]].reward[s]);this.title.text="获得如下宝物",this.buyBtn.labelDisplay.text="抽10次",this.yb=10*i[0].yb,this.zw.text=this.yb+"";var o=GlobalConfig.ItemConfig[i[0].item];this.icon.source=o?o.icon+"_png":null,this.itemId=i[0].item,this.updateDesc(),this.playResult(),this.zwNum2.text="/10）"}else if(t.indexsEx.length){var i=e[this.activityID];this.arr=[];for(var n=0;n<t.indexsEx.length;n++)if(t.indexsEx[n])for(var s=0;s<i[t.indexsEx[n]].reward.length;s++)this.arr.push(i[t.indexsEx[n]].reward[s]);this.title.text="获得如下宝物",this.buyBtn.labelDisplay.text="抽1次",this.yb=1*i[0].yb,this.zw.text=this.yb+"";var o=GlobalConfig.ItemConfig[i[0].item];this.icon.source=o?o.icon+"_png":null,this.itemId=i[0].item,this.updateDesc(),this.playResult(),this.zwNum2.text="/1）"}},e.prototype.updateDesc=function(){var t=BagCT.ins().getBagItemById(this.itemId),e=ColorUtil.WHITE_COLOR,i=0,n=10;t&&(i=t.count,e=t.count>=n?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR),this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+i+"</font> ")},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,n=0;i>n;n++){this.items[n]=this.createItem(this.arr[n]);var s=egret.Tween.get(this.items[n]);this.items[n].x=n%5*cc_distantX+cc_firstX,this.items[n].y=Math.floor(n/5)*cc_distantY+cc_firstY,this.items[n].alpha=0,s.wait(n*cwaitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length,n=0;i>n;n++)if(this.items[n]){var s=egret.Tween.get(this.items[n]);s.to({y:cc_depotY,x:cc_depotX,scaleX:0,scaleY:0},300-50*Math.floor(n/5)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;this.listCon.addChild(e);var i=GlobalConfig.ItemConfig[t.id];return i?(e.num=t.count,e.data=t):e.data={type:0,count:t.count,id:t.id},e.x=cc_launchX,e.y=cc_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.buy=function(t){if(this.canClicck){var e;if(GlobalConfig.PActivityBtnConfig[this.activityID]?(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config,e=PActivity.ins().activityData[this.activityID]):(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config,e=Activity.ins().activityData[this.activityID]),this.indexs.length>1){var i=this.config9[this.activityID][0],n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,i.item);if(n&&n.count)this.ins.sendReward(this.activityID,2);else{var s=10;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.huntWarnFun.bind(this),"是否消耗"+i.yb*s+"元宝购买"+GlobalConfig.ItemConfig[i.item].name+"*"+s)}}else{var i=this.config9[this.activityID][0],n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,i.item);if(n&&n.count)this.ins.sendReward(this.activityID,1),this.ins.sendReward(this.activityID,1);else{var s=1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.huntWarnFun.bind(this),"是否消耗"+i.yb*s+"元宝购买"+GlobalConfig.ItemConfig[i.item].name+"*"+s)}}}},e.prototype.huntWarnFun=function(){var t=this.config9[this.activityID][0],e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);this.indexs.length>1?(e&&e.count&&this.ins.sendReward(this.activityID,2),Actor.yb>=10*t.yb?this.ins.sendReward(this.activityID,2):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")):e&&e.count?(this.ins.sendReward(this.activityID,1),this.ins.sendReward(this.activityID,1)):Actor.yb>=1*t.yb?(this.ins.sendReward(this.activityID,1),this.ins.sendReward(this.activityID,1)):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(LuckyResultWin.prototype,"LuckyResultWin"),ViewManager.ins().reg(LuckyResultWin,LayerManager.UI_Main);var NoticeListRenderer=function(t){function e(){var e=t.call(this)||this;return e.job=["","战士","法师","道士"],e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t="";switch(this.activityID=this.data.activityID,this.activityType=this.data.activityType,this.actType=this.data.actType,this.activityType){case ActivityDataType._17:var e=GlobalConfig.ActivityType17_3Config[this.activityID],i=e[CommonUtils.getObjectLength(e)].group,n=GlobalConfig.ItemConfig[i[this.data.index-1].id],s=ItemUtil.getQualityColor(n),o=n.name;t="恭喜|C:0x16b2ff&T:"+this.data.name+"|在幸运星转盘中抽到了|C:"+s+"&T:"+o+" X"+i[this.data.index-1].count+"|";break;default:var a=this.data.name,r=this.data.index,o="",s=ColorUtil.NORMAL_COLOR,n=GlobalConfig.ItemConfig[r];if(!n)return;o=n.name,s=ItemUtil.getQualityColor(n);var l=ItemUtil.getType(n);0==l&&n&&(o+=n.zsLevel>0?"("+n.zsLevel+"转 ":"("+n.level+"级 ",o+=this.job[ItemUtil.getJob(n)]+")"),t="<font color = '#12b2ff'>"+a+"</font> "+(this.data.des?this.data.des:"获得")+" <font color='"+s+"'>"+o+"</font>"}this.showText.textFlow=TextFlowMaker.generateTextFlow(t)},e.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],e}(BaseItemRender);__reflect(NoticeListRenderer.prototype,"NoticeListRenderer"),window.NoticeListRenderer=NoticeListRenderer;var NoticeYBListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.name;this.activityID=this.data.activityID;var e=this.data.multiple,i=this.data.yb,n="",s="",o=ColorUtil.NORMAL_COLOR;s=RewardData.getCurrencyName(2),o=16711680,n="<font color = '#16b2ff'>"+t+"</font> 在元宝转盘中抽中了 <font color='"+o+"'>"+e+"</font>倍，获得<font color='"+o+"'>"+i+"</font>元宝",this.showText.textFlow=TextFlowMaker.generateTextFlow(n)},e}(BaseItemRender);__reflect(NoticeYBListRenderer.prototype,"NoticeYBListRenderer"),window.NoticeYBListRenderer=NoticeYBListRenderer;var SelectItem=function(t){function e(){var e=t.call(this)||this;return e.isOpenSelectImg=!0,e}return __extends(e,t),e.prototype.init=function(){},e}(ItemBase);__reflect(SelectItem.prototype,"SelectItem"),window.SelectItem=SelectItem;var ThanksGivingWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e.title.visible=!1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t in Activity.ins().activityData)if(Activity.ins().activityData[t]&&Activity.ins().activityData[t].pageStyle==ActivityPageStyle.THANKS&&Activity.ins().getActivityDataById(+t).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,感恩节活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(BagCT.ins().postItemAdd,this.refushRedPoint),this.observe(BagCT.ins().postItemChange,this.refushRedPoint),this.observe(BagCT.ins().postItemDel,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.addChangeEvent(this.menuScroller,this.onChange),this.setOpenIndex(0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuList.removeEventListener(egret.Event.CHANGE,this.onClickMenu,this),this.menuScroller.removeEventListener(egret.Event.CHANGE,this.onChange,this),Timer.stopAll(this);for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){for(var t=0,e=0,i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var n in Activity.ins().activityData)if(Activity.ins().activityData[n]&&Activity.ins().activityData[n].pageStyle==ActivityPageStyle.THANKS&&Activity.ins().getActivityDataById(+n).isOpenActivity()){var s=Activity.ins().getbtnInfo(n);ErrorLog.Assert(s,"ThanksGivingWin  data   "+n)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var o=this._datas[n].id,a=void 0;if(this._datas[n].activityType==ActivityType.Normal?a=Activity.ins().getActivityDataById(+o):this._datas[n].activityType==ActivityType.Personal&&(a=PActivity.ins().getActivityDataById(+o)),a&&a.id==o){var r=a.getHide();if(!r){var l=ActivityPanel.create(o,a.activityType);if(!l)continue;l.top=0,l.left=0,l.bottom=0,l.right=0,this.activityPanelList[e]=l,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[n]),this.actId&&this.actId==o&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,GlobalConfig.ActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID].type){var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID))}else this.setOpenIndex(this.selectIndex)},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},__decorate([callLater],e.prototype,"refushRedPoint",null),e}(BaseEuiView);__reflect(ThanksGivingWin.prototype,"ThanksGivingWin"),ViewManager.ins().reg(ThanksGivingWin,LayerManager.UI_Main),window.ThanksGivingWin=ThanksGivingWin;var TreasureToGetlWin=function(t){function e(){var e=t.call(this)||this;return e.curIndex=0,e.activityID=0,e.isAuto=!1,e.skinName="treasureToGetlSkin",e.isTopLevel=!0,e.itemListGoods.itemRenderer=ItemBase,e.dataArr||(e.dataArr=new eui.ArrayCollection,e.itemListGoods.dataProvider=e.dataArr),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curIndex=t[0],this.activityID=t[1],this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.autoBtn,this.onClick),this.addTouchEvent(this.buyBtn,this.onClick),this.isAuto=0==this.curIndex,this.update(),this.setAuto()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ActivityType14Data.rewardList=[],this.isAuto=!1,egret.Tween.removeTweens(this.bar)},e.prototype.update=function(){this.buyBtn.visible=!0,this.zwHunt.visible=!0,this.barGroup.visible=!0,this.autoBtn.visible=!0,this.barBigGroup.visible=!0;var t=Activity.ins().getActivityDataById(this.activityID),e=t.getType14Config(),i=BagCT.ins().getBagGoodsCountById(0,e.costItem.id);0==this.curIndex?(this.buyBtn.visible=!1,this.zwHunt.visible=!1,0!=t.bigRewardsID?(this.isAuto=!1,this.setAuto()):Actor.yb<e.cost&&i<e.costItem.count&&(TipsCT.ins().showTips("元宝和道具不足"),this.isAuto=!1,this.setAuto()),this.barGroup.visible=this.isAuto):(this.barGroup.visible=!1,this.autoBtn.visible=!1,this.num.text=""+i,this.needNum.text="/"+e.costItem.count+"）",this.zw.text=""+e.cost),0!=t.bigRewardsID&&(this.item.data=t.bigRewardsID,this.buyBtn.visible=!1,this.zwHunt.visible=!1,this.barGroup.visible=!1,this.autoBtn.visible=!1,this.barBigGroup.visible=!1,this.isAuto=!1),this.barBig.maximum=e.maxLucky,this.barBig.value=t.lucky,this.dataArr.source=ActivityType14Data.rewardList,this.bigRewardGroup.visible=0!=t.bigRewardsID},e.prototype.updateLucky=function(t){this.barBig.value=t},e.prototype.onTap=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.onClick=function(t){var e=Activity.ins().getActivityDataById(this.activityID),i=e.getType14Config();if(Actor.yb<i.cost)return void TipsCT.ins().showTips("元宝不足");switch(t.currentTarget){case this.autoBtn:if(this.isAuto)return this.isAuto=!1,void this.setAuto();this.huntWarnFun();break;case this.buyBtn:this.huntWarnFun()}},e.prototype.huntWarnFun=function(){0==this.curIndex?(this.isAuto=!0,this.setAuto()):Activity.ins().sendReward(this.activityID,0)},e.prototype.setAuto=function(){this.autoBtn.label=this.isAuto?"取消":"自动鉴宝",this.barGroup.visible=this.isAuto,this.isAuto&&this.startAuto()},e.prototype.startAuto=function(){var t=this,e=egret.Tween.get(this.bar);this.bar.value=0,this.bar.maximum=100,e.to({value:100},1e3).call(function(){egret.Tween.removeTweens(t.bar),t.isAuto&&(Activity.ins().sendReward(t.activityID,0),t.setAuto())},this)},e}(BaseEuiView);__reflect(TreasureToGetlWin.prototype,"TreasureToGetlWin"),ViewManager.ins().reg(TreasureToGetlWin,LayerManager.UI_Popup),window.TreasureToGetlWin=TreasureToGetlWin;var WeekActiveWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="WeekActiveSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(!(void 0==i||Activity.ins().getActivityDataById(i)&&Activity.ins().getActivityDataById(i).isOpenActivity()))return TipsCT.ins().showTips("|C:0xff0000&T:活动未开启"),!1;for(var n in Activity.ins().activityData)if(Activity.ins().getActivityDataById(+n).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postMuchDayRecReward,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];var i=Activity.ins();e=0;for(var n in i.activityData){var s=i.getActivityDataById(+n);if(s.pageStyle==ActivityPageStyle.TOTALRECHARGE&&s.isOpenActivity()){var o=i.getbtnInfo(n);if(o.activityType&&o.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(o,"WeekActiveWin  data   "+n)||this._datas.push(o)}}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var a=this._datas[n].id,r=void 0;if(this._datas[n].activityType==ActivityType.Normal&&(r=Activity.ins().getActivityDataById(+a)),r&&r.id==a){var l=r.getHide();if(!l){var h=ActivityPanel.create(a,r.activityType);if(!h)continue;h.top=0,h.left=0,h.bottom=0,h.right=0,this.activityPanelList[e]=h,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[n]),this.actId&&this.actId==a&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var u=92*t;u>this.menuList.contentWidth-this.menuScroller.width&&(u=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=u}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,this.activityPanelList[t].activityType==ActivityType.Normal&&Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex;var e,i,n=this.activityPanelList[this.selectIndex].activityType;n==ActivityType.Normal&&(e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID],i=GlobalConfig.ActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID]),i&&(i.type?e&&(e.activityType==ActivityDataType._3||e.activityType==ActivityDataType._9||e.activityType==ActivityDataType._19?this.setOpenIndex(this.selectIndex):n==ActivityType.Normal&&Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)):this.setOpenIndex(this.selectIndex))},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:t.activityType>e.activityType?1:-1},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(WeekActiveWin.prototype,"WeekActiveWin"),ViewManager.ins().reg(WeekActiveWin,LayerManager.UI_Main),window.WeekActiveWin=WeekActiveWin;var YBZhuanPanWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="CEYBZhuanPanSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.YBZHUANPAN,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==ActivityPageStyle.YBZHUANPAN&&Activity.ins().getActivityDataById(+i).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){for(var t=0,e=0,i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var n in Activity.ins().activityData)if(Activity.ins().activityData[n]&&Activity.ins().activityData[n].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+n).isOpenActivity()){var s=Activity.ins().getbtnInfo(n);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"ybzhuanpan  data   "+n)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var o=this._datas[n].id,a=Activity.ins().getActivityDataById(+o);if(a&&a.id==o){var r=a.getHide();if(!r){var l=ActivityPanel.create(o,a.activityType);if(!l)continue;l.top=0,l.left=0,l.bottom=0,l.right=0,this.activityPanelList[e]=l,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[n]),this.actId&&this.actId==o&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;
h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,GlobalConfig.ActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID].type){var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):this.setOpenIndex(this.selectIndex))}else this.setOpenIndex(this.selectIndex)},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(YBZhuanPanWin.prototype,"YBZhuanPanWin"),ViewManager.ins().reg(YBZhuanPanWin,LayerManager.UI_Main),window.YBZhuanPanWin=YBZhuanPanWin;var CDNewYearArenaMacthPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.topThreeId=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.list0.itemRenderer=NewYearRankItemRender,this.listdata=new eui.ArrayCollection,this.list0.dataProvider=this.listdata,this.ranks=[this.rank0,this.rank1,this.rank2],this.groups=[this.eGroup0,this.eGroup1,this.eGroup2],this.playNames=[this.playName0,this.playName1,this.playName3],this.recharges=[this.recharge0,this.recharge1,this.recharge3],this.eLabs=[this.eLab0,this.eLab1,this.eLab2]},e.prototype.addDisplay=function(){this.observe(Rank.ins().postRankingData,this.update),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.update()},e.prototype.update=function(){if(this.myNumber.text="无",this.myRanking.text="无",this.model=Rank.ins().getRankModel(RankDataType.TYPE_37KFBOSS),this.model){var t=this.model.getDataList(),e=Math.max(t.length,3),i=[];this.topThreeId=[];for(var n=0;e>n;n++){var s=t[n];3>n?(this.playNames[n].text="",s&&s.id>0?(this.topThreeId.push(s.id),this.ranks[n].data=null,ReadPlayerCT.ins().sendFindPlayer(s.id,s.serverId),this.groups[n].visible=!0,this.recharges[n].text="已归属："+s.times):(this.recharges[n].text="",this.groups[n].visible=!1),this.eLabs[n].visible=!this.groups[n].visible):i.push(s),s&&s.id==Actor.actorID&&(this.myNumber.text=s.pos+"",this.myRanking.text=s.times+"")}this.listdata.source=i}},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.topThreeId.length;e++)this.topThreeId[e]==t.id&&(this.ranks[e].data={otherPlayerData:t},this.playNames[e].text="s"+t.serverId+"."+t.name)},e}(BaseView);__reflect(CDNewYearArenaMacthPanel.prototype,"CDNewYearArenaMacthPanel"),window.CDNewYearArenaMacthPanel=CDNewYearArenaMacthPanel;var CDNewYearArenaWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CDNewYearArenaSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){Rank.ins().sendGetRankingData(RankDataType.TYPE_37KFBOSS)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.macthPanel.setActivityId(t[0])},e}(BaseEuiView);__reflect(CDNewYearArenaWin.prototype,"CDNewYearArenaWin"),window.CDNewYearArenaWin=CDNewYearArenaWin,ViewManager.ins().reg(CDNewYearArenaWin,LayerManager.UI_Main);var CDNewYearRewardsPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.curServList.itemRenderer=NewYearRewardItemRender,this.listData=new eui.ArrayCollection,this.curServList.dataProvider=this.listData},e.prototype.addDisplay=function(){this.observe(Rank.ins().postRankingData,this.update),this.updateList(),this.update()},e.prototype.setActivityId=function(t){this.activityId=t},e.prototype.updateList=function(){var t=GlobalConfig.ActivityType37_1Config[this.activityId];if(t){var e=CommonUtils.objectToArray(t);this.listData.replaceAll(e)}},e.prototype.update=function(){if(this.myNumber0.text="无",this.myRanking0.text="无",this.model=Rank.ins().getRankModel(RankDataType.TYPE_37KFBOSS),this.model){var t=this.model.getDataList();for(var e in t){var i=t[e];i.id==Actor.actorID&&(this.myNumber0.text=i.pos+"",this.myRanking0.text=i.times+"")}}},e}(BaseView);__reflect(CDNewYearRewardsPanel.prototype,"CDNewYearRewardsPanel"),window.CDNewYearRewardsPanel=CDNewYearRewardsPanel;var NewYearRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostRankItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&this.data instanceof RankData37Boss&&(this.pos.text=this.data.pos+"",this.player.text="s"+this.data.serverId+"."+this.data.name,this.value.text="已归属："+this.data.times)},e}(BaseItemRender);__reflect(NewYearRankItemRender.prototype,"NewYearRankItemRender"),window.NewYearRankItemRender=NewYearRankItemRender;var NewYearRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="SeasonRewardsItemSkin",e.awardslist.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.typeLabel.text=t.range[0]==t.range[1]?"第"+t.range[0]+"名":"第"+t.range[0]+"-"+t.range[1]+"名",this.awardslist.dataProvider=new eui.ArrayCollection(t.rewards)}},e}(BaseItemRender);__reflect(NewYearRewardItemRender.prototype,"NewYearRewardItemRender"),window.NewYearRewardItemRender=NewYearRewardItemRender;var ComActivityBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e._sn_="ActBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t,e;egret.is(this.data,"ActivityBtnConfig")?(t=this.data,e=Activity.ins()):egret.is(this.data,"PActivityBtnConfig")&&(t=this.data,e=PActivity.ins()),null!=t?(this.iconDisplay.source=t.icon,this.redPoint.visible=e.isShowRedPointByBtnInfo(t),t.light&&!e.getPalyEffListById(t.id)?(this.mc||(this.mc=new MovieClip,this.mc.x=35,this.mc.y=35),this.mc.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.addChild(this.mc)):DisplayUtils.removeFromParent(this.mc)):this.iconDisplay.source=""},e}(BaseItemRender);__reflect(ComActivityBtnRenderer.prototype,"ComActivityBtnRenderer"),window.ComActivityBtnRenderer=ComActivityBtnRenderer;var AStarNode=function(){function t(t,e,i){this.nX=t,this.nY=e,this.nDir=i}return t}();__reflect(AStarNode.prototype,"AStarNode");var ComActivityWin1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ComActivityWin);__reflect(ComActivityWin1.prototype,"ComActivityWin1"),window.ComActivityWin1=ComActivityWin1,ViewManager.ins().reg(ComActivityWin1,LayerManager.UI_Popup);var ComActivityWin55=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actList=[],e.timeLimit=!1,e}return __extends(e,t),e.prototype.updateData=function(){var t=Activity.ins().activityData;this.actList=[];for(var e in t){var i=t[e];if(i.pageStyle==this.pageStyle&&i.isOpenActivity()){this.actId=i.id,this.ins=Activity.ins();var n=GlobalConfig.ActivityType55Config[i.id];if(this.timeLimit){var s=i;for(var o in s.list)s.list[o].state<n[s.list[o].index].buyTimes&&this.actList.indexOf(n)<0&&this.actList.push(n)}else this.actList.indexOf(n)<0&&this.actList.push(n)}}t=PActivity.ins().activityData;for(var e in t){var i=t[e];if(i.pageStyle==this.pageStyle&&i.isOpenActivity()){this.actId=i.id,this.ins=PActivity.ins();var n=GlobalConfig.PActivityType55Config[i.id];if(this.timeLimit){var s=i;for(var o in s.list)s.list[o].state<n[s.list[o].index].buyTimes&&this.actList.indexOf(n)<0&&this.actList.push(n)}else this.actList.indexOf(n)<0&&this.actList.push(n)}}},e}(BaseEuiView);__reflect(ComActivityWin55.prototype,"ComActivityWin55"),window.ComActivityWin55=ComActivityWin55;var FengceActivityWin=function(t){function e(){var e=t.call(this)||this;return e.curLevelIndex=0,e.skinName="fengceActiveSkin",e.defaultText="游戏内容遇到的问题，请咨询客服（不超过100字）",e}return __extends(e,t),e.openCheck=function(){return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.edit.addEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this),this.addTouchEvent(this.sendBtn,this.onTap),this.addTouchEvent(this.arrowleft,this.onTap),this.addTouchEvent(this.arrowright,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.edit,this.onTap),this.addChangeEvent(this.tab,this.onSelectIndex),this.setSelectIndex(t[0]||0)},e.prototype.setSelectIndex=function(t){if(this.viewStack.selectedIndex=t,0==t){if(!this.levelData){this.levelData=[];var e=GlobalConfig.LevelMailConfig;for(var i in e)e[i].mType&&this.levelData.push(+i);this.levelData.sort(function(t,e){return e>t?-1:1})}var n=Actor.level,s=ZsCT.ins().lv;this.curLevelIndex=0;for(var o=0;o<this.levelData.length;o++){this.curLevelIndex=o;var a=Math.floor(this.levelData[o]/1e3);if(1>a){if(n<this.levelData[o])break}else if(a>s)break}this.updateLevel(this.curLevelIndex);var r=GameServer.serverOpenDay+1,l=GlobalConfig.LoginDayMailConfig[r];if(l){var h=l.idList[0],u=GlobalConfig.MailIdConfig[h];this.count0.text=u.attachment[0].count+""}else this.count0.text="0"}},e.prototype.updateLevel=function(t){0>t&&(t=0),t>=this.levelData.length&&(t=this.levelData.length-1),0==t?(this.arrowleft.visible=!1,this.arrowright.visible=!0):t==this.levelData.length-1?(this.arrowleft.visible=!0,this.arrowright.visible=!1):(this.arrowleft.visible=!0,this.arrowright.visible=!0),this.curLevelIndex=t;var e=this.levelData[t],i=Math.floor(this.levelData[t]/1e3);1>i?(e>Actor.level?this.countDesc.text="再升"+(e-Actor.level)+"级可领取":this.countDesc.text="",this.lvText.text=e+"级奖励"):(i>ZsCT.ins().lv?this.countDesc.text="达到"+i+"转可领取":this.countDesc.text="",this.lvText.text=i+"转奖励");var n=GlobalConfig.LevelMailConfig[e],s=n.idList[0],o=GlobalConfig.MailIdConfig[s];this.count2.text=o.attachment[0].count+""},e.prototype.onSelectIndex=function(t){this.setSelectIndex(t.itemIndex)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.bgClose)ViewManager.ins().close(this);else if(e==this.arrowleft)this.updateLevel(this.curLevelIndex-1);else if(e==this.arrowright)this.updateLevel(this.curLevelIndex+1);else if(e==this.sendBtn){if(0==this.edit.text.length||this.edit.text==this.defaultText)return void TipsCT.ins().showTips("内容不能为空")}else e==this.edit&&this.edit.text==this.defaultText&&(this.edit.text="",this.edit.textColor=16777215)},e.prototype.callBack=function(){this.edit.text=""},e.prototype.close=function(){this.tab.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSelectIndex,this),this.edit.removeEventListener(egret.FocusEvent.FOCUS_IN,this.onTap,this)},e}(BaseEuiView);__reflect(FengceActivityWin.prototype,"FengceActivityWin"),ViewManager.ins().reg(FengceActivityWin,LayerManager.UI_Popup),window.FengceActivityWin=FengceActivityWin;var CDYBZhuanPanRewardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CDYBZhuanPanRewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.list.itemRenderer=CDYBZhuanPanShowItem},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityId=t[0],this.actType=ActivityPanel.getActivityTypeFromId(this.activityId),this.ins=this.actType==ActivityType.Personal?PActivity.ins():Activity.ins(),this.observe(this.ins.postActivityIsGetAwards,this.update),this.update()},e.prototype.update=function(){var t=CommonUtils.objectToArray(this.actType==ActivityType.Personal?GlobalConfig.PActivityType11_1Config[this.activityId]:GlobalConfig.ActivityType11_1Config[this.activityId]);this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof CDYBZhuanPanShowItem){var e=t.target.parent.parent.data;return void this.ins.sendReward(this.activityId,e.index,1)}switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(CDYBZhuanPanRewardWin.prototype,"CDYBZhuanPanRewardWin"),window.CDYBZhuanPanRewardWin=CDYBZhuanPanRewardWin,ViewManager.ins().reg(CDYBZhuanPanRewardWin,LayerManager.UI_Main);var CDYBZhuanPanShowItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDYBZhuanPanShowItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=ActivityPanel.getActivityTypeFromId(t.id);this.list.dataProvider=new eui.ArrayCollection(t.reward);var i=e==ActivityType.Personal?PActivity.ins():Activity.ins(),n=i.getActivityDataById(t.id);switch(this.scheduleTxt.text=n.hiScore>t.score?t.score+"/"+t.score:n.hiScore+"/"+t.score,this.redPoint0.visible=!1,n.getRewardState(t.index)){case 1:this.get0.label="领取",this.get0.enabled=!0,this.redPoint0.visible=!0;break;case 2:this.get0.label="已领取",this.get0.enabled=!1;break;default:this.get0.label="领取",this.get0.enabled=!1}}},e}(BaseItemRender);__reflect(CDYBZhuanPanShowItem.prototype,"CDYBZhuanPanShowItem"),window.CDYBZhuanPanShowItem=CDYBZhuanPanShowItem;var HappySevenDayBtnItemRender=function(t){function e(){var e=t.call(this)||this;return e.day=0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.dayImg.source=this.data.res,this.isOpen=this.data.isOpen,this.day=this.data.day,this.currentState=this.isOpen?"unlock":"lock",this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=this.isOpen?t?"unlockS":"unlock":"lock",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(HappySevenDayBtnItemRender.prototype,"HappySevenDayBtnItemRender"),window.HappySevenDayBtnItemRender=HappySevenDayBtnItemRender;var HappySevenDayItemRender=function(t){function e(){var e=t.call(this)||this;return e.activityType=ActivityType.Normal,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect,this.actBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.dataChanged=function(){if(this.data&&this.data.conf){var t=this.data.achieve,e=this.data.conf,i=this.data.yunBao||0;this.activityType=this.data.activityType,this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name);var n=e.yuanbaoReward?CommonUtils.getObjectLength(e.yuanbaoReward):0;if(this.sPIntegral="积分:"+e.score,this.sTextFlow=null,2==this.data.state&&n>0){if(this.currentState=2==t.otherState?"done":"normal",this.redpoint.visible=!1,2!=t.otherState){this.scedule.textFlow=TextFlowMaker.generateTextFlow1(0==Math.max(0,t.otherTarget-i)?"":"充值"+Math.max(0,t.otherTarget-i)/GlobalConfig.ClientGlobalConfig.rate+"元再领一次"),this.sTextFlow=TextFlowMaker.generateTextFlow1("剩余领取次数|C:"+(t.hasGetOther>=n?ColorUtil.RED:ColorUtil.GREEN)+"&T:("+Math.max(0,n-t.hasGetOther)+"/"+n+")|");var s=1==t.otherState;this.redpoint.visible=s,this.actBtn.enabled=!0,this.actBtn.label=s?"领  取":"前  往"}this._listCollect.source=t.otherTarget>0?this.data.conf.yuanbaoReward[t.otherTarget]:[]}else this._listCollect.source=this.data.conf.reward,this.scedule.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+Math.floor(this.data.times/(this.data.conf.rate||1))+"|/"+Math.floor(this.data.conf.dayLimit/(this.data.conf.rate||1))),this.currentState=2==this.data.state?"done":"normal",this.redpoint.visible=1==this.data.state,0==this.data.state&&this.data.conf.turn?(this.actBtn.enabled=!0,this.actBtn.label="前  往"):(this.actBtn.label="领  取",this.actBtn.enabled=1==this.data.state)}},e.prototype.onTouch=function(t){var e=this.data.conf.yuanbaoReward?CommonUtils.getObjectLength(this.data.conf.yuanbaoReward):0,i=this.data.achieve;if(0==this.data.state&&this.data.conf.turn){var n=this.data.conf.turn[0].split("|");ViewManager.ins().openBySkin(n[0],n[1],this.data.conf.turn[1],this.data.conf.turn[2])}else if(2==this.data.state&&e>0&&0==i.otherState){var s=Recharge.ins().getRechargeData(0);s&&0!=s.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}else this.activityType==ActivityType.Personal?PActivity.ins().sendReward(this.data.activityID,this.data.conf.index,2):Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2)},e.prototype.destruct=function(){this.actBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HappySevenDayItemRender.prototype,"HappySevenDayItemRender"),window.HappySevenDayItemRender=HappySevenDayItemRender;var HappySevenDayScoreItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];if(e)switch(this.ItemIcon.data=t.reward[0],this.eScore.text=t.score+"",this.Rp.visible=this.eGetImg.visible=!1,this.touchChildren=!0,e.getRewardState(t.index)){case 0:break;case 1:this.touchChildren=!1,this.Rp.visible=!0;break;case 2:this.eGetImg.visible=!0}}},e}(BaseItemRender);__reflect(HappySevenDayScoreItem.prototype,"HappySevenDayScoreItem"),window.HappySevenDayScoreItem=HappySevenDayScoreItem;var HappySevenDayTabListItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.tabName.text=this.data.res,this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=t?"select":"unselect",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(HappySevenDayTabListItemRender.prototype,"HappySevenDayTabListItemRender"),window.HappySevenDayTabListItemRender=HappySevenDayTabListItemRender;var HappySevenDayWin=function(t){function e(){var e=t.call(this)||this;return e._curDay=0,e._curDayIndex=0,e._curGroupIndex=0,e.activityType=ActivityType.Normal,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=HappySevenDayItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._activityID=t[0],this.curPageStyle=t[1],this.activityType=t[2];var i=this.activityType==ActivityType.Normal?GlobalConfig.ActivityConfig[this._activityID]:GlobalConfig.PActivityConfig[this._activityID];i.pageSkin&&"millionRebateSkin"!=i.pageSkin?(this.skinName=i.pageSkin,this.tabP.itemRenderer=HSDTabListItemRender,this.tabD.itemRenderer=HSDTabListItemRender,this.showType=!1):(this.showType=!0,this.skinName=this.activityType==ActivityType.Normal?i.pageSkin||"sevenDayWin":"CDHuiGuitask",this.tabP.itemRenderer=HappySevenDayTabListItemRender,this.tabD.itemRenderer=HappySevenDayBtnItemRender,this.eList.itemRenderer=HappySevenDayScoreItem),this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType11_1Config[this._activityID]):this.activityType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType11_1Config[this._activityID]),this.actInfo0.text=i.desc,this._curDayIndex=0,this._curGroupIndex=0,this.updateView(),this.updateTabs(),this.tabD.selectedIndex=this._curDayIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData(),this.updateTargetAward(),this.addTouchEvent(this,this.onTouch),this.observe(this.ins.postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),this.addChangeEvent(this.tabP,this.onTabBtn),Timer.start(1e3,0,this.setTime,this),this.updateLock(),this.setTime()},e.prototype.updateView=function(){this.data=this.ins.getActivityDataById(this._activityID),this._curDay=this.data.getCurDay(),this._items=[];var t,e,i,n,s,o,a=this.activityType==ActivityType.Normal?GlobalConfig.ActivityType11_2Config[this._activityID]:GlobalConfig.PActivityType11_2Config[this._activityID],r=[];for(var l in a)t=a[l],i=t.day,e=this._items[t.day-1],e||(e=[],this._items[t.day-1]=e,r.push({res:t.dayImg,isOpen:this._curDay>=t.day,showRed:!1,day:t.day})),o=this.data.achieveInfo[t.index-1],this._curDay>=t.day&&(!o.isGot&&o.times>=t.dayLimit||1==o.otherState)&&(r[t.day-1].showRed=!0),n=t.group,s=e[n-1],s||(s=[],e[n-1]=s),s.push(t);this._btnCollect||(this._btnCollect=new eui.ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.replaceAll(r),this.tabD.validateNow(),this._tabCollect||(this._tabCollect=new eui.ArrayCollection,this.tabP.dataProvider=this._tabCollect)},e.prototype.refreshReds=function(){this.updateView(),this.updateTabs(),this.updateData(),this.updateTargetAward(),this.updateRewardBtnRed()},e.prototype.updateRewardBtnRed=function(){if(this.rewardBtnRed){var t=this.ins.getActivityDataById(this._activityID),e=this.cfgs;this.rewardBtnRed.visible=!1;for(var i in e)1==t.getRewardState(e[i].index)&&(this.rewardBtnRed.visible=!0)}},e.prototype.updateData=function(){var t=this._items[this._curDayIndex][this._curGroupIndex];if(t&&t.length){this._listCollect||(this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect);for(var e,i,n=t.length,s=[],o=0,a=this.ins.getActivityDataById(this._activityID),r=0;n>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,s[r]={activityID:this._activityID,conf:e,state:o,times:i.times,achieve:i,yunBao:a.yunBao,activityType:this.activityType};s.sort(this.sort),this._listCollect.replaceAll(s)}},e.prototype.sort=function(t,e){return 1!=t.state&&1!=t.achieve.otherState||1==e.state||1==e.achieve.otherState?1!=e.state&&1!=e.achieve.otherState||1==t.state||1==t.achieve.otherState?2==t.state&&2!=e.state?1:2!=t.state&&2==e.state?-1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0:1:-1},e.prototype.updateTargetAward=function(){var t=null,e=this.ins.getActivityDataById(this._activityID).hiScore;if(!this.showType){var i=this.cfgs;for(var n in i)!t&&e<i[n].score&&(t=i[n])}if(t||(t=this.cfgs[Object.keys(this.cfgs).length]),this.schedule&&(this.schedule.maximum=t.score,this.schedule.value=e),this.eScore&&(this.eScore.text=e+""),this.eList){var s=CommonUtils.objectToArray(this.cfgs),o=[];for(var n in s)o.push([s[n],this.data]);this.eList.dataProvider=new eui.ArrayCollection(o)}},e.prototype.onTouch=function(t){if(t.target instanceof HappySevenDayScoreItem){var e=t.target.data[0],i=this.ins.getActivityDataById(this._activityID);switch(i.getRewardState(e.index)){case 1:this.ins.sendReward(this._activityID,e.index,1)}}else switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:var n=this.cfgs;for(var s in n){0==n[s].rewardType?ViewManager.ins().open(CDYBZhuanPanRewardWin,this._activityID):ViewManager.ins().open(SDRewardWin,this._activityID);break}}},e.prototype.updateLock=function(){if(this.lock){var t=this.tabD.selectedItem;this.lock.visible=!t.isOpen,this.eLockLab.text="活动第"+t.day+"天开启，敬请期待"}},e.prototype.onClickBtn=function(t){if(this._curDayIndex!=t.currentTarget.selectedIndex){var e=this.tabD.getChildAt(this._curDayIndex);e.selected=!1,e=this.tabD.getChildAt(t.currentTarget.selectedIndex),e.selected=!1;var i=e.data;i.isOpen?this._curDayIndex=t.currentTarget.selectedIndex:this.showType||(this._curDayIndex=t.currentTarget.selectedIndex),this.updateLock(),this.tabD.selectedIndex=this._curDayIndex,e=this.tabD.getChildAt(this._curDayIndex),e.selected=!0,this.updateTabs(),this.tabP.selectedIndex=this._curGroupIndex=0,this.item.viewport.scrollV=0,this.updateData()}},e.prototype.onTabBtn=function(t){this._curGroupIndex!=t.currentTarget.selectedIndex&&(this._curGroupIndex=t.currentTarget.selectedIndex,this.tabP.selectedIndex=this._curGroupIndex,this.updateData())},e.prototype.updateTabs=function(){var t,e,i,n=this._items[this._curDayIndex],s=this.ins.getActivityDataById(this._activityID),o=[];for(var a in n){o.push({res:n[a][0].gName,showRed:!1}),t=n[a].length;for(var r=0;t>r;r++)if(i=n[a][r],e=s.achieveInfo[i.index-1],this._curDay>=(i.day||0)&&!e.isGot&&e.times>=i.dayLimit){o[a].showRed=!0;break}}this._tabCollect.source=o},e.prototype.setTime=function(){var t=this.ins.getActivityDataById(this._activityID);t&&(this.actTime0.text=t.getRemainTime())},e}(BaseEuiView);__reflect(HappySevenDayWin.prototype,"HappySevenDayWin"),window.HappySevenDayWin=HappySevenDayWin,ViewManager.ins().reg(HappySevenDayWin,LayerManager.UI_Main);var HSDTabListItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.bg.source=t.res,this.eRp.visible=this.data.showRed}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.chosen.visible=t,this.eRp.visible=this.data?this.data.showRed:!1},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(HSDTabListItemRender.prototype,"HSDTabListItemRender"),window.HSDTabListItemRender=HSDTabListItemRender;var SDRewardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SDRewardSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=SDShowItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,n=(Object.keys(GlobalConfig.ActivityType11_1Config[t[0]]).length,[]);for(var s in GlobalConfig.ActivityType11_1Config[t[0]])i=GlobalConfig.ActivityType11_1Config[t[0]][s],n.push({reward:i.reward,showText:i.showText});this.list.dataProvider=new eui.ArrayCollection(n)},e}(BaseEuiView);__reflect(SDRewardWin.prototype,"SDRewardWin"),ViewManager.ins().reg(SDRewardWin,LayerManager.UI_Main),window.SDRewardWin=SDRewardWin;var SDShowItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase},e.prototype.dataChanged=function(){this.scheduleTxt.textFlow=TextFlowMaker.generateTextFlow1(this.data.showText),this.list.dataProvider=new eui.ArrayCollection(this.data.reward)},e}(BaseItemRender);__reflect(SDShowItemRender.prototype,"SDShowItemRender"),window.SDShowItemRender=SDShowItemRender;var KaiMenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KMHRechargeItem",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){if(this.data&&this.data instanceof KaiMenData){if(this.data.already)return void TipsCT.ins().showTips("已购买");if(this.data.unready)return void TipsCT.ins().showTips("已过期");if(3==this.data.type){if(!this.data.redPoint)return void ViewManager.ins().open(RechargeWin)}else if(1==this.data.type&&!this.data.redPoint)return void TipsCT.ins().showTips("未达到条件");this.ins.sendReward(this.data.id,this.data.index)}},e.prototype.dataChanged=function(){if(this.data&&this.data instanceof KaiMenData&&(this.unready.visible=this.data.unready,this.already.visible=this.data.already,this.redPoint.visible=this.data.redPoint,this.reward.dataProvider=new eui.ArrayCollection(this.data.reward),this.data.actType==ActivityType.Normal?this.ins=Activity.ins():this.ins=PActivity.ins(),3==this.data.type?(this.unready.visible?this.get.visible=!1:this.get.visible=!this.already.visible,this.day.text="第"+this.data.day+"天",DisplayUtils.removeFromParent(this.daySchedule),this.get.parent||this.buyGroup.addChild(this.get)):1==this.data.type&&(this.unready.visible?this.get.visible=!1:(this.get.visible=this.redPoint.visible,this.get.parent||this.buyGroup.addChild(this.get)),this.unready.visible=!1,this.day.text="连充"+this.data.day+"天",this.already.visible?DisplayUtils.removeFromParent(this.daySchedule):this.daySchedule.parent||this.buyGroup.addChild(this.daySchedule)),this.get.visible||DisplayUtils.removeFromParent(this.get),3!=this.data.type||this.data.redPoint?this.get.label="领取":this.get.label="充值",this.daySchedule.parent)){var t=this.ins.getActivityDataById(this.data.id),e=65280;this.daySchedule.textFlow=TextFlowMaker.generateTextFlow1("累充|C:"+e+"&T:"+t.dabiao[this.data.index-1]+"|/"+this.data.day+"天")}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(KaiMenItem.prototype,"KaiMenItem");var KaiMenData=function(){function t(){}return t}();__reflect(KaiMenData.prototype,"KaiMenData"),window.KaiMenItem=KaiMenItem;var LaBaBossPlayerItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaBossPlayerRankSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.rank.text=this.data.rank+"",this.rank.visible=this.data.rank?!0:!1,this.name1.text=this.data.name,CommonUtils.labelIsOverLenght(this.hurt,this.data.damage))},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(LaBaBossPlayerItemRender.prototype,"LaBaBossPlayerItemRender"),window.LaBaBossPlayerItemRender=LaBaBossPlayerItemRender;var LabaBossUIPanel=function(t){function e(){var e=t.call(this)||this;return e._curMonsterID=0,e.skinName="LaBaBossBattleUiSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.bloodBar.slideDuration=0,this.grayImg.visible=!1,this.already=!1,this.bossHurt=!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.otherRank.itemRenderer=LaBaBossPlayerItemRender,this.rankArrayCollection=new eui.ArrayCollection,this.otherRank.dataProvider=this.rankArrayCollection,this.meRank.itemRenderer=LaBaBossPlayerItemRender,this.myrankArrayCollection=new eui.ArrayCollection,this.meRank.dataProvider=this.myrankArrayCollection},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this),this._curMonsterID=0,ViewManager.ins().close(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.observe(BossCT.ins().postHpChange,this.updateInfo),this.addTouchEvent(this.rankReward,this.onTap),this.updateData(),this.activity&&this.activity.go2BossFb()?void this.init():(ViewManager.ins().close(this),void FbCT.ins().sendExitFb())},e.prototype.init=function(){this.timer=this.activity.getResidueTimer(),this.readyTimer=this.activity.getResidueStartTimer(),this.already=this.activity.checkRedPoint(),this.TimerChange()},e.prototype.updateData=function(){this.activity=Activity.ins().checkLabaBossData()},e.prototype.updateLogic=function(){this.already?this.updateFb():this.updateReady(),this.refreshBg.visible=this.refreshHints.visible=this.refreshTime.visible=!this.already,this.bossBloodGroup.visible=this.already},e.prototype.updateReady=function(){this.readyTimer?this.refreshTime.text=this.readyTimer+"秒":this.refreshTime.text="刷新中",this.bossHurt?(this.timer=this.activity.getResidueTimer(),this.already=!0):this.already=!1
},e.prototype.updateFb=function(){this.updateBaseInfo();var t=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index],e=this.timer/t.duration;e=e>=1?1:e,this.bloodBar.value=100*e,this.bloodBar.maximum=100;var i=(100*e).toFixed(1);this.bloodBar.labelFunction=function(){return i+"%"},this.updateHurtRank()},e.prototype.updateHurtRank=function(){for(var t=[],e=[],i=0;i<BossCT.ins().rank.length;i++){var n=BossCT.ins().rank[i],s={rank:n.rank,name:n.roleName,damage:n.value};if(5>i&&t.push(s),n.id==Actor.actorID&&e.push(s),5==t.length&&!e.length)break}if(!e.length){var s={rank:0,name:Actor.myName,damage:0};e.push(s)}this.rankArrayCollection.replaceAll(t),this.myrankArrayCollection.replaceAll(e)},e.prototype.updateBaseInfo=function(){if(this._curMonsterID!=BossCT.ins().monsterID){this._curMonsterID=BossCT.ins().monsterID;var t=GlobalConfig.MonstersConfig[BossCT.ins().monsterID];t&&(this.head.source="monhead"+t.head+"_png",this.lvTxt.text="Lv."+t.level,this.nameTxt.text=t.name)}},e.prototype.TimerChange=function(){Timer.has(this.calcTime,this)||Timer.start(1e3,0,this.calcTime,this),Timer.has(this.updateLogic,this)||Timer.start(60,0,this.updateLogic,this)},e.prototype.calcTime=function(){this.timer>0?this.timer--:this.timer=0,this.bossHurt?this.readyTimer=0:this.readyTimer>0&&this.readyTimer--},e.prototype.onTap=function(t){switch(t.currentTarget){case this.rankReward:ViewManager.ins().open(LabaRewardTips,this.activity)}},e.prototype.updateInfo=function(){this.bossHurt=!0},e}(BaseEuiView);__reflect(LabaBossUIPanel.prototype,"LabaBossUIPanel"),ViewManager.ins().reg(LabaBossUIPanel,LayerManager.Game_Main),window.LabaBossUIPanel=LabaBossUIPanel;var LabaChangeItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.config,e=this.data.state,i=Activity.ins().getActivityDataById(t.Id);this._dataCollect||(this._dataCollect=new eui.ArrayCollection,this.reward.dataProvider=this._dataCollect),this.result.data=t.rewards[0];var n=[];for(var s in t.items){var o=GlobalConfig.ItemConfig[t.items[s].id],a={id:t.items[s].id,count:t.items[s].count,type:ItemUtil.getType(o)};n.push(a)}this._dataCollect.replaceAll(n),this.reward.validateNow();for(var s=0;s<this.reward.numElements;s++){var r=this.reward.getVirtualElementAt(s),l=this.reward.dataProvider.getItemAt(s),h=BagCT.ins().getBagItemById(l.id),u=h?h.count:0,p=u>=l.count?65280:16711680;r.setName("|C:"+p+"&T:("+u+"/"+l.count+")")}var c=0;e==Activity.CanGet?(this.get.enabled=!0,this.get.currentState="up",c=65280):(this.get.enabled=!1,this.get.currentState="disabled",c=16711680);var d=0;t.count?(d=t.count-i.personalRewardsSum[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("剩余："+d)):t.dailyCount&&(d=t.dailyCount-i.exchange[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("今日剩余："+d)),t.scount?(this.slimit.visible=!0,d=t.scount-i.worldRewardsSum[t.index],d=d>0?d:0,this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("今日全服可兑换次数："+d)):this.slimit.visible=!1,this.redPoint.visible=this.get.enabled;for(var g=3,s=0;g>s;s++)t.items[g-s-1]||this["add"+(g-s-1)]&&DisplayUtils.removeFromParent(this["add"+(g-s-1)])}},e.prototype.onTap=function(t){return this.data&&this.data.config?BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void Activity.ins().sendReward(this.data.config.Id,this.data.config.index):void TipsCT.ins().showTips("数据异常")},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(LabaChangeItemRender.prototype,"LabaChangeItemRender"),window.LabaChangeItemRender=LabaChangeItemRender;var LaBaRewardItemItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=ItemBase},e.prototype.dataChanged=function(){if(this.data){var t=this.data.config,e=this.data.index,i=t.rankReward[e],n="";n=e==t.rankReward.length-1?"其他名次":i.start==i.endi?"第"+i.start+"名":"第"+i.start+"-"+i.endi+"名",this.ranks.text=n,this.rewardList.dataProvider=new eui.ArrayCollection(i.reward)}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(LaBaRewardItemItemRender.prototype,"LaBaRewardItemItemRender"),window.LaBaRewardItemItemRender=LaBaRewardItemItemRender;var LabaRewardTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaRankRewardskin",e}return __extends(e,t),e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list0.itemRenderer=LaBaRewardItemItemRender,this.addTouchEvent(this.bgClose,this.onClick),this.activity=t[0],this.updateView()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateView=function(){if(this.activity){for(var t=GlobalConfig.ActivityType20Config[this.activity.id][this.activity.index],e=[],i=0;i<t.rankReward.length;i++)e.push({config:t,index:i});this.list0.dataProvider=new eui.ArrayCollection(e)}},e}(BaseEuiView);__reflect(LabaRewardTips.prototype,"LabaRewardTips"),ViewManager.ins().reg(LabaRewardTips,LayerManager.UI_Popup),window.LabaRewardTips=LabaRewardTips;var LabaWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="LaBaWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this._pageStyle=ActivityPageStyle.LABA,this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t in Activity.ins().activityData)if(Activity.ins().activityData[t]&&Activity.ins().activityData[t].pageStyle==ActivityPageStyle.LABA&&Activity.ins().getActivityDataById(+t).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.observe(TaskCT.ins().postCloseInvestmentTask,this.zeroUpdate),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],e=0;for(var i in Activity.ins().activityData)if(Activity.ins().activityData[i]&&Activity.ins().activityData[i].pageStyle==this._pageStyle&&Activity.ins().getActivityDataById(+i).isOpenActivity()){var n=Activity.ins().getbtnInfo(i);ErrorLog.Assert(n,"laba  data   "+i)||this._datas.push(n)}this._datas.sort(this.sort),this.BtnArr=[];for(var i in this._datas){var s=this._datas[i].id,o=Activity.ins().getActivityDataById(+s);if(o&&o.id==s){var a=o.getHide();if(!a){var r=ActivityPanel.create(s,ActivityType.Normal);if(!r)continue;r.top=0,r.left=0,r.bottom=0,r.right=0,this.activityPanelList[e]=r,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[i]),this.actId&&this.actId==s&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var l=92*t;l>this.menuList.contentWidth-this.menuScroller.width&&(l=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=l}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&this.setOpenIndex(this.selectIndex)}},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:0},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(LabaWin.prototype,"LabaWin"),ViewManager.ins().reg(LabaWin,LayerManager.UI_Main),window.LabaWin=LabaWin;var OSATarget21Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this),Timer.stop(this.setTime,this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="LaBaActivityTimeDrop"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.rewardList.itemRenderer=ItemBase,this.updateData(),this.updateUI(),Timer.start(1e3,0,this.setTime,this)},e.prototype.updateData=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.showReward&&(this.rewardList.dataProvider=new eui.ArrayCollection(t.showReward))},e.prototype.updateUI=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(DateUtils.formatMiniDateTime(t.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND),i=Math.floor(DateUtils.formatMiniDateTime(t.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":(this._time=i,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3));var n=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=n.desc;var s=GlobalConfig.ActivityBtnConfig[this.activityID];s&&(this.title.source=s.title)},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this._time=t.getleftTime(),this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(ActivityPanel);__reflect(OSATarget21Panel.prototype,"OSATarget21Panel"),window.OSATarget21Panel=OSATarget21Panel;var OSATarget7Panel6=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e.skinName="LaBaexchangeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actInfo0.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.content.itemRenderer=LabaChangeItemRender},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemAdd,this.updateList),this.observe(BagCT.ins().postItemChange,this.updateList),this.observe(Activity.ins().postActivityIsGetAwards,this.updateList),this.updateData()},e.prototype.close=function(){this.removeObserve(),Timer.stop(this.setTime,this),this._leftTime=0},e.prototype.updateData=function(){this._activityData=Activity.ins().getActivityDataById(this.activityID),this.checkTime(),this.updateList()},e.prototype.updateList=function(){var t=[],e=GlobalConfig.ActivityType7Config[this.activityID];for(var i in e){var n=this._activityData.getExchange(e[i].index);t.push({config:e[i],state:n})}t.sort(this.sort),this._dataCollect||(this._dataCollect=new eui.ArrayCollection,this.content.dataProvider=this._dataCollect),this._dataCollect.replaceAll(t)},e.prototype.sort=function(t,e){return t.config.index<e.config.index?-1:1},e.prototype.checkTime=function(){this._leftTime=0,Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0?this.actTime0.text="活动未开启":(this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3),this._leftTime<=0?this.actTime0.text="活动已结束":(this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)))},e.prototype.setTime=function(){this._activityData&&(this._leftTime=this._activityData.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),this._leftTime<=0&&this.checkTime())},e}(BaseView);__reflect(OSATarget7Panel6.prototype,"OSATarget7Panel6"),window.OSATarget7Panel6=OSATarget7Panel6;var FireworkerItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e.skinName="fireworkerItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.touchEnabled=2!=this.data.state,this.redPoint.visible=1==this.data.state,this.lingqu.visible=2==this.data.state;var t=0==this.data.state?16711680:65280;if(this.boxSchadule.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+(this.data.curTimes>this.data.times?this.data.times:this.data.curTimes)+"|/"+this.data.times),this.count.text=this.data.count,1==this.data.type){var e=GlobalConfig.ItemConfig[this.data.id];this.box.source=e.icon+"_png"}else this.box.source="richman_reward"},e}(BaseItemRender);__reflect(FireworkerItemRender.prototype,"FireworkerItemRender"),window.FireworkerItemRender=FireworkerItemRender;var HighProjectItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="highProjectItemSkin",e.touchChildren=!1,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTouch,e),e}return __extends(e,t),e.prototype.dataChanged=function(){this.projectName.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.data.config.name),this.jifen.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+this.data.config.score+"|点");var t=this.data.config.rate?this.data.config.rate:1,e=Math.floor(this.data.times/t),i=Math.floor(this.data.config.target/t);e>i&&(e=i),this.daliyCount.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+e+"|/"+i)},e.prototype.onTouch=function(t){this.data.config.turn&&ViewManager.ins().open(this.data.config.turn[0],this.data.config.turn[1])},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HighProjectItemRender.prototype,"HighProjectItemRender"),window.HighProjectItemRender=HighProjectItemRender;var HighRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="highRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.dataChanged=function(){this.count.text=this.data.config.score,this.currentState=2==this.data.state?"done":1==this.data.state?"kelingqu":"normal",this._listCollect.source=this.data.config.reward},e.prototype.onTouch=function(t){Activity.ins().sendReward(this.data.activityID,this.data.index,1)},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(HighRewardItemRender.prototype,"HighRewardItemRender"),window.HighRewardItemRender=HighRewardItemRender;var CDFanliShopItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDFanliShopItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){var t=this.data[1],e=this.data[0],i=GlobalConfig.ActivityType34Config[t],n=i.goodsinfo[e.id];this.itemIcon.num=n.count,this.itemIcon.data=e.id,this.discountNum0.text=n.zhe+"",this.original0.text=n.price+"",this.now0.text=n.discount+"",this.pay.text="您已购买："+e.num,this.pay1.text="全服购买："+e.allServerNum}},e}(BaseItemRender);__reflect(CDFanliShopItemRender.prototype,"CDFanliShopItemRender"),window.CDFanliShopItemRender=CDFanliShopItemRender;var DailyRechargeItemRender=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._totalRecharge=0,e._activityID=0,e._index=0,e.skinName="DailyRechargeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){this._config=this.data[0],this._state=this.data[1],this._totalRecharge=this.data[2],this._activityID=this.data[3],this._index=this.data[4],this.target.text="累计充值"+this._config.val+"元宝",this.recharge.text="("+(this._totalRecharge>this._config.val?this._config.val:this._totalRecharge)+"/"+this._config.val+")",this.reward.dataProvider=new eui.ArrayCollection(this._config.rewards),this.redPoint.visible=1==this._state,this.get.enabled=1==this._state,this.get.label=2==this._state?"已领取":1==this._state?"领取":"未完成"},e.prototype.onTap=function(t){this._config instanceof ActivityType3Config?Activity.ins().sendReward(this._activityID,this._index):this._config instanceof PActivity3Config&&PActivity.ins().sendReward(this._activityID,this._index)},e}(BaseItemRender);__reflect(DailyRechargeItemRender.prototype,"DailyRechargeItemRender"),window.DailyRechargeItemRender=DailyRechargeItemRender;var DailyRechargePanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="DailyRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.content.itemRenderer=DailyRechargeItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),Timer.start(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.updateData();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo0.text=i.desc},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);var i,n=[],s=0,o=0;for(var a in e)i=e[a],o=t.recrod>>i.index&1?2:t.chongzhiTotal>=i.val?1:0,n[s]=[i,o,t.chongzhiTotal,this.activityID,i.index],s++;this.content.dataProvider=new eui.ArrayCollection(n),this._time=t.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4)}this._time>0&&(this._time-=1,this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,4))},e}(BaseView);__reflect(DailyRechargePanel.prototype,"DailyRechargePanel"),window.DailyRechargePanel=DailyRechargePanel;var InvestmentResultItemWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="InvestmentResultItem",e.eList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eList.dataProvider=new eui.ArrayCollection(t.reward),this.eInfo.text="第"+t.target+"天";var e=TaskCT.ins().getInvestmentTask(t.id,t.index);this.eGetImg.visible=e&&2==e.status}},e}(BaseItemRender);__reflect(InvestmentResultItemWin.prototype,"InvestmentResultItemWin"),window.InvestmentResultItemWin=InvestmentResultItemWin;var InvestmentResultWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="InvestmentResult",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.InvestmentReward.itemRenderer=InvestmentResultItemWin,this.InvestmentReward.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.data=Activity.ins().activityData[this.activityID];var i=GlobalConfig.ActivityType41Config[this.activityID],n=CommonUtils.objectToArray(GlobalConfig.InvestmentTaskConfig[i.taskid]);this.listDP.replaceAll(n)},e}(BaseEuiView);__reflect(InvestmentResultWin.prototype,"InvestmentResultWin"),window.InvestmentResultWin=InvestmentResultWin,ViewManager.ins().reg(InvestmentResultWin,LayerManager.UI_Main);var OSA3HeroesPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.skinName="OSA3Heroes",n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.active,this.onTap),this.observe(ThreeHeroes.ins().postInfoChange,this.updateData),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){t.currentTarget==this.active&&(ThreeHeroes.ins().awardState==ThreeHeroes.NotActive?ViewManager.ins().open(VipWin,[4]):ThreeHeroes.ins().awardState==ThreeHeroes.CanGet?ThreeHeroes.ins().sendReward():ThreeHeroes.ins().awardState==ThreeHeroes.Active&&TipsCT.ins().showTips("再登陆"+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+"天可领取20000元宝"))},e.prototype.getTime=function(t){var e=(GlobalConfig.GuildBattleConst.openServer,new Date(t.startTime)),i=e.getMonth()+1+"月"+e.getDate()+"日-";e=new Date(t.endTime-1e3*DateUtils.SECOND_PER_DAY);var n=e.getMonth()+1+"月"+e.getDate()+"日23:59";return i+n},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=this.getTime(t);var n=ThreeHeroes.ins().awardState;this.active.enabled=n!=ThreeHeroes.Geted,this.redPoint.visible=n==ThreeHeroes.CanGet,n==ThreeHeroes.NotActive?this.active.label="激活":n==ThreeHeroes.CanGet||n==ThreeHeroes.Active?this.active.label="领取奖励":this.active.label="已领取";var s=GlobalConfig.ActivityBtnConfig[this.activityID];this.actInfo.text=s.acDesc,this.state.text=n==ThreeHeroes.Active?"再登陆"+(GlobalConfig.LoginActivateConfig.loginDays-ThreeHeroes.ins().loginDays)+"天可领取20000元宝":""},e}(BaseView);__reflect(OSA3HeroesPanel.prototype,"OSA3HeroesPanel"),window.OSA3HeroesPanel=OSA3HeroesPanel;var OSADailyRechargeRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSADailyRechargeItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.eList.itemRenderer=ItemBase,this.eBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.eName.text="累计充值"+e.pay+"元宝",this.eList.dataProvider=new eui.ArrayCollection(e.awardList.concat());var i=Recharge.ins().getRechargeData(0);if(i.curDayPay>=e.pay){var n=i.isAwards>>e.index&1;n?(this.eBtn.label="已领取",this.eBtn.enabled=!1):(this.eBtn.label="领取",this.eBtn.enabled=!0)}else this.eBtn.label="未完成",this.eBtn.enabled=!1},e.prototype.onTap=function(t){Recharge.ins().getDayReward(this.data.index)},e}(BaseItemRender);__reflect(OSADailyRechargeRender.prototype,"OSADailyRechargeRender"),window.OSADailyRechargeRender=OSADailyRechargeRender;var OSARankTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARankTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.arr=t[0],this.rankType=t[1],this.record.itemRenderer=OSATargetItemRender4,this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.init=function(){switch(this.rankType){case RankDataType.TYPE_BAOSHI:this.title.text="开服淬炼榜";break;case RankDataType.TYPE_LONGHUN:this.title.text="开服魂印榜";break;case RankDataType.TYPE_WING:this.title.text="开服翅膀榜";break;case RankDataType.TYPE_BOOK:this.title.text="开服图鉴榜";break;case RankDataType.TYPE_ZS:this.title.text="开服转生榜";break;case RankDataType.TYPE_SCORE:this.title.text="开服装备榜";break;case RankDataType.TYPE_HF_XIAOFEI:this.title.text="合服消费榜";break;case RankDataType.TYPE_RING:this.title.text="神戒排行榜";break;case RankDataType.TYPE_YUANSHEN:this.title.text="元神排行榜"}this.record.dataProvider=new eui.ArrayCollection(this.arr)},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(OSARankTipsWin.prototype,"OSARankTipsWin"),ViewManager.ins().reg(OSARankTipsWin,LayerManager.UI_Popup),window.OSARankTipsWin=OSARankTipsWin;var GlobalFun=function(){function t(){}return t.checkMoney=function(t,e,i,n){switch(void 0===e&&(e=MoneyConst.yuanbao),void 0===i&&(i=""),e){case MoneyConst.gold:if(Actor.gold>=t)return!0;""==i&&(i="金币不足"),TipsCT.ins().showTips(i);break;case MoneyConst.yuanbao:if(Actor.yb>=t)return!0;if(""==i&&(i="元宝不足"),TipsCT.ins().showTips(i),!KFServerSys.ins().isKF&&!LocationProperty.isTSServer){var s=WarnWin.show("元宝不足，是否前往充值？",null,null,function(){var t=Recharge.ins().getRechargeData(0);t&&0!=t.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win),n&&"function"==typeof n&&n()});s.setBtnLabel("取消","前往")}break;default:return console.log("检查货币类型不对，请检查=",e),!1}return!1},t.getRomanNumStr=function(t){var e="";if(t>0){for(var i=Math.floor(t/1e3),n=Math.floor(t%1e3/100),s=Math.floor(t%100/10),o=t%10,a=["I","II","III","IV","V","VI","VII","VIII","IX"],r=["X","XX","XXX","XL","L","LX","LXX","LXXX","XC"],l=["C","CC","CCC","CD","D","DC","DCC","DCCC","CM"],h="M",u=0;i>u;u++)e+=h;n&&(e+=l[n-1]),s&&(e+=r[s-1]),o&&(e+=a[o-1])}return e},t.arrShuffle=function(t){for(var e=t.length,i=0;e-1>i;i++){var n=Math.floor(Math.random()*(e-i)),s=t[n];t[n]=t[e-i-1],t[e-i-1]=s}},t.showDetail=function(t,e,i,n,s,o){if(void 0===e&&(e=null),void 0===i&&(i=1),void 0===n&&(n=null),void 0===s&&(s=""),void 0===o&&(o=""),t){var a=!0;if(t.id==GlobalConfig.TeamFuBenBaseConfig.itemId)return void ViewManager.ins().open(FlowerUseTipsWin);switch(ItemUtil.getType(t)){case ItemType.TYPE_0:case ItemType.TYPE_4:case ThunderEquipPanel.TYPE:this.openEquipsTips(t,e);break;case ItemType.TYPE_35:ViewManager.ins().open(TitleTipsWin,e);break;case ItemType.TYPE_1:e&&e.handle&&GlobalConfig.ItemComposeConfig[t.id]&&!GlobalConfig.ItemComposeConfig[t.id].dropId?ViewManager.ins().open(ItemUseTipsWin,e):Dress.ins().isZhuangBanItem(t.id)?ViewManager.ins().open(DressTipsWin,t,e&&null!=e.handle):MoJianCT.isMoJian(t.id)?ViewManager.ins().open(MoJianTipsWin,t.id):ViewManager.ins().open(ItemDetailedWin,0,t.id,e?e.count:1);break;case ItemType.TYPE_8:case ItemType.TYPE_20:case ItemType.TYPE_47:if(e&&1==e.type)ViewManager.ins().open(ItemDetailedWin,0,t.id,e.count);else{for(a=!1;n&&n.parent;)if(n=n.parent,n instanceof BagWin){a=!0;break}a?ViewManager.ins().open(ItemUseTipsWin,{itemConfig:t,configID:t.id,count:i}):ViewManager.ins().open(ItemDetailedWin,0,t.id,i)}break;case ItemType.TYPE_22:ViewManager.ins().open(ZhanlingZBTipWin,t.id);break;case ItemType.TYPE_41:ViewManager.ins().open(SmItemTipsWin,t.id,e);break;case ItemType.TYPE_45:case ItemType.TYPE_46:ViewManager.ins().open(KingEquipTipsWin,t.id)}}},t.openEquipsTips=function(t,e){void 0===e&&(e=null);var i=ItemUtil.getSubType(t);return ItemUtil.getType(t)==ThunderEquipPanel.TYPE?void ViewManager.ins().open(ThunderEquipTipsWin,0,i,e):void(i>=EquipPos.HAT&&i<=EquipPos.SHIELD?ViewManager.ins().open(SamsaraEquipTips,t.id):GlobalConfig.HotBloodAwakeConf.legendEquip.indexOf(t.id)>-1?ViewManager.ins().open(LegendTipsWin,t.id,e):ViewManager.ins().open(EquipDetailedWin,1,e?e.handle:null,t.id,e))},t}();__reflect(GlobalFun.prototype,"GlobalFun"),window.GlobalFun=GlobalFun;var OSATarget0Panel1=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.skinName="OSAComp",n.effs=[],n.rewards=[{type:1,id:900007,count:1},{type:1,id:900008,count:1},{type:1,id:900009,count:1},{type:0,id:2,count:2e4}],n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.go,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve();for(var i=0;i<this.effs.length;i++)this.effs[i]&&DisplayUtils.removeFromParent(this.effs[i]);this.effs=[]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.go:0!=Guild.ins().guildID?(ViewManager.ins().close(ActivityWin),GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),ViewManager.ins().open(GuildWarMainWin)):TipsCT.ins().showTips("还没加入行会")
}},e.prototype.getTime=function(t){var e=GlobalConfig.GuildBattleConst.openServer,i=new Date(t.startTime-1e3*DateUtils.SECOND_PER_DAY);i.setDate(i.getDate()+e.day),i.setHours(e.hours,e.min||0,0,0);var n=i.getMonth()+1+"月"+i.getDate()+"日"+e.hours+":"+e.min+"-",s=e.hours+":"+(e.min+GlobalConfig.GuildBattleConst.continueTime/60),o=i.getDay(),a=["(周日)","(周一)","(周二)","(周三)","(周四)","(周五)","(周六)"];return n+s+a[Number(o)]},e.prototype.updateData=function(t){void 0===t&&(t=1);var e=Activity.ins().getActivityDataById(this.activityID),i=Math.floor(e.startTime/1e3-GameServer.serverTime/1e3),n=Math.floor(e.endTime/1e3-GameServer.serverTime/1e3);i>=0?(this.actTime.text="活动未开启",this.over.visible=!1):0>=n?(this.actTime.text="活动已结束",this.over.visible=!0):(this.over.visible=!1,this.actTime.text=this.getTime(e)),this.go.visible=!this.over.visible;for(var s=1;4>=s;s++)this["reward"+s].data=this.rewards[s-1];for(var s=1;3>=s;s++){var o="LegenEqui";if(!this.effs[s-1]||!this.effs[s-1].parent){var a=new MovieClip;a.x=this["reward"+s].width/2,a.y=this["reward"+s].height/2,a.y-=10,a.playFile(RES_DIR_EFF+o,-1),this["reward"+s].addChild(a),this.effs.push(a)}}},e}(BaseView);__reflect(OSATarget0Panel1.prototype,"OSATarget0Panel1"),window.OSATarget0Panel1=OSATarget0Panel1;var OSATarget0Panel10=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="ThreeActorSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this,this.onTap),this.updateData(),this.setTime()},e.prototype.onTap=function(t){switch(t.target){case this.btn:var e=GlobalConfig.VipOpenServerConfig,i=SubRoles.ins().subRolesLen;i<e.roleCount?ViewManager.ins().open(NewRoleWin):Actor.vip<e.vipLevel&&ViewManager.ins().open(VipWin,e.vipLevel)}},e.prototype.updateData=function(){this.data=Activity.ins().getActivityDataById(this.activityID);var t=Math.floor(this.data.startTime-GameServer.serverTime)/1e3,e=Math.floor(this.data.endTime-GameServer.serverTime)/1e3;t>=0?this.actTime0.text="活动未开启":0>=e?this.actTime0.text="活动已结束":this.actTime0.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3);var i=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=i.title,this.actDesc0.textFlow=TextFlowMaker.generateTextFlow1(i.acDesc),this.eOpenLab.visible=VipCT.ins().openVip&&VipCT.ins().openVip.isAct,this.btn.visible=!this.eOpenLab.visible},e.prototype.setTime=function(){if(this.data){var t=Math.floor(this.data.endTime/1e3-GameServer.serverTime/1e3);0>t&&(t=0),this.actTime0.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,3)}},e}(BaseView);__reflect(OSATarget0Panel10.prototype,"OSATarget0Panel10"),window.OSATarget0Panel10=OSATarget0Panel10;var KeyboardUtils=function(t){function e(){var e=t.call(this)||this;if(e.key_ups=[],e.key_downs=[],DeviceUtils.IsHtml5&&urlParam.isLocation){var i=e;document.addEventListener("keyup",function(t){for(var e=0,n=i.key_ups.length;n>e;e++){var s=i.key_ups[e][0],o=i.key_ups[e][1];o?s.call(o,t.keyCode):s(t.keyCode)}}),document.addEventListener("keydown",function(t){for(var e=0,n=i.key_downs.length;n>e;e++){var s=i.key_downs[e][0],o=i.key_downs[e][1];o?s.call(o,t.keyCode):s(t.keyCode)}})}return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.addKeyUp=function(t,e){this.key_ups.push([t,e])},e.prototype.addKeyDown=function(t,e){this.key_downs.push([t,e])},e.prototype.removeKeyUp=function(t,e){for(var i=0;i<this.key_ups.length;i++)this.key_ups[i][0]==t&&this.key_ups[i][1]==e&&(this.key_ups.splice(i,1),i--)},e.prototype.removeKeyDown=function(t,e){for(var i=0;i<this.key_downs.length;i++)this.key_downs[i][0]==t&&this.key_downs[i][1]==e&&(this.key_downs.splice(i,1),i--)},e}(BaseClass);__reflect(KeyboardUtils.prototype,"KeyboardUtils");var OSATarget0Panel3=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="OSADailyRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.dailyReward.itemRenderer=OSADailyRechargeRender},e.prototype.open=function(){this.observe(Recharge.ins().postUpdateRechargeEx,this.updateList),Timer.start(1e3,0,this.setTime,this),this.initList()},e.prototype.updateData=function(){this.updateList()},e.prototype.updateList=function(){var t=this.dailyReward.dataProvider,e=t.source;e.sort(this.sort),t.refresh(),this.updateTime(),this.updateValue()},e.prototype.updateTime=function(){this.setTime();var t=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=t.acDesc},e.prototype.initList=function(){var t=Recharge.ins().getCurRechargeConfig(),e=[];for(var i in t)e.push(t[i]);e.sort(this.sort),this.dailyReward.dataProvider=new eui.ArrayCollection(e),this.updateTime(),this.updateValue()},e.prototype.updateValue=function(){var t=Recharge.ins().getRechargeData(0);this.record.text="已充值"+t.curDayPay+"元宝"},e.prototype.sort=function(t,e){var i=Recharge.ins().getRechargeData(0),n=i.isAwards>>t.index&1,s=i.isAwards>>e.index&1;return n&&!s?1:!n&&s?-1:t.pay<e.pay?-1:1},e.prototype.setTime=function(){var t=new Date(GameServer.serverTime);t.setHours(23,59,59,0),this._time=Math.floor((t.getTime()-GameServer.serverTime)/1e3),this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)},e.prototype.close=function(){this.removeObserve(),Timer.stopAll(this)},e}(BaseView);__reflect(OSATarget0Panel3.prototype,"OSATarget0Panel3"),window.OSATarget0Panel3=OSATarget0Panel3;var OSATarget0Panel4=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoopRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){this.setData(),this.observe(Recharge.ins().postMuchDayRecReward,this.setData)},e.prototype.close=function(){this.removeObserve()},e.prototype.setData=function(){var t=GlobalConfig.MultiDayRechargeConfig,e=0;for(var i in t[1].awardList){if(e<=GameServer.serverOpenDay&&GameServer.serverOpenDay<parseInt(i))break;e=parseInt(i)}var n=0,s=Recharge.ins().mDayNum;s=Recharge.ins().mRecNum>=t[s].num?Recharge.ins().mDayNum:Recharge.ins().mDayNum-1;for(var i in t){var o=t[i];this["reward"+n].itemRenderer=ItemBase,this["reward"+n].dataProvider=new eui.ArrayCollection(o.awardList[e]);var a=StringUtils.addColor("（"+(s>n+1?i:s)+"/"+i+"）",s>=parseInt(i)?65280:16750848);this["target"+n].textFlow=(new egret.HtmlTextParser).parser("累计"+i+"天"+a+"充值"+o.num+"元宝"),this["already"+n].visible=this["redPoint"+n].visible=!1,this["get"+n].visible=!0,Recharge.ins().mDayNum>parseInt(i)?(this["get"+n].visible=!1,this["already"+n].visible=!0,this["get"+n].enabled=!1):Recharge.ins().mDayNum==parseInt(i)&&Recharge.ins().mRecNum>=o.num&&0==Recharge.ins().mReward?(this["redPoint"+n].visible=!0,this["get"+n].label="立即领取",this["get"+n].enabled=!0,this.addTouchEvent(this["get"+n],this.onTap)):this["get"+n].enabled=!1,n++}this.todayRecharge.text="本日累计充值："+Recharge.ins().mRecNum;var r=Activity.ins().getbtnInfo(this.activityID);this.actInfo0.text=r.acDesc},e.prototype.onTap=function(){Recharge.ins().sendMuchDayRecReward()},e}(BaseView);__reflect(OSATarget0Panel4.prototype,"OSATarget0Panel4"),window.OSATarget0Panel4=OSATarget0Panel4;var OSATarget0Panel5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.content.useVirtualLayout=!0,this.content.itemRenderer=OSATargetLuxury42ItemRender,this.bigReward.itemRenderer=OSATargetLuxury42ItemRender2},e.prototype.open=function(){this.content.dataProvider?this.updateData():this.updateList(),this.observe(Recharge.ins().postRechargeTotalDay2,this.updateData)},e.prototype.updateList=function(){var t=[],e=[],i=new RewardData;i.count=0,i.id=2,i.type=0;var n={id:999,awardList:[i],sum:0};e.push(n);var s=Recharge.ins().getRechargeList2();for(var o in s){var a=s[o];t.push(a),n.sum||(n.sum=a.sum),i.id=a.awardList[0].id,i.type=a.awardList[0].type,i.count+=a.awardList[0].count,a.awardList.length>1&&a.bigReward&&e.push(a)}t.sort(this.sort),e.sort(this.sort2),this.content.dataProvider=new eui.ArrayCollection(t.splice(0,4)),this.delayUpdate(t),this.bigReward.dataProvider=new eui.ArrayCollection(e);var r=Activity.ins().getbtnInfo(this.activityID);this.actDesc.text=r.acDesc,this.title.source=r.title},e.prototype.sort=function(t,e){var i=Recharge.ins().rechargeTotal2.hasGetDays,n=i.indexOf(t.id),s=i.indexOf(e.id);return n>=0&&0>s?1:0>n&&s>=0?-1:Algorithm.sortAsc(t.id,e.id)},e}(OSATarget0Panel2);__reflect(OSATarget0Panel5.prototype,"OSATarget0Panel5"),window.OSATarget0Panel5=OSATarget0Panel5;var OSATarget0Panel8=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n._time=0,n.skinName="HeFuResetRechargeSkin",n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.pay0,this.onTap),this.updateData(),Timer.start(1e3,0,this.setTime,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.pay0:var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime1.text="活动未开启":0>=i?this.actTime1.text="活动已结束":this.actTime1.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3);var n=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=n.title,this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(n.acDesc)},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this._time=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3),this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(BaseView);__reflect(OSATarget0Panel8.prototype,"OSATarget0Panel8"),window.OSATarget0Panel8=OSATarget0Panel8;var OSATarget0Panel9=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n._time=0,n._angles=[0,0,0,0,0,0,0],n._circleCenter={x:168,y:120},n._a=155,n._b=80,n._angle=.1,n}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNWingUpSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this.pay0,this.onTap),this.observe(Hunt.ins().postHuntNum,this.updateBar),this.updateData(),Timer.start(1e3,0,this.setTime,this),Hunt.ins().sendHuntNum()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this),this.resetBalls()},e.prototype.updateBar=function(t){void 0===t&&(t=0),this.bar&&(this.bar.maximum=GlobalConfig.TreasureHuntConfig.mailCount,this.bar.value=t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.pay0:var e=GlobalConfig.ActivityBtnConfig[this.activityID];if(!e.jump)return;switch(this.bar&&ViewManager.ins().close(ActivityWin),e.jump[0]){case StatePageSysType.WING:if(Actor.level<GlobalConfig.WingCommonConfig.openLevel)return void TipsCT.ins().showTips("翅膀"+GlobalConfig.WingCommonConfig.openLevel+"级开启");ViewManager.ins().open(e.jump[1],e.jump[2],0);break;case StatePageSysType.RING:if(!LyMark.ins().checkOpen())return void TipsCT.ins().showTips("烈焰戒指达到"+GlobalConfig.FlameStamp.openLevel+"级开启");ViewManager.ins().open(e.jump[1],e.jump[2]);break;default:(i=ViewManager.ins()).open.apply(i,[e.jump[1]].concat(e.jump[2]))}}var i},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime-GameServer.serverTime)/1e3,i=Math.floor(t.endTime-GameServer.serverTime)/1e3;e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3);var n=GlobalConfig.ActivityBtnConfig[this.activityID];this.title.source=n.title,this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(n.acDesc);var s=GlobalConfig.ActivityBtnConfig[this.activityID];switch(s.jump[0]){case StatePageSysType.RING:if(this.updateBalls(),this.redPoint.visible=!1,LyMark.ins().checkOpen()&&!LyMark.ins().isMax){var o=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],a=BagCT.ins().getBagItemById(o.costItem),r=a?a.count:0;this.redPoint.visible=r>=o.costCount}}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.updateBalls=function(){if(this.img&&this.img.parent){var t=7;if(t){this.resetBalls(),this._balls||(this._balls=[],Timer.start(51,0,this.doCircle,this)),this._circleCenter.x=this.img.width/2,this._circleCenter.y=this.img.height/2+25;for(var e=void 0,i=2*Math.PI/t,n=0;t>n;n++)e=ObjectPool.pop("MovieClip"),this.img.parent.addChild(e),this._angles[n]=i*n,e.x=this._a*Math.cos(i*n)+this._circleCenter.x,e.y=this._b*Math.sin(i*n)+this._circleCenter.y,this._balls.push(e),e.playFile(RES_DIR_EFF+"FireRing1",-1)}}},e.prototype.doCircle=function(){if(!this._balls)return void Timer.stopAll(this);if(this.img&&this.img.parent)for(var t,e,i=this._balls.length,n=0,s=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,n=e.getChildIndex(this.img),s=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?s>n&&e.addChildAt(t,3):n>s&&e.addChildAt(t,e.numChildren)},e.prototype.resetBalls=function(){if(Timer.stopAll(this),this._balls){for(var t=this._balls.length,e=0;t>e;e++)DisplayUtils.removeFromParent(this._balls[e]);this._balls.length=0,this._balls=null}},e}(BaseView);__reflect(OSATarget0Panel9.prototype,"OSATarget0Panel9"),window.OSATarget0Panel9=OSATarget0Panel9;var OSATarget10Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.skinName||(this.skinName="YbTurntableSkin"),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.actCfg=GlobalConfig.ActivityConfig[this.activityID],this.cfgs=GlobalConfig.ActivityType10Config[this.activityID]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType10Config[this.activityID],this.actCfg=GlobalConfig.PActivityConfig[this.activityID])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi);var i=this.ins.activityData[this.activityID];i&&i.state&&this.ins.sendReward(this.activityID,this.level),this.rolling=!1,this.isClick=!1,Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.skinName||(this.skinName="YbTurntableSkin"),this.observe(this.ins.postChangePage,this.resultCallBack),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeYBListRenderer,this.updateView()},e.prototype.updateView=function(){var t=this.ins.activityData[this.activityID];if(t){var e=this.cfgs;this.level=t.getLevel();var i=this.level,n=!1;this.level||(i=Object.keys(e).length,n=!0),this.img_level.source="trun_10000"+i;for(var s=e[i],o=0;o<s.info.length;o++)this["multiple"+o].text=s.info[o].multiple+"倍";this.pay0.text=s.yuanBao+"";var a=65280,r=0;t.yb<s.recharge&&(a=16711680,r=s.recharge-t.yb),n?this.label_needCharge.text="充值转盘全部抽取完毕":this.label_needCharge.textFlow=TextFlowMaker.generateTextFlow1("再充值|C:"+a+"&T:"+r+"|C:0x00ff00&T:元宝可激活"),this.listRefush(),this.setTime();var l=this.actCfg[this.activityID];l&&(this.title.source=l.title)}},e.prototype.resultCallBack=function(t){if(this.isClick){var e=this.ins.activityData[this.activityID];this.activityID==t&&(e&&e.state&&this.beginLottery(e.index),this.updateView(),this.listRefush())}},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.ins.sendReward(e.activityID,e.level),e.flyItemEx(e["multiple"+(t-1)]),setTimeout(function(){e.rolling=!1,e.isClick=!1},2e3)},this)},e.prototype.flyItemEx=function(t){var e=new eui.Image(RewardData.getCurrencyRes(2));e.x=t.x,e.y=t.y,e.scaleX=1,e.scaleY=1,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(!this.level)return TipsCT.ins().showTips("充值转盘全部抽取完毕"),void(this.isClick=!1);var t=this.ins.activityData[this.activityID],e=this.cfgs[this.level];return t&&!t.getCondition(this.level)?(TipsCT.ins().showTips("还需要充值"+(e.recharge-t.yb)+"元宝激活"),void(this.isClick=!1)):this.rolling?void TipsCT.ins().showTips("正在抽奖，请稍候"):this.isClick?void TipsCT.ins().showTips("等待抽奖结果 请稍后"):void(this.ins.getRollSum(this.activityID)||Actor.yb>=e.yuanBao?(this.isClick=!0,this.ins.sendReward(this.activityID,this.level)):(TipsCT.ins().showTips("元宝不足"),this.isClick=!1))},e.prototype.listRefush=function(){var t=this.ins.activityData[this.activityID];if(t){this.list.dataProvider||(this.list.dataProvider=new eui.ArrayCollection);for(var e=this.list.dataProvider,i=[],n=0;n<t.noticeArr.length;n++){var s={activityID:this.activityID,name:t.noticeArr[n].name,multiple:t.noticeArr[n].multiple,yb:t.noticeArr[n].yb};i.push(s)}e.replaceAll(i)}},e.prototype.setTime=function(){var t=this.ins.activityData[this.activityID];t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(ActivityPanel);__reflect(OSATarget10Panel.prototype,"OSATarget10Panel"),window.OSATarget10Panel=OSATarget10Panel;var OSATarget11Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i;this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType11_1Config[this.activityID]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivityType11_1Config[this.activityID]),this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget11Panel"+i[1].showType,[this.activityID]),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.cruPanel.activityType=this.activityType,this.addChild(this.cruPanel),this.cruPanel.open())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget11Panel.prototype,"OSATarget11Panel"),window.OSATarget11Panel=OSATarget11Panel;var OSATarget11Panel1=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYHighSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rewardList.itemRenderer=HighRewardItemRender,this.projectList.itemRenderer=HighProjectItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=i.desc,this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length,i=0,n=[];n.length=e;var s,o;for(o=1;e>=o;o++)s=GlobalConfig.ActivityType11_1Config[this.activityID][o],i=t.rewardInfo>>o&1?2:t.hiScore>=s.score?1:0,n[o-1]={activityID:this.activityID,index:o,state:i,config:s};n.sort(this.sort),this._rewardCollect||(this._rewardCollect=new eui.ArrayCollection,this.rewardList.dataProvider=this._rewardCollect),this._rewardCollect.source=n,e=Object.keys(GlobalConfig.ActivityType11_2Config[this.activityID]).length;var a;n=[],n.length=e;var r=0;for(o=0;e>o;o++){var l=t.achieveInfo[o];a=GlobalConfig.ActivityType11_2Config[this.activityID][o+1],n[o]={config:a,times:l.times};var h=Math.floor(l.times/a.target),u=Math.floor(a.dayLimit/a.target);h>u&&(h=u),r+=a.score*h}n.sort(this.taskSort),this._achieveCollect||(this._achieveCollect=new eui.ArrayCollection,this.projectList.dataProvider=this._achieveCollect),this._achieveCollect.source=n,this.totalScore.text="当前嗨点:"+r,this.setTime()}},e.prototype.sort=function(t,e){return Algorithm.sortDesc(t.config.score,e.config.score)},e.prototype.taskSort=function(t,e){var i=t.config.rate?t.config.rate:1,n=Math.floor(t.times/i),s=Math.floor(t.config.target/i),o=n>=s;i=e.config.rate?e.config.rate:1,n=Math.floor(e.times/i),s=Math.floor(e.config.target/i);var a=n>=s;return o&&!a?1:!o&&a?-1:Algorithm.sortAsc(t.config.index,e.config.index)},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.actTime1.text=t.getRemainTime())},e}(BaseView);__reflect(OSATarget11Panel1.prototype,"OSATarget11Panel1"),window.OSATarget11Panel1=OSATarget11Panel1;var OSATarget11Panel3=function(t){function e(e){var i=t.call(this)||this;return i._curDayIndex=0,i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabD.itemRenderer=FDtabBtnItemRender,this.list.itemRenderer=FDProjectItemRender,this.rewardlist.itemRenderer=FDrewardItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this._curDayIndex=0,this.setAct22ID(),this.updateView(),this.tabD.selectedIndex=this._curDayIndex,this.updateData(),this.addTouchEvent(this,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.refreshReds),this.addChangeEvent(this.tabD,this.onClickBtn),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.osa22Panel2&&(this.osa22Panel2.close(),DisplayUtils.removeFromParent(this.osa22Panel2))},e.prototype.setAct22ID=function(){this.activity22ID=0;for(var t in Activity.ins().activityData){var e=Activity.ins().activityData[t];if(e&&e.pageStyle==ActivityPageStyle.VERSIONCELE&&e.type==ActivityDataType._22&&Activity.ins().getActivityDataById(+t).isOpenActivity()&&!Activity.ins().getActivityDataById(+t).getHide())return void(this.activity22ID=e.id)}},e.prototype.close=function(){this._btnCollect=null,this._listCollect=null,Timer.stopAll(this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="fiveDaySkin",this.actDesc&&(this.actDesc.text=t.desc)},e.prototype.updateView=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t){this._items=[];var e,i,n,s,o=GlobalConfig.ActivityType11_2Config[this.activityID],a=[];for(var r in o)e=o[r],n=e.group,i=this._items[n-1],i||(i=[],this._items[n-1]=i,a.push({gName:e.gName,showRed:!1})),s=t.achieveInfo[e.index-1],!s.isGot&&s.times>=e.dayLimit&&(a[n-1].showRed=!0),i.push(e);this._btnCollect||(this._btnCollect=new eui.ArrayCollection,this.tabD.dataProvider=this._btnCollect),this._btnCollect.source=a,this.tabD.validateNow();var l=Activity.ins().activityData[this.activity22ID];this.redPointImg.visible=ActivityType11Data.FIRST_OPEN_SHOP||l.refreshFree}},e.prototype.refreshReds=function(){this.updateView(),this.updateData()},e.prototype.updateData=function(){var t=this._items[this._curDayIndex];if(t&&t.length){this._listCollect||(this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect);var e,i,n=t.length,s=[],o=0,a=Activity.ins().getActivityDataById(this.activityID);if(a){for(var r=0;n>r;r++)e=t[r],i=a.achieveInfo[e.index-1],o=i.isGot?2:i.times>=e.dayLimit?1:0,s[r]={activityID:this.activityID,conf:e,state:o,times:i.times};s.sort(this.sort),this._listCollect.source=s,n=Object.keys(GlobalConfig.ActivityType11_1Config[this.activityID]).length;var l=[];l.length=n;var h,u;for(u=1;n>=u;u++)h=GlobalConfig.ActivityType11_1Config[this.activityID][u],o=a.rewardInfo>>u&1?2:a.hiScore>=h.score?1:0,l[u-1]={activityID:this.activityID,index:u,state:o,config:h};this._rewardCollect||(this._rewardCollect=new eui.ArrayCollection,this.rewardlist.dataProvider=this._rewardCollect),this._rewardCollect.source=l,this.totalScore.text=a.hiScore+""}}},e.prototype.sort=function(t,e){return 1==t.state&&1!=e.state?-1:1!=t.state&&1==e.state?1:2==t.state&&2!=e.state?1:2!=t.state&&2==e.state?-1:t.conf.index<e.conf.index?-1:t.conf.index>e.conf.index?1:0},e.prototype.onTouch=function(t){switch(t.target){case this.shopBtn:this.osa22Panel2||(this.osa22Panel2=ObjectPool.pop("OSATarget22Panel2",[this.activity22ID]),this.osa22Panel2.top=0,this.osa22Panel2.bottom=0,this.osa22Panel2.left=0,this.osa22Panel2.right=0),this.osa22Panel2.activityID=this.activity22ID,this.parent.addChild(this.osa22Panel2),this.osa22Panel2.open(this),this.close(),DisplayUtils.removeFromParent(this),ActivityType11Data.FIRST_OPEN_SHOP=!1,Activity.ins().postActivityIsGetAwards()}},e.prototype.onClickBtn=function(t){this._curDayIndex!=t.currentTarget.selectedIndex&&(this._curDayIndex=t.currentTarget.selectedIndex,this.updateData())},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.actTime.text=t.getRemainTime());var e=Activity.ins().activityData[this.activity22ID];if(e){var i=e.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(i>0?i:0,DateUtils.TIME_FORMAT_1,5)+"后刷新"}else this.refreshTime.text="00:00:00后刷新"},e}(BaseView);__reflect(OSATarget11Panel3.prototype,"OSATarget11Panel3"),window.OSATarget11Panel3=OSATarget11Panel3;var OSATarget12Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType12Config[this.activityID];this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget12Panel"+i[1].showType),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.cruPanel.activityType=this.activityType,this.cruPanel.open(),this.addChild(this.cruPanel))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget12Panel.prototype,"OSATarget12Panel"),window.OSATarget12Panel=OSATarget12Panel;var OSATarget12Panel1=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNHongBaoSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this),this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postChangePage,this.updateLogs),this.addTouchEvent(this.onbtn,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),Timer.start(1e3,0,this.setTime,this),this.dataArr||(this.list.itemRenderer=XiaoNianListRenderer,this.dataArr=new eui.ArrayCollection,this.list.dataProvider=this.dataArr),this.index=this.getRuleIndex(),this.updateData(),this.updateLogs()},e.prototype.getRuleIndex=function(){var t=1,e=Activity.ins().getActivityDataById(this.activityID);for(var i in GlobalConfig.ActivityType12Config[this.activityID])e.score>=GlobalConfig.ActivityType12Config[this.activityID][i].score&&(t=GlobalConfig.ActivityType12Config[this.activityID][i].index);return t},e.prototype.GetCallBack=function(t){t==this.activityID&&this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.onbtn:var e=Activity.ins().getActivityDataById(this.activityID);if(!e.isOpenActivity())return void TipsCT.ins().showTips("活动已结束");var i=GlobalConfig.ActivityType12Config[this.activityID];i&&i[this.index]&&(e.score>=i[this.index].score?ViewManager.ins().open(HongBaoSpeak,this.activityID,this.index):TipsCT.ins().showTips("积分不足"));break;case this.leftBtn:if(this.index<=1)return;this.index--,this.updateBtn();break;case this.rightBtn:if(this.index>=CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID]))return;this.index++,this.updateBtn()}},e.prototype.updateBtn=function(){1==this.index?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.index==CommonUtils.getObjectLength(GlobalConfig.ActivityType12Config[this.activityID])?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):this.leftBtn.visible=this.rightBtn.visible=!0;var t=GlobalConfig.ActivityType12Config[this.activityID][this.index];this.hongbao.data=t.skinType;var e=Activity.ins().getActivityDataById(this.activityID);this.redPoint.visible=e.score>=t.score},e.prototype.updateLogs=function(){var t=[],e=Activity.ins().getActivityDataById(this.activityID);this.actPoint.text=e.score+"";for(var i=e.logs.length-1;i>=0;i--){var n=GlobalConfig.ActivityType12Config[this.activityID][e.logs[i].index],s="s"+e.logs[i].serverId+"."+e.logs[i].name,o=StringUtils.replace(n.record,s);t.push(o)}this.dataArr.replaceAll(t)},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID],i=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),n=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);i>=0?this.actTime.text="活动未开启":0>=n?this.actTime.text="活动已结束":(this._time=n,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_5,3)),this.actInfo.text=e.desc,this.updateBtn()},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this.actTime.text=t.getRemainTime())},e}(BaseView);__reflect(OSATarget12Panel1.prototype,"OSATarget12Panel1"),window.OSATarget12Panel1=OSATarget12Panel1;var OSATarget14Panel=function(t){function e(){var e=t.call(this)||this;return e.curIndex=0,e.curReward=-1,e.skinName="treasureAppraisalSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bigItem.isShowName(!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.autoBtn,this.onTap),this.addTouchEvent(this.treasureBtn,this.onTap),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.dataArr||(this.rewardList.itemRenderer=ItemBaseNoName,this.dataArr=new eui.ArrayCollection,this.rewardList.dataProvider=this.dataArr),this.updateData(),this.barGroup.visible=!1
},e.prototype.onTap=function(t){var e=Activity.ins().getActivityDataById(this.activityID),i=e.getType14Config(),n=BagCT.ins().getBagGoodsCountById(0,i.costItem.id);if(Actor.yb<i.cost)return void TipsCT.ins().showTips("元宝不足");switch(t.currentTarget){case this.autoBtn:this.curIndex=0;break;case this.treasureBtn:this.curIndex=1}e.curIndex=this.curIndex,n<i.costItem.count?HuntWarnBuyWin.showBuyWarn("OSATarget14Panel-HuntResultWin",this.huntWarnFun.bind(this),"是否消耗"+i.cost+"元宝购买"+GlobalConfig.ItemConfig[i.costItem.id].name+"*"+i.costItem.count):this.huntWarnFun()},e.prototype.huntWarnFun=function(){Activity.ins().sendReward(this.activityID,0)},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getType14Config(),i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo.text=i.desc,this.setTime(),this.barBig.maximum=e.maxLucky,this.barBig.value=t.lucky,this.curReward!=t.rewardID&&(this.dataArr.source=e.showReward,this.bigItem.data=e.itemId[0]),this.curReward=t.rewardID;var n=BagCT.ins().getBagGoodsCountById(0,e.costItem.id);this.num.text=""+n,this.needNum.text="/"+e.costItem.count+"）",this.yb.text=""+e.cost},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this.actTime.text=t.getRemainTime())},e}(BaseView);__reflect(OSATarget14Panel.prototype,"OSATarget14Panel"),window.OSATarget14Panel=OSATarget14Panel;var OSATarget17Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.showPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.curPanel&&this.curPanel.close()},e.prototype.showPanel=function(t){if(void 0===t&&(t=1),!this.curPanel||this.curPanel.activityID!=this.activityID){this.curPanel&&(this.curPanel.close(),DisplayUtils.removeFromParent(this.curPanel));var e=egret.getDefinitionByName("OSATarget17Panel"+t);this.curPanel=new e,this.curPanel.top=0,this.curPanel.bottom=0,this.curPanel.left=0,this.curPanel.right=0,this.curPanel.activityID=this.activityID,this.curPanel.open(),this.addChild(this.curPanel)}},e.prototype.updateData=function(){this.curPanel&&this.curPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget17Panel.prototype,"OSATarget17Panel"),window.OSATarget17Panel=OSATarget17Panel;var OSATarget17Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyStarSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.luckyzp,this.gotoLuckTurn),this.addTouchEvent(this.help,this.openHelp),this.updateData(),this.refRedpoint()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType17_1Config[this.activityID];this.inte.text=t.score+"",this.recharge.text=t.curRecharge+"",this.endtime.text=t.overDay+"天";var i=0;for(var n in t.actStar){i+=t.actStar[n]*e[n].score;for(var s=1;s<=e[n].star;s++){var o=10>s?"0"+s:s+"";s<=t.actStar[n]?this["star"+(parseInt(n)-1)+o].source="star"+(parseInt(n)+3):this["star"+(parseInt(n)-1)+o].source="star1"}}var a=0;for(var r in e)a+=e[r].score*e[r].star;this.accinte.text=i+"/"+a}},e.prototype.gotoLuckTurn=function(){this.showPanel&&this.showPanel(2)},e.prototype.openHelp=function(){ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[26].text)},e.prototype.refRedpoint=function(){var t=Activity.ins().activityData[this.activityID];t&&(this.redPoint.visible=t.checkRedPoint())},e}(ActivityPanel);__reflect(OSATarget17Panel1.prototype,"OSATarget17Panel1"),window.OSATarget17Panel1=OSATarget17Panel1;var OSATarget17Panel2=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin2",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),Timer.stopAll(this),this.rolling=!1,this.isClick=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postRewardResult,this.resultCallBack),this.addTouchEvent(this.choujiangBtn,this.startLottery),this.addTouchEvent(this.back,this.gotoHome),this.list.itemRenderer=NoticeListRenderer,this.updateView(),this.updateData()},e.prototype.updateView=function(){for(var t=Activity.ins().activityData[this.activityID],e=(GlobalConfig.ActivityType17_2Config[this.activityID],GlobalConfig.ActivityType17_3Config[this.activityID]),i=e[CommonUtils.getObjectLength(e)].group,n=i.length,s=0;n>s;s++)this["item"+s].itemIcon.data=i[s],this["item"+s].rewardState(t.recrod>>s+1&1);this.listRefush();var o=GlobalConfig.ActivityBtnConfig[this.activityID];o&&(this.title.source=o.title)},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];this.inte.text="当前积分 "+t.score},e.prototype.resultCallBack=function(t){if(Activity.ins().isSuccee&&this.isClick&&this.activityID==t){var e=Activity.ins().activityData[this.activityID],i=e.awardIndex;i&&this.beginLottery(i),this.updateView(),this.listRefush()}},e.prototype.beginLottery=function(t){var e=this,i=1440+30*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,0),Activity.ins().isSuccee=!1,e.flyItemEx(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.isClick=!1},2e3)},this)},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.itemIcon.getItemSoure());e.x=t.x,e.y=t.y,e.scaleX=1,e.scaleY=1,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.startLottery=function(){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType17_2Config[this.activityID];return this.rolling?void TipsCT.ins().showTips("正在抽奖，请稍候"):this.isClick?void TipsCT.ins().showTips("等待抽奖结果 请稍后"):void(Activity.ins().getRollSum(this.activityID)||t.score>=e.score?(this.isClick=!0,Activity.ins().sendReward(this.activityID,1)):(TipsCT.ins().showTips("积分不够"),this.isClick=!1))},e.prototype.listRefush=function(){var t=Activity.ins().activityData[this.activityID];if(t){for(var e=[],i=0;i<t.noticeArr.length;i++){var n={activityID:this.activityID,activityType:ActivityDataType._17,name:t.noticeArr[i].name,index:t.noticeArr[i].index};e.push(n)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.gotoHome=function(){this.showPanel&&this.showPanel(1)},e}(ActivityPanel);__reflect(OSATarget17Panel2.prototype,"OSATarget17Panel2"),window.OSATarget17Panel2=OSATarget17Panel2;var OSATarget18Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData);var i=GlobalConfig.ActivityType18Config[this.activityID];if(!this.cruPanel||this.cruPanel.activityID!=this.activityID){this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var n=i[0].showType||1;this.cruPanel=ObjectPool.pop("OSATarget18Panel"+n,[this.activityID]),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)}this.cruPanel.open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget18Panel.prototype,"OSATarget18Panel"),window.OSATarget18Panel=OSATarget18Panel;var OSATarget18Panel1=function(t){function e(e){var i=t.call(this)||this;return i.addBoxEvent=!1,i.huntType=1,i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){for(var t,e=GlobalConfig.ActivityType18Config[this.activityID],i=e[0],n=i.showDrop.length,s=0;n>s&&16>s;s++)t=this["gift"+s],t.data=i.showDrop[s],1>=s&&t.setItemHeirloomBgImg(!0,"csbk03");this.list.itemRenderer=HuntListRenderer,this.jpList.itemRenderer=HuntListRenderer;for(var o in e)1==e[o].count?this.yb1.text=e[o].yb+"":10==e[o].count&&(this.yb10.text=e[o].yb+"")},e.prototype.open=function(){this.setCurSkin(),this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.observe(Activity.ins().postChangePage,this.updateData),this.timeClock(),Timer.stop(this.timeClock,this),Timer.start(1e3,0,this.timeClock,this),this.addBoxEvent=!0,Activity.ins().sendChangePage(this.activityID)},e.prototype.close=function(){this.removeTouchEvent(this.buy1,this.onBuy),this.removeTouchEvent(this.buy10,this.onBuy),this.removeObserve(),Timer.stop(this.timeClock,this),this.addBoxEvent=!1},e.prototype.updateData=function(){this.listRefush(),this.updateBox(),this.updateMaterial()},e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="CETreasureSkin"},e.prototype.timeClock=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this.endedTime=t.getLeftTime(),this.leftTimeTxt.text=this.endedTime)},e.prototype.listRefush=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.list.dataProvider=new eui.ArrayCollection(t.logs),this.jpList.dataProvider=new eui.ArrayCollection(t.bestlogs)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(1);break;case this.buy10:this.buyHunt(2)}},e.prototype.buyHunt=function(t){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);this.huntType=t;var e=GlobalConfig.ActivityType18Config[this.activityID],i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e[t].item);if(i&&i.count)Activity.ins().sendReward(this.activityID,t);else{var n=t>1?10:1,s=e[t].yb;HuntWarnBuyWin.showBuyWarn("OSATarget18Panel1-HuntResultWin"+(10==n?1:0),this.huntWarnFun.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[e[t].item].name+"*"+n)}},e.prototype.huntWarnFun=function(){var t=GlobalConfig.ActivityType18Config[this.activityID][this.huntType].yb;Actor.yb>=t?Activity.ins().sendReward(this.activityID,this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.updateBox=function(){var t=GlobalConfig.ActivityType18Config[this.activityID],e=[];for(var i in t)t[i].dbCount&&e.push(t[i]);e.sort(function(t,e){return Algorithm.sortAsc(t.dbCount,e.dbCount)});var n,s,o=Activity.ins().getActivityDataById(this.activityID),a=0,r=e.length,l=0;for(var h in e){if(s=e[h],this["time"+a].text=s.dbCount+"次",this["time"+a].visible=!0,this["done"+a].visible=!1,this["boxPoint"+a].visible=!1,this["bar"+a].value=0,this["bar"+a].maximum=100,this["box"+a].source="200116_0_png",this["box"+a].name="box"+s.index,this.addBoxEvent||this.addTouchEvent(this["box"+a],this.onGetAward),r>a)if(n=o.getStateByIndex(s.index),2==n)this["box"+a].source="200116_png",this["bar"+a].value=100,this["boxPoint"+a].visible=!0;else if(1==n)this["time"+a].visible=!1,this["done"+a].visible=!0,this["bar"+a].value=100;else{var u=Math.floor((o.num-l)/(s.dbCount-l)*100);0>u?u=0:u>100&&(u=100),this["bar"+a].value=u}l=s.dbCount,a++}this.icon10.source=this.icon1.source=GlobalConfig.ItemConfig[t[1].item].icon+"_png"},e.prototype.onGetAward=function(t){var e=t.target.name.slice(3,4),i=Activity.ins().getActivityDataById(this.activityID),n=i.getStateByIndex(e);2==n?Activity.ins().sendReward(this.activityID,e):ViewManager.ins().open(HuntBoxsTips,e,3,this.activityID)},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagGoodsByTypeAndId(0,GlobalConfig.ActivityType18Config[this.activityID][1].item),e=t?t.count:0;this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|"),this.num10.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(e>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|")},e}(BaseView);__reflect(OSATarget18Panel1.prototype,"OSATarget18Panel1"),window.OSATarget18Panel1=OSATarget18Panel1;var OSATarget18Panel2=function(t){function e(e){var i=t.call(this)||this;return i.huntType=1,i.first=!1,i.sendBuyType=0,i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="wishDragonBallSkin"},e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){var t=GlobalConfig.ActivityType18Config[this.activityID];t[0];for(var e in t)1==t[e].count?this.yb1.text=t[e].yb+"":10==t[e].count&&(this.yb10.text=t[e].yb+"")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy);for(var i=1;7>=i;i++)this.addTouchEvent(this["ball"+i],this.onBuy);this.addTouchEvent(this.getItemTxt,this.onBuy),this.observe(Activity.ins().postHuntResultPlayFunc,this.callbackPlayEff),this.observe(Activity.ins().postRewardResult,this.RewardResult),this.observe(Activity.ins().postHuntResultFunc,this.updateGetLongZhu),this.rewardList.itemRenderer=ItemBase,this.timeClock(),Timer.has(this.timeClock,this)||Timer.start(1e3,0,this.timeClock,this),this.updateData(),this.updateData2(!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.timeClock,this)},e.prototype.updateGetLongZhu=function(){var t=GlobalConfig.ActivityType18Config[this.activityID][0],e=t.relateActivityId,i=GlobalConfig.ActivityType13Config[e];for(var n in i)this.updateLongZhu(i[n].index)},e.prototype.updateData2=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ActivityType18Config[this.activityID][0];if(t){var i=e.relateActivityId,n=GlobalConfig.ActivityType13Config[i];for(var s in n)this.updateLongZhu(n[s].index)}null==this.rewardList.dataProvider?this.rewardList.dataProvider=new eui.ArrayCollection(e.showDrop.concat()):this.rewardList.dataProvider.replaceAll(e.showDrop.concat()),this.rewardList.validateNow();for(var o=0;o<this.rewardList.numElements;o++){var a=this.rewardList.getVirtualElementAt(o);a.hideName()}},e.prototype.RewardResult=function(t){this.activityID==t&&this.updateMaterial()},e.prototype.callbackPlayEff=function(){var t=this,e=Activity.ins().getActivityDataById(this.activityID);if(e){var i=GlobalConfig.ActivityType18Config[this.activityID][0].relateActivityId,n=Activity.ins().getActivityDataById(i);if(n){var s=void 0;s=this.sendBuyType?this.buy10.localToGlobal():this.buy1.localToGlobal(),this.globalToLocal(s.x,s.y,s);for(var o=s.x,a=s.y,r=function(e){var i=n.playList[e];if(!l["ball"+i])return"continue";s=l["ball"+i].localToGlobal(),l.globalToLocal(s.x,s.y,s);var r=new MovieClip;r.x=o,r.y=a,l.addChild(r),egret.Tween.get(r).to({x:s.x,y:s.y},500).call(function(){r&&egret.Tween.removeTweens(r),DisplayUtils.removeFromParent(r),t.updateLongZhu(i,!0)},l)},l=this,h=0;h<n.playList.length;h++)r(h);n.playList=[]}}},e.prototype.listRefush=function(){Activity.ins().getActivityDataById(this.activityID)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(1),this.sendBuyType=0;break;case this.buy10:this.buyHunt(2),this.sendBuyType=1;break;default:var e=Activity.ins().getActivityDataById(this.activityID);if(!e)return;var i=GlobalConfig.ActivityType18Config[this.activityID][0].relateActivityId,n=GlobalConfig.ActivityType13Config[i];if(t.currentTarget==this.getItemTxt)return void ViewManager.ins().open(OSATarget18Panel2Tips,i);for(var s=CommonUtils.getObjectLength(n),o=0;s>o&&this["ball"+(o+1)];o++)if(this["ball"+(o+1)]==t.currentTarget){var a=Activity.ins().getActivityDataById(i),r=a.proCount[o+1]/n[o+1].count;1==r&&0==a.awardCount[o+1]&&Activity.ins().sendReward(i,o+1);break}}},e.prototype.buyHunt=function(t){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);this.huntType=t;var e=GlobalConfig.ActivityType18Config[this.activityID],i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e[t].item);if(i&&i.count)Activity.ins().sendReward(this.activityID,t);else{var n=t>1?10:1,s=e[t].yb;HuntWarnBuyWin.showBuyWarn("OSATarget18Panel2-HuntResultWin"+(10==n?1:0),this.huntWarnFun.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[e[t].item].name+"*"+n)}},e.prototype.huntWarnFun=function(){var t=GlobalConfig.ActivityType18Config[this.activityID],e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t[this.huntType].item);if(e&&e.count)Activity.ins().sendReward(this.activityID,this.huntType);else{var i=GlobalConfig.ActivityType18Config[this.activityID][this.huntType].yb;Actor.yb>=i?Activity.ins().sendReward(this.activityID,this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}},e.prototype.updateMaterial=function(){var t=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=t.desc;var e=BagCT.ins().getBagGoodsByTypeAndId(0,GlobalConfig.ActivityType18Config[this.activityID][1].item),i=e?e.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(i?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+i+"|"),this.num10.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(i>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+i+"|");var n=GlobalConfig.ActivityType18Config[this.activityID];this.icon1.source=GlobalConfig.ItemConfig[n[1].item].icon+"_png",this.icon10.source=GlobalConfig.ItemConfig[n[2].item].icon+"_png",this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text)},e.prototype.updateLongZhu=function(t,e){void 0===e&&(e=!1);var i=this["ball"+t];if(i){i.liang.visible=!0,i.an.source="dragonball_an_"+t,i.liang.source="dragonball_liang_"+t;var n=Activity.ins().getActivityDataById(this.activityID);if(n){var s=GlobalConfig.ActivityType18Config[this.activityID][0].relateActivityId,o=Activity.ins().getActivityDataById(s);o&&(e?i.play(o.awardCount[t],o.proCount[t]):i.data={times:o.awardCount[t],count:o.proCount[t],maxcount:GlobalConfig.ActivityType13Config[s][t].count})}}},e.prototype.timeClock=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this.endedTime=t.getLeftTime(),this.actTime1.text=this.endedTime)},e.prototype.updateData=function(){this.updateMaterial()},e}(BaseView);__reflect(OSATarget18Panel2.prototype,"OSATarget18Panel2"),window.OSATarget18Panel2=OSATarget18Panel2;var OSATarget18Panel2Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="dragonBallSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.maxH=this.liang.height},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){var e=this.data.times;this.get.visible=e>0,this.percent.visible=!this.get.visible;var i=this.data.count/this.data.maxcount;this.eRed.visible=1==i&&0==e,this.percent.text=(100*i>>0)+"%",this.liang.scrollRect?this.liang.scrollRect.y=this.liang.height-this.liang.height*i:(this.liang.scrollRect=new egret.Rectangle(0,this.height-this.height*i,this.liang.width,this.liang.height),this.liang.scrollRect.y=this.height-this.height*i,this.liang.scrollRect.width=this.liang.scrollRect.height=this.height),this.liang.y=this.liang.scrollRect.y}},e.prototype.play=function(t,e,i){var n=this;if(this.data)if(this.data.count<=e){var s=e/this.data.maxcount;this.percent.text=(100*s>>0)+"%";var o=this.liang.height-this.liang.height*s,a=egret.Tween.get(this.liang.scrollRect,{onChange:function(){n.liang.y=n.liang.scrollRect.y}}).to({y:o},500).call(function(){n.data.count=isNaN(i)?e:0,egret.Tween.removeTweens(a),isNaN(i)||(n.liang.y=n.liang.scrollRect.y=n.liang.height,n.play(n.data.times,i))});this.get.visible=t>0,this.percent.visible=!this.get.visible,this.eRed.visible=1==s&&0==t}else{this.play(this.data.times,this.data.maxcount,e),this.get.visible=this.data.times>0,this.percent.visible=!this.get.visible;var s=e/this.data.maxcount;this.eRed.visible=1==s&&0==this.data.times}},e}(BaseItemRender);__reflect(OSATarget18Panel2Item.prototype,"OSATarget18Panel2Item"),window.OSATarget18Panel2Item=OSATarget18Panel2Item;var OSATarget18Panel2ListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="wishRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this.gift.setData(GlobalConfig.ItemConfig[this.data.gift]),this.list.dataProvider=new eui.ArrayCollection(this.data.reward))},e}(BaseItemRender);__reflect(OSATarget18Panel2ListItem.prototype,"OSATarget18Panel2ListItem"),window.OSATarget18Panel2ListItem=OSATarget18Panel2ListItem;var OSATarget18Panel2Tips=function(t){function e(){var e=t.call(this)||this;return e.skinName="wishRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=OSATarget18Panel2ListItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.activityID=t[0],this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateData=function(){var t=GlobalConfig.ActivityType13Config[this.activityID],e=[];for(var i in t)e.push({gift:t[i].award[0].id,reward:t[i].showReward});this.list.dataProvider=new eui.ArrayCollection(e)},e}(BaseEuiView);__reflect(OSATarget18Panel2Tips.prototype,"OSATarget18Panel2Tips"),ViewManager.ins().reg(OSATarget18Panel2Tips,LayerManager.UI_Popup),window.OSATarget18Panel2Tips=OSATarget18Panel2Tips;var OSATarget19Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.showPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.curPanel&&this.curPanel.close()},e.prototype.showPanel=function(){var t=GlobalConfig.ActivityType19Config[this.activityID];if(t){var e=t[1].showType;if(!this.curPanel||this.curPanel.activityID!=this.activityID){this.curPanel&&(this.curPanel.close(),DisplayUtils.removeFromParent(this.curPanel));var i=egret.getDefinitionByName("OSATarget19Panel"+e);this.curPanel=new i,this.curPanel.top=0,this.curPanel.bottom=0,this.curPanel.left=0,this.curPanel.right=0,this.curPanel.activityID=this.activityID,this.curPanel.open(),this.addChild(this.curPanel)}}},e.prototype.updateData=function(){this.curPanel&&!!this.curPanel.updateData&&this.curPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget19Panel.prototype,"OSATarget19Panel"),window.OSATarget19Panel=OSATarget19Panel;var OSATarget19Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostWinSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.curSelectIndex].close(),this.removeObserve(),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.updateRedPoint);var i=GlobalConfig.ActivityType19Config[this.activityID][1];this.costTarget.activityType=ActivityType.Normal,this.costTarget.activityID=i.activityID,this.panelArr=[this.ranking,this.costTarget,this.reward],this.setSelectedIndex(0),this.updateRedPoint()},e.prototype.onTabTouch=function(t){this.panelArr[this.curSelectIndex].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(this.activityID),this.viewStack.selectedIndex=t},e.prototype.updateRedPoint=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.redPoint1.visible=t.canReward()},e.prototype.updateData=function(){},e}(BaseView);__reflect(OSATarget19Panel1.prototype,"OSATarget19Panel1"),window.OSATarget19Panel1=OSATarget19Panel1;var OSATarget19PanelAct1=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostTargetSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.maskGroup,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.activityID=t[0],Activity.ins().sendChangePage(this.activityID)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.maskGroup:if(this.state==Activity.CanGet)Activity.ins().sendReward(this.activityID,this.index);else{var e=GlobalConfig.ActivityType1Config[this.activityID][this.index],i=0;switch(e.showType){case ShowType.XIAOFEI:var n=Activity.ins().getActivityDataById(this.activityID);n.progress<e.consumeYuanbao&&(i=e.consumeYuanbao-n.progress)}if(!i)return void Activity.ins().sendReward(this.activityID,this.index);e.showType==ShowType.XIAOFEI&&TipsCT.ins().showTips("再消费"+i+"之后即领取奖励")}}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t){if(!t.isOpenActivity())return void TipsCT.ins().showTips("异常:跨服达标领取活动结束!");var e=GlobalConfig.ActivityType1Config[this.activityID];this.index=this.getRuleIndex(),this.reward.data=e[this.index].rewards[0],this.reward.setImgBg1(),this.reward.hideName(),this.reward.clearEffect(),this.reward.showNum(!1),this.cost.text=t.progress+"",this.target.text="/"+e[this.index].consumeYuanbao}},e.prototype.getRuleIndex=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType1Config[this.activityID],i=1;for(var n in e){var s=e[n];t.getRewardStateById(s.index);var o=t.getRewardStateById(s.index),a=t.rewardsSum[s.index],r=s.total?s.total-a:1;switch(this.state=o,i=s.index,o){case Activity.NotReached:break;case Activity.CanGet:0>=r?this.state=Activity.NotReached:this.state=Activity.CanGet;break;case Activity.Geted:}if(this.state==Activity.CanGet){this.currentState="can";break}if(this.state==Activity.NotReached){this.currentState="cannot";break}}return this.state==Activity.Geted&&(this.currentState="already"),this.validateNow(),i},e}(BaseView);__reflect(OSATarget19PanelAct1.prototype,"OSATarget19PanelAct1"),window.OSATarget19PanelAct1=OSATarget19PanelAct1;var OSATarget1Panel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.list=[],e}return __extends(e,t),e.prototype.setCurSkin=function(){this.aCon.pageSkin?this.skinName=this.aCon.pageSkin:this.skinName="OSATarget1",this.isQiongQi="ZXPoorOddResourcePackSkin"==this.skinName},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.actData=this.ins.getActivityDataById(this.activityID),this.cfg=GlobalConfig.ActivityType1Config[this.activityID],this.aCon=GlobalConfig.ActivityConfig[this.activityID]):this.activityType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.actData=this.ins.getActivityDataById(this.activityID),this.cfg=GlobalConfig.PActivityType1Config[this.activityID],this.aCon=GlobalConfig.PActivityConfig[this.activityID]),this.setCurSkin(),this.isQiongQi){this.observe(this.ins.postRewardResult,this.updateUI),this.list=[];for(var i in this.cfg)this.cfg[i].isShow&&this.list.push(this.cfg[i]);for(var n=0;n<this.list.length;n++)this.addTouchEvent(this["gift"+n],this.onClick);for(var s=CommonUtils.getObjectLength(this.cfg),o=0,n=1;s>=n;n++)if(-1==this.actData.awardArr.indexOf(this.cfg[n].index)){o=n;break}this.content.selectedIndex=o,this.cardMoveTo(this.content.selectedIndex),this.updateUI()}else this.observe(this.ins.postRewardResult,this.GetCallBack),this.content.itemRenderer=OSATargetItemRenderer,this.updateData();Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)},e.prototype.setTime=function(){this.actData&&(this._time=this.actData.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e.prototype.GetCallBack=function(t){this.activityID==t&&(this.ins.isSuccee||(BagCT.ins().getSurplusCount()?(TipsCT.ins().showTips("领取失败"),this.ins.sendChangePage(this.actData.id)):TipsCT.ins().showTips("背包已满")),this.ins.isSuccee=!1,this.updateData())},e.prototype.onClick=function(t){for(var e=0;e<this.list.length;e++)t.currentTarget==this["gift"+e]&&-1==this.actData.awardArr.indexOf(this.list[e].index)&&(this.actData.bossLevel>=this.list[e].qiongqiLevel?this.ins.sendReward(this.actData.id,this.list[e].index):this["gift"+e].showDetail())},e.prototype.updateUI=function(){var t=this;this.actData=this.ins.getActivityDataById(this.activityID);for(var e=0;e<this.list.length;e++){this["gift"+e].isShowName(!1),this["gift"+e].data=this.list[e].rewards[0],this["level"+e].text=this.list[e].qiongqiLevel+"级";var i=-1==this.actData.awardArr.indexOf(this.list[e].index);this["gift"+e].setGetImg(!i),this["gift"+e].setRedPoint(i&&this.actData.bossLevel>=this.list[e].qiongqiLevel)}this.level.text="当前已抵御神族等级："+this.actData.bossLevel+"级";var n=[];for(var e in this.cfg)n.push([this.cfg[e],this.actData]);this.content.dataProvider=new eui.ArrayCollection(n);for(var s=CommonUtils.getObjectLength(this.cfg),o=0,e=1;s>=e;e++)if(-1==this.actData.awardArr.indexOf(this.cfg[e].index)){o=e;break}this.content.selectedIndex=o,this.curIndex=this.content.selectedIndex,egret.callLater(function(){t.cardMoveTo(t.content.selectedIndex)},this)},e.prototype.cardMoveTo=function(t){var e=this;egret.callLater(function(){var i;e.activityType==ActivityType.Normal?i=GlobalConfig.ActivityConfig:e.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivityConfig);var n=CommonUtils.getObjectLength(i),s=90;e.eScroller.viewport.scrollH=s*(Math.min(t,n-5)-1)},this)},e.prototype.updateData=function(){this.listData||(this.listData=new eui.ArrayCollection,this.content.dataProvider=this.listData),this.actData=this.ins.getActivityDataById(this.activityID);var t=Math.floor((DateUtils.formatMiniDateTime(this.actData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.actData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime0.text="活动未开启":0>=e?this.actTime0.text="活动已结束":(this._time=e,this._time<0&&(this._time=0),this.actTime0.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)),this.actInfo0.text=this.aCon.desc;var i=[];for(var n in this.cfg)i.push(this.cfg[n]);i=i.slice();for(var s=[],o=[],a=0;a<i.length;a++){var r=this.actData.getRewardStateById(i[a].index);r==Activity.Geted?o.push(i[a]):s.push(i[a])}if(i[0].showType==ShowType.LEVEL){var l=[],h=[];h=this.sortLevelList(s),l=this.sortLevelList(o),i=h.concat(l),this.listData.replaceAll(i)}else s.sort(this.sortFunc),o.sort(this.sortFunc),i=s.concat(o),this.listData.replaceAll(i);var u=this.ins.getbtnInfo(this.activityID.toString());this.title.source=u.title,this.setDesc(this.actData)},e.prototype.setDesc=function(t){var e=this.cfg[1],i="",n="";switch(e.showType){case ShowType.LEVEL:i="我的等级:",e.zslevel&&(n+=ZsCT.ins().lv+"转"),e.level&&(n+=Actor.level+"级");
break;case ShowType.WING:i="我的翅膀等阶:",n=WingsData.getWingAllLevel()+"";break;case ShowType.ZHUZAO:i="我的淬炼等级:",n=Role.getAllForgeLevelByType(PackageID.Zhuling)+"";break;case ShowType.LONGHUN:i="我的龙印等级:",n=LongHunData.getLongHunAllLevel()+"";break;case ShowType.BOOK:var s=Book.ins().getBookPowerNumEx();i="我的图鉴战力:",n=s+"";break;case ShowType.EQUIP:i="我的装备评分:",n=(t.progress||BagCT.ins().getEquipsScoreByRolesOfBody())+"";break;case ShowType.XIAOFEI:i="我的消费:",n=t.progress+"";break;case ShowType.RING:i="我的烈焰戒指等级:";var o=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),a=SpecialRing.ins().getRingStair(o.level),r=SpecialRing.ins().getRingStar(o.level);n=a+"阶"+r+"星";break;case ShowType.SAMSARA:i="我的轮回等级:";var l=SamsaraModel.ins().getSamsara(Actor.samsaraLv),h=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv);n=Actor.samsaraLv+" "+SamsaraModel.ins().getSamsaraDesc(l)+"·"+SamsaraModel.ins().getSamsaraLvDesc(h);break;case ShowType.ZHANLING:i="我的魔神等阶:";var u=ZhanLingModel.ins().getZhanLingDataByLevel(0);n=Math.ceil(u/10)+"阶"+(u%10==0?u?10:0:u%10)+"星";break;case ShowType.YUANSHEN:i="我的元神等阶:";var p=YuanshenData.getJingjie();n=p.jingjie+"重"+p.jie+"阶";break;case ShowType.Heirloom:i="我的龍装总战力:",n=this.actData.curVal+"";break;case ShowType.SHENSHOU:i="我的神兽总战力:",n=this.actData.curVal+"";break;case ShowType.HEARTMETHOD:i="我的秘籍总星级:",n=this.actData.curVal+"";break;case ShowType.ENCOUNTER:i="我的PK排名:",n=this.actData.curVal+"";break;case ShowType.MOSHEN:i="我的魔神总星级:",n=this.actData.curVal+""}this.attr.text=i,this.myAttrValue.text=n},e.prototype.sortLevelList=function(t){for(var e=[],i=[],n=[],s=0;s<t.length;s++)t[s].zslevel?n.push(t[s]):i.push(t[s]);return i.sort(this.sortFunc),n.sort(this.sortFunc),e=i.concat(n)},e.prototype.sortFunc=function(t,e){if(t.showType==ShowType.LEVEL){if(t.zslevel<e.zslevel)return-1;if(t.zslevel>e.zslevel)return 1;if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0},e}(ActivityPanel);__reflect(OSATarget1Panel.prototype,"OSATarget1Panel"),window.OSATarget1Panel=OSATarget1Panel;var OSATarget20Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="LaBaBossSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.close=function(){this.removeTouchEvent(this.goBtn,this.onTap),Timer.stop(this.setTime,this)},e.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap),this.initData(),Timer.start(1e3,0,this.setTime,this)},e.prototype.initData=function(){this.rewardList.itemRenderer=ItemBase,this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:var e=Activity.ins().getActivityDataById(this.activityID);if(e.IsEnd())return void TipsCT.ins().showTips("已经全部消灭，请期待下次！");e.go2BossFb()?Activity.ins().sendReward(this.activityID,e.index):TipsCT.ins().showTips("未到刷新时间")}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(DateUtils.formatMiniDateTime(t.startTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND),i=Math.floor(DateUtils.formatMiniDateTime(t.endTime)/DateUtils.MS_PER_SECOND-GameServer.serverTime/DateUtils.MS_PER_SECOND);e>=0?(this.actTime.text="活动未开启",this.readyTime=0):0>=i?(this.actTime.text="活动已结束",this.readyTime=0):(this._time=i,this._time<0&&(this._time=0),this.readyTime=t.getStartTimer(),this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3));var n=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(n.desc),this.redPoint.visible=t.checkRedPoint();var s=GlobalConfig.ActivityType20Config[this.activityID][t.index];s&&(this.rewardList.dataProvider=new eui.ArrayCollection(s.showReward)),this.playModel(),this.setDate()},e.prototype.setDate=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t.IsEnd())return void(this.time.text="今天已全部消灭，请期待下次！");var e=Math.floor(GameServer.serverTime/DateUtils.MS_PER_SECOND),i=t.getEndTimer();if(e>=i)return void(this.time.text="已结束");var n=t.getStartTimer();if(e>=n&&i>e)return void(this.time.text="BOSS已出现，请前往击杀！");var s=GlobalConfig.ActivityType20Config[this.activityID][t.index],o=GlobalConfig.MonstersConfig[s.monsterId.id],a=DateUtils.getFormatBySecond(n,DateUtils.TIME_FORMAT_6);this.time.text=o.name+"将在"+a+"后出现"},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this._time=t.getleftTime(),this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.playModel=function(){this.bossModel||(this.bossModel=new MovieClip),this.bossModel.parent||this.Boss.addChild(this.bossModel);var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType20Config[this.activityID][t.index];e&&(this.bossModel.playFile(RES_DIR_MONSTER+e.monsterId.monster,-1),this.bossModel.scaleX=this.bossModel.scaleY=e.monsterId.scale/100)},e}(ActivityPanel);__reflect(OSATarget20Panel.prototype,"OSATarget20Panel"),window.OSATarget20Panel=OSATarget20Panel;var OSATarget22Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType22_1Config[this.activityID];this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget22Panel"+i[1].showType,[this.activityID]),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID),this.cruPanel&&this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget22Panel.prototype,"OSATarget22Panel"),window.OSATarget22Panel=OSATarget22Panel;var OSATarget22Panel1=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="activityStoreSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.goodsOverView.text),this.listView.itemRenderer=ActivityStoreItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo0.text=i.desc,this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(BagCT.ins().postItemDel,this.updateMaterial),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this,this.onTouch),this.currentState="activityStore",this.updateData(),this.updateMaterial()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem),e=t?t.count:0;if(this.refreshItemNum.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e?65280:16711680)+"&T:"+e),this._isEnough=e>0,"activityStore"==this.currentState){var i=Activity.ins().activityData[this.activityID];this.redPoint1.visible=i.refreshFree||this._isEnough}},e.prototype.updateData=function(){this._collect||(this._collect=new eui.ArrayCollection,this.listView.dataProvider=this._collect);for(var t=Activity.ins().activityData[this.activityID],e=[],i="activityStore"==this.currentState?t.shopItems:t.scoreItems,n=i?i.length:0,s=0;n>s;s++)e.push({data:i[s],isScore:"integralStore"==this.currentState,activityID:this.activityID});if(this._collect.source=e,"activityStore"==this.currentState){this.costGroup.visible=!t.refreshFree,this.price.text=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice+"",this.refreshShopBtn.label=t.refreshFree?"免费刷新":"刷   新",this.redPoint1.visible=t.refreshFree||this._isEnough;var o=Activity.ins().getConfig22_3(this.activityID);this.redPoint0.visible=o&&t.tScore>=o.score}this.integralNum.text=t.tScore+"";var a=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.activityID][1].freshItem];this.refreshItem.source=a?a.icon+"_png":""},e.prototype.onTouch=function(t){switch(t.target){case this.goodsOverView:ViewManager.ins().open(ActivityStoreRewardShowWin,this.activityID);break;case this.integralStoreBtn:this.currentState="integralStore"==this.currentState?"activityStore":"integralStore",this.updateData();break;case this.refreshShopBtn:var e=Activity.ins().activityData[this.activityID];e.refreshFree?Activity.ins().sendReward(this.activityID,0,5,0):Actor.yb<GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice&&!this._isEnough?TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):Activity.ins().sendReward(this.activityID,0,5,0)}},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID];this.actTime0.text=t.getRemainTime();var e=t.getRefreshTime();this.refreshTime.text=DateUtils.getFormatBySecond(e>0?e:0,DateUtils.TIME_FORMAT_1,5)},e}(BaseView);__reflect(OSATarget22Panel1.prototype,"OSATarget22Panel1"),window.OSATarget22Panel1=OSATarget22Panel1;var OSATarget22Panel2=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.setCurSkin(),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="FDStoreSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listView.itemRenderer=FDstoreItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),t&&t.length&&(this.osa11Panel3=t[0]),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(BagCT.ins().postItemDel,this.updateMaterial),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this,this.onTouch),this.updateData(),this.updateMaterial(),this.setTime()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.removeObserve(),Timer.stopAll(this),this.objList){for(var i=void 0,n=0;n<this.objList.length;n++)i=this.objList.shift(),egret.Tween.removeTweens(i),DisplayUtils.removeFromParent(i);this.objList=null}this.osa11Panel3=null},e.prototype.updateData=function(){this._collect||(this._collect=new eui.ArrayCollection,this.listView.dataProvider=this._collect);var t=Activity.ins().activityData[this.activityID];if(!t)return void(this._collect.source=null);for(var e=[],i=t.shopItems,n=i?i.length:0,s=0;n>s;s++)e.push({data:i[s],activityID:this.activityID});this.noGoods.visible=!e||!e.length,this._collect.source=e,this.redPoint.visible=t.refreshFree,this.refresh.visible=this.priceTxt.visible=this.moneyIcon.visible=!t.refreshFree;var o=GlobalConfig.ActivityType22_1Config[this.activityID][1];this.priceTxt.text=o.freshPrice+"",this.refreshFree.visible=t.refreshFree,this.icon.source=GlobalConfig.ItemConfig[o.costItem].icon+"_png",i=t.limitItems,n=i?i.length:0;for(var a,r,s=0;5>s;s++)r=this["itemShow"+s],n-1>=s?(a=i[s],r.visible=!0,r.update({itemID:a.itemID,max:a.buyMax,buy:a.buyCount})):r.visible=!1},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.activityID][1].costItem),e=t?t.count:0;this.point.text="X"+e,this.point.textColor=e?65280:16711680},e.prototype.onTouch=function(t){switch(t.target){case this.refreshShopBtn:var e=Activity.ins().activityData[this.activityID];if(!e)return;if(e.refreshFree)Activity.ins().sendReward(this.activityID,0,5,0);else{var i=GlobalConfig.ActivityType22_1Config[this.activityID][1].freshPrice;Actor.yb<i?TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):(Activity.ins().sendReward(this.activityID,0,5,0),this.flyRMB(i))}break;case this.closeBtn:this.osa11Panel3&&(this.parent.addChild(this.osa11Panel3),this.osa11Panel3.open()),this.close(),DisplayUtils.removeFromParent(this)}},e.prototype.flyRMB=function(t){var e=this;this.objList||(this.objList=[]);var i=new eui.BitmapLabel;i.font="num_2_fnt",i.y=-10,i.x=460,i.scaleX=i.scaleY=1.5,i.text="-"+t,this.addChild(i),this.objList.push(i),egret.Tween.get(i).to({y:i.y+50},1e3).call(function(){DisplayUtils.removeFromParent(i),e.objList&&e.objList.length&&e.objList.shift()})},e.prototype.setTime=function(){var t=Activity.ins().activityData[this.activityID],e=t?t.getRefreshTime():0;this.refreshTime.text=DateUtils.getFormatBySecond(e>0?e:0,DateUtils.TIME_FORMAT_1,5),this.refreshTime.visible=this.refreshTip.visible=e>0},e}(BaseView);__reflect(OSATarget22Panel2.prototype,"OSATarget22Panel2"),window.OSATarget22Panel2=OSATarget22Panel2;var OSATarget23Panel=function(t){function e(e){var i=t.call(this)||this;return i.lbList=[],i.lbCount=[],i.ctn=[],i.maskList=[],i.playing=!1,i.pH=77,i.pW=54.5,i.activityID=e,i.skinName="QixiChoujiangSkin",i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.ktyueka,this.onTap),this.addTouchEvent(this.choujiangbtn,this.onTap),this.observe(Activity.ins().postRewardResult,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),this.ktyueka.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.ktyueka.text+"</u></a>");var i=GlobalConfig.ActivityBtnConfig[this.activityID];i&&(this.title.source=i.title);var n=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=n.desc;for(var s=0;4>s;s++){this.ctn[s]||(this.ctn[s]=new eui.Group,this.addChildAt(this.ctn[s],4)),this.ctn[s].x=292+s*this.pW,this.maskList[s]||(this.maskList[s]=new egret.Shape,this.addChildAt(this.maskList[s],5)),this.maskList[s].graphics.beginFill(16711680),this.maskList[s].graphics.drawRect(0,0,75,118),this.maskList[s].graphics.endFill(),this.maskList[s].x=292+s*this.pW,this.maskList[s].y=346,this.ctn[s].mask=this.maskList[s];for(var o=0;3>o;o++){var a=3*s+o;this.lbList[a]||(this.lbList[a]=new eui.BitmapLabel,this.ctn[s].addChild(this.lbList[a])),this.lbList[a].font="slot_num_fnt"}}this.updateData()},e.prototype.resetAll=function(){for(var t=0;4>t;t++){this.ctn[t].y=346;for(var e=0;3>e;e++){var i=3*t+e;this.lbCount[i]=0,this.lbList[i].y=-this.pH*e;var n=this.getList[t]+e;this.lbList[i].text=(n>9?n%10:n)+""}}},e.prototype.slotUp=function(t){this.slot_up.visible=t,this.slot_down.visible=!t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.ktyueka:var e=0;Recharge.ins().monthDay>0&&(e=1),ViewManager.ins().open(CardWin,e);break;case this.choujiangbtn:"0"==this.cqgold.text?this.playing||(this.slotUp(!1),this.playing=!0,Activity.ins().sendReward(this.activityID,1,1)):0==this.data.leftCount&&0==Recharge.ins().monthDay?TipsCT.ins().showTips("购买月卡后可领取奖励"):Activity.ins().sendReward(this.activityID,1,2)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),Timer.stopAll(this)},e.prototype.setGetList=function(){this.data=Activity.ins().activityData[this.activityID];var t=+this.data.canGet;this.getList=[],this.getList[0]=Math.floor(t/1e3),this.getList[1]=Math.floor((t-1e3*this.getList[0])/100),this.getList[2]=Math.floor((t-1e3*this.getList[0]-100*this.getList[1])/10),this.getList[3]=t-1e3*this.getList[0]-100*this.getList[1]-10*this.getList[2]},e.prototype.updateData=function(){var t=this;if(this.playing){this.resetAll(),this.setGetList();for(var e=function(e){var n=3-e,s=i.ctn[n].y,o=egret.Tween.get(i.ctn[n],{onChange:function(){for(var e=0;3>e;e++){var i=t.ctn[n].y-s,o=3*n+e;if(i-(t.lbCount[o]?t.lbCount[o]*t.pH*3:t.pH)>t.pH*(e+1)){t.lbCount[o]++,t.lbList[o].y-=3*t.pH;var a=+t.lbList[o].text;t.lbList[o].text=(a+3>9?(a+3)%10:a+3)+""}}}});o.wait(300*e).to({x:i.ctn[n].x,y:(-i.lbList[3*n].text+20+i.getList[n])*i.pH+s},2e3,egret.Ease.cubicOut).call(function(){3==e&&(t.playing=!1,t.updateui())})},i=this,n=0;4>n;n++)e(n)}else this.setGetList(),this.resetAll(),this.updateui();this.setTime()},e.prototype.updateui=function(){this.slotUp(!0),this.cqgold.text=this.data.canGet||"0",this.count.text=this.data.leftCount+"/"+this.data.maxCount,this.count.textColor=this.data.leftCount>0?ColorUtil.GREEN:ColorUtil.RED,this.choujiangbtn.enabled=this.data.leftCount>0||"0"!=this.cqgold.text,this.choujiangbtn.label="0"==this.cqgold.text?"抽取奖励":"领取奖励",this.redPoint.visible=this.data.checkRedPoint()},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget23Panel.prototype,"OSATarget23Panel"),window.OSATarget23Panel=OSATarget23Panel;var OSATarget24Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType24Config[this.activityID];this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget24Panel"+i[1].showType,[this.activityID]),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID),this.cruPanel&&this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget24Panel.prototype,"OSATarget24Panel"),window.OSATarget24Panel=OSATarget24Panel;var OSATarget24Panel1=function(t){function e(e){var i=t.call(this)||this;i.selectPinTuIndex=0,i.skinName="CDBossPingTu",i.activityID=e,i.list0.itemRenderer=ActivityType24BtnRenderer,i.pintus=[i.pingtu1,i.pingtu2,i.pingtu3,i.pingtu4,i.pingtu5,i.pingtu6,i.pingtu7,i.pingtu8,i.pingtu9],i.redPoints=[i.redPoint1,i.redPoint2,i.redPoint3,i.redPoint4,i.redPoint5,i.redPoint6,i.redPoint7,i.redPoint8,i.redPoint9];for(var n=1;9>=n;n++)i["eOnClick"+n].id=n;return i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.list0,this.onClickList),this.addTouchEvent(this.giveBtn,this.onClick),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.reward,this.getReward),this.observe(Activity.ins().postChangePage,this.onRewardResult),this.data=Activity.ins().activityData[this.activityID];var i=GlobalConfig.ActivityConfig[this.activityID];this.update(),this.updatePinTuBtn(),this.updateTitle(),this.actInfo1.text=i.desc,this.list0.selectedIndex=this.selectPinTuIndex,this.setTime()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onRewardResult=function(){this.data=Activity.ins().activityData[this.activityID],this.updateActionNum(),this.updatePintuRedPoint(),this.updatePinTuBtn();for(var t=1;t<=this.pintus.length;t++){var e=this.pintus[t-1];0==e.visible&&this.data.isActivation(this.selectPinTuIndex+1,t)?this.showEff(e):e.visible&&!this.data.isActivation(this.selectPinTuIndex+1,t)&&(e.visible=!1)}},e.prototype.showEff=function(t){if(t){t.visible=!0,t.alpha=1,t.scaleX=t.scaleY=1.5,egret.Tween.removeTweens(t);var e=egret.Tween.get(t);e.to({scaleX:1,scaleY:1},1e3,egret.Ease.elasticOut).to({alpha:2},200).to({alpha:1},200)}},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.updatePintuRedPoint=function(){for(var t=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex+1].consume,e=0;e<t.length;e++)this.data.isActivation(this.selectPinTuIndex+1,e+1)?this.redPoints[e].visible=!1:this.redPoints[e].visible=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t[e].id)>0},e.prototype.getReward=function(t){if(this.data.hasActivationNum(this.selectPinTuIndex+1)<9){var e=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex+1].reward[0];ViewManager.ins().open(ItemDetailedWin,1,e.id,e.count)}else Activity.ins().sendReward(this.activityID,this.selectPinTuIndex+1,2,0)},e.prototype.onClick=function(t){var e=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex+1].consume[0];ViewManager.ins().open(GiveTreasureMapWin,ItemUtil.getType(GlobalConfig.ItemConfig[e.id]))},e.prototype.onTap=function(t){t.target.id&&t.target instanceof eui.Group&&(this.data.isActivation(this.selectPinTuIndex+1,t.target.id)||Activity.ins().sendReward(this.activityID,this.selectPinTuIndex+1,1,t.target.id))},e.prototype.onClickList=function(t){this.selectPinTuIndex!=t.currentTarget.selectedIndex&&(this.selectPinTuIndex=t.currentTarget.selectedIndex,this.updatePinTu(),this.updatePintuRedPoint(),this.updateActionNum())},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.updatePinTu(),this.updateActionNum(),this.updatePintuRedPoint(),this.updatePinTuBtn()},e.prototype.updateActionNum=function(){var t=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex+1].reward[0],e=GlobalConfig.ItemConfig[t.id];this.reward.icon=e.icon+"_png",this.redPoint0.visible=this.data.activationNumIsMax(this.selectPinTuIndex+1),this.countLabel1.text=this.data.hasActivationNum(this.selectPinTuIndex+1)+"/9"},e.prototype.updatePinTu=function(){var t="";switch(this.selectPinTuIndex+1){case 1:t="ywBosspt_";break;case 2:t="mjBosspt_";break;case 3:t="shenyuBosspt_";break;case 4:t="shengyuBosspt_";break;case 5:t="kfBosspt_"}if(""!=t){this.bossBG.source=t+"bg_png";for(var e=1;e<=this.pintus.length;e++){var i=this.pintus[e-1];i.visible=this.data.isActivation(this.selectPinTuIndex+1,e),i.source=t+e+"_png",i.scaleX=i.scaleY=1}}},e.prototype.updatePinTuBtn=function(){var t=[];for(var e in GlobalConfig.ActivityType24Config[this.activityID]){var i=GlobalConfig.ActivityType24Config[this.activityID][e];t.push(i)}var n=new eui.ArrayCollection(t);this.list0.dataProvider=n,this.list0.validateNow()},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},__decorate([callLater],e.prototype,"updatePinTu",null),e}(BaseView);__reflect(OSATarget24Panel1.prototype,"OSATarget24Panel1"),window.OSATarget24Panel1=OSATarget24Panel1;var OSATarget24Panel2=function(t){function e(e){var i=t.call(this)||this;return i.selectPinTuIndex=1,i.activityID=e,i.setCurSkin(),i.eList.itemRenderer=OSATarget24Panel2Item,i.pintuGroups=[i.eOnClickstar,i.eOnClickring,i.eOnClicksock,i.eOnClicksweet,i.eOnClickball],i.pintuImgs=[i.star,i.ring,i.sock,i.sweet,i.ball],i.clickMC=new MovieClip,i.clickMC.playFile(RES_DIR_EFF+"NoviceEff",-1),i}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="CDChristmastreeSKin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postChangePage,this.update),this.addTouchEvent(this,this.onClick),this.update(),this.setTime();var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=i.desc},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onClick=function(t){switch(t.target){case this.eOnClickstar:case this.eOnClickring:case this.eOnClicksock:case this.eOnClicksweet:case this.eOnClickball:t.target;var e=this.pintuGroups.indexOf(t.target)+1;e>0&&!this.data.isActivation(this.selectPinTuIndex,e)&&Activity.ins().sendReward(this.activityID,this.selectPinTuIndex,1,e);break;case this.reward:if(this.data.activationNumIsMax(this.selectPinTuIndex))Activity.ins().sendReward(this.activityID,this.selectPinTuIndex,2,0);else{var i=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex].reward[0];ViewManager.ins().open(ItemDetailedWin,1,i.id,i.count)}break;case this.giveBtn:var n=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex],s=[];for(var o in n.consume)s.push(n.consume[o].id);var a=n.consume[0];ViewManager.ins().open(GiveTreasureMapWin,ItemUtil.getType(GlobalConfig.ItemConfig[a.id]),s)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityType24Config[this.activityID][this.selectPinTuIndex],e=!1;DisplayUtils.removeFromParent(this.clickMC);for(var i=0;i<this.pintuGroups.length;i++){var n=this.pintuGroups[i];if(this.pintuImgs[i].visible=this.data.isActivation(this.selectPinTuIndex,i+1),n.visible=!1,!this.pintuImgs[i].visible&&!e){var s=t.consume[i],o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.id);o>=s.count&&(n.visible=!0,e=!0,n.parent.addChild(this.clickMC),this.clickMC.x=n.x+n.width/2,this.clickMC.y=n.y+n.height/2)}}this.countLabel.text=this.data.hasActivationNum(this.selectPinTuIndex)+"/5",this.redPoint.visible=this.data.activationNumIsMax(this.selectPinTuIndex),this.eList.dataProvider=new eui.ArrayCollection(t.consume)},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget24Panel2.prototype,"OSATarget24Panel2"),window.OSATarget24Panel2=OSATarget24Panel2;var OSATarget24Panel2Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="Christmastreeitem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.ItemConfig[this.data.id];this.eItemIcon.setData(t),this.ename.text=t.name;var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,this.data.id);this.enumber.text="数量："+e,this.enumber.textColor=e>=this.data.count?ColorUtil.GREEN:ColorUtil.RED}},e}(BaseItemRender);__reflect(OSATarget24Panel2Item.prototype,"OSATarget24Panel2Item"),window.OSATarget24Panel2Item=OSATarget24Panel2Item;var OSATarget25Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDRechargeSkin",i.activityID=e,i.yuanbaoImgs=[i.yuanbaoImg0,i.yuanbaoImg1,i.yuanbaoImg2,i.yuanbaoImg3],i.eBls=[i.eBl0,i.eBl1,i.eBl2,i.eBl3],i.payeds=[i.payed0,i.payed1,i.payed2,i.payed3],i.eBtns=[i.chong0,i.chong1,i.chong2,i.chong3],i.eXs=[i.eX0,i.eX1,i.eX2,i.eX3],i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(Activity.ins().postChangePage,this.updateUI);var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo0.text=i.desc,this.data=Activity.ins().activityData[this.activityID],this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.chong0:case this.chong1:case this.chong2:case this.chong3:var e=this.data.subType;if(1==e&&this.data.hasRecharge())TipsCT.ins().showTips("活动期间内已充值");else if(2==e&&this.data.hasRechargeById(parseInt(t.target.name)));else{var i=GlobalConfig.ActivityType25Config[this.activityID],n=i[t.target.name].yuanbao;Recharge.ins().showReCharge(n)}}},e.prototype.update=function(){this.updateTitle(),this.setTime(),this.updateUI()},e.prototype.updateUI=function(){this.data=Activity.ins().activityData[this.activityID];var t=this.data.subType,e=GlobalConfig.ActivityType25Config[this.activityID];this.payed.visible=1==t&&this.data.hasRecharge(),this.eBigTitle.source=1==t?"xianshifanli_00_png":"xianshifanli_000_png";for(var i in e){var n=e[i].subid-1,s=e[i];this.yuanbaoImgs[n].source=s.icon,this.eBls[n].text=(1==t&&this.data.hasRecharge()?s.yuanbao:2*s.yuanbao)+"",this.payeds[n].visible=2==t&&this.data.hasRechargeById(s.subid),this.eBtns[n].name=s.subid+"",this.eBtns[n].label=s.yuanbao/GlobalConfig.ClientGlobalConfig.rate*Recharge.getChannelMulti()+"元",this.eXs[n].visible=!(1==t&&this.data.hasRecharge())}},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime0.text=this.data.getRemainTime())},__decorate([callLater],e.prototype,"updateUI",null),e}(BaseView);__reflect(OSATarget25Panel.prototype,"OSATarget25Panel"),window.OSATarget25Panel=OSATarget25Panel;var OSATarget26Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType26Config[this.activityID];this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget26Panel"+i[1].showType,[this.activityID]),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID),this.cruPanel&&this.cruPanel.open(),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget26Panel.prototype,"OSATarget26Panel"),window.OSATarget26Panel=OSATarget26Panel;var OSATarget26Panel1=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDTreasureMap",i.activityID=e,i.rewardList0.itemRenderer=ItemBase,i.rewardList1.itemRenderer=ItemBase,i.rewardList2.itemRenderer=ItemBase,i.redPoints=[i.redPoint0,i.redPoint1,i.redPoint2],i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemAdd,this.updateRedPoint),this.observe(BagCT.ins().postItemChange,this.updateRedPoint),this.observe(BagCT.ins().postItemDel,this.updateRedPoint),this.addTouchEvent(this.eImg0,this.onTap),this.addTouchEvent(this.eImg1,this.onTap),this.addTouchEvent(this.eImg2,this.onTap),this.data=Activity.ins().activityData[this.activityID],this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onTap=function(t){var e=0;switch(t.target){case this.eImg0:e=1;break;case this.eImg1:e=2;break;case this.eImg2:e=3;break;default:return}var i=GlobalConfig.ActivityType26Config[this.activityID],n=i[e].consume,s=!0;for(var o in n)BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n[o].id)<n[o].count&&(s=!1);s?Activity.ins().sendReward(this.activityID,i[e].subid):TipsCT.ins().showTips("材料不足")},e.prototype.update=function(){this.updateTitle(),this.setTime(),this.updateUI(),this.updateRedPoint();var t=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=t.desc},e.prototype.updateUI=function(){var t=GlobalConfig.ActivityType26Config[this.activityID];this.rewardList0.dataProvider=new eui.ArrayCollection(t[1].show),this.rewardList1.dataProvider=new eui.ArrayCollection(t[2].show),this.rewardList2.dataProvider=new eui.ArrayCollection(t[3].show)},e.prototype.updateRedPoint=function(){var t=GlobalConfig.ActivityType26Config[this.activityID];for(var e in t){this.redPoints[t[e].subid-1].visible=!0;var i=t[e].consume;for(var n in i)BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i[n].id)<i[n].count&&(this.redPoints[t[e].subid-1].visible=!1)}},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updateRedPoint",null),e}(BaseView);__reflect(OSATarget26Panel1.prototype,"OSATarget26Panel1"),window.OSATarget26Panel1=OSATarget26Panel1;
var OSATarget26Panel2=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDJiZiSkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i.tabD.itemRenderer=OSATarget26PanelItem,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),this.updateUI(),this.setTime()},e.prototype.update=function(){this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.data=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityType26Config[this.activityID],e=[];for(var i in t)e.push(t[i]);this.tabD.dataProvider=new eui.ArrayCollection(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget26PanelItem){var e=t.target.parent.data;Activity.ins().sendReward(this.activityID,e.subid)}},e.prototype.updateUI=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget26Panel2.prototype,"OSATarget26Panel2"),window.OSATarget26Panel2=OSATarget26Panel2;var OSATarget26PanelItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDJiZiItemSkin",e.rewardList.itemRenderer=ItemBaseNoName,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.rewardList.dataProvider=new eui.ArrayCollection(t.consume),this.rewardList.validateNow(),this.eReward.data=t.show[0];var e=!0;for(var i in t.consume){var n=t.consume[i].id,s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n),o=this.rewardList.getElementAt(+i);e&&s<t.consume[i].count&&(e=!1),o.filters=s<t.consume[i].count?FilterUtil.ARRAY_GRAY_FILTER:[]}this.get.enabled=e;var a=this.eReward.EquipEffect||new MovieClip;a.x=44,a.y=36,this.eReward.addChild(a),a.playFile(RES_DIR_EFF+"ValueEff4",-1),this.eReward.EquipEffect=a}},e}(BaseItemRender);__reflect(OSATarget26PanelItem.prototype,"OSATarget26PanelItem"),window.OSATarget26PanelItem=OSATarget26PanelItem;var OSATarget27Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDZhuanpanSkin",i.activityID=e,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemAdd,this.updateNum),this.observe(BagCT.ins().postItemChange,this.updateNum),this.observe(BagCT.ins().postItemDel,this.updateNum),this.observe(Activity.ins().postRewardResult,this.updateResult),this.addTouchEvent(this.choujiangBtn0,this.getLottery);var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=i.desc,this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateResult=function(){this.beginLottery(this.data.rewardIndex)},e.prototype.beginLottery=function(t){var e=this,i=1440+36*t,n=egret.Tween.get(this.tttzhi0);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.updateView()},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){var t=GlobalConfig.ActivityType27Config[this.activityID],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume[0].id);e<t.consume[0].count?TipsCT.ins().showTips("材料不足"):this.rolling?TipsCT.ins().showTips("正在抽奖，请稍候"):Activity.ins().sendReward(this.activityID,0)},e.prototype.update=function(){this.updateTitle(),this.setTime(),this.updateView(),this.updateNum()},e.prototype.updateNum=function(){var t=GlobalConfig.ActivityType27Config[this.activityID],e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume[0].id);this.num0.text=e+"/"+t.consume[0].count,this.num0.textColor=e>=t.consume[0].count?ColorUtil.GREEN:ColorUtil.RED,this.icon.source=GlobalConfig.ItemConfig[t.consume[0].id].icon+"_png"},e.prototype.updateView=function(){this.data=Activity.ins().activityData[this.activityID];for(var t=GlobalConfig.ActivityType27Config[this.activityID],e=(BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume[0].id),t.reward.length),i=0;e>i;i++){var n=this["item"+i];n.itemIcon.data=t.reward[i],n.rewardState(this.data.hasGetInfo.indexOf(i+1)>-1)}},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget27Panel.prototype,"OSATarget27Panel"),window.OSATarget27Panel=OSATarget27Panel;var OSATarget28Panel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.getClsStr=function(t){var e={1:"OSATarget28Panel1",2:"OSATarget28Panel2"};return e[t.showType]||"OSATarget28Panel1"},e}(OSATarget0Panel);__reflect(OSATarget28Panel.prototype,"OSATarget28Panel"),window.OSATarget28Panel=OSATarget28Panel;var OSATarget28Panel1=function(t){function e(e){var i=t.call(this)||this;i.skinName="CDBossSkin",i.rewardList.itemRenderer=ItemBase,i.pintus=[i.pingtu0,i.pingtu1,i.pingtu2,i.pingtu3],i.redPoints=[i.redPoint0,i.redPoint1,i.redPoint2,i.redPoint3];for(var n=1;4>=n;n++)i["eOnClick"+(n-1)].id=n;return i.mc=i.mc||new MovieClip,i.mc.scaleY=1.5,i.mc.scaleX=1.5,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.ActivityType28Config[this.activityID].showReward),this.data=Activity.ins().activityData[this.activityID],this.observe(Activity.ins().postChangePage,this.onRewardResult),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.goBtn,this.onClick),this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onRewardResult=function(){this.data=Activity.ins().activityData[this.activityID];for(var t=1;t<=this.pintus.length;t++){var e=this.pintus[t-1];0==e.visible&&this.data.isActivation(t)?this.showEff(e):e.visible&&!this.data.isActivation(t)&&(e.visible=!1)}this.updatePintuRedPoint(),this.updateBtnEff()},e.prototype.onClick=function(t){t.target==this.goBtn&&(this.data.activationNumIsMax()?BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):Activity.ins().sendReward(this.activityID,0,2,0):TipsCT.ins().showTips("拼图未激活"))},e.prototype.onTap=function(t){t.target.id&&t.target instanceof eui.Group&&(this.data.isActivation(t.target.id)||Activity.ins().sendReward(this.activityID,0,1,t.target.id))},e.prototype.update=function(){this.updatePintuRedPoint(),this.updateTitle(),this.setTime(),this.updatePinTu();var t=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=t.desc},e.prototype.updatePintuRedPoint=function(){for(var t=GlobalConfig.ActivityType28Config[this.activityID].consume,e=0;e<t.length;e++)this.data.isActivation(e+1)?this.redPoints[e].visible=!1:this.redPoints[e].visible=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t[e].id)>0},e.prototype.updatePinTu=function(){for(var t=1;t<=this.pintus.length;t++){var e=this.pintus[t-1];e.visible=this.data.isActivation(t),e.scaleX=e.scaleY=1}this.updateBtnEff()},e.prototype.updateBtnEff=function(){this.data.activationNumIsMax()?this.mc.parent||(this.mc.playFile(RES_DIR_EFF+"BtnPrompt6",-1),this.eBtnEff.addChild(this.mc)):this.mc&&this.mc.parent&&DisplayUtils.removeFromParent(this.mc)},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e.prototype.showEff=function(t){if(t){t.visible=!0,t.alpha=1,t.scaleX=t.scaleY=1.5,egret.Tween.removeTweens(t);var e=egret.Tween.get(t);e.to({scaleX:1,scaleY:1},1e3,egret.Ease.elasticOut).to({alpha:2},200).to({alpha:1},200)}},__decorate([callLater],e.prototype,"update",null),__decorate([callLater],e.prototype,"updatePinTu",null),e}(BaseView);__reflect(OSATarget28Panel1.prototype,"OSATarget28Panel1"),window.OSATarget28Panel1=OSATarget28Panel1;var OSATarget28Panel2=function(t){function e(e){var i=t.call(this)||this;return i.canEnter=!1,i.skinName="CDPersonalBossSkin",i.eListDP=new eui.ArrayCollection,i.addTouchEvent(i,i.onClick),i.mc=i.mc||new MovieClip,i.eBossGroup.addChild(i.mc),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.sTime=this.data.getRemainTime();var t=GlobalConfig.ActivityBtnConfig[this.activityID];this.sTitle=t.title;var e=GlobalConfig.ActivityConfig[this.activityID];this.eDesc=e.desc;var i=GlobalConfig.ActivityType28Config[this.activityID];this.eListDP.source=i.showReward.concat();var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.consume[0].id);this.canEnter=n>=i.consume[0].count;var s="<font color = "+(n>=i.consume[0].count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+n+"</font><font color = '#F3D00B'>/"+i.consume[0].count+"</font>";this.eKeyFlow=(new egret.HtmlTextParser).parser(s),this.sIcon=GlobalConfig.ItemConfig[i.consume[0].id].icon+"_png";var o=GlobalConfig.MonstersConfig[i.monsterId];this.mc.playFile(RES_DIR_MONSTER+(o.avatar+"_3s"),-1)},e.prototype.onClick=function(t){t.target==this.goBtn&&(this.canEnter?Activity.ins().sendReward(this.activityID,0,2,0):TipsCT.ins().showTips("材料不足"))},e}(BaseView);__reflect(OSATarget28Panel2.prototype,"OSATarget28Panel2"),window.OSATarget28Panel2=OSATarget28Panel2;var OSATarget29Panel=function(t){function e(e){var i=t.call(this)||this;return i.canPlay=!1,i.playing=!1,i.lbList=[],i.lbCount=[],i.ctn=[],i.maskList=[],i.pH=140,i.pW=93,i.skinName="NumberPlaySkin",i.activityID=e,i.link.textFlow=(new egret.HtmlTextParser).parser("<u>"+i.link.text+"</u>"),i.itemlist.itemRenderer=ItemBase,i.choujiangbtn0.label="查看奖励",i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.observe(Activity.ins().postLuckyNumber,this.updateLuckyNum),this.observe(Rank.ins().postRankingData,this.updateRank),this.addTouchEvent(this,this.onClick);for(var i=0;3>i;i++){this.ctn[i]||(this.ctn[i]=new eui.Group,this.eNum.addChild(this.ctn[i])),this.ctn[i].x=i*this.pW,this.maskList[i]||(this.maskList[i]=new egret.Shape,this.eNum.addChild(this.maskList[i])),this.maskList[i].graphics.beginFill(16711680),this.maskList[i].graphics.drawRect(0,0,75,118),this.maskList[i].graphics.endFill(),this.maskList[i].x=i*this.pW,this.ctn[i].mask=this.maskList[i];for(var n=0;3>n;n++){var s=3*i+n;this.lbList[s]||(this.lbList[s]=new eui.BitmapLabel,this.ctn[i].addChild(this.lbList[s])),this.lbList[s].font="npslotnum_fnt",this.lbList[s].text=n+""}}this.update(),this.updateTitle(),this.setTime();var o=GlobalConfig.ActivityConfig[this.activityID];this.actInfo1.text=o.desc,Activity.ins().sendLuckyNumber(this.activityID),Rank.ins().sendGetRankingData(RankDataType.TYPE_LUCKYNUMBER)},e.prototype.updateRank=function(t){if(t.type==RankDataType.TYPE_LUCKYNUMBER){var e=t?t.getDataList():null;this.choujiangbtn0.label=e&&e.length>0?"上期排行":"查看奖励"}},e.prototype.onClick=function(t){switch(t.target){case this.eShowLab:break;case this.choujiangbtn:this.canPlay||(this.canPlay=!0,Activity.ins().sendReward(this.activityID,1,1));break;case this.choujiangbtn0:ViewManager.ins().open(OSATarget29RankWin,this.activityID);break;case this.eImg:var e=GlobalConfig.ActivityType29Config[this.activityID].luckyReward[0];0==e.type?ViewManager.ins().open(ItemCurrencyWin,e.id,e.count):ViewManager.ins().open(ItemDetailedWin,0,e.id,e.count);break;case this.link:var i=GlobalConfig.ActivityType29Config[this.activityID];ViewManager.ins().open(ShopGoodsWarn).setData(i.consume.id)}},e.prototype.resetAll=function(){for(var t=0;3>t;t++)for(var e=0;3>e;e++){var i=3*t+e;this.lbCount[i]=0,this.lbList[i].y=-this.pH*e;var n=this.getList[t]+e;this.lbList[i].text=(n>9?n%10:n)+""}},e.prototype.setGetList=function(){var t=this.data.num;this.getList=[],this.getList[0]=Math.floor(t/100),this.getList[1]=Math.floor((t-100*this.getList[0])/10),this.getList[2]=t-100*this.getList[0]-10*this.getList[1]},e.prototype.updateLuckyNum=function(){if(this.data.luckNums&&this.data.luckNums.length>0){for(var t=this.data.luckNums[0]+"",e=1;e<this.data.luckNums.length;e++)t+=","+this.data.luckNums[e];this.eShowLab.text=t}else this.eShowLab.text=""},e.prototype.update=function(){var t=this;this.data=Activity.ins().activityData[this.activityID],this.updateLuckyNum();var e=this.data.canReward();this.redPoint.visible=e,this.choujiangbtn.enabled=e;var i=GlobalConfig.ActivityType29Config[this.activityID];if(this.itemlist.dataProvider=new eui.ArrayCollection(i.luckyReward),this.expendLabel.text="消耗："+GlobalConfig.ItemConfig[i.consume.id].name+"*"+i.consume.count,!this.playing)if(this.canPlay){this.resetAll(),this.setGetList(),this.playing=!0;for(var n=function(e){var i=2-e,n=s.ctn[i].y,o=egret.Tween.get(s.ctn[i],{onChange:function(){for(var e=0;3>e;e++){var s=t.ctn[i].y-n,o=3*i+e;if(s-(t.lbCount[o]?t.lbCount[o]*t.pH*3:t.pH)>t.pH*(e+1)){t.lbCount[o]++,t.lbList[o].y-=3*t.pH;var a=+t.lbList[o].text;t.lbList[o].text=(a+3>9?(a+3)%10:a+3)+""}}}});o.wait(300*e).to({x:s.ctn[i].x,y:(-s.lbList[3*i].text+20+s.getList[i])*s.pH+n},2e3,egret.Ease.cubicOut).call(function(){2==e&&(t.canPlay=!1,t.playing=!1)})},s=this,o=0;3>o;o++)n(o)}else this.setGetList(),this.resetAll()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget29Panel.prototype,"OSATarget29Panel"),window.OSATarget29Panel=OSATarget29Panel;var LocationProperty=function(){function t(){}return t.init=function(){this.urlParam=urlParam,window.RES_RESOURCE+="/",window.RES_DIR+="/",window.MAP_DIR+="/"},Object.defineProperty(t,"resAdd",{get:function(){return this.urlParam.root||""},set:function(t){this.urlParam.hosts=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"openID",{get:function(){return this.urlParam.openId},set:function(t){this.urlParam.openId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"srvid",{get:function(){return parseInt(this.urlParam.srvid)},set:function(t){this.urlParam.srvid=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"openKey",{get:function(){return this.urlParam.openkey},enumerable:!0,configurable:!0}),Object.defineProperty(t,"zoneId",{get:function(){return this.urlParam.zoneid},enumerable:!0,configurable:!0}),Object.defineProperty(t,"roleCount",{get:function(){return parseInt(this.urlParam.roleCount)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isnew",{get:function(){return parseInt(this.urlParam.isnew)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isFromQQBLUE",{get:function(){return urlParam.appid==PlatFormID.QQ_BLUE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pfid",{get:function(){return this.urlParam.pfid||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pf",{get:function(){return this.urlParam.pf||""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isIosTS",{get:function(){return this.isTSServer&&DeviceUtils.IsIOS},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isWanBaWX",{get:function(){return window.OPEN_DATA&&window.OPEN_DATA.qua&&"WX"==window.OPEN_DATA.qua.app},enumerable:!0,configurable:!0}),Object.defineProperty(t,"QQZoneChannel",{get:function(){return window&&window.OPEN_DATA?window.OPEN_DATA.channel:""},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isTSServer",{get:function(){return(1201==+urlParam.srvid||1202==+urlParam.srvid)&&!urlParam.debugTS},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isOPPO",{get:function(){return urlParam.appid==PlatFormID.OPPO||urlParam.appid==PlatFormID.OPPO_FENG||urlParam.appid==PlatFormID.OPPO_MI},enumerable:!0,configurable:!0}),t.urlParam={},t}();__reflect(LocationProperty.prototype,"LocationProperty"),window.LocationProperty=LocationProperty;var OSATarget29RankWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="NumberPlayrewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=OSATarget29RankItemRender},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.addTouchEvent(this.bgClose,this.onClick),this.observe(Rank.ins().postRankingData,this.initRanking),Rank.ins().sendGetRankingData(RankDataType.TYPE_LUCKYNUMBER)},e.prototype.initRanking=function(t){if(t.type==RankDataType.TYPE_LUCKYNUMBER){if(this.rankModel=t,this.rankModel.selfPos>0){var e=["零","一","二","三"];this.myRankText.text="我的上期获奖："+(this.rankModel.selfPos<4?e[this.rankModel.selfPos]+"等奖":"参与奖")}else this.myRankText.text="我的上期获奖：未参与";var i=this.rankModel?this.rankModel.getDataList():null;i.length>3&&(i.length=3);for(var n in i)i[n].actId=this.actId;for(var n=i.length;4>n;n++)i[n]=new RankDataLuckyNum,i[n].pos=n+1,i[n].actId=this.actId,i[n].name=3>n?"虚位以待":"";this.list.dataProvider=new eui.ArrayCollection(i)}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(OSATarget29RankWin.prototype,"OSATarget29RankWin"),window.OSATarget29RankWin=OSATarget29RankWin,ViewManager.ins().reg(OSATarget29RankWin,LayerManager.UI_Main);var OSATarget2Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i;this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType2Config[this.activityID]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivity2Config[this.activityID]),this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.cruPanel=ObjectPool.pop("OSATarget2Panel"+i[1].showType),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.cruPanel.activityType=this.activityType,this.addChild(this.cruPanel),this.cruPanel.open())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget2Panel.prototype,"OSATarget2Panel"),window.OSATarget2Panel=OSATarget2Panel;var OSATarget2Panel1=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gift.itemRenderer=OSATargetItemRender1},e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="OSADailyGiftSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),Timer.start(1e3,0,this.setTime,this),this.dataArr||(this.dataArr=new eui.ArrayCollection,this.gift.dataProvider=this.dataArr),this.updateData()},e.prototype.setTime=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t&&(this._time=t.getLeftTime(),this.actTime1.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.GetCallBack=function(t){this.activityID==t&&this.updateData()},e.prototype.updateData=function(){var t,e,i,n;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID],n=GlobalConfig.ActivityType2Config[this.activityID],i=GlobalConfig.ActivityBtnConfig[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID],n=GlobalConfig.PActivity2Config[this.activityID],i=GlobalConfig.PActivityBtnConfig[this.activityID]),i&&(this.title.source=i.title);var s=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),o=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);s>=0?this.actTime1.text="活动未开启":0>=o?this.actTime1.text="活动已结束":(this._time=o,this._time<0&&(this._time=0),this.actTime1.text=DateUtils.getFormatBySecond(o,DateUtils.TIME_FORMAT_5,3)),this.actDesc.text=e.desc;var a=[];for(var r in n)a.push(n[r]);this.dataArr.replaceAll(a)},e}(BaseView);__reflect(OSATarget2Panel1.prototype,"OSATarget2Panel1"),window.OSATarget2Panel1=OSATarget2Panel1;var OSATarget2Panel2=function(t){function e(){var e=t.call(this)||this;return e._index=0,e.skinName="OSAGift",e.listDP=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID),this.list.dataProvider=this.listDP},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy,this.onTap),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouch,this),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(Activity.ins().postWingCharge,this.onChangeSelect),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),Timer.start(1e3,0,this.setTime,this);var i=this.getRule();this.list.selectedIndex=i-1,this.updateData(i)},e.prototype.onChangeSelect=function(t){t>-1&&this.updateData(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID)),e.isSuccee||(TipsCT.ins().showTips("领取失败"),e.sendChangePage(i.id)),e.isSuccee=!1;var n=this.getRule();this.list.selectedIndex=n-1,this.updateData(n)}},e.prototype.onTouch=function(){var t=this.list.selectedIndex;this.updateData(t+1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buy:if(this.config.vip&&Actor.vip<this.config.vip)TipsCT.ins().showTips(VipCT.getVipStr(this.config.vip)+"等级不足");else{if(BagCT.ins().getSurplusCount()<7)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?this.activityType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this.list.selectedIndex+1):this.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this.list.selectedIndex+1):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}}},e.prototype.getRule=function(){var t,e;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity2Config[this.activityID]);var i=[];for(var n in e)i.push(e[n]);i.sort(this.sortFunc);for(var s=0;s<i.length;s++){var o=i[s],a=t.buyData[o.index]>=o.count;if(!a)return o.index}return 2},e.prototype.sortFunc=function(t,e){return t.price<e.price?-1:t.price>e.price?1:0},e.prototype.updateData=function(t){if(t){t>=0&&(this._index=t);var e,i,n;this.activityType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.ActivityType2Config[this.activityID][this._index],i=GlobalConfig.ActivityBtnConfig[this.activityID],n=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.PActivity2Config[this.activityID][this._index],i=GlobalConfig.PActivityBtnConfig[this.activityID],n=GlobalConfig.PActivity2Config[this.activityID]),this.setTime(),i&&(this.title.source=i.title),this.desc3.text=this.config.price+"",this.desc5.text=this.config.giftName;for(var s=0;s<this.config.rewards.length;s++){var o=this.config.rewards[s];this["item"+s].data={type:o.type,count:o.count,id:o.id}}var a=e.buyData[this.list.selectedIndex+1]>=this.config.count;this.buy.visible=!a,this.already.visible=a,this.actTime.visible=!this.already.visible,this.showbg.source=this.config.source[2]+"_png",this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1);var r=[];for(var l in n)r.push(n[l].source.concat());this.listDP.replaceAll(r)}},e.prototype.setTime=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID));var e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget2Panel2.prototype,"OSATarget2Panel2"),window.OSATarget2Panel2=OSATarget2Panel2;var OSATarget2Panel3=function(t){function e(){var e=t.call(this)||this;return e._time=0,e._curPage=1,e._maxPage=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase},e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="SFVipGiftSkin"},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.activityType=ActivityPanel.getActivityTypeFromId(this._activityID),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.addTouchEvent(this,this.onTouch),Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.setTime=function(){this._time=this._activityData.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.GetCallBack=function(t){this.activityID==t&&this.updateData()},e.prototype.updateData=function(){this.activityType==ActivityType.Normal?(this._activityData=Activity.ins().getActivityDataById(this.activityID),this._config=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(this._activityData=PActivity.ins().getActivityDataById(this.activityID),this._config=GlobalConfig.PActivity2Config[this.activityID]);var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime0.text="活动未开启":0>=e?this.actTime0.text="活动已结束":(this._time=e,this._time<0&&(this._time=0),this.actTime0.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)),this._maxPage=Object.keys(this._config).length,this._curPage=1;for(var i,n=1;n<=this._maxPage;n++)if(i=this._config[n],this._activityData.buyData[i.index]<i.count){this._curPage=n;break}this.updatePage()},e.prototype.updatePage=function(){this.turnBackBtn.visible=this._curPage>1,this.turnNextBtn.visible=this._curPage<this._maxPage;var t=this._config[this._curPage];this.ggtxt0.source="viptitle"+t.index+"_png",this.tu0.source="vipshow"+t.index+"_png",this.vipLv0.text=t.vip+"",this.times0.text="活动期间仅可购买"+t.count+"次",this.get0.label=t.price+"元宝",this._collect||(this._collect=new eui.ArrayCollection,this.reward0.dataProvider=this._collect),this._collect.source=t.rewards,this.buyred.visible=!1,this.already0.visible=!1,this.get0.visible=!0,this._activityData.buyData[t.index]>=t.count?(this.isGet=!1,this.already0.visible=!0,this.get0.visible=!1):(this.isGet=Actor.vip>=t.vip&&Actor.yb>=t.price,this.buyred.visible=this.isGet),this.leftred.visible=this.rightred.visible=!1;for(var e=1;e<this._curPage;e++)if(t=this._config[e],this._activityData.buyData[t.index]<t.count&&Actor.vip>=t.vip&&Actor.yb>=t.price){this.leftred.visible=!0;break}for(var e=this._curPage+1;e<=this._maxPage;e++)if(t=this._config[e],this._activityData.buyData[t.index]<t.count&&Actor.vip>=t.vip&&Actor.yb>=t.price){this.rightred.visible=!0;break}},e.prototype.onTouch=function(t){switch(t.target){case this.get0:var e=this._config[this._curPage];this.isGet?e instanceof ActivityType2Config?Activity.ins().sendReward(e.Id,e.index):e instanceof PActivity2Config&&PActivity.ins().sendReward(e.Id,e.index):Actor.vip<e.vip?TipsCT.ins().showTips("|C:0xff0000&T:"+VipCT.getVipStr(e.vip)+"等级不满足要求|"):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");break;case this.turnBackBtn:this._curPage>1&&(this._curPage--,this.updatePage());break;case this.turnNextBtn:this._curPage<this._maxPage&&(this._curPage++,this.updatePage())}},e}(BaseView);__reflect(OSATarget2Panel3.prototype,"OSATarget2Panel3"),window.OSATarget2Panel3=OSATarget2Panel3;var OSATarget2Panel4=function(t){function e(){var e=t.call(this)||this;return e._index=0,e._zqindex=1,e.selectIndex=0,e.skinName="KFGiftSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID);var e=this.getRule();this.updateData(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy,this.onTap),this.addTouchEvent(this.szlb,this.onTap),this.addTouchEvent(this.lhlb,this.onTap),this.addTouchEvent(this.yylb,this.onTap),this.addTouchEvent(this.sblb,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.reward0.itemRenderer=ItemBase,this.selectIndex=0;for(var i=0;4>i;i++)this["kfreward"+i]&&this.addTouchEvent(this["kfreward"+i],this.onClick);Timer.start(1e3,0,this.setTime,this),this.hideSelect();var n=this.getRule();this.updateData(n)},e.prototype.hideSelect=function(){for(var t=0;4>t;t++)this["select"+t].visible=!1,this["arrow"+t].visible=!1,this["select"+t].visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.buy,this.onTap),this.removeTouchEvent(this.szlb,this.onTap),this.removeTouchEvent(this.lhlb,this.onTap),this.removeTouchEvent(this.yylb,this.onTap),this.removeTouchEvent(this.sblb,this.onTap),this.removeObserve(),Timer.stopAll(this)
},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID)),e.isSuccee||(TipsCT.ins().showTips("领取失败"),e.sendChangePage(i.id)),e.isSuccee=!1,this.hideSelect();var n=this._index;this.updateZqRule(n),this.updateData(n)}},e.prototype.onClick=function(t){for(var e=0;4>e;e++)t.currentTarget==this["kfreward"+e]&&(this._zqindex=e+1,this.selectIndex=1,ViewManager.ins().open(OSATarget2Panel4TipsWin,this.activityID,this._index,this._zqindex))},e.prototype.onTap=function(t){var e;switch(t.currentTarget){case this.buy:if(this.config.vip&&Actor.vip<this.config.vip)TipsCT.ins().showTips(VipCT.getVipStr(this.config.vip)+"等级不足");else{if(BagCT.ins().getSurplusCount()<7)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");var i=void 0;this.activityType==ActivityType.Normal?i=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(i=PActivity.ins().getActivityDataById(this.activityID)),Actor.yb>=this.config.price?this.activityType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}e=-1;break;case this.lhlb:e=1;break;case this.yylb:e=2;break;case this.szlb:e=3;break;case this.sblb:e=4}if(-1!=e){this.selectIndex=0,this._zqindex=4;var n=void 0;this.activityType==ActivityType.Normal?n=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(n=PActivity.ins().getActivityDataById(this.activityID));var s=GlobalConfig.ActivityType2Config[this.activityID][e],o=n.buyData[s.index]>=s.count;if(o)for(var a=0;a<s.countReward.length;a++){var r=n.getAreaReward(s.index,a+1);if(r==Activity.CanGet){this._zqindex=a+1,this.selectIndex=1;break}r==Activity.NotReached&&this._zqindex>a+1&&!this.selectIndex&&(this._zqindex=a+1,this.selectIndex=1)}else this.selectIndex=0,this._zqindex=1;for(var l=0;4>l;l++)e!=l+1?this["select"+l].visible=!1:this["select"+l].visible=!0,this["arrow"+l].visible=this["select"+l].visible;this.updateData(e)}},e.prototype.getRule=function(){var t,e;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity2Config[this.activityID]);var i=[];for(var n in e)i.push(e[n]);i.sort(this.sortFunc);var s=0;this._zqindex=4,this.selectIndex=0;for(var o=0;o<i.length;o++){var a=i[o],r=t.buyData[a.index]>=a.count;if(r)for(var l=0;l<a.countReward.length;l++){var h=t.getAreaReward(a.index,l+1);if(h==Activity.CanGet)return this._zqindex=l+1,this.selectIndex=1,a.index;h==Activity.NotReached&&this._zqindex>l+1&&!this.selectIndex&&(this._zqindex=l+1,this.selectIndex=1)}else s||(s=a.index)}return s||(s=1),s},e.prototype.updateZqRule=function(t){void 0===t&&(t=this._index);var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),i=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),i=GlobalConfig.PActivity2Config[this.activityID]);var n=[];for(var s in i)n.push(i[s]);n.sort(this.sortFunc),this._zqindex=4,this.selectIndex=0;var o=n[t-1],a=e.buyData[o.index]>=o.count;if(a)for(var r=0;r<o.countReward.length;r++){var l=e.getAreaReward(o.index,r+1);if(l==Activity.CanGet)return this._zqindex=r+1,this.selectIndex=1,o.index;l==Activity.NotReached&&this._zqindex>r+1&&!this.selectIndex&&(this._zqindex=r+1,this.selectIndex=1)}this.selectIndex=1},e.prototype.sortFunc=function(t,e){return Algorithm.sortAsc(t.price,e.price)},e.prototype.updateData=function(t){void 0===t&&(t=this._index),this._index=t,this["select"+(t-1)].visible=!0,this["arrow"+(t-1)].visible=!0;var e,i,n;this.activityType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.ActivityType2Config[this.activityID][t],i=GlobalConfig.ActivityBtnConfig[this.activityID],n=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.PActivity2Config[this.activityID][t],i=GlobalConfig.PActivityBtnConfig[this.activityID],n=GlobalConfig.PActivity2Config[this.activityID]),this.setTime(),i&&(this.title.source=i.title),this.desc3.text=this.config.price+"",this.desc5.text=this.config.giftName;var s=(e.getAreaReward(this._index,this._zqindex),e.buyData[this._index]>=this.config.count);this.reward0.dataProvider=new eui.ArrayCollection(this.config.rewards),this.buy.label="购  买",this.buy.visible=!s,this.already.visible=!this.buy.visible,this.actTime.visible=!this.already.visible,this.showbg.source=this.config.source[2]+"_png",this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1);for(var o in n){var a=n[o];a&&a.source[0]&&(this["bg"+(+o-1)].source=a.source[0]),a&&a.source[1]&&(this["name"+(+o-1)].source=a.source[1])}this.updateArea()},e.prototype.setTime=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID));var e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.prototype.updateArea=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),this.kfCount.text=""+t.areaBuyData[this._index];for(var e=0;4>e;e++){if(this["kfreward"+e]&&(this["kfreward"+e].visible=!1,e<this.config.countReward.length)){this["kfreward"+e].visible=!0;var i=t.getAreaReward(this._index,e+1),n=i==Activity.CanGet;this["kfreward"+e].data={rewardData:this.config.countReward,rewardIndex:e,select:this.selectIndex?this._zqindex:0,redPoint:n,get:i==Activity.Geted}}if(this["bar"+e]&&(this["bar"+e].visible=!1,e<this.config.countReward.length)){this["bar"+e].visible=!0;var s=this.config.countReward[e-1]?this.config.countReward[e-1].count:0,o=this.config.countReward[e].count-s,a=t.areaBuyData[this._index]-s,r=Math.floor(a/o*100);this["bar"+e].value=r>=100?100:r}}},e}(BaseView);__reflect(OSATarget2Panel4.prototype,"OSATarget2Panel4"),window.OSATarget2Panel4=OSATarget2Panel4;var OSATarget2Panel4ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFRewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.redPoint,e=this.data.get,i=(this.data.select,this.data.rewardIndex),n=this.data.rewardData[i];this.itemicon.source=n.show,this.tsNeed.text=""+n.count,this.redPoint.visible=t,this.get.visible=e,t?(this.mc||(this.mc=new MovieClip),this.mc.parent||this.effGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"BtnPrompt3",-1)):this.effGroup.removeChildren(),this.get.visible?this.setGray(this.itemicon):this.setLight(this.itemicon)}},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)]},e.prototype.setLight=function(t){t.filters=[]},e}(BaseItemRender);__reflect(OSATarget2Panel4ItemRender.prototype,"OSATarget2Panel4ItemRender"),window.OSATarget2Panel4ItemRender=OSATarget2Panel4ItemRender;var OSATarget2Panel4TipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFRewardTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buy,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.activityID=t[0],this._index=t[1],this._zqindex=t[2],this.updateData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.buy:var e=void 0,i=void 0;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID));var n=i.getAreaReward(this._index,this._zqindex);n==Activity.Geted?TipsCT.ins().showTips("已领取"):n==Activity.CanGet?this.activityType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index,this._zqindex):this.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index):TipsCT.ins().showTips("未达到条件")}},e.prototype.updateData=function(){var t,e,i;this.activityType==ActivityType.Normal?(t=Activity.ins(),e=t.getActivityDataById(this.activityID),i=GlobalConfig.ActivityType2Config[this.activityID][this._index]):this.activityType==ActivityType.Personal&&(t=PActivity.ins(),e=t.getActivityDataById(this.activityID),i=GlobalConfig.ActivityType2Config[this.activityID][this._index]);var n=e.getAreaReward(this._index,this._zqindex);this.buy.visible=this.redPoint.visible=n==Activity.CanGet,this.already.visible=n==Activity.Geted,this.requireTxt.visible=this.readydesc0.visible=n==Activity.NotReached,this.slogan.source="kf_giftslogan"+this._zqindex,this.value.text=i.countReward[this._zqindex-1].value+"",this.list.dataProvider=new eui.ArrayCollection(i.countReward[this._zqindex-1].reward),this.readydesc0.text="个人购买"+i.giftName+"后\n跨服参团人数达到"+i.countReward[this._zqindex-1].count},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e;this.activityType==ActivityType.Normal?e=Activity.ins():this.activityType==ActivityType.Personal&&(e=PActivity.ins()),e.isSuccee||TipsCT.ins().showTips("领取失败"),e.isSuccee=!1,this.updateData()}},e}(BaseEuiView);__reflect(OSATarget2Panel4TipsWin.prototype,"OSATarget2Panel4TipsWin"),ViewManager.ins().reg(OSATarget2Panel4TipsWin,LayerManager.UI_Popup),window.OSATarget2Panel4TipsWin=OSATarget2Panel4TipsWin;var OSATarget2Panel5=function(t){function e(){var e=t.call(this)||this;return e._index=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activityType=ActivityPanel.getActivityTypeFromId(this.activityID)},e.prototype.setCurSkin=function(){var t;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="specialPriceGiftSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.addTouchEvent(this.buy,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),Timer.start(1e3,0,this.setTime,this),this.rewards.itemRenderer=ItemBase;var i=this.getRule();this.updateData(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e,i;this.activityType==ActivityType.Normal?(e=Activity.ins(),i=e.getActivityDataById(this.activityID)):this.activityType==ActivityType.Personal&&(e=PActivity.ins(),i=e.getActivityDataById(this.activityID)),e.isSuccee||(TipsCT.ins().showTips("领取失败"),e.sendChangePage(i.id)),e.isSuccee=!1;var n=this.getRule();this.updateData(n)}},e.prototype.onTap=function(t){var e;switch(t.currentTarget){case this.buy:if(this.config.vip&&Actor.vip<this.config.vip)TipsCT.ins().showTips(VipCT.getVipStr(this.config.vip)+"等级不足");else{if(BagCT.ins().getSurplusCount()<this.config.rewards.length)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?this.activityType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.activityType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}e=-1}},e.prototype.getRule=function(){var t,e;this.activityType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity2Config[this.activityID]);var i=[];for(var n in e)i.push(e[n]);i.sort(this.sortFunc);for(var s=0;s<i.length;s++){var o=i[s],a=t.buyData[o.index]>=o.count;if(!a)return o.index}return 1},e.prototype.sortFunc=function(t,e){return t.price<e.price?-1:t.price>e.price?1:0},e.prototype.updateData=function(t){void 0===t&&(t=1),this._index=t;var e,i,n;this.activityType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.ActivityType2Config[this.activityID][t],i=GlobalConfig.ActivityBtnConfig[this.activityID],n=GlobalConfig.ActivityType2Config[this.activityID]):this.activityType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),this.config=GlobalConfig.PActivity2Config[this.activityID][t],i=GlobalConfig.PActivityBtnConfig[this.activityID],n=GlobalConfig.PActivity2Config[this.activityID]),this.setTime(),i&&(this.title.source=i.title),this.originalPrice.text=this.config.originalPrice+"",this.nowPrice.text=this.config.price+"",this.rewards.dataProvider=new eui.ArrayCollection(this.config.rewards);var s=e.buyData[this._index]>=this.config.count;this.buy.visible=!s,this.already.visible=s,this.actTime.visible=!this.already.visible,this.redPoint.visible=this.buy.visible&&Actor.yb>=this.config.price,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1)},e.prototype.setTime=function(){var t;this.activityType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.activityType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID));var e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget2Panel5.prototype,"OSATarget2Panel5"),window.OSATarget2Panel5=OSATarget2Panel5;var OSATarget2Panel6=function(t){function e(){var e=t.call(this)||this;return e.zbIds=[],e.sex=1,e.skinName="CDDressSkin",e.buy.itemRenderer=OSATarget2Panel6ItemRender,e.bodyMc=new MovieClip,e.bodyMc.visible=!1,e.eBodyMCGroup.addChild(e.bodyMc),e.wefBodyMc=new MovieClip,e.wefBodyMc.visible=!1,e.eWeapon.addChild(e.wefBodyMc),e.wingMc=new MovieClip,e.wingMc.visible=!1,e.eWingGroup.addChild(e.wingMc),e.sexBtn0.$autoSelected=!1,e.sexBtn1.$autoSelected=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.updateShow(),this.updateData(),this.setSex(0)},e.prototype.onClick=function(t){var i=this;if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget2Panel6ItemRender){var n=t.target.parent.data[0];return void(GlobalFun.checkMoney(n.price,n.currencyType)&&(e.showTips?WarnWin.show("是否消耗"+(n.price+RewardData.getCurrencyName(n.currencyType))+"购买"+GlobalConfig.ItemConfig[n.rewards[0].id].name+"*"+n.rewards[0].count,function(){Activity.ins().sendReward(i.activityID,n.index)},this,function(){e.showTips=!0},this,"check","center",!e.showTips,function(t){e.showTips=!t},this):Activity.ins().sendReward(this.activityID,n.index)))}switch(t.target){case this.sexBtn0:this.setSex(0);break;case this.sexBtn1:this.setSex(1)}},e.prototype.setSex=function(t){this.sex!=t&&(this.sex=t,this.sexBtn0.selected=0==this.sex,this.sexBtn1.selected=1==this.sex,this.updateShow())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime1.text=this.data.getRemainTime())},e.prototype.updateData=function(){this.data=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=t.desc,this.updateTitle(),this.setTime(),this.updateList()},e.prototype.updateShow=function(){this.zbIds=[];var t=GlobalConfig.ActivityType2Config[this.activityID];for(var e in t){var i=Dress.ins().getIdZhuangBanId(t[e].rewards[0].id);this.zbIds.push(i);var n=GlobalConfig.ZhuangBanId[i];switch(n.pos){case 1:n.useMc?this.bodyMc.playFile(RES_DIR_DRESS+n.res+"_"+this.sex+"_c_m",-1):(this.bodyMc.stop(),this.bodyImg.source=n.res+"_"+this.sex+"_c_png"),this.bodyImg.visible=!n.useMc,this.bodyMc.visible=!this.bodyImg.visible;break;case 2:n.useMc?this.wefBodyMc.playFile(RES_DIR_DRESS+n.res+"_"+this.sex+"_c_m",-1):(this.wefBodyMc.stop(),this.weaponImg.source=n.res+"_"+this.sex+"_c_png"),this.weaponImg.visible=!n.useMc,this.wefBodyMc.visible=!this.weaponImg.visible;break;case 3:this.wingImg.visible=!0,this.wingMc.visible=!1,n.useMc?this.wingMc.playFile(RES_DIR_DRESS+n.res+"_c_m",-1):(this.wingMc.stop(),this.wingImg.source=n.res+"_png"),this.wingImg.visible=!n.useMc,this.wingMc.visible=!this.wingImg.visible}}},e.prototype.updateList=function(){for(var t=GlobalConfig.ActivityType2Config[this.activityID],e=[],i=CommonUtils.getObjectLength(t),n=0;i>n;n++)e.push([t[n+1],this.zbIds[n]]);this.buy.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(e))},e.showTips=!0,e}(BaseView);__reflect(OSATarget2Panel6.prototype,"OSATarget2Panel6"),window.OSATarget2Panel6=OSATarget2Panel6;var OSATarget2Panel6ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDDressItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];this.text.text=GlobalConfig.ZhuangBanId[e].name,this.now.text=t.price+"";var i=Activity.ins().activityData[t.Id],n=(i.buyData[t.index]||0)<t.count;this.get.enabled=n,this.get.label=n?"购买":"已购买"}},e}(BaseItemRender);__reflect(OSATarget2Panel6ItemRender.prototype,"OSATarget2Panel6ItemRender"),window.OSATarget2Panel6ItemRender=OSATarget2Panel6ItemRender;var OSATarget30ItemRender1=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDCarnivalTaskItem",e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data[0]&&null!=this.data[0].id&&null!=this.data[0].state&&null!=this.data[0].activityId){var t=this.data[0].state;switch(t){case 1:this.eStateLab.visible=!1;break;case 2:this.eStateLab.visible=!0,this.eStateLab.textColor=65280,this.eStateLab.text="已领取";break;default:this.eStateLab.visible=!0,this.eStateLab.textColor=16714240,this.eStateLab.text="未达成"}this.buyGroup.visible=!this.eStateLab.visible;var e=1==this.data[1]?GlobalConfig.PActivityType30_2Config:GlobalConfig.ActivityType30_2Config,i=e[this.data[0].activityId][this.data[0].id];this.ePow.text=i.score+"",this.reward.dataProvider=new eui.ArrayCollection(i.reward)}},e}(BaseItemRender);__reflect(OSATarget30ItemRender1.prototype,"OSATarget30ItemRender1"),window.OSATarget30ItemRender1=OSATarget30ItemRender1;var OSATarget30ItemRender2=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDCarnivalRewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data[0]&&null!=this.data[0].id&&null!=this.data[0].activityId&&null!=this.data[0].times){var t=1==this.data[1]?GlobalConfig.PActivityType30_1Config:GlobalConfig.ActivityType30_1Config,e=t[this.data[0].activityId][this.data[0].id];this.nameTxt.text=e.name,this.descTxt.text=this.data[0].times+"/"+e.count}},e}(BaseItemRender);__reflect(OSATarget30ItemRender2.prototype,"OSATarget30ItemRender2"),window.OSATarget30ItemRender2=OSATarget30ItemRender2;var OSATarget30Panel=function(t){function e(e){var i=t.call(this)||this;return i.up="up",i.down="down",i.disabled="disabled",i.taskGroup=1,i}return __extends(e,t),e.prototype.setCurSkin=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.aCon=GlobalConfig.ActivityConfig,this.config30=GlobalConfig.ActivityType30_1Config,this.cfg30=GlobalConfig.ActivityType30_2Config,this.btnCfg=GlobalConfig.ActivityBtnConfig):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.aCon=GlobalConfig.PActivityConfig,this.config30=GlobalConfig.PActivityType30_1Config,this.cfg30=GlobalConfig.PActivityType30_2Config,this.btnCfg=GlobalConfig.PActivityBtnConfig),this.aCon[this.activityID].pageSkin?this.skinName=this.aCon[this.activityID].pageSkin:this.skinName="CDCarnivalSkin",this.rechargeitem.itemRenderer=OSATarget30ItemRender1,this.task.itemRenderer=OSATarget30ItemRender2},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onClick),this.setCurSkin(),this.data=this.ins.getActivityDataById(this.activityID),this.update(),this.setTime(),this.actDesc.text=this.aCon[this.activityID].desc;for(var i=GlobalConfig.ActivityBaseConfig.Type30GroupNames,n=1;n<i.length;n++)this["project"+(n-1)].label=""+i[n]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onClick=function(t){var e=0;switch(t.target){case this.project0:this.project0.currentState=this.up,this.project1.currentState=this.disabled,this.project2.currentState=this.disabled,e=1;break;case this.project1:this.project0.currentState=this.disabled,this.project1.currentState=this.up,this.project2.currentState=this.disabled,e=2;break;case this.project2:this.project0.currentState=this.disabled,this.project1.currentState=this.disabled,this.project2.currentState=this.up,e=3;break;default:if(t.target.parent instanceof OSATarget30ItemRender2){var i=t.target.parent.data,n=this.config30[this.activityID][i[0].id].turn;ViewManager.ins().open(n[0],n[1],n[2])}else if(t.target.parent.parent.parent instanceof OSATarget30ItemRender1){var i=t.target.parent.parent.parent.data;this.ins.sendReward(this.activityID,i[0].id)}return}0!=e&&e!=this.taskGroup&&(this.taskGroup=e,this.updateTaskList())},e.prototype.update=function(){this.data=this.ins.activityData[this.activityID],this.count.text=this.data.score+"",this.updateAwardList(),this.updateTaskList()},e.prototype.updateAwardList=function(){var t=[];for(var e in this.data.awardInfo)t.push([this.data.awardInfo[e],this.actType]);this.rechargeitem.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateTaskList=function(){var t=this.data.taskInfo,e=this.config30[this.activityID],i=[];for(var n in t){var s=t[n],o=e[s.id];o.group==this.taskGroup&&i.push([s,this.actType])}this.task.dataProvider=new eui.ArrayCollection(i)},e.prototype.updateTitle=function(){this.title.source=this.btnCfg[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(OSATarget30Panel.prototype,"OSATarget30Panel"),window.OSATarget30Panel=OSATarget30Panel;var OSATarget31Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="CDChristmasBossSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.list.itemRenderer=ItemBase,this.pingTus=[this.pingtu0,this.pingtu1,this.pingtu2,this.pingtu3,this.pingtu4],this.actCfg=GlobalConfig.ActivityType31Config[this.activityID],this.list.dataProvider=new eui.ArrayCollection(this.actCfg.awards),Timer.stop(this.updateTime,this),Timer.start(500,0,this.updateTime,this),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onClick),this.data=Activity.ins().activityData[this.activityID],this.update(),this.setTime(),this.updateTitle(),Activity.ins().sendEnvelopeData(this.activityID,0);var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=i.desc},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateTime,this)},e.prototype.onClick=function(t){switch(t.target){case this.goBtn:this.data.curTimes>0?Activity.ins().sendReward(this.activityID,0,1):TipsCT.ins().showTips("次数不足");break;case this.checkBtn:ViewManager.ins().open(OSATarget31RewardWin,this.activityID)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.schedule1.maximum=this.actCfg.SnowManMaxNumber,this.schedule1.value=this.data.totalPoint,this.text1.text="雪人进度:"+this.data.totalPoint+"/"+this.actCfg.SnowManMaxNumber;for(var t=this.pingTus.length,e=this.actCfg.SnowManMaxNumber/t,i=0;t>i;i++)this.pingTus[i].visible=this.data.totalPoint>=e*(i+1);var n=GlobalConfig.ActivityType31_1Config[this.activityID],s=CommonUtils.getObjectLength(n),o=n[s];this.schedule0.maximum=o.score,this.schedule0.value=this.data.score,this.schedule0.labelDisplay.visible=!1,this.target.text=this.data.score+"/"+o.score},e.prototype.updateTime=function(){var t=this.data.curTimes,e=this.actCfg.StorageMaxCount,i=t>0?"2ECA22":"f3311e",n=Math.round((this.data.cd-egret.getTimer())/1e3);n=0>=n?0:n;var s=t>=e?"(1小时恢复1次)":"(恢复倒计时："+DateUtils.getFormatBySecond(n)+")";this.lastNum.textFlow=(new egret.HtmlTextParser).parser('<font color="#'+i+'">剩余次数：'+t+"/"+e+' <font color="#7E6437">'+s+"</font></font>"),this.setTime()},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget31Panel.prototype,"OSATarget31Panel"),window.OSATarget31Panel=OSATarget31Panel;var OSATarget31RewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDChristmasBossShowItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.index=t.index,this.scheduleTxt.text="达成"+t.score+"次堆雪人",this.list.dataProvider=new eui.ArrayCollection(t.reward);var e=Activity.ins().activityData[t.id],i=e.getAwardStateById(t.index);switch(this.redPoint0.visible=!1,i){case 1:this.get0.enabled=!0,this.get0.label="领取",this.redPoint0.visible=!0;break;case 2:this.get0.enabled=!1,this.get0.label="已领取";break;default:this.get0.enabled=!1,this.get0.label="领取"}}},e}(BaseItemRender);__reflect(OSATarget31RewardItemRender.prototype,"OSATarget31RewardItemRender"),window.OSATarget31RewardItemRender=OSATarget31RewardItemRender;var OSATarget31RewardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CDChristmasBossRewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=OSATarget31RewardItemRender,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.actId=t[0],this.update()},e.prototype.update=function(){var t=GlobalConfig.ActivityType31_1Config[this.actId];if(t){var e=[];for(var i in t)e.push(t[i]);this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.onClick=function(t){if(t.target.parent.parent instanceof OSATarget31RewardItemRender){var e=t.target.parent.parent.index;return void Activity.ins().sendReward(this.actId,e,2)}switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(OSATarget31RewardWin.prototype,"OSATarget31RewardWin"),window.OSATarget31RewardWin=OSATarget31RewardWin,ViewManager.ins().reg(OSATarget31RewardWin,LayerManager.UI_Popup);var OSATarget32Item=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.eL.itemRenderer=ItemBase,this.touchEnabled=!1,this.addTouchEvent(this.eBtn,this.onTap)},e.prototype.onTap=function(){Activity.ins().sendReward(this.info.actId,this.info.id,0,0)},e.prototype.dataChanged=function(){if(this.data&&this.data.id){this.info=this.data,this.eTxt.text=this.eTxt.text="第"+this.info.id+"位好友",this.eHead.data=this.data;var t=GlobalConfig.ActivityType32Config[this.info.actId][this.info.id];this.eL.dataProvider=new eui.ArrayCollection(t.reward),this.info.rewardState?this.eBtn.label=(1==this.info.rewardState?"可":"已")+"领取":this.eBtn.label="未完成",this.eBtn.enabled=1==this.info.rewardState}},e}(BaseItemRender);__reflect(OSATarget32Item.prototype,"OSATarget32Item"),window.OSATarget32Item=OSATarget32Item;var OSATarget32Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDShareLvSkin",e.eList.itemRenderer=OSATarget32Item,e.addTouchEvent(e,e.onClick),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.data=Activity.ins().activityData[this.activityID],this.update(),this.setTime(),this.updateTitle();var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=i.desc},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.eList.dataProvider=new eui.ArrayCollection(this.data.infos)},e.prototype.onClick=function(t){switch(t.target){case this.eFx:ViewManager.ins().open(YqWin,!1)}},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget32Panel.prototype,"OSATarget32Panel"),window.OSATarget32Panel=OSATarget32Panel;var OSATarget33Panel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSelect=0,e.isMoving=!1,e.itemPos=[[0,-9,1,1],[129,15,.9,.9],[-137.5,15,.9,.9]],e.addRewardId=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin()},e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="CDthreedayrechargeSkin",this.gifts=[this.gift1,this.gift2,this.gift3],this.eList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onClick)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.data=Activity.ins().activityData[this.activityID];var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=i.desc,this.setTime(),this.updateTitle(),this.updateReward(),this.update(),this.selectItem(this.data.curOpenDay()+1)},e.prototype.selectItem=function(t,e){var i=this;if(void 0===e&&(e=!1),!(this.curSelect==t||e&&this.isMoving)){for(var n=this.itemPos.slice(0),s=t;s>1;){var o=n.pop();
n.unshift(o),s--}if(e){this.isMoving=!0;for(var a=0;a<this.gifts.length;a++){var r=this.gifts[a],l=egret.Tween.get(r);l.to({horizontalCenter:n[a][0],y:n[a][1],scaleX:n[a][2],scaleY:n[a][3]},500)}Timer.start(500,1,function(){i.isMoving=!1},this)}else for(var a=0;a<this.gifts.length;a++){var r=this.gifts[a];r.horizontalCenter=n[a][0],r.y=n[a][1],r.scaleX=n[a][2],r.scaleY=n[a][3]}this.curSelect=t,this.gifts[t-1].parent.addChild(this.gifts[t-1])}},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget33PanelItem){var e=t.target.parent.index;return void Activity.ins().sendReward(this.activityID,e,0)}if(t.target instanceof OSATarget33PanelItem)return void this.selectItem(t.target.index,!0);switch(t.target){case this.eGetBtn:Activity.ins().sendReward(this.activityID,this.addRewardId,1)}},e.prototype.update=function(){var t=GlobalConfig.ActivityType33_1Config[this.activityID][this.addRewardId];this.eTip.text="已充值天数（"+this.data.addTargetNum+"/"+t.target+"）",(this.data.addTargetState>>t.index&1)>0?(this.eGetBtn.enabled=!1,this.eGetBtn.label="已领奖"):this.data.addTargetNum>=t.target?(this.eGetBtn.enabled=!0,this.eGetBtn.label="领取"):(this.eGetBtn.enabled=!1,this.eGetBtn.label="领取"),this.redPoint.visible=this.eGetBtn.enabled,this.updateItems()},e.prototype.updateItems=function(){for(var t=GlobalConfig.ActivityType33Config[this.activityID],e=0;e<this.gifts.length;e++)this.gifts[e].data=t[e+1]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateTitle=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e.prototype.updateReward=function(){var t=GlobalConfig.ActivityType33_1Config[this.activityID][this.addRewardId];this.eList.dataProvider=new eui.ArrayCollection(t.reward)},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(OSATarget33Panel.prototype,"OSATarget33Panel"),window.OSATarget33Panel=OSATarget33Panel;var OSATarget33PanelItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="threedayitem",e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().activityData[t.Id];this.index=t.index,this.day.source="day"+t.day+"bg_png",this.reward.dataProvider=new eui.ArrayCollection(t.rewards);var i=e.curOpenDay()+1;if(Timer.stop(this.setTime,this),i==t.day){var n=e.chongzhiNum>=t.val,s=n?ColorUtil.GREEN:ColorUtil.RED,o='充值<font color="'+s+'">'+e.chongzhiNum+"/"+t.val+"</font>元宝";this.recharge.textFlow=(new egret.HtmlTextParser).parser(o),this.timetext.text="剩余时间：",(e.recrod>>this.index&1)>0?(this.eGetBtn.visible=!1,this.timetext.visible=!1,this.eTips.text="已领取"):n?(this.eGetBtn.visible=!0,this.timetext.visible=!1,this.eTips.text=""):(this.eGetBtn.visible=!1,this.timetext.visible=!0,this.eTips.text="",Timer.start(1e3,0,this.setTime,this))}else if(t.day<i)this.timetext.visible=!1,this.recharge.text="",this.eTips.text="已过期",this.eGetBtn.visible=1==e.dabiao[t.index-1]&&0==(e.recrod>>t.index&1);else if(t.day>i){this.timetext.visible=!1;var o='充值<font color="'+ColorUtil.RED+'">0/'+t.val+"</font>元宝";this.recharge.textFlow=(new egret.HtmlTextParser).parser(o),this.eTips.text="不可领取",this.eGetBtn.visible=!1}this.redPoint.visible=this.eGetBtn.visible}},e.prototype.setTime=function(){var t=new Date(GameServer.serverTime),e=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()+DateUtils.MS_PER_DAY,i=e-GameServer.serverTime;0>i&&(i=0),this.timetext.text="剩余时间："+DateUtils.getFormatBySecond(i/1e3,DateUtils.TIME_FORMAT_5,3)},e}(BaseItemRender);__reflect(OSATarget33PanelItem.prototype,"OSATarget33PanelItem"),window.OSATarget33PanelItem=OSATarget33PanelItem;var OSATarget34Panel=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.skinName="CDFanliShopSkin",i.items=[i.eItem1,i.eItem2],i.text=i.lab.text,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onClick),this.update(),this.updateUI(),this.setTime(),Activity.ins().sendEnvelopeData(this.activityID,0)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof CDFanliShopItemRender){var e=t.target.parent.parent.itemIcon.data,i=GlobalConfig.ActivityType34Config[this.activityID],n=i.goodsinfo[e];GlobalFun.checkMoney(n.discount)&&Activity.ins().sendReward(this.activityID,0,1,e)}},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];for(var t=this.items.length,e=0;t>e;e++)this.items[e].data=[this.data.goods[e],this.activityID]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.updateUI=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.lab.text=this.text+GlobalConfig.ActivityType34Config[this.activityID].rebate/100+"%"},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget34Panel.prototype,"OSATarget34Panel"),window.OSATarget34Panel=OSATarget34Panel;var OSATarget35Panel=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e,i.skinName="CDRechargeStandardSkin",i.reward.itemRenderer=ItemBase,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this.btn,this.onClick),this.update(),this.updateUI(),this.setTime()},e.prototype.onClick=function(t){switch(this.data.state){case 1:Activity.ins().sendReward(this.activityID,0);break;case 2:break;default:var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}},e.prototype.update=function(){switch(this.data=Activity.ins().activityData[this.activityID],this.btn.enabled=!0,this.data.state){case 1:this.btn.label="领  取";break;case 2:this.btn.enabled=!1,this.btn.label="已领奖";break;default:this.btn.label="立即充值"}},e.prototype.updateUI=function(){this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actDesc0.text=GlobalConfig.ActivityConfig[this.activityID].desc;var t=GlobalConfig.ActivityType35Config[this.activityID];this.reward.dataProvider=new eui.ArrayCollection(t.rewards),this.lab.source=t.info,this.img.source=t.img},e.prototype.setTime=function(){this.data&&(this.actTime0.text=this.data.getRemainTime())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(OSATarget35Panel.prototype,"OSATarget35Panel"),window.OSATarget35Panel=OSATarget35Panel;var OSATarget36Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDDjTurntableSkin",i.activityID=e,i.list.itemRenderer=HuntListRenderer,i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfg=GlobalConfig.ActivityType36Config[this.activityID]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfg=GlobalConfig.PActivityType36Config[this.activityID]),this.observe(this.ins.postRewardResult,this.updateResult),this.observe(this.ins.postActivityIsGetAwards,this.update),this.observe(this.ins.postEnvelopeData,this.updateLog),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.update(),this.updateUI(),this.setTime(),this.text.source=this.cfg.showImage},e.prototype.update=function(){this.actType==ActivityType.Normal?(this.data=Activity.ins().activityData[this.activityID],Activity.ins().sendEnvelopeData(this.activityID,0)):this.actType==ActivityType.Personal&&(this.data=PActivity.ins().activityData[this.activityID],PActivity.ins().sendEnvelopeData(this.activityID,0)),this.updateView(),this.updateNum()},e.prototype.updateLog=function(){this.list.dataProvider=new eui.ArrayCollection(this.data.logs)},e.prototype.updateView=function(){for(var t=this.cfg.reward.length,e=0;t>e;e++){var i=this["item"+e];i.itemIcon.data=this.cfg.reward[e],i.changeEquipEffect("ValueEff4"),i.rewardState(this.data.getRewardState(e+1))}},e.prototype.updateNum=function(){this.rechargeCoumt.text="今日已充值"+this.data.addNum+"元",this.times.text="剩余抽奖次数:"+this.data.times},e.prototype.updateUI=function(){this.actType==ActivityType.Personal?(this.title.source=GlobalConfig.PActivityBtnConfig[this.activityID].title,this.actDesc.text=GlobalConfig.PActivityConfig[this.activityID].desc):(this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc)},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.updateResult=function(){this.beginLottery(this.data.rewardIndex)},e.prototype.beginLottery=function(t){var e=this,i=1440+360*(t-.5)/this.cfg.reward.length,n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.flyItem(e["item"+(t-1)]),e.ins.sendReward(e.activityID,0,2),setTimeout(function(){e.rolling=!1,e.updateView()},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){this.data.times<=0?TipsCT.ins().showTips("次数不足"):this.rolling?TipsCT.ins().showTips("正在抽奖，请稍候"):this.ins.sendReward(this.activityID,0,1)},e}(BaseView);__reflect(OSATarget36Panel.prototype,"OSATarget36Panel"),window.OSATarget36Panel=OSATarget36Panel;var OSATarget37Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDNewYearBossSkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i.bossMc=new MovieClip,i.eBossGroup.addChild(i.bossMc),i.list.itemRenderer=ItemBase,i.lastNum.text="",i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityBossInfo,this.update),this.observe(ReadPlayerCT.ins().postPlayerResult,this.updatePlayerResult),this.update(),this.updateUI(),this.setTime()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID];var t=this.data.getBossInfo();this.eFace.source="",this.belongTxt.text="",this.goBtn.visible=t&&1==t.bossState,this.lastWinnerId=t&&t.lastWinnerId>0?t.lastWinnerId:0,this.winnerGroup.visible=t&&t.lastWinnerId>0,t&&(t.lastWinnerId>0&&ReadPlayerCT.ins().sendFindPlayer(t.lastWinnerId,t.lastWinnerServerId),Timer.has(this.updateTime,this)||Timer.start(1e3,0,this.updateTime,this))},e.prototype.updatePlayerResult=function(t){if(0!=this.lastWinnerId&&this.lastWinnerId==t.id){this.otherPlayerData=t;var e=this.otherPlayerData&&this.otherPlayerData.roleData[0];if(!e)return;this.eFace.source="yuanhead"+e.job+e.sex,this.belongTxt.text=this.otherPlayerData.name}},e.prototype.updateUI=function(){var t=GlobalConfig.ActivityType37Config[this.activityID],e=GlobalConfig.MonstersConfig[t.bossId];this.bossMc.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.list.dataProvider=new eui.ArrayCollection(t.reward)},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateTime,this),this.removeObserve()},e.prototype.updateTime=function(){var t=this.data.getBossInfo();if(t){var e=t.relieveTime-egret.getTimer();0>=e?(this.lastNum.text="",Timer.stop(this.updateTime,this)):this.lastNum.text="复活倒计时："+DateUtils.getFormatBySecond(Math.floor(e/1e3),1)}},e.prototype.onClick=function(t){switch(t.target){case this.goBtn:Activity.ins().sendReward(this.activityID,0);break;case this.rank:ViewManager.ins().open(CDNewYearArenaWin,this.activityID);break;case this.winnerGroup:if(this.otherPlayerData){var e=ViewManager.ins().open(RRoleWin,this.otherPlayerData);KFServerSys.ins().isKF&&e.hideEx(2)}}},e}(BaseView);__reflect(OSATarget37Panel.prototype,"OSATarget37Panel"),window.OSATarget37Panel=OSATarget37Panel;var OSATarget38Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="NewhongbaoSkin",i.activityID=e,i.addTouchEvent(i,i.onThouch),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.upDateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onThouch=function(t){switch(t.target){case this.getRewrodBtn:if(this.data&&this.data.currVipTotal>0&&this.data.hasRecharge)Activity.ins().sendGetHongBao(2,this.activityID);else if(this.data&&!this.data.hasRecharge){var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win)}}},e.prototype.upDateView=function(){if(this.data=Activity.ins().activityData[this.activityID],this.data&&(this.eNoVIPShowGroup.visible=!(this.data.hasRecharge&&this.data.currVipTotal<=0),this.eCurrGetMoneyLab.text=this.data.currGetTotal+"元宝",this.eVIPGetMoneyLab.text=this.data.currVipTotal+"元宝",this.desc.text="",this.getRewrodBtn.visible=this.data.currVipTotal>0,0!=this.data.currentNum)){this.desc.height=0;for(var t=this.data.currentNum>50?this.data.currentNum-50:0,e=this.data.currentNum-1;e>=t;e--)this.desc.text+=this.data.currData[e]+"\n",this.desc.height+=20}},e}(BaseView);__reflect(OSATarget38Panel.prototype,"OSATarget38Panel"),window.OSATarget38Panel=OSATarget38Panel;var OSATarget39Item=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.update=function(t){if(t){this.sign.source="GoodSign"+t.type+"_png";var e=t.rewards[0];0==e.type?this.item.source=RewardData.getCurrencyRes(e.id):this.item.source=GlobalConfig.ItemConfig[e.id].icon+"_png",this.count.text=e.count+"",this.rewards=t.rewards}},e}(BaseView);__reflect(OSATarget39Item.prototype,"OSATarget39Item"),window.OSATarget39Item=OSATarget39Item;var OSATarget39Panel=function(t){function e(e){var i=t.call(this)||this;i.horizontalCenters=[],i.tops=[],i.scales=[],i.isShowEff=!1,i.skinName="CDGoodSignSkin",i.activityID=e,i.addTouchEvent(i,i.onClick),i.eSigns=[i.eSign1,i.eSign2,i.eSign3];for(var n=0;n<i.eSigns.length;n++)i.horizontalCenters.push(i.eSigns[n].horizontalCenter),i.tops.push(i.eSigns[n].top),i.scales.push(i.eSigns[n].scaleX);return i.movieClip=new MovieClip,i.movieClip.visible=!1,i.movieClip.scaleX=1.5,i.movieClip.scaleY=1.5,i.eEffGroup.addChild(i.movieClip),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postRewardResult,this.updateResult),this.init(),this.setTime(),Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this)},e.prototype.init=function(){this.eBtn.touchEnabled&&this.update()},e.prototype.updateData=function(){},e.prototype.updateResult=function(){var t=this.eSigns[this.data.signType-1];if(t){var e=egret.Tween.get(t);e.to({horizontalCenter:this.horizontalCenters[2],top:this.tops[2],scaleX:this.scales[2],scaleY:this.scales[2]},300),Timer.start(300,1,this.showReward,this)}},e.prototype.showReward=function(){var t=this.eSigns[this.data.signType-1];t?(this.movieClip.visible=!0,this.movieClip.playFile(RES_DIR_EFF+"baoxiangkq",-1),Timer.start(2e3,1,this.update,this)):this.update()},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:var e=GlobalConfig.ActivityType39Config[this.activityID][this.data.curSignId];(BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.consume.id)>=e.consume.count||GlobalFun.checkMoney(e.ybConsume))&&this.showEff()}},e.prototype.update=function(){this.movieClip.visible=!1,this.movieClip.stop(),this.revertSign(),this.data=Activity.ins().activityData[this.activityID];var t=GlobalConfig.ActivityType39Config[this.activityID][this.data.curSignId];this.updateSigns(t),this.ePrice.setPrice(t.ybConsume),this.eDesc.source=t.desc;var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume.id),i=e>=t.consume.count,n=i?ColorUtil.GREEN:ColorUtil.RED,s='<font color="'+n+'">'+e+"</font>/"+t.consume.count;this.eKeylab.textFlow=(new egret.HtmlTextParser).parser(s),this.eMaxLab.visible=this.data.isFinish(),this.eBtn.visible=!this.data.isFinish(),this.updateLab(t)},e.prototype.updateLab=function(t){var e=0;for(var i in GlobalConfig.ActivityType39Config[this.activityID])if(GlobalConfig.ActivityType39Config[this.activityID][i].activityID>0){e=GlobalConfig.ActivityType39Config[this.activityID][i].activityID;break}if(0==e)return void(this.eTipGroup.visible=!1);var n=null;for(var i in GlobalConfig.ActivityType1Config[e])if(YuanshenData.ins().yuanShenLv<GlobalConfig.ActivityType1Config[e][i].lianjiLv){n=GlobalConfig.ActivityType1Config[e][i];break}if(!n)return void(this.eTipGroup.visible=!1);var s=YuanshenData.ins().yuanshenData,o=s[YuanshenData.ins().yuanshenId],a=o&&o.level||0,r=GlobalConfig.LianJiSysUpgradeConf[YuanshenData.ins().yuanshenId][a+1],l=r.needExp;this.eStarNum.text=Math.floor(10*t.reward[t.reward.length-1].rewards[0].count/l)+"",this.eDestStarNum.text=YuanshenData.getUpgradeTimesByLv(n.lianjiLv)+"",this.eAwardLv.text=n.index+"";var h,u=YuanshenData.getJingjie(),p=YuanshenData.ins().yuanshenId-1;h=0==u.jie?11-p:11*(4-(u.jie-1))-p;var c=CommonUtils.getObjectLength(GlobalConfig.LianJiSysConf.peiyangNeedName);u.jingjie>=c&&(h-=11),this.eDestStarNum1.text=h+"",this.eBoss.source="GoodSignBoss_"+(u.jingjie+1)+"_png"},e.prototype.updateSigns=function(t){for(var e=0;e<this.eSigns.length;e++)this.eSigns[e].update(t.reward[e])},e.prototype.setTime=function(){this.data&&(this.eActTime.text=this.data.getRemainTime())},e.prototype.showEff=function(){this.eBtn.touchEnabled=!1;for(var t in this.eSigns){var e=this.eSigns[t],i=egret.Tween.get(e);i.to({horizontalCenter:0,top:300,scaleX:0,scaleY:0},100)}Timer.start(100,1,this.shakeIt,this),Timer.start(900,1,this.sendReward,this)},e.prototype.sendReward=function(){Activity.ins().sendReward(this.activityID,0)},e.prototype.shakeIt=function(){DisplayUtils.shakeIt(this.eDesc0,50,150,2)},e.prototype.revertSign=function(){this.eBtn.touchEnabled=!0;for(var t=0;t<this.eSigns.length;t++){var e=this.eSigns[t];egret.Tween.removeTweens(e),e.horizontalCenter=this.horizontalCenters[t],e.top=this.tops[t],e.scaleX=e.scaleY=this.scales[t],e.visible=!0}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.revertSign(),this.removeObserve(),Timer.stop(this.shakeIt,this),Timer.stop(this.sendReward,this),Timer.stop(this.showReward,this),Timer.stop(this.update,this)},e}(BaseView);__reflect(OSATarget39Panel.prototype,"OSATarget39Panel"),window.OSATarget39Panel=OSATarget39Panel;var MathUtils=function(){function t(){}return t.getAngle=function(t){return 180*t/Math.PI},t.getRadian=function(t){return t/180*Math.PI},t.getRadian2=function(t,e,i,n){var s=i-t,o=n-e;return Math.atan2(o,s)},t.getDistance=function(t,e,i,n){var s=i-t,o=n-e,a=s*s+o*o;return Math.sqrt(a)},t.getDistanceByObject=function(t,e){return this.getDistance(t.x,t.y,e.x,e.y)},t.getDistanceX2ByObject=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n},t.getDirMove=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=this.getRadian(t),o={x:0,y:0};return o.x=Math.cos(s)*e+i,o.y=Math.sin(s)*e+n,o},t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var i=e-t;return t+Math.random()*i},t.limitInteger=function(t,e){return Math.round(this.limit(t,e))},t.randomArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t.toInteger=function(t){return t>>0},t}();__reflect(MathUtils.prototype,"MathUtils"),window.MathUtils=MathUtils;var OSATarget3ItemRender=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){t.prototype.dataChanged.call(this);var e=this.data;this.currentState=e.index%2==1?"big":"small"}},e}(OSATarget3BigRewardItemRender);__reflect(OSATarget3ItemRender.prototype,"OSATarget3ItemRender"),window.OSATarget3ItemRender=OSATarget3ItemRender;var OSATarget3ItemRender11=function(t){function e(){var e=t.call(this)||this;return e.skinName="RechargeContinuitySkinItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rewardList.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){switch(t.target){case this.get0:if(this.isGet)this.data instanceof ActivityType3Config?Activity.ins().sendReward(this.actId,this.index):this.data instanceof PActivity3Config&&PActivity.ins().sendReward(this.actId,this.index);else{var e=void 0,i=void 0,n=void 0;this.data instanceof ActivityType3Config?(e=GlobalConfig.ActivityType3Config[this.actId][this.index],n=Activity.ins(),i=n.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=GlobalConfig.PActivity3Config[this.actId][this.index],n=PActivity.ins(),i=n.getActivityDataById(this.actId));var s=0;switch(e.showType){case Show3Type.TYPE11:i.dabiao[this.index-1]<e.day&&(s=e.day-i.dabiao[this.index-1])}if(!s)return void n.sendReward(this.actId,this.index);e.showType==Show3Type.TYPE11&&i.dabiao[this.index-1]<e.day&&TipsCT.ins().showTips("累计充值"+ +s+"天之后即可领取奖励")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i,n;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins(),n=i.getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins(),n=i.getActivityDataById(e.Id)),this.num.text=e.day+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.rewards);var s=n.getRewardStateById(e.index);switch(s){case Activity.NotReached:this.get0.label="未完成",this.get0.enabled=this.isGet=this.redPoint.visible=!1;break;case Activity.CanGet:this.get0.label="领取",this.get0.enabled=this.isGet=this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=this.redPoint.visible=this.get0.visible=!1,this.already.visible=!this.isGet}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender11.prototype,"OSATarget3ItemRender11"),window.OSATarget3ItemRender11=OSATarget3ItemRender11;var OSATarget3ItemRender6=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyRechargeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.reward.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){var e,i,n;switch(this.data instanceof ActivityType3Config?(e=Activity.ins(),i=GlobalConfig.ActivityType3Config[this.actId][this.index],n=e.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=PActivity.ins(),i=GlobalConfig.PActivity3Config[this.actId][this.index],n=e.getActivityDataById(this.actId)),t.target){case this.get:if(this.isGet)e.sendReward(this.actId,this.index);else{var s=0;switch(i.showType){case Show3Type.TYPE6:n.chongzhiTotal<i.val&&(s=i.val-n.chongzhiTotal)}if(!s)return void Activity.ins().sendReward(this.actId,this.index);i.showType==Show3Type.TYPE6&&n.chongzhiTotal<i.val&&TipsCT.ins().showTips("未完成累计充值")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins().getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins().getActivityDataById(e.Id)),this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.target.text="累计充值"+e.val+"元宝";var n=65280;i.chongzhiTotal<e.val&&(n=16711680),this.recharge.textFlow=TextFlowMaker.generateTextFlow1("(|C:"+n+"&T:"+i.chongzhiTotal+"|C:65280&T:/"+e.val+")");var s=i.getRewardStateById(e.index);switch(this.get.visible=!0,this.redPoint.visible=!1,this.already.visible=!1,s){case Activity.NotReached:this.get.label="未完成",this.get.currentState="disabled",this.isGet=!1;break;case Activity.CanGet:this.get.label="领取",this.get.currentState="up",this.isGet=!0,this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=!1,this.redPoint.visible=!1,this.get.visible=!1,this.already.visible=!0}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender6.prototype,"OSATarget3ItemRender6"),window.OSATarget3ItemRender6=OSATarget3ItemRender6;var OSATarget3ItemRender6QM=function(t){function e(){var e=t.call(this)||this;return e.skinName="accumulateRechargeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.reward.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){var e,i,n;switch(this.data instanceof ActivityType3Config?(e=Activity.ins(),i=GlobalConfig.ActivityType3Config[this.actId][this.index],n=e.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=PActivity.ins(),i=GlobalConfig.PActivity3Config[this.actId][this.index],n=e.getActivityDataById(this.actId)),t.target){case this.get:if(this.isGet)e.sendReward(this.actId,this.index);else{var s=0;switch(i.showType){case Show3Type.TYPE6:n.chongzhiTotal<i.val&&(s=i.val-n.chongzhiTotal)}if(!s)return void Activity.ins().sendReward(this.actId,this.index);i.showType==Show3Type.TYPE6&&n.chongzhiTotal<i.val&&TipsCT.ins().showTips("未完成累计充值")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins().getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins().getActivityDataById(e.Id)),this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.target.text="累计充值"+e.val+"元宝";var n=65280;i.chongzhiTotal<e.val&&(n=16711680),this.recharge.textFlow=TextFlowMaker.generateTextFlow1("(|C:"+n+"&T:"+i.chongzhiTotal+"|C:65280&T:/"+e.val+")");var s=i.getRewardStateById(e.index);switch(s){case Activity.NotReached:this.get.label="未完成",this.get.enabled=this.isGet=this.redPoint.visible=!1;break;case Activity.CanGet:this.get.label="领取",this.get.enabled=this.isGet=this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=this.get.visible=this.redPoint.visible=!1,this.already.visible=!this.isGet}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender6QM.prototype,"OSATarget3ItemRender6QM"),window.OSATarget3ItemRender6QM=OSATarget3ItemRender6QM;var OSATarget3ItemRender7=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.rewardList.itemRenderer=ItemBase,this.isGet=!0},e.prototype.onClick=function(t){switch(t.target){case this.get0:if(this.isGet)this.data instanceof ActivityType3Config?Activity.ins().sendReward(this.actId,this.index):this.data instanceof PActivity3Config&&PActivity.ins().sendReward(this.actId,this.index);else{var e=void 0,i=void 0,n=void 0;this.data instanceof ActivityType3Config?(e=GlobalConfig.ActivityType3Config[this.actId][this.index],n=Activity.ins(),i=n.getActivityDataById(this.actId)):this.data instanceof PActivity3Config&&(e=GlobalConfig.PActivity3Config[this.actId][this.index],n=PActivity.ins(),i=n.getActivityDataById(this.actId));var s=0;switch(e.showType){case Show3Type.TYPE7:i.dabiao[this.index-1]<e.day&&(s=e.day-i.dabiao[this.index-1])}if(!s)return void n.sendReward(this.actId,this.index);e.showType==Show3Type.TYPE7&&i.dabiao[this.index-1]<e.day&&TipsCT.ins().showTips("累计充值"+ +s+"天之后即可领取奖励")}}},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i,n;this.data instanceof ActivityType3Config?(e=this.data,i=Activity.ins(),n=i.getActivityDataById(e.Id)):this.data instanceof PActivity3Config&&(e=this.data,i=PActivity.ins(),n=i.getActivityDataById(e.Id)),this.num.text=e.day+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.rewards);var s=n.getRewardStateById(e.index);switch(this.get0.visible=!0,this.already.visible=!1,s){case Activity.NotReached:this.get0.label="未完成",this.get0.currentState="disabled",this.isGet=!1,this.redPoint.visible=!1;break;case Activity.CanGet:this.get0.label="领取",this.get0.currentState="up",this.isGet=!0,this.redPoint.visible=!0;break;case Activity.Geted:this.isGet=!1,this.redPoint.visible=!1,this.get0.visible=!1,this.already.visible=!0}this.actId=e.Id,this.index=e.index},e}(BaseItemRender);__reflect(OSATarget3ItemRender7.prototype,"OSATarget3ItemRender7"),window.OSATarget3ItemRender7=OSATarget3ItemRender7;var OSATarget3Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postChangePage,this.updateData),this.observe(PActivity.ins().postRewardResult,this.updateData),this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&this.cruPanel.close&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.initPanelList(),this.addChild(this.cruPanel),this.cruPanel.open&&this.cruPanel.open())},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cruPanel&&this.cruPanel.close&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t,i="",n=this.activityID;this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityType3Config[n]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivity3Config[n]);for(var s in t)if(e.targetIndex[t[s].showType]){i=e.targetIndex[t[s].showType];break}if(i){var o=egret.getDefinitionByName(i);this.cruPanel=new o(n),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=n,this.cruPanel.activityType=this.activityType}},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData()},e.targetIndex={1:"OSATarget3Panel3",2:"OSATarget3Panel2",3:"OSATarget3Panel4",4:"DailyRechargePanel",5:"OSATarget3Panel5",6:"OSATarget3Panel6",7:"OSATarget3Panel7",8:"OSATarget3Panel8",9:"OSATarget3Panel9",10:"OSATarget3Panel10",11:"OSATarget3Panel11",12:"OSATarget3Panel12",13:"OSATarget3Panel13"},e}(ActivityPanel);__reflect(OSATarget3Panel.prototype,"OSATarget3Panel"),window.OSATarget3Panel=OSATarget3Panel;var OSATarget3Panel1=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._index=1,e._time=0,e.skinName="OSASeriesRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),Timer.start(1e3,0,this.setTime,this),this.initData()},e.prototype.initData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getCurIndex();this._index=e;var i=GlobalConfig.ActivityType3Config[this.activityID][e];if(this.reward.dataProvider=new eui.ArrayCollection(i.rewards),this.redPoint.visible=!1,this.state.visible=!0,(t.dabiao[e-1]||0)>=i.day){var n=t.recrod>>e&1;
0==n?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this.state.visible=!1,this._state=2),this.state.textColor=65280}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this.state.textColor=16750848,this._state=0;this.state.text="当前进度"+(t.dabiao[e-1]||0)+"/"+i.day,this.updateTime()},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3);var i=GlobalConfig.ActivityConfig[this.activityID];this.actDesc.text=i.desc},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(){1==this._state&&Activity.ins().sendReward(this.activityID,this._index)},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel1.prototype,"OSATarget3Panel1"),window.OSATarget3Panel1=OSATarget3Panel1;var OSATarget3Panel10=function(t){function e(){var e=t.call(this)||this;return e.selectRes=["sd_projecttitle2","sd_projecttitle1"],e.pageRedPoint=[!1,!1,!1],e}return __extends(e,t),e.prototype.initSkin=function(){this.activityType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfg=GlobalConfig.ActivityType3Config[this.activityID],this.config=GlobalConfig.ActivityConfig[this.activityID]):(this.ins=PActivity.ins(),this.cfg=GlobalConfig.PActivity3Config[this.activityID],this.config=GlobalConfig.PActivityConfig[this.activityID]),this.config.pageSkin?this.skinName=this.config.pageSkin:this.skinName="KMHRechargeSkin"},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.initSkin(),this.observe(this.ins.postRewardResult,this.updateDataCall),this.observe(this.ins.postChangePage,this.updateDataCall);for(var i=0;3>i;i++)this["projectbg"+i].name=i.toString(),this.addTouchEvent(this["projectbg"+i],this.onTap);this.rechargeitem.itemRenderer=KaiMenItem,this.rechargeitemData=new eui.ArrayCollection,this.rechargeitem.dataProvider=this.rechargeitemData,this.initData(),Timer.start(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){var t=this.ins.getActivityDataById(this.activityID);if(t){var e=t.getLeftTime();this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)}},e.prototype.updatePageRedPoint=function(t){for(var e=0;e<t.length;e++)if(t[e].redPoint)return!0;return!1},e.prototype.updateList=function(t){var e=GlobalConfig.ActivityType3Config[t];this.activityType!=ActivityType.Normal&&(e=GlobalConfig.PActivity3Config[t]);var i=this.ins.getActivityDataById(t),n=[];for(var s in e){var o=new KaiMenData;if(o.id=e[s].Id,o.actType=this.activityType,o.index=e[s].index,o.type=e[s].type,o.day=e[s].day,o.reward=e[s].rewards,o.already=i.recrod>>e[s].index&1?!0:!1,3==o.type)o.unready=i.isOverTimer(e[s].index),i.curOpenDay()+1==e[s].day?o.redPoint=i.chongzhiNum>=e[s].val?!0:!1:o.redPoint=!1;else if(1==o.type&&(o.unready=i.dabiao[e[s].index-1]<e[s].day,o.redPoint=!o.already&&!o.unready,i.curOpenDay()+1==e[s].day)){var a=this.actIds.indexOf(t);this["price"+a].text="充值"+e[s].val/GlobalConfig.ClientGlobalConfig.rate+"元"}o.unready?o.already=o.redPoint=!1:o.redPoint=o.already?!1:o.redPoint,n.push(o)}return n},e.prototype.onTap=function(t){for(var e=0;3>e;e++)if(this["projectbg"+e].source=this.selectRes[0],t.currentTarget==this["projectbg"+e]){this.actIndex=e,this["projectbg"+e].source=this.selectRes[1];var i=this.actIds[this.actIndex],n=this.updateList(i);this.rechargeitemData.replaceAll(n)}},e.prototype.initData=function(){if(this.actDesc.text=this.config.desc,this.actIds=[],this.actIds.push(this.activityID),this.cfg[1]&&this.cfg[1].activityID){for(var t=1;t<=this.cfg[1].activityID.length;t++)this.actIds.push(this.cfg[1].activityID[t-1]);this.actIndex=this.getRuleIndex(),this.updateTime(),this.updateData1();var e=GlobalConfig.ActivityBtnConfig[this.activityID];this.activityType!=ActivityType.Normal&&(e=GlobalConfig.PActivityBtnConfig[this.activityID]),e&&(this.title.source=e.title)}},e.prototype.getRuleIndex=function(){var t=0;return t},e.prototype.updateDataCall=function(t){-1!=this.actIds.indexOf(t)&&this.updateData1()},e.prototype.updateData1=function(){for(var t=0;3>t;t++)this["projectbg"+t].source=this.selectRes[0];this["projectbg"+this.actIndex].source=this.selectRes[1];for(var t=0;t<this.actIds.length;t++){var e=this.actIds[t],i=this.updateList(e);this["redpoint"+t].visible=this.updatePageRedPoint(i),t==this.actIndex&&this.rechargeitemData.replaceAll(i)}var n=this.ins.getActivityDataById(this.actIds[this.actIndex]);this.rechargeCoumt.text="今日已充值"+Math.floor(n.chongzhiNum/100)+"元"},e.prototype.updateData=function(){},e}(BaseView);__reflect(OSATarget3Panel10.prototype,"OSATarget3Panel10"),window.OSATarget3Panel10=OSATarget3Panel10;var OSATarget3Panel11=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin()},e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="RechargeContinuitySkin"},e.prototype.open=function(){this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.listData=new eui.ArrayCollection,this.content0.itemRenderer=OSATarget3ItemRender11,this.content0.dataProvider=this.listData,this.bigReward.itemRenderer=ItemBase,Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e;if(this.actType==ActivityType.Normal?e=Activity.ins():this.actType==ActivityType.Personal&&(e=PActivity.ins()),!e.isSuccee)if(BagCT.ins().getSurplusCount()){TipsCT.ins().showTips("领取失败");var i=void 0;this.actType==ActivityType.Normal?i=e.getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(i=e.getActivityDataById(this.activityID)),e.sendChangePage(i.id)}else TipsCT.ins().showTips("背包已满");e.isSuccee=!1,this.updateData()}},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.updateTime(),this.updateList()},e.prototype.updateList=function(){var t,e,i;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID],i=Activity.ins().getbtnInfo(this.activityID.toString())):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID],i=PActivity.ins().getbtnInfo(this.activityID.toString()));var n=CommonUtils.getObjectLength(e);this.target1.text=n+"";var s=[];for(var o in e)s.push(e[o]);s=s.slice();for(var a=[],r=[],l=0;l<s.length;l++){var h=t.getRewardStateById(s[l].index);h==Activity.Geted?r.push(s[l]):a.push(s[l])}if(a.sort(this.sortFunc),r.sort(this.sortFunc),s=a.concat(r),this.listData.replaceAll(s),this.title.source=i.title,this.bigReward.dataProvider=new eui.ArrayCollection(e[n].rewards),this.process){var u=t.getCurIndex();this.process.text="（"+t.dabiao[u-1]+"/"+n+"）"}this.today&&(this.today.text="今天充值"+t.chongzhiNum+"元宝")},e.prototype.sortFunc=function(t,e){return Algorithm.sortAsc(t.index,e.index)},e}(BaseView);__reflect(OSATarget3Panel11.prototype,"OSATarget3Panel11"),window.OSATarget3Panel11=OSATarget3Panel11;var OSATarget3Panel12=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.oldSelect=0,e}return __extends(e,t),e.prototype.setCurSkin=function(){this.actType==ActivityType.Normal?(this.actCfg=GlobalConfig.ActivityConfig[this.activityID],this.type3Cfg=GlobalConfig.ActivityType3Config[this.activityID]):(this.actCfg=GlobalConfig.PActivityConfig[this.activityID],this.type3Cfg=GlobalConfig.PActivity3Config[this.activityID]),this.actCfg.pageSkin?this.skinName=this.actCfg.pageSkin:this.skinName="OSASeriesRecharge2Skin",this.eList.itemRenderer=OSATarget3ItemRender,this.reward.itemRenderer=ItemBase},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin()},e.prototype.open=function(){this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.eList,this.onChange),this.update()},e.prototype.updateData=function(){this.update()},e.prototype.onClick=function(t){switch(t.target){case this.getBtn:this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this.eList.selectedIndex+1):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this.eList.selectedIndex+1)}},e.prototype.update=function(){this.actType==ActivityType.Normal?this.actData=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(this.actData=PActivity.ins().getActivityDataById(this.activityID));var t=-1,e=-1,i=-1;for(var n in this.type3Cfg)-1==t&&0==this.actData.canRewardById(this.type3Cfg[n].index)?t=this.type3Cfg[n].index-1:-1==e&&1==this.actData.canRewardById(this.type3Cfg[n].index)&&(e=this.type3Cfg[n].index-1),i=Math.max(i,this.type3Cfg[n].index-1);this.eList.selectedIndex=-1==e?-1>=t?i:t:e,this.updateList(),this.updateView()},e.prototype.onChange=function(){this.eList.getElementAt(this.eList.selectedIndex).setSelect(!0),this.eList.getElementAt(this.oldSelect)&&this.eList.getElementAt(this.oldSelect).setSelect(!1),this.oldSelect=this.eList.selectedIndex,this.updateView()},e.prototype.updateView=function(){var t=this.type3Cfg[this.eList.selectedIndex+1];switch(this.show.source=t.image||"",this.getBtn.visible=!0,this.redPoint.visible=!1,this.actData.canRewardById(t.index)){case 0:this.getBtn.label="未完成",this.getBtn.enabled=!1;break;case 1:this.getBtn.label="领取",this.getBtn.enabled=!0,this.redPoint.visible=!0;break;case 2:this.getBtn.visible=!1}this.already.visible=!this.getBtn.visible,this.actDesc.text=this.actCfg.desc,this.actTime.text=DateUtils.getFormatBySecond(this.actData.getLeftTime(),DateUtils.TIME_FORMAT_5,3),this.reward.dataProvider=new eui.ArrayCollection(t.rewards)},e.prototype.updateList=function(){this.eList.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(this.type3Cfg))},e.prototype.close=function(){},e}(BaseView);__reflect(OSATarget3Panel12.prototype,"OSATarget3Panel12"),window.OSATarget3Panel12=OSATarget3Panel12;var OSATarget3Panel2=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._index=1,e._time=0,e.skinName="OSATotalRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),Timer.start(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.rechargeBar||(this.rechargeBar=new ProgressBarEff,this.rechargeBar.setWidth(520),this.rechargeBar.x=-272,this.rechargeBar.y=0,this.process.addChild(this.rechargeBar));var t,e,i;if(this.actType==ActivityType.Normal?(e=Activity.ins().getActivityDataById(this.activityID),i=e.getCurIndex(),t=GlobalConfig.ActivityType3Config[this.activityID][i]):this.actType==ActivityType.Personal&&(e=PActivity.ins().getActivityDataById(this.activityID),i=e.getCurIndex(),t=GlobalConfig.PActivity3Config[this.activityID][i]),this._index=i,this.reward.dataProvider=new eui.ArrayCollection(t.rewards),this.redPoint.visible=!1,this.state.visible=!0,e.chongzhiTotal>=t.val){var n=e.recrod>>i&1;0==n?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this.state.visible=!1,this._state=2),this.state.textColor=65280}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this.state.textColor=16750848,this._state=0;this.state.text="已充值"+e.chongzhiTotal+"/"+t.val+"元宝",this.rechargeBar.setData(e.chongzhiTotal,t.val),this.rechargeBar.setLbValueText(""),this.updateTime()},e.prototype.updateTime=function(){var t,e;if(this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]),t){var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(){if(1==this._state){if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void TipsCT.ins().showTips("背包剩余空位不足，请先清理");this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index)}},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel2.prototype,"OSATarget3Panel2"),window.OSATarget3Panel2=OSATarget3Panel2;var OSATarget3Panel3=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t;t=this.actType==ActivityType.Normal?GlobalConfig.ActivityConfig[this.activityID]:GlobalConfig.PActivityConfig[this.activityID],t.pageSkin?this.skinName=t.pageSkin:this.skinName="OSASeriesRechargeSkin"},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin(),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.gift0,this.onTap),this.addTouchEvent(this.gift1,this.onTap),this.addTouchEvent(this.gift2,this.onTap),Timer.start(1e3,0,this.setTime,this),this.initData()},e.prototype.initData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);var i=-1,n=Object.keys(e);for(var s in e){var o=e[s],a=+s;(t.dabiao[a-1]||0)<o.day?-1==i&&(i=n.length):0==(t.recrod>>a&1)&&(t.dabiao[a-1]||0)>=o.day&&(i=a),this["gift"+(a-1)].setData(this.activityID,a)}var r=Object.keys(e),l=+r[r.length-1];this.bar.maximum=e[l].day,this.bar.value=t.dabiao[l-1],-1==i&&(i=t.getCurIndex()),this.setSelectIndex(i),this.updateTime()},e.prototype.setSelectIndex=function(t){this._index=t;var e,i;if(this.actType==ActivityType.Normal?(e=GlobalConfig.ActivityType3Config[this.activityID][t],i=Activity.ins().getActivityDataById(this.activityID)):this.actType==ActivityType.Personal&&(e=GlobalConfig.PActivity3Config[this.activityID][t],i=PActivity.ins().getActivityDataById(this.activityID)),this.reward.dataProvider=new eui.ArrayCollection(e.rewards),this.redPoint.visible=!1,(i.dabiao[t-1]||0)>=e.day){var n=i.recrod>>t&1;0==n?(this.getBtn.label="领取",this.getBtn.visible=!0,this.getBtn.enabled=!0,this.already.visible=!1,this.redPoint.visible=!0,this._state=1):(this.getBtn.label="已领取",this.getBtn.visible=!1,this.already.visible=!0,this._state=2)}else this.getBtn.label="未完成",this.getBtn.visible=!0,this.getBtn.enabled=!1,this.already.visible=!1,this._state=0;var s=GlobalConfig.ActivityType3Config[this.activityID][t];this.show.source=s.image,1==t?(this.gift0.setSelect(!0),this.gift1.setSelect(!1),this.gift2.setSelect(!1)):2==t?(this.gift0.setSelect(!1),this.gift1.setSelect(!0),this.gift2.setSelect(!1)):(this.gift0.setSelect(!1),this.gift1.setSelect(!1),this.gift2.setSelect(!0))},e.prototype.updateTime=function(){var t,e;if(this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]),t){var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.getBtn?1==this._state&&(this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index)):e==this.gift0?this.setSelectIndex(1):e==this.gift1?this.setSelectIndex(2):e==this.gift2&&this.setSelectIndex(3)},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel3.prototype,"OSATarget3Panel3"),window.OSATarget3Panel3=OSATarget3Panel3;var OSATarget3Panel4=function(t){function e(){var e=t.call(this)||this;return e.skinName="SecondRechargeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.get0,this.onTap),this.addTouchEvent(this.get1,this.onTap),Timer.start(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.setIndex(0),this.setIndex(1),this.updateTime()},e.prototype.setIndex=function(t){var e,i,n,s;this.actType==ActivityType.Normal?n=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(n=PActivity.ins().getActivityDataById(this.activityID)),0==t?(this._index=e=1,i=n.chongzhiTotal):(e=2,i=n.chongzhiTotal),this.actType==ActivityType.Normal?s=GlobalConfig.ActivityType3Config[this.activityID][e]:this.actType==ActivityType.Personal&&(s=GlobalConfig.ActivityType3Config[this.activityID][e]),this["reward"+t].dataProvider=new eui.ArrayCollection(s.rewards),this["redPoint"+t].visible=!1;var o=this["already"+t],a=this["get"+t],r=this["record"+t];if(o.visible=!1,i>=s.val){var l=n.recrod>>e&1;0==l?(a.label="立即领取",a.visible=!0,a.enabled=!0,this["redPoint"+t].visible=!0):(a.label="已领取",a.visible=!1,o.visible=!0),r.textColor=65280}else a.label="未完成",a.visible=!0,a.enabled=!1,r.textColor=16750848;r.text="已充值"+i+"/"+s.val+"元宝",0==t?this.target0.text="7日累计充值"+s.val+"元宝可领取":this.target1.text="7日累计充值"+s.val+"元宝可领取"},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.get0?this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,1):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,1):e==this.get1&&(this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,2):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,2))},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel4.prototype,"OSATarget3Panel4"),window.OSATarget3Panel4=OSATarget3Panel4;var OSATarget3Panel5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="hefuSeriesRechargeSkin"},e.prototype.open=function(){this.setCurSkin(),this.addTouchEvent(this.getBtn0,this.onTap),this.addTouchEvent(this.getBtn1,this.onTap),Timer.start(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.initData()},e.prototype.initData=function(){this.setIndex(0),this.setIndex(1),this.updateTime()},e.prototype.setIndex=function(t){var e,i,n,s;this.actType==ActivityType.Normal?(n=Activity.ins().getActivityDataById(this.activityID),s=GlobalConfig.ActivityBtnConfig[this.activityID]):this.actType==ActivityType.Personal&&(n=PActivity.ins().getActivityDataById(this.activityID),s=GlobalConfig.PActivityBtnConfig[this.activityID]),s&&(this.title.source=s.title),0==t?(e=n.getCurIndex(3),this._index=e,i=n.chongzhiNum):(e=n.getCurIndex(2),i=n.chongzhiTotal);var o;this.actType==ActivityType.Normal?o=GlobalConfig.ActivityType3Config[this.activityID][e]:this.actType==ActivityType.Personal&&(o=GlobalConfig.PActivity3Config[this.activityID][e]),this["reward"+t].dataProvider=new eui.ArrayCollection(o.rewards),this["redPoint"+t].visible=!1;var a=this["already"+t],r=this["getBtn"+t];if(a.visible=!1,i>=o.val){var l=n.recrod>>e&1;0==l?(r.label="立即领取",r.visible=!0,r.enabled=!0,this["redPoint"+t].visible=!0):(r.label="已领取",r.visible=!1,a.visible=!0)}else r.label="未完成",r.visible=!0,r.enabled=!1;0==t||(this.state.text="累计充值:"+i+"/"+o.val+"元宝"),this.bar&&(this.bar.maximum=o.val,this.bar.value=i),158==this.activityID?this.addchong.source="l_biaoti_leichong800":212==this.activityID&&(this.addchong.source="l_biaoti_leichong800")},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.getBtn0)this.actType==ActivityType.Normal?Activity.ins().sendReward(this.activityID,this._index):this.actType==ActivityType.Personal&&PActivity.ins().sendReward(this.activityID,this._index);else if(e==this.getBtn1){var i=void 0;this.actType==ActivityType.Normal?(i=Activity.ins().getActivityDataById(this.activityID),Activity.ins().sendReward(this.activityID,i.getCurIndex(2))):this.actType==ActivityType.Personal&&(i=PActivity.ins().getActivityDataById(this.activityID),PActivity.ins().sendReward(this.activityID,i.getCurIndex(2)))}},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.initData()},e}(BaseView);__reflect(OSATarget3Panel5.prototype,"OSATarget3Panel5"),window.OSATarget3Panel5=OSATarget3Panel5;var OSATarget3Panel6=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t;t=this.actType==ActivityType.Normal?GlobalConfig.ActivityConfig[this.activityID]:GlobalConfig.PActivityConfig[this.activityID],t.pageSkin?this.skinName=t.pageSkin:this.skinName="hefuCostSkin"},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin(),this.listData=new eui.ArrayCollection;var e;e=this.actType==ActivityType.Normal?GlobalConfig.ActivityBtnConfig[this.activityID]:GlobalConfig.PActivityBtnConfig[this.activityID],this.content.itemRenderer=e.listItem?egret.getDefinitionByName(e.listItem):OSATarget3ItemRender6,this.content.dataProvider=this.listData},e.prototype.open=function(){Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.updateTime=function(){var t,e;if(this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]),t){var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.updateData=function(){this.updateTime(),this.updateList()},e.prototype.updateList=function(){var t,e,i;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID],i=Activity.ins().getbtnInfo(this.activityID.toString())):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID],i=PActivity.ins().getbtnInfo(this.activityID.toString()));var n=[];for(var s in e)n.push(e[s]);n=n.slice();for(var o=[],a=[],r=0;r<n.length;r++){var l=t.getRewardStateById(n[r].index);l==Activity.Geted?a.push(n[r]):o.push(n[r])}o.sort(this.sortFunc),a.sort(this.sortFunc),n=o.concat(a),this.listData.replaceAll(n),this.title.source=i.title},e.prototype.sortFunc=function(t,e){return Algorithm.sortAsc(t.val,e.val)},e}(BaseView);__reflect(OSATarget3Panel6.prototype,"OSATarget3Panel6"),window.OSATarget3Panel6=OSATarget3Panel6;var OSATarget3Panel7=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuSeriesRechargeSkin2",e}return __extends(e,t),e.prototype.open=function(){this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(PActivity.ins().postRewardResult,this.GetCallBack),this.listData=new eui.ArrayCollection,this.content0.itemRenderer=OSATarget3ItemRender7,this.content0.dataProvider=this.listData,Timer.start(1e3,0,this.setTime,this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.updateData()},e.prototype.GetCallBack=function(t){if(this.activityID==t){var e;if(this.actType==ActivityType.Normal?e=Activity.ins():this.actType==ActivityType.Personal&&(e=PActivity.ins()),!e.isSuccee)if(BagCT.ins().getSurplusCount()){TipsCT.ins().showTips("领取失败");var i=void 0;this.actType==ActivityType.Normal?i=e.getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(i=e.getActivityDataById(this.activityID)),e.sendChangePage(i.id)}else TipsCT.ins().showTips("背包已满");e.isSuccee=!1,this.updateData()}},e.prototype.updateTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivityConfig[this.activityID]);var i=t.getLeftTime();this._time=i,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3),this.actDesc.text=e.desc},e.prototype.setTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this._time=e,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3)}},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.updateData=function(){this.updateTime(),this.updateList()},e.prototype.updateList=function(){var t,e,i;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID],i=Activity.ins().getbtnInfo(this.activityID.toString())):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID],i=PActivity.ins().getbtnInfo(this.activityID.toString()));var n=[];for(var s in e)n.push(e[s]);n=n.slice();for(var o=[],a=[],r=0;r<n.length;r++){var l=t.getRewardStateById(n[r].index);l==Activity.Geted?a.push(n[r]):o.push(n[r])}o.sort(this.sortFunc),a.sort(this.sortFunc),n=o.concat(a),this.listData.replaceAll(n),this.title.source=i.title},e.prototype.sortFunc=function(t,e){return Algorithm.sortAsc(t.index,e.index)},e}(BaseView);__reflect(OSATarget3Panel7.prototype,"OSATarget3Panel7"),window.OSATarget3Panel7=OSATarget3Panel7;var OSATarget3Panel8=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e||0,i.initSkin(),i}return __extends(e,t),e.prototype.initSkin=function(){this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var t;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityConfig[this.activityID],this.skinName=t.pageSkin):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID],this.skinName=t.pageSkin)},e.prototype.open=function(){this.initSkin();for(var t=0;6>t;t++)this.addTouchEvent(this["reward"+t],this.onTap);this.addTouchEvent(this.rechargeBtn,this.onTap),this.observe(Activity.ins().postActivityIsGetAwards,this.showAward),this.observe(PActivity.ins().postActivityIsGetAwards,this.showAward),this.initData(),Timer.start(1e3,0,this.updateTime,this)
},e.prototype.initData=function(){var t;this.actType==ActivityType.Normal?(this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc,t=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc,t=GlobalConfig.PActivity3Config[this.activityID]);for(var e in t){var i=t[e];if(4==i.type){this.singleReward.data=i.rewards[0];break}}this.updateTime(),this.updateData()},e.prototype.updateTime=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this.activityID):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID)),t){var e=t.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){if(t.currentTarget==this.rechargeBtn){var e=Recharge.ins().getRechargeData(0);return void(e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win))}},e.prototype.showAward=function(){if(this._sendConf){var t=void 0;this.actType==ActivityType.Normal?t=Activity.ins().getActivityDataById(this._sendConf.Id):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this._sendConf.Id));var e=t.getRewardStateById(this._sendConf.index);e==Activity.Geted&&TipsCT.ins().showItemTips(this._sendConf.rewards[0].id)}},e.prototype.close=function(){Timer.stop(this.updateTime,this)},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType3Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins().getActivityDataById(this.activityID),e=GlobalConfig.PActivity3Config[this.activityID]);for(var i=0;5>i;i++)for(var n=e[i+1],s=e[i+2],o=Math.floor((t.chongzhiTotal-n.val)/(s.val-n.val)*5),a=0;5>a;a++){var r="sche"+i+"bell"+a;o>a?this[r].source="bell2":this[r].source="bell1"}for(var i=0;6>i;i++)this["reward"+i].data=e[i+1];this.numLbl.text=""+Math.floor(t.chongzhiTotal/100)},e}(BaseView);__reflect(OSATarget3Panel8.prototype,"OSATarget3Panel8"),window.OSATarget3Panel8=OSATarget3Panel8;var OSATarget3Panel9=function(t){function e(e){var i=t.call(this)||this;return i.activityID=e||0,i.initSkin(),i}return __extends(e,t),e.prototype.initSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];this.skinName=t.pageSkin},e.prototype.open=function(){this.initSkin();for(var t=GlobalConfig.ActivityType3Config[this.activityID],e=CommonUtils.getObjectLength(t),i=0;e>i;i++)this["targtet"+i]&&this.addTouchEvent(this["targtet"+i],this.onTap);this.addTouchEvent(this.rechargeBtn,this.onTap),this.observe(Activity.ins().postActivityIsGetAwards,this.showAward),this.reward.itemRenderer=ItemBase,this.initData(),Timer.start(1e3,0,this.updateTime,this)},e.prototype.initData=function(){this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc;for(var t in GlobalConfig.ActivityType3Config[this.activityID]){var e=GlobalConfig.ActivityType3Config[this.activityID][t];if(4==e.type){this.singleReward.data=e.rewards[0];break}}this.updateTime(),this.updateData2()},e.prototype.updateTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(t){var e=t.getLeftTime();this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){if(t.currentTarget==this.rechargeBtn){if(!this._sendConf)return;var e=Activity.ins().getActivityDataById(this._sendConf.Id),i=e.getRewardStateById(this._sendConf.index);return void(i==Activity.Geted?TipsCT.ins().showTips("已领取"):i==Activity.CanGet?Activity.ins().sendReward(this.activityID,this._sendConf.index):TipsCT.ins().showTips("未达成条件不足，请先获得锤子充值目标"))}},e.prototype.showAward=function(){if(this._sendConf){var t=Activity.ins().getActivityDataById(this._sendConf.Id),e=t.getRewardStateById(this._sendConf.index);e==Activity.Geted&&(this.showEff(this._sendConf),this.rechargeBtn.visible=!1,this.already.visible=!this.rechargeBtn.visible)}},e.prototype.close=function(){this.cleanEff(),Timer.stop(this.updateTime,this)},e.prototype.updateReward=function(t,e){var i=Activity.ins().getActivityDataById(this.activityID),n=GlobalConfig.ActivityType3Config[this.activityID][t];if(n&&i&&this["targtet"+(t-1)]){if(this["targtet"+(t-1)].data={curCost:i.chongzhiTotal,config:n},this["targtet"+(t-1)].setSelect(e?t==e:!1),this.currentCharge.textFlow=TextFlowMaker.generateTextFlow("|C:"+(i.chongzhiTotal?65280:13746831)+"&T:"+i.chongzhiTotal),this.rechargeBtn.visible=!0,this.bigEgg.source=n.expAttr[4],t==e){this._sendConf=n;var s=i.getRewardStateById(this._sendConf.index);this.redPoint.visible=!1,s==Activity.Geted?(this.rechargeBtn.visible=!1,this.bigEgg.source=n.expAttr[5]):s==Activity.CanGet&&(this.redPoint.visible=!0),this.reward.dataProvider=new eui.ArrayCollection(n.rewards)}this.already.visible=!this.rechargeBtn.visible}},e.prototype.updateData2=function(){var t=this.getRuleIndex();if(t)for(var e=(Activity.ins().getActivityDataById(this.activityID),GlobalConfig.ActivityType3Config[this.activityID]),i=CommonUtils.getObjectLength(e),n=0;i>n;n++)this.updateReward(n+1,t)},e.prototype.getRuleIndex=function(){var t=Activity.ins().getActivityDataById(this.activityID);if(!t)return 0;var e=GlobalConfig.ActivityType3Config[this.activityID],i=CommonUtils.getObjectLength(e),n=i;for(var s in e)if(!(e[s].index-1>=i)&&this["targtet"+(e[s].index-1)]){var o=t.getRewardStateById(e[s].index);if(o!=Activity.Geted){if(o==Activity.CanGet)return e[s].index;n>e[s].index&&(n=e[s].index)}}return n},e.prototype.cleanEff=function(){egret.Tween.removeTweens(this.hamer),egret.Tween.removeTweens(this.flower),DisplayUtils.removeFromParent(this.tonk),DisplayUtils.removeFromParent(this.boom)},e.prototype.showEff=function(t){var e=this;if(t){this.tonk||(this.tonk=new MovieClip),this.tonk.parent||this.hamer.addChild(this.tonk),this.boom||(this.boom=new MovieClip),this.boom.parent||this.flower.addChild(this.boom),egret.Tween.removeTweens(this.hamer),egret.Tween.removeTweens(this.flower);var i=this;this.tonk.playFile(RES_DIR_EFF+t.expAttr[2],1,function(){var n=egret.Tween.get(e.hamer);n.wait(200).call(function(){i.updateReward(t.index,t.index)}),i.boom.playFile(RES_DIR_EFF+t.expAttr[3],1,function(){egret.Tween.removeTweens(i.hamer),egret.Tween.removeTweens(i.flower),DisplayUtils.removeFromParent(i.tonk),DisplayUtils.removeFromParent(i.boom)})})}},e}(BaseView);__reflect(OSATarget3Panel9.prototype,"OSATarget3Panel9"),window.OSATarget3Panel9=OSATarget3Panel9;var OSATarget40JFStoreItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="JFStoreItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=Activity.ins().activityData[t.id];this.itemIcon.data=t.rewards[0],this.eName.text=GlobalConfig.ItemConfig[t.rewards[0].id].name,this.money.text=t.score+"",t.count>=0?(this.eNum.text=t.count-e.exchangeNums[t.index]+"/"+t.count,this.eNum.textColor=t.count-e.exchangeNums[t.index]==0?ColorUtil.RED:ColorUtil.GREEN,this.eGroup.visible=!0):this.eGroup.visible=!1}},e}(BaseItemRender);__reflect(OSATarget40JFStoreItem.prototype,"OSATarget40JFStoreItem"),window.OSATarget40JFStoreItem=OSATarget40JFStoreItem;var OSATarget40JFStoreWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="JFStoreSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=OSATarget40JFStoreItem,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update()},e.prototype.update=function(){this.data=Activity.ins().activityData[this.actId];var t=[],e=GlobalConfig.ActivityType40_1Config[this.actId];for(var i in e)e[i].score&&t.push(e[i]);this.eList.dataProvider=new eui.ArrayCollection(t),this.money.text=this.data.score+""},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof OSATarget40JFStoreItem){var e=t.target.parent.data,i=Activity.ins().activityData[e.id];return void(i.exchangeNums[e.index]>=e.count?TipsCT.ins().showTips("兑换次数不足"):i.score<e.score?TipsCT.ins().showTips("积分不足"):Activity.ins().sendReward(this.actId,0,3,e.index))}t.target==this.eCloseRect&&ViewManager.ins().close(this)},e.prototype.enterFrame=function(){this.data&&(this.eTime.text=this.data.getRemainTime())},e}(BaseEuiView);__reflect(OSATarget40JFStoreWin.prototype,"OSATarget40JFStoreWin"),window.OSATarget40JFStoreWin=OSATarget40JFStoreWin,ViewManager.ins().reg(OSATarget40JFStoreWin,LayerManager.UI_Main);var OSATarget40Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.activityID,n=GlobalConfig.ActivityType40Config[i];if(!this.cruPanel||this.cruPanel.activityID!=this.activityID){this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var s=n[1].showType?n[1].showType:1;this.cruPanel=ObjectPool.pop("OSATarget40Panel"+s),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)}this.cruPanel.open&&this.cruPanel.open()},e.prototype.close=function(){this.cruPanel&&this.cruPanel.close&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget40Panel.prototype,"OSATarget40Panel"),window.OSATarget40Panel=OSATarget40Panel;var OSATarget41Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAChaozhitouziitemSkin",e.eList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eName.visible=!1;var e="";switch(t.type){case 8:e="等级："+t.target;break;case 19:e="等级："+t.target+"转";break;case 100:e="登录"+t.target+"天"}this.eInfo.text=e,this.eList.dataProvider=new eui.ArrayCollection(t.reward);var i=TaskCT.ins().getInvestmentTask(t.id,t.index);if(this.eBtn.enabled=!1,this.eBtn.label="未完成",i)switch(this.redPoint.visible=1==i.status,i.status){case 0:this.eBtn.enabled=!1,this.eBtn.label="未完成";break;case 1:this.eBtn.enabled=!0,this.eBtn.label="领取";break;case 2:this.eBtn.enabled=!1,this.eBtn.label="已领取"}}},e}(BaseItemRender);__reflect(OSATarget41Item.prototype,"OSATarget41Item"),window.OSATarget41Item=OSATarget41Item;var OSATarget41Panel=function(t){function e(e){var i=t.call(this)||this;return i.skinName="OSADailyChaozhitouziSkin",i.listDP=new eui.ArrayCollection,i.dailyReward.itemRenderer=OSATarget41Item,i.dailyReward.dataProvider=i.listDP,i.activityID=e,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(TaskCT.ins().postInvestmentTaskData,this.update),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update(),this.show.source=GlobalConfig.ActivityType41Config[this.activityID].show},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.setTime(),this.updateView()},e.prototype.updateView=function(){var t=GlobalConfig.ActivityType41Config[this.activityID],e=CommonUtils.objectToArray(GlobalConfig.InvestmentTaskConfig[t.taskid]);this.listDP.replaceAll(e),this.eBtn.label=this.data.hasBuy?"已投资":"投资"+t.buyMoney/100*Recharge.getChannelMulti()+"元",this.eBtn.enabled=!this.data.hasBuy},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof OSATarget41Item){if(!this.data.hasBuy)return void TipsCT.ins().showTips("进行投资后可领取，领取失败");var e=t.target.parent.parent.data;return void TaskCT.ins().sendInvestmentTaskData(e.id,e.index)}switch(t.target){case this.eBtn:var e=GlobalConfig.ActivityType41Config[this.activityID],i=e.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(e.buyMoney,ShowRechargeType.Type_TOUZI41):Recharge.ins().sendPayOrder(i)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.setTime=function(){this.data&&(this.eTime.text=this.data.hasBuy?"":this.data.getRemainTime())},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(OSATarget41Panel.prototype,"OSATarget41Panel"),window.OSATarget41Panel=OSATarget41Panel;var OSATarget41Panel1=function(t){function e(e){var i=t.call(this)||this;return i.centerX=202,i.centerY=181,i.radius=150,i.degree=0,i.skinName="OSADailyGaoertouziSkin",i.activityID=e,i.list0.itemRenderer=ItemBase,i.addTouchEvent(i,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(TaskCT.ins().postInvestmentTaskData,this.update),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.update(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this);var i=GlobalConfig.ActivityConfig[this.activityID];this.actInfo.text=i.desc},e.prototype.update=function(){this.data=Activity.ins().activityData[this.activityID],this.setTime(),this.updateView(),this.updateBtn()},e.prototype.enterFrameHandler=function(t){for(var e=1;8>e;e++){var i=egret.Point.polar(this.radius,(360*e/7+this.degree)*Math.PI/180);this["item"+e].x=this.centerX+i.x,this["item"+e].y=this.centerY+i.y}this.degree+=.3},e.prototype.updateView=function(){var t=GlobalConfig.ActivityType41Config[this.activityID],e=CommonUtils.objectToArray(GlobalConfig.InvestmentTaskConfig[t.taskid]),i=1;for(var n in e){var s=e[n].reward;for(var o in s)if(s[o].type>0){var a=RewardData.objectToRewardData(s[o]),r=TaskCT.ins().getInvestmentTask(t.taskid,e[n].index);a.isRedPoint=this.data.hasBuy&&r&&2==r.status?2:0,this["item"+i].data=a,i++}}var l=e[0].reward[0],h=new RewardData;h.type=l.type,h.id=l.id,h.count=this.getTotlaYuanBao(),this.item0.data=h},e.prototype.getTotlaYuanBao=function(){var t=GlobalConfig.ActivityType41Config[this.activityID],e=GlobalConfig.InvestmentTaskConfig[t.taskid],i=0;for(var n in e){var s=e[n];(!this.data.hasBuy||TaskCT.ins().getInvestmentTask(s.id,s.index).status<2)&&(i+=s.reward[0].count)}return i},e.prototype.updateBtn=function(){var t=GlobalConfig.ActivityType41Config[this.activityID],e=CommonUtils.objectToArray(GlobalConfig.InvestmentTaskConfig[t.taskid]);if(this.eBtn.enabled=!this.data.hasBuy,this.data.hasBuy){this.label1.visible=!0;var i=this.data.getCurDay(),n=this.data.getCanGetRewardId(),s=n>0?n:i,o=TaskCT.ins().getInvestmentTask(t.taskid,s),a=GlobalConfig.InvestmentTaskConfig[t.taskid][s],r=[];for(var l in a.reward){var h=RewardData.objectToRewardData(a.reward[l]);h.isRedPoint=2==o.status?2:0,r.push(h)}switch(this.list0.dataProvider=new eui.ArrayCollection(r),this.label1.text="第"+s+"天投资奖励",o.status){case 0:this.eBtn.enabled=!1;break;case 1:this.eBtn.enabled=!0,this.eBtn.label="领取奖励";break;case 2:this.eBtn.label=s<e.length?"明日可领":"已领取",this.eBtn.enabled=!1}}else this.label1.visible=!1,this.list0.dataProvider=new eui.ArrayCollection(e[0].reward),this.eBtn.label="投资"+t.buyMoney/100*Recharge.getChannelMulti()+"元";this.img.visible=!this.label1.visible},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:var e=GlobalConfig.ActivityType41Config[this.activityID];if(this.data.hasBuy){var i=this.data.getCanGetRewardId();i>0&&TaskCT.ins().sendInvestmentTaskData(e.taskid,i)}else{var n=e.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!n?Recharge.ins().showReCharge(e.buyMoney,ShowRechargeType.Type_TOUZI41,this.activityID+""):Recharge.ins().sendPayOrder(n)}break;case this.eBtn0:ViewManager.ins().open(InvestmentResultWin,this.activityID)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},e.prototype.setTime=function(){if(this.data){var t=GlobalConfig.ActivityType41Config[this.activityID],e=CommonUtils.objectToArray(GlobalConfig.InvestmentTaskConfig[t.taskid]),i=e.length;this.eTime.text=this.data.hasBuy?"剩余返还天数"+(i-this.data.getCurDay())+"天":"限时购买："+this.data.getRemainTime()}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(OSATarget41Panel1.prototype,"OSATarget41Panel1"),window.OSATarget41Panel1=OSATarget41Panel1;var OSATarget42ListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="NewDailytasksItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){var t=this.data[0],e=this.data[1];this.pName.textFlow=TextFlowMaker.generateTextFlow(t.name),this.list.dataProvider=new eui.ArrayCollection(t.reward);var i=e.getAchieveInfo(t.index);switch(this.scedule.text=(i?i.times:0)+"/"+t.target,this.eRp.visible=this.eGetImg.visible=!1,e.getStatus(t.index)){case 0:break;case 1:this.eRp.visible=!0;break;case 2:this.eGetImg.visible=!0}this.scedule.visible=this.actBtn.visible=!this.eGetImg.visible,this.actBtn.enabled=this.eRp.visible||null!=t.turn,this.actBtn.label=!this.eRp.visible&&t.turn?"前  往":"领  取"}},e.prototype.onClick=function(){if(this.data){var t=this.data[0];if(this.eRp.visible){var e=this.data[1];e instanceof PActivityType42Data?PActivity.ins().sendReward(t.id,t.index):Activity.ins().sendReward(t.id,t.index)}else t.turn&&ViewManager.ins().open(t.turn[0],t.turn[1],t.turn[2])}},e}(BaseItemRender);__reflect(OSATarget42ListItem.prototype,"OSATarget42ListItem"),window.OSATarget42ListItem=OSATarget42ListItem;var OSATarget42Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,n=this.activityID;if(this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType42Config[n]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivityType42Config[n]),!this.cruPanel||this.cruPanel.activityID!=this.activityID){this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var s=i[1].showType?i[1].showType:1;this.cruPanel=ObjectPool.pop("OSATarget42Panel"+s),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)}this.cruPanel.open()},e.prototype.close=function(){this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget42Panel.prototype,"OSATarget42Panel"),window.OSATarget42Panel=OSATarget42Panel;var OSATarget42TabItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="NewDailyBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){var t=this.data[0][0];if(t){var e=this.data[1];this.eRp.visible=e.groupCanReward(t.group),this.eBtn.label=t.gName}}},e}(BaseItemRender);__reflect(OSATarget42TabItem.prototype,"OSATarget42TabItem"),window.OSATarget42TabItem=OSATarget42TabItem;var OSATarget4Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel)),this.observe(Rank.ins().postRankingData,this.initInfo),this.initPanelList()},e.prototype.initInfo=function(t){this.openPanel(t)},e.prototype.openPanel=function(t){this.cruPanel.open&&this.cruPanel.open(t),this.addChild(this.cruPanel)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t=GlobalConfig.ActivityType4Config[this.activityID];if(!this.cruPanel||this.cruPanel.activityID!=this.activityID){var e=t[1].showType?t[1].showType:2;this.cruPanel=ObjectPool.pop("OSATarget4Panel"+e),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID}var i=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;i&&i!=RankDataType.TYPE_HF_XIAOFEI?Rank.ins().sendGetRankingData(i):this.openPanel()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget4Panel.prototype,"OSATarget4Panel"),window.OSATarget4Panel=OSATarget4Panel;var OSATarget4Panel2=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.skinName="OSARankSkin",e.titleEffNameMc||(e.titleEffNameMc=new MovieClip),e.titleEffNameMc.parent||e.titleEffGroup.addChild(e.titleEffNameMc),e.titleEffNameMc.x=e.titleEffGroup.x,e.titleEffNameMc.y=e.titleEffGroup.y,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward0.itemRenderer=ItemBase,this.reward1.itemRenderer=ItemBase,this.reward2.itemRenderer=ItemBase,this.reward3.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.seek,this.onTap),Timer.start(1e3,0,this.setTime,this),t&&(this.model=t[0]),this.observe(Activity.ins().postGetDaBiaoInfo,this.updateData);var i=GlobalConfig.ActivityType4Config[this.activityID][1];i&&i.rankType==RankDataType.TYPE_HF_XIAOFEI?Activity.ins().sendDabiaoInfo(this.activityID):this.updateData()},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(this.activityID);t&&(this._time=t.getLeftTime(),this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.seek,this.onTap),Timer.stopAll(this),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.seek:var e=GlobalConfig.ActivityType4Config[this.activityID][0].rankType,i=void 0,n=void 0;i=this.model?this.model.getDataList():Activity.ins().rankInfoList,n=Math.min(i.length,20);for(var s=[],o=Activity.ins().getActivityDataById(this.activityID),a={idx:1},r=0;n>r;r++){var l=i[r],h=o.getCostRank(l,a);s.push({rankData:i[r],activityID:this.activityID,rank:h})}ViewManager.ins().open(OSARankTipsWin,s,e)}},e.prototype.setMyRank=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=t.getMyRank();this.myAttrValue.text=e[0],this.myRanking.text=e[1]},e.prototype.updateData=function(){var t=GlobalConfig.ActivityType4Config[this.activityID][0].rankType;t==RankDataType.TYPE_HF_XIAOFEI?this.currentState="hefu":this.currentState="kaifu",this.validateNow();var e,i=GlobalConfig.ActivityConfig[this.activityID],n=GlobalConfig.ActivityType4Config[this.activityID];if(e=this.model?this.model.getDataList():Activity.ins().rankInfoList){var s=Activity.ins().getActivityDataById(this.activityID),o=Math.floor((DateUtils.formatMiniDateTime(s.startTime)-GameServer.serverTime)/1e3),a=Math.floor((DateUtils.formatMiniDateTime(s.endTime)-GameServer.serverTime)/1e3);o>=0?this.actTime.text="活动未开启":0>=a?this.actTime.text="活动已结束":(this._time=a,this._time<0&&(this._time=0),this.actTime.text=DateUtils.getFormatBySecond(a,DateUtils.TIME_FORMAT_5,3)),this.actDesc.text=i.desc,t==RankDataType.TYPE_HF_XIAOFEI?this.costRank(e,n):this.normalRank(e,n,t);var r=GlobalConfig.ActivityBtnConfig[this.activityID];if(r&&(this.title.source=r.title),this.attr.text=s.getAttrDesc(t),GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName){var l=GlobalConfig.ActivityType4Config[this.activityID][0].titleEffName;this.titleEffNameMc.playFile(RES_DIR_EFF+l,-1)}else this.titleName.source=RES_DIR_CHENGHAO+GlobalConfig.ActivityType4Config[this.activityID][0].titleName}},e.prototype.costRank=function(t,e){for(var i=0;4>i;i++){this["name"+i]&&(this["name"+i].visible=!1),this["name"+i+"1"]&&(this["name"+i+"1"].visible=!1);var n=i+1;2==i?n=4:3==i&&(n=6);var s=e[n];this["reward"+i].dataProvider=new eui.ArrayCollection(s.rewards),this["attrValue"+i]&&(this["attrValue"+i].visible=!0,this["attrValue"+i].text="要求："+s.value),this["desc"+i]&&(this["desc"+i].text="元宝：")}var o={idx:1},a=Activity.ins().getActivityDataById(this.activityID);for(var r in t){var l=t[r],h=a.getCostRank(l,o),u=e[h];if(h&&u&&!(h>5))if(1==h)l&&(this.name0.visible=!0,this.attrValue0.visible=this.name0.visible,this.model?(this.name0.text=l.player,this.attrValue0.text=l.value):(this.name0.text=l.name,this.attrValue0.text="消费："+l.numType));else{var p="";if(2==h)p="name1";else if(3==h)p="name11",this.attrValue1.visible=!1;else if(4==h)p="name2";else{if(5!=h)continue;p="name21",this.attrValue2.visible=!1}u=e[h];var c=this[p];c.visible=!0,this.model?c.text=l.player:c.text=l.name}}var d=e[6];this.reward3.dataProvider=new eui.ArrayCollection(d.rewards),this.model&&this.model.selfPos?(this.model.selfPos<=20?this.myRanking.text=this.model.selfPos+"":this.myRanking.text="20名以后",t[this.model.selfPos-1]?this.myAttrValue.text=t[this.model.selfPos-1].value:this.setMyRank()):this.setMyRank()},e.prototype.normalRank=function(t,e,i){var n="";switch(i){case RankDataType.TYPE_SCORE:n="评分：";break;case RankDataType.TYPE_BOOK:case RankDataType.TYPE_HEIRLOOM:case RankDataType.TYPE_SHENSHOU:n="战力：";break;case RankDataType.TYPE_WING:n="等阶：";break;case RankDataType.TYPE_SKIRMISH:n="排名：";break;case RankDataType.TYPE_HEARTMETHOD:n="星级：";break;default:n="等级："}for(var s=1;3>=s;s++){var o=t[s-1];o?(this["name"+(s-1)].visible=!0,this["attrValue"+(s-1)].visible=this["name"+(s-1)].visible,this.model?(this["name"+(s-1)].text=o.player,this["attrValue"+(s-1)].text=o.value):(this["name"+(s-1)].text=o.name,this["attrValue"+(s-1)].text="消费："+o.numType)):(this["name"+(s-1)].visible=!1,this["attrValue"+(s-1)].visible=this["name"+(s-1)].visible);var a=e[s];this["reward"+(s-1)].dataProvider=new eui.ArrayCollection(a.rewards),this["desc"+s]&&(this["desc"+s].text=n)}var r=e[4];this.reward3.dataProvider=new eui.ArrayCollection(r.rewards),this.model&&this.model.selfPos?(this.model.selfPos<=20?this.myRanking.text=this.model.selfPos+"":this.myRanking.text="20名以后",t[this.model.selfPos-1]?this.myAttrValue.text=t[this.model.selfPos-1].value:this.setMyRank()):this.setMyRank()},e}(BaseView);__reflect(OSATarget4Panel2.prototype,"OSATarget4Panel2"),window.OSATarget4Panel2=OSATarget4Panel2;var OSATarget5Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postActivityIsGetAwards,this.updateData),this.observe(Activity.ins().postChangePage,this.updateData),this.observe(Activity.ins().postRewardResult,this.updateData),this.observe(PActivity.ins().postActivityIsGetAwards,this.updateData),this.observe(PActivity.ins().postChangePage,this.updateData),this.observe(PActivity.ins().postRewardResult,this.updateData),this.initPanelList(),Activity.ins().sendRewardStatu(this.activityID),PActivity.ins().sendRewardStatu(this.activityID)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),this.cruPanel&&this.cruPanel.close()},e.prototype.initPanelList=function(){var t,i=this.activityID;if(this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityType5Config[i]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityType5Config[i]),!this.cruPanel||this.cruPanel.activityID!=i){this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var n=e.targetIndex[i]||"OSATarget5Panel"+t[1].showType,s=egret.getDefinitionByName(n);this.cruPanel=new s(this.activityID),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)}this.cruPanel.open()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e.targetIndex={157:"OSATarget5Panel1",210:"OSATarget5Panel2"},e}(ActivityPanel);__reflect(OSATarget5Panel.prototype,"OSATarget5Panel"),window.OSATarget5Panel=OSATarget5Panel;var SevenDayItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="act14item",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.LoginRewardsConfig[t],i=(Activity.ins().dayNum,1==(Activity.ins().isAwards>>e.day&1));i?(this.select.visible=!1,this.checkedMask.visible=this.checked.visible=!0):this.checkedMask.visible=this.checked.visible=!1,this.item.data=e.rewards[0]},e.prototype.setSelectImg=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(SevenDayItemRender.prototype,"SevenDayItemRender"),window.SevenDayItemRender=SevenDayItemRender;var OSATarget5Panel1=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.dayindex=1,e.itemList=[],e.skinName="hefuLogSkin",e.itemary=[],e}return __extends(e,t),e.prototype.initData=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0,this.itemList=[];for(var n=0;7>n;n++)this.itemList[n]=this["dayNum"+(n+1)],this.itemList[n].touchEnabled=!1,i[n+1]?(this["dayNum"+(n+1)]&&(this["dayNum"+(n+1)].visible=!0),this["imgDay"+(n+1)]&&(this["imgDay"+(n+1)].visible=!0),this["arrow"+(n+2)]&&(this["arrow"+(n+2)].visible=!0),this.maxNum++):(this["dayNum"+(n+1)]&&(this["dayNum"+(n+1)].visible=!1),this["imgDay"+(n+1)]&&(this["imgDay"+(n+1)].visible=!1),this["arrow"+(n+2)]&&(this["arrow"+(n+2)].visible=!1));this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch);for(var n=0;n<this.maxNum;n++)this.addTouchEvent(this.itemList[n],this.itemTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),Timer.start(1e3,0,this.setTime,this),this.updateData();var s=t[0];s&&this.setList(s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.removeObserve(),Timer.stopAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var n=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(n&&e>=n.day&&0==(this._activityData.recrod>>n.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):TipsCT.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var n=1;n=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+n,this.daylabel.visible=!0;var s=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,n>=this.day?s?(this.daylabel.visible=!1,this.suerBtn.visible=!1,this.redPoint.visible=!1):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=75,this.btnMC.y=27.5,this.btnMC.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1);
this.showRedPoint()},e.prototype.showRedPoint=function(){},e.prototype.updateData=function(){this.changeList(),this.showRedPoint(),this.setTime()},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget5Panel1.prototype,"OSATarget5Panel1");var ActivityHFRenderItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.activityID,e=Activity.ins().getActivityDataById(t),i=this.data,n=GlobalConfig.ActivityType5Config[t][i+""],s=(e.getCurDay(),1==(e.recrod>>n.day&1));s?(this.select.visible=!1,this.checkedMask.visible=this.checked.visible=!0):this.checkedMask.visible=this.checked.visible=!1,null!=this.bg&&(this.bg.visible=!this.checked.visible),this.item.data=n.rewards[0]},e.prototype.setSelectImg=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(ActivityHFRenderItem.prototype,"ActivityHFRenderItem"),window.ActivityHFRenderItem=ActivityHFRenderItem,window.OSATarget5Panel1=OSATarget5Panel1;var OSATarget5Panel2=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.dayindex=1,e.itemList=[],e.skinName="ganenLogSkin",e.itemary=[],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActivityType5Config[this.activityID];this.maxNum=0,this.itemList=[];for(var n=0;3>n;n++)this.itemList[n]=this["dayNum"+(n+1)],this.itemList[n].touchEnabled=!1,i[n+1]?(this["dayNum"+(n+1)]&&(this["dayNum"+(n+1)].visible=!0),this["imgDay"+(n+1)]&&(this["imgDay"+(n+1)].visible=!0),this["arrow"+(n+1)]&&(this["arrow"+(n+1)].visible=!0),this.maxNum++):(this["dayNum"+(n+1)]&&(this["dayNum"+(n+1)].visible=!1),this["imgDay"+(n+1)]&&(this["imgDay"+(n+1)].visible=!1),this["arrow"+(n+1)]&&(this["arrow"+(n+1)].visible=!1));this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch),this.addTouchEvent(this.group,this.onTouch);for(var n=0;n<this.maxNum;n++)this.addTouchEvent(this.itemList[n],this.itemTouch);this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),Timer.start(1e3,0,this.setTime,this),this.updateData();var s=t[0];s&&this.setList(s)},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.suerBtn,this.onTouch),this.removeTouchEvent(this.group,this.onTouch),DisplayUtils.removeFromParent(this.btnMC);for(var i=0;i<this.maxNum;i++)this.removeTouchEvent(this.itemList[i],this.itemTouch);this.removeObserve(),Timer.stopAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var n=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(n&&e>=n.day&&0==(this._activityData.recrod>>n.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.group:this.setList(this.group.getChildIndex(t.target));break;case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):TipsCT.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var n=1;n=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+n,this.daylabel.visible=!0;var s=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,n>=this.day?s?(this.daylabel.visible=!1,this.suerBtn.visible=!1,this.redPoint.visible=!1):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1);this.showRedPoint()},e.prototype.showRedPoint=function(){},e.prototype.updateData=function(){this.changeList(),this.showRedPoint(),this.setTime()},e}(BaseView);__reflect(OSATarget5Panel2.prototype,"OSATarget5Panel2"),window.OSATarget5Panel2=OSATarget5Panel2;var OSATarget5Panel3=function(t){function e(){var e=t.call(this)||this;return e.itemary=[],e.itemList=[],e.dayindex=1,e}return __extends(e,t),Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t=GlobalConfig.ActivityConfig[this.activityID];t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYLogSkin"},e.prototype.setItemList=function(){var t=GlobalConfig.ActivityType5Config[this.activityID];this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.itemList=[],this.maxNum=Object.keys(t).length;for(var e=0;e<this.maxNum;e++)this.itemList[e]=this["dayNum"+(e+1)],this.addTouchEvent(this.itemList[e],this.itemTouch),this.itemList[e].item.hideName()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.setItemList(),this._activityData=Activity.ins().getActivityDataById(this.activityID),this.addTouchEvent(this.suerBtn,this.onTouch),this.observe(Activity.ins().postActivityIsGetAwards,this.changeList),Timer.start(1e3,0,this.setTime,this),this.updateData();var i=t[0];i&&this.setList(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.btnMC),this.itemList.length=0,this.removeObserve(),Timer.stopAll(this)},e.prototype.changeList=function(){var t=1,e=this._activityData.getCurDay();e||(e=t),t=e>=this.maxNum?this.maxNum:e;for(var i=1;t>=i;i++){var n=GlobalConfig.ActivityType5Config[this.activityID][i+""];if(e>=n.day&&0==(this._activityData.recrod>>n.day&1))return void this.setList(i)}this.setList(t+1)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.suerBtn:this._activityData.getCurDay()>=this.day?Activity.ins().sendReward(this.activityID,this.day):TipsCT.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.itemTouch=function(t){this.setList(t.currentTarget.data)},e.prototype.setList=function(t){void 0===t&&(t=-1),-1==t&&(t=this.dayindex),t>this.maxNum&&(t=this.maxNum),this.dayindex=t;var e=GlobalConfig.ActivityType5Config[this.activityID][t+""],i=e.rewards;this.day=e.day;var n=1;n=this._activityData.getCurDay(),this.daylabel.text="登陆天数："+n;var s=1==(this._activityData.recrod>>this.day&1);this.dayaward.text="第"+TextFlowMaker.getCStr(t)+"天奖励详情",this.suerBtn.visible=!0,this.done.visible=!1,n>=this.day?s?(this.suerBtn.visible=!1,this.redPoint.visible=!1,this.done.visible=!0):(this.btnMC=this.btnMC||new MovieClip,this.btnMC.x=this.suerBtn.width/2,this.btnMC.y=this.suerBtn.height/2,this.btnMC.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.suerBtn.addChild(this.btnMC),this.redPoint.visible=!0):(DisplayUtils.removeFromParent(this.btnMC),this.suerBtn.visible=!1,this.redPoint.visible=!1),this.itemary.forEach(function(t){t.parent&&(t.parent.removeChild(t),t=null)}),this.itemary=[];for(var o=0;o<i.length;o++){var a=new ItemBase;this.group1.addChild(a),a.data=i[o],this.itemary.push(a)}this.itemList.length||this.setItemList();for(var o=0;o<this.maxNum;o++)this.itemList[o].activityID=this.activityID,this.itemList[o].data=o+1,o+1==t||o+1==this.maxNum&&t==this.maxNum?this.itemList[o].setSelectImg(!0):this.itemList[o].setSelectImg(!1)},e.prototype.updateData=function(){this.changeList(),this.setTime()},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime1.text="活动未开启":0>=e?this.actTime1.text="活动已结束":this.actTime1.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget5Panel3.prototype,"OSATarget5Panel3"),window.OSATarget5Panel3=OSATarget5Panel3;var OSATarget5Panel4=function(t){function e(e){var i=t.call(this)||this;return i.skinName="CDHuiGuiLogSkin",i.eRewardList.itemRenderer=ItemBase,i.eList.itemRenderer=OSATarget5Panel4Item,i.dataDP=new eui.ArrayCollection,i.eList.dataProvider=i.dataDP,i.eList.selectedIndex=0,i.activityID=e,i.addTouchEvent(i.suerBtn,i.onClick),i}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType5Config[this.activityID]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType5Config[this.activityID]),this.observe(this.ins.postActivityIsGetAwards,this.update),this.eList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.update(),this.updateUI(),this.setTime(),this.setSelectId(1)},e.prototype.onListChange=function(t){this.setSelectId(t.itemIndex+1)},e.prototype.onClick=function(t){this.ins.sendReward(this.activityID,this.curSelectDay)},e.prototype.update=function(){this.data=this.ins.activityData[this.activityID],this.updateList(),this.daylabel.text="累计登陆天数:"+this.data.getCurDay(),this.updateBtn()},e.prototype.setSelectId=function(t){this.curSelectDay!=t&&(this.curSelectDay=t,this.eRewardList.dataProvider=new eui.ArrayCollection(this.cfgs[t].rewards),this.zhanshi.source=this.cfgs[t].img||"",this.updateBtn())},e.prototype.updateBtn=function(){var t=this.data.getRewardState(this.curSelectDay);switch(t){case 1:this.suerBtn.visible=!0,this.suerBtn.enabled=!0;break;case 2:this.suerBtn.visible=!1;break;default:this.suerBtn.visible=!0,this.suerBtn.enabled=!1}this.done.visible=!this.suerBtn.visible},e.prototype.updateList=function(){var t=[];for(var e in this.cfgs)t.push([this.cfgs[e],this.data]);this.dataDP.replaceAll(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.updateUI=function(){this.actType==ActivityType.Normal?(this.title.source=GlobalConfig.ActivityBtnConfig[this.activityID].title,this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc):(this.title.source=GlobalConfig.PActivityBtnConfig[this.activityID].title,this.actInfo.text=GlobalConfig.PActivityConfig[this.activityID].desc)},e.prototype.setTime=function(){this.data&&(this.actTime.text=this.data.getRemainTime())},e}(BaseView);__reflect(OSATarget5Panel4.prototype,"OSATarget5Panel4"),window.OSATarget5Panel4=OSATarget5Panel4;var OSATarget5Panel4Item=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnTab13Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data[0],e=this.data[1];this.bg.source=t.tabImg;var i=e.getRewardState(t.day);this.stateImg.visible=2==i,this.eRp.visible=1==i}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.chosen.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(OSATarget5Panel4Item.prototype,"OSATarget5Panel4Item"),window.OSATarget5Panel4Item=OSATarget5Panel4Item;var OSATarget6Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSABoss",e.maxIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=this.getRule();this.updateData(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.goBtn,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack);for(var i=1;3>=i;i++)this.addTouchEvent(this["boss"+i],this.onClick);this.maxIndex=0;for(var n in GlobalConfig.ActivityType6Config[this.activityID])this.maxIndex++;var s=this.getRule();this.updateData(s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.rightBtn,this.onTap),this.removeTouchEvent(this.goBtn,this.onTap),this.removeObserve()},e.prototype.onClick=function(t){for(var e=1;3>=e;e++)if(t.currentTarget==this["boss"+e]){var i=this.calcIndex(this.index),n=GlobalConfig.ActivityType6Config[this.activityID][i];n&&n.bossID&&n.jump&&ViewManager.ins().open(n.jump[0][0],n.jump[0][1],n.bossID[e-1][0]);break}},e.prototype.onTap=function(t){var e,i;switch(t.currentTarget){case this.leftBtn:if(--this.index,i=this.calcIndex(this.index),!i)return;e=GlobalConfig.ActivityType6Config[this.activityID][i],(!e||this.index-1<=0)&&(this.index=1,this.leftBtn.visible=!1),this.rightBtn.visible=!0,this.updateData(this.index);break;case this.rightBtn:if(++this.index,i=this.calcIndex(this.index),!i)return;e=GlobalConfig.ActivityType6Config[this.activityID][i],(!e||this.index+1>this.maxIndex)&&(this.index=this.maxIndex,this.rightBtn.visible=!1),this.leftBtn.visible=!0,this.updateData(this.index);break;case this.goBtn:if(i=this.calcIndex(this.index),!i)return;"前往击杀"==this.goBtn.label?(ViewManager.ins().close(ActivityWin),e=GlobalConfig.ActivityType6Config[this.activityID][i],e&&e.bossID&&e.jump&&ViewManager.ins().open(e.jump[0][0],e.jump[0][1])):Activity.ins().sendReward(this.activityID,i)}},e.prototype.GetCallBack=function(t){if(this.activityID==t){if(!Activity.ins().isSuccee)if(BagCT.ins().getSurplusCount()){TipsCT.ins().showTips("领取失败");var e=Activity.ins().getActivityDataById(this.activityID);Activity.ins().sendChangePage(e.id)}else TipsCT.ins().showTips("背包已满");Activity.ins().isSuccee=!1;var i=this.getRule();this.updateData(i)}},e.prototype.sortRule=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.getRule=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=GlobalConfig.ActivityType6Config[this.activityID],i=0,n=0,s=!1,o=[];for(var a in e)o.push(e[a]);o.sort(this.sortRule);for(var r in o){var l=this.calcIndex(Number(r)),h=t.getBossGroupGiftIndex(o[r]),u=t.getBossGroup(t.rewardsBossSum[l],o[r]);if(h==Activity.Geted);else{if(u==Activity.KILL&&h==Activity.CanGet){(!i||o[r].sort<i)&&(i=o[r].sort,s=!0);break}if(u==Activity.NOKILL&&h==Activity.CanGet){(!n||o[r].sort<n)&&(n=o[r].sort);break}}if(s)break}var p=0;return p=i?i:n,p=p?p:o[0].sort},e.prototype.updateData=function(t){if(void 0===t&&(t=1),t>this.maxIndex)return void(this.index=this.maxIndex);this.index=t;var e=this.calcIndex(this.index);if(e){var i=Activity.ins().getActivityDataById(this.activityID),n=Math.floor((DateUtils.formatMiniDateTime(i.startTime)-GameServer.serverTime)/1e3),s=Math.floor((DateUtils.formatMiniDateTime(i.endTime)-GameServer.serverTime)/1e3);n>=0?this.actTime.text="活动未开启":0>=s?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_5,3),this.actInfo.text=GlobalConfig.ActivityConfig[this.activityID].desc;for(var o=SubRoles.ins().getSubRoleByIndex(0),a=GlobalConfig.ActivityType6Config[this.activityID][e],r=0,l=0;l<a.rewards.length&&this["item"+r];l++){var h=a.rewards[l];h.job&&o.job!=h.job||(this["item"+r].data={type:h.type,count:h.count,id:h.id},this["item"+r].visible=!0,r++)}for(var u=r;4>u;u++)this["item"+u].visible=!1;for(var p=a.bossID,l=0;3>l;l++)if(this["boss"+(l+1)]){var c=p[l][0],d=GlobalConfig.MonstersConfig[c];this["boss"+(l+1)].source="monhead"+d.head+"_png",this["monName"+l].text=d.name}var g=i.getBossGroupGiftIndex(a),f=i.getBossGroup(i.rewardsBossSum[e],a);this.redPoint.visible=!1,g==Activity.Geted?(this.successBtn.visible=!0,this.goBtn.visible=!1):f==Activity.KILL&&g==Activity.CanGet?(this.goBtn.visible=!0,this.successBtn.visible=!1,this.goBtn.label="领取",this.redPoint.visible=!0):f==Activity.NOKILL&&g==Activity.CanGet&&(this.goBtn.visible=!0,this.successBtn.visible=!1,this.goBtn.label="前往击杀"),this.leftBtn.visible=!0,this.rightBtn.visible=!0,1==this.index?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.index==this.maxIndex&&(this.rightBtn.visible=!1,this.leftBtn.visible=!0);for(var v=i.getBossGroupIndex(i.rewardsBossSum[e],a),l=0;l<v.length;l++)v[l]?this["state"+l].visible=!0:this["state"+l].visible=!1;this.actTitle.source=a.groupName,this.giftTitle.source=a.giftName}},e.prototype.calcSortId=function(t){for(var e in GlobalConfig.ActivityType6Config[this.activityID]){var i=GlobalConfig.ActivityType6Config[this.activityID][e];if(i.index==t)return i.sort}return 0},e.prototype.calcIndex=function(t){for(var e in GlobalConfig.ActivityType6Config[this.activityID]){var i=GlobalConfig.ActivityType6Config[this.activityID][e];if(i.sort==t)return i.index}return 0},e}(ActivityPanel);__reflect(OSATarget6Panel.prototype,"OSATarget6Panel"),window.OSATarget6Panel=OSATarget6Panel;var OSATarget8Panel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARingFbSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ActivityType8Data.open8Panel=!0,this.observe(Activity.ins().postChangePage,this.updateView),this.addTouchEvent(this.chanllage,this.onChanllage),this.addTouchEvent(this.showAward,this.onShowAward);var i=0;for(var n in GlobalConfig.ActivityType8Config){var s=GlobalConfig.ActivityType8Config[n][1];if(s.showType=ActivityType8Data.TYPE_RING){i=s.Id;break}}this.updateView()},e.prototype.updateView=function(){var t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType8Config[this.activityID][1];if(e.showType==ActivityType8Data.TYPE_RING){var i=Activity.ins().getCurrentRingAwardIndex(t.record),n=Activity.ins().getRingAward(i);if(n){this.currentState="normal",this.price.setPrice(n.ybCount),this.awardIndex=i,this.needYB=n.ybCount;var s=n.rewardsNum;this.starNum.text=SpecialRing.ins().getCanUpgradeStars(s).toString(),this.rewardsCount.text=s.toString(),this.setAwardData()}else{var o=Activity.ins().getLastRingAward();this.starNum.text=SpecialRing.ins().getCanUpgradeStars(o.rewardsNum).toString(),this.rewardsCount.text=o.rewardsNum.toString(),this.currentState="fullcount",this.price.visible=!1,this.chanllage.visible=!1,this.destStarNum.visible=!1,this.awardLv.visible=!1,this.des_lb.visible=!1}}this.actTime.text=t.getRemainTime()},e.prototype.setAwardData=function(){var t=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),e=SpecialRing.ins().getRingStair(t.level),i=SpecialRing.ins().getRingStar(t.level),n=0;n=0==e?10*e+i:10*e+i-10;var s=0,o=0,a=GlobalConfig.ActivityType1Config[200];this.eTipGroup.visible=!1;for(var r in a){var l=a[r];if(t.level<l.huoyanRingLv){this.eTipGroup.visible=!0;break}}for(var r in a){var l=a[r];if(s=l.index,o=l.huoyanRingLv-n>0?l.huoyanRingLv-n:0,l.huoyanRingLv>n)break}this.destStarNum.text=o+"",this.awardLv.text=s+"";for(var h,u=CommonUtils.objectToArray(GlobalConfig.ActorExRingFubenExConfig),r=0;r<u.length;r++)if(e<u[r].tejieLv){h=u[r];break}h&&(this.starNum1.text=11*(h.tejieLv-1)-t.level+"",this.awardLv0.text=h.id+"",this.starNum0.text=Math.floor(100*(h.rewardShow[0].count/GlobalConfig.ActorExRingFubenExConfig[1].rewardShow[0].count-1))+"")},e.prototype.onChanllage=function(){Actor.yb>=this.needYB?(Activity.ins().sendReward(this.activityID,this.awardIndex),Activity.ins().addEvent()):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onShowAward=function(){},e}(ActivityPanel);__reflect(OSATarget8Panel.prototype,"OSATarget8Panel"),window.OSATarget8Panel=OSATarget8Panel;var OSATarget9Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i;this.activityType==ActivityType.Normal?i=GlobalConfig.ActivityType9Config[this.activityID]:this.activityType==ActivityType.Personal&&(i=GlobalConfig.PActivityType9Config[this.activityID]),this.cruPanel&&this.cruPanel.activityID==this.activityID||(this.cruPanel&&(1==i[1].showType||3==i[1].showType||4==i[1].showType||(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel))),this.cruPanel=ObjectPool.pop("OSATarget9Panel"+i[1].showType),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)),this.cruPanel.open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget9Panel.prototype,"OSATarget9Panel"),window.OSATarget9Panel=OSATarget9Panel;var OSATarget9Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i,n;this.actType==ActivityType.Normal?(n=Activity.ins(),i=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(n=PActivity.ins(),i=PActivity.ins().activityData[this.activityID]),i&&1==i.indexs.length&&n.sendReward(this.activityID,1),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID);var i;this.actType==ActivityType.Normal?i=Activity.ins():this.actType==ActivityType.Personal&&(i=PActivity.ins()),this.observe(i.postChangePage,this.resultCallBack),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery);for(var n=0;3>n;n++)this.addTouchEvent(this["isget"+n],this.onGiftClick);this.list.itemRenderer=NoticeListRenderer,this.turnten.selected=!1,this.currentState="unReset",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.getkey:}},e.prototype.updateData=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType9Config[this.activityID][0]):this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID],e=GlobalConfig.PActivityType9Config[this.activityID][0]);var i=GlobalConfig.ItemConfig[e.item];if(i){this.icon.source=i.icon+"_png";var n=BagCT.ins().getBagItemById(i.id),s=0,o=1,a=13746831;n?(s=n.count,a=s>=o?ColorUtil.GREEN:ColorUtil.RED):a=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:"+s+"|C:0xD1C28F&T:/"+o),this.pay0.text=e.yb+""}var r;this.actType==ActivityType.Normal?r=GlobalConfig.ActivityType9Config:this.actType==ActivityType.Personal&&(r=GlobalConfig.PActivityType9Config);for(var l in r[this.activityID])if(+l){var h=r[this.activityID][l],n=this["item"+(+l-1)];n.itemIcon.data=h.reward[0],n.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Activity.ins().sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");var t,e;this.actType==ActivityType.Normal?(t=Activity.ins(),e=GlobalConfig.ActivityType9Config[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=GlobalConfig.PActivityType9Config[this.activityID]),this.turnten.selected?t.getIsRollTen(this.activityID)?t.sendReward(this.activityID,2):TipsCT.ins().showTips("元宝不足"):t.getRollSum(this.activityID)||Actor.yb>=e[0].yb?t.sendReward(this.activityID,1):TipsCT.ins().showTips("元宝不足")},e.prototype.onGiftClick=function(t){for(var e=0;3>e;e++)if(t.currentTarget==this["isget"+e]){var i=this["gift"+e].getItemIcon();this.flyItemEx(i),Activity.ins().sendReward(this.activityID,0,e+1);break}},e.prototype.updateProgress=function(){var t,e;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config[this.activityID],e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID],e=PActivity.ins().activityData[this.activityID]);var i=t[0];if(i&&e){this.turntime.text=e.count+"";for(var n=0;3>n;n++){if(this["turntime"+n].text=i.reward[n].times,this["gift"+n].data={id:i.reward[n].id,type:i.reward[n].type,count:i.reward[n].count},this["gift"+n].isShowName(!1),this["bar"+n].maximum=100,this["lingqu"+n].touchEnabled=!1,e.record>>n+1&1)this["bar"+n].value=100,this["lingqu"+n].visible=!0,this["isget"+n].touchEnabled=!1;else if(this["lingqu"+n].visible=!1,e.count>=i.reward[n].times)this["bar"+n].value=100,this["isget"+n].touchEnabled=!0;else{var s=i.reward[n-1],o=e.count,a=i.reward[n].times;s&&(o=e.count-s.times,a=i.reward[n].times-s.times),o=o>0?o:0,this["bar"+n].value=Math.floor(o/a*100),this["isget"+n].touchEnabled=!1}this.updateRedPoint(this.activityID,n)}}},e.prototype.updateRedPoint=function(t,e){var i;this.actType==ActivityType.Normal?i=Activity.ins():this.actType==ActivityType.Personal&&(i=PActivity.ins());var n=i.isGetRollReward(t,e);this["redPoint"+e].visible=n},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var n={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].itemId,actType:this.actType};e.push(n)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel1.prototype,"OSATarget9Panel1"),window.OSATarget9Panel1=OSATarget9Panel1;var OSATarget9Panel2=function(t){function e(){var e=t.call(this)||this;return e._curAwardPage=1,e._maxAwardPages=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.list.itemRenderer=ItemBase,this.list0.itemRenderer=NoticeListRenderer;for(var t,e,i=[],n=1;8>=n;n++)this.actType==ActivityType.Normal?t=GlobalConfig.ActivityType9Config[this.activityID][n]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID][n]),e=new RewardData,e.type=t.reward[0].type,e.id=t.reward[0].id,e.count=t.reward[0].count,i[n-1]=e;this.list.dataProvider=new eui.ArrayCollection(i)},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,isNaN(this.actType)&&(this.actType=ActivityPanel.getActivityTypeFromId(this._activityID)),this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="NYFireworkerSkin"},e.prototype.open=function(){this.setCurSkin(),this.init();var t;this.actType==ActivityType.Normal?(t=Activity.ins(),this.actInfo1.text=GlobalConfig.ActivityConfig[this.activityID].desc):this.actType==ActivityType.Personal&&(t=PActivity.ins(),this.actInfo1.text=GlobalConfig.PActivityConfig[this.activityID].desc),this.observe(t.postActivityIsGetAwards,this.updateData),this.observe(t.postChangePage,this.resultCallBack),this.addTouchEvent(this,this.onTouch),Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){this.removeObserve(),this.removeTouchEvent(this,this.onTouch),Timer.stopAll(this),DisplayUtils.removeFromParent(this._fireEff),this.turnten.selected=!1},e.prototype.onTouch=function(t){switch(t.target){case this.buyBtn:var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,this.config.item);if(e&&e.count)this.onSend();else{var i=this.turnten.selected?10:1,n=this.config.yb*i;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(10==i?"-10":"-1"),this.huntWarnFun.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[this.config.item].name+"*"+i)}break;case this.reward0:case this.reward1:case this.reward2:case this.reward3:var s=t.target.data;0==s.state?this.openEquipsTips(s.id,s.count):1==s.state&&(this.flyItemEx(t.target),this.ins.sendReward(this.activityID,0,s.index));break;case this.arrowleft:this._curAwardPage>1&&(this._curAwardPage--,this.updateAwardPage());break;case this.arrowright:this._curAwardPage<this._maxAwardPages&&(this._curAwardPage++,this.updateAwardPage())}},e.prototype.openEquipsTips=function(t,e){var i=GlobalConfig.ItemConfig[t];if(i)switch(ItemUtil.getType(i)){case ItemType.TYPE_0:case ItemType.TYPE_4:var n=ItemUtil.getSubType(i);n>=EquipPos.HAT&&n<=EquipPos.SHIELD?ViewManager.ins().open(SamsaraEquipTips,i.id):ViewManager.ins().open(EquipDetailedWin,1,null,i.id);break;default:ViewManager.ins().open(ItemDetailedWin,0,t,e)}},e.prototype.huntWarnFun=function(){var t=this.turnten.selected?10:1,e=this.config.yb*t;Actor.yb>=e?this.onSend():TipsCT.ins().showTips("元宝不足")},e.prototype.onSend=function(){this.turnten.selected?this.ins.sendReward(this.activityID,2):(this.ins.sendReward(this.activityID,1),this.ins.sendReward(this.activityID,1),this._fireEff||(this._fireEff=new MovieClip),this._fireEff.parent||(this.effLocation.addChild(this._fireEff),this._fireEff.scaleX=this.effLocation.scaleX,this._fireEff.scaleY=this.effLocation.scaleY),this._fireEff.playFile(RES_DIR_EFF+"FireWork",1))},e.prototype.setCurAwardPage=function(){var t,e;if(this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config[this.activityID][0],e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config[this.activityID][0],e=PActivity.ins().activityData[this.activityID]),this._maxAwardPages=t.reward.length/4,!e)return void(this._curAwardPage=1);
for(var i=t.reward.length,n=0;i>n;n++)if(!(e.record>>n+1&1))return void(this._curAwardPage=Math.floor(n/4)+1);this._curAwardPage=1},e.prototype.updateData=function(){var t,e;if(this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config=GlobalConfig.ActivityType9Config[this.activityID][0],t=Activity.ins().activityData[this.activityID],e=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config=GlobalConfig.PActivityType9Config[this.activityID][0],t=PActivity.ins().activityData[this.activityID],e=GlobalConfig.PActivityType9Config),this.price.setText(this.config.yb+""),this.price.setType(MoneyConst.yuanbao),this.setCurAwardPage(),this.updateAwardPage(),this._recordCollect||(this._recordCollect=new eui.ArrayCollection,this.list0.dataProvider=this._recordCollect),t){for(var i=[],n=t.noticeArr.length,s=void 0,o=0;n>o;o++)s={activityID:this.activityID,name:t.noticeArr[o].name,index:t.noticeArr[o].itemId,actType:this.actType},i.push(s);this._recordCollect.source=i}else this._recordCollect.source=null;this.setTime()},e.prototype.updateAwardPage=function(){var t,e;this.actType==ActivityType.Normal?(t=GlobalConfig.ActivityType9Config,e=Activity.ins().activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityType9Config,e=PActivity.ins().activityData[this.activityID]),this.arrowleft.visible=this._curAwardPage>1,this.arrowright.visible=this._curAwardPage<this._maxAwardPages;var i=t[this.activityID][0];if(this.redPointLeft.visible=this.redPointRight.visible=!1,e)for(var n=e.count,s=0,o=0,a=0,r=0,l=1;l<=this._maxAwardPages;l++)for(var h=0;4>h;h++)if(s=4*(l-1)+h,o=e.record>>s+1&1?2:n>=i.reward[s].times?1:0,l==this._curAwardPage)this["reward"+h].data={id:i.reward[s].id,type:i.reward[s].type,count:i.reward[s].count,index:s+1,state:o,times:i.reward[s].times,curTimes:n},h>0&&(a=this["reward"+h].data.times,n>=a?(this["bar"+(h-1)].maximum=100,this["bar"+(h-1)].value=100):(r=this["reward"+(h-1)].data.times,this["bar"+(h-1)].maximum=a-r,this["bar"+(h-1)].value=r>=n?0:n-r));else if(l<this._curAwardPage){if(1==o){this.redPointLeft.visible=!0;break}}else if(1==o){this.redPointRight.visible=!0;break}},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?(ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs),e.indexsEx=[]):e.indexsEx.length&&(ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexsEx),e.indexsEx=[]))},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.box.source);e.x=t.box.x,e.y=t.box.y,e.width=t.box.width,e.height=t.box.height,e.scaleX=t.box.scaleX,e.scaleY=t.box.scaleY,t.box.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=PActivity.ins().activityData[this.activityID]),this.actTime1.text=t.getRemainTime()},e}(BaseView);__reflect(OSATarget9Panel2.prototype,"OSATarget9Panel2"),window.OSATarget9Panel2=OSATarget9Panel2;var OSATarget9Panel3=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=PActivity.ins().activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.config9=GlobalConfig.ActivityType9Config,this.ins=Activity.ins()):this.actType==ActivityType.Personal&&(this.config9=GlobalConfig.PActivityType9Config,this.ins=PActivity.ins()),this.observe(this.ins.postChangePage,this.resultCallBack),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.menuList.itemRenderer=OSATarget9Panel3ItemRender,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.turnten.selected=!1,this.currentState="reset",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.currentTarget){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.updateBtn();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.updateBtn()}},e.prototype.updateData=function(){var t;this.actType==ActivityType.Normal?t=this.config9[this.activityID][0]:this.actType==ActivityType.Personal&&(t=this.config9[this.activityID][0]);var e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id),n=0,s=1,o=13746831;i?(n=i.count,o=n>=s?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+n+"|C:0xD1C28F&T:/"+s),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=Activity.ins().activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=PActivity.ins().activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0;var s;this.actType==ActivityType.Normal?s=Activity.ins():this.actType==ActivityType.Personal&&(s=PActivity.ins()),n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){s.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins());var e=this.config9[this.activityID][0];if(this.turnten.selected){var i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e.item);if(i&&i.count)t.sendReward(this.activityID,2);else{var n=10,s=e.yb*n;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+n)}}else{var i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,e.item);if(i&&i.count)t.sendReward(this.activityID,1);else{var n=1,s=1*e.yb;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),"是否消耗"+s+"元宝购买"+GlobalConfig.ItemConfig[e.item].name+"*"+n)}}},e.prototype.checkSend1=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins()),t.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb?t.sendReward(this.activityID,1):TipsCT.ins().showTips("元宝不足")},e.prototype.checkSend10=function(){var t;this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins()),t.getIsRollTen(this.activityID)?t.sendReward(this.activityID,2):TipsCT.ins().showTips("元宝不足")},e.prototype.updateProgress=function(){var t,e,i=this;this.actType==ActivityType.Normal?(e=Activity.ins(),t=e.activityData[this.activityID]):this.actType==ActivityType.Personal&&(e=PActivity.ins(),t=e.activityData[this.activityID]);var n=this.config9[this.activityID][0],s=[];if(n&&t){for(var o=0;o<n.reward.length;o++){var a={index:o,config:n,actType:this.actType};s.push(a)}this.menuListData.replaceAll(s)}this.menuList.validateNow(),egret.callLater(function(){for(var e=0,n=1;n<=i.menuListData.length;n++)if(0==t.getStateByIndex(n)){e=90*(n-1);break}e>i.menuList.contentWidth-i.menuList.width&&(e=i.menuList.contentWidth-i.menuList.width),i.menuList.scrollH=e,i.updateBtn()},this)},e.prototype.updateBtn=function(){this.menuListData.length<=5?this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=!1:this.onChange()},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=this.leftRed.visible=!1,this.rightBtn.visible=this.rightRed.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!1):(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){var t,e=this.config9[this.activityID][0];this.actType==ActivityType.Normal?t=Activity.ins():this.actType==ActivityType.Personal&&(t=PActivity.ins());for(var i=!1,n=0;n<e.reward.length&&!(i=t.isGetRollReward(this.activityID,n));n++);this.leftBtn.visible&&(this.leftRed.visible=i),this.rightBtn.visible&&(this.rightRed.visible=i)},e.prototype.listRefush=function(){var t,e;if(this.actType==ActivityType.Normal?(t=Activity.ins(),e=t.activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=t.activityData[this.activityID]),e){for(var i=[],n=0;n<e.noticeArr.length;n++){var s={activityID:this.activityID,name:e.noticeArr[n].name,index:e.noticeArr[n].itemId,actType:this.actType};i.push(s)}this.list.dataProvider=new eui.ArrayCollection(i)}},e.prototype.setTime=function(){var t,e;this.actType==ActivityType.Normal?(t=Activity.ins(),e=t.activityData[this.activityID]):this.actType==ActivityType.Personal&&(t=PActivity.ins(),e=t.activityData[this.activityID]),e&&(this.actTime.text="剩余时间："+e.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel3.prototype,"OSATarget9Panel3"),window.OSATarget9Panel3=OSATarget9Panel3;var OSATarget9Panel3ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="luckyTurntableItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.isget.addEventListener(egret.TouchEvent.TOUCH_END,this.onTap,this)},e.prototype.onTap=function(t){var e=this.gift.getItemIcon();this.flyItemEx(e),this.ins.sendReward(this.activityID,0,this.index+1)},e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data&&(this.data.config instanceof ActivityType9Config||this.data.config instanceof PActivity9Config)){this.actType=this.data.actType;var e=this.data.config;this.activityID=e.Id;var i,n=this.index=this.data.index;if(this.actType==ActivityType.Normal?(this.ins=Activity.ins(),i=this.ins.activityData[e.Id]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),i=this.ins.activityData[e.Id]),i){this.targetTime.text="/"+e.reward[n].times,this.gift.data={id:e.reward[n].id,type:e.reward[n].type,count:e.reward[n].count},this.gift.isShowName(!1),this.lingqu.touchEnabled=!1;var s=0,o=i.count>=e.reward[n].times?e.reward[n].times:i.count;if(i.record>>n+1&1)this.lingqu.visible=!0,this.isget.touchEnabled=!1,s=65280;else if(this.lingqu.visible=!1,i.count>=e.reward[n].times)this.isget.touchEnabled=!0,s=65280;else{var a=e.reward[n-1],r=i.count,l=e.reward[n].times;a&&(r=i.count-a.times,l=e.reward[n].times-a.times),r=r>0?r:0,this.isget.touchEnabled=!1,s=16711680}this.alreadyTime.textFlow=TextFlowMaker.generateTextFlow1("|C:"+s+"&T:"+o),this.updateRedPoint(this.activityID,n)}}},e.prototype.updateRedPoint=function(t,e){var i=this.ins.isGetRollReward(t,e);this.redPoint.visible=i},e.prototype.flyItemEx=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e}(BaseItemRender);__reflect(OSATarget9Panel3ItemRender.prototype,"OSATarget9Panel3ItemRender"),window.OSATarget9Panel3ItemRender=OSATarget9Panel3ItemRender;var OSATarget9Panel4=function(t){function e(){var e=t.call(this)||this;return e.huntType=1,e.skinName="luckyTurntableSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.menuScroller.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onChange,this),this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=this.ins.activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config),this.observe(this.ins.postChangePage,this.resultCallBack),this.addEvent(eui.UIEvent.CHANGE_END,this.menuScroller,this.onChange),this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.menuList.itemRenderer=OSATarget9Panel3ItemRender,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.turnten.selected=!1,this.currentState="resetWithKey",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.currentTarget){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i,this.updateBtn();break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i,this.updateBtn()}},e.prototype.updateData=function(){var t=this.config9[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id),n=0,s=1,o=13746831;i?(n=i.count,o=n>=s?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+n+"|C:0xD1C28F&T:/"+s),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.updateProgress(),this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=this.ins.activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.ins.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);this.huntType=this.turnten.selected?2:1;var t=this.config9[this.activityID][0],e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,this.huntType);else{var i=2==this.huntType?10:1;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+(10==i?"-10":"-1"),this.huntWarnFun.bind(this),"是否消耗"+t.yb*i+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}},e.prototype.huntWarnFun=function(){var t=this.config9[this.activityID][0],e=2==this.huntType?10:1;Actor.yb>=t.yb*e?this.ins.sendReward(this.activityID,this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.updateProgress=function(){var t,e=this,i=this.config9[this.activityID][0];this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]);var n=[];if(i&&t){for(var s=0;s<i.reward.length;s++){var o={index:s,config:i,actType:this.actType};n.push(o)}this.menuListData.replaceAll(n)}this.menuList.validateNow(),egret.callLater(function(){for(var i=0,n=1;n<=e.menuListData.length;n++)if(0==t.getStateByIndex(n)){i=90*(n-1);break}i>e.menuList.contentWidth-e.menuList.width&&(i=e.menuList.contentWidth-e.menuList.width),e.menuList.scrollH=i,e.updateBtn()},this)},e.prototype.updateBtn=function(){this.menuListData.length<=5?this.rightBtn.visible=this.rightRed.visible=this.leftBtn.visible=this.leftRed.visible=!1:this.onChange()},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=this.leftRed.visible=!1,this.rightBtn.visible=this.rightRed.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!1):(this.leftBtn.visible=this.leftRed.visible=!0,this.rightBtn.visible=this.rightRed.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){for(var t=this.config9[this.activityID][0],e=!1,i=0;i<t.reward.length&&!(e=this.ins.isGetRollReward(this.activityID,i));i++);this.leftBtn.visible&&(this.leftRed.visible=e),this.rightBtn.visible&&(this.rightRed.visible=e)},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var n={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].itemId,actType:this.actType};e.push(n)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel4.prototype,"OSATarget9Panel4"),window.OSATarget9Panel4=OSATarget9Panel4;var OSATarget9Panel5=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setCurSkin=function(){var t;this.actType==ActivityType.Normal?t=GlobalConfig.ActivityConfig[this.activityID]:this.actType==ActivityType.Personal&&(t=GlobalConfig.PActivityConfig[this.activityID]),t.pageSkin?this.skinName=t.pageSkin:this.skinName="XNluckyTurntableSkin"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve(),egret.Tween.removeTweens(this.tttzhi),this.rolling=!1;var i;this.actType==ActivityType.Normal?i=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(i=this.ins.activityData[this.activityID]),i&&1==i.indexs.length&&this.ins.sendReward(this.activityID,1),Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.setCurSkin(),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.config9=GlobalConfig.ActivityType9Config):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.config9=GlobalConfig.PActivityType9Config),this.observe(this.ins.postChangePage,this.resultCallBack),Timer.start(1e3,0,this.setTime,this),this.addTouchEvent(this.choujiangBtn,this.getLottery),this.list.itemRenderer=NoticeListRenderer,this.turnten.selected=!1,this.currentState="resetWithKey",this.validateNow(),this.updateData()},e.prototype.onTouch=function(t){t.currentTarget},e.prototype.updateData=function(){var t=this.config9[this.activityID][0],e=GlobalConfig.ItemConfig[t.item];if(e){this.icon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id),n=0,s=1,o=13746831;i?(n=i.count,o=n>=s?ColorUtil.GREEN:ColorUtil.RED):o=ColorUtil.RED,this.num.textFlow=TextFlowMaker.generateTextFlow1("|C:"+o+"&T:"+n+"|C:0xD1C28F&T:/"+s),this.pay0.text=t.yb+""}for(var a in this.config9[this.activityID])if(+a){var r=this.config9[this.activityID][a],i=this["item"+(+a-1)];i.itemIcon.data=r.reward[0],i.rewardState(!1)}this.num2.visible=!1,this.listRefush(),this.setTime()},e.prototype.resultCallBack=function(t){var e;this.actType==ActivityType.Normal?e=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(e=this.ins.activityData[this.activityID]),e&&this.activityID==t&&(e.indexs.length>1?ViewManager.ins().open(LuckyResultWin,this.activityID,e.indexs):1==e.indexs.length&&this.beginLottery(e.indexs[0]),this.listRefush(),this.updateData())},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){e.ins.sendReward(e.activityID,1),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.getLottery=function(){if(this.rolling)return void TipsCT.ins().showTips("正在抽奖，请稍候");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);var t=this.config9[this.activityID][0];if(this.turnten.selected){var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,2);else{var i=10,n=t.yb*i;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-10",this.checkSend10.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}else{var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t.item);if(e&&e.count)this.ins.sendReward(this.activityID,1);else{var i=1,n=1*t.yb;HuntWarnBuyWin.showBuyWarn("LuckyResultWin"+this.activityID+"-1",this.checkSend1.bind(this),"是否消耗"+n+"元宝购买"+GlobalConfig.ItemConfig[t.item].name+"*"+i)}}},e.prototype.checkSend10=function(){this.ins.getIsRollTen(this.activityID)?this.ins.sendReward(this.activityID,2):TipsCT.ins().showTips("元宝不足")},e.prototype.checkSend1=function(){this.ins.getRollSum(this.activityID)||Actor.yb>=this.config9[this.activityID][0].yb?this.ins.sendReward(this.activityID,1):TipsCT.ins().showTips("元宝不足")},e.prototype.updateRedPoint=function(){for(var t=this.config9[this.activityID][0],e=!1,i=0;i<t.reward.length&&!(e=this.ins.isGetRollReward(this.activityID,i));i++);},e.prototype.listRefush=function(){var t;if(this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t){for(var e=[],i=0;i<t.noticeArr.length;i++){var n={activityID:this.activityID,name:t.noticeArr[i].name,index:t.noticeArr[i].itemId,actType:this.actType};e.push(n)}this.list.dataProvider=new eui.ArrayCollection(e)}},e.prototype.setTime=function(){var t;this.actType==ActivityType.Normal?t=this.ins.activityData[this.activityID]:this.actType==ActivityType.Personal&&(t=this.ins.activityData[this.activityID]),t&&(this.actTime.text="剩余时间："+t.getRemainTime())},e}(BaseView);__reflect(OSATarget9Panel5.prototype,"OSATarget9Panel5"),window.OSATarget9Panel5=OSATarget9Panel5;var OSATargetDays42ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.get0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.rewardList.itemRenderer=ItemBase},e.prototype.onTap=function(t){Recharge.ins().getRechargeTotalAward(this.data.id)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.id>42?e.id-42:e.id;this.num.text=i+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList),Recharge.ins().rechargeTotal.hasGetDays.indexOf(e.id)>=0?(this.get0.visible=!1,this.already.visible=!0):(this.get0.visible=!0,this.already.visible=!1,e.id<=Recharge.ins().rechargeTotal.totalDay?(this.get0.label="领取",this.get0.enabled=!0):(this.get0.label="未完成",this.get0.enabled=!1))},e}(BaseItemRender);__reflect(OSATargetDays42ItemRender.prototype,"OSATargetDays42ItemRender"),window.OSATargetDays42ItemRender=OSATargetDays42ItemRender;var OSATargetDays42ItemRender2=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42BigRewardItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.days.text="",e.awardList.length>2?this.reward.data=e.awardList[2]:this.reward.data=e.awardList[0];var i=42*this.data.sum;Recharge.ins().rechargeTotal.hasGetDays.length>=i?this.state.visible=!0:this.state.visible=Recharge.ins().rechargeTotal.hasGetDays.indexOf(e.id)>=0},e}(BaseItemRender);__reflect(OSATargetDays42ItemRender2.prototype,"OSATargetDays42ItemRender2"),window.OSATargetDays42ItemRender2=OSATargetDays42ItemRender2;var OSATargetItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.juebanItems={260112:!0,260113:!0,260114:!0,260115:!0,260116:!0},e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.isGet=!0},e.prototype.onClick=function(t){switch(t.target){case this.get:var e=void 0,i=void 0;if(GlobalConfig.PActivityBtnConfig[this.actId]?(e=GlobalConfig.PActivityType1Config[this.actId][this.index],i=PActivity.ins()):(e=GlobalConfig.ActivityType1Config[this.actId][this.index],i=Activity.ins()),this.isGet)i.sendReward(this.actId,this.index);else{var n=0;switch(e.showType){case ShowType.LEVEL:Actor.level<e.level?n=e.level-Actor.level:ZsCT.ins().lv<e.zslevel&&(n=e.zslevel-ZsCT.ins().lv);break;case ShowType.WING:WingsData.getWingAllLevel()<e.wingLv&&(n=e.wingLv-WingsData.getWingAllLevel());break;case ShowType.ZHUZAO:Role.getAllForgeLevelByType(PackageID.Zhuling)<e.zzLv&&(n=e.zzLv-Role.getAllForgeLevelByType(PackageID.Zhuling));break;case ShowType.LONGHUN:LongHunData.getLongHunAllLevel()<e.lhLv&&(n=e.lhLv-LongHunData.getLongHunAllLevel());break;case ShowType.BOOK:var s=Book.ins().getBookPowerNumEx();s<e.tjPower&&(n=e.tjPower-s);break;case ShowType.EQUIP:var o=Activity.ins().getActivityDataById(this.actId),a=Math.max(o?o.progress:0,BagCT.ins().getEquipsScoreByRolesOfBody());a<e.equipPower&&(n=e.equipPower-a);break;case ShowType.XIAOFEI:var r=Activity.ins().getActivityDataById(this.actId);r&&r.progress<e.consumeYuanbao&&(n=e.consumeYuanbao-r.progress);break;case ShowType.RING:var l=0,h=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);h&&h.level&&(l=h.level),l<e.huoyanRingLv&&(n=e.huoyanRingLv-l);break;case ShowType.SAMSARA:Actor.samsaraLv<e.lunhLv&&(n=e.lunhLv-Actor.samsaraLv);break;case ShowType.YUANSHEN:YuanshenData.ins().isEnough(e.lianjiLv)||(n=e.lianjiLv-YuanshenData.ins().yuanShenLv)}if(!n)return void Activity.ins().sendReward(this.actId,this.index);e.showType==ShowType.LEVEL&&ZsCT.ins().lv<e.zslevel?TipsCT.ins().showTips(+n+"转之后即可领取奖励"):e.showType==ShowType.BOOK?TipsCT.ins().showTips("再升"+n+"图鉴战力之后即领取奖励"):e.showType==ShowType.EQUIP?TipsCT.ins().showTips("再升"+n+"装备评分之后即领取奖励"):e.showType==ShowType.XIAOFEI?TipsCT.ins().showTips("再消费"+n+"之后即领取奖励"):TipsCT.ins().showTips("再升"+n+"级即可领取奖励")}}},e.prototype.dataChanged=function(){if(this.data){var t,e=this.data;t=GlobalConfig.PActivityBtnConfig[e.Id]?PActivity.ins().getActivityDataById(e.Id):Activity.ins().getActivityDataById(e.Id),this.ActivityShowType(e);for(var i=SubRoles.ins().getSubRoleByIndex(0),n=0,s=0;3>s;s++)this["item"+s].visible=!1;for(var s=0;s<e.rewards.length;s++){var o=e.rewards[s];if(!o.job||o.job==i.job){this["item"+n].visible=!0;var a=!1;this.juebanItems[o.id]&&3==e.Id&&(a=!0),this["item"+n].data={type:o.type,count:o.count,id:o.id,showJueban:a},n++}}var r=t.getRewardStateById(e.index),l=t.rewardsSum[e.index],h=e.total?e.total-l:1;switch(h=h>0?h:0,this.redPoint.visible=!1,r){case Activity.NotReached:h>0?this.currentState="can":this.currentState="zero",this.isGet=!1;break;case Activity.CanGet:h>0?(this.currentState="can",this.redPoint.visible=!0):this.currentState="zero";break;case Activity.Geted:this.currentState="already"}this.get.enabled=this.redPoint.visible,this.get.enabled?this.get.label="领取":this.get.label="未完成",this.num.visible=!0,e.total?this.num.text="剩余"+h+"份":this.num.visible=!1,this.actId=e.Id,this.index=e.index,e.showType==ShowType.XIAOFEI?(this.target.visible=this.recharge.visible=!0,this.target.visible=!1,this.recharge.text=t.progress+"/"+e.consumeYuanbao):this.target.visible=this.recharge.visible=!1,this.validateNow()}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.ActivityShowType=function(t){switch(t.showType){case ShowType.LEVEL:t.zslevel?(this.lvName.text="转生数",this.lvName0.text=t.zslevel+"转"):(this.lvName.text="人物等级",this.lvName0.text=t.level+"级"),15==t.Id&&(this.lvName.text="转生等级",this.lvName0.text=t.zslevel+"转");break;case ShowType.WING:this.lvName.text="翅膀等阶",this.lvName0.text=t.wingLv+"阶";break;case ShowType.ZHUZAO:this.lvName.text="总等级",this.lvName0.text=t.zzLv+"";break;case ShowType.LONGHUN:this.lvName.text="龙印星级",this.lvName0.text=t.lhLv+"星";break;case ShowType.BOOK:this.lvName.text="图鉴战力",this.lvName0.text=t.tjPower+"";break;case ShowType.EQUIP:this.lvName.text="装备评分",this.lvName0.text=t.equipPower+"";break;case ShowType.XIAOFEI:this.lvName.text="消费元宝",this.lvName0.text=t.consumeYuanbao+"";break;case ShowType.RING:this.lvName.text="烈焰戒指",this.lvName0.text=t.huoyanRingLv+"级";break;case ShowType.SAMSARA:this.lvName.text="轮回等级";var e=SamsaraModel.ins().getSamsara(t.lunhLv),i=SamsaraModel.ins().getSamsaraLv(t.lunhLv),n=SamsaraModel.ins().getSamsaraDesc(e)+"·"+SamsaraModel.ins().getSamsaraLvDesc(i);this.lvName0.textFlow=TextFlowMaker.generateTextFlow1(t.lunhLv+"\n|S:16&T:"+n);break;case ShowType.ZHANLING:this.lvName.text="魔神等阶";var s=t.zhanlingLv;this.lvName0.text=Math.ceil(s/10)+"阶"+(s%10==0?s?10:0:s%10)+"星";break;case ShowType.YUANSHEN:this.lvName.text="元神等阶",this.lvName0.text=t.lianjiLv+"";break;case ShowType.Heirloom:this.lvName.text="传世战力",this.lvName0.text=t.heirloomPower+"";break;case ShowType.SHENSHOU:this.lvName.text="神兽战力",this.lvName0.text=t.shenshouPower+"";break;case ShowType.HEARTMETHOD:this.lvName.text="秘籍星级",this.lvName0.text=t.heartmethodLv+"级";break;case ShowType.ENCOUNTER:this.lvName.text="PK排名",this.lvName0.text="第"+t.skirmishFame+"名";
break;case ShowType.MOSHEN:this.lvName.text="魔神星级",this.lvName0.text=t.moshenLv+"级"}},e}(BaseItemRender);__reflect(OSATargetItemRenderer.prototype,"OSATargetItemRenderer"),window.OSATargetItemRenderer=OSATargetItemRenderer;var OSATargetItemRender1=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSADailyGiftItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){switch(t.target){case this.get:if(this.isGet)this.data instanceof ActivityType2Config?Activity.ins().sendReward(this.actId,this.index):this.data instanceof PActivity2Config&&PActivity.ins().sendReward(this.actId,this.index);else{var e=this.data;e&&(Actor.vip<e.vip?TipsCT.ins().showTips("|C:0xff0000&T:"+VipCT.getVipStr(e.vip)+"等级不满足要求|"):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"))}}},e.prototype.dataChanged=function(){if(this.data){var t,e;if(this.data instanceof ActivityType2Config?(t=this.data,e=Activity.ins().getActivityDataById(t.Id)):this.data instanceof PActivity2Config&&(t=this.data,e=PActivity.ins().getActivityDataById(t.Id)),!t||!e)return void(this.isGet=!1);this.redPoint.visible=!1,e.buyData[t.index]>=t.count?(this.isGet=!1,this.already.visible=!0):(this.isGet=Actor.vip>=t.vip&&Actor.yb>=t.price,this.already.visible=!1,this.redPoint.visible=this.getRedPoint(t));var i=t.count-e.buyData[t.index];i=0>=i?0:i;var n=i?65280:16711680;this.times.textFlow=TextFlowMaker.generateTextFlow1("可购买：|C:"+n+"&T:"+i+"|/"+t.count),this.times.visible=this.get.visible=!this.already.visible,this.original.text=t.originalPrice+"",this.now.text=t.price+"",this.reward.dataProvider=new eui.ArrayCollection(t.rewards),this.actId=t.Id,this.index=t.index,this.discountNum.text=t.discount+"",t.vip?(this.vip.visible=!0,this.vipLv.text=t.vip+""):this.vip.visible=!1,Actor.level<ActivityType2Data.LimitLevel&&(this.redPoint.visible=!1)}},e.prototype.getRedPoint=function(t){return Actor.vip>=t.vip&&Actor.yb>=t.price},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(OSATargetItemRender1.prototype,"OSATargetItemRender1"),window.OSATargetItemRender1=OSATargetItemRender1;var OSATargetItemRender4=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSARankListItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){if(this.data.rankData){var t,e=this.data.rankData,i=this.data.activityID,n=GlobalConfig.ActivityType4Config[i][1],s=n.rankType;if(s==RankDataType.TYPE_HF_XIAOFEI)if(e instanceof DabiaoData){var o=this.data.rank?this.data.rank:e.rankIndex;3>=o?(this.rankImg.source="paihang"+o,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=o+""),this.name1.text=e.name,this.value.text=e.numType,t=o,t=1==t?1:2==t||3==t?2:4==t||5==t?4:6,n=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(n.rewards)}else{var o=this.data.rank?this.data.rank:e.pos;3>=o?(this.rankImg.source="paihang"+o,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=o),this.name1.text=e.player,this.value.text=e.value,t=o,t=1==t?1:2==t||3==t?2:4==t||5==t?4:6,n=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(n.rewards)}else e instanceof DabiaoData?(e.rankIndex<=3?(this.rankImg.source="paihang"+e.rankIndex,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=e.rankIndex+""),this.name1.text=e.name,this.value.text=e.numType,t=e.rankIndex,t>4&&(t=4),n=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(n.rewards)):(e.pos<=3?(this.rankImg.source="paihang"+e.pos,this.rankNum.visible=!1):(this.rankImg.source="",this.rankNum.visible=!0,this.rankNum.text=e.pos),this.name1.text=e.player,this.value.text=e.value,t=e.pos,n=GlobalConfig.ActivityType4Config[i][t],this.reward.dataProvider=new eui.ArrayCollection(n.rewards))}},e}(BaseItemRender);__reflect(OSATargetItemRender4.prototype,"OSATargetItemRender4"),window.OSATargetItemRender4=OSATargetItemRender4;var OSATargetLuxury42ItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="OSAItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.get0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.rewardList.itemRenderer=ItemBase},e.prototype.onTap=function(t){Recharge.ins().getRechargeTotalAward2(this.data.id)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data,i=e.id>42?e.id-42:e.id;this.num.text=i+"",this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList),Recharge.ins().rechargeTotal2.hasGetDays.indexOf(e.id)>=0?(this.get0.visible=!1,this.already.visible=!0):(this.get0.visible=!0,this.already.visible=!1,e.id<=Recharge.ins().rechargeTotal2.totalDay?(this.get0.label="领取",this.get0.enabled=!0):(this.get0.label="未完成",this.get0.enabled=!1))},e}(BaseItemRender);__reflect(OSATargetLuxury42ItemRender.prototype,"OSATargetLuxury42ItemRender"),window.OSATargetLuxury42ItemRender=OSATargetLuxury42ItemRender;var OSATargetLuxury42ItemRender2=function(t){function e(){var e=t.call(this)||this;return e.skinName="Days42BigRewardItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.days.text="",e.awardList.length>1?this.reward.data=e.awardList[1]:this.reward.data=e.awardList[0];var i=42*this.data.sum;Recharge.ins().rechargeTotal2.hasGetDays.length>=i?this.state.visible=!0:this.state.visible=Recharge.ins().rechargeTotal2.hasGetDays.indexOf(e.id)>=0},e}(BaseItemRender);__reflect(OSATargetLuxury42ItemRender2.prototype,"OSATargetLuxury42ItemRender2"),window.OSATargetLuxury42ItemRender2=OSATargetLuxury42ItemRender2;var ActivityStoreRewardShowWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="activityStoreRewardShowSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.shopList.itemRenderer=ActivityStoreShowItemRender,this.addTouchEvent(this.bgClose,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._activityID=t[0],this.update()},e.prototype.update=function(){var t=Activity.ins().getConfig22_3(this._activityID);this.shopList.dataProvider=new eui.ArrayCollection(t?t.showReward:null)},e.prototype.onTouch=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(ActivityStoreRewardShowWin.prototype,"ActivityStoreRewardShowWin"),ViewManager.ins().reg(ActivityStoreRewardShowWin,LayerManager.UI_Main),window.ActivityStoreRewardShowWin=ActivityStoreRewardShowWin;var ActivityStoreItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="activityStoreItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.buyBtn.label=this.data.isScore?"兑 换":"购 买",this.discount.visible=!this.data.isScore&&this.data.data.discount,this.discount.visible&&(this.discountNum.source="discountNum"+this.data.data.discount),this.itemIcon.data={type:1,id:this.data.data.itemID,count:this.data.data.itemCount},this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.buyBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.data.isScore?(this.buyBtn.enabled=!0,this.yuanbao.visible=!1,this.jifen.visible=!0,this.jifenNum.text=this.data.data.score):(this.buyBtn.enabled=0==this.data.data.state,this.yuanbao.visible=!0,this.jifen.visible=!1,this.money.text=this.data.data.price)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.buyBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){var e=Activity.ins().activityData[this.data.activityID];this.data.isScore?e.tScore<this.data.data.score?TipsCT.ins().showTips("|C:0xf3311e&T:积分不足|"):Activity.ins().sendReward(this.data.activityID,0,4,this.data.data.id):Actor.yb<this.data.data.price?TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id)},e}(BaseItemRender);__reflect(ActivityStoreItemRender.prototype,"ActivityStoreItemRender"),window.ActivityStoreItemRender=ActivityStoreItemRender;var ActivityStoreShowItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="activityStoreShowItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.discount.visible=this.data.discountImg>0,this.discount.visible&&(this.discountNum.source="discountNum"+this.data.discountImg),this.money.text=this.data.cost,this.itemIcon.data=this.data},e}(BaseItemRender);__reflect(ActivityStoreShowItemRender.prototype,"ActivityStoreShowItemRender"),window.ActivityStoreShowItemRender=ActivityStoreShowItemRender;var Activity2Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitGiftActSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData(),this.addTouchEvent(this.buy0,this.onTap),this.addTouchEvent(this.buy1,this.onTap),this.addTouchEvent(this.buy2,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){var e,i,n=this;switch(t.currentTarget){case this.buy0:i=0;break;case this.buy1:i=1;break;case this.buy2:i=2}var s=Activity.ins().activityData[this.activityID];e=GlobalConfig.ActivityType2Config[this.activityID][i];var o=(s.buyData[i]||0,1==e.currencyType?Actor.gold:Actor.yb),a=1==e.currencyType?"金币":"元宝";if(e.vip&&Actor.vip<e.vip)TipsCT.ins().showTips(VipCT.getVipStr(e.vip)+"等级不足");else{var r=this.configList[i].rewards[0].id,l=ItemUtil.getType(GlobalConfig.ItemConfig[r]);if(BagCT.ins().getSurplusCount()<1&&0==l)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");o>=e.price?WarnWin.show("确定消耗"+e.price+a+"购买特惠商品吗？",function(){Activity.ins().sendReward(n.activityID,i+1)},this):TipsCT.ins().showTips(a+"不足")}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);if(e>=0)this.date.text="活动未开启";else if(0>=i)this.date.text="活动已结束";else{var n=Math.floor(i/86400),s=Math.floor(i%86400/3600),o=Math.floor(i%3600/60);this.date.text=n+"天"+s+"小时"+o+"分"}this.desc.text=GlobalConfig.ActivityConfig[this.activityID].desc,this.configList=GlobalConfig.ActivityType2Config[this.activityID],this.group_item0&&(this.group_item0.visible=!1),this.group_item1&&(this.group_item1.visible=!1),this.group_item2&&(this.group_item2.visible=!1);for(var a=0;a<this.configList.length;a++){var r=this.configList[a],l=t.buyData[a]||0,h=this["item"+a],u=this["itemCount"+a],p=this["label_title"+a],c=this["price"+a],d=this["desc"+a],g=this["buy"+a],f=this["redPoint"+a],v=this["group_item"+a],y=(this["imgDiscount"+a],this["itemname"+a]),m=this["title"+a],T=GlobalConfig.ItemConfig[r.rewards[0].id];h&&(h.setData(T),u.text=r.rewards[0].count+""),y&&(y.text=T.name),p&&(p.text=r.vip?VipCT.getVipStr(r.vip,!0)+"特权":"全民特惠"),c&&(c.setText(r.price+""),c.setType(1==r.currencyType?MoneyConst.gold:MoneyConst.yuanbao)),d&&(d.text="今日购买次数："+(r.count-l)),m&&(m.source="tq_"+(r.vip<10?"0"+r.vip:r)),g&&(g.enabled=r.count-l>0),f&&(f.visible=Activity.ins().getisCanBuyXianGouItem(this.activityID+"",a)),v&&(v.visible=!0)}},e}(BaseView);__reflect(Activity2Panel1.prototype,"Activity2Panel1"),window.Activity2Panel1=Activity2Panel1;var Activity2Panel2=function(t){function e(){var e=t.call(this)||this;return e._index=0,e.skinName="ActGiftSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this.type_1,this.onTap),this.addTouchEvent(this.type_2,this.onTap),this.addTouchEvent(this.type_3,this.onTap),this.addTouchEvent(this.type_4,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){var e,i=this;switch(t.currentTarget){case this.buyBtn:if(e=-1,this.config.vip&&Actor.vip<this.config.vip)TipsCT.ins().showTips(VipCT.getVipStr(this.config.vip)+"等级不足");else{if(BagCT.ins().getSurplusCount()<1&&3==this._index)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|");Actor.yb>=this.config.price?WarnWin.show("确定消耗"+this.config.price+"元宝购买特惠商品吗？",function(){Activity.ins().sendReward(i.activityID,i._index+1)},this):TipsCT.ins().showTips("元宝不足")}break;case this.type_1:e=0;break;case this.type_2:e=1;break;case this.type_3:e=2;break;case this.type_4:e=3}-1!=e&&this.updateData(e)},e.prototype.updateData=function(t){void 0===t&&(t=0);var i=Activity.ins().getActivityDataById(this.activityID),n=Math.floor((DateUtils.formatMiniDateTime(i.startTime)-GameServer.serverTime)/1e3),s=Math.floor((DateUtils.formatMiniDateTime(i.endTime)-GameServer.serverTime)/1e3);n>=0?this.date.text="活动未开启":0>=s?this.date.text="活动已结束":this.date.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_5,3),this.config=GlobalConfig.ActivityType2Config[this.activityID][t],this.list.dataProvider=new eui.ArrayCollection(this.config.rewards);var o=e.giftNameArr[t],a="花费<font color = '#FF964C'>"+this.config.price+"</font>元宝即可获得<font color = '#FF964C'>"+o+"</font>";this.desc.textFlow=(new egret.HtmlTextParser).parser(a),this.chosen.x=7+105*t,this._index=t,this.get_1.visible=1==i.buyData[0],this.get_2.visible=1==i.buyData[1],this.get_3.visible=1==i.buyData[2],this.get_4.visible=1==i.buyData[3],this.buyBtn.visible=0==i.buyData[t]},e.giftNameArr=["超值礼包","豪华礼包","神翅礼包","官印礼包"],e}(BaseView);__reflect(Activity2Panel2.prototype,"Activity2Panel2"),window.Activity2Panel2=Activity2Panel2;var FDProjectItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=ItemBase,this._listCollect=new eui.ArrayCollection,this.list.dataProvider=this._listCollect},e.prototype.dataChanged=function(){this._listCollect.source=this.data.conf.reward,this.pName.textFlow=TextFlowMaker.generateTextFlow1(this.data.conf.name),this.scedule.textFlow=TextFlowMaker.generateTextFlow1("|C:65280&T:"+Math.floor(this.data.times/this.data.conf.rate)+"|/"+Math.floor(this.data.conf.dayLimit/this.data.conf.rate)),this.currentState=2==this.data.state?"done":"normal",this.redpoint.visible=1==this.data.state,this.score.text=this.data.conf.score,0==this.data.state&&this.data.conf.turn?(this.actBtn.enabled=!0,this.actBtn.label="前  往"):(this.actBtn.label="领  取",this.actBtn.enabled=1==this.data.state),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){t.target==this.actBtn&&(0==this.data.state&&this.data.conf.turn?ViewManager.ins().open(this.data.conf.turn[0],this.data.conf.turn[1]):Activity.ins().sendReward(this.data.activityID,this.data.conf.index,2))},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(FDProjectItemRender.prototype,"FDProjectItemRender"),window.FDProjectItemRender=FDProjectItemRender;var FDrewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDrewardItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemicon.touchChildren=!1},e.prototype.dataChanged=function(){this.tsNeed.text=this.data.config.score+"狂欢值",this.get.visible=2==this.data.state,this.redpoint.visible=1==this.data.state,this.arrow.source=this.data.state?"fd_arrow2":"fd_arrow1";var t=this.data.config;this.itemicon.data=t.reward[0],this.itemicon.isShowName(!1),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.itemicon.touchEnabled=1!=this.data.state,this.itemicon.filters=0==this.data.state?FilterUtil.ARRAY_GRAY_FILTER:null},e.prototype.onTouch=function(t){1==this.data.state&&Activity.ins().sendReward(this.data.activityID,this.data.index,1)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(FDrewardItemRender.prototype,"FDrewardItemRender"),window.FDrewardItemRender=FDrewardItemRender;var FDstoreItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDstoreItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.data;this.discount.visible=t.buyMax>0,this.limitCount.text=t.buyMax-t.buyCount+"",this.itemIcon.data={type:1,id:t.itemID,count:t.itemCount},this.costIcon.source=GlobalConfig.ItemConfig[GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem].icon+"_png",this.money.text="X"+t.materialNum,this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.buyBtn.label=0==this.data.data.state?"购买":"已购买",this.buyBtn.enabled=0==this.data.data.state},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){if(t.target==this.buyBtn){var e=BagCT.ins().getBagItemById(GlobalConfig.ActivityType22_1Config[this.data.activityID][1].costItem),i=e?e.count:0;i>=this.data.data.materialNum?Activity.ins().sendReward(this.data.activityID,0,3,this.data.data.id):TipsCT.ins().showTips("材料不足")}},e}(BaseItemRender);__reflect(FDstoreItemRender.prototype,"FDstoreItemRender"),window.FDstoreItemRender=FDstoreItemRender;var FDstoreShowItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FDstoreShowItem",e}return __extends(e,t),e.prototype.update=function(t){this.itemID=t.itemID,this.itemImg.source=null,this.itemImg.source=GlobalConfig.ItemConfig[t.itemID].icon+"_png",this.limitCount.textFlow=TextFlowMaker.generateTextFlow("限购 "+t.buy+"/"+t.max),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){this.itemID&&GlobalFun.showDetail(GlobalConfig.ItemConfig[this.itemID],null,1,this.parent)},e}(eui.Component);__reflect(FDstoreShowItemRender.prototype,"FDstoreShowItemRender"),window.FDstoreShowItemRender=FDstoreShowItemRender;var FDtabBtnItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.tabName.text=this.data.gName,this.redpoint.visible=this.data.showRed},Object.defineProperty(e.prototype,"selected",{set:function(t){this.currentState=t?"select":"unselect",this.data&&(this.redpoint.visible=this.data.showRed)},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(FDtabBtnItemRender.prototype,"FDtabBtnItemRender"),window.FDtabBtnItemRender=FDtabBtnItemRender;var HongBaoOpenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoOpenSkin",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(){this.hbbtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.list.itemRenderer=HongBaoRewardsItem,this.closeBtn.visible=!1},e.prototype.onClick=function(t){switch(t.currentTarget){case this.hbbtn:if(!this.data||!this.data.actId||!this.data.eId)return;var e=Activity.ins().getActivityDataById(this.data.actId);if(!e.isOpenActivity())return void TipsCT.ins().showTips("活动已结束");Activity.ins().sendReward(this.data.actId,this.data.eId,EnvelopeType.GET)}},e.prototype.onTouch=function(){this.close()},e.prototype.close=function(){this.callFun&&this.bt1&&this.bt2&&this.bt3&&(Timer.stop(this.close,this),this.parent&&(this.parent.removeChildren(),this.callFun()))},e.prototype.dataChanged=function(){if(this.data){var t=this.data.job,e=this.data.sex,i=this.data.name,n=this.data.text,s=this.data.index;this.myFace.source="head_"+t+e,this.playerName.text=i,this.speaktxt.textFlow=TextFlowMaker.generateTextFlow1(n);var o=GlobalConfig.ActivityType12Config[this.data.actId][s];this.title.source="hongbao_title"+o.skinType}},e.prototype.destruct=function(){this.hbbtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.playAni=function(t,e,i){var n=this;this.removeChild(this.hbbtn),this.removeChild(this.hhbtnlabel),this.removeChild(this.speaktxt),this.removeChild(this.speakbg),this.topImg.scrollRect||(this.topImg.scrollRect=new egret.Rectangle(0,0,this.topImg.width,this.topImg.height)),this.downImg.scrollRect||(this.downImg.scrollRect=new egret.Rectangle(0,0,this.downImg.width,this.downImg.height));var s=this;this.callFun=function(){e&&e.call(i)};var o=this.topImg.scrollRect,a=this.downImg.scrollRect,r=400;this.list.dataProvider=new eui.ArrayCollection(t);var l=egret.Tween.get(o,{onChange:function(){n.topImg.scrollRect=o}}).to({y:200},r).call(function(){egret.Tween.removeTweens(l),s.bt1=!0,s.closeBtn.visible=!0}),h=egret.Tween.get(a,{onChange:function(){n.downImg.scrollRect=a}}).to({height:0},r).call(function(){egret.Tween.removeTweens(h),s.bt2=!0}),u=egret.Tween.get(this.downImg).to({y:this.downImg.y+this.downImg.height},r).call(function(){egret.Tween.removeTweens(u),s.bt3=!0});Timer.has(this.close,this)||Timer.start(1e4,0,this.close,this)},e}(BaseItemRender);__reflect(HongBaoOpenItem.prototype,"HongBaoOpenItem"),window.HongBaoOpenItem=HongBaoOpenItem;var HongBaoRewardsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoRewardItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.yb,e=this.data.gold,i=""+t,n="";this.itemIndex||this.data.name!=Actor.myName?(this.currentState="otherman",n="在红包里抢到了"):(this.currentState="owner",n="手气爆炸，在红包里抢到了"),e?(i=CommonUtils.overLength(e),n+=i+"金币"):n+=i+"元宝",this.validateNow(),this.myFace.source="yuanhead"+this.data.job+this.data.sex,"otherman"==this.currentState?(this.speaktxt.text="",this.playerName.textFlow=(new egret.HtmlTextParser).parse('<font color="#5186FD">'+this.data.name+'</font><font color="#B1B097">'+n+"</font>")):(this.speaktxt.text=n,this.playerName.text=this.data.name)}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(HongBaoRewardsItem.prototype,"HongBaoRewardsItem"),window.HongBaoRewardsItem=HongBaoRewardsItem;var HongBaoShowItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoShowItem",e.init(),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.touchEnabled=!1},e.prototype.init=function(){this.hbimg.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),this.hongbaoeff.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){if(this.data&&this.data.actId&&this.data.eId){var t=Activity.ins().getActivityDataById(this.data.actId);if(!t.isOpenActivity())return void TipsCT.ins().showTips("活动已结束");for(var e=t.envelopeData.length-1;e>=0;e--)if(!t.envelopeData[e]||t.envelopeData[e].id==this.data.eId){if(t.envelopeData[e].isOverTimer())return TipsCT.ins().showTips("|C:0xff0000&T:红包已过期"),void Activity.ins().postEnvelopeDataCall(null);break}Activity.ins().sendEnvelopeData(this.data.actId,this.data.eId)}},e.prototype.dataChanged=function(){if(this.data&&(this.eff||(this.eff=new MovieClip),!this.eff.parent)){this.hbimg.visible=!1,this.hongbaoeff.addChild(this.eff);var t=this;this.eff.playFile(RES_DIR_EFF+"RedPacket",1,function(){t.hbimg&&(t.hbimg.visible=!0)})}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e}(BaseItemRender);__reflect(HongBaoShowItem.prototype,"HongBaoShowItem"),window.HongBaoShowItem=HongBaoShowItem;var HongBaoSpeak=function(t){function e(){var e=t.call(this)||this;return e.skinName="hongbaoSpeakSkin",e}return __extends(e,t),e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.sendBtn,this.onClick),this.actId=t[0],this.index=t[1];var i=GlobalConfig.ActivityType12Config[this.actId][this.index];this.input.text=i.blessWord,this.input.maxChars=i.wordCount},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:ViewManager.ins().close(this);var e=Activity.ins().getActivityDataById(this.actId);if(!e.isOpenActivity())return void TipsCT.ins().showTips("活动已结束");Activity.ins().sendReward(this.actId,this.index,EnvelopeType.SEND,this.input.text)}},e}(BaseEuiView);__reflect(HongBaoSpeak.prototype,"HongBaoSpeak"),ViewManager.ins().reg(HongBaoSpeak,LayerManager.UI_Popup),window.HongBaoSpeak=HongBaoSpeak;var XiaoNianItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="XNHongBaoItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.currentState=this.data)},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(XiaoNianItem.prototype,"XiaoNianItem"),window.XiaoNianItem=XiaoNianItem;var XiaoNianListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.showText.textFlow=TextFlowMaker.generateTextFlow(this.data))},e}(BaseItemRender);__reflect(XiaoNianListRenderer.prototype,"XiaoNianListRenderer"),window.XiaoNianListRenderer=XiaoNianListRenderer;var ZhanLingACTWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ZhanlingActWin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(void 0!=i&&!(Activity.ins().getActivityDataById(i)&&Activity.ins().getActivityDataById(i).isOpenActivity()&&PActivity.ins().getActivityDataById(i)&&PActivity.ins().getActivityDataById(i).isOpenActivity()))return TipsCT.ins().showTips("|C:0xff0000&T:活动未开启"),!1;for(var n in PActivity.ins().activityData)if(PActivity.ins().getZhanlingActivity(n)&&PActivity.ins().getActivityDataById(+n).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.actId=t[0],this.updateView(),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postMuchDayRecReward,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.observe(PActivity.ins().postActivityPanel,this.updatePanel),this.observe(PActivity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(PActivity.ins().postChangePage,this.ChangePageCallBack),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(){var t=0,e=0;for(e=0;e<this.viewStack.numElements;e++)ObjectPool.push(this.viewStack.getElementAt(e));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[];var i=PActivity.ins();for(var n in i.activityData)if(i.getZhanlingActivity(n)&&i.getActivityDataById(+n).isOpenActivity()){var s=i.getbtnInfo(n);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"PActivityWin  data   "+n)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var o=this._datas[n].id,a=void 0;if(this._datas[n].activityType==ActivityType.Normal?a=Activity.ins().getActivityDataById(+o):this._datas[n].activityType==ActivityType.Personal&&(a=i.getActivityDataById(+o)),a&&a.id==o){var r=a.getHide();if(!r){var l=ActivityPanel.create(o,a.activityType);if(!l)continue;l.top=0,l.left=0,l.bottom=0,l.right=0,this.activityPanelList[e]=l,this.viewStack.addChild(this.activityPanelList[e]),this.BtnArr.push(this._datas[n]),this.actId&&this.actId==o&&(t=e),e++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(t),this.viewStack.validateNow(),this.menuList.validateNow(),t>=5){var h=92*t;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,this.activityPanelList[t].activityType==ActivityType.Normal?Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0):this.activityPanelList[t].activityType==ActivityType.Personal&&PActivity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()
},e.prototype.onClickMenu=function(t){this.actId=0,this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex;var e,i,n=this.activityPanelList[this.selectIndex].activityType;n==ActivityType.Normal?(e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID],i=GlobalConfig.ActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID]):n==ActivityType.Personal&&(e=GlobalConfig.PActivityConfig[this.activityPanelList[this.selectIndex].activityID],i=GlobalConfig.PActivityBtnConfig[this.activityPanelList[this.selectIndex].activityID]),i&&(i.type?e&&(e.activityType==ActivityDataType._3||e.activityType==ActivityDataType._9||e.activityType==ActivityDataType._19?this.setOpenIndex(this.selectIndex):n==ActivityType.Normal?Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID):n==ActivityType.Personal&&PActivity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID)):this.setOpenIndex(this.selectIndex))},e.prototype.ChangePageCallBack=function(){this.actId&&(this.selectIndex=this.checkIndexByActivityId(this.actId)),this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return t.sort>e.sort?1:t.sort<e.sort?-1:t.activityType>e.activityType?1:-1},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in PActivity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(PActivity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(PActivity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZhanLingACTWin.prototype,"ZhanLingACTWin"),ViewManager.ins().reg(ZhanLingACTWin,LayerManager.UI_Main),window.ZhanLingACTWin=ZhanLingACTWin;var ActivityExWin=function(t){function e(){var e=t.call(this)||this;return e.activityPanelList=[],e.skinName="ActivityWinSkin",e.isTopLevel=!0,e.selectIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.menuList.itemRenderer=ActivityBtnRenderer},e.prototype.checkIndexByActivityId=function(t){for(var e=0;e<this.activityPanelList.length;e++)if(this.activityPanelList[e].activityID==t)return e;return 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!OpenSystem.ins().checkSysOpen(SystemType.ACTIVITY))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.ACTIVITY)),!1;var i=t[0];if(void 0!=i){if(Activity.ins().activityData[i].pageStyle||Activity.ins().activityData[i].timeType!=ActivityDataFactory.TimeType_Total)return TipsCT.ins().showTips("|C:0xff0000&T:此活动不是合服活动"),!1;if(!Activity.ins().getActivityDataById(i)||!Activity.ins().getActivityDataById(i).isOpenActivity())return TipsCT.ins().showTips("|C:0xff0000&T:合服活动未开启"),!1}var n=Object.keys(Activity.ins().activityData);if(!n.length)return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,合服活动已经结束了"),!1;for(var s in Activity.ins().activityData)if(!Activity.ins().activityData[s].pageStyle&&Activity.ins().activityData[s].timeType==ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+s).isOpenActivity())return!0;return TipsCT.ins().showTips("|C:0xff0000&T:很遗憾,合服活动已经结束了"),!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.updateView(i),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.leftBtn,this.onTouchBtn),this.addTouchEvent(this.rightBtn,this.onTouchBtn),this.observe(Activity.ins().postActivityPanel,this.updatePanel),this.observe(Activity.ins().postActivityIsGetAwards,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRecharge,this.refushRedPoint),this.observe(Recharge.ins().postRechargeTotalDay,this.refushRedPoint),this.observe(Recharge.ins().postUpdateRechargeEx,this.refushRedPoint),this.observe(BagCT.ins().postItemAdd,this.refushRedPoint),this.observe(BagCT.ins().postItemChange,this.refushRedPoint),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.observe(GameApp.ins().postZeroInit,this.zeroUpdate),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.activityPanelList.length;i++)this.activityPanelList[i].close()},e.prototype.refushRedPoint=function(){this.dataArr.replaceAll(this.BtnArr),this.menuList.dataProvider=this.dataArr},e.prototype.updateView=function(t){this.title.source="biaoti_hefuhuodong";var e=0,i=0;for(i=0;i<this.viewStack.numElements;i++)ObjectPool.push(this.viewStack.getElementAt(i));this.viewStack.removeChildren(),this.activityPanelList=[],this._datas=[],i=0;for(var n in Activity.ins().activityData)if(!Activity.ins().activityData[n].pageStyle&&Activity.ins().activityData[n].timeType==ActivityDataFactory.TimeType_Total&&Activity.ins().getActivityDataById(+n).isOpenActivity()){var s=Activity.ins().getbtnInfo(n);if(s.activityType&&s.activityType==ActivityType.Nesting)continue;ErrorLog.Assert(s,"ActivityExWin  data   "+n)||this._datas.push(s)}this._datas.sort(this.sort),this.BtnArr=[];for(var n in this._datas){var o=this._datas[n].id,a=void 0;if(this._datas[n].activityType==ActivityType.Normal?a=Activity.ins().getActivityDataById(+o):this._datas[n].activityType==ActivityType.Personal&&(a=PActivity.ins().getActivityDataById(+o)),a&&a.id==o){var r=a.getHide();if(!r){var l=ActivityPanel.create(o,a.activityType);if(!l)continue;l.top=0,l.left=0,l.bottom=0,l.right=0,this.activityPanelList[i]=l,this.viewStack.addChild(this.activityPanelList[i]),this.BtnArr.push(this._datas[n]),void 0!=t&&t==o&&(e=i),i++}}}if(this.dataArr=new eui.ArrayCollection(this.BtnArr),this.menuList.dataProvider=this.dataArr,this.onChange(),this.viewStack.numElements>0&&this.setOpenIndex(e),this.viewStack.validateNow(),this.menuList.validateNow(),e>=5){var h=92*e;h>this.menuList.contentWidth-this.menuScroller.width&&(h=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=h}},e.prototype.updatePanel=function(t){for(var e in this.activityPanelList)if(this.activityPanelList[e].activityID==t){this.activityPanelList[e].updateData();break}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.activityPanelList[t].open(),this.viewStack.selectedIndex=t,this.menuList.selectedIndex=t,Activity.ins().setPalyEffListById(this.activityPanelList[t].activityID,!0),this.refushRedPoint()},e.prototype.onClickMenu=function(t){if(this.selectIndex!=t.currentTarget.selectedIndex&&(SoundUtil.play(SoundEnum.WINDOW),this.activityPanelList[this.selectIndex]&&this.activityPanelList[this.selectIndex].close()),this.selectIndex=t.currentTarget.selectedIndex,this.activityPanelList[this.selectIndex].activityID>1e4)this.setOpenIndex(this.selectIndex);else{var e=GlobalConfig.ActivityConfig[this.activityPanelList[this.selectIndex].activityID];e&&(3==e.activityType?this.setOpenIndex(this.selectIndex):Activity.ins().sendChangePage(this.activityPanelList[this.selectIndex].activityID))}},e.prototype.ChangePageCallBack=function(){this.setOpenIndex(this.selectIndex)},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.menuList.scrollH>=this.menuList.contentWidth-this.menuList.width-46?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.viewStack.numElements<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.leftRed.visible=this.leftBtn.visible,this.rightRed.visible=this.rightBtn.visible},e.prototype.onTouchBtn=function(t){var e=460,i=0;switch(t.target){case this.leftBtn:i=this.menuList.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.menuList.scrollH=i;break;case this.rightBtn:i=this.menuList.scrollH+e,i=92*Math.round(i/92),i>this.menuList.contentWidth-this.menuScroller.width&&(i=this.menuList.contentWidth-this.menuScroller.width),this.menuList.scrollH=i}this.onChange()},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.zeroUpdate=function(){var t=!1,e=Math.floor(GameServer.serverTime/1e3),i=0;for(var n in Activity.ins().activityData){if(Math.floor(DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).startTime)/1e3)==e||DateUtils.formatMiniDateTime(Activity.ins().getActivityDataById(+n).endTime)<=0){t=!0;break}i||i++}t&&this.updateView(),i||ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ActivityExWin.prototype,"ActivityExWin"),ViewManager.ins().reg(ActivityExWin,LayerManager.UI_Main),window.ActivityExWin=ActivityExWin;var BossScoreExchangeBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuBossBtnSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.id,e=this.data.index,i=GlobalConfig.ActivityType7Config[t][e];this.btnText.text=i.title+"转",this.redPoint.visible=Activity.ins().IsBossScoreTitle(i.Id,i.title)},e.prototype.destruct=function(){},e}(eui.ItemRenderer);__reflect(BossScoreExchangeBtn.prototype,"BossScoreExchangeBtn"),window.BossScoreExchangeBtn=BossScoreExchangeBtn;var BossScoreExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuBossItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.onClick=function(){if(egret.is(this.data,"ActivityType7Config")){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);if(e.bossScore<t.score)return void TipsCT.ins().showTips("|C:0xf3311e&T:积分不足|");if(!Activity.ins().getIsBuy(t))return void TipsCT.ins().showTips("|C:0xf3311e&T:已经兑换完|");Activity.ins().sendReward(t.Id,t.index)}},e.prototype.dataChanged=function(){if(egret.is(this.data,"ActivityType7Config")){var t=this.data,e=GlobalConfig.ItemConfig[t.rewards[0].id],i=Activity.ins().getActivityDataById(t.Id),n=i.bossScore,s=Activity.ins().getIsBuy(t);this.redPoint.visible=s&&n>=t.score,0==t.rewards[0].type?this.nameLab.text=RewardData.getCurrencyName(t.rewards[0].id):this.nameLab.text=e.name;var o=n<t.score?"#F3311E":"#35E62D";if(this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+o+"'>"+t.score+"</font>"),this.goBtn.currentState="up",this.goBtn.touchEnabled=!0,t.count){this.count.visible=!0;var a=t.count-i.personalRewardsSum[t.index];a=a>0?a:0,a||(this.goBtn.currentState="disabled",this.goBtn.touchEnabled=!1);var r=0>a?15937822:3532333;this.count.textFlow=TextFlowMaker.generateTextFlow1("|C:0x9F946D&T:剩余|C:"+r+"&T:"+a+"|C:0x9F946D&T:份")}else this.count.visible=!1;this.itemConfig=e,this.itemIcon0.data=t.rewards[0]}},e}(eui.ItemRenderer);__reflect(BossScoreExchangeItem.prototype,"BossScoreExchangeItem"),window.BossScoreExchangeItem=BossScoreExchangeItem;var BossScoreExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="hefuBossjifenSkin",this.equiplist.itemRenderer=BossScoreExchangeBtn,this.dataArr=new eui.ArrayCollection,this.exchangelist.dataProvider=this.dataArr,this.listData={},this.menuData=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.initMenu();var i=GlobalConfig.ActivityType7Config[this.activityID][1];i&&i.showType==ActivityType7Data.TYPE_RING?(this.currentState="lyring",this.exchangelist.itemRenderer=RingBossScoreExchangeItem):(this.currentState="hefu",this.equiplist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.exchangelist.itemRenderer=BossScoreExchangeItem),this.observe(Activity.ins().postRewardResult,this.onListChange),this.observe(Activity.ins().postChangePage,this.ChangePageCallBack),this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),i&&i.showType!=ActivityType7Data.TYPE_RING&&(this.equiplist.selectedIndex=this.currentSelect),this.refushInfo()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this)}},e.prototype.onListChange=function(){Activity.ins().sendChangePage(this.activityID)},e.prototype.ChangePageCallBack=function(){this.refushInfo()},e.prototype.initMenu=function(){var t=GlobalConfig.ActivityType7Config[this.activityID],e=-1,i=0;for(var n in t)i!=t[n].title&&(i=t[n].title,e++,this.menuData||(this.menuData=[]),this.menuData.push({id:t[n].Id,index:t[n].index})),this.listData[e]||(this.listData[e]=[]),this.listData[e].push(t[n])},e.prototype.refushInfo=function(){var t=Activity.ins().getActivityDataById(this.activityID);this.suipian.text=""+t.bossScore,this.dataArr.replaceAll(this.listData[this.currentSelect].concat()),this.exchangelist.validateNow();var e=GlobalConfig.ActivityType7Config[this.activityID][1];e&&e.showType!=ActivityType7Data.TYPE_RING&&(this.equiplist.dataProvider=new eui.ArrayCollection(this.menuData))},e.prototype.onTap=function(t){t&&t.itemRenderer&&t.item&&(this.currentSelect=t.itemIndex,this.refushInfo(),this.exchangelist.scrollV=0)},e}(BaseEuiView);__reflect(BossScoreExchangeWin.prototype,"BossScoreExchangeWin"),ViewManager.ins().reg(BossScoreExchangeWin,LayerManager.UI_Popup),window.BossScoreExchangeWin=BossScoreExchangeWin;var HefuAncientBossPanel=function(t){function e(){var e=t.call(this)||this;return e.openTime=[0,1,3,5],e._aryTime=[],e.skinName="hefuBoss",e.bossEffect=new MovieClip,e.bossEffect.scaleX=-1,e.bossEffect.scaleY=1,e.bossEffect.x=128,e.bossEffect.y=160,e.Boss.addChild(e.bossEffect),e.bossImage=new MovieClip,e.bossImage.scaleX=-1,e.bossImage.scaleY=1,e.bossImage.x=128,e.bossImage.y=160,e.Boss.addChild(e.bossImage),e.bossImg.visible=!1,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.goBtn,this.onTap),this.rewardList.itemRenderer=ItemBase,this.initView()},e.prototype.close=function(){},e.prototype.initView=function(){this._aryTime=[],this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var t,i,n=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),s="",o=0;for(i=0;i<this.openTime.length;i++)s.length>0&&(s+="、"),o=n+this.openTime[i]*DateUtils.MS_PER_DAY,t=new Date(o),s+=t.getMonth()+1+"月"+t.getDate()+"日",this._aryTime.push(t.getMonth()+1+"月"+t.getDate()+"日");s+="的"+e.timer+"开启",this.actTime.text=s;var a,r,l,h,u=!1,p=-1;for(i=this.openTime.length-1;i>=0;i--){if(o=n+this.openTime[i]*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(20,30,0),a=n+(this.openTime[i]+1)*DateUtils.MS_PER_DAY,r=new Date(a),0==i&&(l=t.getTime()),i==this.openTime.length-1&&(h=r.getTime()),!i){GameServer.serverTime>=t.getTime()&&(u=!0),p=i;break}var c=i-1;if(c>=0){var d=this.getBossConfig(i),g=d.killBossId;o=n+this.openTime[i]*DateUtils.MS_PER_DAY;var f=new Date(o);if(f.setHours(0,0,0),1!=CityCC.ins().bossKillNumData[g][1]&&GameServer.serverTime<f.getTime())continue;GameServer.serverTime>=t.getTime()&&(u=!0),p=i;break}}if(u)this.selectCurBoss(GlobalConfig.CityBossConfig[p+1].bossId,p);else if(GameServer.serverTime<l)p=-1,this.selectCurBoss(GlobalConfig.CityBossConfig[1].bossId,p);else if(GameServer.serverTime>=h)p=-2,this.selectCurBoss(GlobalConfig.CityBossConfig[4].bossId,p);else{var v=this.getBossConfig(p+1).bossId;this.selectCurBoss(v,p,!0)}var y;y=-1==p?1:-2==p?4:p+1;var m=GlobalConfig.CityBossConfig[y];m&&(this.rewardList.dataProvider=new eui.ArrayCollection(m.showReward))},e.prototype.selectCurBoss=function(t,i,n){void 0===n&&(n=!1);var s=GlobalConfig.MonstersConfig[t];if(i>=0){var o=GlobalConfig.CityBossConfig[i+1].bossId;s=GlobalConfig.MonstersConfig[o]}var a=GlobalConfig.EffectConfig[s.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+(s.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+a,-1);var r,l=Activity.ins().getActivityDataById(this.activityID);if(this.redPoint.visible=l.specialState(),i>=0)if(n)r=this._aryTime[i],this.time.text=r+(" "+e.timer),this._btnB=!1;else{r=this._aryTime[i],this.time.text=r+(" "+e.timer);var h=this.getBossConfig(i+1),u=h.killBossId;if(CityCC.ins().bossKillNumData&&void 0!=CityCC.ins().bossKillNumData[u]&&1!=CityCC.ins().bossKillNumData[u][1])this._btnB=!0;else if(this._btnB=!1,r=this._aryTime[i+1]){this.time.text=r+(" "+e.timer);var o=GlobalConfig.CityBossConfig[i+1].bossId;s=GlobalConfig.MonstersConfig[o];var p=GlobalConfig.EffectConfig[s.effect].fileName;this.bossImage.playFile(RES_DIR_MONSTER+(s.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+p,-1)}}else this._btnB=!1,-2==i?this.time.text="已结束":-1==i&&(r=this._aryTime[0]+("的"+e.timer+"开启"),this.time.text=r)},e.prototype.getBossConfig=function(t){return GlobalConfig.CityBossConfig[t]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:if(!this._btnB)return void TipsCT.ins().showTips("BOSS未开启，请准时参加");if(CityCC.ins().enterCD>0)return void TipsCT.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城");CityCC.ins().isCity?egret.callLater(function(){var t=ViewManager.ins().getView(BossBelongPanel);t&&t.attrBoss()},this):(CityCC.ins().isChallenge=!0,CityCC.ins().sendEnter()),ViewManager.ins().close(ActivityExWin)}},e.timer="20:30",e}(BaseView);__reflect(HefuAncientBossPanel.prototype,"HefuAncientBossPanel"),window.HefuAncientBossPanel=HefuAncientBossPanel;var HefuLCZBPanel=function(t){function e(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=t.call(this)||this;return n.openTime=[3,5,7],n.skinName="hefuLongchengSkin",n}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.go,this.onTap),this.observe(GuildWar.ins().postHeFuBelong,this.updateBelongs),GuildWar.ins().sendHeFuBelong(),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.go,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.go:0!=Guild.ins().guildID?(ViewManager.ins().close(ActivityExWin),GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(GuildMap),ViewManager.ins().open(GuildWarMainWin)):TipsCT.ins().showTips("还没加入行会")}},e.prototype.updateData=function(){this.actInfo.text=GlobalConfig.ActivityBtnConfig[this.activityID].acDesc;var t,e,i=GlobalConfig.GuildBattleConst.hefuOpen,n=DateUtils.formatMiniDateTime(GameServer._serverHeZeroTime),s="",o=0;for(e=0;e<i.length;e++){s.length>0&&(s+="、"),o=n+(i[e].day-1)*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(i[e].hours,i[e].min||0,0,0);var a=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()+"";s+=t.getMonth()+1+"月"+t.getDate()+"日"+t.getHours()+":"+a}this.actTime.text=s;var r,l,h,u=!1,p=0,c=0;for(e=0;e<i.length;e++)if(o=n+(i[e].day-1)*DateUtils.MS_PER_DAY,c=n+i[e].day*DateUtils.MS_PER_DAY,t=new Date(o),t.setHours(i[e].hours,i[e].min||0,0,0),l=new Date(c),l.setHours(0,0,0),0==e&&(r=t.getTime()),e==i.length-1&&(h=l.getTime()),GameServer.serverTime>=t.getTime()&&GameServer.serverTime<l.getTime()){u=!0,p=e;break}u?this.over.visible=!1:(this.over.visible=!0,GameServer.serverTime<r?this.over.text="未开启":GameServer.serverTime>=h?this.over.text="已结束":this.over.text="未开启"),this.go.visible=!this.over.visible;var d=GlobalConfig.GuildBattleConst.hefuAwardc.leader,g=d.award;this.list0.itemRenderer=ItemBase,this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase,this.list0.dataProvider=new eui.ArrayCollection(g[0]),this.list1.dataProvider=new eui.ArrayCollection(g[1]),this.list2.dataProvider=new eui.ArrayCollection(g[2])},e.prototype.updateBelongs=function(){for(var t=0;3>t;t++)GuildWar.ins().GuildNameBelongs[t]?(this["guild"+t].visible=!0,this["guild"+t].text="归属:"+GuildWar.ins().GuildNameBelongs[t]):this["guild"+t].visible=!1},e}(BaseView);__reflect(HefuLCZBPanel.prototype,"HefuLCZBPanel"),window.HefuLCZBPanel=HefuLCZBPanel;var HefuXunbaoPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="hefuXunbao",e}return __extends(e,t),e.prototype.addDisplay=function(){Timer.has(this.updateData,this)||Timer.start(1e3,0,this.updateData,this),this.initData()},e.prototype.removeDisplay=function(){Timer.stop(this.updateData,this)},e.prototype.skinComplete=function(){this.addTouchEvent(this.goBtn,this.onTap)},e.prototype.open=function(){var t=GlobalConfig.ActivityBtnConfig[this.activityID];t.pageSkin&&(this._sn_=t.pageSkin)},e.prototype.initData=function(){this.updateData();var t=GlobalConfig.ActivityBtnConfig[this.activityID];this.actDesc.textFlow=TextFlowMaker.generateTextFlow1(t.acDesc)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goBtn:ViewManager.ins().close(ActivityWin),ViewManager.ins().open(TreasureHuntWin)}},e.prototype.updateData=function(){var t=Activity.ins().getActivityDataById(this.activityID),e=Math.floor(t.startTime/1e3-GameServer.serverTime/1e3),i=Math.floor(t.endTime/1e3-GameServer.serverTime/1e3);e>=0?this.actTime.text="活动未开启":0>=i?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(HefuXunbaoPanel.prototype,"HefuXunbaoPanel"),window.HefuXunbaoPanel=HefuXunbaoPanel;var limitChangeItemRender=function(t){function e(){var e=t.call(this)||this;return e.actType=ActivityType.Normal,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase,this.get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){if(this._activityID=this.data[0],this._config=this.data[1],this.actType=this.data[5],this.slimit.visible=this.data[4]!=Number.MAX_VALUE,this._config.exValue&&(this.icon.source=GlobalConfig.ItemConfig[this._config.itemId].icon+"_png"),this.data[4]!=Number.MAX_VALUE){var t=this.data[4]?65280:16711680;this.limitchange0.textFlow=TextFlowMaker.generateTextFlow1("今日全服可兑换次数：|C:"+t+"&T:"+this.data[4])}if(this.data[3]==Number.MAX_VALUE)this.limitchange1.text="";else{var t=this.data[3]?65280:16711680;this.limitchange1.textFlow=TextFlowMaker.generateTextFlow1("可兑换：|C:"+t+"&T:"+this.data[3]+"|/"+this._config.count)}this._dataCollect||(this._dataCollect=new eui.ArrayCollection,this.reward.dataProvider=this._dataCollect),this._dataCollect.source=this._config.rewards,this.consnum.text=this._config.itemCount+"",this.get.enabled=this.data[2],this.redPoint.visible=this.get.enabled},e.prototype.onTap=function(t){return BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?void ViewManager.ins().open(BagFullTipsWin):void(this.actType==ActivityType.Personal?PActivity.ins().sendReward(this._activityID,this._config.index):Activity.ins().sendReward(this._activityID,this._config.index))},e.prototype.destruct=function(){this.get.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(limitChangeItemRender.prototype,"limitChangeItemRender"),window.limitChangeItemRender=limitChangeItemRender;var OSATarget7Panel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.open=function(){var t,e=this.activityID;if(this.activityType==ActivityType.Normal?t=GlobalConfig.ActivityType7Config[e]:this.activityType==ActivityType.Personal&&(t=GlobalConfig.PActivityType7Config[e]),!this.cruPanel||this.cruPanel.activityID!=this.activityID){this.cruPanel&&(this.cruPanel.close(),DisplayUtils.removeFromParent(this.cruPanel));var i=t[1].showType;this.cruPanel=ObjectPool.pop("OSATarget7Panel"+(i==ActivityType7Data.TYPE_RING||i==ActivityType7Data.TYPE_HEFUBOSS||i==ActivityType7Data.TYPE_CELEBREATE?1:i)),this.cruPanel.top=0,this.cruPanel.bottom=0,this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.activityID=this.activityID,this.addChild(this.cruPanel)}this.cruPanel.open()},e.prototype.close=function(){this.cruPanel&&this.cruPanel.close()},e.prototype.updateData=function(){this.cruPanel&&this.cruPanel.updateData&&this.cruPanel.updateData()},e}(ActivityPanel);__reflect(OSATarget7Panel.prototype,"OSATarget7Panel"),window.OSATarget7Panel=OSATarget7Panel;var OSATarget7Panel1=function(t){function e(){var e=t.call(this)||this;return e.skinName="hefuHalftimeBoss",e.bossMc=new MovieClip,e.bossGroup.addChild(e.bossMc),e.bossMc.x=e.bossGroup.x,e.bossMc.y=e.bossGroup.y,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateData()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.boss,this.onTap),this.addTouchEvent(this.costbtn,this.onTap),this.observe(Activity.ins().postRewardResult,this.GetCallBack),this.observe(Activity.ins().postChangePage,this.GetCallBack),Timer.start(1e3,0,this.setTime,this),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.boss,this.onTap),this.removeTouchEvent(this.costbtn,this.onTap),this.removeObserve(),Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boss:ViewManager.ins().open(BossWin,1);break;case this.costbtn:this.activityData&&ViewManager.ins().open(BossScoreExchangeWin,this.activityID)}},e.prototype.GetCallBack=function(t){this.updateData()},e.prototype.updateData=function(){var t=GlobalConfig.ActivityType7Config[this.activityID][1];t.showType==ActivityType7Data.TYPE_RING?this.currentState="lieyan":t.showType==ActivityType7Data.TYPE_HEFUBOSS?this.currentState="hefu":this.currentState="celebreate",this.validateNow();var e=GlobalConfig.ActivityBtnConfig[this.activityID];e&&(this.title.source=e.title),this.activityData=Activity.ins().getActivityDataById(this.activityID),this.setTime(),this.actDesc.text=GlobalConfig.ActivityConfig[this.activityID].desc;var i=Activity.ins().getActivityDataById(this.activityID);this.cost.text="积分:"+i.bossScore;var n="10002_3s";t.exValue&&(n=t.exValue),this.bossMc.playFile(RES_DIR_MONSTER+n,-1),this.redPoint.visible=Activity.ins().getType7RedPoint(this.activityID)},e.prototype.setTime=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.activityData.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.activityData.endTime)-GameServer.serverTime)/1e3);t>=0?this.actTime.text="活动未开启":0>=e?this.actTime.text="活动已结束":this.actTime.text=DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_5,3)},e}(BaseView);__reflect(OSATarget7Panel1.prototype,"OSATarget7Panel1"),window.OSATarget7Panel1=OSATarget7Panel1;var OSATarget7Panel3=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._matrailId=0,e._oldCount=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actType=ActivityPanel.getActivityTypeFromId(this.activityID),this.actType==ActivityType.Normal?(this.ins=Activity.ins(),this.cfgs=GlobalConfig.ActivityType7Config[this.activityID],this.actCfg=GlobalConfig.ActivityConfig[this.activityID]):this.actType==ActivityType.Personal&&(this.ins=PActivity.ins(),this.cfgs=GlobalConfig.PActivityType7Config[this.activityID],this.actCfg=GlobalConfig.PActivityConfig[this.activityID]),this.actInfo0.text=this.actCfg.desc,this.content.itemRenderer=limitChangeItemRender},Object.defineProperty(e.prototype,"activityID",{get:function(){return this._activityID},set:function(t){this._activityID=t,this.setCurSkin()},enumerable:!0,configurable:!0}),e.prototype.setCurSkin=function(){this.actCfg&&this.actCfg.pageSkin?this.skinName=this.actCfg.pageSkin:this.skinName="limitChangeSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setCurSkin(),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.updateData()},e.prototype.close=function(){this.removeObserve(),Timer.stop(this.setTime,this),this._leftTime=0,this._oldCount=0},e.prototype.updateData=function(){this._activityData=this.ins.getActivityDataById(this.activityID),this.checkTime(),this.updateList()},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagItemById(this._matrailId),e=t?t.count:0;e!=this._oldCount&&this.updateList()},e.prototype.updateList=function(){var t=this.cfgs;this._matrailId=t[1].itemId;var e=BagCT.ins().getBagItemById(this._matrailId),i=e?e.count:0;this.num.text=i+"",this._oldCount=i;var n,s=[],o=0,a=0,r=0,l=0;for(var h in t)n=t[h],l=void 0==n.scount||0==n.scount?Number.MAX_VALUE:n.scount-this._activityData.worldRewardsSum[o+1],r=void 0==n.count||0==n.count?Number.MAX_VALUE:n.count-this._activityData.personalRewardsSum[o+1],a=l&&r&&i>=n.itemCount?1:0,s[o]=[this.activityID,n,a,r,l,this.actType],o++;if(s.sort(this.sort),this._dataCollect||(this._dataCollect=new eui.ArrayCollection,this.content.dataProvider=this._dataCollect),s[0]){var u=s[0][1];this.icon.source=GlobalConfig.ItemConfig[u.itemId].icon+"_png"}this._dataCollect.replaceAll(s)},e.prototype.sort=function(t,e){return t[2]>e[2]?-1:t[2]<e[2]?1:t[1].index<e[1].index?-1:1},e.prototype.checkTime=function(){Timer.stop(this.setTime,this),this._leftTime=0,Math.floor((DateUtils.formatMiniDateTime(this._activityData.startTime)-GameServer.serverTime)/1e3)>=0?this.actTime0.text="活动未开启":(this._leftTime=Math.floor((DateUtils.formatMiniDateTime(this._activityData.endTime)-GameServer.serverTime)/1e3),this._leftTime<=0?this.actTime0.text="活动已结束":(this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),Timer.start(1e3,0,this.setTime,this)))},e.prototype.setTime=function(){this._activityData&&(this._leftTime=this._activityData.getLeftTime(),this.actTime0.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,3),this._leftTime<=0&&this.checkTime())},e}(BaseView);__reflect(OSATarget7Panel3.prototype,"OSATarget7Panel3"),window.OSATarget7Panel3=OSATarget7Panel3;var RingBossScoreExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ringBossItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=GlobalConfig.ItemConfig[t.rewards[0].id],i=Activity.ins().getActivityDataById(t.Id),n=i.bossScore,s=Activity.ins().getIsBuy(t);this.redPoint.visible=s&&n>=t.score,this.nameLab.text=e.name;var o=n<t.score?"#F3311E":"#35E62D";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+o+"'>"+n+"</font><font color = '#9F946D'>/"+t.score+"</font>"),this.itemConfig=e,this.itemIcon0.data=t.rewards[0],this.itemIcon0.hideName();var a=Activity.ins().getActivityDataById(t.Id),r=a.personalRewardsSum[t.index],l=t.count-r;l?this.count.text="剩余"+l+"份":this.count.text=""}},e.prototype.onClick=function(){if(this.data instanceof ActivityType7Config){var t=this.data,e=Activity.ins().getActivityDataById(t.Id);
if(e.bossScore<t.score)return void TipsCT.ins().showTips("|C:0xf3311e&T:积分不足|");if(!Activity.ins().getIsBuy(t))return void TipsCT.ins().showTips("|C:0xf3311e&T:已经兑换完|");Activity.ins().sendReward(t.Id,t.index)}},e}(eui.ItemRenderer);__reflect(RingBossScoreExchangeItem.prototype,"RingBossScoreExchangeItem"),window.RingBossScoreExchangeItem=RingBossScoreExchangeItem;var PActivity=function(t){function e(){var e=t.call(this)||this;return e.activityData={},e.palyEffList=[],e.hfLoginID=157,e.geLoginID=210,e.hfLoginDay=1,e.geLoginDay=1,e.isSuccee=!1,e.sysId=PackageID.PActivity,e.regNetMsg(1,e.doActivityData),e.regNetMsg(2,e.postRewardResult),e.regNetMsg(5,e.doRewardStatu),e.regNetMsg(6,e.postEnvelopeData),e.regNetMsg(7,e.postChangePage),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getZhanlingActivity=function(t){switch(+t){case 5003:case 5004:case 5005:case 5006:return!0}return!1},e.prototype.initZero=function(){if(this.activityData)for(var t in this.activityData){var e=+t;if(1e4>e){var i=GlobalConfig.ActivityConfig[t];i&&this.sendChangePage(e)}}},e.prototype.doActivityData=function(t){this.activityData={};for(var e=t.readShort(),i=0;e>i;i++){var n=PActivityDataFactory.create(t);if(n){var s=n.id;this.activityData[s]=n}}this.postActivityIsGetAwards()},e.prototype.postActivityIsGetAwards=function(){},e.prototype.postRewardResult=function(t){this.isSuccee=t.readBoolean();var e=t.readInt(),i=this.getActivityDataById(e);return i&&i instanceof ActivityType36Data?i.postRewardResult(t):this.getActivityDataById(e).update(t),this.postActivityPanel(e),this.postActivityIsGetAwards(),e},e.prototype.postActivityPanel=function(t){return t},e.prototype.sendReward=function(t,e,i){var n=this.getBytes(2),s=GlobalConfig.PActivityConfig[t];s&&s.activityType==PActivityDataFactory.PA_9?e?(n.writeInt(t),n.writeShort(e)):(n.writeInt(t),n.writeShort(e),n.writeByte(i)):(n.writeInt(t),n.writeShort(e),n.writeShort(i||0)),this.sendToServer(n)},e.prototype.sendRewardStatu=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.doRewardStatu=function(t){var e=t.readInt(),i=this.getActivityDataById(e);i?i.id==this.hfLoginID?(i.updateData(t),this.hfLoginDay=i.logTime):i.id==this.geLoginID?(i.updateData(t),this.geLoginDay=i.logTime):i.updateData(t):(i=new ActivityType5Data(null),this.activityData[e]=i,i.updateData(t)),this.postActivityIsGetAwards()},e.prototype.sendEnvelopeData=function(t,e){var i=this.getBytes(6);i.writeInt(t),i.writeUnsignedShort(e),this.sendToServer(i)},e.prototype.postEnvelopeData=function(t){var e=t.readInt(),i=this.getActivityDataById(e);if(i instanceof ActivityType12Data){var n=t.readByte();if(n){var s=t.readUnsignedShort(),o=t.readShort(),a=t.readShort(),r=t.readShort(),l=t.readInt(),h=t.readString(),u=t.readString(),p=new EnvelopeData;return p.id=e,p.eId=s,p.job=o,p.sex=a,p.index=r,p.serverId=l,p.name=h,void(p.desc=u)}}else i instanceof ActivityType36Data?i.postlog(t):(i.update(t),this.postActivityIsGetAwards())},e.prototype.postChangePage=function(t){var e=PActivityDataFactory.create(t);return e&&(this.activityData[e.id]=e),this.postActivityIsGetAwards(),e?e.id:0},e.prototype.sendChangePage=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.getActivityDataById=function(t){return this.activityData[t]},e.prototype.setPalyEffListById=function(t,e){this.palyEffList[t]=e},e.prototype.getPalyEffListById=function(t){return this.palyEffList[t]},e.prototype.getbtnInfo=function(t){var e=GlobalConfig.PActivityBtnConfig;return e[t]?e[t]:null},e.prototype.isShowRedPointByBtnInfo=function(t){var e=!1;return e=this.checkAcCanGet(t.id+"")},e.prototype.checkAcCanGet=function(t){var e=this.activityData;for(var i in e)if(i==t&&e[i].isOpenActivity()&&e[i].canReward()&&e[i].specialState())return!0;return!1},e.prototype.getType9RedPoint=function(t){var e=!1;if(this.getRollSum(t))e=!0;else{var i=GlobalConfig.PActivityType9Config[t];for(var n in i[0].reward)if(this.isGetRollReward(t,+n)){e=!0;break}}return e},e.prototype.isGetRollReward=function(t,e){var i=this.activityData[t],n=GlobalConfig.PActivityType9Config[t];return n&&n[0]&&n[0].reward[e].times&&i.count>=n[0].reward[e].times&&!(i.record>>e+1&1)?!0:!1},e.prototype.getRollSum=function(t){var e=GlobalConfig.PActivityType9Config[t];if(e&&e[0]){var i=BagCT.ins().getBagItemById(e[0].item);if(i)return!0}return!1},e.prototype.getIsRollTen=function(t){var e=GlobalConfig.PActivityType9Config[t][0];if(!e)return!1;var i=0;if(e.item){var n=BagCT.ins().getBagItemById(e.item);if(n&&(i+=n.count),i>=10)return!0}return i=10-i,e.yb&&Actor.yb>=e.yb*i?!0:void 0},e.prototype.getIsBuy=function(t){if(t){var i=e.ins().getActivityDataById(t.Id);return t.count&&i.personalRewardsSum[t.index]>=t.count?!1:t.scount&&i.worldRewardsSum[t.index]>=t.scount?!1:!0}},e.prototype.getType7RedPoint=function(t){var i,n=GlobalConfig.PActivityType7Config[t],s=e.ins().getActivityDataById(t);for(var o in n)if(e.ins().getIsBuy(n[o]))if(n[o].itemId){if(i=BagCT.ins().getBagItemById(n[o].itemId),i&&i.count>=n[o].itemCount)return!0}else if(s.bossScore>=n[o].score)return!0;return!1},e.prototype.getType10RedPoint=function(t){var i=e.ins().activityData[t],n=GlobalConfig.PActivityType10Config[t][i.getLevel()];return n&&i.yb>=n.recharge&&Actor.yb>=n.yuanBao?!0:!1},e.NotReached=0,e.CanGet=1,e.Geted=2,__decorate([post()],e.prototype,"postActivityIsGetAwards",null),__decorate([post()],e.prototype,"postRewardResult",null),__decorate([post()],e.prototype,"postActivityPanel",null),__decorate([post()],e.prototype,"postEnvelopeData",null),__decorate([post()],e.prototype,"postChangePage",null),e}(BaseSystem);__reflect(PActivity.prototype,"PActivity"),System.PActivity=function(){return PActivity.ins()},window.PActivity=PActivity;var PActivityDataFactory=function(){function t(){}return t.create=function(e){var i,n=e.readInt(),s=e.readInt(),o=e.readInt(),a=e.readShort(),r=e.readInt();switch(a){case t.PA_1:i=new PActivityType1Data(e);break;case t.PA_2:i=new PActivityType2Data(e);break;case t.PA_3:i=new PActivityType3Data(e);break;case t.PA_5:i=new PActivityType5Data(e);break;case t.PA_7:i=new PActivityType7Data(e);break;case t.PA_9:i=new PActivityType9Data(e);break;case t.PA_10:i=new PActivityType10Data(e);break;case t.PA_11:i=new PActivityType11Data(e,n,s,o);break;case t.PA_36:i=new PActivityType36Data(e);break;case t.PA_42:i=new PActivityType42Data(e);break;case t.PA_50:i=new PActivityType50Data(e,n,s,o);break;case t.PA_53:i=new PActivityType53Data(e,n);break;case t.PA_55:i=new PActivityType55Data(e,n,s,o);break;default:if(!ErrorLog.Assert(a,"错误个人活动:"+n+" 类型:"+a))for(var l=0;r>l;l++)e.readByte();return null}if(!i)return null;i.id=n,i.startTime=s,i.endTime=o,i.type=a,i.activityType=ActivityType.Personal;var h=GlobalConfig.PActivityConfig[n];return h&&(i.duration=h.duration,i.pageStyle=h.pageStyle),i},t.PA_1=1,t.PA_2=2,t.PA_3=3,t.PA_5=5,t.PA_7=7,t.PA_9=9,t.PA_10=10,t.PA_11=11,t.PA_36=36,t.PA_42=42,t.PA_50=50,t.PA_53=53,t.PA_55=55,t}();__reflect(PActivityDataFactory.prototype,"PActivityDataFactory"),window.PActivityDataFactory=PActivityDataFactory;var PActivityType10Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType10Data);__reflect(PActivityType10Data.prototype,"PActivityType10Data"),window.PActivityType10Data=PActivityType10Data;var PActivityType11Data=function(t){function e(e,i,n,s){return t.call(this,e,i,n,s,ActivityType.Personal)||this}return __extends(e,t),e}(ActivityType11Data);__reflect(PActivityType11Data.prototype,"PActivityType11Data"),window.PActivityType11Data=PActivityType11Data;var PActivityType1Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType1Data);__reflect(PActivityType1Data.prototype,"PActivityType1Data"),window.PActivityType1Data=PActivityType1Data;var PActivityType2Data=function(t){function e(e){var i=t.call(this,e)||this;return i.buyData=[],i.serverBuyData=[],i.initBuyData(e),i}return __extends(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e);var i=e.readShort(),n=e.readInt();this.buyData[i]=n,this.serverBuyData[i]=e.readInt()},e.prototype.initBuyData=function(t){for(var e=t.readShort(),i=1;e>=i;i++)this.buyData[i]=t.readShort(),this.serverBuyData[i]=t.readShort();this.sumRMB=t.readInt()},e.prototype.canReward=function(){if(Actor.level<e.LimitLevel)return!1;var t;t=PActivity.ins().getActivityDataById(this.id);var i=GlobalConfig.PActivity2Config[this.id],n=!1;for(var s in i){var o=i[s],a=t.buyData[o.index]>=o.count;if(!a&&t.sumRMB>=o.needRecharge&&Actor.yb>=o.price&&Actor.vip>=o.vip&&!n)return!0}return!1},e.prototype.isOpenActivity=function(){var t=Math.floor((DateUtils.formatMiniDateTime(this.startTime)-GameServer.serverTime)/1e3),e=Math.floor((DateUtils.formatMiniDateTime(this.endTime)-GameServer.serverTime)/1e3);return 0>t&&e>0},e.prototype.getHide=function(){if(this.isHide)return this.isHide;for(var t=GlobalConfig.PActivity2Config[this.id],e=1;e<this.buyData.length;e++){var i=t[e];if(this.buyData[e]<i.count)return this.isHide=!1,this.isHide}return this.isHide=!0,this.isHide},e.prototype.getLeftTime=function(){if(this.endTime){var t=DateUtils.formatMiniDateTime(this.endTime),e=Math.floor((t-GameServer.serverTime)/1e3);return 0>e&&(e=0),e}return 0},e.prototype.getAreaReward=function(t,e){return 0},e.LimitLevel=50,e}(ActivityBaseData);__reflect(PActivityType2Data.prototype,"PActivityType2Data"),window.PActivityType2Data=PActivityType2Data;var PActivityType36Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType36Data);__reflect(PActivityType36Data.prototype,"PActivityType36Data"),window.PActivityType36Data=PActivityType36Data;var PActivityType3Data=function(t){function e(e){var i=t.call(this,e)||this;return i.actCfg=GlobalConfig.PActivity3Config,i}return __extends(e,t),e.prototype.curOpenDay=function(){var t=Math.floor((GameServer.serverTime-DateUtils.formatMiniDateTime(this.startTime))/1e3/3600/24);return t},e}(ActivityType3Data);__reflect(PActivityType3Data.prototype,"PActivityType3Data"),window.PActivityType3Data=PActivityType3Data;var PActivityType42Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType42Data);__reflect(PActivityType42Data.prototype,"PActivityType42Data"),window.PActivityType42Data=PActivityType42Data;var PActivityType5Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType5Data);__reflect(PActivityType5Data.prototype,"PActivityType5Data"),window.PActivityType5Data=PActivityType5Data;var PActivityType7Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType7Data);__reflect(PActivityType7Data.prototype,"PActivityType7Data"),window.PActivityType7Data=PActivityType7Data;var PActivityType9Data=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e}(ActivityType9Data);__reflect(PActivityType9Data.prototype,"PActivityType9Data"),window.PActivityType9Data=PActivityType9Data;var Artifact=function(t){function e(){var e=t.call(this)||this;return e.listArtifacts={},e.showGuide=-2e3,e.openHeji=0,e.attArr=["a","args","b","cd","crit","d","selfEff"],e.sysId=PackageID.Artifact,e.regNetMsg(3,e.postNewArtifactInit),e.regNetMsg(4,e.postNewArtifactUpdate),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getNewArtifactPower=function(t){var e=GlobalConfig.ImbaConf[t],i=this.listArtifacts[e.id];if(!i)return 0;for(var n=!0,s=0,o=0;o<e.jigsawId.length;o++){var a=i.record>>o&1;a?s+=GlobalConfig.ImbaJigsawConf[e.jigsawId[o]].power:n=!1}return i.open&&(s+=e.power),s},e.prototype.getAttr=function(){var t={};for(var e in GlobalConfig.ImbaConf){for(var i=GlobalConfig.ImbaConf[e],n=this.getNewArtifactBy(i.index),s=0;s<i.jigsawId.length;s++){var o=n.record>>s&1;if(o)for(var a=GlobalConfig.ImbaJigsawConf[i.jigsawId[s]],r=0,l=a.attrs;r<l.length;r++){var h=l[r];AttributeData.addAttrToList(t,h)}}if(n.open&&i.attrs)for(var u=0,p=i.attrs;u<p.length;u++){var h=p[u];AttributeData.addAttrToList(t,h)}}var c=[];for(var d in t)c.push(t[d]);return c.sort(AttributeData.sortAttribute),c},e.prototype.getArtifactIndexById=function(t){for(var e in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[e].id==t)return GlobalConfig.ImbaConf[e].index;return 0},e.prototype.getNewArtifactBy=function(t){var e=0;if(!GlobalConfig.ImbaConf[t])return null;if(e=GlobalConfig.ImbaConf[t].id,!this.listArtifacts[e]){var i=new NewArtifactData;i.id=e,i.record=0,this.listArtifacts[e]=i}return this.listArtifacts[e]},e.prototype.getMaxIndex=function(){if(!this.maxIndex){var t=1,e=GlobalConfig.ImbaConf;for(var i in e)t=Math.max(e[i].index,t);this.maxIndex=t}return this.maxIndex},e.prototype.getConfById=function(t){var e=GlobalConfig.ImbaConf;for(var i in e)if(e[i].id==t)return e[i]},e.prototype.showRedPoint=function(){for(var t=this.getMaxIndex(),e=1;t>=e;e++){var i=GlobalConfig.ImbaConf[e],n=this.getNewArtifactBy(e);if(!n.open){var s=i.jigsawId.length,o=Math.pow(2,s)-1;if(o==n.record)return!0;if(n.exitRecord!=n.record)return!0}}return!1},e.prototype.getConfByChipId=function(t){var e=GlobalConfig.ImbaConf;for(var i in e)if(-1!=e[i].jigsawId.indexOf(t))return e[i];return null},e.prototype.setGuide=function(){this.showGuide=egret.getTimer(),this.postGuide(),Timer.stop(this.guideEnd,this),Timer.start(3e3,1,this.guideEnd,this)},e.prototype.guideEnd=function(){e.ins().showGuide=-3e3,e.ins().postGuide()},e.prototype.postGuide=function(){},e.prototype.postNewArtifactInit=function(t){var e=t.readUnsignedShort();this.artifactsOpenDic={};for(var i=0;e>i;i++){var n=new NewArtifactData;n.id=t.readInt(),n.record=t.readInt(),n.open=0!=t.readByte(),n.open?(n.exitRecord=Math.pow(2,32)-1,1==e&&1==this.openHeji&&(this.openHeji=2)):n.exitRecord=t.readInt(),this.listArtifacts[n.id]=n,n.open&&(this.artifactsOpenDic[n.id]=n)}this.setImbaBuffDic()},e.prototype.setImbaBuffDic=function(){if(!this.imbaBuffDic){this.imbaBuffDic={};var t=GlobalConfig.ImbaSkillReviseConfig;for(var e in t){var i=t[e],n=i.skill,s=i.imba_id;this.imbaBuffDic[n]||(this.imbaBuffDic[n]={}),this.imbaBuffDic[n][s]||(this.imbaBuffDic[n][s]={}),this.imbaBuffDic[n][s]=i}}var o=CommonUtils.getObjectLength(this.artifactsOpenDic);if(o){this.imbaSkillDic={};for(var a in this.imbaBuffDic){var r=this.imbaBuffDic[a];for(var l in r)if(this.artifactsOpenDic[l]){var i=r[l];this.imbaSkillDic[a]||(this.imbaSkillDic[a]={id:0,skill:0,imba_id:0,a:0,b:0,cd:0,d:0,crit:0,affectCount:0,selfEff:[],targetEff:[],args:{}});var h=this.imbaSkillDic[a];for(var u in h)-1!=this.attArr.indexOf(u)&&i[u]&&("selfEff"==u?(h.selfEff||(h.selfEff=[]),h.selfEff.push(i.selfEff[0])):"args"==u?h.args=i.args:h[u]=i[u])}}}},e.prototype.getReviseBySkill=function(t){if(!this.imbaSkillDic)return null;var e=Math.floor(t/1e3);return this.imbaSkillDic[e]?this.imbaSkillDic[e]:null},e.prototype.postNewArtifactUpdate=function(t){var e=t.readInt(),i=this.listArtifacts[e];if(i){var n=i.exitRecord;i.exitRecord=t.readInt(),i.record=t.readInt();for(var s=i.exitRecord-n,o=this.getConfById(e),a=0;a<o.jigsawId.length;a++){var r=s>>a&1;if(r){var l=new ItemData;l.configID=o.jigsawId[a]}}}else{var h=new NewArtifactData;h.id=e,h.exitRecord=t.readInt(),h.record=t.readInt(),this.listArtifacts[e]=h}},e.prototype.sendOpenChip=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.openArtifact=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e),0==this.openHeji&&(this.openHeji=1)},__decorate([post()],e.prototype,"postGuide",null),__decorate([post()],e.prototype,"postNewArtifactInit",null),__decorate([post()],e.prototype,"postNewArtifactUpdate",null),e}(BaseSystem);__reflect(Artifact.prototype,"Artifact"),System.Artifact=function(){return Artifact.ins()},window.Artifact=Artifact;var ArtifactData=function(){function t(){this.id=0,this.rank=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.rank=t.readShort()},t}();__reflect(ArtifactData.prototype,"ArtifactData"),window.ArtifactData=ArtifactData;var NewArtifactData=function(){function t(){this.id=0,this.record=0,this.open=!1,this.exitRecord=0}return t.prototype.isChipExit=function(t){return 1==(this.exitRecord>>t&1)},t.prototype.remindNumToOpen=function(){for(var t=this.getConf(),e=0,i=0;i<t.jigsawId.length;i++)this.isChipExit(i)||e++;return e},t.prototype.getConf=function(){for(var t in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[t].id==this.id)return GlobalConfig.ImbaConf[t]},t}();__reflect(NewArtifactData.prototype,"NewArtifactData"),window.NewArtifactData=NewArtifactData;var ArtifactAllAttrWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiAttrskin",e.list.itemRenderer=ArtifactAttrDescItem,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.rect,this.onTap),this.list.dataProvider=new eui.ArrayCollection(Artifact.ins().getAttr())},e.prototype.close=function(){},e.prototype.onTap=function(t){switch(t.target){case this.rect:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ArtifactAllAttrWin.prototype,"ArtifactAllAttrWin"),ViewManager.ins().reg(ArtifactAllAttrWin,LayerManager.UI_Popup),window.ArtifactAllAttrWin=ArtifactAllAttrWin;var ArtifactAttrDescItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenQiAttrDescSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=AttributeData.getAttStrByType(t,0,"：");this.labelInfo.text=e},e}(eui.ItemRenderer);__reflect(ArtifactAttrDescItem.prototype,"ArtifactAttrDescItem"),window.ArtifactAttrDescItem=ArtifactAttrDescItem;var ArtifactChipOpenWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiPartActskin",e.list.itemRenderer=ArtifactAttrDescItem,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[1],this.mId=t[0],this.openTips(this.mId),this.addTouchEvent(this.btnOpen,this.onTap)},e.prototype.close=function(){},e.prototype.openTips=function(t){var e=Artifact.ins().getNewArtifactBy(this.index),i=GlobalConfig.ImbaJigsawConf[t];this.list.dataProvider=new eui.ArrayCollection(i.attrs),this.imgArtifact.source=i.img,this.labelInfo.text="再获得"+e.remindNumToOpen()+"个碎片可激活完整神器",this.labelName.text=i.name},e.prototype.onTap=function(t){switch(t.target){case this.btnOpen:Artifact.ins().sendOpenChip(this.mId),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ArtifactChipOpenWin.prototype,"ArtifactChipOpenWin"),ViewManager.ins().reg(ArtifactChipOpenWin,LayerManager.UI_Popup),window.ArtifactChipOpenWin=ArtifactChipOpenWin;var ArtifactConditionItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ArtifactsItemSkin",e.go.addEventListener(egret.TextEvent.LINK,e.onGo,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.taskId,e=TaskCT.ins().getAchieveByTaskId(t);this.config=TaskCT.ins().getAchieveConfById(e.id);var i;e.value>=this.config.target?(i="0x35e62d",this.go.visible=!1,this.complete.visible=!0):(i="0xf3311e",this.go.textFlow=(new egret.HtmlTextParser).parser("<a href='event:' color=0x35e62d><u>前往</u></a>"),this.go.visible=!0,this.complete.visible=!1,void 0==this.config.controlTarget&&(this.go.visible=!1));var n=this.config.name+"(<font color="+i+">"+e.value+"</font>/"+this.config.target+")";this.desc.textFlow=(new egret.HtmlTextParser).parser(n)},e.prototype.destruct=function(){this.go.removeEventListener(egret.TextEvent.LINK,this.onGo,this)},e.prototype.onGo=function(){void 0==this.config.controlTarget?new Error("配置表没有配跳转界面ID"):(ViewManager.ins().close(this.config.controlTarget[0].toString()),ViewManager.ins().open(this.config.controlTarget[0].toString(),[this.config.controlTarget[1]]))},e}(BaseItemRender);__reflect(ArtifactConditionItemRenderer.prototype,"ArtifactConditionItemRenderer"),window.ArtifactConditionItemRenderer=ArtifactConditionItemRenderer;var ArtifactSuiItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqiItemskin",e}return __extends(e,t),e.prototype.dataChanged=function(){""==this.data.name?(this.itemImg.visible=!1,this.labelMaterial.visible=!1,this.closeImg.visible=!0):(this.data.state?this.labelMaterial.textColor=3532333:this.labelMaterial.textColor=12434877,this.data.state2?(this.mc||(this.mc=new MovieClip,this.mc.x=0,this.mc.y=0,this.mc.scaleY=.6),this.groupMc.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):this.mc&&DisplayUtils.removeFromParent(this.mc),this.itemImg.visible=!0,this.labelMaterial.visible=!0,this.closeImg.visible=!1,this.itemImg.source=this.data.img,this.labelMaterial.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.data.name+"</u>"))},e}(BaseItemRender);__reflect(ArtifactSuiItemRenderer.prototype,"ArtifactSuiItemRenderer"),window.ArtifactSuiItemRenderer=ArtifactSuiItemRenderer;var NewArtifactWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrImage=[],e.expBarEff=new ProgressBarEff,e}return __extends(e,t),e.prototype.skinComplete=function(){this.index=1,this.addTouchEvent(this,this.onTap),this.beginY=this.imgArtfact.y,this.mc=new MovieClip,this.groupEff.addChild(this.mc),this.mc.x=0,this.mc.y=0,this.mc.playFile(RES_DIR_EFF+"Projection",-1),this.list.itemRenderer=ArtifactAttrDescItem,this.turnicon.textFlow=(new egret.HtmlTextParser).parser("<u>查看合击</u>"),this.eff=new MovieClip,this.eff.x=65,this.eff.y=25,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.addBarEff()},e.prototype.addDisplay=function(){this.observe(Artifact.ins().postNewArtifactUpdate,this.updateView),this.observe(Artifact.ins().postNewArtifactInit,this.updateView),this.getGuideTips(),this.updateView()},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.eff),this.groupMaterial&&egret.Tween.removeTweens(this.groupMaterial),ViewManager.ins().close(ArtifactChipOpenWin)},e.prototype.onTap=function(t){if(this.isBtnOpen=!1,t.target.parent instanceof ArtifactSuiItemRenderer){var e=t.target.parent.data.index;return void(isNaN(e)||this.openTips(e))}switch(t.target){case this.imgLeft:if(1==this.index)break;this.index--,this.updateView();break;case this.imgRight:this.index<Artifact.ins().getMaxIndex()&&this.getIsNext()&&this.index++,this.updateView();break;case this.btnOpen:this.isBtnOpen=!0,Artifact.ins().openArtifact(this.index);break;case this.detail:ViewManager.ins().open(ArtifactAllAttrWin);break;case this.turnicon:var i=GlobalConfig.ImbaConf[this.index];i&&i.winGuide&&(GameGuider.guidance(i.winGuide[0],i.winGuide[1]),"LiLianWin"!=i.winGuide[0]&&ViewManager.ins().close(LiLianWin));break;case this.button:if(FbCT.ins().currentEnergy>=FbCT.ins().energy){GameGuider.challengeBoss(function(){ViewManager.ins().close(LiLianWin)})}else TipsCT.ins().showTips("能量未满无法挑战，请继续清怪。")}},e.prototype.getIsNext=function(){if(1==this.index)return!0;var t=this.index-1,e=Artifact.ins().getNewArtifactBy(t);return e.open},e.prototype.updateView=function(){if(this.skin){var t=GlobalConfig.ImbaConf[this.index],e=Artifact.ins().getNewArtifactBy(this.index);e&&e.open&&t.turnDesc?(this.turnicon.visible=!0,this.turnicon.textFlow=(new egret.HtmlTextParser).parser("<u>"+t.turnDesc+"</u>")):this.turnicon.visible=!1,this.imgArtfact.y=this.beginY,this.imgOpen.visible=!e.open,this.imgName.source=t.imgName;var i="",n=0;for(var s in t.attrs)n++;if(t.attrs&&(i=AttributeData.getAttStr(t.attrs,1)),null!=t.exattrs)for(var s in t.exattrs)i+="\n",i+=AttributeData.getExtAttStrByType(t.exattrs[s],1),n++;this.labelAttr.text=t.funcDesc,this.imgFunc.source=t.simpleDesc;for(var o=[],a=Artifact.ins().getNewArtifactBy(this.index),r=0,l=!1,h=0;8>h;h++){var u=a.record>>h&1,p=a.exitRecord>>h&1&&0==u,c={};c.state=u,c.state2=p;var d=t.jigsawId[h],g="",f="";null==d?(g="",f=""):(g=GlobalConfig.ImbaJigsawConf[d].name,f=GlobalConfig.ImbaJigsawConf[d].img,r++),c.name=g,c.index=d,c.img=f,!l&&p&&(l=!0),o.push(c)}if(r=r>2?r:2,this.pieceCom.setData(r),this.pieceCom.listDP.source=o,this.powerPanel.setPower(Artifact.ins().getNewArtifactPower(this.index)),this.imgLeft.visible=1!=this.index,this.imgRight.visible=this.index<Artifact.ins().getMaxIndex()&&this.getIsNext(),this.getGuideMaterialId(this.index)?(this.imgArtfact.source=t.imgShadow,this.setMaterialImg(),this.groupEff.visible=!1,this.currentState=FbCT.ins().guanqiaID>1e5||l?"normal":"nothing",this.updateNothingUI(),DisplayUtils.removeFromParent(this.eff),egret.Tween.removeTweens(this.groupMaterial),this.groupMaterial.x=42,this.groupMaterial.y=101):e.open?(this.imgArtfact.source=t.img,this.cleanMaterialImg(),this.groupEff.visible=!0,this.currentState="normal",DisplayUtils.removeFromParent(this.eff),this.artifactTween()):(this.imgArtfact.source=t.imgShadow,this.setMaterialImg(),this.groupEff.visible=!1,this.currentState="open",this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.parent||this.actGroup.addChild(this.eff),egret.Tween.removeTweens(this.groupMaterial),this.groupMaterial.x=42,this.groupMaterial.y=101),e.open&&this.isBtnOpen){var v=t.img.split("_"),f=v[0]+"_"+v[1];Activationtongyong.show(0,t.name,"j"+f+"_png",!0,function(){t.winGuide&&(ViewManager.ins().open(t.winGuide[0],t.winGuide[1]),"LiLianWin"!=t.winGuide[0]&&ViewManager.ins().close(LiLianWin))})}}},e.prototype.addBarEff=function(){this.expBarEff.setWidth(this.eExpGroup.width),this.eExpGroup.addChild(this.expBarEff)},e.prototype.updateNothingUI=function(){if("nothing"==this.currentState){var t=FbCT.ins().getNewChapter();if(t){var e=FbCT.ins().getDiffChapter(),i=t.needLevel,n=FbCT.ins().guanqiaID-i-1;n=n>0?n:0,this.guanqiaDes1.text=FbCT.ins().getNextNeedChapter()+"";var s=FbCT.ins().getNextReward(),o=GlobalConfig.ItemConfig[s[0].id];this.artifactName.text=o.name,this.expBarEff.setData(n,e,!0),this.prossX=0;var a=this.btnbar.localToGlobal();this.btnbar.parent.globalToLocal(a.x,a.y,a),this.masksp=new egret.Sprite;var r=new egret.Shape;r.graphics.beginFill(16777215),r.graphics.drawRect(a.x,a.y,this.btnbar.width,this.btnbar.height),r.graphics.endFill(),this.prossX=a.x-this.btnbar.width,this.masksp.y=a.y,this.masksp.addChild(r),this.btnbar.parent.addChild(this.masksp),this.btnbar.mask=this.masksp}}},e.prototype.artifactTween=function(){var t=egret.Tween.get(this.groupMaterial,{loop:!0});t.to({y:60},1e3).to({y:101},1e3)},e.prototype.getGuideTips=function(){for(var t=Artifact.ins().getMaxIndex(),e=1;t>=e;e++){var i=Artifact.ins().getNewArtifactBy(e);if(this.index=e,!i.open)break}},e.prototype.getGuideMaterialId=function(t){for(var e=GlobalConfig.ImbaConf[t],i=Artifact.ins().getNewArtifactBy(t),n=0,s=0;s<e.jigsawId.length;s++){var o=i.record>>s&1;if(1!=o){n=e.jigsawId[s];break}}return n},e.prototype.openTips=function(t){var e=Artifact.ins().getNewArtifactBy(this.index),i=GlobalConfig.ImbaConf[this.index],n=i.jigsawId.indexOf(t),s=e.record>>n&1,o=e.exitRecord>>n&1&&!s;this.parttips.visible=!1,o?ViewManager.ins().open(ArtifactChipOpenWin,t,this.index):ViewManager.ins().open(shenqispTipsWin,t,this.index)},e.prototype.setMaterialImg=function(){this.cleanMaterialImg();for(var t=GlobalConfig.ImbaConf[this.index],e=Artifact.ins().getNewArtifactBy(this.index),i=0;i<t.jigsawId.length;i++){var n=e.record>>i&1;if(!this.arrImage[i]){var s=new eui.Image;this.arrImage.push(s),this.groupMaterial.addChild(s)}if(1==n){var o=GlobalConfig.ImbaJigsawConf[t.jigsawId[i]];this.arrImage[i].source=o.img,this.arrImage[i].visible=!0,this.arrImage[i].x=o.point.x,this.arrImage[i].y=o.point.y}}},e.prototype.cleanMaterialImg=function(){for(var t=0;t<this.arrImage.length;t++)this.arrImage[t].visible=!1},e.prototype.onLink=function(t){var e=parseInt(t.item.index);isNaN(e)||this.openTips(e)},e}(BaseView);__reflect(NewArtifactWin.prototype,"NewArtifactWin"),ViewManager.ins().reg(NewArtifactWin,LayerManager.UI_Main),window.NewArtifactWin=NewArtifactWin;var ShenqiSelectItemWin=function(t){function e(){var e=t.call(this)||this;return e.listDP=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.skinComplete=function(){this.piece.itemRenderer=ArtifactSuiItemRenderer,this.piece.dataProvider=this.listDP},e.prototype.addDisplay=function(){},e.prototype.setData=function(t){this.currentState=t.toString()},e.prototype.dataChanged=function(){},e}(BaseView);__reflect(ShenqiSelectItemWin.prototype,"ShenqiSelectItemWin"),window.ShenqiSelectItemWin=ShenqiSelectItemWin;var shenqispTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenqispTip",e.isTopLevel=!0,e.powerPanel.setBgVis(!1),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1];this.list.itemRenderer=ArtifactAttrDescItem,this.addTouchEvent(this.rect,this.onTap),this.setData(i,n)},e.prototype.setData=function(t,e){var i=GlobalConfig.ImbaJigsawConf[t],n=GlobalConfig.ImbaJigsawConf[t];this.partname.text=n.name,this.getway.text=n.guide,this.icon.source=n.img;var s=Artifact.ins().getNewArtifactBy(e);this.list.dataProvider=new eui.ArrayCollection(i.attrs);var o=t%10-1,a=s.record>>o&1,r="",l=BagCT.getAttrPower(i.attrs);this.powerPanel.setPower(l),r=a?"|C:0x35e62d&T:已获得|":"|C:0xf3311e&T:未获得|"},e.prototype.onTap=function(t){switch(t.target){case this.rect:ViewManager.ins().close(this)}},e.prototype.dataChanged=function(){},e}(BaseEuiView);__reflect(shenqispTipsWin.prototype,"shenqispTipsWin"),ViewManager.ins().reg(shenqispTipsWin,LayerManager.UI_Popup),window.shenqispTipsWin=shenqispTipsWin;var TargetWin=function(t){function e(){var e=t.call(this)||this;return e.expBarEff=new ProgressBarEff,e.skinName="targetSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.taskTip.visible=!1},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.button,this.onTouch),this.addTouchEvent(this.btn2,this.onTouch),this.observe(FbCT.ins().postAddEnergy,this.upDataGuanqia);var n=t[0];n==e.SEHNQI?(this.guanqia.visible=!0,this.quest.visible=!1,this.index=this.getShenQiId()):(this.guanqia.visible=!1,this.quest.visible=!0),[this.show1,this.show2][n].apply(this),this.addBarEff()},e.prototype.show2=function(){var t=SubRoles.ins().getSubRoleByIndex(0),i=this.getTaskSum(),n=e.TASKID%100;this.skillName.source="8000"+t.job+"_png",this.questNumber.text=e.TASKID%100-i+1+"",this.mcSkillID="40"+t.job,this.targetSkillID=""+(403+t.job);var s=0;i=i>0?i:0;var o=(i-1)/n;o=0>=o?0:o,o=o>=1?1:o,s=Math.floor(100*o),this.bar2.value=i-1,this.bar2.maximum=n,this.bar2.labelFunction=function(){return s+"%"}},e.prototype.getTaskSum=function(){if(TaskCT.ins().taskTrace.id>=e.TASKID)return 0;for(var t in GlobalConfig.AchievementTaskConfig)if(TaskCT.ins().taskTrace.id==GlobalConfig.AchievementTaskConfig[t].taskId){var i=GlobalConfig.AchievementTaskConfig[t].index;return i>0?i:0}return 0},e.prototype.show1=function(){var t=GlobalConfig.ImbaConf[this.index];if(t){var e=FbCT.ins().getNextReward();if(e){var i=FbCT.ins().getNewChapter();if(i){var n=this.getChipNum(t),s=FbCT.ins().getDiffChapter(),o=i.needLevel,a=GlobalConfig.ItemConfig[e[0].id];this.artifactImg.source=t.img,this.itemImg.source=a.icon+"_png",this.artifactname.text=t.name,this.number1.text=n+"",this.des1a1.text=t.funcDesc,this.guanqiaDes2.text=FbCT.ins().getNextNeedChapter()+"",this.artifactName1.text=a.name;var r=FbCT.ins().guanqiaID-o-1;r=r>0?r:0,this.bar1.visible=!1,this.guanqiaScheduleFrame.visible=!1,this.guanqiaDes1.x=-51,this.expBarEff.setData(r,s,!0),this.prossX=0;var l=this.btnbar.localToGlobal();this.btnbar.parent.globalToLocal(l.x,l.y,l),this.masksp=new egret.Sprite;var h=new egret.Shape;h.graphics.beginFill(16777215),h.graphics.drawRect(l.x,l.y,this.btnbar.width,this.btnbar.height),h.graphics.endFill(),this.prossX=l.x-this.btnbar.width,this.masksp.y=l.y,this.masksp.addChild(h),this.btnbar.parent.addChild(this.masksp),this.btnbar.mask=this.masksp,this.upDataGuanqia()}}}},e.prototype.addBarEff=function(){this.expBarEff.setWidth(525),this.expBarEff.x=35,this.expBarEff.y=450,this.expBarEff.scaleX=.8,this.guanqia.addChild(this.expBarEff)
},e.prototype.upDataGuanqia=function(){if(this.masksp){var t=FbCT.ins().currentEnergy,e=FbCT.ins().energy,i=(t-1)/e;i=i>=1?1:i,this.masksp.x=this.prossX+Math.abs(this.prossX)*i}},e.prototype.getChipNum=function(t){for(var e=0,i=0;i<t.jigsawId.length;i++)for(var n in GlobalConfig.WorldRewardConfig){var s=GlobalConfig.WorldRewardConfig[n];if(s.rewards[0].id==t.jigsawId[i]){s.needLevel>=FbCT.ins().guanqiaID&&e++;break}}return e},e.prototype.getShenQiId=function(){for(var t=Artifact.ins().getMaxIndex(),e=1,i=1;t>=i;i++){var n=Artifact.ins().getNewArtifactBy(i);for(var s in GlobalConfig.ImbaConf)if(GlobalConfig.ImbaConf[s].id==n.id){var o=FbCT.ins().getChipByGuanQia();if(-1!=GlobalConfig.ImbaConf[s].jigsawId.indexOf(o))return e=GlobalConfig.ImbaConf[s].index}}return e},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.bgClose:case this.btn2:ViewManager.ins().close(this);break;case this.button:if(FbCT.ins().currentEnergy>=FbCT.ins().energy){var e=this;GameGuider.challengeBoss(function(){ViewManager.ins().close(e)})}else this.showTaskTips("能量未满无法挑战，请继续清怪。")}},e.prototype.showTaskTips=function(t){var e=this.taskTip;this.taskTipText0.textFlow=TextFlowMaker.generateTextFlow1(t),egret.Tween.removeTweens(e),e.bottom=70,e.visible=!0,egret.Tween.get(e).to({bottom:100},500).wait(2e3).call(function(){e.visible=!1})},e.SEHNQI=0,e.HEJI=1,e.TASKID=100026,e}(BaseEuiView);__reflect(TargetWin.prototype,"TargetWin"),window.TargetWin=TargetWin,ViewManager.ins().reg(TargetWin,LayerManager.UI_Popup);var Auction=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Auction,e.regNetMsg(1,e.postListData),e.regNetMsg(2,e.onOpenSuccess),e.regNetMsg(4,e.postAuctionResult),e.regNetMsg(5,e.postBuyResult),e.regNetMsg(6,e.postRecord),e.regNetMsg(7,e.noLimit),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGetList(0),this.sendGetList(1)},e.prototype.sendGetList=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.postListData=function(t){for(var e=t.readByte(),i=t.readInt(),n=[],s=0;i>s;s++)n.push(new AuctionVo(t));n.length>=2&&n.sort(this.sort),0==e?this.auGuildDatas=n:this.auServerDatas=n},e.prototype.sort=function(t,e){return Algorithm.sortDesc(t.putAwayTime,e.putAwayTime)},e.prototype.sortByAuTime=function(t,e){return Algorithm.sortDesc(t.time,e.time)},e.prototype.sendOpenAuBox=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.onOpenSuccess=function(t){ViewManager.ins().open(AuctionItemChoiceWin,t.readInt(),t.readInt())},e.prototype.sendUseAuBox=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendAUction=function(t,e,i){var n=this.getBytes(4);n.writeInt(t),n.writeByte(e),n.writeByte(i),this.sendToServer(n)},e.prototype.postAuctionResult=function(t){var e=t.readByte();switch(e){case 0:case 1:case 2:var i=new AuctionVo(t),n=this.getVoByID(i.id);1==e?(this.deleteVo(n),TipsCT.ins().showTips("物品不存在")):(this.dateChanged(n,i),TipsCT.ins().showTips(0==e?"竞拍成功":"商品信息已改变"));break;case 3:TipsCT.ins().showTips("还在展示时间");break;case 4:TipsCT.ins().showTips("活跃额度不足")}},e.prototype.deleteVo=function(t){if(this.auGuildDatas){var e=this.auGuildDatas.indexOf(t);if(e>=0)return void this.auGuildDatas.splice(e,1)}if(this.auServerDatas){var e=this.auServerDatas.indexOf(t);e>=0&&this.auServerDatas.splice(e,1)}},e.prototype.postUpdate=function(){},e.prototype.getVoByID=function(t){return this.getVo(t,this.auGuildDatas)||this.getVo(t,this.auServerDatas)},e.prototype.getVo=function(t,e){if(!e||e.length<=0)return null;for(var i=0,n=e;i<n.length;i++){var s=n[i];if(s.id==t)return s}return null},e.prototype.sendBuy=function(t,e){var i=this.getBytes(5);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postBuyResult=function(t){var e=t.readByte();switch(e){case 0:case 1:case 2:var i=new AuctionVo(t),n=this.getVoByID(i.id);2!=e?(this.deleteVo(n),TipsCT.ins().showTips(1==e?"物品不存在":"兑换成功")):(this.dateChanged(n,i),TipsCT.ins().showTips("商品信息已改变"));break;case 3:TipsCT.ins().showTips("还在展示时间");break;case 4:TipsCT.ins().showTips("活跃额度不足")}},e.prototype.dateChanged=function(t,e){t.type!=e.type?(this.deleteVo(t),0==e.type?(this.auGuildDatas.push(e),this.auGuildDatas.length>=2&&this.auGuildDatas.sort(this.sort)):(this.auServerDatas.push(e),this.auServerDatas.length>=2&&this.auServerDatas.sort(this.sort))):(t.putAwayTime=e.putAwayTime,t.endTime=e.endTime,t.myAuPrice=e.myAuPrice,t.auctionTimes=e.auctionTimes,t.aID=e.aID)},e.prototype.getMaxPageByType=function(t,e){var i=t?this.auServerDatas:this.auGuildDatas;return i&&i.length?Math.ceil(i.length/e):1},e.prototype.getDataByPage=function(t,e,i){var n=t?this.auServerDatas:this.auGuildDatas;if(!n||!n.length)return null;var s=(e-1)*i;return n.slice(s,s+i)},e.prototype.isAuctionOpen=function(){return ZsCT.ins().lv>=GlobalConfig.AuctionConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.AuctionConfig.openserverday},e.prototype.sendRecord=function(t){var e=this.getBytes(6);e.writeByte(t),this.sendToServer(e)},e.prototype.postRecord=function(t){for(var e,i=t.readByte(),n=t.readShort(),s=[],o=0;n>o;o++)e=new AuctionRecordVo(t),e.type=i,s.push(e);return s.length>1&&s.sort(this.sortByAuTime),{type:i,list:s}},e.prototype.noLimit=function(t){ViewManager.ins().open(AuctionQuotaTipWin,t.readInt(),t.readInt())},e.prototype.checkRed=function(){return this.checkRedByType(0)||this.checkRedByType(1)},e.prototype.checkRedByType=function(t){var e=t?this.auServerDatas:this.auGuildDatas;return e&&e.length>0},__decorate([post()],e.prototype,"postListData",null),__decorate([post()],e.prototype,"postAuctionResult",null),__decorate([post()],e.prototype,"postUpdate",null),__decorate([post()],e.prototype,"postBuyResult",null),__decorate([post()],e.prototype,"postRecord",null),e}(BaseSystem);__reflect(Auction.prototype,"Auction"),System.Auction=function(){return Auction.ins()},window.Auction=Auction;var AuctionItemRender=function(t){function e(){var e=t.call(this)||this;return e.STATE_SHOW=0,e.STATE_AUCTION=1,e.STATE_END=2,e.state=0,e.leftTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.AuctionItem[t.aID];e&&(this.item.data=e.item,this.price=e.buy,this.price2=e.bid+Math.floor(e.bid*t.auctionTimes*GlobalConfig.AuctionConfig.priceIncrease/1e4),this.btn1.visible=e.buy>0,this.zb0.text=this.price+"",this.jingjia.text=this.price2+"",this.labelMy.visible=t.owner>0,this.labelMy.source=t.owner?1==t.owner?"labelMy":"labelGuild":"",this.zb1.text=e.bid+Math.floor(e.bid*(t.auctionTimes>0?t.auctionTimes-1:0)*GlobalConfig.AuctionConfig.priceIncrease/1e4)+"",this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.checkTime(),this.openedWard&&this.showWarn())},e.prototype.showWarn=function(){WarnWin.show("是否花费|C:2149168&T:"+(this.isYiKouJia?this.price:this.price2)+"|元宝"+(this.isYiKouJia?"立即拍下商品":"参与竞拍"),this.onAuction.bind(this),this,this.onAuction2.bind(this),this)},e.prototype.checkTime=function(){Timer.stopAll(this);var t=this.data,e=DateUtils.formatMiniDateTime(t.endTime),i=GameServer.serverTime,n=DateUtils.formatMiniDateTime(t.putAwayTime);this.leftTime=0,this.showTime.textColor=16711680,i>=e?(this.state=this.STATE_END,this.showTime.text="00:00:00",Auction.ins().deleteVo(t),Auction.ins().postUpdate()):Math.floor((i-n)/1e3)<(t.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)?(this.state=this.STATE_SHOW,this.showTime.textColor=16767295,this.leftTime=(t.type?GlobalConfig.AuctionConfig.globalShowTime:GlobalConfig.AuctionConfig.guildShowTime)-Math.floor((i-n)/1e3)):(this.state=this.STATE_AUCTION,this.showTime.textColor=65280,this.leftTime=Math.floor((e-i)/1e3)),this.leftTime&&(this.repeat(),Timer.start(1e3,0,this.repeat,this)),this.jingjiazhong.visible=t.auctionTimes>0,this.jingjiazhong.textFlow=TextFlowMaker.generateTextFlow("|C:"+(t.myAuPrice?16767295:2149168)+"&T:"+(t.myAuPrice?"我的竞价":"竞价中"))},e.prototype.repeat=function(){return this.showTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_12)+(this.state==this.STATE_SHOW?"后开始":"后结束"),this.state==this.STATE_AUCTION&&this.leftTime<=GlobalConfig.AuctionConfig.rushTime&&16711680!=this.showTime.textColor&&(this.showTime.textColor=16711680),this.leftTime<=0?void this.checkTime():void this.leftTime--},e.prototype.onRemove=function(){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),Timer.stopAll(this),this.openedWard=!1},e.prototype.onTouch=function(t){switch(t.target){case this.yikoujia:case this.yikoujia0:if(this.state==this.STATE_END)return void TipsCT.ins().showTips("物品拍卖结束");if(this.state==this.STATE_SHOW)return void TipsCT.ins().showTips("物品展示时间");this.openedWard=!0,this.isYiKouJia=t.target==this.yikoujia,this.showWarn()}},e.prototype.onAuction=function(){if(this.openedWard=!1,Actor.yb<(this.isYiKouJia?this.price:this.price2))return void this.noMoney();var t=this.data;this.isYiKouJia?Auction.ins().sendBuy(t.id,t.type):Auction.ins().sendAUction(t.id,t.type,t.auctionTimes+1)},e.prototype.noMoney=function(){TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onAuction2=function(){this.openedWard=!1},__decorate([callDelay(150)],e.prototype,"noMoney",null),e}(BaseItemRender);__reflect(AuctionItemRender.prototype,"AuctionItemRender"),window.AuctionItemRender=AuctionItemRender;var AuctionRecordItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.AuctionItem[t.aId];this.item.data=e.item,this.playerName.text=t.roleName,this.price.text=t.price+"",this.successTime.text=DateUtils.getFormatBySecond(Math.floor(DateUtils.formatMiniDateTime(t.time)/1e3),DateUtils.TIME_FORMAT_15),this.text1.text=t.state?1==t.state?"竞拍价成交":"一口价成交":0==t.type?"流拍到全服":"流拍"},e}(BaseItemRender);__reflect(AuctionRecordItemRender.prototype,"AuctionRecordItemRender"),window.AuctionRecordItemRender=AuctionRecordItemRender;var AuctionItemChoiceWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionItemChoiceSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemID=t[0],this.auID=t[1],this.addTouchEndEvent(this,this.onTouch),this.update()},e.prototype.update=function(){var t=GlobalConfig.AuctionItem[this.auID];this.item.data=t.item,this.price1.text=t.bid+"",this.price2.text=t.buy+""},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.ownUse:case this.auctionBtn:Auction.ins().sendUseAuBox(t.target==this.ownUse?0:1,this.itemID),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(AuctionItemChoiceWin.prototype,"AuctionItemChoiceWin"),ViewManager.ins().reg(AuctionItemChoiceWin,LayerManager.UI_Main),window.AuctionItemChoiceWin=AuctionItemChoiceWin;var AuctionPanel=function(t){function e(){var e=t.call(this)||this;return e.curPage=1,e.maxPage=1,e.type=0,e.itemCount=10,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=AuctionItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.itemCount=GlobalConfig.AuctionConfig.eachPageNumber,this.addTouchEndEvent(this,this.onTouch),this.observe(Auction.ins().postListData,this.update),this.observe(Auction.ins().postAuctionResult,this.update),this.observe(Auction.ins().postBuyResult,this.update),this.observe(Auction.ins().postUpdate,this.update),this.curPage=1,this.update(),Timer.stopAll(this),Timer.start(1e4,0,this.onSend,this)},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onSend=function(){Auction.ins().sendGetList(this.type)},e.prototype.update=function(){this.collect||(this.collect=new eui.ArrayCollection,this.list.dataProvider=this.collect),this.maxPage=Auction.ins().getMaxPageByType(this.type,this.itemCount),this.curPage>this.maxPage&&(this.curPage=this.maxPage),this.updateCurPage(),this.add.visible=this.maxPage>1},e.prototype.onTouch=function(t){switch(t.target){case this.btn:ViewManager.ins().open(AuctionRecordWin,this.type);break;case this.minBtn:this.curPage>1&&(this.curPage--,this.updateCurPage());break;case this.maxBtn:this.curPage<this.maxPage&&(this.curPage++,this.updateCurPage())}},e.prototype.updateCurPage=function(){var t=Auction.ins().getDataByPage(this.type,this.curPage,this.itemCount),e=this.collect.source;if(e&&e.length==(t?t.length:0))for(var i=e.length,n=0;i>n;n++){e[n]=t[n];var s=this.list.getElementAt(n);s&&this.list.updateRenderer(s,n,t[n])}else this.collect.source=t;this["null"].visible=!this.collect.source||this.collect.source.length<=0,this.pageTxt.text=this.curPage+"/"+this.maxPage},e}(BaseEuiView);__reflect(AuctionPanel.prototype,"AuctionPanel"),window.AuctionPanel=AuctionPanel;var AuctionQuotaTipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionQuotaTipSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch),this.positiveQuotaNum.text=t[0],this.rechargeQuotaNum.text=t[1]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.goRechargeBtn:var i=Recharge.ins().getRechargeData(0);i&&0!=i.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win),ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(AuctionQuotaTipWin.prototype,"AuctionQuotaTipWin"),ViewManager.ins().reg(AuctionQuotaTipWin,LayerManager.UI_Popup),window.AuctionQuotaTipWin=AuctionQuotaTipWin;var AuctionRecordWin=function(t){function e(){var e=t.call(this)||this;return e.type=0,e.skinName="auctionRecordSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=AuctionRecordItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.observe(Auction.ins().postRecord,this.update),this.curAuction.textFlow=TextFlowMaker.generateTextFlow("拍卖纪录("+(this.type?"全服":"公会")+")"),this["null"].visible=!0,Auction.ins().sendRecord(this.type),this.addTouchEndEvent(this,this.onTouch)},e.prototype.onTouch=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},e.prototype.update=function(t){this.collect||(this.collect=new eui.ArrayCollection,this.list.dataProvider=this.collect),t.type==this.type&&(this.collect.source=t.list,this["null"].visible=!this.collect.source||this.collect.source.length<=0)},e}(BaseEuiView);__reflect(AuctionRecordWin.prototype,"AuctionRecordWin"),ViewManager.ins().reg(AuctionRecordWin,LayerManager.UI_Popup),window.AuctionRecordWin=AuctionRecordWin;var AuctionWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="auctionSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch),this.addChangeEvent(this.tab,this.selectIndexChange),this.observe(Auction.ins().postListData,this.updateRed),this.observe(Auction.ins().postAuctionResult,this.updateRed),this.observe(Auction.ins().postBuyResult,this.updateRed),this.observe(Auction.ins().postUpdate,this.updateRed),this.updateRed(),this.tab.selectedIndex=this.viewStack.selectedIndex=Auction.ins().checkRedByType(1)&&!Auction.ins().checkRedByType(0)?1:0,this.selectIndexChange()},e.prototype.close=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:ViewManager.ins().open(ZsBossRuleSpeak,41)}},e.prototype.selectIndexChange=function(t){switch(void 0===t&&(t=null),this.tab.selectedIndex){case 0:Auction.ins().sendGetList(0),this.guild.open(0);break;case 1:Auction.ins().sendGetList(1),this.server.open(1)}},e.prototype.updateRed=function(){this.redPoint0.visible=Auction.ins().checkRedByType(0),this.redPoint1.visible=Auction.ins().checkRedByType(1)},e}(BaseEuiView);__reflect(AuctionWin.prototype,"AuctionWin"),ViewManager.ins().reg(AuctionWin,LayerManager.UI_Main),window.AuctionWin=AuctionWin;var AuctionRecordVo=function(){function t(t){this.type=0,this.parser(t)}return t.prototype.parser=function(t){this.aId=t.readInt(),this.roleName=t.readString(),this.state=t.readByte(),this.price=t.readInt(),this.time=t.readInt()},t}();__reflect(AuctionRecordVo.prototype,"AuctionRecordVo"),window.AuctionRecordVo=AuctionRecordVo;var AuctionVo=function(){function t(t){this.parser(t)}return t.prototype.parser=function(t){this.type=t.readByte(),this.endTime=t.readInt(),this.id=t.readInt(),this.putAwayTime=t.readInt(),this.aID=t.readInt(),this.auctionTimes=t.readByte(),this.myAuPrice=t.readByte(),this.owner=t.readByte()},t}();__reflect(AuctionVo.prototype,"AuctionVo"),window.AuctionVo=AuctionVo;var BagCT=function(t){function e(){var e=t.call(this)||this;e.bagModel=[],e.isExitUsedItem=0,e.isChange=0,e.OrangeEquipRedPoint=[],e.itemCount={0:{},1:{}},e.bagAdditional=0,e.promptList=["","背包满了","","不能被使用","级别不足","数量不足够"],e.equipPowerDic=[],e.wearList=[],e.sysId=PackageID.Bag,e.regNetMsg(1,e.doBagData),e.regNetMsg(2,e.postBagVolAdd),e.regNetMsg(3,e.doDeleteItem),e.regNetMsg(4,e.doAddItem),e.regNetMsg(5,e.doUpDataItem),e.regNetMsg(6,e.postUseItemSuccess),e.regNetMsg(7,e.postMergeItemBack),e.regNetMsg(8,e.doChoosableGiftResult),e.regNetMsg(9,e.postBagAdditional),e.regNetMsg(10,e.postItemEndTime),e.observe(Recharge.ins().postGetMonthDay,e.doBagVolChange),e._useItemFunc={},e.registerUseItemFunc(ItemConst.RENAME,e.useRenameItem);for(var i=0;8>i;i++)e.OrangeEquipRedPoint[i]=!1;return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e,"fitleEquip",{get:function(){if(!e._fitleEquip){e._fitleEquip=[];for(var t in GlobalConfig.SpecialEquipsConfig)GlobalConfig.SpecialEquipsConfig[t].style==FitleStyle.hc&&e._fitleEquip.push(GlobalConfig.SpecialEquipsConfig[t].id)}return e._fitleEquip},enumerable:!0,configurable:!0}),e.prototype.sendAddBagGrid=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendUseItem=function(t,e){var i=this.getBytes(6);return i.writeInt(t),i.writeInt(e),this.sendToServer(i),null!=this._useItemFunc[t]?(this._useItemFunc[t](t,e),!0):!1},e.prototype.addItemCount=function(t,e){var i=e.configID;return 0==e.count?void this.delItemCount(t,i):(this.itemCount[t][i]=this.itemCount[t][i]||0,void(1==t?this.itemCount[t][i]+=1:this.itemCount[t][i]=e.count))},e.prototype.delItemCount=function(t,e){1==t?this.itemCount[t][e]&&(this.itemCount[t][e]-=1,0==this.itemCount[t][e]&&delete this.itemCount[t][e]):delete this.itemCount[t][e]},e.prototype.getBagItemCount=function(t,e){return this.itemCount[t][e]||0},e.prototype.doBagData=function(t){var e=t.readByte(),i=t.readByte();0==e&&(this.bagModel[i]=[],this.itemCount[i]={});for(var n,s=t.readInt(),o=0;s>o;o++)n=new ItemData,n.parser(t),this.bagModel[i].push(n),(0==i||1==i)&&this.addItemCount(i,n),1==i&&NewEquip.ins().addItem(n);this.postItemAdd(),1==i&&this.doBagVolChange(),2==i&&this.postHuntStore(),this.getIsExitUsedItem(),this.postHasItemCanUse()},e.prototype.doBagVolChange=function(){this.postBagVolChange()},e.prototype.postBagVolChange=function(){var t=this.ronglianCheck();this.isChange=t?1:0;var e=t?2:0;this.postItemCountChange(),t||(t=this.getSurplusCount()<.05*this.getMaxBagRoom(),e=t?1:0),this.postBagWillFull(e)},e.prototype.ronglianCheck=function(){var t=Actor.bagNum+this.bagAdditional,e=!1,i=FbCT.ins().guanqiaID>50?this.getBagItemNum()/t>=.8:this.getBagItemNum()>=50;if(i)for(var n=this.getOutEquips(),s=0,o=n;s<o.length;s++){var a=o[s];if(a&&a.itemConfig){e=!0;break}}return e},e.prototype.postUseItemSuccess=function(t){var e=t.readByte();if(e>0)return TipsCT.ins().showTips(this.promptList[e]),!1;if(0==e){var i=t.readInts(2);209001==i[1]&&ViewManager.ins().open(CardWin,1),FloatWinCT.ins().checkItem(i);var n=GlobalConfig.ItemConfig[i[1]];return n&&n.showYb&&ShowImgCT.ins().showMoveImg("showuanbao",0,n.showYb,-300),n&&n.showExp&&ShowImgCT.ins().showMoveImg("vipexphuizhang",50,n.showExp,300),i}},e.prototype.postBagVolAdd=function(t){Actor.bagNum=t.readInt()},e.prototype.doDeleteItem=function(t){var e=t.readByte(),i=t.readDouble(),n=0;if(this.bagModel[e]){for(var s=this.bagModel[e].length-1;s>=0;s--)if(this.bagModel[e][s].handle==i){n=this.bagModel[e][s].configID,this.isExitUsedItem=this.bagModel[e][s].getCanbeUsed()?1:0,this.bagModel[e].splice(s,1);break}(0==e||1==e)&&this.delItemCount(e,n),2==e&&(this.deleteHasType2=!0),this.isDeleteDelay||(this.isDeleteDelay=!0,Timer.start(50,1,this.deleteDelay,this))}},e.prototype.doAddItem=function(t){var e=t.readByte(),i=new ItemData;if(i.endTime=t.readInt(),i.parser(t),this.bagModel[e]){this.bagModel[e].push(i),(0==e||1==e)&&this.addItemCount(e,i),this.isExitUsedItem=i.getCanbeUsed()?1:0;var n=t.readByte();if(n){var s=ItemUtil.getQuality(i.itemConfig);if(s>=4&&1==e)TipsCT.ins().showGoodEquipTips(i);else if(2!=e)if(ItemUtil.getType(i.itemConfig)==ItemType.TYPE_18)TipsCT.ins().showHeartItemTips(i.itemConfig.id);else{var o="获得|C:"+ItemUtil.getQualityColor(i.itemConfig)+"&T:"+i.itemConfig.name+" x "+i.count+"|";TipsCT.ins().showTips(o)}}2==e&&(this.addHasType2=!0),this.isAddDelay||(this.isAddDelay=!0,Timer.start(50,1,this.addDelay,this)),1==e&&NewEquip.ins().addItem(i),i.itemConfig&&i.itemConfig.showImg&&FloatWinCT.ins().showItemWin(i)}},e.prototype.addDelay=function(){this.isAddDelay=!1,this.postItemAdd(),this.postHasItemCanUse(),this.doBagVolChange(),this.addHasType2&&(this.addHasType2=!1,this.postHuntStore())},e.prototype.deleteDelay=function(){this.isDeleteDelay=!1,this.postItemDel(),this.postHasItemCanUse(),this.doBagVolChange(),this.deleteHasType2&&(this.deleteHasType2=!1,this.postHuntStore())},e.prototype.doUpDataItem=function(t){var e,i=t.readByte(),n=t.readDouble(),s=0;if(this.bagModel[i]){for(var o=0;o<this.bagModel[i].length;o++)if(e=this.bagModel[i][o],e.handle==n){var a=t.readInt();s=a-e.count,e.count=a,(0==i||1==i)&&this.addItemCount(i,e),ItemUtil.getType(e.itemConfig)==ItemType.TYPE_47&&this.sendItemEndTime(n),this.isExitUsedItem=e.getCanbeUsed()?1:0,this.postHasItemCanUse();break}var r=t.readByte();if(r&&s>0){if(2!=i){if(ItemUtil.getType(e.itemConfig)==ItemType.TYPE_18)TipsCT.ins().showHeartItemTips(e.itemConfig.id);else{var l=ItemUtil.getQualityColor(e.itemConfig),h="获得|C:"+l+"&T:"+e.itemConfig.name+" x "+s+"|";TipsCT.ins().showTips(h)}this.postItemAdd()}e.itemConfig&&e.itemConfig.showImg&&FloatWinCT.ins().showItemWin(e)}this.doBagVolChange(),this.postItemChange()}},e.prototype.sendMergeItem=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postMergeItemBack=function(t){for(var e=(t.readInt(),t.readInt(),t.readInt()),i=[],n=0;e>n;n++)i[n]=new RewardData,i[n].parser(t);return i},e.prototype.sendGetGoodsByStore=function(t){if(t==DepotType.Equip&&this.getSurplusCount()<1){var e=GlobalConfig.ServerTips[2].tips;return void TipsCT.ins().showTips(e)}var i=this.getBytes(4);i.writeDouble(t),this.sendToServer(i)},e.prototype.postItemChange=function(){},e.prototype.registerUseItemFunc=function(t,e){this._useItemFunc[t]=e},e.prototype.postItemDel=function(){},e.prototype.postItemAdd=function(){},e.prototype.postItemCountChange=function(){return this.isChange},e.prototype.postBagWillFull=function(t){return t},e.prototype.postHuntStore=function(){},e.prototype.postHasItemCanUse=function(){return this.isExitUsedItem},e.prototype.getBagItemById=function(t,i){void 0===i&&(i=e.BAG_TYPE_OTHTER);var n=this.bagModel[i];if(!n)return null;for(var s=0,o=n;s<o.length;s++){var a=o[s];if(a.itemConfig.id==t)return a}return null},e.prototype.getBagGoodsByTypeAndId=function(t,e){for(var i=this.bagModel[t],n=0,s=i;n<s.length;n++){var o=s[n];if(o.itemConfig.id==e)return o}return null},e.prototype.getBagEquipByType=function(t){var i=this.bagModel[e.BAG_TYPE_EQUIP],n=[];if(!i)return n;for(var s=0,o=i;s<o.length;s++){var a=o[s];ItemUtil.getType(a.itemConfig)==t&&n.push(a)}return n},e.prototype.getBagGoodsByTypeAndSubType=function(t,e){for(var i=this.getBagGoodsByType(t),n=[],s=0,o=i;s<o.length;s++){var a=o[s];ItemUtil.getSubType(a.itemConfig)==e&&n.push(a)}return n},e.prototype.getBagGoodsCountByType=function(t){var i=this.bagModel[e.BAG_TYPE_OTHTER];if(!i||0==i.length)return!1;for(var n=0,s=i;n<s.length;n++){var o=s[n],a=o.itemConfig,r=ItemUtil.getType(a),l=GlobalConfig.OptionalGiftConfig[a.id];if(!l||!(Actor.level<l.options[0].level||ZsCT.ins().lv<l.options[0].zslimit)){if(r==ItemType.TYPE_8){if(a.bagType==DepotType.Rune)continue;if(t&&-1!=t.indexOf(a.id))return!0;if(a.id==ItemConst.EXP_ITEM&&Actor.level<65)continue;if(a.id==ItemConst.LEVELUP_ITEM){if(this.getRmbItemIsBuy(ItemConst.LEVELUP_ITEM))return!0;continue}if(a.id==ItemConst.WEIWANG_ITEM)continue;return!0}if(r==ItemType.TYPE_12){if(Actor.level>=a.level&&0!=Guild.ins().guildID)return!0}else{if(r==ItemType.TYPE_17)return!0;if(r==ItemType.TYPE_35)return!0;if(r==ItemType.TYPE_47)return!0;var h=GlobalConfig.ItemComposeConfig[o.configID];if(h&&h.srcCount<=o.count)return!0}}}return!1},e.prototype.getRuneBagGoodsCountByType=function(){var t=this.bagModel[e.BAG_TYPE_OTHTER];if(t)for(var i=0,n=t;i<n.length;i++){var s=n[i];if(ItemUtil.getType(s.itemConfig)==ItemType.TYPE_8&&1==s.itemConfig.bagType)return!0}return!1},e.prototype.getBagGoodsCountById=function(t,e){if(0==t||1==t)return this.getBagItemCount(t,e);var i=this.bagModel[t];if(i)for(var n=0,s=i;n<s.length;n++){var o=s[n];if(o.itemConfig&&o.itemConfig.id==e)return o.count}return 0},e.prototype.getBagGoodsByIndex=function(t,e){return this.bagModel[t][e]},e.prototype.getBagItemNum=function(t){void 0===t&&(t=1);var e=this.bagModel[t];return e?e.length:0},e.prototype.getSurplusCount=function(){return Actor.bagNum-this.getBagItemNum()+this.bagAdditional},e.prototype.getMaxBagRoom=function(){return Actor.bagNum+this.bagAdditional},e.prototype.sort2=function(t,e){return Algorithm.sortAsc(t.point,e.point)},e.prototype.getHejiEquipsByType=function(t){for(var e=this.bagModel[1],i=[],n=0,s=e;n<s.length;n++){var o=s[n],a=ItemUtil.getType(o.itemConfig),r=ItemUtil.getSubType(o.itemConfig);5==a&&r==t&&i.push(o)}return i.sort(this.sort3),i},e.prototype.sort3=function(t,e){var i=Algorithm.sortDesc(t.point,e.point);return 0==i&&(i=Algorithm.sortDesc(t.configID,e.configID)),i},e.prototype.getBagSortQualityEquips=function(t,i,n,s){void 0===t&&(t=5),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=null);var o=this.bagModel[e.BAG_TYPE_EQUIP],a=[];if(!o)return a;for(var r=0,l=o;r<l.length;r++){var h=l[r],u=ItemUtil.getQuality(h.itemConfig);5!=t&&(u>t||i&&t>u)||(null==s||s(h))&&(a[a.length]=h)}return a},e.prototype.getLegendOutEquips=function(){for(var t=this.getBagEquipsByQuality(5),e=[],i=[],n=SubRoles.ins().subRolesLen,s=0;n>s;s++)for(var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getEquipLen(),r=0;a>r;r++){var l=o.getEquipByIndex(r);l.item.itemConfig&&this.addOneEquipToListEx(i,l,o.job)}for(var h,u=0,p=t;u<p.length;u++){var c=p[u],d=ItemUtil.getSubType(c.itemConfig);if(0==d||2==d){for(var g=!1,f=0,v=i;f<v.length;f++){var y=v[f];if(y){for(var m=0,T=y;m<T.length;m++){var C=T[m];if(C){var b=ItemUtil.getSubType(C.itemConfig);if(b==d){g=!0;break}}}if(g)break}}g&&(h=this.checkEquipsIsGood(i,this.cloneItemDataInfo(c)),h&&(EquipCT.ins().checkEquipsIsWear(h)||5!=ItemUtil.getQuality(h.itemConfig)||e.push(h)))}}return e},e.prototype.getLegendHasResolve=function(){for(var t=this.getBagEquipsByQuality(4),e=[],i=SubRoles.ins().subRolesLen,n=0;i>n;n++)for(var s=SubRoles.ins().getSubRoleByIndex(n),o=s.getEquipLen(),a=0;o>a;a++){var r=s.getEquipByIndex(a);r.item.itemConfig&&this.addOneEquipToListRed(e,r,n)}for(var l,h=0,u=t;h<u.length;h++){var p=u[h];if(!BreakDownView.fitleEquip[p.configID]&&(l=this.checkEquipsIsGoodRed(e,this.cloneItemDataInfo(p)),!l))return!0}return!1},e.prototype.otherEquipSmeltFilter=function(t){var e=ItemUtil.getType(t.itemConfig),i=ItemUtil.getSubType(t.itemConfig);if(t.itemConfig&&4==e)return!0;if(0==e){for(var n in ForgeConst.CAN_FORGE_EQUIP)if(ForgeConst.EQUIP_POS_TO_SUB[ForgeConst.CAN_FORGE_EQUIP[n]]==i)return!1;return!0}return!1},e.prototype.normalEquipSmeltFilter=function(t){return 0==ItemUtil.getType(t.itemConfig)},e.prototype.getHejiOutEquips=function(){var t=[];return t.length<e.SmeltMax&&this.checkHejiEquipsTodestroy(t),this.creatListLength(t),t},e.prototype.getOutEquips=function(){for(var t=this.getBagSortQualityEquips(5,0,1,this.normalEquipSmeltFilter),i=[],n=[],s=SubRoles.ins().subRolesLen,o=0;s>o;o++)for(var a=SubRoles.ins().getSubRoleByIndex(o),r=a.getEquipLen(),l=0;r>l;l++){var h=a.getEquipByIndex(l);h.item.itemConfig&&this.addOneEquipToList(n,h,a.job)}for(var u,o=0;o<t.length;o++){var p=t[o];if(u=this.checkEquipsIsGood(n,this.cloneItemDataInfo(p)),u&&!EquipCT.ins().checkEquipsIsWear(u)&&ItemUtil.getQuality(u.itemConfig)<4&&ItemUtil.getSubType(u.itemConfig)!=ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]&&i.push(u),i.length>=e.SmeltMax)break}return i.length<e.SmeltMax&&this.getGuanyinEquip(i),this.upLevelEquips=[],this.creatListLength(i),i},e.prototype.creatListLength=function(t){if(t.length<e.SmeltMax)for(var i=0;i<e.SmeltMax;i++)void 0==t[i]&&(t[i]=null)},e.prototype.checkUpLevelEquips=function(t){var e=ItemUtil.getJob(t.itemConfig),i=ItemUtil.getSubType(t.itemConfig),n=t.itemConfig.zsLevel,s=t.itemConfig.level,o=ItemUtil.getQuality(t.itemConfig);if(5==o)return null;this.upLevelEquips||(this.upLevelEquips=[]),this.upLevelEquips[e]||(this.upLevelEquips[e]=[]),this.upLevelEquips[e][i]||(this.upLevelEquips[e][i]=[]),this.upLevelEquips[e][i][n]||(this.upLevelEquips[e][i][n]=[]);var a;if(a=this.upLevelEquips[e][i][n][s]){var r=this.checkEquipGetBest(a,t);return r==a&&(this.upLevelEquips[e][i][n][s]=t),r}return this.upLevelEquips[e][i][n][s]=t,null},e.prototype.checkUplevelBest=function(t,e){var i,n=ItemUtil.getJob(t.itemConfig),s=ItemUtil.getSubType(t.itemConfig),o=null;return e[n]||(e[n]=[]),e[n][s]||(e[n][s]=null),i=e[n][s],i&&(o=this.checkEquipGetBest(i,t)),o},e.prototype.checkEquipsIsGoodRed=function(t,e){for(var i=Actor.level,n=ZsCT.ins().lv,s=ItemUtil.getSubType(e.itemConfig),o=0;o<SubRoles.ins().subRolesLen;o++){t[o]||(t[o]=[]);var a=e.itemConfig.zsLevel?e.itemConfig.zsLevel:0,r=e.itemConfig.level?e.itemConfig.level:0;if(n>=a&&i>=r){if(!t[o][s])return e;var l=this.checkEquipGetBestEx(t[o][s],e);if(!EquipCT.ins().checkEquipsIsWear(l))return l}}return null},e.prototype.checkEquipsIsGood=function(t,e){var i=Actor.level,n=ZsCT.ins().lv,s=ItemUtil.getJob(e.itemConfig),o=ItemUtil.getSubType(e.itemConfig);if(e.itemConfig.level>i||e.itemConfig.zsLevel>n){var a=this.checkUplevelBest(e,t);return a&&!EquipCT.ins().checkEquipsIsWear(a)?a:this.checkUpLevelEquips(e)}if(!t[s]||!t[s][o])return this.addOneEquipToList(t,e),null;var r=t[s][o],l=this.checkEquipGetBest(r,e);return r==l&&(t[s][o]=e),l},e.prototype.checkEquipGetBestEx=function(t,e){return t&&e?t.point>=e.point?t:e:null},e.prototype.checkEquipGetBest=function(t,e){return null!=t&&null!=e&&t.point>=e.point?e:t},e.prototype.addOneEquipToListEx=function(t,e,i){void 0===i&&(i=0);var n;n=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var s=ItemUtil.getJob(n.itemConfig),o=ItemUtil.getSubType(n.itemConfig);s||(s=i),t[s]||(t[s]=[]),t[s][o]=n
},e.prototype.addOneEquipToListRed=function(t,e,i){var n;n=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var s=ItemUtil.getSubType(n.itemConfig);t[i]||(t[i]=[]),t[i][s]=n},e.prototype.addOneEquipToList=function(t,e,i){void 0===i&&(i=0);var n;n=e instanceof EquipsData?this.cloneItemDataInfo(e.item):this.cloneItemDataInfo(e);var s=ItemUtil.getJob(n.itemConfig);0==s&&(s=i);var o=ItemUtil.getSubType(n.itemConfig);t[s]||(t[s]=[]),t[s][o]=n},e.prototype.cloneItemDataInfo=function(t){var e=new ItemData;return e.handle=t.handle,e.configID=t.configID,e.att=t.att,e.itemConfig=t.itemConfig,e.count=t.count,e},e.prototype.getBagGoodsBySort=function(t){var i=this.getGoodsListByType(t,e.BAG_TYPE_OTHTER);return i.sort(function(t,e){return Algorithm.sortAsc(t.configID,e.configID)}),i},e.prototype.getBagGoodsByType=function(t){var i=this.bagModel[e.BAG_TYPE_OTHTER],n=[];if(!i)return n;for(var s=0,o=i;s<o.length;s++){var a=o[s];ItemUtil.getType(a.itemConfig)==t&&n.push(a)}return n},e.prototype.getBagEquipsByQuality=function(t,i,n){void 0===i&&(i=0),void 0===n&&(n=e.BAG_TYPE_EQUIP);var s=this.bagModel[n],o=[];if(!s)return o;for(var a=0,r=s;a<r.length;a++){var l=r[a];l&&ItemUtil.getType(l.itemConfig)==i&&ItemUtil.getQuality(l.itemConfig)==t&&o.push(l)}return o},e.prototype.getBagGoodsByHandle=function(t,e){var i=this.bagModel[t];if(!i)return null;for(var n=0,s=i;n<s.length;n++){var o=s[n];if(o.handle==e)return o}return null},e.prototype.getHuntGoods=function(t){return this.getGoodsListByType(t)},e.prototype.getGoodsListByType=function(t,i){void 0===i&&(i=e.BAG_TYPE_TREASUREHUNT);var n=this.bagModel[i],s=[];if(n)for(var o=0,a=n;o<a.length;o++){var r=a[o],l=r.itemConfig;l.bagType==t&&(l.split?this.splitItemData(s,r):s.push(r))}return s},e.prototype.splitItemData=function(t,e){var i=e.count;if(i>1)for(;i>0;){var n=e.copy();n.count=1,t.push(n),i-=1}else t.push(e)},e.prototype.getHuntGoodsBySort=function(t){var i=[];return this.bagModel[e.BAG_TYPE_TREASUREHUNT]&&(i=this.getGoodsListByType(t),i.sort(function(t,e){var i=ItemUtil.getType(t.itemConfig),n=ItemUtil.getType(e.itemConfig);return n>i?1:i>n?-1:i?Algorithm.sortAsc(t.configID,e.configID):Algorithm.sortDesc(t.point,e.point)})),i},e.prototype.getGuanyinEquip=function(t){var i=this.getBagSortQualityEquips(5,0,0,this.otherEquipSmeltFilter),n=0,s=SubRoles.ins().subRolesLen;if(3>s)n=0;else for(var o=0;s>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o),r=a.getEquipByIndex(EquipPos.DZI);(r&&r.item&&r.item.configID<n||0==n)&&(n=r.item.configID)}if(i.length>0)for(var l in i){var h=this.updateGuanyinEquip(i[l],n);if(null!=h&&t.push(h),t.length>=e.SmeltMax)break}return t},e.prototype.updateGuanyinEquip=function(t,e){void 0===e&&(e=0);var i=SubRoles.ins().subRolesLen;if(ItemUtil.getSubType(t.itemConfig)==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]){for(var n=t.point,s=0;i>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getEquipByIndex(EquipPos.DZI),r=a.item.itemConfig;if(!r||r&&n>a.item.point)return null}return t}return null},e.prototype.getGuanyinLevel=function(t){var e=TextFlowMaker.getCStr(t.id-ItemConst.GUANYIN_ITEM+1);return e+"阶"},e.prototype.getIsExitUsedItem=function(){var t=this.bagModel[e.BAG_TYPE_OTHTER];if(!t)return!1;for(var i=0,n=t;i<n.length;i++){var s=n[i];if(s.getCanbeUsed())return this.isExitUsedItem=1,!0}return this.isExitUsedItem=0,!1},e.prototype.getEquipsScoreByRolesOfBody=function(){for(var t=SubRoles.ins().subRolesLen,e=0,i=0;t>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(n&&n.equipsData)for(var s=n.equipsData,o=0;o<EquipPos.MAX;o++)s[o]&&s[o].item&&s[o].item.itemConfig&&s[o].item.itemConfig.id&&(e+=s[o].item.point)}return e},e.prototype.calculationScore=function(t){for(var e,i=0,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s);if(o.job==ItemUtil.getJob(t.itemConfig))for(var a=o.getEquipLen(),r=0;a>r;r++)e=o.getEquipByIndex(r).item,e&&e.itemConfig&&ItemUtil.getSubType(e.itemConfig)==ItemUtil.getSubType(t.itemConfig)&&(i=0==i?e.point:Math.min(e.point,i))}return t.point-i},e.prototype.useRenameItem=function(t,e){ViewManager.ins().open(RenameWin)},e.getAttrPower=function(t,e){void 0===e&&(e=null);var i=GlobalConfig.AttrPowerConfig,n=0;if(!t)return n;for(var s=0,o=0;o<t.length;o++){var a=t[o].type,r=t[o].value;a!=AttributeType.atHpEx&&a!=AttributeType.atAtkEx&&a!=AttributeType.atDamageReduction&&i[a]&&r&&(n+=r*i[a].pow,a==AttributeType.atHuiXinDamage&&e&&(s+=ItemUtil.relatePower(t[o],e)))}return Math.floor(n/100)+Math.floor(s)},e.prototype.setEquipPowerDic=function(t,e,i){void 0===i&&(i=0),this.equipPowerDic[t]||(this.equipPowerDic[t]=[]),this.equipPowerDic[t][e]||(this.equipPowerDic[t][e]=0),this.equipPowerDic[t][e]=i},e.prototype.getEquipPowerDic=function(t,e){return this.equipPowerDic[t]&&this.equipPowerDic[t][e]?this.equipPowerDic[t][e]:0},e.prototype.getLowEquipIndex=function(t,e){for(var i=-1,n=Number.MAX_VALUE,s=t.length,o=0;s>o;o++)if(ForgeConst.EQUIP_POS_TO_SUB[o]==e){var a=t[o];if(0==a.handle)return o;var r=a.point;n>r&&(i=o,n=r)}return i},e.prototype.getHejiEquips=function(){for(var t=this.bagModel[1],e=[],i=0;t&&i<t.length;i++){var n=t[i];5==ItemUtil.getType(n.itemConfig)&&e.push(n)}return e},e.prototype.checkIsWear=function(t){if(!t)return!1;for(var e=0;8>e;e++){var i=SkillCT.ins().equipListData[e];if(i&&i.handle==t.handle)return!1}return!0},e.prototype.makeHejiWearList=function(t){var e=ItemUtil.getSubType(t.itemConfig);this.wearList[e]=t},e.prototype.checkHejiEquipsTodestroy=function(t){if(SkillCT.ins().equipListData){for(var i=0;8>i;i++){var n=SkillCT.ins().equipListData[i];n&&0!=n.configID&&this.makeHejiWearList(n)}for(var s=this.getHejiEquips(),o=0,a=s;o<a.length;o++){var r=a[o],l=ItemUtil.getSubType(r.itemConfig),n=this.wearList[l];if(n&&0!=n.configID){var h=r.point,u=n.point;if(u>=h)t.push(r);else{var p=0;r.itemConfig.level<=p&&(this.wearList[l]=r,this.checkIsWear(n)&&t.push(n))}if(t.length>=e.SmeltMax)break}}}},e.prototype.getThundersByPos=function(t){void 0===t&&(t=null);for(var i=this.bagModel[e.BAG_TYPE_EQUIP],n=[],s=[],o=ZsCT.ins().lv,a=Actor.level,r=0,l=i;r<l.length;r++){var h=l[r];ItemUtil.getType(h.itemConfig)!=ThunderEquipPanel.TYPE||(null==t?0:ItemUtil.getSubType(h.itemConfig)!=t)||(o<h.itemConfig.zsLevel||a<h.itemConfig.level?s.push(h):n.push(h))}return n=n.sort(this.sortFun),s.sort(this.sortFun),n=n.concat(s)},e.prototype.getEquipByPos=function(t,i){var n=this.bagModel[e.BAG_TYPE_EQUIP],s=SubRoles.ins().getSubRoleByIndex(t),o=s.getEquipByIndex(i),a=0;a=o&&o.item.itemConfig?ItemUtil.getSubType(o.item.itemConfig):i;for(var r=[],l=[],h=Actor.level,u=ZsCT.ins().lv,p=0,c=n;p<c.length;p++){var d=c[p],g=ItemUtil.getJob(d.itemConfig),f=ItemUtil.getSubType(d.itemConfig);if((g==s.job||0==g)&&f==a){if(91==Math.floor(d.itemConfig.id/1e4))continue;if(o&&d.handle==o.item.handle)continue;if(0!=ItemUtil.getType(d.itemConfig))continue;u<d.itemConfig.zsLevel||h<d.itemConfig.level?l.push(d):r.push(d)}}return r=r.sort(this.sortFun),l.sort(this.sortFun),r=r.concat(l)},e.prototype.sortFun=function(t,i){var n=e.ins().getEquipAttrs(t),s=e.getAttrPower(n),o=e.ins().getEquipAttrs(i),a=e.getAttrPower(o);return a>s?1:s>a?-1:0},e.prototype.getEquipAttrs=function(t){var e=GlobalConfig.EquipConfig[t.configID],i=[];for(var n in Role.translate)if(e[n]&&!(e[n]<=0)){var s=t.att,o=new AttributeData;o.type=Role.getAttrTypeByName(n),o.value=e[n];for(var a=0;a<s.length;a++)if(s[a].type==Role.getAttrTypeByName(n)){o.value+=s[a].value;break}i.push(o)}return i},e.prototype.checkEqRedPoint=function(t,i,n){var s,o=i.getEquipByIndex(t),a=o.item.itemConfig;if(!a)return!1;var r=ItemUtil.getQuality(a);s=4>r?null:GlobalConfig.ItemConfig[o.item.configID+1];var l=0,h=0;if(5==r||4==r&&a.zsLevel>=13)return!1;if(null!=s&&(s.level>Actor.level||s.zsLevel>ZsCT.ins().lv))return!1;if(null!=s&&0!=o.item.handle&&4==r&&1!=a.level){var u=GlobalConfig.LegendLevelupConfig[o.item.configID];u&&(l=u.count,h=u.itemId)}else{var p=EquipCT.ins().getEquipConfigIDByPosAndQualityByGod(i,t,4,i.job),c=GlobalConfig.LegendComposeConfig[p];if(c){l=c.count,h=c.itemId;var d=this.getBagGoodsCountById(0,h);return d>=l&&!this.OrangeEquipRedPoint[t]?(n&&(this.OrangeEquipRedPoint[t]=!1),!0):!1}}var g=e.ins().getBagGoodsCountById(0,h);return g>=l},e.prototype.getSoulSuitEquips=function(){for(var t=this.bagModel[1],e=[],i=0;t&&i<t.length;i++){var n=t[i];ItemUtil.getType(n.itemConfig)==ItemType.TYPE_28&&e.push(n)}return e},e.prototype.getSoulSuitsByPos=function(t){var e=this.getSoulSuitEquips(),i=[];for(var n in e)t==ItemUtil.getSubType(e[n].itemConfig)&&i.push(e[n]);return i.sort(this.sortSoulSuits),i},e.prototype.sortSoulSuits=function(t,e){return t.configID>e.configID?-1:t.configID<e.configID?1:0},e.prototype.getXMPowerEquips=function(t){for(var i=e.ins().bagModel[0],n=[],s=0;i&&s<i.length;s++){var o=i[s];ItemUtil.getType(o.itemConfig)==t&&n.push(o)}return n},e.prototype.getXMPowerEquipByPos=function(t,e){var i=this.getXMPowerEquips(e),n=[];for(var s in i)t==ItemUtil.getSubType(i[s].itemConfig)&&n.push(i[s]);return n.sort(this.sortSoulSuits),n},e.prototype.getXMPowerEquipById=function(t,e){var i=this.getXMPowerEquips(e),n=[];for(var s in i)t==i[s].itemConfig.id&&n.push(i[s]);return n.sort(this.sortSoulSuits),n},e.prototype.getPowerEquips=function(){for(var t=this.bagModel[1],e=[],i=0;t&&i<t.length;i++){var n=t[i];ItemUtil.getType(n.itemConfig)==ItemType.TYPE_33&&e.push(n)}return e},e.prototype.getPowerEquipByPos=function(t){var e=this.getPowerEquips(),i=[];for(var n in e)t==ItemUtil.getSubType(e[n].itemConfig)&&i.push(e[n]);return i.sort(this.sortSoulSuits),i},e.prototype.getMoJianItems=function(){var t=this.bagModel[e.BAG_TYPE_OTHTER],i=[];for(var n in t){var s=GlobalConfig.MoJianEquip[t[n].configID];s&&i.push(t[n])}return i},e.prototype.getMoJianItemsByPos=function(t){var e=this.getMoJianItems(),i=[];for(var n in e){var s=GlobalConfig.MoJianEquip[e[n].configID];s.pos==t&&i.push(e[n])}return i.sort(this.sortMoJianItems),i},e.prototype.getMoJianItemsByLv=function(t){var i=this.bagModel[e.BAG_TYPE_OTHTER],n=[];for(var s in i){var o=GlobalConfig.MoJianEquip[i[s].configID];o&&t==o.level&&n.push(i[s])}return n},e.prototype.sortMoJianItems=function(t,e){return Algorithm.sortDesc(t.configID,e.configID)},e.prototype.doChoosableGiftResult=function(t){var e=t.readUnsignedByte();0==e&&this.postGiftResult()},e.prototype.postGiftResult=function(){},e.prototype.postBagAdditional=function(t){this.bagAdditional=t.readInt()},e.prototype.sendChoosableGift=function(t,e,i){var n=this.getBytes(8);n.writeInt(t),n.writeInt(e),n.writeInt(i+1),this.sendToServer(n)},e.prototype.postItemEndTime=function(t){var i=t.readDouble(),n=this.getBagGoodsByHandle(e.BAG_TYPE_OTHTER,i);n&&(n.endTime=DateUtils.formatMiniDateTime(t.readInt()))},e.prototype.sendItemEndTime=function(t){var e=this.getBytes(10);e.writeDouble(t),this.sendToServer(e)},e.prototype.getRmbItemIsBuy=function(t){var e=GlobalConfig.ItemConfig[t];return e&&e.needyuanbao&&Actor.yb>=e.needyuanbao?!0:!1},e.prototype.getBestSMItemBySmIdPos=function(t,e){},e.SmeltMax=16,e.BAG_TYPE_OTHTER=0,e.BAG_TYPE_EQUIP=1,e.BAG_TYPE_TREASUREHUNT=2,e.BAG_ENOUGH=20,e.BAG_DESC_TYPE_HEIR=11,__decorate([post()],e.prototype,"postBagVolChange",null),__decorate([post()],e.prototype,"postUseItemSuccess",null),__decorate([post()],e.prototype,"postBagVolAdd",null),__decorate([post()],e.prototype,"postMergeItemBack",null),__decorate([post()],e.prototype,"postItemChange",null),__decorate([post()],e.prototype,"postItemDel",null),__decorate([post()],e.prototype,"postItemAdd",null),__decorate([post()],e.prototype,"postItemCountChange",null),__decorate([post()],e.prototype,"postBagWillFull",null),__decorate([post()],e.prototype,"postHuntStore",null),__decorate([post()],e.prototype,"postHasItemCanUse",null),__decorate([post()],e.prototype,"postGiftResult",null),__decorate([post()],e.prototype,"postBagAdditional",null),e}(BaseSystem);__reflect(BagCT.prototype,"BagCT"),System.BagCT=function(){return BagCT.ins()},window.BagCT=BagCT;var DepotType;!function(t){t[t.Equip=0]="Equip",t[t.Rune=1]="Rune",t[t.Heirloom=2]="Heirloom",t[t.Beast=3]="Beast"}(DepotType||(DepotType={}));var FitleStyle;!function(t){t[t.fj=1]="fj",t[t.hc=2]="hc"}(FitleStyle||(FitleStyle={})),window.FitleStyle=FitleStyle,window.DepotType=DepotType;var ItemData=function(){function t(){this._point=-1,this.endTime=0}return t.prototype.parser=function(t){this.handle=t.readDouble(),this.configID=t.readInt(),this.count=t.readInt(),this.att=[];for(var e=0;8>e;e++){var i=new AttributeData(t.readInt(),t.readInt());this.att.push(i)}this.extAtt=[];for(var e=0;8>e;e++){var i=new AttributeData(t.readInt(),t.readInt());this.extAtt.push(i)}ItemUtil.getType(this.itemConfig)==ItemType.TYPE_47&&BagCT.ins().sendItemEndTime(this.handle)},Object.defineProperty(t.prototype,"configID",{get:function(){return this._configID},set:function(t){this.itemConfig=GlobalConfig.ItemConfig[t],0!=t&&Assert(this.itemConfig,"无法读取道具配置，id："+t+",请检查配置"),this._point=-1,this._configID=t,this.setCanbeUsed()},enumerable:!0,configurable:!0}),t.getStringByList=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=": ");for(var n="",s=0;s<t.length;s++)if(n+=t[s]+i,s<t.length-1)for(var o=0;e>o;o++)n+="\n";return n},t.getStringByNextList=function(t,e){for(var i="",n=0;n<t.length;n++)i+=t[n],e[n]&&(i+=e[n]),n<t.length-1&&(i+="\n");return i},Object.defineProperty(t.prototype,"point",{get:function(){return-1==this._point&&(this._point=ItemUtil.calculateBagItemScore(this)),this._point},enumerable:!0,configurable:!0}),t.prototype.setCanbeUsed=function(){if(this.itemConfig){var t=ItemUtil.getType(this.itemConfig);if(t==ItemType.TYPE_47)this.canbeUsed=!0;else if(t==ItemType.TYPE_20)this.canbeUsed=SpecialRing.ins().checkCanUseByItem(this.itemConfig.id);else if(1==this.itemConfig.useType||2==this.itemConfig.useType){if(ZsCT.ins().lv<this.itemConfig.zsLevel&&Actor.level<this.itemConfig.level)this.canbeUsed=!1;else if(230001==this.itemConfig.id||230002==this.itemConfig.id||230003==this.itemConfig.id?this.canbeUsed=!1:this.canbeUsed=!0,26==Math.floor(this.itemConfig.id/1e4)){var e=this.itemConfig.id%26e4,i=Book.ins().getBookById(e),n=i.getState();this.canbeUsed=n==BookState.canOpen}}else this.canbeUsed=!1}},t.prototype.getCanbeUsed=function(){return this.canbeUsed},t.prototype.copy=function(e){e||(e=new t);var i=this;e.handle=i.handle,e.configID=i.configID,e.count=i.count,e._point=i._point,e.endTime=i.endTime,e.att=[];for(var n=0;8>n;n++){var s=new AttributeData(i.att[n].type,i.att[n].value);e.att.push(s)}e.extAtt=[];for(var n=0;8>n;n++){var s=new AttributeData(i.extAtt[n].type,i.extAtt[n].value);e.extAtt.push(s)}return e},t.prototype.init=function(){this.handle=0,this.configID=0,this.count=0,this.att=[];for(var t=0;8>t;t++){var e=new AttributeData(0,0);this.att.push(e)}this.extAtt=[];for(var t=0;8>t;t++){var e=new AttributeData(0,0);this.extAtt.push(e)}},Object.defineProperty(t.prototype,"subType",{get:function(){return ItemUtil.getSubType(this.itemConfig)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"job",{get:function(){return ItemUtil.getJob(this.itemConfig)},enumerable:!0,configurable:!0}),t}();__reflect(ItemData.prototype,"ItemData"),window.ItemData=ItemData;var ItemUtil=function(){function t(){}return t.calculateBagItemScore=function(e){var i={hp:2,atk:4,def:5,res:6},n=GlobalConfig.EquipConfig[e.itemConfig.id],s=GlobalConfig.AttrPowerConfig,o=0,a=e.att,r=0;if(a)for(var l in i){r=n[l]||0;for(var h=0;h<a.length;h++)if(a[h].type==i[l]){r+=a[h].value;break}o+=r*s[i[l]].pow}else for(var u in i)if(r=n[u]){var p=Role.getAttrTypeByName(u);o+=r*s[p].pow}var c=0;if(n.baseAttr1&&(c+=BagCT.getAttrPower([n.baseAttr1])),n.baseAttr2&&(c+=BagCT.getAttrPower([n.baseAttr2])),n.exPower&&(c+=n.exPower),t.getType(e.itemConfig)==ThunderEquipPanel.TYPE&&e.extAtt){for(var d=GlobalConfig.LeitingEquipEffConf,g=0,f=0;f<e.extAtt.length;f++)e.extAtt[f].type&&(g+=d[e.extAtt[f].type].power*e.extAtt[f].value);c+=g}return Math.floor(o/100)+Math.floor(c)},t.pointCalNumber=function(e){var i=e.id;if(void 0!=t.itemPoints[i])return t.itemPoints[i];var n={hp:2,atk:4,def:5,res:6},s=GlobalConfig.EquipConfig[i],o=GlobalConfig.AttrPowerConfig,a=0;for(var r in n){var l=n[r],h=s[r];if(h){var u=o[l];a+=(h+Math.floor(h*ItemBase.additionRange/100))*u.pow}}return t.itemPoints[i]=Math.floor(a/100),t.itemPoints[i]},t.isCanAwakeEquip=function(e){return e&&GlobalConfig.EquipAwakeConf.equipQuality.indexOf(t.getQuality(e))>-1&&GlobalConfig.EquipAwakeConf.equipType.indexOf(t.getType(e))>-1&&GlobalConfig.EquipAwakeConf.equipSubType.indexOf(t.getSubType(e))>-1},t.pointCalAwakeNumber=function(e,i,n){if(void 0===n&&(n=!0),!e)return 0;var s=e.id,o={hp:2,atk:4,def:5,res:6},a=t.getSubType(GlobalConfig.ItemConfig[s]),r=GlobalConfig.EquipConfig[s],l=GlobalConfig.AttrPowerConfig,h=GlobalConfig.EquipAwakeLevel[a][i],u=0;for(var p in o){var c=o[p],d=r[p];if(d){var g=l[c];u+=((n?d:0)+(h?d*h.precent/1e4:0))*g.pow}}return Math.floor(u/100)},t.getBaseAttrData=function(t){var e=GlobalConfig.EquipConfig[t.id],i={hp:2,atk:4,def:5,res:6},n=[AttributeType.atHolyDamege],s=[];for(var o in i)e[o]&&s.push(new AttributeData(i[o],e[o]));return e.baseAttr1&&n.indexOf(e.baseAttr1.type)>=0&&s.push(new AttributeData(e.baseAttr1.type,e.baseAttr1.value)),e.baseAttr2&&n.indexOf(e.baseAttr2.type)>=0&&s.push(new AttributeData(e.baseAttr2.type,e.baseAttr2.value)),s},t.relatePower=function(t,e){var i=0,n=GlobalConfig.AttrPowerConfig,s=n[t.type];if(s&&s.relate_type){var o=e.getAtt(s.relate_type),a=AttributeData.exRelate[s.relate_type];if(a){var r=e.getAtt(a);r&&(o=Math.floor(o/(1+r/1e4)))}i+=Math.floor(t.value*o*s.relate_power/100)}return i},t.getQuality=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].quality:0},t.getEffName=function(t){var e="";if(!t)return e;var i=GlobalConfig.ItemDescConfig[t.descIndex];return i&&null!=GlobalConfig.ItemEffConfig[i.type]&&null!=GlobalConfig.ItemEffConfig[i.type][i.quality]&&(e=GlobalConfig.ItemEffConfig[i.type][i.quality].name,e=null!=e?e:""),e},t.getDropEffName=function(t){var e="";if(!t)return e;var i=GlobalConfig.ItemDescConfig[t.descIndex];return i&&null!=GlobalConfig.ItemEffConfig[i.type]&&null!=GlobalConfig.ItemEffConfig[i.type][i.quality]&&(e=GlobalConfig.ItemEffConfig[i.type][i.quality].dropEff,e=null!=e?e:""),e},t.getQualityColor=function(t){return ItemBase.QUALITY_COLOR[this.getQuality(t)]},t.getType=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].type:0},t.getSubType=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].subType:0},t.getJob=function(t){return t&&GlobalConfig.ItemDescConfig[t.descIndex]?GlobalConfig.ItemDescConfig[t.descIndex].job:0},t.isEquip=function(t){var e=this.getType(t);switch(e){case ItemType.TYPE_0:case ItemType.TYPE_4:case ItemType.TYPE_11:case ItemType.TYPE_26:case ItemType.TYPE_33:return!0}return!1},t.itemPoints={},t}();__reflect(ItemUtil.prototype,"ItemUtil"),window.ItemUtil=ItemUtil;var BagWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.oldIndex=0,e._sn_="BagSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.tab.dataProvider=this.viewStack,this.itemList.itemRenderer=ItemBase,this.itemListGoods.itemRenderer=ItemBase,this.itemListRune.itemRenderer=ItemBase,this.itemScroller.viewport=this.itemList,this.itemGoodsScroller.viewport=this.itemListGoods,this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.smeltBtn,this.onClick),this.addTouchEvent(this.addBtn,this.onClick),this.addChangeEvent(this.tab,this.onClick)},e.prototype.addDisplay=function(t,e,i,n){void 0===t&&(t=0),this.observe(BagCT.ins().postBagWillFull,this.setBagTips),this.observe(BagCT.ins().postBagVolAdd,this.setCount),this.observe(BagCT.ins().postHasItemCanUse,this.setIsExitUsedItem),this.observe(BagCT.ins().postItemCountChange,this.showBagBtnRedPoint),this.observe(BagCT.ins().postItemChange,this.updateBag),this.observe(BagCT.ins().postItemAdd,this.updateBag),this.observe(BagCT.ins().postItemDel,this.updateBag),this.observe(OtherCT.ins().postYBCardTime,this.upTips),3==t&&this.reinComposePanel.setParam(e,i,n),this.viewStack.selectedIndex=this.tab.selectedIndex=t,this.setBagData(t),this.setIsExitUsedItem(),BagCT.ins().postBagVolChange(),this.showBagBtnRedPoint(BagCT.ins().isChange),MergeCC.ins().isOpen()?this.openMerge():this.inactiveSamsara(),this.upTips()},e.prototype.removeDisplay=function(){var t=ViewManager.ins().getView(UIView2);t&&t.closeNav(UIView2.NAV_BAG)},e.prototype.openMerge=function(){var t=this.viewStack.getChildIndex(this.reinComposePanel);0>t&&this.viewStack.addChild(this.reinComposePanel),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=37,this.redPoint3.visible=MergeCC.ins().redPoint()},e.prototype.inactiveSamsara=function(){var t=this.viewStack.getChildIndex(this.reinComposePanel);t>=0&&this.viewStack.removeChildAt(t),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=98,this.redPoint3.visible=!1},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.smeltBtn:ViewManager.ins().close(e),ViewManager.ins().open(SmeltEquipTotalWin);break;case this.addBtn:var i=GlobalConfig.BagBaseConfig,n=(Actor.bagNum-i.baseSize)/i.rowSize;n>=CommonUtils.getObjectLength(GlobalConfig.BagExpandConfig)?TipsCT.ins().showTips(StringUtils.addColor("格子不能继续扩张",15937822)):ViewManager.ins().open(BagAddItemWarn);break;case this.tab:3==this.tab.selectedIndex||(2==this.tab.selectedIndex?this.setBagData(this.tab.selectedIndex):this.setBagData(this.tab.selectedIndex))}},e.prototype.setCount=function(){this.itemCount.text=BagCT.ins().getBagItemNum()+"/"+BagCT.ins().getMaxBagRoom()},e.prototype.updateBag=function(){this.setBagData(this.oldIndex)},e.prototype.setBagData=function(t){switch(void 0===t&&(t=1),t){case 0:var e=BagCT.ins().getBagSortQualityEquips(5,0,1);e.sort(BagCT.ins().sort3);var i=this.itemList.dataProvider;i?i.replaceAll(e):this.itemList.dataProvider=new eui.ArrayCollection(e);break;case 1:var n=BagCT.ins().getBagGoodsBySort(0),s=BagCT.ins().getBagGoodsBySort(2),o=BagCT.ins().getBagGoodsBySort(3),a=o.concat(s,n),r=this.itemListGoods.dataProvider;r?r.replaceAll(a):this.itemListGoods.dataProvider=new eui.ArrayCollection(a);break;case 2:var l=BagCT.ins().getBagGoodsBySort(1),h=this.itemListRune.dataProvider;h?h.replaceAll(l):this.itemListRune.dataProvider=new eui.ArrayCollection(l)}this.oldIndex!=t?this.oldIndex=t:this.tab.selectedIndex=t,this.setCount()},e.prototype.setIsExitUsedItem=function(){this.redPoint1.visible=BagCT.ins().getIsExitUsedItem()||BagCT.ins().getBagGoodsCountByType(),this.redPoint2.visible=BagCT.ins().getRuneBagGoodsCountByType(),this.redPoint3.visible=MergeCC.ins().isOpen()&&MergeCC.ins().redPoint()},e.prototype.setBagTips=function(t){this.redPoint0.visible=t>0||BagCT.ins().isChange>0},e.prototype.showBagBtnRedPoint=function(t){this.redPoint.visible=t>0},e.prototype.upTips=function(){this.eTips.visible=OtherCT.ins().hasDouble},__decorate([callDelay(100)],e.prototype,"updateBag",null),e}(BaseEuiView);__reflect(BagWin.prototype,"BagWin"),ViewManager.ins().reg(BagWin,LayerManager.UI_Main),window.BagWin=BagWin;var BookUpItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mc=new MovieClip,this.mc.x=45,this.mc.y=40},e.prototype.dataChanged=function(){if(this.clear(),this.data instanceof ItemData){if(this.itemConfig=this.data.itemConfig,this.itemIcon.setData(this.itemConfig),null==this.itemConfig)return;var t=ItemUtil.getType(this.itemConfig),e=ItemUtil.getJob(this.itemConfig);4==t&&(this.nameTxt.text=this.itemConfig.name),this.itemIcon.imgJob.source=(0==t||4==t)&&e&&this.itemIcon.imgJob.visible?"job"+e+"Item":""}},e.prototype.onClick=function(){},e.prototype.playEff=function(){this.data&&(this.mc.playFile(RES_DIR_EFF+"BoomEff",1),this.addChild(this.mc))},e.prototype.clear=function(){t.prototype.clear.call(this),this.itemIcon.imgJob.source=null},e}(ItemBase);__reflect(BookUpItem.prototype,"BookUpItem"),window.BookUpItem=BookUpItem;var DressSpecialTipsBase=function(t){function e(){var e=t.call(this)||this;return e.skinName="DressSpecialAttrSkin",e}return __extends(e,t),e.prototype.setData=function(t){if(this.clear(),null!=t){var e=t.title,i=t.attrDesc;this.attrType.textFlow=TextFlowMaker.generateTextFlow1(e),this.suit.textFlow=TextFlowMaker.generateTextFlow1(i)}},e.prototype.clear=function(){this.attrType.textFlow=null,this.suit.textFlow=null},e}(BaseView);__reflect(DressSpecialTipsBase.prototype,"DressSpecialTipsBase"),window.DressSpecialTipsBase=DressSpecialTipsBase;var DressTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="DressTipsSkin",e.sex=0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemConfig=t[0],this.showBtn=t[1]?t[1]:!1,this.takeBtn.visible=this.showBtn,this.itemId=this.itemConfig.id,this.setTipsData()},e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTap),this.addTouchEndEvent(this.bgClose,this.otherClose),this.weaponMc=new MovieClip,this.weapon.addChild(this.weaponMc),this.wingMc=new MovieClip,this.wing.addChild(this.wingMc),this.bodyMc=new MovieClip,this.body.addChild(this.bodyMc),this.sexBtn.visible=!1},e.prototype.setTipsData=function(){var t=this.getIdByItemId(this.itemId);if(this.itemData=t,t){this.eLab.visible=Dress.ins().isLimitZhuangBanItem(this.itemId);var e=t.attr,i=BagCT.getAttrPower(AttributeData.transformAttr(e))+(t.exPower||0);this.powerPanel.setPower(i),this.itemname.text=t.name;var n=t.show_img;this.eWingImg.source=this.eBodyImg.source=this.eWeaponImg.source=n,this.quali.source="quali"+ItemUtil.getQuality(this.itemConfig),this.style.text=DressTypeName[t.pos],this.dressName.source=t.dress_name?t.dress_name+"_png":"";var s=new EquipTipsItemBase;if(s.data={title:"普通属性",attributeData:e,colorName:0,colorValue:0,others:null},this.content.addChild(s),t.special_attr_desc){var o=new DressSpecialTipsBase;o.setData({title:"特殊属性",attrDesc:t.special_attr_desc}),this.content.addChild(o)}this.updateEff()}},e.prototype.updateEff=function(){var t=GlobalConfig.ZhuangBanId[this.itemData.id];switch(this.eWingImg.visible=this.eBodyImg.visible=this.eWeaponImg.visible=this.bodyMc.visible=this.weaponMc.visible=this.wingMc.visible=!1,t.pos){case 1:this.sexBtn.visible=!0,t.useMc?(this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+t.res+"_"+this.sex+"_c_m",-1)):(this.eBodyImg.visible=!0,this.eBodyImg.source=t.res+"_"+this.sex+"_c_png",this.bodyMc.stop());break;case 2:t.useMc?(this.weaponMc.visible=!0,this.weaponMc.playFile(RES_DIR_DRESS+t.res+"_0_c_m",-1)):(this.eWeaponImg.visible=!0,this.weaponMc.stop());break;case 3:t.useMc?(this.wingMc.visible=!0,this.wingMc.playFile(RES_DIR_DRESS+t.res+"_c_m",-1)):(this.eWingImg.visible=!0,this.wingMc.stop())}},e.prototype.setSex=function(){this.sex=this.sexBtn.selected?1:0,this.updateEff()},e.prototype.onTap=function(t){switch(t.target){case this.takeBtn:ViewManager.ins().close(this),ViewManager.ins().open(DressWin,0,this.itemData.pos-1,this.itemData.id);break;case this.sexBtn:this.setSex()}},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.getIdByItemId=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var n=e[i];if(n.cost.itemId==t||n.permanentCost&&n.permanentCost.itemId==t)return n}return null},e}(BaseEuiView);__reflect(DressTipsWin.prototype,"DressTipsWin"),ViewManager.ins().reg(DressTipsWin,LayerManager.UI_Popup),window.DressTipsWin=DressTipsWin;var EquipDetailedWin=function(t){function e(){var e=t.call(this)||this;return e.scrollMaxHeight=620,e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.index=0,e.type1=0,e.basicAttr=[],e._sn_="EquipTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.powerPanel.setBgVis(!1),this.itemIcon.imgJob.visible=!1,this.eList.itemRenderer=PowerEquipSuitItem},e.prototype.addDisplay=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.type1=t[0];var n=t[1];return this.configID=t[2],this.data=t[3],this.roleModel=t[4],this.showXueYin=!1,t[5]>=0?(this.curRole=t[5],this.index=t[6],this.showXueYin=BloodstainCT.checkItem(this.data)):DisplayUtils.removeFromParent(this.changeBtn),this.showXueYin||DisplayUtils.removeFromParent(this.eXueyinBtn),t[7]||DisplayUtils.removeFromParent(this.official),this.data&&ItemUtil.getType(this.data.itemConfig)==ThunderEquipPanel.TYPE?(ViewManager.ins().open(ThunderEquipTipsWin,0,ItemUtil.getSubType(this.data.itemConfig),this.data),void ViewManager.ins().close(e)):(this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.changeBtn,this.onEquipChange),this.addTouchEndEvent(this.eXueyinBtn,this.onXueyinBtn),this.addTouchEndEvent(this.official,this.onOfficial),this.setData(this.type1,n,this.configID,this.data),this.type1==ItemType.TYPE_33?this.UpDatePowerEquip(this.data):DisplayUtils.removeFromParent(this.mSuitGroup),!this.roleModel||0!=this.index&&2!=this.index||this.type1==ItemType.TYPE_33||this.upDataView(),this.updateImgGrp(),this.updateBloodstain(),this.observe(OfficalPostRedPoint.ins().postRoleRedPoint,this.updateRed),this.observe(BloodstainRedPoint.ins().postRoleRedPoint,this.updateRed),this.updateRed(),void(this.eScroller.height>this.scrollMaxHeight&&(this.eScroller.height=this.scrollMaxHeight)))},e.prototype.updateRed=function(){this.eXueyinBtn.eRp&&(this.eXueyinBtn.visible?this.eXueyinBtn.eRp.visible=BloodstainRedPoint.ins().itemReds[this.curRole]&&BloodstainRedPoint.ins().itemReds[this.curRole][ItemUtil.getSubType(this.data.itemConfig)]:this.eXueyinBtn.eRp.visible=!1)},e.prototype.onOfficial=function(){OfficalPostCT.ins().checkOpen(!0)&&(ViewManager.ins().open(OfficaPostPanel,this.curRole),ViewManager.ins().close(e))},e.prototype.otherClose=function(){ViewManager.ins().close(e)},e.prototype.onXueyinBtn=function(){ViewManager.ins().open(BloodstainWin,ItemUtil.getSubType(this.data.itemConfig),this.curRole),ViewManager.ins().close(this)},e.prototype.onEquipChange=function(){if(this.type1==ItemType.TYPE_33){var t=ItemUtil.getSubType(this.data.itemConfig);ViewManager.ins().open(RoleChooseEquipWin,this.curRole,t,ItemType.TYPE_33)}else ViewManager.ins().open(RoleChooseEquipWin,this.curRole,this.index);ViewManager.ins().close(e)},e.prototype.getExtremeName=function(t){var e="";if(ItemUtil.isCanAwakeEquip(t)){var i=this.roleModel?this.roleModel.equipAwakeLv[ItemUtil.getSubType(t)]:0;i>0&&(e+=GlobalConfig.EquipAwakeConf.firstName[i])}var n=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,this.index);return n&&(e+=GlobalConfig.ZhiZunEquipLevel[this.index][n].headTxt),e},e.prototype.setData=function(t,e,i,n){var s,o=n instanceof ItemData?n:void 0;if(this._totalPower=0,void 0!=e&&void 0==o){if(o=BagCT.ins().getBagGoodsByHandle(t,e),!o)for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++)for(var l=SubRoles.ins().getSubRoleByIndex(r),h=l.getEquipLen(),u=0;h>u;u++)if(l.getEquipByIndex(u).item.handle==e){o=l.getEquipByIndex(u).item;break}if(!o)for(var p=Shop.ins().shopData,a=p.getShopEquipDataLength(),c=null,r=0;a>r;r++)if(c=p.getShopEquipDataByIndex(r),null!=c&&e==c.item.handle){o=c.item;break}o||new Error("请检查handle是否传错！"),s=o.itemConfig,i=o.configID}else s=GlobalConfig.ItemConfig[i];t==ItemType.TYPE_33?(this.itemIcon.setTag("zz_jj"+GlobalConfig.MasterEquipConf[i].stage),this.nameLabel.text=s.name):this.nameLabel.text=this.getExtremeName(s)+s.name,this.nameLabel.textColor=ItemUtil.getQualityColor(s);var d=ItemUtil.getQuality(s),g=ItemUtil.getSubType(s),f=ItemUtil.getJob(s);this.quali.source=d>0?"quali"+d:"",this.itemIcon.setData(s);var v=0;if(this.jobKey.text="职业：",o instanceof ItemData||s)if(o&&4==ItemUtil.getType(o.itemConfig)){this.levelKey.text="需求：",this.type.text=Role.getWingEquipNameByType(g),this.lv.text=s.level+1+"阶翅膀可穿戴",this.lv.textColor=15937822;
for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++)if(SubRoles.ins().getSubRoleByIndex(r).wingsData.lv>=s.level){this.lv.textColor=3532333;break}this.career.text=Role.getJobNameByJob(f),this.jobGroup.visible=!0}else o&&5==ItemUtil.getType(o.itemConfig)?(this.levelKey.text=s.zsLevel>0?"转生：":"等级：",this.type.text=Role.getHejiEquipNameByType(g),this.lv.text=isNaN(s.zsLevel)?(s.level||1)+"级":s.zsLevel+"转",s.zsLevel>0?this.lv.textColor=ZsCT.ins().lv<s.zsLevel&&this.roleModel&&this.roleModel.isMy?15937822:3532333:this.lv.textColor=Actor.level<s.level&&this.roleModel&&this.roleModel.isMy?15937822:3532333,this.jobGroup.visible=!1,-1!=BagCT.fitleEquip.indexOf(s.id)&&(this.lv.text="无级别")):s&&ItemUtil.getType(s)==ItemType.TYPE_33?(this.levelKey.text="阶级",this.type.text=Role.getEquipNameByType(g),this.lv.text=GlobalConfig.MasterEquipConf[s.id].stage+"阶",this.jobKey.text="等级：",this.career.text=isNaN(s.zsLevel)?(s.level||1)+"级":s.zsLevel+"转"+(s.level?s.level+"级":"")):(g==EquipPos.DZI?(this.levelKey.text="等阶：",this.type.text=Role.getEquipNameByType(g),this.lv.text=BagCT.ins().getGuanyinLevel(s)):(this.levelKey.text=s.zsLevel>0?"转生：":"等级：",this.type.text=Role.getEquipNameByType(g),this.lv.text=isNaN(s.zsLevel)?(s.level||1)+"级":s.zsLevel+"转",-1!=BagCT.fitleEquip.indexOf(s.id)&&(this.lv.text="无级别")),s.zsLevel>0?this.lv.textColor=ZsCT.ins().lv<s.zsLevel&&this.roleModel&&this.roleModel.isMy?15937822:3532333:this.lv.textColor=Actor.level<s.level&&this.roleModel&&this.roleModel.isMy?15937822:3532333,this.career.text=Role.getJobNameByJob(f),this.jobGroup.visible=!0);var y,m=GlobalConfig.EquipConfig[i],T=[],C=["","","hp","","atk","def","res"];this.roleModel&&(y=this.roleModel.heirloom.getInfoBySolt(this.index)),this.basicAttr=[];var b="";for(var I in Role.translate)if(!isNaN(m[I])&&m[I]){var w="",S=AttributeData.getAttrStrByType(Role.getAttrTypeByName(I));w+=S+"  ",w+=m[I],this.basicAttr.push([S,m[I]]);var _=new AttributeData;if(void 0!=o){if(o.att){for(var B=o.att,D=0;D<B.length;D++)if(B[D].type==Role.getAttrTypeByName(I)){w+=" +"+B[D].value,y&&y.attr_add&&(w+="+"+Math.floor((m[I]+B[D].value)*(y.attr_add/100))),_.type=B[D].type,_.value=m[I]+B[D].value,T.push(_);break}}else for(var x in m)if(C[x]){var R=m[C[x]];if(void 0!=R&&0!=R){var E=Role.getAttrTypeByName(C[x]);w+=AttributeData.getAttrStrByType(E)+"  ",w+=m[x],_.type=E,_.value=m[x],T.push(_)}}}else _.type=Role.getAttrTypeByName(I),_.value=m[I],T.push(_);""!=b&&(b+="\n"),b+=w}for(this.attr.text=b,o?this._equipPower=o.point:(this._equipPower=Math.floor(BagCT.getAttrPower(T)),m&&m.exPower&&(v=m.exPower)),this._totalPower+=this._equipPower+v,this._score=this._totalPower,this.score.text="评分："+this._totalPower,this._bottomY=0;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);if(this.roleModel){if(ItemUtil.isCanAwakeEquip(s)){var A=ItemUtil.getSubType(s),P=this.roleModel.equipAwakeLv[A]||0;this._totalPower+=ItemUtil.pointCalAwakeNumber(s,P,!1)}for(var a=this.roleModel.getEquipLen(),r=0;a>r;r++){var k=this.roleModel.getEquipByIndex(r);if(k.item.handle==e){this.setForge(k,r);break}}m&&(m.baseAttr1&&(this._equipPower+=ItemUtil.relatePower(m.baseAttr1,this.roleModel)),m.baseAttr2&&(this._equipPower+=ItemUtil.relatePower(m.baseAttr2,this.roleModel)))}if(g==EquipPos.DZI&&this.addTips(null,4,0),s.desc){var M=new eui.Label;M.size=18,M.width=250,M.textColor=13746831,M.x=this.attr.x,M.y=this._bottomY+=10,M.textFlow=TextFlowMaker.generateTextFlow(s.desc),this.forgeGroup.addChild(M),this._bottomY+=M.textHeight}this.powerPanel.setPower(this._totalPower)},e.prototype.setForge=function(t,e){this.addAwakeTips(t,e),this.addLegendTips(t);for(var i=0,n=0;4>n;n++){switch(n){case ForgeWin.Page_Select_Boost:i=t.strengthen;break;case ForgeWin.Page_Select_ZhuLing:i=t.zhuling;break;case ForgeWin.Page_Select_Gem:i=t.gem;break;case ForgeWin.Page_Select_Weapon:i=t.tupo}if(i>0){var s=ForgeCT.ins().getForgeConfigByPos(e,i,n);this.addTips(s.attr,n,i);var o=0;o=3==n?Math.floor(this._equipPower*(Number(s.attr)/100)):Math.floor(BagCT.getAttrPower(s.attr)),this._totalPower+=o}}if(e>=EquipPos.WEAPON&&e<=EquipPos.SHOE&&(i=ExtremeEquipModel.ins().getZhiZunLvByRoleID(this.roleModel,e),this.itemIcon.extreme.visible=i>0,i)){var s=GlobalConfig.ZhiZunEquipLevel[e][i];s.ex_attrs&&(this._totalPower+=Math.floor(BagCT.getAttrPower(s.ex_attrs))),this._totalPower+=s.ex_power;var a="",r=ExtremeEquipModel.ins().getZhiZunLinkLv(this.roleModel,e,i),l=r>0,h=void 0,u=!1;for(var p in GlobalConfig.ZhiZunLinkLevel[e]){for(var c in GlobalConfig.ZhiZunLinkLevel[e][p])if(h=GlobalConfig.ZhiZunLinkLevel[e][p][c],1==h.level&&(a=h.chainDesc),h.level==r&&l){u=!0,h.attrs&&(this._totalPower+=Math.floor(BagCT.getAttrPower(h.attrs))),h.exAttrs&&(this._totalPower+=Math.floor(BagCT.getAttrPower(h.exAttrs))),this._totalPower+=h.ex_power,a=h.chainDesc;break}if(u)break}this._totalPower+=Math.floor(BagCT.getAttrPower(s.attrs)),this.addTips(s.attrs,5,i,r,s.skillId,a)}},e.prototype.addLegendTips=function(t){if(!(GlobalConfig.HotBloodAwakeConf.legendEquip.indexOf(t.item.configID)<=-1)){var e=GlobalConfig.EquipConfig[t.item.configID];if(e.baseAttr1){var i=new AttributeData(e.baseAttr1.type,e.baseAttr1.value);this.addTips([i],7)}}},e.prototype.addAwakeTips=function(t,e){if(ItemUtil.isCanAwakeEquip(t.item.itemConfig)&&this.roleModel){var i=this.roleModel.equipAwakeLv[e];if(i>0){var n=GlobalConfig.EquipAwakeLevel[e][i],s=ItemUtil.getBaseAttrData(t.item.itemConfig);for(var o in s)s[o].value=Math.floor(s[o].value*n.precent/1e4);this.addTips(s,6,n.precent/100,i)}}},e.prototype.addTips=function(t,e,i,n,s,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o="");var a=new eui.Label;a.fontFamily="Arial",a.size=20,a.textColor=8283191,a.bold=!0,a.x=24,a.y=this._bottomY+10+14,a.touchEnabled=!1,this.forgeGroup.addChild(a);var r=new eui.Label;r.fontFamily="Arial",r.size=18,r.lineSpacing=8,r.x=46,r.y=a.y+24,r.touchEnabled=!1,this.forgeGroup.addChild(r);var l;switch(e){case ForgeWin.Page_Select_Boost:a.text="强化属性",l=AttributeData.getAttrStrAdd(t,11,this.roleModel.tempVipLv),r.textColor=5342973;break;case ForgeWin.Page_Select_Gem:a.text="注魂属性",l=AttributeData.getAttrStrAdd(t,12,this.roleModel.tempVipLv),r.textColor=13779707;break;case ForgeWin.Page_Select_ZhuLing:a.text="淬炼属性",r.textColor=15054355,l=AttributeData.getAttrStrAdd(t,15,this.roleModel.tempVipLv);break;case ForgeWin.Page_Select_Weapon:a.text="突破属性";break;case 4:a.text="特殊属性",this._bottomY=a.y+a.height;break;case 5:a.text="霸业属性",a.textColor=16577847,l=t,r.textColor=16577847;break;case 6:a.text="觉醒属性 "+GlobalConfig.EquipAwakeConf.stageNames[n],a.textColor=14316818,l=t,r.textColor=14316818;break;case 7:a.text="热血属性",a.textColor=16776960,l=t[0],r.textColor=16776960}var h;e!=ForgeWin.Page_Select_ZhuLing&&5!=e&&this.roleModel&&(h=this.roleModel.heirloom.getInfoBySolt(this.index));var u=0;if(l)if(6==e){var p="\n装备基础属性加成 "+i+"%";r.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(l,1,1,"  ",!1,!0)+p)}else if(e!=ForgeWin.Page_Select_Weapon){if(r.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(l,1,1,"  ",!1,!0,h)),5==e){var c=new eui.Label;c.fontFamily="Arial",c.size=20,c.textColor=16577847,c.x=24,c.y=r.y+r.height+10,c.touchEnabled=!1,c.width=280,this.forgeGroup.addChild(c),c.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(n?"#FCF537":"#666666")+"'><b>【灵魂锁链Lv"+(n?n:1)+"】</b></font>"),u+=c.textHeight+10;var d=new eui.Label;if(d.fontFamily="Arial",d.size=18,d.lineSpacing=8,d.textColor=16577847,d.x=46,d.y=c.y+c.textHeight+10,d.touchEnabled=!1,d.multiline=!0,d.wordWrap=!0,this.forgeGroup.addChild(d),d.textFlow=TextFlowMaker.generateTextFlow("<font color = '"+(n?"#FCF537":"#666666")+"'>"+o+"</font>"),u+=d.textHeight+10,s){var g=GlobalConfig.SkillsConfig[s],f=new eui.Label;f.fontFamily="Arial",f.size=20,f.textColor=16577847,f.x=24,f.y=d.y+d.height+10,f.touchEnabled=!1,f.width=280,f.wordWrap=!0,f.multiline=!0,this.forgeGroup.addChild(f),f.textFlow=TextFlowMaker.generateTextFlow("<b>【"+SkillUtil.getName(g)+"Lv"+i+"】</b>"),u+=f.textHeight+10;var v=new eui.Label;v.fontFamily="Arial",v.size=18,v.lineSpacing=8,v.textColor=16577847,v.x=46,v.y=f.y+f.textHeight+10,v.touchEnabled=!1,v.width=280,v.wordWrap=!0,v.multiline=!0,this.forgeGroup.addChild(v),v.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(g)),u+=v.textHeight+10}}}else r.textFlow=TextFlowMaker.generateTextFlow1("基础属性 +"+t+"%");this._bottomY=r.y+r.height+u},e.prototype.getScore=function(){return this._score},e.prototype.getPower=function(){return this.powerPanel.power},e.prototype.getType=function(){return this.type.text},e.prototype.upDataView=function(){var t=this.haveEquip(this.index);if(this._bottomY+=30,t){var e=EquipCT.getLegendJINengLevel(),i=this.roleModel.legenEquipDate[this.index],n=this.roleModel.legenEquipDate[0==this.index?2:0],s=null,o=(0==i?1:i).toString(),a=this.createLabel(this.forgeGroup,"神话属性:"+("   ["+o+"阶]"),i>0?13779707:5196867,"left",25);a.size=20,a.touchEnabled=!1,a.bold=!0;var r="|C:0xD242FB&T:神话属性| C:"+(i>0?13779707:5196867)+"&T:  ["+o+"阶]|";a.textFlow=TextFlowMaker.generateTextFlow1(r);for(var l in GlobalConfig.HotBloodAwakeLevel)for(var h in GlobalConfig.HotBloodAwakeLevel[l])GlobalConfig.HotBloodAwakeLevel[l][h].slot==this.index&&GlobalConfig.HotBloodAwakeLevel[l][h].level==(0==i?1:i)&&(s=GlobalConfig.HotBloodAwakeLevel[l][h]);var u=0;if(null!=s){for(var p=s.attrs,l=0;l<p.length;l++){var c=AttributeData.getAttrStrByType(p[l].type);this.createLabel(this.forgeGroup,c+":"+p[l].value,0==i?5196867:65280,"left",44)}this.createLabel(this.forgeGroup,(0==this.index?"热血霸刀":"热血神甲")+"基础属性:"+s.precent/100+"%",0==i?5196867:65280,"left",44),u+=BagCT.getAttrPower(p);var d=ItemUtil.getBaseAttrData(this.roleModel.equipsData[this.index].item.itemConfig);for(var g in d)d[g].value=d[g].value*(s.precent/1e4);u+=BagCT.getAttrPower(d),0==i&&(u=0)}a=this.createLabel(this.forgeGroup,"神话套装:",15909414,"left",25),a.size=20,a.touchEnabled=!1,a.bold=!0;var f=0==this.index?i:n,v=2==this.index?i:n,y=e[0],m=Number(GlobalConfig.SkillsConfig[EquipCT.LegendToLevelgenDescID(i,n)].desc),T=!0;f>=e[2]&&v>=e[2]?y=e[2]:f>=e[1]&&v>=e[1]?y=e[1]:f>=e[0]&&v>=e[0]?y=e[0]:T=!1,this.createLabel(this.forgeGroup,"[热血霸刀神话"+(0==f?1:f)+"阶 ("+f+"/"+y+")]",0==f?5196867:15909414,"left",44),this.createLabel(this.forgeGroup,"[热血神甲神话"+(0==v?1:v)+"阶 ("+v+"/"+y+")]",0==v?5196867:15909414,"left",44);var C=GlobalConfig.SkillsDescConfig[m],b=new eui.Label;b.size=18,b.width=280,b.textColor=T?ColorUtil.GREEN:7170660,b.textFlow=TextFlowMaker.generateTextFlow1(C.desc),b.anchorOffsetX=0,b.anchorOffsetY=0,b.textAlign="center",b.y=this._bottomY+=10,this._bottomY=b.y+b.height+10,this.forgeGroup.addChild(b),b.x+=35,this.powerPanel.setPower(this.getPower()+u),this.score.text="评分："+(this.getPower()+u)}},e.prototype.UpDatePowerEquip=function(t){var e;if(isNaN(t))if(t instanceof ItemData)e=t.itemConfig;else{if(1!=this.data.type)return;if(e=GlobalConfig.ItemConfig[t.id],!e)return}else e=GlobalConfig.ItemConfig[t];var i=this.getGodPowerFormItemId(e.id),n=ItemUtil.getSubType(e),s=!!this.roleModel&&!!this.roleModel.powerEquipAwakeLv&&this.roleModel.powerEquipAwakeLv[n],o=n%2+1,a=1==o?1:0,r=PowerEquipAwakeCT.getPosStage(this.roleModel,a),l=Math.max.apply(null,r),h=GlobalConfig.MasterEquipAwakeSuitConf[o][l];if(s==l&&h){var u="",p=0,c=0;for(var d in r)r[d]==l&&c++;if(c>1){var g="",f="";for(var v in h)if(c>=parseInt(v))for(var y in h[v].exattr){var m=AttributeData.getAttrStrByType(h[v].exattr[y].type),T=(h[v].exattr[y].value/100).toFixed(1)+"%";for(var d in this.basicAttr)if(this.basicAttr[d][0]==m){var C=Math.floor(this.basicAttr[d][1]*(h[v].exattr[y].value/1e4));g+=""+m+"  "+C+"\n",p+=20;var b=[{type:h[v].exattr[y].type,value:C}],I=0;I=Math.floor(BagCT.getAttrPower(b)),this._totalPower+=I,this.powerPanel.setPower(this._totalPower),f+="主宰装备"+m+"+"+T+"\n",p+=20}}u=g+f}if(u){var w=this.createLabel(this.forgeGroup,"主宰觉醒",15937822,"left",25);w.size=20,w.touchEnabled=!1,w.bold=!0;var S=this.createLabel(this.forgeGroup,"",15937822,"left",46);S.lineSpacing=7,S.text=u,S.height+=p,this._bottomY+=p,this._bottomY+=10}}var _=this.createLabel(this.forgeGroup,"主宰属性",16741647,"left",25);_.size=20,_.touchEnabled=!1,_.bold=!0,_=this.createLabel(this.forgeGroup,"主宰经验  "+i,16741647,"left",46),_.touchEnabled=!1;var B,D=GlobalConfig.MasterEquipQuenchingConf;if(this.roleModel){var x=this.roleModel.powerEquipDate[n];for(var d in D)for(var R in D[d])for(var y in D[d][R])if(D[d][R][y].slot==n&&1==D[d][R][y].pos&&D[d][R][y].leve==x[0]?B=B?AttributeData.AttrAddition(B,D[d][R][y].attrs):D[d][R][y].attrs:D[d][R][y].slot==n&&2==D[d][R][y].pos&&D[d][R][y].leve==x[1]?B=B?AttributeData.AttrAddition(B,D[d][R][y].attrs):D[d][R][y].attrs:D[d][R][y].slot==n&&3==D[d][R][y].pos&&D[d][R][y].leve==x[2]&&(B=B?AttributeData.AttrAddition(B,D[d][R][y].attrs):D[d][R][y].attrs),D[d][R][y].slot!=n)break;if(B){var E=this.createLabel(this.forgeGroup,"主宰淬炼",5342973,"left",25);E.size=20,E.touchEnabled=!1,E.bold=!0;var A=this.createLabel(this.forgeGroup,"",5342973,"left",46);A.lineSpacing=7;for(var d=0;d<B.length;d++){var P=AttributeData.getAttrStrByType(B[d].type);A.text+=P+"  "+B[d].value+"\n",A.height+=20,this._bottomY+=20}this._bottomY+=10}}var k=this.data.configID||this.configID,M=PowerEquipCT.ins().getStageFormItemId(k),L=PowerEquipCT.ins().getPosFormItemId(k),G=[],F=GlobalConfig.MasterEquipStarSuitConf;for(var d in F)if(F[d].stage==M)for(var R in F[d].cond)if(+R==L){G.push([F[d],this.roleModel]);break}this.eList.dataProvider=new eui.ArrayCollection(G)},e.prototype.haveEquip=function(t){var e=GlobalConfig.HotBloodAwakeConf.legendEquip;if(0==this.roleModel.equipsData[t].item.configID)return!1;if(0==t){for(var i=0;i<e.length/2;i++)if(this.roleModel.equipsData[0].item.configID==e[i])return this._totalPower=ItemUtil.calculateBagItemScore(this.roleModel.equipsData[0].item),!0}else for(var i=e.length/2;i<e.length;i++)if(this.roleModel.equipsData[2].item.configID==e[i])return this._totalPower=ItemUtil.calculateBagItemScore(this.roleModel.equipsData[2].item),!0;return!1},e.prototype.createLabel=function(t,e,i,n,s){var o=new eui.Label;return o.size=18,o.width=250,o.fontFamily="Arial",o.textColor=13746831,o.text=e,o.anchorOffsetX=0,o.anchorOffsetY=0,o.textAlign=n,o.textColor=i,t.addChild(o),o.y=this._bottomY+=9,this._bottomY=o.y+o.height,o.x+=s,o},e.prototype.getGodPowerFormItemId=function(t){var e=GlobalConfig.MasterEquipConf;for(var i in e)if(e[i].itemId==t)return e[i].godpower},e.prototype.updateBloodstain=function(){if(this.updateBloodGroup(),!this.showXueYin||!this.data)return void DisplayUtils.removeFromParent(this.eXueyinGroup);var t=BloodstainCT.ins().getBloodstainEquip(this.curRole,ItemUtil.getSubType(this.data.itemConfig));if(!(t&&t.lv>0))return void DisplayUtils.removeFromParent(this.eXueyinGroup);for(var e=BloodstainCT.ins().getEquipSuitLvs(this.curRole),i=1;4>i;i++){var n=this["xueyin"+i];n.filters=t.lv>=i?null:FilterUtil.ARRAY_GRAY_FILTER;var s=this["xiaoguo"+i],o=GlobalConfig.BloodstainSkillConfig[i];s.text="";for(var a in o){var r=o[a];if(r.skillId){s.text=SkillUtil.getDesc(GlobalConfig.SkillsConfig[r.skillId]),s.filters=e[r.equipCountLimit-1]>=r.levelLimit?null:FilterUtil.ARRAY_GRAY_FILTER;break}}}},e.prototype.updateBloodGroup=function(){if(!this.showXueYin||!this.data)return void DisplayUtils.removeFromParent(this.eBloodGroup);var t=BloodstainCT.ins().getBloodstainEquip(this.curRole,ItemUtil.getSubType(this.data.itemConfig));if(!(t&&t.lv>0))return void DisplayUtils.removeFromParent(this.eBloodGroup);var e=GlobalConfig.BloodstainLevelConfig[t.lv],i=AttributeData.getAttrFromCfg(e),n=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子","","面甲","护肩","披风","护符"];this.sBloodAtt=AttributeData.getAttStr(i),this.sBloodAtt+=e.equipAdd>0?"\n"+n[t.pos]+"部位基础属性+"+MathUtils.toInteger(e.equipAdd/100)+"%":""},e.prototype.updateImgGrp=function(){var t=this.data.configID||this.configID;t&&-1!=GlobalConfig.HotBloodAwakeConf.legendEquip.indexOf(t)||DisplayUtils.removeFromParent(this.eImgGrp)},e}(BaseEuiView);__reflect(EquipDetailedWin.prototype,"EquipDetailedWin"),window.EquipDetailedWin=EquipDetailedWin,ViewManager.ins().reg(EquipDetailedWin,LayerManager.UI_Popup);var FlowerOpenWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerOpenSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FlowerRewardItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.closeBtn0,this.onTouch),this.observe(FbCT.ins().postTeamFbFlowarRecords,this.update),this.update()},e.prototype.close=function(){FbCT.ins().clearTfFlowerRecords();var t=ViewManager.ins().getView(PlayFunView);t&&t.removeFlowerItem()},e.prototype.update=function(){this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect);var t=FbCT.ins().tfFlowerRecords.concat();t.reverse(),this._collect.source=t;for(var e=t.length,i=0,n=0;e>n;n++)i+=t[n].count*GlobalConfig.TeamFuBenBaseConfig.flowerChiv;this.charmCount.text="你的魅力提高了 "+i+" 点"},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(FlowerOpenWin.prototype,"FlowerOpenWin"),ViewManager.ins().reg(FlowerOpenWin,LayerManager.UI_Popup),window.FlowerOpenWin=FlowerOpenWin;var FlowerUseTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sendCount=1,e._maxCount=0,e.skinName="flowerUseTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FlowerTargetItemrender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.list,this.onTouchList),this.observe(Friends.ins().postFriendChange,this.update),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(BagCT.ins().postItemDel,this.updateMaterial),this._sendCount=1,this._friendID=0,this.update(),this.selectName.text=""},e.prototype.close=function(){this.scroller.visible=!1},e.prototype.update=function(){this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect),this._collect.source=Friends.ins().friendsList.source,this.updateCount(),this.updateMaterial()},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagItemById(GlobalConfig.TeamFuBenBaseConfig.itemId);this._maxCount=t?t.count:0,this.itemCount.text="剩余鲜花："+this._maxCount},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sendBtn:if(!this._friendID)return void TipsCT.ins().showTips("请选择要赠送鲜花的好友");if(this._maxCount<=0||this._maxCount<this._sendCount)return void TipsCT.ins().showTips("背包内没有足够的道具");FbCT.ins().sendTfFlower(this._friendID,this._sendCount);break;case this.minBtn:1!=this._sendCount&&(this._sendCount=1,this.updateCount());break;case this.maxBtn:this._sendCount!=this._maxCount&&(this._sendCount=this._maxCount,this.updateCount());break;case this.sub1Btn:this._sendCount>1&&(this._sendCount--,this.updateCount());break;case this.add1Btn:this._sendCount<this._maxCount&&(this._sendCount++,this.updateCount());break;case this.openListBtn:this.scroller.visible=!this.scroller.visible}},e.prototype.onTouchList=function(t){var e=this.list.selectedItem;e&&(this._friendID=e.id,this.selectName.text=e.name,this.scroller.visible=!this.scroller.visible)},e.prototype.updateCount=function(){this.numLabel.text=this._sendCount+"",this.charmPoint.text="魅力值："+this._sendCount*GlobalConfig.TeamFuBenBaseConfig.flowerChiv},e}(BaseEuiView);__reflect(FlowerUseTipsWin.prototype,"FlowerUseTipsWin"),ViewManager.ins().reg(FlowerUseTipsWin,LayerManager.UI_Popup),window.FlowerUseTipsWin=FlowerUseTipsWin;var HejiEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.index=0,e.gainWay=[["参与击杀秘境BOSS","BossWin",2],["限时任务","LimitTaskView"]],e.skinName="HejiEquipTipsSkin",e.powerPanel.setBgVis(!1),e.powerPanel0.setBgVis(!1),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1,this.waylist.itemRenderer=RingGainItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],t[1]?this.changeBtn.visible=!0:this.changeBtn.visible=!1,this.isBagTips=t[2],this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.changeBtn,this.onEquipChange),this.waylist.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.setData(this.data)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEquipChange,this.changeBtn),this.waylist.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2],!0),ViewManager.ins().close(this))}},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onEquipChange=function(t){return this.needCount?void this.onBtn():void TipsCT.ins().showTips("|C:0xff0000&T:材料不足")},e.prototype.onBtn=function(){var t;if(this.data instanceof ItemData||this.data.id)t=this.data.configID+10;else{var i=91e4+this.data+1;t=i}for(var n=GlobalConfig.ItemConfig[t],s=ItemUtil.getSubType(n),o=BagCT.ins().getHejiEquipsByType(s),a=0,r=0;r<o.length;r++)if(o[r].configID==n.id&&s==ItemUtil.getSubType(o[r].itemConfig)){a=o[r].handle;break}if(!a)return void TipsCT.ins().showTips("|C:0xff0000&T:符文异常");var l=n.level?n.level:0,h=n.zsLevel?n.zsLevel:0;return h>ZsCT.ins().lv||l>Actor.level?void TipsCT.ins().showTips("|C:0xff0000&T:符文需要"+h+"转"+l+"级"):(ViewManager.ins().close(e),void SkillCT.ins().sendDressHejiEquip(a,s))},e.prototype.setData=function(t){var e;if(t instanceof ItemData){e=t;var i=GlobalConfig.EquipConfig[e.configID+10];if(i){var n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_EQUIP,i.id);n?this.currentState="not_max":this.currentState="not_max_no"}else this.currentState="max"}else{if(t.id)e=new ItemData,e.configID=t.id;else if(t>91e4)e=new ItemData,e.configID=t;else{var s=91e4+t+1;e=new ItemData,e.configID=s}var n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_EQUIP,e.configID);n&&n.count?this.currentState="unactivated_have":this.currentState="unactivated_no"}this.isBagTips&&(this.currentState="default"),this.validateNow(),this.needCount=0,this.setCurAttrs(e),this.setNextAttrs(e),this.unactivated(e)},e.prototype.unactivated=function(t){if("max"!=this.currentState&&"default"!=this.currentState){var e;e=this.data instanceof ItemData||this.data.id?t.configID+10:t.configID;var i=GlobalConfig.ItemConfig[e];this.attr0.text=""+i.name,this.attr0.textColor=ItemUtil.getQualityColor(i);var n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_EQUIP,i.id);n?(this.attr6.text="(拥有×"+n.count+")",this.attr6.textColor=65280,this.needCount=n.count):this.attr6.textColor=16711680,"unactivated_no"==this.currentState||"not_max_no"==this.currentState?this.waylist.dataProvider=new eui.ArrayCollection(this.gainWay):"unactivated_have"==this.currentState&&(this.changeBtn.label="激  活")}},e.prototype.setNextAttrs=function(t){if("not_max"==this.currentState||"not_max_no"==this.currentState){this.changeBtn.label="升  级";var e=t.configID+10,i=GlobalConfig.ItemConfig[e],n=GlobalConfig.EquipConfig[e],s=i;this._totalPower=0,this.nextTile.text="下级("+s.name+")",this.nextTile.textColor=ItemUtil.getQualityColor(s),this.attr7.text=""+s.name,this.attr7.textColor=this.nextTile.textColor;var o=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_EQUIP,i.id);o?(this.attr9.text="(拥有×"+o.count+")",this.attr9.textColor=65280,this.needCount=o.count):this.attr9.textColor=16711680;var a=1;this.nextAttr1.visible=!1,this.nextAttr2.visible=!1,this.nextAttr3.visible=!1,this.nextAttr4.visible=!1;var r=n,l=[];if(this.score.visible=!1,t.att){for(var h in AttributeData.translate)if(r[h]&&!(r[h]<=0)){var u=new AttributeData(AttributeData.translate[h],r[h]);for(var p in t.att)if(t.att[p].type==u.type){u.value+=t.att[p].value;break}var c="";c=AttributeData.getAttStrByType(u,0,"  "),l.push(u),this["nextAttr"+a].text=c,this["nextAttr"+a].visible=!0,a++}this._bottomY=this["nextAttr"+(a-1)].y+this["nextAttr"+(a-1)].height}else{for(var h in AttributeData.translate)if(r[h]&&!(r[h]<=0)){var u=new AttributeData(AttributeData.translate[h],r[h]),c="";c=AttributeData.getAttStrByType(u,0,"  "),l.push(u),this["nextAttr"+a].text=c,this["nextAttr"+a].visible=!0,a++}this._bottomY=this["nextAttr"+(a-1)].y+this["nextAttr"+(a-1)].height}if(r.baseAttr1){var d=new AttributeData(r.baseAttr1.type,r.baseAttr1.value);l.push(d)}if(r.baseAttr2){var d=new AttributeData(r.baseAttr2.type,r.baseAttr2.value);l.push(d)}for(this._equipPower=Math.floor(BagCT.getAttrPower(l)),this._totalPower+=this._equipPower+(r.exPower||0),this._totalPower*=SubRoles.ins().subRolesLen,this.score.text="评分："+this._totalPower;this.nextForgeGroup.numElements;)this.nextForgeGroup.removeChildAt(0);this.addTips(r,this.nextForgeGroup),this.background.height=this._bottomY+12,this.powerPanel0.setPower(this._totalPower)}},e.prototype.setCurAttrs=function(t){var e=t.itemConfig;this._totalPower=0,this.nameLabel.text=e.name,this.nameLabel.textColor=ItemUtil.getQualityColor(e);var i=ItemUtil.getQuality(e);this.quali.source=i>0?"quali"+i:"",this.itemIcon.setData(e),(t instanceof ItemData||null!=e)&&t&&5==ItemUtil.getType(t.itemConfig)&&(this.levelKey.text=e.zsLevel>0?"转生：":"等级：",this.type.text=Role.getHejiEquipNameByType(ItemUtil.getSubType(e)),this.lv.text=e.zsLevel>0?e.zsLevel+"转":e.level+"级",e.zsLevel>0?this.lv.textColor=ZsCT.ins().lv<e.zsLevel?15937822:3532333:this.lv.textColor=Actor.level<(e.level||1)?15937822:3532333);var n=1;this.attr1.visible=!1,this.attr2.visible=!1,this.attr3.visible=!1,this.attr4.visible=!1;var s=GlobalConfig.EquipConfig[t.configID],o=[];if(this.score.visible=!1,t.att){for(var a in AttributeData.translate)if(s[a]&&!(s[a]<=0)){var r=new AttributeData(AttributeData.translate[a],s[a]);for(var l in t.att)if(t.att[l].type==r.type){r.value+=t.att[l].value;break}var h="";h=AttributeData.getAttStrByType(r,0,"  "),o.push(r),this["attr"+n].text=h,this["attr"+n].visible=!0,n++}this._bottomY=this["attr"+(n-1)].y+this["attr"+(n-1)].height}else{for(var a in AttributeData.translate)if(s[a]&&!(s[a]<=0)){var r=new AttributeData(AttributeData.translate[a],s[a]),h="";h=AttributeData.getAttStrByType(r,0,"  "),o.push(r),this["attr"+n].text=h,this["attr"+n].visible=!0,n++}this._bottomY=this["attr"+(n-1)].y+this["attr"+(n-1)].height}if(s.baseAttr1){var u=new AttributeData(s.baseAttr1.type,s.baseAttr1.value);o.push(u)}if(s.baseAttr2){var u=new AttributeData(s.baseAttr2.type,s.baseAttr2.value);o.push(u)}for(this._equipPower=Math.floor(BagCT.getAttrPower(o)),this._totalPower+=this._equipPower+(s.exPower||0),this._totalPower*=SubRoles.ins().subRolesLen,this.score.text="评分："+this._totalPower;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);this.addTips(s,this.forgeGroup),this.background.height=this._bottomY+12,this.powerPanel.setPower(this._totalPower),this.next.y=this._bottomY+12},e.prototype.addTips=function(t,e){var i=new eui.Label,n=new eui.Label;if(t.baseAttr1&&(i.parent||this.createTitle(i,n,e),n.text+=AttributeData.getAttStrByType(t.baseAttr1,1,""),this._bottomY=n.y+n.height),t.baseAttr2&&(i.parent||this.createTitle(i,n,e),n.text+=AttributeData.getAttStrByType(t.baseAttr2,1,""),this._bottomY=n.y+n.height),t.exAttr1&&(i.parent||this.createTitle(i,n,e),n.text+=AttributeData.getExtAttStrByType(t.exAttr1,1,""),this._bottomY=n.y+n.height),t.exAttr2&&(n.text=AttributeData.getExtAttStrByType(t.exAttr2,1,""),this._bottomY=n.y+n.height),this.forgeGroup==e){var s=new eui.Label,o=new eui.Label,a=t.id%10,r=SkillCT.ins().getPunchForge().getPunchLevel(a-1),l=GlobalConfig.PunchEquipConfig[a-1][r];l&&(s.parent||this.createTitle(s,o,e,"注灵属性"),o.text=AttributeData.getAttStr(l.attr,1,1," "),this._bottomY=o.y+o.height)}},e.prototype.createTitle=function(t,e,i,n){t.fontFamily="Arial",t.size=20,t.textColor=8283191,t.bold=!0,t.x=24,t.y=this._bottomY+10+14,i.addChild(t),t.text=n?n:"极品属性",e.fontFamily="Arial",e.size=18,e.lineSpacing=8,e.x=46,e.y=t.y+24,e.textColor=16730612,i.addChild(e)},e}(BaseEuiView);__reflect(HejiEquipTipsWin.prototype,"HejiEquipTipsWin"),ViewManager.ins().reg(HejiEquipTipsWin,LayerManager.UI_Popup),window.HejiEquipTipsWin=HejiEquipTipsWin;var ItemCurrencyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ItemCurrencySkin",this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1];n=n?n:0,this.addTouchEndEvent(this,this.otherClose),this.setData(i,n)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e){var i="";switch(t){case MoneyConst.feat:i=e?e+"":"0"}var n=GlobalConfig.MoneyConfig[t];this.nameLabel.text=n.name,this.num.text=i,this.setImgData(t,e),this.description.textFlow=TextFlowMaker.generateTextFlow1(n.describe),this.BG.height=170+this.description.height},e.prototype.setImgData=function(t,e){var i=1;switch(t){case MoneyConst.yuanbao:i=5;break;case MoneyConst.gold:i=0;break;case MoneyConst.soul:case MoneyConst.chip:i=2;break;case MoneyConst.piece:i=2;break;case MoneyConst.godweaponExp:i=2}this.nameLabel.text=RewardData.getCurrencyName(t),this.nameLabel.textColor=ItemBase.QUALITY_COLOR[i],this.itemIcon.imgIcon.source=RewardData.getCurrencyRes(t),this.itemIcon.imgBg.source="quality"+i,this.setCount(e+"")},e.prototype.setCount=function(t){if(t.length>4){var e=Math.floor(Number(t)/1e3);t=e/10+"万"}this.num.text=t},e}(BaseEuiView);__reflect(ItemCurrencyWin.prototype,"ItemCurrencyWin"),ViewManager.ins().reg(ItemCurrencyWin,LayerManager.UI_Popup),window.ItemCurrencyWin=ItemCurrencyWin;var ItemDetailedWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ItemTipsSkin",this.itemIcon.imgJob.visible=!1,this.eItemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2];this.addTouchEndEvent(this,this.otherClose),this.setData(i,n,s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e,i){var n="";if(void 0==i){var s=BagCT.ins().getBagGoodsByTypeAndId(t,e);n=s?s.count+"":"0"}else n=i+"";var o=GlobalConfig.ItemConfig[e];if(this.nameLabel.text=o.name,this.nameLabel.textColor=ItemUtil.getQualityColor(o),this.itemIcon.setData(o),this.lv.text=(o.level||1)+"级",this.num.text=n,this.description.textFlow=TextFlowMaker.generateTextFlow1(o.desc),2==ItemUtil.getType(o)){var a=MiJiSkillConfig.getSkillIDByItem(o.id);this.power.text="评分："+GlobalConfig.MiJiSkillConfig[a].pow}else this.power.text="";this.BG.height=170+this.description.height,this.updateItemList(o)},e.prototype.updateItemList=function(t){var e=GlobalConfig.ItemRandomConfig[t.id];e&&(this.eItemList.dataProvider=new eui.ArrayCollection(e.awards))},e}(BaseEuiView);__reflect(ItemDetailedWin.prototype,"ItemDetailedWin"),window.ItemDetailedWin=ItemDetailedWin,ViewManager.ins().reg(ItemDetailedWin,LayerManager.UI_Popup);var ItemUseTipsWin=function(t){function e(){var e=t.call(this)||this;
return e.maxNum=0,e.oldNum=0,e._sn_="ItemUseTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.numLabel.restrict="0-9",this.itemIcon.imgJob.visible=!1,this.isTopLevel=!0,this.showNoBtn=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.showNoBtn=t[1],this.goodsId=this._data.configID,this.addTouchEndEvent(this.BG,this.otherClose),this.addTouchEndEvent(this.minBtn,this.onTap),this.addTouchEndEvent(this.maxBtn,this.onTap),this.addTouchEndEvent(this.sub1Btn,this.onTap),this.addTouchEndEvent(this.add1Btn,this.onTap),this.addTouchEndEvent(this.useBtn,this.onTap),this.addTouchEndEvent(this.useBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(BagCT.ins().postUseItemSuccess,this.useSuccess),this.observe(BagCT.ins().postItemChange,this.itemChange),this.observe(BagCT.ins().postItemDel,this.itemChange),this.addChangeEvent(this.numLabel,this.onTxtChange),this.setData(this._data),this.isBossBox=-1!=FloatWinCT.ins().bossBoxIdList.lastIndexOf(this.goodsId),this.itemList.itemRenderer=ItemBase,this.useBtn.visible=!this.showNoBtn,this.useLabel.visible=this.showNoBtn;var i=ItemUtil.getType(this._data.itemConfig);this.add.visible=i!=ItemType.TYPE_25,i!=ItemType.TYPE_47?DisplayUtils.removeFromParent(this.eTime):BagCT.ins().sendItemEndTime(this._data.handle)},e.prototype.enterFrame=function(){if(this.eTime.parent&&this._data.endTime){var t=Math.max(0,(this._data.endTime-GameServer.serverTime)/1e3);t>0?this.eTime.text="倒计时:  "+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1):this.eTime.text="",this._data.endTime>0&&0==t&&(this.useBtn.label="已过期")}},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=null},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTxtChange=function(t){var e=Number(this.numLabel.text);e>this.maxNum?e=this.maxNum:0>=e&&(e=1),this.useNum=e,this.numLabel.text=this.useNum+"",this.updateUse()},e.prototype.onTap=function(t){switch(t.target){case this.minBtn:this.useNum=1;break;case this.maxBtn:this.useNum=this.maxNum;break;case this.sub1Btn:this.useNum--,this.useNum<=0&&(this.useNum=1);break;case this.add1Btn:this.useNum++,this.useNum>this.maxNum&&(this.useNum=this.maxNum);break;case this.useBtn:Number(this.numLabel.text)<=0&&(this.numLabel.text="1"),"热血特权体验卡"==this.nameLabel.text&&Setting.ins().setValue(ClientSet.useHotBlood,1),FloatWinCT.ins().onUse(this._data,this.useNum);break;case this.useBtn0:this.onBack();break;case this.bgClose:ViewManager.ins().close(this)}this.numLabel.text=this.useNum+"",this.updateBtn()},e.prototype.onBack=function(){var t=this._data.itemConfig;ItemUtil.getType(t)==ItemType.TYPE_10?BagCT.ins().sendUseItem(this.goodsId,this.useNum):BagCT.ins().sendUseItem(this.goodsId,this.useNum)&&ViewManager.ins().close(e)},e.prototype.useSuccess=function(){var t=BagCT.ins().getBagItemById(this.goodsId);t?(this.setData(t),this.onTxtChange(null)):ViewManager.ins().close(e)},e.prototype.itemChange=function(){var t=BagCT.ins().getBagItemById(this.goodsId);t?(this.setData(t),this.onTxtChange(null)):ViewManager.ins().close(this)},e.prototype.updateState=function(){var t=this._data,e=ItemUtil.getType(t.itemConfig);FloatWinCT.ins().checkCanMerge(this._data)?this.currentState="rename":e==ItemType.TYPE_2?this.currentState="2":e==ItemType.TYPE_10?this.currentState="10":e==ItemType.TYPE_12?this.currentState="guildgifts":e==ItemType.TYPE_14?this.currentState="rename":this.currentState="2"},e.prototype.updateBaseInfo=function(t){var e=this._data;t.count=t.count?t.count:1;var i=t.count+"",n=e.itemConfig;this.nameLabel.text=n.name,this.nameLabel.textColor=ItemUtil.getQualityColor(n),this.itemIcon.setData(n),this.lv.text=(n.level||1)+"级",this.num.text=i,this.description.textFlow=TextFlowMaker.generateTextFlow(n.desc)},e.prototype.updateUse=function(){var t=this._data;this.useNum=this._data.count,this.numLabel.text=this.useNum+"",this.oldNum=t.count,this.maxNum=t.count},e.prototype.updateHandlePos=function(){this._data},e.prototype.setData=function(t){this._data=t;var e=this._data.itemConfig;this.updateState(),this.updateBaseInfo(t);var i=ItemUtil.getType(e);i==ItemType.TYPE_2?this.updateType2():i==ItemType.TYPE_10&&egret.callLater(this.updateType10,this),this.updateUse(),this.updateHandlePos(),this.updateGuildGift(e),this.updateRandomGift(e),this.updateBtn()},e.prototype.updateBtn=function(){if(this._data&&this._data.itemConfig){var t=this._data.itemConfig;FloatWinCT.ins().checkCanMerge(this._data)?this.useBtn.label="合成":ItemUtil.getType(t)==ItemType.TYPE_47?this._data.endTime&&this._data.endTime>GameServer.serverTime&&(this.useBtn.label=t.needyuanbao*this.useNum+"元宝"):t.needyuanbao&&(this.useBtn.label=t.needyuanbao*this.useNum+"元宝")}},e.prototype.updateType2=function(){},e.prototype.updateRandomGift=function(t){var e=GlobalConfig.ItemRandomConfig[t.id];e&&(this.itemList1.dataProvider=new eui.ArrayCollection(e.awards))},e.prototype.updateGuildGift=function(t){var e=GlobalConfig.ItemGiftConfig[t.id];e&&(this.itemList1.dataProvider=new eui.ArrayCollection(e.awards))},e.prototype.updateType10=function(){var t=this._data.itemConfig,e=0;if(SubRoles.ins().subRolesLen==SubRoles.MAX_ROLES)for(var i=200013==t.id?0:1,n=0;n<SubRoles.MAX_ROLES;n++){var s=SubRoles.ins().getSubRoleByIndex(n);if(s){var o=SubRoles.ins().getSubRoleByIndex(n).getExRingsData(i);o>0&&(e+=1)}}e==SubRoles.MAX_ROLES?(this.useBtn0.horizontalCenter=0,this.useBtn.visible=!1):(this.useBtn0.horizontalCenter=-90,this.useBtn.visible=!0)},e}(BaseEuiView);__reflect(ItemUseTipsWin.prototype,"ItemUseTipsWin"),ViewManager.ins().reg(ItemUseTipsWin,LayerManager.UI_Popup),window.ItemUseTipsWin=ItemUseTipsWin;var RuneTipsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuneTipsSkin",this.cur_desc=""},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0];this.item_config_id=t[1],this.cur_desc=t[2],this.cur_desc2=t[3],this.addTouchEndEvent(this,this.otherClose),this.addTouchEndEvent(this.userBtn,this.onUser),this.setData(this.item_config_id)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onUser=function(t){var e=Rune.ins().getRuneMergeByID(this.item_config_id);e&&ViewManager.ins().open(BagWin,3,MergeType.Rune,e.mixId[1],Rune.ins().getMergeIndexByType(e.mixId[1],e.id))},e.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];if(e){this.itemIcon.setData(e);var i="",n=e.id%100;0==n?this.cur_desc2||(i=" lv."+n):0!=ItemUtil.getSubType(e)&&(i=" lv."+n),this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemUtil.getQualityColor(e)+"'>"+e.name+i+"</font>"),this.userBtn.visible=!1,Rune.ins().isOpen()&&Rune.ins().isRuneCanMergeByID(e.id)&&(this.userBtn.visible=!0);var s=!1;if(1==ItemUtil.getType(e))this.randomAttr.text=e.desc;else{var o=GlobalConfig.RuneBaseConfig[t];o?(s=!0,this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(o),this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(o,!1),this.attrName.x=this.runeAttr.width/2-(this.attrName.width+this.attrValue.width)/2,this.attrValue.x=this.attrName.x+this.attrName.width,this.attrDes.text=this.cur_desc):(this.randomAttr.visible=!0,this.randomAttr.text=e.desc,this.cur_desc2?this.attrDes.text="通关"+this.cur_desc2+"解锁":this.attrDes.visible=!1)}this.attrName.visible=this.attrValue.visible=s,this.randomAttr.visible=!s}},e}(BaseEuiView);__reflect(RuneTipsWin.prototype,"RuneTipsWin"),ViewManager.ins().reg(RuneTipsWin,LayerManager.UI_Popup),window.RuneTipsWin=RuneTipsWin;var SmeltEquipItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mc=new MovieClip,this.mc.x=45,this.mc.y=40},e.prototype.dataChanged=function(){if(this.clear(),this.data instanceof ItemData){this.itemConfig=this.data.itemConfig,this.itemIcon.setData(this.itemConfig);var t=ItemUtil.getType(this.itemConfig),e=ItemUtil.getJob(this.itemConfig);if(4==t)this.nameTxt.text=this.itemConfig.name;else{var i=this.itemConfig?ItemUtil.getSubType(this.itemConfig):-1;i==ForgeConst.EQUIP_POS_TO_SUB[EquipPos.DZI]?this.nameTxt.text=this.itemConfig.name:this.nameTxt.text=isNaN(this.itemConfig.zsLevel)?"lv."+(this.itemConfig.level||1):this.itemConfig.zsLevel+"转",-1!=BagCT.fitleEquip.indexOf(this.itemConfig.id)&&(this.nameTxt.text="无级别")}this.itemIcon.imgJob.source=(0==t||4==t)&&e&&this.itemIcon.imgJob.visible?"job"+e+"Item":""}},e.prototype.onClick=function(){},e.prototype.playEff=function(){this.data&&(this.mc.playFile(RES_DIR_EFF+"BoomEff",1),this.addChild(this.mc),this.selectFrame.visible=!1)},e.prototype.clear=function(){t.prototype.clear.call(this),this.itemIcon.imgJob.source=null},e}(ItemBase);__reflect(SmeltEquipItem.prototype,"SmeltEquipItem"),window.SmeltEquipItem=SmeltEquipItem;var SmeltEquipTotalWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="SmeltMainViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=AddYBItemRender,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=0,this.addTouchEvent(this.bgClose,this.onTap),this.observe(OtherCT.ins().postYBCardTime,this.upTips),this.observe(Activity.ins().postAddTips,this.upSmeltTips),this.upTips()},e.prototype.enterFrame=function(){if(OtherCT.ins().hasDouble){var t=Math.max(0,OtherCT.ins().doubleYBCardTime-GameServer.serverTime)/1e3;this.sTime=t?"双倍时间: "+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1):""}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.upTips=function(){this.eTips.visible=OtherCT.ins().hasDouble},e.prototype.upSmeltTips=function(t){this.listDP.source=t},e}(BaseEuiView);__reflect(SmeltEquipTotalWin.prototype,"SmeltEquipTotalWin"),ViewManager.ins().reg(SmeltEquipTotalWin,LayerManager.UI_Popup),window.SmeltEquipTotalWin=SmeltEquipTotalWin;var SmeltSelectItem=function(t){function e(){var e=t.call(this)||this;return e.translate={hp:AttributeType.atMaxHp,atk:AttributeType.atAttack,def:AttributeType.atDef,res:AttributeType.atRes,crit:AttributeType.atCrit,tough:AttributeType.atTough},e.skinName="SmeltSeletctItemSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){if(this.data instanceof ItemData){var t=this.data;if(this.itemConfig=t.itemConfig,this.arrowIcon.visible=!1,!this.itemConfig)return;this.itemIcon.setData(this.itemConfig);var e=ItemUtil.getType(this.itemConfig);4==e?(this.updateWingEquip(),this.lvLabel.text=this.itemConfig.name):0==e?this.lvLabel.text=this.itemConfig.zsLevel?this.itemConfig.zsLevel+"转":"lv."+this.itemConfig.level:this.lvLabel.text="",this.nameLabel.textColor=ItemUtil.getQualityColor(this.itemConfig),this.nameLabel.text=this.itemConfig.name,this.gradeLabel.text="评分："+t.point,this.attrLabel.text=AttributeData.getAttrInfoByItemData(t)}},e.prototype.updateWingEquip=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)for(var i=SubRoles.ins().getSubRoleByIndex(e).wingsData,n=i.equipsLen,s=0;n>s;s++){var o=i.getEquipByIndex(s);if(0!=o.item.configID){if(ItemUtil.getSubType(this.data.itemConfig)==ItemUtil.getSubType(o.item.itemConfig)&&this.data.point>o.item.point)return void(this.arrowIcon.visible=!0)}else if(this.data.itemConfig.subType==s)return void(this.arrowIcon.visible=!0)}},e}(BaseItemRender);__reflect(SmeltSelectItem.prototype,"SmeltSelectItem"),window.SmeltSelectItem=SmeltSelectItem;var SmeltSelectWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="SmeltSelectSkin",this.isTopLevel=!0,this.itemList.itemRenderer=SmeltSelectItem,this.itemScroller.viewport=this.itemList,this.checkList=[]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.len=t[1],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this);var i=t[0];i.sort(BagCT.ins().sort2),this.itemList.dataProvider=new eui.ArrayCollection(t[0])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.foolChecklist(),EquipCT.ins().postEquipCheckList(this.checkList)},e.prototype.onItemTap=function(t){var e=t.itemRenderer;e.checkBoxs.selected=!e.checkBoxs.selected;var i=this.itemList.selectedItem;if(e.checkBoxs.selected){if(!(this.checkList.length<this.len))return void this.autoClose();if(this.checkList[this.checkList.length]=i,this.checkList.length>=this.len)return void this.autoClose()}else{var n=this.checkList.indexOf(i);if(0>n)return;this.checkList.splice(n,1)}this.setCountLabel(this.checkList.length)},e.prototype.autoClose=function(){EquipCT.ins().postEquipCheckList(this.checkList),ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.sureBtn:EquipCT.ins().postEquipCheckList(this.checkList),ViewManager.ins().close(e)}},e.prototype.setSmeltEquipList=function(t){var e=this;this.checkList=t,this.checkListData(),this.setCountLabel(this.checkList.length),Timer.start(60,1,function(){for(var t=0;t<e.checkList.length;t++)for(var i=0;i<e.itemList.numElements;i++){var n=e.itemList.getElementAt(i);if(e.checkList[t]&&n&&e.checkList[t].handle==n.data.handle){e.checkList.length<=e.len&&(n.checkBoxs.selected=!0);break}}},this)},e.prototype.setCountLabel=function(t){this.countLabel.text=t+"/"+this.len},e.prototype.checkListData=function(){for(var t=this.checkList.length,e=t-1;e>=0;e--)null==this.checkList[e]&&this.checkList.splice(e,1)},e.prototype.foolChecklist=function(){for(var t=this.checkList.length,e=0;e<this.len;e++)e>=t&&this.checkList.push(null)},e}(BaseEuiView);__reflect(SmeltSelectWin.prototype,"SmeltSelectWin"),ViewManager.ins().reg(SmeltSelectWin,LayerManager.UI_Main),window.SmeltSelectWin=SmeltSelectWin;var FlowerRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerRewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.playerName.text=this.data.roleName,this.flowerCount.textFlow=TextFlowMaker.generateTextFlow("被你的魅力折服，送上了|C:65280&T:【"+this.data.count+"】|朵泣血神花")},e}(BaseItemRender);__reflect(FlowerRewardItemRender.prototype,"FlowerRewardItemRender"),window.FlowerRewardItemRender=FlowerRewardItemRender;var FlowerShowItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerShowItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._inited=!0,this.showEffect()},e.prototype.onTouch=function(t){ViewManager.ins().open(FlowerOpenWin),DisplayUtils.removeFromParent(this)},e.prototype.onRemove=function(t){this.flowerImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.mcEff&&(DisplayUtils.removeFromParent(this.mcEff),this.mcEff=null,this.isPlaying=!1)},e.prototype.showEffect=function(){this._inited&&(this.isPlaying||(this.flowerImg.alpha=0,this.mcEff||(this.mcEff=ObjectPool.pop("MovieClip"),this.flowereff.addChild(this.mcEff)),this.mcEff.playFile(RES_DIR_EFF+"SendFlowers",1,this.playComplete.bind(this)),this.isPlaying=!0,this.flowerImg.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.flowerImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.flowerImg.source=null,this.flowerImg.source="flower_openImg",this.imgBg.source=null,this.imgBg.source="main_hongbaotexiao_png"))},e.prototype.playComplete=function(){this.mcEff=null,this.flowerImg.alpha=1,this.isPlaying=!1},e}(eui.Component);__reflect(FlowerShowItem.prototype,"FlowerShowItem"),window.FlowerShowItem=FlowerShowItem;var FlowerTargetItemrender=function(t){function e(){var e=t.call(this)||this;return e.skinName="flowerTargetItem",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.nameTxt.text=this.data.name},e}(BaseItemRender);__reflect(FlowerTargetItemrender.prototype,"FlowerTargetItemrender"),window.FlowerTargetItemrender=FlowerTargetItemrender;var BangDingWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bangSucc=!1,e._sn_="BindingPhoneSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ItemBase,this.eList.dataProvider=new eui.ArrayCollection(GlobalConfig.PhoneBindingConfig.rewards),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postBangingInfo,this.update),this.update()},e.prototype.update=function(){this.eBtn.touchEnabled=!0,PfActivity.ins().hasBang?0==PfActivity.ins().bangDingRewardState?this.eBtn.label="领取奖励":1==PfActivity.ins().bangDingRewardState?(this.eBtn.label="已领奖",this.eBtn.touchEnabled=!1):this.eBtn.label="绑定手机":this.eBtn.label="绑定手机"},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:0==PfActivity.ins().bangDingRewardState&&PfActivity.ins().hasBang||this.bangSucc?PfActivity.ins().sendBangingReward(1):PfActivity.ins().hasBang||this.bindPhonePanel()}},e.prototype.bindPhonePanel=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return(t=window.bindPhonePanel)?(e=this,[4,new Promise(function(e){t(e)})]):[2];case 1:return e.bangSucc=i.sent(),PfActivity.ins().hasBang=this.bangSucc,this.eBtn.label=this.bangSucc?"领取奖励":"绑定手机",[2]}})})},e}(BaseEuiView);__reflect(BangDingWin.prototype,"BangDingWin"),window.BangDingWin=BangDingWin,ViewManager.ins().reg(BangDingWin,LayerManager.UI_Popup);var BattleCC=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e.battleRanks=[],e.myRank=0,e.myScore=0,e.awardID=0,e._openLeftTime=0,e._openTimer=0,e._enterCD=0,e._enterCDTimer=0,e._changeTime=0,e._changeLittle=0,e.isOpenWin=!1,e.sysId=PackageID.Battle,e.observe(GameLogic.ins().postEnterMap,e.mapChange),e.regNetMsg(1,e.joinResult),e.regNetMsg(2,e.doRank),e.regNetMsg(3,e.doOpen),e.regNetMsg(4,e.doRelive),e.regNetMsg(5,e.getAwardResult),e.regNetMsg(6,e.doAwardInfo),e.regNetMsg(7,e.doMyScore),e.regNetMsg(10,e.doMyRank),e.regNetMsg(11,e.doEnterCD),e.regNetMsg(12,e.doGameOver),e.regNetMsg(13,e.postLittleChange),e.regNetMsg(14,e.postChangeTime),e.regNetMsg(15,e.postKilled),e}return __extends(e,t),e.prototype.mapChange=function(){if(this.isBattle()?this.enterBattle():this._lastBattle&&this.escBattle(),this.gotoNpc&&GameMap.fbType==FbCT.FB_TYPE_CITY){this.gotoNpc=!1;var t=GlobalConfig.CampBattleConfig.npcPos,e=t[0],i=t[1],n=GameMap.CELL_SIZE;MoveCC.ins().myMoveTo(e*n,i*n,this.findComplete),GameMap.moveTo(e*n,i*n)}},e.prototype.findComplete=function(){ViewManager.ins().open(BattleNpcTipWin)},e.ins=function(){return t.ins.call(this)},e.prototype.isBattle=function(){return GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId},e.prototype.joinBattle=function(){this.sendBaseProto(1)},e.prototype.joinResult=function(t){this.camp=t.readShort(),this._leftTime=DateUtils.formatMiniDateTime(t.readInt()),this.postEnterSuccess()},e.prototype.postEnterSuccess=function(){},e.prototype.doRank=function(t){var e=t.readInt();this.battleRanks.length=e;for(var i,n=0;e>n;n++)i=this.battleRanks[n],i||(i=new BattleRankVo,this.battleRanks[n]=i),i.parse(t);this.postRankInfo()},e.prototype.doOpen=function(t){this.isOpen=t.readBoolean(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer(),this.postOpenInfo(),this.isOpen&&!this.isOpenWin&&(this.isOpenWin=!0,ViewManager.ins().open(PlayTipsWin,PlayTipsWin.TYPE_Battle))},e.prototype.doRelive=function(t){BossCT.ins().reliveTime=t.readInt(),BossCT.ins().killerHandler=t.readDouble(),ViewManager.ins().close(TargetPlayerBigBloodPanel),BossCT.ins().reliveTime>0?(BossCT.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.postOpenInfo=function(){},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.getRankTop=function(t){return void 0===t&&(t=3),this.battleRanks?this.battleRanks.slice(0,t):null},e.prototype.postRankInfo=function(){},e.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)},e.prototype.enterBattle=function(){this._lastBattle=!0,ViewManager.ins().isShow(BattleWin)||ViewManager.ins().open(BattleWin),ViewManager.ins().close(BattleNpcTipWin)},e.prototype.escBattle=function(){this._lastBattle=!1,ViewManager.ins().close(BattleWin)},e.prototype.sendReLive=function(){this.sendBaseProto(4)},e.prototype.getMyAward=function(){this.sendBaseProto(5)},e.prototype.getAwardResult=function(t){t.readBoolean()},e.prototype.doAwardInfo=function(t){this.awardID=t.readInt(),this.postGiftInfo()},e.prototype.postGiftInfo=function(){},e.prototype.doMyScore=function(t){this.myScore=t.readInt();var e,i=t.readInt(),n=t.readString(),s=t.readUnsignedByte();switch(s){case 1:e="成功击杀|C:0x00ff00&T:"+n+"|，积分+|C:0x00ff00&T:"+i+"|";break;case 2:e="助攻击杀|C:0x00ff00&T:"+n+"|，积分+|C:0x00ff00&T:"+i+"|";break;case 3:e="被|C:0x00ff00&T:"+n+"|击杀，积分+|C:0x00ff00&T:"+i+"|";break;case 4:e="获得持续参与奖，积分+|C:0x00ff00&T:"+i+"|";break;case 5:e="杀怪获得积分+|C:0x00ff00&T:"+i+"|"}e&&TipsCT.ins().showCenterTips3(e),this.postScoreChange()},e.prototype.doMyRank=function(t){this.myRank=t.readInt(),this.myScore=t.readInt(),this.postScoreChange()},e.prototype.postScoreChange=function(){},e.prototype.doEnterCD=function(t){this._enterCD=t.readInt(),this._enterCDTimer=egret.getTimer()},e.prototype.doGameOver=function(t){ViewManager.ins().open(BattleResultWin)},e.prototype.postLittleChange=function(t){this._changeLittle=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.getChangeLittleTime=function(){return Math.floor((this._changeLittle-GameServer.serverTime)/1e3)},e.prototype.canMove=function(){return this.getChangeLittleTime()<=0},e.prototype.postChangeTime=function(t){this._changeTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.postKilled=function(t){return t.readShort()},e.prototype.getChangeTime=function(){return Math.floor((this._changeTime-GameServer.serverTime)/1e3)},e.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)},e.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level>=GlobalConfig.CampBattleConfig.openLevel},e.prototype.checkBattleOpen=function(){return Actor.level<=GlobalConfig.CampBattleConfig.openLevel?(TipsCT.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+"级可参与血战中州"),!1):KfArenaSys.ins().checkIsMatching()?this.isOpen?CityCC.ins().enterCD<1?CityCC.ins().isCity?(MoveCC.ins().myMoveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete),GameMap.moveTo(GlobalConfig.CampBattleConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.CampBattleConfig.npcPos[1]*GameMap.CELL_SIZE),!1):(this.gotoNpc=!0,CityCC.ins().sendEnter(),!0):(TipsCT.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城"),!1):(TipsCT.ins().showTips(GlobalConfig.CampBattleConfig.openTips),!1):!1},__decorate([post()],e.prototype,"postEnterSuccess",null),__decorate([post()],e.prototype,"postOpenInfo",null),__decorate([post()],e.prototype,"postRankInfo",null),__decorate([post()],e.prototype,"postGiftInfo",null),__decorate([post()],e.prototype,"postScoreChange",null),__decorate([post()],e.prototype,"postLittleChange",null),__decorate([post()],e.prototype,"postChangeTime",null),__decorate([post()],e.prototype,"postKilled",null),e}(BaseSystem);__reflect(BattleCC.prototype,"BattleCC"),System.BattleCC=function(){return BattleCC.ins()},window.BattleCC=BattleCC;var BattleAwardTargetItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleTargetItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data[0];this.rank.text=t.integral+"\n积分",this.award.data=t.award[0],this.already.visible=this.data[1]},e}(BaseItemRender);__reflect(BattleAwardTargetItemRender.prototype,"BattleAwardTargetItemRender"),window.BattleAwardTargetItemRender=BattleAwardTargetItemRender;var BattleNpcTipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onGoto),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)},e.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.CampBattleConfig.desc),this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[17].text),this.redPoint.visible=BattleCC.ins().isOpen},e.prototype.onGoto=function(t){if(t.target==this.goTo){if(!KfArenaSys.ins().checkIsMatching())return;if(Actor.level<GlobalConfig.CampBattleConfig.openLevel)return void TipsCT.ins().showTips(GlobalConfig.CampBattleConfig.openLevel+"级可参与血战中州");if(!BattleCC.ins().isOpen)return void TipsCT.ins().showTips(GlobalConfig.CampBattleConfig.openTips);var e=BattleCC.ins().getEnterCD();if(e>0)return void TipsCT.ins().showTips(e+"秒后才可进入阵营副本");BattleCC.ins().joinBattle()}else t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(BattleNpcTipWin.prototype,"BattleNpcTipWin"),ViewManager.ins().reg(BattleNpcTipWin,LayerManager.UI_Main),window.BattleNpcTipWin=BattleNpcTipWin;var BattleRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleScoreRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.rank<=3;this.rankImg.source=e?"paihang"+t.rank:null,this.rank.text=e?"":t.rank+"",this.nameLabel.text=t.roleName,this.nameGuild.text=t.unionName,this.score.text=t.score+""},e}(BaseItemRender);__reflect(BattleRankItemRender.prototype,"BattleRankItemRender"),window.BattleRankItemRender=BattleRankItemRender;var BattleRankWin=function(t){function e(){var e=t.call(this)||this;return e._selectedIndex=0,e._sn_="BattleScoreSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this._panels=[this.runePanel0,this.decomPanel0],this._panels[this._selectedIndex].open(),this.viewStack.selectedIndex=this._selectedIndex},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.addChangeEvent(this.tab,this.onTabTouch)},e.prototype.removeDisplay=function(){this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.TouchEvent.CHANGE,this.onTabTouch,this.tab)},e.prototype.onTabTouch=function(t){this._panels[this._selectedIndex].close(),this._selectedIndex=t.currentTarget.selectedIndex,this._panels[this._selectedIndex].open(),this.viewStack._selectedIndex=this._selectedIndex},e.prototype.onTap=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(BattleRankWin.prototype,"BattleRankWin"),ViewManager.ins().reg(BattleRankWin,LayerManager.UI_Main),window.BattleRankWin=BattleRankWin;var BattleResultItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleResultItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.ranking.text=t.rank+"",this.roleName.text=t.roleName,this.guild.text=t.unionName,this.score.text=t.score+""},e}(BaseItemRender);__reflect(BattleResultItemRender.prototype,"BattleResultItemRender"),window.BattleResultItemRender=BattleResultItemRender;var BattleResultWin=function(t){function e(){var e=t.call(this)||this;return e._time=5,e.skinName="BattleResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rankList.itemRenderer=BattleResultItemRender,this.myRewarrd.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(BattleCC.ins().postRankInfo,this.updateRank),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.timerGroup.visible=!0,this.info.text=this._time+"",Timer.start(1e3,5,this.repeat,this),this.updateMyScore(),this.updateRank()},e.prototype.updateRank=function(){this.rankList.dataProvider=new eui.ArrayCollection(BattleCC.ins().getRankTop(5))},e.prototype.updateMyScore=function(){var t=BattleCC.ins().myRank;this.myScore.text=BattleCC.ins().myScore+"",this.myRanking.text=t+"";var e=Object.keys(GlobalConfig.CampBattlePersonalRankAwardConfig).length,i=GlobalConfig.CampBattlePersonalRankAwardConfig[t>0&&e>=t?t:e];this.myRewarrd.dataProvider=new eui.ArrayCollection(i.award)},e.prototype.repeat=function(){this._time--,this._time>0?this.info.text=this._time+"":this.timerGroup.visible=!1},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:FbCT.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BattleResultWin.prototype,"BattleResultWin"),ViewManager.ins().reg(BattleResultWin,LayerManager.UI_Main),window.BattleResultWin=BattleResultWin;var BattleRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleRewarrdItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.awards.itemRenderer=ItemBase,this._arrayCollect=new eui.ArrayCollection,this.awards.dataProvider=this._arrayCollect},e.prototype.dataChanged=function(){var t=this.data;this.rank.text="第"+t.rank+"名",this._arrayCollect.source=t.award},e}(BaseItemRender);__reflect(BattleRewardItemRender.prototype,"BattleRewardItemRender"),window.BattleRewardItemRender=BattleRewardItemRender;var BattleRewardPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.list0.itemRenderer=BattleRewardItemRender;var t=0,e=[];for(var i in GlobalConfig.CampBattlePersonalRankAwardConfig)e[t]=GlobalConfig.CampBattlePersonalRankAwardConfig[i],t++;this.list0.dataProvider=new eui.ArrayCollection(e),this._collect=new eui.ArrayCollection,this.list1.itemRenderer=BattleAwardTargetItemRender,this.list1.dataProvider=this._collect},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BattleCC.ins().postGiftInfo,this.update),this.update()},e.prototype.removeDisplay=function(){this.removeObserve()},e.prototype.update=function(){var t=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length,e=[],i=BattleCC.ins().awardID;e.length=t;for(var n=1;t>=n;n++)e[n-1]=[GlobalConfig.CampBattlePersonalAwardConfig[n],i>=n];this._collect.source=e},e}(BaseEuiView);__reflect(BattleRewardPanel.prototype,"BattleRewardPanel"),window.BattleRewardPanel=BattleRewardPanel;var BattleScoreRankPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=BattleRankItemRender,this._arrayCllect=new eui.ArrayCollection,this.list.dataProvider=this._arrayCllect
},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BattleCC.ins().postRankInfo,this.update),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.update(),this.updateMyScore()},e.prototype.update=function(){this._arrayCllect.source=BattleCC.ins().battleRanks},e.prototype.updateMyScore=function(){this.myScore.text=BattleCC.ins().myScore+"",this.myRank.text="我的排名："+BattleCC.ins().myRank},e}(BaseEuiView);__reflect(BattleScoreRankPanel.prototype,"BattleScoreRankPanel"),window.BattleScoreRankPanel=BattleScoreRankPanel;var BattleWin=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._changeTime=-1,e._littleChangeTime=-1,e.skinName="BattleLittleRankSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.jump.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:查看排行"),this.bigTimeGroup.visible=!1,this.assignPer.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(BattleCC.ins().postRankInfo,this.updateRank),this.observe(BattleCC.ins().postScoreChange,this.updateMyScore),this.observe(BattleCC.ins().postGiftInfo,this.updateGift),this.observe(BattleCC.ins().postEnterSuccess,this.update),this.observe(BattleCC.ins().postChangeTime,this.update),this.observe(BattleCC.ins().postLittleChange,this.update),this.observe(BattleCC.ins().postKilled,this.onKill),this.updateRank(),this.updateGift(),this.updateMyScore(),this.update()},e.prototype.update=function(){Timer.stop(this.repeat,this),this._leftTime=BattleCC.ins().getLeftTime();var t;this._leftTime>0?t=!0:this.wholeLeftTime.text="",this._changeTime=BattleCC.ins().getChangeTime(),this._changeTime>0?t=!0:this.assignPer.visible=!1,this._littleChangeTime=BattleCC.ins().getChangeLittleTime(),this._littleChangeTime>0?t=!0:this.bigTimeGroup.visible=!1,t&&(Timer.start(1e3,0,this.repeat,this),this.repeat()),this.skillGroup0.visible=!1},e.prototype.onKill=function(t){if(egret.Tween.removeTweens(this.lzlabel0),egret.Tween.removeTweens(this.skillGroup0),!t)return void(this.skillGroup0.visible=!1);this.skillGroup0.visible=!0,this.skillGroup0.alpha=1,this.lzlabel0.scaleX=this.lzlabel0.scaleY=1,this.lzlabel0.text=t+"";var e=this;egret.Tween.get(this.lzlabel0).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(e.skillGroup0).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(e.lzlabel0),egret.Tween.removeTweens(e.skillGroup0),e.skillGroup0.visible=!1})})},e.prototype.repeat=function(){this._leftTime<=0?""!=this.wholeLeftTime.text&&(this.wholeLeftTime.text=""):this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),this._leftTime--,this._changeTime<=0?this.assignPer.visible&&(this.assignPer.visible=!1):(this.assignPer.visible||(this.assignPer.visible=!0),this.campLeftTime0.text=DateUtils.getFormatBySecond(this._changeTime,DateUtils.TIME_FORMAT_5,4)),this._changeTime--,this._littleChangeTime<=0?this.bigTimeGroup.visible&&(this.bigTimeGroup.visible=!1):(this.countDown.text=Math.floor(this._littleChangeTime)+"",this.bigTimeGroup.visible||(this.bigTimeGroup.visible=!0)),this._littleChangeTime--},e.prototype.close=function(){Timer.stopAll(this),this._giftMax=!1,this._canGetGift=!1,egret.Tween.removeTweens(this.lzlabel0),egret.Tween.removeTweens(this.skillGroup0)},e.prototype.updateRank=function(){for(var t,e=BattleCC.ins().getRankTop(),i=e?e.length:0,n=0;3>n;n++)t=i>n?e[n]:null,this["name"+n].text=t?t.roleName:"",this["num"+n].text=t?t.score+"":""},e.prototype.updateMyScore=function(){this.num3.text=BattleCC.ins().myScore+"",this.rank3.text=BattleCC.ins().myRank+"",this.updateGift()},e.prototype.updateGift=function(){if(!this._giftMax){var t=BattleCC.ins().awardID,e=Object.keys(GlobalConfig.CampBattlePersonalAwardConfig).length;if(this._canGetGift=!1,t>=e)this._giftMax=!0,this.giftGroup.visible=!1;else{this.giftGroup.visible=!0;var i=void 0;i=GlobalConfig.CampBattlePersonalAwardConfig[t+1],this._canGetGift=BattleCC.ins().myScore>=i.integral,this.redPoint.visible=this._canGetGift,this.scoreTxt.text="战绩："+BattleCC.ins().myScore;var n=this._canGetGift?65280:16711680;this.scoreTxt2.textFlow=TextFlowMaker.generateTextFlow1("|C:"+n+"&T:"+BattleCC.ins().myScore+"|/"+i.integral)}}},e.prototype.onTap=function(t){switch(t.target){case this.jump:ViewManager.ins().open(BattleRankWin);break;case this.giftBtn:this._canGetGift&&BattleCC.ins().getMyAward()}},e}(BaseEuiView);__reflect(BattleWin.prototype,"BattleWin"),ViewManager.ins().reg(BattleWin,LayerManager.Main_View),window.BattleWin=BattleWin;var CommonHelpWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="HelpTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.otherClose)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.textInfo.textFlow=TextFlowMaker.generateTextFlow(t[0])},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(CommonHelpWin.prototype,"CommonHelpWin"),window.CommonHelpWin=CommonHelpWin,ViewManager.ins().reg(CommonHelpWin,LayerManager.UI_Popup);var BattleRankVo=function(){function t(){}return t.prototype.parse=function(t){this.rank=t.readShort(),this.camp=t.readShort(),this.roleName=t.readString(),this.unionName=t.readString(),this.score=t.readInt()},t}();__reflect(BattleRankVo.prototype,"BattleRankVo"),window.BattleRankVo=BattleRankVo;var Book=function(t){function e(){var e=t.call(this)||this;return e.bookPower=0,e.score=-1,e.sysId=PackageID.Book,e.regNetMsg(1,e.postDataChange),e.listBook={},e.itemBook={},e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getSuitIdByBookId=function(t){var e=GlobalConfig.CardConfig[t][0];if(!e)return 0;for(var i in GlobalConfig.SuitConfig)if(-1!=GlobalConfig.SuitConfig[i][1].idList.indexOf(t))return Number(i);return 0},e.prototype.getSuitNum=function(t){for(var e=GlobalConfig.SuitConfig[t][1],i=0,n=0;n<e.idList.length;n++){var s=this.getBookById(e.idList[n]);s.level>-1&&i++}return i},e.prototype.getSuitLevel=function(t){for(var e=this.getSuitNum(t),i=0,n=1;GlobalConfig.SuitConfig[t][n];)GlobalConfig.SuitConfig[t][n].count<=e&&(i=GlobalConfig.SuitConfig[t][n].level),n++;return i},e.prototype.getBookRed=function(){for(var t in GlobalConfig.BookListConfig)for(var e=GlobalConfig.BookListConfig[t].idList,i=0,n=e;i<n.length;i++)for(var s=n[i],o=GlobalConfig.SuitConfig[s][1].idList,a=0,r=o;a<r.length;a++){var l=r[a];if(this.getBookById(l).getState()==BookState.canOpen)return!0}return!1},e.prototype.getBookUpRed=function(){for(var t in GlobalConfig.BookListConfig)for(var e=GlobalConfig.BookListConfig[t].idList,i=0,n=e;i<n.length;i++){var s=n[i];if(this.getBookUpRedByListId(s))return!0}return!1},e.prototype.getBookUpRedByListId=function(t){for(var e=GlobalConfig.SuitConfig[t][1].idList,i=0,n=e;i<n.length;i++){var s=n[i],o=this.getBookById(s);if(o.canUpgrade())return!0}return!1},e.prototype.getBookRedById=function(t){return this.getBookById(t).getState()==BookState.canOpen?!0:!1},e.prototype.getBookById=function(t){if(!this.listBook[t]){var e=new BooKData;this.listBook[t]=e,e.id=t}return this.listBook[t]},e.prototype.getBookByItemId=function(t){return this.itemBook[t]||(this.itemBook[t]=[]),this.itemBook[t]},e.prototype.getBookPown=function(){var t=GlobalConfig.CardConfig,i=0;for(var n in this.listBook){var s=this.listBook[n];if(s.level>-1){var o=t[n][s.level];i+=Math.floor(BagCT.getAttrPower(o.attrs))}}var a=[];for(var r in GlobalConfig.BookListConfig){var l=GlobalConfig.BookListConfig[r],h=e.ins().getSuitNum(l.idList[0]);for(var u in GlobalConfig.SuitConfig[l.idList[0]]){var p=GlobalConfig.SuitConfig[l.idList[0]][u];if(!(h>=p.count)){i+=Math.floor(BagCT.getAttrPower(a)),a=[];break}a=p.attrs}a.length>0&&(i+=Math.floor(BagCT.getAttrPower(a)))}return i},e.prototype.getBookPowerNum=function(t,i){var n=SubRoles.ins().subRolesLen;if(i)for(var s in GlobalConfig.SuitConfig)if(-1!=e.jobs.indexOf(Number(s))&&-1!=GlobalConfig.SuitConfig[s][1].idList.indexOf(i)){n=1;break}return t*n},e.prototype.getBookPowerNumEx=function(){return this.bookPower},e.prototype.getUpChipData=function(t){var i=[],n=GlobalConfig.CardConfig,s=n[t.id],o=0;for(var a in s)s[a].level>t.level&&(o+=s[a].cost);var r=GlobalConfig.DecomposeConfig,l=o-t.exp,h=0;for(var a in this.listBook){var u=n[a][1],p=BagCT.ins().getBagGoodsCountById(0,u.itemId),c=r[t.id],d=this.listBook[a];if(d.level>-1&&p>0)for(var g=0;p>g&&!(h>l);g++)if(h+=c.value,i.push(+a),i.length>=12)return i}return i.sort(e.sort),i},e.sort=function(t,e){if(t==e)return 0;var i=GlobalConfig.DecomposeConfig[t],n=GlobalConfig.DecomposeConfig[e];return i.value>n.value?1:i.value<n.value?-1:0},e.prototype.getTitleById=function(t){var e=GlobalConfig.BookListConfig;for(var i in e)if(-1!=e[i].idList.indexOf(t))return e[i].name;return""},e.prototype.getListData=function(){return this.listBook},e.prototype.sendBookData=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.postDataChange=function(t){if(-1==this.score){var e=GlobalConfig.DecomposeConfig;for(var i in e){var n=this.getBookById(+i);this.getBookByItemId(e[i].itemId).push(n)}}for(var s=t.readInt(),o=0;s>o;o++){var i=t.readShort(),n=this.getBookById(i);n.updateData(t)}var a=t.readInt();if(this.score>-1){var r=a-this.score;r>0&&TipsCT.ins().showTips("获得|C:0xff700f&T:图鉴经验x"+r+"|")}this.score=a,this.bookPower=t.readDouble()},e.prototype.sendOpen=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendDecompose=function(t){var e=this.getBytes(3);e.writeInt(t.length);for(var i=0;i<t.length;i++)e.writeShort(t[i][0]),e.writeShort(t[i][1]);this.sendToServer(e)},e.prototype.sendUp=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.getDecomposeConfigByItemId=function(t){var e=GlobalConfig.DecomposeConfig;if(!this.itemBook[t])return Assert(!1,"图鉴数据未初始化,id="+t+",itemBook keys length="+Object.keys(this.itemBook).length),null;if(this.itemBook[t][0]){var i=this.itemBook[t][0].id;return e[i]}return null},e.prototype.checkResolveRedPoint=function(){var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_9);if(!t.length)return!1;var e=this.itemBook,i={};for(var n in e)for(var s=0,o=e[n];s<o.length;s++){var a=o[s];if(a.getState()!=BookState.haveOpen){i[n]=!0;break}var r=GlobalConfig.CardConfig[a.id][a.level];if(null!=r.consume&&!a.lvIsMax()){i[n]=!0;break}}for(var l=0,h=t;l<h.length;l++){var a=h[l];if(!i[a.configID])return!0}return!1},e.prototype.getSuitRedPoint=function(t){var i=this,n=GlobalConfig.SuitConfig,s=BagCT.ins().getBagGoodsByType(ItemType.TYPE_9);if(0==s.length)return!1;for(var o={},a=0,r=s;a<r.length;a++){var l=r[a];o[l.configID]=!0}var h=function(t){for(var s=n[t][1],a=s.idList,r=0,l=a;r<l.length;r++){var h=l[r];if(i.listBook[h]&&-1==i.listBook[h].level){var u=e.jobs.indexOf(s.id);if(-1==u){var p=GlobalConfig.DecomposeConfig[h];if(o[p.itemId])return!0}else{for(var c=!1,d=0;d<SubRoles.ins().subRolesLen;d++){var g=SubRoles.ins().getSubRoleByIndex(d);if(g.job==u+1){c=!0;break}}if(!c)continue;var f=GlobalConfig.CardConfig[h][0];if(f&&o[f.itemId])return!0}}}return!1};if(0!=t)return h(t);for(var u in n)if(h(u))return!0;return!1},e.prototype.getHaveBookSuit=function(t){var e=BagCT.ins().getBagGoodsByType(ItemType.TYPE_9),i=GlobalConfig.SuitConfig[t][1];return 0==e.length?{ishave:!1,cur:0,target:i.idList.length}:void 0},e.jobs=[6,7,8],__decorate([post()],e.prototype,"postDataChange",null),e}(BaseSystem);__reflect(Book.prototype,"Book"),System.Book=function(){return Book.ins()},window.Book=Book;var BookState;!function(t){t[t.canOpen=0]="canOpen",t[t.haveOpen=1]="haveOpen",t[t.noOpen=2]="noOpen"}(BookState||(BookState={}));var BooKData=function(){function t(){this.level=-1,this.exp=0,this.number=0}return t.prototype.updateData=function(t){this.level=t.readShort()},t.prototype.getNum=function(t){var e=GlobalConfig.CardConfig[this.id][0].itemId,i=BagCT.ins().getBagGoodsCountById(0,e);if(isNaN(t)){var n=Book.ins().getSuitIdByBookId(this.id);if(!n)return i;var s=Book.jobs.indexOf(n);if(-1==s)return i;for(var o=void 0,a=0;a<SubRoles.ins().subRolesLen;a++){var r=SubRoles.ins().getSubRoleByIndex(a);if(r&&r.job==s+1){o=!0;break}}return o?i:0}if(i)for(var l in GlobalConfig.SuitConfig){var s=Book.jobs.indexOf(Number(l));if(-1!=s&&-1!=GlobalConfig.SuitConfig[l][1].idList.indexOf(this.id))for(var a=0;a<SubRoles.ins().subRolesLen;a++){var r=SubRoles.ins().getSubRoleByIndex(a);if(r&&r.job==t+1)return i}}return 0},t.prototype.getItemId=function(){return GlobalConfig.CardConfig[this.id][0].itemId},t.prototype.canOpen=function(){return this.getNum()>0},t.prototype.getNextLevelCost=function(){if(-1==this.level)return 0;var t=GlobalConfig.CardConfig[this.id][this.level+1];return t?t.cost:0},t.prototype.canUpgrade=function(){if(-1==this.level)return!1;var t=GlobalConfig.CardConfig[this.id][this.level+1];if(t){if(t.consume)return BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume.id)>=t.consume.count;var e=this.getNextLevelCost();return e&&Book.ins().score>=e}return!1},t.prototype.lvIsMax=function(){return-1!=this.level&&!this.canUpgrade()},t.prototype.getState=function(t){return this.level>-1?BookState.haveOpen:this.getNum(t)>0?BookState.canOpen:BookState.noOpen},t}();__reflect(BooKData.prototype,"BooKData"),window.BooKData=BooKData;var BookRedPoint=function(t){function e(){var e=t.call(this)||this;return e.canLvlUp=!1,e.registerOpen(Actor.ins().postLevelChange,ZsCT.ins().postZsData),e.registerTab(0,Book.ins().postDataChange,BagCT.ins().postItemAdd,GameLogic.ins().postSubRoleChange),e.registerTab(1,Book.ins().postDataChange,BagCT.ins().postItemAdd),e.associated(e.postLvlUp,Book.ins().postDataChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postLvlUp=function(){var t=this.canLvlUp;return this.canLvlUp=Book.ins().getBookUpRed(),t!=this.canLvlUp},e.prototype.getTabRedPoint=function(t){return 0==t?Book.ins().getBookRed():1==t?Book.ins().checkResolveRedPoint():2==t?Book.ins().getBookUpRed():!1},e.prototype.getIsOpen=function(){return LiLian.ins().checkBookOpen()},__decorate([post()],e.prototype,"postLvlUp",null),e}(RedPointBase);__reflect(BookRedPoint.prototype,"BookRedPoint"),System.BookRedPoint=function(){return BookRedPoint.ins()},window.BookRedPoint=BookRedPoint;var BookItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="tujianskinstate",e.tw=egret.Tween.get(e.kejihuo,{loop:!0}),e.tw.to({scaleX:e.kejihuo.scaleX+.3,scaleY:e.kejihuo.scaleY+.3},500).to({scaleX:e.kejihuo.scaleX,scaleY:e.kejihuo.scaleY},500),e}return __extends(e,t),e.prototype.setRemoveTween=function(t){t&&egret.Tween.removeTweens(this.kejihuo)},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.Tween.removeTweens(this.kejihuo)},e.prototype.setStar=function(t){for(var e,i=0;10>i;i++)e=t>10?t>i+10?"moon":"star3":t>i?"star3":"",this["imgStar"+i].source=e},e.prototype.dataChanged=function(){var t,e=this.data,i=Book.ins().getBookById(e),n=GlobalConfig.DecomposeConfig[e],s=i.level>-1?i.level:0,o=GlobalConfig.CardConfig[e][s];for(var a in GlobalConfig.SuitConfig){var r=GlobalConfig.SuitConfig[a][1],l=r.idList.indexOf(e);if(-1!=l){if(t=Book.jobs.indexOf(Number(a)),-1!=t)break;t=void 0}}var h=i.getState(t);this.quality0.source=this.quality1.source=this.quality2.source=this.quality3.source="tujian_"+n.quality+"c",this.quality.source="tujian_"+n.quality+"a",this.quality4.source="tujian_"+n.quality+"b",this.setStar(s);var u=BagCT.getAttrPower(o.attrs);u=Book.ins().getBookPowerNum(u,n.id),this.pown.text=u+"",this.rect.visible=!1,this.weiji.visible=!1,this.manji.visible=!1,this.kejihuo.visible=!1;var p=!GlobalConfig.CardConfig[e][s+1];if(p&&h==BookState.haveOpen)this.manji.visible=!0,this.redPoint.visible=!1,this.imgBox.source=""+n.imgLight;else switch(h){case BookState.canOpen:this.imgBox.source=""+n.imgLight,this.redPoint.visible=!1,this.rect.visible=!0,this.kejihuo.visible=!0;break;case BookState.haveOpen:this.imgBox.source=""+n.imgLight,this.redPoint.visible=i.canUpgrade();break;case BookState.noOpen:this.imgBox.source=""+n.imgLight,this.redPoint.visible=!1,this.rect.visible=!0,this.weiji.visible=!0;break;default:this.imgBox.source=""+n.imgLight}this.labelName.text=n.name,this.labelName.textColor=ItemBase.QUALITY_COLOR[n.quality],this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e}(BaseItemRender);__reflect(BookItem.prototype,"BookItem"),window.BookItem=BookItem;var BookListItem=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e.skinName="TujiandaanniuSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.label.touchEnabled=!1},e.prototype.destruct=function(){},e.prototype.dataChanged=function(){var t=this.data;this.label.text=""+t.name,this.btnName.source=t.icon,this.idList=t.idList,this.checkRedPoint()},e.prototype.checkRedPoint=function(){for(var t=0,e=this.idList;t<e.length;t++){var i=e[t];if(Book.ins().getBookUpRedByListId(i)||Book.ins().getSuitRedPoint(i))return void(this.redPoint.visible=!0)}this.redPoint.visible=!1},e}(BaseItemRender);__reflect(BookListItem.prototype,"BookListItem"),window.BookListItem=BookListItem;var BookMenuItem=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e.skinName="TujianzianniuSkin",e.width=160,e.height=50,e.label.touchEnabled=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemData=GlobalConfig.SuitConfig[this.data][1],this.label.text=this.itemData.name,this.checkRedPoint()},e.prototype.checkRedPoint=function(){this.redPoint.visible=Book.ins().getSuitRedPoint(this.data)},e.prototype.show=function(t){this.isShow=t,this.isShow?this.currentState="select":this.currentState="close",this.validateNow(),this.checkRedPoint()},e}(BaseItemRender);__reflect(BookMenuItem.prototype,"BookMenuItem"),window.BookMenuItem=BookMenuItem;var BookTipsWin=function(t){function e(){var e=t.call(this)||this;return e._bottomY=0,e._equipPower=0,e._totalPower=0,e.curRole=0,e.curId=0,e.curLevel=0,e.index=0,e.skinName="tujiantips",e.powerPanel.setBgVis(!1),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1,this.anigroup.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curId=t[0],this.curLevel=t[1]||0,this.handle=t[2],this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.btnUse,this.onTap),this.setData(this.curId)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.otherClose),this.removeTouchEvent(this.btnUse,this.onTap)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTap=function(t){var e=t.currentTarget;"使用"==e.label,ViewManager.ins().close(this),ViewManager.ins().open(LiLianWin,3,this.curId)},e.prototype.setData=function(t){var e=Book.ins().getDecomposeConfigByItemId(t),i=GlobalConfig.CardConfig[e.id][this.curLevel];this._confBase=e,this._totalPower=0;var n=GlobalConfig.ItemConfig[i.itemId];n&&(this.nameLabel.text=n.name),this.nameLabel.textColor=ItemBase.QUALITY_COLOR[e.quality],this.lvTxt.text=i.level+"星",this.qualityImg.source="quali"+e.quality,this.qualTxt.text=ColorUtil.COLOR_STR[e.quality],n=GlobalConfig.ItemConfig[i.itemId],this.itemIcon.setData(n);var s=1;this.attr1.visible=!1,this.attr2.visible=!1,this.attr3.visible=!1,this.attr4.visible=!1;var o=[],a=!1,r="";for(var l in i.attrs)if(0!=i.attrs[l].type&&0!=i.attrs[l].value)if(i.attrs[l].type==AttributeType.atHpEx||i.attrs[l].type==AttributeType.atAtkEx||i.attrs[l].type==AttributeType.atDamageReduction||i.attrs[l].type==AttributeType.atDefEx||i.attrs[l].type==AttributeType.atResEx){if(!a){r="特殊属性:",r+="所有角色",a=!0;var h=AttributeData.getAttrStrByType(i.attrs[l].type);(i.attrs[l].type==AttributeType.atDefEx||i.attrs[l].type==AttributeType.atResEx)&&(h="防御加成"),r+=h,r+="+"+i.attrs[l].value/100+"%",o.push(i.attrs[l])}}else{var u="";u=AttributeData.getAttStrByType(i.attrs[l],0,"  "),o.push(i.attrs[l]),this["attr"+s].text=u,this["attr"+s].visible=!0,s++}if(i.specialAttr){""==r&&(r="特殊属性:");for(var l in i.specialAttr)0!=i.specialAttr[l].type&&0!=i.specialAttr[l].value&&i.specialAttr&&(a=!0,r+="挂机获得",r+=1==i.specialAttr[l].type?"金币":"经验",r+="+"+i.specialAttr[l].value+"%")}if(""==r&&null!=i.equiAttrs&&(r="特殊属性:"+(i.equiAttrs.notshow?"":"三角色")+i.equiAttrs.pos+"基础属性+"+i.equiAttrs.attrsRate/100+"%",a=!0),""==r&&null!=i.cardAdd){var p=GlobalConfig.BookListConfig,c="";for(var d in p)if(p[d].idList[0]==i.cardAdd[0][0]){c=p[d].name;break}r=c?"特殊属性:"+c+"图鉴属性永久增加"+i.cardAdd[0][1]/100+"%":"",a=!!c}this.specialAttr.text=r,this.specialAttr.visible=a,this._equipPower=Math.floor(BagCT.getAttrPower(o)),this._totalPower+=this._equipPower,this.addTipsEx();var g=3;for(var l in GlobalConfig.SuitConfig)if(-1!=Book.jobs.indexOf(Number(l))&&-1!=GlobalConfig.SuitConfig[l][1].idList.indexOf(i.id)){g=1,this.threeLabel.visible=!1;break}this._totalPower=this._totalPower*g,this.powerPanel.setPower(this._totalPower),this.iconBg.source=e.imgShow||e.imgLight;for(var f=Book.ins().getBookByItemId(this.curId),v=!0,y=0,m=f;y<m.length;y++){var T=m[y];if(T.getState()!=BookState.haveOpen){v=!1;break}}v?(this.btnUse.label="分解",this.tips.source="tjyijihuo"):(this.btnUse.label="使用",this.tips.source="tjweijihuo"),this.btnUse.visible=!!this.handle},e.prototype.addTipsEx=function(){var t,e=Book.ins().getBookByItemId(this.curId)[0];if(e&&(t=e.id),t){var i="";for(var n in GlobalConfig.SuitConfig){var s=GlobalConfig.SuitConfig[n][1];if(-1!=s.idList.indexOf(t)){i=s.name?s.name:"",t=s.id;break}}var o="";for(var a in GlobalConfig.BookListConfig){var s=GlobalConfig.BookListConfig[a];if(-1!=s.idList.indexOf(t)){o=s.name?s.name:"";break}}if(i||o){this.belong.visible=!0;var r=i?i+"·":"";r+=o,this.belong.text=r}else this.belong.visible=!1}},e.prototype.addTips=function(){for(;this.forgeGroup.numElements;)this.forgeGroup.removeChildAt(0);var t=new eui.Label,e=new eui.Label,i=Book.ins().getSuitNum(this.curId),n=GlobalConfig.SuitConfig[this.curId][1].count,s=Math.floor(i/n);if(0!=s){var o=GlobalConfig.SuitConfig[this.curId][s];t.parent||this.createTitle(t,e);var a=Book.ins().getTitleById(this.curId);if(t.text="当前套装系列:"+a+"·"+o.name+"("+Book.ins().getSuitNum(this.curId)+"/"+o.idList.length+")",e.text=AttributeData.getAttStr(o.attrs,1,1,"  "),GlobalConfig.SuitConfig[this.curId][s]){var r=new eui.Label,l=new eui.Label;this._bottomY=e.y+e.height,this.createTitle(r,l);var h=GlobalConfig.SuitConfig[this.curId][s+1];r.text="下级套装系列:"+a+"·"+h.name+"("+h.count+"/"+o.idList.length+")",l.text+=AttributeData.getAttStr(h.attrs,1,1,"  "),this._bottomY=l.y+l.height}else this._bottomY=e.y+e.height}},e.prototype.createTitle=function(t,e){t.fontFamily="Arial",t.size=20,t.textColor=8283191,t.bold=!0,t.x=24,t.y=this._bottomY+10+14,this.forgeGroup.addChild(t),e.fontFamily="Arial",e.size=18,e.lineSpacing=8,e.x=46,e.y=t.y+24,e.textColor=10458221,this.forgeGroup.addChild(e)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Book.ins().getDecomposeConfigByItemId(t[0])?!0:!1},e}(BaseEuiView);__reflect(BookTipsWin.prototype,"BookTipsWin"),ViewManager.ins().reg(BookTipsWin,LayerManager.UI_Popup),window.BookTipsWin=BookTipsWin;var BookUpWin=function(t){function e(){var e=t.call(this)||this;return e.jobName=["战士","法师","道士"],e.skinName="tujianshengxing",e.list.itemRenderer=BookUpItem,e.listOpen.dataProvider=null,e.listOpen.itemRenderer=BookItem,e.isTopLevel=!0,e.smeltEquips=[],e.smeltEquips.length=10,e.dataInfo=new eui.ArrayCollection(e.smeltEquips),e.list.dataProvider=e.dataInfo,e.barbc=new ProgressBarEff,e.barbc.setWidth(450),e.barbc.x=-10,e.barbc.y=-15,e.barGroup.addChild(e.barbc),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.selectData=t[0],this.observe(Book.ins().postDataChange,this.updateView),this.updateView(),this.addTouchEvent(this.btnUp,this.onTap),this.addTouchEvent(this.info,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.close=function(){},e.prototype.onTap=function(t){switch(t.target){case this.btnUp:var e=Book.ins().getSuitIdByBookId(this.selectData.id);if(!e)return;var i=!1,n=Book.jobs.indexOf(Number(e));if(-1!=n){for(var s=0;s<SubRoles.ins().subRolesLen;s++){var o=SubRoles.ins().getSubRoleByIndex(s);if(o&&o.job==n+1){i=!0;break}}if(!i)return void TipsCT.ins().showTips("|C:0xff0000&T:请先开启"+this.jobName[n]+"职业")}var a=GlobalConfig.DecomposeConfig[this.selectData.id],r=a.itemId,l=a.name,h=a.imgLight;if(i){var u=GlobalConfig.CardConfig[this.selectData.id][0];r=u.itemId}if(-1==this.selectData.level){var p=GlobalConfig.ItemConfig[r],c=BagCT.ins().getBagItemById(p.id);c?(Book.ins().sendOpen(this.selectData.id),ViewManager.ins().close(this),ViewManager.ins().open(Activationtongyong,0,l,h,!0,function(){})):WarnCT.ins().setBuyGoodsWarn(p.id,1)}else{var d=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level];d.cost>Book.ins().score?TipsCT.ins().showTips("图鉴经验不足"):d.consume&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,d.consume.id)<d.consume.count?TipsCT.ins().showTips("道具不足"):Book.ins().sendUp(this.selectData.id)}break;case this.info:var g=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level+1];if(-1==this.selectData.level||g&&g.consume){var f=Book.ins().getSuitIdByBookId(this.selectData.id);if(!f)return;var v,p=void 0;if(-1==Book.jobs.indexOf(Number(f)))v=GlobalConfig.DecomposeConfig[this.selectData.id],p=GlobalConfig.ItemConfig[v.itemId],WarnCT.ins().setBuyGoodsWarn(p.id,1);else{var y=GlobalConfig.CardConfig[this.selectData.id][0];p=GlobalConfig.ItemConfig[y.itemId],WarnCT.ins().setBuyGoodsWarn(p.id,1)}}else ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9);break;case this.btnAdd:break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateView=function(){var t=GlobalConfig.DecomposeConfig[this.selectData.id],e=this.selectData.level>-1?this.selectData.level:0,i=GlobalConfig.CardConfig[this.selectData.id][e];this.expBar.value=Book.ins().score,this.listOpen.dataProvider=new eui.ArrayCollection([this.selectData.id]),this.listOpen.validateNow();for(var n=0;n<this.listOpen.numElements;n++){var s=this.listOpen.getElementAt(n);s&&s.setRemoveTween(!0)}var o=GlobalConfig.CardConfig[this.selectData.id][this.selectData.level+1];if(this.labelCur.text=AttributeData.getAttStr(i.attrs,0,1,"："),this.selectData.level<0){this.currentState="noActive",this.btnUp.label="激活",this.info.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:获取图鉴|");var a=[];for(var n in i.attrs)i.attrs[n].type!=AttributeType.atHpEx&&i.attrs[n].type!=AttributeType.atAtkEx&&i.attrs[n].type!=AttributeType.atDamageReduction&&i.attrs[n].type!=AttributeType.atDefEx&&i.attrs[n].type!=AttributeType.atResEx&&a.push({type:i.attrs[n].type,value:0});this.labelCur.text=AttributeData.getAttStr(a,0,1,"：")}else o?(this.currentState="nomax",this.btnUp.label="升星",this.info.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+(o.consume?"获取升级道具":"获取图鉴经验")+"|")):(this.currentState="max",this.btnUp.label="已满星");if(this.selectData.level<0){this.tujian.textColor=ItemBase.QUALITY_COLOR[t.quality];var r=GlobalConfig.ItemConfig[t.itemId];this.tujian.text=r.name+"x1"}if(o){this.expLabel.text=Book.ins().score+"/"+o.cost,this.expBar.maximum=o.cost,this.barbc.setMaxValue(o.cost);var l=[];for(var n in o.attrs)o.attrs[n].type!=AttributeType.atHpEx&&o.attrs[n].type!=AttributeType.atAtkEx&&o.attrs[n].type!=AttributeType.atDamageReduction&&o.attrs[n].type!=AttributeType.atDefEx&&o.attrs[n].type!=AttributeType.atResEx&&(l[n]=o.attrs[n]);if(this.labelNext.text=AttributeData.getAttStr(l,0,1,"："),this.need.visible=o&&null!=o.consume,this.need.visible){var h=GlobalConfig.ItemConfig[o.consume.id];this.tujian.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(h)],this.tujian.text=h.name+"x"+o.consume.count}this.barGroup.visible=o&&null!=o.cost,this.barGroup.visible&&(this.barbc.setMaxValue(o?o.cost:i.cost),this.barbc.setValue(Book.ins().score))}else this.expLabel.text="已满星",this.labelNext.text="已满星",this.barbc.setLbValueText("已满星");this.specialAttrDese(i)},e.prototype.specialAttrDese=function(t){if(!t)return void(this.specialAttr.visible=!1);this.specialAttr.visible=!0;var e=!1,i="";for(var n in t.attrs)if(0!=t.attrs[n].type&&0!=t.attrs[n].value&&!e&&(t.attrs[n].type==AttributeType.atHpEx||t.attrs[n].type==AttributeType.atAtkEx||t.attrs[n].type==AttributeType.atDamageReduction||t.attrs[n].type==AttributeType.atDefEx||t.attrs[n].type==AttributeType.atResEx)){i="特殊属性:",e=!0,i+="所有角色";var s=AttributeData.getAttrStrByType(t.attrs[n].type);(t.attrs[n].type==AttributeType.atDefEx||t.attrs[n].type==AttributeType.atResEx)&&(s="防御加成"),i+=s,i+="+"+t.attrs[n].value/100+"%"}if(t.specialAttr){""==i&&(i="特殊属性:");for(var n in t.specialAttr)0!=t.specialAttr[n].type&&0!=t.specialAttr[n].value&&t.specialAttr&&(e=!0,i+="挂机获得",i+=1==t.specialAttr[n].type?"金币":"经验",i+="+"+t.specialAttr[n].value+"%")}if(""==i&&null!=t.equiAttrs&&(i="特殊属性:"+(t.equiAttrs.notshow?"":"三角色")+t.equiAttrs.pos+"基础属性+"+t.equiAttrs.attrsRate/100+"%",e=!0),""==i&&null!=t.cardAdd){var o=GlobalConfig.BookListConfig,a="";for(var r in o)if(o[r].idList[0]==t.cardAdd[0][0]){a=o[r].name;break}i=a?"特殊属性:"+a+"图鉴属性永久增加"+t.cardAdd[0][1]/100+"%":"",e=!!a}this.specialAttr.text=i,this.specialAttr.visible=e},e}(BaseEuiView);__reflect(BookUpWin.prototype,"BookUpWin"),ViewManager.ins().reg(BookUpWin,LayerManager.UI_Popup),window.BookUpWin=BookUpWin;var BookWayTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="TuJianSuitTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.suitlist.itemRenderer=BookWayTipsItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.otherClose),this.suitId=t[0],this.updateData()},e.prototype.updateData=function(){this.nameLabel.text=Book.ins().getTitleById(this.suitId)+"套装加成";var t=GlobalConfig.SuitConfig[this.suitId],e=[],i=Book.ins().getSuitNum(this.suitId);for(var n in t){var s=t[n],o={config:s,curNum:i};e.push(o)}this.suitlist.dataProvider=new eui.ArrayCollection(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(BookWayTips.prototype,"BookWayTips"),ViewManager.ins().reg(BookWayTips,LayerManager.UI_Popup),window.BookWayTips=BookWayTips;var BookWayTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TuJianSuitItem",e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.destruct=function(){},e.prototype.dataChanged=function(){var t=this.data.config;if(this.jieduan.text=t.level+"阶",this.num.text=t.count+"",this.suitNum.text=this.data.curNum+"/"+t.count,t.attrs)for(var e=0;e<t.attrs.length;e++){var i=AttributeData.getAttrStrByType(t.attrs[e].type);if(10==t.id&&86==t.attrs[e].type){var n=t.attrs[e].value/1e4*100+"%";this["value"+e].text=i+"+"+n}else 90==t.attrs[e].type?this["value"+e].text=AttributeData.getAttStr(t.attrs):this["value"+e].text=i+"+"+t.attrs[e].value;this.data.curNum>=t.count&&(this["value"+e].textColor=2149168)}else t.suitEffDesc&&(this.data.curNum>=t.count&&(this.value0.textColor=2149168),this.value0.text=t.suitEffDesc);this.data.curNum>=t.count&&(this.suitNum.textColor=2149168)},e}(BaseItemRender);__reflect(BookWayTipsItem.prototype,"BookWayTipsItem"),window.BookWayTipsItem=BookWayTipsItem;var BookWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.param=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.listBook.dataProvider=null,this.listMenu.dataProvider=null,this.listBook.itemRenderer=BookItem,this.listMenu.itemRenderer=BookListItem,this.listBook.touchEnabled=!1,this.resolve.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:分解多余图鉴|"),this.chargeEff1=new MovieClip,this.eff.addChild(this.chargeEff1),this.chargeEff1.x=this.eff.x,this.chargeEff1.y=this.eff.y,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.5,this.chargeEff1.scaleX=.75,this.greencolor=2149168,this.graycolor=this.attr.textColor,this.itemHeight=150,this.listBook.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBookTap,this),this.listMenu.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onMenuTap,this),this.addTouchEvent(this.resolve,this.onTap),this.addTouchEvent(this.getway,this.onTap),this.addTouchEvent(this.leftGroup,this.onTap),this.addTouchEvent(this.rightGroup,this.onTap),this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange)
},e.prototype.addDisplay=function(){var t=this;this.observe(Book.ins().postDataChange,this.delayItemChange),this.observe(BagCT.ins().postItemDel,this.delayItemChange),this.observe(BagCT.ins().postItemAdd,this.delayItemChange),this.observe(BagCT.ins().postItemChange,this.delayItemChange),this.observe(BookRedPoint.ins().postRedPoint,this.updateRedPoint),this.initView();var e=this.param[0]||0,i=null,n=0,s=0;if(e){i=Book.ins().getDecomposeConfigByItemId(e);var o=GlobalConfig.SuitConfig,a=1;for(var r in o)if(o[r][1].idList.indexOf(i.id)>=0){a=+r;break}for(var r in GlobalConfig.BookListConfig)if(GlobalConfig.BookListConfig[r].idList.indexOf(a)>=0){n=GlobalConfig.BookListConfig[r].sort-1,s=GlobalConfig.BookListConfig[r].idList.indexOf(a);break}}Timer.start(200,1,function(){t.listMenu.selectedIndex=n;var e=t.listMenu.getVirtualElementAt(n);e&&e.idList&&(t.curId=e.idList[s],t.updateBook(),t.updateAttr())},this),this.preScrollV=0},e.prototype.onChange=function(){this.listMenu.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.listMenu.scrollH>=this.listMenu.contentWidth-this.listMenu.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0),this.updateRedPoint()},e.prototype.onTap=function(t){var e=460,i=0;switch(t.currentTarget){case this.resolve:ViewManager.ins().open(BreakDownView,BreakDownView.type_book,ItemType.TYPE_9);break;case this.getway:ViewManager.ins().open(BookWayTips,this.curId);break;case this.leftGroup:i=this.listMenu.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.listMenu.scrollH=i,this.onChange();break;case this.rightGroup:i=this.listMenu.scrollH+e,i=92*Math.round(i/92),i>this.listMenu.contentWidth-this.listScroller.width&&(i=this.listMenu.contentWidth-this.listScroller.width),this.listMenu.scrollH=i,this.onChange()}},e.prototype.initView=function(){var t=GlobalConfig.BookListConfig,e=[];for(var i in t)e.push(t[i]);e.sort(function(t,e){return t.sort<e.sort?-1:1});var n=new eui.ArrayCollection(e);this.listMenu.dataProvider=n,this.updateBook(),this.leftGroup.parent.touchEnabled=!1,this.onChange()},e.prototype.playEffect=function(){BookRedPoint.ins().getRedPoint(1)?(this.chargeEff1.parent||this.eff.addChild(this.chargeEff1),this.chargeEff1.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.chargeEff1)},e.prototype.delayItemChange=function(){Timer.has(this.onItemChange,this)||Timer.start(60,1,this.onItemChange,this)},e.prototype.onItemChange=function(){this.updateBook();var t=this.listBook.parent;t.scrollV=this.preScrollV},e.prototype.setStartPosition=function(t){var e=this.listBook.parent,i=e.parent;i.stopAnimation();for(var n=0,s=0;s<t.length;s++)if(this.getIsAct(t[s])){s>9&&(n=Math.floor((s+1)/3)*this.itemHeight);break}if(i.height>=this.listBook.contentHeight)n=0;else{var o=this.listBook.contentHeight-41*i.height/30;o=o>0?o:0,n>=o&&(n=o)}e.scrollV=n,this.preScrollV=e.scrollV},e.prototype.updateBook=function(t){if(this.curId){var e=GlobalConfig.SuitConfig[this.curId][1],i=this.listBook.dataProvider;if(i&&i.source==e.idList?i.refresh():this.listBook.dataProvider=new eui.ArrayCollection(e.idList),this.listBook.validateNow(),this.setStartPosition(e.idList),!t){var n=this.listMenu.dataProvider;for(var s in n.source)n.itemUpdated(n.getItemAt(parseInt(s)))}this.updateAttr(),this.playEffect();var o=Book.ins().getBookPowerNumEx();this.power.text=o+""}},e.prototype.onBookTap=function(t){var e=this.listBook.selectedItem,i=Book.ins().getBookById(e);if(e&&i){var n=this.listBook.parent;this.preScrollV=n.scrollV,ViewManager.ins().open(BookUpWin,i)}},e.prototype.updateAttr=function(){var t,e=GlobalConfig.SuitConfig[this.curId][1],i=Book.ins().getSuitLevel(this.curId);i>0?(e=GlobalConfig.SuitConfig[this.curId][i],t=this.greencolor):t=this.graycolor;var n="";for(var s in GlobalConfig.BookListConfig){var o=GlobalConfig.BookListConfig[s];if(-1!=o.idList.indexOf(this.curId)){n=o.nameImg;break}}var a=Book.ins().getSuitNum(this.curId),r=e.idList.length;this.progress.text="（已集齐"+a+"/"+r+"）",this.labelIcon.source=n;for(var l=AttributeData.getAttStr(e.attrs,0,1,":"),h=l.split("\n"),u="集齐套装效果：",p=0;p<h.length;p++)u+=h[p]+"  ";""==l&&e.suitEffDesc&&(u+=e.suitEffDesc),this.attr.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+u),this.expValue.text=Book.ins().score+""},e.prototype.onMenuTap=function(t){var e=t.item;this.curId=e.idList[0],this.updateBook(!0),this.updateAttr()},e.prototype.getIsAct=function(t){var e=Book.ins().getBookById(t),i=e.getState();return i==BookState.canOpen},e.prototype.updateRedPoint=function(){this.leftRed.visible=BookRedPoint.ins().redpoint,this.rightRed.visible=BookRedPoint.ins().redpoint},e}(BaseView);__reflect(BookWin.prototype,"BookWin"),window.BookWin=BookWin;var BreakDownView=function(t){function e(){var e=t.call(this)||this;return e._addExp=[],e.skinName="BreakDownSkin",e.isTopLevel=!0,e.listData=new eui.ArrayCollection,e.equipList.itemRenderer=BreakDownItemRenderer,e.equipList.dataProvider=e.listData,e.gainList.itemRenderer=GainGoodsItem,e.goList=new eui.ArrayCollection,e.gainList.dataProvider=e.goList,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(BagCT.ins().postItemDel,this.updateData),this.observe(BagCT.ins().postItemCountChange,this.updateData),this.observe(Book.ins().postDataChange,this.showExp),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this._breakType=t[0]||0,this._ext=t[1],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Object.defineProperty(e,"fitleEquip",{get:function(){if(!e._fitleEquip){e._fitleEquip={};for(var t in GlobalConfig.SpecialEquipsConfig)GlobalConfig.SpecialEquipsConfig[t].style==FitleStyle.fj&&(e._fitleEquip[GlobalConfig.SpecialEquipsConfig[t].id]=GlobalConfig.SpecialEquipsConfig[t])}return e._fitleEquip},enumerable:!0,configurable:!0}),e.prototype.getLegendSource=function(){var t=[];if(4==this._ext)for(var i=BagCT.ins().getBagEquipsByQuality(4),n=0;n<i.length;n++)!e.fitleEquip[i[n].configID]&&ItemUtil.getSubType(i[n].itemConfig)<8&&t.push(i[n]);else t=BagCT.ins().getBagEquipsByQuality(5);return t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],n=GlobalConfig.ItemConfig[e.configID];return i.zsLevel>n.zsLevel?1:i.zsLevel<n.zsLevel?-1:i.level>n.level?1:i.level<n.level?-1:0}),t},e.prototype.getThunderSource=function(){return Heirloom.ins().thunderBoostElse()},e.prototype.getBookSource=function(){var t=BagCT.ins().getBagGoodsByType(this._ext);t.sort(function(t,e){var i=ItemUtil.getQuality(t.itemConfig),n=ItemUtil.getQuality(e.itemConfig);return n>i?-1:i>n?1:t.configID-e.configID});var e=[],i=Book.ins().itemBook,n={};for(var s in i)for(var o=0,a=i[s];o<a.length;o++){var r=a[o];if(r.getState()!=BookState.haveOpen){n[s]=!0;break}var l=GlobalConfig.CardConfig[r.id][r.level];if(null!=l.consume&&!r.lvIsMax()){n[s]=!0;break}}for(var h=0,u=t;h<u.length;h++){var r=u[h];if(!n[r.configID]){var p=new ItemData;p.count=1,p.handle=r.handle,p.configID=r.configID;for(var c=0;c<r.count;c++)e.push(p)}}return e},e.prototype.getLegendGoSource=function(){if(this.itemList)return this.itemList;var t=new GainWay;t[0]="获得神装：寻宝",t[1]=egret.getQualifiedClassName(TreasureHuntWin),t[2]=0;var e=new GainWay;e[0]="获得神装：全民BOSS",e[1]=egret.getQualifiedClassName(BossWin),e[2]=1;var i=new GainWay;i[0]="获得神装：挑战副本",i[1]=egret.getQualifiedClassName(FbWin),i[2]=2;var n=new GainWay;n[0]="神秘商店购买",n[1]=egret.getQualifiedClassName(ShopWin),n[2]=0;var s=[[],[],[],[],[],[n]];return this.itemList=s[this._ext],this.itemList},e.prototype.getBookGoSource=function(){return[]},e.prototype.updateData=function(){var t,i;this._breakType==e.type_legend?(t=this.getLegendSource(),i=this.getLegendGoSource()):this._breakType==e.type_book?(t=this.getBookSource(),i=this.getBookGoSource()):this._breakType==e.type_thunder?(t=this.getThunderSource(),i=[]):this._breakType==e.type_soulSuit&&(t=SoulSuitCT.ins().getSoulSuitSurplus(),i=[]),this.listData.source=t,this.goList.source=i;var n=i.length;this.refushPos(n)},e.prototype.showExp=function(){this._addExp.pop()},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.contrain.visible=t>0,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":this.onHandler(t.target.parent.data)}}},e.prototype.onHandler=function(t){if(this._breakType==e.type_legend)EquipCT.ins().sendSmeltEquip(1,[t]);else if(this._breakType==e.type_book){var i=Book.ins().getDecomposeConfigByItemId(t.itemConfig.id);Book.ins().sendDecompose([[i.id,t.count]]),this._addExp.push(i.value)}else this._breakType==e.type_thunder?EquipCT.ins().sendThunderBreak(t.handle):this._breakType==e.type_soulSuit&&SoulSuitCT.ins().sendSoulSuitBreak(t.handle)},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e.type_legend=1,e.type_book=2,e.type_thunder=3,e.type_soulSuit=4,e}(BaseEuiView);__reflect(BreakDownView.prototype,"BreakDownView"),ViewManager.ins().reg(BreakDownView,LayerManager.UI_Popup),window.BreakDownView=BreakDownView;var AutoChallengeBoss=function(t){function e(){var e=t.call(this)||this;return e.observe(BossCT.ins().postWorldBoss,e.checkEnter),e.observe(BossCT.ins().postBossData,e.delayCheckEnter),e.observe(GameLogic.ins().postEnterMap,function(){0==GameMap.fubenID&&e.checkEnter()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.refBossTimeFun=function(){Timer.stop(this.refTimes,this),this.refType=BossCT.BOSS_SUBTYPE_QMBOSS;var t=BossCT.ins().worldBossrestoreTime[this.refType];t>BossCT.ins().worldBossrestoreTime[BossCT.BOSS_SUBTYPE_SHENYU]&&(this.refType=BossCT.BOSS_SUBTYPE_SHENYU,t=BossCT.ins().worldBossrestoreTime[this.refType]);var e=t-egret.getTimer();e>0&&Timer.start(e,1,this.refTimes,this)},e.prototype.refTimes=function(){BossCT.ins().sendWorldBossInfo(this.refType)},e.prototype.delayCheckEnter=function(t){t[0]&&!Timer.has(this.checkEnter,this)&&Timer.start(1e3,2,this.checkEnter,this)},e.prototype.checkEnter=function(){if(BossCT.ins().worldInfoList&&0==GameMap.fubenID){var t=[],e=[],i=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_QMBOSS];if(i&&this.autoYewaiBoss&&BossCT.ins().worldBossLeftTime[BossCT.BOSS_SUBTYPE_QMBOSS])for(var n=0,s=i;n<s.length;n++){var o=s[n],a=GlobalConfig.WorldBossConfig[o.id];BossCT.isCanChallenge(a)&&(a.samsaraLv?t.push(o):e.push(o))}t=t.sort(this.compareFn);for(var r=0;r<t.length;r++){var o=t[r];if(o.canChallenge&&BossCT.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,BossCT.BOSS_SUBTYPE_QMBOSS)}if(BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_SHENYU]&&this.autoShenyuBoss&&BossCT.ins().worldBossLeftTime[BossCT.BOSS_SUBTYPE_SHENYU]){var l=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_SHENYU].slice();l=l.sort(this.compareFn);for(var r=0;r<l.length;r++){var o=l[r];if(o.canChallenge&&BossCT.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,BossCT.BOSS_SUBTYPE_SHENYU)}}e=e.sort(this.compareFn);for(var r=0;r<e.length;r++){var o=e[r];if(o.canChallenge&&BossCT.ins().getBossRemindByIndex(o.id))return void this.enterFb(o.id,BossCT.BOSS_SUBTYPE_QMBOSS)}}},e.prototype.enterFb=function(t,e){var i=BossCT.ins().worldBossCd[e]-egret.getTimer();i>0&&!Timer.has(this.checkEnter,this)?Timer.start(i,1,this.checkEnter,this):(BossCT.ins().postBossData(!1),BossCT.ins().sendChallengWorldBoss(t,e))},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],n=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<n.zsLevel?1:i.zsLevel>n.zsLevel?-1:Algorithm.sortDesc(i.level,n.level)},e}(BaseSystem);__reflect(AutoChallengeBoss.prototype,"AutoChallengeBoss"),System.AutoChallengeBoss=function(){return AutoChallengeBoss.ins()},window.AutoChallengeBoss=AutoChallengeBoss;var BossCT=function(t){function e(){var e=t.call(this)||this;return e.worldBossLeftTime=[],e.worldChallengeTime=[],e.worldBossCd=[],e.worldBossrestoreTime=[],e.worldBossBelongTime=[],e.worldBossCdTime=[],e.curShield=0,e.totalShield=0,e.shieldType=0,e.worldInfoList=[],e.worldBossPlayList=[],e.rankList=[],e.monsterID=0,e.hp=0,e.bossHandler=0,e.lastBossID=-1,e.rank=[],e.challengeCount=0,e.restoreTime=0,e.toDaySoul=0,e.cdTime=0,e.bossRemind=0,e.autoClear=[!1,!1,!1],e.ShowTip=!0,e.currBossSubType=0,e.currBossConfigID=0,e.newWorldBossData=new NewWorldBossData,e.hideBossData={id:0,endTime:0,lastId:0},e.worldPrize=0,e._reliveTime=0,e.killerHandler=0,e.winner="",e.cdCount=0,e.bossAlertList=[],e.isOpenWin=!1,e.weixieList=[],e.canPlayList=[],e.belongName="",e.attHandle=0,e.canClick=!0,e.sysId=PackageID.Boss,e.regNetMsg(7,e.doBelongChange),e.regNetMsg(10,e.postWorldBoss),e.regNetMsg(11,e.setShieldPer),e.regNetMsg(14,e.doClearCD),e.regNetMsg(16,e.startLottery),e.regNetMsg(17,e.doLotteryRan),e.regNetMsg(18,e.doLotteryResult),e.regNetMsg(19,e.doHelpInfo),e.regNetMsg(20,e.doBossBlood),e.regNetMsg(21,e.postUpdatePerInfo),e.regNetMsg(23,e.attackList),e.regNetMsg(24,e.doKillNotice),e.regNetMsg(25,e.postRemainTime),e.regNetMsg(26,e.postWorldBossEndTime),e.regNetMsg(27,e.postWorldNotice),e.regNetMsg(28,e.postChallageRank),e.regNetMsg(29,e.doBossChallengeResult),e.regNetMsg(30,e.doBossSetting),e.regNetMsg(31,e.postNewBossResult),e.regNetMsg(32,e.postNewBossInfo),e.regNetMsg(33,e.postNewBossReliveTime),e.regNetMsg(34,e.postNewBossOpen),e.regNetMsg(35,e.postAddAttrNum),e.regNetMsg(36,e.postNewBossRank),e.regNetMsg(37,e.postBossDieNotice),e.regNetMsg(38,e.postBaseHideBossInfo),e.observe(GameLogic.ins().postEnterMap,e.checkShow),e.observe(GameLogic.ins().postHpChange,e.checkOpenBossBlood),e.observe(GameLogic.ins().postRemoveEntity,e.checkRemoveEntity),e.observe(ZsCT.ins().postZsLv,e.postUpdateWorldPlayList),e.observe(Actor.ins().postLevelChange,e.postUpdateWorldPlayList),e._buyFunc={},e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.init()},e.prototype.checkOpenBossBlood=function(t){var e=t[0],i=t[1],n=e.infoModel.configID;n&&n==this.monsterID&&e.infoModel.handle==GameLogic.ins().currAttackHandle&&GameMap.fbType!=FbCT.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=FbCT.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=FbCT.FB_TYPE_HOMEBOSS&&GameMap.fbType!=FbCT.FB_TYPE_LABA&&GameMap.fbType!=FbCT.FB_TYPE_STARBOSS&&(GameMap.fbType!=FbCT.FB_TYPE_XMHJ||0!=GameLogic.ins().currHandle&&e.infoModel.handle==GameLogic.ins().currHandle)&&(GameMap.fbType!=FbCT.FB_TYPE_SMYJ||0!=GameLogic.ins().currHandle&&e.infoModel.handle==GameLogic.ins().currHandle)&&(this.hp=i,i>0?ViewManager.ins().open(BossBloodPanel):ViewManager.ins().close(BossBloodPanel))},e.prototype.postHpChange=function(){},e.prototype.postBossData=function(t,e,i){return void 0===e&&(e=""),void 0===i&&(i=0),[t,e,i]},e.prototype.sendWorldBossInfo=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.postWorldBoss=function(t){var i=t.readByte(),n=this.worldInfoList[i]=this.worldInfoList[i]||[];this.worldBossPlayList[i]=[],this.worldBossrestoreTime[i]=[],this.worldBossCd[i]=1e3*t.readShort()+egret.getTimer(),this.worldBossLeftTime[i]=t.readShort();var s=t.readShort();n.length=s;for(var o=0;s>o;o++){var a=n[o]||new WorldBossItemData;a.parser(t),a.bossType=i,n[o]=a}return this.worldBossrestoreTime[i]=1e3*t.readShort()+egret.getTimer(),this.worldChallengeTime[i]=t.readShort(),this.worldBossBelongTime[i]=t.readShort(),this.updateBossPlayList(i),(i==e.BOSS_SUBTYPE_QMBOSS||i==e.BOSS_SUBTYPE_SHENYU)&&AutoChallengeBoss.ins().refBossTimeFun(),this.worldBossCdTime[i]=1e3*t.readInt()+egret.getTimer(),i==e.BOSS_SUBTYPE_STARBOSS&&(this.worldBossLeftTime[i]=t.readShort()),i},e.prototype.getCurBossLv=function(t){for(var e=ZsCT.ins().lv,i=0,n=0,s=t;n<s.length;n++){var o=s[n];o.zsLevel<=e&&o.zsLevel>i&&(i=o.zsLevel)}return i?i:1e4},e.prototype.getNextBossLv=function(t){for(var e=ZsCT.ins().lv,i=1e4,n=0,s=t;n<s.length;n++){var o=s[n];o.zsLevel>e&&o.zsLevel<i&&(i=o.zsLevel)}return i},e.prototype.updateBossPlayList=function(t){var i,n,s=this.worldInfoList[t].slice();(t==e.BOSS_SUBTYPE_WORLDBOSS||t==e.BOSS_SUBTYPE_STARBOSS)&&(i=this.getCurBossLv(s),n=this.getNextBossLv(s));for(var o=this.worldBossPlayList[t],a=0,r=s;a<r.length;a++){var l=r[a],h=GlobalConfig.WorldBossConfig[l.id];if(h)if(t==e.BOSS_SUBTYPE_QMBOSS)ZsCT.ins().lv+1>=h.zsLevel&&Actor.level>=h.level&&o.push(l);else if(t==e.BOSS_SUBTYPE_WORLDBOSS)(l.zsLevel==i||l.zsLevel==n)&&Actor.level>=h.level&&o.push(l);else if(t==e.BOSS_SUBTYPE_HOMEBOSS){var u=void 0;for(var p in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[p].boss.lastIndexOf(l.id)){u=GlobalConfig.BossHomeConfig[p];break}u&&Actor.vip>=u.vip&&ZsCT.ins().lv>=h.zsLevel&&Actor.level>=h.level&&o.push(l)}else t==e.BOSS_SUBTYPE_SHENYU?ZsCT.ins().lv>=h.zsLevel&&Actor.level>=h.level&&o.push(l):t==e.BOSS_SUBTYPE_GODWEAPON||t==e.BOSS_SUBTYPE_GODWEAPON_TOP?l.canInto&&o.push(l):t==e.BOSS_SUBTYPE_DARKBOSS?l.zsLevel<=ZsCT.ins().lv+1&&Actor.level>=h.level&&o.push(l):t==e.BOSS_SUBTYPE_STARBOSS&&l.canInto&&o.push(l)}},e.prototype.postUpdateWorldPlayList=function(){for(var t in this.worldInfoList){var e=+t;this.worldBossPlayList[e]=[],this.updateBossPlayList(e)}},e.prototype.setShieldPer=function(t){this.shieldType=t.readByte(),this.curShield=t.readInt(),this.totalShield=t.readInt();var e=t.readByte(),i=this.curShield==this.totalShield;if(i){var n="";e?(n="BOSS开启护盾，击破护盾开启抽奖获得幸运奖励",TipsCT.ins().showSceneTips(n)):(n="BOSS开启护盾，期间BOSS不会减少血量",TipsCT.ins().showSceneTips(n))}this.postShieldPer()},e.prototype.postShieldPer=function(){},e.prototype.sendGetBossAward=function(){this.sendToServer(this.getBytes(13))},e.prototype.sendClearCD=function(){GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS?FbCT.ins().sendGuideFbAlive():GameMap.fbType==FbCT.FB_TYPE_CITY?CityCC.ins().sendRevival():GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId?BattleCC.ins().sendReLive():GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId?PaoDianCC.ins().sendReLive():GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS?this.sendNewBossBuyRelive():this.sendToServer(this.getBytes(14))},e.prototype.doClearCD=function(t){TipsCT.ins().showTips(t.readByte()?"成功清除挑战CD":"CD已结束，直接参与挑战")},e.prototype.sendChallengWorldBoss=function(t,e){this.currBossSubType=e,this.currBossConfigID=t;var i=this.getBytes(15);i.writeInt(t),this.sendToServer(i)},e.prototype.startLottery=function(t){this.worldPrize=t.readInt(),ViewManager.ins().open(WorldBossJiangLiWin)},e.prototype.sendJoinLottery=function(){this.sendBaseProto(17)},e.prototype.doLotteryRan=function(t){var e=t.readShort();this.postLotteryRan(e)},e.prototype.postLotteryRan=function(t){return t},e.prototype.sendChallengRank=function(t){this.currBossSubType=t;var e=this.getBytes(28);e.writeInt(t),this.sendToServer(e)},e.prototype.doLotteryResult=function(t){var e=t.readString(),i=t.readShort();this.postLotteryResult(e,i)},e.prototype.postLotteryResult=function(t,e){return[t,e]},e.prototype.sendHelpLottery=function(t){var e=this.getBytes(18);e.writeString(t),this.sendToServer(e)},e.prototype.doHelpInfo=function(t){this.helpInfo=t.readString(),ChatCT.ins().postSysChatMsg(new ChatSystemData(3,this.helpInfo))},e.prototype.doBossBlood=function(t){this.monsterID=t.readInt(),this.hp=t.readDouble(),this.hp&&this.monsterID!=this.lastBossID&&GameMap.fbType!=FbCT.FB_TYPE_MATERIAL&&GameMap.fbType!=FbCT.FB_TYPE_TIAOZHAN&&GameMap.fbType!=FbCT.FB_TYPE_EXP&&GameMap.fbType!=FbCT.FB_TYPE_GUIDEBOSS&&this.postBossAppear(),this.lastBossID=this.monsterID,this.hp<=0&&(this.lastBossID=-1),this.bossHandler=t.readDouble();var e=(t.readDouble(),t.readShort());this.rank.length=e;for(var i=0;e>i;i++)this.rank[i]=this.rank[i]||new WorldBossRankItemData,this.rank[i].parser(t),this.rank[i].rank=i+1;if(this.postHpChange(),GameMap.fbType==FbCT.FB_TYPE_XUANWU&&(!this.hp||this.hp<=0))ViewManager.ins().close(BossBloodPanel);else if(GameMap.fbType==FbCT.FB_TYPE_SPIRIT&&(!GameLogic.ins().currAttackHandle||this.hp<=0))ViewManager.ins().close(BossBloodPanel);else if(GameMap.fbType==FbCT.FB_TYPE_Legend){var n=EntityManager.ins().getEntityByHandle(this.bossHandler);n&&ViewManager.ins().open(BossBloodPanel)}else GameMap.fbType!=FbCT.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=FbCT.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=FbCT.FB_TYPE_HOMEBOSS&&GameMap.fbType!=FbCT.FB_TYPE_LABA&&GameMap.fbType!=FbCT.FB_TYPE_STARBOSS&&GameMap.fbType!=FbCT.FB_TYPE_XMHJ&&GameMap.fbType!=FbCT.FB_TYPE_SOULS&&GameMap.fbType!=FbCT.FB_TYPE_SPIRIT&&GameMap.fbType!=FbCT.FB_TYPE_SMYJ&&ViewManager.ins().open(BossBloodPanel);(!this.hp||this.hp<=0&&(1==CrossGuildBattleCT.ins().getCurMapLevel()||GuildWar.ins().getModel().checkinAppoint(1)))&&ViewManager.ins().close(BossBloodPanel)},e.prototype.postBossAppear=function(){return this.monsterID},e.prototype.postBossDisappear=function(t){return this.bossHandler=0,t},e.prototype.postUpdatePerInfo=function(t){return this.worldBossCd[this.currBossSubType]=1e3*t.readShort()+egret.getTimer(),this.worldBossLeftTime[this.currBossSubType]=t.readShort(),[this.worldBossCd,this.worldBossLeftTime]},e.prototype.doBelongChange=function(t){var e=t.readDouble(),i=t.readDouble(),n=t.readString();this.postBelongChange(e,i,n)},e.prototype.postBelongChange=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=""),this.changecanPlayList(t),this.attHandle=t,EntityShowMgr.ins().showHideSomeOne(t),t>0){var n=EntityManager.ins().getMasterList(t),s="";if(!(n&&n[0]&&n[0].infoModel))return;s=n[0].infoModel.name,this.setBelongHPandColor();var o="";if(t>0&&e>0){var a=s,r=a.split("\n");a=r[1]?r[1]:r[0];var l=i;r=l.split("\n"),l=r[1]?r[1]:r[0],l=StringUtils.replaceStr(l,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),o="|C:"+ColorUtil.ROLENAME_COLOR_GREEN+"&T:"+a+"|击败了|C:"+ColorUtil.ROLENAME_COLOR_GREEN+"&T:"+l+"|，成为了新的归属者。",TipsCT.ins().showSceneTips(o)}}},e.prototype.attackList=function(t){var e=t.readUnsignedInt();this.weixieList=[];for(var i=0;e>i;i++){var n=t.readDouble(),s=EntityManager.ins().getRootMasterHandle(n);this.changeWeiXieList(s)}this.postHasAttackChange(0)},e.prototype.doKillNotice=function(t){var e=t.readString(),i=t.readShort(),n=t.readShort(),s=GlobalConfig.WorldBossKillMsgConfig[n].msg;s=StringUtils.substitute(s,e,i),TipsCT.ins().showSceneTips(s)},e.prototype.postRemainTime=function(t){this.reliveTime=t.readShort(),this.killerHandler=t.readDouble(),this.reliveTime>0&&this.clearWorldBossList()},e.prototype.setBelongHPandColor=function(){if(this.attHandle!=Actor.handle)for(var t=EntityManager.ins().getMasterList(this.attHandle),e=0,i=t;e<i.length;e++){var n=i[e];n instanceof CharRole&&n.setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW)}},e.prototype.postWorldBossEndTime=function(t){this.winner=t.readString();var e=6e4;GwBoss.ins().isGwBoss?e=3e4:GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS&&(e=1e4),this.worldBossEndTime=egret.getTimer()+e,this.clearWorldBossList()},e.prototype.resetCD=function(){this.cdCount>0?this.cdCount--:Timer.stop(this.resetCD,this)},e.prototype.postWorldNotice=function(t){var i=t.readByte(),n=t.readInt(),s=Actor.level,o=ZsCT.ins().lv;if(i==e.BOSS_SUBTYPE_QMBOSS){var a=this.worldInfoList[i];for(var r in a){var l=GlobalConfig.WorldBossConfig[n];if(a[r].id==n&&this.getBossRemindByIndex(n)&&o>=l.zsLevel&&s>=l.level){var h=GlobalConfig.MonstersConfig[l.bossId];a[r].hp=100,a[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}var c="|C:0xfee900&T:BOSS||C:0xfe4444&T:"+h.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:野外BOSS！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c)),this.worldBossLeftTime[i]&&this.postBossData(!0,h.name,l.type);break}}}else if(i==e.BOSS_SUBTYPE_HOMEBOSS){var l=GlobalConfig.WorldBossConfig[n],h=GlobalConfig.BossHomeConfig[n];if(h&&o>=l.zsLevel&&s>=l.level&&Actor.vip>=h.vip){var a=this.worldInfoList[i],u=this.worldBossPlayList[i],d=h.boss;for(var r in a)-1!=d.lastIndexOf(a[r].id)&&(a[r].hp=100,a[r].bossState=1);for(var p in u)-1!=d.lastIndexOf(u[p].id)&&(u[p].hp=100,u[p].bossState=1);var c="|C:0xfee900&T:BOSS之家"+n+"层所有BOSS刷新了，这里的BOSS太多了，简直就是打宝天堂|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c)),this.worldBossLeftTime[i]&&this.postBossData(!0,"BOSS之家",3)}}else if(i==e.BOSS_SUBTYPE_SHENYU){var a=this.worldInfoList[i];for(var r in a){var l=GlobalConfig.WorldBossConfig[n];if(a[r].id==n&&this.getBossRemindByIndex(n)&&o>=l.zsLevel&&s>=l.level){var h=GlobalConfig.MonstersConfig[l.bossId];a[r].hp=100,a[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}var c="|C:0xfee900&T:BOSS||C:0xfe4444&T:"+h.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:神域BOSS！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c)),this.worldBossLeftTime[i]&&this.postBossData(!0,h.name,l.type);break}}}else if(i==e.BOSS_SUBTYPE_GODWEAPON||i==e.BOSS_SUBTYPE_GODWEAPON_TOP){var a=this.worldInfoList[i];for(var r in a){var l=GlobalConfig.WorldBossConfig[n];if(a[r].id==n){var h=GlobalConfig.MonstersConfig[l.bossId];a[r].hp=100,a[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}break}}}else if(i==e.BOSS_SUBTYPE_DARKBOSS){var a=this.worldInfoList[i];for(var r in a){var l=GlobalConfig.WorldBossConfig[n];if(a[r].id==n&&this.getBossRemindByIndex(n)&&o>=l.zsLevel&&s>=l.level){var h=GlobalConfig.MonstersConfig[l.bossId];a[r].hp=100,a[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}if(a[r].canInto){var c="|C:0xfee900&T:未知暗殿BOSS||C:0xfe4444&T:"+h.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:未知暗殿BOSS！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c)),this.worldBossLeftTime[i]&&this.postBossData(!0,h.name,l.type)}break}}}else if(i==e.BOSS_SUBTYPE_STARBOSS){var g=this.worldInfoList[i];for(var r in g){var l=GlobalConfig.WorldBossConfig[n];if(g[r].id==n){var h=GlobalConfig.MonstersConfig[l.bossId];g[r].hp=100,g[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}if(g[r].canInto){var c="|C:0xfee900&T:星辰BOSS||C:0xfe4444&T:"+h.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:星辰BOSS！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c));var f=e.ins().bossAlertList.some(function(t){return t==g[r].id});this.worldBossLeftTime[i]&&this.postBossData(f,h.name,l.type)}break}}}else if(i==e.BOSS_SUBTYPE_VIPBOSS){var v=this.worldInfoList[i];for(var r in v){var l=GlobalConfig.WorldBossConfig[n];if(v[r].id==n&&o>=l.zsLevel&&s>=l.level){var h=GlobalConfig.MonstersConfig[l.bossId];v[r].hp=100,v[r].bossState=1;var u=this.worldBossPlayList[i];for(var p in u)if(u[p]&&u[p].id==n){u[p].hp=100,u[p].bossState=1;break}if(Actor.vip>=l.belongRewardVipLimit){var c="|C:0xfee900&T:VipBOSS||C:0xfe4444&T:"+h.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:玛雅神殿！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,c));var f=e.ins().bossAlertList.some(function(t){return t==v[r].id});this.worldBossLeftTime[i]&&this.postBossData(f,h.name,l.type)}break}}}else i==e.BOSS_SUBTYPE_XUANWUBOSS},e.prototype.postChallageRank=function(t){for(var e,i=t.readInt(),n=t.readByte(),s=[],o=0;n>o;o++)s[o]=[],e=t.readInt(),s[o][0]=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(e)/1e3,6),s[o][1]=t.readString(),s[o][2]=t.readDouble().toString(),s[o][3]="1";return s.reverse(),[i,s]},e.prototype.doBossChallengeResult=function(t){for(var e=t.readByte(),i=t.readByte(),n=t.readString(),s=t.readByte()||1,o=t.readByte(),a=t.readShort(),r=[],l=0;a>l;l++)r[l]=new RewardData,r[l].parser(t),(GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS||GameMap.fbType==FbCT.FB_TYPE_DARK_BOSS||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss)&&(0==r[l].type&&1!=r[l].id&&2!=r[l].id&&r[l].id!=MoneyConst.rune||DropHelp.addDrop([0!=DropHelp.tempDropPoint.x?DropHelp.tempDropPoint.x:Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),0!=DropHelp.tempDropPoint.y?DropHelp.tempDropPoint.y:Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE),r[l]]));var h=t.readString();n=(""==h?"":"|C:0x2eb6ff&T:【"+h+"】|\n")+n;var u="yuanhead"+s+o;if(GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS||GameMap.fbType==FbCT.FB_TYPE_DARK_BOSS||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss){var p=function(){ResultManager.ins().create(GameMap.fbType,!0,r,"",null,[e,n,u,i])};DropHelp.start(),DropHelp.addCompleteFunc(p,this)}else ResultManager.ins().create(GameMap.fbType,!0,r,"",null,[e,n,u,i])},e.prototype.setBossSetting=function(t){if(!isNaN(t)){var e=this.bossAlertList.indexOf(t);-1!=e?this.bossAlertList.splice(e,1):this.bossAlertList.push(t)}},e.prototype.sendBossSetting=function(){var t=this.bossAlertList?this.bossAlertList.length:0,e=this.getBytes(29);e.writeShort(t);for(var i=0;t>i;i++)e.writeShort(this.bossAlertList[i]);this.sendToServer(e)},e.prototype.doBossSetting=function(t){this.bossAlertList=[];for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort();this.bossAlertList.push(n)}},e.prototype.checkNewWorldBossOpen=function(){return Actor.level>=GlobalConfig.NewWorldBossBaseConfig.openLv},e.prototype.sendIntoNewBoss=function(){this.sendBaseProto(31)},e.prototype.postNewBossResult=function(t){this.newWorldBossData.isKill=!!t.readByte(),this.newWorldBossData.rank=t.readInt(),this.newWorldBossData.lastKillRoleName=t.readString(),this.newWorldBossData.randomRoleName=t.readString(),this.newWorldBossData.totalTime=t.readInt(),this.newWorldBossData.randomAwards=[];for(var e=t.readShort(),i=0;e>i;i++)this.newWorldBossData.randomAwards[i]=new RewardData,this.newWorldBossData.randomAwards[i].parser(t);ResultManager.ins().create(GameMap.fbType,1)},e.prototype.sendGetNewBossInfo=function(){this.sendBaseProto(32)},e.prototype.postNewBossInfo=function(t){this.newWorldBossData.bossID=t.readInt(),this.newWorldBossData.curHp=t.readDouble()},e.prototype.sendNewBossBuyRelive=function(){this.sendBaseProto(33)},e.prototype.postNewBossReliveTime=function(t){this.reliveTime=t.readShort()},e.prototype.postNewBossOpen=function(t){this.newWorldBossData.isOpen=!!t.readByte(),this.newWorldBossData.startTime=t.readInt(),this.newWorldBossData.startTime&&(this.newWorldBossData.startTime=DateUtils.formatMiniDateTime(this.newWorldBossData.startTime)),this.newWorldBossData.isOpen&&!this.isOpenWin&&(this.isOpenWin=!0,ViewManager.ins().open(PlayTipsWin,PlayTipsWin.TYPE_BOSS))},e.prototype.postAddAttrNum=function(t){this.newWorldBossData.addAttrNum=t.readShort()},e.prototype.postNewBossRank=function(t){var e=t.readShort();null==this.newWorldBossData.rankList&&(this.newWorldBossData.rankList=[]),this.newWorldBossData.rankList.length=e;for(var i=0;e>i;i++)this.newWorldBossData.rankList[i]=this.newWorldBossData.rankList[i]||new NewWorldBossRankData,this.newWorldBossData.rankList[i].parser(t);this.newWorldBossData.rankList.sort(this.sortNewBossRank)},e.prototype.sortNewBossRank=function(t,e){return t.value>e.value?-1:1},e.prototype.postBossDieNotice=function(t){var i=t.readInt(),n=GlobalConfig.WorldBossConfig[i];if(n)switch(n.type){case e.BOSS_SUBTYPE_WORLDBOSS:case e.BOSS_SUBTYPE_QMBOSS:case e.BOSS_SUBTYPE_DARKBOSS:case e.BOSS_SUBTYPE_STARBOSS:case e.BOSS_SUBTYPE_GODWEAPON:case e.BOSS_SUBTYPE_GODWEAPON_TOP:var s=GlobalConfig.MonstersConfig[n.bossId];this.postBossData(!1,s.name,n.type),this.sendWorldBossInfo(n.type);break;case e.BOSS_SUBTYPE_HOMEBOSS:this.postBossData(!1,"BOSS之家",3),this.sendWorldBossInfo(n.type)}},e.prototype.sendBuyChallengeTimes=function(t){var e=this.getBytes(30);return e.writeByte(t),this.sendToServer(e),null!=this._buyFunc[t]?(this._buyFunc[t](t),!0):void 0},e.prototype.registerBuyFunc=function(t,e){this._buyFunc[t]=e},e.prototype.sendBuyAddAttrNum=function(){this.sendBaseProto(34)
},e.prototype.getBossRemindByIndex=function(t){return-1!=this.bossAlertList.indexOf(t)},e.prototype.sendCleanBelong=function(){this.sendBaseProto(35)},e.prototype.sendChallengeHideBoss=function(){this.sendBaseProto(36)},e.prototype.postBaseHideBossInfo=function(t){var e=t.readInt(),i=t.readInt();this.hideBossData.id=e,this.hideBossData.endTime=i},e.prototype.checkWorldBossMoney=function(){return Actor.yb>=this.checkWorldBossNeed()},e.prototype.checkWorldBossNeed=function(){return GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS?GlobalConfig.LeadFubenBaseConfig.BuyRebornCost:GameMap.fbType==FbCT.FB_TYPE_CITY?GlobalConfig.CityBaseConfig.BuyRebornCost:GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS?GlobalConfig.NewWorldBossBaseConfig.clearCdCost:GameMap.fubenID==GlobalConfig.CampBattleConfig.fbId?GlobalConfig.CampBattleConfig.buyRebornCdCost:GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId?GlobalConfig.PassionPointConfig.buyRebornCdCost:GlobalConfig.WorldBossBaseConfig.clearCdCost[this.currBossSubType-1]},e.prototype.checkisAutoRelive=function(){if(this.reliveTime>0){if(this.autoClear[this.currBossSubType]){if(this.checkWorldBossMoney())return this.sendClearCD(),!1;TipsCT.ins().showTips("元宝不足，无法立即复活"),this.autoClear[this.currBossSubType]=!1}return!0}return!1},Object.defineProperty(e.prototype,"reliveTime",{get:function(){return this._reliveTime},set:function(t){this._reliveTime!=t&&(this._reliveTime=t,Timer.stop(this.timeClock,this),Timer.start(1e3,this._reliveTime,this.timeClock,this))},enumerable:!0,configurable:!0}),e.prototype.timeClock=function(){this._reliveTime--,this._reliveTime<=0&&Timer.stop(this.timeClock,this)},e.prototype.parser=function(t){this.challengeCount=t.readShort(),this.restoreTime=1e3*t.readShort()+egret.getTimer(),this.toDaySoul=t.readInt(),this.cdTime=1e3*t.readShort()+egret.getTimer(),this.bossRemind=t.readInt(),(!this.hp||this.hp<=0&&(1==CrossGuildBattleCT.ins().getCurMapLevel()||GuildWar.ins().getModel().checkinAppoint(1)))&&ViewManager.ins().close(BossBloodPanel)},e.prototype.checkShow=function(){var t=GameMap.fubenID;isNaN(t)||(GameMap.fubenID!=GameMap.lastFbId&&(this.lastBossID=-1),0!=t&&GameMap.fbType!=FbCT.FB_TYPE_GUANQIABOSS?GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fubenID==GlobalConfig.NewWorldBossBaseConfig.fbId?ViewManager.ins().open(NewWorldBossUIView):GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS||GameMap.fbType==FbCT.FB_TYPE_STARBOSS||GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS&&40001!=GameMap.fubenID?ViewManager.ins().open(WorldBossUiInfo):GameMap.sceneInMine()?ViewManager.ins().open(MineScenePanel):GameMap.fbType==FbCT.FB_TYPE_LABA?ViewManager.ins().open(LabaBossUIPanel):GameMap.fbType==FbCT.FB_TYPE_DEMON&&ViewManager.ins().open(DemonSceneWin):(ViewManager.ins().close(MineScenePanel),ViewManager.ins().close(WorldBossUiInfo),ViewManager.ins().close(WorldBossBeKillWin),ViewManager.ins().close(NewWorldBossUIView),ViewManager.ins().close(LabaBossUIPanel),ViewManager.ins().close(DemonSceneWin)))},e.prototype.checkRelive=function(){if(GwBoss.ins().isRoleDie()){if(this.checkWorldBossMoney())return!0;TipsCT.ins().showTips("元宝不足，无法立即复活"),this.autoClear[this.currBossSubType]=!1}return!1},e.prototype.checkRemoveEntity=function(t){var e=t[0],i=t[1],n=i.infoModel;if(n&&n.team!=Team.My&&n.type==EntityType.Role&&n.masterHandle){var s=n.masterHandle;EntityManager.ins().getMasterList(s)||EntityShowMgr.ins().showNearSomeOne()}n&&e==this.bossHandler&&this.postBossDisappear(i)},e.prototype.getRankList=function(t){return this.rankList[t]},e.prototype.init=function(){this.sendWorldBossInfo(e.BOSS_SUBTYPE_WORLDBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_QMBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_HOMEBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_SHENYU),this.sendWorldBossInfo(e.BOSS_SUBTYPE_GODWEAPON),this.sendWorldBossInfo(e.BOSS_SUBTYPE_GODWEAPON_TOP),this.sendWorldBossInfo(e.BOSS_SUBTYPE_DARKBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_STARBOSS),this.sendWorldBossInfo(e.BOSS_SUBTYPE_VIPBOSS)},e.prototype.changeWeiXieList=function(t,e){if(void 0===e&&(e=!0),Actor.handle!=t){var i=this.checkListElements(t,this.weixieList);e?-1==i&&this.weixieList.push(t):-1!=i&&this.weixieList.splice(i,1)}},e.prototype.changecanPlayList=function(t,e){void 0===e&&(e=!0);var i;Actor.handle!=t?0==t?(this.canPlayList=[],this.belongName=""):(this.weixieList=[],this.canPlayList[0]=t,i=EntityManager.ins().getEntityBymasterhHandle(t),i&&(this.belongName=i.infoModel.name)):(this.weixieList=[],this.canPlayList=[],this.belongName=Actor.myName),this.postHasAttackChange(0),this.postCanplayChange()},e.prototype.checkListElements=function(t,e){if(e.length<=0)return-1;for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},e.prototype.postHasAttackChange=function(t){return t},e.prototype.postCanplayChange=function(){},e.prototype.clearWorldBossList=function(){GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS||GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS||GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON||GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON_TOP||GameMap.fbType==FbCT.FB_TYPE_DARK_BOSS||GameMap.fbType==FbCT.FB_TYPE_XUANWU||GameMap.fbType==FbCT.FB_TYPE_37BOSS?(this.weixieList=[],this.canPlayList=[],GameLogic.ins().currAttackHandle=0):(this.winner="",FbCT.ins().guideBossKill=0)},e.prototype.checkBossIconShow=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOSS)},e.prototype.checkShenyuOpen=function(){return GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.shenyuOpenDay-1},e.prototype.checkWorldBossRedPoint=function(t){var i;if(i=t==e.BOSS_SUBTYPE_XUANWUBOSS?XuanWuCT.ins().bossPlayList:this.worldBossPlayList[t],!i&&t!=e.BOSS_SUBTYPE_XUANWUBOSS)return!1;if(t==e.BOSS_SUBTYPE_SHENYU&&!this.checkShenyuOpen())return!1;if(t!=e.BOSS_SUBTYPE_HOMEBOSS&&(!this.worldBossLeftTime||this.worldBossLeftTime.length<0||!this.worldBossLeftTime[t]))return!1;if(t==e.BOSS_SUBTYPE_DARKBOSS){for(var n=!0,s=this.worldInfoList[t].slice(),o=1e3*ZsCT.ins().lv+Actor.level,a=0,r=s;a<r.length;a++){var l=r[a],h=(l.relieveTime-egret.getTimer())/1e3>0||l.hp<=0;if(!h){var u=GlobalConfig.WorldBossConfig[l.id];if(u.samsaraLv){if(Actor.samsaraLv>=u.samsaraLv){n=!1;break}}else{var p=1e3*u.zsLevel+u.level;if(o>=p){n=!1;break}}}}return!n}if(t==e.BOSS_SUBTYPE_QMBOSS||t==e.BOSS_SUBTYPE_SHENYU){if(!this.bossAlertList||!this.bossAlertList.length)return!1;for(var n=!0,s=this.worldInfoList[t].slice(),o=1e3*ZsCT.ins().lv+Actor.level,c=0,d=s;c<d.length;c++){var l=d[c],h=(l.relieveTime-egret.getTimer())/1e3>0||l.hp<=0;if(!h&&this.getBossRemindByIndex(l.id)){var u=GlobalConfig.WorldBossConfig[l.id];if(u.samsaraLv){if(Actor.samsaraLv>=u.samsaraLv){n=!1;break}}else{var p=1e3*u.zsLevel+u.level;if(o>=p){n=!1;break}}}}return!n}if(t==e.BOSS_SUBTYPE_GODWEAPON){for(var g=0,f=i;g<f.length;g++){var v=f[g];if(this.worldBossBelongTime[t]>0&&v.canChallenge&&this.getBossRemindByIndex(v.id))return!0}return!1}if(t==e.BOSS_SUBTYPE_GODWEAPON_TOP){for(var y=0,m=i;y<m.length;y++){var v=m[y];if(v.canChallenge&&this.getBossRemindByIndex(v.id)){var T=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t-1];if(Actor.yb>=T)return!0;var C=GlobalConfig.WorldBossBaseConfig.challengeItem[t-1],b=BagCT.ins().getBagGoodsByTypeAndId(0,C);if(b&&b.count)return!0}}return!1}if(t==e.BOSS_SUBTYPE_STARBOSS){for(var I=0,w=i;I<w.length;I++){var v=w[I];if((this.worldBossCdTime[t]-egret.getTimer())/1e3<=0&&v.canChallenge&&!v.isDie&&v.canInto)return!0}return!1}if(t==e.BOSS_SUBTYPE_XUANWUBOSS){for(var S=0,_=i;S<_.length;S++){var v=_[S];if(2!=v.bossState){var h=(v.relieveTime-egret.getTimer())/1e3>0;if(h)continue;var B=GlobalConfig.XuanWuBossConfig[v.id];if(YuanshenData.ins().isInTheRange(B.lianjiLv))return!0}}return!1}if(this.worldBossLeftTime[t]<=0)return!1;for(var D=i.length,x=0;D>x;x++)if(2!=i[x].bossState){if(t!=e.BOSS_SUBTYPE_WORLDBOSS&&!e.BOSS_SUBTYPE_DARKBOSS)return!0;if(i[x].zsLevel<=ZsCT.ins().lv)return!0}return!1},Object.defineProperty(e.prototype,"clickTime",{set:function(t){this.canClick=!1,this._clickTime=t,Timer.stop(this.endTimeChangeStatu,this),Timer.start(500,this._clickTime,this.endTimeChangeStatu,this)},enumerable:!0,configurable:!0}),e.prototype.endTimeChangeStatu=function(){--this._clickTime,this._clickTime<=0&&(this.canClick=!0,Timer.stop(this.endTimeChangeStatu,this))},e.prototype.getListData=function(){for(var t=FbCT.getPersonalBossFbIds().slice(),e=[],i=[],n=[],s=1e3*ZsCT.ins().lv+Actor.level,o=0,a=t;o<a.length;o++){var r=a[o],l=FbCT.ins().getFbDataById(r.id);if(l){var h=l.getPlayCount()<=0;if(h)e.push(r);else{var u=1e3*r.zsLevel+r.levelLimit;r.monthcard?Recharge.ins().monthDay>0?i.unshift(r):n.push(r):r.specialCard?Recharge.ins().franchise?i.unshift(r):n.push(r):r.privilege?Recharge.ins().getIsForeve()?i.unshift(r):n.push(r):s>=u?i.push(r):n.push(r)}}}return[i,n,e]},e.prototype.getGwBossList=function(){for(var t=this.worldInfoList[e.BOSS_SUBTYPE_GODWEAPON].concat(),i=this.worldInfoList[e.BOSS_SUBTYPE_GODWEAPON_TOP].concat(),n=0;n<i.length;n++){var s=i[n];GlobalConfig.WorldBossConfig[s.id];if(s.canInto){t.push(i[n]);break}}return t},e.isCanChallenge=function(t){var e;if(t.samsaraLv>0)e=Actor.samsaraLv>=t.samsaraLv;else{var i=1e3*ZsCT.ins().lv+Actor.level,n=1e3*t.zsLevel+t.level;e=i>=n}return e},e.prototype.checkBossOpen=function(){if(!this.newWorldBossData.isOpen)return TipsCT.ins().showTips("世界BOSS未开启"),!1;if(!KfArenaSys.ins().checkIsMatching())return!1;if(this.newWorldBossData.startTime>GameServer.serverTime){var t=new Date(this.newWorldBossData.startTime),e=t.getHours()+"点"+(t.getMinutes()?t.getMinutes()+"分":"");return TipsCT.ins().showTips("每天"+e+"开启，请按时参加"),!1}return this.checkNewWorldBossOpen()?(this.sendIntoNewBoss(),!0):(TipsCT.ins().showTips(GlobalConfig.NewWorldBossBaseConfig.openLv+"级才可以参加"),!1)},e.WB_BAG_ENOUGH=50,e.BOSS_SUBTYPE_WORLDBOSS=1,e.BOSS_SUBTYPE_QMBOSS=2,e.BOSS_SUBTYPE_HOMEBOSS=3,e.BOSS_SUBTYPE_SHENYU=4,e.BOSS_SUBTYPE_GODWEAPON=5,e.BOSS_SUBTYPE_GODWEAPON_TOP=6,e.BOSS_SUBTYPE_DARKBOSS=7,e.BOSS_SUBTYPE_STARBOSS=8,e.BOSS_SUBTYPE_VIPBOSS=9,e.BOSS_SUBTYPE_XUANWUBOSS=100,e.BOSS_SUBTYPE_TXMY=101,__decorate([post()],e.prototype,"postHpChange",null),__decorate([post()],e.prototype,"postBossData",null),__decorate([post()],e.prototype,"postWorldBoss",null),__decorate([post()],e.prototype,"postUpdateWorldPlayList",null),__decorate([post()],e.prototype,"postShieldPer",null),__decorate([post()],e.prototype,"postLotteryRan",null),__decorate([post()],e.prototype,"postLotteryResult",null),__decorate([post()],e.prototype,"postBossAppear",null),__decorate([post()],e.prototype,"postBossDisappear",null),__decorate([post()],e.prototype,"postUpdatePerInfo",null),__decorate([post()],e.prototype,"postBelongChange",null),__decorate([post()],e.prototype,"postRemainTime",null),__decorate([post()],e.prototype,"postWorldBossEndTime",null),__decorate([post()],e.prototype,"postWorldNotice",null),__decorate([post()],e.prototype,"postChallageRank",null),__decorate([post()],e.prototype,"postNewBossResult",null),__decorate([post()],e.prototype,"postNewBossInfo",null),__decorate([post()],e.prototype,"postNewBossReliveTime",null),__decorate([post()],e.prototype,"postNewBossOpen",null),__decorate([post()],e.prototype,"postAddAttrNum",null),__decorate([post()],e.prototype,"postNewBossRank",null),__decorate([post()],e.prototype,"postBossDieNotice",null),__decorate([post()],e.prototype,"postBaseHideBossInfo",null),__decorate([post()],e.prototype,"postHasAttackChange",null),__decorate([post()],e.prototype,"postCanplayChange",null),e}(BaseSystem);__reflect(BossCT.prototype,"BossCT"),System.BossCT=function(){return BossCT.ins()},window.BossCT=BossCT;var DarkMjBoss=function(t){function e(){var e=t.call(this)||this;return e.lastDarkBoss=!1,e.isBossDie=!1,e.observe(GameLogic.ins().postEnterMap,function(){e.isDarkBoss?e.postEnterGwBoss():e.lastDarkBoss&&e.postEscGwBoss(),e.checkIsShowBtn()}),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(BossCT.ins().postRemainTime,e.onDie),e.observe(BossCT.ins().postWorldBossEndTime,e.onBossDisappear),e.observe(BossCT.ins().postBaseHideBossInfo,e.onHideBossAppear),e}return __extends(e,t),Object.defineProperty(e.prototype,"isDarkBoss",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_DARK_BOSS},enumerable:!0,configurable:!0}),e.prototype.postEnterGwBoss=function(){this.lastDarkBoss=!0,this.isBossDie=!1,this.showView(!0)},e.prototype.postEscGwBoss=function(){this.lastDarkBoss=!1,this.isBossDie=!1,this.showView(!1),ViewManager.ins().close(BossEndView)},e.prototype.showView=function(t){t?(ViewManager.ins().isShow(BossBelongPanel)||ViewManager.ins().open(BossBelongPanel,!1),ViewManager.ins().isShow(BossBloodPanel)||ViewManager.ins().open(BossBloodPanel)):(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetListPanel))},e.prototype.onCreateEntity=function(t){t&&this.isDarkBoss&&(t.type!=EntityType.Monster||t.team!=Team.Monster||t.masterHandle||(BossCT.ins().monsterID=t.configID,BossCT.ins().bossHandler=t.handle,this.showView(!0)))},e.prototype.onDie=function(){this.isDarkBoss&&(this.isRoleDie()?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin))},e.prototype.isRoleDie=function(){return BossCT.ins().reliveTime>0},e.prototype.onBossDisappear=function(){this.isDarkBoss&&(this.showView(!1),this.isBossDie=!0,ViewManager.ins().open(BossEndView))},e.prototype.checkIsShowBtn=function(){this.checkCanShow()&&GameMap.sceneInMain()?ViewManager.ins().isShow(HideBossBtnWin)||ViewManager.ins().open(HideBossBtnWin):ViewManager.ins().close(HideBossBtnWin)},e.prototype.checkCanShow=function(){var t=BossCT.ins().hideBossData.endTime;return BossCT.ins().hideBossData.id&&t&&DateUtils.formatMiniDateTime(t)>GameServer.serverTime},e.prototype.onHideBossAppear=function(){var t=this;if(!this.checkCanShow())return void ViewManager.ins().close(HideBossBtnWin);if(!this.isDarkBoss)return void(ViewManager.ins().isShow(HideBossBtnWin)||ViewManager.ins().open(HideBossBtnWin));var e=EntityManager.ins().getEntityByHandle(BossCT.ins().bossHandler);if(e&&e.parent){var i=ObjectPool.pop("MovieClip"),n=function(){ViewManager.ins().isShow(HideBossBtnWin)||ViewManager.ins().open(HideBossBtnWin,1),i.removeEventListener(egret.Event.REMOVED_FROM_STAGE,n,t)};i.playFile(RES_DIR_EFF+"luckyboss_dragon_up",1,function(){n()}),i.x=e.x,i.y=e.y,i.addEventListener(egret.Event.REMOVED_FROM_STAGE,n,this),e.parent.addChild(i)}else ViewManager.ins().open(HideBossBtnWin,1)},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postEnterGwBoss",null),__decorate([post()],e.prototype,"postEscGwBoss",null),e}(BaseSystem);__reflect(DarkMjBoss.prototype,"DarkMjBoss"),System.DarkMjBoss=function(){return DarkMjBoss.ins()},window.DarkMjBoss=DarkMjBoss;var GwBoss=function(t){function e(){var e=t.call(this)||this;return e.lastGwBoss=!1,e.lastGwTopBoss=!1,e.isBossDie=!1,e.observe(GameLogic.ins().postEnterMap,function(){e.isGwBoss||e.isGwTopBoss?e.postEnterGwBoss():(e.lastGwBoss||e.lastGwTopBoss)&&e.postEscGwBoss()}),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(BossCT.ins().postRemainTime,e.onDie),e.observe(BossCT.ins().postWorldBossEndTime,e.onBossDisappear),e}return __extends(e,t),Object.defineProperty(e.prototype,"isGwBoss",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGwTopBoss",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON_TOP},enumerable:!0,configurable:!0}),e.prototype.postEnterGwBoss=function(){this.lastGwBoss=this.isGwBoss,this.lastGwTopBoss=this.isGwTopBoss,this.isBossDie=!1,this.showView(!0)},e.prototype.postEscGwBoss=function(){this.lastGwBoss=!1,this.lastGwTopBoss=!1,this.isBossDie=!1,this.showView(!1),ViewManager.ins().close(BossEndView)},e.prototype.showView=function(t){t?(ViewManager.ins().isShow(BossBelongPanel)||ViewManager.ins().open(BossBelongPanel),ViewManager.ins().isShow(BossBloodPanel)||ViewManager.ins().open(BossBloodPanel)):(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetListPanel))},e.prototype.onCreateEntity=function(t){t&&(this.isGwBoss||this.isGwTopBoss)&&(t.type!=EntityType.Monster||t.team!=Team.Monster||t.masterHandle||(BossCT.ins().monsterID=t.configID,BossCT.ins().bossHandler=t.handle,this.showView(!0)))},e.prototype.onDie=function(){(this.isGwBoss||this.isGwTopBoss)&&(this.isRoleDie()?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin))},e.prototype.isRoleDie=function(){var t=!1;if(this.isGwTopBoss){var e=SubRoles.lookAtTar;(!e||e.infoModel.getAtt(AttributeType.atHp)<=0)&&(t=!0)}return BossCT.ins().reliveTime>0||t},e.prototype.onBossDisappear=function(){(this.isGwBoss||this.isGwTopBoss)&&(this.showView(!1),this.isBossDie=!0,ViewManager.ins().open(BossEndView))},e.prototype.canMove=function(){return!this.isBossDie},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postEnterGwBoss",null),__decorate([post()],e.prototype,"postEscGwBoss",null),e}(BaseSystem);__reflect(GwBoss.prototype,"GwBoss"),System.GwBoss=function(){return GwBoss.ins()},window.GwBoss=GwBoss;var md5=function(){function t(){}return t.hex_md5=function(t){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(t)))},t.b64_md5=function(t){return this.rstr2b64(this.rstr_md5(this.str2rstr_utf8(t)))},t.any_md5=function(t,e){return this.rstr2any(this.rstr_md5(this.str2rstr_utf8(t)),e)},t.hex_hmac_md5=function(t,e){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.b64_hmac_md5=function(t,e){return this.rstr2b64(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)))},t.any_hmac_md5=function(t,e,i){return this.rstr2any(this.rstr_hmac_md5(this.str2rstr_utf8(t),this.str2rstr_utf8(e)),i)},t.md5_vm_test=function(){return"900150983cd24fb0d6963f7d28e17f72"==this.hex_md5("abc").toLowerCase()},t.rstr_md5=function(t){return this.binl2rstr(this.binl_md5(this.rstr2binl(t),8*t.length))},t.rstr_hmac_md5=function(t,e){var i=this.rstr2binl(t);i.length>16&&(i=this.binl_md5(i,8*t.length));for(var n=Array(16),s=Array(16),o=0;16>o;o++)n[o]=909522486^i[o],s[o]=1549556828^i[o];var a=this.binl_md5(n.concat(this.rstr2binl(e)),512+8*e.length);return this.binl2rstr(this.binl_md5(s.concat(a),640))},t.rstr2hex=function(t){try{this.hexcase}catch(e){this.hexcase=0}for(var i,n=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",s="",o=0;o<t.length;o++)i=t.charCodeAt(o),s+=n.charAt(i>>>4&15)+n.charAt(15&i);return s},t.rstr2b64=function(t){try{this.b64pad}catch(e){this.b64pad=""}for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",s=t.length,o=0;s>o;o+=3)for(var a=t.charCodeAt(o)<<16|(s>o+1?t.charCodeAt(o+1)<<8:0)|(s>o+2?t.charCodeAt(o+2):0),r=0;4>r;r++)n+=8*o+6*r>8*t.length?this.b64pad:i.charAt(a>>>6*(3-r)&63);return n},t.rstr2any=function(t,e){var i,n,s,o,a,r=e.length,l=Array(Math.ceil(t.length/2));for(i=0;i<l.length;i++)l[i]=t.charCodeAt(2*i)<<8|t.charCodeAt(2*i+1);var h=Math.ceil(8*t.length/(Math.log(e.length)/Math.log(2))),u=Array(h);for(n=0;h>n;n++){for(a=Array(),o=0,i=0;i<l.length;i++)o=(o<<16)+l[i],s=Math.floor(o/r),o-=s*r,(a.length>0||s>0)&&(a[a.length]=s);u[n]=o,l=a}var p="";for(i=u.length-1;i>=0;i--)p+=e.charAt(u[i]);return p},t.str2rstr_utf8=function(t){for(var e,i,n="",s=-1;++s<t.length;)e=t.charCodeAt(s),i=s+1<t.length?t.charCodeAt(s+1):0,e>=55296&&56319>=e&&i>=56320&&57343>=i&&(e=65536+((1023&e)<<10)+(1023&i),s++),127>=e?n+=String.fromCharCode(e):2047>=e?n+=String.fromCharCode(192|e>>>6&31,128|63&e):65535>=e?n+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|63&e):2097151>=e&&(n+=String.fromCharCode(240|e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|63&e));return n},t.str2rstr_utf16le=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i),t.charCodeAt(i)>>>8&255);return e},t.str2rstr_utf16be=function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t.charCodeAt(i)>>>8&255,255&t.charCodeAt(i));return e},t.rstr2binl=function(t){for(var e=Array(t.length>>2),i=0;i<e.length;i++)e[i]=0;for(var i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<i%32;return e},t.binl2rstr=function(t){for(var e="",i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>i%32&255);return e},t.binl_md5=function(t,e){t[e>>5]|=128<<e%32,t[(e+64>>>9<<4)+14]=e;for(var i=1732584193,n=-271733879,s=-1732584194,o=271733878,a=0;a<t.length;a+=16){var r=i,l=n,h=s,u=o;i=this.md5_ff(i,n,s,o,t[a+0],7,-680876936),o=this.md5_ff(o,i,n,s,t[a+1],12,-389564586),s=this.md5_ff(s,o,i,n,t[a+2],17,606105819),n=this.md5_ff(n,s,o,i,t[a+3],22,-1044525330),i=this.md5_ff(i,n,s,o,t[a+4],7,-176418897),o=this.md5_ff(o,i,n,s,t[a+5],12,1200080426),s=this.md5_ff(s,o,i,n,t[a+6],17,-1473231341),n=this.md5_ff(n,s,o,i,t[a+7],22,-45705983),i=this.md5_ff(i,n,s,o,t[a+8],7,1770035416),o=this.md5_ff(o,i,n,s,t[a+9],12,-1958414417),s=this.md5_ff(s,o,i,n,t[a+10],17,-42063),n=this.md5_ff(n,s,o,i,t[a+11],22,-1990404162),i=this.md5_ff(i,n,s,o,t[a+12],7,1804603682),o=this.md5_ff(o,i,n,s,t[a+13],12,-40341101),s=this.md5_ff(s,o,i,n,t[a+14],17,-1502002290),n=this.md5_ff(n,s,o,i,t[a+15],22,1236535329),i=this.md5_gg(i,n,s,o,t[a+1],5,-165796510),o=this.md5_gg(o,i,n,s,t[a+6],9,-1069501632),s=this.md5_gg(s,o,i,n,t[a+11],14,643717713),n=this.md5_gg(n,s,o,i,t[a+0],20,-373897302),i=this.md5_gg(i,n,s,o,t[a+5],5,-701558691),o=this.md5_gg(o,i,n,s,t[a+10],9,38016083),s=this.md5_gg(s,o,i,n,t[a+15],14,-660478335),n=this.md5_gg(n,s,o,i,t[a+4],20,-405537848),i=this.md5_gg(i,n,s,o,t[a+9],5,568446438),o=this.md5_gg(o,i,n,s,t[a+14],9,-1019803690),s=this.md5_gg(s,o,i,n,t[a+3],14,-187363961),n=this.md5_gg(n,s,o,i,t[a+8],20,1163531501),i=this.md5_gg(i,n,s,o,t[a+13],5,-1444681467),o=this.md5_gg(o,i,n,s,t[a+2],9,-51403784),s=this.md5_gg(s,o,i,n,t[a+7],14,1735328473),n=this.md5_gg(n,s,o,i,t[a+12],20,-1926607734),i=this.md5_hh(i,n,s,o,t[a+5],4,-378558),o=this.md5_hh(o,i,n,s,t[a+8],11,-2022574463),s=this.md5_hh(s,o,i,n,t[a+11],16,1839030562),n=this.md5_hh(n,s,o,i,t[a+14],23,-35309556),i=this.md5_hh(i,n,s,o,t[a+1],4,-1530992060),o=this.md5_hh(o,i,n,s,t[a+4],11,1272893353),s=this.md5_hh(s,o,i,n,t[a+7],16,-155497632),n=this.md5_hh(n,s,o,i,t[a+10],23,-1094730640),i=this.md5_hh(i,n,s,o,t[a+13],4,681279174),o=this.md5_hh(o,i,n,s,t[a+0],11,-358537222),s=this.md5_hh(s,o,i,n,t[a+3],16,-722521979),n=this.md5_hh(n,s,o,i,t[a+6],23,76029189),i=this.md5_hh(i,n,s,o,t[a+9],4,-640364487),o=this.md5_hh(o,i,n,s,t[a+12],11,-421815835),s=this.md5_hh(s,o,i,n,t[a+15],16,530742520),n=this.md5_hh(n,s,o,i,t[a+2],23,-995338651),i=this.md5_ii(i,n,s,o,t[a+0],6,-198630844),o=this.md5_ii(o,i,n,s,t[a+7],10,1126891415),s=this.md5_ii(s,o,i,n,t[a+14],15,-1416354905),n=this.md5_ii(n,s,o,i,t[a+5],21,-57434055),i=this.md5_ii(i,n,s,o,t[a+12],6,1700485571),o=this.md5_ii(o,i,n,s,t[a+3],10,-1894986606),s=this.md5_ii(s,o,i,n,t[a+10],15,-1051523),n=this.md5_ii(n,s,o,i,t[a+1],21,-2054922799),i=this.md5_ii(i,n,s,o,t[a+8],6,1873313359),o=this.md5_ii(o,i,n,s,t[a+15],10,-30611744),s=this.md5_ii(s,o,i,n,t[a+6],15,-1560198380),n=this.md5_ii(n,s,o,i,t[a+13],21,1309151649),i=this.md5_ii(i,n,s,o,t[a+4],6,-145523070),o=this.md5_ii(o,i,n,s,t[a+11],10,-1120210379),s=this.md5_ii(s,o,i,n,t[a+2],15,718787259),n=this.md5_ii(n,s,o,i,t[a+9],21,-343485551),i=this.safe_add(i,r),n=this.safe_add(n,l),s=this.safe_add(s,h),o=this.safe_add(o,u)}return[i,n,s,o]},t.md5_cmn=function(t,e,i,n,s,o){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(e,t),this.safe_add(n,o)),s),i)},t.md5_ff=function(t,e,i,n,s,o,a){return this.md5_cmn(e&i|~e&n,t,e,s,o,a)},t.md5_gg=function(t,e,i,n,s,o,a){return this.md5_cmn(e&n|i&~n,t,e,s,o,a)},t.md5_hh=function(t,e,i,n,s,o,a){return this.md5_cmn(e^i^n,t,e,s,o,a)},t.md5_ii=function(t,e,i,n,s,o,a){return this.md5_cmn(i^(e|~n),t,e,s,o,a)},t.safe_add=function(t,e){var i=(65535&t)+(65535&e),n=(t>>16)+(e>>16)+(i>>16);return n<<16|65535&i},t.bit_rol=function(t,e){return t<<e|t>>>32-e},t.hexcase=0,t.b64pad="",t}();__reflect(md5.prototype,"md5");var NewWorldBossData=function(){function t(){this.addAttrNum=0}return t}();__reflect(NewWorldBossData.prototype,"NewWorldBossData");var NewWorldBossRankData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(WorldBossRankItemData);__reflect(NewWorldBossRankData.prototype,"NewWorldBossRankData"),window.NewWorldBossData=NewWorldBossData;var AStar=function(){function t(t){void 0===t&&(t=null),this.m_nMarkTag=0,t&&this.initFromMap(t)}return t.prototype.initFromMap=function(t){var e=0;this.m_ASMapCells?e=this.m_ASMapCells.length:this.m_ASMapCells=[],this.m_nWidth=t.numCols,this.m_nHeight=t.numRows;var i=this.m_nWidth*this.m_nHeight;i>this.m_ASMapCells.length&&(this.m_ASMapCells.length=i);for(var n=e;i>n;++n)this.m_ASMapCells[n]=new ASMapCell;var s,o,a,r;for(a=0,o=0;o<this.m_nHeight;++o)for(s=0;s<this.m_nWidth;++s)r=this.m_ASMapCells[a],r.X=s,r.Y=o,r.CanNotMove=!t.isWalkableTile(s,o),a++},t.prototype.getPatch=function(e,i,n,s){if(e==n&&i==s)return null;(0>e||e>=this.m_nWidth||0>i||i>=this.m_nHeight)&&console.log("寻路的起始位置参数无效：("+e+", "+i+")"),(0>n||n>=this.m_nWidth||0>s||s>=this.m_nHeight)&&console.log("寻路的目的位置参数无效：("+n+", "+s+")");var o=this.m_ASMapCells[s*this.m_nWidth+n];if(!o||o.CanNotMove)return null;if(this.reset(e,i),this.pathLine({x:e,y:i},{x:n,y:s}))return[new AStarNode(n,s,DirUtil.get8DirBy2Point({x:e,y:i},{x:n,y:s}))];var a=!1,r=e,l=i,h=this.m_ASMapCells[l*this.m_nWidth+r];if(!h)return null;h.GCost=0,h.LastX=-1,h.LastY=-1,h.X=r,h.Y=l,h.MarkTag=this.m_nMarkTag,h.HCost=Math.abs(n-e)+10*Math.abs(s-i);for(var u,p,c,d;;){if(r==n&&l==s){a=!0;break}for(h.State!=ASMapCell.CSCLOSE&&this.closeCell(h),u=0;8>u;++u)p=r+t.NEIGHBORPOS_X_VALUES[u],c=l+t.NEIGHBORPOS_Y_VALUES[u],0>p||p>=this.m_nWidth||0>c||c>=this.m_nHeight||(d=this.m_ASMapCells[c*this.m_nWidth+p],d.CanNotMove||(d.MarkTag!=this.m_nMarkTag||d.State==ASMapCell.CSNONE?(d.MarkTag=this.m_nMarkTag,d.LastX=r,d.LastY=l,d.btDir=u,d.GCost=h.GCost+t.AS_MOVECOST[1&u],d.HCost=Math.abs(n-p)+10*Math.abs(s-c),this.openCell(d)):d.State==ASMapCell.CSOPEN&&d.GCost>h.GCost+t.AS_MOVECOST[1&u]&&(d.LastX=r,d.LastY=l,d.btDir=u,d.GCost=h.GCost+t.AS_MOVECOST[1&u],this.reopenCell(d))));if(h=this.m_LastOpenCell,null==h)break;r=h.X,l=h.Y}if(a){for(var g=[],f=void 0;;)if(f&&h&&f.nDir==h.btDir||(f=new AStarNode(h.X,h.Y,h.btDir),g.push(f)),h=this.m_ASMapCells[h.LastY*this.m_nWidth+h.LastX],h.LastX<=0&&h.LastY<=0||h.MarkTag!=this.m_nMarkTag)break;return g}return null},t.prototype.pathLine=function(t,e){var i=t,n=0;n=e.x==t.x?1:1*(e.y-t.y)/(e.x-t.x);for(var s=e.y-n*e.x,o=e.x>t.x?1:-1,a=e.y>t.y?1:-1,r=t.x+(o>0?1:0),l=Math.abs(t.x-e.x),h=e,u=0;l>=u;u++,r+=o){if(u!=l&&(h.x=o>0?r:r-1,h.y=Math.floor(n*h.x+s)),i.y!=h.y)for(var p=i.y+a;;p+=a){if(!GameMap.checkWalkable(i.x,p))return!1;if(p==h.y)break}if(u!=l&&!GameMap.checkWalkable(h.x,h.y))return!1;i=h}return!0},t.prototype.reset=function(t,e){var i=this.m_ASMapCells[e*this.m_nWidth+t];i&&(i.LastX=0,i.LastY=0,i.HCost=0,i.GCost=0,i.FValue=0,i.State=0,i.Prev=null,i.Next=null,i.btDir=0,this.m_LastOpenCell=null,this.m_nMarkTag=this.m_nMarkTag+1)},t.prototype.closeCell=function(t){t.State==ASMapCell.CSOPEN&&(t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),t==this.m_LastOpenCell&&(this.m_LastOpenCell=t.Prev)),t.State=ASMapCell.CSCLOSE},t.prototype.openCell=function(t){t.State=ASMapCell.CSOPEN;var e=t.HCost+t.GCost;t.FValue=e;var i=this.m_LastOpenCell;if(i){for(;i.FValue<e;){if(null==i.Prev)return i.Prev=t,t.Prev=null,void(t.Next=i);i=i.Prev}t.Prev=i,i.Next?(t.Next=i.Next,i.Next.Prev=t,i.Next=t):(t.Next=null,i.Next=t,this.m_LastOpenCell=t)}else this.m_LastOpenCell=t,t.Prev=null,t.Next=null},t.prototype.reopenCell=function(t){var e=t.HCost+t.GCost;t.FValue=e;var i=t.Next;if(i&&i.FValue>e){do i=i.Next;while(i&&i.FValue>e);t.Prev&&(t.Prev.Next=t.Next),t.Next&&(t.Next.Prev=t.Prev),i?(t.Next=i,i.Prev?(t.Prev=i.Prev,i.Prev.Next=t):t.Prev=null,i.Prev=t):(t.Prev=this.m_LastOpenCell,t.Next=null,this.m_LastOpenCell.Next=t,this.m_LastOpenCell=t)}},t.RMOVECOST=14,t.DMOVECOST=10,t.AS_MOVECOST=[t.DMOVECOST,t.RMOVECOST],t.NEIGHBORPOS_X_VALUES=[0,1,1,1,0,-1,-1,-1],t.NEIGHBORPOS_Y_VALUES=[-1,-1,0,1,1,1,0,-1],t}();__reflect(AStar.prototype,"AStar");var ASMapCell=function(){function t(){}return t.CSNONE=0,t.CSOPEN=1,t.CSCLOSE=2,t}();__reflect(ASMapCell.prototype,"ASMapCell");var WorldBossItemData=function(){function t(){this.id=0,this.bossAlert=0,this.roleName="",this.guildName="",this.relieveTime=0,this.bossState=0,this.hp=0,this.people=0,this.challengeing=0,this.bossType=0,this.lastWinnerId=0,this.lastWinnerServerId=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.roleName=t.readString(),this.guildName=t.readString();var e=t.readInt();this.relieveTime=1e3*e+egret.getTimer(),this.bossState=t.readShort(),this.hp=t.readByte(),this.people=t.readShort(),this.challengeing=t.readByte()},Object.defineProperty(t.prototype,"isDie",{get:function(){return(this.relieveTime-egret.getTimer())/1e3>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"zsLevel",{get:function(){var t=GlobalConfig.WorldBossConfig[this.id];return t.zsLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canInto",{get:function(){var t=GlobalConfig.WorldBossConfig[this.id],e=t.zsLevel;if("number"==typeof e)return e>0?ZsCT.ins().lv>=e:Actor.level>=e;var i=e;return i.length>1?ZsCT.ins().lv>=i[0]&&ZsCT.ins().lv<=i[1]:void console.log("WorldBossConfig配置错误！ "+i)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canChallenge",{get:function(){return!this.isDie&&this.canInto},enumerable:!0,configurable:!0}),t}();__reflect(WorldBossItemData.prototype,"WorldBossItemData"),window.WorldBossItemData=WorldBossItemData;var AndianBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.endTime=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=WorldBossItemMain,this.dropRewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.getItemTxt,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this)},e.prototype.addDisplay=function(){var t=[];if(this.currData=null,ZsCT.ins().lv>=5&&GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay-1){var e=BossCT.BOSS_SUBTYPE_DARKBOSS,i=BossCT.ins().worldBossPlayList[e].slice();i.length||(BossCT.ins().updateBossPlayList(e),i=BossCT.ins().worldBossPlayList[e].slice()),i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:0,clickCall:this.onClickList.bind(this)}),this.currData=t[0].arr[0]}this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(BossCT.ins().postWorldBoss,this.setWin),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.listData.source=t,this.list.scrollV=0,this.list.selectedIndex=0,this.setWin()},e.prototype.sortList=function(t,e){return t.id<e.id?-1:1},e.prototype.onClickMenu=function(t){var e=this.list.dataProvider.getItemAt(t.itemIndex);e.type==BossCT.BOSS_SUBTYPE_DARKBOSS&&0==e.arr.length&&TipsCT.ins().showTips("6转即可开启未知暗殿")},e.prototype.onClickList=function(t){this.currData=t;for(var e=GlobalConfig.WorldBossConfig[this.currData.id],i=0;i<this.listData.length;i++){var n=this.listData.getItemAt(i);
e.type==n.type?n.selectIndex=n.arr.indexOf(t):(n.selectIndex=-1,this.listData.itemUpdated(n))}this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId];this.nameTxt.text=e.name+"("+t.zslook[0]+"转-"+t.zslook[t.zslook.length-1]+"转)";var i="无";""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider?this.dropRewardList.dataProvider.source=t.showReward.concat():this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward.concat()),this.playerNameTxt.text=i;var n=BossCT.ins().worldBossLeftTime[t.type],s=t.type==BossCT.BOSS_SUBTYPE_WORLDBOSS?"秘境BOSS":"未知暗殿BOSS";if(this.leftText.text=s+"剩余次数:"+n+"次",this.getItemTxt.visible=n>0||t.type==BossCT.BOSS_SUBTYPE_DARKBOSS?!1:!0,this.endTime=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),Timer.has(this.updateTime,this)||Timer.start(500,0,this.updateTime,this),i=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+i):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),t.type==BossCT.BOSS_SUBTYPE_WORLDBOSS){var o=BagCT.ins().getBagItemById(ItemConst.WORLDBOSS);this.showJuan(o)}else this.showJuan(null)}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.updateTime=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(e,5,3),0>=e&&(Timer.stop(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)}},e.prototype.showTips=function(){var t=this;if(this.currData){var e=GlobalConfig.WorldBossConfig[this.currData.id],i=BossCT.ins().worldBossLeftTime[e.type];if(i>0)return!0;if(e.type==BossCT.BOSS_SUBTYPE_DARKBOSS)return void TipsCT.ins().showTips("未知暗殿BOSS挑战次数已用完");var n="",s=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.WORLDBOSS);if(s)n="确定使用1个<font color='#FFB82A'>秘境boss</font>道具进入挑战？\n",WarnWin.show(n,function(){t.isUse=!0,BagCT.ins().registerUseItemFunc(s.configID,function(){ViewManager.ins().close(BossWin),t.joinWorldBoss()}),BagCT.ins().sendUseItem(s.configID,1)},this);else{var o=VipCT.ins().getVipCfg(Actor.vip);if(!o)return TipsCT.ins().showTips("|C:0xf3311e&T:成为"+VipCT.getVipStr()+"可购买挑战次数|"),!1;if(!o.boss2buy)return TipsCT.ins().showTips("|C:0xf3311e&T:"+VipCT.getVipStr()+"等级不足，提升"+VipCT.getVipStr()+"等级可购买挑战次数|"),!1;var a=BossCT.ins().worldChallengeTime[e.type];if(0>=i&&a>=o.boss2buy)return void TipsCT.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[e.type-1])return TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;n="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[e.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+a+"/"+o.boss2buy),WarnWin.show(n,function(){BossCT.ins().registerBuyFunc(e.type,function(){t.joinWorldBoss()}),BossCT.ins().sendBuyChallengeTimes(e.type)},this)}return!1}},e.prototype.UseToItem=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];this.isUse&&(this.isUse=!1,BossCT.ins().sendWorldBossInfo(t.type))}},e.prototype.joinWorldBoss=function(){if(this.isJoin&&this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];if(this.isJoin=!1,!FbCT.ins().checkInFB()){if(Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3)>0)return void TipsCT.ins().showTips("挑战CD中");var e=1e3*ZsCT.ins().lv+Actor.level,i=1e3*t.zsLevel+t.level;if(i>e){var n=t.zsLevel>0?t.zsLevel+"转":t.level+"级";return void TipsCT.ins().showTips("只有"+n+"才可以挑战。")}BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH):BossCT.ins().sendChallengWorldBoss(this.currData.id,t.type),ViewManager.ins().close(LimitTaskView)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(this.isJoin=!0,this.currData&&this.currData.zsLevel>ZsCT.ins().lv)return void TipsCT.ins().showTips(this.currData.zsLevel+"转解锁");if(!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips())return;this.joinWorldBoss();break;case this.getItemTxt:if(!this.showTips())return}},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_DARKBOSS)},e.prototype.close=function(){this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)},e}(BaseView);__reflect(AndianBossPanel.prototype,"AndianBossPanel"),window.AndianBossPanel=AndianBossPanel;var BossBloodPanel=function(t){function e(){var e=t.call(this)||this;return e._curMonsterID=0,e.curValue=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossBloodSkin",this.bloodBar.slideDuration=0,this.grayImg.source="bosshp2",e.GRAYIMG_WIDTH=this.grayImg.width,this.hudunbloodBar.value=100,this.hudunbloodBar.maximum=100,this.eGuildInfo.visible=!1,this.observe(CityCC.ins().postHudunPoint,this.delayHuDunChange),this.observe(BossCT.ins().postShieldPer,this.delayHuDunChange),this.observe(DevildomSys.ins().postHudun,this.delayHuDunChange),this.observe(KFSmyjBossCT.ins().postHudun,this.delayHuDunChange),this.observe(CrossGuildBattleCT.ins().postBossInfo,this.updateGuildBossInfo),this.addTouchEvent(this.tipBtn0,this.onTap),this.eGuildInfo.visible=!1,this.hudun.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.myTxt.text="自己：",this.dropDown.setEnabled(!1),this.tipBtn0.visible=this.checkShowSeeAwardBtn();var i=BossCT.ins().rank.concat(),n=i.length;if(n){n>10&&(n=10);var s=i.slice(1,n);this.dropDown.setData(s),this.dropDown.setLabel(i[0].name)}else this.dropDown.setData([]),this.dropDown.setLabel("");n=i.length;for(var o=Actor.actorID,a=0;n>a;a++)if(i[a].id==o){this.myTxt.text="自己:"+CommonUtils.overLength(i[a].value);break}this.huDunChange(),this.checkIsShowFbInfo(),this.showCurRewards();var r=GlobalConfig.MonstersConfig[BossCT.ins().monsterID];r&&(this.updateBaseInfo(),this.guildFBInfo(r)),GameMap.fbType==FbCT.FB_TYPE_SMYJ?this.belong.visible=KFSmyjBossCT.ins().isShowBelong():this.belong.visible=!1},e.prototype.changeBoss=function(){var t=GlobalConfig.MonstersConfig[BossCT.ins().monsterID];t&&(this.updateBaseInfo(),this.guildFBInfo(t))},e.prototype.checkShowSeeAwardBtn=function(){return CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||GameMap.fbType==FbCT.FB_TYPE_HIDE_BOSS||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle||XuanWuCT.ins().isXuanWu||GameMap.fbType==FbCT.FB_TYPE_37BOSS},e.prototype.updateBaseInfo=function(){if(this._curMonsterID!=BossCT.ins().monsterID){this._curMonsterID=BossCT.ins().monsterID;var t,e=GlobalConfig.MonstersConfig[BossCT.ins().monsterID];GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN&&SkyLevelModel.ins().cruLevel&&(t=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel].layer);var i=t&&GameMap.fbType!=FbCT.FB_TYPE_HUN_SHOU?t+"层守将·":"";if(GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS){var n=TextFlowMaker.generateTextFlow1(e.name),s=n[n.length-1].text;this.nameTxt.text=""+i+s+"("+e.level+"级)"}else this.nameTxt.text=""+i+e.name+"("+e.level+"级)";this.head.source="monhead"+e.head+"_png",(GameMap.fbType==FbCT.FB_TYPE_KF_BOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS2||GameMap.fbType==FbCT.FB_TYPE_HIDE_BOSS||GameMap.fbType==FbCT.FB_TYPE_XUANWU||GameMap.fbType==FbCT.FB_TYPE_37BOSS||GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.fbType==FbCT.FB_TYPE_Legend||GameMap.fbType==FbCT.FB_TYPE_SMYJ)&&(BossCT.ins().currBossConfigID=BossCT.ins().monsterID)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.closeShowInfoPanel(),this._curMonsterID=0,this.grayImg&&egret.Tween.removeTweens(this.grayImg)},e.prototype.guildFBInfo=function(t){if(GuildWar.ins().getModel().checkinAppoint(1)){var e=GuildWar.ins().getModel().doorEndtime;this.bloodBar.value=e,this.bloodBar.maximum=120,this.barGroup.y=101,this.visible=e>0,this.bloodBar.labelFunction=function(){return Math.floor(100*e/120)+"%"},this.curValue=Math.floor(this.bloodBar.value/120*100),this.tweenBlood()}else this.myTxt.visible=this.dropDown.visible=!1,this.bloodBar.value=void 0==BossCT.ins().hp?t.hp:BossCT.ins().hp,this.bloodBar.maximum=t.hp,this.barGroup.y=1==CrossGuildBattleCT.ins().getCurMapLevel()||3==CrossGuildBattleCT.ins().getCurMapLevel()?101:20,this.visible=this.bloodBar.value>0,this.curValue=Math.floor(this.bloodBar.value/t.hp*100),this.tweenBlood()},e.prototype.tweenBlood=function(){var t=this,i=this.curValue*e.GRAYIMG_WIDTH/100;if(egret.Tween.removeTweens(this.grayImg),!(3>i)){var n=egret.Tween.get(this.grayImg);n.to({width:i-3},1e3).call(function(){0>=i&&(t.grayImg.width=0,egret.Tween.removeTweens(t.grayImg))})}},e.prototype.delayHuDunChange=function(){Timer.has(this.huDunChange,this)||Timer.start(60,1,this.huDunChange,this)},e.prototype.huDunChange=function(){if(this.proLab.visible=!0,CityCC.ins().isCity)this.proLab.visible=!1,CityCC.ins().hudun&&CityCC.ins().hudun>0?(this.hudun.visible=!0,this.hudunbloodBar.value=CityCC.ins().hudun,this.hudunbloodBar.maximum=CityCC.ins().huDunMax):this.hudun.visible=!1;else if(DevildomSys.ins().isDevildomBattle)this.proLab.visible=!1,DevildomSys.ins().hudun&&DevildomSys.ins().hudun>0?(this.hudun.visible=!0,this.hudunbloodBar.value=DevildomSys.ins().hudun,this.hudunbloodBar.maximum=DevildomSys.ins().hudunMax):this.hudun.visible=!1;else if(GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss||XuanWuCT.ins().isXuanWu||GameMap.fbType==FbCT.FB_TYPE_37BOSS||GameMap.fbType==FbCT.FB_TYPE_GUILDFB)this.proLab.visible=!1,BossCT.ins().shieldType?BossCT.ins().curShield>0&&(this.hudun.visible=!0,Timer.has(this.setTimeShieldChange,this)||(Timer.start(1e3,0,this.setTimeShieldChange,this),this.setTimeShieldChange())):this.setHpShieldChange();else if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){this.proLab.visible=!1;var t=KFSmyjBossCT.ins(),e=GlobalConfig.DevilRuinsBossConfig[t.fbKind];t.bossIndex&&(e&&e[t.bossIndex]&&e[t.bossIndex].bossId&&e[t.bossIndex].bossId==BossCT.ins().monsterID&&1==t.hudunType?1==t.hudunType?Timer.has(this.setSmyjHpTime,this)||(Timer.start(1e3,0,this.setSmyjHpTime,this),this.setSmyjHpTime()):0==t.hudunType&&t.hunHp>0?(this.hudun.visible=!0,this.hudunbloodBar.value=t.hunHp,this.hudunbloodBar.maximum=t.maxHp):this.hudun.visible=!1:this.hudun.visible=!1)}else this.hudun.visible=!1},e.prototype.setSmyjHpTime=function(){var t=KFSmyjBossCT.ins();this.hudunbloodBar.value=t.hunHp,this.hudunbloodBar.maximum=t.maxHp,t.hunHp>0?this.hudun.visible=!0:(Timer.stop(this.setTimeShieldChange,this),this.hudun.visible=!1),t.hunHp--},e.prototype.setHpShieldChange=function(){BossCT.ins().curShield&&BossCT.ins().curShield>0?(this.hudun.visible=!0,this.hudunbloodBar.value=Math.ceil(BossCT.ins().curShield/BossCT.ins().totalShield*100)):this.hudun.visible=!1},e.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=BossCT.ins().curShield,this.hudunbloodBar.maximum=BossCT.ins().totalShield,BossCT.ins().curShield>0?this.hudun.visible=!0:(Timer.stop(this.setTimeShieldChange,this),this.hudun.visible=!1),BossCT.ins().curShield--},e.prototype.onTap=function(t){switch(t.target){case this.tipBtn0:CityCC.ins().isCity?ViewManager.ins().open(CityBossJiangliTipsWin):GameMap.fbType==FbCT.FB_TYPE_GUARD_WEAPON?ViewManager.ins().open(GuardRewardWin):DevildomSys.ins().isDevildomBattle?DevildomSys.ins().isDevildomBOss(this._curMonsterID)?ViewManager.ins().open(DevilTabletWin):ViewManager.ins().open(DevildomBossAwardWin):ViewManager.ins().open(PublicBossJiangliTipWin)}},e.prototype.checkIsShowFbInfo=function(){switch(GameMap.fbType){case FbCT.FB_TYPE_TIAOZHAN:case FbCT.FB_TYPE_HUN_SHOU:case FbCT.FB_TYPE_THUNDER:ViewManager.ins().open(ChallengeInfoPanel)}},e.prototype.closeShowInfoPanel=function(){ViewManager.ins().isShow(ChallengeInfoPanel)&&ViewManager.ins().close(ChallengeInfoPanel)},e.prototype.showCurRewards=function(){if(GameMap.fbType!=FbCT.FB_TYPE_TIAOZHAN&&GameMap.fbType!=FbCT.FB_TYPE_HUN_SHOU&&GameMap.fbType!=FbCT.FB_TYPE_THUNDER)return void(this.currewards.visible=!1);this.currewards.visible=!0;var t={rewards:[]};if(GameMap.fbType==FbCT.FB_TYPE_HUN_SHOU){var e=Hungu.ins().hunShouFBPassID>=Object.keys(GlobalConfig.FsFbConfig).length?Hungu.ins().hunShouFBPassID:Hungu.ins().hunShouFBPassID+1,i=GlobalConfig.FsFbConfig[e];t.rewards=i.award}else if(GameMap.fbType==FbCT.FB_TYPE_THUNDER){if(!GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId])return;t.rewards=GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId].reward}else{var n=SkyLevelModel.ins(),s=GlobalConfig.FbChallengeConfig[n.cruLevel];s&&(t.rewards=s.reward)}this.currewards.data=t},e.prototype.updateGuildBossInfo=function(){var t=CrossGuildBattleCT.ins().bossInfo;return!t||t.isDie?(this.eGuildInfo.visible=!1,void(Timer.has(this.updateTimerCB,this)&&Timer.stop(this.updateTimerCB,this))):(this.eGuildInfo.visible=!0,void(Timer.has(this.updateTimerCB,this)||Timer.start(1e3,0,this.updateTimerCB,this)))},e.prototype.updateTimerCB=function(){var t=CrossGuildBattleCT.ins().bossInfo;if(!t||t.isDie)return void(this.sTipsL=this.sTipsR=TextFlowMaker.generateTextFlow(null));var e=0;0!=t.belongGuild&&(e=0==t.belongStartTime||GameServer.serverTime-t.belongStartTime<0?0:Math.floor((GameServer.serverTime-t.belongStartTime)/1e3)),""!=t.guildNameL&&(this.sTipsL=TextFlowMaker.generateTextFlow("|C:0x"+(e>0&&t.belongGuild==t.guildIdL?"21AD1A":"F3D00B")+"&T:"+t.guildNameL+" "+((t.guildIdL==t.belongGuild?e:0)+t.timeL)+"秒|")),""!=t.guildNameR&&(this.sTipsR=TextFlowMaker.generateTextFlow("|C:0x"+(e>0&&t.belongGuild==t.guildIdR?"21AD1A":"F3D00B")+"&T:"+t.guildNameR+" "+((t.guildIdR==t.belongGuild?e:0)+t.timeR)+"秒|"))},e.GRAYIMG_WIDTH=0,e}(BaseEuiView);__reflect(BossBloodPanel.prototype,"BossBloodPanel"),ViewManager.ins().reg(BossBloodPanel,LayerManager.Game_Main),window.BossBloodPanel=BossBloodPanel;var BossEndView=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossEndSkin",e}return __extends(e,t),e.prototype.open=function(){this.observe(BossCT.ins().postWorldBossEndTime,this.worldBossEnd),this.worldBossEnd()},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.worldBossEnd=function(){var t=this;this.winnerName.text="最终归属者是："+BossCT.ins().winner;var e=Math.ceil((BossCT.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),Timer.stopAll(this),Timer.start(1e3,e,function(){e--,t.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),0==e&&FbCT.ins().sendExitFb()},this)},e}(BaseEuiView);__reflect(BossEndView.prototype,"BossEndView"),ViewManager.ins().reg(BossEndView,LayerManager.Main_View),window.BossEndView=BossEndView;var BossItem=function(t){function e(){var e=t.call(this)||this;return e.isStartTime=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.dataChanged=function(){var t,e,i="",n=this.data,s=GlobalConfig.WorldBossConfig[n.id];if(this.list.itemRenderer=this.list.itemRenderer||ItemBase,this.config=s,this.list.dataProvider){var o=this.list.dataProvider;o.source=s.showReward.concat()}else this.list.dataProvider=new eui.ArrayCollection(s.showReward.concat());var a=n.isDie;if(this.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.infoTxt0.touchEnabled=!0,t=BossCT.isCanChallenge(s),s.samsaraLv>0?(i=s.showName+"开启",this.lunhuiBg.visible=!0,this.normalBg.visible=!1):(this.lunhuiBg.visible=!1,this.normalBg.visible=!0,i=s.zsLevel>0?s.zsLevel+"转开启":s.level+"级开启"),this.levelRequire.text=i,this.bar.value=n.hp,this.bar.maximum=100,e=GlobalConfig.MonstersConfig[s.bossId],this.timeTxt.visible=a,this.timeTxt.visible&&(this.updateTime(),this.isStartTime||(Timer.start(100,0,this.updateTime,this),this.isStartTime=!0)),this.challengeBtn.visible=!a,s.type==BossCT.BOSS_SUBTYPE_QMBOSS?this.challengeBtn.name="publicChallenge":s.type==BossCT.BOSS_SUBTYPE_SHENYU&&(this.challengeBtn.name="shenyuChallenge"),this.challengeBtn.visible){var r=(BossCT.ins().cdTime-egret.getTimer())/1e3;n.challengeing&&r>0?(this.challengeBtn.enabled=!1,this.challengeBtn.touchEnabled=!1,this.updateCDTime(),Timer.start(100,0,this.updateCDTime,this)):(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,Timer.stop(this.updateCDTime,this))}if(this.barBg.visible=this.bar.visible=!0,e){this.head.source="monhead"+e.head+"_png";var l=void 0;l=s.samsaraLv>0?s.showName:s.zsLevel>0?s.zsLevel+"转":s.level+"级",this.nameTxt0.text=l,this.nameTxt.text=""+e.name}this.needLv.visible=!t,this.challengeBtn.visible=this.challengeBtn.visible&&t},e.prototype.updateCDTime=function(){var t=(BossCT.ins().cdTime-egret.getTimer())/1e3;this.challengeBtn.label="冷却中（"+t.toFixed(0)+"）",0>=t&&(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,Timer.stop(this.updateCDTime,this))},e.prototype.updateTime=function(){var t=this.data,e=t.relieveTime-egret.getTimer();this.timeTxt.text=DateUtils.getFormatBySecond(Math.floor(e/1e3),1)+"后重生",0>=e&&(this.timeTxt.visible=!1,BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_QMBOSS),Timer.stop(this.updateTime,this),this.isStartTime=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boxBtn:WarnWin.show(this.config.rewardsDesc,null,this,null,null,"sure")}},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),Timer.stopAll(this),this.isStartTime=!1},e}(BaseItemRender);__reflect(BossItem.prototype,"BossItem"),window.BossItem=BossItem;var BossRevelryDayItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossrevelydaySkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.dayImg.source="sd_day"+(this.itemIndex+1),this.endImg.visible=GameServer.serverOpenDay>this.itemIndex,this.readyImg.visible=GameServer.serverOpenDay<this.itemIndex)},e}(BaseItemRender);__reflect(BossRevelryDayItem.prototype,"BossRevelryDayItem"),window.BossRevelryDayItem=BossRevelryDayItem;var BossRevelryPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossRevelrySkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.itemRenderer=BossRevelryDayItem,this.rewardList.itemRenderer=ItemBase,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.addTouchEvent(this.challengeBtn,this.onChallenge),this.initView()},e.prototype.close=function(){this.removeObserve()},e.prototype.initView=function(){this.cfgs=[];for(var t in GlobalConfig.CityBossConfig){var e=GlobalConfig.CityBossConfig[t];e.killBossId>100&&e.killBossId<108&&this.cfgs.push(e)}this.list.dataProvider=new eui.ArrayCollection(this.cfgs);var i=GameServer.serverOpenDay;this.list.selectedIndex=i,this.list.validateNow(),this.list.scrollH=95*i,this.updateView()},e.prototype.updateView=function(){var t=this.list.selectedIndex,e=this.cfgs[t];if(e){var i=GlobalConfig.MonstersConfig[e.bossId];if(this.rewardList.dataProvider=new eui.ArrayCollection(e.showReward),this.bossImage||(this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=160,this.bossGroup.addChild(this.bossImage),this.bossImage.playFile(RES_DIR_MONSTER+(i.avatar+"_3s"),-1)),this.challengeBtn.visible=!1,this.canChallengeTxt.visible=!0,GameServer.serverOpenDay==t)switch(CityCC.ins().bossState){case 1:Timer.stop(this.runTime,this),this.challengeBtn.visible=!0,this.canChallengeTxt.visible=!1;break;case 0:Timer.stop(this.runTime,this),this.canChallengeTxt.text="今日已结束";break;case 2:var n=new Date(GameServer.serverTime);n.setHours(21,0,0),this.startTime=n.getTime(),this.runTime(),Timer.has(this.runTime,this)||Timer.start(1e3,0,this.runTime,this)}else GameServer.serverOpenDay>t?(Timer.stop(this.runTime,this),this.canChallengeTxt.text="已结束"):(Timer.stop(this.runTime,this),this.canChallengeTxt.text="开服第"+(t+1)+"天开启")}},e.prototype.onListChange=function(t){this.updateView()},e.prototype.runTime=function(){if(2==CityCC.ins().bossState){var t=Math.max(Math.floor((this.startTime-GameServer.serverTime)/1e3),0);this.canChallengeTxt.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_12)+"后刷新"}else this.updateView()},e.prototype.onChallenge=function(t){CityCC.ins().checkRevelryOpen()},e}(BaseView);__reflect(BossRevelryPanel.prototype,"BossRevelryPanel"),window.BossRevelryPanel=BossRevelryPanel;var BossRewardsItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.rewards;if(this.experience.data=t[0],this.randomRune.data=t[1],this.runeCream.data=t[2],GameMap.fbType==FbCT.FB_TYPE_THUNDER){for(var e=GlobalConfig.LeitingEquipBaseConf.towerUnlock,i=void 0,n=0;n<e.length;n++)if(e[n][0]>=ThunderCT.ins().curLayerId){i=e[n];break}if(i){var s=i[1];this.target.visible=!0,this.labelGroup.visible=!0,this.target.setCount("");var o=this.target.getItemIcon();o.imgJob.visible=!1,this.target.setName("|C:0xE100ED&T:"+(ThunderCT.firstName+ThunderCT.equipNames[s]+"装备位")),o.imgIcon.source="lt"+(s>9?s:"0"+s),this.leftlabel.text=i[0]+"层解锁"}else this.target.visible=!1,this.labelGroup.visible=!1}else{var a=SkyLevelModel.ins(),r=a.getNextOpenLevel();if(r){this.target.data||(this.target.data=r.showIcon);var l=GlobalConfig.FbChallengeConfig[a.cruLevel],h=GlobalConfig.ItemConfig[r.showIcon],u=ItemUtil.getQuality(h),p="层解锁";u==FBChallengePanel.RunType&&(p="层获得"),l.group==r.group?this.leftlabel.text=""+r.layer+p:this.leftlabel.text="再闯"+(r.id-l.id)+p}this.labelGroup.visible=this.target.visible=r&&GameMap.fbType!=FbCT.FB_TYPE_HUN_SHOU}},e}(BaseItemRender);__reflect(BossRewardsItem.prototype,"BossRewardsItem"),window.BossRewardsItem=BossRewardsItem;var BossTargetInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossTargetSkin",e}return __extends(e,t),e.prototype.refushTargetInfo=function(t){this.model=t.infoModel,this.bloodBar.maximum=this.model.getAtt(AttributeType.atMaxHp),this.bloodBar.value=t.getHP(),this.model.team==Team.My?this.nameLabel.text=Actor.myName:this.nameLabel.text=this.model.name+"",this.head.source="yuanhead"+this.model.job+this.model.sex},e}(BaseView);__reflect(BossTargetInfo.prototype,"BossTargetInfo"),window.BossTargetInfo=BossTargetInfo;var HomeBossGroupItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){},e}(BaseItemRender);__reflect(HomeBossGroupItem.prototype,"HomeBossGroupItem"),window.HomeBossGroupItem=HomeBossGroupItem;var HomeBossItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t,e,i="",n="",s=this.data,o=GlobalConfig.WorldBossConfig[s.id];this.list.itemRenderer=ItemBase,this.config=o,this.list.dataProvider=new eui.ArrayCollection(o.showReward);var a=2==s.bossState;this.boxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.infoTxt0.touchEnabled=!0;var r;for(var l in GlobalConfig.BossHomeConfig)if(-1!=GlobalConfig.BossHomeConfig[l].boss.lastIndexOf(s.id)){r=GlobalConfig.BossHomeConfig[l];break}if(Actor.vip>=r.vip?o.zsLevel>0?(t=ZsCT.ins().lv>=o.zsLevel,n=t?"23CA23":"f15a25",i=o.zsLevel+"转开启"):(t=Actor.level>=o.level,n=t?"23CA23":"f15a25",i=o.level+"级开启"):(t=!1,n=t?"23CA23":"f15a25",i=VipCT.getVipStr(r.vip,!0)+"开放"),a&&(i="已击杀"),this.levelRequire.text=i,this.bar.value=s.hp,this.bar.maximum=100,e=GlobalConfig.MonstersConfig[o.bossId],this.challengeBtn.visible=!a,this.challengeBtn.name="homeChallenge",this.challengeBtn.visible){var h=(BossCT.ins().cdTime-egret.getTimer())/1e3;s.challengeing&&h>0?(this.challengeBtn.enabled=!1,this.challengeBtn.touchEnabled=!1,this.updateCDTime(),Timer.start(100,0,this.updateCDTime,this)):(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,Timer.stop(this.updateCDTime,this))}if(this.barBg.visible=this.bar.visible=!0,e){this.head.source="monhead"+e.head+"_png";var u=o.zsLevel>0?o.zsLevel+"转":o.level+"级";this.nameTxt0.text=u,this.nameTxt.text=""+e.name}this.challengeBtn.visible=this.challengeBtn.visible&&t,this.needLv.visible=!this.challengeBtn.visible},e.prototype.updateCDTime=function(){var t=(BossCT.ins().cdTime-egret.getTimer())/1e3;this.challengeBtn.label="冷却中（"+t.toFixed(0)+"）",0>=t&&(this.challengeBtn.label="挑战",this.challengeBtn.enabled=!0,this.challengeBtn.touchEnabled=!0,Timer.stop(this.updateCDTime,this))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.boxBtn:WarnWin.show(this.config.rewardsDesc,null,this,null,null,"sure")}},e}(BaseItemRender);__reflect(HomeBossItem.prototype,"HomeBossItem"),window.HomeBossItem=HomeBossItem;var huodongBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastSelect=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.addDisplay=function(){this.setOpenIndex(this.select?this.select[0]:0),this.updateRedPoint(),this.observe(BossCT.ins().postWorldBoss,this.updateRedPoint)},e.prototype.removeDisplay=function(){delete this.select},e.prototype.updateRedPoint=function(){this.redPoint0.visible=CityCC.ins().cityBossId&&CityCC.ins().getCityBossConfig(CityCC.ins().cityBossId)&&GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(28),this.redPoint1.visible=BossCT.ins().newWorldBossData.isOpen&&BossCT.ins().newWorldBossData.startTime<GameServer.serverTime},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){this.lastSelect=t,this.tab.selectedIndex=this.lastSelect,this.viewStack.selectedIndex=this.lastSelect},e.prototype.checkIsOpen=function(t){var e=t.target.selectedIndex;return 0!=e||OpenSystem.ins().checkSysOpen(28)?void 0:(TipsCT.ins().showTips("怪物攻城未开启"),t.$cancelable=!0,void t.preventDefault())},e}(BaseView);__reflect(huodongBossPanel.prototype,"huodongBossPanel"),window.huodongBossPanel=huodongBossPanel;var KuafuBossPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.setOpenIndex(this.select?this.select[0]:0),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(KFBossRedpoint.ins().postRedPoint,this.updateRedPoint),this.tab.validateNow(),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.tab.getChildAt(0)&&this.tab.getChildAt(0).redPoint0&&(this.tab.getChildAt(0).redPoint0.visible=KFBossRedpoint.ins().redpointGroup1),this.tab.numChildren>3&&this.tab.getChildAt(3)&&this.tab.getChildAt(3).redPoint0&&(this.tab.getChildAt(3).redPoint0.visible=KFBossRedpoint.ins().redpointGroup2)},e.prototype.setOpenIndex=function(t){this.tab.selectedIndex=t,this.viewStack.selectedIndex=t,BossCT.ins().KFPage=t,e.changeIndex(t)},e.changeIndex=function(t){return t},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.checkIsOpen=function(t){if(1==t.target.selectedIndex){var e=GlobalConfig.CrossBossBase;if(ZsCT.ins().lv<e.txmyOpen[0]||GameServer.serverOpenDay+1<e.txmyOpen[1])return TipsCT.ins().showTips("开服"+e.txmyOpen[1]+"天且角色"+e.txmyOpen[0]+"转开启"),t.$cancelable=!0,void t.preventDefault()}if(2==t.target.selectedIndex){var e=GlobalConfig.SpiritSystemBaseConfig;if(GameServer.serverOpenDay+1<e.openserverday||ZsCT.ins().lv<e.zslv)return TipsCT.ins().showTips("开服"+e.openserverday+"天且角色"+e.zslv+"转开启"),t.$cancelable=!0,void t.preventDefault();if(!SpiritBossCT.ins().sfData.length)return TipsCT.ins().showTips("跨服未开启"),t.$cancelable=!0,void t.preventDefault()}if(3==t.target.selectedIndex){var e=GlobalConfig.CrossBossBase;if(ZsCT.ins().lv<e.symdOpen[0]||GameServer.serverOpenDay+1<e.symdOpen[1])return TipsCT.ins().showTips("开服"+e.symdOpen[1]+"天且角色"+e.symdOpen[0]+"转开启"),t.$cancelable=!0,void t.preventDefault()}if(4==t.target.selectedIndex){var e=GlobalConfig.DevilRuinsBase;if(ZsCT.ins().lv<e.limitZsLv||GameServer.serverOpenDay+1<e.openDay)return TipsCT.ins().showTips("开服"+e.openDay+"天且角色"+e.limitZsLv+"转开启"),t.$cancelable=!0,void t.preventDefault()}},__decorate([post()],e,"changeIndex",null),e}(BaseView);__reflect(KuafuBossPanel.prototype,"KuafuBossPanel"),window.KuafuBossPanel=KuafuBossPanel;var PersonalBossItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="personalBossItemSkin",e.nameTxt.textColor=11645079,e.eRed.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.MonstersConfig[t.bossId];this.bg.source="yeqian4";var i;if(this.bg1.visible=!1,t.monthcard){i="周卡特权",this.eRed.visible=FbCT.ckeckMonthCardBoss(t.id);var n=0==FbCT.ins().fbFirstLogs[t.id]||Recharge.ins().monthDay>0;this.bg1.visible=!n,this.bg.source=n?"monthbossyeqian":"dark_monthbossyeqian"}else if(t.specialCard){i="至尊特权",this.eRed.visible=FbCT.ckeckSpecialCardBoss(t.id);var n=Recharge.ins().franchise>0;this.bg1.visible=!n,this.bg.source=n?"monthbossyeqian":"dark_monthbossyeqian"}else i=t.privilege?"贵族":t.zsLevel>0?t.zsLevel+"转":t.levelLimit+"级";this.nameTxt.text=e.name+"·"+i;var s=1e3*ZsCT.ins().lv+Actor.level,o=FbCT.ins().getFbDataById(this.data.id),a=o.getPlayCount()<=0,r=1e3*this.data.zsLevel+this.data.levelLimit;a?this.notOpenImg.visible=!1:t.monthcard?this.notOpenImg.visible=!1:t.privilege?this.notOpenImg.visible=2!=Recharge.ins().forevetCard:t.specialCard?this.notOpenImg.visible=!1:this.notOpenImg.visible=r>s}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.bg0.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(PersonalBossItem.prototype,"PersonalBossItem"),window.PersonalBossItem=PersonalBossItem;var PublicBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.tipTxt.textFlow=TextFlowMaker.generateTextFlow("挑战次数不足，首充开启BOSS之家，|C:0xf3311e&T:BOSS不限次数无限刷!|"),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){this.type=BossCT.BOSS_SUBTYPE_QMBOSS,this.observe(BossCT.ins().postWorldBoss,this.updateList),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.observe(BagCT.ins().postItemDel,this.UseToItem),this.setData(),Timer.start(5e3,0,this.getNewInfo,this)},e.prototype.removeDisplay=function(){delete this.select,this.vipGroup&&egret.Tween.removeTweens(this.vipGroup),Timer.stopAll(this),this.isStartTime=!1},e.prototype.getNewInfo=function(){BossCT.ins().sendWorldBossInfo(this.type)},e.prototype.showTips=function(){var t=this,e=BossCT.ins().worldBossLeftTime[this.type];if(e>0)return!0;var i="",n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.PUBLICBOSS);if(n)this.isUse=!0,BagCT.ins().sendUseItem(n.configID,1);else{var s=VipCT.ins().getVipCfg(Actor.vip);if(!s)return TipsCT.ins().showTips("|C:0xf3311e&T:成为"+VipCT.getVipStr()+"可购买挑战次数|"),!1;if(!s.boss1buy)return TipsCT.ins().showTips("|C:0xf3311e&T:"+VipCT.getVipStr()+"等级不足，提升"+VipCT.getVipStr()+"等级可购买挑战次数|"),!1;
var o=BossCT.ins().worldChallengeTime[this.type];if(0>=e&&o>=s.boss1buy)return void TipsCT.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1])return TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;i="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[this.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+o+"/"+s.boss1buy),WarnWin.show(i,function(){BossCT.ins().registerBuyFunc(t.type,function(){var e=t.config;ViewManager.ins().close(BossWin),e&&!t.joinPulbicChallenge(e)}),BossCT.ins().sendBuyChallengeTimes(t.type)},this)}return!1},e.prototype.UseToItem=function(){this.isUse&&BossCT.ins().sendWorldBossInfo(this.type)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"publicChallenge":if(this.isJoin=!0,this.config=e,this.eId=t.target.parent.data.id,!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips())return;if(!this.joinPulbicChallenge(e))return}ViewManager.ins().close(LimitTaskView)}}},e.prototype.joinPulbicChallenge=function(t){var e=this;if(!t)return!1;if(!this.isJoin)return!1;if(this.isJoin=!1,FbCT.ins().checkInFB())return!1;if(t.zsLevel<=ZsCT.ins().lv&&t.level<=Actor.level)if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);else{var i=Math.ceil((BossCT.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(i>0)return TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+i+"秒后可进行挑战|"),!1;RexueDideCT.checkEnoughTimeById(RexueID.PublicBoss,BossCT.ins().worldBossLeftTime[this.type],function(){BossCT.ins().sendChallengWorldBoss(e.eId,e.type)})}else TipsCT.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!0},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.restoreTime-egret.getTimer();0>=t?(Timer.stop(this.updateTime,this),this.isStartTime=!1,BossCT.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1]&&(this.timeTxt.visible=!1)):this.timeTxt.visible||(this.timeTxt.visible=!0);var e=DateUtils.getFormatBySecond(Math.floor(t/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text="（"+e+"恢复）"}},e.prototype.setData=function(){var t=BossCT.ins().worldBossLeftTime[this.type],e=BagCT.ins().getBagItemById(ItemConst.PUBLICBOSS);this.buyBtn.visible=t>0||e?!1:!0,this.showJuan(e),this.challengeCountTxt.text=t+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1],0>=t&&Actor.vip<=0?(this.vipGroup.visible=!0,egret.Tween.get(this.vipGroup,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)):(this.vipGroup.visible=!1,egret.Tween.removeTweens(this.vipGroup)),this.isStartTime||(Timer.start(5e3,0,this.updateTime,this),this.restoreTime=BossCT.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime()),this.initList()},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.initList=function(){for(var t=BossCT.ins().worldInfoList[this.type].slice(),e=[],i=[],n=[],s=[],o=[],a=1e3*ZsCT.ins().lv+Actor.level,r=0;r<t.length;r++){var l=(t[r].relieveTime-egret.getTimer())/1e3>0||t[r].hp<=0,h=BossCT.ins().getBossRemindByIndex(t[r].id),u=GlobalConfig.WorldBossConfig[t[r].id];if(u){var p=1e3*u.zsLevel+u.level,c=void 0;if(u.samsaraLv){if(c=Actor.samsaraLv>=u.samsaraLv,!SamsaraModel.ins().isOpen())continue}else c=a>=p;c?h?l?i.push(t[r]):e.push(t[r]):l?s.push(t[r]):n.push(t[r]):o.push(t[r])}}e.sort(this.compareFn),i.sort(this.compareFn),n.sort(this.compareFn),s.sort(this.compareFn),o.sort(this.compareFn);var d=e.concat(i,n,o,s);this.listData=new eui.ArrayCollection(d),this.list.dataProvider=this.listData,this.refushBarList(d)},e.prototype.updateList=function(){if(this.isUse&&BossCT.ins().worldBossLeftTime[this.type]>0)return this.isUse=!1,ViewManager.ins().close(this),void this.joinPulbicChallenge(this.config);for(var t=0;t<this.listData.length;t++)this.listData.itemUpdated(this.listData.getItemAt(t))},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],n=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<n.zsLevel?1:i.zsLevel>n.zsLevel?-1:Algorithm.sortDesc(i.level,n.level)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)},e.prototype.refushBarList=function(t){if(!this.select)return void(this.bossScroller.viewport.scrollV=0);for(var e=0;e<t.length;e++){var i=GlobalConfig.WorldBossConfig[t[e].id];if(i&&this.select==i.bossId){this.bossScroller.viewport.validateNow(),this.bossScroller.viewport.scrollV=138*e,this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height&&(this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height);break}}},e}(BaseView);__reflect(PublicBossPanel.prototype,"PublicBossPanel"),window.PublicBossPanel=PublicBossPanel;var ShenyuBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){this.type=BossCT.BOSS_SUBTYPE_SHENYU,this.observe(BossCT.ins().postWorldBoss,this.updateList),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.setData(),Timer.start(2e3,0,this.getNewInfo,this)},e.prototype.removeDisplay=function(){Timer.stopAll(this),this.isStartTime=!1},e.prototype.getNewInfo=function(){BossCT.ins().sendWorldBossInfo(this.type)},e.prototype.showTips=function(){var t=BossCT.ins().worldBossLeftTime[this.type];if(t>0)return!0;var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.SHENYUBOSS);return e?(this.isUse=!0,BagCT.ins().sendUseItem(e.configID,1),!1):(TipsCT.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战"),!1)},e.prototype.UseToItem=function(){this.isUse&&BossCT.ins().sendWorldBossInfo(this.type)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.buyBtn:if(!this.showTips())return;break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"shenyuChallenge":if(this.isJoin=!0,this.config=e,this.eId=t.target.parent.data.id,!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips())return;if(!this.joinPulbicChallenge(e))return}ViewManager.ins().close(LimitTaskView)}}},e.prototype.joinPulbicChallenge=function(t){var e=this;if(!t)return!1;if(!this.isJoin)return!1;if(this.isJoin=!1,FbCT.ins().checkInFB())return!1;if(t.zsLevel<=ZsCT.ins().lv&&t.level<=Actor.level)if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);else{var i=Math.ceil((BossCT.ins().worldBossCd[this.type]-egret.getTimer())/1e3);if(i>0)return TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+i+"秒后可进行挑战|"),!1;var n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.SHENYUBOSS),s=n?n.count:0;RexueDideCT.checkEnoughTimeById(RexueID.ShenyuBoss,BossCT.ins().worldBossLeftTime[this.type]+s,function(){BossCT.ins().sendChallengWorldBoss(e.eId,e.type)})}else TipsCT.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!0},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.restoreTime-egret.getTimer();0>=t?(Timer.stop(this.updateTime,this),this.isStartTime=!1,BossCT.ins().worldBossLeftTime[this.type]>=GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1]&&(this.timeTxt.visible=!1)):this.timeTxt.visible||(this.timeTxt.visible=!0);var e=DateUtils.getFormatBySecond(Math.floor(t/1e3),DateUtils.TIME_FORMAT_12);this.timeTxt.text="（"+e+"恢复）"}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.setData=function(){var t=BossCT.ins().worldBossLeftTime[this.type];this.buyBtn.visible=!1;var e=BagCT.ins().getBagItemById(ItemConst.SHENYUBOSS);this.showJuan(e),this.challengeCountTxt.text=t+"/"+GlobalConfig.WorldBossBaseConfig.dayCount[this.type-1];for(var i=BossCT.ins().worldInfoList[this.type].slice(),n=[],s=[],o=[],a=[],r=[],l=1e3*ZsCT.ins().lv+Actor.level,h=0;h<i.length;h++){var u=(i[h].relieveTime-egret.getTimer())/1e3>0||i[h].hp<=0,p=BossCT.ins().getBossRemindByIndex(i[h].id),c=GlobalConfig.WorldBossConfig[i[h].id],d=1e3*c.zsLevel+c.level;l>=d?p?u?s.push(i[h]):n.push(i[h]):u?a.push(i[h]):o.push(i[h]):r.push(i[h])}n.sort(this.compareFn),s.sort(this.compareFn),o.sort(this.compareFn),a.sort(this.compareFn),r.sort(this.compareFn);var g=n.concat(s,o,r,a);this.listData=new eui.ArrayCollection(g),this.list.dataProvider=this.listData,this.isStartTime||(Timer.start(1e3,0,this.updateTime,this),this.restoreTime=BossCT.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime()),this.refushBarList(g)},e.prototype.updateList=function(){if(this.listData){if(this.isUse&&BossCT.ins().worldBossLeftTime[this.type]>0)return this.isUse=!1,ViewManager.ins().close(this),void this.joinPulbicChallenge(this.config);for(var t=0;t<this.listData.length;t++)this.listData.itemUpdated(this.listData.getItemAt(t))}},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],n=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<n.zsLevel?1:i.zsLevel>n.zsLevel?-1:i.level<n.level?1:i.level>n.level?-1:0},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,this.type)},e.prototype.refushBarList=function(t){if(!this.showBossId)return void(this.bossScroller.viewport.scrollV=0);for(var e=0;e<t.length;e++){var i=GlobalConfig.WorldBossConfig[t[e].id];if(i&&this.showBossId==i.bossId){this.bossScroller.viewport.validateNow(),this.bossScroller.viewport.scrollV=138*e,this.bossScroller.viewport.contentHeight-this.bossScroller.viewport.scrollV<this.bossScroller.viewport.height&&(this.bossScroller.viewport.scrollV=this.bossScroller.viewport.contentHeight-this.bossScroller.height);break}}},e}(BaseView);__reflect(ShenyuBossPanel.prototype,"ShenyuBossPanel"),window.ShenyuBossPanel=ShenyuBossPanel;var VipBossItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.itemIndex+1;GlobalConfig.BossHomeConfig[t];this.bg.source="vipbossb"+t}},e}(BaseItemRender);__reflect(VipBossItem.prototype,"VipBossItem"),window.VipBossItem=VipBossItem;var WildBossJoinItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.bg.visible=this.itemIndex%2==0,this.data[3]?this.txt0.text=this.data[0]:this.txt0.text=this.itemIndex+1+"",this.txt1.text=this.data[1],this.txt2.text=this.data[2]},e}(BaseItemRender);__reflect(WildBossJoinItem.prototype,"WildBossJoinItem"),window.WildBossJoinItem=WildBossJoinItem;var WorldBossItem=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t;switch(this.data.bossType){case BossCT.BOSS_SUBTYPE_XUANWUBOSS:t=GlobalConfig.XuanWuBossConfig[this.data.id].bossId;break;default:t=GlobalConfig.WorldBossConfig[this.data.id].bossId}var e=GlobalConfig.MonstersConfig[t];if(Timer.stop(this.updateTime,this),this.titleText.text=e.name,2==this.data.bossState||0==this.data.bossState)this.killImg.visible=!1,this.updateTime(),Timer.start(1e3,0,this.updateTime,this);else if(1==this.data.bossState)if(this.data.bossType==BossCT.BOSS_SUBTYPE_XUANWUBOSS){var i=GlobalConfig.XuanWuBossConfig[this.data.id];YuanshenData.ins().isInTheRange(i.lianjiLv)?(this.timeTxt.text="已刷新",this.killImg.visible=!0):(this.timeTxt.text="元神达到"+YuanshenData.getName(i.lianjiLv[0])+"解锁",this.killImg.visible=!1)}else this.data.zsLevel<=ZsCT.ins().lv?(this.timeTxt.text="已刷新",this.killImg.visible=!0):(this.timeTxt.text=this.data.zsLevel+"转解锁",this.killImg.visible=!1);else this.killImg.visible=!1}},e.prototype.updateTime=function(){var t=this.data.relieveTime-egret.getTimer();this.timeTxt.text=""+DateUtils.getFormatBySecond(Math.floor(t/1e3),1),0>=t&&(Timer.stop(this.updateTime,this),this.timeTxt.text="")},e.prototype.onRemove=function(t){Timer.stop(this.updateTime,this)},e}(BaseItemRender);__reflect(WorldBossItem.prototype,"WorldBossItem"),window.WorldBossItem=WorldBossItem;var WorldBossItemMain=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=WorldBossItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.onTap=function(t){var e=this.listData.getItemAt(t.itemIndex);this.data.clickCall(e)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.listData.source=e.arr,this.list.selectedIndex=e.selectIndex,e.type==BossCT.BOSS_SUBTYPE_WORLDBOSS?this.title.source="title_mijingboss":e.type==BossCT.BOSS_SUBTYPE_DARKBOSS?this.title.source="title_anzhimijingboss":e.type==BossCT.BOSS_SUBTYPE_XUANWUBOSS&&(this.title.source="xuanwudian_png")},e}(BaseItemRender);__reflect(WorldBossItemMain.prototype,"WorldBossItemMain"),window.WorldBossItemMain=WorldBossItemMain;var WorldBossMainPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.endTime=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.getItemTxt,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this)},e.prototype.addDisplay=function(){var t=[],e=BossCT.BOSS_SUBTYPE_WORLDBOSS,i=BossCT.ins().worldBossPlayList[e].slice();i.length||(BossCT.ins().updateBossPlayList(e),i=BossCT.ins().worldBossPlayList[e].slice()),i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:0,clickCall:this.onClickList.bind(this)}),this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(BossCT.ins().postWorldBoss,this.setWin),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.observe(BagCT.ins().postItemDel,this.UseToItem),this.listData.source=t,this.list.scrollV=0,this.list.selectedIndex=0,this.currData=t[0].arr[0],this.setWin()},e.prototype.sortList=function(t,e){return t.id<e.id?-1:1},e.prototype.onClickMenu=function(t){var e=this.list.dataProvider.getItemAt(t.itemIndex);e.type==BossCT.BOSS_SUBTYPE_DARKBOSS&&0==e.arr.length&&TipsCT.ins().showTips("6转即可开启暗之秘境")},e.prototype.onClickList=function(t){this.currData=t;for(var e=GlobalConfig.WorldBossConfig[this.currData.id],i=0;i<this.listData.length;i++){var n=this.listData.getItemAt(i);e.type==n.type?n.selectIndex=n.arr.indexOf(t):(n.selectIndex=-1,this.listData.itemUpdated(n))}this.setWin()},e.prototype.setWin=function(){if(this.currData){if(this.isUse)return this.isUse=!1,ViewManager.ins().close(this),void this.joinWorldBoss();var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId];this.nameTxt.text=e.name+"("+t.zslook[0]+"转-"+t.zslook[t.zslook.length-1]+"转)";var i="无";""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider?this.dropRewardList.dataProvider.source=t.showReward.concat():this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward.concat()),this.playerNameTxt.text=i;var n=BossCT.ins().worldBossLeftTime[t.type],s=t.type==BossCT.BOSS_SUBTYPE_WORLDBOSS?"秘境BOSS":"暗之秘境BOSS";if(this.leftText.text=s+"剩余次数:"+n+"次",this.getItemTxt.visible=n>0||t.type==BossCT.BOSS_SUBTYPE_DARKBOSS?!1:!0,this.endTime=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),Timer.has(this.updateTime,this)||Timer.start(500,0,this.updateTime,this),i=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+i):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),t.type==BossCT.BOSS_SUBTYPE_WORLDBOSS){var o=BagCT.ins().getBagItemById(ItemConst.WORLDBOSS);this.showJuan(o)}else this.showJuan(null)}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.updateTime=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(e,5,3),0>=e&&(Timer.stop(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)}},e.prototype.showTips=function(){var t=this;if(this.currData){var e=GlobalConfig.WorldBossConfig[this.currData.id],i=BossCT.ins().worldBossLeftTime[e.type];if(i>0)return!0;if(e.type==BossCT.BOSS_SUBTYPE_DARKBOSS)return void TipsCT.ins().showTips("暗之秘境BOSS挑战次数已用完");var n="",s=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.WORLDBOSS);if(s)this.isUse=!0,BagCT.ins().sendUseItem(s.configID,1);else{var o=VipCT.ins().getVipCfg(Actor.vip);if(!o)return TipsCT.ins().showTips("|C:0xf3311e&T:成为"+VipCT.getVipStr()+"可购买挑战次数|"),!1;if(!o.boss2buy)return TipsCT.ins().showTips("|C:0xf3311e&T:"+VipCT.getVipStr()+"等级不足，提升"+VipCT.getVipStr()+"等级可购买挑战次数|"),!1;var a=BossCT.ins().worldChallengeTime[e.type];if(0>=i&&a>=o.boss2buy)return void TipsCT.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[e.type-1])return TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;n="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[e.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+a+"/"+o.boss2buy),WarnWin.show(n,function(){BossCT.ins().registerBuyFunc(e.type,function(){t.joinWorldBoss()}),BossCT.ins().sendBuyChallengeTimes(e.type)},this)}return!1}},e.prototype.UseToItem=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];this.isUse&&BossCT.ins().sendWorldBossInfo(t.type)}},e.prototype.joinWorldBoss=function(){var t=this;if(this.isJoin&&this.currData){var e=GlobalConfig.WorldBossConfig[this.currData.id];if(this.isJoin=!1,!FbCT.ins().checkInFB()){if(Math.floor((BossCT.ins().worldBossCd[e.type]-egret.getTimer())/1e3)>0)return void TipsCT.ins().showTips("挑战CD中");var i=1e3*ZsCT.ins().lv+Actor.level,n=1e3*e.zsLevel+e.level;if(n>i){var s=e.zsLevel>0?e.zsLevel+"转":e.level+"级";return void TipsCT.ins().showTips("只有"+s+"才可以挑战。")}BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH):RexueDideCT.checkEnoughTimeById(RexueID.WorldBoss,BossCT.ins().worldBossLeftTime[e.type],function(){BossCT.ins().sendChallengWorldBoss(t.currData.id,e.type)}),ViewManager.ins().close(LimitTaskView)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(!this.currData)return;if(this.isJoin=!0,!this.currData.zsLevel)return void platform.reportError("WorldBossMainPanel:"+BossCT.ins().worldBossPlayList[BossCT.BOSS_SUBTYPE_WORLDBOSS].length+" "+(this.currData?this.currData.id:"this.currData为空"));if(this.currData.zsLevel>ZsCT.ins().lv)return void TipsCT.ins().showTips(this.currData.zsLevel+"转解锁");if(!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips())return;this.joinWorldBoss();break;case this.getItemTxt:if(!this.showTips())return}},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_WORLDBOSS)},e.prototype.close=function(){this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)},e}(BaseView);__reflect(WorldBossMainPanel.prototype,"WorldBossMainPanel"),window.WorldBossMainPanel=WorldBossMainPanel;var XcBossView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0,this.addTouchEvent(this.gw0,this.onTap),this.addTouchEvent(this.gw1,this.onTap),this.addTouchEvent(this.gw2,this.onTap),this.addTouchEvent(this.gw3,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this)},e.prototype.addDisplay=function(){this.observe(ZsCT.ins().postZsLv,this.initData),this.observe(BossCT.ins().postWorldBoss,this.onUpdateBoss),this.observe(LianJiCT.ins().onYuanshenData,this.checkXuanWuRed),this.observe(XuanWuCT.ins().postInfo,this.updateXuanWuTimes),Timer.start(3e3,0,this.onUpdateTime,this),Timer.start(1e3,0,this.initData,this),this.initData();var t=GlobalConfig.WorldBossBaseConfig.BasaltTowerDay;this.gw3.filters=GameServer.serverOpenDay+1<t||!XuanWuCT.ins().bossInfo||0==XuanWuCT.ins().bossInfo.length?FilterUtil.ARRAY_GRAY_FILTER:[],this.updateXuanWuTimes()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onUpdateTime=function(){BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_STARBOSS)},e.prototype.updateXuanWuTimes=function(){this.eXuanWuLab.text="玄武殿领奖次数："+XuanWuCT.ins().bossLeftTime+"次"},e.prototype.initData=function(){var t=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_STARBOSS].concat();t.sort(this.compareFn);for(var e=0,i=0;i<t.length;i++){var n=t[i],s=GlobalConfig.WorldBossConfig[n.id],o=(BossCT.ins().worldBossCdTime[BossCT.BOSS_SUBTYPE_STARBOSS],"("+s.zsLevel[0]+"转-"+s.zsLevel[1]+"转)");if(this["redPoint"+i].visible=!1,e=s.type,n.canInto)if(this.setGwState(i,2),n.isDie){var a=n.relieveTime-egret.getTimer();a=0>a?0:a,o+="\n"+DateUtils.getFormatBySecond(Math.floor(a/1e3),1)}else this["redPoint"+i].visible=this.checkBossRed(n);else this.setGwState(i,0);this["info"+i].text=o}this.leftTime.text="三圣宫剩余领奖次数："+BossCT.ins().worldBossLeftTime[e],this.checkXuanWuRed()},e.prototype.checkXuanWuRed=function(){var t=XuanWuCT.ins().bossInfo,e=XuanWuCT.ins().bossLeftTime,i=!1;if(!t||0==e)return void(this.redPoint3.visible=i);for(var n=0,s=t;n<s.length;n++){var o=s[n];if(o&&2!=o.bossState){var a=(o.relieveTime-egret.getTimer())/1e3>0;if(a)continue;var r=GlobalConfig.XuanWuBossConfig[o.id];if(YuanshenData.ins().isInTheRange(r.lianjiLv)){i=!0;break}}}this.redPoint3.visible=i},e.prototype.checkBossRed=function(t){var e=(BossCT.ins().worldBossCdTime[BossCT.BOSS_SUBTYPE_STARBOSS]-egret.getTimer())/1e3,i=BossCT.ins().worldBossLeftTime[BossCT.BOSS_SUBTYPE_STARBOSS];return 0>=e&&i>0},e.prototype.setGwState=function(t,e){var i=["locked","normal","selected"];this["img"+t].source="xc_field_"+i[e]+"_"+t+"_png",this["title"+t].source="xc_title_"+(0==e?"locked_":"")+(t+1)+"_png",this["info"+t].textColor=0==e?11119017:65280},e.prototype.onUpdateBoss=function(t){t==BossCT.BOSS_SUBTYPE_STARBOSS&&this.initData(),t==BossCT.BOSS_SUBTYPE_XUANWUBOSS&&this.checkXuanWuRed()},e.prototype.compareFn=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_STARBOSS)},e.prototype.onTap=function(t){var e=t.currentTarget,i=this.getClickGwIndex(e);if(i>-1){if(!KfArenaSys.ins().checkIsMatching())return;if(3==i)return void ViewManager.ins().open(XuanWuBossPanel);var n=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_STARBOSS].concat(),s=BossCT.ins().worldBossCdTime[BossCT.BOSS_SUBTYPE_STARBOSS];if(n.sort(this.compareFn),n[i].canInto){var o=n[i],a=GlobalConfig.WorldBossConfig[o.id];if(o.isDie)TipsCT.ins().showTips("BOSS未复活");else if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);else if(s-egret.getTimer()>0){var r=Math.ceil((s-egret.getTimer())/1e3);TipsCT.ins().showTips("玩法冷却中"+r+"秒后继续挑战")}else{var r=Math.ceil((BossCT.ins().worldBossCd[a.type]-egret.getTimer())/1e3);if(r>0)return TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+r+"秒后可进行挑战|"),!1;BossCT.ins().worldBossLeftTime[a.type]>0?RexueDideCT.checkEnoughTimeById(RexueID.XcBoss,BossCT.ins().worldBossLeftTime[a.type],function(){BossCT.ins().sendChallengWorldBoss(o.id,a.type)}):BossCT.ins().sendChallengWorldBoss(o.id,a.type)}}}},e.prototype.getClickGwIndex=function(t){for(var e=0;4>e;e++)if(t==this["gw"+e])return e;return-1},e}(BaseView);__reflect(XcBossView.prototype,"XcBossView"),window.XcBossView=XcBossView;var XingchenBossPanel=function(t){function e(){var e=t.call(this)||this;return e.endTime=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=WorldBossItemMain,this.dropRewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData},e.prototype.open=function(){var t=[],e=BossCT.BOSS_SUBTYPE_STARBOSS,i=BossCT.ins().worldBossPlayList[e].slice();i.length||(BossCT.ins().updateBossPlayList(e),i=BossCT.ins().worldBossPlayList[e].slice()),i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:0,clickCall:this.onClickList.bind(this)}),this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(BossCT.ins().postWorldBoss,this.setWin),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.listData.source=t,this.list.scrollV=0,this.list.selectedIndex=0,this.currData=t[0].arr[0],this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.getItemTxt,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.setWin()},e.prototype.sortList=function(t,e){return t.id<e.id?-1:1},e.prototype.onClickMenu=function(t){var e=this.list.dataProvider.getItemAt(t.itemIndex);e.type==BossCT.BOSS_SUBTYPE_STARBOSS&&0==e.arr.length&&TipsCT.ins().showTips("6转即可开启星辰boss")},e.prototype.onClickList=function(t){this.currData=t;for(var e=GlobalConfig.WorldBossConfig[this.currData.id],i=0;i<this.listData.length;i++){var n=this.listData.getItemAt(i);e.type==n.type?n.selectIndex=n.arr.indexOf(t):(n.selectIndex=-1,this.listData.itemUpdated(n))}this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId];t.zsLevel>0?t.zsLevel+"转":t.level+"级";this.nameTxt.text=e.name+"("+t.zslook[0]+"转-"+t.zslook[t.zslook.length-1]+"转)";var i="无";""!=this.currData.roleName&&(i=this.currData.roleName,""!=this.currData.guildName&&(i=i+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider?this.dropRewardList.dataProvider.source=t.showReward.concat():this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward.concat()),this.playerNameTxt.text=i;var n=BossCT.ins().worldBossLeftTime[t.type],s=t.type==BossCT.BOSS_SUBTYPE_STARBOSS;if(this.leftText.text=s+"剩余次数:"+n+"次",this.getItemTxt.visible=!1,this.endTime=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),Timer.has(this.updateTime,this)||Timer.start(500,0,this.updateTime,this),i=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+i):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),t.type==BossCT.BOSS_SUBTYPE_WORLDBOSS){var o=BagCT.ins().getBagItemById(ItemConst.WORLDBOSS);this.showJuan(o)}else this.showJuan(null)}},e.prototype.showJuan=function(t){return t?(this.juan.visible=!0,this.jicon.source=t.itemConfig.icon+"_png",void(this.jcount.text=t.count+"")):void(this.juan.visible=!1)},e.prototype.updateTime=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(e,5,3),0>=e&&(Timer.stop(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)}},e.prototype.showTips=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=BossCT.ins().worldBossLeftTime[t.type];if(e>0)return!0;if(t.type==BossCT.BOSS_SUBTYPE_STARBOSS)return void TipsCT.ins().showTips("星辰BOSS挑战次数已用完");var i="",n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.WORLDBOSS);if(n)i="确定使用1个<font color='#FFB82A'>秘境boss</font>道具进入挑战？\n",WarnWin.show(i,function(){var t=this;this.isUse=!0,BagCT.ins().registerUseItemFunc(n.configID,function(){ViewManager.ins().close(BossWin),t.joinWorldBoss()}),BagCT.ins().sendUseItem(n.configID,1)},this);else{var s=VipCT.ins().getVipCfg(Actor.vip);if(!s)return TipsCT.ins().showTips("|C:0xf3311e&T:成为"+VipCT.getVipStr()+"可兑换挑战次数|"),!1;if(!s.boss2buy)return TipsCT.ins().showTips("|C:0xf3311e&T:"+VipCT.getVipStr()+"等级不足，提升"+VipCT.getVipStr()+"等级可兑换挑战次数|"),!1;var o=BossCT.ins().worldChallengeTime[t.type];if(0>=e&&o>=s.boss2buy)return void TipsCT.ins().showTips("|C:0xff0000&T:挑战次数不足,无法挑战");if(Actor.yb<GlobalConfig.WorldBossBaseConfig.buyCountPrice[t.type-1])return TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),!1;i="确定花费<font color='#FFB82A'>"+GlobalConfig.WorldBossBaseConfig.buyCountPrice[t.type-1]+"元宝</font>购买1次挑战次数吗？\n"+("今日已购买："+o+"/"+s.boss2buy),WarnWin.show(i,function(){var e=this;BossCT.ins().registerBuyFunc(t.type,function(){e.config;e.joinWorldBoss()}),BossCT.ins().sendBuyChallengeTimes(t.type)},this)}return!1}},e.prototype.UseToItem=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];this.isUse&&(this.isUse=!1,BossCT.ins().sendWorldBossInfo(t.type))}},e.prototype.joinWorldBoss=function(){if(this.isJoin&&this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id];if(this.isJoin=!1,!FbCT.ins().checkInFB()){if(Math.floor((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3)>0)return void TipsCT.ins().showTips("挑战CD中");var e=1e3*ZsCT.ins().lv+Actor.level,i=(GlobalConfig.MonstersConfig[t.bossId],1e3*t.zsLevel+t.level);if(i>e){var n=t.zsLevel>0?t.zsLevel+"转":t.level+"级";return void TipsCT.ins().showTips("只有"+n+"才可以挑战。")}BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH):BossCT.ins().sendChallengWorldBoss(this.currData.id,t.type),ViewManager.ins().close(LimitTaskView)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(this.isJoin=!0,this.currData&&this.currData.zsLevel>ZsCT.ins().lv)return void TipsCT.ins().showTips(this.currData.zsLevel+"转解锁");if(!KfArenaSys.ins().checkIsMatching())return;if(!this.showTips())return;this.joinWorldBoss();break;case this.getItemTxt:if(!this.showTips())return}},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_STARBOSS)
},e.prototype.close=function(){this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)},e}(BaseView);__reflect(XingchenBossPanel.prototype,"XingchenBossPanel"),window.XingchenBossPanel=XingchenBossPanel;var zhengduoBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastSelect=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.rightGroup.visible=this.leftGroup.visible=!1,this.setOpenIndex(this.select?this.select[0]:0),this.select&&(this.select[0]>4&&(this.tab.scrollH=100*(this.select[0]-4)),0==this.viewStack.selectedIndex&&(this.publicBoss.select=this.select[1])),this.tab.validateNow(),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen),this.addTouchEvent(this.leftGroup,this.onTap),this.addTouchEvent(this.rightGroup,this.onTap),this.addEvent(eui.UIEvent.CHANGE_END,this.scroll,this.onChange)},e.prototype.addDisplay=function(){this.observe(BossCT.ins().postWorldBoss,this.updateRedPoint),this.updateRedPoint()},e.prototype.removeDisplay=function(){delete this.select},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.updateRedPoint=function(){this.tab.getChildAt(e.YeWai).redPoint0.visible=BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_QMBOSS),this.tab.getChildAt(e.MiJing).redPoint0.visible=BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_WORLDBOSS),this.tab.getChildAt(e.ShenYu).redPoint0.visible=BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_SHENYU),this.tab.getChildAt(e.ShenBin).redPoint0.visible=GodWeaponRedPoint.ins().gwBossRp,this.tab.getChildAt(e.AnDian).redPoint0.visible=ZsCT.ins().lv>=5&&GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay-1&&BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_DARKBOSS),this.leftRed.visible=this.tab.getChildAt(e.YeWai).redPoint0.visible||this.tab.getChildAt(e.MiJing).redPoint0.visible,this.rightRed.visible=this.tab.getChildAt(e.AnDian).redPoint0.visible||this.tab.getChildAt(e.ShenBin).redPoint0.visible},e.prototype.checkIsOpen=function(t){var i=t.target,n=1;if(ViewManager.ins().close(LimitTaskView),i.selectedIndex==e.MiJing&&ZsCT.ins().lv<n)return TipsCT.ins().showTips(n+"转开启"),t.$cancelable=!0,void t.preventDefault();if(i.selectedIndex==e.ShenYu&&(GameServer.serverOpenDay<2||ZsCT.ins().lv<1))return TipsCT.ins().showTips("开服第3天并达到1转开启"),t.$cancelable=!0,void t.preventDefault();if(i.selectedIndex==e.ShenBin){var s=GlobalConfig.GodWeaponBaseConfig,o=s.openDay,a=s.zhuanshengLevel;if(GameServer.serverOpenDay<o||ZsCT.ins().lv<a)return TipsCT.ins().showTips("开服第"+(o+1)+"天并达到"+a+"转开启"),t.$cancelable=!0,void t.preventDefault()}if(i.selectedIndex==e.AnDian){var o=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay;if(!(ZsCT.ins().lv>=GlobalConfig.WorldBossBaseConfig.canSennDarkBoss&&GameServer.serverOpenDay>=GlobalConfig.WorldBossBaseConfig.canSeeDarkBossDay-1))return TipsCT.ins().showTips("开服第"+o+"天并达到"+GlobalConfig.WorldBossBaseConfig.canSennDarkBoss+"转开启"),t.$cancelable=!0,void t.preventDefault()}if(i.selectedIndex==e.XingChen){var o=GlobalConfig.WorldBossBaseConfig.starsBOSSDay;if(!(ZsCT.ins().lv>=GlobalConfig.WorldBossBaseConfig.starsBOSSLevel[0]&&GameServer.serverOpenDay>=o-1))return TipsCT.ins().showTips("开服第"+o+"天并达到"+GlobalConfig.WorldBossBaseConfig.starsBOSSLevel[0]+"转开启"),t.$cancelable=!0,void t.preventDefault()}},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(!BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_WORLDBOSS]&&!BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_QMBOSS])return TipsCT.ins().showTips("网络不佳，请稍后"),!1;if(t&&t.length){if(t[0]==e.MiJing){var n=1;return ZsCT.ins().lv<n?(TipsCT.ins().showTips(n+"转开启"),!1):!0}if(t[0]==e.ShenYu&&!BossCT.ins().checkShenyuOpen())return TipsCT.ins().showTips("开服第"+GlobalConfig.WorldBossBaseConfig.shenyuOpenDay+"天开启"),!1}return OpenSystem.ins().checkSysOpen(SystemType.BOSS)?(FbWin.isClose||ViewManager.ins().close(LiLianWin),FbWin.isClose=!1,!0):(TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOSS)),!1)},e.prototype.setOpenIndex=function(t){this.lastSelect=t,this.tab.selectedIndex=this.lastSelect,BossCT.ins().ZDPage=this.lastSelect,this.viewStack.selectedIndex=this.lastSelect,e.changeIndex(t)},e.changeIndex=function(t){return t},e.prototype.onChange=function(){this.tab.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.tab.scrollH>=this.tab.contentWidth-this.tab.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0)},e.prototype.onTap=function(t){var e=460,i=0;switch(t.currentTarget){case this.leftGroup:i=this.tab.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.leftGroup.visible=!1,this.rightGroup.visible=!0,this.tab.scrollH=i,this.onChange();break;case this.rightGroup:i=this.tab.scrollH+e,i=92*Math.round(i/92),i>this.tab.contentWidth-this.scroll.width&&(i=this.tab.contentWidth-this.scroll.width),this.leftGroup.visible=!0,this.rightGroup.visible=!1,this.tab.scrollH=i,this.onChange()}},e.YeWai=0,e.MiJing=1,e.XingChen=999,e.ShenYu=2,e.ShenBin=3,e.AnDian=4,__decorate([post()],e,"changeIndex",null),e}(BaseView);__reflect(zhengduoBossPanel.prototype,"zhengduoBossPanel"),window.zhengduoBossPanel=zhengduoBossPanel;var Boss_RevelryWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=1,e.skinName="Boss_RevelrySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.tab1,this.onTabTouch),this.addTouchEvent(this.tab2,this.onTabTouch),this.addTouchEvent(this.tab3,this.onTabTouch),this.addTouchEvent(this.viewStack.getElementAt(0).goBtn,function(){ViewManager.ins().open(BossWin,1)}),this.addTouchEvent(this.viewStack.getElementAt(2).goBtn,function(){return GameServer.serverOpenDay<3||ZsCT.ins().lv<1?void TipsCT.ins().showTips("开服3天并达到1转开启"):void ViewManager.ins().open(BossWin,1,2)})},e.prototype.onTabTouch=function(t){switch(t.target){case this.tab1:if(1==this.lastSelect)return;this.viewStack.selectedIndex=0;break;case this.tab2:if(2==this.lastSelect)return;this.viewStack.selectedIndex=1;break;case this.tab3:if(3==this.lastSelect)return;this.viewStack.selectedIndex=2}this["tab"+this.lastSelect].$children[0].visible=!1,this.lastSelect=this.viewStack.selectedIndex+1,this["tab"+this.lastSelect].$children[0].visible=!0},e.prototype.selectTab1=function(){1!=this.lastSelect&&(this.viewStack.getElementAt(0).visible=!0,this.viewStack.getElementAt(1).visible=!1,this.viewStack.getElementAt(2).visible=!1,this.lastSelect=1,this.tab1.$children[0].visible=!0,this.tab2.$children[0].visible=!1,this.tab3.$children[0].visible=!1)},e.prototype.selectTab2=function(){2!=this.lastSelect&&(this.viewStack.getElementAt(0).visible=!1,this.viewStack.getElementAt(1).visible=!0,this.viewStack.getElementAt(2).visible=!1,this.lastSelect=2,this.tab1.$children[0].visible=!1,this.tab2.$children[0].visible=!0,this.tab3.$children[0].visible=!1)},e.prototype.selectTab3=function(){3!=this.lastSelect&&(this.viewStack.getElementAt(0).visible=!1,this.viewStack.getElementAt(1).visible=!1,this.viewStack.getElementAt(2).visible=!0,this.lastSelect=3,this.tab1.$children[0].visible=!1,this.tab2.$children[0].visible=!1,this.tab3.$children[0].visible=!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(Boss_RevelryWin.prototype,"Boss_RevelryWin"),ViewManager.ins().reg(Boss_RevelryWin,LayerManager.UI_Main),window.Boss_RevelryWin=Boss_RevelryWin;var BossHomeMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isStartTime=!1,e.type=0,e.restoreTime=0,e.lastIndex=-1,e.isClickItem=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=HomeBossItem,this.titleList.itemRenderer=VipBossItem,this.setting.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.setting.text+"</u></a>"),this.setting.touchEnabled=!0;var t=[];for(var e in GlobalConfig.BossHomeConfig)t.push(e);this.titleList.dataProvider=new eui.ArrayCollection(t),this.setLoginView()},e.prototype.addDisplay=function(){this.setGroupVis(!0),this.type=BossCT.BOSS_SUBTYPE_HOMEBOSS,this.lastIndex=-1,this.titleList.selectedIndex=0,this.observe(BossCT.ins().postWorldBoss,this.setData),this.setting.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.titleList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.addTouchEvent(this.bosshome0,this.onTap),this.addTouchEvent(this.bosshome1,this.onTap),this.rewardList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.rewardList1.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.setData()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bosshome0:this.onRukouClick(0);break;case this.bosshome1:ViewManager.ins().open(VipBossWin);break;case this.rewardList0:case this.rewardList1:this.isClickItem=!0}},e.prototype.onRukouClick=function(t){if(this.isClickItem)return void(this.isClickItem=!1);var e=GlobalConfig.BossHomeConfig[t+1];return Actor.vip<e.vip?void TipsCT.ins().showTips(VipCT.getVipStr(e.vip,!0)+"开启"):(this.titleList.selectedIndex=t,this.setGroupVis(!1),void this.setData())},e.prototype.setGroupVis=function(t){this.rukou.visible=t,this.mainGroup.visible=!t},e.prototype.onClickMenu=function(t){this.setData()},e.prototype.setLoginView=function(){for(var t=0;2>t;t++){var e=GlobalConfig.BossHomeConfig[t+1];this["rewardList"+t].itemRenderer=ItemBase,this["rewardList"+t].dataProvider=new eui.ArrayCollection(e.icon)}},e.prototype.setData=function(){if(this.lastIndex!=this.titleList.selectedIndex){this.lastIndex=this.titleList.selectedIndex;var t=this.list.parent;t.stopAnimation(),this.list.scrollV=0;var e=BossCT.ins().worldInfoList[this.type].slice(),i=[],n=[],s=[],o=[],a=[],r=1e3*ZsCT.ins().lv+Actor.level,l=this.titleList.selectedIndex+1,h=GlobalConfig.BossHomeConfig[l],u=h.boss;this.titleText.text="BOSS之家 "+l+"层",this.vipTipTxt.text=VipCT.getVipStr(h.vip,!0)+"无限挑战";for(var p=0;p<e.length;p++)if(-1!=u.indexOf(e[p].id)){var c=2==e[p].bossState,d=GlobalConfig.WorldBossConfig[e[p].id],g=1e3*d.zsLevel+d.level;if(g>r)a.push(e[p]);else{var f=BossCT.ins().getBossRemindByIndex(e[p].id);f?c?n.push(e[p]):i.push(e[p]):c?o.push(e[p]):s.push(e[p])}}i.sort(this.compareFn),n.sort(this.compareFn),s.sort(this.compareFn),o.sort(this.compareFn),a.sort(this.compareFn);var v=i.concat(n,s,o,a);this.listData=new eui.ArrayCollection(v),this.list.dataProvider=this.listData,this.currData=v[0],this.isStartTime||(Timer.start(1e3,0,this.updateTime,this),this.restoreTime=BossCT.ins().worldBossrestoreTime[this.type],this.isStartTime=!0,this.updateTime())}},e.prototype.updateTime=function(){if(void 0!=this.timeTxt){var t=this.currData,e=t.relieveTime-egret.getTimer();0>=e?(Timer.stop(this.updateTime,this),this.isStartTime=!1,this.timeTxt.visible=!1,BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_HOMEBOSS)):(this.timeTxt.visible||(this.timeTxt.visible=!0),this.timeTxt.text=DateUtils.getFormatBySecond(Math.floor(e/1e3),1)+"后刷新")}},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],n=GlobalConfig.WorldBossConfig[e.id];return i.zsLevel<n.zsLevel?1:i.zsLevel>n.zsLevel?-1:i.level<n.level?1:i.level>n.level?-1:0},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_HOMEBOSS)},e}(BaseView);__reflect(BossHomeMainWin.prototype,"BossHomeMainWin"),window.BossHomeMainWin=BossHomeMainWin;var BossWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BossSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.tabPanels=[this.personalBoss,this.zhengduoBoss,this.kuafuBoss,this.huodongBoss,this.homeBoss],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.seeRule,this.onTap),this.addChangeEvent(this.tab,this.setSelectedIndex),this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.setSeeBtn=function(t){this.seeRule.visible=2==t},e.prototype.setSeeBtn1=function(t){this.seeRule.visible=0==t||1==t||2==t},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(void 0==t[0]){var i=BossCT.ins().getListData()[0];0==i.length&&(t[0]=1)}this.lastSelect=t.length?t[0]:0,this.tabPanels[this.lastSelect].select=t.slice(1),this.lastSelect>this.viewStack.numChildren-1&&(this.lastSelect=this.viewStack.numChildren-1),LocationProperty.isIosTS&&(this.viewStack.removeChildAt(this.viewStack.numChildren-1),this.viewStack.removeChildAt(this.viewStack.numChildren-1)),this.viewStack.selectedIndex=this.lastSelect,this.tab.selectedIndex=this.lastSelect,this.tab.validateNow(),this.updateRedPoint(),ViewManager.ins().close(GuildMap),ViewManager.ins().close(GuildActivityWin),ViewManager.ins().close(TreasureHuntWin),this.checkHelpBtn(),this.observe(BossCT.ins().postWorldBoss,this.updateRedPoint),this.observe(KFBossRedpoint.ins().postRedPoint,this.updateRedPoint),this.observe(FbCT.ins().postUpDataInfo,this.setSelectedIndex),this.observe(FbCT.ins().postUpDataInfo,this.updateRedPoint),this.observe(zhengduoBossPanel.changeIndex,this.setSeeBtn),this.observe(KuafuBossPanel.changeIndex,this.setSeeBtn1),BossCT.ins().init()},e.prototype.setSelectedIndex=function(){this.lastSelect=this.viewStack.selectedIndex,this.checkHelpBtn()},e.prototype.checkHelpBtn=function(){BossCT.ins().checkShenyuOpen()?this.seeRule.visible=3!=this.lastSelect:this.seeRule.visible=!0,this.seeRule.visible=!(1==this.viewStack.selectedIndex||2==this.viewStack.selectedIndex),1==this.viewStack.selectedIndex&&2==BossCT.ins().ZDPage&&(this.seeRule.visible=!0),2==this.viewStack.selectedIndex&&0==BossCT.ins().KFPage&&(this.seeRule.visible=!0),2==this.viewStack.selectedIndex&&1==BossCT.ins().KFPage&&(this.seeRule.visible=!0),2==this.viewStack.selectedIndex&&2==BossCT.ins().KFPage&&(this.seeRule.visible=!0)},e.prototype.updateRedPoint=function(){var t=this.tab.getChildAt(0),e=t.eRp;e.visible=FbCT.isCanChallenge(),t=this.tab.getChildAt(1),e=t.eRp,e.visible=BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_QMBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_WORLDBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_DARKBOSS)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_SHENYU)||GodWeaponRedPoint.ins().gwBossRp,LocationProperty.isIosTS||(t=this.tab.getChildAt(3),e=t.eRp,e.visible=CityCC.ins().cityBossId&&CityCC.ins().getCityBossConfig(CityCC.ins().cityBossId)&&GameServer.serverOpenDay&&OpenSystem.ins().checkSysOpen(28)||BossCT.ins().newWorldBossData.isOpen&&BossCT.ins().newWorldBossData.startTime<GameServer.serverTime,t=this.tab.getChildAt(4),e=t.eRp,e.visible=BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_HOMEBOSS),t=this.tab.getChildAt(2),e=t.eRp,e.visible=1==KFBossRedpoint.ins().redpoint)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.seeRule:4==this.viewStack.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,12):3==this.viewStack.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,16):1==this.viewStack.selectedIndex&&2==BossCT.ins().ZDPage?ViewManager.ins().open(ZsBossRuleSpeak,46):2==this.viewStack.selectedIndex&&0==BossCT.ins().KFPage?ViewManager.ins().open(ZsBossRuleSpeak,34):2==this.viewStack.selectedIndex&&1==BossCT.ins().KFPage?ViewManager.ins().open(ZsBossRuleSpeak,50):2==this.viewStack.selectedIndex&&2==BossCT.ins().KFPage?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[57].text):ViewManager.ins().open(ZsBossRuleSpeak,this.viewStack.selectedIndex+1);break;default:if(t.target instanceof eui.Button){var e=t.target.parent.config;switch(t.target.name){case"publicChallenge":return;case"homeChallenge":if(FbCT.ins().checkInFB())return;if(!KfArenaSys.ins().checkIsMatching())return;if(e.zsLevel<=ZsCT.ins().lv&&e.level<=Actor.level)if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);else{var i=Math.ceil((BossCT.ins().worldBossCd[BossCT.BOSS_SUBTYPE_HOMEBOSS]-egret.getTimer())/1e3);if(i>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+i+"秒后可进行挑战|");BossCT.ins().sendChallengWorldBoss(t.target.parent.data.id,BossCT.BOSS_SUBTYPE_HOMEBOSS),ViewManager.ins().close(this)}else TipsCT.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");break;case"ZsBoss":}ViewManager.ins().close(LimitTaskView)}}},e.prototype.checkIsOpen=function(t){var e=t.target;ViewManager.ins().close(LimitTaskView);var i=1;if((3==e.selectedIndex||4==e.selectedIndex)&&LocationProperty.isIosTS)return void t.preventDefault();if(2==e.selectedIndex){var n=GlobalConfig.CrossBossBase;if(GameServer.serverOpenDay+1<n.openDay||ZsCT.ins().lv<n.limitZsLv)return TipsCT.ins().showTips("开服第"+n.openDay+"天并达到"+n.limitZsLv+"转开启"),t.$cancelable=!0,void t.preventDefault()}return 3==e.selectedIndex&&GameServer.serverOpenDay<i?(TipsCT.ins().showTips("开服第"+(i+1)+"天开启"),t.$cancelable=!0,void t.preventDefault()):void 0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS&&(2==t[0]||3==t[0]))return!1;if(!BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_WORLDBOSS]&&!BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_QMBOSS])return TipsCT.ins().showTips("网络不佳，请稍后"),!1;if(t&&t.length){if(2==t[0]){var i=GlobalConfig.CrossBossBase;if(GameServer.serverOpenDay+1<i.openDay||ZsCT.ins().lv<i.limitZsLv)return TipsCT.ins().showTips("开服第"+i.openDay+"天并达到"+i.limitZsLv+"转开启"),!1}return!0}return OpenSystem.ins().checkSysOpen(SystemType.BOSS)?(FbWin.isClose||ViewManager.ins().close(LiLianWin),FbWin.isClose=!1,!0):(TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOSS)),!1)},e}(BaseEuiView);__reflect(BossWin.prototype,"BossWin"),ViewManager.ins().reg(BossWin,LayerManager.UI_Main),window.BossWin=BossWin;var HideBossBtnWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="HideBossBtnSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.eff_dragon.touchEnabled=!1,this.eff_dragon.touchChildren=!1,this.hideBossBtn.visible=!1,this.eff_dragon.visible=!1},e.prototype.initUI=function(){this.hideBossBtn.visible=!1,this.eff_dragon.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]?this.playDragonEff():this.showBtn()},e.prototype.onTap=function(){return GameMap.sceneInMain()?Encounter.ins().isEncounter()?void TipsCT.ins().showCenterTips("|C:0xf3311e&T:正在挑战附近的人|"):void ViewManager.ins().open(HideBossWin):void TipsCT.ins().showCenterTips("|C:0xf3311e&T:请先退出副本后再击杀隐藏BOSS|")},e.prototype.playDragonEff=function(){var t=this,e=ObjectPool.pop("MovieClip");e.addEventListener(egret.Event.CHANGE,this.onloadComp,this),e.playFile(RES_DIR_EFF+"luckyboss_dragon_down",1,function(){e.removeEventListener(egret.Event.CHANGE,t.onloadComp,t)}),this.eff_dragon.visible=!0,this.eff_dragon.addChild(e)},e.prototype.onloadComp=function(){Timer.start(400,1,this.showBtn,this)},e.prototype.showBtn=function(){if(Assert(BossCT.ins().hideBossData.id,"hideBossData id:"+BossCT.ins().hideBossData.id))return void ViewManager.ins().close(this);this.hideBossBtn.visible=!0,this.addTouchEvent(this.hideBossBtn,this.onTap);var t=GlobalConfig.MonstersConfig[GlobalConfig.HideBossConfig[BossCT.ins().hideBossData.id].bossId];this.hideBossBtn.headImg.source="monhead"+t.head+"_png",this._sec=Math.floor((DateUtils.formatMiniDateTime(BossCT.ins().hideBossData.endTime)-GameServer.serverTime)/1e3),this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1),Timer.stop(this.setTime,this),Timer.start(1e3,0,this.setTime,this),this.mcBtn||(this.mcBtn=ObjectPool.pop("MovieClip"),this.mcBtn.playFile(RES_DIR_EFF+"luckyboss_hint",-1)),this.mcBtn.parent||this.hideBossBtn.eff_btn.addChild(this.mcBtn)},e.prototype.setTime=function(){this._sec>0?(this._sec-=1,this.lbTime.text=DateUtils.getFormatBySecond(this._sec,DateUtils.TIME_FORMAT_1)):(BossCT.ins().hideBossData.id=0,BossCT.ins().hideBossData.endTime=0,ViewManager.ins().close(this))},e}(BaseEuiView);__reflect(HideBossBtnWin.prototype,"HideBossBtnWin"),ViewManager.ins().reg(HideBossBtnWin,LayerManager.UI_Main),window.HideBossBtnWin=HideBossBtnWin;var HideBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="LuckyBossSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.boss.touchEnabled=!1,this.boss.touchChildren=!1,this.dropRewardList.itemRenderer=ItemBase},e.prototype.open=function(){this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.showBoss(),this.showAward()},e.prototype.showAward=function(){var t=BossCT.ins().hideBossData.id,e=GlobalConfig.HideBossConfig[t].rewardShow;this.dropRewardList.dataProvider=new eui.ArrayCollection(e.concat())},e.prototype.showBoss=function(){if(!this.bossMc){var t=ObjectPool.pop("MovieClip");this.bossMc=t,t.scaleX=-1,t.scaleY=1,t.x=78,t.y=50,this.boss.addChild(t)}var e=BossCT.ins().hideBossData.id,i=GlobalConfig.HideBossConfig[e].bossId,n=GlobalConfig.MonstersConfig[i];this.bossMc.playFile(RES_DIR_MONSTER+(n.avatar+"_3s"),-1)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.bgClose?ViewManager.ins().close(this):e==this.challengeBtn&&(Encounter.ins().isEncounter()?TipsCT.ins().showCenterTips("正在挑战附近的人"):GameMap.sceneInMain()?(BossCT.ins().hideBossData.lastId=BossCT.ins().hideBossData.id,BossCT.ins().sendChallengeHideBoss(),ViewManager.ins().close(this)):TipsCT.ins().showCenterTips("请先退出副本后再击杀隐藏BOSS"))},e}(BaseEuiView);__reflect(HideBossWin.prototype,"HideBossWin"),ViewManager.ins().reg(HideBossWin,LayerManager.UI_Popup),window.HideBossWin=HideBossWin;var PubBossRemindWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PubBossRemindSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listDatas=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.eCheckGroup.visible=!1,this.eLv.text="等级";var i=[];if(BossCT.ins().worldInfoList[this.type]&&(i=BossCT.ins().worldInfoList[this.type].slice()),this.type==BossCT.BOSS_SUBTYPE_QMBOSS?(this.list0.itemRenderer=PubBossRemindItem,this.autoChallenge0.selected=AutoChallengeBoss.ins().autoYewaiBoss,this.eCheckGroup.visible=!0):this.type==BossCT.BOSS_SUBTYPE_HOMEBOSS?this.list0.itemRenderer=HomeBossRemindItem:this.type==BossCT.BOSS_SUBTYPE_WORLDBOSS?this.list0.itemRenderer=PubBossRemindItem:this.type==BossCT.BOSS_SUBTYPE_VIPBOSS?(this.list0.itemRenderer=GwBossRemindItem,this.eLv.text="VIP等级"):this.type==BossCT.BOSS_SUBTYPE_GODWEAPON?(i=BossCT.ins().getGwBossList(),this.list0.itemRenderer=GwBossRemindItem):this.type==BossCT.BOSS_SUBTYPE_SHENYU?(this.eCheckGroup.visible=!0,this.list0.itemRenderer=PubBossRemindItem,this.autoChallenge0.selected=AutoChallengeBoss.ins().autoYewaiBoss):this.type==BossCT.BOSS_SUBTYPE_DARKBOSS?this.list0.itemRenderer=PubBossRemindItem:this.type==BossCT.BOSS_SUBTYPE_STARBOSS?this.list0.itemRenderer=GwBossRemindItem:this.type==BossCT.BOSS_SUBTYPE_XUANWUBOSS?(i=XuanWuCT.ins().bossInfo,this.list0.itemRenderer=GwBossRemindItem):this.type==BossCT.BOSS_SUBTYPE_TXMY&&(i=KFBossSys.ins().txmyBossRemindInfo(),this.list0.itemRenderer=GwBossRemindItem),this.addTouchEvent(this.autoChallenge0,this.onChallenge),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.type==BossCT.BOSS_SUBTYPE_QMBOSS&&!SamsaraModel.ins().isOpen()){var n=[];for(var s in i){var o=GlobalConfig.WorldBossConfig[i[s].id];o.samsaraLv||n.push(i[s])}i=n}this.type==BossCT.BOSS_SUBTYPE_TXMY?this.listDatas.source=i:this.listDatas.source=i.sort(this.compareFn),this.list0.dataProvider=this.listDatas,this.addTouchEvent(this,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];BossCT.ins().sendBossSetting(),this.removeTouchEvent(this,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),AutoChallengeBoss.ins().checkEnter()},e.prototype.onChallenge=function(t){return 0==Recharge.ins().franchise?(TipsCT.ins().showTips("未开通特权月卡"),this.autoChallenge0.selected=!1,AutoChallengeBoss.ins().autoShenyuBoss=!1,void(AutoChallengeBoss.ins().autoYewaiBoss=!1)):void(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?(ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH),this.autoChallenge0.selected=!1):this.type==BossCT.BOSS_SUBTYPE_SHENYU?AutoChallengeBoss.ins().autoShenyuBoss=this.autoChallenge0.selected:this.type==BossCT.BOSS_SUBTYPE_QMBOSS&&(AutoChallengeBoss.ins().autoYewaiBoss=this.autoChallenge0.selected))},e.prototype.onTap=function(t){if(t.target instanceof eui.CheckBox){var e=parseInt(t.target.name);BossCT.ins().setBossSetting(e)}else switch(t.currentTarget){case this.bgClose:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.compareFn=function(t,e){var i=GlobalConfig.WorldBossConfig[t.id],n=GlobalConfig.WorldBossConfig[e.id],s=BossCT.isCanChallenge(i),o=BossCT.isCanChallenge(n);return s&&!o?-1:!s&&o?1:i.samsaraLv>n.samsaraLv?1:i.samsaraLv<n.samsaraLv?-1:i.samsaraLv!=n.samsaraLv||0==i.samsaraLv?i.zsLevel>n.zsLevel?1:i.zsLevel<n.zsLevel?-1:i.lianjiLv>n.lianjiLv?1:i.lianjiLv<n.lianjiLv?-1:i.level>n.level?1:i.level<n.level?-1:i.belongRewardVipLimit>n.belongRewardVipLimit?1:i.belongRewardVipLimit<n.belongRewardVipLimit?-1:0:i.level>n.level?1:i.level<n.level?-1:void 0},e}(BaseEuiView);__reflect(PubBossRemindWin.prototype,"PubBossRemindWin"),window.PubBossRemindWin=PubBossRemindWin,ViewManager.ins().reg(PubBossRemindWin,LayerManager.UI_Popup);var PublicBossJiangliTipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossJiangLiTishiSkin",this.isTopLevel=!0,this.belongList.itemRenderer=ItemBase,this.joinList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.otherClose);var i;if(GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS){var n=GlobalConfig.WorldBossConfig;for(var s in n)n[s].fbid==GameMap.fubenID&&(i=n[s].type)}if(GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle?this.currentState="gwboss":GwBoss.ins().isGwTopBoss?this.currentState="tower":GameMap.fbType==FbCT.FB_TYPE_HIDE_BOSS?this.currentState="hideboss":GameMap.fbType==FbCT.FB_TYPE_STARBOSS?this.currentState="xcboss":GameMap.fbType==FbCT.FB_TYPE_XUANWU?this.currentState="xwdboss":i&&i==BossCT.BOSS_SUBTYPE_VIPBOSS?(this.currentState="gwboss",this.proWordGroup.visible=this.proWordGroup0.visible=this.proWordGroup1.visible=!1):this.currentState="normal",KFBossSys.ins().isKFBossBattle){this.proWordGroup1.visible=!1,this.proWordGroup.visible=!1;for(var o in GlobalConfig.CrossBossConfig){var a=GlobalConfig.CrossBossConfig[o];if(a.fbid==GameMap.fubenID){var r=KFBossSys.ins().getBossShowAward(a.belongRewardshow);r&&(this.belongItem.data=r.shift()),this.belongList.dataProvider=new eui.ArrayCollection(r);break}}}else if(GameMap.fbType==FbCT.FB_TYPE_HIDE_BOSS){var l=BossCT.ins().hideBossData.lastId,h=GlobalConfig.HideBossConfig[l].rewardShow.concat();this.belongItem.data=h.shift(),this.belongList.dataProvider=new eui.ArrayCollection(h)}else if(GameMap.fbType==FbCT.FB_TYPE_XUANWU)for(var s in GlobalConfig.XuanWuBossConfig){var a=GlobalConfig.XuanWuBossConfig[s];if(a.fbid==GameMap.fubenID){var h=XuanWuCT.ins().getBossShowAward(a.belongRewardshow1);this.belongItem.data=h.shift(),this.belongList.dataProvider=new eui.ArrayCollection(h),h=XuanWuCT.ins().getBossShowAward(a.joinRewardshow1),this.joinItem.data=h.shift(),this.joinList.dataProvider=new eui.ArrayCollection(h)}}else if(GameMap.fbType==FbCT.FB_TYPE_37BOSS)for(var s in GlobalConfig.ActivityType37Config){var a=GlobalConfig.ActivityType37Config[s];a.fbid==GameMap.fubenID&&(this.belongItem.data=a.belongRewardshow,this.belongList.dataProvider=new eui.ArrayCollection(a.belongRewardshow1),a.canRewardshow&&(this.joinItem.data=a.canRewardshow,this.joinList.dataProvider=new eui.ArrayCollection(a.canRewardshow1)))}else{var u=GlobalConfig.WorldBossConfig[BossCT.ins().currBossConfigID];this.belongItem.data=u.belongRewardshow,this.belongList.dataProvider=new eui.ArrayCollection(u.belongRewardshow1),u.canRewardshow&&(this.joinItem.data=u.canRewardshow,this.joinList.dataProvider=new eui.ArrayCollection(u.canRewardshow1))}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.openCheck=function(){return BossCT.ins().currBossConfigID?!0:!1},e}(BaseEuiView);__reflect(PublicBossJiangliTipWin.prototype,"PublicBossJiangliTipWin"),ViewManager.ins().reg(PublicBossJiangliTipWin,LayerManager.UI_Popup),window.PublicBossJiangliTipWin=PublicBossJiangliTipWin;var PublicBossMainWin=function(t){function e(){var e=t.call(this)||this;return e.endTime=0,e.actLevel=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.list.itemRenderer=WorldBossItem,this.dropRewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1},e.prototype.open=function(){var t=BossCT.ins().worldBossPlayList[BossCT.BOSS_SUBTYPE_QMBOSS].slice();this.bossImage&&!this.bossImage.parent&&this.bossGroup.addChild(this.bossImage),this.observe(ZsCT.ins().postZsData,this.setActLevel),this.observe(Actor.ins().postLevelChange,this.setActLevel),this.setActLevel(),this.list.dataProvider=new eui.ArrayCollection(t),this.list.selectedIndex=0,this.currData=this.list.dataProvider.getItemAt(0),this.addTouchEvent(this.challengeBtn,this.onTap),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this),this.setWin()},e.prototype.onClickMenu=function(t){this.currData=this.list.dataProvider.getItemAt(t.itemIndex),this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.WorldBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId],i=t.zsLevel>0?t.zsLevel+"转":t.level+"级";this.nameTxt.text=e.name+"("+i+")";var n="无";""!=this.currData.roleName&&(n=this.currData.roleName,""!=this.currData.guildName&&(n=n+"("+this.currData.guildName+")")),2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider=new eui.ArrayCollection(t.showReward),this.playerNameTxt.text=n;var s=BossCT.ins().worldBossLeftTime[BossCT.BOSS_SUBTYPE_QMBOSS];this.leftText.text="挑战剩余次数:"+s+"次",this.endTime=Math.floor((BossCT.ins().worldBossCd[BossCT.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3),this.endTime>0?(this.challengeBtn.visible=!1,this.updateTime(),Timer.start(100,0,this.updateTime,this),n=DateUtils.getFormatBySecond(this.endTime,5,3),this.leftCDText.text="挑战CD:"+n):this.leftCDText.text="",this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)}},e.prototype.updateTime=function(){var t=Math.floor((BossCT.ins().worldBossCd[BossCT.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3);this.leftCDText.text="挑战CD:"+DateUtils.getFormatBySecond(t,5,3),0>=t&&(Timer.stop(this.updateTime,this),this.leftCDText.text="",this.challengeBtn.visible=!0)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:if(Math.floor((BossCT.ins().worldBossCd[BossCT.BOSS_SUBTYPE_QMBOSS]-egret.getTimer())/1e3)>0)return void TipsCT.ins().showTips("挑战CD中");
var e=1e3*ZsCT.ins().lv+Actor.level,i=GlobalConfig.WorldBossConfig[this.currData.id],n=(GlobalConfig.MonstersConfig[i.bossId],1e3*(i.zsLevel||0)+i.level);if(n>e){var s=i.zsLevel>0?i.zsLevel+"转":i.level+"级";return void TipsCT.ins().showTips("只有"+s+"才可以挑战。")}BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH):(ViewManager.ins().close(BossWin),BossCT.ins().sendChallengWorldBoss(this.currData.id,BossCT.BOSS_SUBTYPE_QMBOSS))}},e.prototype.setActLevel=function(){this.actLevel=1e4*ZsCT.ins().lv+Actor.level},e.prototype.close=function(){this.list.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onClickMenu,this)},e}(BaseView);__reflect(PublicBossMainWin.prototype,"PublicBossMainWin"),window.PublicBossMainWin=PublicBossMainWin;var PublicBossRank=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossRankSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.hideBtn,this.onTap),this.myHarm.text="我的伤害：",this.myRank.text="我的排名："},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateRank=function(t){for(var e=(t[0],t[1]),i=Actor.actorID,n=0;3>n;n++)this["rank"+n].text=n+1,this["name"+n].text=e[n]?e[n][1]:"",e[n]?CommonUtils.labelIsOverLenght(this["harm"+n],e[n][2]):this["harm"+n].text="",e[n]&&e[n][0]==i.toString()&&(this.myHarm.text="我的伤害："+this["harm"+n].text,this.myRank.text="我的排名："+this["rank"+n].text)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.hideBtn:var e=egret.Tween.get(this.group);e.to({x:this.hideBtn.selected?480:247},500)}},e}(BaseEuiView);__reflect(PublicBossRank.prototype,"PublicBossRank"),ViewManager.ins().reg(PublicBossRank,LayerManager.UI_Main),window.PublicBossRank=PublicBossRank;var RandBossWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RandBossSkin",this.list.itemRenderer=ItemBase,this.upVip.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("<u>提升"+VipCT.getVipStr()+"等级</u>","#23C42A"))},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.upVip,this.onTap),this.info=this.getUserInfoByItemId(t[0]),this.list.dataProvider=new eui.ArrayCollection(this.info.show);var i=FbCT.ins().bossCallNum,n=this.info.challengeTime[Actor.vip];this.playNum.text=n-i+"/"+n,this.lastNum=n-i,this.bossdesc.text=this.info.titledes},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.upVip,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sure:if(this.lastNum<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:今日召唤次数已用完|");if(Actor.level>=this.info.levelLimit)return FbCT.ins().sendCallBossPlay(this.info.id),ViewManager.ins().close(this),void ViewManager.ins().close(BagWin);TipsCT.ins().showTips("|C:0xf3311e&T:等级达到"+this.info.levelLimit+"级可召唤|");break;case this.upVip:ViewManager.ins().open(VipWin)}},e.prototype.getUserInfoByItemId=function(t){var e=GlobalConfig.OtherBoss2Config;for(var i in e)if(e[i].itemId==t)return e[i];return null},e}(BaseEuiView);__reflect(RandBossWin.prototype,"RandBossWin"),ViewManager.ins().reg(RandBossWin,LayerManager.UI_Main),window.RandBossWin=RandBossWin;var ShieldWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="shieldSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.shieldBtn,this.onTap),this.addTouchEvent(this.sbsyBtn,this.onTap),this.touchEnabled=!1,this.shieldBtn.selected=!EntityHideBody.ins().isShow,CityCC.ins().isCity?this.shieldBtn.bottom=208:this.shieldBtn.bottom=140,GameMap.fbType==FbCT.FB_TYPE_KF_BOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS2||GameMap.fbType==FbCT.FB_TYPE_GUILDFB?this.sbsyBtn.visible=!0:this.sbsyBtn.visible=!1},e.prototype.onTap=function(t){if(t)switch(t.target){case this.shieldBtn:EntityHideBody.ins().setShowState(!this.shieldBtn.selected);break;case this.sbsyBtn:if(BossCT.ins().cdCount){TipsCT.ins().showTips(BossCT.ins().cdCount+"秒后才能进行邀请");break}if(BossCT.ins().cdCount=60,Timer.has(BossCT.ins().resetCD,BossCT.ins())||Timer.start(1e3,0,BossCT.ins().resetCD,BossCT.ins()),GameMap.fbType==FbCT.FB_TYPE_GUILDFB)GuildFBCT.ins().sendHelp("|E:9,"+GuildFBCT.ins().bossId+",&U:&C:65280&T:快速加入");else{var e=GlobalConfig.WorldBossBaseConfig.helpText,i=e.replace("%s",GlobalConfig.CrossBossConfig[KFBossSys.ins().kfBossCfgID].sceneName),n="|C:0x16B2FF&T:"+Actor.myName+"|："+i+"|E:6,"+KFBossSys.ins().kfBossCfgID+",&U:&C:65280&T:快速加入";KFBossSys.ins().helpInfo=n,KFBossSys.ins().sendHelpLottery(n)}TipsCT.ins().showCenterTips2("求助信息已发送")}},e}(BaseEuiView);__reflect(ShieldWin.prototype,"ShieldWin"),ViewManager.ins().reg(ShieldWin,LayerManager.UI_Main),window.ShieldWin=ShieldWin;var WildBossJoinWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WildBossJoinSkin",this.list.itemRenderer=WildBossJoinItem,this.arrCollect=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.arrCollect.source=[],this.list.dataProvider=this.arrCollect},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateRank=function(t){var e=(t[0],t[1]);this.arrCollect.source=e,this.list.dataProvider=this.arrCollect},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WildBossJoinWin.prototype,"WildBossJoinWin"),ViewManager.ins().reg(WildBossJoinWin,LayerManager.UI_Main),window.WildBossJoinWin=WildBossJoinWin;var WorldBossBeKillWin=function(t){function e(){var e=t.call(this)||this;return e.remainM=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossGoldSkin",this.aliveNum=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.reliveBtn,this.onTap),this.addTouchEvent(this.exitBtn,this.onTap),this.setWin()},e.prototype.setWin=function(){if(BossCT.ins().killerHandler>0){var t=EntityManager.ins().getEntityByHandle(BossCT.ins().killerHandler),e="";if(t)if(t instanceof CharRole)e=t.infoModel.name;else if(t.infoModel.masterHandle){var i=EntityManager.ins().getMasterList(EntityManager.ins().getRootMasterHandle(t.infoModel.masterHandle));if(i&&i.length)for(var n=0,s=i;n<s.length;n++){var o=s[n];if(o instanceof CharRole){e=""+o.infoModel.name;break}}e||(e=""+t.infoModel.name)}else e="Boss"+t.infoModel.name;this.killTips.textFlow=(new egret.HtmlTextParser).parser("你被"+StringUtils.addColor(""+e,"#23C42A")+"击败"),this.aliveNum=this.getAliveItem(),this.alive.visible=!!this.aliveNum,this.alive.visible&&(this.alive.text="复活道具 "+this.aliveNum+"/1")}this.reliveBtn.label=BossCT.ins().checkWorldBossNeed()+"原地复活",GameMap.fbType==FbCT.FB_TEAM?(this.reliveBtn.visible=!1,this.moneyIcon.visible=!1):(this.reliveBtn.visible=!0,this.moneyIcon.visible=!0),this.reliveTimesTxt.text=BossCT.ins().reliveTime+"秒",Timer.stop(this.refushLabel,this),this.remainM=BossCT.ins().reliveTime,Timer.start(1e3,this.remainM,this.refushLabel,this),DieGuide.ins().postdieGuide(0)},e.prototype.getAliveItem=function(){if(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian)return 0;var t=CityCC.ins().isCity?GlobalConfig.CityBaseConfig.rebornItem:GlobalConfig.WorldBossBaseConfig.rebornItem,e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t);return e?e.count:0},e.prototype.refushLabel=function(){this.remainM--,this.reliveTimesTxt.text=this.remainM+"秒",this.remainM<=0&&this.overTime()},e.prototype.overTime=function(){ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.reliveBtn:if(this.aliveNum)return void BossCT.ins().sendClearCD();BossCT.ins().checkWorldBossMoney()?BossCT.ins().sendClearCD():TipsCT.ins().showTips("元宝不足，无法立即复活");break;case this.exitBtn:FbCT.ins().sendExitFb()}},__decorate([callLater],e.prototype,"overTime",null),e}(BaseEuiView);__reflect(WorldBossBeKillWin.prototype,"WorldBossBeKillWin"),ViewManager.ins().reg(WorldBossBeKillWin,LayerManager.UI_Popup),window.WorldBossBeKillWin=WorldBossBeKillWin;var PageArray=function(){function t(t,e){void 0===e&&(e=20),this.dataSource=t,this.size=e,this.currentPage=0,this.setPageData()}return Object.defineProperty(t.prototype,"length",{get:function(){return this.dataSource.length},enumerable:!0,configurable:!0}),t.prototype.setPageData=function(){this.pageData=[];for(var t=this.currentPage*this.size,e=(this.currentPage+1)*this.size,i=Math.min(this.length,e),n=t;i>n;n++)this.pageData.push(this.dataSource[n])},t.prototype.getDataSource=function(){return this.dataSource},Object.defineProperty(t.prototype,"totalPage",{get:function(){return Math.ceil(this.length/this.size)},enumerable:!0,configurable:!0}),t.prototype.havePre=function(){return 0!=this.currentPage},t.prototype.haveNext=function(){return this.currentPage<this.totalPage-1},t.prototype.prev=function(){this.currentPage--,this.setPageData()},t.prototype.next=function(){this.currentPage++,this.setPageData()},t.prototype.first=function(){this.currentPage=0,this.setPageData()},t.prototype.last=function(){this.currentPage=this.totalPage-1,this.setPageData()},t.prototype.gotoPage=function(t){this.totalPage<t||(this.currentPage=t-1,this.setPageData())},t}();__reflect(PageArray.prototype,"PageArray");var RegExpUtil=function(){function t(){}return t.LINE_BREAK=/\r+/g,t.BLANK_REG=/[\s\\]/g,t.ARGB_COLOR=/[a-fA-F0-9]{8}/,t.HTML=/<[^>]+>/g,t.DELETE_SPACE=/\s/g,t.REPLACE_STRING=/%s/g,t.NumericExp=/^\d+$/,t.NonNumericExp=/\D/,t.ActorNameExp=/^([\u4e00-\u9fa5]?\w?[^>|!@#$%&*\^\?]){1,48}$/,t.CHAT_EMOJI=/\$[0-9]{1,4}\$/g,t.CHAT_EMOJI_ID=/\$/g,t}();__reflect(RegExpUtil.prototype,"RegExpUtil");var WorldBossJiangliTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WorldBossJiangLiTishiSkin2",e}return __extends(e,t),e.prototype.skinComplete=function(){this.belongList.itemRenderer=ItemBase,this.joinList.itemRenderer=ItemBase,this.addTouchEvent(this,this.otherClose)},e.prototype.addDisplay=function(){var t=GlobalConfig.WorldBossConfig[BossCT.ins().currBossConfigID];this.belongList.dataProvider=new eui.ArrayCollection(t.belongRewardshow1),this.joinList.dataProvider=new eui.ArrayCollection(t.canRewardshow1)},e.prototype.otherClose=function(){ViewManager.ins().close(e)},e.openCheck=function(){return!!BossCT.ins().currBossConfigID},e}(BaseEuiView);__reflect(WorldBossJiangliTipWin.prototype,"WorldBossJiangliTipWin"),ViewManager.ins().reg(WorldBossJiangliTipWin,LayerManager.UI_Popup),window.WorldBossJiangliTipWin=WorldBossJiangliTipWin;var WorldBossJiangLiWin=function(t){function e(){var e=t.call(this)||this;return e.configTimes=0,e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossJiangLiSkin",this.bar.labelDisplay.visible=!1,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.playGroup.visible=!0,this.maxPointGroup.visible=!1,this.myPointGroup.visible=!1,this.addTouchEvent(this.play,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.observe(BossCT.ins().postLotteryRan,this.getMyPoint),this.observe(BossCT.ins().postLotteryResult,this.getMaxPoint),this.observe(GuildWar.ins().postLotteryPoint,this.getMyPoint),this.observe(GuildWar.ins().postLotteryMaxPost,this.getMaxPoint),this.type=0,t[0]?(this.configTimes=GlobalConfig.WorldBossBaseConfig.lotteryTime>0?GlobalConfig.WorldBossBaseConfig.lotteryTime:10,this.type=t[0]):(this.configTimes=10,this.type=0),this.bar.maximum=10*this.configTimes,this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushInfo=function(){this.times=0,0==this.type?this.goods.data={type:1,id:BossCT.ins().worldPrize,count:1}:1==this.type&&(this.goods.data={type:1,id:BossCT.ins().worldPrize,count:1}),Timer.start(100,10*this.configTimes,this.refushBar,this,this.TimeOver,this),this.timeLabel.text=this.configTimes+"秒"},e.prototype.refushBar=function(){this.times++;var t=10*this.configTimes-this.times;this.bar.value=t,this.timeLabel.text=Math.floor(this.configTimes-this.times/10)+"秒",0>=t&&ViewManager.ins().close(e)},e.prototype.TimeOver=function(){ViewManager.ins().close(e)},e.prototype.getMyPoint=function(t){this.play.touchEnabled=!1,this.myPoint.text=t+"",this.myPointGroup.visible=!0},e.prototype.getMaxPoint=function(t){this.maxPoint.text=t[1],this.playerName.text=t[0],this.maxPointGroup.visible=!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.play:0==this.type?BossCT.ins().sendJoinLottery():1==this.type&&GuildWar.ins().sendPlayLotteryInfo(),this.playGroup.visible=!1;break;case this.giveUp:0==this.type?ViewManager.ins().close(e):1==this.type&&ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(WorldBossJiangLiWin.prototype,"WorldBossJiangLiWin"),ViewManager.ins().reg(WorldBossJiangLiWin,LayerManager.UI_Popup),window.WorldBossJiangLiWin=WorldBossJiangLiWin;var WorldBossUiInfo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GRAYIMG_WIDTH=0,e._curMonsterID=0,e._sn_="WorldBossUiSkin",e.lastWeixieList=[],e.isDelayUpdate=!1,e.curValue=1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list1.itemRenderer=WorldBossHeadRender,this.list2.itemRenderer=WorldBossHeadRender,this.list3.itemRenderer=TargetMemberHeadRender,this.list4.itemRenderer=TargetMemberHeadRender,this.list1.name="world.list1",this.list2.name="world.list2",this.list3.name="world.list3",this.list4.name="world.list4",this.list3Dt=new eui.ArrayCollection,this.list3.dataProvider=this.list3Dt,this.list3.touchChildren=!1,this.list4Dt=new eui.ArrayCollection,this.list4.dataProvider=this.list4Dt,this.bloodBar.slideDuration=0,this.bloodBar0.labelFunction=function(){return""},this.grayImg.source="bosshp2",this.GRAYIMG_WIDTH=this.grayImg.width,this.observe(BossCT.ins().postHasAttackChange,this.refushWeixieList),this.observe(BossCT.ins().postCanplayChange,this.refushcanPlayList),this.observe(BossCT.ins().postHpChange,this.reflashBlood),this.observe(BossCT.ins().postShieldPer,this.huDunChange),this.observe(BossCT.ins().postRemainTime,this.reliveInfoChange),this.observe(BossCT.ins().postWorldBossEndTime,this.worldBossEnd),this.observe(GameLogic.ins().postChangeTarget,this.refushcanPlayList),this.observe(GameLogic.ins().postHpChange,this.refushWeixieList),this.list2.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.list2Tap,this),this.addTouchEvent(this.btn,this.onTap),this.addTouchEvent(this.attackBoss,this.onTap),this.addTouchEvent(this.attackPlayer,this.onTap),this.addTouchEvent(this.belongGroup,this.onTap),this.addTouchEvent(this.tipBtn,this.onTap),this.addTouchEvent(this.attguishu,this.onTap),this.addTouchEvent(this.sbsyBtn,this.onTap),Timer.stop(this.reflashAtkInfo,this),Timer.start(200,0,this.reflashAtkInfo,this)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.hudun.visible=!1,this.visible=!0,this.attList.visible=this.attackBtnGroup.visible=""==BossCT.ins().winner,this.updateBaseInfo(),this.refushShowInfo(),this.reflashAtkInfo(),this.refushWeixieList(),this.refushcanPlayList(),this.reflashBlood()},e.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[BossCT.ins().monsterID],this.bossConfig&&(this._curMonsterID=BossCT.ins().monsterID,this.nameTxt.text=this.bossConfig.name,this.head.source="monhead"+this.bossConfig.head+"_png",this.lvTxt.text="Lv."+this.bossConfig.level)},e.prototype.refushShowInfo=function(){this.leftTimeGroup.visible=!1,this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4),Timer.has(this.showInfoTime,this)||Timer.start(1e3,GuildWar.ins().getModel().acEndTime,this.showInfoTime,this)},e.prototype.showInfoTime=function(){this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)},e.prototype.checkBqPd=function(){return 7003==GameMap.mapID||7004==GameMap.mapID||5211==GameMap.mapID||5212==GameMap.mapID||5213==GameMap.mapID||5214==GameMap.mapID},e.prototype.refreshStarBossList=function(){if(GameMap.fbType==FbCT.FB_TYPE_STARBOSS||GameMap.fbType==FbCT.FB_TYPE_XUANWU||GameMap.fbType==FbCT.FB_TYPE_37BOSS){this.attList1.visible=!0;var t=EntityManager.ins().getAllEntity(),e=[],i=[];for(var n in t){var s=t[n].infoModel;if(!s.isMy&&t[n]instanceof CharRole&&t[n].getHP()>0){var o=s.masterHandle;Guild.ins().guildID&&s.guildID==Guild.ins().guildID?i.indexOf(o)<0&&i.push(o):e.indexOf(o)<0&&e.push(o)}}this.list3.dataProvider=this.list3Dt,i.length>0?(this.tonghanghuiGroup.visible=!0,this.list3Dt.replaceAll(i)):this.tonghanghuiGroup.visible=!1,e.length>0?(this.canAttackGroup.visible=!0,this.list4Dt.replaceAll(e)):this.canAttackGroup.visible=!1}else this.attList1.visible=!1},e.prototype.reflashAtkInfo=function(){this.refreshStarBossList();var t=EntityManager.ins().getMasterList(BossCT.ins().attHandle);if(t&&t.length>0){for(var e=t.length,i=0,n=0,s=0,o=0,a=void 0,r=void 0,l=0;e>l;l++){var h=t[l];if(h instanceof CharRole){var u=h.infoModel.getAtt(AttributeType.atHp)||0,p=h.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=u,n+=p;var c=h.infoModel.getAtt(AttributeType.cruNeiGong)||0,d=h.infoModel.getAtt(AttributeType.maxNeiGong)||0;s+=c,o+=d,a||(a=h.infoModel),r=h}}if(r&&(this.curBelongRoleData=r),Assert(a,"WorldBossUIInfo 归属者："+t[0].infoModel.name+",fbType:"+GameMap.fbType+",fbId:"+GameMap.fubenID))return void(this.belongGroup.visible=!1);this.belongGroup.visible=i>0&&""==BossCT.ins().winner,this.sameHanghui.visible=!r.isMy&&Guild.ins().guildID&&a.guildID==Guild.ins().guildID&&!this.checkBqPd();var g=Actor.handle!=BossCT.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN,f=a.name,v=f.split("\n");f=v[1]?v[1]:v[0],f=StringUtils.replaceStr(f,"0xffffff",g+""),this.belongNameTxt.textFlow=TextFlowMaker.generateTextFlow("|C:"+g+"&T:"+f),this.roleHead.source="yuanhead"+a.job+a.sex,this.bloodBar0.maximum=n,this.bloodBar0.value=i,this.neigongBar0.maximum=o,this.neigongBar0.value=s}else this.belongGroup.visible=!1;this.sbsyBtn.visible=GameMap.fbType==FbCT.FB_TYPE_STARBOSS||GameMap.fbType==FbCT.FB_TYPE_XUANWU},e.prototype.refushWeixieList=function(){this.isDelayUpdate||(this.isDelayUpdate=!0,Timer.start(500,1,this.updateWeixieList,this))},e.prototype.updateWeixieList=function(){this.isDelayUpdate=!1,BossCT.ins().weixieList.length>this.lastWeixieList.length&&this.showAttGroupEff();var t=this.getWeixieList();if(this.list2.dataProvider){var e=this.list2.dataProvider;e.replaceAll(t)}else this.list2.dataProvider=new eui.ArrayCollection(t);if(this.lastWeixieList=BossCT.ins().weixieList.slice(),this.list1.dataProvider){var e=this.list1.dataProvider;e.replaceAll([GameLogic.ins().currAttackHandle])}else this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle]);this.checkListVis(),BossCT.ins().weixieList.length&&this.checkGuide()},e.prototype.getWeixieList=function(){for(var t=BossCT.ins().weixieList,e=[],i=0,n=t;i<n.length;i++){var s=n[i],o=EntityManager.ins().getMasterList(s),a=void 0;if(o&&o.length)for(var r=0,l=o;r<l.length;r++){var h=l[r];if(h instanceof CharRole){a=h;break}}else a=EntityManager.ins().getEntityByHandle(s);a&&e.push(a)}return e},e.prototype.showAttGroupEff=function(){var t=this;if(!this.attEffectGroup.visible){this.attEffectGroup.touchEnabled=!1,this.attEffectGroup.visible=!0;var e=egret.Tween.get(this.attEffectGroup);e.to({alpha:1},500).to({alpha:0},500).to({alpha:1},500).to({alpha:0},500).call(function(){t.attEffectGroup.visible=!1},this)}},e.prototype.refushcanPlayList=function(){this.reflashAtkInfo(),this.checkListVis(),this.refushWeixieList()},e.prototype.checkListVis=function(){var t=SubRoles.lookAtTar,e=t&&t.infoModel.getAtt(AttributeType.atHp)>0&&""==BossCT.ins().winner;this.beAttackGroup.visible=BossCT.ins().weixieList.length>0&&e,this.attackGroup.visible=e,this.setBtnState(e)},e.prototype.checkGuide=function(){1==FbCT.ins().guideBossKill&&GuideUtils.ins().updateByAppear()},e.prototype.setBtnState=function(t){return this.curBelongRoleData?GameMap.fbType!=FbCT.FB_TYPE_STARBOSS&&GameMap.fbType!=FbCT.FB_TYPE_XUANWU&&GameMap.fbType!=FbCT.FB_TYPE_37BOSS||this.curBelongRoleData.isMy||!Guild.ins().guildID||Guild.ins().guildID!=this.curBelongRoleData.infoModel.guildID?this.attguishu.visible=!0:this.attguishu.visible=!1:this.attguishu.visible=!0,t?(BossCT.ins().attHandle==Actor.handle?(this.attackPlayer.currentState="attgsdis",this.attguishu.visible=!1):GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle!=BossCT.ins().bossHandler?this.attackPlayer.currentState="attgsing":this.attackPlayer.currentState="attgsup",void(GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==BossCT.ins().bossHandler?this.attackBoss.currentState="attbossing":this.attackBoss.currentState="attbossup")):(this.attackPlayer.currentState="attgsup",void(this.attackBoss.currentState="attbossup"))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn:"down"==this.btn.currentState?this.list1.dataProvider=new eui.ArrayCollection([]):this.refushcanPlayList();break;case this.attackBoss:if(0==GameLogic.ins().currAttackHandle)return;this.clearRendererItem(),GameLogic.ins().postChangeAttrPoint(0);break;case this.attackPlayer:case this.belongGroup:if(BossCT.ins().attHandle==Actor.handle||BossCT.ins().attHandle==GameLogic.ins().currAttackHandle)return;if(!this.list1.dataProvider||this.list1.dataProvider.length<=0)return;if(!BossCT.ins().canClick)return;this.clearRendererItem(),GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS?FbCT.ins().sendGuideFbAttacker():GameLogic.ins().postChangeAttrPoint(BossCT.ins().attHandle);break;case this.tipBtn:GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS?ViewManager.ins().open(WorldBossJiangliTipWin):ViewManager.ins().open(PublicBossJiangliTipWin);break;case this.attguishu:TipsCT.ins().showTips("正在攻击归属者！");break;case this.sbsyBtn:var e=GlobalConfig.WorldBossBaseConfig.helpText,i=e.replace("%s",GlobalConfig.WorldBossConfig[BossCT.ins().currBossConfigID].showName);if(BossCT.ins().cdCount){TipsCT.ins().showTips(BossCT.ins().cdCount+"秒后才能进行邀请");break}BossCT.ins().cdCount=60,Timer.has(BossCT.ins().resetCD,BossCT.ins())||Timer.start(1e3,0,BossCT.ins().resetCD,BossCT.ins()),BossCT.ins().sendHelpLottery("|C:0x16B2FF&T:"+Actor.myName+"|："+i+"|E:3,"+BossCT.ins().currBossConfigID+","+BossCT.ins().currBossSubType+",&U:&C:65280&T:快速加入"),TipsCT.ins().showCenterTips2("求助信息已发送")}},e.prototype.list2Tap=function(t){if(BossCT.ins().canClick&&BossCT.ins().attHandle!=GameLogic.ins().currAttackHandle){var e=this.list2.getChildAt(t.itemIndex);if(e){this.clearRendererItem(),e.addAttEffect();var i=e.data;e.data instanceof CharMonster&&(i=e.data.infoModel.masterHandle),GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS?FbCT.ins().sendGuideFbAttacker():GameLogic.ins().postChangeAttrPoint(i),BossCT.ins().attHandle!=i&&EntityShowMgr.ins().showHideSomeOne(i)}}},e.prototype.clearRendererItem=function(){for(var t=this.list1.numChildren,e=0;t>e;e++){var i=this.list1.getChildAt(e);i.clearEffect()}t=this.list2.numChildren;for(var e=0;t>e;e++){var i=this.list2.getChildAt(e);i.clearEffect()}},e.prototype.getXinShou=function(){return this.list2.getChildAt(0).roleHead},e.prototype.reflashBlood=function(){if(this._curMonsterID!=BossCT.ins().monsterID&&this.updateBaseInfo(),this.bossConfig=GlobalConfig.MonstersConfig[BossCT.ins().monsterID],!this.bossConfig)return this.bossBloodGroup.visible=!1,void this.checkListVis();var t=EntityManager.ins().getEntityByHandle(BossCT.ins().bossHandler);if(!t||!t.infoModel)return this.bossBloodGroup.visible=!1,void this.checkListVis();var e=t?t.infoModel:null;e?(this.bloodBar.maximum=e.getAtt(AttributeType.atMaxHp),this.bloodBar.value=e.getAtt(AttributeType.atHp),this.bossBloodGroup.visible=this.bloodBar.value>0):(this.bloodBar.maximum=this.bossConfig.hp,this.bloodBar.value=this.bossConfig.hp,this.bossBloodGroup.visible=this.bloodBar.value>0),this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood()},e.prototype.huDunChange=function(){BossCT.ins().shieldType?BossCT.ins().curShield>0&&(Timer.has(this.setTimeShieldChange,this)||Timer.start(1e3,0,this.setTimeShieldChange,this),this.setTimeShieldChange()):this.setHpShieldChange()},e.prototype.setHpShieldChange=function(){BossCT.ins().curShield&&BossCT.ins().curShield>0?(this.hudun.visible=!0,this.hudunbloodBar.value=Math.ceil(BossCT.ins().curShield/BossCT.ins().totalShield*100)):this.hudun.visible=!1},e.prototype.setTimeShieldChange=function(){this.hudunbloodBar.value=BossCT.ins().curShield,this.hudunbloodBar.maximum=BossCT.ins().totalShield,BossCT.ins().curShield>0?this.hudun.visible=!0:(Timer.stop(this.setTimeShieldChange,this),this.hudun.visible=!1),BossCT.ins().curShield--},e.prototype.worldBossEnd=function(){var t=this;if(Timer.stop(this.reflashAtkInfo,this),GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS){this.endGroup.visible=!0,this.winnerName.text="最终归属者是："+BossCT.ins().winner;var e=Math.ceil((BossCT.ins().worldBossEndTime-egret.getTimer())/1e3);this.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),Timer.start(1e3,e,function(){e--,t.leftTime.text=DateUtils.getFormatTimeByStyle(e,DateUtils.STYLE_4),0==e&&FbCT.ins().sendExitFb()},this)}this.attList.visible=this.attackBtnGroup.visible=this.attackPlayer.visible=this.attackBoss.visible=!1},e.prototype.reliveInfoChange=function(){BossCT.ins().reliveTime>0?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin),this.refushWeixieList()},e.prototype.tweenBlood=function(){var t=this,e=this.curValue*this.GRAYIMG_WIDTH/100;if(egret.Tween.removeTweens(this.grayImg),!(3>e)){var i=egret.Tween.get(this.grayImg);i.to({width:e-3},1e3).call(function(){0>=e&&(t.grayImg.width=t.GRAYIMG_WIDTH,egret.Tween.removeTweens(t.grayImg))})}},e}(BaseEuiView);__reflect(WorldBossUiInfo.prototype,"WorldBossUiInfo"),ViewManager.ins().reg(WorldBossUiInfo,LayerManager.UI_Main),window.WorldBossUiInfo=WorldBossUiInfo;var WorldBossWin=function(t){function e(){var e=t.call(this)||this;return e.selectIndex=0,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WorldBossSkin",this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=330,this.bossImage.y=380,this.challengeBtn.y=400},e}(BaseEuiView);__reflect(WorldBossWin.prototype,"WorldBossWin"),ViewManager.ins().reg(WorldBossWin,LayerManager.UI_Main),window.WorldBossWin=WorldBossWin;var NewBossJiangliView=function(t){function e(){var e=t.call(this)||this;return e.skinName="wpkBossJiangLiTishiSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.giveUp,this.onTap),this.initView()},e.prototype.initView=function(){var t=GlobalConfig.NewWorldBossBaseConfig.showDrows;this.endItem0.data=t[0],this.endItem1.data=t[1],this.belongItem.data=GlobalConfig.NewWorldBossRankConfig[1][1].rewardc[0],this.joinItem.data=GlobalConfig.NewWorldBossRankConfig[1][4].rewardc[0],this.endItem0.isShowName(!1),this.endItem1.isShowName(!1),this.belongItem.isShowName(!1),this.joinItem.isShowName(!1)},e.prototype.onTap=function(t){var e=t.currentTarget;(e==this.closeBtn||e==this.giveUp)&&ViewManager.ins().close(this)},e.prototype.close=function(){},e}(BaseEuiView);__reflect(NewBossJiangliView.prototype,"NewBossJiangliView"),ViewManager.ins().reg(NewBossJiangliView,LayerManager.UI_Popup),window.NewBossJiangliView=NewBossJiangliView;var NewWorldBossUIView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.GRAYIMG_WIDTH=0,e.leftTime=0,e._curMonsterID=0,e._sn_="wpkBossUiSkin",e.curValue=1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.bossBloodGroup.visible=!1,this.leftTimeGroup.visible=!1,this.dropDown.visible=!1,this.dropDown.setEnabled(!1),this.attList.visible=!1,this.attList0.visible=!1,this.grayImg.source="bosshp2",this.GRAYIMG_WIDTH=this.grayImg.width,this.addTouchEvent(this.guwu,this.onTap),this.addTouchEvent(this.tipBtn0,this.onTap)},e.prototype.addDisplay=function(){this.observe(BossCT.ins().postHpChange,this.reflashBlood),this.observe(BossCT.ins().postBossAppear,this.reflashBlood),this.observe(BossCT.ins().postNewBossReliveTime,this.updateReliveTime),this.observe(BossCT.ins().postNewBossOpen,this.updateTime),this.observe(BossCT.ins().postNewBossRank,this.updateRank),this.observe(BossCT.ins().postAddAttrNum,this.updateAttr),this.initView()},e.prototype.initView=function(){this.updateTime(),this.updateReliveTime(),this.updateAttr(),this.dropDown.currentState="down",this.bossConfig=GlobalConfig.MonstersConfig[BossCT.ins().monsterID],this.bossConfig&&(this.updateBaseInfo(),this.reflashBlood())},e.prototype.updateTime=function(){var t=BossCT.ins().newWorldBossData.startTime,e=BossCT.ins().newWorldBossData.isOpen;if(!e||!t)return void(this.leftTimeGroup.visible=!1);var i=Math.floor((GameServer.serverTime-t)/1e3);return 0>=i||i>=GlobalConfig.NewWorldBossBaseConfig.bossTime?void(this.leftTimeGroup.visible=!1):(this.leftTimeGroup.visible=!0,this.leftTime=GlobalConfig.NewWorldBossBaseConfig.bossTime-i,Timer.has(this.setTime,this)||Timer.start(1e3,0,this.setTime,this),void this.setTime())},e.prototype.setTime=function(){this.lastTime.text=DateUtils.getFormatBySecond(this.leftTime,DateUtils.TIME_FORMAT_10),this.leftTime>0&&(this.leftTime-=1)},e.prototype.updateReliveTime=function(){BossCT.ins().reliveTime>0?ViewManager.ins().open(WorldBossBeKillWin):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.updateBaseInfo=function(){this.bossConfig=GlobalConfig.MonstersConfig[BossCT.ins().monsterID],this.bossConfig&&(this._curMonsterID=BossCT.ins().monsterID,this.nameTxt.text=this.bossConfig.name,this.head.source="monhead"+this.bossConfig.head+"_png",this.lvTxt.text="Lv."+this.bossConfig.level)},e.prototype.reflashBlood=function(){if(this._curMonsterID!=BossCT.ins().monsterID&&this.updateBaseInfo(),this.bossConfig=GlobalConfig.MonstersConfig[BossCT.ins().monsterID],!this.bossConfig)return this.bossBloodGroup.visible=!1,void(this.leftTimeGroup.visible=!1);var t=EntityManager.ins().getEntityByHandle(BossCT.ins().bossHandler);if(!t||!t.infoModel||t.infoModel.getAtt(AttributeType.atHp)<=0)return this.bossBloodGroup.visible=!1,void(this.leftTimeGroup.visible=!1);var e=t?t.infoModel:null;e?(this.bloodBar.maximum=e.getAtt(AttributeType.atMaxHp),this.bloodBar.value=e.getAtt(AttributeType.atHp)):(this.bloodBar.maximum=this.bossConfig.hp,this.bloodBar.value=this.bossConfig.hp),this.bossBloodGroup.visible||(this.leftTimeGroup.visible=!1),this.dropDown.visible=!0,this.updateRank(),this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood()},e.prototype.tweenBlood=function(){var t=this,e=this.curValue*this.GRAYIMG_WIDTH/100;if(egret.Tween.removeTweens(this.grayImg),!(3>e)){var i=egret.Tween.get(this.grayImg);i.to({width:e-3},1e3).call(function(){0>=e&&(t.grayImg.width=t.GRAYIMG_WIDTH,egret.Tween.removeTweens(t.grayImg))},this)}},e.prototype.updateRank=function(){var t=BossCT.ins().newWorldBossData.rankList?BossCT.ins().newWorldBossData.rankList.concat():[],e=t.length;
if(e){e>10&&(e=10);var i=t.slice(1,e);this.dropDown.setData(i),this.dropDown.setLabel(t[0].roleName+":"+CommonUtils.overLength(t[0].value))}else this.dropDown.setData([]),this.dropDown.setLabel("");for(var n=0;n<t.length;n++)if(t[n].id==Actor.actorID){var s=CommonUtils.overLength(t[n].value);this.myTxt.text="自己："+s;break}},e.prototype.updateAttr=function(){var t=BossCT.ins().newWorldBossData.addAttrNum||0,e=GlobalConfig.NewWorldBossAttrConfig[t],i=GlobalConfig.NewWorldBossAttrConfig[t+1],n="",s={type:0,value:0},o={type:0,value:0};if(i){for(var a=0;a<i.attr.length;a++)a>0&&(n+="\n"),o.type=i.attr[a].type,o.value=i.attr[a].value,s.type=o.type,s.value=0,e&&e.attr[a]&&(s.value=e.attr[a].value),n+=AttributeData.getAttStrByType(s,0,":",!1),o.value-=s.value,n+=AttributeData.getAttStrByType(o,0,"+",!1,!1);this.costGroup.parent||this.timeGroup.addChildAt(this.costGroup,0)}else{for(var a=0;a<e.attr.length;a++)a>0&&(n+="\n"),n+=AttributeData.getAttStrByType(e.attr[a],0,":",!1);this.costGroup.parent&&this.costGroup.parent.removeChild(this.costGroup)}this.guwuNum.text=n,this.guwutime.text=t+"/"+Object.keys(GlobalConfig.NewWorldBossAttrConfig).length;var r=i||e;1==r.type?this.typeImg.source="szjinbi":2==r.type&&(this.typeImg.source="szyuanbao"),this.cost.text=r.count+""},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.guwu){if(BossCT.ins().newWorldBossData.addAttrNum==Object.keys(GlobalConfig.NewWorldBossAttrConfig).length)return void TipsCT.ins().showTips("鼓舞次数已用完");var i=BossCT.ins().newWorldBossData.addAttrNum||0,n=GlobalConfig.NewWorldBossAttrConfig[i+1];if(n){if(1==n.type&&Actor.gold<n.count)return void TipsCT.ins().showTips("金币不足");if(2==n.type&&Actor.yb<n.count)return void TipsCT.ins().showTips("元宝不足")}BossCT.ins().sendBuyAddAttrNum()}else e==this.tipBtn0&&ViewManager.ins().open(NewBossJiangliView)},e.prototype.removeDisplay=function(){Timer.stopAll(this),this._curMonsterID=0},e}(BaseEuiView);__reflect(NewWorldBossUIView.prototype,"NewWorldBossUIView"),ViewManager.ins().reg(NewWorldBossUIView,LayerManager.UI_Main),window.NewWorldBossUIView=NewWorldBossUIView;var NewWorldBossWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=0,this.bossImage.y=215,this.boss.addChild(this.bossImage),this.list.itemRenderer=ItemBaseNoName,this.eTimeLab.name=this.eTimeLab.text,BossCT.ins().sendGetNewBossInfo(),this.addTouchEvent(this.enter,this.onTap),this.addTouchEvent(this.help,this.onTap)},e.prototype.addDisplay=function(){this.observe(BossCT.ins().postNewBossInfo,this.update),this.observe(BossCT.ins().postNewBossOpen,this.updateOpen),this.update(),this.updateOpen()},e.prototype.updateOpen=function(){var t=new Date(GameServer.serverTime).setHours(19,30,0,0),e=BossCT.ins().newWorldBossData.isOpen,i=Math.floor((GameServer.serverTime-t)/1e3);0>i?(this.enter.visible=!1,this.eTimeLab.text=this.eTimeLab.name):1==e?this.enter.visible=!0:(this.enter.visible=!1,this.eTimeLab.text="今日已经结束"),this.eTimeLab.visible=!this.enter.visible},e.prototype.update=function(){var t=BossCT.ins().newWorldBossData.bossID,e=GlobalConfig.MonstersConfig[t];e&&(this.nameTxt.text=e.name+"("+e.level+")",this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.NewWorldBossBaseConfig.showAwards),this.bar.maximum=e.hp,this.bar.value=BossCT.ins().newWorldBossData.curHp)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e==this.enter){if(!KfArenaSys.ins().checkIsMatching())return;if(BossCT.ins().newWorldBossData.startTime>GameServer.serverTime){var i=new Date(BossCT.ins().newWorldBossData.startTime),n=i.getHours()+"点"+(i.getMinutes()?i.getMinutes()+"分":"");return void TipsCT.ins().showTips("每天"+n+"开启，请按时参加")}if(!BossCT.ins().checkNewWorldBossOpen())return void TipsCT.ins().showTips(GlobalConfig.NewWorldBossBaseConfig.openLv+"级才可以参加");BossCT.ins().sendIntoNewBoss(),ViewManager.ins().close(this)}else e==this.help?ViewManager.ins().open(ZsBossRuleSpeak,15):e==this.bgClose&&ViewManager.ins().close(this)},e}(BaseView);__reflect(NewWorldBossWin.prototype,"NewWorldBossWin"),window.NewWorldBossWin=NewWorldBossWin;var BtnHejiWin=function(t){function e(){var e=t.call(this)||this;return e.curState=!1,e.skinName="BtnHejiSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.heji,this.onTap),this.curState=Setting.ins().getValue(ClientSet.autoHeji)&&LianJiCT.ins().auto,this.hejiState(this.curState)},e.prototype.onTap=function(){var t=this.curState=!this.curState;this.hejiState(t),Setting.ins().setValue(ClientSet.autoHeji,+t),LianJiCT.ins().sendAuto(+t)},e.prototype.hejiState=function(t){this.heji.icon=t?"noheji_png":"heji_png"},e}(BaseEuiView);__reflect(BtnHejiWin.prototype,"BtnHejiWin"),ViewManager.ins().reg(BtnHejiWin,LayerManager.UI_Main),window.BtnHejiWin=BtnHejiWin;var CardActBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActBtnSkin",DisplayUtils.removeFromParent(e.mc),e.mc=null,e}return __extends(e,t),e.prototype.dataChanged=function(){this.iconDisplay.source=this.data.icon;var t=!1;switch(this.data.id){case 0:t=!1;break;case 1:t=Recharge.ins().franchise&&Recharge.ins().franchiseget?!0:!1;break;case 2:t=!1}t?(this.mc||(this.mc=new MovieClip,this.mc.x=36,this.mc.y=36),this.mc.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.addChild(this.mc)):(DisplayUtils.removeFromParent(this.mc),this.mc=null),this.redPoint.visible=t},e}(BaseItemRender);__reflect(CardActBtnRenderer.prototype,"CardActBtnRenderer"),window.CardActBtnRenderer=CardActBtnRenderer;var CardGiftWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="CardgiftSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.btn.label=106*Recharge.getChannelMulti()+"元抢购",this.addTouchEvent(this.btn,this.onTap),this.setIconEff(),this.depictLabel.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.MonthCardConfig.rightDesc)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn:var e=GlobalConfig.MonthCardConfig.monthCardAndPrivilegeRid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.MonthCardConfig.monthCardAndPrivilegeMoney,ShowRechargeType.Type_Cardgift):Recharge.ins().sendPayOrder(e)}},e.prototype.setIconEff=function(){this.mc||(this.mc=new MovieClip),this.mc.parent||this.mcgroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"Titlezztq_big",-1)},e}(BaseView);__reflect(CardGiftWin.prototype,"CardGiftWin"),window.CardGiftWin=CardGiftWin;var CardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arrList=new eui.ArrayCollection,e._datas=[],e.curPage=0,e._sn_="CardSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.iconList.itemRenderer=CardActBtnRenderer,this.observe(Recharge.ins().postFranchiseInfo,this.updateMenuList),this.addChangeEvent(this.iconList,this.onClickMenu),this.iconList.dataProvider=this.arrList,this.curPage=t&&t[0]?t[0]:0,this.updateMenuList(),this.checkPanel()},e.prototype.checkPanel=function(){urlParam.isMiniGame&&urlParam.appid!=PlatFormID.QQ_MINI||this.weekCardWin&&this.weekCardWin.parent&&DisplayUtils.removeFromParent(this.weekCardWin)},e.prototype.onClickMenu=function(t){SoundUtil.play(SoundEnum.WINDOW),this.curPage=this.iconList.selectedIndex,this.viewStack.selectedIndex=this.curPage},e.prototype.updateMenuList=function(){this._datas=[];for(var t in GlobalConfig.CardBtnConfig)(urlParam.isMiniGame&&urlParam.appid!=PlatFormID.QQ_MINI||2!=GlobalConfig.CardBtnConfig[t].id)&&3!=GlobalConfig.CardBtnConfig[t].id&&this._datas.push(GlobalConfig.CardBtnConfig[t]);this.arrList.replaceAll(this._datas),this.iconList.selectedIndex=this.curPage},e.openCheck=function(){return LocationProperty.isIosTS?!1:urlParam.nofr?!1:Recharge.ins().isOpenIosRecharge?OpenSystem.ins().checkSysOpen(SystemType.MONTHCARD):!1},e}(BaseEuiView);__reflect(CardWin.prototype,"CardWin"),window.CardWin=CardWin,ViewManager.ins().reg(CardWin,LayerManager.UI_Main);var MonthbossNoticeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MonthbossNoticeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cfg=t[0],this.sureBtn.label=0==FbCT.ins().fbFirstLogs[this.cfg.id]?"立刻体验":"立刻激活"},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.sureBtn:0==FbCT.ins().fbFirstLogs[this.cfg.id]?BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?ViewManager.ins().open(BagFullTipsWin):FbCT.ins().sendChallenge(this.cfg.id):ViewManager.ins().open(FuliWin,4),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(MonthbossNoticeWin.prototype,"MonthbossNoticeWin"),window.MonthbossNoticeWin=MonthbossNoticeWin,ViewManager.ins().reg(MonthbossNoticeWin,LayerManager.UI_Popup);var WeekcardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WeekcardSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.btn0.label=6*Recharge.getChannelMulti()+"元抢购",this.observe(Recharge.ins().postGetWeekDay,this.update),this.addTouchEvent(this.btn0,this.onTap),this.update()},e.prototype.update=function(){Timer.stop(this.setTimeLbel,this),Recharge.ins().weekDay>0&&(Timer.start(1e3,0,this.setTimeLbel,this),this.setTimeLbel()),this.leftTime0.visible=Recharge.ins().weekDay>0},e.prototype.setTimeLbel=function(){var t=Recharge.ins().weekDay/1e3;if(t>0){var e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,1);e="<font color='#35e62d'>剩余时间:"+e+"</font>",this.leftTime0.textFlow=(new egret.HtmlTextParser).parser(e)}else Timer.stop(this.setTimeLbel,this),this.leftTime0.visible=!1},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn0:var e=GlobalConfig.WeekCardConfig.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.WeekCardConfig.weekCardMoney,ShowRechargeType.Type_WeekCard):Recharge.ins().sendPayOrder(e)}},e}(BaseView);__reflect(WeekcardWin.prototype,"WeekcardWin"),window.WeekcardWin=WeekcardWin;var CDKey=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.CDKey,e.regNetMsg(1,e.doChangeResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendCdkey=function(t){if(t.length<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:请输入激活码|");var e=this.getBytes(1);e.writeString(t),this.sendToServer(e)},e.prototype.doChangeResult=function(t){var e,i=t.readByte();switch(i){case 0:e="|C:0x35e62d&T:兑换成功,请在邮件中领取奖励|";break;case 1:e="|C:0xf3311e&T:激活码已被使用|";break;case 2:e="|C:0xf3311e&T:激活码不存在|";break;case 3:e="|C:0xf3311e&T:已使用过同类型|";break;case 4:e="|C:0xf3311e&T:兑换失败|"}TipsCT.ins().showTips(e)},e}(BaseSystem);__reflect(CDKey.prototype,"CDKey"),System.CDKey=function(){return CDKey.ins()},window.CDKey=CDKey;var CDKeyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CDkeySkin",this.input.maxChars=28},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sendBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.sendBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e);break;case this.sendBtn:CDKey.ins().sendCdkey(this.input.text)}},e}(BaseEuiView);__reflect(CDKeyWin.prototype,"CDKeyWin"),ViewManager.ins().reg(CDKeyWin,LayerManager.UI_Main),window.CDKeyWin=CDKeyWin;var ChatCT=function(t){function e(){var e=t.call(this)||this;return e.isShowTip=!1,e.chatInterval=5e3,e.charMax=50,e.canSpeak=!0,e.UpSpeak="",e.canSpeakTime=0,e.info=[],e.cdCount=0,e.initData(),e.sysId=PackageID.Chat,e.regNetMsg(1,e.doNewChatMsg),e.regNetMsg(2,e.doSystemInfo),e.regNetMsg(3,e.doIsSendSuccess),e.regNetMsg(4,e.doSystemMessage),e.regNetMsg(5,e.doCannotSpeak),e.observe(RoleMgr.ins().postEnterGame,e.initData),e}return __extends(e,t),e.prototype.initData=function(){this._chatListData||(this._chatListData=new eui.ArrayCollection),this._systemListData||(this._systemListData=new eui.ArrayCollection),this._chatListData2||(this._chatListData2=new eui.ArrayCollection),this._chatKuaFuListData||(this._chatKuaFuListData=new eui.ArrayCollection),this._chatListData.removeAll(),this._systemListData.removeAll(),this._chatListData2.removeAll(),this._chatKuaFuListData.removeAll()},e.ins=function(){return t.ins.call(this)},e.prototype.sendChatInfo=function(t,e,i){return void 0===i&&(i=0),__awaiter(this,void 0,void 0,function(){var n,s,o,a,r,l,h,u;return __generator(this,function(p){switch(p.label){case 0:return"@"==e.charAt(0)?(n=this.getBytes(0),n.writeString(e),this.sendToServer(n),[2]):(s=[null,TagChanneID.ciChannelAll,TagChanneID.ciChannelGuild,TagChanneID.ciChannelSecret,TagChanneID.ciChannelBigTeam,null,TagChanneID.ciChannelKuaFu],o=s.indexOf(t),0>o&&(o=5),[4,platform.checkStr(e,1,o)]);case 1:return a=p.sent(),r=a.result,l=a.content,h=2+("self"==r?1:0),u=this.getBytes(1),u.writeByte(t),u.writeInt(i),u.writeString(l),u.writeByte(h),this.sendToServer(u),[2]}})})},e.prototype.doNewChatMsg=function(t){var e=new ChatInfoData(t);-1==Friends.ins().indexOfBlackList(e.id)&&this.insertChatMsg(e)},e.prototype.insertChatMsg=function(t){if(this._chatListData||(this._chatListData=new eui.ArrayCollection),this._chatListData.length>=this.charMax){var e=this._chatListData.removeItemAt(0);this.removeAllChatMsg(e)}t.type==TagChanneID.ciChannelKuaFu?this._chatKuaFuListData.addItem(t):this._chatListData.addItem(t),this.insertAllChatMsg(t),this.postNewChatMsg(t)},e.prototype.resetCD=function(){for(var t in this.info)this.info[t].cd>0?this.info[t].cd--:this.info[t].cd=0;0==this.info.length&&Timer.stop(this.resetCD,this)},e.prototype.insertAllChatMsg=function(t){var e=this;this._chatListData2||(this._chatListData2=new eui.ArrayCollection);var i=3==t.type&&!!t.str&&t.str==BossCT.ins().helpInfo||1==t.type&&!!t.content&&t.content==KFBossSys.ins().helpInfo,n=3==t.type&&!!t.str&&t.str==RareAnimalCT.ins().helpInfo||1==t.type&&!!t.content&&t.content==Mine.ins().helpInfo;(i||n)&&0==this._chatListData2.length?Timer.start(5e3,1,function(){e._chatListData2.addItem(t)},this):this._chatListData2.addItem(t),i&&(t.cd=120,this.info.push(t)),n&&(Mine.ins().cdCount=t.cd=60,this.info.push(t)),Timer.has(this.resetCD,this)||Timer.start(1e3,0,this.resetCD,this),!Timer.has(this.updateTime,this)&&this.info.length>0&&Timer.start(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){for(var t in this.info)!this.info[t].cd&&this._chatListData2.getItemIndex(this.info[t])>=0&&(this._chatListData2.removeItemAt(this._chatListData2.getItemIndex(this.info[t])),this.info.splice(this.info.indexOf(this.info[t]),1));0==this.info.length&&Timer.stop(this.updateTime,this)},e.prototype.removeAllChatMsg=function(t){var e=this._chatListData2.getItemIndex(t);e>=0&&this._chatListData2.removeItemAt(e)},e.prototype.removeChatWithId=function(t){if(this._chatListData&&this._chatListData.length){for(var e=[],i=0;i<this._chatListData.length;i++){var n=this._chatListData.getItemAt(i);n.id!=t&&e.push(n)}this._chatListData.source=e,this._chatListData.refresh()}},e.prototype.postNewChatMsg=function(t){return t},e.prototype.doSystemInfo=function(t){},e.prototype.doIsSendSuccess=function(t){t.readBoolean()&&this.postSendInfoSuccess()},e.prototype.postSendInfoSuccess=function(){},e.prototype.doSystemMessage=function(t){var i=t.readInt(),n=t.readInt(),s=t.readString();if(0==i||Actor.level>=i)switch(n){case 512:if(TipsCT.ins().showBottomCenterTips(s),KfArenaSys.ins().isKFArena){var o=new ChatSystemData(0,s);FbCT.ins().chatCampDtList.addItem(o),e.ins().postNewChatMsg(o)}break;case 8:TipsCT.ins().showCenterTips2(s);break;case 4:ErrorLog.ins().show(s);break;case 2:TipsCT.ins().showCenterTips(s);break;default:TipsCT.ins().showTips(s)}},e.prototype.doCannotSpeak=function(t){this.canSpeakTime=t.readInt()},e.prototype.isCanSpeak=function(){return this.canSpeakTime>GameServer.serverTime/1e3?!1:!0},Object.defineProperty(e.prototype,"chatListData",{get:function(){return this._chatListData||(this._chatListData=new eui.ArrayCollection),this._chatListData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListData2",{get:function(){return this._chatListData2||(this._chatListData2=new eui.ArrayCollection),this._chatListData2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatKuaFuListData",{get:function(){return this._chatKuaFuListData||(this._chatKuaFuListData=new eui.ArrayCollection),this._chatKuaFuListData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListTip",{get:function(){this._chatListData||(this._chatListData=new eui.ArrayCollection([]));var t,e,i=this._chatListData.length;return i>2?(t=i-2,e=i):(t=0,e=i),this._chatListData.source.slice(t,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatListTip2",{get:function(){var t=this._chatListData2;FbCT.ins().isFBChatChannle()&&(t=FbCT.ins().chatCampDtList),t||(t=new eui.ArrayCollection([]));var e,i,n=t.length;return n>2?(e=n-2,i=n):(e=0,i=n),t.source.slice(e,i)},enumerable:!0,configurable:!0}),e.prototype.startInterval=function(){this.canSpeak=!1,Timer.start(this.chatInterval,1,this.timeDo,this)},e.prototype.timeDo=function(){this.canSpeak=!0},e.prototype.postSysChatMsg=function(t){if(this._systemListData.length>=this.charMax){var e=this._systemListData.removeItemAt(0);this.removeAllChatMsg(e)}return this._systemListData.addItem(t),this.insertAllChatMsg(t),t},Object.defineProperty(e.prototype,"systemListData",{get:function(){return this._systemListData||(this._systemListData=new eui.ArrayCollection([])),this._systemListData},enumerable:!0,configurable:!0}),e.prototype.checkRepeatString=function(t){var e=t.length;if(10>=e)return!0;for(var i=0,n=0;e>n;n++){var s=t.charAt(n);-1!=this.UpSpeak.lastIndexOf(s)&&++i}return i>=10?(TipsCT.ins().showTips("|C:0xf3311e&T:输入的内容重复过多|"),!1):!0},e.prototype.getWorldStr=function(){return KFServerSys.ins().isKF||KFBossSys.ins().isKFBossBattle?"跨服":"世界"},__decorate([post()],e.prototype,"postNewChatMsg",null),__decorate([post()],e.prototype,"postSendInfoSuccess",null),__decorate([post()],e.prototype,"postSysChatMsg",null),e}(BaseSystem);__reflect(ChatCT.prototype,"ChatCT"),window.gm=gm,System.ChatCT=function(){return ChatCT.ins()},window.ChatCT=ChatCT;var ChatMainUI=function(t){function e(){var e=t.call(this)||this;return e.resId=["xlt_98","xlt_99"],e.fistOpenGuild=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChatMainSkin",this.chatList.itemRenderer=ChatListItemRenderer2,this.dataList=new eui.ArrayCollection([]),this.chatList.dataProvider=this.dataList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.message,this.onTap),this.addTouchEvent(this.chatList,this.onTap),this.observe(ChatCT.ins().postSysChatMsg,this.getNewNotice),this.observe(ChatCT.ins().postNewChatMsg,this.updateNewChatMsg),this.observe(GameLogic.ins().postEnterMap,this.checkShow),this.observe(TaskCT.ins().postUpdteTaskTrace,this.updateTipShow),this.updataList(),this.updateTipShow(),this.setChatTipShow(ChatCT.ins().isShowTip),this.checkShow()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.message:case this.chatList:ViewManager.ins().open(ChatWin)}},e.prototype.getNewNotice=function(t){t.type==TagChanneID.ciChannelAll?(this.chat||(this.chat=new ChatTipsView,this.chat.y=this.message.y+12,this.chat.x=this.message.x+50),this.chat.parent||this.addChildAt(this.chat,0),this.chat.setData(t)):t.type==TagChanneID.ciChannelGuild&&this.updataList()},e.prototype.updateNewChatMsg=function(){this.fistOpenGuild&&(this.fistOpenGuild=!1,Guild.ins().guildID&&Guild.ins().sendAllGuildMessage()),this.updataList()},e.prototype.updataList=function(){Timer.has(RareAnimalCT.ins().resetCD,RareAnimalCT.ins())||Timer.start(1e3,RareAnimalCT.ins().cdCount+1,RareAnimalCT.ins().resetCD,RareAnimalCT.ins()),!Timer.has(this.updataList,this)&&BossCT.ins().cdCount?Timer.start(1e3,BossCT.ins().cdCount+1,this.updataList,this):!Timer.has(this.updataList,this)&&KFBossSys.ins().cdCount?Timer.start(1e3,KFBossSys.ins().cdCount+1,this.updataList,this):!Timer.has(this.updataList,this)&&Mine.ins().cdCount?Timer.start(1e3,Mine.ins().cdCount+1,this.updataList,this):!Timer.has(this.updataList,this)&&RareAnimalCT.ins().cdCount&&Timer.start(1e3,RareAnimalCT.ins().cdCount+1,this.updataList,this),this.dataList.replaceAll(ChatCT.ins().chatListTip2.concat())},e.prototype.checkShow=function(){var t=GameMap.fubenID;this.updataLayer(0!=t),this.updataList()},e.prototype.updataLayer=function(t){t?this.chatGroup.y=616:this.chatGroup.y=546},e.prototype.setChatTipShow=function(t){this.chatList.visible=!0},e.prototype.updateTipShow=function(){var t=!0;this.setChatTipShow(t)},e.prototype.destoryView=function(){t.prototype.destoryView.call(this,!1)},e}(BaseEuiView);__reflect(ChatMainUI.prototype,"ChatMainUI"),window.ChatMainUI=ChatMainUI,ViewManager.ins().reg(ChatMainUI,LayerManager.UI_Popup);var ChatWin=function(t){function e(){var e=t.call(this)||this;return e.cruIndex=0,e.fistOpenGuild=!0,e.isStretch=!1,e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChatSkin",this.defaultText="点击输入咨询内容",this.chatInput.maxChars=30,this.input.maxChars=100,this.tabData=new eui.ArrayCollection,this.tab.dataProvider=this.tabData,this.chatList.touchEnabled=!1},e.prototype.refTab=function(){var t=[];if(FbCT.ins().isFBChatChannle())t=["阵营"],this.tab.horizontalCenter=0/0;else{var i=ChatCT.ins().getWorldStr();GameServer.serverOpenDay+1<GlobalConfig.ClientGlobalConfig.kfChannelOpenDay?(t=["综合",i,"行会","系统"],e.Channel_All=0,e.Channel_World=1,e.Channel_Guild=2,e.Channel_SYS=3,e.Channel_KF=4,e.Channel_KuaFu=100):"跨服"==i?(t=["综合",i,"行会","系统"],e.Channel_All=0,e.Channel_KuaFu=1,e.Channel_Guild=2,e.Channel_SYS=3,e.Channel_KF=4,e.Channel_World=100):(t=["综合",i,"跨服","行会","系统"],e.Channel_All=0,e.Channel_World=1,e.Channel_KuaFu=2,e.Channel_Guild=3,e.Channel_SYS=4,e.Channel_KF=5),"0"!=urlParam.kf&&t.push("客服"),this.tab.horizontalCenter=0}this.tabData.replaceAll(t),this.tab.validateNow()},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];"7000183"==urlParam.appid&&window.mz?(this.chatInputGroup.touchChildren=this.chatGroup.touchChildren=!1,this.chatInputGroup.touchEnabled=this.chatGroup.touchEnabled=!0):(this.chatInputGroup.touchChildren=this.chatGroup.touchChildren=!0,this.chatInputGroup.touchEnabled=this.chatGroup.touchEnabled=!1),0==this.input.text.length?(this.input.text=this.defaultText,this.input.textColor=7105644):this.input.textColor=14668213,this.addTouchEvent(this.chatGroup,this.onTap),this.addTouchEvent(this.chatInputGroup,this.onTap),this.addTouchEvent(this.faceBtn,this.onTap),this.addTouchEvent(this.chatList,this.onListTap),this.addTouchEvent(this.upBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.sendBtn,this.onTap),this.addTouchEvent(this.allReceiveBtn,this.onTap),this.addTouchEvent(this.sendBtn0,this.onTap),this.observe(ChatCT.ins().postNewChatMsg,this.getNewOne),this.chatInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.observe(ChatCT.ins().postSendInfoSuccess,this.textInOn),this.addChangeEvent(this.tab,this.selectIndexChange),this.addChangingEvent(this.tab,this.checkIsOpen),this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this),this.observe(Guild.ins().postGetNewGuildMessage,this.getNewOneGuild),this.observe(Guild.ins().postAllGuildMessage,this.updataList),this.observe(Guild.ins().postQuitGuild,this.updateMsgRedPoint),this.observe(GameLogic.ins().postEnterMap,this.updateMsgRedPoint),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.observe(GameLogic.ins().postInputText,this.updateKeFuText),this.cruIndex!=e.Channel_Guild||Guild.ins().guildID?this.cruIndex>e.Channel_Guild&&(this.cruIndex=0):this.cruIndex=0,t&&(this.cruIndex=t[0]),this.refTab(),this.backSelect(this.cruIndex),this.selectIndexChange(null),this.addDataProviderEvent()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.chatInput.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.updateInput,this),this.removeDataProviderEvent(),ChatCT.ins().chatListData2.removeEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this),this.chatList.dataProvider=null},e.prototype.addDataProviderEvent=function(){this.chatList.dataProvider&&this.chatList.dataProvider.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)},e.prototype.removeDataProviderEvent=function(){this.chatList.dataProvider&&this.chatList.dataProvider.removeEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.listDataChange,this)},e.prototype.checkIsOpen=function(t){var i=t.target;return i.selectedIndex!=e.Channel_Guild||Guild.ins().guildID?void 0:(TipsCT.ins().showTips("请先加入公会"),void t.preventDefault())},e.prototype.selectIndexChange=function(t){this.oldChangle=this.cruIndex,this.cruIndex=this.tab.selectedIndex,this.updataList(!0),this.cruIndex==e.Channel_Guild&&this.fistOpenGuild&&(this.fistOpenGuild=!1,Guild.ins().sendAllGuildMessage())},e.prototype.backSelect=function(t){this.tab.selectedIndex=t},e.prototype.updataList=function(t){var i=this;switch(void 0===t&&(t=!1),this.cruIndex){case e.Channel_All:this.currentState="all",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRenderer=ChatListItemRenderer3,FbCT.ins().isFBChatChannle()?this.chatList.dataProvider=FbCT.ins().chatCampDtList:this.chatList.dataProvider=ChatCT.ins().chatListData2,this.addDataProviderEvent();break;case e.Channel_World:this.currentState="world",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRendererSkinName="ChatItemSkin",this.chatList.dataProvider=ChatCT.ins().chatListData,this.chatList.itemRenderer=ChatListItemRenderer,this.addDataProviderEvent();break;case e.Channel_KuaFu:this.currentState="kuafu",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRendererSkinName="ChatItemSkin",this.chatList.dataProvider=ChatCT.ins().chatKuaFuListData,this.chatList.itemRenderer=ChatListItemRenderer,this.addDataProviderEvent();break;case e.Channel_Guild:this.currentState="guild",this.removeDataProviderEvent(),this.chatList.dataProvider=null,this.chatList.itemRendererSkinName="ChatItemSkin",this.chatList.itemRenderer=ChatGuildItemRender,this.chatList.dataProvider=Guild.ins().guildMessageInfoData,this.addDataProviderEvent();break;case e.Channel_SYS:this.currentState="sys",this.removeDataProviderEvent(),this.chatList.itemRenderer=ChatSystemItemRenderer,this.chatList.dataProvider=ChatCT.ins().systemListData,this.addDataProviderEvent();break;case e.Channel_KF:this.currentState="customService",egret.callLater(function(){i.eDefault.text=urlParam.appid==PlatFormID.WAN_BA?"客服QQ：3099227036":"游戏内容遇到的问题，请咨询客服（不超过100字）"},this),this.removeDataProviderEvent()}this.listDataChange(),this.updateMsgRedPoint()},e.prototype.updateMsgRedPoint=function(){return KFServerSys.ins().isKF?void(this.redPoint2.visible=!1):(this.tab.selectedIndex==e.Channel_Guild&&(Guild.ins().hasNewMsg=!1),void(this.redPoint2.visible=Guild.ins().hasNewMsg))},e.prototype.getNewOne=function(t){-1==Friends.ins().indexOfBlackList(t.id)&&(this.refushBar(),this.updateMsgRedPoint())},e.prototype.getNewOneGuild=function(t){-1==Friends.ins().indexOfBlackList(t.id)&&this.refushBar()},e.prototype.listDataChange=function(){this.cruIndex!=e.Channel_KF&&this.refushBar()},e.prototype.refushBar=function(){Timer.start(100,1,this.refushBarList,this)},e.prototype.refushBarList=function(){this.barList.viewport.validateNow(),this.barList.viewport.contentHeight>this.barList.height&&(this.barList.viewport.scrollV=this.barList.viewport.contentHeight-this.barList.height)},e.prototype.refushBarListTop=function(){this.barList.viewport.scrollV=0},e.prototype.updateInput=function(){this.input.text==this.defaultText&&(this.input.text="",this.input.textColor=14668213)},e.prototype.textInOn=function(){"点击输入聊天内容"==this.chatInput.text&&(this.chatInput.text="")},e.prototype.setStretchWin=function(){this.isStretch?(this.isStretch=!1,this.upBtn.scaleY=1,this.winGroup.height=e.LITTLE_HEIGHT):(this.isStretch=!0,this.upBtn.scaleY=-1,this.winGroup.height=e.BIG_HEIGHT),this.updataList()},e.prototype.onListTap=function(){var t=this.chatList.selectedItem;if(t&&(t instanceof ChatInfoData||t instanceof GuildMessageInfo||t instanceof ChatSystemData)){var e=void 0;if(t instanceof ChatSystemData?e=t.str:t&&(e=t.content),e&&e.indexOf("|E:")>=0)return void this.onLink(e);void 0!=t.lv&&ViewManager.ins().open(PlayerTipsWin,t)}},e.prototype.onLink=function(t){var e=t.indexOf("|E:");t=t.slice(e+3,Number.MAX_VALUE);var i;if(t.indexOf(",")>=0?i=t.split(","):t.indexOf("*")>=0&&(i=t.split("*")),i&&!(i.length<=0)){if(ViewManager.ins().isShow(TeamFbRoomWin))return void TipsCT.ins().showTips("当前正在队伍中");switch(Mine.ins().fightActId=null,Mine.ins().fightIndex=null,Mine.ins().fightId=null,i[0]){case"1":if(!KfArenaSys.ins().checkIsMatching())return;FbCT.ins().sendEnterTFRoom(+i[1]);break;case"2":KfArenaSys.ins().sendJoinTeam(+i[1]);break;case"3":if(BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH);BossCT.ins().sendChallengWorldBoss(+i[1],+i[2]);break;case"4":ViewManager.ins().openBySkin(ComActivityWin,"ActivityWinSkin",ActivityPageStyle.Activity10);break;case"5":if(BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH);XuanWuCT.ins().sendEnter(+i[1]);break;case"6":var n=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;if(n>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:"+n+"秒后可以进入！");KFBossSys.ins().sendEnter(+i[1]),KFBossSys.ins().kfBossCfgID=+i[1];break;case"7":if(!RareAnimalCT.ins().checkOpen(!0))return;if(!KfArenaSys.ins().checkIsMatching())return;if(!RareAnimalCT.ins().helpNum)return void TipsCT.ins().showTips("今日的协助次数已用尽");RareAnimalCT.ins().sendEnterTeam(+i[1]);break;case"8":if(MineFight.ins().isFighting)return void TipsCT.ins().showTips("战斗中");if(+i[5]>0)return void TipsCT.ins().showTips("已复仇");if(Actor.actorID==+i[1])return void TipsCT.ins().showTips("不能协助自己复仇");if(Actor.actorID==+i[2])return void TipsCT.ins().showTips("不能复仇自己");Mine.ins().fightActId=+i[1],Mine.ins().fightIndex=+i[3],Mine.ins().fightId=+i[4],GameMap.sceneInMine()?Mine.ins().sendHelpFight(+i[1],+i[3]):Mine.ins().sendIntoMine();break;case"9":if(!KfArenaSys.ins().checkIsMatching())return;if(!GuildFBCT.checkOpen(!0))return;if(!GuildFBCT.ins().isOpenTime)return void TipsCT.ins().showTips("未开启");GuildFBCT.ins().sendEnterFB(+i[1])}}},e.prototype.updateInputText=function(t){this.chatInput.text=t,this.textInOn()},e.prototype.updateKeFuText=function(t){this.input.text=t,this.updateInput()
},e.prototype.onTap=function(t){switch(t.currentTarget){case this.faceBtn:ViewManager.ins().open(ChatEmojiWin,this.chatInput);break;case this.upBtn:this.setStretchWin(),this.refushBar();break;case this.closeBtn0:ViewManager.ins().close(this);break;case this.sendBtn:if(this.cruIndex!=e.Channel_Guild&&!OpenSystem.ins().checkSysOpen(SystemType.CHAT))return void TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.CHAT));if(!ChatCT.ins().canSpeak)return void TipsCT.ins().showTips("|C:0xf3311e&T:发言次数过快|");if("点击输入聊天内容"==this.chatInput.text)return void TipsCT.ins().showTips("|C:0xf3311e&T:请输入聊天内容|");if(ChatCT.ins().startInterval(),this.cruIndex==e.Channel_Guild)Guild.ins().sendGuildMessage(this.chatInput.text),this.chatInput.text="";else{if(this.chatInput.text.indexOf("@")>-1)return GameLogic.ins().sendGMCommad(this.chatInput.text),void("@version"==this.chatInput.text?WarnWin.show(Version.BUILD_NUMBER,null,this,null,null,"sure"):"@player"==this.chatInput.text&&PlayerAttrManager.ins().getAttr());ChatCT.ins().checkRepeatString(this.chatInput.text)&&(FbCT.ins().isFBChatChannle()?FbCT.ins().sendFbChat(1,this.chatInput.text):this.cruIndex==e.Channel_KuaFu?ChatCT.ins().sendChatInfo(TagChanneID.ciChannelKuaFu,this.chatInput.text):ChatCT.ins().sendChatInfo(TagChanneID.ciChannelAll,this.chatInput.text),ChatCT.ins().UpSpeak=this.chatInput.text,this.chatInput.text="")}break;case this.sendBtn0:if(0==this.input.text.length||this.input.text==this.defaultText)return void TipsCT.ins().showTips("内容不能为空");if(this.input.text.indexOf("@")>-1)return void GameLogic.ins().sendGMCommad(this.input.text);this.sendAsk();break;case this.chatGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.chatInput.text||"");break;case this.chatInputGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(1,this.input.text||"")}},e.prototype.sendAsk=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,s;return __generator(this,function(o){return t=urlParam.srvid,e=urlParam.appid,i=urlParam.openId,n=urlParam.reportRoot,s="?game="+t,s+="&appId="+e,s+="&userId="+Actor.actorID,s+="&userName="+i,s+="&userNameCn="+Actor.myName,s+="&userLevel="+Actor.level,s+="&vipLevel="+Actor.vip,s+="&content="+this.input.text,Http.get(n+"y4/custom/receive"+s),WarnWin.show("您的反馈已发送",null,this,null,null,"sure"),this.input.text="",[2]})})},e.Channel_All=0,e.Channel_World=1,e.Channel_KuaFu=2,e.Channel_Guild=3,e.Channel_SYS=4,e.Channel_KF=5,e.BIG_HEIGHT=850,e.LITTLE_HEIGHT=370,e}(BaseEuiView);__reflect(ChatWin.prototype,"ChatWin"),ViewManager.ins().reg(ChatWin,LayerManager.UI_Popup),window.ChatWin=ChatWin;var StageUtils=function(t){function e(){var i=t.call(this)||this;return null==e._uiStage&&(e._uiStage=new eui.UILayer,e._uiStage.touchEnabled=!1,e._uiStage.percentHeight=100,e._uiStage.percentWidth=100,i.getStage().addChild(e._uiStage)),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getHeight=function(){return this.getStage().stageHeight},e.prototype.getWidth=function(){return this.getStage().stageWidth},e.prototype.setTouchChildren=function(t){this.getStage().touchChildren=t},e.prototype.setMaxTouches=function(t){this.getStage().maxTouches=t},e.prototype.setFrameRate=function(t){this.getStage().frameRate=t},e.prototype.setScaleMode=function(t){this.getStage().scaleMode=t},e.prototype.getStage=function(){return egret.MainContext.instance.stage},e.prototype.getUIStage=function(){return e._uiStage},e}(BaseClass);__reflect(StageUtils.prototype,"StageUtils"),window.StageUtils=StageUtils;var ChatCampData=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.readData=function(t){void 0===t&&(t=null),this.type=t.readShort(),this.servId=t.readInt(),this.name=t.readString(),this.content=t.readString()},e}(ChatDataBase);__reflect(ChatCampData.prototype,"ChatCampData"),window.ChatCampData=ChatCampData;var ChatInfoData=function(t){function e(e){void 0===e&&(e=null);var i=t.call(this)||this;return i.type=0,i.id=0,i.servId=0,i.name="",i.job=0,i.sex=0,i.vip=0,i.monthCard=0,i.ladderLevel=0,i.pointId=0,i.str="",i.isFirst=0,i.zsLevel=0,i.lv=0,i.guild="",i.titleId=0,i.fpVipInfo={},e&&(i.type=e.readByte(),i.id=e.readInt(),i.servId=e.readInt(),i.name=e.readString(),i.job=e.readByte(),i.sex=e.readByte(),i.vip=e.readByte(),i.monthCard=e.readByte(),i.ladderLevel=e.readByte(),i.isFirst=e.readByte(),i.zsLevel=e.readUnsignedByte(),i.lv=e.readShort(),i.guild=e.readString(),i.pointId=e.readUnsignedInt(),i.str=e.readString(),i.fpVipInfo=PFVipCT.parserPFVipInfo(e),i.cd=0),i}return __extends(e,t),e}(ChatDataBase);__reflect(ChatInfoData.prototype,"ChatInfoData");var TagChanneID;!function(t){t[t.ciChannelSecret=0]="ciChannelSecret",t[t.ciChannelNear=1]="ciChannelNear",t[t.ciChannelWorld=2]="ciChannelWorld",t[t.ciChannelGuild=3]="ciChannelGuild",t[t.ciChannelTeam=4]="ciChannelTeam",t[t.ciChannelBigTeam=5]="ciChannelBigTeam",t[t.ciChannelMap=6]="ciChannelMap",t[t.ciChannelAll=7]="ciChannelAll",t[t.ciChannelCamp=8]="ciChannelCamp",t[t.ciChannelSystem=9]="ciChannelSystem",t[t.ciChannelKuafuOld=10]="ciChannelKuafuOld",t[t.ciChannelSos=11]="ciChannelSos",t[t.ciChannelCosign=12]="ciChannelCosign",t[t.ciChannelKuaFu=13]="ciChannelKuaFu",t[t.ciChannelMax=14]="ciChannelMax"}(TagChanneID||(TagChanneID={})),window.ChatInfoData=ChatInfoData;var ChatSystemData=function(t){function e(e,i){var n=t.call(this)||this;return n.type=e,n.str=i,n}return __extends(e,t),e}(ChatDataBase);__reflect(ChatSystemData.prototype,"ChatSystemData"),window.ChatSystemData=ChatSystemData;var ChatEmojiWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="EmojiPanelSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.emoji,this.onChooseEmoji),this.addTouchEvent(this.closeBg,this.onTouch),this.chatInput=t[0]},e.prototype.close=function(){this.chatInput=null},e.prototype.onChooseEmoji=function(t){if(t.target instanceof eui.Image){if(!this.chatInput)return void ViewManager.ins().close(this);var e=t.target.name,i=e.replace(/emoji_/g,""),n=GlobalConfig.ChatEmojiConfig[+i];"点击输入聊天内容"==this.chatInput.text?this.chatInput.text=n.emojiId:this.chatInput.text=this.chatInput.text.concat(n.emojiId),ViewManager.ins().close(this)}},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ChatEmojiWin.prototype,"ChatEmojiWin"),ViewManager.ins().reg(ChatEmojiWin,LayerManager.UI_Popup),window.ChatEmojiWin=ChatEmojiWin;var ChatGuildItemRender=function(t){function e(){var e=t.call(this)||this;return e.emojiTxt=new EmojiText,e.emojiTxt.x=0,e.emojiTxt.lineSpacing=8,e.emojiTxt.textColor=13746831,e.addChild(e.emojiTxt),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.showHead.visible=!1,this.showText.visible=!1,this.chatVip.visible=!1,this.data instanceof GuildMessageInfo){var t=(this.data,this.data),e="",i="",n="",s="";1==t.type?(t.office&&(e="|C:0x"+GuildLanguage.guildOfficeColor[t.office]+"&T:["+GuildLanguage.guildOffice[t.office]+"]|"),i=t.vipLevel>0?EmojiText.VIP_IMG:"",i+=PFVipCT.getCurPFVipStr(t.pfVipInfo),t.name&&(n="|C:0x16B2FF&T:["+t.name+"]|"),s="|C:0xDFD1B5&T:"+t.content+"|"):s="|C:0xDFD1B5&T:"+t.content+"|",this.emojiTxt.textWidth=this.textGroup.width,this.emojiTxt.richText=""+e+i+n+" "+s,this.height=this.emojiTxt.uHeight+14}},e}(BaseItemRender);__reflect(ChatGuildItemRender.prototype,"ChatGuildItemRender"),window.ChatGuildItemRender=ChatGuildItemRender;var ChatListItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.emojiTxt=new EmojiText,e.emojiTxt.x=0,e.emojiTxt.lineSpacing=8,e.emojiTxt.textColor=13746831,e.addChild(e.emojiTxt),e}return __extends(e,t),e.prototype.dataChanged=function(){this.showHead.visible=!1,this.showText.visible=!1,this.chatVip.visible=!1;var t=null;t=7==this.data.type?this.data:3==this.data.type?this.data:this.data;var e,i,n=KFServerSys.ins().isKF?"S"+t.servId:"",s="",o="";0!=t.type&&1!=t.type&&2!=t.type&&(3==t.type?(s=t.str,e="|C:0xDD6717&T:[系统]|",i=s):(s=t.str,o=t.vip?EmojiText.VIP_IMG:"",o+=PFVipCT.getCurPFVipStr(t.fpVipInfo),e="|C:0x16B2FF&T:["+t.name+n+"]|",i="|C:0xDFD1B5&T:"+s+"|"),this.emojiTxt.textWidth=this.textGroup.width,this.emojiTxt.richText=""+o+e+" "+i,this.height=this.emojiTxt.uHeight+14)},e.HEAD_BG=["touxiangkuang0","touxiangkuang1"],e}(BaseItemRender);__reflect(ChatListItemRenderer.prototype,"ChatListItemRenderer"),window.ChatListItemRenderer=ChatListItemRenderer;var ChatListItemRenderer2=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChatItemSkin2",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=0,i="",n="",s=0;if(t instanceof GuildMessageInfo)i="|C:0xDD6717&T:[行会]|",n=t.content,s=t.vipLevel;else if(t instanceof ChatCampData)i="|C:0xDD6717&T:[阵营]|",n=t.content;else if(t instanceof ChatSystemData)i="|C:0xDD6717&T:[系统]|",n=t.str;else{var o="";o=t instanceof ChatInfoData&&t.type==TagChanneID.ciChannelKuaFu?"跨服":ChatCT.ins().getWorldStr(),i="|C:0xDD6717&T:["+o+"]|",n=t.str,s=t.vip}if(this.showChannel.textFlow=TextFlowMaker.generateTextFlow(i),this.showHead.text="",t.name){var a="|C:0x16B2FF&T:["+t.name+"]|";this.showHead.textFlow=TextFlowMaker.generateTextFlow(a)}s>0?this.chatVip.source="xvip_v2_png":this.chatVip.source="";var r=0;s>0&&(this.chatVip.x=this.showChannel.width,this.chatVip.y=this.showChannel.y,r=this.chatVip.width),this.showHead.x=this.showChannel.x+this.showChannel.width+r,this.showHead.y+this.showChannel.y;var l="|C:0xDFD1B5&T:"+n+"|";if(this.showText.textFlow=TextFlowMaker.generateTextFlow(l),this.showText.y=this.showHead.y,this.showText.width=void 0,this.validateNow(),this.showChannel.width+r+this.showHead.width+this.showText.textWidth>(e||this.textGroup.width)){var h=this.showText.height;this.showText.width=(e||this.textGroup.width)-this.showChannel.width-r-this.showHead.width,this.showText.height=h}this.showText.x=this.showChannel.x+this.showChannel.width+r+this.showHead.width},e}(BaseItemRender);__reflect(ChatListItemRenderer2.prototype,"ChatListItemRenderer2"),window.ChatListItemRenderer2=ChatListItemRenderer2;var ChatListItemRenderer3=function(t){function e(){var e=t.call(this)||this;return e.emojiTxt=new EmojiText,e.emojiTxt.x=0,e.emojiTxt.lineSpacing=8,e.emojiTxt.textColor=13746831,e.addChild(e.emojiTxt),e}return __extends(e,t),e.prototype.dataChanged=function(){this.showHead.visible=!1,this.showText.visible=!1,this.chatVip.visible=!1;var t=this.data,e=0,i="",n="",s="",o="";if(t instanceof GuildMessageInfo)i="|C:0xDD6717&T:[行会]|",n=t.content,s=t.vipLevel?EmojiText.VIP_IMG:"";else if(t instanceof ChatCampData)i="|C:0xDD6717&T:[阵营]|",n=t.content;else if(t instanceof ChatSystemData)i="|C:0xDD6717&T:[系统]|",n=t.str;else{var a="";a=t instanceof ChatInfoData&&t.type==TagChanneID.ciChannelKuaFu?"跨服":ChatCT.ins().getWorldStr(),i="|C:0xDD6717&T:["+a+"]|",n=t.str,s=t.vip?EmojiText.VIP_IMG:""}s+=PFVipCT.getCurPFVipStr(t.fpVipInfo),t.name&&(o="|C:0x16B2FF&T:["+t.name+"]|");var r="|C:0xDFD1B5&T:"+n+"|";this.emojiTxt.textWidth=e||this.textGroup.width,this.emojiTxt.richText=""+i+s+o+" "+r,this.height=this.emojiTxt.uHeight+14},e}(BaseItemRender);__reflect(ChatListItemRenderer3.prototype,"ChatListItemRenderer3"),window.ChatListItemRenderer3=ChatListItemRenderer3;var ChatSystemItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="SysMesItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){1==this.data.type?(this.str.textFlow=TextFlowMaker.generateTextFlow("|C:0xFD2F2F&T:"+this.data.str+"|"),this.type.source="lt_01"):(this.str.textFlow=TextFlowMaker.generateTextFlow(this.data.str),this.type.source="lt_02")},e}(BaseItemRender);__reflect(ChatSystemItemRenderer.prototype,"ChatSystemItemRenderer"),window.ChatSystemItemRenderer=ChatSystemItemRenderer;var EmojiText=function(t){function e(e){var i=t.call(this)||this;return i.emojiSize=1,i.curHight=0,i._autoWrapLine=!0,i._emojiAlignment=EmojiAlign.CENTER,i.SPACEING_E=.275,i.EMOJI_INTERVAL=3,i.EMOJI_SPACEING=" ",i.emojiArr={},i.msgTxt=new egret.TextField,i.msgTxt.x=0,i.msgTxt.y=0,i.msgTxt.lineSpacing=20,i.msgTxt.verticalAlign="top",i.msgTxt.size=16,i.addChild(i.msgTxt),e&&i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this)},e.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.reset()},Object.defineProperty(e.prototype,"richText",{set:function(t){if(this.reset(),t){var e=this.splitFace(t);if(!e.emojis)return void(this.msgTxt.textFlow=TextFlowMaker.generateTextFlow1(e.msgs[0]));for(var i=e.msgs.length,n=0;i>n;n++)this.appendText(e.msgs[n]),e.emojis[n]&&this.insertEmoji(e.emojis[n])}},enumerable:!0,configurable:!0}),e.prototype.insertEmoji=function(t){var i=t.replace(RegExpUtil.CHAT_EMOJI_ID,""),n=this.getEmojiInfo(+i);if(!n)return void this.appendText(t);var s=n.soure?n.soure:"emoji_"+i+"_png";e.VIP_IMG==t&&(n.width=45),e.SVIP_IMG==t&&(n.width=60),this.setEmojiSize(n.scale>0?n.scale:1),this.emojiW=n.width*this.emojiSize,this.emojiH=n.height*this.emojiSize;var o=this.addEmoji(s);this.emojiArr[o.hashCode]=o},e.prototype.addEmoji=function(t){var e=ObjectPool.pop("Emoji");e.setData(t),e.scaleX=e.scaleY=this.emojiSize,this.addChildAt(e,0);var i=this.msgTxt.numLines,n=this.msgTxt.$getLinesArr(),s=i>0?n[i-1].width:0;this._autoWrapLine?(s+this.emojiW>this.msgTxt.width?(this.appendText("\n"),e.x=0):e.x=s+this.EMOJI_INTERVAL,e.y=this.getEmojiY()):(e.x=s+this.EMOJI_INTERVAL,e.y=this.getEmojiY()),this.curHight=this.curHight>e.y+this.emojiH?this.curHight:e.y+this.emojiH;for(var o="",a=0,r=this.SPACEING_E*this.msgTxt.size;this.emojiW>r*a;)o+=this.EMOJI_SPACEING,a++;return this.appendText(o),e},Object.defineProperty(e.prototype,"autoWrapLine",{set:function(t){this._autoWrapLine=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emojiAlignment",{set:function(t){this._emojiAlignment=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textColor",{set:function(t){this.msgTxt.textColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{set:function(t){this.msgTxt.size=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{set:function(t){this.width=t,this.msgTxt.width=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textheight",{set:function(t){this.height=t,this.msgTxt.height=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineSpacing",{set:function(t){this.msgTxt.lineSpacing=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uHeight",{get:function(){return this.curHight>this.msgTxt.textHeight?this.curHight:this.msgTxt.textHeight},enumerable:!0,configurable:!0}),e.prototype.setEmojiSize=function(t){this.emojiSize=t},e.prototype.reset=function(){this.curHight=20,this.msgTxt.text="",this.removeAllEmoji()},e.prototype.removeAllEmoji=function(){for(var t in this.emojiArr){var e=this.emojiArr[t];DisplayUtils.removeFromParent(e),ObjectPool.push(e)}this.emojiArr={}},e.prototype.getEmojiInfo=function(t){return GlobalConfig.ChatEmojiConfig[t]?GlobalConfig.ChatEmojiConfig[t]:null},e.prototype.appendText=function(t){this.msgTxt.textFlow=this.msgTxt.textFlow.concat(TextFlowMaker.generateTextFlow1(t))},e.prototype.getEmojiY=function(){for(var t=0,e=this.msgTxt.$getLinesArr(),i=0;i<this.msgTxt.numLines;i++)i>0&&(t+=e[i].height+this.msgTxt.lineSpacing);switch(this._emojiAlignment){case EmojiAlign.UP:return t;case EmojiAlign.CENTER:return t-(this.emojiH-this.msgTxt.size>>1)*this.emojiSize;case EmojiAlign.DOWN:return t-(this.emojiH-this.msgTxt.size)*this.emojiSize;default:return t-(this.emojiH-this.msgTxt.size>>1)*this.emojiSize}},e.prototype.splitFace=function(t){return{emojis:t.match(RegExpUtil.CHAT_EMOJI),msgs:t.split(RegExpUtil.CHAT_EMOJI)}},e.EMOJI_MAX_ID=36,e.MAX_ID=100,e.VIP_IMG="$80$",e.SVIP_IMG="$81$",e}(egret.Sprite);__reflect(EmojiText.prototype,"EmojiText");var Emoji=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){void 0===e&&(e=!1),e?(this.emojiMc||(this.emojiMc=new MovieClip),this.emojiMc.playFile(RES_DIR_EFF+t,-1),this.addChild(this.emojiMc)):(this.emojiImg||(this.emojiImg=new eui.Image,this.addChild(this.emojiImg)),this.emojiImg.source=t)},e.prototype.reset=function(){this.emojiImg?this.emojiImg.source="":this.emojiMc&&this.emojiMc.stop()},e.prototype.dispose=function(){this.reset(),this.emojiMc&&DisplayUtils.removeFromParent(this.emojiMc)},e}(BaseView);__reflect(Emoji.prototype,"Emoji"),window.Emoji=Emoji;var EmojiAlign;!function(t){t[t.UP=1]="UP",t[t.CENTER=2]="CENTER",t[t.DOWN=3]="DOWN"}(EmojiAlign||(EmojiAlign={}));var PlayerTipsWin=function(t){function e(){var e=t.call(this)||this;return e.currId=0,e.skinName="PlayerInfoSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return this.data=t[0],this.data?(this.currId=0,this.addTouchEvent(this.btnIgnore,this.onTap),this.addTouchEvent(this.btnChat,this.onTap),this.addTouchEvent(this.btnFriend,this.onTap),this.addTouchEvent(this.btnInfo,this.onTap),this.addTouchEvent(this.rect,this.onTap),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),void this.initView()):void ViewManager.ins().close(e)},e.prototype.onTap=function(t){switch(t.target){case this.btnChat:var i=Friends.ins().getFriendIndex(this.currId);-1!=i?(ViewManager.ins().close(this),ViewManager.ins().open(FriendBgWin,0,i)):TipsCT.ins().showTips("只有好友才能私聊");break;case this.btnInfo:ReadPlayerCT.ins().sendFindPlayer(this.currId,this.data.name);break;case this.btnIgnore:Friends.ins().sendAddBlackList(this.currId,this.userData);break;case this.btnFriend:Friends.ins().sendAddFriend(this.currId,this.data.name);break;case this.rect:ViewManager.ins().close(e)}},e.prototype.initView=function(){if(this.btnChat.enabled=this.btnInfo.enabled=this.btnFriend.enabled=!KFServerSys.ins().isKF,this.userData={name:this.data.name||"",guildName:this.data.guildName||"",job:this.data.job||0,sex:this.data.sex||0,vip:this.data.vip||0,lv:this.data.lv||0,zsLv:this.data.zsLevel||0,monthCard:this.data.monthCard||0,power:this.data.power||0,appId:this.data.appId||""},this.data instanceof FriendData){var t=this.data;this.sName="S"+t.serverName+t.name,this.sLv=""+(t.zs?t.zs+"转":"")+t.lv+"级",this.sGuildName=t.guildName,this.sHeadBg=ChatListItemRenderer.HEAD_BG[t.sex],this.sHead="head_"+t.job+t.sex,this.currId=t.id,this.userData.vip=t.vip,this.userData.zsLv=t.zs}else this.data instanceof GuildMemberInfo?(this.sName=this.data.name,this.sLv=""+(this.data.zsLevel?this.data.zsLevel+"转":"")+this.data.level+"级",this.userData.guildName=this.sGuildName=Guild.ins().guildName?Guild.ins().guildName:"",this.sHeadBg=ChatListItemRenderer.HEAD_BG[this.data.sex],this.sHead="head_"+this.data.job+this.data.sex,this.currId=this.data.roleID,this.userData.vip=this.data.vipLevel,this.userData.lv=this.data.level,this.userData.power=this.data.attack):this.data instanceof GuildMessageInfo?(this.sName=this.data.name,this.sLv=""+(this.data.zsLevel?this.data.zsLevel+"转":"")+this.data.lv+"级",this.sGuildName=this.data.guildName,this.sHeadBg=ChatListItemRenderer.HEAD_BG[this.data.sex],this.sHead="head_"+this.data.job+this.data.sex,this.currId=this.data.roleId,this.userData.vip=this.data.vipLevel):(this.sName=""+(this.data.servId?"S"+this.data.servId:"")+this.data.name,this.sLv=""+(this.data.zsLevel?this.data.zsLevel+"转":"")+this.data.lv+"级",this.sGuildName=this.data.guild||this.data.guildName,this.sHeadBg=ChatListItemRenderer.HEAD_BG[this.data.sex],this.sHead="head_"+this.data.job+this.data.sex,this.currId=this.data.id)},e.prototype.openOtherPlayerView=function(t){ViewManager.ins().close(this),ViewManager.ins().close(FriendBgWin);var e=ViewManager.ins().open(RRoleWin,t);KFServerSys.ins().isKF&&e.hideEx(2)},e}(BaseEuiView);__reflect(PlayerTipsWin.prototype,"PlayerTipsWin"),ViewManager.ins().reg(PlayerTipsWin,LayerManager.UI_Popup),window.PlayerTipsWin=PlayerTipsWin;var DailyCheckIn=function(t){function e(){var e=t.call(this)||this;return e._loginTimes=0,e.conLoginTimes=0,e.todayReward=!1,e.comTimesIndexList=[],e.sysId=PackageID.DailyCheckIn,e.regNetMsg(1,e.postCheckInData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"loginTimes",{get:function(){return this._loginTimes},enumerable:!0,configurable:!0}),e.prototype.postCheckInData=function(t){this._loginTimes=t.readShort(),this.todayReward=t.readBoolean(),this.conLoginTimes=t.readShort(),this.rewardIndex=t.readShort()},e.prototype.sendCheckIn=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendReCheckIn=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.postCheckIn=function(t){return t},e.prototype.sendGetReward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.postComplement=function(t){return t},e.prototype.showRedPoint=function(){var t=this.canNormalCheckIn()||this.checkConReward();return t},e.prototype.canNormalCheckIn=function(){return!this.todayReward},e.prototype.checkConReward=function(){var t=this.getRewardList(this.rewardIndex)?this.getRewardList(this.rewardIndex).days:0;return this.conLoginTimes>=t},e.prototype.getCheckInState=function(t){return t>this.loginTimes?DailyCheckInState.notYet:t<this.loginTimes?DailyCheckInState.hasChecked:this.todayReward?DailyCheckInState.hasChecked:DailyCheckInState.canCheck},e.prototype.getRewardDays=function(){return 0},e.prototype.getRewardList=function(t){return GlobalConfig.MonthSignDaysConfig[t]?GlobalConfig.MonthSignDaysConfig[t]:null},__decorate([post()],e.prototype,"postCheckInData",null),__decorate([post()],e.prototype,"postCheckIn",null),__decorate([post()],e.prototype,"postComplement",null),e}(BaseSystem);__reflect(DailyCheckIn.prototype,"DailyCheckIn"),System.DailyCheckIn=function(){return DailyCheckIn.ins()};var DailyCheckInState;!function(t){t[t.notYet=0]="notYet",t[t.canCheck=1]="canCheck",t[t.hasChecked=2]="hasChecked"}(DailyCheckInState||(DailyCheckInState={})),window.DailyCheckIn=DailyCheckIn;var DailyCheckInCard=function(t){function e(){var e=t.call(this)||this;return e.id=0,e.checkInState=0,e.skinName="DailyCheckInItem",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){this.resetView();var t=this.data;if(t){this.dayFlagGroup.visible=!1,this.item.data=t.rewards[0];var e=DailyCheckIn.ins().getCheckInState(t.day);if(e)switch(e){case DailyCheckInState.canCheck:this.checkInState=DailyCheckInState.canCheck,this.showFlag();break;case DailyCheckInState.hasChecked:this.checkInState=DailyCheckInState.hasChecked,this.showChecked()}else{this.showFlag();var i=!1;this.item.touchChildren=!i,this.item.touchEnabled=!i}}this.showEquipEffect()},e.prototype.showEquipEffect=function(){var t=DailyCheckIn.ins().getCheckInState(this.data.day);t!=DailyCheckInState.canCheck?this.EquipEffect&&DisplayUtils.removeFromParent(this.EquipEffect):(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.x=50,this.EquipEffect.y=50,this.EquipEffect.scaleX=1.4,this.EquipEffect.scaleY=1.4,this.EquipEffect.parent||this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+"ValueEff2",-1))},e.prototype.showChecked=function(){this.checked.visible=this.checkedMask.visible=!0},e.prototype.showFlag=function(){var t=this.data;if(t)if(t.vipLabel>0){var e=t.vipLabel;e>10&&(e=10);var i=CheckInConfigMgr.ins().getVipCfg_Daily(e);i&&(this.vipFlagGroup.visible=!0,this.vipLab.text="V"+e+"双倍")}else t.dayLabel>0&&(this.dayLab.text=t.day+"天")},e.prototype.resetView=function(){this.complement.visible=!1,this.vipFlagGroup.visible=!1,this.dayFlagGroup.visible=!1,this.checked.visible=this.checkedMask.visible=!1,this.EquipEffect&&DisplayUtils.removeFromParent(this.EquipEffect)},e.GENE_STRING_LIST=["零","一","双","三","四","五","六","七","八","九","十"],e}(eui.ItemRenderer);__reflect(DailyCheckInCard.prototype,"DailyCheckInCard"),window.DailyCheckInCard=DailyCheckInCard;var DailyCheckInPanel=function(t){function e(){var e=t.call(this)||this;return e.isTweenItem=!1,e.currentyear=0,e.currentDay=0,e.panelwidth=400,e.xqArr=["日","一","二","三","四","五","六"],e.MonthArr=[31,28,31,30,31,30,31,31,30,31,30,31],e.skinName="DailyCheckInPanelSkin",e.cardList.itemRenderer=DailyCheckInCard,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.eff=new MovieClip,this.eff.x=428,this.eff.y=43,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.listData=new eui.ArrayCollection,this.cardList.dataProvider=this.listData},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(DailyCheckIn.ins().postCheckInData,this.onCheckInData),this.observe(DailyCheckIn.ins().postCheckIn,this.onCheckIn),this.observe(VipCT.ins().postUpdateVipData,this.onCheckInData),this.cardScroller.addEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this),this.addTouchEvent(this.cardList,this.onListTap),this.addTouchEvent(this.rewardBtn,this.ondayRewardListTap),this.isTweenItem=!0,this.initPanel(),this.updateCheckInTimes(),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isTweenItem=!1,DisplayUtils.removeFromParent(this.eff),this.listData=null,this.cleanList(),this.removeObserve()},e.prototype.toCheckIn=function(t){DailyCheckIn.ins().sendCheckIn(t)},e.prototype.onCheckIn=function(t){var e=t[0],i=t[1],n=e?"签到成功":"签到失败，请稍后再试";TipsCT.ins().showTips(n),e&&this.isTweenItem&&this.runTweenItem(this,i)},e.prototype.runTweenItem=function(t,e){if(t){var i=t.cardList;if(i){var n=i.getElementAt(e-1);if(n){var s=n.data;if(s){var o=GlobalConfig.ItemConfig[s.rewards[0].id];if(o){var a=i.localToGlobal(n.x+(n.width>>1),n.y+(n.height>>1)),r=a.x,l=a.y;return[o.icon.toString(),r,l]}}}}}},e.prototype.onCheckInData=function(t){this.updateCheckInTimes(),this.updateList()},e.prototype.onListTap=function(t){var e=this;if(t&&t.currentTarget&&this.cardList.selectedItem){var i=DailyCheckIn.ins().getCheckInState(this.cardList.selectedItem.day);if(i)if(1==i)if(Actor.vip>0)this.toCheckIn(this.cardList.selectedItem.day);else if(this.cardList.selectedItem.vipLabel&&Actor.vip<this.cardList.selectedItem.vipLabel){var n="建议双倍领取，长期可获得高达百倍收益",s=WarnWin.show(n,function(){e.toCheckIn(e.cardList.selectedItem.day)},this,function(){ViewManager.ins().open(Recharge1Win)},this);s.showUI("","VIP1","",""),s.setBtnLabel("单倍领取","双倍领取")}else this.toCheckIn(this.cardList.selectedItem.day);else 2==i&&TipsCT.ins().showTips("已签到");else this.cardList.selectedItem.day>this.currentDay&&TipsCT.ins().showTips("未到签到时间")}},e.prototype.ondayRewardListTap=function(t){DailyCheckIn.ins().sendGetReward(this.curRewardData.days)},e.prototype.onNotYetCardTap=function(t){if(t){this.cardList.getElementAt(t.day-1)}},e.prototype.updateCheckInTimes=function(){this.checkInLab.text=DailyCheckIn.ins().loginTimes.toString()+"天"},e.prototype.initPanel=function(){this.monthList=CheckInConfigMgr.ins().getMonthRewardCfg_Daily();this.panelwidth/7;this.listData.replaceAll(this.monthList)},e.prototype.updateList=function(){this.addDate()},e.prototype.addDate=function(){this.listData.replaceAll(this.monthList);var t=DailyCheckIn.ins().conLoginTimes,e=DailyCheckIn.ins().getRewardList(DailyCheckIn.ins().rewardIndex);if(e){this.rewardBtn.visible=this.rewardItem.visible=!0,this.curRewardData=e;var i=this.curRewardData.days-t>=0?this.curRewardData.days-t:0,n=t>=this.curRewardData.days,s=n?2149168:15937822,o=10458221,a=16298305,r="已累计签到(|C:"+s+"&T:"+t+"|/|C:"+o+"&T:"+this.curRewardData.days+"|)天，\n再签到|C:"+a+"&T:"+i+"天|领取奖励。";this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(r),this.rewardItem.data=this.curRewardData.rewards[0],n?(this.rewardBtn.enabled=!0,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.parent||this.rewardGroup.addChild(this.eff)):(this.rewardBtn.enabled=!1,DisplayUtils.removeFromParent(this.eff))}else{DisplayUtils.removeFromParent(this.eff),this.rewardBtn.visible=this.rewardItem.visible=!1,this.rewardBtn.enabled=!1;var i=1,n=!1,s=n?2149168:15937822,o=10458221,a=16298305,r="已领取所有的累计奖励";this.dayReardText.textFlow=TextFlowMaker.generateTextFlow(r)}},e.prototype.cleanList=function(){this.cardList.dataProvider=null},e.prototype.updateListPos=function(){this.cardScroller.removeEventListener(egret.Event.ENTER_FRAME,this.updateListPos,this);var t=DailyCheckIn.ins().loginTimes;t>=25&&(this.cardScroller.viewport.scrollV=this.cardScroller.viewport.contentHeight-this.cardScroller.height)},e}(BaseEuiView);__reflect(DailyCheckInPanel.prototype,"DailyCheckInPanel"),window.DailyCheckInPanel=DailyCheckInPanel;var DailyDayRewardItem=function(t){function e(){var e=t.call(this)||this;return e.id=0,e.skinName="DailyDayRewardItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.rewards[0],this.item.touchChildren=!1,this.item.touchEnabled=!1,this.item.isShowName(!1)},e.prototype.resetView=function(){},e}(eui.ItemRenderer);__reflect(DailyDayRewardItem.prototype,"DailyDayRewardItem"),window.DailyDayRewardItem=DailyDayRewardItem;var CheckInConfigMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getMonthRewardCfg_Daily=function(){if(!this.monthListConfig||this.monthListConfig.length<=0){this.monthListConfig=[];var t=GlobalConfig.MonthSignConfig;for(var e in t)this.monthListConfig.push(t[e])}return this.monthListConfig},e.prototype.getSingleRewardCfg_Daily=function(t){var e=this.getMonthRewardCfg_Daily();if(e){var i=e[t-1];return this.assert(i,"MonthSignConfig("+t+")")?null:i}return null},e.prototype.getVipCfg_Daily=function(t){var e=GlobalConfig.MonthSignVipConfig[t];return this.assert(e,"MonthSignVipConfig("+t+")")?null:e},e.prototype.assert=function(t,e){return Assert(t,e+" is null")},e}(BaseClass);__reflect(CheckInConfigMgr.prototype,"CheckInConfigMgr"),window.CheckInConfigMgr=CheckInConfigMgr;var CheckInData=function(){function t(){}return t.prototype.paser=function(t){this.cDate=t.readShort(),this.rewardState=t.readShort()},t}();__reflect(CheckInData.prototype,"CheckInData"),window.CheckInData=CheckInData;var CityCC=function(t){function e(){var e=t.call(this)||this;return e.cityBossId=0,e.cityBossHandle=0,e.attStatue=2,e.bossKillNumData={},e.bossState=2,e.isOpenWin=!1,e.openRevelryDay=7,e.sysId=PackageID.City,e.observe(GameLogic.ins().postEnterMap,function(){e.isCity?e.postEnterCity():e.lastCity&&e.postEscCity()}),e.enterCD=0,e.observe(Rank.ins().postPraiseData,e.createStatue),e.observe(GuildWar.ins().postWinGuildInfo,e.createStatue),e.regNetMsg(1,e.cityBossBelong),e.regNetMsg(2,e.doBossChallengeResult),e.regNetMsg(3,e.postBossInfo),e.regNetMsg(4,e.postCityBossId),e.regNetMsg(5,e.postRemainTime),e.regNetMsg(6,e.updateHudunPoint),e.regNetMsg(7,e.postEnterCD),e.regNetMsg(8,e.postBossRevelryState),e}return __extends(e,t),Object.defineProperty(e.prototype,"isCity",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_CITY},enumerable:!0,configurable:!0}),e.prototype.doBossChallengeResult=function(t){for(var e=t.readByte(),i=t.readString(),n=t.readByte()||1,s=t.readByte(),o=t.readShort(),a=[],r=0;o>r;r++)a[r]=new RewardData,a[r].parser(t);var l="yuanhead"+n+s;ResultManager.ins().create(GameMap.fbType,!0,a,"",null,[e,i,l])},e.prototype.getBossList=function(){var t=[];for(var e in GlobalConfig.CityBossConfig){var i=GlobalConfig.CityBossConfig[e];-1==t.indexOf(i.bossId)&&i.killBossId>999&&t.push(i.bossId)}return new eui.ArrayCollection(t)},e.prototype.getCityBossConfig=function(t){if(!this.cityBossIdConf){this.cityBossIdConf={};
for(var e in GlobalConfig.CityBossConfig){var i=GlobalConfig.CityBossConfig[e];this.cityBossIdConf[i.bossId]=i}}var n=this.cityBossIdConf[t];return n&&n.killBossId>999?n:null},e.prototype.getKillBossNum=function(t){var e=this.getCityBossConfig(t),i=e.killBossId,n=0;void 0!=this.bossKillNumData[i]&&(n=this.bossKillNumData[i][0]);var s=this.getNeedKillBossNum(t);return(t==this.cityBossId||n>s)&&(n=s),n},e.prototype.getNeedKillBossNum=function(t){var e=this.getCityBossConfig(t),i=e.killBossId,n=0;return void 0!=this.bossKillNumData[i]&&(n=this.bossKillNumData[i][1]),n>=e.killCount.length&&(n=e.killCount.length-1),e.killCount[n]},e.prototype.getRefreshTime=function(t){var e=this.getCityBossConfig(t),i=e.killBossId,n=0;void 0!=this.bossKillNumData[i]&&(n=this.bossKillNumData[i][2]);var s;return 0==n?s="":(n=DateUtils.formatMiniDateTime(n),s=DateUtils.checkTime(n,7)||0==n?"":DateUtils.formatFullTime(n)),s},e.prototype.postBossInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readInt(),s=t.readInt(),o=t.readInt(),a=t.readInt();this.bossKillNumData[n]=[s,o,a]}},e.prototype.postCityBossId=function(t){BossCT.ins().monsterID=this.cityBossId=t.readInt(),BossCT.ins().bossHandler=this.cityBossHandle=t.readDouble(),this.changeFunView()},e.prototype.getMaxKillNumBoss=function(){var t,e=0,i=0,n=Number.MAX_VALUE,s=!1,o=0;for(var a in this.bossKillNumData)if(!(999>+a)){t=this.getCfgByKillBossId(parseInt(a));var r=t.killCount[this.bossKillNumData[a][1]];void 0==r&&(r=t.killCount[t.killCount.length-1]);var l=this.bossKillNumData[a][0]/r;if(l>=1)return[e,l];e||s||0!=this.bossKillNumData[a][2]||(s=!0,o=t.bossId,i=l),this.bossKillNumData[a][2]&&this.bossKillNumData[a][2]<n&&(e=t.bossId,n=this.bossKillNumData[a][2],i=l)}return[e||o,i]},e.prototype.getShowBossId=function(){var t;return t=this.cityBossId>0?this.cityBossId:this.getMaxKillNumBoss()[0]},e.prototype.getCfgByKillBossId=function(t){for(var e in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[e].killBossId==t)return GlobalConfig.CityBossConfig[e];return null},e.prototype.createStatue=function(t){if(void 0===t&&(t=-1),this.isCity){var e={};e[RankDataType.TYPE_POWER]="Titletxdy",e[RankDataType.TYPE_LILIAN]="chenghaomdtx",e[RankDataType.TYPE_SKIRMISH]="Titleslzw";var i,n,s=GameSceneView.ins;if(-1==t){var o=GuildWar.ins().getModel().winGuildInfo;n=GlobalConfig.CityBaseConfig.masterPos,i=new StatueView("Titlelcbz",o.guildOwnName||"虚位以待","diaoxiang0_"+o.guildOwnSex)}else{if(n=GlobalConfig.CityBaseConfig.statuePos[t],!n)return;var a=Rank.ins().getRankModel(t).praise,r=3;if(a.subRole[0])r=a.subRole[0].job;else switch(t){case RankDataType.TYPE_POWER:r=1;break;case RankDataType.TYPE_SKIRMISH:r=2}i=new StatueView(e[t],a.name||"虚位以待","statue_"+r+"_"+(a.subRole[0]?a.subRole[0].sex:0))}i.x=n.x,i.y=n.y,s.map.addEntity(i)}},e.prototype.sendEnter=function(){this.sendBaseProto(1)},e.prototype.sendStopAI=function(){this.sendBaseProto(2)},e.prototype.sendRevival=function(){this.sendBaseProto(3)},e.prototype.postEnterCity=function(){this.lastCity=!0,this.cityBossId>0&&this.isChallenge&&(this.isChallenge=!1,egret.callLater(function(){var t=ViewManager.ins().getView(BossBelongPanel);t&&t.attrBoss()},this)),this.changeFunView(),ViewManager.ins().open(CityFunPanel),Rank.ins().sendGetRankingData(),Rank.ins().sendGetPraiseData(RankDataType.TYPE_POWER),Rank.ins().sendGetPraiseData(RankDataType.TYPE_SKIRMISH),Rank.ins().sendGetPraiseData(RankDataType.TYPE_LILIAN),GuildWar.ins().requestWinGuildInfo()},e.prototype.postEscCity=function(){this.lastCity=!1,this.attStatue=2,ViewManager.ins().close(CityFunPanel),ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetPlayerBigBloodPanel)},e.prototype.postChangeAttStatue=function(t){return this.attStatue=t,this.changeFunView(),t},e.prototype.changeFunView=function(){this.isCity&&(2==this.attStatue&&0==this.cityBossId?ViewManager.ins().open(PlayFunView):ViewManager.ins().close(PlayFunView),0==this.cityBossId?(ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(BossBelongPanel)):(ViewManager.ins().open(BossBelongPanel),ViewManager.ins().open(BossBloodPanel)))},e.prototype.cityBossBelong=function(t){var e=t.readDouble(),i=t.readDouble(),n="";if(e>0){var s=EntityManager.ins().getMasterList(e);s&&s[0]&&s[0].infoModel&&(n=s[0].infoModel.name)}BossCT.ins().postBelongChange(i,e,n)},e.prototype.postRemainTime=function(t){BossCT.ins().reliveTime=t.readShort(),BossCT.ins().killerHandler=t.readDouble(),BossCT.ins().reliveTime>0?(BossCT.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.updateHudunPoint=function(t){return t?(this.hudun=t.readInt(),this.huDunMax=t.readInt(),Timer.stop(this.hudunPointFun,this),this.hudun>0&&Timer.start(1e3,this.hudun,this.hudunPointFun,this),void this.postHudunPoint()):!0},e.prototype.hudunPointFun=function(){this.hudun--,this.postHudunPoint()},e.prototype.postHudunPoint=function(){},e.prototype.postEnterCD=function(t){this.enterCD=t.readInt(),Timer.stop(this.enterCDFun,this),this.enterCD>0&&Timer.start(1e3,this.enterCD,this.enterCDFun,this)},e.prototype.postBossRevelryState=function(t){t.readInt();this.bossState=t.readUnsignedByte(),this.checkIsOpen()&&!this.isOpenWin&&(this.isOpenWin=!0,ViewManager.ins().open(PlayTipsWin,PlayTipsWin.TYPE_Revelry))},e.prototype.enterCDFun=function(){this.enterCD--},e.ins=function(){return t.ins.call(this)},e.prototype.checkRevelryOpen=function(){return this.checkIsOpen()?this.enterCD>0?(TipsCT.ins().showTips("冷却中，"+this.enterCD+"秒后可进入主城"),!1):e.ins().isCity&&ViewManager.ins().isShow(GuideTaskWin)?(ViewManager.ins().close(GuideTaskWin),!1):(e.ins().isChallenge=!0,e.ins().sendEnter(),!0):(TipsCT.ins().showTips("活动未开启"),!1)},e.prototype.checkIsOpen=function(){return 1==this.bossState&&GameServer.serverOpenDay<this.openRevelryDay},__decorate([post()],e.prototype,"postBossInfo",null),__decorate([post()],e.prototype,"postCityBossId",null),__decorate([post()],e.prototype,"postEnterCity",null),__decorate([post()],e.prototype,"postEscCity",null),__decorate([post()],e.prototype,"postChangeAttStatue",null),__decorate([post()],e.prototype,"postRemainTime",null),__decorate([post()],e.prototype,"postHudunPoint",null),__decorate([post()],e.prototype,"postEnterCD",null),__decorate([post()],e.prototype,"postBossRevelryState",null),e}(BaseSystem);__reflect(CityCC.prototype,"CityCC"),System.CityCC=function(){return CityCC.ins()},window.CityCC=CityCC;var BossBelongPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="BossBelongSkin",e.bloodBar0.labelDisplay.visible=!1,e.attackBoss1.currentState="attbossup",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=null!=t[0]?t[0]:!0;GameMap.fbType==FbCT.FB_TYPE_SPIRIT?this.observe(SpiritBossCT.ins().postFlag,this.updateBelong):XinMoFbCT.ins().isXMHJ?(this.observe(XinMoFbCT.ins().postHandle,this.updateBelong),this.observe(XinMoFbCT.ins().postScreenMon,this.updateBelong)):this.observe(BossCT.ins().postBelongChange,this.updateBelong),this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),i&&this.observe(MapView.onGridClick,this.mapClick),this.observe(GameLogic.ins().postEnterMap,this.onEnterMap),this.addTouchEvent(this.belongGroup,this.onTap),this.addTouchEvent(this.attguishu1,this.onTap),this.addTouchEvent(this.attackBoss1,this.onTap),this.addTouchEvent(this.attackPlayer1,this.onTap),this.updateBelong(),Timer.stop(this.updateBelong,this),Timer.start(200,0,this.updateBelong,this),(SpiritBossCT.ins().isSPIRIT||XinMoFbCT.ins().isXMHJ)&&(this.attackBtnGroup.visible=!1),XinMoFbCT.ins().isXMHJ&&(this.attguishu1.visible=!1,this.belongGroup.touchEnabled=!1,this.belongGroup.touchChildren=!1)},e.prototype.onEnterMap=function(){this.attackBoss1.currentState="attbossup",this.attackPlayer1.currentState="attgsup"},e.prototype.mapClick=function(t){t.target,t.x,t.y;this.attackBoss1.currentState="attbossup"},e.prototype.onTap=function(t){var e=KFSmyjBossCT.ins().getBelongHandle(KFSmyjBossCT.ins().monsId);switch(t.currentTarget){case this.attackBoss1:this.attrBoss();break;case this.attguishu1:if(BossCT.ins().attHandle==Actor.handle||this.handle==Actor.handle||e==Actor.handle||LegendTowerCT.ins().handle==Actor.handle){if(KFBossSys.ins().isKFBossBattle)KFBossSys.ins().sendCleanBelong();else if(DevildomSys.ins().isDevildomBattle)DevildomSys.ins().sendCleanBelong();else if(SpiritBossCT.ins().isSPIRIT){var i=SpiritBossCT.ins().getBossNum(this.handle);SpiritBossCT.ins().sendUpBelongMon(i[0],i[1])}else if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){var i=KFSmyjBossCT.ins().getHandleNum(KFSmyjBossCT.ins().monsId);KFSmyjBossCT.ins().sendCancel(i[0],i[1])}else GameMap.fbType==FbCT.FB_TYPE_Legend?LegendTowerCT.ins().sendCancel(LegendTowerCT.ins().layer):GameMap.fbType==FbCT.FB_TYPE_KING?KingAreaCT.ins().sendCleanBelong(KingAreaCT.ins().fbId):GameMap.fbType==FbCT.FB_TYPE_GUILDFB?GuildFBCT.ins().sendCleanBelong(GuildFBCT.ins().bossId):BossCT.ins().sendCleanBelong();break}case this.belongGroup:if(GameMap.fbType==FbCT.FB_TYPE_SMYJ&&0==e)return;case this.attackPlayer1:var n=SpiritBossCT.ins().getBelongHandle(BossCT.ins().monsterID);if(GameMap.fbType==FbCT.FB_TYPE_SMYJ&&0==e)return void TipsCT.ins().showTips("|C:0xFFFF00&T:该BOSS无归属者,快去抢夺!|");if(GameMap.fbType==FbCT.FB_TYPE_Legend&&!LegendTowerCT.ins().handle)return void TipsCT.ins().showTips("|C:0xFFFF00&T:该BOSS无归属者,快去抢夺!|");if(GameMap.fbType!=FbCT.FB_TYPE_SMYJ&&GameMap.fbType!=FbCT.FB_TYPE_Legend&&0==BossCT.ins().attHandle&&0==n)return void TipsCT.ins().showTips("|C:0xFFFF00&T:该BOSS无归属者,快去抢夺!|");if(SpiritBossCT.ins().isSPIRIT){if(n==Actor.handle||n==GameLogic.ins().currAttackHandle)return}else if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){if(e==Actor.handle||e==GameLogic.ins().currAttackHandle)return}else if(GameMap.fbType==FbCT.FB_TYPE_Legend){if(LegendTowerCT.ins().handle==Actor.handle||LegendTowerCT.ins().handle==GameLogic.ins().currAttackHandle)return}else if(BossCT.ins().attHandle==Actor.handle||BossCT.ins().attHandle==GameLogic.ins().currAttackHandle)return;if(!BossCT.ins().canClick)return;GameLogic.ins().postChangeAttrPoint(BossCT.ins().attHandle||n||e||LegendTowerCT.ins().handle),this.setBtnState()}},e.prototype.attrBoss=function(){GameMap.fbType==FbCT.FB_TYPE_SMYJ?GameLogic.ins().postChangeAttrPoint(KFSmyjBossCT.ins().handle):GameLogic.ins().postChangeAttrPoint(BossCT.ins().bossHandler),this.attackBoss1.currentState="attbossing",this.attackPlayer1.currentState="attgsup"},e.prototype.updateTarget=function(){this.setBtnState()},e.prototype.setBtnState=function(){if(SpiritBossCT.ins().isSPIRIT){this.attguishu1.visible=!1;var t=SpiritBossCT.ins().getBelongHandle(BossCT.ins().monsterID);this.handle==Actor.handle&&t==Actor.handle?(this.attguishu1.visible=!0,this.attguishu1.label="取消归属"):EntityManager.ins().getMasterList(this.handle)&&(this.attguishu1.visible=!0,this.attguishu1.label="抢夺归属")}else if(GameMap.fbType==FbCT.FB_TYPE_Legend)LegendTowerCT.ins().handle==Actor.handle?(this.attguishu1.visible=!0,this.attguishu1.label="取消归属",this.attackPlayer1.currentState="attgsdis"):(this.attguishu1.visible=!0,this.attguishu1.label="抢夺归属",GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==LegendTowerCT.ins().handle?this.attackPlayer1.currentState="attgsing":this.attackPlayer1.currentState="attgsup");else if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){var t=KFSmyjBossCT.ins().getBelongHandle(KFSmyjBossCT.ins().monsId);t==Actor.handle?(this.attguishu1.visible=!0,this.attguishu1.label="取消归属",this.attackPlayer1.currentState="attgsdis"):(this.attguishu1.visible=!0,this.attguishu1.label="抢夺归属",GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==t?this.attackPlayer1.currentState="attgsing":this.attackPlayer1.currentState="attgsup");var e=EntityManager.ins().getEntityByMonsterId(KFSmyjBossCT.ins().monsId);e&&e[0]&&GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==e[0].infoModel.handle?this.attackBoss1.currentState="attbossing":this.attackBoss1.currentState="attbossup"}else XinMoFbCT.ins().isXMHJ?this.attguishu1.visible=!1:(BossCT.ins().attHandle==Actor.handle?(GwBoss.ins().isGwBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||GameMap.fbType==FbCT.FB_TYPE_KING||GameMap.fbType==FbCT.FB_TYPE_GUILDFB?this.attguishu1.label="取消归属":this.attguishu1.visible=!1,this.attackPlayer1.currentState="attgsdis"):(this.attguishu1.visible=!0,this.attguishu1.label="抢夺归属",GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle!=BossCT.ins().bossHandler?this.attackPlayer1.currentState="attgsing":this.attackPlayer1.currentState="attgsup"),GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==BossCT.ins().bossHandler?this.attackBoss1.currentState="attbossing":this.attackBoss1.currentState="attbossup")},e.prototype.updateBelong=function(){this.updateTarget();var t=EntityManager.ins().getMasterList(BossCT.ins().attHandle);if(SpiritBossCT.ins().isSPIRIT)this.handle=SpiritBossCT.ins().getTargetBelong()||SpiritBossCT.ins().getBelongHandle(BossCT.ins().monsterID),this.handle&&(t=EntityManager.ins().getMasterList(this.handle));else if(XinMoFbCT.ins().isXMHJ){var e=XinMoFbCT.ins().getBelongHandle();t=EntityManager.ins().getMasterList(e)}else if(GameMap.fbType==FbCT.FB_TYPE_Legend)t=EntityManager.ins().getMasterList(LegendTowerCT.ins().handle);else if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){var e=KFSmyjBossCT.ins().getBelongHandle(KFSmyjBossCT.ins().monsId);t=EntityManager.ins().getMasterList(e)}if(t&&t.length>0){for(var i=t.length,n=0,s=0,o=0,a=0,r=void 0,l=void 0,h=0;i>h;h++){var u=t[h];if(u instanceof CharRole){var p=u.infoModel.getAtt(AttributeType.atHp)||0,c=u.infoModel.getAtt(AttributeType.atMaxHp)||0;n+=p,s+=c;var d=u.infoModel.getAtt(AttributeType.cruNeiGong)||0,g=u.infoModel.getAtt(AttributeType.maxNeiGong)||0;o+=d,a+=g,r||(r=u.infoModel),l=u}}if(l&&!l.isMy&&Guild.ins().guildID&&r.guildID==Guild.ins().guildID?this.sameHanghui.visible=!0:this.sameHanghui.visible=!1,Assert(r,"BossBelongPanel 归属者："+t[0].infoModel.name+",fbType:"+GameMap.fbType+",fbId:"+GameMap.fubenID))return this.belongGroup.visible=!1,void(this.attackPlayer1.currentState="attgsup");this.belongGroup.visible=n>0&&""==BossCT.ins().winner;var f=Actor.handle!=BossCT.ins().attHandle?ColorUtil.ROLENAME_COLOR_YELLOW:ColorUtil.ROLENAME_COLOR_GREEN,v=r.getNameWithServer(),y=v.split("\n");v=y[1]?y[1]:y[0],v=StringUtils.replaceStr(v,"0xffffff",f+""),this.belongNameTxt1.textFlow=TextFlowMaker.generateTextFlow("|C:"+f+"&T:"+v),this.roleHead1.source="yuanhead"+r.job+r.sex,this.bloodBar0.maximum=s,this.bloodBar0.value=n,this.neigongBar0.maximum=a,this.neigongBar0.value=o}else this.belongGroup.visible=!1,this.attackPlayer1.currentState="attgsup"},e}(BaseEuiView);__reflect(BossBelongPanel.prototype,"BossBelongPanel"),System.BossBelongPanel=function(){return ViewManager.ins().reg(BossBelongPanel,LayerManager.Main_View)},window.BossBelongPanel=BossBelongPanel;var CityBossJiangliTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityBossJiangliTipsSkin",this.isTopLevel=!0,this.belongList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.giveUp,this.otherClose),this.showAward()},e.prototype.showAward=function(){if(CityCC.ins().isCity)for(var t in GlobalConfig.CityBossConfig)if(GlobalConfig.CityBossConfig[t].bossId==CityCC.ins().cityBossId){this.belongList.dataProvider=new eui.ArrayCollection(GlobalConfig.CityBossConfig[t].showReward);break}},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(CityBossJiangliTipsWin.prototype,"CityBossJiangliTipsWin"),ViewManager.ins().reg(CityBossJiangliTipsWin,LayerManager.UI_Popup),window.CityBossJiangliTipsWin=CityBossJiangliTipsWin;var CityBossView=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=0,e.skinName="CitySkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.onTap),this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this),this.addTouchEvent(this.seeRule,this.onSeeRule),this.viewStack.selectedIndex=0,this.viewStack.getElementAt(0).open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onSeeRule=function(t){ViewManager.ins().open(ZsBossRuleSpeak,16)},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e}(BaseEuiView);__reflect(CityBossView.prototype,"CityBossView"),ViewManager.ins().reg(CityBossView,LayerManager.UI_Main),window.CityBossView=CityBossView;var CityFunPanel=function(t){function e(){var e=t.call(this)||this;return e.isInitInter=!0,e.skinName="CityFunSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.attState,this.onClick),this.addTouchEvent(this.quit,this.onClick),this.observe(CityCC.ins().postChangeAttStatue,this.changeBtn),this.observe(CityCC.ins().postCityBossId,this.changeAttStatue),this.changeAttStatue(),Timer.has(this.changeBtn,this)||Timer.start(1e3,0,this.changeBtn,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.changeBtn,this)},e.prototype.changeAttStatue=function(){CityCC.ins().cityBossId>0&&(CityCC.ins().postChangeAttStatue(1),ViewManager.ins().open(TargetListPanel))},e.prototype.changeBtn=function(){var t=0;if(SubRoles.lookAtTar.isSafety())0!=CityCC.ins().cityBossId&&(t=1);else{var e=void 0,i=EntityManager.ins().getAllEntity(),n=void 0,s=SubRoles.lookAtTar;for(var o in i)if(e=i[o],n=e.infoModel,n&&n.type==EntityType.Monster&&n.getAtt(AttributeType.atHp)>0){var a=GlobalConfig.MonstersConfig[n.configID];if(!a)continue;if(4==a.type||3==a.type)continue;if(!s)continue;t=1;break}}if(this.attState.selected=ViewManager.ins().isShow(TargetListPanel)||!!t,this.attState.icon=this.attState.selected?"btn_attack":"btn_peace",this.isInitInter){this.isInitInter=!1;var r=0;this.attState.selected?(ViewManager.ins().open(TargetListPanel),r=1):0==CityCC.ins().cityBossId&&(r=2,ViewManager.ins().close(TargetListPanel)),CityCC.ins().postChangeAttStatue(r)}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.attState:var e=0;this.attState.selected?(ViewManager.ins().open(TargetListPanel),e=1):0==CityCC.ins().cityBossId?(e=2,ViewManager.ins().close(TargetListPanel)):TipsCT.ins().showTips("当前远古BOSS攻城期间，不能切换模式"),CityCC.ins().postChangeAttStatue(e);break;case this.quit:WarnWin.show("是否退出主城，退出后有30秒进入CD",function(){FbCT.ins().sendExitFb()},this)}},e}(BaseEuiView);__reflect(CityFunPanel.prototype,"CityFunPanel"),System.ViewManager=function(){return ViewManager.ins()},ViewManager.ins().reg(CityFunPanel,LayerManager.UI_Main),window.CityFunPanel=CityFunPanel;var MonsterCityWarView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(CityCC.ins().postBossInfo,this.checkState),this.observe(CityCC.ins().postCityBossId,this.checkState),this.initView()},e.prototype.skinComplete=function(){this.list.itemRenderer=BossListRender,this.rewardList.itemRenderer=ItemBase,this.canChallengeTxt.text="未刷新",this.bossEffect=new MovieClip,this.bossEffect.scaleX=-1,this.bossEffect.scaleY=1,this.bossEffect.x=78,this.bossEffect.y=160,this.bossGroup.addChild(this.bossEffect),this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=160,this.bossGroup.addChild(this.bossImage),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.addTouchEvent(this.challengeBtn,this.onChallenge)},e.prototype.initView=function(){this.list.dataProvider=CityCC.ins().getBossList();var t=this.getBossIndex();this.list.selectedIndex=t,this.updateView(t)},e.prototype.getBossIndex=function(){var t=CityCC.ins().getShowBossId(),e=0;if(t>0)for(var i=this.list.dataProvider.length,n=0;i>n;n++)if(t==this.list.dataProvider.getItemAt(n)){e=n;break}return e},e.prototype.onChallenge=function(){CityCC.ins().enterCD>0?TipsCT.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城"):CityCC.ins().isCity?egret.callLater(function(){var t=ViewManager.ins().getView(BossBelongPanel);t&&t.attrBoss()},this):(CityCC.ins().isChallenge=!0,CityCC.ins().sendEnter()),ViewManager.ins().close(this)},e.prototype.checkState=function(){this.list.dataProvider=CityCC.ins().getBossList(),this.updateView(this.list.selectedIndex)},e.prototype.onListChange=function(t){this.updateView(t.itemIndex)},e.prototype.updateView=function(t){var e=this.list.dataProvider.getItemAt(t),i=GlobalConfig.MonstersConfig[e],n=CityCC.ins().getCityBossConfig(e),s=CityCC.ins().getKillBossNum(e),o=CityCC.ins().getNeedKillBossNum(e),a=s>=o,r=GlobalConfig.EffectConfig[i.effect].fileName;this.bossName.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+GlobalConfig.MonstersConfig[n.killBossId].name+"</u></a>"),this.bossName.touchEnabled=!0;var l=CityCC.ins().getRefreshTime(e);l&&l.length>0?this.nextTime.text="最快将于"+CityCC.ins().getRefreshTime(e)+"刷新":this.nextTime.text="",this.nextTime.visible=!0,this.nameTxt.text=i.name+"("+i.level+"级)",this.killProgressBar.minimum=0,this.killProgressBar.maximum=o,this.killProgressBar.value=s,this.rewardList.dataProvider=new eui.ArrayCollection(n.showReward),this.bossImage.playFile(RES_DIR_MONSTER+(i.avatar+"_3s"),-1),this.bossEffect.playFile(RES_DIR_EFF+r,-1),this.updateState(a)},e.prototype.updateState=function(t){this.canChallengeTxt.visible=!t,this.challengeBtn.visible=t,this.redPoint.visible=t,this.stateImage.visible=t,this.nextTime.visible=!t},e}(BaseView);__reflect(MonsterCityWarView.prototype,"MonsterCityWarView"),window.MonsterCityWarView=MonsterCityWarView;var StatueView=function(t){function e(e,i,n){var s=t.call(this)||this;return s.title=new MovieClip,s.title.playFile(RES_DIR_EFF+e,-1),s.addChild(s.title),s.roleName=new eui.Label,s.roleName.size=14,s.roleName.strokeColor=0,s.roleName.stroke=1,s.roleName.text=""+i,s.roleName.x=-s.roleName.width>>1,s.addChild(s.roleName),s.model=new eui.Image,s.model.source=""+RES_DIR_CITY+n+".png",s.model.once(egret.Event.COMPLETE,function(){s.model.x=-s.model.width>>1,s.model.y=-s.model.height,s.roleName.y=s.model.y-20,s.title.y=s.roleName.y-50},s),s.addChild(s.model),s}return __extends(e,t),Object.defineProperty(e.prototype,"weight",{get:function(){return this.y},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(StatueView.prototype,"StatueView"),window.StatueView=StatueView;var BossListRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="CityBossItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.MonstersConfig[t];this.nameTxt.text=e.name;var i=CityCC.ins().getKillBossNum(t)>=CityCC.ins().getNeedKillBossNum(t);this.redPoint.visible=i},e}(BaseItemRender);__reflect(BossListRender.prototype,"BossListRender"),window.BossListRender=BossListRender;var CrossDartCT=function(t){function e(){var i=t.call(this)||this;return i.score=0,i.rewardState=0,i.changeTimes=0,i.carDatas=[],i.joinCarNum=0,i.guildScore=0,i.guildCarData=[],i.logs=[],i.guildLogs=[],i.openState=e.ACTIVITY_CLOSE,i.openLeftTime=0,i.sysId=PackageID.CrossDart,i.regNetMsg(1,i.postInfo),i.regNetMsg(2,i.postGuildInfo),i.regNetMsg(3,i.postGuildInfoChange),i.regNetMsg(4,i.postSignUpChange),i.regNetMsg(5,i.postGuildCarChange),i.regNetMsg(6,i.doRefreshCar),i.regNetMsg(7,i.postBuyLing),i.regNetMsg(9,i.postBossResult),i.regNetMsg(10,i.postScore),i.regNetMsg(11,i.postScoreReward),i.regNetMsg(12,i.postLogs),i.regNetMsg(14,i.postJoinCarNum),i.regNetMsg(25,i.postOpenNotice),i}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){this.score=t.readUnsignedInt(),this.rewardState=t.readInt();var e=t.readByte();this.hasJoinCars=[];for(var i=0;e>i;i++)this.hasJoinCars.push(t.readUnsignedByte());this.curLingNum=t.readUnsignedInt(),this.hasBuyNum=t.readUnsignedInt(),this.lingCD=DateUtils.formatMiniDateTime(t.readUnsignedInt()),this.changeTimes=t.readUnsignedByte(),e=t.readByte(),this.carDatas=[];for(var i=0;e>i;i++)this.carDatas.push(this.createCarData(t,i+1))},e.prototype.createCarData=function(t,e){var i={id:e,guildId:t.readInt(),guildName:t.readString(),serverID:t.readInt(),carLv:t.readByte(),totalNum:t.readInt(),hasNum:t.readInt(),canPlunderNum:t.readUnsignedShort()};return i},e.prototype.updateCarData=function(t,e){var i=t.readInt(),n=t.readString(),s=t.readInt(),o=t.readByte(),a=t.readInt(),r=t.readInt(),l=t.readUnsignedShort();e&&(e.guildId=i,e.guildName=n,e.serverID=s,e.carLv=o,e.totalNum=a,e.hasNum=r,e.canPlunderNum=l)},e.prototype.postGuildInfo=function(t){this.guildScore=t.readUnsignedInt();var e=t.readByte();this.guildCarData=[];for(var i=0;e>i;i++){for(var n=[],s={id:t.readByte(),lv:t.readByte(),canPlunderNum:t.readByte(),state:t.readByte(),dartDivisions:n},o=t.readUnsignedShort(),a=0;o>a;a++)n.push(this.createDartDivision(t));this.guildCarData.push(s)}},e.prototype.createDartDivision=function(t){var e={name:t.readString(),lv:t.readUnsignedShort(),zsLv:t.readUnsignedShort(),power:t.readUnsignedInt()};return e},e.prototype.sendJoinOrQuit=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postGuildInfoChange=function(t){var e=this.getGuildCarById(t.readByte());if(e){e.lv=t.readUnsignedByte(),e.canPlunderNum=t.readUnsignedByte(),e.state=t.readUnsignedByte(),e.dartDivisions=[];for(var i=t.readUnsignedShort(),n=0;i>n;n++)e.dartDivisions.push(this.createDartDivision(t))}},e.prototype.postSignUpChange=function(t){var e=t.readUnsignedByte();this.hasJoinCars=[];for(var i=0;e>i;i++)this.hasJoinCars.push(t.readUnsignedByte())},e.prototype.postGuildCarChange=function(t){var e=t.readByte(),i=this.getGuildCarById(e);i?i.state=t.readByte():this.errorLog(e)},e.prototype.errorLog=function(t){var e="";for(var i in this.guildCarData)e+="位置:"+i+"-id:"+this.guildCarData[i].id+"-";platform.reportError("GuildCarId:"+t+"-carNum:"+e)},e.prototype.sendRefreshCar=function(){this.sendBaseProto(6)},e.prototype.doRefreshCar=function(t){var e=t.readUnsignedByte();this.changeTimes=t.readUnsignedByte();var i=t.readUnsignedByte();if(0==e){this.carDatas=[];for(var n=0;i>n;n++)this.carDatas.push(this.createCarData(t,n+1));this.postRefreshCar()}else{for(var n=0;i>n;n++)this.updateCarData(t,this.carDatas[n]);this.postUpdateCar()}},e.prototype.postRefreshCar=function(){},e.prototype.postUpdateCar=function(){},e.prototype.sendBuyLing=function(){this.sendBaseProto(7)},e.prototype.postBuyLing=function(t){this.curLingNum=t.readUnsignedInt(),this.hasBuyNum=t.readUnsignedInt()},e.prototype.sendChallengeCar=function(t){var e=this.getBytes(8);e.writeByte(t),this.sendToServer(e)},e.prototype.postBossResult=function(t){for(var e=t.readByte(),i=t.readString(),n=t.readInt(),s=t.readInt(),o=t.readUnsignedInt(),a=t.readUnsignedShort(),r=[],l=0;a>l;l++)r[l]=new RewardData,r[l].parser(t);var h=t.readString();ResultManager.ins().create(FbCT.FB_TYPE_DARTCAR,e,i,n,s,o,r,h)},e.prototype.postScore=function(t){this.score=t.readUnsignedInt(),this.guildScore=t.readUnsignedInt()},e.prototype.postScoreReward=function(t){this.score=t.readUnsignedInt(),this.rewardState=t.readUnsignedInt()},e.prototype.sendScoreReward=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.postLogs=function(t){for(var e=t.readByte(),i=t.readInt(),n=[],s=0;i>s;s++)n.push({time:t.readUnsignedInt(),str:t.readString()});1==e?this.logs=n:this.guildLogs=n},e.prototype.sendLogs=function(t){var e=this.getBytes(12);e.writeByte(t),this.sendToServer(e)},e.prototype.sendCheckCar=function(){this.sendBaseProto(13)},e.prototype.postJoinCarNum=function(t){this.joinCarNum=t.readByte()},e.prototype.postOpenNotice=function(t){this.openState=t.readInt(),this.openLeftTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.getGuildCarById=function(t){return this.guildCarData[t-1]},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=this.getOpenTips();return t&&""!=e&&TipsCT.ins().showTips(e),""==e},e.prototype.getOpenTips=function(){var t=GlobalConfig.CrossDartCarBase,i="";return GameServer.serverOpenDay+1<t.openDay?i="开服"+t.openDay+"天开启":0==Guild.ins().guildID?i="加入公会后可参与":Guild.ins().guildLv<t.guildLevel?i="公会"+t.guildLevel+"级开启":ZsCT.ins().lv<t.zhuanshengLevel?i=t.zhuanshengLevel+"转开启":this.openState==e.ACTIVITY_CLOSE&&(i="活动暂未开放"),i},e.prototype.checkSysOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.CrossDartCarBase,i="";return GameServer.serverOpenDay+1<e.openDay?i="开服"+e.openDay+"天开启":ZsCT.ins().lv<e.zhuanshengLevel&&(i=e.zhuanshengLevel+"转开启"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.prototype.getRewardStateById=function(t){return(this.rewardState>>t&1)>0?2:this.score>=GlobalConfig.PersonalScoreRewardConfig[t].score?1:0},e.prototype.buyLing=function(){WarnWin.show("确认花费<font color='#ff9649'>"+GlobalConfig.CrossDartCarBase.buyChallengeMoney+"元宝</font>购买1枚劫镖令吗？\n今天已购买："+this.hasBuyNum+"/"+GlobalConfig.CrossDartCarBase.buyChallengeCount,function(){e.ins().hasBuyNum<GlobalConfig.CrossDartCarBase.buyChallengeCount?(Actor.yb<GlobalConfig.CrossDartCarBase.buyChallengeMoney&&ViewManager.ins().close(WarnWin),GlobalFun.checkMoney(GlobalConfig.CrossDartCarBase.buyChallengeMoney,MoneyConst.yuanbao,"元宝不足，无法购买")&&e.ins().sendBuyLing()):TipsCT.ins().showTips("次数已满")},this)},e.prototype.refreshCars=function(){this.openState!=e.STATE_MOVE?TipsCT.ins().showTips("活动暂未开放"):this.changeTimes>0?e.ins().sendRefreshCar():WarnWin.show("是否花费<font color='#ff9649'>"+GlobalConfig.CrossDartCarBase.buyRefreshListMoney+"元宝</font>重新随机获取新的一批镖车",function(){GlobalFun.checkMoney(GlobalConfig.CrossDartCarBase.buyRefreshListMoney,MoneyConst.yuanbao,"元宝不足，无法购买")&&e.ins().sendRefreshCar()},this)},e.prototype.hasJoinCarById=function(t){return-1!=this.hasJoinCars.indexOf(t)},e.prototype.hasJoinCarNum=function(){var t=0;for(var e in this.hasJoinCars)this.hasJoinCars[e]>0&&t++;return t},e.prototype.getBreakNum=function(t){return Math.max(GlobalConfig.CrossDartCarBase.dartCarBreakNum-t,0)},e.getCarColor=function(t){switch(t){case 1:return 11645079;case 2:return 5342973;case 3:return 13779707;case 4:return 16741647;default:return 15937822}},e.MAXJOIN=2,e.ACTIVITY_CLOSE=0,e.STATE_OPEN=1,e.STATE_READY=2,e.STATE_MOVE=3,e.STATE_CLOSE=4,__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postGuildInfo",null),__decorate([post()],e.prototype,"postGuildInfoChange",null),__decorate([post()],e.prototype,"postSignUpChange",null),__decorate([post()],e.prototype,"postGuildCarChange",null),__decorate([post()],e.prototype,"postRefreshCar",null),__decorate([post()],e.prototype,"postUpdateCar",null),__decorate([post()],e.prototype,"postBuyLing",null),__decorate([post()],e.prototype,"postBossResult",null),__decorate([post()],e.prototype,"postScore",null),__decorate([post()],e.prototype,"postScoreReward",null),__decorate([post()],e.prototype,"postLogs",null),__decorate([post()],e.prototype,"postJoinCarNum",null),__decorate([post()],e.prototype,"postOpenNotice",null),e}(BaseSystem);__reflect(CrossDartCT.prototype,"CrossDartCT"),System.CrossDartCT=function(){return CrossDartCT.ins()},window.CrossDartCT=CrossDartCT;var DartRedPoint=function(t){function e(){var e=t.call(this)||this;return e.plunderPoint=!1,e.rewardPoints=[],e.joinPoint=!1,e.canJoinPoints=[],e.associated(e.postRedPoint,e.postPlunderPoint,e.postJoinPoint),e.associated(e.postPlunderPoint,e.postRewardPoint),e.associated(e.postRewardPoint,CrossDartCT.ins().postInfo,CrossDartCT.ins().postScoreReward),e.associated(e.postJoinPoint,e.postCanJoinPoint),e.associated(e.postCanJoinPoint,CrossDartCT.ins().postGuildInfo,CrossDartCT.ins().postSignUpChange,Guild.ins().postGuildInfo,Guild.ins().postUpBuilding),e
}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.plunderPoint||this.joinPoint,t!=this.redPoint},e.prototype.postPlunderPoint=function(){this.plunderPoint=!1;for(var t in this.rewardPoints)this.rewardPoints[t]&&(this.plunderPoint=!0);!this.plunderPoint&&CrossDartCT.ins().openState==CrossDartCT.STATE_MOVE&&CrossDartCT.ins().curLingNum>0&&CrossDartCT.ins().lingCD<GameServer.serverTime&&(this.plunderPoint=!0)},e.prototype.postRewardPoint=function(){var t=GlobalConfig.PersonalScoreRewardConfig;for(var e in t){var i=t[e].id,n=CrossDartCT.ins().getRewardStateById(t[e].id);this.rewardPoints[i]=1==n}},e.prototype.postJoinPoint=function(){this.joinPoint=!1;for(var t in this.canJoinPoints)this.canJoinPoints[t]&&(this.joinPoint=!0)},e.prototype.postCanJoinPoint=function(){this.canJoinPoints=[];var t=CrossDartCT.ins().guildCarData;for(var e in t){var i=t[e],n=CrossDartCT.ins().hasJoinCarById(i.id);this.canJoinPoints[i.id]=0==i.state&&!n&&Guild.ins().guildLv>=GlobalConfig.CrossDartCarBase.guildLevel&&CrossDartCT.ins().hasJoinCarNum()<CrossDartCT.MAXJOIN&&i.dartDivisions.length<GlobalConfig.CrossDartCarBase.dartCarNumber[Guild.ins().guildLv]}},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postPlunderPoint",null),__decorate([post()],e.prototype,"postRewardPoint",null),__decorate([post()],e.prototype,"postJoinPoint",null),__decorate([post()],e.prototype,"postCanJoinPoint",null),e}(BaseSystem);__reflect(DartRedPoint.prototype,"DartRedPoint"),System.DartRedPoint=function(){return DartRedPoint.ins()},window.DartRedPoint=DartRedPoint;var CrossDartWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(DartRedPoint.ins().postPlunderPoint,this.updateRed),this.observe(DartRedPoint.ins().postJoinPoint,this.updateRed),this.updateRed()},e.prototype.onClick=function(t){switch(t.target){case this.help:ViewManager.ins().open(ZsBossRuleSpeak,48)}},e.prototype.updateRed=function(){this.eRed0.visible=DartRedPoint.ins().plunderPoint,this.eRed1.visible=DartRedPoint.ins().joinPoint},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return CrossDartCT.ins().checkOpen(!0)},e}(BaseEuiView);__reflect(CrossDartWin.prototype,"CrossDartWin"),window.CrossDartWin=CrossDartWin,ViewManager.ins().reg(CrossDartWin,LayerManager.UI_Main);var DartCarInfoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoInfoSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eLoseList.itemRenderer=ItemBase,this.eWinList.itemRenderer=ItemBase,this.eList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onClick)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];if(null==t[0])return!1;var n=(CrossDartCT.ins().lingCD-GameServer.serverTime)/1e3,s=null;return n>0?s="|C:0x"+ColorUtil.RED+"&T:劫镖冷却中，无法进行掠夺|":CrossDartCT.ins().curLingNum<=0?s="劫镖令不足，无法挑战":i.canPlunderNum<=0&&(s="这辆镖车已经够惨了，换一辆吧~"),s?(TipsCT.ins().showTips(s),!1):!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.carData=t[0],this.update()},e.prototype.update=function(){this.eLv.textColor=CrossDartCT.getCarColor(this.carData.carLv),this.eLv.text=this.carData.carLv+"级镖车",this.eCarImg.source="kf_bclv"+this.carData.carLv,this.eServer.text=this.carData.serverID+"区",this.eGuildName.text=this.carData.guildName,this.eMembers.text=this.carData.hasNum+"/"+this.carData.totalNum;var t=new RewardData;t.type=0,t.id=MoneyConst.dartCarScore,t.count=GlobalConfig.DartCarLootConfig[this.carData.carLv][1].score,this.eLoseList.dataProvider=new eui.ArrayCollection([t]),t=new RewardData,t.type=0,t.id=MoneyConst.dartCarScore,t.count=GlobalConfig.DartCarLootConfig[this.carData.carLv][2].score,this.eWinList.dataProvider=new eui.ArrayCollection([t]),t=new RewardData,t.type=0,t.id=MoneyConst.dartCarScore,t.count=GlobalConfig.DartCarLootConfig[this.carData.carLv][3].score,this.eList.dataProvider=new eui.ArrayCollection([t])},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eBtn:CrossDartCT.ins().sendChallengeCar(this.carData.id)}},e}(BaseEuiView);__reflect(DartCarInfoWin.prototype,"DartCarInfoWin"),window.DartCarInfoWin=DartCarInfoWin,ViewManager.ins().reg(DartCarInfoWin,LayerManager.UI_Popup);var StringUtils=function(){function t(){}return t.trimSpace=function(t){return t.replace(/^\s*(.*?)[\s\n]*$/g,"$1")},t.getStringLength=function(t){for(var e=t.split(""),i=0,n=0;n<e.length;n++){var s=e[n];i+=this.isChinese(s)?2:1}return i},t.isChinese=function(t){var e=/^[\u4E00-\u9FA5]+$/;return e.test(t)?!1:!0},t.strByteLen=function(t){for(var e=0,i=t.length,n=0;i>n;n++)e+=t.charCodeAt(n)>=127?2:1;return e},t.complementByChar=function(e,i,n,s){void 0===n&&(n=" "),void 0===s&&(s=!0);var o=this.strByteLen(s?e.replace(t.HTML,""):e);return e+this.repeatStr(n,i-o)},t.repeatStr=function(t,e){for(var i="",n=0;e>n;n++)i+=t;return i},t.addColor=function(t,e){var i;if("string"==typeof e)i=String(e);else{if("number"!=typeof e)return t;i=Number(e).toString(10)}return'<font color="'+i+'">'+t+"</font>"},t.addColor1=function(t,e){var i=new Object;return i.style=new Object,i.text=t,i.textColor=Number(e).toString(16),i},t.substitute=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=RegExpUtil.REPLACE_STRING,s=t.match(n);if(s&&s.length)for(var o=s.length,a=0;o>a;a++)t=t.replace(s[a],e[a]);return t},t.replaceStr=function(t,e,i){if(-1==t.indexOf(e))return t;var n=t.split(e);return n[0]+i+n[1]},t.replaceStrColor=function(t,e){for(var i=t.indexOf("0x"),n=i,s="",o="";-1!=n;)s=t.substring(i,i+8),t=t.replace(s,e),i+=8,o=t.substring(i),n=o.indexOf("0x"),i+=n;return t},t.replace=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0;n<e.length;n++)t=t.replace("%s",e[n]+"");return t},t.getStrByRegExp=function(t,e){void 0===e&&(e=/\d+/g);var i=[];t.replace(e,function(){return i.push(arguments[0]),"number"==typeof arguments[0]?arguments[0].toString():arguments[0]});return i},t.ChineseToNumber=function(e){for(var i=0,n=0,s=0,o=!1,a=e.split(""),r=0;r<a.length;r++){var l=t.chnNumCharCN[a[r]];if("undefined"!=typeof l)s=l,r===a.length-1&&(n+=s);else{var h=t.chnNameValueCN[a[r]].value;o=t.chnNameValueCN[a[r]].secUnit,o?(n=(n+s)*h,i+=n,n=0):n+=s*h,s=0}}return i+n},t.NumberToChinese=function(e){var i=0,n="",s="",o=!1,a=t.chnNumChar,r=t.chnUnitSection;if(0===e)return a[0];if(e>=10&&20>e)return t.chnUnitChar[1]+t.SectionToChinese(e%10);for(;e>0;){var l=e%1e4;o&&(s=a[0]+s),n=t.SectionToChinese(l),n+=0!==l?r[i]:r[0],s=n+s,o=1e3>l&&l>0,e=Math.floor(e/1e4),i++}return s},t.SectionToChinese=function(e){for(var i="",n="",s=0,o=!0,a=t.chnNumChar,r=t.chnUnitChar;e>0;){var l=e%10;0===l?o||(o=!0,n=a[l]+n):(o=!1,i=a[l],i+=r[s],n=i+n),s++,e=Math.floor(e/10)}return n},t.HTML=/<[^>]+>/g,t.chnNumCharCN={"零":0,"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9},t.chnNameValueCN={"十":{value:10,secUnit:!1},"百":{value:100,secUnit:!1},"千":{value:1e3,secUnit:!1},"万":{value:1e4,secUnit:!0},"亿":{value:1e8,secUnit:!0}},t.chnNumChar=["零","一","二","三","四","五","六","七","八","九"],t.chnUnitSection=["","万","亿","万亿","亿亿"],t.chnUnitChar=["","十","百","千"],t}();__reflect(StringUtils.prototype,"StringUtils"),window.StringUtils=StringUtils;var DartConvoyItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoConvoyInfoSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eName.textFlow=TextFlowMaker.generateTextFlow(t.name),t.zsLv>0?this.eLv.text=t.zsLv+"转"+t.lv+"级":this.eLv.text=t.lv+"级",this.ePower.text="战斗力："+t.power}},e}(BaseItemRender);__reflect(DartConvoyItem.prototype,"DartConvoyItem"),window.DartConvoyItem=DartConvoyItem;var DartGuildItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoGuildItemSkin",e.eList.itemRenderer=ItemBaseNoName,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof RankDataGuildDart){this.eGuildName.text=this.data.guildName,this.sServer.text=0!=this.data.serverId?this.data.serverId+"区":"",this.score.text=this.data.score>0?this.data.score+"":"",this.data.pos<4?(this.rankTxt.text="",this.rankImg.source="paihang"+this.data.pos):(this.rankTxt.text=this.data.pos+"",this.rankImg.source="");for(var t in GlobalConfig.DartCarGuildRankAward){var e=GlobalConfig.DartCarGuildRankAward[t];if(this.data.pos>=e.range[0]&&this.data.pos<=e.range[1]){this.eList.dataProvider=new eui.ArrayCollection(e.award);break}}}},e}(BaseItemRender);__reflect(DartGuildItem.prototype,"DartGuildItem"),window.DartCarItem=DartCarItem;var DartGuildRankPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoGuildRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=DartGuildItem},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Rank.ins().postRankingData,this.update),Rank.ins().sendGetRankingData(RankDataType.TYPE_GUILDDART)},e.prototype.update=function(t){if(void 0===t&&(t=null),!t||t.type==RankDataType.TYPE_GUILDDART){for(var e=t?t.getDataList():null,i=[],n=0;20>n;n++)if(e&&e[n])i.push(e[n]);else{var s=new RankDataGuildDart;s.pos=n+1,s.score=0,s.serverId=0,s.guildName="虚位以待",i.push(s)}this.eGuildScore.text=CrossDartCT.ins().guildScore+"",this.eGuildRank.text=t&&t.selfPos>0?t.selfPos+"":"未上榜",this.eList.dataProvider=new eui.ArrayCollection(i)}},e}(BaseView);__reflect(DartGuildRankPanel.prototype,"DartGuildRankPanel"),window.DartGuildRankPanel=DartGuildRankPanel;var DartJoinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoSelectSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eCarLab.text=t.lv+"级镖车",this.eCarLab.textColor=CrossDartCT.getCarColor(t.lv),this.eCarImg.source="kf_bclv"+t.lv,this.eSelectImg.visible=this.selected;var e=CrossDartCT.ins().hasJoinCarById(t.id);switch(t.state){case 0:this.eConvoyImg.source=e?"kf_yunbiao_ycy":"kf_yunbiao_wcy";break;case 1:this.eConvoyImg.source=e?"kf_yunbiao_ycy":"kf_yunbiao_wcy";break;case 2:this.eConvoyImg.source=e?"kf_yunbiao_ycy":"kf_yunbiao_yfc";break;case 3:this.eConvoyImg.source="kf_yunbiao_lb";break;case 4:this.eConvoyImg.source="kf_yunbiao_ywc"}this.eBtn.label=e?"取消护送":"参与护送",this.eBtn.enabled=!(0!=t.state||!e&&CrossDartCT.ins().hasJoinCarNum()>=CrossDartCT.MAXJOIN),t.state<=2?(this.eTime.textColor=15978507,this.eTime.text="发车时间\n"+GlobalConfig.CrossDartCarBase.startTimes[t.id-1]+":00:00"):(this.eTime.textColor=1694464,this.eTime.text="抵达时间\n"+(GlobalConfig.CrossDartCarBase.startTimes[t.id-1]+GlobalConfig.CrossDartCarBase.lastTime)+":00:00"),this.eRed.visible=DartRedPoint.ins().canJoinPoints[t.id]}},e.prototype.setSelect=function(t){this.eSelectImg.visible=t},e}(BaseItemRender);__reflect(DartJoinItem.prototype,"DartJoinItem"),window.DartJoinItem=DartJoinItem;var DartJoinPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFyunbiaoJoinSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=DartJoinItem,this.listDP=new eui.ArrayCollection(CrossDartCT.ins().guildCarData),this.eList.dataProvider=this.listDP,this.eList.selectedIndex=this.selectId=0,this.eListMember.itemRenderer=DartConvoyItem,this.eGuildReward.itemRenderer=ItemBase,this.eReward.itemRenderer=ItemBase,this.addEvent(egret.Event.CHANGE,this.eList,this.onChange),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossDartCT.ins().postGuildInfoChange,this.updateUI),this.observe(CrossDartCT.ins().postSignUpChange,this.updateUI),this.observe(CrossDartCT.ins().postJoinCarNum,this.updateJoinCar),this.observe(DartRedPoint.ins().postJoinPoint,this.updateList),this.updateUI()},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof DartJoinItem){var e=t.target.parent.data,i=CrossDartCT.ins().hasJoinCarById(e.id);return!i&&e.dartDivisions.length>=GlobalConfig.CrossDartCarBase.dartCarNumber[Guild.ins().guildLv]?void TipsCT.ins().showTips("本趟镖车当前护送人数已满"):void CrossDartCT.ins().sendJoinOrQuit(e.id,i?2:1)}},e.prototype.updateJoinCar=function(){this.eConvoyLab.text=CrossDartCT.MAXJOIN-CrossDartCT.ins().joinCarNum+"/"+CrossDartCT.MAXJOIN},e.prototype.updateUI=function(){var t=this.eList.selectedItem;if(t){this.updateJoinCar(),this.eNum.text=t.dartDivisions.length+"",this.eTotal.text=GlobalConfig.CrossDartCarBase.dartCarNumber[Guild.ins().guildLv]+"",this.eListMember.dataProvider=new eui.ArrayCollection(t.dartDivisions),this.eRewardImg.source=CrossDartCT.ins().hasJoinCarById(t.id)&&4==t.state?"kf_yunbiao_hdjl":"kf_yunbiao_khdjl";var e=CrossDartCT.ins().getBreakNum(t.canPlunderNum),i=GlobalConfig.DartCarLevelRewardConfig[t.lv][e],n=new RewardData;n.type=0,n.id=MoneyConst.dartCarGuildScore,n.count=i.guild_score,this.eGuildReward.dataProvider=new eui.ArrayCollection([n]),n=new RewardData,n.type=0,n.id=MoneyConst.dartCarScore,n.count=i.personal_score,this.eReward.dataProvider=new eui.ArrayCollection([n]),this.updateList()}},e.prototype.updateList=function(){this.listDP.source=CrossDartCT.ins().guildCarData},e.prototype.onChange=function(){var t=this.eList.getElementAt(this.selectId);t&&t.setSelect(!1),this.selectId=this.eList.selectedIndex,t=this.eList.getElementAt(this.selectId),t&&t.setSelect(!0),this.updateUI()},__decorate([callLater],e.prototype,"updateUI",null),__decorate([callLater],e.prototype,"updateList",null),e}(BaseView);__reflect(DartJoinPanel.prototype,"DartJoinPanel"),window.DartJoinPanel=DartJoinPanel;var DartMarketItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PeakMarketItemSkin",e.itemIcon.imgJob.visible=!1,e.itemIcon.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.ItemConfig[t.goods.id];if(e)switch(this.itemIcon.setData(e),this.money.text=t.costItem.count+"",this.num.text=t.goods.count+"",this.itemName.text=e.name,this.usage.text="",this.buyBtn.enabled=!0,t.buyType){case 1:this.myTimes.visible=!0;var i=Shop.ins().getDartBuyNumById(t.index),n=this.myTimes.textColor,s=void 0,o="";t.Maxcount&&(i>=t.Maxcount?(this.buyBtn.enabled=!1,s=ColorUtil.RED,o="每日限购:|C:"+s+"&T:"+i+"/"+t.Maxcount):(s=ColorUtil.GREEN,o="每日限购:|C:"+s+"&T:"+i+"|/|C:"+n+"&T:"+t.Maxcount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o);break;case 2:this.myTimes.visible=!1;break;case 3:this.myTimes.visible=!0;var i=Shop.ins().getDartBuyNumById(t.index),n=this.myTimes.textColor,s=void 0,o="";t.Maxcount&&(i>=t.Maxcount?(s=ColorUtil.RED,this.buyBtn.enabled=!1,o="永久限购:|C:"+s+"&T:"+i+"/"+t.Maxcount):(s=ColorUtil.GREEN,o="永久限购:|C:"+s+"&T:"+i+"|/|C:"+n+"&T:"+t.Maxcount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o);break;case 4:this.myTimes.visible=!0;var i=Shop.ins().getDartBuyNumById(t.index),n=this.myTimes.textColor,s=void 0,o="";t.Maxcount&&(i>=t.Maxcount?(s=ColorUtil.RED,this.buyBtn.enabled=!1,o="每周限购:|C:"+s+"&T:"+i+"/"+t.Maxcount):(s=ColorUtil.GREEN,o="每周限购:|C:"+s+"&T:"+i+"|/|C:"+n+"&T:"+t.Maxcount)),this.myTimes.textFlow=TextFlowMaker.generateTextFlow1(o)}}},e}(BaseItemRender);__reflect(DartMarketItem.prototype,"DartMarketItem"),window.OSATarget29RankItemRender=OSATarget29RankItemRender;var DartMarketPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="PeakMarketSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listView.itemRenderer=DartMarketItem,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Shop.ins().postAllDartData,this.update),this.observe(Shop.ins().postDartData,this.update),this.update()},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof DartMarketItem){var e=t.target.parent.data;ViewManager.ins().open(BuyWin,e.index,4)}else if(t.target instanceof ItemIcon&&t.target.parent instanceof DartMarketItem){var e=t.target.parent.data;this.showTip(e.goods)}},e.prototype.update=function(){var t=[];for(var e in GlobalConfig.CrossDartCarStore){var i=GlobalConfig.CrossDartCarStore[e];if(!(i.openday[0]>GameServer.serverOpenDay+1||i.openday[1]<GameServer.serverOpenDay+1)){var n=!0;3==i.buyType&&(n=Shop.ins().getDartBuyNumById(i.index)<i.Maxcount),n&&t.push(i)}}t.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"sort")});var s=t[0].costItem.id;this.dataArr.replaceAll(t),this.myLabel.text=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s)+"",this.eLab.text="我的"+GlobalConfig.ItemConfig[s].name+":",this.eIcon.source=GlobalConfig.ItemConfig[s].icon+"_png"},e.prototype.showTip=function(t){var e=GlobalConfig.ItemConfig[t.id];switch(ItemUtil.getType(e)){case ItemType.TYPE_1:Dress.ins().isZhuangBanItem(t.id)?ViewManager.ins().open(DressTipsWin,e):ViewManager.ins().open(ItemDetailedWin,0,t.id,t.count);break;case ItemType.TYPE_30:var i=WushuangEquipCT.getPos(t.id),n=[];n[i]=[t.id,BagCT.getAttrPower(ItemUtil.getBaseAttrData(GlobalConfig.ItemConfig[t.id]))],ViewManager.ins().open(WushuangEquipTips,n,i);break;default:ViewManager.ins().open(ItemDetailedWin,0,t.id,t.count)}},e}(BaseView);__reflect(DartMarketPanel.prototype,"DartMarketPanel"),window.DartMarketPanel=DartMarketPanel;var DartPlunderListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eServer.text=t.serverID+"区",this.eGuildName.text=t.guildName,this.eLv.text=t.carLv+"",this.eMember.text=t.hasNum+"/"+t.totalNum,this.eTimes.text=t.canPlunderNum+"次"}},e}(BaseItemRender);__reflect(DartPlunderListItem.prototype,"DartPlunderListItem"),window.DartPlunderListItem=DartPlunderListItem;var DartPlunderListWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoLootListSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=DartPlunderListItem,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossDartCT.ins().postRefreshCar,this.updateList),this.updateList()},e.prototype.updateList=function(){this.eList.dataProvider=new eui.ArrayCollection(CrossDartCT.ins().carDatas),this.eTips.visible=this.eList.dataProvider.length<=0,CrossDartCT.ins().changeTimes>0?this.bChangeBtn.label="换一批("+CrossDartCT.ins().changeTimes+"次)":this.bChangeBtn.label="换一批"},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof DartPlunderListItem){var e=t.target.parent.data;ViewManager.ins().open(DartCarInfoWin,e)}switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.bChangeBtn:CrossDartCT.ins().refreshCars()}},__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(DartPlunderListWin.prototype,"DartPlunderListWin"),window.DartPlunderListWin=DartPlunderListWin,ViewManager.ins().reg(DartPlunderListWin,LayerManager.UI_Popup);var DartPlunderPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KFyunbiaoPlunderSkin",e.listTotalW=0,e.itemRenderW=0,e.itemRenderGapH=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eBoxBtns=[null,this.eBoxBtn0,this.eBoxBtn1,this.eBoxBtn2,this.eBoxBtn3],this.redPoints=[null,this.redPoint0,this.redPoint1,this.redPoint2,this.redPoint3],this.eScoreLabs=[null,this.eLab0,this.eLab1,this.eLab2,this.eLab3],this.eCarList.itemRenderer=DartCarItem,this.carsDP=new eui.ArrayCollection,this.eCarList.dataProvider=this.carsDP,this.addTouchEvent(this,this.onClick),this.eCarScroller.touchEnabled=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossDartCT.ins().postRefreshCar,this.updateCarList),this.observe(CrossDartCT.ins().postScore,this.updateScore),this.observe(CrossDartCT.ins().postScoreReward,this.updateReward),this.observe(CrossDartCT.ins().postOpenNotice,this.updateState),this.observe(CrossDartCT.ins().postBuyLing,this.updateLing),Timer.start(1e3,0,this.updateState,this),Timer.start(1e4,0,this.updateTimer,this),this.updateCarList(),this.updateReward(),this.updateState(),this.updateChangeNum()},e.prototype.updateTimer=function(){CrossDartCT.ins().openState==CrossDartCT.STATE_MOVE&&CrossDartCT.ins().sendCheckCar()},e.prototype.removeDisplay=function(){this.skin&&egret.Tween.removeTweens(this.eCarScroller.viewport),Timer.has(this.moveCars,this)&&Timer.stop(this.moveCars,this),Timer.has(this.updateTimer,this)&&Timer.stop(this.updateTimer,this),Timer.has(this.updateState,this)&&Timer.stop(this.updateState,this)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button){var e=this.eBoxBtns.indexOf(t.target);if(-1!=e){var i=CrossDartCT.ins().getRewardStateById(e);if(0==i){var n=GlobalConfig.PersonalScoreRewardConfig[e].reward[0];ViewManager.ins().open(ItemDetailedWin,n.type,n.id,n.count)}else CrossDartCT.ins().sendScoreReward(e);return}}else if(t.target instanceof DartCarItem){var s=t.target.data;return void ViewManager.ins().open(DartCarInfoWin,s)}switch(t.target){case this.eListBtn:ViewManager.ins().open(DartPlunderListWin);break;case this.eLingBtn:CrossDartCT.ins().buyLing();break;case this.eChangeBtn:CrossDartCT.ins().openState==CrossDartCT.STATE_MOVE?CrossDartCT.ins().refreshCars():TipsCT.ins().showTips("活动还未开始");break;case this.eLogBtn:ViewManager.ins().open(DartRecordWin)}},e.prototype.updateChangeNum=function(){this.eChangeNum.text=CrossDartCT.ins().changeTimes+""},e.prototype.updateState=function(){switch(this.eTimeGroup1.visible=!1,CrossDartCT.ins().openState){case CrossDartCT.STATE_OPEN:case CrossDartCT.STATE_READY:this.eTimeGroup2.visible=this.eTimeGroup3.visible=!0,this.refreshTime2.text=DateUtils.getFormatBySecond(CrossDartCT.ins().openLeftTime/1e3,DateUtils.TIME_FORMAT_6),this.refreshTime3.text=DateUtils.getFormatBySecond(Math.max(CrossDartCT.ins().openLeftTime-GameServer.serverTime,0)/1e3,DateUtils.TIME_FORMAT_1),this.eTimeGroup0.visible=!1;break;case CrossDartCT.STATE_MOVE:this.eTimeGroup2.visible=this.eTimeGroup3.visible=!1,this.refreshTime0.text=DateUtils.getFormatBySecond(Math.max(CrossDartCT.ins().openLeftTime-GameServer.serverTime,0)/1e3,DateUtils.TIME_FORMAT_1),this.eTimeGroup1.visible=!0;var t=(CrossDartCT.ins().lingCD-GameServer.serverTime)/1e3;t>0?(this.refreshTime1.textColor=ColorUtil.RED,this.refreshTime1.text=DateUtils.getFormatBySecond(Math.max(t,0),DateUtils.TIME_FORMAT_1)):(this.refreshTime1.textColor=ColorUtil.GREEN,this.refreshTime1.text="可劫镖",DartRedPoint.ins().plunderPoint||DartRedPoint.ins().postPlunderPoint());break;default:this.eTimeGroup0.visible=this.eTimeGroup2.visible=this.eTimeGroup3.visible=!1}},e.prototype.updateScore=function(){var t,e=CrossDartCT.ins().score,i=GlobalConfig.PersonalScoreRewardConfig,n=CommonUtils.getObjectLength(i);for(var s in i)if(t=i[s],e<=t.score)break;this.eScoreLab.text=e+"",this.bar.maximum=100;var o=i[t.id-1]?i[t.id-1].score:0,a=(t.id-1+(e-o)/(t.score-o))/n*100;this.bar.value=Math.min(a,100)},e.prototype.updateReward=function(){var t=GlobalConfig.PersonalScoreRewardConfig;for(var e in t){var i=t[e].id,n=CrossDartCT.ins().getRewardStateById(t[e].id);switch(this.eBoxBtns[i].enabled=2!=n,this.eBoxBtns[i].filters=2==n?FilterUtil.ARRAY_GRAY_FILTER:[],this.redPoints[i].visible=1==n,n){case 1:this.eScoreLabs[i].text="可领取",this.eScoreLabs[i].textColor=ColorUtil.GREEN;break;case 2:this.eScoreLabs[i].text="已领取",this.eScoreLabs[i].textColor=ColorUtil.RED;break;default:this.eScoreLabs[i].text=t[e].score+""}}this.updateScore()},e.prototype.updateLing=function(){this.eLingNum.text=CrossDartCT.ins().curLingNum+""},e.prototype.updateCarList=function(){this.updateLing(),this.updateChangeNum(),egret.Tween.removeTweens(this.eCarScroller.viewport),this.eCarList.visible=!1;var t=2,e=CrossDartCT.ins().carDatas.concat();if(e&&0!=e.length){for(var i=[];e.length>0;){for(var n=[e.shift()],s=0;t-1>s;s++)n.push(e.shift()),n.push(null);GlobalFun.arrShuffle(n),i=i.concat(n)}for(var o=4;o>0;)i.push(null),i.unshift(null),o--;this.carsDP.replaceAll(i),this.eCarList.validateNow(),this.itemRenderW=this.eCarList.getVirtualElementAt(0).width,this.itemRenderGapH=this.eCarList.layout.horizontalGap,this.listTotalW=.5*i.length*(this.itemRenderW+this.itemRenderGapH)-this.itemRenderGapH,Timer.start(1e3,1,this.moveCars,this)}},e.prototype.moveCars=function(){var t=this,e=200,i=this.eCarList.dataProvider.length*(this.itemRenderW+this.itemRenderGapH)*.5/e*1e3;this.eCarScroller.viewport.scrollH=this.listTotalW-2.5*(this.itemRenderW+this.itemRenderGapH),this.eCarList.visible=!0;var n=egret.Tween.get(this.eCarScroller.viewport,{loop:!0});n.to({scrollH:0},i).call(function(){t.eCarScroller.viewport.scrollH=t.listTotalW-2.5*(t.itemRenderW+t.itemRenderGapH)},this)},__decorate([callLater],e.prototype,"updateScore",null),__decorate([callLater],e.prototype,"updateCarList",null),e}(BaseView);__reflect(DartPlunderPanel.prototype,"DartPlunderPanel"),window.DartPlunderPanel=DartPlunderPanel;var DartRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KfyunbiaoRankItemSkin",e.eList.itemRenderer=ItemBaseNoName,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof RankDataDart){this.data.pos<4?(this.eRank.text="",this.eRankImg.source="paihang"+this.data.pos):(this.eRank.text=this.data.pos+"",this.eRankImg.source=""),this.eServer.text=this.data.serverName+"区",this.eName.text=this.data.name,this.score.text=this.data.score+"";for(var t in GlobalConfig.DartCarPersonalRankAward){var e=GlobalConfig.DartCarPersonalRankAward[t];this.data.pos>=e.range[0]&&this.data.pos<=e.range[1]&&(this.eList.dataProvider=new eui.ArrayCollection(e.award))}}},e}(BaseItemRender);__reflect(DartRankItem.prototype,"DartRankItem"),window.DartRankItem=DartRankItem;var DartRankPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=DartRankItem,this.eListItem.itemRenderer=ItemBaseNoName,this.ranks=[this.rank0,this.rank1,this.rank2],this.rank0.index=0,this.rank1.index=1,this.rank2.index=2},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Rank.ins().postRankingData,this.update),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),Rank.ins().sendGetRankingData(RankDataType.TYPE_DART),this.update()},e.prototype.update=function(t){if(void 0===t&&(t=null),!t||t.type==RankDataType.TYPE_DART){for(var e=t?t.getDataList():null,i=0;i<this.ranks.length;i++)this.ranks[i].data=null;e&&e[0]&&ReadPlayerCT.ins().sendFindPlayer(e[0].id,e[0].serverId),this.state.visible=null==e,this.eMyRank.text=t&&0!=t.selfPos?t.selfPos+"":"未上榜";var n=e&&e.length>0?e.shift():null;this.eName.text=n?n.name:"",this.sServer.text=n?n.serverName+"区":"",this.eScore.text=n?n.score+"":"",this.eListItem.dataProvider=new eui.ArrayCollection(n?GlobalConfig.DartCarPersonalRankAward[1].award:[]),this.eList.dataProvider=new eui.ArrayCollection(e)}},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.ranks.length;e++)this.ranks[e].data={otherPlayerData:t}},e}(BaseView);__reflect(DartRankPanel.prototype,"DartRankPanel"),window.DartRankPanel=DartRankPanel;var DartRecordItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="KFyunbiaoListSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(this.data.time)/1e3,DateUtils.TIME_FORMAT_2)+"\n";t+=this.data.str,this.info.textFlow=TextFlowMaker.generateTextFlow(t)}},e}(BaseItemRender);__reflect(DartRecordItem.prototype,"DartRecordItem"),window.DartRecordItem=DartRecordItem;var DartRecordWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfyunbiaoRecordSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection([]),this.eList.itemRenderer=DartRecordItem,this.eList.dataProvider=this.listDP,this.eTab.dataProvider=new eui.ArrayCollection(["公会记录","个人记录"]),this.eTab.selectedIndex=0,this.addChangeEvent(this.eTab,this.onTabTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(CrossDartCT.ins().postLogs,this.updateList),CrossDartCT.ins().sendLogs(0==this.eTab.selectedIndex?2:1),this.updateList()},e.prototype.removeDisplay=function(){Timer.stop(this.openTouch,this)},e.prototype.onTabTouch=function(t){CrossDartCT.ins().sendLogs(0==this.eTab.selectedIndex?2:1),this.eTab.touchChildren=!1,Timer.start(500,1,this.openTouch,this)},e.prototype.openTouch=function(){this.eTab.touchChildren=!0},e.prototype.updateList=function(){this.listDP.source=1==this.eTab.selectedIndex?CrossDartCT.ins().logs:CrossDartCT.ins().guildLogs},__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(DartRecordWin.prototype,"DartRecordWin"),window.DartRecordWin=DartRecordWin,ViewManager.ins().reg(DartRecordWin,LayerManager.UI_Main);var DartResultWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KfYunbiaoResultSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],r=t[5],l=t[6];switch(this.title.source=1==i?"lost_02":"win_02",this.bg.source=1==i?"lost_png":"win_png",this.closeBtn.name=1==i?"退出":"领取奖励",i){case 1:this.eTips.text="被"+s+"区"+n+"公会的"+l+"击败了";break;case 2:this.eTips.text="很遗憾，镖车已提前被"+s+"区"+n+"公会的"+l+"击破了";break;case 3:this.eTips.text="恭喜成功击破"+s+"区"+n+"公会的"+o+"级镖车";break;default:this.eTips.text=""}if(a>0){var h=new RewardData;h.type=0,h.id=MoneyConst.dartCarScore,h.count=a,r.unshift(h)}this.eList.dataProvider=new eui.ArrayCollection(r),this.repeatTimes=10,Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this)},e.prototype.updateCloseBtnLabel=function(){this.repeatTimes--,this.repeatTimes<=0&&(ViewManager.ins().close(this),FbCT.ins().sendExitFb()),this.closeBtn.label=this.closeBtn.name+"("+this.repeatTimes+"s)"},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:FbCT.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DartResultWin.prototype,"DartResultWin"),window.DartResultWin=DartResultWin,ViewManager.ins().reg(DartResultWin,LayerManager.UI_Popup);var BubbleFactory=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.playBubbleEffect=function(t){var e="",i=GlobalConfig.BubbleConfig[t];if(i)switch(i.type){case BubbleType.B1:e=i.news;break;case BubbleType.B2:i.news&&SkillCT.ins().postShowSkillWord(i.news)}return e},e}(BaseClass);__reflect(BubbleFactory.prototype,"BubbleFactory");var BubbleType;!function(t){t[t.B1=1]="B1",t[t.B2=2]="B2"}(BubbleType||(BubbleType={})),window.BubbleFactory=BubbleFactory;var DemonCir=function(t){function e(){var e=t.call(this)||this;return e.taskID=0,e.taskProgress=0,e.taskCD=0,e.firstRec=!0,e.encounterTimes=0,e.demonCirLevel={},e.curLayerId=1,e.layerData=[1,0,0],e.isAllPass=!1,e.isFrist=!0,e.sysId=PackageID.DemonCir,e.regNetMsg(1,e.postRoleDatas),e.regNetMsg(2,e.postTask),e.regNetMsg(4,e.postDemonLevelUp),e.regNetMsg(5,e.postSpecialUp),e.regNetMsg(7,e.postShowChange),e.regNetMsg(8,e.postTalentUp),e.regNetMsg(13,e.postFbInfo),e.regNetMsg(14,e.postDemonCirLevelCfg),e
}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRoleDatas=function(t){if(this.taskState!=e.STATE_COMPLETE){var i=Object.keys(GlobalConfig.DemonCirTask).length,n=GlobalConfig.DemonCirTask[i];this.taskID=n.taskIdx,this.taskState=e.STATE_COMPLETE}var s=t.readByte();this.roleDeData||(this.roleDeData=[]),this.roleDeData.length=s;for(var o=0;s>o;o++){var a=this.roleDeData[o];a?a.parser(t):(a=new DemonCirRoleData(t),this.roleDeData[o]=a)}},e.prototype.postTask=function(t){this.taskID=t.readByte(),this.taskProgress=t.readByte(),this.taskState=t.readByte(),this.taskCD=t.readInt(),1!=this.taskState||this.firstRec||this.checkReward(),this.firstRec=!1},e.prototype.sendTaskEvent=function(){this.sendBaseProto(3)},e.prototype.sendDemonLevelUp=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postDemonLevelUp=function(t){var i=e.ins().getRoleDataByID(t.readByte()),n=i.getDemonDataByID(t.readByte());n.level=t.readInt(),n.exp=t.readInt()},e.prototype.sendActiveDemon=function(t,e){var i=this.getBytes(5);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendSpecialUp=function(t,e){var i=this.getBytes(6);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postSpecialUp=function(t){var i=e.ins().getRoleDataByID(t.readByte()),n=t.readByte();t.position--;var s=i.getDemonDataByID(n);s?s.parser(t):(s=new DemonCirData(t),i.addDemonData(n,s))},e.prototype.sendShowChange=function(t,e){var i=this.getBytes(7);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postShowChange=function(t){var i=e.ins().getRoleDataByID(t.readByte());i.showID=t.readByte()},e.prototype.sendTalentUp=function(t,e){var i=this.getBytes(8);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postTalentUp=function(t){var i=e.ins().getRoleDataByID(t.readByte()),n=i.getDemonDataByID(t.readByte());n.talentLv=t.readByte()},e.prototype.getRoleDataByID=function(t){if(!this.roleDeData||!this.roleDeData.length)return null;for(var e=this.roleDeData.length,i=0;e>i;i++){var n=this.roleDeData[i];if(n.roleID==t)return n}return null},e.prototype.checkOpen=function(){return ZsCT.ins().lv<GlobalConfig.DemonCirConf.openzhuanshenglv?!1:GameServer.serverOpenDay<GlobalConfig.DemonCirConf.openserverday-1?!1:!0},e.prototype.checkActived=function(){var t=Object.keys(GlobalConfig.DemonCirTask).length,i=GlobalConfig.DemonCirTask[t];return this.taskID<i.taskIdx?!1:this.taskState==e.STATE_COMPLETE?!0:!1},e.prototype.getCDTime=function(){return Math.floor((DateUtils.formatMiniDateTime(this.taskCD)-GameServer.serverTime)/1e3)},e.prototype.sendEnterFb=function(){var t=this.getBytes(13);this.sendToServer(t)},e.prototype.postFbInfo=function(t){this.isAllPass=!1,this.curLayerId=t.readInt(),this.layerData=[];var e=CommonUtils.arraySort(CommonUtils.objectToArrayShallow(GlobalConfig.DemonCirFbConf),"id");if(this.curLayerId>e[e.length-1].id&&(this.isAllPass=!0,this.curLayerId=e[e.length-1].id),this.isAllPass)for(var i=0;i<e.length;i++)this.layerData.push(2);else for(var i=0;i<e.length;i++)e[i].id==this.curLayerId?this.layerData.push(1):this.curLayerId>e[i].id?this.layerData.push(2):this.layerData.push(0)},e.prototype.sendDemonCirLevel=function(t,e){var i=this.getBytes(14);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postDemonCirLevelCfg=function(t){var e=new DemonCirLevel;e.id=t.readInt(),e.level=t.readInt(),e.exp=t.readInt(),e.count=t.readInt(),e.expower=t.readInt(),t.readInt(),e.attrs=[];for(var i=t.readInt(),n=0;i>n;n++)e.attrs[n]={type:t.readInt(),value:t.readInt()};null==this.demonCirLevel[e.id]&&(this.demonCirLevel[e.id]={}),this.demonCirLevel[e.id][e.level]=e},e.prototype.isLastLayer=function(){return this.isAllPass},e.prototype.checkFb=function(){if(!this.getCanSee()||ZsCT.ins().lv<GlobalConfig.DemonCirConf.openzhuanshenglv)return!1;if(this.isAllPass)return!1;var t=GlobalConfig.DemonCirFbConf[this.curLayerId];if(!t)return!1;var e=t.itemCount,i=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId);return this.isFrist||i>=e?!0:!1},e.prototype.getCanSee=function(){return GameServer.serverOpenDay+1>=GlobalConfig.DemonCirConf.openserverday},e.prototype.checkLastTask=function(){this.taskState!=e.STATE_TASK||this.taskID<Object.keys(GlobalConfig.DemonCirTask).length||(this.encounterTimes++,this.encounterTimes>=GlobalConfig.DemonCirConf.taskCount?ViewManager.ins().open(DCTaskTriggerWin):Math.random()<GlobalConfig.DemonCirConf.taskRate/1e4&&ViewManager.ins().open(DCTaskTriggerWin))},e.prototype.getAddPerBySysIDRoleId=function(t,i){var n=0,s=e.ins().getRoleDataByID(i);if(!s)return n;for(var o=s.demonCirDatas?s.demonCirDatas.length:0,a=0;o>a;a++){var r=s.demonCirDatas[a];if(r&&r.talentLv>0){var l=GlobalConfig.DemonCirTalent[GlobalConfig.DemonCirBase[r.id].talent][r.talentLv];l.sysAttr&&l.sysAttr.type==t&&(n+=l.sysAttr.value)}}return n},e.prototype.getAddPerBySysID=function(t){for(var i=0,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=e.ins().getRoleDataByID(s);if(o)for(var a=o.demonCirDatas?o.demonCirDatas.length:0,r=0;a>r;r++){var l=o.demonCirDatas[s];if(l&&l.talentLv>0){var h=GlobalConfig.DemonCirTalent[GlobalConfig.DemonCirBase[l.id].talent][l.talentLv];h.sysAttr.type==t&&(i+=h.sysAttr.value)}}}return i},e.prototype.getAttrsBySysID=function(t,i){var n=e.ins().getAddPerBySysID(i);if(!n)return t;for(var s,o=[],a=t.length,r=0;a>r;r++)s=t[r],o.push(new AttributeData(s.type,Math.floor(s.value*n/1e4)));return o=o.concat(t),AttributeData.combineAtts(o)},e.prototype.checkReward=function(){ViewManager.ins().open(DCTaskRewardWin,{itemID:GlobalConfig.DemonCirTask[e.ins().taskID].itemId,des:"恭喜获得"})},e.prototype.checkXiLianRed=function(t,i){var n=e.ins().getRoleDataByID(t);if(!n)return!1;var s=n.getDemonDataByID(i);if(!s)return!1;var o=GlobalConfig.DemonCirBase[i];if(s.specialVals&&s.specialVals.length){for(var a=s.specialVals.length,r=!0,l=0;a>l;l++){var h=s.specialVals[l];if(!h||!h.length){r=!1;break}for(var u=h.length,p=!0,c=0;u>c;c++)if(h[c].value<GlobalConfig.DemonCirSkill[o.skillgroup[l]][c+1].attrMax){p=!1;break}if(!p){r=!1;break}}if(!r){var d=BagCT.ins().getBagItemById(o.skillcost.id);if(d&&Math.floor(d.count/o.skillcost.count)>=GlobalConfig.DemonCirConf.skillCautionCount)return!0}}return!1},e.prototype.checkCirMainRed=function(t,i){var n=e.ins().getRoleDataByID(t);if(!n)return!1;var s=GlobalConfig.DemonCirBase[i],o=n.getDemonDataByID(s.id);if(o){if(o.level<GlobalConfig.DemonCirBase[s.id].maxLevel){var a=BagCT.ins().getBagItemById(GlobalConfig.DemonCirConf.expItemId),r=a?a.count:0,l=this.getDemonCirLevelCfg(s.id,o.level);if(l&&GlobalConfig.DemonCirConf.expPerItem*r>=l.exp-o.exp)return!0}if(o.talentLv>0&&o.talentLv<Object.keys(GlobalConfig.DemonCirTalent[s.talent]).length){var h=GlobalConfig.DemonCirTalent[s.talent][o.talentLv+1],a=BagCT.ins().getBagItemById(s.mat);if(a&&a.count>=h.costCount)return!0}}else{var a=BagCT.ins().getBagItemById(s.mat);if(a&&a.count>=s.matCost)return!0}return!1},e.prototype.getDemonCirLevelCfg=function(t,e){var i=null;return this.demonCirLevel[t]&&(i=this.demonCirLevel[t][e]),i?i:(this.sendDemonCirLevel(t,e),null)},e.prototype.getUpgradeDesc=function(t,e){var i=GlobalConfig.DemonCirTalent[t][e];if(!i)return"";var n=";";switch(t){case 1:n="注魂";break;case 2:n="强化";break;case 3:n="淬炼";break;case 4:n="魂印";break;case 5:n="金币";break;case 6:n="经验";break;default:return""}return 4>=t?"                 |C:0xff00ff&T:"+n+"系统|的属性百分比提升|C:0x00ff00&T:"+i.sysAttr.value/100+"%| 法阵蕴养的等级上限突破至|C:0xffd93f&T:"+i.maxLevel+"级|":6>=t?"                 |C:0xff00ff&T:野外挂机"+n+"|收益百分比提升|C:0x00ff00&T:"+2*i.level+"%| 法阵蕴养的等级上限突破至|C:0xffd93f&T:"+i.maxLevel+"级|":""},e.STATE_TASK=0,e.STATE_CAN_GET=1,e.STATE_GOT=2,e.STATE_COMPLETE=3,__decorate([post()],e.prototype,"postRoleDatas",null),__decorate([post()],e.prototype,"postTask",null),__decorate([post()],e.prototype,"postDemonLevelUp",null),__decorate([post()],e.prototype,"postSpecialUp",null),__decorate([post()],e.prototype,"postShowChange",null),__decorate([post()],e.prototype,"postTalentUp",null),__decorate([post()],e.prototype,"postFbInfo",null),__decorate([post()],e.prototype,"postDemonCirLevelCfg",null),e}(BaseSystem);__reflect(DemonCir.prototype,"DemonCir"),System.DemonCir=function(){return DemonCir.ins()},window.DemonCir=DemonCir;var DemonCirRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.roleTabs=[],e.taskPoint=!1,e.roleYunyang=[],e.yunyangPoints=[],e.zhenYanPoints=[],e.roleQianneng=[],e.qiannengPoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint,e.postTaskPoint),e.associated(e.postTaskPoint,DemonCir.ins().postTask,ZsCT.ins().postZsData),e.associated(e.postRoleRedPoint,DemonCir.ins().postRoleDatas,DemonCir.ins().postSpecialUp,DemonCir.ins().postDemonLevelUp,DemonCir.ins().postDemonCirLevelCfg,BagCT.ins().postItemAdd,BagCT.ins().postItemChange,BagCT.ins().postItemDel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=this.taskPoint;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postTaskPoint=function(){this.taskPoint=DemonCir.ins().checkOpen()&&(0==DemonCir.ins().taskID||1==DemonCir.ins().taskState)},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.yunyangPoint(t),n=this.qiannengPoint(t);this.roleYunyang[t]=i,this.roleQianneng[t]=n,this.roleTabs[t]=i||n}else this.roleTabs[t]=!1}return!0},e.prototype.qiannengPoint=function(t){this.qiannengPoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=DemonCir.ins().getRoleDataByID(t);if(!n)return!1;var s,o;for(var a in GlobalConfig.DemonCirBase){this.qiannengPoints[t][a]=!1;var r=GlobalConfig.DemonCirBase[a],l=n.getDemonDataByID(r.id),h=null!=l;if(h){for(var u=0,p=0;5>p;p++){var c=l.getActiveByIndex(p),d=GlobalConfig.DemonCirSkill[r.skillgroup[p]];c&&(s=l.specialVals[p]);for(var g=Object.keys(d).length,f=s?s.length:0,v=!0,y=0;g>y;y++){o=f>y?s[y]:null;var m=d[y+1];(!o||o.value<m.attrMax)&&(v=!1)}v&&u++}var T=u>=5;if(!T){var C=BagCT.ins().getBagItemById(r.skillcost.id),b=C?C.count:0;b>=r.skillcost.count&&(this.qiannengPoints[t][a]=!0,e=!0)}}}return e},e.prototype.yunyangPoint=function(t){this.yunyangPoints[t]=[],this.zhenYanPoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=DemonCir.ins().getRoleDataByID(t);if(!n)return!1;var s=BagCT.ins().getBagItemById(GlobalConfig.DemonCirConf.expItemId),o=s?s.count:0;for(var a in GlobalConfig.DemonCirBase){var r=GlobalConfig.DemonCirBase[a],l=n.getDemonDataByID(r.id),h=null!=l;if(this.yunyangPoints[t][a]=!1,h)if(l.level>=GlobalConfig.DemonCirBase[r.id].maxLevel);else{var u=DemonCir.ins().getDemonCirLevelCfg(r.id,l.level);u&&o>=u.count&&(this.yunyangPoints[t][a]=!0,e=!0)}else{var p=BagCT.ins().getBagItemById(r.mat),c=p?p.count:0;c>=r.matCost&&(this.yunyangPoints[t][a]=!0,e=!0)}if(h&&l.talentLv>0&&l.talentLv<Object.keys(GlobalConfig.DemonCirTalent[r.talent]).length){var d=GlobalConfig.DemonCirTalent[r.talent][l.talentLv+1],p=BagCT.ins().getBagItemById(r.mat);p&&p.count>=d.costCount&&(this.zhenYanPoints[t][a]=!0,e=!0)}else this.zhenYanPoints[t][a]=!1}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postTaskPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),e}(BaseSystem);__reflect(DemonCirRedPoint.prototype,"DemonCirRedPoint"),System.DemonCirRedPoint=function(){return DemonCirRedPoint.ins()},window.DemonCirRedPoint=DemonCirRedPoint;var DCBtnItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.dcNameTxt.textFlow=TextFlowMaker.generateTextFlow(this.data.cfg.dcName),this.dcImg.source=null,this.dcImg.source=this.data.cfg.nameImg,this.redPoint.visible=1==this.data.state,this.actTxt.visible=1==this.data.state,this.cantActTxt.visible=0==this.data.state},Object.defineProperty(e.prototype,"selected",{set:function(t){this.xuanzhong.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(DCBtnItemRender.prototype,"DCBtnItemRender"),window.DCBtnItemRender=DCBtnItemRender;var DCPotentialItemCell=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.update()},e.prototype.setData=function(t){this.data=t,this.inited&&this.update()},e.prototype.update=function(){this.data&&(this.redPoint.visible=!1,this.potentialImg.source=null,this.potentialImg.source=GlobalConfig.DemonCirSkill[this.data.id][1].skillIcon,this.potentialImg.filters=this.data.actived?null:FilterUtil.ARRAY_GRAY_FILTER,this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this))},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.data=null},e.prototype.onTouch=function(t){this.data&&ViewManager.ins().open(DCSkillTipsWin,this.data)},e}(eui.Component);__reflect(DCPotentialItemCell.prototype,"DCPotentialItemCell"),window.DCPotentialItemCell=DCPotentialItemCell;var DCSkillItemCell=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inited=!0,this.update()},e.prototype.setData=function(t){this.data=t,this.inited&&this.update()},e.prototype.update=function(){if(this.data){if(this.dcImg.source=null,this.data.type==e.TYPE_TALENT)this.dcImg.source=GlobalConfig.DemonCirBase[this.data.id].talentImg;else if(this.data.type==e.TYPE_TEZHI){var t=GlobalConfig.DemonCirTeZhi[this.data.id][this.data.actived?this.data.param:1];this.dcImg.source=t.icon}this.dcImg.filters=this.data.actived?null:FilterUtil.ARRAY_GRAY_FILTER,this.redPoint.visible=!1,this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.updateRed()}},e.prototype.updateRed=function(){this.data.type==e.TYPE_TALENT&&(this.redPoint.visible=DemonCirRedPoint.ins().zhenYanPoints[this.data.roleId][this.data.id])},e.prototype.onRmove=function(t){this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRmove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.data=null},e.prototype.onTouch=function(t){this.data&&(this.data.type==e.TYPE_TALENT?ViewManager.ins().open(DCAbilityTipsWin,this.data.roleId,this.data.id,this.data.actived):this.data.type==e.TYPE_TEZHI&&ViewManager.ins().open(DCTeZhiTipsWin,{id:this.data.id,level:this.data.param,actived:this.data.actived,demonID:this.demonID,demonLvl:this.demonLvl}))},e.TYPE_TALENT=0,e.TYPE_TEZHI=1,e}(eui.Component);__reflect(DCSkillItemCell.prototype,"DCSkillItemCell"),window.DCSkillItemCell=DCSkillItemCell;var demonCirListItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.lvCount.text=this.data.actived?"Lv."+this.data.level:"",this.nameImg.source=null,this.nameImg.source=this.data.cfg.nameImg,this.redPoint.visible=this.data.showRed,this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.demonCirEff.addChild(this.deEff),this.deEff.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||this.deEff.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.deEff.playFile(""+RES_DIR_EFF+this.data.cfg.winEff,-1),this.deEff.filters=this.data.actived?null:FilterUtil.ARRAY_GRAY_FILTER},e.prototype.onRemove=function(t){this.deEff&&(this.deEff.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),DisplayUtils.removeFromParent(this.deEff),this.deEff=null)},e.prototype.onTouch=function(t){},e}(BaseItemRender);__reflect(demonCirListItemRender.prototype,"demonCirListItemRender"),window.demonCirListItemRender=demonCirListItemRender;var DCAbilityTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCAbilityTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(BagCT.ins().postItemAdd,this.updateMaterail),this.observe(BagCT.ins().postItemChange,this.updateMaterail),this.observe(BagCT.ins().postItemDel,this.updateMaterail),this.observe(DemonCir.ins().postTalentUp,this.update),this.roleId=t[0],this.id=t[1],this.isActived=t[2],this.update()},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.updateBtn:if(!this.isEnough)return void TipsCT.ins().showTips("材料不足");DemonCir.ins().sendTalentUp(this.roleId,this.id);break;case this.getItemTxt:ViewManager.ins().open(ShopGoodsWarn).setData(GlobalConfig.DemonCirBase[this.id].mat)}},e.prototype.update=function(){var t=GlobalConfig.DemonCirBase[this.id];this.nametxt.textFlow=TextFlowMaker.generateTextFlow(t.talentName);var e=0;if(this.isActived){var i=DemonCir.ins().getRoleDataByID(this.roleId),n=i.getDemonDataByID(this.id);e=n.talentLv,this.costImg.source=null,this.costImg.source=GlobalConfig.ItemConfig[t.mat].icon+"_png"}this.nowDesctxt.textFlow=TextFlowMaker.generateTextFlow(e?DemonCir.ins().getUpgradeDesc(t.talent,e):"未激活"),this.nextTitle.visible=!0,this.nextDesctxt.visible=!0,this.updateBtn.visible=this.isActived,this.redpoint.visible=!1,this.cost.visible=this.isActived,this.lvtxt.textFlow=TextFlowMaker.generateTextFlow("Lv."+e),this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.demonCirEff.addChild(this.deEff),this.deEff.playFile(""+RES_DIR_EFF+t.winEff,-1),this.isMax=e>=Object.keys(GlobalConfig.DemonCirTalent[t.talent]).length,this.isMax?(this.nextTitle.visible=!1,this.nextDesctxt.visible=!1,this.updateBtn.visible=!1,this.cost.visible=!1):this.nextDesctxt.textFlow=TextFlowMaker.generateTextFlow(DemonCir.ins().getUpgradeDesc(t.talent,e+1)),this.updateMaterail(),this.abilityImg.source=t.talentImg},e.prototype.updateMaterail=function(){if(this.isActived&&!this.isMax){var t=GlobalConfig.DemonCirBase[this.id],e=DemonCir.ins().getRoleDataByID(this.roleId),i=e.getDemonDataByID(this.id),n=GlobalConfig.DemonCirTalent[t.talent][i.talentLv+1];if(n){var s=BagCT.ins().getBagItemById(t.mat),o=s?s.count:0;this.isEnough=o>=n.costCount,this.costNum.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this.isEnough?13746831:16711680)+"&T:"+o+"|/"+n.costCount),this.redpoint.visible=!this.isMax&&this.isEnough,this.updateBtn.enabled=this.isEnough}}},e}(BaseEuiView);__reflect(DCAbilityTipsWin.prototype,"DCAbilityTipsWin"),ViewManager.ins().reg(DCAbilityTipsWin,LayerManager.UI_Popup),window.DCAbilityTipsWin=DCAbilityTipsWin;var DcPotentialPanel=function(t){function e(){var e=t.call(this)||this;return e.isAddDis=!1,e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(DemonCir.ins().postRoleDatas,this.update),this.observe(DemonCir.ins().postSpecialUp,this.update),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(BagCT.ins().postItemDel,this.updateMaterial),this.addTouchEvent(this,this.onTouch),this.update(),this.isAddDis=!0},e.prototype.setData=function(t){this.data=t,this.isAddDis&&this.update()},e.prototype.updateRedPoint=function(){this.redPoint.visible=DemonCirRedPoint.ins().qiannengPoints[this.data.roleIndex][this.data.cfg.id]},e.prototype.update=function(){this.updateRedPoint();var t=DemonCir.ins().getRoleDataByID(this.data.roleIndex),e=t.getDemonDataByID(this.data.cfg.id);if(this.actived=null!=e,this.dcNameImg){this.dcNameImg.source=null,this.dcNameImg.source=this.data.cfg.mainNameImg,this.deEff||(this.deEff=ObjectPool.pop("MovieClip"),this.deEff.touchEnabled=!1),this.deEff.parent||this.demonCirEff.addChild(this.deEff);var i=this.data.cfg;this.deEff.playFile(""+RES_DIR_EFF+i.winEff,-1),this.demonCirEff.filters=this.actived?null:FilterUtil.ARRAY_GRAY_FILTER,this.deEffLeft||(this.deEffLeft=ObjectPool.pop("MovieClip")),this.deEffLeft.parent||this.effLeft.addChild(this.deEffLeft);var n,s=Object.keys(GlobalConfig.DemonCirBase).length;n=i.talent<=1?GlobalConfig.DemonCirBase[s]:GlobalConfig.DemonCirBase[i.talent-1],this.deEffLeft.playFile(""+RES_DIR_EFF+n.winEff,-1),this.effLeft.filters=t.getDemonDataByID(n.id)?null:FilterUtil.ARRAY_GRAY_FILTER,this.deEffRight||(this.deEffRight=ObjectPool.pop("MovieClip")),this.deEffRight.parent||this.effRight.addChild(this.deEffRight),n=i.talent>=s?GlobalConfig.DemonCirBase[1]:GlobalConfig.DemonCirBase[i.talent+1],this.deEffRight.playFile(""+RES_DIR_EFF+n.winEff,-1),this.effRight.filters=t.getDemonDataByID(n.id)?null:FilterUtil.ARRAY_GRAY_FILTER;for(var o,a,r,l=i.skillgroup.length,h=[],u="",p=0,c=[],d=0,g=0,f=0;5>f;f++){if(o=this["potential"+f],a=null,r=!1,l>f){if(o.visible=!0,r=this.actived){var v=DemonCir.ins().getRoleDataByID(this.data.roleIndex),y=v.getDemonDataByID(i.id);r=y.getActiveByIndex(f),r&&(a=y.specialVals[f],d++)}o.setData({id:i.skillgroup[f],actived:r,param:a})}else o.visible=!1;for(var m=GlobalConfig.DemonCirSkill[i.skillgroup[f]],T=void 0,C=Object.keys(m).length,b=a?a.length:0,I=!0,w=0;C>w;w++){T=b>w?a[w]:null;var S=m[w+1];p+=S.expower?S.expower:0,2==S.skillType?u+="|C:"+(r?this.getColorByValue(T.value,S.attrMax):12434877)+"&T:法阵全属性提升:"+(r?(T.value/S.attrMax*100).toFixed(1)+"%":"尚未领悟")+"|\n":(h.push(new AttributeData(S.attrType,T?T.value:0)),u+="|C:"+(r?13746831:12434877)+"&T:"+AttributeData.getAttrStrByType(S.attrType)+":"+(r?T.value:"尚未领悟")+"|\n"),(!T||T.value<S.attrMax)&&(I=!1)}I&&g++,c.push(r)}if(p+=BagCT.getAttrPower(h,SubRoles.ins().getSubRoleByIndex(this.data.roleIndex)),this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(u),this.powerPanel.setPower(p),this.isMax=g>=5,this.upGradeBtn.visible=!this.isMax,this.maxDesc.visible=this.isMax,this.costGroup.visible=!this.isMax,this.getItemTxt.visible=!this.isMax,this.isMax)this.potentialTitle.visible=this.resultAttr.visible=this.arrow.visible=!1,this.curImg.horizontalCenter=0,this.nowAttr.left=200;else{this.potentialTitle.visible=this.resultAttr.visible=this.arrow.visible=!0,this.curImg.horizontalCenter=-140,this.nowAttr.left=0;var _=c.length,B=d-g-1,D=void 0;u="";for(var f=0;_>f;f++){var m=GlobalConfig.DemonCirSkill[i.skillgroup[f]],C=Object.keys(m).length;r=c[f];for(var w=0;C>w;w++){var S=m[w+1];D=S.attrAdd[B],u+=2==S.skillType?"|C:"+(r?13746831:12434877)+"&T:法阵全属性提升:|C:2925607&T:"+(r?(D[0]/100).toFixed(1)+"% ~ "+(D[1]/100).toFixed(1)+"%":(S.attrMin/100).toFixed(1)+"%")+"||\n":"|C:"+(r?13746831:12434877)+"&T:"+AttributeData.getAttrStrByType(S.attrType)+":|C:2925607&T:"+(r?D[0]+" ~ "+D[1]:S.attrMin)+"||\n"}}this.resultAttr.textFlow=TextFlowMaker.generateTextFlow1(u),this.icon.source=null,this.icon.source=GlobalConfig.ItemConfig[this.data.cfg.skillcost.id].icon+"_png"}this.updateMaterial()}},e.prototype.getColorByValue=function(t,e){var i=+(t/e*100).toFixed(1);return 19>=i?10458221:i>=20&&39>=i?4251448:i>=40&&59>=i?10562239:12410893},e.prototype.updateMaterial=function(){if(this.clearMixEff(),!this.isMax){var t=BagCT.ins().getBagItemById(this.data.cfg.skillcost.id),e=t?t.count:0;this.isEnough=e>=this.data.cfg.skillcost.count,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this.isEnough?65280:16711680)+"&T:"+e+"|/"+this.data.cfg.skillcost.count),t&&Math.floor(t.count/this.data.cfg.skillcost.count)>=GlobalConfig.DemonCirConf.skillCautionCount&&(this.mixEff||(this.mixEff=ObjectPool.pop("MovieClip"),this.mixEff.touchEnabled=!1,this.effGroup.addChild(this.mixEff),this.mixEff.scaleX=1,this.mixEff.scaleY=1,this.mixEff.x=0,this.mixEff.y=-22),this.mixEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1))}},e.prototype.clearMixEff=function(){this.mixEff&&(DisplayUtils.removeFromParent(this.mixEff),this.mixEff=null)},e.prototype.onTouch=function(t){if(t.target==this.upGradeBtn){if(!this.actived)return void TipsCT.ins().showTips("法阵尚未激活");if(!this.isEnough)return void TipsCT.ins().showTips("材料不足");DemonCir.ins().sendSpecialUp(this.data.roleIndex,this.data.cfg.id)}else if(t.target==this.getItemTxt){this.actived?GlobalConfig.DemonCirConf.expItemId:this.data.cfg.mat;ViewManager.ins().open(ShopGoodsWarn).setData(this.data.cfg.skillcost.id)}},e}(BaseEuiView);__reflect(DcPotentialPanel.prototype,"DcPotentialPanel"),window.DcPotentialPanel=DcPotentialPanel;var DCSActivatedTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCSActivatedTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.id=t[0],this.skillID=t[1],this.skillDatas=t[2],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){var t=GlobalConfig.DemonCirBase[this.id];this.demonCirName.textFlow=TextFlowMaker.generateTextFlow("您在洗练 "+t.dcName+" 时");var e=GlobalConfig.DemonCirSkill[this.skillID],i=e[1];this.skillImg.source=null,this.skillImg.source=i.skillIcon,this.skillName.textFlow=TextFlowMaker.generateTextFlow(i.skillName);for(var n,s,o=[],a=this.skillDatas.length,r=0;a>r;r++)s=this.skillDatas[r],2==s.param?(i=e[r+1],n=(s.value/i.attrMax*100).toFixed(1)):o.push(new AttributeData(s.type,s.value));var l=AttributeData.getAttStr(o,0,1,"：");l+="法阵全属性提升  "+n+"%",this.skillTxt.textFlow=TextFlowMaker.generateTextFlow1(l)},e.prototype.onTouch=function(t){switch(t.target){case this.touchClose:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DCSActivatedTipsWin.prototype,"DCSActivatedTipsWin"),ViewManager.ins().reg(DCSActivatedTipsWin,LayerManager.UI_Popup),window.DCSActivatedTipsWin=DCSActivatedTipsWin;var DCSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCSkillTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){var t=GlobalConfig.DemonCirSkill[this.data.id],e=t[1];this.potentialName0.textFlow=TextFlowMaker.generateTextFlow(e.skillName),this.potentialName1.text=e.skillName+" (Max)",this.infoTxt.visible=!this.data.actived;for(var i,n,s,o=this.data.param,a=Object.keys(t).length,r=o?o.length:0,l="",h="",u=0;a>u;u++)s=r>u?o[u]:null,e=t[u+1],2==e.skillType?(i=((s?s.value:e.attrMin)/e.attrMax*100).toFixed(1)+"%",n=(e.attrMax/100).toFixed(1)+"%",l+=e.skillDesc+i+"\n",h+=e.skillDesc+n+"\n"):(l+=e.skillDesc+(s?s.value:100)+"\n",h+=e.skillDesc+e.attrMax+"\n");this.Desc0.textFlow=TextFlowMaker.generateTextFlow1(l),this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow1(h)},e.prototype.onTouch=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(DCSkillTipsWin.prototype,"DCSkillTipsWin"),ViewManager.ins().reg(DCSkillTipsWin,LayerManager.UI_Popup),window.DCSkillTipsWin=DCSkillTipsWin;var DCTaskItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCTaskItem",e}return __extends(e,t),e.prototype.setTaskId=function(t){this.skin&&(this.taskId=t,this.itemIcon.source=GlobalConfig.DemonCirTask[t].itemId+"_png",this.updateTask())},e.prototype.updateTask=function(){if(this.skin){var t=DemonCir.ins().taskID;this.taskId<t?this.doneImg.visible=!0:this.taskId==t?this.doneImg.visible=DemonCir.ins().taskState>=DemonCir.STATE_GOT&&DemonCir.ins().getCDTime()<=0:this.doneImg.visible=!1,this.curTask.visible=this.taskId==t,this.taskBg.visible=!this.curTask.visible}},e}(BaseView);__reflect(DCTaskItemIcon.prototype,"DCTaskItemIcon"),window.DCTaskItemIcon=DCTaskItemIcon;var DCTaskPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=0,e._sn_="DCTaskSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(DemonCir.ins().postTask,this.updateTask),this.observe(DemonCirRedPoint.ins().postTaskPoint,this.updateRed),this.addTouchEvent(this,this.onTouch),this.updateTask(),this.step1.setTaskId(1),this.step2.setTaskId(2),this.step3.setTaskId(3)},e.prototype.removeDisplay=function(){Timer.stopAll(this),this.clearEff()},e.prototype.updateRed=function(){this.redPoint.visible=DemonCirRedPoint.ins().taskPoint},e.prototype.clearEff=function(){this.deEff&&(DisplayUtils.removeFromParent(this.deEff),this.deEff=null)},e.prototype.updateTask=function(){Timer.stopAll(this),this.clearEff();var t,i,n,s,o,a=DemonCir.ins().taskID,r=GlobalConfig.DemonCirTask[0==a?1:a],l=GlobalConfig.ItemConfig[r.itemId].name;if(0==a)t=r.npcDialog1,i=r.taskRequire1,n=r.taskInfo1,s="",o="一探究竟",this.state=e.PHASE1;else{var h=DemonCir.ins().taskState;if(h==DemonCir.STATE_TASK)t=r.npcDialog2,i=r.taskRequire2,n=r.taskInfo2,s="需要"+l+"（|C:16711680&T:"+DemonCir.ins().taskProgress+"|/"+r.target+"）",o="前往挑战",this.state=e.PHASE2;else if(h==DemonCir.STATE_CAN_GET||h==DemonCir.STATE_GOT)if(t=r.npcDialog3,i=r.taskRequire3,n=r.taskInfo3,this.state=e.PHASE3,DemonCir.ins().taskCD<=0)s="需要"+l+"（"+DemonCir.ins().taskProgress+"/"+r.target+"）",o="领取";else{s="";var u=DemonCir.ins().getCDTime();u>0?(o=DateUtils.getFormatBySecond(u,DateUtils.TIME_FORMAT_1,5),Timer.start(1e3,0,this.onRepeat,this),this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.taskEff.addChild(this.deEff),this.taskEff.visible=!0,this.deEff.playFile(RES_DIR_EFF+"demonCirTask",-1)):o="领取"}else t=r.npcDialog4,i=r.taskRequire4,n=r.taskInfo4,s="",o="等待",this.state=e.PHASE4}this.npcDialog.textFlow=TextFlowMaker.generateTextFlow(t),this.taskRequire.textFlow=TextFlowMaker.generateTextFlow(i),this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(n),this.taskschedule.textFlow=TextFlowMaker.generateTextFlow(s),this.goBtn.label=o,this.updateRed(),this.step1.updateTask(),this.step2.updateTask(),this.step3.updateTask()},e.prototype.onRepeat=function(){var t=DemonCir.ins().getCDTime();t>0?this.goBtn.label=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1,5):this.updateTask()},e.prototype.onTouch=function(t){if(t.target==this.goBtn)if(this.state==e.PHASE1)DemonCir.ins().sendTaskEvent();else if(this.state==e.PHASE2){var i=GlobalConfig.DemonCirTask[DemonCir.ins().taskID],n=i.controlTarget[2];n?ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1],n):ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1]),ViewManager.ins().close(ForgeWin)}else this.state==e.PHASE3&&(DemonCir.ins().taskCD<=0||DemonCir.ins().getCDTime()<=0)&&DemonCir.ins().sendTaskEvent()},e.PHASE1=0,e.PHASE2=1,e.PHASE3=2,e.PHASE4=3,e}(BaseEuiView);__reflect(DCTaskPanel.prototype,"DCTaskPanel"),ViewManager.ins().reg(DCTaskPanel,LayerManager.UI_Main),window.DCTaskPanel=DCTaskPanel;var DCTaskRewardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.data=t[0],this.update()},e.prototype.close=function(){egret.Tween.removeTweens(this)},e.prototype.update=function(){egret.Tween.removeTweens(this),this.desc.textFlow=TextFlowMaker.generateTextFlow(this.data.des),this.item.data=this.data.itemID,this.item.hideName(),this.skillName.text=GlobalConfig.ItemConfig[this.data.itemID].name,this.x=50,this.y=750,this.alpha=1;var t=egret.Tween.get(this);t.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){ViewManager.ins().close(e)})},e}(BaseEuiView);__reflect(DCTaskRewardWin.prototype,"DCTaskRewardWin"),window.DCTaskRewardWin=DCTaskRewardWin,ViewManager.ins().reg(DCTaskRewardWin,LayerManager.UI_Main);var DCTaskTriggerWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCTask3Btn",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.eff_dragon.touchEnabled=!1,this.eff_dragon.touchChildren=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.eff_dragon.addChild(this.deEff),this.deEff.playFile(RES_DIR_EFF+"demonCirTask3",-1)},e.prototype.onTouch=function(t){t.target==this.hideBossBtn&&(DemonCir.ins().sendTaskEvent(),ViewManager.ins().close(this))},e}(BaseEuiView);__reflect(DCTaskTriggerWin.prototype,"DCTaskTriggerWin"),ViewManager.ins().reg(DCTaskTriggerWin,LayerManager.UI_Main),window.DCTaskTriggerWin=DCTaskTriggerWin;var DCTeZhiTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DCTeZhiTips",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.addTouchEvent(this,this.onTouch),this.observe(DemonCir.ins().postDemonCirLevelCfg,this.update),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){this.currentState=this.data.actived?"activated":"lock";var t=this.data.actived&&this.data.level>=Object.keys(GlobalConfig.DemonCirTeZhi[this.data.id]).length;if(this.nextGroup.visible=this.data.actived&&!t,!t){var e=GlobalConfig.DemonCirTeZhi[this.data.id][this.data.level+1];this.skillName0.textFlow=TextFlowMaker.generateTextFlow(e.name),this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow(e.desc.replace("%s",this.getAddValue(e)+"")),this.condition0.textFlow=TextFlowMaker.generateTextFlow(e.dcMinLv+"")}var i=GlobalConfig.DemonCirTeZhi[this.data.id][this.data.actived?this.data.level:1];this.skillName2.textFlow=TextFlowMaker.generateTextFlow(i.name),this.skillDesc2.textFlow=TextFlowMaker.generateTextFlow(i.desc.replace("%s",this.data.actived?this.getAddValue(i)+"":"")),this.condition2.textFlow=TextFlowMaker.generateTextFlow(t?"已满级":this.data.actived?"":"|C:16777164&T:法阵等级达到|"+i.dcMinLv+"级|C:16777164&T:解锁|")},e.prototype.getAddValue=function(t){var e=DemonCir.ins().getDemonCirLevelCfg(this.data.demonID,this.data.demonLvl);if(!e)return 0;for(var i=e.attrs,n=i.length,s=0;n>s;s++){var o=i[s];if(t.attrs.type==o.type)return Math.floor(t.attrs.per*o.value/1e4)}return 0},e.prototype.onTouch=function(t){t.target==this.bgClose&&ViewManager.ins().close(this)},__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(DCTeZhiTipsWin.prototype,"DCTeZhiTipsWin"),ViewManager.ins().reg(DCTeZhiTipsWin,LayerManager.UI_Popup),window.DCTeZhiTipsWin=DCTeZhiTipsWin;var DemonCirListPanel=function(t){function e(){var e=t.call(this)||this;return e.state=0,e}return __extends(e,t),e.prototype.addDisplay=function(){this.list.itemRenderer=demonCirListItemRender,this.observe(DemonCir.ins().postRoleDatas,this.updateCurState),this.observe(DemonCir.ins().postSpecialUp,this.updateList),this.observe(DemonCir.ins().postDemonLevelUp,this.updateList),this.observe(DemonCir.ins().postDemonCirLevelCfg,this.updateList),this.observe(BagCT.ins().postItemAdd,this.updateList),this.observe(BagCT.ins().postItemChange,this.updateList),this.observe(BagCT.ins().postItemDel,this.updateList),this.observe(DemonCir.ins().postTask,this.updateTask),this.addTouchEvent(this,this.onTouch),this.updateCurState(),this.step1.setTaskId(1),this.step2.setTaskId(2),this.step3.setTaskId(3)},e.prototype.updateCurState=function(){var t=DemonCir.ins().checkActived()?"DCList":"DCTask";this.currentState!=t&&(this.currentState=t),DemonCir.ins().checkActived()?egret.callLater(this.updateList,this):egret.callLater(this.updateTask,this)},e.prototype.clearEff=function(){this.deEff&&(DisplayUtils.removeFromParent(this.deEff),this.deEff=null)},e.prototype.updateTask=function(){Timer.stopAll(this),this.clearEff();var t,i,n,s,o,a=DemonCir.ins().taskID,r=GlobalConfig.DemonCirTask[0==a?1:a],l=GlobalConfig.ItemConfig[r.itemId].name;if(0==a)t=r.npcDialog1,i=r.taskRequire1,n=r.taskInfo1,s="",o="一探究竟",this.state=e.PHASE1;else{var h=DemonCir.ins().taskState;if(h==DemonCir.STATE_TASK)t=r.npcDialog2,i=r.taskRequire2,n=r.taskInfo2,s="需要"+l+"（|C:16711680&T:"+DemonCir.ins().taskProgress+"|/"+r.target+"）",o="前往挑战",this.state=e.PHASE2;else if(h==DemonCir.STATE_CAN_GET||h==DemonCir.STATE_GOT)if(t=r.npcDialog3,i=r.taskRequire3,n=r.taskInfo3,this.state=e.PHASE3,DemonCir.ins().taskCD<=0)s="需要"+l+"（"+DemonCir.ins().taskProgress+"/"+r.target+"）",o="领取";else{s="";var u=DemonCir.ins().getCDTime();u>0?(o=DateUtils.getFormatBySecond(u,DateUtils.TIME_FORMAT_1,5),Timer.start(1e3,0,this.onRepeat,this),this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.taskEff.addChild(this.deEff),this.taskEff.visible=!0,this.deEff.playFile(RES_DIR_EFF+"demonCirTask",-1)):o="领取"}else t=r.npcDialog4,i=r.taskRequire4,n=r.taskInfo4,s="",o="等待",this.state=e.PHASE4}this.npcDialog.textFlow=TextFlowMaker.generateTextFlow(t),this.taskRequire.textFlow=TextFlowMaker.generateTextFlow(i),this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(n),this.taskschedule.textFlow=TextFlowMaker.generateTextFlow(s),this.goBtn.label=o,this.redPoint.visible=0==a||1==DemonCir.ins().taskState,this.step1.updateTask(),this.step2.updateTask(),this.step3.updateTask()},e.prototype.onRepeat=function(){var t=DemonCir.ins().getCDTime();t>0?this.goBtn.label=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1,5):this.updateTask()},e.prototype.onTouch=function(t){if(t.target==this.goBtn)if(this.state==e.PHASE1)DemonCir.ins().sendTaskEvent();else if(this.state==e.PHASE2){var i=GlobalConfig.DemonCirTask[DemonCir.ins().taskID],n=i.controlTarget[2];n?ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1],n):ViewManager.ins().open(i.controlTarget[0],i.controlTarget[1]),ViewManager.ins().close(ForgeWin)}else this.state==e.PHASE3&&(DemonCir.ins().taskCD<=0||DemonCir.ins().getCDTime()<=0)&&DemonCir.ins().sendTaskEvent()},Object.defineProperty(e.prototype,"curRole",{set:function(t){this.role=SubRoles.ins().getSubRoleByIndex(t)},enumerable:!0,configurable:!0}),e.prototype.updateList=function(){this.collect||(this.collect=new eui.ArrayCollection,this.list.dataProvider=this.collect);var t,e,i=Object.keys(GlobalConfig.DemonCirBase).length,n=[],s=DemonCir.ins().getRoleDataByID(this.role.index);if(s){for(var o=1;i>=o;o++){t=GlobalConfig.DemonCirBase[o],e=0;var a=void 0,r=void 0,l=s.getDemonDataByID(t.id);if(l){if(a=!0,e=l.level,l.level<GlobalConfig.DemonCirBase[t.id].maxLevel){var h=BagCT.ins().getBagItemById(GlobalConfig.DemonCirConf.expItemId),u=h?h.count:0,p=DemonCir.ins().getDemonCirLevelCfg(t.id,l.level);p&&GlobalConfig.DemonCirConf.expPerItem*u>=p.exp-l.exp&&(r=!0)}if(l.talentLv>0&&l.talentLv<Object.keys(GlobalConfig.DemonCirTalent[t.talent]).length){var c=GlobalConfig.DemonCirTalent[t.talent][l.talentLv+1],h=BagCT.ins().getBagItemById(t.mat);h&&h.count>=c.costCount&&(r=!0)}DemonCir.ins().checkXiLianRed(this.role.index,t.id)&&(r=!0)}else{var h=BagCT.ins().getBagItemById(t.mat);r=h&&h.count>=t.matCost}n.push({cfg:t,showRed:r,level:e,roleIndex:this.role.index,actived:a})}this.collect.source=n}},e.PHASE1=0,e.PHASE2=1,e.PHASE3=2,e.PHASE4=3,__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(DemonCirListPanel.prototype,"DemonCirListPanel"),window.DemonCirListPanel=DemonCirListPanel;var DemonCirMainPanel=function(t){function e(){var e=t.call(this)||this;return e.curRoleId=0,e.data={cfg:GlobalConfig.DemonCirBase[1],roleIndex:0},e.pageId=1,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(DemonCirRedPoint.ins().postRoleRedPoint,this.updateRed),this.addTouchEvent(this.yunyang,this.onTouch),this.addTouchEvent(this.qianneng,this.onTouch),this.addTouchEvent(this.leftBtn1,this.onClick),this.addTouchEvent(this.rightBtn1,this.onClick),this.setOpenPage(0),this.updateRed()},Object.defineProperty(e.prototype,"curRole",{set:function(t){this.curRoleId=t,this.updateData(),this.viewStack&&this.setOpenPage(this.viewStack.selectedIndex)},enumerable:!0,configurable:!0}),e.prototype.updateData=function(){this.data.cfg=GlobalConfig.DemonCirBase[this.pageId],this.data.roleIndex=this.curRoleId},e.prototype.onTouch=function(t){switch(t.target){case this.yunyang:if(0==this.viewStack.selectedIndex)return;this.viewStack.selectedIndex=0,this.eYunYangGroup.visible=!1;break;case this.qianneng:if(1==this.viewStack.selectedIndex)return;this.viewStack.selectedIndex=1,this.eYunYangGroup.visible=!0;break;default:return}this.eQiannengGroup.visible=!this.eYunYangGroup.visible,this.setOpenPage(this.viewStack.selectedIndex),this.updateRed()},e.prototype.onClick=function(t){var e=Object.keys(GlobalConfig.DemonCirBase).length;switch(t.target){case this.leftBtn1:this.pageId=this.pageId>1?this.pageId-1:e;break;case this.rightBtn1:this.pageId=this.pageId>=e?1:this.pageId+1}this.updateData(),this.setOpenPage(this.viewStack.selectedIndex)},e.prototype.setOpenPage=function(t){switch(t){case e.Page_LEVEL_UP:this.demonCir.setData(this.data);break;case e.Page_XILIAN:this.dcPotential.setData(this.data)}},e.prototype.updateRed=function(){if(this.redPoint0.visible=DemonCirRedPoint.ins().roleYunyang[this.curRoleId],this.redPoint1.visible=DemonCirRedPoint.ins().roleQianneng[this.curRoleId],this.leftRed1.visible=this.rightRed1.visible=!1,!this.eYunYangGroup.visible){var t=DemonCirRedPoint.ins().yunyangPoints[this.curRoleId];if(!t)return;for(var e=0;e<t.length;e++)if(t[e]&&this.pageId!=e){this.leftRed1.visible=this.rightRed1.visible=!0;break}}},e.Page_LEVEL_UP=0,e.Page_XILIAN=1,__decorate([callLater],e.prototype,"updateRed",null),e}(BaseEuiView);__reflect(DemonCirMainPanel.prototype,"DemonCirMainPanel"),window.DemonCirMainPanel=DemonCirMainPanel;var DemonCirWin=function(t){function e(){var e=t.call(this)||this;return e.isAddDis=!1,e}return __extends(e,t),e.prototype.addDisplay=function(){this._expBar||(this._expBar=new ProgressBarEff,this._expBar.setWidth(520),this.exp.addChild(this._expBar),this._expBar.x=-15,this._expBar.y=-10),this.role=SubRoles.ins().getSubRoleByIndex(this.data.roleIndex),this.observe(DemonCir.ins().postRoleDatas,this.update),this.observe(DemonCir.ins().postSpecialUp,this.update),this.observe(DemonCir.ins().postDemonLevelUp,this.update),this.observe(DemonCir.ins().postDemonCirLevelCfg,this.update),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.observe(BagCT.ins().postItemDel,this.update),this.observe(DemonCir.ins().postShowChange,this.updateShow),this.addTouchEvent(this,this.onTouch),this._expBar.reset(),this.update(),this.isAddDis=!0},e.prototype.setData=function(t){this.data=t,this.role=SubRoles.ins().getSubRoleByIndex(this.data.roleIndex),this.isAddDis&&this.update()},e.prototype.update=function(){var t=this.data.cfg,e=DemonCir.ins().getRoleDataByID(this.role.index),i=e.getDemonDataByID(t.id);this.actived=null!=i,this.dcNameImg.source=null,this.dcNameImg.source=t.mainNameImg,this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.demonCirEff.addChild(this.deEff),this.deEff.playFile(""+RES_DIR_EFF+t.winEff,-1),this.demonCirEff.filters=this.actived?null:FilterUtil.ARRAY_GRAY_FILTER,this.deEffLeft||(this.deEffLeft=ObjectPool.pop("MovieClip")),this.deEffLeft.parent||this.effLeft.addChild(this.deEffLeft);var n,s=Object.keys(GlobalConfig.DemonCirBase).length;n=t.id<=1?GlobalConfig.DemonCirBase[s]:GlobalConfig.DemonCirBase[t.id-1],this.deEffLeft.playFile(""+RES_DIR_EFF+n.winEff,-1),this.effLeft.filters=e.getDemonDataByID(n.id)?null:FilterUtil.ARRAY_GRAY_FILTER,this.deEffRight||(this.deEffRight=ObjectPool.pop("MovieClip")),this.deEffRight.parent||this.effRight.addChild(this.deEffRight),n=t.talent>=s?GlobalConfig.DemonCirBase[1]:GlobalConfig.DemonCirBase[t.talent+1],this.deEffRight.playFile(""+RES_DIR_EFF+n.winEff,-1),this.effRight.filters=e.getDemonDataByID(n.id)?null:FilterUtil.ARRAY_GRAY_FILTER,this.upGradeBtn.visible=!0,this.maxDesc.visible=!1,this.nextAttr.visible=!0,this.arrow.visible=!0,this.costGroup.visible=!0,this.getItemTxt.visible=!0,this.nowAttr.left=100;for(var o,a=[],r=t.tezhiAttrC.length,l=0;4>l;l++)if(o=this["skill"+l],r>l){o.visible=!0;var h=0,u=t.tezhiAttrC[l],p=this.actived;if(p){var c=DemonCir.ins().getRoleDataByID(this.role.index),d=c.getDemonDataByID(t.id);h=this.getTeZhiLvl(u,d.level),p=h>0,p&&a.push({id:u,lvl:h})}o.setData({roleId:this.role.index,type:DCSkillItemCell.TYPE_TEZHI,id:u,actived:p,param:h}),o.demonID=t.id,o.demonLvl=i?i.level:1}else o.visible=!1;if(this.showBtn.visible=this.actived,this.redPoint.visible=!1,this.actived){var g=DemonCir.ins().getRoleDataByID(this.role.index),f=g.getDemonDataByID(t.id),v=f.level>=GlobalConfig.DemonCirBase[t.id].maxLevel;this.lvCount.text="Lv."+f.level;var y=this.getTotalAttrByLvl(f.level);if(!y)return;if(a&&a.length&&(y=y.concat(this.getTZAttrs(a,f.level))),y=AttributeData.combineAtts(y),this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(y,0,1,"：")),this.powerPanel.setPower(BagCT.getAttrPower(y,SubRoles.ins().getSubRoleByIndex(this.role.index))),this.expbarBg.visible=this._expBar.visible=!v,v)this.upGradeBtn.visible=!1,this.maxDesc.visible=!0,this.nextAttr.visible=!1,this.arrow.visible=!1,this.nowAttr.left=200,this.costGroup.visible=!1,this.getItemTxt.visible=!1;else{var m=DemonCir.ins().getDemonCirLevelCfg(t.id,f.level);m&&(this.updateMaterail(GlobalConfig.DemonCirConf.expItemId,m.count),this.upGradeBtn.label="蕴   养",y=this.getTotalAttrByLvl(f.level+1),y&&(a&&a.length&&(y=y.concat(this.getTZAttrs(a,f.level))),y=AttributeData.combineAtts(y),this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(y,0,1,"：")),this._expBar.getMaxValue()!=m.exp?this._expBar.setData(f.exp,m.exp):this._expBar.setValue(f.exp)))}}else{this.upGradeBtn.label="激   活",this._expBar.visible=!1,this.expbarBg.visible=!1,this.lvCount.text="未激活";var y=[],T=[],m=DemonCir.ins().getDemonCirLevelCfg(t.id,1);if(m){var C=void 0;for(var b in m.attrs)C=m.attrs[b],y.push(new AttributeData(C.type,0)),T.push(new AttributeData(C.type,C.value));this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(y,0,1,"：")),this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(T,0,1,"：")),this.powerPanel.setPower(0),t.matCost&&this.updateMaterail(t.mat,t.matCost)}}this.ability.setData({roleId:this.role.index,type:DCSkillItemCell.TYPE_TALENT,id:t.id,actived:this.actived,param:null}),this.updateShow()},e.prototype.updateShow=function(){if(this.actived){var t=DemonCir.ins().getRoleDataByID(this.data.roleIndex).showID==this.data.cfg.id;this.showBtn.icon=t?"dc_cancelBtn":"dc_showBtn",t&&1==this.data.cfg.id&&(this.showBtn.visible=!1)}},e.prototype.getTeZhiLvl=function(t,e){for(var i,n=GlobalConfig.DemonCirTeZhi[t],s=Object.keys(n).length,o=1;s>=o;o++){if(i=n[o],e<i.dcMinLv)return i.tezhiLv-1;if(e>=i.dcMinLv&&e<=i.dcMaxLv)return i.tezhiLv}return i.tezhiLv},e.prototype.getTotalAttrByLvl=function(t){var e=this.data.cfg,i=[],n=DemonCir.ins().getDemonCirLevelCfg(e.id,t);if(!n)return null;var s;for(var o in n.attrs)s=n.attrs[o],i.push(new AttributeData(s.type,s.value));var a=[];if(a=a.concat(i),this.data.state&&2==this.data.state){for(var r=DemonCir.ins().getRoleDataByID(this.data.roleIndex),l=r.getDemonDataByID(e.id),h=void 0,u=0,p=0;5>p;p++){h=l.specialVals[p];for(var c=h.length,d=void 0,g=0;c>g;g++)d=h[g],2==d.param?u+=d.value>0?d.value:0:d.value>0&&a.push(new AttributeData(d.type,d.value))}if(u>0)for(var f,v=i.length,p=0;v>p;p++)f=i[p],a.push(new AttributeData(f.type,Math.floor(f.value*u/1e4)))}return a},e.prototype.getTZAttrs=function(t,e){var i=[],n=t.length,s=DemonCir.ins().getDemonCirLevelCfg(this.data.cfg.id,e);if(!s)return i;for(var o=s.attrs,a=o.length,r=0;n>r;r++)for(var l=t[r],h=GlobalConfig.DemonCirTeZhi[l.id][l.lvl],u=0;a>u;u++){var p=o[u];if(h.attrs.type==p.type){i.push(new AttributeData(h.attrs.type,Math.floor(h.attrs.per*p.value/1e4)));break}}return i},e.prototype.updateMaterail=function(t,e){this.icon.source=GlobalConfig.ItemConfig[t].icon+"_png";var i=BagCT.ins().getBagItemById(t),n=i?i.count:0;this.isEnough=n>=e,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this.isEnough?13746831:16711680)+"&T:"+n+"|/"+e),this.redPoint.visible=DemonCirRedPoint.ins().yunyangPoints[this.role.index][this.data.cfg.id],this.upGradeBtn.enabled=this.isEnough},e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn:if(!this.isEnough)return void TipsCT.ins().showTips("材料不足");this.actived?DemonCir.ins().sendDemonLevelUp(this.role.index,this.data.cfg.id):DemonCir.ins().sendActiveDemon(this.role.index,this.data.cfg.id);break;case this.showBtn:DemonCir.ins().sendShowChange(this.data.roleIndex,this.data.cfg.id);break;case this.getItemTxt:var e=this.actived?GlobalConfig.DemonCirConf.expItemId:this.data.cfg.mat;ViewManager.ins().open(ShopGoodsWarn).setData(e)}},__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(DemonCirWin.prototype,"DemonCirWin"),window.DemonCirWin=DemonCirWin;var DemonCirData=function(){function t(t){this.parser(t)}return t.prototype.parser=function(t){this.id=t.readByte(),this.level=t.readInt(),this.exp=t.readInt(),this.talentLv=t.readByte();var e=t.readByte();this.specialVals=[];for(var i=0;e>i;i++){for(var n=[],s=t.readByte(),o=0;s>o;o++)n.push({type:t.readByte(),param:t.readInt(),value:t.readInt()});this.specialVals.push(n)}},t.prototype.getActiveByIndex=function(t){if(!this.specialVals||this.specialVals.length<=t)return!1;var e=this.specialVals[t];if(!e||!e.length)return!1;for(var i=e.length,n=0;i>n;n++)if(-1==e[n].value)return!1;return!0},t}();__reflect(DemonCirData.prototype,"DemonCirData"),window.DemonCirData=DemonCirData;var DemonCirRoleData=function(){function t(t){this.parser(t)}return t.prototype.parser=function(t){this.roleID=t.readByte();var e=t.readByte();this.demonCirDatas||(this.demonCirDatas=[]);for(var i=0;e>i;i++){var n=t.readByte();t.position--;var s=this.demonCirDatas[n];s?s.parser(t):(s=new DemonCirData(t),this.demonCirDatas[n]=s)}this.showID=t.readByte()},t.prototype.getDemonDataByID=function(t){return this.demonCirDatas&&this.demonCirDatas.length?this.demonCirDatas[t]:null},t.prototype.addDemonData=function(t,e){this.demonCirDatas&&(this.demonCirDatas[t]=e)},t}();__reflect(DemonCirRoleData.prototype,"DemonCirRoleData"),window.DemonCirRoleData=DemonCirRoleData;var DieGuide=function(t){function e(){var e=t.call(this)||this;return e.resImg=["vipbn2_png","vipbn2_1_png"],e.observe(Encounter.ins().postFightResult,e.postdieGuide),e.observe(Recharge.ins().postRecharge1Data,e.initRecharge1),e.observe(Setting.ins().postInitSetting,e.initSetting),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initRecharge1=function(){this.isInitRecharge1=!0},e.prototype.initSetting=function(){this.isInitSetting=!0},e.prototype.postdieGuide=function(t){if(!t){var e=Setting.ins().getValue(ClientSet.diedFirstTime);e||(e=Math.floor((new Date).getTime()/1e3),Setting.ins().setValue(ClientSet.diedFirstTime,e));var i=Recharge.ins().getRechargeData(0);i.num&&(e=Setting.ins().getValue(ClientSet.diedFirstTime2),e||(e=Math.floor((new Date).getTime()/1e3),Setting.ins().setValue(ClientSet.diedFirstTime2,e)))}},e.prototype.dieFbRedPoint=function(t,e){var i=GlobalConfig.DailyFubenConfig[e];if(!i)return!1;if(ZsCT.ins().lv<i.zsLevel||Actor.level<i.levelLimit)return!1;var n=Setting.ins().getValue(ClientSet.FB);if(n){var s=e-3e3;if(n>>s&1)return!1}var o=Setting.ins().getValue(ClientSet.diedFirstTime);if(!o)return!1;var a=Math.floor((new Date).getTime()/1e3);return a>DateUtils.getTodayZeroSecond(new Date(1e3*o))+86400?!1:t>0},e.prototype.getOpenRoles=function(){var t=Setting.ins().getValue(ClientSet.role);if(t==e.Show2&&SubRoles.ins().subRolesLen>=3)return"";for(var i=3,n=1;i>n;n++){var s=SubRoles.ins().getSubRoleByIndex(n);if(!s)return t?t==e.Show&&2==n&&Setting.ins().setValue(ClientSet.role,e.Show2):Setting.ins().setValue(ClientSet.role,e.Show),this.resImg[n-1]}return""},e.prototype.setClick=function(t){var e=t-3e3,i=Setting.ins().getValue(ClientSet.FB)||0;i>>e&1||(i|=1<<e,Setting.ins().setValue(ClientSet.FB,i))},e.Show=1,e.Show2=2,__decorate([post()],e.prototype,"postdieGuide",null),e}(BaseSystem);__reflect(DieGuide.prototype,"DieGuide"),System.DieGuide=function(){return DieGuide.ins()},window.DieGuide=DieGuide;var DressType;!function(t){t[t.ROLE=1]="ROLE",t[t.ARM=2]="ARM",t[t.WING=3]="WING"}(DressType||(DressType={}));var DressTypeName;!function(t){t[t[""]=0]="",t[t["角色"]=1]="角色",t[t["武器"]=2]="武器",t[t["翅膀"]=3]="翅膀"}(DressTypeName||(DressTypeName={}));var Dress=function(t){function e(){var e=t.call(this)||this;return e.timeInfo={},e.posInfo=[],e.careerDic={},e.itemIdDic={},e.sysId=PackageID.Dress,e.regNetMsg(1,e.doDressInfo),e.regNetMsg(2,e.doDressActivationRes),e.regNetMsg(3,e.doDressUserRes),e.regNetMsg(4,e.doUnDressUserRes),e.regNetMsg(5,e.doDressTimeEnd),e.regNetMsg(6,e.postLevelUp),e.regNetMsg(7,e.postAddTime),e}return __extends(e,t),e.prototype.sendDressInfoReq=function(){this.sendBaseProto(1)},e.prototype.doDressInfo=function(t){this.parser(t),e.ins().postDressInfo()},e.prototype.sendDressActivationReq=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.doDressActivationRes=function(t){this.parserAct(t),e.ins().postJiHuo(),TipsCT.ins().showTips("|C:0xffffff&T:激活装扮形象成功|")},e.prototype.sendDressUserReq=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doDressUserRes=function(t){this.parserDress(t),e.ins().postDressInfo(),TipsCT.ins().showTips("|C:0xffffff&T:幻化形象成功|")},e.prototype.sendUnDressUserReq=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doUnDressUserRes=function(t){this.parserDress(t),e.ins().postDressInfo(),TipsCT.ins().showTips("|C:0xffffff&T:取消幻化形象成功|")},e.prototype.doDressTimeEnd=function(t){this.parserDel(t),e.ins().postDressInfo()},e.prototype.parserAct=function(t){var e=new DressTimeInfo;e.dressId=t.readInt(),e.invalidtime=t.readInt(),e.lv=t.readInt(),this.timeInfo[e.dressId]=e},e.prototype.parserDress=function(t){var i=t.readByte(),n=this.posInfo[i],s=t.readByte(),o=t.readInt();n&&(n.posAry[s-1]=o);var a=SubRoles.ins().getSubRoleByIndex(i);a.zhuangbei[s-1]=o,1==s||2==s?EquipCT.ins().postEquipChange(i,s):e.ins().postChangeWing();var r=EntityManager.ins().getEntityByHandle(a.handle);r&&r.updateModel()},e.prototype.parserDel=function(t){var i=t.readInt();delete this.timeInfo[i];for(var n=0;n<this.posInfo.length;n++)for(var s=this.posInfo[n],o=0;3>o;o++)if(s.posAry[o]==i){s.posAry[o]=0;var a=SubRoles.ins().getSubRoleByIndex(n);a.zhuangbei[o]=0,0==o||1==o?EquipCT.ins().postEquipChange(n,o):e.ins().postChangeWing();var r=EntityManager.ins().getEntityByHandle(a.handle);r&&r.updateModel();break}},e.prototype.getModelPosId=function(t){return this.posInfo[t]},e.prototype.redPoint=function(){return this.careerRedPoint()},e.prototype.careerRedPoint=function(){for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=SubRoles.ins().getSubRoleByIndex(t).job,i=this.getIdByCareer(e);for(var n in i)for(var s=i[n],o=0,a=s;o<a.length;o++){var r=a[o];if(this.redPointDress(r.id))return!0}}return!1},e.ins=function(){return t.ins.call(this)},e.getCost=function(t){for(var e=t.cost,i=t.permanentCost,n=[i,e],s=0,o=n;s<o.length;s++){var a=o[s];if(a){var r=a.itemId,l=a.num,h=BagCT.ins().getBagGoodsCountById(0,r);if(h>=l)return[a,h]}}return[i||e,0]},e.prototype.canDress=function(t,e){if(e==DressType.WING&&Actor.level<=16)return!1;var i=this.getIdByCareer(t)[e];for(var n in i)if(this.redPointDress(i[n].id))return!0;return!1},e.prototype.parser=function(t){var e=t.readInt();this.timeInfo={};for(var i=0;e>i;i++){var n=new DressTimeInfo;n.dressId=t.readInt(),n.invalidtime=t.readInt(),n.lv=t.readInt(),this.timeInfo[n.dressId]=n}e=t.readByte(),this.posInfo=[];for(var i=0;e>i;i++){for(var s=new DressPosInfo,o=0;3>o;o++)s.posAry[o]=t.readInt();this.posInfo.push(s)}},e.prototype.posRedPoint=function(){for(var t=[!1,!1,!1],e=SubRoles.ins().subRolesLen,i=0;e>i;i++)for(var n=SubRoles.ins().getSubRoleByIndex(i).job,s=this.getIdByCareer(n),o=0;3>o;o++)if(!t[o])for(var a=s[o+1],r=0,l=a;r<l.length;r++){var h=l[r];if(this.redPointDress(h.id)){t[o]=!0;break}}return t},e.prototype.redPointDress=function(t){var i=GlobalConfig.ZhuangBanId[t];if(i.pos==DressType.WING&&Actor.level<=16)return!1;var n=e.getCost(i),s=n[0],o=n[1];if(0==o)return!1;if(this.timeInfo[t]){var a=this.timeInfo[t].lv+1,r=GlobalConfig.ZhuangBanLevelUp[t];if(r&&r[a]&&r[a].cost.num<=o)return!0}else if(o>=s.num)return!0;return!1},e.prototype.isZhuangBanItem=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var n=e[i];if(n.cost.itemId==t||n.permanentCost&&n.permanentCost.itemId==t)return!0}return!1},e.prototype.isLimitZhuangBanItem=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var n=e[i];if(n.cost.itemId==t&&n.permanentCost)return!0}return!1},e.prototype.getIdZhuangBanId=function(t){var e=GlobalConfig.ZhuangBanId;for(var i in e){var n=e[i];if(n.cost.itemId==t)return n.id}return 0},e.prototype.sendLevelUp=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.postLevelUp=function(t){var e=t.readInt(),i=t.readInt(),n=t.readInt(),s=this.timeInfo[e];s.invalidtime=i,s.lv=n,this.postDressInfo()},e.prototype.postAddTime=function(t){var e=t.readInt(),i=t.readInt(),n=t.readInt(),s=this.timeInfo[e]||new DressTimeInfo;s.invalidtime=i,s.lv=n,s.dressId=e,this.timeInfo[e]=s},e.prototype.getIdByCareer=function(t){return this.careerDic[t]?this.careerDic[t]:(this.initConfig(),this.careerDic[t])},e.prototype.initConfig=function(){if(!Object.keys(this.itemIdDic).length){var t=GlobalConfig.ZhuangBanId;for(var e in t){var i=t[e],n=i.roletype,s=i.pos;this.careerDic[n]=this.careerDic[n]||{},this.careerDic[n][s]=this.careerDic[n][s]||[],this.careerDic[n][s].push(i);var o=i.cost.itemId;this.itemIdDic[o]=this.itemIdDic[o]||[],this.itemIdDic[o].push(i)}}},e.prototype.postDressInfo=function(){},e.prototype.postJiHuo=function(){},e.prototype.postChangeWing=function(){},__decorate([post()],e.prototype,"postLevelUp",null),__decorate([post()],e.prototype,"postAddTime",null),__decorate([post()],e.prototype,"postDressInfo",null),__decorate([post()],e.prototype,"postJiHuo",null),__decorate([post()],e.prototype,"postChangeWing",null),e}(BaseSystem);__reflect(Dress.prototype,"Dress"),System.Dress=function(){return Dress.ins()},window.Dress=Dress;var DressItemInfo=function(){function t(){this.isDress=!1,this.lv=0}return t}();__reflect(DressItemInfo.prototype,"DressItemInfo"),window.DressItemInfo=DressItemInfo;var DressPosInfo=function(){function t(){this.posAry=[]}return t}();__reflect(DressPosInfo.prototype,"DressPosInfo"),window.DressPosInfo=DressPosInfo;var DressTimeInfo=function(){function t(){}return t}();__reflect(DressTimeInfo.prototype,"DressTimeInfo"),window.DressTimeInfo=DressTimeInfo;var DressItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="DressItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(null!=t){this.redPoint0.visible=!1;var e=t.zhuanban.cost.itemId;t.lv?(this.timelabel.visible=!0,this.imgIcon.source=e+"_png"):(this.timelabel.visible=!1,this.imgIcon.source=e+"_png"),this.redPoint0.visible=Dress.ins().redPointDress(t.zhuanban.id),this.imageName.text=t.zhuanban.name,this.huanhuaImage.visible=t.isDress,0==t.timer?this.timelabel.textFlow=(new egret.HtmlTextParser).parser(StringUtils.addColor("永久",3532333)):t.timer>0?this.timelabel.text=this.updateTimer(t.timer):this.timelabel.visible=!1,t.lv>1?this.levellabel.text=t.lv+"级":this.levellabel.text="1级"}},e.prototype.updateTimer=function(t){var e="",i=(DateUtils.formatMiniDateTime(t)-GameServer.serverTime)/1e3;return i>=0&&(e=DateUtils.getFormatBySecond(i,5,2)),e},Object.defineProperty(e.prototype,"selected",{set:function(t){this.selectImage.visible=t},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(DressItemRenderer.prototype,"DressItemRenderer"),window.DressItemRenderer=DressItemRenderer;var DressWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listInfo=[],e._sn_="DressSkin",e.isTopLevel=!0,e.lastRole=-1,e.lastIndex=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eBodyMCGroup.addChild(this.bodyMc),this.wefBodyMc=new MovieClip,this.wefBodyMc.visible=!1,this.eWeapon.addChild(this.wefBodyMc),this.wingMc=new MovieClip,this.wingMc.visible=!1,this.eWingGroup.addChild(this.wingMc),this.arry=new eui.ArrayCollection(this.listInfo),this.list.itemRenderer=DressItemRenderer,this.list.dataProvider=this.arry,this.titleList.itemRenderer=TitleItem;var t=CommonUtils.copyDataHandler(GlobalConfig.ZhuangBanConfig.zhuangbanpos);t.push("称号"),this.tab.dataProvider=new eui.ArrayCollection(t),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.help,this.onClick),this.addTouchEvent(this.itemName,this.onClick),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.list,this.onChange),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.addChangeEvent(this.roleSelect0,this.onChange),this.addTouchEvent(this.dressBtn,this.onClick),this.addTouchEvent(this.dressBtn2,this.onClick),this.list.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.list.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.list.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.titleList.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouch,this)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0]||0,void 0!=t[1]&&(this.lastIndex=this.selectIndex=parseInt(t[1]+""),this.tab.selectedIndex=this.selectIndex),this.listId=t[2]||-1,this.list.selectedIndex=-1,this.roleSelect.setCurRole(this.curRole),this.roleSelect0.setCurRole(this.curRole),MessageCenter.ins().addListener(Title.TITLE_WIN_REFLASH_PANEL,this.reflashPanel,this),this.observe(Dress.ins().postDressInfo,this.update),this.observe(Dress.ins().postJiHuo,this.onJihuo),this.observe(GameLogic.ins().postSubRoleChange,this.getDressInfo),this.observe(Title.ins().postListUpdate,this.updateList),this.observe(Title.ins().postTitleShow,this.updateShow),this.observe(Title.ins().postUseTitle,this.useTitle),this.titleGroup.visible=!1,this.dressGroup.visible=!0,this.changeRole(),this.getDressInfo(),this.lastIndex>=0&&this.setSelectedIndex()},e.prototype.removeDisplay=function(){MessageCenter.ins().removeListener(Title.TITLE_WIN_REFLASH_PANEL,this.reflashPanel,this)},e.prototype.reflashPanel=function(t,e){if(t.itemIndex==Title.ins().list.length-1){var i=Title.EXPAND_HEIGHT-Title.SIMLPE_HEIGHT;"expand"==e?this.titleList.scrollV=this.titleList.contentHeight-this.titleList.height+i:this.titleList.scrollV=this.titleList.contentHeight-this.titleList.height-i,this.titleList.validateNow()
}},e.prototype.listSelectIndex=function(t){if(-1==t)return-1;var e=0,i=SubRoles.ins().getSubRoleByIndex(this.curRole).job;for(var n in this.listInfo){if(this.listInfo.hasOwnProperty(n)){var s=this.listInfo[n];if(s.zhuanban.id-i+1==t)break}e++}return e},e.prototype.onTouch=function(t){t.type==egret.TouchEvent.TOUCH_BEGIN?(this.roleSelect.parent.touchEnabled=!1,this.roleSelect0.parent.touchEnabled=!1):(this.roleSelect.parent.touchEnabled=!0,this.roleSelect0.parent.touchEnabled=!0)},e.prototype.getDressInfo=function(){Dress.ins().sendDressInfoReq()},e.prototype.onChange=function(t){switch(t.target){case this.roleSelect:if(this.lastRole==this.roleSelect.getCurRole())return;this.changeRole();break;case this.roleSelect0:if(this.lastRole==this.roleSelect0.getCurRole())return;Title.ins().curSelectRole=this.lastRole=this.roleSelect0.getCurRole(),null==Title.ins().list?Title.ins().sendGetList():this.updateList();break;case this.list:this.onInfoUpdate(t.item)}},e.prototype.changeRole=function(){this.curRole=this.roleSelect.getCurRole(),this.lastWeapon=0,this.lastBody=0,this.lastWing=0,this.lastRole=this.curRole,this.update()},e.prototype.careerRedPoint=function(){for(var t=Dress.ins().posRedPoint(),e=0;3>e;e++)this["redPoint"+e].visible=t[e]},e.prototype.onTabTouch=function(t){var e=this.list.parent;e.stopAnimation(),this.list.scrollH=0,this.listId=-1,this.selectIndex=t.currentTarget.selectedIndex,this.setSelectedIndex()},e.prototype.setSelectedIndex=function(){this.lastIndex=this.selectIndex,this.selectIndex<this.tab.dataProvider.length-1?(this.dressGroup.visible=!0,this.roleSelect.openRole(),this.titleGroup.visible=!1,this.update()):(this.dressGroup.visible=!1,this.titleGroup.visible=!0,Title.ins().curSelectRole=0,this.roleSelect.hideRole(),null==Title.ins().list?Title.ins().sendGetList():this.updateList())},e.prototype.update=function(){this.curRole=this.curRole||0,this.selectIndex=this.selectIndex||0;var t=Dress.ins();this.listInfo=[];for(var e in GlobalConfig.ZhuangBanId)if(SubRoles.ins().getSubRoleByIndex(this.curRole).job==GlobalConfig.ZhuangBanId[e].roletype&&this.selectIndex+1==GlobalConfig.ZhuangBanId[e].pos){var i=new DressItemInfo;i.zhuanban=GlobalConfig.ZhuangBanId[e],i.lv=0;var n=i.zhuanban.id;if(t.timeInfo[n]&&(i.timer=t.timeInfo[n].invalidtime,i.lv=t.timeInfo[n].lv),t.posInfo.length>this.curRole&&n==t.posInfo[this.curRole].posAry[this.selectIndex]&&(i.isDress=!0),i.zhuanban.noItemNoShow&&1==i.zhuanban.noItemNoShow&&0==i.lv&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.zhuanban.cost.itemId)<1)continue;this.listInfo.push(i)}if(this.listInfo.sort(this.sortList),this.arry.replaceAll(this.listInfo),this.list.dataProvider=this.arry,this.onInfoUpdate(),this.redPoint(),this.careerRedPoint(),-1!=this.listId){var s=this.listSelectIndex(this.listId);this.list.selectedIndex=s,this.list.scrollH=110*s}},e.prototype.sortList=function(t,e){return t.zhuanban.sort<e.zhuanban.sort?-1:t.zhuanban.sort>e.zhuanban.sort?1:0},e.prototype.redPoint=function(){for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=Dress.ins().canDress(SubRoles.ins().getSubRoleByIndex(t).job,this.tab.selectedIndex+1);this.roleSelect.showRedPoint(t,e)}},e.prototype.onInfoUpdate=function(t){if(void 0===t&&(t=null),null==t?(-1==this.list.selectedIndex&&(this.list.selectedIndex=0),this.dress=this.list.selectedItem):this.dress=t,this.attrLv.visible=!0,this.attrLv.text="",this.dress){this.selectGroup.visible=!0,this.unSelectGroup.visible=!1;var e=this.dress.zhuanban.attr;if(this.dress.lv>1){var i=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][this.dress.lv];e=AttributeData.AttrAddition(e,i.attr)}this.attrLabel.text=AttributeData.getAttStr(AttributeData.transformAttr(e),0,1,":");var n=this.getSlotDesc(this.dress.zhuanban.id);if(this.attrLabel.text+=n?"\n"+n:"",this.attrLabel.text+=this.dress.zhuanban.special_attr_desc?"\n"+this.dress.zhuanban.special_attr_desc:"",this.dress.zhuanban.wing_attr_per>0){this.attrLabel.text+="\n翅膀基础属性："+Math.floor(this.dress.zhuanban.wing_attr_per/100)+"%";var s=[],o=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData,a=o?o.lv:0;a=a>=0?a:0;for(var r=GlobalConfig.WingLevelConfig[a].attr,l=r.length,h=0;l>h;h++)s.push(new AttributeData(r[h].type,Math.floor(r[h].value*this.dress.zhuanban.wing_attr_per/1e4)));e=AttributeData.AttrAddition(e,s)}if(this.isCanLevelUp(this.dress)&&!this.isMaxLevel(this.dress)){var u=this.dress.lv+1,p=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id],c=p[u].attr;p[this.dress.lv]&&(c=AttributeData.AttrDel(c,p[this.dress.lv].attr));for(var d="",h=0;h<c.length;h++)d+="升级+"+c[h].value+"\n";var g=d.lastIndexOf("\n");d=d.substring(0,g),this.attrLv.text=d}var f=BagCT.getAttrPower(AttributeData.transformAttr(e));if(f+=this.dress.zhuanban.exPower?this.dress.zhuanban.exPower:0,this.powerPanel.setPower(f),this.namelabel.visible=!1,this.itemName.visible=!1,this.dressBtn.enabled=!0,this.dress.lv)if(this.isCanLevelUp(this.dress)){if(this.dressBtn.visible=!0,this.dressBtn2.visible=!0,this.isMaxLevel(this.dress))this.namelabel.visible=!1,this.itemName.visible=!1,this.dressBtn.label="已满级",this.dressBtn.enabled=!1;else{this.namelabel.visible=!0,this.itemName.visible=!0,this.dressBtn.label=this.dress.timer>0?"永久激活":"升 级";var u=this.dress.lv+1,i=GlobalConfig.ZhuangBanLevelUp[this.dress.zhuanban.id][u];this.id=i.cost.itemId,this.num=i.cost.num;var v=BagCT.ins().getBagGoodsCountById(0,this.id),d="<font color='"+(v>=this.num?"#23C42A":"#f3311e")+"'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>";this.itemName.textFlow=(new egret.HtmlTextParser).parser(d)}this.dress.isDress?this.dressBtn2.label="脱 下":this.dressBtn2.label="幻 化"}else this.namelabel.visible=!1,this.itemName.visible=!1,this.dressBtn.visible=!0,this.dressBtn2.visible=!1,this.dress.isDress?this.dressBtn.label="脱 下":this.dressBtn.label="幻 化";else{this.dressBtn.label="激 活",this.namelabel.visible=!0,this.itemName.visible=!0,this.dressBtn.visible=!0,this.dressBtn2.visible=!1;var y=Dress.getCost(this.dress.zhuanban),m=y[0],v=y[1];this.id=m.itemId,this.num=m.num;var d="<font color='"+(v>=this.num?"#23C42A":"#f3311e")+"'><u>"+GlobalConfig.ItemConfig[this.id].name+"×"+this.num+"</u></font>";this.itemName.textFlow=(new egret.HtmlTextParser).parser(d)}this.onupdateEquip(!1)}else this.selectGroup.visible=!1,this.unSelectGroup.visible=!0,this.onupdateEquip(!0)},e.prototype.isCanLevelUp=function(t){return!!GlobalConfig.ZhuangBanLevelUp[t.zhuanban.id]},e.prototype.isMaxLevel=function(t){var e=t.lv+1,i=t.zhuanban.id;return GlobalConfig.ZhuangBanLevelUp[i]&&GlobalConfig.ZhuangBanLevelUp[i][e]?!1:!0},e.prototype.onupdateEquip=function(t){void 0===t&&(t=!1);var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=Dress.ins().getModelPosId(this.curRole);if(!i||!i.posAry||i.posAry.length<=0){var n=this.listInfo[0];return void(1==n.zhuanban.pos?(this.setEquip(e,n.zhuanban.id,this.lastWeapon),this.lastBody=n.zhuanban.id):2==n.zhuanban.pos?(this.setEquip(e,this.lastBody,n.zhuanban.id),this.lastWeapon=n.zhuanban.id):(this.setWing(n.zhuanban.id),this.lastWing=n.zhuanban.id))}t?(this.setWing(i.posAry[2]),this.setEquip(e,i.posAry[0],i.posAry[1])):3==this.dress.zhuanban.pos?(this.setWing(this.dress.zhuanban.id),this.setEquip(e,this.lastBody||i.posAry[0],this.lastWeapon||i.posAry[1]),this.lastWing=this.dress.zhuanban.id):1==this.dress.zhuanban.pos?(this.setEquip(e,this.dress.zhuanban.id,this.lastWeapon||i.posAry[1]),this.lastBody=this.dress.zhuanban.id,this.setWing(this.lastWing)):(this.setEquip(e,this.lastBody||i.posAry[0],this.dress.zhuanban.id),this.lastWeapon=this.dress.zhuanban.id,this.setWing(this.lastWing))},e.prototype.setWing=function(t){var e=SubRoles.ins().getSubRoleByIndex(this.curRole).wingsData;if(this.wingImg.visible=!0,this.wingMc.visible=!1,t>0){var i=this.getZhuangbanById(t);i.useMc?this.wingMc.playFile(RES_DIR_DRESS+i.res+"_c_m",-1):this.wingImg.source=i.res+"_png",this.wingMc.visible=i.useMc>0,this.wingImg.visible=!this.wingMc.visible}else e.openStatus?this.wingImg.source=GlobalConfig.WingLevelConfig[e.lv].appearance+"_png":this.wingImg.source=""},e.prototype.setEquip=function(t,e,i){if(t){var n,s=t.equipsData;this.weaponImg.source="";for(var o=GlobalConfig.ClientGlobalConfig.useManRes?0:t.sex,a=0;a<s.length;a++)if(0==a||2==a){var r=s[a].item.configID;if(r>0){var l=GlobalConfig.EquipConfig[r].appearance;l&&l.indexOf("[job]")>-1&&(l=l.replace("[job]",t.job+"")),0==a?this.weaponImg.source=l+"_"+o+"_c_png":(this.bodyImg.source=l+"_"+t.sex+"_c_png",n=!0)}}if(n||(this.bodyImg.source="body000_"+t.sex+"_c_png"),i>0){var h=this.getZhuangbanById(i);h.otherId>0&&h.otherId==e&&(h=this.getZhuangbanById(h.changeId)),h.useMc>0?(this.weaponImg.visible=!1,this.wefBodyMc.visible=!0,this.wefBodyMc.playFile(RES_DIR_DRESS+h.res+"_"+o+"_c_m",-1)):(this.weaponImg.visible=!0,this.wefBodyMc.visible=!1,this.weaponImg.source=h.res+"_"+o+"_c_png")}else this.weaponImg.visible=!0,this.wefBodyMc.visible=!1;if(e>0){var h=this.getZhuangbanById(e);h.otherId>0&&h.otherId==i&&(h=this.getZhuangbanById(h.changeId)),h.useMc>0?(this.bodyImg.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+h.res+"_"+t.sex+"_c_m",-1)):(this.bodyMc.visible=!1,this.bodyImg.visible=!0,this.bodyImg.source=h.res+"_"+t.sex+"_c_png")}else this.bodyMc.visible=!1,this.bodyImg.visible=!0}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.onJihuo=function(){return this.dress&&this.dress.zhuanban?void Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id):void console.log(e,"DressWin　　"+this.dress+" ++++++ ")},e.prototype.onClick=function(t){var i=this;switch(t.target){case this.closeBtn:ViewManager.ins().close(e);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,48);break;case this.itemName:var n=GlobalConfig.ItemConfig[this.id],s=ItemUtil.getType(n);void 0!=n&&n&&void 0!=s&&(0==s||4==s?ViewManager.ins().open(EquipDetailedWin,1,void 0,n.id):ViewManager.ins().open(ItemDetailedWin,0,n.id));break;case this.dressBtn2:"幻 化"==this.dressBtn2.label?Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id):Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id);break;case this.dressBtn:if(!this.dress||!this.dress.zhuanban)return void console.log(e,"DressWin　　"+this.dress+" ++++++ ");if("激 活"==this.dressBtn.label||"永久激活"==this.dressBtn.label){if(BagCT.ins().getBagGoodsCountById(0,this.id)<this.num)return void TipsCT.ins().showTips("|C:0xf3311e&T:激活道具不足|");if(3==this.dress.zhuanban.pos&&Actor.level<16)return void TipsCT.ins().showTips("16级开启翅膀后可激活");var o={0:"通用",1:"战士",2:"法师",3:"道士"},a=GlobalConfig.ZhuangBanConfig.zhuangbanpos;WarnWin.show("确定要激活<font color='#35e62d'>"+(o[this.dress.zhuanban.roletype]+a[this.dress.zhuanban.pos-1])+"</font>装扮"+this.dress.zhuanban.name+"吗?",function(){Dress.ins().sendDressActivationReq(i.dress.zhuanban.id)},this)}else if("幻 化"==this.dressBtn.label)Dress.ins().sendDressUserReq(this.curRole,this.dress.zhuanban.id);else if("升 级"==this.dressBtn.label){if(BagCT.ins().getBagGoodsCountById(0,this.id)<this.num)return void TipsCT.ins().showTips("|C:0xf3311e&T:升级道具不足|");Dress.ins().sendLevelUp(this.dress.zhuanban.id)}else"脱 下"==this.dressBtn.label&&Dress.ins().sendUnDressUserReq(this.curRole,this.dress.zhuanban.id)}},e.prototype.useTitle=function(t){t.config.Id!=Title.ins().showTitleDic[Title.ins().curSelectRole]?t.config.job&&t.config.job!=SubRoles.ins().getSubRoleByIndex(this.roleSelect0.getCurRole()).job?TipsCT.ins().showTips("职业不符"):Title.ins().setTitle(this.roleSelect0.getCurRole(),t.config.Id):Title.ins().setTitle(Title.ins().curSelectRole,0)},e.prototype.updateList=function(){for(var t=Title.ins().list.concat(),e=0;e<t.length;e++)t[e].config.job&&t[e].config.job!=SubRoles.ins().getSubRoleByIndex(this.roleSelect0.getCurRole()).job&&(t.splice(e,1),e--);this.titleList.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateShow=function(t){var e=(t[0],t[1]),i=t[2];if(e>0==i>0)this.updateItemByID(i),this.updateItemByID(e);else for(var n in Title.ins().timeDict)this.updateItemByID(+n)},e.prototype.updateItemByID=function(t){if(t in Title.ins().infoDict){var e=Title.ins().infoDict[t];this.titleList&&this.titleList.dataProvider&&this.titleList.dataProvider.itemUpdated(e)}},e.prototype.getSlotDesc=function(t){var e=GlobalConfig.ZhuangBanId[t];if(!e||!e.attr_precent)return"";for(var i="",n=0;n<e.attr_precent.length;n++){switch(e.attr_precent[n].pos){case EquipPos.WEAPON:i="武器";break;case EquipPos.HEAD:i="头盔";break;case EquipPos.CLOTHES:i="衣服";break;case EquipPos.NECKLACE:i="项链";break;case EquipPos.Wrist:i="手镯";break;case EquipPos.BRACELET:i="腰带";break;case EquipPos.RING:i="戒指";break;case EquipPos.SHOE:i="鞋子"}i+="基础属性+"+Math.floor(e.attr_precent[n].pre/100)+"%\n"}if(i){var s=i.lastIndexOf("\n");i=i.substring(0,s)}return i},e}(BaseEuiView);__reflect(DressWin.prototype,"DressWin"),ViewManager.ins().reg(DressWin,LayerManager.UI_Main),window.DressWin=DressWin;var Encounter=function(t){function e(){var e=t.call(this)||this;return e.encounterModel=[],e.revengeData=[],e.wildModel={},e.isGuiding=!1,e.wildPersonList={},e.isFindDrop=!1,e.buyAndFight=!1,e.encounterRank=0,e.sysId=PackageID.Encounter,e.regNetMsg(1,e.doLastRefreshTime),e.regNetMsg(2,e.doEncounterData),e.regNetMsg(3,e.doResult),e.regNetMsg(4,e.postZaoYuRecord),e.regNetMsg(7,e.postDataUpdate),e.regNetMsg(5,e.doUpdateWildBoss),e.regNetMsg(6,e.doWildBossResult),e.regNetMsg(8,e.doAddWildPlayer),e.regNetMsg(9,e.doWildPlayerResult),e.regNetMsg(10,e.doRedNameResult),e.regNetMsg(11,e.onTreasureData),e.regNetMsg(12,e.onTreasureUpdate),e.regNetMsg(13,e.onEnemyData),e.regNetMsg(14,e.onOpenTreasure),e.observe(RoleMgr.ins().postEnterGame,e.clearEncounterModel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onOpenTreasure=function(t){for(var e=t.readByte(),i=[],n=0;e>n;n++){var s=(t.readInt(),t.readInt());t.readInt();i.push(s)}ViewManager.ins().open(EncounterTreasureTipsView,i)},e.prototype.sendRevengeResult=function(t,e){var i=this.getBytes(15);i.writeByte(e),i.writeByte(t),this.sendToServer(i)},e.prototype.onEnemyData=function(t){var e=new TreasureEnemyModel;return e.parser(t),e},e.prototype.revengeEnemy=function(t){var e,i=t.toName;this.revengeData.forEach(function(t){i==t.name&&(e=t)}),e&&!FbCT.ins().checkInFB()&&(ViewManager.ins().close(BagFullTipsWin),ViewManager.ins().closeTopLevel(),Timer.start(100,1,function(){EncounterFight.ins().start(e.index)},this))},e.prototype.openTreasure=function(t){var e=this.getBytes(12);e.writeByte(t),this.sendToServer(e)},e.prototype.viewTreasure=function(){this.sendBaseProto(13)},e.prototype.onTreasureData=function(t){return EncounterTreasureData.ins().parse(t)},e.prototype.onTreasureUpdate=function(t){var e=EncounterTreasureData.ins().updateTreasureData(t);return e},e.prototype.doLastRefreshTime=function(t){EncounterModel.lastTime=t.readInt();t.readInt(),t.readInt();EncounterModel.refreshTimes=t.readInt(),EncounterModel.redName=t.readInt(),this.postEncounterDataChange()},e.prototype.sendRefresh=function(){this.sendBaseProto(1)},e.prototype.sendFightResult=function(t){if(void 0!=EncounterFight.ins().encounterIndex){1==t&&TipsCT.ins().showTips("PK值增加"+GlobalConfig.SkirmishBaseConfig.onesPkval+"点");var e=this.getBytes(2),i=EncounterFight.ins().encounterIndex;console.log("结果 ",t," index",i),e.writeInt(i),e.writeInt(t),this.sendToServer(e)}},e.prototype.postFightResult=function(t){return t},e.prototype.isEncounter=function(){return void 0!=EncounterFight.ins().encounterIndex&&EncounterFight.ins().encounterIndex>=0||this.isFindDrop},e.prototype.isHasRed=function(){for(var t=0,i=0;i<e.ins().encounterModel.length;i++)e.ins().getEncounterModel(i)&&t++;return t>0&&EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval?t:0},e.prototype.doEncounterData=function(t){var e=t.readInt();if(e>=100){var i=e-100;t.position-=4,this.revengeData[i]=this.revengeData[i]||new EncounterModel,this.revengeData[i].parser(t)}else t.position-=4,this.encounterModel[e]=this.encounterModel[e]||new EncounterModel,this.encounterModel[e].parser(t),this.postEncounterDataChange()},e.prototype.postEncounterDataChange=function(){},e.prototype.sendGetreward=function(){this.sendBaseProto(3)},e.prototype.doResult=function(t){for(var i,n=t.readInt(),s=t.readInt(),o=[],a=[0,1,4,3],r=a.length,l=0;r>l;l++)i=new RewardData,i.type=0,i.id=a[l],i.count=t.readInt(),i.count&&o.push(i);r=t.readShort();for(var l=0;r>l;l++)i=new RewardData,i.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,i),o.push(i);this.encounterModel[n-1]=null;if(s&&r){var h=function(){e.ins().isFindDrop=!1,this.sendGetreward(),EncounterFight.ins().win()};this.isFindDrop=!0,DropHelp.addCompleteFunc(h,this),DropHelp.start(),DemonCir.ins().checkLastTask()}else s||EncounterFight.ins().lose();this.postEncounterDataChange()},e.prototype.getEncounterLength=function(){for(var t=0,i=0;i<e.ins().encounterModel.length;i++){var n=e.ins().getEncounterModel(i);n&&(t+=1)}return t},e.prototype.postDataUpdate=function(t){var e=t.readInt(),i=t.readShort();return this.encounterRank=i,[e,i]},e.prototype.sendInquirePrestige=function(){this.sendBaseProto(7)},e.prototype.postZaoYuRecord=function(t){if(void 0===t&&(t=null),!t)return null;for(var e=t.readShort(),i=[],n=0;e>n;n++){var s=[];s[0]=t.readInt(),s[1]=t.readBoolean(),s[2]=t.readString(),s[3]=t.readInt(),s[4]=t.readInt(),s[5]=t.readInt(),s[6]=t.readInt(),i[n]=s}return i},e.prototype.sendInquireRecord=function(){this.sendBaseProto(4)},e.prototype.doUpdateWildBoss=function(t){var e=t.readInt();this.willBossID=e,PlayFun.ins().upDataWillBoss(e)},e.prototype.createBoss=function(){},e.prototype.doWildBossResult=function(t){var i=t.readBoolean();if(i)for(var n=t.readShort(),s=0;n>s;s++){var o=new RewardData;o.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,o)}var a=function(){this.sendGetAward(),GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(a,this),DropHelp.start()},e.prototype.postCreateDrop=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return DropHelp.getItemCount()<5?(DropHelp.addDrop(t),!1):t},e.prototype.sendResult=function(t){var e=this.getBytes(5);e.writeBoolean(t),this.sendToServer(e)},e.prototype.sendGetAward=function(){this.sendBaseProto(6)},e.prototype.getEncounterModel=function(t){return this.encounterModel[t]},e.prototype.clearEncounterModel=function(){this.encounterModel.length=0},e.prototype.sendCleanRedName=function(){this.sendBaseProto(8)},e.prototype.doAddWildPlayer=function(t){var e=new WildPlayerData;e.index=t.readInt();var i=t.readShort(),n=t.readShort();t.readShort(),t.readShort();e.actionType=t.readByte(),e.attackEnable=0!=t.readByte(),e.killNum=t.readInt(),e.backX=t.readShort(),e.backY=t.readShort();for(var s,o=t.readString(),a=t.readShort(),r=0;a>r;r++){var l=new Role;l.parser(t),l.x=i,l.y=n,l.name=o,l.type=EntityType.Role,l.killNum=0,GameLogic.ins().createEntityByModel(l,Team.Faker),0==r&&(s=l.handle),l.masterHandle=s}e.fireRing=new OtherFireRingData,e.fireRing.parser(t),this.wildPersonList[s]=e},e.prototype.canRunAwary=function(t){var e=this.wildPersonList[t];return e.backCount--,0==e.backCount},e.prototype.RunAwary=function(t){this.wildPersonList[t];delete this.wildPersonList[t]},e.prototype.sendWildPeopleResult=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doWildPlayerResult=function(t){for(var i,n=(t.readInt(),t.readInt()),s=[],o=t.readShort(),a=0;o>a;a++)i=new RewardData,i.parser(t),e.ins().postCreateDrop(DropHelp.tempDropPoint.x,DropHelp.tempDropPoint.y,i),s.push(i);if(n){var r=function(){this.sendGetWildPeopleReward(),GameLogic.ins().createGuanqiaMonster()};DropHelp.addCompleteFunc(r,this),DropHelp.start()}else Timer.start(800,1,function(){ResultManager.ins().create(GameMap.fbType,n,s,"",!1),GameLogic.ins().createGuanqiaMonster(),e.ins().wildPersonList={}},this)},e.prototype.sendCleanWildPeople=function(t){var e=this.getBytes(10);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetWildPeopleReward=function(){this.sendBaseProto(11)},e.prototype.doRedNameResult=function(t){TipsCT.ins().showTips("PK值减少"+GlobalConfig.SkirmishBaseConfig.subPkval+"点")},e.prototype.checkIsEncounter=function(t,e){var i;if(i=EncounterFight.ins().isRevenge?this.revengeData[t-100]:this.encounterModel[t],!i)return!1;for(var n=i.subRole,s=0;s<n.length;s++){var o=n[s];if(o&&o.handle==e.handle)return!0}return!1},__decorate([post()],e.prototype,"onEnemyData",null),__decorate([post()],e.prototype,"onTreasureData",null),__decorate([post()],e.prototype,"onTreasureUpdate",null),__decorate([post()],e.prototype,"postFightResult",null),__decorate([post()],e.prototype,"postEncounterDataChange",null),__decorate([post()],e.prototype,"postDataUpdate",null),__decorate([post()],e.prototype,"postZaoYuRecord",null),__decorate([post()],e.prototype,"postCreateDrop",null),e}(BaseSystem);__reflect(Encounter.prototype,"Encounter"),System.Encounter=function(){return Encounter.ins()},window.Encounter=Encounter;var EncounterFight=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.aiList={},e.encounterList={},e.willEntityFightTeam=Team.Monster,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(t){var e=this;if(Encounter.ins().isEncounter()||EntityManager.ins().getTeamCount(Team.WillBoss)>0)return void TipsCT.ins().showTips("|C:0xf3311e&T:正在挑战附近的人|");if(!FbCT.ins().checkInFB2()&&(this.isRevenge=t>=100,console.log("开始战斗 ",t," isRevenge",this.isRevenge),Encounter.ins().encounterModel[t]||Encounter.ins().revengeData[t-100])){this.encounterIndex=t,this.rolePositions={},this.removeAllEncounter(),RoleAI.ins().stop(),DropHelp.clearDrop(),SkillCT.ins().setHejiCD(6e3),HejiUseMgr.ins().register(this),this.addCheckResult();for(var i=EntityManager.ins().getEntityByTeam(Team.My),n=0,s=i;n<s.length;n++){var o=s[n];if(o.stopMove(),o.playAction(EntityAction.STAND),o instanceof CharRole){this.rolePositions[o.infoModel.handle]={x:o.x,y:o.y,dir:o.dir};var a=new MovieClip;a.playFile(RES_DIR_SKILLEFF+"208",1),o.addChild(a),o.playAction(EntityAction.ATTACK)}else EntityManager.ins().removeByHandle(o.infoModel.handle)}Timer.start(800,1,function(){DropHelp.clearDrop(),e.addRole()},this),this.clearOldAI(),this.createEncounterAndMonster(),SoundUtil.play(SoundEnum.SCENE)}},e.prototype.addCheckResult=function(){Timer.start(1e3,0,this.checkResult,this)},e.prototype.checkResult=function(){Encounter.ins().isFindDrop||(0==EntityManager.ins().getTeamCount(Team.My)||0==EntityManager.ins().getTeamCount(Team.WillEntity))&&(0==EntityManager.ins().getTeamCount(Team.WillEntity)?this.sendFightResult(1):this.sendFightResult(0))},e.prototype.sendFightResult=function(t){t?Encounter.ins().sendFightResult(t):Timer.start(2e3,1,function(){Encounter.ins().sendFightResult(t)},this),Encounter.ins().postFightResult(t),Timer.stop(this.checkResult,this)},e.prototype.win=function(){for(var t=this,e=EntityManager.ins().getEntityByTeam(Team.My),i=0,n=e;i<n.length;i++){var s=n[i];if(s.stopMove(),s instanceof CharRole){var o=new MovieClip;o.playFile(RES_DIR_SKILLEFF+"208",1),s.addChild(o),s.playAction(EntityAction.ATTACK)}else EntityManager.ins().removeByHandle(s.infoModel.handle)}SoundUtil.play(SoundEnum.SCENE),Timer.start(800,1,function(){for(var e=EntityManager.ins().getEntityByTeam(Team.My),i=0,n=e;i<n.length;i++){var s=n[i];EntityManager.ins().removeByHandle(s.infoModel.handle)}t.stop(),t.fightEnd(),GameMap.sceneInMain()&&(t.resetPos(),RoleAI.ins().start())},this)},e.prototype.lose=function(){SoundUtil.play(SoundEnum.SCENE),this.stop(),this.fightEnd()},e.prototype.fightEnd=function(){EncounterModel.redName<GlobalConfig.SkirmishBaseConfig.maxPkval&&Encounter.ins().getEncounterLength()&&ViewManager.ins().open(LadderWin)},e.prototype.stop=function(){if(void 0!=this.encounterIndex){HejiUseMgr.ins().unregister(this),Timer.stopAll(this),EntityManager.ins().resetRole(),this.encounterIndex=void 0,this.willEntityFightTeam=Team.Monster,this.removeAllEncounter();for(var t in this.aiList){var e=EntityManager.ins().getEntityByHandle(t);e&&e.AI_STATE!=AI_State.Die&&RoleAI.ins().add(e)}this.aiList={}}},e.prototype.resetPos=function(){var t=EntityManager.ins().getEntityByTeam(Team.My);for(var e in t){var i=t[e],n=this.rolePositions[i.infoModel.handle];n&&(i.x=n.x,i.y=n.y);var s=new MovieClip;s.playFile(RES_DIR_SKILLEFF+"208",1),i.addChild(s)}this.rolePositions={}},e.prototype.removeAllEncounter=function(){for(var t in this.encounterList)EntityManager.ins().removeByHandle(t),delete this.encounterList[t]},e.prototype.addRole=function(){for(var t=EntityManager.ins().getEntityByTeam(Team.My),e=0,i=t;e<i.length;e++){var n=i[e];EntityManager.ins().removeByHandle(n.infoModel.handle)}EntityManager.ins().resetRole();var s=EntityManager.ins().getJobMainRole(0),o=this.getRolePos();s.x=o[0]*GameMap.CELL_SIZE,s.y=o[1]*GameMap.CELL_SIZE;var a=EntityManager.ins().screeningTargetByPos(s);if(a[0])s.dir=DirUtil.get8DirBy2Point(s,a[0]);else{var r=this.getEncounterModel();if(r){var l=r.subRole.length;Assert(!1,"遭遇战找不到敌人，实际遭遇战数据人数："+l)}}var h=EntityManager.ins().getMyOtherRolePos(s);t=EntityManager.ins().getEntityByTeam(Team.My);for(var u in t){if(t[u].playAction(EntityAction.STAND),RoleAI.ins().add(t[u]),t[u]!=s){var p=t[u].infoModel.handle;t[u].dir=s.dir,t[u].x=Math.floor(h[p].x),t[u].y=Math.floor(h[p].y)}var c=new MovieClip;c.playFile(RES_DIR_SKILLEFF+"208",1),t[u].addChild(c)}},e.prototype.getRoles=function(){var t=this.getEncounterModel();return t&&t.subRole},e.prototype.getSkillLvl=function(){var t=this.getEncounterModel();return t&&t.hejiLvl||0},e.prototype.getIsWeiShe=function(t){var e=this.getEncounterModel();return e?t?Actor.weiWang>e.weiWang:Actor.weiWang<e.weiWang:!1},e.prototype.getWeiSheHurt=function(t){if(!this.getIsWeiShe(t))return 0;var e=Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG),i="";if(t)i=Actor.myName;else{var n=this.getEncounterModel();i=n.subRole[0].name}var s=0;if(e)for(var o=0;3>o;o++){var a=e.getDataList(o);if(a&&a.player==i){s=a.pos;break}}return GlobalConfig.PrestigeBase.rankDeterDam[s-1]||GlobalConfig.PrestigeBase.normalDeterDam},e.prototype.getRolePos=function(){var t=GlobalConfig.SkirmishBaseConfig.range;return GameMap.getPosRange(this.zyRolePos[0],this.zyRolePos[1],t)},e.prototype.clearOldAI=function(){this.aiList=RoleAI.ins().getAIList(),RoleAI.ins().clearAIList()},e.prototype.createEncounterAndMonster=function(){var t=FbCT.ins().zyPos,e=Math.floor(Math.random()*t.length),i=t[e],n=i[0];this.zyRolePos=n;var s=FbCT.ins().waveMonsterId[0],o=i[1];Assert(o,"关卡第"+FbCT.ins().guanqiaID+"关遭遇战怪物出生点配错")&&(o=[]);for(var a=0;a<o.length;a++){var r=FbCT.ins().createMonster(s);r.x=o[a][0]*GameMap.CELL_SIZE,r.y=o[a][1]*GameMap.CELL_SIZE;var l=GameLogic.ins().createEntityByModel(r);l.AI_STATE=AI_State.Patrol,this.encounterList[l.infoModel.handle]=l}for(var h=this.getEncounterModel(),u=h.subRole.length,a=0;u>a;a++){var p=h.subRole[a];if(p){p.setAtt(AttributeType.atHp,p.getAtt(AttributeType.atMaxHp)),p.setAtt(AttributeType.atMp,p.getAtt(AttributeType.atMaxMp)),p.type=EntityType.Role,p.x=n[0]*GameMap.CELL_SIZE+Math.floor(40*a*Math.random()),p.y=n[1]*GameMap.CELL_SIZE+Math.floor(40*a*Math.random());var c=GameLogic.ins().createEntityByModel(p,Team.WillEntity);c.AI_STATE=AI_State.Stand,c.updateNeiGong(),this.encounterList[p.handle]=c}}RoleAI.ins().start()},e.prototype.getEncounterModel=function(){return this.isRevenge?Encounter.ins().revengeData[this.encounterIndex-100]:Encounter.ins().encounterModel[this.encounterIndex]},e}(BaseClass);__reflect(EncounterFight.prototype,"EncounterFight",["IHejiUse"]),System.EncounterFight=function(){return EncounterFight.ins()},window.EncounterFight=EncounterFight;var EncounterModel=function(){function t(t){this.subRole=[],this.hejiLvl=0,this.weiWang=0,this.name=t}return t.prototype.parser=function(t){this.index=t.readInt(),this.lv=t.readShort(),this.zsLv=t.readShort(),this.name=t.readString(),this.subRole=[];for(var e=t.readShort(),i=0;e>i;i++){var n=this.subRole[i]=new Role;n.parser(t),n.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData,this.fireRing.parser(t),this.firstData=0!=t.readByte(),this.hejiLvl=t.readInt(),this.weiWang=t.readInt(),this.treasureId=t.readInt()},t.redName=0,t}();__reflect(EncounterModel.prototype,"EncounterModel"),window.EncounterModel=EncounterModel;var EncounterTreasureFight=function(t){function e(){var e=t.call(this)||this;return e.isFighting=0,e.range=4,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.start=function(){if(console.log("EncounterTreasureFight start!!"),this.isFighting)return void console.log("isFighting");this.isFighting=1,this.handles=[],this._data=this.revengeTarget;var t=this._data,e=EntityManager.ins().getAllEntity(),i=SubRoles.lookAtTar;for(var n in e){var s=e[n].infoModel;s&&(0==t.type&&s.type==EntityType.Mine&&s.actorID==t.actorID||e[n]!=i&&(e[n].visible=!1))}this.setShowUI(!1),SkillCT.ins().setHejiCD(6e3),this.enemyPoints=this.getEnemyPoint(),this.startPos={x:i.x,y:i.y};for(var o=DirUtil.get8DirBy2Point(this.startPos,{x:GameMap.grip2Point(this.enemyPoints[0][0]),y:GameMap.grip2Point(this.enemyPoints[0][1])}),a=0;a<SubRoles.ins().subRolesLen;a++){var r=EntityManager.ins().getJobMainRole(a);if(!r)break;if(0==a)r.x=this.startPos.x,r.y=this.startPos.y;else{var l=GameMap.getPosRangeRandom(this.startPos.x,this.startPos.y,DirUtil.dirOpposit(o),a);r.x=GameMap.grip2Point(l[0]),r.y=GameMap.grip2Point(l[1])}r.dir=o,r.visible=!0,r.AI_STATE=AI_State.Stand,this.playTransferEffect(r),this.handles.push(r.infoModel.handle),RoleAI.ins().add(r)}},e.prototype.stop=function(){if(this.isFighting){this.isFighting=0,this._model=null,HejiUseMgr.ins().unregister(this),Timer.stopAll(this);var t=EntityManager.ins().getAllEntity();for(var e in t)t[e].infoModel&&t[e].infoModel.type!=EntityType.Monster&&(t[e].visible=!0);for(var i=0;i<this.handles.length;i++){var e=this.handles[i];EntityManager.ins().removeByHandle(e)}this.resetRole(),this.setShowUI(!0),RoleAI.ins().stop(),RoleAI.ins().clearAIList(),GameMap.sceneInMine()&&Mine.ins().finishedData&&ViewManager.ins().open(MineRobWin,Mine.ins().finishedData)}},e.prototype.resetRole=function(){MineData.ins().resetRole();var t=SubRoles.ins().getSubRoleByIndex(0),e=EntityManager.ins().getEntityByHandle(t.handle);e.x=this.startPos.x,e.y=this.startPos.y,e.AI_STATE=AI_State.Stand},e.prototype.setShowUI=function(t){GameMap.sceneInMine()&&(MineData.ins().showTransfer(t),Mine.ins().postMineFightState(t?1:0))},e.prototype.getRoles=function(){return this._model?this._model.subRole:null},e.prototype.getSkillLvl=function(){return this._model?this._model.hejiLvl:0},e.prototype.playTransferEffect=function(t){var e=new MovieClip;e.playFile(RES_DIR_SKILLEFF+"208",1),t.addChild(e),t.playAction(EntityAction.ATTACK)},e.prototype.getEnemyPoint=function(){for(var t=SubRoles.lookAtTar,e=GameMap.point2Grip(t.x),i=GameMap.point2Grip(t.y),n=[],s=0,o=0,a=Math.random()>.5,r=0;8>r;r++){for(var l=a?r:7-r,h=this.range;h<this.range+3;h++){var u=GameMap.getPosRangeByDir(e,i,l,h);u[2]&&(n[l]=n[l]||[],n[l].push(u))}if(n[l]&&n[l].length>=3)return n[l]}for(var r=0;r<n.length;r++)n[r]&&n[r].length>o&&(o=n[r].length,s=r);return n[s]},e}(BaseClass);__reflect(EncounterTreasureFight.prototype,"EncounterTreasureFight",["IHejiUse"]),window.EncounterTreasureFight=EncounterTreasureFight;var TreasureTips=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"view",{get:function(){return this._view&&this._view.parent||(ViewManager.ins().open(EncounterTreasureTipsView),this._view=ViewManager.ins().getView(EncounterTreasureTipsView)),this._view},enumerable:!0,configurable:!0}),e.prototype.showDetail=function(t){},e.prototype.showDrop=function(t){console.log(t),this.view.showDrop(t)},e}(BaseClass);__reflect(TreasureTips.prototype,"TreasureTips"),window.TreasureTips=TreasureTips;
var EncounterTreasureData=function(t){function e(){var e=t.call(this)||this;return e.isInit=!0,e.treasureGot=0,e.robLogList=[],e.systemMsg=[],e.taskData=[],e.treasureData=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.parse=function(t){this.treasureData=[],this.robLogList=[],this.systemMsg=[],this.treasureGot=t.readByte();for(var e=t.readByte(),i=0;e>i;i++){var n=new TreasureData;n.id=t.readInt(),n.countDown=t.readInt(),this.treasureData.push(n)}for(var s=t.readByte(),i=0;s>i;i++){var n=new TreasureRobListDataItem;n.parse(t),this.robLogList.push(n)}for(var o=t.readByte(),i=0;o>i;i++){var n=new TreasureSystemMsgData;n.msg=t.readString(),this.systemMsg.push(n)}return[this.treasureData,this.robLogList,this.systemMsg]},e.prototype.parseTaskData=function(t){var e=t.readByte();this.taskData=[];for(var i=0;e>i;i++){var n=new TreasureTaskData;n.taskLine=t.readByte(),n.taskId=t.readInt(),n.taskVar=t.readInt(),n.taskStat=t.readInt(),this.taskData.push(n)}return this.taskData},e.prototype.updateTreasureData=function(t){var e=t.readByte(),i=t.readInt(),n=t.readInt(),s=t.readByte();switch(e){case 0:this.treasureData.forEach(function(t,e){e==s-1&&(t.countDown=n)});break;case 1:var o=new TreasureData;o.id=i,o.countDown=n,this.treasureData.push(o),GlobalConfig.SkirmishTreasureConfig[o.id].quality>1&&TipsCT.ins().showTreasureTips(o);break;case 2:var a=[];this.treasureData.forEach(function(t,e){e!=s-1&&a.push(t)}),this.treasureData=a}return[this.treasureData,this.robLogList,this.systemMsg]},e.prototype.hasTimeEndTreasure=function(){var t=this.treasureData[0],e=!1,i=DateUtils.formatServerTime((new Date).getTime());if(t){var n=t.countDown-i;0>=n&&(e=!0)}return e},e}(BaseClass);__reflect(EncounterTreasureData.prototype,"EncounterTreasureData"),window.EncounterTreasureData=EncounterTreasureData;var TreasureData=function(){function t(){}return t}();__reflect(TreasureData.prototype,"TreasureData"),window.TreasureData=TreasureData;var TreasureEnemyModel=function(){function t(){this.subRole=[],this.hejiLvl=0,this.weiWang=0}return t.prototype.parser=function(t){this.logicId=t.readByte(),this.lv=t.readShort(),this.zsLv=t.readShort(),this.name=t.readString();for(var e=t.readShort(),i=0;e>i;i++){var n=this.subRole[i]=new Role;n.parser(t),n.name=this.name}this.fireRing=this.fireRing||new OtherFireRingData,this.fireRing.parser(t),this.hejiLvl=t.readInt(),this.weiWang=t.readInt(),console.log(this)},t.prototype.getJobRoles=function(){var t=[].concat(this.subRole);return t.sort(function(t,e){return t.job<e.job?-1:1}),t},t}();__reflect(TreasureEnemyModel.prototype,"TreasureEnemyModel"),window.TreasureEnemyModel=TreasureEnemyModel;var TreasureRobListDataItem=function(){function t(){}return t.prototype.parse=function(t){this.index=t.readUnsignedShort(),this.time=t.readInt(),this.treasureId=t.readInt(),this.logType=t.readUnsignedByte(),this.doerId=t.readInt(),this.doerName=t.readString(),this.toId=t.readInt(),this.toName=t.readString(),this.isWin=t.readUnsignedByte()},t}();__reflect(TreasureRobListDataItem.prototype,"TreasureRobListDataItem"),window.TreasureRobListDataItem=TreasureRobListDataItem;var TreasureSystemMsgData=function(){function t(){}return t}();__reflect(TreasureSystemMsgData.prototype,"TreasureSystemMsgData"),window.TreasureSystemMsgData=TreasureSystemMsgData;var TreasureTaskData=function(){function t(){}return t}();__reflect(TreasureTaskData.prototype,"TreasureTaskData"),window.TreasureTaskData=TreasureTaskData;var WildPlayerData=function(){function t(){}return t}();__reflect(WildPlayerData.prototype,"WildPlayerData"),window.WildPlayerData=WildPlayerData;var BuyRedNameWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuQueSkin",e.horizontalCenter=0,e.verticalCenter=0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnBuy,this.onTap),this.addTouchEvent(this.btnClose,this.onTap),this.updateText()},e.prototype.updateText=function(){this.pkNow.text=""+EncounterModel.redName,this.ybNum.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost,this.pkValue.text=""+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)},e.prototype.close=function(){this.removeTouchEvent(this.btnBuy,this.onTap),this.removeTouchEvent(this.btnClose,this.onTap)},e.prototype.onTap=function(t){switch(t.target){case this.btnBuy:if(!(Actor.yb>=(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)*GlobalConfig.SkirmishBaseConfig.subPkvalCost)){TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this);break}Encounter.ins().sendCleanRedName(),Encounter.ins().buyAndFight=!0}ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(BuyRedNameWin.prototype,"BuyRedNameWin"),ViewManager.ins().reg(BuyRedNameWin,LayerManager.UI_Popup),window.BuyRedNameWin=BuyRedNameWin;var EncounterInfoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curIndex=-1,e.treasureMaxCount=3,e.timerSet=!1,e.treasureInited=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.myFace.source="head_"+SubRoles.ins().getSubRoleByIndex(0).job+SubRoles.ins().getSubRoleByIndex(0).sex,this.list.itemRenderer=EncounterInfoItem,this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.hunshiImg.source=RewardData.getCurrencyRes(MoneyConst.soul),this.jinbiImg.source=RewardData.getCurrencyRes(MoneyConst.gold),this.rankSearch.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0xFB9409&T:查看排名|")},e.prototype.addDisplay=function(){this.mibaoskin.visible=!1,this.labelRed.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0x35e62d&T:立即挑战|"),this.selfName.text=Actor.myName,Encounter.ins().sendInquireRecord(),Encounter.ins().sendInquirePrestige(),this.setData(),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),this.addTouchEvent(this.treasureBtn,this.showTreasure),this.observe(Encounter.ins().postEncounterDataChange,this.setData),this.observe(Encounter.ins().postDataUpdate,this.updatePrestigeRank),this.observe(Encounter.ins().postDataUpdate,this.updateDailySettlement),this.observe(Encounter.ins().onTreasureData,this.checkTreasureRed),this.observe(Encounter.ins().onTreasureUpdate,this.checkTreasureRed),EncounterTreasureData.ins().taskData[0].taskId==Object.keys(GlobalConfig.DailyLineConfig).length&&2==EncounterTreasureData.ins().taskData[0].taskStat?(this.missionDoneLabel.visible=!0,this.missionLabel.visible=!1):(this.missionDoneLabel.visible=!1,this.missionLabel.visible=!0),this.checkTreasureRed()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.showTreasure=function(){EncounterTreasureData.ins().taskData[0].taskId==Object.keys(GlobalConfig.DailyLineConfig).length&&2==EncounterTreasureData.ins().taskData[0].taskStat?(ViewManager.ins().open(EncounterTreasureWin),Encounter.ins().viewTreasure()):ViewManager.ins().open(EncounterTreasureMissionWin,this)},e.prototype.initTreasure=function(){this.treasureInited||(this.observe(Encounter.ins().onTreasureData,this.updateView),this.observe(Encounter.ins().onTreasureUpdate,this.updateView),this.observe(Encounter.ins().onEnemyData,this.enterFight),this.addTouchEvent(this.openNow,this.quickOpen),this.openNow.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0x00ff00&T:立即开启|")),this.treasureDatas=EncounterTreasureData.ins().treasureData,this.robLogList.itemRenderer=EncounterTreasureLogItemRender,this.msgList.itemRenderer=EncounterTreasureSystemMsgRender},e.prototype.checkTreasureRed=function(){EncounterTreasureData.ins().taskData[0].taskId==Object.keys(GlobalConfig.DailyLineConfig).length&&2==EncounterTreasureData.ins().taskData[0].taskStat?this.treasureRed.visible=EncounterTreasureData.ins().hasTimeEndTreasure():this.treasureRed.visible=2!=EncounterTreasureData.ins().taskData[0].taskStat},e.prototype.updatePrestigeRank=function(t){var e=t[0],i=t[1];this.dayPrestige.text=e+"",0==i?this.rank.textFlow=TextFlowMaker.generateTextFlow1("未上榜"):this.rank.textFlow=TextFlowMaker.generateTextFlow1(i+"名")},e.prototype.updateDailySettlement=function(t){var e=t[1],i="0",n="0";if(0==e)this.hunshiLabel.text=i,this.jinbiLabel.text=n;else{var s=GameServer.serverOpenDay+1;for(var o in GlobalConfig.SkirmishRankConfig){var a=GlobalConfig.SkirmishRankConfig[o];if(e>=a.minRank&&e<=a.maxRank){var r=1;for(var l in a.rewards)s>=+l&&(r=+l);var h=a.rewards[r];return i=h[0].count>=1e4?Math.floor(h[0].count/1e4)+"万":h[0].count.toString(),n=h[1].count>=1e4?Math.floor(h[1].count/1e4)+"万":h[1].count.toString(),this.hunshiLabel.text=i,void(this.jinbiLabel.text=n)}}}},e.prototype.setData=function(){var t=[];this.curIndex>-1&&Encounter.ins().buyAndFight&&this.sendFight(this.curIndex),Encounter.ins().buyAndFight=!1,this.curIndex=-1,this.labelRedPoint.text=""+EncounterModel.redName,this.labelRedPoint.textColor=EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?16711680:3532333,this.labelRed.visible=!1,EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval?(this.time.text="("+(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1)+"分钟后可挑战)",this.time.textColor=16711680):this.removeTime();for(var e=0;e<Encounter.ins().encounterModel.length;e++){var i=Encounter.ins().getEncounterModel(e);if(i){if(i.firstData){t=[i];break}t.push(i)}}0==t.length&&t.push(null),this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.addTime=function(){this.removeTime(),this.timeGap=60*(EncounterModel.redName-GlobalConfig.SkirmishBaseConfig.maxPkval+1),this.time.text="("+DateUtils.getFormatBySecond(this.timeGap,3)+"后可挑战)",Timer.start(1e3,0,this.timeHandler,this)},e.prototype.timeHandler=function(){this.timeGap>0?(this.timeGap-=1,this.time.text="("+DateUtils.getFormatBySecond(this.timeGap,3)+"后可挑战)"):this.time.text=""},e.prototype.removeTime=function(){this.time.text="",Timer.stop(this.timeHandler,this)},e.prototype.onTap=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof EncounterInfoItem){if(CityCC.ins().isCity)return void TipsCT.ins().showTips("主城不能击杀附近的人,请先传送到野外");if("挑 战"==t.target.label||"挑战中"==t.target.label){if(!KfArenaSys.ins().checkIsMatching())return;if(FbCT.ins().checkInFB())return;var e=t.target.parent.data.index;if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);if(EncounterModel.redName>=GlobalConfig.SkirmishBaseConfig.maxPkval)return this.curIndex=e,void ViewManager.ins().open(BuyRedNameWin);this.sendFight(e)}else"寻 敌"==t.target.label&&ViewManager.ins().open(FindEnemyWin)}else if(t.target.parent instanceof EncounterTreasureLogItemRender){if(CityCC.ins().isCity)return void TipsCT.ins().showTips("主城不能击杀附近的人,请先传送到野外");if(!KfArenaSys.ins().checkIsMatching())return;if(FbCT.ins().checkInFB())return}else switch(t.target){case this.rankBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.recordBtn:ViewManager.ins().open(ZaoYuRecordWin);break;case this.labelRed:EncounterModel.redName>0?ViewManager.ins().open(BuyRedNameWin):TipsCT.ins().showTips("没有可消除的PK值");break;case this.rankSearch:ViewManager.ins().open(RankingWin,RankDataType.TYPE_SKIRMISH);break;case this.rewardBtn:ViewManager.ins().open(EncounterRewardWin)}},e.prototype.sendFight=function(t){FbCT.ins().checkInFB()||(ViewManager.ins().close(BagFullTipsWin),ViewManager.ins().closeTopLevel(),Timer.start(100,1,function(){EncounterFight.ins().start(t)},this))},e.prototype.updateView=function(t){var e=this;t&&(this.treasureDatas=t[0]),this.timerSet=!1;for(var i=0;i<this.treasureMaxCount;i++)this["item"+i].visible=!1,this["unlockLabel"+i].visible=!1;if(this.treasureDatas.length>=this.treasureMaxCount?(this.fullTips.visible=!0,this.countDown.visible=!1):this.fullTips.visible=!1,0!=this.treasureDatas.length&&this.treasureDatas||(this.countDown.visible=!1,this.openNow.visible=!1),this.treasureDatas.forEach(function(t,i){var n=e["item"+i],s=e["unlockLabel"+i],o=GlobalConfig.SkirmishTreasureConfig[t.id];n.visible=!0,n.setItemImg(o.icon+"_png"),n.setImgBg(o.quality),n.isShowJob(!1),n.showNum(!1),n.showName=!0,n.setName(o.name),i>0&&(s.visible=!0)}),this.treasureDatas.length){this.currentTreasure=this.treasureDatas[0];var n=this.getUnlockTime();this.gotLabel.visible=!1,this.emptyLabel.visible=!1,n>0?(this.countDown.visible=!0,this.openNow.visible=!0,this.setTimer()):(this.openNow.visible=!0,this.unlockLabel0.visible=!0)}else this.countDown.visible=!1,this.openNow.visible=!1,EncounterTreasureData.ins().treasureGot>=GlobalConfig.SkirmishBaseConfig.treasureDailyMax?this.gotLabel.visible=!0:this.emptyLabel.visible=!0;this.robLogList.dataProvider=new eui.ArrayCollection(EncounterTreasureData.ins().robLogList||[]),this.msgList.dataProvider=new eui.ArrayCollection(EncounterTreasureData.ins().systemMsg||[])},e.prototype.getTreasuerSysMsg=function(){var t=EncounterTreasureData.ins().robLogList||[],e=[],i=GlobalConfig.SkirmishTreasureConfig;return t.forEach(function(t){i[t.treasureId].quality>2&&4==t.logType&&e.push(t)}),e},e.prototype.setTimer=function(){if(!this.timerSet){this.timerSet=!0;var t=this.getUnlockTime();if(0>=t)return void(this.unlockLabel0.visible=!0);Timer.stop(this.doCountDown,this),Timer.start(1e3,t,this.doCountDown,this)}},e.prototype.doCountDown=function(){var t=this.getUnlockTime();0>=t&&(Timer.stop(this.doCountDown,this),this.countDown.visible=!1,this.unlockLabel0.visible=!0),this.countDown.text=DateUtils.getFormatTimeByStyle(t,DateUtils.STYLE_3)},e.prototype.getUnlockTime=function(){var t=DateUtils.formatServerTime(GameServer.serverTime),e=this.currentTreasure.countDown-t;return e},e.prototype.quickOpen=function(){var t=this.getUnlockTime();if(0>=t)Encounter.ins().openTreasure(0);else{var e=Math.ceil(t/60)*GlobalConfig.SkirmishBaseConfig.treasureOpenYb,i=WarnWin.show("是否花费"+e+"元宝快速打开秘宝？",function(){Encounter.ins().openTreasure(1)},this);i.setBtnLabel("确定","取消")}},e.prototype.enterFight=function(t){ViewManager.ins().closeTopLevel()},e}(BaseView);__reflect(EncounterInfoWin.prototype,"EncounterInfoWin"),window.EncounterInfoWin=EncounterInfoWin;var EncounterRewardRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoyurewardItemSkin",e.eList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.data.maxRank==this.data.minRank?this.rank.text="第"+this.data.minRank+"名":this.rank.text="第"+this.data.minRank+"名~第"+this.data.maxRank+"名";var t=GameServer.serverOpenDay+1,e=1;for(var i in this.data.rewards)t>=+i&&(e=+i);this.eList.dataProvider=new eui.ArrayCollection(this.data.rewards[e])},e}(BaseItemRender);__reflect(EncounterRewardRender.prototype,"EncounterRewardRender"),window.EncounterRewardRender=EncounterRewardRender;var EncounterRewardWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="Zaoyurewardskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list0.itemRenderer=EncounterRewardRender,this.rewardList=[];for(var t in GlobalConfig.SkirmishRankConfig)this.rewardList.push(GlobalConfig.SkirmishRankConfig[t])},e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.setPanelInfo()},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e.prototype.setPanelInfo=function(){this.list0.dataProvider=new eui.ArrayCollection(this.rewardList);var t=Encounter.ins().encounterRank;0==t?this.myRankText.textFlow=TextFlowMaker.generateTextFlow1("我的当前排名：|C:0xFB9409&T:未上榜|"):this.myRankText.textFlow=TextFlowMaker.generateTextFlow1("我的当前排名：|C:0xFB9409&T:"+t+"名|")},e}(BaseEuiView);__reflect(EncounterRewardWin.prototype,"EncounterRewardWin"),ViewManager.ins().reg(EncounterRewardWin,LayerManager.UI_Main),window.EncounterRewardWin=EncounterRewardWin;var EncounterTreasure=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="zaoyuMibbaoskin"},e.prototype.open=function(){},e}(BaseEuiView);__reflect(EncounterTreasure.prototype,"EncounterTreasure"),window.EncounterTreasure=EncounterTreasure;var EncounterTreasureLogItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="zaoyuMibaoLogRenderSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t,e=GlobalConfig.SkirmishTreasureConfig[this.data.treasureId],i=ItemBase.QUALITY_COLOR[e.quality];this.revenge.visible=!1,this.time.text=DateUtils.formatFullTime(DateUtils.formatMiniDateTime(this.data.time));var n=this.data.doerId==Actor.actorID?"你":this.data.doerName;switch(this.data.logType){case 1:t="<font color = '#12b2ff'>"+this.data.toName+("</font>击败了<font color = '#12b2ff'>"+n+"</font>后,夺走了 <font color='")+i+"'>"+e.name+"</font>",1==this.data.isWin?this.revenge.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00FF00&T:已复仇|"):(this.revenge.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0xFF0000&T:复仇|"),this.addTouchEvent(this.revenge,this.toRevenge)),this.revenge.visible=!0;break;case 2:t="<font color = '#12b2ff'>"+n+("</font>击败了<font color = '#12b2ff'>"+this.data.toName+"</font>后,夺走了<font color='")+i+"'>"+e.name+"</font>";break;case 3:t="<font color = '#12b2ff'>"+n+("</font>打败了仇人<font color = '#12b2ff'>"+this.data.toName+",夺回了</font><font color='")+i+"'>"+e.name+"</font>";break;case 4:t="<font color = '#12b2ff'>"+n+("</font>击败<font color = '#12b2ff'>"+this.data.toName+"</font>后幸运地发现了<font color='")+i+"'>"+e.name+"</font>"}this.showText.textFlow=TextFlowMaker.generateTextFlow(t)},e.prototype.toRevenge=function(){Encounter.ins().revengeEnemy(this.data)},e.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],e}(BaseItemRender);__reflect(EncounterTreasureLogItemRender.prototype,"EncounterTreasureLogItemRender"),window.EncounterTreasureLogItemRender=EncounterTreasureLogItemRender;var EncounterTreasureMissionWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoyuMibaoTaskskin",e.horizontalCenter=0,e.verticalCenter=0,e.addTouchEvent(e.bgClose,e.close),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnGo,this["goto"]),this.addTouchEvent(this.btnDone,this.finish),this.observe(TaskCT.ins().onEncounterTaskData,this.updateView),this.encounterInfo=t[0],this.updateView(null)},e.prototype.updateView=function(t){var e=GlobalConfig.DailyLineConfig,i=t&&t[0]||EncounterTreasureData.ins().taskData[0];this.currentTaskData=i;var n=Object.keys(e).length;if(i.taskId==n&&2==i.taskStat)return ViewManager.ins().close(this),void this.encounterInfo.showTreasure();for(var s=1;n>=s;s++)e[s].id<i.taskId?this["mibao"+e[s].id].visible=!0:e[s].id==i.taskId&&2==i.taskStat&&(this["mibao"+e[s].id].visible=!0);1==i.taskStat&&(this.btnGo.visible=!1,this.btnDone.visible=!0),2==i.taskStat&&(this.btnGo.visible=!1,this.btnDone.visible=!1,this.doneLabel.visible=!0),this.currentTaskCfg=e[i.taskId],this.taskDesc.text=this.currentTaskCfg.name,this.taskProgress.text="("+i.taskVar+"/"+this.currentTaskCfg.target+")";var o=2==i.taskStat?i.taskId:i.taskId-1;this.taskTotalProgress.text="("+o+"/"+n+")"},e.prototype.startAnim=function(t){var e=this;return new Promise(function(i){var n=e["mibao"+t];n.alpha=0,n.visible=!0,egret.Tween.get(n).to({alpha:1},1e3).call(i)})},e.prototype["goto"]=function(){ViewManager.ins().open(this.currentTaskCfg.controlTarget[0],this.currentTaskCfg.controlTarget[1]),ViewManager.ins().close(this)},e.prototype.finish=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.startAnim(this.currentTaskData.taskId)];case 1:return t=e.sent(),TaskCT.ins().finishTreasureMission(this.currentTaskData.taskLine),[2]}})})},e.prototype.close=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(EncounterTreasureMissionWin.prototype,"EncounterTreasureMissionWin"),ViewManager.ins().reg(EncounterTreasureMissionWin,LayerManager.UI_Popup),window.EncounterTreasureMissionWin=EncounterTreasureMissionWin;var EncounterTreasureSystemMsgRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="zaoyuMibaoLogRenderSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.height=30;var t;this.revenge.visible=!1,this.time.visible=!1,t=this.data.msg,this.showText.textFlow=TextFlowMaker.generateTextFlow(t)},e.prototype.toRevenge=function(){EncounterTreasureFight.ins().revengeTarget=this.data,Encounter.ins().revengeEnemy(this.data.index),EncounterTreasureFight.ins().start()},e.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],e}(BaseItemRender);__reflect(EncounterTreasureSystemMsgRender.prototype,"EncounterTreasureSystemMsgRender"),window.EncounterTreasureSystemMsgRender=EncounterTreasureSystemMsgRender;var EncounterTreasureTipsView=function(t){function e(){var e=t.call(this)||this;return e.skinName="zaoyuMibaoTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.movieClip=new MovieClip,this.horizontalCenter=0,this.verticalCenter=0,this.addTouchEvent(this.effect,this.close),this.showDrop(t[0])},e.prototype.showDrop=function(t){var e=this;this.resetView(),this.data=t,this.effect.addChild(this.movieClip),this.movieClip.scaleX=1.5,this.movieClip.scaleY=1.5,this.movieClip.playFile(RES_DIR_EFF+"baoxiangkq",-1),this.data.forEach(function(t,i){var n=new ItemBase;n.x=100*i,n.data=t,n.alpha=0,e.itemsList.addChild(n)}),this.itemsList.width=100*t.length,this.itemsList.$children.forEach(function(t,i){Timer.start(300*i,1,function(e){egret.Tween.get(t).to({alpha:1},800).call(function(t){})},e)}),Timer.has(this.close,this)&&Timer.stop(this.close,this),Timer.start(2e3,1,this.close,this)},e.prototype.resetView=function(){var t=this;this.itemsList.width=0,this.itemsList.$children.forEach(function(e){t.itemsList.removeChild(e)})},e.prototype.close=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(EncounterTreasureTipsView.prototype,"EncounterTreasureTipsView"),ViewManager.ins().reg(EncounterTreasureTipsView,LayerManager.UI_Popup),window.EncounterTreasureTipsView=EncounterTreasureTipsView;var EncounterTreasureWin=function(t){function e(){var e=t.call(this)||this;return e.treasureMaxCount=3,e.timerSet=!1,e.treasureInited=!1,e.skinName="zaoyuMibaoskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.robLogList.itemRenderer=EncounterTreasureLogItemRender,this.msgList.itemRenderer=EncounterTreasureSystemMsgRender},e.prototype.open=function(){this.treasureDatas=EncounterTreasureData.ins().treasureData,this.addTouchEvent(this.openNow,this.quickOpen),this.observe(Encounter.ins().onTreasureUpdate,this.updateView),this.observe(Encounter.ins().onTreasureData,this.updateView),this.observe(Encounter.ins().onEnemyData,this.enterFight),this.addTouchEvent(this.openNow,this.quickOpen),this.openNow.textFlow=TextFlowMaker.generateTextFlow1("|U:&C:0x00ff00&T:立即开启|")},e.prototype.updateView=function(t){var e=this;t&&(this.treasureDatas=t[0]),this.timerSet=!1;for(var i=0;i<this.treasureMaxCount;i++)this["item"+i].visible=!1,this["unlockLabel"+i].visible=!1;if(this.treasureDatas.length>=this.treasureMaxCount?(this.fullTips.visible=!0,this.countDown.visible=!1):this.fullTips.visible=!1,0!=this.treasureDatas.length&&this.treasureDatas||(this.countDown.visible=!1,this.openNow.visible=!1),this.treasureDatas.forEach(function(t,i){var n=e["item"+i],s=e["unlockLabel"+i],o=GlobalConfig.SkirmishTreasureConfig[t.id];n.visible=!0,n.setItemImg(o.icon+"_png"),n.setImgBg(o.quality),n.isShowJob(!1),n.showNum(!1),n.showName=!0,n.setName(o.name),i>0&&(s.visible=!0)}),this.treasureDatas.length){this.currentTreasure=this.treasureDatas[0];var n=this.getUnlockTime();this.gotLabel.visible=!1,this.emptyLabel.visible=!1,n>0?(this.countDown.visible=!0,this.openNow.visible=!0,this.setTimer()):(this.openNow.visible=!0,this.unlockLabel0.visible=!0)}else this.countDown.visible=!1,this.openNow.visible=!1,EncounterTreasureData.ins().treasureGot>=GlobalConfig.SkirmishBaseConfig.treasureDailyMax?this.gotLabel.visible=!0:this.emptyLabel.visible=!0;this.robLogList.dataProvider=new eui.ArrayCollection(EncounterTreasureData.ins().robLogList.reverse()||[]),this.msgList.dataProvider=new eui.ArrayCollection(EncounterTreasureData.ins().systemMsg.reverse()||[])},e.prototype.getTreasuerSysMsg=function(){var t=EncounterTreasureData.ins().robLogList||[],e=[],i=GlobalConfig.SkirmishTreasureConfig;return t.forEach(function(t){i[t.treasureId].quality>2&&4==t.logType&&e.push(t)}),e},e.prototype.setTimer=function(){if(!this.timerSet){this.timerSet=!0;var t=this.getUnlockTime();if(0>=t)return void(this.unlockLabel0.visible=!0);Timer.stop(this.doCountDown,this),Timer.start(1e3,t,this.doCountDown,this)}},e.prototype.doCountDown=function(){var t=this.getUnlockTime();0>=t&&(Timer.stop(this.doCountDown,this),this.countDown.visible=!1,this.unlockLabel0.visible=!0),this.countDown.text=DateUtils.getFormatTimeByStyle(t,DateUtils.STYLE_3)},e.prototype.getUnlockTime=function(){var t=DateUtils.formatServerTime(GameServer.serverTime),e=this.currentTreasure.countDown-t;return e},e.prototype.quickOpen=function(){var t=this.getUnlockTime();if(0>=t)Encounter.ins().openTreasure(0);else{var e=Math.ceil(t/60)*GlobalConfig.SkirmishBaseConfig.treasureOpenYb,i=WarnWin.show("是否花费"+e+"元宝快速打开秘宝？",function(){Encounter.ins().openTreasure(1)},this);i.setBtnLabel("确定","取消")}},e.prototype.enterFight=function(t){ViewManager.ins().closeTopLevel()},e}(BaseEuiView);__reflect(EncounterTreasureWin.prototype,"EncounterTreasureWin"),ViewManager.ins().reg(EncounterTreasureWin,LayerManager.UI_Main),window.EncounterTreasureWin=EncounterTreasureWin;var FindEnemyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ZaoYuTip0Skin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.closeCB),this.addTouchEvent(this.cancel,this.closeCB),this.addTouchEvent(this.ok,this.buy),this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.closeCB),this.removeTouchEvent(this.cancel,this.closeCB),this.removeTouchEvent(this.ok,this.buy)},e.prototype.updateView=function(){this.yuanbao.text=GlobalConfig.SkirmishBaseConfig.refreshCost+"元宝",this.count.text="（本日已主动寻找"+EncounterModel.refreshTimes+"次对手）"},e.prototype.closeCB=function(t){ViewManager.ins().close(this)},e.prototype.buy=function(t){Actor.yb>=GlobalConfig.SkirmishBaseConfig.refreshCost?(Encounter.ins().sendRefresh(),Encounter.ins().postZaoYuRecord(),ViewManager.ins().close(this)):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(FindEnemyWin.prototype,"FindEnemyWin"),ViewManager.ins().reg(FindEnemyWin,LayerManager.UI_Main),window.FindEnemyWin=FindEnemyWin;var TreasureItemIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){t&&(this.itemIcon.imgIcon.source=t.icon+"_png",this.itemIcon.imgBg.source="quality"+t.quality+"_png",this.nameTxt.text=t.name)},e}(ItemBase);__reflect(TreasureItemIcon.prototype,"TreasureItemIcon"),window.TreasureItemIcon=TreasureItemIcon;var ZaoYuRecordItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuRecordInfoSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.time.text=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(t[0])/1e3,2),this.playerName.textFlow=(new egret.HtmlTextParser).parser('遭遇玩家：<font color="#3681FC">'+t[2]+"</font>"),this.exp.text=""+t[3],this.money.text=""+t[4],this.prestige.text=""+t[5],this.lingpo.text=t[6]||"0",t[1]?this.currentState="win":this.currentState="lose"},e}(BaseItemRender);__reflect(ZaoYuRecordItem.prototype,"ZaoYuRecordItem"),window.ZaoYuRecordItem=ZaoYuRecordItem;var ZaoYuRecordWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZaoYuRecordSkin",e.list.itemRenderer=ZaoYuRecordItem,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.observe(Encounter.ins().postZaoYuRecord,this.updateData),Encounter.ins().sendInquireRecord()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(t){function e(t,e){return Algorithm.sortDesc(t[0],e[0])}t&&(t.sort(e),this.list.dataProvider=new eui.ArrayCollection(t))},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ZaoYuRecordWin.prototype,"ZaoYuRecordWin"),ViewManager.ins().reg(ZaoYuRecordWin,LayerManager.UI_Main),window.ZaoYuRecordWin=ZaoYuRecordWin;var EntrustManager=function(t){function e(){var e=t.call(this)||this;return e.isStart=!1,e.taskDic={},e}return __extends(e,t),e.prototype.start=function(){this.isStart||(this.isStart=!0,this.observe(GameLogic.ins().syncMyPos,this.transferComplete))},e.prototype.stop=function(){this.taskDic={},this.removeObserve(),Timer.stopAll(this)},e.prototype.regEntrusTask=function(t,e,i,n){if(!n||!Assert(!this.taskDic[EntrustType.Transfer],"当前有委托传送任务，不能多线程或重复委托任务！ value="+e))switch(this.start(),t){case EntrustType.Transfer:this.transferTask(e,i)}},e.prototype.cancelEntrusTask=function(t){this.taskDic[t]=null,delete this.taskDic[t]},e.prototype.transferTask=function(t,e){this.taskDic[EntrustType.Transfer]={doFun:t,callobj:e}},e.prototype.transferComplete=function(){var t=this.taskDic[EntrustType.Transfer];t&&(t.doFun instanceof Function?(t.callobj?t.doFun.bind(t.callobj)():t.doFun(),this.cancelEntrusTask(EntrustType.Transfer)):!isNaN(this.taskDic[EntrustType.Transfer]))},e}(BaseSystem);__reflect(EntrustManager.prototype,"EntrustManager"),function(t){t.entrustManager=t.ins.bind(t)}(EntrustManager||(EntrustManager={}));var EntrustType;!function(t){t[t.Transfer=0]="Transfer"}(EntrustType||(EntrustType={})),window.EntrustType=EntrustType,window.EntrustManager=EntrustManager;var ExpGoldCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.ExpGold,e.regNetMsg(1,e.doRemainTimeAndIndex),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.doRemainTimeAndIndex=function(t){this.remainTime=t.readUnsignedInt(),this.index=t.readInt(),this.postExpUpdate()},e.prototype.postExpUpdate=function(){},e.prototype.sendBuyExp=function(){this.sendBaseProto(2)},Object.defineProperty(e.prototype,"remainTime",{get:function(){return this._remainTime},set:function(t){this._remainTime!=t&&(this._remainTime=t,Timer.stop(this.downTime,this),Timer.start(1e3,this._remainTime,this.downTime,this))},enumerable:!0,configurable:!0}),e.prototype.downTime=function(){this._remainTime-=1,this._remainTime<=0&&this.postExpUpdate()},e.prototype.getIndexNeedGold=function(){return GlobalConfig.RefinesystemExpConfig[this.index].yuanBao},e.prototype.checkIsOver=function(){return GlobalConfig.RefinesystemExpConfig[this.index]?!1:!0},e.prototype.checkIsCanPlay=function(){if(Actor.vip<3)return void TipsCT.ins().showTips("|C:0xf3311e&T:VIP3可炼制|");var t=GlobalConfig.RefinesystemExpConfig[this.index].yuanBao;return Actor.yb>=t?void e.ins().sendBuyExp():(TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),void ViewManager.ins().open(RechargeWin))},e.prototype.isOpenBtn=function(){return Actor.level>=60&&this.remainTime>0?!this.checkIsOver():!1},e.prototype.checkUpLevel=function(){var t=Actor.level,e=GlobalConfig.RefinesystemExpConfig[this.index].exp,i=GlobalConfig.ExpConfig[t].exp-Actor.exp;if(e>=i)for(++t,e-=i,t;150>t&&(i=GlobalConfig.ExpConfig[t].exp,!(0>e-i));t++)e-=i;return t},__decorate([post()],e.prototype,"postExpUpdate",null),e
}(BaseSystem);__reflect(ExpGoldCT.prototype,"ExpGoldCT"),System.ExpGoldCT=function(){return ExpGoldCT.ins()},window.ExpGoldCT=ExpGoldCT;var ExpGoldWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="exprefineSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.goUpBtn,this.onTap),this.observe(ExpGoldCT.ins().postExpUpdate,this.refreshShow),this.refreshShow()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.goUpBtn,this.onTap)},e.prototype.refreshShow=function(){if(ExpGoldCT.ins().checkIsOver())this.getAll.visible=!0,this.group.visible=!1;else{this.group.visible=!0,this.getAll.visible=!1,this.constImg.source="exprefine_json.explz_"+ExpGoldCT.ins().index;var t="可立即提升至<font color='#35e62d'>"+ExpGoldCT.ins().checkUpLevel()+"</font>级";this.depictLabel0.textFlow=(new egret.HtmlTextParser).parser(t);var e=GlobalConfig.RefinesystemExpConfig[ExpGoldCT.ins().index].yuanBao;Actor.yb>=e?this.goldConst.setText("<font color='#35e62d'>"+ExpGoldCT.ins().getIndexNeedGold()+"</font>"):this.goldConst.setText("<font color='#f3311e'>"+ExpGoldCT.ins().getIndexNeedGold()+"</font>");var i=ExpGoldCT.ins().remainTime;this.depictLabel.text="剩余时间："+DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.goUpBtn:ExpGoldCT.ins().checkIsCanPlay()}},e}(BaseEuiView);__reflect(ExpGoldWin.prototype,"ExpGoldWin"),ViewManager.ins().reg(ExpGoldWin,LayerManager.UI_Main),window.ExpGoldWin=ExpGoldWin;var ExtremeEquipModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectJob=0,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"descNames",{get:function(){return["霸业神刀","霸业头盔","霸业神甲","霸业项链","霸业手镯","霸业腰带","霸业戒指","霸业鞋子"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return[EquipPos.WEAPON,EquipPos.CLOTHES,EquipPos.Wrist,EquipPos.RING,EquipPos.SHOE,EquipPos.BRACELET,EquipPos.NECKLACE,EquipPos.HEAD]},enumerable:!0,configurable:!0}),e.prototype.getZhiZunLv=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),n=i.getEquipByIndex(e),s=n.item.configID;return s?n.soulLv:0},e.prototype.getZhiZunLvByRoleID=function(t,e){if(!t||e>EquipPos.SHOE)return 0;var i=t.getEquipByIndex(e),n=i.item.configID;return n?i.soulLv:0},e.prototype.isWear=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),n=i.getEquipByIndex(e),s=n.item.configID;return s?!0:!1},e.prototype.canOperate=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),n=i.getEquipByIndex(e),s=n.item.configID;if(s){var o=n.soulLv;if(o<this.getMaxZhiZunEquipLevel(ItemUtil.getSubType(n.item.itemConfig))){var a=GlobalConfig.ZhiZunEquipLevel[e][o+1],r=a.materialInfo.count,l=BagCT.ins().getBagGoodsCountById(0,a.materialInfo.id);return l>=r}}return!1},e.prototype.getRedPointByJob=function(t){for(var e=EquipPos.WEAPON;e<=EquipPos.SHOE;e++)if(this.canOperate(t,e))return!0;return!1},e.prototype.getRedPoint=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e),n=i.job;if(this.getRedPointByJob(n))return!0}return!1},e.prototype.getMaxZhiZunEquipLevel=function(t){var e=CommonUtils.getObjectLength(GlobalConfig.ZhiZunEquipLevel[t]);return e},e.prototype.getZhiZunSkills=function(t){for(var e=[EquipPos.WEAPON,EquipPos.CLOTHES],i=[],n=0,s=e;n<s.length;n++){var o=s[n],a=t.getEquipByIndex(o);if(a.item.configID){var r=a.soulLv;if(r>0){var l=GlobalConfig.ZhiZunEquipLevel[o][r];l.skillId&&i.push(new SkillData(l.skillId))}}}return i},e.prototype.getZhiZunSkill=function(t,e){var i=SubRoles.ins().getSubRoleByJob(t),n=i.getEquipByIndex(e),s=n.item.configID;if(s){var o=n.soulLv;if(o>0){var a=GlobalConfig.ZhiZunEquipLevel[e][o];return a.skillId}}return 0},e.prototype.getZhiZunLinkLv=function(t,e,i){var n=this.getLinkEquipPos(e);if(Assert(t,"函数getZhiZunLinkLv， roleIndex:"+t.index+",mainPos:"+e+",soullv:"+i))return 0;var s=t.getEquipByIndex(e),o=t.getEquipByIndex(n);return s&&o?Math.min(i,o.soulLv):0},e.prototype.getZhiZunLinkLvShow=function(t,e,i){var n=SubRoles.ins().getSubRoleByIndex(t),s=n.getEquipByIndex(e);if(s&&i){var o=GlobalConfig.ZhiZunEquipLevel[e][i];return o.soulLinkLevel}return 1},e.prototype.getLinkEquipPos=function(t){for(var e in GlobalConfig.ZhiZunLinkLevel)if(e==t.toString())for(var i in GlobalConfig.ZhiZunLinkLevel[e])return+i;return null},e.prototype.getZhiZunLinkLevelConfig=function(t,i,n){var s=t,o=i,a=e.ins().getZhiZunLv(o,s);a||(a=1);var r=e.ins().getLinkEquipPos(s);n&&(a+=1);var l=GlobalConfig.ZhiZunLinkLevel[s][r][a];return l},e.prototype.getZhiZunEquipLevelConfig=function(t,e,i){var n=t,s=e;s||(s=1),i&&(s+=1);var o=GlobalConfig.ZhiZunEquipLevel[n][s];return o},e.prototype.getSkillName=function(t){var e=GlobalConfig.ZhiZunEquipLevel[t][1];if(!e)return"";var i=GlobalConfig.SkillsConfig[e.skillId];return i?SkillUtil.getName(i):""},e.prototype.getSkillDesc=function(t){var e=GlobalConfig.ZhiZunEquipLevel[t][1];if(!e)return"";var i=GlobalConfig.SkillsConfig[e.skillId];return i?SkillUtil.getDesc(i):""},e}(BaseClass);__reflect(ExtremeEquipModel.prototype,"ExtremeEquipModel"),window.ExtremeEquipModel=ExtremeEquipModel;var ExtremeBuffTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodSkillTipSkin",e.currentState="initial",e.skillShow.visible=!1,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]&&(this.role=t[0]),this.addTouchEvent(this.bgClose,this.onClick),this.skillMc=new MovieClip,this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateUI=function(){this.validateNow(),this.skillName.text=GlobalConfig.ZhiZunSuitSkillConf.skillName,this.skill.addChild(this.skillMc),this.skillMc.x=250,this.skillMc.y=270,this.skillMc.playFile(RES_DIR_EFF+GlobalConfig.ZhiZunSuitSkillConf.skillEff,-1);var t=ItemBase.QUALITY_COLOR[1];this.curskillDesc0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:【"+GlobalConfig.ZhiZunSuitSkillConf.skillName+"】");var e="",i=0,n=ExtremeEquipModel.ins().positions.length;if(this.role)for(var s=0;n>s;s++){var o=0,a=this.role.getEquipByIndex(ExtremeEquipModel.ins().positions[s]),r=a.item.configID;r&&(o=a.soulLv),o>0&&i++}else for(var s=0;n>s;s++)ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,ExtremeEquipModel.ins().positions[s])>0&&i++;var l=GlobalConfig.ZhiZunSuitSkillConf.kitCount;e="("+i+"/"+l+")",this.curskillDesc2.text="收集一套霸者装备激活"+e,this.curskillDesc3.textColor=i>=l?t:11645079,this.curskillDesc3.text=GlobalConfig.ZhiZunSuitSkillConf.skilldesc},e.prototype.getColorDesc=function(t){var e="";switch(t){case 0:e="白色";break;case 1:e="绿色";break;case 2:e="紫色";break;case 3:e="橙色";break;case 4:e="红色"}return e&&(e="收集一套"+e+"心法残页激活"),e},e}(BaseEuiView);__reflect(ExtremeBuffTips.prototype,"ExtremeBuffTips"),ViewManager.ins().reg(ExtremeBuffTips,LayerManager.UI_Popup),window.ExtremeBuffTips=ExtremeBuffTips;var ExtremeEquipPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.menuList.itemRenderer=ExtremeEquipItem,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.menuList.selectedIndex=0,this.addTouchEvent(this.leftBtn,this.onLeft),this.addTouchEvent(this.rightBtn,this.onRight),this.addTouchEvent(this.updateBtn,this.update),this.addTouchEvent(this.skillIcon0,this.onClick),this.addTouchEvent(this.skillIcon1,this.onClick),this.addTouchEvent(this.chainImg0,this.onClick),this.addTouchEvent(this.chainImg1,this.onClick),this.addTouchEvent(this.skillIcon2,this.onClick),this.addTouchEvent(this.chainImg2,this.onClick),this.addTouchEvent(this.skill,this.onClick),this.addChangeEvent(this.menuScroller,this.onChange),this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.setRoleId(this.curRole)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(EquipCT.ins().postZhiZunUpgrade,this.undateView),this.listWidth=726},e.prototype.onClick=function(t){var e,i,n,s,o;switch(t.currentTarget){case this.skillIcon0:case this.skillIcon2:e=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),n=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem),i=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,n),s=GlobalConfig.SkillsConfig[i.skillId],o=SkillUtil.getDesc(s),ViewManager.ins().open(YupeiSkillTipsWin,SkillUtil.getName(s)+("Lv."+e.level),o);break;case this.chainImg0:case this.chainImg2:e=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),ViewManager.ins().open(YupeiSkillTipsWin,"灵魂锁链Lv."+e.level,e.chainDesc);break;case this.skillIcon1:e=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob),n=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,this.menuList.selectedItem),i=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem,n,!0),s=GlobalConfig.SkillsConfig[i.skillId],o=SkillUtil.getDesc(s),ViewManager.ins().open(YupeiSkillTipsWin,SkillUtil.getName(s)+("Lv."+e.level),o);break;case this.chainImg1:e=ExtremeEquipModel.ins().getZhiZunLinkLevelConfig(this.menuList.selectedItem,ExtremeEquipModel.ins().selectJob,!0),ViewManager.ins().open(YupeiSkillTipsWin,"灵魂锁链Lv."+e.level,e.chainDesc);break;case this.skill:ViewManager.ins().open(ExtremeBuffTips)}},e.prototype.undateView=function(){var t=this.menuList.selectedItem;this.pos=t,this.setRoleId(this.curRole,t)},e.prototype.update=function(){var t=ExtremeEquipModel.ins().selectJob,e=this.menuList.selectedItem,i=SubRoles.ins().getSubRoleByJob(t),n=i.getEquipByIndex(e),s=n.item.configID;return s?ExtremeEquipModel.ins().canOperate(t,e)?void EquipCT.ins().upgradeZhiZunEquip(i.index,e):void TipsCT.ins().showTips("|C:0xff0000&T:材料不足"):void TipsCT.ins().showTips("|C:0xff0000&T:该部位未穿戴装备")},e.prototype.onListChange=function(){var t=this.menuList.selectedItem;this.pos=t,this.selectEquip(t),this.selectList()},e.prototype.onLeft=function(){var t=410,e=this.menuList.scrollH-t;e=82*Math.round(e/82),0>e&&(e=0),this.menuList.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=410,e=this.menuList.scrollH+t;e=82*Math.round(e/82),e>this.listWidth-this.menuScroller.width&&(e=this.listWidth-this.menuScroller.width),this.menuList.scrollH=e,this.onChange()},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ZsCT.ins().lv<5?(TipsCT.ins().showTips("霸业装备功能5转开启"),!1):!0},e.prototype.setRoleId=function(t,e){if(t=t?t:0,this.curRole=t,this.skin){var i=SubRoles.ins().getSubRoleByIndex(t);ExtremeEquipModel.ins().selectJob=i.job,this.menuListData.replaceAll(ExtremeEquipModel.ins().positions),e=e?e:this.pos?this.pos:EquipPos.WEAPON,this.pos=e,this.selectEquip(e)}},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.menuList.scrollH>=this.listWidth-this.menuList.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.leftRed.visible=ExtremeEquipModel.ins().getRedPoint(),this.rightRed.visible=ExtremeEquipModel.ins().getRedPoint();var t=ViewManager.ins().getView(HeirloomMainWin);t&&t.setRoleRed()},e.prototype.selectEquip=function(t){this.extremeName.source="extreme_name_0"+t;var e=ExtremeEquipModel.ins().selectJob,i=SubRoles.ins().getSubRoleByJob(e),n=ExtremeEquipModel.ins().getZhiZunLv(e,t);if(n)if(n>=ExtremeEquipModel.ins().getMaxZhiZunEquipLevel(t)){this.attrGroup1.visible=!0,this.attrGroup0.visible=!1,this.updateBtn.visible=this.redPoint.visible=this.cost.parent.visible=!1;var s=GlobalConfig.ZhiZunEquipLevel[t][n],o=AttributeData.getAttStr(s.attrs,0,1,"  :  ");this.attr2.text=o,this.skillChain2.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,n);var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName2.text=a+"Lv."+n,this.skillIcon2.source=SkillCT.ins().getSkillIdIcon(s.skillId));var r=Math.floor(BagCT.getAttrPower(s.attrs))+s.ex_power;r+=this.getChainAddPower(t,n),this.powerPanel2.setPower(r)}else{this.attrGroup1.visible=!1,this.attrGroup0.visible=!0,this.updateBtn.visible=this.cost.parent.visible=!0;var s=GlobalConfig.ZhiZunEquipLevel[t][n+1],l=GlobalConfig.ItemConfig[s.materialInfo.id],h=s.materialInfo.count;this.cost.text=l.name;var u=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.materialInfo.id),p=void 0;u>=h?(p=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(p=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+p+">"+u+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+h+"</font> ");var o=AttributeData.getAttStr(s.attrs,0,1,"  :  "),c=void 0,d=void 0;0==n?(d=GlobalConfig.ZhiZunEquipLevel[t][1],c=AttributeData.getAttStr(d.attrs,0,1,"  :  ")):(d=GlobalConfig.ZhiZunEquipLevel[t][n],c=AttributeData.getAttStr(d.attrs,0,1,"  :  ")),this.attr0.text=c,this.attr1.text=o;var g=Math.floor(BagCT.getAttrPower(d.attrs))+d.ex_power,f=Math.floor(BagCT.getAttrPower(s.attrs))+s.ex_power;g+=this.getChainAddPower(t,n),f+=this.getChainAddPower(t,n+1),this.powerPanel0.setPower(g),this.powerPanel1.setPower(f),this.skillChain0.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,n),this.skillChain1.text="灵魂锁链Lv."+ExtremeEquipModel.ins().getZhiZunLinkLvShow(i.index,t,n+1);var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName0.text=a+"Lv."+n,this.skillName1.text=a+"Lv."+(n+1),this.skillIcon0.source=SkillCT.ins().getSkillIdIcon(s.skillId),this.skillIcon1.source=SkillCT.ins().getSkillIdIcon(s.skillId)),this.redPoint.visible=ExtremeEquipModel.ins().canOperate(e,t),this.updateBtn.label="升 级"}else{this.attrGroup1.visible=!0,this.attrGroup0.visible=!1,this.updateBtn.label="激 活",this.updateBtn.visible=!0;var d=GlobalConfig.ZhiZunEquipLevel[t][1],c=AttributeData.getAttStr(d.attrs,0,1,"  :  ");this.attr2.text=c,this.skillChain2.text="灵魂锁链Lv.1";var a=ExtremeEquipModel.ins().getSkillName(t);a&&(this.skillName2.text=a+"Lv.1",this.skillIcon2.source=SkillCT.ins().getSkillIdIcon(d.skillId));var r=Math.floor(BagCT.getAttrPower(d.attrs))+d.ex_power;r+=this.getChainAddPower(t,n),this.powerPanel2.setPower(r);var u=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,d.materialInfo.id),l=GlobalConfig.ItemConfig[d.materialInfo.id],h=d.materialInfo.count;this.cost.text=l.name;var p=void 0;u>=h?(p=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(p=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.numLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+p+">"+u+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+h+"</font> "),this.redPoint.visible=ExtremeEquipModel.ins().canOperate(e,t)}t==EquipPos.WEAPON||t==EquipPos.CLOTHES?(this.skill_0_0.parent||this.group0.addChild(this.skill_0_0),this.skill_1_0.parent||this.group1.addChild(this.skill_1_0),this.skill_2_0.parent||this.group3.addChild(this.skill_2_0)):(this.skill_0_0.parent&&this.skill_0_0.parent.removeChild(this.skill_0_0),this.skill_1_0.parent&&this.skill_1_0.parent.removeChild(this.skill_1_0),this.skill_2_0.parent&&this.skill_2_0.parent.removeChild(this.skill_2_0)),this.setEff(t),this.selectList(),this.onChange()},e.prototype.setEff=function(t){this.mc1||(this.mc1=new MovieClip),this.mc1.parent||this.extreme_eff.addChild(this.mc1),this.mc2||(this.mc2=new MovieClip),this.mc2.parent||this.extreme_eff_bottom.addChild(this.mc2),this.mc1.playFile(RES_DIR_EFF+("extrme_eff_0"+t),-1),this.mc2.playFile(RES_DIR_EFF+"extrme_eff_bottom",-1)},e.prototype.selectList=function(){for(var t=this.menuList.dataProvider.length,e=0;t>e;e++){var i=this.menuList.getElementAt(e);i&&(e!=this.menuList.selectedIndex?i.setSelect(!1):i.setSelect(!0))}},e.prototype.getChainAddPower=function(t,e){if(!e)return 0;var i=GlobalConfig.ZhiZunEquipLevel[t][e];if(!i)return 0;var n=ExtremeEquipModel.ins().getLinkEquipPos(t),s=GlobalConfig.ZhiZunLinkLevel[t][n][i.soulLinkLevel];if(!s)return 0;var o=0,a=SubRoles.ins().getSubRoleByIndex(this.curRole);if(s.attrs){o+=BagCT.getAttrPower(s.attrs);for(var r in s.attrs)o+=ItemUtil.relatePower(s.attrs[r],a)}var l=s.ex_power?s.ex_power:0;return o=Math.floor(o)+l},e.prototype.close=function(){},e}(BaseView);__reflect(ExtremeEquipPanel.prototype,"ExtremeEquipPanel"),window.ExtremeEquipPanel=ExtremeEquipPanel;var ExtremeEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="ExtremeEquipTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.mc=new MovieClip,this.eEffGrp.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.posId=t[0],this.addTouchEvent(this.bgClose,this.onTouch),this.updateTips()},e.prototype.updateTips=function(){this.pos.text=Role.getEquipNameByType(this.posId);var t=GlobalConfig.ZhiZunEquipLevel[this.posId][1];this.mc.playFile(RES_DIR_EFF+("extrme_eff_0"+this.posId),-1),this.eImg.source="extreme_name_0"+this.posId,this.powerPanel.setPower(t.showPower);for(var e in t.attrs)this["attr"+t.attrs[e].type]&&(this["attr"+t.attrs[e].type].text=t.attrs[e].value);this.posId==EquipPos.WEAPON||this.posId==EquipPos.CLOTHES?(this.chainName.text=ExtremeEquipModel.ins().getSkillName(this.posId),this.chainPos.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(ExtremeEquipModel.ins().getSkillDesc(this.posId),"0xffff00"))):DisplayUtils.removeFromParent(this.chainGroup);var i=ExtremeEquipModel.ins().getLinkEquipPos(this.posId),n=GlobalConfig.ZhiZunLinkLevel[this.posId][i][1];this.soulAttr.textFlow=TextFlowMaker.generateTextFlow1(StringUtils.replaceStrColor(n.chainDesc,"0xffff00"))},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ExtremeEquipTipsWin.prototype,"ExtremeEquipTipsWin"),ViewManager.ins().reg(ExtremeEquipTipsWin,LayerManager.UI_Popup),window.ExtremeEquipTipsWin=ExtremeEquipTipsWin;var ExtremeEquipItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.redPoint.visible=ExtremeEquipModel.ins().canOperate(ExtremeEquipModel.ins().selectJob,t);var e,i=ExtremeEquipModel.ins().getZhiZunLv(ExtremeEquipModel.ins().selectJob,t);e=0>=i?ExtremeEquipModel.ins().descNames[t]:ExtremeEquipModel.ins().descNames[t],this.nameLabel.text=e,this.selectIcon.visible=this.selected,this.itemIcon.source="icon_extreme_0"+t},e.prototype.setSelect=function(t){this.selectIcon.visible=t},e}(eui.ItemRenderer);__reflect(ExtremeEquipItem.prototype,"ExtremeEquipItem"),window.ExtremeEquipItem=ExtremeEquipItem;var DailyFbRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.cailiao=!1,e.rareRed=!1,e.expRed=!1,e.guardRed=!1,e.demonRed=!1,e.leiTing=!1,e.associated(e.postRedPoint,e.postRareAnimal,e.postExp,e.postGuardWeapon,e.postDemonCircle,e.postCaiLiao,e.postLeiTing,MoJianFBRP.ins().postRP),e.associated(e.postRareAnimal,RareAnimalCT.ins().postInit),e.associated(e.postExp,FbCT.ins().postFbExpInfo),e.associated(e.postGuardWeapon,ZsCT.ins().postZsLv,GameApp.ins().postZeroInit,FbCT.ins().postGuardInfo),e.associated(e.postDemonCircle,BagCT.ins().postItemAdd,BagCT.ins().postItemChange,DemonCir.ins().postFbInfo),e.associated(e.postCaiLiao,FbCT.ins().postFbInfoInit,FbCT.ins().postUpDataInfo,DieGuide.ins().postdieGuide,Actor.ins().postLevelChange),e.associated(e.postLeiTing,ThunderCT.ins().postThunderFBInfo,ZsCT.ins().postZsLv),e}return __extends(e,t),e.prototype.postCaiLiao=function(){var t=this.cailiao;return this.cailiao=FbCT.ins().hasCount(),this.cailiao!=t},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.rareRed||this.expRed||this.guardRed||this.demonRed||this.leiTing||MoJianFBRP.ins().rp,t!=this.redPoint},e.prototype.postRareAnimal=function(){var t=this.rareRed,e=RareAnimalCT.ins();return this.rareRed=e.checkOpen()&&!!e.passNum,t!=this.rareRed},e.prototype.postExp=function(){var t=this.expRed;return this.expRed=FbCT.ins().fbExpRed(),t!=this.expRed},e.prototype.postGuardWeapon=function(){var t=this.guardRed;return this.guardRed=GuardWeaponModel.ins().canChallenge(),t!=this.guardRed},e.prototype.postDemonCircle=function(){var t=this.demonRed;return this.demonRed=DemonCir.ins().checkFb(),t!=this.demonRed},e.prototype.postLeiTing=function(){var t=this.leiTing;return this.leiTing=ThunderCT.ins().checkLeiTingFbOpen()&&null!=GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId]&&ThunderCT.ins().remainNum>0,t!=this.leiTing},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postCaiLiao",null),__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRareAnimal",null),__decorate([post()],e.prototype,"postExp",null),__decorate([post()],e.prototype,"postGuardWeapon",null),__decorate([post()],e.prototype,"postDemonCircle",null),__decorate([post()],e.prototype,"postLeiTing",null),e}(BaseSystem);__reflect(DailyFbRedPoint.prototype,"DailyFbRedPoint"),System.DailyFbRedPoint=function(){return DailyFbRedPoint.ins()},window.DailyFbRedPoint=DailyFbRedPoint;var Fb2CT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.FbChallenge,e.regNetMsg(1,e.postUpDataInfo),e.regNetMsg(2,e.postRewardStatu),e.regNetMsg(3,e.doGetFbTime),e.regNetMsg(4,e.postGetReward),e.regNetMsg(5,e.postLotteryReward),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendChallenge=function(){this.sendBaseProto(1)},e.prototype.sendrequestDayReward=function(){this.sendBaseProto(2)},e.prototype.postUpDataInfo=function(t){SkyLevelModel.ins().setCruLevelInfo(t.readInt()),SkyLevelModel.ins().dayReward=t.readShort(),SkyLevelModel.ins().lotteryIndexs=t.readInt(),SkyLevelModel.ins().lotteryUseTimes=t.readInt()},e.prototype.postRewardStatu=function(t){var e=t.readShort();SkyLevelModel.ins().dayRewardList=[];for(var i=0;e>i;i++){var n=t.readInt(),s=t.readInt(),o=t.readInt();SkyLevelModel.ins().dayRewardList[i]=[n,s,o]}SkyLevelModel.ins().rewardTimes=Math.ceil((e-12)/12)},e.prototype.doGetFbTime=function(t){SkyLevelModel.ins().setLimtTimeDown(t.readShort())},e.prototype.sendGetDayReward=function(){this.sendBaseProto(4)},e.prototype.sendBeginLottery=function(){this.sendBaseProto(5)},e.prototype.sendGetReward=function(){this.sendBaseProto(6)},e.prototype.postLotteryReward=function(t){SkyLevelModel.ins().lotteryUseTimes=t.readInt(),SkyLevelModel.ins().lotteryAwardIndex=t.readInt()},e.prototype.postGetReward=function(t){},__decorate([post()],e.prototype,"postUpDataInfo",null),__decorate([post()],e.prototype,"postRewardStatu",null),__decorate([post()],e.prototype,"postLotteryReward",null),__decorate([post()],e.prototype,"postGetReward",null),e}(BaseSystem);__reflect(Fb2CT.prototype,"Fb2CT"),System.Fb2CT=function(){return Fb2CT.ins()},window.Fb2CT=Fb2CT;var TextFlowMaker=function(){function t(){}return t.generateTextFlow=function(e){if(!e)return(new egret.HtmlTextParser).parser("");for(var i,n=e.split("|"),s="",o=0,a=n.length;a>o;o++)s+=t.getSingleTextFlow1(n[o]);try{i=(new egret.HtmlTextParser).parser(s)}catch(r){return console.log("错误的HTML输入"),(new egret.HtmlTextParser).parser("")}return i},t.generateTextFlow1=function(e){if(!e)return(new egret.HtmlTextParser).parser("");for(var i=e.split("|"),n=[],s=0,o=i.length;o>s;s++){var a=t.getSingleTextFlow(i[s]);a.text&&""!=a.text&&n.push(a)}return n},t.getSingleTextFlow1=function(e){var i=e.split("&T:",2);if(2==i.length){for(var n="<font",s=i[0].split("&"),o=void 0,a=!1,r=0,l=s.length;l>r;r++)switch(o=s[r].split(":"),o[0]){case t.STYLE_SIZE:n+=' size="'+Math.floor(+o[1])+'"';break;case t.STYLE_COLOR:n+=' color="'+Math.floor(+o[1])+'"';break;case t.UNDERLINE_TEXT:a=!0}return n+=a?"><u>"+i[1]+"</u></font>":">"+i[1]+"</font>"}return"<font>"+e+"</font>"},t.getSingleTextFlow=function(e){var i=e.split("&T:",2),n={style:{}};if(2==i.length){for(var s=(i[0],e.split("&")),o=void 0,a=0,r=s.length;r>a;a++)switch(o=s[a].split(":"),o[0]){case t.STYLE_SIZE:n.style.size=+o[1];break;case t.STYLE_COLOR:n.style.textColor=+o[1];break;case t.UNDERLINE_TEXT:n.style.underline=!0;break;case t.EVENT:n.style.href="event:"+o[1]}n.text=i[1]}else n.text=e;return n},t.getCStr=function(e){var i=Math.floor(e%100/10),n=e%10;return 10>=e?t.numberList[e]:20>=e||e%10==0?1==i?t.numberList[10]+t.numberList[n]:t.numberList[i]+t.numberList[10]:100>e?t.numberList[i]+t.numberList[10]+t.numberList[n]:""},t.STYLE_COLOR="C",t.STYLE_SIZE="S",t.PROP_TEXT="T",t.UNDERLINE_TEXT="U",t.EVENT="E",t.numberList=["零","一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五","十六","十七","十八","十九","二十"],t}();__reflect(TextFlowMaker.prototype,"TextFlowMaker"),window.TextFlowMaker=TextFlowMaker;var FbModel=function(){function t(){}return t.prototype.parser=function(t){this.fbID=t.readInt(),this.useCount=t.readShort(),this.vipBuyCount=t.readShort(),this.vipHoldCount=t.readShort(),this.isPass=t.readBoolean()},t.prototype.getCount=function(){if(GlobalConfig.ZhanLingConfig.fbIndex==this.fbID&&!ZhanLingModel.ins().ZhanLingOpen)return 0;var t=GlobalConfig.DailyFubenConfig[this.fbID];if(t.zsLevel>0){if(ZsCT.ins().lv<t.zsLevel)return 0}else if(Actor.level<t.levelLimit)return 0;return t.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount},t.prototype.getPlayCount=function(){var t=GlobalConfig.DailyFubenConfig[this.fbID];return t.freeCount+this.vipBuyCount+this.vipHoldCount-this.useCount},t.prototype.getNextVip=function(){var t=GlobalConfig.DailyFubenConfig[this.fbID];for(var e in t.vipBuyCount)if(this.useCount-t.freeCount-t.vipBuyCount[e]<0)return parseInt(e);return-1},t.prototype.getResetCount=function(){var t=Actor.vip,e=GlobalConfig.DailyFubenConfig[this.fbID];return e.vipBuyCount[t]-(this.useCount-e.freeCount)},t}();__reflect(FbModel.prototype,"FbModel"),window.FbModel=FbModel;var FbRedPoint=function(t){function e(){var e=t.call(this)||this;return e.fb=!1,e.richang=!1,e.tongtian=!1,e.mrjl=!1,e.xyzp=!1,e.shenbin=!1,e.chuanqi=!1,e.mhzd=!1,e.associated(e.postFb,e.postRiChang,e.postTongTian,e.postShenBin,e.postChuanQi,e.postMhzd),e.associated(e.postRiChang,DailyFbRedPoint.ins().postRedPoint,e.postShenBin),e.associated(e.postTongTian,e.postMrjl,e.postXyzp),e.associated(e.postMrjl,Fb2CT.ins().postUpDataInfo),e.associated(e.postXyzp,Fb2CT.ins().postUpDataInfo),e.associated(e.postShenBin,GodWeaponRedPoint.ins().postGwMj),e.associated(e.postChuanQi,FbCT.ins().postShowRedChange),e.associated(e.postMhzd,ZsCT.ins().postZsData,Hungu.ins().postHunShouFBInfo,Hungu.ins().postSweepHunShouFB),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postFb=function(){var t=this.fb;return this.fb=this.richang||this.tongtian||this.shenbin||this.chuanqi,this.fb!=t},e.prototype.postRiChang=function(){var t=this.richang;return this.richang=DailyFbRedPoint.ins().redPoint||this.shenbin,this.richang!=t},e.prototype.postTongTian=function(){var t=this.tongtian;return this.tongtian=this.mrjl||this.xyzp,this.tongtian!=t},e.prototype.postMrjl=function(){var t=this.mrjl,e=SkyLevelModel.ins(),i=e.cruLevel,n=e.dayReward;return this.mrjl=i>1&&1==n,this.mrjl!=t},e.prototype.postXyzp=function(){var t=this.xyzp;return this.xyzp=SkyLevelModel.ins().lotteryRemainTimes>0,this.xyzp!=t},e.prototype.postShenBin=function(){var t=this.shenbin;return this.shenbin=GodWeaponRedPoint.ins().gwMjRed,this.shenbin!=t},e.prototype.postChuanQi=function(){var t=this.chuanqi;return this.chuanqi=FbCT.ins().checkTFRed(),this.chuanqi!=t},e.prototype.postMhzd=function(){var t=this.mhzd,e=Hungu.ins();return this.mhzd=e.checkOpen()&&e.hunShouFBTimes>0,this.mhzd!=t},__decorate([post()],e.prototype,"postFb",null),__decorate([post()],e.prototype,"postRiChang",null),__decorate([post()],e.prototype,"postTongTian",null),__decorate([post()],e.prototype,"postMrjl",null),__decorate([post()],e.prototype,"postXyzp",null),__decorate([post()],e.prototype,"postShenBin",null),__decorate([post()],e.prototype,"postChuanQi",null),__decorate([post()],e.prototype,"postMhzd",null),e}(BaseSystem);__reflect(FbRedPoint.prototype,"FbRedPoint"),System.FbRedPoint=function(){return FbRedPoint.ins()},window.FbRedPoint=FbRedPoint;var MapType;!function(t){t[t.chapterMap=0]="chapterMap",t[t.bigMap=1]="bigMap"}(MapType||(MapType={}));var SpeakType;!function(t){t[t.appear=1]="appear",t[t.hit=2]="hit",t[t.die=3]="die"}(SpeakType||(SpeakType={}));var MonsterSpeak=function(t){function e(){var e=t.call(this)||this;return e.speakDic={},e.observe(GameLogic.ins().postHpChange,function(t){var i=t[0],n=t[1];40001==GameMap.fubenID&&(i instanceof CharRole||e.trigger(i.infoModel.configID,n>0?SpeakType.hit:SpeakType.die))}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.clear=function(){this.speakDic={}},e.prototype.trigger=function(t,e){if((!this.speakDic[t]||!this.speakDic[t][e])&&GlobalConfig.MonsterSpeakConfig){var i=GlobalConfig.MonsterSpeakConfig[t];i&&i[e]&&(this.postMonsterSpeak(i[e].speak),this.speakDic[t]=this.speakDic[t]||{},this.speakDic[t][e]=1)}},e.prototype.postMonsterSpeak=function(t){return t},__decorate([post()],e.prototype,"postMonsterSpeak",null),e}(BaseSystem);__reflect(MonsterSpeak.prototype,"MonsterSpeak"),System.MonsterSpeak=function(){return MonsterSpeak.ins()},window.MonsterSpeak=MonsterSpeak;var SkyLevelModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cruLevel=1,e.lastPass=!1,e.stageLevel=1,e.dayReward=1,e.limitTime=180,e.rewardTimes=0,e}return __extends(e,t),e.ins=function(){return this._instance||(this._instance=new e),this._instance},Object.defineProperty(e.prototype,"lotteryRemainTimes",{get:function(){var t,e=GlobalConfig.FbChallengeConfig;if(this.lastPass){var i=Object.keys(e).length;t=e[i]}else if(t=e[this.cruLevel-1],this.cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel)return 0;if(!t)return 0;var n=t.lotteryCount-this.lotteryUseTimes;return n},enumerable:!0,configurable:!0}),e.prototype.isGetLotteryAward=function(t){return 1==(this.lotteryIndexs>>t&1)},e.prototype.getNextOpenLevel=function(){var t=GlobalConfig.FbChallengeConfig;for(var e in t)if(t[e].id>=this.cruLevel&&t[e].showIcon)return t[e];return null},e.prototype.getIsopenNext=function(){var t=GlobalConfig.FbChallengeConfig,e=t[this.cruLevel];return Actor.level>=e.levelLimit&&Actor.zhuanShengLv>=e.zsLevelLimit},e.prototype.getSkyLevelList=function(){var t=[],e=GlobalConfig.FbChallengeConfig,i=e[this.cruLevel],n=this.getStageList(),s=CommonUtils.getObjectLength(n);for(var o in n){var a=n[o];if(this.checkIsPushInlist(i.layer,a.layer,s)&&(t.push(a),t.length>=6))break}return t.reverse(),t},e.prototype.setLimtTimeDown=function(t){this.limitTime=t,Timer.stop(this.timeDown,this),Timer.start(1e3,t,this.timeDown,this)},e.prototype.timeDown=function(){this.limitTime--,this.limitTime<0&&(this.limitTime=0,Timer.stop(this.timeDown,this))},e.prototype.checkIsPushInlist=function(t,e,i){if(4>=t)return!0;if(t>4){var n=i-t>=3?3:i-t,s=6-n,o=t-s,a=t+n;return a>=e&&e>o}},e.prototype.getStageList=function(){var t=GlobalConfig.FbChallengeConfig,e=t[this.cruLevel];this.stageLevel=e.group;var i=[];if(!e)return i;
for(var n in t){var s=t[n];s.group==e.group&&i.push(s)}return i},e.prototype.setCruLevelInfo=function(t){t>0?(this.cruLevel=t,this.lastPass=!1):(this.cruLevel=CommonUtils.getObjectLength(GlobalConfig.FbChallengeConfig),this.lastPass=!0)},e}(egret.HashObject);__reflect(SkyLevelModel.prototype,"SkyLevelModel"),window.SkyLevelModel=SkyLevelModel;var ThunderCT=function(t){function e(){var e=t.call(this)||this;return e.curLayerId=1,e.sysId=PackageID.LianJi,e.regNetMsg(7,e.postThunderFBInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postThunderFBInfo=function(t){this.curLayerId=t.readShort()+1,this.remainNum=t.readShort()},e.getThundersAwakeLv=function(t,e){return t&&t.thunderEquipAwakeLv[e]?t.thunderEquipAwakeLv[e]:0},e.getEquipName=function(t,e){void 0===e&&(e=0);var i=GlobalConfig.ItemConfig[t].name;return e>0&&(i=GlobalConfig.LeitingEquipBaseConf.awakeName+i+"·"+GlobalFun.getRomanNumStr(e)),i},e.prototype.sendEnterThunder=function(){var t=this.getBytes(8);this.sendToServer(t)},e.prototype.getLayerStatus=function(t){return this.curLayerId<t?2:this.curLayerId>t?1:0},e.calculateThunderItemScore=function(t,e){if(ItemUtil.getType(t.itemConfig)!=ItemType.TYPE_26)return 0;var i={hp:2,atk:4,def:5,res:6},n=this.getThundersAwakeLv(e,ItemUtil.getSubType(t.itemConfig)),s=GlobalConfig.LeiTingSoulLevel[t.itemConfig.id]?GlobalConfig.LeiTingSoulLevel[t.itemConfig.id][n]:null,o=GlobalConfig.EquipConfig[t.itemConfig.id],a=GlobalConfig.AttrPowerConfig,r=0,l=t.att,h=0;if(l)for(var u in i){h=o[u]||0;for(var p=0;p<l.length;p++)if(l[p].type==i[u]){h+=l[p].value;break}s&&(h+=h*s.precent/1e4),r+=h*a[i[u]].pow}else for(var c in i)if(h=o[c]){var d=Role.getAttrTypeByName(c);r+=h*a[d].pow}var g=s?BagCT.getAttrPower(s.attrs):0;if(o.baseAttr1&&(g+=BagCT.getAttrPower([o.baseAttr1])),o.baseAttr2&&(g+=BagCT.getAttrPower([o.baseAttr2])),o.exPower&&(g+=o.exPower),ItemUtil.getType(t.itemConfig)==ThunderEquipPanel.TYPE&&t.extAtt){for(var f=GlobalConfig.LeitingEquipEffConf,v=0,y=0;y<t.extAtt.length;y++)t.extAtt[y].type&&(v+=f[t.extAtt[y].type].power*t.extAtt[y].value);g+=v}return Math.floor(r/100)+Math.floor(g)},e.getMergeEquipByType=function(t){var e=[],i=GlobalConfig.LeitingEquipComposeConf;for(var n in i)i[n].mixId[1]==t&&e.push({type:MergeType.Thunder,id:i[n].id});return e},e.isThunderCanMerge=function(){var t=GlobalConfig.LeitingEquipComposeConf;for(var e in t)if(this.isCanMergeById(t[e].id))return!0;return!1},e.isThunderCanMergeByIdIndex=function(t){var e=GlobalConfig.LeitingEquipComposeConf;for(var i in e)if(e[i].mixId[1]==t&&this.isCanMergeById(e[i].id))return!0;return!1},e.isCanMergeById=function(t){for(var e=!0,i=GlobalConfig.LeitingEquipComposeConf[t],n=0,s=i.input;n<s.length;n++){var o=s[n],a=ItemUtil.getType(GlobalConfig.ItemConfig[o.id])==ItemType.TYPE_1?0:o.type;if(BagCT.ins().getBagGoodsCountById(a,o.id)<o.count){e=!1;break}}return e},e.prototype.checkLeiTingFbOpen=function(){var t=GlobalConfig.LeiTingSysConf,e=t.lvlLimit,i=t.odLimit,n=GameServer.serverOpenDay,s=ZsCT.ins().lv;return i>n?!1:e>s?!1:!0},e.equipNames=["武器","头盔","衣服","项链","手镯","腰带","戒指","鞋子","面甲","护肩","护膝","吊坠"],e.firstName="雷霆",__decorate([post()],e.prototype,"postThunderFBInfo",null),e}(BaseSystem);__reflect(ThunderCT.prototype,"ThunderCT"),System.ThunderCT=function(){return ThunderCT.ins()},window.ThunderCT=ThunderCT;var ThunderRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.composePoint=[],e.roleTabs=[],e.composeItemPoints=[],e.awakeItemPoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postThunderEquipUpdate,EquipCT.ins().postThunderEquipLv,EquipCT.ins().postThunderAwakeLevel,Actor.init),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.getComposeItemPoints=function(t,e){return this.composeItemPoints[t]&&this.composeItemPoints[t][e]?this.composeItemPoints[t][e]:!1},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){this.composePoint[t]=this.itemComposePoints(t);var i=this.itemAwakePoints(t);this.roleTabs[t]=this.composePoint[t]||i}else this.roleTabs[t]=!1}return!0},e.prototype.itemAwakePoints=function(t){this.awakeItemPoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=i.thunderData;if(!n)return!1;for(var s=GlobalConfig.LeiTingSoulLevel,o=0;12>o;o++){var a=n[o];if(!a.itemConfig||o>7)this.awakeItemPoints[t][o]=!1;else{var r=ThunderCT.getThundersAwakeLv(i,ItemUtil.getSubType(a.itemConfig)),l=(s[a.itemConfig.id][r],s[a.itemConfig.id][r+1]);if(l){var h=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,l.materialInfo.id);h>=l.materialInfo.count?(this.awakeItemPoints[t][o]=!0,e=!0):this.awakeItemPoints[t][o]=!1}else this.awakeItemPoints[t][o]=!1}}return e},e.prototype.itemComposePoints=function(t){this.composeItemPoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=i.thunderData;if(!n)return!1;for(var s=GlobalConfig.LeitingEquipConf,o=8;12>o;o++){var a=n[o];if(a.itemConfig){var r=GlobalConfig.LeitingEquipTrimConf[o][s[a.configID].level+1];if(r&&r.consume){var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_EQUIP,r.consume.id);l>=r.consume.count?(this.composeItemPoints[t][o]=!0,e=!0):this.composeItemPoints[t][o]=!1}else this.composeItemPoints[t][o]=!1}else this.composeItemPoints[t][o]=!1}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),e}(BaseSystem);__reflect(ThunderRedPoint.prototype,"ThunderRedPoint"),System.ThunderRedPoint=function(){return ThunderRedPoint.ins()},window.ThunderRedPoint=ThunderRedPoint;var WaveDropData=function(){function t(){this.drops=[]}return t.prototype.parser=function(t){for(var e=1,i=0;e>i;i++)this.drops[i]=this.drops[i]||new RewardData,this.drops[i].parser(t);this.drops.length=e},t}();__reflect(WaveDropData.prototype,"WaveDropData"),window.WaveDropData=WaveDropData;var BabelLotteryWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="tttZhuanpan",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addCustomEvent(),this.updateView()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.choujiangBtn,this.getLottery),this.addTouchEvent(this.closeBtn,this.close),this.observe(Fb2CT.ins().postLotteryReward,this.onGetRewards),this.observe(Fb2CT.ins().postUpDataInfo,this.refreshView)},e.prototype.getLottery=function(){0==SkyLevelModel.ins().lotteryRemainTimes?TipsCT.ins().showTips("没有抽奖次数，每通关10层可抽取1次"):this.rolling?TipsCT.ins().showTips("正在抽奖，请稍候"):Fb2CT.ins().sendBeginLottery()},e.prototype.onGetRewards=function(){this.beginLottery(SkyLevelModel.ins().lotteryAwardIndex)},e.prototype.refreshView=function(){var t=this;SkyLevelModel.ins().lotteryUseTimes%10==0?setTimeout(function(){t.updateView()},2e3):this.updateView()},e.prototype.beginLottery=function(t){var e=this,i=1440+36*(t-1),n=egret.Tween.get(this.tttzhi);this.rolling=!0,n.to({rotation:i},4e3,egret.Ease.circOut).call(function(){Fb2CT.ins().sendGetReward(),e.flyItem(e["item"+(t-1)]),setTimeout(function(){e.rolling=!1,e.refreshView()},2e3)},this)},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=t.x,e.y=t.y,e.data=t.itemIcon.data,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,t.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.updateView=function(){this.num.text=SkyLevelModel.ins().lotteryRemainTimes.toString();var t=SkyLevelModel.ins().lotteryUseTimes,e=10*parseInt((t/10).toString())+10,i=GlobalConfig.FbChallengeLotteryConfig[e],n=null==i;n&&(i=GlobalConfig.FbChallengeLotteryConfig[e-10]);for(var s=i.groupc.length,o=0;s>o;o++){var a=this["item"+o];a.itemIcon.data=i.groupc[o];var r=n||SkyLevelModel.ins().isGetLotteryAward(o+1);a.rewardState(r)}},e}(BaseEuiView);__reflect(BabelLotteryWin.prototype,"BabelLotteryWin"),ViewManager.ins().reg(BabelLotteryWin,LayerManager.UI_Main),window.BabelLotteryWin=BabelLotteryWin;var d_launchX=180,d_launchY=500,d_firstX=0,d_firstY=0,d_distantX=77,d_distantY=93,d_depotX=320,d_depotY=620,d_waitTime=50,ChallengeDayRewardWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.maxCount=12,e.isTopLevel=!0,e.skinName="chuangtianguanDayReward",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.GetRewardBtn0,this.challenge),this.addTouchEvent(this.bgClose,this.closeCB),this.observe(Fb2CT.ins().postRewardStatu,this.setBtnStatu),Fb2CT.ins().sendrequestDayReward()},e.prototype.challenge=function(){var t=function(){Fb2CT.ins().sendGetDayReward()};this.playGet(t),this.canClicck=!1},e.prototype.setBtnStatu=function(){SkyLevelModel.ins().rewardTimes>=1?this.GetRewardBtn0.label="继续领取("+SkyLevelModel.ins().rewardTimes+")":this.GetRewardBtn0.label="确定",this.arr=SkyLevelModel.ins().dayRewardList.slice(),this.playResult()},e.prototype.playResult=function(t){for(var e=this,i=this.arr.length>this.maxCount?this.maxCount:this.arr.length,n=0;i>n;n++){this.items[n]=this.createItem(this.arr[n]);var s=egret.Tween.get(this.items[n]);this.items[n].x=n%4*d_distantX+d_firstX,this.items[n].y=Math.floor(n/4)*d_distantY+d_firstY,this.items[n].alpha=0,s.wait(n*d_waitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length>this.maxCount?this.maxCount:this.arr.length,n=0;i>n;n++)if(this.items[n]){var s=egret.Tween.get(this.items[n]);s.to({y:d_depotY,x:d_depotX,scaleX:0,scaleY:0},300-50*Math.floor(n/4)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;return this.listCon.addChild(e),e.data={type:t[0],count:t[2],id:t[1]},e.x=d_launchX,e.y=d_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[],0==SkyLevelModel.ins().rewardTimes&&ViewManager.ins().close(e)},e.prototype.closeCB=function(t){var e=this;if(this.canClicck){this.canClicck=!1;var i=function(){ViewManager.ins().close(e)};this.playGet(i)}},e}(BaseEuiView);__reflect(ChallengeDayRewardWin.prototype,"ChallengeDayRewardWin"),ViewManager.ins().reg(ChallengeDayRewardWin,LayerManager.UI_Main),window.ChallengeDayRewardWin=ChallengeDayRewardWin;var ChallengeInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.dalay=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChuangtianguanBloodSkin",this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(GameMap.fbType){case FbCT.FB_TYPE_HUN_SHOU:this.dalay=Hungu.ins().getHunShouFbLeftTime();break;case FbCT.FB_TYPE_THUNDER:if(0!=this.dalay||null==GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId])return;this.dalay=GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId].limitTimes;break;default:this.dalay=SkyLevelModel.ins().limitTime}this.time.text=DateUtils.getFormatBySecond(this.dalay,3),Timer.has(this.setTimeLimit,this)||Timer.start(1e3,this.dalay,this.setTimeLimit,this),this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushInfo=function(){var t=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel+1];t&&(this.levelLimit.text=t.zsLevelLimit>0?t.zsLevelLimit+"转":""+(t.levelLimit+"级可挑战"),this.setTimeLimit())},e.prototype.setTimeLimit=function(){switch(GameMap.fbType){case FbCT.FB_TYPE_HUN_SHOU:this.dalay=Hungu.ins().getHunShouFbLeftTime();break;case FbCT.FB_TYPE_THUNDER:this.dalay>0&&this.dalay--;break;default:this.dalay=SkyLevelModel.ins().limitTime}this.time.text=DateUtils.getFormatBySecond(this.dalay,3)},e}(BaseEuiView);__reflect(ChallengeInfoPanel.prototype,"ChallengeInfoPanel"),ViewManager.ins().reg(ChallengeInfoPanel,LayerManager.Game_Main),window.ChallengeInfoPanel=ChallengeInfoPanel;var DailyFbPanel=function(t){function e(){var e=t.call(this)||this;e.lastSelect=-1,e.fbDataList=[],e.pageId=[],e.fbDataList=FbCT.ins().fbDataList.slice();for(var i=0;i<DailyFBPage.Page_MAX;i++)e.pageId.push(i);return e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen),this.addTouchEvent(this.fbList,this.onTap);var t=GlobalConfig.MoJianFubenBaseConfig.openDay;GameServer.serverOpenDay+1<t&&(DisplayUtils.removeFromParent(this.moJianFbPanel),this.pageId.splice(DailyFBPage.Page_MoJian,1));var e=GlobalConfig.DemonCirConf.fbopenserverday;GameServer.serverOpenDay+1<e&&(this.pageId.splice(DailyFBPage.Page_DemonCircle,1),DisplayUtils.removeFromParent(this.demonCirclePanel)),this.tab.validateNow(),this.viewStack.validateNow()},e.prototype.addDisplay=function(){this.fbList.itemRenderer=FbItem,this.observe(FbCT.ins().postUpDataInfo,this.updateFbList);var t=DailyFbRedPoint.ins();this.associated(this.updateRedPoint,t.postRedPoint),this.setOpenIndex(Math.max(this.pageId.indexOf(this.select),0)),this.updateRedPoint(),this.updateFbList()},e.prototype.removeDisplay=function(){delete this.select},e.prototype.onTap=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.data,i=GlobalConfig.DailyFubenConfig[e];if("add"==t.target.name)this.Sweep(e);else if("double"==t.target.name)this.DoubleSweep(e);else{if(!KfArenaSys.ins().checkIsMatching())return;var n=FbCT.ins().getFbDataById(e);if(n.getCount()<=0)TipsCT.ins().showTips("|C:0xf3311e&T:剩余挑战次数不足|");else if(i.levelLimit>Actor.level)TipsCT.ins().showTips("|C:0xf3311e&T:转生或等级不足|");else{var s=FbCT.ins().fbModel[e].isPass;if(Recharge.ins().franchise&&s)FbCT.ins().sendChallenge(e);else{if(FbCT.ins().checkInFB())return;FbCT.ins().sendChallenge(i.id)}}}ViewManager.ins().close(LimitTaskView)}},e.prototype.Sweep=function(t){var e=GlobalConfig.DailyFubenConfig[t],i=GlobalConfig.MonthCardConfig.sweepPrecent/100,n=Recharge.ins().monthDay>0?1-i:1,s=e.buyPrice[FbCT.ins().getFbDataById(t).vipBuyCount]*n;if(!(Actor.yb>=s))return void TipsCT.ins().showTips("元宝不足");DieGuide.ins().setClick(t);var o=this.fbDataList.lastIndexOf(t);this.fbList.getChildAt(o).starSaoDang(0)},e.prototype.DoubleSweep=function(t){var e=GlobalConfig.DailyFubenConfig[t],i=GlobalConfig.MonthCardConfig.sweepPrecent/100,n=Recharge.ins().monthDay>0?1-i:1,s=e.buyDoublePrice[FbCT.ins().getFbDataById(t).vipBuyCount]*n;if(!(Actor.yb>=s))return void TipsCT.ins().showTips("元宝不足");DieGuide.ins().setClick(t);var o=this.fbDataList.lastIndexOf(t);this.fbList.getChildAt(o).starSaoDang(1)},e.prototype.updateFbList=function(){var t=this.fbDataList.indexOf(GlobalConfig.ZhanLingConfig.fbIndex);t>=0&&GlobalConfig.ZhanLingConfig.openserverday>GameServer.serverOpenDay+1&&this.fbDataList.splice(t,1),this.fbList.dataProvider=new eui.ArrayCollection(this.fbDataList)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){this.lastSelect=t,this.tab.selectedIndex=this.lastSelect,this.viewStack.selectedIndex=this.lastSelect},e.prototype.checkIsOpen=function(t){return e.checkIndexOpen(this.pageId[this.tab.selectedIndex])?void 0:(t.$cancelable=!0,void t.preventDefault())},e.checkIndexOpen=function(t){if(t==DailyFBPage.Page_fbExp){if(Actor.level<GlobalConfig.ExpFubenBaseConfig.openLv)return TipsCT.ins().showTips(GlobalConfig.ExpFubenBaseConfig.openLv+"级开启"),!1}else if(t==DailyFBPage.Page_GwFu){var e=GlobalConfig.GodWeaponBaseConfig,i=e.zhuanshengLevel,n=e.openDay,s=GameServer.serverOpenDay,o=ZsCT.ins().lv;if(i>o||n>s)return i>o?TipsCT.ins().showTips("角色"+i+"转开启"):n>s&&TipsCT.ins().showTips("开服"+(n+1)+"天开启"),!1}else if(t==DailyFBPage.Page_GuardWeapon){if(!GuardWeaponModel.ins().isOpen())return TipsCT.ins().showTips(GuardWeaponModel.ins().getDesc()),!1}else if(t==DailyFBPage.Page_DemonCircle){var a=GlobalConfig.DemonCirConf.openzhuanshenglv;if(ZsCT.ins().lv<a)return TipsCT.ins().showTips("达到"+a+"转开启"),!1}else{if(t==DailyFBPage.Page_MoJian)return MoJianFBCT.checkOpen(!0);if(t==DailyFBPage.Page_Thundre){var r=GlobalConfig.LeiTingSysConf,l=r.lvlLimit,h=r.odLimit,s=GameServer.serverOpenDay,o=ZsCT.ins().lv;if(h>s)return TipsCT.ins().showTips("开服"+(h+1)+"天开启"),!1;if(l>o)return TipsCT.ins().showTips("角色"+l+"转开启"),!1;if(!GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId])return TipsCT.ins().showTips("已通关全部秘境"),!1}else if(t==DailyFBPage.Page_RareAnimal)return RareAnimalCT.ins().checkOpen(!0)}return!0},e.prototype.updateRedPoint=function(){for(var t=DailyFbRedPoint.ins(),e=t.cailiao,i=t.expRed,n=t.guardRed,s=t.demonRed,o=t.rareRed,a=t.leiTing,r=FbRedPoint.ins().shenbin,l=[i,n,s,e,r,MoJianFBRP.ins().rp,a,o],h=0;h<this.tab.numElements;h++){var u=this.tab.getElementAt(h);if(u&&u.data&&u.eRp){var p=u.data.split("_")[2];u.eRp.visible=l[p]}}},e}(BaseView);__reflect(DailyFbPanel.prototype,"DailyFbPanel");var DailyFBPage;!function(t){t[t.Page_CaiLiao=0]="Page_CaiLiao",t[t.Page_fbExp=1]="Page_fbExp",t[t.Page_GwFu=2]="Page_GwFu",t[t.Page_GuardWeapon=3]="Page_GuardWeapon",t[t.Page_DemonCircle=4]="Page_DemonCircle",t[t.Page_MoJian=5]="Page_MoJian",t[t.Page_RareAnimal=6]="Page_RareAnimal",t[t.Page_Thundre=7]="Page_Thundre",t[t.Page_MAX=8]="Page_MAX"}(DailyFBPage||(DailyFBPage={})),window.DailyFBPage=DailyFBPage,window.DailyFbPanel=DailyFbPanel;var DemonCircleFbWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selLayer=1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.rewardList.itemRenderer=ItemBaseTimes,this.dataArr||(this.dataArr=new eui.ArrayCollection,this.rewardList.dataProvider=this.dataArr),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.monArr=[this.monCom0,this.monCom1,this.monCom2],this.seeRule&&(this.seeRule.visible=!1),this.addTouchEvent(this.challengeBtn,this.onTap),this.addTouchEvent(this.getItemTxt,this.onTap),this.addTouchEvent(this.monCom0,this.onMonster),this.addTouchEvent(this.monCom1,this.onMonster),this.addTouchEvent(this.monCom2,this.onMonster)},e.prototype.addDisplay=function(){this.observe(DemonCir.ins().postFbInfo,this.onUpdate),this.onUpdate(),DemonCir.ins().isFrist&&(DemonCir.ins().isFrist=!1,DailyFbRedPoint.ins().postDemonCircle())},e.prototype.onTap=function(t){switch(t.currentTarget){case this.challengeBtn:var e=DemonCir.ins().layerData[this.selLayer-1];if(0==e)return void TipsCT.ins().showTips("请先挑战"+GlobalConfig.DemonCirFbConf[this.selLayer-1].fbName);var i=GlobalConfig.DemonCirFbConf[this.selLayer],n=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId);if(n<i.itemCount)return void HuntWarnBuyWin.showBuyWarn("DemonCircleFbWin",this.huntWarnFun.bind(this),"恶魔卷轴数量不足，是否花费"+GlobalConfig.DemonCirConf.enterMoney*(i.itemCount-n)+"元宝购买卷轴进行挑战？");DemonCir.ins().sendEnterFb(),ViewManager.ins().close(FbWin);break;case this.getItemTxt:ViewManager.ins().open(ShopGoodsWarn).setData(GlobalConfig.DemonCirConf.enterItemId);break;case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[45].text)}},e.prototype.huntWarnFun=function(){var t=GlobalConfig.DemonCirFbConf[this.selLayer],e=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId),i=GlobalConfig.DemonCirConf.enterMoney*(t.itemCount-e);return Actor.yb<i?void TipsCT.ins().showTips("元宝不足"):(DemonCir.ins().sendEnterFb(),void ViewManager.ins().close(FbWin))},e.prototype.onMonster=function(t){switch(t.currentTarget){case this.monCom0:this.selLayer=1;break;case this.monCom1:this.selLayer=2;break;case this.monCom2:this.selLayer=3}this.selectLayer()},e.prototype.onUpdate=function(){this.updateBossInfo(),this.selectLayer()},e.prototype.updateBossInfo=function(){for(var t=CommonUtils.arraySort(CommonUtils.objectToArrayShallow(GlobalConfig.DemonCirFbConf),"id"),e=0;e<this.monArr.length;e++)this.monArr[e].data=t[e];this.selLayer=DemonCir.ins().curLayerId},e.prototype.selectLayer=function(){for(var t=0;t<this.monArr.length;t++)this.monArr[t].setSelected(!1);this.monArr[this.selLayer-1].setSelected(!0);var e=GlobalConfig.DemonCirFbConf,i=e[this.selLayer];this.nameLabel.text="第"+i.id+"关  "+i.fbName,this.dataArr.source=i.showAward;var n=DemonCir.ins().layerData[this.selLayer-1];this.challengeBtn.visible=!0,this.alreadyTxt.visible=!1,2==n&&(this.alreadyTxt.visible=!0,this.challengeBtn.visible=!1);var s=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId);this.num.text=""+s,this.needNum.text="/"+i.itemCount},e}(BaseView);__reflect(DemonCircleFbWin.prototype,"DemonCircleFbWin"),window.DemonCircleFbWin=DemonCircleFbWin;var DemonCircleResultWin=function(t){function e(){var e=t.call(this)||this;return e.winResult=0,e.repeatTimes=20,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DemonCircleResultSkin",this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;var n=e[0];this.winResult=n,this.bg.source=n?"win_png":"lost_png",this.title.source=n?"win_02":"lost_02",this.s=this.repeatTimes,this.updateCloseBtnLabel(),Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var s=e[1];this.addTouchEvent(this.quitBtn,this.onTap),this.addTouchEvent(this.endBtn,this.onTap),this.addTouchEvent(this.carryOnBtn,this.onTap),s&&this.setRewardList(s);var o=GlobalConfig.DemonCirFbConf[DemonCir.ins().curLayerId],a=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId);this.costTxt.text=a+"/"+o.itemCount,this.eTip.visible=this.costImg.visible=this.costTxt.visible=!DemonCir.ins().isAllPass,this.quitBtn.visible=!0,this.carryOnBtn.visible=!0,this.endBtn.visible=!1,DemonCir.ins().isLastLayer()&&(this.quitBtn.visible=!1,this.carryOnBtn.visible=!1,this.endBtn.visible=!0)},e.prototype.setRewardList=function(t){void 0===t&&(t=[]),this.rewardList.dataProvider=new eui.ArrayCollection(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),ViewManager.ins().isShow(HuntWarnBuyWin)&&ViewManager.ins().close(HuntWarnBuyWin)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&(ViewManager.ins().close(this),FbCT.ins().sendExitFb()),this.quitBtn.visible&&(this.quitBtn.label="放弃挑战("+this.s+"s)"),this.endBtn.visible&&(this.endBtn.label="领取奖励("+this.s+"s)")},e.prototype.onTap=function(t){var i=this;switch(t.currentTarget){case this.quitBtn:var n=GlobalConfig.DemonCirFbConf[DemonCir.ins().curLayerId];WarnWin.show(n.quitHint,function(){ViewManager.ins().close(i),FbCT.ins().sendExitFb()},this);break;case this.endBtn:ViewManager.ins().close(this),FbCT.ins().sendExitFb();break;case this.carryOnBtn:var s=GlobalConfig.DemonCirFbConf[DemonCir.ins().curLayerId],o=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId);if(o<s.itemCount)return void HuntWarnBuyWin.showBuyWarn("DemonCircleFbWin",this.huntWarnFun.bind(this),"恶魔卷轴数量不足，是否花费"+GlobalConfig.DemonCirConf.enterMoney*(s.itemCount-o)+"元宝购买卷轴进行挑战？");DemonCir.ins().sendEnterFb(),ViewManager.ins().close(e)}},e.prototype.huntWarnFun=function(){var t=GlobalConfig.DemonCirFbConf[DemonCir.ins().curLayerId],i=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.DemonCirConf.enterItemId),n=GlobalConfig.DemonCirConf.enterMoney*(t.itemCount-i);return Actor.yb<n?void TipsCT.ins().showTips("元宝不足"):(DemonCir.ins().sendEnterFb(),void ViewManager.ins().close(e))},e}(BaseEuiView);__reflect(DemonCircleResultWin.prototype,"DemonCircleResultWin"),ViewManager.ins().reg(DemonCircleResultWin,LayerManager.UI_Popup),window.DemonCircleResultWin=DemonCircleResultWin;var DemonSceneWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="DemonSceneSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.DemonCirFbConf,n=i[DemonCir.ins().curLayerId];this.nameTxt.text=""+n.fbName},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(DemonSceneWin.prototype,"DemonSceneWin"),ViewManager.ins().reg(DemonSceneWin,LayerManager.UI_Main),window.DemonSceneWin=DemonSceneWin;var FBChallengePanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=SkyItemRenderer,this.iconList.itemRenderer=ItemBase,this.iconList0.itemRenderer=ItemBase,this.addTouchEvent(this.challengeBtn,this.challenge),this.addTouchEvent(this.challengeBtn0,this.getDayRewward),this.addTouchEvent(this.jump,this.onClick),this.addTouchEvent(this.choujiang,this.lotto)},e.prototype.addDisplay=function(){this.refushPanelInfo(),this.observe(FbRedPoint.ins().postTongTian,this.updateRedPoint),this.observe(Fb2CT.ins().postGetReward,this.updateReward),this.observe(Rank.ins().postRankingData,this.initRanking),this.observe(Fb2CT.ins().postUpDataInfo,this.updateRedPointStyle),Rank.ins().sendGetRankingData(RankDataType.TYPE_COPY),this.updateRedPoint(),this.showRewwardLabel(),this.eDailtGroup.visible=!LocationProperty.isIosTS},e.prototype.updateRedPointStyle=function(){this.redPoint0.visible=SkyLevelModel.ins().cruLevel>1&&1==SkyLevelModel.ins().dayReward,this.redPoint1.visible=SkyLevelModel.ins().lotteryRemainTimes>0,this.updateTowerState()},e.prototype.lotto=function(t){0==SkyLevelModel.ins().cruLevel&&0==SkyLevelModel.ins().rewardTimes?TipsCT.ins().showTips("已全部通关"):ViewManager.ins().open(BabelLotteryWin)},e.prototype.updateReward=function(){this.showRewwardLabel()},e.prototype.initRanking=function(t){if(t.type==RankDataType.TYPE_COPY){this.rankModel=t;for(var e=t.getDataList(),i=1;3>=i;i++){var n=e[i-1];if(n){this["name"+(i-1)].text=n.player;var s=GlobalConfig.FbChallengeConfig[n.count];Assert(s,"排行榜数据，爬塔异常：id("+n.count+")")?this["num"+(i-1)].text="":this["num"+(i-1)].text=s.group+"重天"+s.layer+"层"}else this["rankImg"+(i-1)].visible=this["name"+(i-1)].visible=this["num"+(i-1)].visible=!1}var o=this.jump.text;this.jump.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)}},e.prototype.refushPanelInfo=function(){var t=SkyLevelModel.ins().getSkyLevelList();this.list.dataProvider=new eui.ArrayCollection(t);var i=GlobalConfig.FbChNameConfig[SkyLevelModel.ins().stageLevel];this.nameLabel.text=i?i.name:"";var n=SkyLevelModel.ins(),s=n.getNextOpenLevel();if(s){var o=GlobalConfig.FbChNameConfig[s.group],a="通关"+o.name+s.layer+"层",r="";if(s.equipPos)r="第"+s.equipPos+"个图腾槽",this.noOpenTF.text=r,this.unlock.text="开启图腾槽",this.itemicon.runeName=r,this.itemicon.desc2=""+o.name+s.layer+"层",this.itemicon.data=s.showIcon;else{this.itemicon.desc="通关"+o.name+s.layer+"层解锁",this.itemicon.data=s.showIcon;var l=GlobalConfig.ItemConfig[s.showIcon],h=ItemUtil.getQuality(l),u="解锁新类型";h==e.RunType&&(u="获得"),this.unlock.text=u}this.openDesc.text=a}else this.topGroup.visible=!1,this.buttomGroup.verticalCenter=0;var p=GlobalConfig.FbChallengeConfig[n.cruLevel];if(p){this.nowrawed.text="通关第"+p.layer+"层奖励";var c="",d=p.zsLevelLimit;d&&(c=d?d.toString()+"转":""),this.limit.text=""+c+p.levelLimit+"级可继续挑战",this.iconList.dataProvider=new eui.ArrayCollection([p.reward[0]]),this.iconList0.dataProvider=new eui.ArrayCollection([p.reward[1]]),this.expText.text=p.reward[2]?""+p.reward[2].count:"";var g=Actor.level>=p.levelLimit&&ZsCT.ins().lv>=p.zsLevelLimit;this.limit.visible=!g,this.challengeBtn.visible=g,this.endImg.visible=p.layer<=4}},e.prototype.updateRedPoint=function(){var t=FbRedPoint.ins(),e=t.mrjl,i=t.xyzp;this.redPoint0.visible=e,this.redPoint1.visible=i,this.updateTowerState()},e.prototype.updateTowerState=function(){var t=!0;0!=SkyLevelModel.ins().cruLevel&&SkyLevelModel.ins().cruLevel-1<GlobalConfig.FbChallengeBaseConfig.LotteryOpenLevel&&(t=!1),this.dailyGift0.visible=t,this.choujiang.visible=t},e.prototype.challenge=function(){return FbCT.ins().checkInFB()?void 0:SkyLevelModel.ins().lastPass?void TipsCT.ins().showTips("当前已全部通关"):void(KfArenaSys.ins().checkIsMatching()&&(Fb2CT.ins().sendChallenge(),ViewManager.ins().closeTopLevel()))},e.prototype.getDayRewward=function(){return SkyLevelModel.ins().cruLevel<=1?void TipsCT.ins().showTips("通关一层后，明日0点可领取每日奖励，通关层数越高，奖励越好"):SkyLevelModel.ins().dayReward<1?void TipsCT.ins().showTips("今天没有奖励可以领取"):2==SkyLevelModel.ins().dayReward?void TipsCT.ins().showTips("明日0点可领取每日奖励，通关层数越高，奖励越好"):void ViewManager.ins().open(ChallengeDayRewardWin)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.jump:this.rankModel&&ViewManager.ins().open(FBChallengeRankWin,this.rankModel)}},e.prototype.showRewwardLabel=function(){var t="";t=1==SkyLevelModel.ins().dayReward?"可领取":"明日0点可领取",this.dailyGift.text=t},e.RunType=3,e}(BaseView);__reflect(FBChallengePanel.prototype,"FBChallengePanel"),window.FBChallengePanel=FBChallengePanel;var FBChallengeRankItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChuangtianguanRankItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data&&(this.data.pos>3?(this.rankImg.visible=!1,this.rank.visible=!this.rankImg.visible,this.rank.text=this.data.pos+""):(this.rankImg.visible=!0,this.rank.visible=!this.rankImg.visible,this.rankImg.source="paihang"+this.data.pos),this.vip.visible=this.data.vip,this.nameLabel.text=this.data.player,this.data.count)){var t=GlobalConfig.FbChallengeConfig[this.data.count],e=GlobalConfig.FbChNameConfig[t.group];this.cengNum.text=""+e.name+t.layer+"层"}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(FBChallengeRankItem.prototype,"FBChallengeRankItem"),window.FBChallengeRankItem=FBChallengeRankItem;var FBChallengeRankWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChuangtianguanRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.rankModel=t[0],this.list0.itemRenderer=FBChallengeRankItem,this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.init=function(){var t=this.rankModel.getDataList(),e=[];for(var i in t){if(!t[i].count)break;e.push(t[i])}this.list0.dataProvider=new eui.ArrayCollection(e);var n,s,o=e[this.rankModel.selfPos-1];if(o)n=GlobalConfig.FbChallengeConfig[o.count],s=GlobalConfig.FbChNameConfig[n.group],this.myRank.text="我的排名："+this.rankModel.selfPos;else{var a=SkyLevelModel.ins();n=GlobalConfig.FbChallengeConfig[a.cruLevel],s=GlobalConfig.FbChNameConfig[n.group],this.myRank.text="我的排名：未上榜"}n&&s&&(this.myNum.text=""+s.name+n.layer+"层")},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(FBChallengeRankWin.prototype,"FBChallengeRankWin"),ViewManager.ins().reg(FBChallengeRankWin,LayerManager.UI_Popup),window.FBChallengeRankWin=FBChallengeRankWin;var FBCountDown=function(t){function e(){var e=t.call(this)||this;return e._count=1,e.skinName="FBCountDownSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(GameMap.fbType){case FbCT.FB_TYPE_PEAKED:t[0]&&(this._count=t[0]),this.bgImg.source="peakness_start_fight";break;default:return}Timer.stop(this.upFun,this),Timer.start(1e3,this._count+1,this.upFun,this),this.upFun()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
Timer.stopAll(this)},e.prototype.upFun=function(){this.countDown.text=this._count+"",this._count--,this._count<0&&ViewManager.ins().close(e)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(GameMap.fbType){case FbCT.FB_TYPE_PEAKED:break;default:return!1}return!0},e}(BaseEuiView);__reflect(FBCountDown.prototype,"FBCountDown"),ViewManager.ins().reg(FBCountDown,LayerManager.UI_Popup),window.FBCountDown=FBCountDown;var FbExpPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){this.observe(FbCT.ins().postFbExpInfo,this.onUpdate),this.onUpdate()},e.prototype.canSD=function(){return GameServer.serverOpenDay>GlobalConfig.ExpFubenBaseConfig.sweepday&&1e3*ZsCT.ins().lv+Actor.level>=GlobalConfig.ExpFubenBaseConfig.sweepLv||Recharge.ins().franchise>0?!0:!1},e.prototype.onUpdate=function(){var t=this.canSD(),e=FbCT.ins().fbExp;if(e){var i=0,n=CommonUtils.getObjectLength(GlobalConfig.ExpConfig);if(Actor.level>=n)return void(this.currentState="max");e.cid||e.sid?e.cid?(i=1,this.currentState="free"):(i=3,this.currentState="sdget"):t?(i=2,this.currentState="sdfb"):(i=0,this.currentState="challenge"),this.validateNow(),this.onInitIndex(i),this.btnSD.parent.visible=t,this.eRedLine.visible=this.eFree.visible=this.eGuideArrow.visible=!e.hasGetFree,this.eGuideArrow.lab.text="首次免费领取",this.btnGet0.enabled=this.btnGet1.enabled=e.hasGetFree}},e.prototype.getChangeNum=function(t){void 0==t&&(t=Actor.vip);var e=GlobalConfig.ExpFubenBaseConfig.freeCount;return(GlobalConfig.ExpFubenBaseConfig.vipCount[t]||0)+e},e.prototype.getSdNum=function(t){return GlobalConfig.ExpFubenBaseConfig.vipBuyCount[t]},e.prototype.onInitIndex=function(t){var e=FbCT.ins().fbExp,i=FbCT.ins().getExpFbId();if(0!=i){var n=GlobalConfig.MonthCardConfig.expFubenPrecent/100,s=Recharge.ins().getIsForeve()?1+n:1,o=Math.floor(GlobalConfig.ExpFubenConfig[i].exp*s);if(0==t)if(this.lbTime.text="今日可挑战次数："+(this.getChangeNum()-e.useTime),this.lbExp.text=""+o,this.getChangeNum()>e.useTime)this.btnChallenge.enabled=!0;else{this.btnChallenge.enabled=!1;for(var a=Actor.vip+1,r=this.getChangeNum(a);void 0!=r&&r<=e.useTime&&(a+=1,r=this.getChangeNum(a),void 0!=GlobalConfig.ExpFubenBaseConfig.vipCount[a]););r-e.useTime>0&&(this.lbTime.text=VipCT.getVipStr(a,!0)+"可挑战次数+"+(r-e.useTime))}else if(2==t){this.barGroup.visible=!1,this.btnSD.visible=!0,this.bar.value=0,this.lbExp.text=""+o;var l=this.getSdNum(Actor.vip);if(e.sdTime>=(l||0)){for(var a=Actor.vip+1,r=this.getSdNum(a);void 0!=r&&l>=r;)a+=1,r=this.getSdNum(a);this.lbVip0.visible=!1,r&&r>l?(this.lbVip.textFlow=TextFlowMaker.generateTextFlow1("|C:0xf3311e&T:"+VipCT.getVipStr(a,!0)+"|可额外扫荡"+(r-l)+"次"),this.lbVip.visible=!0,this.btnSD.enabled=!1):void 0==r?(this.lbVip.textFlow=TextFlowMaker.generateTextFlow1("今日扫荡次数已用完"),this.lbVip.visible=!0,this.btnSD.enabled=!1):(this.lbVip.visible=!1,this.btnSD.enabled=!0)}else this.lbVip.visible=!1,this.lbVip0.visible=!0,this.lbVip0.textFlow=TextFlowMaker.generateTextFlow1("今日可扫荡次数"+(l-e.sdTime)+"次"),this.btnSD.enabled=!0}else if(1==t||3==t){for(var h=GlobalConfig.ExpFubenConfig[e.cid||e.sid].exp*s,u=0;3>u;u++){this["lbExp"+u].textFlow=TextFlowMaker.generateTextFlow1("经验："+h*(u+1));var p=0;p=1==t?GlobalConfig.ExpFubenBaseConfig.recPrice[u]:GlobalConfig.ExpFubenBaseConfig.buyPrice[u],this["gold"+u].setPrice(p)}0==Setting.ins().getValue(ClientSet.expFirst)&&(this.eff||(this.eff=new MovieClip,this.eff.scaleX=.75,this.eff.scaleY=.75,this.eff.touchEnabled=!1,this.eff.x=this.btnGet2.x+this.btnGet2.width/2,this.eff.y=this.btnGet2.y+this.btnGet2.height/2,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.g2.addChild(this.eff)))}}},e.prototype.onTap=function(t){var e=this,i=t.target;if(this.checkBtnGet(i));else if(i==this.btnChallenge){if(!KfArenaSys.ins().checkIsMatching())return;if(FbCT.ins().checkInFB())return;FbCT.ins().sendChallengeExpFb()}else i==this.btnSD&&0==this.barGroup.visible&&(this.btnSD.enabled=!1,this.barGroup.visible=!0,this.lbVip.visible=!1,this.lbVip0.visible=!1,this.bar.maximum=100,this.bar.value=0,egret.Tween.get(this.bar).to({value:100},2e3).call(function(){e.btnSD.enabled=!0,e.barGroup.visible=!1,FbCT.ins().sendSaodang()}))},e.prototype.checkBtnGet=function(t){var e=this,i=FbCT.ins().fbExp,n=0;if(t==this.btnGet0?n=1:t==this.btnGet1?n=2:t==this.btnGet2&&(n=3),n>0){var s=i.cid?0:1,o=GlobalConfig.ExpFubenBaseConfig.recPrice[n-1];if(i.hasGetFree&&Actor.yb<o)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");if(3!=n&&0==Setting.ins().getValue(ClientSet.expFirst)){if(1==n&&Actor.level<80)this.sendGetAward(s,n,t),DisplayUtils.removeFromParent(this.eff),this.eff=null;else{var a="是否领取"+n+"倍奖励，领取后您的等级将会落后一大截，强烈推荐3倍领取";0!=o&&(a="是否花费<font color='#FFB82A'>"+o+"元宝</font>领取"+n+"倍奖励，领取后您的等级将会落后一大截，强烈推荐3倍领取");var r=WarnWin.show(a,function(){e.sendGetAward(s,n,t),Setting.ins().setValue(ClientSet.expFirst,1),DisplayUtils.removeFromParent(e.eff),e.eff=null},this);r.setBtnLabel("领取")}return}0==o?this.sendGetAward(s,n,t):this.sendGetAward(s,n,t)}return n>0},e.prototype.sendGetAward=function(t,e,i){var n=FbCT.ins().fbExp,s=GlobalConfig.ExpFubenConfig[n.cid||n.sid];if(s){var o=s.exp,a=CommonUtils.getObjectLength(GlobalConfig.ExpConfig);if(Actor.level>=a)return void TipsCT.ins().showTips("角色等级已达到上限，获取经验失败");var r=this.getFlyTime(o*e),l=Math.floor(r/15);Timer.start(15,l,function(){var t=1;switch(e){case 2:t=2;break;case 3:t=9}FbCT.ins().postExpFly(i.parent.localToGlobal(i.x+i.width/2,i.y+i.height/2),t)},this),egret.Tween.get(i).wait(1100).call(function(){FbCT.ins().sendGetAwardMul(t,e)})}},e.prototype.getFlyTime=function(t){for(var e=0,i=Actor.level,n=Actor.exp,s=GlobalConfig.ExpConfig[i].exp;t>0&&t>s-n;)e+=1,i+=1,t-=s-n,s=GlobalConfig.ExpConfig[i].exp,n=0;return 0==e?400:400*(e+1)-200},e}(BaseView);__reflect(FbExpPanel.prototype,"FbExpPanel"),window.FbExpPanel=FbExpPanel;var FbWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastSelectIndex=-1,e._sn_="DailyFbSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t[0]||0,s=t[1]||0;switch(n){case 0:var o=DailyFbPanel.checkIndexOpen(s);if(!o)return o;break;case 1:var a=GlobalConfig.FbChallengeConfig[1];if(Actor.level<a.levelLimit)return TipsCT.ins().showTips(a.levelLimit+"级可挑战"),!1;break;case 2:if(!FbCT.ins().isTeamFBOpen())return TipsCT.ins().showTips("开服第"+GlobalConfig.TeamFuBenBaseConfig.openDay+"天并达到"+GlobalConfig.TeamFuBenBaseConfig.needZsLv+"转开启"),!1;break;case 3:var r=Hungu.ins().checkOpen(!0);if(!r)return r}return e.isClose||ViewManager.ins().close(LiLianWin),e.isClose=!1,!0},e.prototype.skinComplete=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=FbRedPoint.ins();this.associated(this.updateRedPoint,i.postRiChang,i.postTongTian,i.postShenBin,i.postChuanQi);var n=t[0]||0,s=t[1]||0;this.viewStack.selectedIndex=n,0==n&&(this.dailyFbPanel.select=s),this.tab.selectedIndex=n,this.tab.validateNow(),this.setOpenIndex(n,s),this.updateRedPoint()},e.prototype.updateRedPoint=function(){if(this.skin){var t=FbRedPoint.ins(),e=t.richang,i=t.tongtian,n=t.chuanqi,s=t.mhzd;this.tab.getChildAt(0)&&this.tab.getChildAt(0).eRp&&(this.tab.getChildAt(0).eRp.visible=e,this.tab.getChildAt(1).eRp.visible=i,this.tab.getChildAt(2).eRp.visible=n,this.tab.getChildAt(3).eRp.visible=s)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:var e=this.tab.selectedIndex,i=[0,0,37,0,44];ViewManager.ins().open(ZsBossRuleSpeak,i[e]);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t,i){if(void 0===i&&(i=0),!e.openCheck(t))return this.setOpenIndex(this.lastSelectIndex),void(this.tab.selectedIndex=this.lastSelectIndex);if(this.lastSelectIndex>-1)switch(this.lastSelectIndex){case 0:}this.lastSelectIndex=t,this.help.visible=4==t},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.checkIsOpen=function(t){var i=t.target;return e.openCheck(i.selectedIndex)?(ViewManager.ins().close(LiLianWin),void ViewManager.ins().close(LimitTaskView)):void t.preventDefault()},e}(BaseEuiView);__reflect(FbWin.prototype,"FbWin"),ViewManager.ins().reg(FbWin,LayerManager.UI_Main),window.FbWin=FbWin;var GuanQiaWorldMapItem=function(t){function e(){var e=t.call(this)||this;return e.chapter=0,e.rewardChapter=-1,e.skinName="CheckMapItemSkin",e.observe(FbCT.ins().postZhangJieAwardChange,e.reflashChapter),e.observe(FbCT.ins().postGuanqiaWroldReward,e.reflashChapter),e.addTouchEvent(e,e.onClick),e.mc=new MovieClip,e.mc.x=e.mc.y=32,e.mc.scaleX=.45,e.mc.scaleY=1.2,e.rewardGroup.addChild(e.mc),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reflashChapter()},e.prototype.close=function(){egret.Tween.removeTweens(this.rewardGroup)},e.prototype.onClick=function(t){var e=GlobalConfig.WorldRewardConfig[this.chapter];FbCT.ins().guanqiaID>e.needLevel?FbCT.ins().sendGuanqiaWroldReward(this.chapter):FbCT.ins().isGetReceiveBox(this.chapter)||TipsCT.ins().showTips("还需要"+(e.needLevel-FbCT.ins().guanqiaID+1)+"关可领取")},e.prototype.reflashChapter=function(){this.update(this.chapter)},e.prototype.update=function(t){this.chapter=t,this.rewardChapter=-1;var e=GlobalConfig.WorldRewardConfig[t],i=GlobalConfig.WorldRewardConfig[t-1];this.itemIcon.setData(GlobalConfig.ItemConfig[e.rewards[0].id]);var n=1;i&&(n=i.needLevel+1),this.nameTxt.text=e?e.id+"."+e.name:"",this.chapterCount.text=n+"-"+e.needLevel+"关",FbCT.ins().guanqiaID<=e.needLevel&&FbCT.ins().guanqiaID>=n?this.box.source=e.icon+"c":this.box.source=e.icon;var s=0;s=n-FbCT.ins().guanqiaID,this.passImg.visible=!1;var o=this.rewardGroup.y,a=o-10;egret.Tween.removeTweens(this.rewardGroup),FbCT.ins().guanqiaID>e.needLevel?FbCT.ins().isGetReceiveBox(t)?(this.mc.visible=!1,this.mc.stop(),this.rewardGroup.visible=!1,this.passImg.visible=!0):(this.rewardGroup.visible=!0,this.mc.visible=!0,this.rewardChapter=t,this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1),egret.Tween.get(this.rewardGroup,{loop:!0}).to({y:a},1e3).to({y:o},1e3)):(this.rewardGroup.visible=FbCT.ins().guanqiaID<=e.needLevel&&FbCT.ins().guanqiaID>=n,this.mc.visible=!1,this.mc.stop())},e}(BaseView);__reflect(GuanQiaWorldMapItem.prototype,"GuanQiaWorldMapItem"),window.GuanQiaWorldMapItem=GuanQiaWorldMapItem;var GuanQiaWorldRewardWin=function(t){function e(){var e=t.call(this)||this;return e.isReceive=!1,e.pass=0,e.rewardCount=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CheckWorldRewardSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.update(e[0])},e.prototype.close=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.close.call(this,e),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap)},e.prototype.update=function(t){this.isReceive=FbCT.ins().isReceiveBox(t),this.pass=t>0?t:1;var e=GlobalConfig.WorldRewardConfig[this.pass];this.rewardCount=e.rewards.length,this.specialItem0.data=e.rewards[0],this.specialItem1.data=e.rewards[1],this.specialItem2.data=e.rewards[2],this.specialItem3.data=e.rewards[3];var i,n;if(t>1){var s=GlobalConfig.WorldRewardConfig[this.pass-1];i=this.getLevelStr(s.needLevel,e.needLevel),n=s.needLevel+1+"-"+e.needLevel}else i=this.getLevelStr(e.needLevel-1,e.needLevel),n=""+e.needLevel;this.requireLabel.text="通关第"+n+"章（"+i+"关）的奖励",this.isReceive?this.closeBtn0.label="领取":this.closeBtn0.label="确定"},e.prototype.getLevelStr=function(t,e){return 10*t+1+"-"+10*e},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.closeBtn0:this.isReceive?this.sendReceiveReward():TipsCT.ins().showTips("|C:0xf3311e&T:通关地图才能领取奖励|"),ViewManager.ins().close(this)}},e.prototype.sendReceiveReward=function(){BagCT.ins().getSurplusCount()>=this.rewardCount?FbCT.ins().sendGuanqiaWroldReward(this.pass):TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请清理背包|")},e}(BaseEuiView);__reflect(GuanQiaWorldRewardWin.prototype,"GuanQiaWorldRewardWin"),ViewManager.ins().reg(GuanQiaWorldRewardWin,LayerManager.UI_Popup),window.GuanQiaWorldRewardWin=GuanQiaWorldRewardWin;var PlayWayItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayWayItemSkin",e.eInfo.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+e.eInfo.text),e}return __extends(e,t),e.prototype.dataChanged=function(){if(null!=this.data&&!isNaN(this.data)){var t=this.data;switch(this.redPoint.visible=!1,this.eOpenLab.visible=!1,this.eTime.visible=!1,t){case PlayWayPanel.TYPE_WORLDBOSS:this.eBg.source="pwsjboss_png";var e=GlobalConfig.NewWorldBossBaseConfig.openSevDay,i="开服第"+e+"天起 每天 19:30 开启";if(GameServer.serverOpenDay+1<e)this.time.textFlow=TextFlowMaker.generateTextFlow1(i);else{var n=i.split("每天");this.time.textFlow=TextFlowMaker.generateTextFlow1("每天"+n[1])}break;case PlayWayPanel.TYPE_CITY:this.eBg.source="pwyzbq1_png",this.time.textFlow=TextFlowMaker.generateTextFlow1("每周一、三、五20:00开启"),this.redPoint.visible=BattleCC.ins().checkRedPoint();break;case PlayWayPanel.TYPE_PAODIAN:this.eBg.source=2==PaoDianCC.ins().paoDianType?"pwjqpd2_png":"pwjqpd_png",this.time.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PassionPointConfig.openTips),this.redPoint.visible=PaoDianCC.ins().checkRedPoint()}}},e}(BaseItemRender);__reflect(PlayWayItem.prototype,"PlayWayItem"),window.PlayWayItem=PlayWayItem;var PlayWayPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.types=[e.TYPE_WORLDBOSS,e.TYPE_CITY,e.TYPE_PAODIAN],this.eList.itemRenderer=PlayWayItem,this.eList.dataProvider=new eui.ArrayCollection(this.types),this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){this.observe(BattleCC.ins().postOpenInfo,this.update),this.observe(Actor.ins().postLevelChange,this.update),this.observe(PaoDianCC.ins().postOpenInfo,this.update),this.update()},e.prototype.update=function(){this.eList.dataProvider=new eui.ArrayCollection(this.types)},e.prototype.close=function(){},e.prototype.onTap=function(t){if(t.target.parent.parent instanceof PlayWayItem){var i=t.target.parent.parent.data;if(t.target instanceof eui.Label)switch(i){case e.TYPE_WORLDBOSS:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[18].text);break;case e.TYPE_CITY:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[17].text);break;case e.TYPE_PAODIAN:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[2==PaoDianCC.ins().paoDianType?49:20].text)}else if(t.target instanceof eui.Button)switch(i){case e.TYPE_WORLDBOSS:BossCT.ins().checkBossOpen();break;case e.TYPE_CITY:BattleCC.ins().checkBattleOpen();break;case e.TYPE_PAODIAN:PaoDianCC.ins().checkPaodianOpen()}}},e.TYPE_WORLDBOSS=0,e.TYPE_CITY=1,e.TYPE_PAODIAN=2,e.TYPE_KFPVP=3,e.TYPE_DART=4,e}(BaseView);__reflect(PlayWayPanel.prototype,"PlayWayPanel"),window.PlayWayPanel=PlayWayPanel;var SkyItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.skinName="chuangtianguanItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t&&(this.passAllTip0.text=t.layer+"层",this.currentState=t.id==SkyLevelModel.ins().cruLevel?"down":"up")},e}(eui.ItemRenderer);__reflect(SkyItemRenderer.prototype,"SkyItemRenderer"),window.SkyItemRenderer=SkyItemRenderer;var ThunderBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ThunderBossSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList.itemRenderer=ItemBase,this.itemCollect=new eui.ArrayCollection,this.itemList.dataProvider=this.itemCollect},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.layerId=t[0],this.addTouchEvent(this.eCloseRect,this.onClick),this.addTouchEvent(this.eFireBtn,this.onClick),this.update()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.update=function(){var t=GlobalConfig.FBLeiTingConf[this.layerId];if(t){this.bossMc||(this.bossMc=new MovieClip,this.Boss.addChild(this.bossMc));var e=GlobalConfig.MonstersConfig[t.bossId];this.bossMc.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1),this.eBossLab.text=e.name,this.ePowerLab.text="推荐战力："+t.RecPower,this.eNumLab.text=this.layerId+"",this.itemCollect.source=t.reward}},e.prototype.onClick=function(t){switch(t.target){case this.eCloseRect:ViewManager.ins().close(this);break;case this.eFireBtn:ThunderCT.ins().remainNum<=0?TipsCT.ins().showTips("挑战次数已用完，请明日再来"):(ViewManager.ins().close(FbWin),ViewManager.ins().close(this),ThunderCT.ins().sendEnterThunder())}},e}(BaseEuiView);__reflect(ThunderBossWin.prototype,"ThunderBossWin"),ViewManager.ins().reg(ThunderBossWin,LayerManager.UI_Popup),window.ThunderBossWin=ThunderBossWin;var ThunderFBItem=function(t){function e(){var e=t.call(this)||this;return e.layerId=0,e}return __extends(e,t),e.prototype.update=function(t){var e=GlobalConfig.FBLeiTingConf[t];if(!e||!this.skin)return void(this.visible=!1);this.layerId=t,this.visible=!0,this.eHead.source=e.bossIcon+"_png";var i=ThunderCT.ins().getLayerStatus(t);switch(this.eBossName.text=e.name,i){case 0:this.ePass.visible=!1,this.redPoint.visible=!0,this.eFiltersGroup.filters=[];break;case 1:this.eFiltersGroup.filters=[],this.ePass.visible=!0,this.ePass.source="11a_png",this.redPoint.visible=!1;break;case 2:this.eFiltersGroup.filters=FilterUtil.ARRAY_GRAY_FILTER,this.ePass.visible=!0,this.ePass.source="11b_png",this.redPoint.visible=!1}},e}(BaseView);__reflect(ThunderFBItem.prototype,"ThunderFBItem"),window.ThunderFBItem=ThunderFBItem;var ThunderFBPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){this.fbItems=[this.eItem1,this.eItem2,this.eItem3,this.eItem4,this.eItem5,this.eItem6],this.observe(ThunderCT.ins().postThunderFBInfo,this.onUpdate),this.onUpdate()},e.prototype.onClick=function(t){if(t.target instanceof ThunderFBItem)switch(ThunderCT.ins().getLayerStatus(t.target.layerId)){case 0:ViewManager.ins().open(ThunderBossWin,t.target.layerId);break;case 1:break;case 2:TipsCT.ins().showTips("请挑战前置关卡")}},e.prototype.onUpdate=function(){for(var t,i=GlobalConfig.LeitingEquipBaseConf.towerUnlock,n=0;n<i.length;n++)if(i[n][0]>=ThunderCT.ins().curLayerId){t=i[n];break}if(t){var s=t[1];this.eTips.text="通关第"+t[0]+"关可解锁";var o=this.equip.itemIcon;o.imgJob.visible=!1,this.equip.level.text="",o.imgIcon.source="lt"+(s>9?s:"0"+s),this.eunLockLab.text=ThunderCT.firstName+ThunderCT.equipNames[s]+"装备位",this.eTipGroup.visible=!0}else this.eTipGroup.visible=!1;this.eChallengesLab.visible=null!=GlobalConfig.FBLeiTingConf[ThunderCT.ins().curLayerId],this.eOver.visible=!this.eChallengesLab.visible,this.eChallengesLab.text="今日可挑战次数："+ThunderCT.ins().remainNum;for(var a=MathUtils.toInteger((ThunderCT.ins().curLayerId-1)/e.MAX_NUM),n=1;n<=e.MAX_NUM;n++)this.fbItems[n-1].update(a*e.MAX_NUM+n)},e.MAX_NUM=6,e}(BaseView);__reflect(ThunderFBPanel.prototype,"ThunderFBPanel"),window.ThunderFBPanel=ThunderFBPanel;var BabelLotteryItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.rewardState=function(t){t?this.currentState="yilingqu":this.currentState="weilingqu"},e.prototype.changeEquipEffect=function(t){var e=this.itemIcon.EquipEffect||new MovieClip;e.x=44,e.y=36,this.itemIcon.addChild(e),e.playFile(RES_DIR_EFF+t,-1),this.itemIcon.EquipEffect=e},e}(eui.Component);__reflect(BabelLotteryItem.prototype,"BabelLotteryItem"),window.BabelLotteryItem=BabelLotteryItem;var DemonCircleMonsterItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="DemonCircleMonsterItemSkin",e.bossImage=new MovieClip,e.bossImage.x=20,e.bossImage.y=70,e.monsterGroup.addChild(e.bossImage),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.bossImage.scaleX=t.scaleValue,this.bossImage.scaleY=t.scaleValue,this.monsterNameImg.source=t.bosNameImg,this.stateImg.visible=this.noChallge.visible=!1,this.bossImage.playFile(RES_DIR_MONSTER+(""+t.bossModel),-1),this.monsterGroup.filters=null,0==DemonCir.ins().layerData[t.id-1]?this.noChallge.visible=!0:1==DemonCir.ins().layerData[t.id-1]||2==DemonCir.ins().layerData[t.id-1]&&(this.stateImg.visible=!0,this.monsterGroup.filters=FilterUtil.ARRAY_GRAY_FILTER)},e.prototype.setSelected=function(t){this.selectedImg&&(this.selectedImg.visible=t)},e}(BaseItemRender);__reflect(DemonCircleMonsterItem.prototype,"DemonCircleMonsterItem"),window.DemonCircleMonsterItem=DemonCircleMonsterItem;var HunShouFBWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.itemList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){this.observe(Hungu.ins().postHunShouFBInfo,this.update),this.observe(Hungu.ins().postSweepHunShouFB,this.updateTimes),this.update()},e.prototype.update=function(){this.updateTimes();var t=Hungu.ins().hunShouFBPassID?Hungu.ins().hunShouFBPassID+1:1;this._isMax=!1,t>Object.keys(GlobalConfig.FsFbConfig).length&&(this._isMax=!0,t--);var e=GlobalConfig.FsFbConfig[t];this._zsLvEough=ZsCT.ins().lv>=e.zsLevelLimit,this.zsLimit.textFlow=TextFlowMaker.generateTextFlow("|C:"+(this._zsLvEough?3532331:16711680)+"&T:挑战要求：人物"+e.zsLevelLimit+"转|"),this._collect||(this._collect=new eui.ArrayCollection,this.itemList.dataProvider=this._collect),this._collect.source=e.award,this.btnSweep.visible=GlobalConfig.HunGuConf.sweepLayer<=Hungu.ins().hunShouFBPassID,this.sweepInfoText.visible=this.sweepInfo.visible=this.btnSweep.visible,this.btnChallenge.visible=!this._isMax,this.btnChallenge.horizontalCenter=this.btnSweep.visible?109:0,this.max.visible=this._isMax,this.zsLimit.visible=!this._isMax,this.sweepInfo.visible&&(this.sweepInfo.text=Hungu.ins().hunShouFBPassID+""),this.bossName.source=e.pic,this._bossMc||(this._bossMc=ObjectPool.pop("MovieClip"),this.Boss.addChild(this._bossMc)),this._bossMc.playFile(RES_DIR_MONSTER+(GlobalConfig.MonstersConfig[e.monster].avatar+"_3s"),-1)},e.prototype.updateTimes=function(){this.lbTime.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|")},e.prototype.onTouch=function(t){switch(t.target){case this.btnSweep:case this.btnChallenge:if(!KfArenaSys.ins().checkIsMatching())return;if(!Hungu.ins().hunShouFBTimes)return void TipsCT.ins().showTips("剩余次数不足");if(t.target==this.btnSweep)Hungu.ins().sweepHunShouFB();else{if(!Hungu.ins().checkOpen(!0))return;this._isMax?TipsCT.ins().showTips("当前已通关"):(Hungu.ins().enterHunShouFB(),ViewManager.ins().close(LadderWin))}}},e}(BaseEuiView);__reflect(HunShouFBWin.prototype,"HunShouFBWin"),window.HunShouFBWin=HunShouFBWin;var HunShouSweepWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunshouSweepSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._id=t[0],this._rewards=t[1],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTouch)},e.prototype.update=function(){this.reward.dataProvider=new eui.ArrayCollection(this._rewards),this.times.textFlow=TextFlowMaker.generateTextFlow("|c:"+(Hungu.ins().hunShouFBTimes?3532331:16711680)+"&T:"+Hungu.ins().hunShouFBTimes+"|"),this.fbName.text=GlobalConfig.FsFbConfig[this._id].fbName},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.nextBtn:if(!Hungu.ins().hunShouFBTimes)return void TipsCT.ins().showTips("剩余次数不足");Hungu.ins().sweepHunShouFB()}},e}(BaseEuiView);__reflect(HunShouSweepWin.prototype,"HunShouSweepWin"),ViewManager.ins().reg(HunShouSweepWin,LayerManager.UI_Popup),window.HunShouSweepWin=HunShouSweepWin;var FriendListWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="friendListSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=FriendItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._des=t[0],this.addTouchEvent(this,this.onTouch),this.addTouchEvent(this.list,this.onListTap),this.observe(Friends.ins().postFriendChange,this.update),this.update()},e.prototype.close=function(){},e.prototype.update=function(){this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect),this._collect.source=Friends.ins().friendsList.source},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.onListTap=function(t){var e=this.list.selectedItem;e&&Friends.ins().sendChat(e,this._des,ChatFlag.Inside)},e}(BaseEuiView);__reflect(FriendListWin.prototype,"FriendListWin"),ViewManager.ins().reg(FriendListWin,LayerManager.UI_Popup),window.FriendListWin=FriendListWin;var GwbossqzWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="Gwbossqz",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch);var i=GlobalConfig.WorldBossBaseConfig.helpText;this.showText.text=i.replace("%s",GlobalConfig.WorldBossConfig[BossCT.ins().currBossConfigID].showName)},e.prototype.close=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.worldInviteBtn:if(BossCT.ins().cdCount){TipsCT.ins().showTips(BossCT.ins().cdCount+"秒后才能进行邀请");break}BossCT.ins().cdCount=60,Timer.has(BossCT.ins().resetCD,BossCT.ins())||Timer.start(1e3,0,BossCT.ins().resetCD,BossCT.ins()),BossCT.ins().sendHelpLottery("|C:0x16B2FF&T:"+Actor.myName+"|："+this.showText.text+"|E:3,"+BossCT.ins().currBossConfigID+","+BossCT.ins().currBossSubType+",&U:&C:65280&T:快速加入");case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GwbossqzWin.prototype,"GwbossqzWin"),ViewManager.ins().reg(GwbossqzWin,LayerManager.UI_Popup),window.GwbossqzWin=GwbossqzWin;var MemberInfoWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="memberInfoSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.type=t[1],this.addTouchEvent(this,this.onTouch),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.update()},e.prototype.close=function(){},e.prototype.update=function(){this.imgBg.source=ChatListItemRenderer.HEAD_BG[this._data.sex],this.imgHead.source="head_"+this._data.job+this._data.sex,this.labelName.text=this._data.roleName,this.labelLv.text=(this._data.zs?this._data.zs+"级":"")+this._data.lv+"级",this.btnRemove.visible=this.type?RareAnimalCT.ins().isTFCaptain:FbCT.ins().isTFCaptain},e.prototype.onTouch=function(t){switch(t.target){case this.btnInfo:ReadPlayerCT.ins().sendFindPlayer(this._data.roleID);break;case this.btnRemove:this.type?RareAnimalCT.ins().sendQuitMember(this._data.roleID):FbCT.ins().sendOutTFRoom(this._data.roleID),ViewManager.ins().close(this);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.openOtherPlayerView=function(t){ViewManager.ins().open(TeamFBCheckRoleWin,t)},e}(BaseEuiView);__reflect(MemberInfoWin.prototype,"MemberInfoWin"),ViewManager.ins().reg(MemberInfoWin,LayerManager.UI_Popup),window.MemberInfoWin=MemberInfoWin;var TeamFBCheckRoleWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbCheckSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.otherPlayerData=t[0],this.roleSelect.otherPlayerData=this.otherPlayerData,this.nameTxt.text=this.otherPlayerData.name,this.roleSelect.open(),this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.roleSelect.setCurRole(0),this.setRoleInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClick),this.roleInfoPanel.clear()},e.prototype.destoryView=function(){t.prototype.destoryView.call(this),this.roleSelect.close(),this.roleInfoPanel.close()},e.prototype.setRoleInfo=function(){var t=this.otherPlayerData.roleData[0],e="[S"+this.otherPlayerData.serverId+"]";this.otherPlayerData.serverId&&this.otherPlayerData.serverId!=LocationProperty.srvid||(e=""),this.nameTxt.text=this.otherPlayerData.name+e,this.guildNameText.x=this.nameTxt.x+this.nameTxt.textWidth+10,this.guildNameText.text=this.otherPlayerData.guildName?"公会："+this.otherPlayerData.guildName:"";var i=this.otherPlayerData.zhuan?this.otherPlayerData.zhuan+"转":"";this.levelText.text=""+i+this.otherPlayerData.level+"级",this.headIcon.source="head_"+t.job+t.sex;var n=this.otherPlayerData.lilianLv,s=GlobalConfig.TrainLevelConfig[n];this.jueweiIcon.source="juewei_1_"+s.type+"_png"},e.prototype.onChange=function(t){this.setView(this.roleSelect.getCurRole())},e.prototype.setView=function(t){void 0===t&&(t=0),this.roleInfoPanel.curRole=this.roleSelect.getCurRole(),this.roleInfoPanel.open(this.otherPlayerData)},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn1:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(TeamFBCheckRoleWin.prototype,"TeamFBCheckRoleWin"),ViewManager.ins().reg(TeamFBCheckRoleWin,LayerManager.UI_Popup),window.TeamFBCheckRoleWin=TeamFBCheckRoleWin;var TeamFbFightWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbFightSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.teamFbMember.touchEnabled=!1,this.teamFbMember.touchChildren=!1,this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(FbCT.ins().postFbTime,this.setTime),Timer.stopAll(this),Timer.start(1e3,0,this.update,this),this.setTime([FbCT.ins().curFbID,FbCT.ins().curFbLeftTime]),this.updateFbName(),this.update()},e.prototype.close=function(){},e.prototype.updateFbName=function(){var t;for(var e in GlobalConfig.TeamFuBenConfig)if(t=GlobalConfig.TeamFuBenConfig[e],t.fbid==GameMap.fubenID){this.teamFbName.source=t.nameImg,this._roomID=t.id;break}},e.prototype.setTime=function(t){Timer.stop(this.updateLeftTime,this),GameMap.fbType==FbCT.FB_TEAM&&(this._leftTime=t[1],this.updateLeftTime(),Timer.start(1e3,0,this.updateLeftTime,this))},e.prototype.updateLeftTime=function(){return this.leftTimeTxt.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),this._leftTime<=0?void Timer.stop(this.updateLeftTime,this):void this._leftTime--},e.prototype.onTouch=function(t){switch(t.target){case this.target1:case this.target2:case this.target3:case this.target4:case this.boss:t.target.data&&t.target.data.infoModel&&(SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameLogic.ins().postChangeAttrPoint(t.target.data.infoModel.handle));
break;case this.gonglveTxt:ViewManager.ins().open(TeamFbGuideWin,this._roomID)}},e.prototype.update=function(){var t,e,i,n,s=EntityManager.ins().getAllEntity(),o=[],a=[],r=[];for(var l in s)if(t=s[l],i=t.infoModel)if(i.type==EntityType.Role){if(e=i,e.masterHandle!=Actor.handle){var h=o.indexOf(e.masterHandle);-1==h?(o.push(e.masterHandle),a[a.length]=[t]):a[h].push(t)}}else if(i.type==EntityType.Monster&&i.getAtt(AttributeType.atHp)>0){var u=GlobalConfig.MonstersConfig[i.configID];if(!u)continue;if(4==u.type||3==u.type)continue;var p=1==u.type;!p&&!i.masterHandle&&r.length<4&&r.push(t),p&&(n=t)}this.teamFbMember.visible=a.length>0;for(var c,d=a.length,l=0;2>l;l++)c=this["member"+(l+1)],d>=l+1?(c.visible=!0,c.data=a[l]):c.visible=!1;for(var g,f=r.length,l=1;5>l;l++)g=this["target"+l],f>=l?(this.teamFbTarget.addChild(g),g.data=r[l-1]):DisplayUtils.removeFromParent(g);n?(this.boss.data=n,this.teamFbTarget.addChildAt(this.boss,Math.ceil(this.teamFbTarget.numChildren/2))):DisplayUtils.removeFromParent(this.boss)},e}(BaseEuiView);__reflect(TeamFbFightWin.prototype,"TeamFbFightWin"),ViewManager.ins().reg(TeamFbFightWin,LayerManager.UI_Main),window.TeamFbFightWin=TeamFbFightWin;var TeamFbGuideWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbGuideSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=TeamFbGuideItemrender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._roomId=t[0],this.addTouchEvent(this.bgClose,this.onTouch),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onTouch)},e.prototype.update=function(){this.fbName.text=GlobalConfig.TeamFuBenConfig[this._roomId].name,this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect);for(var t=Object.keys(GlobalConfig.TeamFuBenGuideConfig[this._roomId]).length,e=[],i=1;t>=i;i++)e.push(GlobalConfig.TeamFuBenGuideConfig[this._roomId][i]);this._collect.source=e},e.prototype.onTouch=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TeamFbGuideWin.prototype,"TeamFbGuideWin"),ViewManager.ins().reg(TeamFbGuideWin,LayerManager.UI_Main),window.TeamFbGuideWin=TeamFbGuideWin;var TeamFbInviteWin=function(t){function e(){var e=t.call(this)||this;return e._deDes="",e.skinName="teamFbInviteSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._deDes=t[0],this._room=t[1],this._configID=t[2],this.input.text=this._deDes,this.input.maxChars=40,this.addTouchEvent(this,this.onTouch)},e.prototype.close=function(){},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.worldInviteBtn:if(this._configID){var e=FbCT.ins().getTfInviteCD();if(e>0)return void TipsCT.ins().showTips(e+"秒后才能世界邀请");FbCT.ins().sendTfSysInvite(this.getDes()+("|E:1,"+FbCT.ins().tfRoomID+",&U:&C:65280&T:快速加入"))}else{var i=RareAnimalCT.ins();if(i.cdCount>0)return void TipsCT.ins().showTips(i.cdCount+"秒后才能世界邀请");i.sendInvite(this.getDes()+("|E:7,"+i.teamID+",&U:&C:65280&T:快速加入"))}ViewManager.ins().close(this);break;case this.friendInviteBtn:this._configID?ViewManager.ins().open(FriendListWin,this.getDes()+("|E:1,"+FbCT.ins().tfRoomID+",&U:&C:65280&T:快速加入")):ViewManager.ins().open(FriendListWin,this.getDes()+("|E:7,"+RareAnimalCT.ins().teamID+",&U:&C:65280&T:快速加入")),ViewManager.ins().close(this)}},e.prototype.getDes=function(){var t=this.input.text?this.input.text:this._deDes,e="[|C:1487615&T:"+Actor.myName+"|]";return t=t==this._deDes?t.replace("我",e):e+t},e}(BaseEuiView);__reflect(TeamFbInviteWin.prototype,"TeamFbInviteWin"),ViewManager.ins().reg(TeamFbInviteWin,LayerManager.UI_Popup),window.TeamFbInviteWin=TeamFbInviteWin;var TeamFbNewPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._index=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.Fblist.itemRenderer=TeamFbItemRender},e.prototype.addDisplay=function(){this.observe(FbCT.ins().postFTRoomPassInfo,this.update),MessageCenter.ins().addListener(FbCT.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this),this._firstOpen=!0,this.update(),FbCT.ins().postShowRedChange(!1)},e.prototype.removeDisplay=function(){MessageCenter.ins().removeListener(FbCT.TEAM_FB_WIN_REFLASH_PANEL,this.listFresh,this),Timer.stopAll(this)},e.prototype.listFresh=function(t,e){if(this._collect&&t.itemIndex==this._collect.length-1){var i=FbCT.TF_EXPAND_HEIGHT-FbCT.TF_SIMLPE_HEIGHT;1==e?this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height+i:this.Fblist.scrollV=this.Fblist.contentHeight-this.Fblist.height-i,this.Fblist.validateNow()}},e.prototype.update=function(){this._collect||(this._collect=new eui.ArrayCollection,this.Fblist.dataProvider=this._collect);for(var t,e=Object.keys(GlobalConfig.TeamFuBenConfig).length,i=[],n=0;e>n;n++)t=GlobalConfig.TeamFuBenConfig[n+1].id==FbCT.ins().tfPassID+1,t&&(this._index=n),i.push({config:GlobalConfig.TeamFuBenConfig[n+1],passID:FbCT.ins().tfPassID,open:t});this._collect.source=i,this.Fblist.validateNow(),this._firstOpen&&(this._firstOpen=!1,Timer.start(50,1,this.selectCanChallege,this),this.selectCanChallege())},e.prototype.selectCanChallege=function(){var t=(this._index+1)*FbCT.TF_SIMLPE_HEIGHT-this.Fblist.height+FbCT.TF_EXPAND_HEIGHT-FbCT.TF_SIMLPE_HEIGHT;this.Fblist.scrollV=t>0?t:0,this.Fblist.validateNow()},e}(BaseView);__reflect(TeamFbNewPanel.prototype,"TeamFbNewPanel"),window.TeamFbNewPanel=TeamFbNewPanel;var TeamFbResultWin=function(t){function e(){var e=t.call(this)||this;return e._result=0,e.skinName="teamFbResultSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.listItem.itemRenderer=ItemBase,this.listChallenger.itemRenderer=ChallengerHeadItemRender,this.listAssistant.itemRenderer=AssistantHeadItemRender,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._configID=t[0],this._result=t[1],this._list=t[2],this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.close=function(){},e.prototype.update=function(){this.listItem.dataProvider=new eui.ArrayCollection(GlobalConfig.TeamFuBenConfig[this._configID].rewardShow),this.title.source=this._result?"result_json.win_02":"result_json.lost_02",this.bg.source=this._result?"win_png":"lost_png",this.win.visible=this._result>0,this.defeat.visible=0==this._result,this._hasCaptain=!1;for(var t,e,i,n=[],s=0;s<this._list.length;s++)2==this._list[s].position?(t=this._list.splice(s,1)[0],n.push(t),t.roleID==Actor.actorID&&(e=!0),s--):1==this._list[s].position&&(this._list[s].roleID==Actor.actorID&&(i=!0),this._hasCaptain=!0);this.assResultTxt.visible=e,0==this._result&&this.updateDefeatList(),this.listChallenger.dataProvider=new eui.ArrayCollection(this._list);for(var o=n.length,a=[],s=0;o>s;s++)a.push({vo:n[s],id:this._configID});this.listAssistant.dataProvider=new eui.ArrayCollection(a),this.closeBtn.visible=i&&1==this._result,0==this._result||this._configID>=Object.keys(GlobalConfig.TeamFuBenConfig).length?(this.closeBtn.horizontalCenter=0,this.challengeBtn.visible=!1):(this.closeBtn.horizontalCenter=-80,this.challengeBtn.visible=this.closeBtn.visible),this._exitTime=5,Timer.start(1e3,0,this.repeate,this),this.repeate()},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay)if(16!=i.gainWay[n][0])t.push(i.gainWay[n][0]);else{var s=DieGuide.ins().getOpenRoles();if(s){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];o.itemId=s,t.push(i.gainWay[n][0])}}break}}this.list0.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:this.exitFb();break;case this.challengeBtn:this.exitFb(1);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this),ViewManager.ins().open(NewRoleWin)}},e.prototype.repeate=function(){return this.closeBtn.label="退出("+this._exitTime+"s)",this.assResultTxt.text="等待队长操作（"+this._exitTime+"s）",this._exitTime<=0?(Timer.stopAll(this),void this.exitFb()):void this._exitTime--},e.prototype.exitFb=function(t){void 0===t&&(t=0),0==this._result||this._configID>=Object.keys(GlobalConfig.TeamFuBenConfig).length?FbCT.ins().sendExitFb():this._hasCaptain?FbCT.ins().sendExitTFFb(t):FbCT.ins().sendExitFb(),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(TeamFbResultWin.prototype,"TeamFbResultWin"),ViewManager.ins().reg(TeamFbResultWin,LayerManager.UI_Popup),window.TeamFbResultWin=TeamFbResultWin;var TeamFbRoomWin=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._room=0,e.skinName="teamFbRoomSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._state=t[0],this._config=GlobalConfig.TeamFuBenConfig[t[1]],this._room=t[2],this.observe(FbCT.ins().postFTRoomChange,this.onRoomInfoChange),this.observe(FbCT.ins().postCreateTFRoomSuccess,this.createSuccess),this.addTouchEvent(this,this.onTouch),this.update(),this.onRoomInfoChange(),ViewManager.ins().open(ChatMainUI)},e.prototype.close=function(){ViewManager.ins().close(ChatMainUI)},e.prototype.createSuccess=function(){this._room=FbCT.ins().tfRoomID,this.onRoomInfoChange()},e.prototype.update=function(){if(this._collect||(this._collect=new eui.ArrayCollection,this.itemList.dataProvider=this._collect),this._collect.source=this._config.rewardShow,this.fbName.text=this._config.name,this.passTxt.visible=!1,this.infoText.visible=!1,this.roleGroup.visible=!0,this.challengeBtn.visible=!1,this.leader.visible=this.member1.visible=this.member2.visible=!1,0==this._state)this.roleGroup.visible=!1,this.infoText.visible=!0,this.infoText.textFlow=TextFlowMaker.generateTextFlow("通关"+GlobalConfig.TeamFuBenConfig[this._config.id-1].name+"后可开启挑战");else if(2==this._state){this.passTxt.visible=!0,this.member1.visible=this.member2.visible=!1;var t=new TeamFuBenRoleVo,e=SubRoles.ins().getSubRoleByIndex(0);t.roleID=Actor.actorID,t.position=1,t.roleName=Actor.myName,t.job=e.job,t.sex=e.sex,t.cloth=e.getEquipByIndex(2).item.configID,t.weapon=e.getEquipByIndex(0).item.configID,t.wingLv=e.wingsData.lv,t.wingState=e.wingsData.openStatus;var i=e.getZhuangBanNG();t.pos1=i[0],t.pos2=i[1],t.pos3=i[2],t.zs=ZsCT.ins().lv,t.lv=e.lv,this.leader.data={vo:t,configID:this._config.id},this.leader.visible=!0}else this.challengeBtn.visible=!0,this._room<=0&&FbCT.ins().sendCreateTFRoom()},e.prototype.onRoomInfoChange=function(){if(this._room){for(var t,e=FbCT.ins().tfMembers?FbCT.ins().tfMembers.length:0,i=[this.member1,this.member2],n=0;e>n;n++)1==FbCT.ins().tfMembers[n].position?this.leader.data={vo:FbCT.ins().tfMembers[n],configID:this._config.id}:(t=i.shift(),t.data={vo:FbCT.ins().tfMembers[n],configID:this._config.id});e=i.length;for(var n=0;e>n;n++)i[n].data={vo:null,configID:this._config.id};i.length=0,i=null,this.member1.visible=null!=this.member1.data,this.member2.visible=null!=this.member2.data,this.leader.visible=null!=this.leader.data}},e.prototype.onTouch=function(t){switch(t.target){case this.challengeBtn:var i=new Date(GameServer.serverTime);if(i.getDay()==GlobalConfig.TeamFuBenBaseConfig.closeTime[0]&&i.getHours()>=GlobalConfig.TeamFuBenBaseConfig.closeTime[1])return TipsCT.ins().showTips("每周"+DateUtils.WEEK_CN[GlobalConfig.TeamFuBenBaseConfig.closeTime[0]]+GlobalConfig.TeamFuBenBaseConfig.closeTime[1]+"点后不能挑战"),void ViewManager.ins().close(this);if(!KfArenaSys.ins().checkIsMatching())return;if(!FbCT.ins().isTFCaptain)return void TipsCT.ins().showTips("队长才能开启进入副本");FbCT.ins().sendBeginTF(),ViewManager.ins().close(e);break;case this.closeBtn0:1==this._state?WarnWin.show("是否退出房间",function(){FbCT.ins().sendExitTFRoom(),ViewManager.ins().close(e)},this):ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(TeamFbRoomWin.prototype,"TeamFbRoomWin"),ViewManager.ins().reg(TeamFbRoomWin,LayerManager.UI_Popup),window.TeamFbRoomWin=TeamFbRoomWin;var AssistantHeadItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="assistantHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.Name.text=this.data.vo.roleName,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.vo.sex],this.imgHead.source="head_"+this.data.vo.job+this.data.vo.sex,this.charm.text="魅力值 +"+GlobalConfig.TeamFuBenConfig[this.data.id].chiv},e}(BaseItemRender);__reflect(AssistantHeadItemRender.prototype,"AssistantHeadItemRender"),window.AssistantHeadItemRender=AssistantHeadItemRender;var ChallengerHeadItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="challengerHeadSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.roleName,i=t.sex,n=t.job;this.Name.text=e||"虚位以待",this.imgBg.source=ChatListItemRenderer.HEAD_BG[i],this.imgHead.source=n?"head_"+n+i:""},e}(BaseItemRender);__reflect(ChallengerHeadItemRender.prototype,"ChallengerHeadItemRender"),window.ChallengerHeadItemRender=ChallengerHeadItemRender;var FriendItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="friendItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelName.text=this.data.name,this.imgBg.source=ChatListItemRenderer.HEAD_BG[this.data.sex],this.imgHead.source="head_"+this.data.job+this.data.sex,this.labelGuild.text=this.data.guildName?this.data.guildName:"",this.labelLv.text=(this.data.zs?this.data.zs+"级":"")+this.data.lv+"级"},e}(BaseItemRender);__reflect(FriendItemRender.prototype,"FriendItemRender"),window.FriendItemRender=FriendItemRender;var TeamFbGuideItemrender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.monHeadImg.source=t.monHead,this.nameTxt.text=t.monName,this.dangerLvTxt.textFlow=TextFlowMaker.generateTextFlow(t.dangerLv),this.guideTxt.textFlow=TextFlowMaker.generateTextFlow(t.guideText)},e}(BaseItemRender);__reflect(TeamFbGuideItemrender.prototype,"TeamFbGuideItemrender"),window.TeamFbGuideItemrender=TeamFbGuideItemrender;var TeamFbItemRender=function(t){function e(){var e=t.call(this)||this;return e._isShow=!1,e.skinName="teamFbItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.Rewardlist.itemRenderer=ItemBase,this.gonglveTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.gonglveTxt.text)},e.prototype.dataChanged=function(){this.nameImg.source=this.data.config.nameImg,this.fbDesc.textFlow=TextFlowMaker.generateTextFlow(this.data.config.infoText),this.head.source=this.data.config.bossImg,this.Rewardlist.dataProvider=new eui.ArrayCollection(this.data.config.rewardShow),this.nameTxt.text=this.data.config.bossName,this.fbImg.source=this.data.config.guanqiaImg,this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.updateStates(),this.data.open&&(this._isShow=!0,this.currentState="zhankai")},e.prototype.updateStates=function(){this.lock.visible=this.data.config.id>this.data.passID+1,this.unlock.visible=!this.lock.visible,this.redPoint.visible=this.data.config.id==this.data.passID+1,this.createRoomBtn.visible=this.data.config.id>this.data.passID,this.done.visible=this.data.config.id<=this.data.passID},e.prototype.onTap=function(t){if(t.target==this.fbImg)this._isShow=!this._isShow,this.currentState=this._isShow?"zhankai":"normal",MessageCenter.ins().dispatch(FbCT.TEAM_FB_WIN_REFLASH_PANEL,this,this._isShow);else if(t.target==this.createRoomBtn){if(0!=GameMap.fbType)return void TipsCT.ins().showTips("正在其他副本中，不能挑战");ViewManager.ins().open(TeamFbRoomWin,this.state,this.data.config.id,0)}else t.target==this.gonglveTxt&&ViewManager.ins().open(TeamFbGuideWin,this.data.config.id)},Object.defineProperty(e.prototype,"state",{get:function(){return this.data.passID>=this.data.config.id?2:this.data.config.id==this.data.passID+1?1:0},enumerable:!0,configurable:!0}),e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(TeamFbItemRender.prototype,"TeamFbItemRender"),window.TeamFbItemRender=TeamFbItemRender;var TeamFbMemberItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbMemberSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.die.visible=this.fuhuoImg.visible=!1;for(var e,i=t.length,n=0;i>n;n++)if(t[n].infoModel.getAtt(AttributeType.atHp)>0){e=!0,this.updateRole(t[n]);break}e||(this.updateRole(t[0]),this.fuhuoImg.visible=GameMap.fbType!=FbCT.FB_TYPE_RAREANIMAL,this.die.visible=GameMap.fbType==FbCT.FB_TYPE_RAREANIMAL)},e.prototype.updateRole=function(t){var e=t.infoModel;this.roleName.text=e.name,this.roleHead.source="yuanhead"+e.job+e.sex},e}(BaseItemRender);__reflect(TeamFbMemberItemRender.prototype,"TeamFbMemberItemRender"),window.TeamFbMemberItemRender=TeamFbMemberItemRender;var TeamFbRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.member.visible=!0,this.noteam.visible=!1,this.fubenName.text=GlobalConfig.TeamFuBenConfig[this.data.configID].name;for(var t=void 0,e=void 0,i=this.data.members.length,n=0;3>n;n++)t=this["img"+n],e=this["nameTxt"+n],i>=n+1?(t.source=1==this.data.members[n].position?"tfb_leader":2==this.data.members[0].position?"tfb_assistant":"",e.text=this.data.members[n].roleName):(t.source="",e.text="")}else this.member.visible=!1,this.noteam.visible=!0},e}(BaseItemRender);__reflect(TeamFbRankItemRender.prototype,"TeamFbRankItemRender"),window.TeamFbRankItemRender=TeamFbRankItemRender;var TeamFbRoleItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbRoleItem",e.touchEnabled=!1,e.bodyMc=new MovieClip,e.bodyMc.visible=!1,e.wefbodyMc=new MovieClip,e.wefbodyMc.visible=!1,e.eBodyMCGroup.addChild(e.bodyMc),e.eWeapon.addChild(e.wefbodyMc),e.wingMc=new MovieClip,e.wingMc.visible=!1,e.eWingMCGroup.addChild(e.wingMc),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e.prototype.onTouch=function(t){switch(t.target){case this.invite:case this.nomember:if(this.data.type){if(!RareAnimalCT.ins().isTFCaptain)return void TipsCT.ins().showTips("队长才能邀请玩家");ViewManager.ins().open(TeamFbInviteWin,GlobalConfig.AnimalsBaseConfig.inviteText,RareAnimalCT.ins().teamID)}else{if(!FbCT.ins().isTFCaptain)return void TipsCT.ins().showTips("队长才能邀请玩家");ViewManager.ins().open(TeamFbInviteWin,GlobalConfig.TeamFuBenBaseConfig.inviteText.replace("%s",GlobalConfig.TeamFuBenConfig[FbCT.ins().tfPassID+1].name),FbCT.ins().tfRoomID,this.data.configID)}break;case this.body:this.data.vo.roleID!=Actor.actorID&&ViewManager.ins().open(MemberInfoWin,this.data.vo,this.data.type)}},e.prototype.dataChanged=function(){if(this.data.vo){this.nomember.visible=this.invite.visible=!1,this.body.visible=this.position.visible=this.weapon.visible=!0;var t=this.data.vo;this.roleName.text=t.roleName,3!=t.position?this.position.source=1==t.position?"tfb_leader":"tfb_assistant":this.position.source=null,this.body.source=this.weapon.source=this.wing.source=null;var e=GlobalConfig.EquipConfig[t.cloth];if(e){var i=e.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.body.source=(t.cloth>0?i+"_":t.job+"00_")+t.sex+"_c_png"}var n=GlobalConfig.EquipConfig[t.weapon];if(n){var i=n.appearance;i&&i.indexOf("[job]")>-1&&(i=i.replace("[job]",t.job+"")),this.weapon.source=t.weapon>0?i+"_0_c_png":""}var s=GlobalConfig.WingLevelConfig[t.wingLv];if(s&&(this.wing.source=t.wingLv>=0?s.appearance+"_png":""),t.pos1>0){var o=this.getZhuangbanById(t.pos1);o.useMc>0?(this.body.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+o.res+"_"+t.sex+"_c_m",-1)):(this.bodyMc.visible=!1,this.body.visible=!0,this.body.source=o.res+"_"+t.sex+"_c_png")}if(t.pos2>0){var o=this.getZhuangbanById(t.pos2);o.useMc>0?(this.wefbodyMc||(this.wefbodyMc=new MovieClip),this.weapon.visible=!1,this.wefbodyMc.visible=!0,this.wefbodyMc.playFile(RES_DIR_DRESS+o.res+"_"+t.sex+"_c_m",-1)):(this.weapon.visible=!0,this.wefbodyMc.visible=!1,this.weapon.source=o.res+"_0_c_png")}else this.weapon.visible=!0,this.wefbodyMc.visible=!1;if(this.wing.visible=!0,this.wingMc.visible=!1,t.pos3>0){var o=this.getZhuangbanById(t.pos3);o.useMc?this.wingMc.playFile(RES_DIR_DRESS+o.res+"_c_m",-1):this.wing.source=o.res+"_png",this.wingMc.visible=o.useMc>0,this.wing.visible=!this.wingMc.visible}this.body.source||(this.bodyMc.visible=!1,this.body.visible=!0,this.body.source="body000_"+t.sex+"_c_png")}else this.nomember.visible=this.invite.visible=!0,this.body.visible=this.position.visible=this.weapon.visible=this.wing.visible=!1,this.roleName.text="虚位以待"},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this)},e}(BaseItemRender);__reflect(TeamFbRoleItemRender.prototype,"TeamFbRoleItemRender"),window.TeamFbRoleItemRender=TeamFbRoleItemRender;var TeamFbTargetItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="teamFbTargetSkin",e.touchEnabled=!0,e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.MonstersConfig[t.infoModel.configID];this.roleName.text=e.name,this.checkMonHead(e)&&(this.roleHead.source="monhead"+e.head+"_png"),GameLogic.ins().currAttackHandle&&GameLogic.ins().currAttackHandle==t.infoModel.handle?(this.addAttEffect(),this.targetName.visible=!0,this.targetSelect.visible=!0):(this.removeAttEffect(),this.targetName.visible=!1,this.targetSelect.visible=!1)},e.prototype.checkMonHead=function(t){return Assert(t.head,"怪物头像不存在2，id:"+t.id+",name:"+t.name)?!1:!0},e.prototype.addAttEffect=function(){this.attEffect||(this.attEffect=new MovieClip,this.attEffect.x=49,this.attEffect.y=28,this.attEffect.playFile(RES_DIR_EFF+"BattlEff2",-1),this.addChild(this.attEffect))},e.prototype.removeAttEffect=function(){this.attEffect&&(DisplayUtils.removeFromParent(this.attEffect),this.attEffect=null)},e}(BaseItemRender);__reflect(TeamFbTargetItemRender.prototype,"TeamFbTargetItemRender"),window.TeamFbTargetItemRender=TeamFbTargetItemRender;var TeamFuBenRoleVo=function(){function t(){}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.position=t.readByte(),this.roleName=t.readString(),this.job=t.readByte(),this.sex=t.readByte(),this.cloth=t.readInt(),this.weapon=t.readInt(),this.wingLv=t.readInt(),this.wingState=t.readByte(),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt(),this.zs=t.readInt(),this.lv=t.readInt()},t}();__reflect(TeamFuBenRoleVo.prototype,"TeamFuBenRoleVo"),window.TeamFuBenRoleVo=TeamFuBenRoleVo;var BossResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=8,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BossResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;e[0];this.bg.source="win_png",this.title.source="win_02",this.sameHanghui.visible=!1,this.getSame.visible=!1,this.notGetIt.visible=!1;var n=5;GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_ALLHUMENBOSS?n=10:GameMap.fbType==FbCT.FB_TYPE_XUANWU?(this.repeatTimes=15,this.getSame0.visible=!0):GameMap.fbType==FbCT.FB_TYPE_37BOSS&&(this.repeatTimes=15),this.s=this.repeatTimes;var s=e[0];if(GameMap.fbType==FbCT.FB_TYPE_STARBOSS||GameMap.fbType==FbCT.FB_TYPE_XUANWU||GameMap.fbType==FbCT.FB_TYPE_37BOSS?(this.getSame.visible=GameMap.fbType!=FbCT.FB_TYPE_37BOSS,s.length<=0?(this.btnGrp.visible=!1,this.closeBtn.visible=!0,this.closeBtn.name="退出",this.closeBtn.label=this.closeBtn.name+"("+this.repeatTimes+"s)",Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this),this.addTouchEvent(this.closeBtn,this.onTap)):e[1][0]>0?(this.btnGrp.visible=!1,this.closeBtn.visible=!0,this.closeBtn.name="领取奖励",this.closeBtn.label=this.closeBtn.name+"("+this.repeatTimes+"s)",Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this),this.addTouchEvent(this.closeBtn,this.onTap)):e[1][3]>0?(this.btnGrp.visible=!1,this.closeBtn.visible=!0,this.sameHanghui.visible=!0,this.closeBtn.name="领取奖励",this.closeBtn.label=this.closeBtn.name+"("+this.repeatTimes+"s)",Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this),this.addTouchEvent(this.closeBtn,this.onTap)):(this.notGetIt.visible=!0,this.btnGrp.visible=!0,this.closeBtn.visible=!1,this.outBtn.name="退出",this.outBtn.label=this.outBtn.name+"("+this.repeatTimes+"s)",Timer.start(1e3,this.repeatTimes,this.updateOutBtnLabel,this),this.addTouchEvent(this.getBtn,this.onTap),this.addTouchEvent(this.outBtn,this.onTap))):(this.btnGrp.visible=!1,this.closeBtn.visible=!0,this.closeBtn.name="领取奖励",this.updateCloseBtnLabel(),Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this),this.addTouchEvent(this.closeBtn,this.onTap)),e[1]){var o=e[1][0];o&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"FireWork",1));var a=e[1][1]||"";a=StringUtils.replaceStr(a,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(a),this.eRewardTitle.source=o?"win_guishu_png":"win_canyu_png",this.eFace.source=e[1][2]}else this.belongTxt.text="";s?this.setRewardList(s):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],n=[],s=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?s.push(t[a]):e.push(t[a]):n.push(t[a]);else if(i.length){for(var l=!1,h=0;h<i.length;h++)if(i[h].id==t[a].id){i[h].count+=t[a].count,l=!0;break}l||i.push(t[a])}else i.push(t[a])}n.sort(this.RuleSortByItem),o=s.concat(e,i,n),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&FbCT.ins().isQuite&&this._fbType!=FbCT.FB_TYPE_ZHUANSHENGBOSS&&FbCT.ins().sendExitFb(),this._fbType==FbCT.FB_TYPE_HOMEBOSS&&ViewManager.ins().open(BossWin,4),this.closeFunc&&(this.closeFunc(),this.closeFunc=null)},e.prototype.updateOutBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.outBtn.label=this.outBtn.name+"("+this.s+"s)"},e.prototype.updateCloseBtnLabel=function(){this.s=this.s-1,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.outBtn:ViewManager.ins().close(this);break;case this.getBtn:switch(GameMap.fbType){case FbCT.FB_TYPE_XUANWU:XuanWuCT.ins().sendGetAward();break;default:BossCT.ins().sendGetBossAward()}ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return Algorithm.sortDesc(s,o)},e}(BaseEuiView);__reflect(BossResultWin.prototype,"BossResultWin"),ViewManager.ins().reg(BossResultWin,LayerManager.UI_Popup),window.BossResultWin=BossResultWin;var CityResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="CityResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(t.prototype.open.call(this,e),this.addTouchEvent(this.closeBtn,this.onTap),this.bg.source="win_png",this.closeBtn.label="领取奖励",this.title.source="win_02",e[1]){var n=e[1][0];n&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"FireWork",1));var s=e[1][1]||"",o=s.split("\n");s=o[1]?o[1]:o[0],s=StringUtils.replaceStr(s,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(s),this.labelItem.text=n?"我的归属奖：":"我的参与奖：",this.eRewardTitle.source=n?"win_guishu_png":"win_canyu_png",this.eFace.source=e[1][2]}var a=e[0];a&&this.setRewardList(a)},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],n=[],s=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))0==t[a].type?t[a].id==MoneyConst.soul?s.push(t[a]):e.push(t[a]):n.push(t[a]);else if(i.length){for(var l=!1,h=0;h<i.length;h++)if(i[h].id==t[a].id){i[h].count+=t[a].count,l=!0;break}l||i.push(t[a])}else i.push(t[a])}n.sort(this.RuleSortByItem),o=s.concat(e,i,n),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return Algorithm.sortDesc(s,o)},e}(BaseEuiView);__reflect(CityResultWin.prototype,"CityResultWin"),ViewManager.ins().reg(CityResultWin,LayerManager.UI_Popup),window.CityResultWin=CityResultWin;var ExpFbResultWin=function(t){function e(){var e=t.call(this)||this;return e.s=11,e.skinName="jyjiangli",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.btnGet,this.onTouch),this.observe(FbCT.ins().postFbExpInfo,this.update),this.update(),this.s=9,this.btnGet.name="前往领取",this.updateCloseBtnLabel(),Timer.start(1e3,this.s,this.updateCloseBtnLabel,this)},e.prototype.onTouch=function(){ViewManager.ins().close(this)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.btnGet.label=this.btnGet.name+"("+this.s+"s)"},e.prototype.close=function(){ViewManager.ins().open(FbWin,0,1),FbCT.ins().sendExitFb()},e.prototype.update=function(){var t=FbCT.ins().fbExp,e=GlobalConfig.ExpFubenConfig[t.cid||t.sid];if(e){var i=GlobalConfig.MonthCardConfig.expFubenPrecent/100,n=Recharge.ins().getIsForeve()?1+i:1;this.setExp(Math.ceil(e.exp*n))}},e.prototype.setExp=function(t){this.lbExp.text=t+""},e}(BaseEuiView);__reflect(ExpFbResultWin.prototype,"ExpFbResultWin"),ViewManager.ins().reg(ExpFbResultWin,LayerManager.UI_Popup),window.ExpFbResultWin=ExpFbResultWin;var FireResultWin=function(t){function e(){var e=t.call(this)||this;return e.s=11,e.skinName="LYRFbResultSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnGet,this.onTouch),this.s=9,this.btnGet.name="前往领取",this.updateCloseBtnLabel();var i=t&&t[0]>0?t[0]:0;this.setExp(i),Timer.start(1e3,this.s,this.updateCloseBtnLabel,this)},e.prototype.onTouch=function(){ViewManager.ins().close(this)
},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.btnGet.label=this.btnGet.name+"("+this.s+"s)"},e.prototype.close=function(){ViewManager.ins().open(FireRingWin,2),FbCT.ins().sendExitFb()},e.prototype.setExp=function(t){this.lbExp.text=t>0?t+"":GlobalConfig.ActorExRingFubenConfig.reward[0].count+""},e}(BaseEuiView);__reflect(FireResultWin.prototype,"FireResultWin"),ViewManager.ins().reg(FireResultWin,LayerManager.UI_Popup),window.FireResultWin=FireResultWin;var MaterialResultWin=function(t){function e(){var e=t.call(this)||this;return e.winResult=0,e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailyFbResultSkin",this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;var n=e[0];this.winResult=n,this.bg.source=n?"win_png":"lost_png",this.closeBtn.name=n?"领取奖励":"退出",this.title.source=n?"win_02":"lost_02",DieGuide.ins().postdieGuide(n);var s=5;this.s=this.repeatTimes=s,this.updateCloseBtnLabel(),Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];e[2]&&(this.txt.text=e[2]),this.txt.visible=0!=n,this.defeat.visible=0==n,this.addTouchEvent(this.closeBtn,this.onTap),0==n&&this.updateDefeatList(),o&&this.setRewardList(o)},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);var e=[];if(this._fbType==FbCT.FB_TYPE_GUIDEBOSS||this._fbType==FbCT.FB_TYPE_HUN_SHOU||this._fbType==FbCT.FB_TYPE_EXCLUSIVE)e=t;else for(var i=0;i<t.length;i++){var n=GlobalConfig.ItemConfig[t[i].id];1==ItemUtil.getType(n)&&e.push(t[i])}this.listItem.dataProvider=new eui.ArrayCollection(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(Timer.stop(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),FbCT.ins().sendExitFb(),this._fbType==FbCT.FB_TYPE_MATERIAL)ViewManager.ins().open(FbWin,0);else if(this.winResult&&GameMap.fubenID==GlobalConfig.MoJianFubenBaseConfig.fbId)return void ViewManager.ins().open(FbWin,0,5);FbCT.ins().sendExitFb()},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay)if(16!=i.gainWay[n][0])t.push(i.gainWay[n][0]);else{var s=DieGuide.ins().getOpenRoles();if(s){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];o.itemId=s,t.push(i.gainWay[n][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e}(BaseEuiView);__reflect(MaterialResultWin.prototype,"MaterialResultWin"),ViewManager.ins().reg(MaterialResultWin,LayerManager.UI_Popup),window.MaterialResultWin=MaterialResultWin;var NewWorldBossResultPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="wpkResultSkin",this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.init()},e.prototype.init=function(){this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"FireWork",1),this.s=20;var t=BossCT.ins().newWorldBossData;this.myrank.text=t.rank?t.rank+"":"没上榜",this.rankList.itemRenderer=NewWorldBossResultRender,this.rankList.itemRendererSkinName="wpkResultRenderSkin";var e=t.rankList.concat();e.length>3?e.length=3:null;for(var i=0;i<e.length;i++)e[i].rank=i+1;this.rankList.dataProvider=new eui.ArrayCollection(e),this.time.text=DateUtils.getFormatBySecond(t.totalTime,DateUtils.TIME_FORMAT_10),this.weidao.text=t.lastKillRoleName,t.randomRoleName&&t.randomAwards&&t.randomAwards.length?(this.lucky.visible=!0,this.luckyName.text=t.randomRoleName,this.luckyGift.text=GlobalConfig.ItemConfig[t.randomAwards[0].id].name):this.lucky.visible=!1,this.updateBtn(),Timer.start(1e3,this.s,this.updateCloseBtnLabel,this),FbCT.ins().isQuite=!0},e.prototype.onTap=function(t){ViewManager.ins().close(this),FbCT.ins().sendExitFb()},e.prototype.updateCloseBtnLabel=function(){this.s>0&&this.s--,this.s<=0&&(ViewManager.ins().close(this),FbCT.ins().sendExitFb()),this.updateBtn()},e.prototype.updateBtn=function(){this.closeBtn.label="离开("+this.s+"s)"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),Timer.stopAll(this)},e}(BaseEuiView);__reflect(NewWorldBossResultPanel.prototype,"NewWorldBossResultPanel"),ViewManager.ins().reg(NewWorldBossResultPanel,LayerManager.UI_Popup),window.NewWorldBossResultPanel=NewWorldBossResultPanel;var NewWorldBossResultRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.nameTxt.text=t.roleName,this.valueTxt.text=Math.floor(t.value)+"",this.paihang.source="paihangs"+t.rank},e}(BaseItemRender);__reflect(NewWorldBossResultRender.prototype,"NewWorldBossResultRender"),window.NewWorldBossResultRender=NewWorldBossResultRender;var PersonalResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="PersonalBossResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this._fbType=GameMap.fbType;var n=e[0];this.bg.source=n?"win_png":"lost_png",this.closeBtn.name=n?"领取奖励":"退出",this.title.source=n?"win_02":"lost_02",DieGuide.ins().postdieGuide(n);var s=5;this.s=this.repeatTimes=s,this.updateCloseBtnLabel(),Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var o=e[1];this.txt.text="",GameMap.fbType==FbCT.FB_TYPE_GUARD_WEAPON&&(this.txt.text="本次击杀"+GuardWeaponModel.ins().getKillWave()+"波怪物"),FbCT.ins().isQuite=!0,e[3]instanceof Function&&(this.closeFunc=e[3]),this.txt.verticalCenter=-226,this.txt.visible=0!=n,this.defeat.visible=0==n,this.addTouchEvent(this.closeBtn,this.onTap),GameMap.fbType==FbCT.FB_TYPE_XMHJ&&0==n?(this.txt.visible=0==n,this.defeat.visible=0!=n,this.txt.verticalCenter=-90):0==n&&this.updateDefeatList(),o?this.setRewardList(o):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],n=[],s=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))0==t[a].type?e.push(t[a]):i.push(t[a]);else if(s.length){for(var l=!1,h=0;h<s.length;h++)if(s[h].id==t[a].id){s[h].count+=t[a].count,l=!0;break}l||s.push(t[a])}else s.push(t[a])}this.labelItem.text="获得道具：",this.labelItem.height=i.length>0?20:0,this.labelItem.visible=i.length>0,e.sort(this.RuleSort),i.sort(this.RuleSortByItem),GameMap.fbType!=FbCT.FB_TYPE_CDBOSS&&(this.listCoin.dataProvider=new eui.ArrayCollection(e)),o=n.concat(e,s,i),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&FbCT.ins().isQuite&&FbCT.ins().sendExitFb(),this.closeFunc&&(this.closeFunc(),this.closeFunc=null)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay){if(14==i.gainWay[n][0]){var s=Recharge.ins().getRechargeData(0);if(s.num&&2!=s.num&&VipCT.ins().vipIsMax(Actor.vip))continue}else if(16==i.gainWay[n][0]){var o=DieGuide.ins().getOpenRoles();if(o){var a=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];a.itemId=o,t.push(i.gainWay[n][0])}continue}t.push(i.gainWay[n][0])}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return Algorithm.sortDesc(s,o)},e}(BaseEuiView);__reflect(PersonalResultWin.prototype,"PersonalResultWin"),ViewManager.ins().reg(PersonalResultWin,LayerManager.UI_Popup),window.PersonalResultWin=PersonalResultWin;var ResultCoinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ResultCoinItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.labelInfo.size=20,this.labelInfo.text="获得"+RewardData.getCurrencyName(t.id)+"：",this.imgCoin.source=RewardData.getCurrencyRes(t.id),this.labelCount.text=""+t.count,this.labelInfo.x=0,this.imgCoin.x=this.labelInfo.x+this.labelInfo.textWidth,this.labelCount.x=this.imgCoin.x+this.imgCoin.width},e}(eui.ItemRenderer);__reflect(ResultCoinItem.prototype,"ResultCoinItem"),window.ResultCoinItem=ResultCoinItem;var ResultWin=function(t){function e(){var e=t.call(this)||this;return e.winResult=0,e.repeatTimes=5,e.isBossResult=!1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listEmblem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem,this.winnerEff=new MovieClip,this.winnerEff.x=41,this.winnerEff.y=41,this.winnerEff.touchEnabled=!1},e.prototype.sortFunc=function(t,e){if(1==t.type&&1==e.type){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(i);if(s>o)return-1;if(o>s)return 1;if(i.level>n.level)return-1;if(i.level<n.level)return 1}else{if(t.type<e.type)return-1;if(t.type>e.type)return 1}return 0},e.prototype.showRune=function(t){if(GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN){if(!t)return void(this.nune.visible=!1);var e=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!e||!e.showIcon)return void(this.nune.visible=!1);var i=GlobalConfig.ItemConfig[e.showIcon],n=ItemUtil.getQuality(i);if(n==FBChallengePanel.RunType)return void(this.nune.visible=!1);this.nune.visible=!0,this.scrollerGroup.y+=3*this.nune.height/2;var s="";e.equipPos?(this.nuneLock.visible=!0,s="开启图腾槽：",this.oldValue.text=(e.equipPos-1).toString(),this.newValue.text=e.equipPos.toString()):(this.nuneLock.visible=!1,s="解锁类型：",this.nuneValue.text=e.describe),this.nameLabel.text=s,this.nuneValue.visible=!this.nuneLock.visible}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._fbType=GameMap.fbType,this.doublePrice.visible=!1,this.sameHanghui.visible=!1;var i=t[0];this.winResult=i,this.bg.source=i?"win_png":"lost_png",this.closeBtn.name=i?"领取奖励":"退出",this.title.source=i?"win_02":"lost_02",DieGuide.ins().postdieGuide(i),this.showRune(i);var n=GameMap.fbType==FbCT.FB_TYPE_EXP?15:5;GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS||GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS?n=10:GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS&&(n=21),this.s=this.repeatTimes=n,this.updateCloseBtnLabel(),CityCC.ins().isCity||Timer.start(1e3,this.repeatTimes,this.updateCloseBtnLabel,this);var s=t[1];if(t[2]&&(this.txt.text=t[2]),FbCT.ins().isQuite=!0,t[3]instanceof Function?this.closeFunc=t[3]:0==t[3]&&(FbCT.ins().isQuite=t[3]),CityCC.ins().isCity&&(FbCT.ins().isQuite=!1),t[4]){var o=t[4][0];o&&(this.winnerEff.parent||this.effGroup.addChild(this.winnerEff),this.winnerEff.playFile(RES_DIR_EFF+"FireWork",1));var a=t[4][1]||"",r=a.split("\n");a=r[1]?r[1]:r[0],a=StringUtils.replaceStr(a,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+""),this.belongTxt.textFlow=TextFlowMaker.generateTextFlow1(a),this.labelItem.text="",this.eRewardTitle.source=o?"win_guishu_png":"win_canyu_png",this.isBossResult=!0,this.eFace.source=t[4][2],this.txt.text="",this.sameHanghui.visible=t[4][3]&&t[4][3]>0}else this.belongTxt.text="";var l=this.txt.horizontalCenter;if(this.txt.horizontalCenter=t[5]?0:l,t[5]&&(this.txt.textFlow=TextFlowMaker.generateTextFlow1("成功帮助|C:0x35E62D&T:"+t[5]+"|夺回被掠夺的奖励")),this.txt.visible=0!=i,this.defeat.visible=0==i,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),this.addTouchEvent(this.openRole,this.onTap),this.addTouchEvent(this.openRole1,this.onTap),this.openRole.visible=!1,this.defeat.y=210,this.closeBtn.x=90,0==i&&(0!=GameMap.fubenID&&(this.defeat.y=110),this.updateDefeatList()),0!=GameMap.fubenID&&1==i)if(GameMap.fbType==FbCT.FB_TYPE_EXP)this.closeBtn.label="领取奖励";else if(GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN){var h=SkyLevelModel.ins(),u=GlobalConfig.FbChallengeConfig[h.cruLevel];u&&ZsCT.ins().lv>=u.zsLevelLimit&&Actor.level>=u.levelLimit&&0==SkyLevelModel.ins().lotteryRemainTimes?(this.rewardBtn.visible=!0,this.closeBtn.x=0,1==u.layer?(this.rewardBtn.label="继续挑战",this.rewardBtn.width=130):(this.rewardBtn.label="挑战第"+u.layer+"层",this.rewardBtn.width=140)):(this.rewardBtn.visible=!1,this.closeBtn.x=90)}else if(GameMap.fbType==FbCT.FB_TYPE_NEW_WORLD_BOSS)this.winnerGroup.visible=!1,this.closeBtn.visible=!1,this.rewardBtn.visible=!1,this.txt.visible=!1,this.wpkBoss.visible=!0,this.wpkBoss.open();else if(GameMap.fbType==FbCT.FB_TYPE_HUN_SHOU){this.closeBtn.name="退出",this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)";var p=Hungu.ins().hunShouFBPassID,c=p>=Object.keys(GlobalConfig.FsFbConfig).length;c?(this.rewardBtn.visible=!1,this.closeBtn.x=90):(this.rewardBtn.visible=!0,this.closeBtn.x=0,this.rewardBtn.label="挑战第"+(p+1)+"层")}else this.rewardBtn.visible=!1;else this.rewardBtn.visible=!1;s?this.setRewardList(s):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);var i=[],n=[],s=[];if(this.isBossResult){this.winnerGroup.visible=!0,this.scrollerGroup.y+=60,this.scrollerGroup.height=336,this.labelEmblem.height=0,this.labelItem.height=20,this.labelEmblem.visible=!1,this.labelItem.visible=!0;for(var o=[],a=[],r=0;r<t.length;r++){var l=GlobalConfig.ItemConfig[t[r].id];if(1!=ItemUtil.getType(l))0==t[r].type?t[r].id==MoneyConst.soul?o.push(t[r]):i.push(t[r]):s.push(t[r]);else if(-1!=e.filterFb.indexOf(GameMap.fbType))n.push(t[r]);else if(n.length){for(var h=!1,u=0;u<n.length;u++)if(n[u].id==t[r].id){n[u].count+=t[r].count,h=!0;break}h||n.push(t[r])}else n.push(t[r])}s.sort(this.RuleSortByItem),a=o.concat(i,n,s),this.listItem.dataProvider=new eui.ArrayCollection(a)}else{for(var o=[],p=[],a=[],r=0;r<t.length;r++){var l=GlobalConfig.ItemConfig[t[r].id];if(1!=ItemUtil.getType(l))if(0==t[r].type)i.push(t[r]);else{var c=GlobalConfig.ItemConfig[t[r].id],d=ItemUtil.getType(c);d==ItemType.TYPE_6?s.push(t[r]):s.push(t[r])}else if(-1!=e.filterFb.indexOf(GameMap.fbType))p.push(t[r]);else if(p.length){for(var h=!1,u=0;u<p.length;u++)if(p[u].id==t[r].id){p[u].count+=t[r].count,h=!0;break}h||p.push(t[r])}else p.push(t[r])}this.winnerGroup.visible=!1,this.scrollerGroup.height=324,this.labelItem.text="获得道具：",this.labelEmblem.height=n.length>0?20:0,this.labelItem.height=s.length>0?20:0,this.labelEmblem.visible=n.length>0,this.labelItem.visible=s.length>0&&!GameMap.sceneInMine(),i.sort(this.RuleSort),s.sort(this.RuleSortByItem),this.listCoin.dataProvider=new eui.ArrayCollection(i),this.listEmblem.dataProvider=new eui.ArrayCollection(n),a=o.concat(i,p,s),this.listItem.dataProvider=new eui.ArrayCollection(a)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),this.wpkBoss.close();for(var i=1;6>i;i++)this.removeTouchEvent(this["img"+i],this.onTap);this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.openRole,this.onTap),this.removeTouchEvent(this.openRole1,this.onTap),GameMap.fubenID>0&&(!FbCT.ins().isQuite||KFServerSys.ins().isLinkingKF||this._fbType==FbCT.FB_TYPE_GUANQIABOSS&&this._fbType!=GameMap.fbType||FbCT.ins().sendExitFb()),this._fbType==FbCT.FB_TYPE_MATERIAL?ViewManager.ins().open(FbWin,0):this._fbType==FbCT.FB_TYPE_GUILD_BOSS?ViewManager.ins().open(GuildBossWin):this._fbType==FbCT.FB_TYPE_HOMEBOSS&&ViewManager.ins().open(BossWin,3),this.winResult&&GameMap.fubenID==GlobalConfig.MoJianFubenBaseConfig.fbId&&ViewManager.ins().open(FbWin,0,5),this.closeFunc&&(this.closeFunc(),this.closeFunc=null),this.bossmc&&(DisplayUtils.removeFromParent(this.bossmc),this.bossmc=null),SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN&&ViewManager.ins().open(BabelLotteryWin)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),CityCC.ins().isCity?this.closeBtn.label=""+this.closeBtn.name:this.closeBtn.label=this.closeBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:if(GameMap.fbType==FbCT.FB_TYPE_HUN_SHOU){if(!Hungu.ins().hunShouFBTimes)return void TipsCT.ins().showTips("剩余次数不足");ZsCT.ins().lv<GlobalConfig.FsFbConfig[Hungu.ins().hunShouFBPassID+1].zsLevelLimit?TipsCT.ins().showTips("转生等级不足"):(Hungu.ins().enterHunShouFB(),FbCT.ins().isQuite=!1)}else Fb2CT.ins().sendChallenge(),FbCT.ins().isQuite=!1;ViewManager.ins().close(this);break;case this.openRole:case this.openRole1:ViewManager.ins().close(this),ViewManager.ins().open(NewRoleWin)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay)if(16!=i.gainWay[n][0])t.push(i.gainWay[n][0]);else{var s=DieGuide.ins().getOpenRoles();if(s){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];o.itemId=s,t.push(i.gainWay[n][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return t.id<e.id?-1:1},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return s>o?-1:o>s?1:0},e.filterFb=[FbCT.FB_TYPE_MATERIAL,50],e}(BaseEuiView);__reflect(ResultWin.prototype,"ResultWin"),ViewManager.ins().reg(ResultWin,LayerManager.UI_Popup),window.ResultWin=ResultWin;var ThunderResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ThunderResultSkin",this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.addTouchEvent(this.eCloseBtn,this.onClick),this.update(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GameMap.fubenID>0&&FbCT.ins().isQuite&&FbCT.ins().sendExitFb()},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay){if(14==i.gainWay[n][0]){var s=Recharge.ins().getRechargeData(0);if(s.num&&2!=s.num&&VipCT.ins().vipIsMax(Actor.vip))continue}else if(16==i.gainWay[n][0]){var o=DieGuide.ins().getOpenRoles();if(o){var a=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];a.itemId=o,t.push(i.gainWay[n][0])}continue}t.push(i.gainWay[n][0])}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.win=function(t){this.updateUI(t);var e=GlobalConfig.FBLeiTingConf[t],i=e.reward;i&&this.setRewardList(i)},e.prototype.lost=function(){this.updateDefeatList()},e.prototype.update=function(t){if(this.bg.source=t?"win_png":"lost_png",this.eCloseBtn.name=t?"确认":"退出",this.title.source=t?"win_02":"lost_02",0==t)this.lost(),this.eUnlockGroup.visible=!1,this.eItemsGroup.visible=!1,this.defeat.visible=!0;else{this.eUnlockGroup.visible=!0,this.eItemsGroup.visible=!0,this.defeat.visible=!1;var e=ThunderCT.ins().curLayerId-1;this.win(e),this.updateUI(e)}this.s=5,this.updateCloseBtnLabel(),CityCC.ins().isCity||Timer.start(1e3,this.s,this.updateCloseBtnLabel,this)},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.eCloseBtn.label=this.eCloseBtn.name+"("+this.s+"s)"},e.prototype.updateUI=function(t){for(var e,i=GlobalConfig.LeitingEquipBaseConf.towerUnlock,n=0;n<i.length;n++)if(i[n][0]==t){e=i[n];break}if(e){this.eUnlockGroup.visible=!0;var s=e[1],o=this.equip.itemIcon;o.imgJob.visible=!1,this.equip.level.text="",o.imgIcon.source="lt"+(s>9?s:"0"+s),this.eunLockLab.text=ThunderCT.firstName+ThunderCT.equipNames[s]+"装备位"}else this.eUnlockGroup.visible=!1,this.eItemsGroup.y=this.eUnlockGroup.y},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],n=[],s=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))if(0==t[a].type)e.push(t[a]);else{var l=GlobalConfig.ItemConfig[t[a].id],h=ItemUtil.getType(l);h==ItemType.TYPE_6?i.push(t[a]):i.push(t[a])}else if(s.length){for(var u=!1,p=0;p<s.length;p++)if(s[p].id==t[a].id){s[p].count+=t[a].count,u=!0;break}u||s.push(t[a])}else s.push(t[a])}this.scrollerGroup.height=324,e.sort(this.RuleSort),i.sort(this.RuleSortByItem),o=n.concat(e,s,i),this.listItem.itemRenderer=ItemBase,this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.RuleSort=function(t,e){return t.id<e.id?-1:1},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return s>o?-1:o>s?1:0},e.prototype.onClick=function(t){switch(t.target){case this.eCloseBtn:FbCT.ins().isQuite=!0,ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ThunderResultWin.prototype,"ThunderResultWin"),ViewManager.ins().reg(ThunderResultWin,LayerManager.UI_Popup),window.ThunderResultWin=ThunderResultWin;var TongResultWin=function(t){function e(){var e=t.call(this)||this;return e.repeatTimes=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChuangtianguanResultSkin",this.listCoin.itemRenderer=ResultCoinItem,this.listItem.itemRenderer=ItemBase,this.listData0=new eui.ArrayCollection,this.list0.itemRenderer=DefeatItem},e.prototype.showRune=function(t){if(GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN){if(!t)return void(this.nune.visible=!1);var e=GlobalConfig.FbChallengeConfig[SkyLevelModel.ins().cruLevel-1];if(!e||!e.showIcon)return void(this.nune.visible=!1);var i=GlobalConfig.ItemConfig[e.showIcon],n=ItemUtil.getQuality(i);if(n==FBChallengePanel.RunType)return void(this.nune.visible=!1);this.nune.visible=!0,this.scrollerGroup.y+=3*this.nune.height/2;var s="";e.equipPos?(this.nuneLock.visible=!0,s="开启图腾槽：",this.oldValue.text=(e.equipPos-1).toString(),this.newValue.text=e.equipPos.toString()):(this.nuneLock.visible=!1,s="解锁类型：",this.nuneValue.text=e.describe),this.nameLabel.text=s,this.nuneValue.visible=!this.nuneLock.visible}},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e);var n=e[0];this.bg.source=n?"win_png":"lost_png",this.closeBtn.name=n?"领取奖励":"退出",this.title.source=n?"win_02":"lost_02",DieGuide.ins().postdieGuide(n),this.showRune(n);var s=5;this.s=this.repeatTimes=s,this.closeBtn.label=""+this.closeBtn.name;var o=e[1];if(e[2]&&(this.txt.text=e[2]),FbCT.ins().isQuite=!0,e[3]instanceof Function?this.closeFunc=e[3]:0==e[3]&&(FbCT.ins().isQuite=e[3]),this.txt.visible=0!=n,this.defeat.visible=0==n,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rewardBtn,this.onTap),0==n)this.rewardBtn.visible=!1,this.updateDefeatList();else if(1==n){var a=SkyLevelModel.ins(),r=GlobalConfig.FbChallengeConfig[a.cruLevel];r&&ZsCT.ins().lv>=r.zsLevelLimit&&Actor.level>=r.levelLimit&&0==SkyLevelModel.ins().lotteryRemainTimes?(this.rewardBtn.visible=!0,this.closeBtn.x=0,1==r.layer?this.rewardBtn.label="继续挑战":this.rewardBtn.label="挑战第"+r.layer+"层",this.rewardBtn.name=this.rewardBtn.label,this.updateRewardBtnLabel()):(this.rewardBtn.visible=!1,this.closeBtn.x=90)}this.rewardBtn.visible&&Timer.start(1e3,this.repeatTimes,this.updateRewardBtnLabel,this),o?this.setRewardList(o):this.setRewardList()},e.prototype.setRewardList=function(t){void 0===t&&(t=[]);for(var e=[],i=[],n=[],s=[],o=[],a=0;a<t.length;a++){var r=GlobalConfig.ItemConfig[t[a].id];if(1!=ItemUtil.getType(r))0==t[a].type?e.push(t[a]):i.push(t[a]);else if(s.length){for(var l=!1,h=0;h<s.length;h++)if(s[h].id==t[a].id){s[h].count+=t[a].count,l=!0;break}l||s.push(t[a])}else s.push(t[a])}this.scrollerGroup.height=324,this.labelItem.text="获得道具：",this.labelItem.height=i.length>0?20:0,this.labelItem.visible=i.length>0,e.sort(this.RuleSort),i.sort(this.RuleSortByItem),this.listCoin.dataProvider=new eui.ArrayCollection(e),o=n.concat(e,s,i),this.listItem.dataProvider=new eui.ArrayCollection(o)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateRewardBtnLabel,this),this.removeTouchEvent(this.closeBtn,this.onTap),GameMap.fubenID>0&&FbCT.ins().isQuite&&FbCT.ins().sendExitFb(),this.closeFunc&&(this.closeFunc(),this.closeFunc=null),SkyLevelModel.ins().lotteryRemainTimes>0&&GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN&&ViewManager.ins().open(BabelLotteryWin)},e.prototype.updateRewardBtnLabel=function(){this.s--,this.s<=0&&(Fb2CT.ins().sendChallenge(),FbCT.ins().isQuite=!1,ViewManager.ins().close(this)),this.rewardBtn.label=this.rewardBtn.name+"("+this.s+"s)"},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.rewardBtn:Fb2CT.ins().sendChallenge(),FbCT.ins().isQuite=!1,ViewManager.ins().close(this)}},e.prototype.updateDefeatList=function(){var t=[];for(var e in GlobalConfig.DeathGuideConfig){var i=GlobalConfig.DeathGuideConfig[e];if(ZsCT.ins().lv<=i.zslv||Actor.level<=i.lv){for(var n in i.gainWay)if(16!=i.gainWay[n][0])(14!=i.gainWay[n][0]&&20!=i.gainWay[n][0]||!VipCT.ins().vipIsMax(Actor.vip))&&t.push(i.gainWay[n][0]);else{var s=DieGuide.ins().getOpenRoles();if(s){var o=GlobalConfig.DeathgainWayConfig[i.gainWay[n][0]];o.itemId=s,t.push(i.gainWay[n][0])}}break}}this.listData0.source=t,this.list0.dataProvider=this.listData0},e.prototype.RuleSort=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return s>o?-1:o>s?1:0},e}(BaseEuiView);__reflect(TongResultWin.prototype,"TongResultWin"),ViewManager.ins().reg(TongResultWin,LayerManager.UI_Popup),window.TongResultWin=TongResultWin;var FloatingWindowView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isTopLevel=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.showFloatWin(t[0])},e.prototype.showFloatWin=function(t){if(t){var e=ObjectPool.pop("FloatingWindowWin");e.bottom=150,e.horizontalCenter=160,e.setImg(t,e),this.addChild(e),FloatWinCT.ins().checkItem([ItemUtil.getType(t.itemConfig),t.configID]),FloatWinCT.ins().floatWindow.unshift(e)}},e}(BaseEuiView);__reflect(FloatingWindowView.prototype,"FloatingWindowView"),ViewManager.ins().reg(FloatingWindowView,LayerManager.UI_Tips),window.FloatingWindowView=FloatingWindowView;var FloatingWindowWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="floatingWindowSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this,this.onClick)},e.prototype.setImg=function(t,e){t&&(this.img.source=t.itemConfig.showImg,this.itemIcon.data=t,this.itemIcon.setRedPoint(!1),this.item=t,this.tips=e)},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:FloatWinCT.ins().removeItemWin(t.target.parent);break;case this.buyBtn:FloatWinCT.ins().onUse(this.item,this.item.count),FloatWinCT.ins().removeItemWin(t.target.parent)}},e}(BaseView);__reflect(FloatingWindowWin.prototype,"FloatingWindowWin"),window.FloatingWindowWin=FloatingWindowWin;var FloatWinCT=function(t){function e(){var e=t.call(this)||this;return e.floatWindow=[],e.bossBoxIdList=[230001,230002,230003],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.showItemWin=function(t){this.view.showFloatWin(t)},Object.defineProperty(e.prototype,"view",{get:function(){return this._view&&this._view.parent||(ViewManager.ins().open(FloatingWindowView),this._view=ViewManager.ins().getView(FloatingWindowView)),this._view},enumerable:!0,configurable:!0}),e.prototype.removeItemWin=function(t,i){DisplayUtils.removeFromParent(t),i||0==i?e.ins().floatWindow.splice(i,1):e.ins().floatWindow.pop()},e.prototype.checkItem=function(t){var e,i=t[0],n=t[1],s=this.floatWindow,o=-1;for(var a in s)ItemUtil.getType(s[a].itemIcon.data.itemConfig)==i&&s[a].itemIcon.data.configID==n&&(o=+a,e=s[a]);o>-1&&this.removeItemWin(e,o)},e.prototype.checkCanMerge=function(t){var e=t.itemConfig.id;return!!GlobalConfig.ItemComposeConfig[e]},e.prototype.onMerge=function(){var t=this._data.itemConfig,e=t.id,i=this._data.count,n=GlobalConfig.ItemComposeConfig[e];return n.srcCount>i?void TipsCT.ins().showTips("数量不足,不能合成"):void BagCT.ins().sendMergeItem(e,i)},e.prototype.onUseType10=function(){for(var t=this._data.itemConfig,e=200013==t.id?0:1,i=0;i<SubRoles.MAX_ROLES;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(!n){TipsCT.ins().showTips("角色未开启，无法使用");break}var s=n.getExRingsData(e);if(0>=s){ViewManager.ins().open(RoleWin,0,i),ViewManager.ins().isShow(ItemUseTipsWin)&&ViewManager.ins().close(ItemUseTipsWin);break}}},e.prototype.onUseType13=function(){var t=this._data.itemConfig,e=t.useCond;if(300==t.descIndex)return void this.onUseType13_300();if(302==t.descIndex)return void this.onUseType13_302();if(200215==t.id)return void this.onUseType13_swly();if(200216==t.id)return void this.onUseType13_symd();if(!e)return void TipsCT.ins().showTips("错误卷轴的使用类型");var i=BossCT.ins().worldBossLeftTime[e],n=t.name;return i>0?void TipsCT.ins().showTips("无"+n+"挑战次数时,才能使用"):(TipsCT.ins().showTips("使用成功,获得"+this.useNum+"次"+n+"挑战次数"),void BagCT.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType13_symd=function(){var t=KFBossSys.ins().enterNum9;return t>0?void TipsCT.ins().showTips("无深渊boss归属次数时,才能使用"):(TipsCT.ins().showTips("使用成功,获得"+this.useNum+"次深渊boss归属次数"),void BagCT.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType13_swly=function(){var t=this,e=KFBossSys.ins().bossTimes;if(e>0)return void TipsCT.ins().showTips("无神威boss归属次数时,才能使用");var i=GlobalConfig.CrossBossBase;if(i&&i.bossBelongMaxCount&&KFBossSys.ins().swlyUseNum>=i.bossBelongMaxCount)return void TipsCT.ins().showTips("已达到当前每日归属上限");var n="确定使用1个<font color='#FFB82A'>跨服挑战卷轴</font>进入挑战？\n";WarnWin.show(n,function(){BagCT.ins().registerUseItemFunc(t.goodsId,function(){}),TipsCT.ins().showTips("使用成功,获得1次神威boss归属次数"),BagCT.ins().sendUseItem(t.goodsId,1)},this)},e.prototype.onUseType13_300=function(){var t=FbCT.ins().fbRings.challengeTime;return t>0?void TipsCT.ins().showTips("无挑战次数时,才能使用"):(TipsCT.ins().showTips("使用成功,获得"+this.useNum+"次烈焰副本挑战次数"),void BagCT.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType13_302=function(){var t=GodWeaponCC.ins().fubenInfoData.hadChallengeNum;
return t>0?void TipsCT.ins().showTips("无挑战次数时,才能使用"):(TipsCT.ins().showTips("使用成功,获得"+this.useNum+"次神兵副本挑战次数"),void BagCT.ins().sendUseItem(this.goodsId,this.useNum))},e.prototype.onUseType14=function(){ViewManager.ins().open(RenameWin)},e.prototype.onUse=function(t,e){this._data=t,this.goodsId=this._data.configID,this.useNum=e;var i=ViewManager.ins().isShow(ItemUseTipsWin),n=this._data.itemConfig;if(n.id==GlobalConfig.WingCommonConfig.attrPillId||n.id==GlobalConfig.WingCommonConfig.flyPillId)return WingCT.ins().userDans(n.id),void(i&&ViewManager.ins().close(ItemUseTipsWin));if(this.checkCanMerge(this._data))return this.onMerge(),void(i&&ViewManager.ins().close(ItemUseTipsWin));var s=ItemUtil.getType(n);if(s==ItemType.TYPE_2)return ViewManager.ins().open(SkillWin,3),i&&ViewManager.ins().close(ItemUseTipsWin),void MijiCT.ins().postBagUseMiji(n.id);if(s==ItemType.TYPE_10)return this.onUseType10(),void(i&&ViewManager.ins().close(ItemUseTipsWin));if(s==ItemType.TYPE_13)return this.onUseType13(),void(i&&ViewManager.ins().close(ItemUseTipsWin));if(s==ItemType.TYPE_14)return this.onUseType14(),void(i&&ViewManager.ins().close(ItemUseTipsWin));if(s==ItemType.TYPE_20&&!SpecialRing.ins().checkCanUseByItem(n.id))return TipsCT.ins().showTips("烈焰精髓的使用数量已达到最大值"),void(i&&ViewManager.ins().close(ItemUseTipsWin));if(n.id==ItemConst.LEVELUP_ITEM){var o=Recharge.ins().getRechargeData(0);if(!o.num)return TipsCT.ins().showTips("充值任意金额才能开启礼包"),i&&ViewManager.ins().close(ItemUseTipsWin),void RechargeData.checkOpenWin()}if(n.id==GlobalConfig.MijiBaseConfig.lockId)return i&&ViewManager.ins().close(ItemUseTipsWin),void ViewManager.ins().open(MijiLockWin,MijiCT.BAGOPEN);if(s==ItemType.TYPE_9)return i&&ViewManager.ins().close(ItemUseTipsWin),void ViewManager.ins().open(LiLianWin,3);if(this.isBossBox)return i&&ViewManager.ins().close(ItemUseTipsWin),void ViewManager.ins().open(RandBossWin,this.goodsId);if(s==ItemType.TYPE_47){if(this._data.endTime>GameServer.serverTime&&!GlobalFun.checkMoney(n.needyuanbao*e))return}else if(n.needyuanbao&&Actor.yb<n.needyuanbao)return TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),void(i&&ViewManager.ins().close(this));if(s==ItemType.TYPE_8){var a=n.level?n.level:0,r=n.zsLevel?n.zsLevel:0;if(Actor.level>=a&&ZsCT.ins().lv>=r);else{var l="";ZsCT.ins().lv<r&&(l+=r+"转"),Actor.level<a&&(l+=a+"级"),TipsCT.ins().showTips("需要"+l+"后使用")}}return s==ItemType.TYPE_25?(Auction.ins().sendOpenAuBox(n.id),void(i&&ViewManager.ins().close(ItemUseTipsWin))):void((BagCT.ins().sendUseItem(this.goodsId,this.useNum)||n.split)&&i&&ViewManager.ins().close(ItemUseTipsWin))},e}(BaseSystem);__reflect(FloatWinCT.prototype,"FloatWinCT"),System.FloatWinCT=function(){return FloatWinCT.ins()},window.FloatWinCT=FloatWinCT;var ForgeCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.strongthen,e.regNetMsg(2,e.doForgeUpdata),e.regNetMsg(5,e.postMeltItem),e.observe(BagCT.ins().postItemAdd,e.delaySeekItem),e.observe(BagCT.ins().postItemDel,e.delaySeekItem),e.observe(BagCT.ins().postItemChange,e.delaySeekItem),e.observe(Actor.ins().postSoulChange,e.delaySeekItem),e}return __extends(e,t),Object.defineProperty(e,"CONDITION_ZHUZAO",{get:function(){return GlobalConfig.StoneOpenConfig[0].openLv},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.doForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e).parseForgeChange(t,this.sysId);this.postForgeUpdate(this.sysId,i)},e.prototype.postForgeUpdate=function(t,e){return void 0===e&&(e=0),[t,e]},e.prototype.postForgeTips=function(t){return t?1:0},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.delaySeekItem=function(){Timer.has(this.seekForgeItem,this)||Timer.start(60,1,this.seekForgeItem,this)},e.prototype.seekForgeItem=function(){for(var t=!1,e=BagCT.ins().getBagItemNum(0),i=0;e>i;i++){var n=BagCT.ins().getBagGoodsByIndex(0,i);switch(n.itemConfig.id){case 200002:t=this.forgeHint(0,n.count);break;case 200003:t=this.forgeHint(ForgeWin.Page_Select_ZhuLing,n.count)}if(t)break}if(t||(t=this.forgeHint(ForgeWin.Page_Select_Gem,Actor.soul)),!t)for(var s=0;s<SubRoles.ins().subRolesLen&&!(t=Weapons.ins().checkRedPoint(s));s++);this.postForgeTips(t)},e.prototype.getForgeConfigByPos=function(t,e,i){var n=this.getForgeConfig(i);return n[t]&&n[t][e]},e.prototype.getForgeConfig=function(t){if(this.forgeConfigDic=this.forgeConfigDic||{},!this.forgeConfigDic[t]){var e=void 0;switch(t){case ForgeWin.Page_Select_Boost:e=GlobalConfig.EnhanceAttrConfig;break;case ForgeWin.Page_Select_ZhuLing:e=GlobalConfig.ZhulingAttrConfig;break;case ForgeWin.Page_Select_Gem:e=GlobalConfig.StoneLevelConfig;break;case 3:}var i=this.forgeConfigDic[t]={};for(var n in e){var s=e[n];i[s.posId]||(i[s.posId]={}),i[s.posId][s.level]=e[n]}}return this.forgeConfigDic[t]},e.prototype.getEnhanceCostConfigByLv=function(t){var e=GlobalConfig.EnhanceCostConfig;return e[t]},e.prototype.getStoneLevelCostConfigByLv=function(t){var e,i=GlobalConfig.StoneLevelCostConfig;for(e in i){var n=i[e];if(n.level==t)return n}return null},e.prototype.getZhulingCostConfigByLv=function(t){var e,i=GlobalConfig.ZhulingCostConfig;for(e in i){var n=i[e];if(n.level==t)return n}return null},e.prototype.jingLianCanUp=function(){for(var t=SubRoles.ins().subRolesLen,e=!1,i=0;t>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i),s=n.getMinEquipIndexByType(1),o=n.getEquipByIndex(s).zhuling,a=this.getZhulingCostConfigByLv(o+1).count;if(a){var r=this.getZhulingCostConfigByLv(o+1).itemId,l=BagCT.ins().getBagGoodsCountById(0,r);if(l>=a){e=!0;break}}}return e},e.prototype.getTupoCostConfigByLv=function(t){return null},e.prototype.forgeHint=function(t,i){for(var n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getMinEquipIndexByType(t),r=this.getForgeLv(t,o,a),l=this.getForgeCount(t,r);if(l&&i>=l){if(t!=ForgeWin.Page_Select_Gem)return this.postForgeTips(!0),!0;if(Actor.level>=e.CONDITION_ZHUZAO)return this.postForgeTips(!0),!0}}return this.postForgeTips(!1),!1},e.prototype.getForgeLv=function(t,e,i){switch(t){case ForgeWin.Page_Select_Boost:return e.getEquipByIndex(i).strengthen;case ForgeWin.Page_Select_ZhuLing:return e.getEquipByIndex(i).zhuling;case ForgeWin.Page_Select_Gem:return e.getEquipByIndex(i).gem;case 3:return e.getEquipByIndex(i).tupo}},e.prototype.getForgeCount=function(t,e){switch(t){case ForgeWin.Page_Select_Boost:var i=this.getEnhanceCostConfigByLv(e+1);if(i)return i.stoneNum;break;case ForgeWin.Page_Select_ZhuLing:var n=this.getZhulingCostConfigByLv(e+1);if(n)return n.count;break;case ForgeWin.Page_Select_Gem:var s=this.getStoneLevelCostConfigByLv(e+1);if(s)return s.soulNum;break;case 3:var o=this.getTupoCostConfigByLv(e+1);if(o)return o.count}return 0},e.prototype.countAllBoostAttr=function(t,i,n,s){void 0===n&&(n=0),void 0===s&&(s=!1);for(var o=[],a=SubRoles.ins().getSubRoleByIndex(t),r=0;r<EquipCT.FOEGE_MAX;r++){var l=null,h=this.getForgeLv(i,a,r);s&&n==r&&(h+=1),l=this.getForgeConfigByPos(r,h,i),l&&l.attr&&(o=e.AttrAddition(l.attr,o))}return o},e.prototype.isMaxForge=function(t,e){for(var i=0;8>i;i++){var n=this.getForgeLv(e,t,e),s=this.getForgeConfigByPos(e,n+1,e);if(!s)return!1}return!0},e.AttrAddition=function(t,e){for(var i,n=t.length,s=e.length,o=[],a=0;n>a;a++)i=AttributeData.copyAttrbute(t[a]),o.push(i);for(var r=0;s>r;r++){for(var l=!1,a=0;a<o.length;a++)e[r].type==o[a].type&&(o[a].value=o[a].value+e[r].value,l=!0);l||(i=AttributeData.copyAttrbute(e[r]),o.push(i))}return o},e.prototype.sendMeltItem=function(t){var e=this.getBytes(5);e.writeShort(t.length);for(var i in t)e.writeInt(t[i].configID),e.writeInt(t[i].count);this.sendToServer(e)},e.prototype.postMeltItem=function(){},e.upGradeTime=150,__decorate([post()],e.prototype,"postForgeUpdate",null),__decorate([post()],e.prototype,"postForgeTips",null),__decorate([post()],e.prototype,"postMeltItem",null),e}(BaseSystem);__reflect(ForgeCT.prototype,"ForgeCT"),System.ForgeCT=function(){return ForgeCT.ins()},window.ForgeCT=ForgeCT;var GemCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Gem,e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),n=i.parseForgeChange(t,this.sysId);ForgeCT.ins().postForgeUpdate(this.sysId,n)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.ROLL_NUM=8,__decorate([post()],e.prototype,"postForgeUpdata",null),e}(BaseSystem);__reflect(GemCT.prototype,"GemCT"),System.GemCT=function(){return GemCT.ins()},window.GemCT=GemCT;var TupoCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Tupo,e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e);i.parseForgeChange(t,this.sysId),ForgeCT.ins().postForgeUpdate(this.sysId)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},__decorate([post()],e.prototype,"postForgeUpdata",null),e}(BaseSystem);__reflect(TupoCT.prototype,"TupoCT"),System.TupoCT=function(){return TupoCT.ins()},window.TupoCT=TupoCT;var ZhuLingCT=function(t){function e(){var e=t.call(this)||this;return e.power=[],e.sysId=PackageID.Zhuling,e.regNetMsg(1,e.InitPower),e.regNetMsg(2,e.postForgeUpdata),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.InitPower=function(t){for(var e=t.readByte(),i=0;e>i;i++)this.power[i]=t.readInt()},e.prototype.postForgeUpdata=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),n=i.parseForgeChange(t,this.sysId);this.power[e]=t.readInt(),ForgeCT.ins().postForgeUpdate(this.sysId,n)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},__decorate([post()],e.prototype,"InitPower",null),__decorate([post()],e.prototype,"postForgeUpdata",null),e}(BaseSystem);__reflect(ZhuLingCT.prototype,"ZhuLingCT"),System.ZhuLingCT=function(){return ZhuLingCT.ins()},window.ZhuLingCT=ZhuLingCT;var RenderTextureManager=function(t){function e(){var e=t.call(this)||this;return e._pool=[],e._useNum=0,e.isLowerQQBrowser()?e._maxNum=18:e._maxNum=-1,e}return __extends(e,t),e.prototype.isLowerQQBrowser=function(){if(DeviceUtils.IsQQBrowser){for(var t=["2013022","Lenovo A630t","SM-G3818","vivo X3t","GT-I9100"],e=!1,i=0,n=t.length;n>i;i++)if(-1!=navigator.userAgent.indexOf(t[i])){e=!0;break}return e}return!1},e.prototype.pop=function(){var t=this._pool.pop();return t||(-1==this._maxNum||this._useNum<this._maxNum)&&(t=new egret.RenderTexture,this._useNum++),t},e.prototype.push=function(t){for(var e=!1,i=0,n=this._pool.length;n>i;i++)if(this._pool[i]==t){e=!0;break}e||this._pool.push(t)},e}(BaseClass);__reflect(RenderTextureManager.prototype,"RenderTextureManager");var ForgeConst;!function(t){t.CAN_FORGE_EQUIP=[EquipPos.WEAPON,EquipPos.HEAD,EquipPos.CLOTHES,EquipPos.NECKLACE,EquipPos.Wrist,EquipPos.BRACELET,EquipPos.RING,EquipPos.SHOE],t.EQUIP_POS_TO_SUB=[],t.EQUIP_POS_TO_SUB[EquipPos.WEAPON]=0,t.EQUIP_POS_TO_SUB[EquipPos.HEAD]=1,t.EQUIP_POS_TO_SUB[EquipPos.CLOTHES]=2,t.EQUIP_POS_TO_SUB[EquipPos.NECKLACE]=3,t.EQUIP_POS_TO_SUB[EquipPos.Wrist]=4,t.EQUIP_POS_TO_SUB[EquipPos.BRACELET]=5,t.EQUIP_POS_TO_SUB[EquipPos.RING]=6,t.EQUIP_POS_TO_SUB[EquipPos.SHOE]=7,t.EQUIP_POS_TO_SUB[EquipPos.DZI]=8,t.EQUIP_POS_TO_SUB[EquipPos.HAT]=9,t.EQUIP_POS_TO_SUB[EquipPos.VIZARD]=10,t.EQUIP_POS_TO_SUB[EquipPos.CLOAK]=11,t.EQUIP_POS_TO_SUB[EquipPos.SHIELD]=12}(ForgeConst||(ForgeConst={})),window.ForgeConst=ForgeConst;var ForgeRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.flexible={},e.tabs={},e.roleTabs={},e.flexible={},e.redPoint=!1,e.associated(e.postForgeRedPoint,e.postForgeBoostRedPoint,e.postForgeZhulingRedPoint,e.postForgeGemRedPoint,e.postForgeWeaponRedPoint),e.associated(e.postForgeBoostRedPoint,ForgeCT.ins().postForgeUpdate,ForgeCT.ins().postForgeTips),e.associated(e.postForgeZhulingRedPoint,ForgeCT.ins().postForgeUpdate,ForgeCT.ins().postForgeTips),e.associated(e.postForgeGemRedPoint,ForgeCT.ins().postForgeUpdate,ForgeCT.ins().postForgeTips),e.associated(e.postForgeWeaponRedPoint,ForgeCT.ins().postForgeUpdate,ForgeCT.ins().postForgeTips,Weapons.ins().postWeaponsUse,Weapons.ins().postWeaponsFlexibleAct,Weapons.ins().postWeaponsInfo),e}return __extends(e,t),e.prototype.postForgeRedPoint=function(){var t=this.redPoint;return this.redPoint=this.tabs[ForgeWin.Page_Select_Boost]||this.tabs[ForgeWin.Page_Select_ZhuLing]||this.tabs[ForgeWin.Page_Select_Gem]||this.tabs[ForgeWin.Page_Select_Weapon]||this.tabs[ForgeWin.Page_Select_Gw],t!=this.redPoint},e.prototype.getRedPoint=function(t){return this.tabs[t]},e.prototype.getFlexibleRoleRedPoint=function(t){return this.flexible[t]},e.prototype.postForgeBoostRedPoint=function(){for(var t=ForgeWin.Page_Select_Boost,e=this.tabs[t],i=!1,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).strengthen,l=ForgeCT.ins().getEnhanceCostConfigByLv(r+1);if(l){var h=l.stoneNum;if(h){var u=l.stoneId,p=BagCT.ins().getBagGoodsCountById(0,u);if(p>=h){var c=ForgeCT.ins().isMaxForge(o,t);c&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][s]=p>=h}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeZhulingRedPoint=function(){for(var t=ForgeWin.Page_Select_ZhuLing,e=this.tabs[t],i=!1,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).zhuling,l=ForgeCT.ins().getZhulingCostConfigByLv(r+1);if(l){var h=l.count;if(h){var u=l.itemId,p=BagCT.ins().getBagGoodsCountById(0,u);if(p>=h){var c=ForgeCT.ins().isMaxForge(o,t);c&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][s]=p>=h}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeGemRedPoint=function(){if(Actor.level<GlobalConfig.StoneOpenConfig[0].openLv)return!1;for(var t=ForgeWin.Page_Select_Gem,e=this.tabs[t],i=!1,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=o.getMinEquipIndexByType(t),r=o.getEquipByIndex(a).gem,l=ForgeCT.ins().getStoneLevelCostConfigByLv(r+1);if(l){var h=l.soulNum;if(h){var u=(l.stoneId,Actor.soul);if(u>=h){var p=ForgeCT.ins().isMaxForge(o,t);p&&(i=!0)}this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][s]=u>=h}}}return this.tabs[t]=i,e!=i},e.prototype.postForgeWeaponRedPoint=function(){for(var t=ForgeWin.Page_Select_Weapon,e=!1,i=!1,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=Weapons.ins().checkRedPoint(s);o&&(i=o),this.roleTabs[t]||(this.roleTabs[t]={}),e||this.roleTabs[t][s]==o||(e=!0);var a=this.getFlexibleRedPoint(s);this.flexible[s]=a,this.roleTabs[t][s]=o}return this.tabs[t]=i,e},e.prototype.getFlexibleRedPointOnly=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t),n=i.weapons.getFlexibleData();if(i.weapons.flexibleCount<=n.length)return!1;var s=i.weapons.getSoulInfoData(),o=[];for(var a in s)s[a]&&s[a].id&&o.push(s[a].id);return-1==n.indexOf(e)?!0:!1},e.prototype.getFlexibleRedPoint=function(t){var e=SubRoles.ins().getSubRoleByIndex(t),i=e.weapons.getFlexibleData();if(e.weapons.flexibleCount<=i.length)return!1;for(var n in GlobalConfig.WeaponSoulConfig){var s=GlobalConfig.WeaponSoulConfig[n];if(e.weapons.getRedPointBySuit(s.id))return!0}return!1},__decorate([post()],e.prototype,"postForgeRedPoint",null),__decorate([post()],e.prototype,"postForgeBoostRedPoint",null),__decorate([post()],e.prototype,"postForgeZhulingRedPoint",null),__decorate([post()],e.prototype,"postForgeGemRedPoint",null),__decorate([post()],e.prototype,"postForgeWeaponRedPoint",null),e}(BaseSystem);__reflect(ForgeRedPoint.prototype,"ForgeRedPoint"),System.ForgeRedPoint=function(){return ForgeRedPoint.ins()},window.ForgeRedPoint=ForgeRedPoint;var CastingPosItemRender=function(t){function e(){var e=t.call(this)||this;return e.statuList=["open","select","dark"],e.skinName="castingpositemrenderskin",e}return __extends(e,t),e.prototype.setShowStatu=function(t){this.currentState=this.statuList[t]},e}(BaseView);__reflect(CastingPosItemRender.prototype,"CastingPosItemRender"),window.CastingPosItemRender=CastingPosItemRender;var Castingposlist=function(t){function e(){var e=t.call(this)||this;return e.skinName="castingposlistskin",e}return __extends(e,t),e.prototype.setShow=function(t,e,i){this.currentState="pos_"+t;for(var n=i?GemCT.ROLL_NUM:e%GemCT.ROLL_NUM,s=0;s<GemCT.ROLL_NUM;s++){var o=0;o=n>s?0:n==s?1:2,this["item"+s].setShowStatu(o),this["line_"+s]&&(this["line_"+s].source=0==o?"zhuzaoxian":"zhuzaoxianbg")}},e}(BaseView);__reflect(Castingposlist.prototype,"Castingposlist"),window.Castingposlist=Castingposlist;var CircleRunBoostView=function(t){function e(){var e=t.call(this)||this;e.equipSource=["xduanzao_20","xduanzao_21","xduanzao_22","xduanzao_23","xduanzao_24","xduanzao_24","xduanzao_25","xduanzao_25"],e.nameBg=["xduanzao_10_png","xduanzao_11_png"],e.skinName="CircleRunBoostSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.itemName.source="xduanzao_12_png",e.item1.itemName.source="xduanzao_13_png",e.item2.itemName.source="xduanzao_14_png",e.item3.itemName.source="xduanzao_15_png",e.item4.itemName.source="xduanzao_16_png",e.item5.itemName.source="xduanzao_16_png",e.item6.itemName.source="xduanzao_17_png",e.item7.itemName.source="xduanzao_17_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var n=0;switch(this._type){case 0:n=t.getEquipByIndex(i).strengthen}this.itemList[i].setValue(n)}},e.prototype.turnItem=function(t){this.equip.source=this.equipSource[t],this.setNameBg(t)},e.prototype.setNameBg=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].setSource(this.nameBg[1]):this.itemList[i].setSource(this.nameBg[0])},e}(BaseView);__reflect(CircleRunBoostView.prototype,"CircleRunBoostView"),window.CircleRunBoostView=CircleRunBoostView;var CircleRunGemView=function(t){function e(){var e=t.call(this)||this;e.skinName="CircleRunGemSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.item.source="forge_00_png",e.item1.item.source="forge_01_png",e.item2.item.source="forge_02_png",e.item3.item.source="forge_03_png",e.item4.item.source="forge_04_png",e.item5.item.source="forge_05_png",e.item6.item.source="forge_06_png",e.item7.item.source="forge_07_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var n=0;switch(this._type){case 1:n=t.getEquipByIndex(i).gem}this.itemList[i].setValue(n)}},e.prototype.turnItem=function(t){this.setItemSelect(t)},e.prototype.setItemSelect=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].isSelectEff(!0):this.itemList[i].isSelectEff(!1)},e}(BaseView);__reflect(CircleRunGemView.prototype,"CircleRunGemView"),window.CircleRunGemView=CircleRunGemView;var CircleRunView=function(t){function e(){var e=t.call(this)||this;return e.boostView=new CircleRunBoostView,e.addChild(e.boostView),e.gemView=new CircleRunGemView,e.addChild(e.gemView),e.zhulingView=new CircleRunZhulingView,e.addChild(e.zhulingView),e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){switch(this._type=t,this.boostView.visible=!1,this.gemView.visible=!1,this.zhulingView.visible=!1,this._type){case 0:this.boostView.visible=!0,this.boostView.type=t;break;case 1:this.gemView.visible=!0,this.gemView.type=t;break;case 2:this.zhulingView.visible=!0,this.zhulingView.type=t;break;case 3:}this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setCurRole=function(t){this._curRole=t,this.boostView.curRole=t,this.gemView.curRole=t,this.zhulingView.curRole=t},e.prototype.getCurRole=function(){return this._curRole},e.prototype.setValue=function(){switch(this._type){case 0:this.boostView.setValue();break;case 1:this.gemView.setValue();break;case 2:this.zhulingView.setValue();break;case 3:}},e.prototype.turnItem=function(t){switch(this._type){case 0:this.boostView.turnItem(t);break;case 1:this.gemView.turnItem(t);break;case 2:this.zhulingView.turnItem(t);break;case 3:}},e.BOOST=0,e.GEM=1,e.ZHU_LING=2,e.EQUIP_COUNT=8,e}(BaseView);__reflect(CircleRunView.prototype,"CircleRunView"),window.CircleRunView=CircleRunView;var CircleRunZhulingView=function(t){function e(){var e=t.call(this)||this;e.skinName="CircleRunZhulingSkin",e.itemList=[];for(var i=CircleRunView.EQUIP_COUNT;i--;)e.itemList[i]=e["item"+i];return e.item0.item.source="forge_00_png",e.item1.item.source="forge_01_png",e.item2.item.source="forge_02_png",e.item3.item.source="forge_03_png",e.item4.item.source="forge_04_png",e.item5.item.source="forge_05_png",e.item6.item.source="forge_06_png",e.item7.item.source="forge_07_png",e}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t;for(var e=0;e<this.itemList.length;e++)this.itemList[e].setType(this._type);this.setValue()},enumerable:!0,configurable:!0}),e.prototype.setValue=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=this.itemList.length,i=0;e>i;i++){var n=0;switch(this._type){case 2:n=t.getEquipByIndex(i).zhuling}this.itemList[i].setValue(n)}},e.prototype.turnItem=function(t){this.setItemSelect(t)},e.prototype.setItemSelect=function(t){for(var e=this.itemList.length,i=0;e>i;i++)i==t?this.itemList[i].isSelectEff(!0):this.itemList[i].isSelectEff(!1)},e}(BaseView);__reflect(CircleRunZhulingView.prototype,"CircleRunZhulingView"),window.CircleRunZhulingView=CircleRunZhulingView;var ForgeBoostPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curRole=0,e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.startPos=0,e.isclick=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.upGradeBtn.label="强  化",this.curPanel=ForgeWin.Page_Select_Boost,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.eff=new MovieClip,this.eff.x=this.upGradeBtn.width/2,this.eff.y=this.upGradeBtn.height/2,this.eff.touchEnabled=!1,this.addTouchEvent(this.upGradeBtn0,this.onTouch),this.addTouchEvent(this.getItemTxt,this.onGetItem),this.curRole=this.curRole},e.prototype.addDisplay=function(){var t=this;this.observe(BagCT.ins().postItemAdd,this.setCount),this.observe(BagCT.ins().postItemChange,this.setCount),this.observe(Actor.ins().postLevelChange,this.setView),this.observe(ForgeCT.ins().postForgeUpdate,function(){return t.curRole=t.curRole}),this.addTouchEvent(this.upGradeBtn,this.updateDown,!0),this.upGradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){DisplayUtils.removeFromParent(this.eff);var t=ForgeCT.ins().getEnhanceCostConfigByLv(this.lv+1);!this.isclick&&t&&(this.itemNum>=t.stoneNum?(SoundUtil.play(SoundEnum.FORGE),ForgeCT.ins().sendUpGrade(this.curRole,this.pos)):(this.isclick=!0,WarnCT.ins().setBuyGoodsWarn(t.stoneId,t.stoneNum-this.itemNum)))},e.prototype.removeDisplay=function(){this.removeTouchEvent(this.upGradeBtn,this.updateDown,!0),DisplayUtils.removeFromParent(this.eff),this.stopAutoUp(),this.upGradeBtn&&this.upGradeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){if(this._curRole=t,this.skin){var e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=e.getMinEquipIndexByType(this.curPanel);this.isMax=!1,this.setView(),this.changeData(i,e.getEquipByIndex(i).strengthen),this.stopAutoUp()}},enumerable:!0,configurable:!0}),e.prototype.setView=function(){DisplayUtils.removeFromParent(this.eff)},e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn0:if(!this.isAutoUp){if(this.isAutoUp=!0,this.startPos=this.pos,!this.autoUpStarEx())return TipsCT.ins().showTips("材料不足"),void(this.isAutoUp=!1);var e;e||(e=new MovieClip,e.x=this.itemGroup.width/2+120,e.y=this.itemGroup.height/2+140,this.itemGroup.addChild(e)),e.playFile(RES_DIR_EFF+"UpEff4",1,function(){DisplayUtils.removeFromParent(e)})}}},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,this.upGradeBtn0&&(this.upGradeBtn0.label="一键强化",egret.Tween.removeTweens(this.upGradeBtn0))},e.prototype.autoUpBack=function(t){if(this.isAutoUp){var e=ForgeCT.ins().getEnhanceCostConfigByLv(this.lv+1);if(!e)return;if(this.itemNum<e.stoneNum)return this.isAutoUp=!1,void TipsCT.ins().showTips("材料不足");if(this.startPos==t)return void(this.isAutoUp=!1);ForgeCT.ins().sendUpGrade(this.curRole,t)}},e.prototype.autoUpStarEx=function(){var t=ForgeCT.ins().getEnhanceCostConfigByLv(this.lv+1);return t?this.itemNum>=t.stoneNum?(SoundUtil.play(SoundEnum.FORGE),ForgeCT.ins().sendUpGrade(this.curRole,this.pos),!0):(this.upGradeBtn0.label="一键强化",!1):!1},e.prototype.onGetItem=function(t){WarnCT.ins().setBuyGoodsWarn(ForgeCT.ins().getEnhanceCostConfigByLv(this.lv+1).stoneId,1)},e.prototype.changeData=function(t,e,i){void 0===t&&(t=this.pos),void 0===e&&(e=this.lv),void 0===i&&(i=!0),this.pos=t,this.lv=e;var n=ForgeCT.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(n),this.setPower(),this.setSlectedInfo(),i?(this.setCount(),this.upGradeBtn.touchEnabled=!0):this.upGradeBtn.touchEnabled=!1},e.prototype.strongMove=function(t){this.setTargetMove(this["show"+(this.pos+1)],t)},e.prototype.setPower=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=t.getForgeTotalPower(this.curPanel),this._totalPower+=Math.floor(this._totalPower*DemonCir.ins().getAddPerBySysIDRoleId(1,this._curRole)/1e4),this.powerPanel.setPower(this._totalPower)},e.prototype.setTargetMove=function(t,e){var i=new eui.Image;i.source=t.source,i.x=t.x,i.y=t.y,i.verticalCenter=t.verticalCenter,i.horizontalCenter=t.horizontalCenter,t.parent.addChild(i),t=i;var n=egret.Tween.get(t,{loop:!1});n.to({scaleX:1.2,scaleY:1.2,alpha:.5},20).wait(80).to({scaleX:1,scaleY:1,alpha:2.8},0).wait(100).call(function(){DisplayUtils.removeFromParent(t),e()})},e.prototype.setSlectedInfo=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.equipsData,i=0;i<EquipCT.FOEGE_MAX;i++){var n=e[i].strengthen;this["level_"+i].text=n>0?"+"+n:"",this["show"+(i+1)].visible=i==this.pos,this["lianjiexian"+i].visible=i==this.pos}},e.prototype.setAttrData=function(t){var e,i=t.length;t=DemonCir.ins().getAttrsBySysID(t,1),t.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++)this["attr"+n].text=i>n?AttributeData.getAttStrByType(t[n],.5):"";if(e=ForgeCT.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel)){this.isMax=!1;var s="",o=ForgeCT.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,!0);o=DemonCir.ins().getAttrsBySysID(o,1),o.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++){if(i>n){var a=t[n];s=this.getAttrByType(o,a)}this["arrow"+n].visible=s.length>0,this["addAttr"+n].text=s}}else{this.isMax=!0;for(var n=0;4>n;n++)this["arrow"+n].visible=!1,this["addAttr"+n].text=""}this.upInfo.visible=!this.isMax,this.maxDesc.visible=this.isMax},e.prototype.setCount=function(){var t=ForgeCT.ins().getEnhanceCostConfigByLv(this.lv+1),e=0;t&&(this.itemNum=BagCT.ins().getBagGoodsCountById(0,t.stoneId),e=t.stoneNum);var i="";i=this.itemNum>=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+e+"</font> ")},e.prototype.getAttrByType=function(t,e){for(var i=t.length,n=0;i>n;n++)if(t[n].type==e.type&&t[n].value!=e.value)return""+t[n].value;return""},e}(BaseView);__reflect(ForgeBoostPanel.prototype,"ForgeBoostPanel"),window.ForgeBoostPanel=ForgeBoostPanel;var ForgeGemPanel=function(t){function e(){var e=t.call(this)||this;return e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.eqIndexItems=[],e.isclick=!1,e.isPlay=!1,e.name="注灵",e.curPanel=ForgeWin.Page_Select_Gem,e}return __extends(e,t),e.prototype.addDisplay=function(){var t=this;this.observe(BagCT.ins().postItemAdd,this.setCount),this.observe(BagCT.ins().postItemChange,this.setCount),this.observe(GemCT.ins().postForgeUpdata,function(){t.curRole=t.curRole,t.updateCallBack()}),this.addTouchEvent(this.upGradeBtn,this.updateDown,!0),this.upGradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){var t=ForgeCT.ins().getStoneLevelCostConfigByLv(this.lv+1);!this.isclick&&t&&(this.itemNum>=t.soulNum?(GemCT.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.play(SoundEnum.FORGE)):(this.isclick=!0,WarnCT.ins().setBuyGoodsWarn(t.stoneId,t.soulNum-this.itemNum)))},e.prototype.removeDisplay=function(){this.removeTouchEvent(this.upGradeBtn,this.updateDown),this.stopAutoUp(),this.upGradeBtn&&this.upGradeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.skinComplete=function(){this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this.getItemTxt,this.onGetItem);for(var t=0;t<EquipCT.FOEGE_MAX;t++)this.eqIndexItems.push(this["item"+t]),this.addTouchEvent(this["item"+t],this.onSelectItem);this.curRole=this.curRole},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){if(this._curRole=t,this.skin){var e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=e.getMinEquipIndexByType(this.curPanel);this.isMax=!1,this.changeData(i,e.getEquipByIndex(i).gem,!0,!0);for(var n=0;n<EquipCT.FOEGE_MAX;n++)this["item"+n].select.visible=n==this.pos;this.stopAutoUp(),this.cleanEff(),this.playEff()}},enumerable:!0,configurable:!0}),e.prototype.stopAutoUp=function(){this.isAutoUp=!1,Timer.stop(this.autoUpStar,this)},e.prototype.autoUpStar=function(){var t=ForgeCT.ins().getStoneLevelCostConfigByLv(this.lv+1);this.itemNum>=t.soulNum?(GemCT.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.play(SoundEnum.FORGE)):(this.isAutoUp=!1,Timer.stop(this.autoUpStar,this))},e.prototype.setPower=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this._totalPower=t.getForgeTotalPower(this.curPanel),this._totalPower+=Math.floor(this._totalPower*DemonCir.ins().getAddPerBySysIDRoleId(3,this.curRole)/1e4),this.powerPanel.setPower(this._totalPower)},e.prototype.changeData=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),this.pos=t,this.lv=e,this.setPower(),i&&this.setCount(),this.updateItem(n),this.setAttrData()},e.prototype.addBarEff=function(t){var e="ProgressEff5",i=new MovieClip;i.playFile(RES_DIR_EFF+e,-1),t.addChild(i),i.x=t.width/2,i.y=t.height/2,i.scaleX=t.width/466,i.scaleY=t.height/16,t.scaleX=0,t.scaleY=0},e.prototype.moveBarEff=function(t,e,i){var n=1,s=1e3*t[e?"width":"height"]/160,o={};o[e?"scaleX":"scaleY"]=1,t[e?"scaleY":"scaleX"]=1;var a=egret.Tween.get(t);a.to(o,s/n).call(function(){i&&i()})},e.prototype.playEff=function(){var t=this;if(!this.isPlay){for(var e=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,28],i=0;i<=e.length-1;i++)this.addBarEff(this["bar"+e[i]]);this.moveBarEff(this.bar21,!1),this.moveBarEff(this.bar11,!1,function(){t.moveBarEff(t.bar13,!0),t.moveBarEff(t.bar22,!0),t.moveBarEff(t.bar23,!0),t.moveBarEff(t.bar12,!0,function(){t.moveBarEff(t.bar24,!1),t.moveBarEff(t.bar14,!1,function(){t.moveBarEff(t.bar25,!0),t.moveBarEff(t.bar15,!0,function(){t.moveBarEff(t.bar16,!0,function(){t.moveBarEff(t.bar17,!1,function(){t.moveBarEff(t.bar28,!0),t.moveBarEff(t.bar18,!0,function(){t.moveBarEff(t.bar19,!1,function(){t.isPlay=!1
})})})})})})})})}},e.prototype.cleanEff=function(){for(var t=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,28],e=0;e<t.length;e++)this["bar"+t[e]].removeChildren()},e.prototype.updateCallBack=function(){var t=this,e=new MovieClip;e.x=this["new"].x+this["new"].width/2,e.y=this["new"].y+this["new"].height/2,this.itemGroup2.addChild(e),e.playFile(RES_DIR_EFF+"UpEff1",1,function(){var e=SubRoles.ins().getSubRoleByIndex(t.curRole),i=e.equipsData;t.now.updateItem(i[t.pos].item.itemConfig,t.pos,i[t.pos].gem,t.itemNum,!1),t["new"].updateItem(i[t.pos].item.itemConfig,t.pos,i[t.pos].gem+1,t.itemNum,!1)})},e.prototype.updateItem=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=e.equipsData,n=0;n<EquipCT.FOEGE_MAX;n++){var s=i[n].gem,o=this.itemNum;if(t&&n==this.pos){var a=GlobalConfig.StoneOpenConfig[n];Actor.level>=a.openLv&&(this.lv=i[this.pos].gem,this["item"+n].select.visible=!0,this.xjyl.visible=!1),this.now.updateItem(i[n].item.itemConfig,n,s,this.itemNum,!1),this["new"].updateItem(i[n].item.itemConfig,n,s+1,this.itemNum,!1)}if(!o){var r=i[n].gem?i[n].gem:1,l=GlobalConfig.StoneLevelCostConfig[r];l&&(o=BagCT.ins().getBagGoodsCountById(0,l.stoneId))}this["item"+n].data={item:i[n].item.itemConfig,pos:n,lv:i[n].gem,itemNum:o}}},e.prototype.onSelectItem=function(t){var e=this.eqIndexItems.indexOf(t.currentTarget);if(-1!=e){this.isPlay&&(this.isPlay=!1,this.cleanEff());for(var i=this.pos,n=0;n<EquipCT.FOEGE_MAX;n++)this["item"+n].select.visible&&(i=n),this["item"+n].select.visible=!1;var s=!1,o=SubRoles.ins().getSubRoleByIndex(this.curRole),a=o.equipsData,r=GlobalConfig.StoneOpenConfig[e],l="";switch(t.currentTarget){case this["item"+e]:Actor.level>=r.openLv?(this.cleanEff(),this.playEff(),this.pos=e,this.lv=a[this.pos].gem,s=!0,this["item"+e].select.visible=!0,this.xjyl.visible=!1,this.now.updateItem(a[e].item.itemConfig,e,a[e].gem,this.itemNum,!1),this["new"].updateItem(a[e].item.itemConfig,e,a[e].gem+1,this.itemNum,!1)):l=r.openLv+"级开启"}s||(this["item"+i].select.visible=!0,TipsCT.ins().showTips(l)),this.setAttrData(),this.setCount()}},e.prototype.setAttrData=function(){var t;t=ForgeCT.ins().getForgeConfigByPos(this.pos,this.lv,this.curPanel);var e=t.attr||[];e=DemonCir.ins().getAttrsBySysID(e,3);var i=e&&e.length?e.length:0;e&&i>0&&e.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++)this["attr"+n].text=i>n?AttributeData.getAttStrByType(e[n],.5):"";var s;s=ForgeCT.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel);var o="";if(s){this.isMax=!1;var a=s.attr||[];a=DemonCir.ins().getAttrsBySysID(a,3),a.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++){var r="";if(i>n){var l=e[n];r=this.getAttrByType(a,l)}this["arrow"+n].visible=r.length>0,this["addAttr"+n].text=r}}else{this.isMax=!0;for(var n=0;4>n;n++)this["arrow"+n].visible=!1,this["addAttr"+n].text=""}this.attr.text=o,this.upInfo.visible=!this.isMax,this.maxDesc.visible=this.isMax,this.maxDesc.visible&&(this.now.hideAdd(),this["new"].hideAdd())},e.prototype.onGetItem=function(){var t=ForgeCT.ins().getStoneLevelCostConfigByLv(this.lv+1);WarnCT.ins().setBuyGoodsWarn(t.stoneId,1)},e.prototype.setCount=function(){var t=ForgeCT.ins().getStoneLevelCostConfigByLv(this.lv+1);if(t){var e=t.soulNum;this.itemNum=Actor.soul;var i="";i=this.itemNum>=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+e+"</font> "),this.buyStoneUpdateItem()}},e.prototype.buyStoneUpdateItem=function(){this.updateItem()},e.prototype.getAttrByType=function(t,e){if(!e)return"";for(var i=t.length,n=0;i>n;n++)if(t[n].type==e.type&&t[n].value!=e.value)return""+t[n].value;return""},e}(BaseView);__reflect(ForgeGemPanel.prototype,"ForgeGemPanel"),window.ForgeGemPanel=ForgeGemPanel;var ForgeItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.getSource=function(){return this._source},e.prototype.getSourceName=function(){return this._sourceName},e.prototype.setSource=function(t){this._source!=t&&(this._source=t,this.item.source=this._source)},e.prototype.setSourceName=function(t){this._sourceName!=t&&(this._sourceName=t,this.item.source=this._sourceName)},e.prototype.isSelect=function(t){return this.select.visible=t,t},e.prototype.isSelectEff=function(t){return this.parent?(this.selectEff||(this.selectEff=new MovieClip,this.selectEff.x=40,this.selectEff.y=38,this.selectEff.playFile(RES_DIR_EFF+"BtnPrompt9",-1)),!this.selectEff.parent&&t&&this.addChildAt(this.selectEff,2),t?this.selectEff.play(-1):this.selectEff.stop(),this.selectEff.visible=t,t):void 0},e.prototype.setValue=function(t){switch(this._type){case 0:this.boost.text="+"+t;break;case 1:this.gem.text="+"+t;break;case 2:this.zhuling.text="+"+t;break;case 3:this.tupo.text=t+"星"}},e.prototype.getType=function(){return this._type},e.prototype.setType=function(t){if(this._type!=t)switch(this._type=t,this._type){case 0:this.boost.visible=!0,this.itemName.visible=!0,this.gem.visible=!1,this.zhuling.visible=!1,this.tupo.visible=!1,this.isSelect(!1),this.labelBg.visible=!1;break;case 1:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!0,this.zhuling.visible=!1,this.tupo.visible=!1,this.labelBg.visible=!0;break;case 2:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!1,this.zhuling.visible=!0,this.tupo.visible=!1,this.labelBg.visible=!0;break;case 3:this.boost.visible=!1,this.itemName.visible=!1,this.gem.visible=!1,this.zhuling.visible=!1,this.tupo.visible=!0,this.labelBg.visible=!0}},e}(eui.Component);__reflect(ForgeItem.prototype,"ForgeItem"),window.ForgeItem=ForgeItem;var ForgeTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="forgeTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.attr=t[0],this.attrStr=t[1],this.addTouchEndEvent(this,this.otherClose),this.attrTxt.text=this.attrStr,this.attrTxt0.text="";for(var i=0;i<this.attr.length;i++)this.attrTxt0.text+=this.attr[i]+(i==this.attr.length-1?"":"\n");this.background.height=this.attrTxt.textHeight+60,this.group.y=this.group.height/2-this.background.height/2},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ForgeTipsWin.prototype,"ForgeTipsWin"),ViewManager.ins().reg(ForgeTipsWin,LayerManager.UI_Popup),window.ForgeTipsWin=ForgeTipsWin;var ForgeTupoPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(BaseView);__reflect(ForgeTupoPanel.prototype,"ForgeTupoPanel"),window.ForgeTupoPanel=ForgeTupoPanel;var ForgeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mcList=[],e._sn_="forgeskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ForgeCT.ins().postForgeUpdate,this.onEvent),this.observe(ForgeRedPoint.ins().postForgeBoostRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeZhulingRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeGemRedPoint,this.delayRedPoint),this.observe(ForgeRedPoint.ins().postForgeWeaponRedPoint,this.delayRedPoint),this.observe(GodWeaponRedPoint.ins().postGwSb,this.delayRedPoint),this.onlyGWTaskPanel=t&&t[2]?t[2]:!1,this.tab.selectedIndex=this.viewStack.selectedIndex=t[0],void 0!=t[1]&&this.roleSelect.setCurRole(parseInt(t[1]+"")),this.setRoleId(this.roleSelect.getCurRole());var i;if(this.onlyGWTaskPanel){for(var n=this.viewStack.selectedIndex;this.viewStack.numChildren>0;)i=this.viewStack.removeChildAt(0),i.visible=!1,i=this.redPointGroup.removeChildAt(0),i.visible=!1;this.viewStack.addChild(this.weaponGroup),this.redPointGroup.addChild(this.redPoint4),this.viewStack.selectedIndex=n}},e.prototype.skinComplete=function(){this.viewStack.selectedIndex=e.Page_Select_Boost,this.tab.dataProvider=this.viewStack,this.mc=new MovieClip,this.mc.x=240,this.mc.y=400;for(var t=0;8>t;t++){var i=new MovieClip;i.x=240,i.y=400,this.mcList.push(i)}this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.closeBtn0,this.onTouch),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange)},e.prototype.removeDisplay=function(){var t=ViewManager.ins().getView(UIView2);t&&t.closeNav(UIView2.NAV_SMITH),DisplayUtils.removeFromParent(this.mc);for(var e=0;e<this.mcList.length;e++)DisplayUtils.removeFromParent(this.mcList[e]);Timer.stopAll(this)},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(t&&t.length&&t[0]==e.Page_Select_Gw){var n=GlobalConfig.GodWeaponBaseConfig,s=n.zhuanshengLevel,o=n.openDay;if(ZsCT.ins().lv<s)return TipsCT.ins().showTips("角色转生等级"+s+"开启"),!1;if(GameServer.serverOpenDay<o)return TipsCT.ins().showTips("开服"+(o+1)+"天开启"),!1}return!0},e.prototype.onTouch=function(t){ViewManager.ins().close(e)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex),this.redPointEx()},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.setOpenIndex=function(t,e){var i=!0;switch(this.roleSelect.openRole(),this.viewStack.getElementAt(t)){case this.weaponsoul:this.roleSelect.currentState="yhead",this.weaponsoul.roleId=this.roleSelect.getCurRole();break;case this.weaponGroup:this.roleSelect.currentState="nohead";break;default:this.roleSelect.currentState="yhead"}i||(this.tab.selectedIndex=this.viewStack.selectedIndex),this.tab.selectedIndex!=this.viewStack.selectedIndex&&this.checkAutoBtn()},e.prototype.checkIsOpen=function(t){switch(t){case e.Page_Select_Gem:var i=GlobalConfig.StoneOpenConfig[0].openLv;if(Actor.level<i)return TipsCT.ins().showTips("精炼"+i+"级开启"),!1;break;case e.Page_Select_Weapon:if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.WEAPONS)),!1;break;case e.Page_Select_Gw:var n=GlobalConfig.GodWeaponBaseConfig,s=n.zhuanshengLevel,o=n.openDay;return ZsCT.ins().lv>=s&&GameServer.serverOpenDay>=o?!0:(ZsCT.ins().lv<s?TipsCT.ins().showTips("角色转生等级"+s+"开启"):GameServer.serverOpenDay<o&&TipsCT.ins().showTips("开服"+(o+1)+"天开启"),!1)}return!0},e.prototype.checkAutoBtn=function(){this.boostPanel.isAutoUp&&this.boostPanel.stopAutoUp(),this.zhulingPanel.isAutoUp&&this.zhulingPanel.stopAutoUp()},e.prototype.onEvent=function(t){var i=t[0],n=t[1],s=SubRoles.ins().getSubRoleByIndex(this.roleSelect.getCurRole());switch(i){case PackageID.strongthen:if(e.Page_Select_Boost==this.viewStack.selectedIndex){if(!this.boostPanel.isAutoUp){if(this.mcList[n].x=n%2*434+40,this.mcList[n].y=120*Math.floor(n/2)+35,this.mcList[n].playFile(RES_DIR_EFF+"UpEff1",1),!this.boostPanel||!this.boostPanel.itemGroup)return void platform.reportError("onEvent:"+this.skin);this.boostPanel.itemGroup.addChild(this.mcList[n])}this.boostPanel.autoUpBack(n)}break;case PackageID.Zhuling:e.Page_Select_ZhuLing==this.viewStack.selectedIndex&&(this.zhulingPanel.isAutoUp||(this.mcList[n].x=this.zhulingPanel["kuang"+n].x+this.zhulingPanel["kuang"+n].width/2,this.mcList[n].y=this.zhulingPanel["kuang"+n].y+this.zhulingPanel["kuang"+n].height/2,this.mcList[n].playFile(RES_DIR_EFF+"UpEff1",1),this.zhulingPanel.itemGroup.addChild(this.mcList[n])),n=s.getMinEquipIndexByType(e.Page_Select_ZhuLing),this.zhulingPanel.autoUpBack(n))}this.redPointEx()},e.prototype.delayRedPoint=function(){Timer.has(this.redPointEx,this)||Timer.start(60,1,this.redPointEx,this)},e.prototype.redPointEx=function(){for(var t=[!1,!1,!1],i=0;i<t.length;i++)this.roleSelect.showRedPoint(i,t[i]);this.redPoint3.visible=!1;for(var i=0;5>i;i++){if(ForgeRedPoint.ins().roleTabs[i]&&this.tab.selectedIndex==i)for(var n=0;n<SubRoles.ins().subRolesLen;n++)this.roleSelect.showRedPoint(n,ForgeRedPoint.ins().roleTabs[i][n]),i==e.Page_Select_Weapon&&this.weaponsoul.isShowSoul()&&this.roleSelect.showRedPoint(n,ForgeRedPoint.ins().getFlexibleRoleRedPoint(n));if(i==e.Page_Select_Weapon)for(var s=0;s<SubRoles.ins().subRolesLen;s++){var o=Weapons.ins().checkRedPoint(s);this.redPoint3.visible||(this.redPoint3.visible=o),this.tab.selectedIndex==e.Page_Select_Weapon&&this.roleSelect.showRedPoint(s,o)}else this["redPoint"+i].visible=!1,this["redPoint"+i].visible=ForgeRedPoint.ins().getRedPoint(i);i==e.Page_Select_Gw&&(this.redPoint4.visible=GodWeaponRedPoint.ins().gwSbRed)}},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole(),!0)},e.prototype.setRoleId=function(t,e){this.boostPanel.curRole=this.gemPanel.curRole=this.zhulingPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex,e),this.redPointEx()},e.Page_Select_Boost=0,e.Page_Select_Gem=1,e.Page_Select_ZhuLing=2,e.Page_Select_Weapon=3,e.Page_Select_Gw=4,e}(BaseEuiView);__reflect(ForgeWin.prototype,"ForgeWin"),ViewManager.ins().reg(ForgeWin,LayerManager.UI_Main),window.ForgeWin=ForgeWin;var ForgeZhulingPanel=function(t){function e(){var e=t.call(this)||this;return e.isMax=!1,e.isAutoUp=!1,e.itemNum=0,e.startPos=0,e.isclick=!1,e.name="淬炼",e.curPanel=ForgeWin.Page_Select_ZhuLing,e}return __extends(e,t),e.prototype.skinComplete=function(){this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this.upGradeBtn0,this.onTouch),this.addTouchEvent(this.getItemTxt,this.onGetItem),this.curRole=this.curRole},e.prototype.addDisplay=function(){var t=this;this.observe(BagCT.ins().postItemAdd,this.setCount),this.observe(BagCT.ins().postItemChange,this.setCount),this.observe(ZhuLingCT.ins().postForgeUpdata,function(){return t.curRole=t.curRole}),this.observe(ZhuLingCT.ins().InitPower,this.setPower),this.addTouchEvent(this.upGradeBtn,this.updateDown,!0),this.upGradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){!this.isclick&&this.costConfig&&(this.itemNum>=this.costConfig.count?(ZhuLingCT.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.play(SoundEnum.FORGE)):(this.isclick=!0,WarnCT.ins().setBuyGoodsWarn(this.costConfig.itemId,1)))},e.prototype.removeDisplay=function(){this.stopAutoUp(),this.removeTouchEvent(this.upGradeBtn,this.updateDown,!0),this.upGradeBtn&&this.upGradeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){if(this._curRole=t,this.skin){var e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=e.getMinEquipIndexByType(this.curPanel);this.isMax=!1,this.createBitMapNum(),this.changeData(i,e.getEquipByIndex(i).zhuling),this.stopAutoUp()}},enumerable:!0,configurable:!0}),e.prototype.onTouch=function(t){switch(t.target){case this.upGradeBtn0:this.isAutoUp||(this.isAutoUp=!0,this.startPos=this.pos,this.autoUpStarEx()||(TipsCT.ins().showTips("材料不足"),this.isAutoUp=!1))}},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,this.upGradeBtn0&&(this.upGradeBtn0.label="一键精炼"),Timer.stop(this.autoUpStar,this)},e.prototype.autoUpBack=function(t){if(this.isAutoUp){var e=ForgeCT.ins().getZhulingCostConfigByLv(this.lv+1);if(!e)return;if(this.itemNum<e.count)return this.isAutoUp=!1,void TipsCT.ins().showTips("材料不足");if(this.startPos==t)return void(this.isAutoUp=!1);ZhuLingCT.ins().sendUpGrade(this.curRole,t)}},e.prototype.autoUpStarEx=function(){var t=ForgeCT.ins().getZhulingCostConfigByLv(this.lv+1);return t?this.itemNum>=t.count?(ZhuLingCT.ins().sendUpGrade(this.curRole,this.pos),SoundUtil.play(SoundEnum.FORGE),!0):(this.upGradeBtn0.label="一键精炼",!1):!1},e.prototype.autoUpStar=function(){this.costConfig&&this.itemNum>=this.costConfig.count?(ZhuLingCT.ins().sendUpGrade(this.curRole,this.pos),7==this.pos&&(this.isAutoUp=!1,this.upGradeBtn0.label="一键精炼",Timer.stop(this.autoUpStar,this))):(this.isAutoUp=!1,this.upGradeBtn0.label="一键精炼",Timer.stop(this.autoUpStar,this))},e.prototype.onGetItem=function(t){WarnCT.ins().setBuyGoodsWarn(this.costConfig.itemId,1)},e.prototype.changeData=function(t,e,i){void 0===t&&(t=this.pos),void 0===e&&(e=this.lv),void 0===i&&(i=!0),this.pos=t,this.lv=e;var n=ForgeCT.ins().countAllBoostAttr(this.curRole,this.curPanel);this.setAttrData(n),this.setPower(),this.setSlectedInfo(),this.updateLevel(),i&&this.setCount()},e.prototype.setPower=function(){var t=ZhuLingCT.ins().power[this.curRole];this.powerPanel.setPower(t?t:0)},e.prototype.createBitMapNum=function(){for(var t=0;t<EquipCT.FOEGE_MAX;t++)this["level_"+t].text="0"},e.prototype.updateLevel=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.equipsData,i=0;i<EquipCT.FOEGE_MAX;i++){var n=e[i].zhuling;this["level_"+i].visible=n>0,this["level_"+i].text=n.toString()}},e.prototype.setSlectedInfo=function(){for(var t=0;t<EquipCT.FOEGE_MAX;t++)this["selectIcon"+t].visible=t==this.pos,0==t||(this["line"+(t-1)].source=t<=this.pos?"jinglianline1":"jinglianline0",this["jinglianed"+t].visible=t<=this.pos)},e.prototype.setAttrData=function(t){var e,i=t.length;t=DemonCir.ins().getAttrsBySysID(t,2),t.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++)this["attr"+n].text=i>n?AttributeData.getAttStrByType(t[n],.5):"";if(e=ForgeCT.ins().getForgeConfigByPos(this.pos,this.lv+1,this.curPanel)){this.isMax=!1;var s=ForgeCT.ins().countAllBoostAttr(this.curRole,this.curPanel,this.pos,!0);s=DemonCir.ins().getAttrsBySysID(s,2),s.sort(AttributeData.sortAttribute);for(var n=0;4>n;n++){var o="";if(i>n){var a=t[n];o=this.getAttrByType(s,a)}this["arrow"+n].visible=o.length>0,this["addattr"+n].text=o}}else{this.isMax=!0;for(var n=0;4>n;n++)this["arrow"+n].visible=!1,this["addattr"+n].text=""}this.maxDesc.visible=this.isMax,this.upInfo.visible=!this.isMax},e.prototype.setCount=function(){this.costConfig=ForgeCT.ins().getZhulingCostConfigByLv(this.lv+1);var t=0;this.costConfig&&(this.itemNum=BagCT.ins().getBagGoodsCountById(0,this.costConfig.itemId),t=this.costConfig.count);var e="";e=this.itemNum>=t?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+e+">"+this.itemNum+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t+"</font> ")},e.prototype.getAttrByType=function(t,e){for(var i=t.length,n=0;i>n;n++)if(t[n].type==e.type&&t[n].value!=e.value)return""+t[n].value;return""},e}(BaseView);__reflect(ForgeZhulingPanel.prototype,"ForgeZhulingPanel"),window.ForgeZhulingPanel=ForgeZhulingPanel;var Friends=function(t){function e(){var e=t.call(this)||this;return e.friendsList=new eui.ArrayCollection,e.recentList=new eui.ArrayCollection,e.appList=new eui.ArrayCollection,e.blackList=new eui.ArrayCollection,e.chatList={},e.newMsg={},e.currentId=-1,e.sysId=PackageID.Friends,e.regNetMsg(1,e.doFriendsList),e.regNetMsg(2,e.doRencentList),e.regNetMsg(3,e.doAppList),e.regNetMsg(4,e.doBlackList),e.regNetMsg(7,e.doAddListMsg),e.regNetMsg(9,e.doRemoveListMsg),e.regNetMsg(10,e.doFriendsStateChange),e.regNetMsg(11,e.doSendResult),e.regNetMsg(13,e.doChatAdd),e.regNetMsg(14,e.doRecentChatList),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendAppList()},e.prototype.sendFriendsList=function(){var t=this.getBytes(1);this.sendToServer(t)},e.prototype.sendRecentList=function(){var t=this.getBytes(2);this.sendToServer(t)},e.prototype.sendAppList=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.sendBlackList=function(){var t=this.getBytes(4);this.sendToServer(t)},e.prototype.sendAddFriend=function(t,e){if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.FriendLimit.addFriendLv){var i=GlobalConfig.FriendLimit.addFriendLv>1e3?(GlobalConfig.FriendLimit.addFriendLv/1e3>>0)+"转":"",n=GlobalConfig.FriendLimit.addFriendLv>1e3?GlobalConfig.FriendLimit.addFriendLv%1e3+"级":GlobalConfig.FriendLimit.addFriendLv+"级";return void TipsCT.ins().showTips(""+i+n+"开放功能")}if(-1!=this.indexOfBlackList(t))return void TipsCT.ins().showTips("不能添加黑名单中的用户为好友");for(var s=0,o=this.blackList.source;s<o.length;s++){var a=o[s],r=a;if(r.name==e)return void TipsCT.ins().showTips("不能添加黑名单中的用户为好友")}var l=this.getBytes(5);l.writeInt(t),l.writeString(e),this.sendToServer(l)},e.prototype.sendAddBlackList=function(t,e){if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.FriendLimit.blackListLv){var i=GlobalConfig.FriendLimit.blackListLv>1e3?(GlobalConfig.FriendLimit.blackListLv/1e3>>0)+"转":"",n=GlobalConfig.FriendLimit.blackListLv>1e3?GlobalConfig.FriendLimit.blackListLv%1e3+"级":GlobalConfig.FriendLimit.blackListLv+"级";return void TipsCT.ins().showTips(""+i+n+"开放功能")}var s=this.getBytes(6);s.writeInt(t),s.writeString(e.name),s.writeString(e.guildName),s.writeByte(e.job),s.writeByte(e.sex),s.writeByte(e.vip),s.writeByte(e.lv),s.writeByte(e.zsLv),s.writeByte(e.monthCard),s.writeInt(e.power),s.writeString(e.appId),this.sendToServer(s)},e.prototype.sendAgreeApp=function(t,e){var i=this.getBytes(8);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendDelete=function(t,e){var i=this.getBytes(9);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendChat=function(t,e,i){return void 0===i&&(i=0),__awaiter(this,void 0,void 0,function(){var i,n,s,o,a;return __generator(this,function(r){switch(r.label){case 0:return[4,platform.checkStr(e,1,3,t)];case 1:return i=r.sent(),n=i.result,s=i.content,o=2+("self"==n?1:0),a=this.getBytes(11),a.writeInt(t.id),a.writeString(s),a.writeByte(o),this.sendToServer(a),[2]}})})},e.prototype.sendRecentChat=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.doFriendsList=function(t){this.paserList(1,t),this.postFriendChange()},e.prototype.doRencentList=function(t){this.paserList(2,t),this.postFriendChange()},e.prototype.doAppList=function(t){this.paserList(3,t),this.postFriendChange()},e.prototype.doBlackList=function(t){this.paserList(4,t),this.postFriendChange()},e.prototype.doAddListMsg=function(t){var e=t.readByte();this.paserAddData(e,t),this.postFriendChange()},e.prototype.doRemoveListMsg=function(t){var e=t.readByte(),i=t.readInt();this.paserRemoveData(e,i),this.postFriendChange()},e.prototype.doFriendsStateChange=function(t){var e=t.readInt(),i=t.readByte();this.paserOnlineChange(e,i),this.postFriendChange()},e.prototype.doSendResult=function(t){var e=t.readByte();if(0!=e){var i=t.readInt(),n=t.readInt(),s=t.readString();this.paserChatMsg(1,i,n,s)}this.postFriendChange()},e.prototype.doChatAdd=function(t){var e=t.readInt(),i=t.readInt(),n=t.readString();this.paserChatMsg(0,e,i,n),this.postFriendChange()},e.prototype.doRecentChatList=function(t){this.paserRecentMsg(t),this.postFriendChange()},e.prototype.postFriendChange=function(){return 0},e.prototype.postCloseFriendList=function(){},e.prototype.postChatToFriend=function(t){return t},e.prototype.indexOfFriendList=function(t){for(var e=-1,i=0;i<this.friendsList.length;i++){var n=this.friendsList.getItemAt(i);if(n&&n.id==t){e=i;break}}return e},e.prototype.indexOfBlackList=function(t){for(var e=-1,i=0;i<this.blackList.length;i++){var n=this.blackList.getItemAt(i);if(n&&n.id==t){e=i;break}}return e},e.prototype.indexOfRecentList=function(t){for(var e=-1,i=0;i<this.recentList.length;i++){var n=this.recentList.getItemAt(i);if(n&&n.id==t){e=i;break}}return e},e.prototype.indexOfAppList=function(t){for(var e=-1,i=0;i<this.appList.length;i++){var n=this.appList.getItemAt(i);if(n&&n.id==t){e=i;break}}return e},e.prototype.sortRecentList=function(){for(var t=0;t<e.ins().friendsList.length;t++){var i=e.ins().friendsList.getItemAt(t);-1==this.indexOfRecentList(i.id)&&e.ins().recentList.addItem(i)}this.recentList.source;e.ins().recentList.source.sort(function(t,e){return t.lastMsgDate>e.lastMsgDate?-1:t.lastMsgDate<e.lastMsgDate?1:0})},e.prototype.sortFriendList=function(){var t=this.friendsList.source,e=[],i=[];t.forEach(function(t){1==t.online?e.push(t):i.push(t)}),e.sort(function(t,e){return e.zs!=t.zs?e.zs-t.zs:e.lv-t.lv}),i.sort(function(t,e){return e.zs!=t.zs?e.zs-t.zs:e.lv-t.lv}),t=e.concat(i),this.friendsList.replaceAll(t)},e.prototype.sortAppList=function(){var t=this.appList.source;t.sort(function(t,e){return e.power-t.power}),this.appList.replaceAll(t)},e.prototype.paserList=function(t,i){for(var n=[],s=i.readInt(),o=0;s>o;o++){var a=new FriendData(t,i);n.push(a)}switch(t){case 1:this.friendsList.source=n,this.sortFriendList();break;case 2:this.recentList.source=n,this.sortRecentList();break;case 3:n.length>e.MAXNUM&&(n=n.slice(n.length-e.MAXNUM,e.MAXNUM)),this.appList.source=n,this.sortAppList();break;case 4:this.blackList.replaceAll(n)}},e.prototype.paserAddData=function(t,e){var i=new FriendData(t,e),n=["friendsList","recentList","appList","blackList"][t-1],s=-1;1==t?s=this.indexOfFriendList(i.id):2==t?s=this.indexOfRecentList(i.id):3==t?s=this.indexOfAppList(i.id):4==t&&(s=this.indexOfBlackList(i.id),this.paserRemoveData(1,i.id),this.paserRemoveData(2,i.id),this.paserRemoveData(3,i.id),ChatCT.ins().removeChatWithId(i.id),Guild.ins().removeMsgWithId(i.id)),this[n]&&2!=t&&(s>-1?this[n].replaceItemAt(i,s):this[n].addItemAt(i,0)),this.sortFriendList(),this.sortRecentList(),this.sortAppList()},e.prototype.paserRemoveData=function(t,e){var i=["friendsList","recentList","appList","blackList"][t-1],n=-1;this[i]&&(1==t?(n=this.indexOfFriendList(e),this.newMsg[e]=!1):2==t?(n=this.indexOfRecentList(e),this.newMsg[e]=!1):3==t?n=this.indexOfAppList(e):4==t&&(n=this.indexOfBlackList(e)),n>-1&&this[i].removeItemAt(n))},e.prototype.paserOnlineChange=function(t,e){var i=this.indexOfFriendList(t);if(i>-1){var n=this.friendsList.getItemAt(i);n.id==t&&(n.online=e,0==n.online?this.friendsList.replaceItemAt(n,i):(this.friendsList.removeItemAt(i),this.friendsList.addItemAt(n,0)))}},e.prototype.paserChatMsg=function(t,e,i,n){if(!(this.indexOfBlackList(e)>-1)){0==t&&this.currentId!=e&&(this.newMsg[e]=!0);var s=this.indexOfFriendList(e);if(s>-1){var o=this.friendsList.getItemAt(s),a=new FriendData(1);a.id=Actor.actorID,a.job=SubRoles.ins().getSubRoleByIndex(0).job,a.sex=SubRoles.ins().getSubRoleByIndex(0).sex,a.power=Actor.power,0==t?o.addChat(new ChatData(o,a,i,n)):1==t&&o.addChat(new ChatData(a,o,i,n))}var r=this.indexOfRecentList(e);if(r>-1){var o=this.recentList.getItemAt(r);o.lastMsg=n,o.lastMsgDate=i,this.recentList.removeItemAt(r),this.recentList.addItemAt(o,0)}else if(s>-1){var o=this.friendsList.getItemAt(s);o.lastMsg=n,o.lastMsgDate=i,this.recentList.addItemAt(o,0)}else console.log("有一个不属于最近联系人和好友列表的私聊"),console.log("id:"+e+"/ msg:"+n);this.sortFriendList(),this.sortRecentList(),this.sortAppList()}},e.prototype.paserRecentMsg=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readByte(),s=t.readInt(),o=t.readString();if(-1==this.indexOfBlackList(n))for(var a=0;i<this.recentList.length;i++){var r=this.recentList.getItemAt(a);if(r.id==n){r.lastMsg=o,r.offLineSec=s;break}}}},e.prototype.getFriendIndex=function(t){for(var e=0;;){var i=this.recentList.getItemAt(e);if(!i)return-1;if(i.id==t)return e;e++}},e.MAXNUM=100,__decorate([post()],e.prototype,"postFriendChange",null),__decorate([post()],e.prototype,"postCloseFriendList",null),__decorate([post()],e.prototype,"postChatToFriend",null),e}(BaseSystem);__reflect(Friends.prototype,"Friends");var ChatFlag;!function(t){t[t.Inside=2]="Inside"}(ChatFlag||(ChatFlag={})),System.Friends=function(){return Friends.ins()},window.Friends=Friends;var FriendData=function(){function t(t,e){if(void 0===e&&(e=null),this.serverName=0,this._offLineSec=0,this.appDate=0,this._redPoint=!1,this.msgMaxLen=50,this.lastMsg="",this.lastMsgDate=0,this.lastMsgData_local=0,this.type=t,e){switch(this.id=e.readInt(),this.name=e.readString(),this.guildName=e.readString(),this.online=e.readUnsignedByte(),this.job=e.readUnsignedByte(),this.sex=e.readUnsignedByte(),this.vip=e.readUnsignedByte(),this.lv=e.readUnsignedByte(),this.zs=e.readUnsignedByte(),this.monthCard=e.readUnsignedByte(),this.ladderLv=e.readUnsignedByte(),this.isLastWeekLadder=e.readUnsignedByte(),this.power=e.readInt(),this.serverName=e.readUnsignedShort(),t){case 1:var i=e.readInt()||0;this.offLineSec=i;break;case 2:this.lastMsgDate=e.readInt();break;case 3:var n=e.readInt()||0;this.appDate=n;break;case 4:}this.openId=e.readString(),this.appId=e.readString()}}return Object.defineProperty(t.prototype,"offLineSec",{get:function(){var t=0;try{var e=Date.now()/1e3;t=Math.floor(this._offLineSec+(e-this._updateTs))}catch(i){console.log(i)}return t},set:function(t){this._offLineSec=t,this._updateTs=Date.now()/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"redPoint",{get:function(){var t=this._redPoint;return this._redPoint=!1,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acMsg",{get:function(){return null==Friends.ins().chatList[this.id]&&(Friends.ins().chatList[this.id]=new eui.ArrayCollection),Friends.ins().chatList[this.id]},set:function(t){Friends.ins().chatList[this.id]=t},enumerable:!0,configurable:!0}),t.prototype.addChat=function(t){var e=this;if(this._redPoint=t.fromActor.id==this.id,0==this.acMsg.length)t.showDate=!0;else for(var i=e.acMsg.length-1;i>=0;--i){var n=e.acMsg.getItemAt(i);if(t.date-n.date>300&&(t.showDate=!0),n.showDate)break}e.acMsg.addItem(t),e.lastMsgData_local=Date.now(),e.acMsg.length>this.msgMaxLen&&e.acMsg.removeItemAt(0)},t}();__reflect(FriendData.prototype,"FriendData");var ChatData=function(){function t(t,e,i,n){this.date=0,this.msg="",this.showDate=!1,this.fromActor=t,this.toActor=e,this.date=i,this.msg=n}return Object.defineProperty(t.prototype,"dateStr",{get:function(){var t=DateUtils.getFormatBySecond(DateUtils.formatMiniDateTime(this.date)/1e3,8);return t=StringUtils.complementByChar(t,16)},enumerable:!0,configurable:!0}),t}();__reflect(ChatData.prototype,"ChatData"),window.FriendData=FriendData;var BlackListWin=function(t){function e(){var e=t.call(this)||this;return e.name="黑名单",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.list_blackList.itemRenderer=BlackListItemRender,this.list_blackList.dataProvider=Friends.ins().blackList,this.observe(Friends.ins().postFriendChange,this.updateView),Friends.ins().sendBlackList(),this.updateView()},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.updateView=function(){this.label_num.text=+this.list_blackList.dataProvider.length+"/"+GlobalConfig.FriendLimit.blacklistLen,this.group_pingbi&&(this.group_pingbi.visible=0==Friends.ins().blackList.length)},e}(BaseEuiView);__reflect(BlackListWin.prototype,"BlackListWin"),ViewManager.ins().reg(BlackListWin,LayerManager.UI_Main),window.BlackListWin=BlackListWin;var FriendBgWin=function(t){function e(){var e=t.call(this)||this;return e.BIG_HEIGHT=880,e.LITTLE_HEIGHT=403,e.isStretch=!1,e.skinName="FriendsWinSkin",e.isTopLevel=!0,e.tab.dataProvider=e.viewStack,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0,n=0;0==i&&(n=t[1]?t[1]:0),this.viewStack.selectedIndex=i,this.addChangeEvent(this.tab,this.changeView),this.addTouchEvent(this.btnClose,this.onTap),this.addTouchEvent(this.upBtn,this.onTap),this.addChangeEvent(this.tab,this.onTap),Friends.ins().sendFriendsList(),this.friendPanel.open(),this.friendChatPanel.open(n),this.friendAppListPanel.open(),this.blackListPanel.open(),this.mailPanel.open(),this.updateRedPoint(),this.setUpBtn(),this.changeView(),this.observe(Friends.ins().postFriendChange,this.updateRedPoint),this.observe(MailCT.ins().postMailDetail,this.updateRedPoint),this.observe(MailCT.ins().postMailData,this.updateRedPoint)
},e.prototype.changeView=function(){(0==this.viewStack.selectedIndex||1==this.viewStack.selectedIndex)&&this.readMsg()},e.prototype.readMsg=function(){for(var t in Friends.ins().newMsg)Friends.ins().newMsg[t]=!1},e.prototype.onShowdMailPoint=function(){MailCT.ins().mailData?this.mailRedPoint.visible=MailCT.ins().getUnreadMail()>0:this.mailRedPoint.visible=!1},e.prototype.setStretchWin=function(){this.isStretch?(this.isStretch=!1,this.upBtn.scaleY=1,this.upGroup.height=this.LITTLE_HEIGHT):(this.isStretch=!0,this.upBtn.scaleY=-1,this.upGroup.height=this.BIG_HEIGHT)},e.prototype.setUpBtn=function(){this.upBg.visible=this.upBtn.visible=0==this.viewStack.selectedIndex},e.prototype.updateRedPoint=function(){this.applyRedPoint.visible=Friends.ins().appList.length>0,this.onShowdMailPoint()},e.prototype.onTap=function(t){switch(t.target){case this.btnClose:ViewManager.ins().close(this);break;case this.tab:0!=this.viewStack.selectedIndex&&this.isStretch&&this.setStretchWin(),this.setUpBtn();break;case this.upBtn:this.setStretchWin()}},e}(BaseEuiView);__reflect(FriendBgWin.prototype,"FriendBgWin"),window.FriendBgWin=FriendBgWin,ViewManager.ins().reg(FriendBgWin,LayerManager.UI_Popup);var FriendChatPanel=function(t){function e(){var e=t.call(this)||this;return e.name="最近",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),Friends.ins().sendFriendsList(),Friends.ins().sendRecentList(),this.listFriend.selectedIndex=this.selectedIndex=t[0]?t[0]:0,this.addTouchEvent(this.listFriend,this.onChange),this.addTouchEvent(this.btnSend,this.onTap),this.addTouchEvent(this.faceBtn,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.observe(Friends.ins().postFriendChange,this.updateView),this.observe(Friends.ins().postChatToFriend,this.updateView),this.addTouchEvent(this.listChat,this.onListTap),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.onChange()},e.prototype.childrenCreated=function(){this.listFriend.dataProvider=null,this.listChat.dataProvider=null,this.listFriend.itemRenderer=FriendHeadItem,this.listChat.itemRenderer=FriendsChatItemRender},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.updateInputText=function(t){this.input.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.input.text&&(this.input.text="")},e.prototype.onListTap=function(){var t=this.listChat.selectedItem;if(t&&t instanceof ChatData){var e=t.msg;e&&e.indexOf("|E:")>=0&&this.onLink(e)}},e.prototype.onLink=function(t){var e=t.indexOf("|E:");t=t.slice(e+3,Number.MAX_VALUE);var i;if(t.indexOf(",")>=0?i=t.split(","):t.indexOf("*")>=0&&(i=t.split("*")),i&&!(i.length<=0))switch(i[0]){case"1":FbCT.ins().sendEnterTFRoom(+i[1]);break;case"7":if(!RareAnimalCT.ins().checkOpen(!0))return;if(!RareAnimalCT.ins().helpNum)return void TipsCT.ins().showTips("今日的协助次数已用尽");RareAnimalCT.ins().sendEnterTeam(+i[1])}},e.prototype.updateView=function(){this.listFriend.dataProvider=Friends.ins().recentList,-1==this.listFriend.selectedIndex&&(this.listFriend.selectedIndex=0),this.selectedIndex=this.listFriend.selectedIndex;var t=this.listFriend.dataProvider,e=t.source[this.listFriend.selectedIndex];e?(this.currentState="chat",this.listChat.dataProvider=e.acMsg,this.scroller.viewport.validateNow(),this.scroller.viewport.contentHeight>this.scroller.height&&(this.scroller.viewport.scrollV=this.scroller.viewport.contentHeight-this.scroller.height)):this.currentState="nofriend"},e.prototype.onChange=function(){this.updateView();var t=this.listFriend.dataProvider,e=t.source[this.listFriend.selectedIndex];e&&Friends.ins().sendRecentChat(e.id)},e.prototype.onTap=function(t){switch(t.target){case this.btnSend:var e=this.listFriend.dataProvider,i=e.source[this.listFriend.selectedIndex];if(!i)return;if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.FriendLimit.chatLv||Actor.vip<GlobalConfig.FriendLimit.vipLv){var n=GlobalConfig.FriendLimit.chatLv>1e3?(GlobalConfig.FriendLimit.chatLv/1e3>>0)+"转":"",s=GlobalConfig.FriendLimit.chatLv>1e3?GlobalConfig.FriendLimit.chatLv%1e3+"级":GlobalConfig.FriendLimit.chatLv+"级",o=GlobalConfig.FriendLimit.vipLv>0?"且达到"+VipCT.getVipStr(GlobalConfig.FriendLimit.vipLv,!0):"";TipsCT.ins().showTips(n+s+o+"开放")}else if(this.input.text.length>GlobalConfig.FriendLimit.contentLimit)TipsCT.ins().showTips("你说的话太长了");else if(this.input.text.length>0){if(1e3*i.zs+i.lv<GlobalConfig.FriendLimit.chatLv||i.vip<GlobalConfig.FriendLimit.vipLv)return void TipsCT.ins().showTips("好友未开启聊天功能");Friends.ins().sendChat(i,this.input.text+""),this.selectedIndex=0,this.input.text=""}break;case this.faceBtn:ViewManager.ins().open(ChatEmojiWin,this.input);break;case this.chatGroup:this.observe(GameLogic.ins().postInputText,this.updateInputText),"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(2,this.input.text+""||"")}},e}(BaseView);__reflect(FriendChatPanel.prototype,"FriendChatPanel"),window.FriendChatPanel=FriendChatPanel;var FriendListPanel=function(t){function e(){var e=t.call(this)||this;return e.name="好友",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=FriendListItemRender},e.prototype.open=function(){this.updateView(),this.addTouchEvent(this.btnFind,this.onTap)},e.prototype.updateView=function(){this.list.dataProvider=Friends.ins().friendsList},e.prototype.onTap=function(t){switch(t.target){case this.btnFind:ViewManager.ins().open(FriendsAddWin)}},e}(BaseView);__reflect(FriendListPanel.prototype,"FriendListPanel"),window.FriendListPanel=FriendListPanel;var FriendsAddWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsAddWinSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),this.addTouchEvent(this.btn_add,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.shadow,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.addTouchEvent(this.editText_name,this.onTap),this.observe(Friends.ins().postFriendChange,this.updateView),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.editText_name.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.updateInputText=function(t){this.editText_name.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.editText_name.text&&(this.editText_name.text="")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.editText_name.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn0:ViewManager.ins().close(e);break;case this.btn_add:if(this.editText_name.text==Actor.myName)return void TipsCT.ins().showTips("不能添加自己为好友");""!=this.editText_name.text&&Friends.ins().sendAddFriend(0,this.editText_name.text),ViewManager.ins().close(e);break;case this.shadow:ViewManager.ins().close(this);break;case this.chatGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.editText_name.text||"")}},e.prototype.updateView=function(){},e}(BaseEuiView);__reflect(FriendsAddWin.prototype,"FriendsAddWin"),ViewManager.ins().reg(FriendsAddWin,LayerManager.UI_Popup),window.FriendsAddWin=FriendsAddWin;var FriendsAppListWin=function(t){function e(){var e=t.call(this)||this;return e.panelList=[],e.name="申请",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn_allNo,this.onTap),this.addTouchEvent(this.btn_allYes,this.onTap),this.list_appList.itemRenderer=FriendAppListItemRender,this.list_appList.dataProvider=Friends.ins().appList,this.friendsScroller.viewport=this.list_appList,this.observe(Friends.ins().postFriendChange,this.updateView),this.updateView(),this.panelList=Friends.ins().appList.source},e.prototype.onTap=function(t){switch(t.target){case this.btn_allYes:for(var e=0,i=this.panelList;e<i.length;e++){var n=i[e];Friends.ins().sendAgreeApp(n.id,1)}break;case this.btn_allNo:for(var s=0,o=this.panelList;s<o.length;s++){var n=o[s];Friends.ins().sendAgreeApp(n.id,0)}}},e.prototype.updateView=function(){this.group_shenqing&&(this.group_shenqing.visible=0==Friends.ins().appList.length)},e}(BaseEuiView);__reflect(FriendsAppListWin.prototype,"FriendsAppListWin"),ViewManager.ins().reg(FriendsAppListWin,LayerManager.UI_Main),window.FriendsAppListWin=FriendsAppListWin;var FriendsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="FriendsWinSkin",this.isTopLevel=!0;var e=["最近","联系人"];this.tab.dataProvider=new eui.ArrayCollection(e)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.btn_add,this.onTap),this.addTouchEvent(this.btn_AskList,this.onTap),this.addTouchEvent(this.btn_blackList,this.onTap),this.addTouchEvent(this.btn_send,this.onTap),this.addChangeEvent(this.tab,this.onTap),this.list_recent.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onRecentListItemTap,this),this.tab.selectedIndex=0,this.onTabBarTouchTap(),this.list_friends.itemRenderer=FriendListItemRender,this.list_friends.dataProvider=Friends.ins().friendsList,this.list_recent.itemRenderer=FriendRecentListItemRender,this.list_recent.dataProvider=Friends.ins().recentList,this.list_chat.itemRenderer=FriendsChatItemRender,this.editText_input.maxChars=GlobalConfig.FriendLimit.contentLimit,this.observe(Friends.ins().postFriendChange,this.updateView),this.observe(Friends.ins().postChatToFriend,this.openChatGroup),Friends.ins().sendFriendsList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:Friends.ins().currentId=-1,ViewManager.ins().close(e);break;case this.btn_add:ViewManager.ins().open(FriendsAddWin);break;case this.btn_AskList:ViewManager.ins().open(FriendsAppListWin);break;case this.btn_blackList:ViewManager.ins().open(BlackListWin);break;case this.btn_send:if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.FriendLimit.chatLv||Actor.vip<GlobalConfig.FriendLimit.vipLv){var i=GlobalConfig.FriendLimit.chatLv>1e3?(GlobalConfig.FriendLimit.chatLv/1e3>>0)+"转":"",n=GlobalConfig.FriendLimit.chatLv>1e3?GlobalConfig.FriendLimit.chatLv%1e3+"级":GlobalConfig.FriendLimit.chatLv+"级",s=GlobalConfig.FriendLimit.vipLv>0?"且达到"+VipCT.getVipStr(GlobalConfig.FriendLimit.vipLv,!0):"";TipsCT.ins().showTips(i+n+s+"开放")}else this.editText_input.text.length>GlobalConfig.FriendLimit.contentLimit?TipsCT.ins().showTips("你说的话太长了"):this.editText_input.text.length>0&&(Friends.ins().sendChat(this.fd,this.editText_input.text+""),this.editText_input.text="",Timer.start(200,1,this.scrollerChatToBottom,this));break;case this.tab:this.onTabBarTouchTap()}},e.prototype.onRecentListItemTap=function(t){var e=t.item;e&&e.id&&this.openChatGroup(e.id)},e.prototype.onTabBarTouchTap=function(){this.group_recent&&(this.group_recent.visible=!1),this.group_lianxiren&&(this.group_lianxiren.visible=!1),this.list_friends.selectedIndex=-1,this.group_0.visible=this.group_1.visible=this.group_chat.visible=!1;var t=this["group_"+this.tab.selectedIndex];t&&(this.img_title.visible=!0,t.visible=!0,this.updateView(),0==this.tab.selectedIndex&&Friends.ins().recentList.refresh(),this.updateTipTab(),Friends.ins().sortRecentList(),Friends.ins().sortFriendList()),Friends.ins().postCloseFriendList()},e.prototype.openChatGroup=function(t){this.group_recent&&(this.group_recent.visible=!1),this.group_lianxiren&&(this.group_lianxiren.visible=!1);var e=Friends.ins().indexOfFriendList(t);if(e>-1){Friends.ins().currentId=t;var i=Friends.ins().friendsList.getItemAt(e);this.group_0.visible=this.group_1.visible=this.img_title.visible=!1,this.group_chat.visible=!0,this.talkWith=i.id,this.fd=i,this.label_name.text=i.name,this.list_chat.dataProvider=Friends.ins().friendsList.getItemAt(e).acMsg,delete Friends.ins().newMsg[t]}egret.setTimeout(this.scrollerChatToBottom,this,200)},e.prototype.scrollerChatToBottom=function(){this.scroller_chat&&(this.scroller_chat.viewport.scrollV=Math.max(this.scroller_chat.viewport.contentHeight-this.scroller_chat.height,0))},e.prototype.updateView=function(t){if(void 0===t&&(t=null),this.label_num.text=this.list_friends.dataProvider.length+"/"+GlobalConfig.FriendLimit.friendListLen,this.redPoint0&&(this.redPoint0.visible=!1,Object.keys(Friends.ins().newMsg).length>0))for(var e in Friends.ins().newMsg){var i=Friends.ins().newMsg[e];if(1==i){this.redPoint0.visible=!0;break}}this.redPoint1.visible=Friends.ins().appList.length>0,this.redPoint2&&(this.redPoint2.visible=Friends.ins().appList.length>0),this.group_chat.visible&&egret.setTimeout(this.scrollerChatToBottom,this,200),this.updateTipTab()},e.prototype.updateTipTab=function(){this.group_recent&&0==this.tab.selectedIndex&&(this.group_recent.visible=0==Friends.ins().recentList.length),this.group_lianxiren&&1==this.tab.selectedIndex&&(this.group_lianxiren.visible=0==Friends.ins().friendsList.length)},e}(BaseEuiView);__reflect(FriendsWin.prototype,"FriendsWin"),ViewManager.ins().reg(FriendsWin,LayerManager.UI_Main),window.FriendsWin=FriendsWin;var BlackListItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendDelete(4,e.data.id),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.sName="S"+e.serverName+e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.sUserIcon="head_"+e.job+e.sex+(1==e.online?"":"b"),this.eGuildName=e.guildName,this.sHeadBg=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(BlackListItemRender.prototype,"BlackListItemRender"),window.BlackListItemRender=BlackListItemRender;var FriendAppListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsAppListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendAgreeApp(e.data.id,1),t.stopPropagation(),t.stopImmediatePropagation()},this),this.btn_no.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().sendAgreeApp(e.data.id,0),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.img_userIcon.source="head_"+e.job+e.sex,this.labelGuild.text=e.guildName;var i=Math.floor(e.vip/10)||0,n=e.vip%10||0;i?this.img_vipLv0.source="xvip_4"+i+"_png":this.img_vipLv0.source=null,this.img_vipLv1.source="xvip_4"+n+"_png",this.headBg.source=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(FriendAppListItemRender.prototype,"FriendAppListItemRender"),window.FriendAppListItemRender=FriendAppListItemRender;var FriendHeadItem=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.label_name.text=t.name,this.img_userIcon.source="head_"+t.job+t.sex,this.imgBg.source=ChatListItemRenderer.HEAD_BG[t.sex]},e}(BaseItemRender);__reflect(FriendHeadItem.prototype,"FriendHeadItem"),window.FriendHeadItem=FriendHeadItem;var FriendListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="FriendsItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(e)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Friends.ins().postChatToFriend(e.data.id),t.stopPropagation(),t.stopImmediatePropagation()},this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){WarnWin.show("确定要删除<font color='#f3311e'>"+e.data.name+"</font>吗?",function(){Friends.ins().sendDelete(1,e.data.id)},e),t.stopPropagation(),t.stopImmediatePropagation()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.label_power.text="战斗力:"+e.power,this.labelGuild.text=e.guildName,1==e.online?(this.label_lastLogin.text="在线",this.label_lastLogin.textColor=2610714):(this.label_lastLogin.text=DateUtils.getFormatBySecond(Math.max(e.offLineSec,60),4),this.label_lastLogin.textColor=16579836),this.img_userIcon.source="head_"+e.job+e.sex+(1==e.online?"":"b"),this.headBg.source=ChatListItemRenderer.HEAD_BG[e.sex]},e}(BaseItemRender);__reflect(FriendListItemRender.prototype,"FriendListItemRender"),window.FriendListItemRender=FriendListItemRender;var FriendRecentListItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data;this.label_name.text=e.name+"("+(e.zs>0?e.zs+"转":"")+e.lv+"级)",this.label_lastChat.text=e.lastMsg,this.img_userIcon.source="head_"+e.job+e.sex+(1==e.online?"":"b"),this.redPoint.visible=Friends.ins().newMsg[e.id]},e}(BaseItemRender);__reflect(FriendRecentListItemRender.prototype,"FriendRecentListItemRender"),window.FriendRecentListItemRender=FriendRecentListItemRender;var FriendsChatItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.label_msg&&(this.label_msg.wordWrap=!1),this.label_msg.visible=!1,this.emojiTxt=new EmojiText,this.emojiTxt.x=17,this.emojiTxt.y=2,this.emojiTxt.lineSpacing=8,this.group_bubble.addChild(this.emojiTxt)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e,i,n=this.data;n.fromActor.id==Actor.actorID?(n.fromActor.name=Actor.myName,e="0xE5B613",i="0xE5B613"):(e=n.fromActor.sex?"0xBC8787":"0x318ECE",i="0xFFFFFF"),this.label_date.text=n.dateStr;var s="|C:"+e+"&T:"+n.fromActor.name+"|:|C:"+i+"&T:"+n.msg+"|";this.emojiTxt.textWidth=this.group_bubble.width,this.emojiTxt.richText=s,this.emojiTxt.textColor=i,this.height=this.emojiTxt.uHeight+14+this.label_date.textHeight},e}(BaseItemRender);__reflect(FriendsChatItemRender.prototype,"FriendsChatItemRender"),window.FriendsChatItemRender=FriendsChatItemRender;var FuLiCT=function(t){function e(){var e=t.call(this)||this;return e.playNum=0,e.boxOn=0,e.addCoefficient=1,e.exp=0,e.boxInfo=0,e.baoji=0,e.isOpen=[],e.sysId=PackageID.moneyTree,e.regNetMsg(1,e.doMoneyTreeInfo),e.regNetMsg(2,e.doPalyBack),e.regNetMsg(3,e.doGetRewardBack),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendPlayYaoYao=function(){this.sendBaseProto(2)},e.prototype.sendGetCaseReward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.doMoneyTreeInfo=function(t){this.playNum=t.readUnsignedShort(),this.boxOn=t.readUnsignedShort(),this.addCoefficient=t.readUnsignedShort(),this.exp=t.readUnsignedShort(),this.boxInfo=t.readInt(),this.postMoneyInfoChange()},e.prototype.postMoneyInfoChange=function(t){return void 0===t&&(t=null),t},e.prototype.doPalyBack=function(t){this.playNum=t.readUnsignedShort(),this.boxOn=t.readUnsignedShort(),this.addCoefficient=t.readUnsignedShort(),this.exp=t.readUnsignedShort(),this.baoji=t.readUnsignedShort(),this.postMoneyInfoChange([!1,this.baoji])},e.prototype.doGetRewardBack=function(t){this.boxInfo=t.readInt(),this.postMoneyInfoChange()},e.prototype.getOrderByIndex=function(t){void 0===t&&(t=0);var e=this.boxInfo>>t&1;return e},e.prototype.getNowCoefficientinfo=function(t){void 0===t&&(t=0);var e=GlobalConfig.CashCowAmplitudeConfig;for(var i in e)if(e[i].level==this.addCoefficient+t)return e[i];return null},Object.defineProperty(e.prototype,"maxNum",{get:function(){return this.checkCashCowBasicLenght(10)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cruMaxNum",{get:function(){return this.checkCashCowBasicLenght()},enumerable:!0,configurable:!0}),e.prototype.getIndexCost=function(){var t=GlobalConfig.CashCowBasicConfig;for(var e in t)if(t[e].time==this.boxOn+1)return t[e];return null},e.prototype.getBoxInfoByIndex=function(t){var e=GlobalConfig.CashCowBoxConfig;for(var i in e)if(e[i].index==t)return e[i];return null},e.prototype.checkCashCowBasicLenght=function(t){void 0===t&&(t=0),0==t&&(t=Actor.vip);var e=GlobalConfig.CashCowLimitConfig;for(var i in e)if(e[i].vip==t)return e[i].maxTime;return 0},e.prototype.checkBoxIsCanget=function(t){var e=this.getBoxInfoByIndex(t);return e.time<=this.playNum&&this.getOrderByIndex(t-1)<=0?!0:!1},__decorate([post()],e.prototype,"postMoneyInfoChange",null),__decorate([post()],e.prototype,"doGetRewardBack",null),e}(BaseSystem);__reflect(FuLiCT.prototype,"FuLiCT"),System.FuLiCT=function(){return FuLiCT.ins()},window.FuLiCT=FuLiCT;var FuliWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FuliMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.iconList.itemRenderer=FuliActBtnRenderer,this.allPanels=[DailyCheckInPanel,SevenDayLogWin,GameNoticePanle,CdkeyPanle,MonthCardWin,FranchiseWin],this.panels=[],this.arrList=new eui.ArrayCollection},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.listBar,this.onChange),this.addChangeEvent(this.iconList,this.onClickMenu),this.observe(NoticeCT.ins().postGameNotice,this.updateMenuList),this.observe(DailyCheckIn.ins().postCheckInData,this.updateMenuList),this.observe(Activity.ins().postSevendayAwardCallback,this.updateMenuList),this.observe(Recharge.ins().postFranchiseInfo,this.updateMenuList),this.observe(Activity.ins().postActivityIsGetAwards,this.updateMenuList),this.observe(FangpianRedPoint.ins().postRedPoint,this.updateMenuList),this.index=0,e[0]&&(this.index=e[0],this.initFunc=function(){if(t.allPanels[t.index]!=t.panels[t.index]){var e=t.allPanels.length-t.panels.length;e=e>0?e:0,t.index-=e}}),this.updateMenuList([!0],e[1])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cruPanel.close&&this.cruPanel.close()},e.prototype.updateMenuList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._datas=[],this.panels=this.allPanels;var i,n=!1,s=0;t&&t[0]&&(t[0][0]&&(n=t[0][0]),t[0][1]&&(s=t[0][1]));for(var o in GlobalConfig.WelfareConfig)i=GlobalConfig.WelfareConfig[o],i.notOpen&&(LocationProperty.isIosTS||LocationProperty.isTSServer)||this._datas.push(i);var a=!0;for(var r in GlobalConfig.LoginRewardsConfig){var l=GlobalConfig.LoginRewardsConfig[r];if(0==(Activity.ins().isAwards>>l.day&1)){a=!1;break}}if(a){this.panels=[];for(var r=0,h=0;r<this._datas.length;h++)i=this._datas[r],1==i.id?this._datas.splice(r,1):(this.panels.push(this.allPanels[h]),r++)}this.arrList.replaceAll(this._datas),this.initFunc&&(this.initFunc(),this.initFunc=null),this.iconList.selectedIndex=this.index,this.iconList.dataProvider=this.arrList,n&&(this.curId=this.iconList.selectedIndex,this.updateDetail(t[1])),this.btnNum=this._datas.length,this.onChange()},e.prototype.onClickMenu=function(t){SoundUtil.play(SoundEnum.WINDOW),this.curId=this.iconList.selectedIndex,this.index=this.curId,this.updateDetail()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onChange=function(){this.iconList.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.iconList.scrollH>88*(this.iconList.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.btnNum<=6&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1)},e.prototype.updateDetail=function(t){return this.cruPanel&&(DisplayUtils.removeFromParent(this.cruPanel),this.cruPanel.close&&this.cruPanel.close()),null!=this.curId&&this.panels&&this.panels[this.curId]?(this.cruPanel=new this.panels[this.curId],FuLiCT.ins().isOpen[this.curId]||(FuLiCT.ins().isOpen[this.curId]=!0,this.updateMenuList()),void(this.cruPanel&&(this.cruPanel.left=0,this.cruPanel.right=0,this.cruPanel.top=0,this.cruPanel.bottom=0,this.info.addChild(this.cruPanel),this.cruPanel.open&&this.cruPanel.open(t)))):void platform.reportError("fuliwin.updateDetail:"+this.curId+"-"+(this.panels?this.panels.length:"null"))},e}(BaseEuiView);__reflect(FuliWin.prototype,"FuliWin"),ViewManager.ins().reg(FuliWin,LayerManager.UI_Main),window.FuliWin=FuliWin;var CdkeyPanle=function(t){function e(){var e=t.call(this)||this;return e.skinName="CDkeySkin",e.input.maxChars=28,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sendBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sendBtn:CDKey.ins().sendCdkey(this.input.text)}},e}(BaseView);__reflect(CdkeyPanle.prototype,"CdkeyPanle"),window.CdkeyPanle=CdkeyPanle;var ResultManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.create=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=t?t:GameMap.fbType;switch(n){case FbCT.FB_TYPE_PERSONAL:case FbCT.FB_TYPE_GUARD_WEAPON:case FbCT.FB_TYPE_CDBOSS:case FbCT.FB_TYPE_XMHJ:case FbCT.FB_TYPE_ACTIVITY:(s=ViewManager.ins()).open.apply(s,[PersonalResultWin].concat(e));break;case FbCT.FB_TYPE_TIAOZHAN:(o=ViewManager.ins()).open.apply(o,[TongResultWin].concat(e));break;case FbCT.FB_TYPE_FIRE_RING:case FbCT.FB_TYPE_MATERIAL:case FbCT.FB_TYPE_MOJIAN:case FbCT.FB_TYPE_HUN_SHOU:case FbCT.FB_TYPE_GUIDEBOSS:case FbCT.FB_TYPE_EXCLUSIVE:n==FbCT.FB_TYPE_FIRE_RING&&void 0!=e&&void 0!=e[0]&&0==e[0]&&Activity.ins().removeEvent(),(a=ViewManager.ins()).open.apply(a,[MaterialResultWin].concat(e));break;case FbCT.FB_TYPE_NEW_WORLD_BOSS:ViewManager.ins().open(NewWorldBossResultPanel);break;case FbCT.FB_TYPE_CITY:ViewManager.ins().open(CityResultWin,e[1],e[4]);break;case FbCT.FB_TYPE_ALLHUMENBOSS:case FbCT.FB_TYPE_ZHUANSHENGBOSS:case FbCT.FB_TYPE_HOMEBOSS:case FbCT.FB_TYPE_LABA:case FbCT.FB_TYPE_DARK_BOSS:case FbCT.FB_TYPE_HIDE_BOSS:case FbCT.FB_TYPE_STARBOSS:case FbCT.FB_TYPE_XUANWU:case FbCT.FB_TYPE_37BOSS:case FbCT.FB_TYPE_GOD_WEAPON:case FbCT.FB_TYPE_GOD_WEAPON_TOP:case FbCT.FB_TYPE_GUILDFB:ViewManager.ins().open(BossResultWin,e[1],e[4]);break;case FbCT.FB_TYPE_KF_BOSS:case FbCT.FB_TYPE_KF_BOSS2:case FbCT.FB_TYPE_SPIRIT:case FbCT.FB_TYPE_Legend:case FbCT.FB_TYPE_SMYJ:ViewManager.ins().open(KFBossResultWin,e[0],e[1],e[2]);break;case FbCT.FB_TYPE_KING:ViewManager.ins().open(KFBossResultWin,e[0],e[1],e[2],e[3]);break;case FbCT.FB_TYPE_THUNDER:(r=ViewManager.ins()).open.apply(r,[ThunderResultWin].concat(e));break;case FbCT.FB_TYPE_DARTCAR:(l=ViewManager.ins()).open.apply(l,[DartResultWin].concat(e));break;default:(h=ViewManager.ins()).open.apply(h,[ResultWin].concat(e))}var s,o,a,r,l,h},e}(BaseClass);__reflect(ResultManager.prototype,"ResultManager"),window.ResultManager=ResultManager;var GameNoticePanle=function(t){function e(){var e=t.call(this)||this;return e.skinName="gameNoticeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.HelpInfoConfig[5].text,n=i.split("_");this.title.textFlow=TextFlowMaker.generateTextFlow(n[0]),this.setDesc(),FuLiCT.ins().isOpenNotice&&(FuLiCT.ins().isOpenNotice=!1,NoticeCT.ins().postGameNotice(),NoticeCT.ins().setNoticeOPen()),this.observe(Activity.ins().postActivityIsGetAwards,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.setDesc=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.desc.textFlow=TextFlowMaker.generateTextFlow("暂无公告内容"),[4,window.platform.getNotice()];case 1:return t=e.sent(),t&&""!=t&&(this.desc.textFlow=TextFlowMaker.generateTextFlow(t)),[2]}})})},e.prototype.update=function(){if(this._cfg=GlobalConfig.WelfareConfig[2],!this._cfg||!this._cfg.activityId)return void(this.updataReward.visible=!1);var t=Activity.ins().getActivityDataById(this._cfg.activityId?this._cfg.activityId:0);t?(this.updataReward.visible=!0,this.suerBtn.enabled=t.canReward(),this.redPoint.visible=this.suerBtn.enabled,t.getRewardStateById(1)==Activity.Geted?(this.yilingqu.visible=!0,this.suerBtn.visible=!1):(this.yilingqu.visible=!1,this.suerBtn.visible=!0),this._collect||(this._collect=new eui.ArrayCollection,this.reward.dataProvider=this._collect),this._collect.source=GlobalConfig.ActivityType1Config[this._cfg.activityId][1].rewards):this.updataReward.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.onTouch=function(t){switch(t.target){case this.suerBtn:Activity.ins().sendReward(this._cfg.activityId,1)}},e}(BaseView);__reflect(GameNoticePanle.prototype,"GameNoticePanle"),window.GameNoticePanle=GameNoticePanle;var MoneyTreeBoxWin=function(t){function e(){var e=t.call(this)||this;return e.dataList=[],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MoneyTreeBoxSkin",this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.index=t[0];var i=FuLiCT.ins().getBoxInfoByIndex(this.index);this.desc.text="今日使用摇钱树"+i.time+"次，可额外获得：",this.creatRewardList(i.box),this.list.dataProvider=new eui.ArrayCollection(this.dataList),this.sure.enabled=FuLiCT.ins().playNum>=i.time},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap)},e.prototype.creatRewardList=function(t){for(var e,i=0;3>i;i++)this.dataList[i]?e=this.dataList[i]:(e=new RewardData,e.type=0,e.id=1,this.dataList.push(e)),e.count=t[i]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(this);
break;case this.sure:FuLiCT.ins().sendGetCaseReward(this.index),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(MoneyTreeBoxWin.prototype,"MoneyTreeBoxWin"),ViewManager.ins().reg(MoneyTreeBoxWin,LayerManager.UI_Main),window.MoneyTreeBoxWin=MoneyTreeBoxWin;var MoneyTreePanel=function(t){function e(){var e=t.call(this)||this;return e.posY=180,e.skinName="MoneyTreeSkin",e.mc1=new MovieClip,e.mc1.x=140,e.mc1.y=46,e.mc2=new MovieClip,e.mc2.x=222,e.mc2.y=46,e.mc3=new MovieClip,e.mc3.x=370,e.mc3.y=46,e.expMc=new MovieClip,e.expMc.x=376,e.expMc.y=e.posY,e.addChildAt(e.expMc,3),e.baojiMc=new MovieClip,e.baojiMc.x=207,e.baojiMc.y=270,e.movieExp=new MovieClip,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(NoticeCT.ins().postGameNotice,this.refushInfo),this.observe(FuLiCT.ins().postMoneyInfoChange,this.refushInfo),this.addTouchEvent(this.goUpBtn,this.onTap),this.addTouchEvent(this.image1,this.onTap),this.addTouchEvent(this.image2,this.onTap),this.addTouchEvent(this.image3,this.onTap),this.addTouchEvent(this.descBtn,this.onTap),this.addTouchEvent(this.expMc,this.onTap),this.refushInfo([!0]),this.expMc.playFile(RES_DIR_EFF+"ExpGroove")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.goUpBtn:if(FuLiCT.ins().playNum>=FuLiCT.ins().cruMaxNum)return void(Actor.vip>=10?TipsCT.ins().showTips("|C:0xf3311e&T:今日次数已用完|"):TipsCT.ins().showTips("|C:0xf3311e&T:提高"+VipCT.getVipStr()+"等级，获得更多次数|"));if(Actor.yb>=this.costNum)return void FuLiCT.ins().sendPlayYaoYao();TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");break;case this.image1:ViewManager.ins().open(MoneyTreeBoxWin,1);break;case this.image2:ViewManager.ins().open(MoneyTreeBoxWin,2);break;case this.image3:ViewManager.ins().open(MoneyTreeBoxWin,3);break;case this.descBtn:ViewManager.ins().open(ZsBossRuleSpeak,6);break;case this.expMc:ViewManager.ins().open(ZsBossRuleSpeak,6)}},e.prototype.refushInfo=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=!1,n=0,s=FuLiCT.ins(),o=s.getIndexCost();t&&t[0]&&(t[0][0]&&(i=t[0][0]),t[0][1]&&(n=t[0][1])),s.playNum==s.maxNum||(this.costNum=o.yuanbao),i||this.moveExpMc(),this.refushBoxInfo(),n>1&&(this.baojiMc.playFile(RES_DIR_EFF+"BurstEff",1),this.addChild(this.baojiMc))},e.prototype.moveExpMc=function(){this.movieExp.x=189,this.movieExp.y=257,this.movieExp.playFile(RES_DIR_EFF+"moneytreeexp",1),this.addChild(this.movieExp);var t=egret.Tween.get(this.movieExp);t.to({y:180,x:376},420)},e.prototype.refushBoxInfo=function(){for(var t=FuLiCT.ins(),e=1;4>e;e++){var i=this["mc"+e];t.checkBoxIsCanget(e)?this.playEffect(i):i.parent&&DisplayUtils.removeFromParent(i)}},e.prototype.playEffect=function(t){t.playFile(RES_DIR_EFF+"taskBox",100),this.addChild(t)},e}(BaseView);__reflect(MoneyTreePanel.prototype,"MoneyTreePanel"),window.MoneyTreePanel=MoneyTreePanel;var GameLogic=function(t){function e(){var e=t.call(this)||this;e.MONSTER_RADIUS=2,e.MONSTER_LEN=2*e.MONSTER_RADIUS+1,e.currHandle=0,e.currAttackHandle=0,e.rPosindex=[],e.runTime=0,e.guanqiaId=0,e.sysId=PackageID.Default,e.regNetMsg(2,e.postSubRoleChange),e.regNetMsg(3,e.postEnterMap),e.regNetMsg(4,e.postCreateOtherEntity),e.regNetMsg(5,e.doGoldChange),e.regNetMsg(8,e.doSubRoleAtt),e.regNetMsg(9,e.postHpChange),e.regNetMsg(10,e.doRemoveEntity),e.regNetMsg(11,e.doMoveEntity),e.regNetMsg(12,e.doStopMoveEntity),e.regNetMsg(13,e.doSyncPos),e.regNetMsg(15,e.postMpChange),e.regNetMsg(17,e.doTips),e.regNetMsg(18,e.doFirstRegister),e.regNetMsg(20,e.doDieNotice),e.regNetMsg(21,e.postGuildChange),e.regNetMsg(22,e.postRename),e.regNetMsg(24,e.postOtherAttChange),e.regNetMsg(25,e.doPaoPao),e.regNetMsg(26,e.doNeiGongChange),e.regNetMsg(27,e.doSubRoleExtAtt),e.regNetMsg(31,e.doFindPath),e.regNetMsg(32,e.doBloodNumShow),e.regNetMsg(33,e.doChangeTarget),e.regNetMsg(34,e.doAddMonsterConfig),e.regNetMsg(35,e.doZeroInit),e.regNetMsg(36,e.postChangeCamp),e.regNetMsg(38,e.postFunsShow),urlParam.isLocation&&KeyboardUtils.ins().addKeyDown(e.test,e);var i="";for(var n in urlParam)"reportRoot"!=n&&"apiRoot"!=n&&(i+="&"+n+"="+urlParam[n]);console.log("外网资源",i),i="";for(var n in urlParam)"v"!=n&&"root"!=n&&"reportRoot"!=n&&"apiRoot"!=n&&(i+="&"+n+"="+urlParam[n]);console.log("内网资源",i),e.radiusMap=[];for(var s=2*e.MONSTER_RADIUS+1,n=0;s>n;n++)e.radiusMap[n]=[];return e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendHeartbeat()},e.prototype.sendNewRole=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendHeartbeat=function(){var t=this;if(!this.heartBeatTimer){var e=function(){var e=t.getBytes(255);t.sendToServer(e)};this.heartBeatTimer=new egret.Timer(6e4),this.heartBeatTimer.addEventListener(egret.TimerEvent.TIMER,e,this),this.heartBeatTimer.start()}},e.prototype.sendGMCommad=function(t){var e=this.getBytes(0);e.writeString(t),this.sendToServer(e)},e.prototype.postSubRoleChange=function(t){SubRoles.ins().doSubRole(t)},e.prototype.postEnterMap=function(t){ObjectPool.clearClass("TipsItem"),SoundUtil.stopAll(),DropHelp.clearDrop(),GameMap.parser(t),RoleAI.ins().clear(),MonsterSpeak.ins().clear(),MineFight.ins().stop(),MineData.ins().removeAll(),EntityManager.ins().removeAll(),EntityHideBody.ins().changeScene(),EntityShowMgr.ins().changeScene(),Timer.stopAll(GameMap.ins()),Timer.stopAll(SkillEffPlayer.ins()),Timer.stop(this.shakeMapView,this),this.gamescene.map.clearAllLayer(),this.gamescene.map.changeMap(),0==GameMap.fubenID?(FbCT.ins().pkGqboss=!1,Encounter.ins().willBossID&&(Encounter.ins().createBoss(),PlayFun.ins().upDataWillBoss(Encounter.ins().willBossID))):GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS||ViewManager.ins().closeTopLevel(),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetPlayerBigBloodPanel),GuildWar.ins().getModel().clearGuildWarList(),BossCT.ins().clearWorldBossList(),TargetListCC.ins().clear(),ObjectPool.clearClass("CharMonster"),ObjectPool.clearClass("BarrageTipsItem"),SoundUtil.WINDOW_OPEN||GameMap.lastFbId==GameMap.fubenID&&!GameMap.fubenID||SoundUtil.play(SoundEnum.SCENE),0==GameMap.fbType&&SubRoles.lookAtTar&&SubRoles.lookAtTar.wearTitle()},e.prototype.postCreateOtherEntity=function(t){var e=t.readShort();t.readDouble();t.position-=10;var i,n;return e==EntityType.Monster||e==EntityType.CollectionMonst?(i=new EntityModel,i.parser(t)):e==EntityType.Role?(i=new Role,i.parserBase(t),i.parserOtherRole(t,!0)):e==EntityType.LadderPlayer?(i=new Role,i.parserBase(t),i.parserOtherRole(t,!1),GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS&&(i.masterHandle=i.handle)):e==EntityType.DropItem&&(i=new CharModel,i.parserBase(t),i.parserItemData(t)),i?(EntityHideBody.ins().onCreateEntity(i),n=this.createEntityByModel(i),this.afterCreateOtherEntity(e,i,n),i):!1},e.prototype.afterCreateOtherEntity=function(t,e,i){t==EntityType.Monster||t==EntityType.CollectionMonst?(GameMap.fbType==FbCT.FB_TYPE_EXP&&(FbCT.ins().expMonterCount+=1),GameMap.sceneInMine()&&i&&(i.visible=!1),MonsterSpeak.ins().trigger(e.configID,SpeakType.appear)):t==EntityType.Role?((GuildWar.ins().getModel().checkinAppoint()||GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS)&&(e.guildID!=Guild.ins().guildID?GuildWar.ins().getModel().changecanPlayList(e.masterHandle):GuildWar.ins().getModel().setMyGuildNum(e.masterHandle)),CrossGuildBattleCT.ins().getCurMapLevel()>0&&e.guildID!=Guild.ins().guildID&&CrossGuildBattleCT.ins().changecanPlayList(e.masterHandle),MineFight.ins().isFighting&&i&&(i.visible=!1)):t==EntityType.LadderPlayer&&GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS&&(FbCT.ins().guideBossPlayerId=e.configID,FbCT.ins().guideBossPlayerJob=e.job,FbCT.ins().guideBossPlayerSex=e.sex,FbCT.ins().guideBossPlayerName=e.name,0==FbCT.ins().guideBossKill&&BossCT.ins().postBelongChange(e.masterHandle))},e.prototype.doGoldChange=function(t){var e=t.readShort();if(1==e){var i=t.readNumber();Actor.ins().postGoldChange(i)}else if(4==e){var n=t.readNumber();Actor.ins().postSoulChange(n)}else if(7==e)Actor.ins().postFeatsChange(t.readNumber());else if(9==e){var s=Actor.runeShatter;Actor.runeShatter=t.readNumber(),Actor.runeShatter-s>0&&TipsCT.ins().showTips("获得|C:0x35e62d&T:图腾精华x"+(Actor.runeShatter-s)+"|"),this.postRuneShatter()}else if(e==MoneyConst.piece){var o=Actor.runeExchange;Actor.runeExchange=t.readNumber(),o&&Actor.runeExchange-o>0&&TipsCT.ins().showTips("|C:0xFFD700&T:获得"+(Actor.runeExchange-o)+RewardData.getCurrencyName(MoneyConst.piece)+"|"),this.postRuneExchange()}else if(11==e){var a=t.readNumber();Actor.ins().postUpdateTogeatter(a,1)}else if(12==e){var a=t.readNumber();Actor.ins().postUpdateTogeatter(a,2)}else if(e==MoneyConst.weiWang)Actor.ins().postWeiWang(t.readNumber());else if(e==MoneyConst.chip)Actor.ins().postChip(t.readNumber());else{var r=t.readNumber();Actor.ins().postYbChange(r)}},e.prototype.postRuneShatter=function(){},e.prototype.postRuneExchange=function(){},e.prototype.postLevelBarChange=function(t){return t},e.prototype.postAdjustMapPos=function(){},e.prototype.doSubRoleAtt=function(t){SubRoles.ins().doSubRoleAtt(t)},e.prototype.postHpChange=function(t){var e=t.readDouble(),i=t.readDouble(),n=t.readDouble(),s=EntityManager.ins().getEntityByHandle(e);if(!s)return!1;var o=s.infoModel,a=o.getAtt(AttributeType.atHp);return o.setAtt(AttributeType.atHp,i),o.setAtt(AttributeType.atMaxHp,n),s.updateBlood(),0>=i?(RoleAI.ins().checkPlayDieSound(s),DropHelp.tempDropPoint.x=Math.floor(s.x/GameMap.CELL_SIZE),DropHelp.tempDropPoint.y=Math.floor(s.y/GameMap.CELL_SIZE)):o.type!=EntityType.Role||s.nameVisible||s.showNameAndHp(),[s,i,a]},e.prototype.doNeiGongChange=function(t){var e=t.readDouble(),i=t.readDouble(),n=EntityManager.ins().getEntityByHandle(e);n&&n.infoModel&&(n.infoModel.setAtt(AttributeType.cruNeiGong,i),n.updateNeiGong())},e.prototype.postEntityHpChange=function(t,e,i,n){if((e&&e.team==Team.My||t&&t.team==Team.My)&&16==i){var s=GameSceneView.ins;DisplayUtils.shakeItHeji(s.map,30,700)}return[t,e,i,n]},e.prototype.doRemoveEntity=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){if(i instanceof CharRole)i.infoModel&&i.infoModel.type==EntityType.LadderPlayer?GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS?0==FbCT.ins().guideBossKill?(this.removeEntity(e),BossCT.ins().postBelongChange(Actor.handle,e,i.infoModel.name),FbCT.ins().guideBossKill+=1):(EntityManager.ins().removeByHandle(e,!1,!0),i.onDead(function(){i.deadDelay()}),GuideUtils.ins().clickOut(),FbCT.ins().guideBossKill+=1,BossCT.ins().weixieList.length=0,BossCT.ins().postHasAttackChange(0)):this.removeEntity(e):EntityManager.ins().removeByHandle(e);else if(i instanceof CharItem2)EntityManager.ins().removeByHandle(e);else{if(this.removeEntity(e),i&&i.team!=Team.My){var n=!1,s=EntityManager.ins().screeningTargetByPos(i,!0);if(s&&0!=s.length){if(GameMap.fbType==FbCT.FB_TYPE_GUILD_WAR){var o=EntityManager.ins().getEntityByHandle(this.currAttackHandle);(!o||o.infoModel.getAtt(AttributeType.atHp)<=0)&&(n=!0)}}else n=!0;if(n)for(var a=EntityManager.ins().getEntityByTeam(Team.My),r=0,l=a;r<l.length;r++){var o=l[r];o.action!=EntityAction.RUN&&o.playAction(EntityAction.STAND)}if((GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS||GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN)&&i.parent){var h=i.parent.localToGlobal(i.x,i.y);FbCT.ins().postExpFly(h,50)}}GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS&&(BossCT.ins().attHandle=0,FbCT.ins().guideBossKill&&(BossCT.ins().winner=Actor.myName),GuideUtils.ins().clickOut(),this.postChangeTarget(0))}if(GameMap.fbType==FbCT.FB_TYPE_Legend){var u=LegendTowerCT.ins().checkNum(e);(u||0==u)&&LegendTowerCT.ins().buffData.splice(u,1)}this.postRemoveEntity(e,i)}},e.prototype.postRemoveEntity=function(t,e){return[t,e]},e.prototype.removeEntity=function(t){var e=EntityManager.ins().getEntityByHandle(t);e&&e.infoModel.getAtt(AttributeType.atHp)<=0?(EntityManager.ins().removeByHandle(t,!1,!0),e.stopMove(),e.onDead(function(){e.deadDelay();var t=egret.Tween.get(e.dieTweenObj);t.wait(1e3).to({alpha:0},1e3).call(function(){DisplayUtils.removeFromParent(e)})})):EntityManager.ins().removeByHandle(t,!0,!0)},e.prototype.doMoveEntity=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var n=t.readInt(),s=t.readInt();(i.x!=n||i.y!=s)&&GameMap.moveEntity(i,n,s,!0)}},e.prototype.doStopMoveEntity=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);i&&(i.stopMove(),i.infoModel.getAtt(AttributeType.atHp)>0&&i.playAction(EntityAction.STAND),i.x=t.readInt(),i.y=t.readInt())},e.prototype.doSyncPos=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e),n=t.readShort();if(i){i.stopMove();var s=void 0;switch(n){case 0:i.playAction(EntityAction.STAND),i.x=t.readInt(),i.y=t.readInt(),i.isMy&&i==SubRoles.lookAtTar&&this.syncMyPos({x:i.x,y:i.y});break;case 1:i.playAction(EntityAction.RUN),s=egret.Tween.get(i.moveTweenObj),s.to({x:t.readInt(),y:t.readInt()},t.readInt()).call(function(){i.playAction(EntityAction.STAND)});break;case 2:i.playAction(EntityAction.STAND),s=egret.Tween.get(i.moveTweenObj),s.to({x:t.readInt(),y:t.readInt()},t.readInt())}}},e.prototype.moveCamera=function(){},e.prototype.sendSyncServerTime=function(){this.sendBaseProto(14)},e.prototype.postMpChange=function(t){var e,i=t.readDouble(),n=t.readDouble(),s=EntityManager.ins().getEntityByHandle(i);return s&&(e=s.infoModel,e.setAtt(AttributeType.atMp,n)),e},e.prototype.postExpMc=function(t){return t},e.prototype.syncMyPos=function(t){return t},e.prototype.doTips=function(t){var e=GlobalConfig.ServerTips[t.readInt()].tips;TipsCT.ins().showTips(e)},e.prototype.doFirstRegister=function(t){var e=t.readByte();e?ViewManager.ins().open(WelcomeWin2):ViewManager.ins().open(WelcomeWin)},e.prototype.doDieNotice=function(t){},e.prototype.postGuildChange=function(t){return[t.readInt(),t.readString()]},e.prototype.postOtherAttChange=function(t){var e=EntityManager.ins().getEntityByHandle(t.readDouble());if(!e||!e.infoModel)return!1;for(var i=t.readShort(),n=0;i>n;n++)e.infoModel.setAtt(t.readInt(),t.readDouble());return e},e.prototype.doPaoPao=function(t){var e=t.readDouble(),i=t.readInt(),n=EntityManager.ins().getEntityByHandle(e);n&&n.addPaoPao(i)},e.prototype.doSubRoleExtAtt=function(t){SubRoles.ins().doSubRoleExtAtt(t)},e.prototype.sendRename=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:return[4,platform.checkStr(t,2)];case 1:return e=n.sent().content,i=this.getBytes(22),i.writeString(e),i.writeByte(1),this.sendToServer(i),[2]}})})},e.prototype.postRename=function(t){var e=t.readByte();0==e?(Socket.ins().close(),ViewManager.ins().close(RenameWin),alert("需要重新登录！"),location.reload()):RoleMgr.ins().showErrorTips(e)},e.prototype.postChangeAttrPoint=function(t){var e=this.getBytes(25);e.writeDouble(t),this.sendToServer(e),GuildWar.ins().getModel().clickTime=1,CrossGuildBattleCT.ins().clickTime=1},e.prototype.doFindPath=function(t){var e=t.readDouble(),i=Math.floor(t.readInt()/GameMap.CELL_SIZE),n=Math.floor(t.readInt()/GameMap.CELL_SIZE),s=t.readInt(),o=t.readInt(),a=Math.floor(s/GameMap.CELL_SIZE),r=Math.floor(o/GameMap.CELL_SIZE),l=this.getFindPath(e,i,n,a,r);this.sendFindPathToServer(e,l,!0,!0)},e.prototype.getFindPath=function(t,e,i,n,s){var o,a=EntityManager.ins().getEntityByHandle(t);if(SubRoles.lookAtTar&&a&&a.infoModel&&a.infoModel.isMy&&SubRoles.lookAtTar!=a){var r=Math.floor(SubRoles.lookAtTar.x/GameMap.CELL_SIZE),l=Math.floor(SubRoles.lookAtTar.y/GameMap.CELL_SIZE);if(r==e&&l==i)o=GameMap.getPatch(e,i,n,s);else{var h=GameMap.getPatch(e,i,r,l),u=GameMap.getPatch(r,l,n,s);o=h&&u?u.concat(h):GameMap.getPatch(e,i,n,s)}}else o=GameMap.getPatch(e,i,n,s);return o},e.prototype.sendFindPathToServer=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var s=e?e.length:0,o=this.getBytes(31);o.writeDouble(t),o.writeInt(s);for(var a=0;s>a;a++)0!=a||i?(o.writeInt(e[a].nX*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1)),o.writeInt(e[a].nY*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1))):(o.writeInt(e[a].nX),o.writeInt(e[a].nY));o.writeByte(+n),this.sendToServer(o)},e.prototype.doBloodNumShow=function(t){var e=t.readDouble(),i=t.readDouble(),n=-1*Math.ceil(t.readDouble()),s=t.readUnsignedInt(),o=EntityManager.ins().getEntityByHandle(i);if(o){var a=EntityManager.ins().getEntityByHandle(e);a&&(a.team==Team.My&&a.infoModel.type==EntityType.Monster&&0>n||(a instanceof CharRole||a.shakeIt(),this.postEntityHpChange(a,o,s,n)))}},e.prototype.doChangeTarget=function(t){var e=t.readDouble(),i=t.readDouble();this.postAllAtkTarget(e,i);var n=EntityManager.ins().getEntityByHandle(e);if(n&&n.infoModel&&n.infoModel.masterHandle==Actor.handle&&this.postAtkTarget(i),TargetListCC.ins().isShow)return void TargetListCC.ins().postTargetList(e,i);if(GameMap.fbType!=FbCT.FB_TYPE_GUILD_WAR&&GameMap.fbType!=FbCT.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=FbCT.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=FbCT.FB_TYPE_HOMEBOSS&&GameMap.fbType!=FbCT.FB_TYPE_GUIDEBOSS&&GameMap.fbType!=FbCT.FB_TYPE_STARBOSS&&GameMap.fbType!=FbCT.FB_TYPE_37BOSS&&GameMap.fbType!=FbCT.FB_TYPE_XUANWU||0==i)return void(n&&(n==SubRoles.lookAtTar||SubRoles.lookAtTar&&n.infoModel.handle==SubRoles.lookAtTar.infoModel.handle)&&(this.currAttackHandle=EntityManager.ins().getRootMasterHandle(i)));var s=EntityManager.ins().getEntityByHandle(i);if(s&&s.infoModel&&s.infoModel.masterHandle>0){var o=EntityManager.ins().getEntityByHandle(e);if(o&&o.infoModel&&o.infoModel.masterHandle==Actor.handle&&this.postChangeTarget(s.infoModel.masterHandle),o&&o.infoModel){var a=EntityManager.ins().getMasterList(o.infoModel.masterHandle);if(s.infoModel.masterHandle==Actor.handle&&a){for(var r in a)a[r]instanceof CharRole&&a[r].setNameTxtColor(ColorUtil.ROLENAME_COLOR_YELLOW);if(GameMap.fbType==FbCT.FB_TYPE_GUIDEBOSS){if(BossCT.ins().weixieList[0]!=o.infoModel.masterHandle){var l=o.infoModel.name;if(o.infoModel.type==EntityType.LadderPlayer){var h=l.split("\n");l=h[1]?h[1]:h[0],l=StringUtils.replaceStr(l,"0xffffff",ColorUtil.ROLENAME_COLOR_GREEN+"")}FbCT.ins().guideBossKill&&TipsCT.ins().showCenterTips("受到|C:0x35e62d&T:"+l+"|玩家的攻击，点击右边头像进行反击")}BossCT.ins().weixieList.length=0,BossCT.ins().changeWeiXieList(o.infoModel.masterHandle),BossCT.ins().postHasAttackChange(0)}}}}else{var u=EntityManager.ins().getEntityByHandle(e);u&&u.infoModel&&u.infoModel.masterHandle==Actor.handle&&(s&&s.infoModel?this.postChangeTarget(s.infoModel.masterHandle):this.postChangeTarget(0))}},e.prototype.postChangeTarget=function(t){this.currAttackHandle=t},e.prototype.postAtkTarget=function(t){this.currHandle=t},e.prototype.postAllAtkTarget=function(t,e){return[t,e]},e.prototype.test=function(t){if(t==Keyboard.BRACE_R,t==Keyboard.BRACE_L,t==Keyboard.BACKSLASH,t==Keyboard.I,t==Keyboard.O){var e=0;egret.setInterval(function(){e&&console.log(egret.$hashCount-e),e=egret.$hashCount},this,1e3)}if(t==Keyboard.P,t==Keyboard.SPACE&&RoleAI.ins().togglePause(),t==Keyboard.BACK_QUOTE,t==Keyboard.ENTER,t==Keyboard.KC_TAB)if(ViewManager.ins().isShow(WarnWin))ViewManager.ins().close(WarnWin);else{var i=Version.BUILD_NUMBER;i+="\n开服天数:"+(GameServer.serverOpenDay+1)+"天",i+="\n服务器id:"+LocationProperty.srvid,i+="\n账号:"+LocationProperty.openID,WarnWin.show(i,null,this,null,null,"sure")}},e.prototype.startPkBoss=function(){FbCT.ins().autoPk()},e.prototype.createEntityByModel=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=EntityManager.ins().createEntity(t,e);return n&&this.addEntity(n),n},e.prototype.addEntity=function(t){t instanceof CharRole?(t.showBlood(t.isMy||t.team==Team.WillEntity),t.showNeigong(t.isMy),t.dir=t.x>=GameMap.MAX_WIDTH>>1?6:2):t instanceof CharMonster&&GlobalConfig.MonstersConfig[t.infoModel.configID]&&3==GlobalConfig.MonstersConfig[t.infoModel.configID].type&&(t.dir=t.x>=GameMap.MAX_WIDTH>>1?6:2),this.gamescene.map.addEntity(t)},e.prototype.playSkillEff=function(t,e,i,n){void 0===n&&(n=null);var s=300;if(t.wordEff&&e.team==Team.My&&(SkillCT.ins().postShowSkillWord(t.wordEff+""),SkillCT.ins().hejiLevel>0&&SkillCT.ins().isHejiSkill(t.configID)&&(SkillCT.ins().hejiEnable=!1,SkillCT.ins().setHejiCD(-1),SkillCT.ins().postHejiRemove())),(1==i.length&&e!=i[0]||i.length>1)&&(e.dir=DirUtil.get8DirBy2Point(e,i[0])),t&&t.actionType&&e.playAction(t.actionType,e instanceof CharRole?null:function(){e.action!=EntityAction.DIE&&e.playAction(EntityAction.STAND)}),!GameSceneView.ins.stage)return 0;e&&e.team==Team.My&&t.repelDistance&&Timer.start(350,1,this.shakeMapView,this);var o=[14],a=Math.floor(t.configID/1e3);if(!(o.indexOf(a)<0&&!EntityShowMgr.ins().checkShowSkillEffect()&&e.infoModel.masterHandle)||e.isMy||i[0].isMy){var r=GlobalConfig.ShieldSkillConfig[GameMap.fubenID];if(!(r&&r[GameMap.mapID]&&r[GameMap.mapID].effId&&t.effectId&&r[GameMap.mapID].effId.indexOf(t.effectId)>-1)){if(!t.effectId)return n&&n(),0;if(e.infoModel.type==EntityType.Monster&&-1!=GlobalConfig.FlameStamp.skillId.indexOf(t.configID)&&e.usedLyMarkSkill(),!e.getIsShowBody())return n&&n(),0;switch(SkillEffPlayer.play(t.effectId,e,[i[0]],n),t.effType){case 3:return 700}return s}}},e.prototype.shakeMapView=function(){var t=GameSceneView.ins;DisplayUtils.shakeIt(t.map,5,250,2)},e.prototype.addOutEff=function(t,e){var i=new TransferModel;i.configID=0,i.x=t,i.y=e,i.type=EntityType.Transfer,EntityManager.ins().createEntity(i)},e.prototype.removeOutEff=function(){EntityManager.ins().removeTransferById(0)},Object.defineProperty(e.prototype,"gamescene",{get:function(){return GameSceneView.ins},enumerable:!0,configurable:!0}),e.prototype.createGuanqiaMonster=function(t,e,i){if(void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=this.fw),this.guanqiaId=FbCT.ins().guanqiaID,GameMap.sceneInMain()){var n=FbCT.ins(),s=n.waveMonsterId.length,o=[],a=0,r=s;this.guanqiaId>1e5&&i&&(D=this.fw=i,a=D[0],r=D[1]);for(var l=a;r>l;l++){var h=EntityManager.ins().getEntityByMonsterId(n.eliteMonsterId).length,u=EntityManager.ins().getEntityByMonsterId(n.waveMonsterId[l]).length-h;if(!(u>3)||e){var p=t?n.rPos[l].length:1;p>3&&(p=3),o.length<=l&&o.push(10-u);var c=1==p?p:Math.ceil(o[l]/p);1==p&&1==u&&(p=0),o[l]=c;for(var d=e,g=0;p>g;g++){this.runTime=0,(!this.rPosindex[l]||this.rPosindex[l]>=n.rPos[l].length)&&(this.rPosindex[l]=0);var f=this.rPosindex[l],v=[],y=n.rPos[l][f],m=y.x-this.MONSTER_RADIUS,T=y.y-this.MONSTER_RADIUS;this.writeMap(v,m,T,c);for(var C=0;C<this.MONSTER_LEN;C++)for(var b=0;b<this.MONSTER_LEN;b++)if(v[C]){var I=v[C][b];if(I){var w=void 0;if(e&&d&&5>h)w=n.createMonster(n.eliteMonsterId),w.isElite=!0,d=!1,h+=1;else{var S=n.waveMonsterId[l];w=n.createMonster(S)}w.x=(m+C)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1),w.y=(T+b)*GameMap.CELL_SIZE+(GameMap.CELL_SIZE>>1);var _=n.wanderpercent;w.isWander=1e4*Math.random()<_,w.isClient=!0;var B=this.createEntityByModel(w);B.AI_STATE=AI_State.Patrol}}this.rPosindex[l]++}}}var D}},e.prototype.writeMap=function(t,e,i,n){if(this.runTime++,this.runTime>200)return void console.log("关卡"+this.guanqiaId+"的刷怪点可能在不可行区域内,请策划检查");var s=MathUtils.limitInteger(0,this.MONSTER_LEN-1),o=MathUtils.limitInteger(0,this.MONSTER_LEN-1);if(t[s]||(t[s]=[]),t[s][o])this.writeMap(t,e,i,n);else{var a=GameMap.checkWalkable(e+s,i+o);a&&(t[s][o]=1,n--),n>0&&this.writeMap(t,e,i,n)}},e.prototype.postHookStateChange=function(t){return this.hookState=t,t},e.prototype.postMoveEntity=function(t,e,i){return void 0===i&&(i=!0),[t,e,i]},e.calculateRealAttribute=function(t,e,i,n){void 0===n&&(n={});var s,o=t.infoModel.getAtt(e),a=t.buffList,r=EntityManager.ins();for(var l in a){s=a[l];var h=r.getRootMasterHandle(i.infoModel.handle);(3==s.effConfig.type||7==s.effConfig.type&&s.hostsHandle&&s.hostsHandle.indexOf(h)>=0)&&s.effConfig.args.d==e&&(o+=s.multRate?s.value*s.multRate:s.value)}var u=n[e]?n[e]:0;return o+u},e.triggerAttr=function(t,e,i){void 0===i&&(i={});var n=t.infoModel.getAtt(e)||0;if(n+=i[e]?i[e]:0){var s=Math.random();if(n/1e4>s)return!0}return!1},e.triggerExAttr=function(t,e){var i=t.infoModel.getExAtt(e);if(i){var n=Math.random();if(i/1e4>n)return!0}return!1},e.triggerCrit=function(t,e,i){void 0===i&&(i=0);var n=t.infoModel.getAtt(AttributeType.atCrit);if(t.buffList[60003]){var s=t.buffList[60003].effConfig;n+=Math.floor(s.args.c/1e4*n)}var o=n-e.infoModel.getAtt(AttributeType.atTough)+i;if(o>0){var a=Math.random();if(o/1e4>a)return!0}return!1},e.triggerMiss=function(t,e){var i=t.infoModel.getExAtt(42),n=e.infoModel.getExAtt(26),s=Math.min(n-i,4e3);if(s>0){var o=Math.random();if(s/1e4>o)return!0}return!1},e.triggerValue=function(t){if(t){var e=Math.random();if(t/1e4>e)return!0}return!1},e.prototype.postViewOpen=function(t){var e=win.openList.length;return t?(ViewManager.ins().close(ChatMainUI),ViewManager.ins().close(PlayFunView),t):e?1:(ViewManager.ins().open(ChatMainUI),(GameMap.sceneInMain()||20==GameMap.fbType)&&ViewManager.ins().open(PlayFunView),t)},e.prototype.doAddMonsterConfig=function(t){var e=JSON.parse(t.readString());for(var i in e)GlobalConfig.MonstersConfig[i]=e[i]},e.prototype.doZeroInit=function(t){GameApp.ins().postZeroInit()},e.prototype.postChangeCamp=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i&&i.infoModel){if(i.infoModel.camp=t.readInt(),i.infoModel.masterHandle==Actor.handle){var n=i.infoModel.camp;if(n==BattleCC.ins().camp)return;BattleCC.ins().camp=n,BattleCC.ins().postEnterSuccess()}i.setCharName(i.infoModel.guildAndName),i.updateNameColor()}},e.prototype.sendFunsShowAward=function(t){var e=this.getBytes(35);e.writeInt(t),this.sendToServer(e)},e.prototype.postFunsShow=function(t){ActivityForeshowModel.ins().funcShowAward=t.readUnsignedInt()},e.skyBallCheck=function(t){if(this.triggerExAttr(t,8)){var e=void 0;return e=ObjectPool.pop("EntityBuff"),e.effConfig=GlobalConfig.EffectsConfig[SkillConst.EFF_SKY_BALL],e.addTime=egret.getTimer(),e.endTime=e.addTime+t.infoModel.getExAtt(9),t.addBuff(e),!0}return!1},e.prototype.postFlyItem=function(t){return t},e.prototype.postFlyItemEx=function(t){return t},e.prototype.stopAI=function(){this.sendBaseProto(33)},e.prototype.sendGetOtherAttr=function(t){var e=this.getBytes(34);e.writeShort(t.length);for(var i=0;i<t.length;i++)e.writeDouble(t[i]);this.sendToServer(e)},e.prototype.postInputText=function(t){return t},e.HOOK_STATE_HOOK=0,e.HOOK_STATE_FIND_ENMENY=1,__decorate([post()],e.prototype,"postSubRoleChange",null),__decorate([post()],e.prototype,"postEnterMap",null),__decorate([post()],e.prototype,"postCreateOtherEntity",null),__decorate([post()],e.prototype,"postRuneShatter",null),__decorate([post()],e.prototype,"postRuneExchange",null),__decorate([post()],e.prototype,"postLevelBarChange",null),__decorate([post()],e.prototype,"postAdjustMapPos",null),__decorate([post()],e.prototype,"postHpChange",null),__decorate([post()],e.prototype,"postEntityHpChange",null),__decorate([post()],e.prototype,"postRemoveEntity",null),__decorate([post(!0)],e.prototype,"moveCamera",null),__decorate([post()],e.prototype,"postMpChange",null),__decorate([post()],e.prototype,"postExpMc",null),__decorate([post()],e.prototype,"syncMyPos",null),__decorate([post()],e.prototype,"postGuildChange",null),__decorate([post()],e.prototype,"postOtherAttChange",null),__decorate([post()],e.prototype,"postRename",null),__decorate([post()],e.prototype,"postChangeAttrPoint",null),__decorate([post()],e.prototype,"postChangeTarget",null),__decorate([post()],e.prototype,"postAtkTarget",null),__decorate([post()],e.prototype,"postAllAtkTarget",null),__decorate([post()],e.prototype,"postHookStateChange",null),__decorate([post()],e.prototype,"postMoveEntity",null),__decorate([post()],e.prototype,"postViewOpen",null),__decorate([post()],e.prototype,"postChangeCamp",null),__decorate([post()],e.prototype,"postFunsShow",null),__decorate([post()],e.prototype,"postFlyItem",null),__decorate([post()],e.prototype,"postFlyItemEx",null),__decorate([post()],e.prototype,"postInputText",null),e}(BaseSystem);__reflect(GameLogic.prototype,"GameLogic"),System.GameLogic=function(){return GameLogic.ins()},window.GameLogic=GameLogic;var MainScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onEnter=function(){t.prototype.onEnter.call(this),this.addLayer(LayerManager.Game_Bg);var e=[LayerManager.Game_Main,LayerManager.Main_View,LayerManager.UI_Main,LayerManager.UI_Main2,LayerManager.UI_Popup,LayerManager.UI_Tips],i=DeviceUtils.IsLiuHai;if(i){win.setTop(i);var n=new eui.Rect;n.top=0,n.height=i,n.width=StageUtils.ins().getWidth(),n.fillColor=0,StageUtils.ins().getStage().addChild(n)}for(var s=0,o=e;s<o.length;s++){var a=o[s];a.top=LocationProperty.isOPPO&&a==LayerManager.UI_Popup?0:i,a.bottom=0,this.addLayer(a)}Main.ins.addChild(GameSceneView.ins),ViewManager.ins().open(ChatMainUI),ViewManager.ins().open(UIView2),ViewManager.ins().open(TipsView),GameApp.ins().postLoginInit()},e.prototype.onExit=function(){t.prototype.onExit.call(this)},e}(BaseScene);__reflect(MainScene.prototype,"MainScene"),window.MainScene=MainScene;var DropHelp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.init=function(t,e){this.dropContainer=t,this.dropNameContainer=e,MessageCenter.addListener(Encounter.ins().postCreateDrop,this.addDrop,this)},e.start=function(t){this.mainEntity=t?t:SubRoles.lookAtTar,GameMap.fbType==FbCT.FB_TYPE_MATERIAL||GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS&&OpenSystem.ins().checkSysOpen(SystemType.QUICKDROP)||(GameMap.fbType==FbCT.FB_TYPE_PERSONAL||Encounter.ins().isEncounter()||GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN)&&GameServer.serverOpenDay>0||GameMap.fbType==FbCT.FB_TYPE_GUARD_WEAPON||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS2||GameMap.fbType==FbCT.FB_TYPE_DEMON||GameMap.fbType==FbCT.FB_TYPE_CDBOSS||MineFight.ins().isFighting&&MineFight.ins().getIsFightBack()||4e4==GameMap.fubenID||40001==GameMap.fubenID||GameMap.fubenID==GlobalConfig.MoJianFubenBaseConfig.fbId||GameMap.fbType==FbCT.FB_TYPE_XMHJ||GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.fbType==FbCT.FB_TYPE_DARK_BOSS||GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON||GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_KING||GameMap.fbType==FbCT.FB_TYPE_EXCLUSIVE||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss?Timer.start(800,1,this.delayTweenItem,this.ins()):Timer.has(this.findDrop,this.ins())||Timer.start(100,0,this.findDrop,this.ins()),this.starting=!0},e.stop=function(){Timer.stopAll(this.ins()),this.starting=!1,RoleAI.ins().isFindDrop=!1},e.delayTweenItem=function(){if(!e.getItemCount())return void e.checkDrop();var t=e.mainEntity;if(!t)return void e.clearDrop();for(var i in e.itemPos)e.tweenItem(e.itemPos[i],t,i)},e.tweenItem=function(t,i,n){if(null==t)return void console.warn("掉落物Item=null，不能缓动！");DisplayUtils.removeFromParent(t),t.setItemParent(e.dropNameContainer);var s=egret.Tween.get(t),o=500*Math.random()+200;s.wait(o).to({x:i.x,y:i.y-50},450,egret.Ease.backIn).call(function(){egret.Tween.removeTweens(t),DisplayUtils.removeFromParent(t),t.destruct(),delete e.itemPos[n],e.getItemCount()||e.checkDrop()},e)},e.getItemCount=function(){return e.itemPos?Object.keys(e.itemPos).length:0},e.addDrop=function(t){var e=t[0],i=t[1],n=t[2],s=ObjectPool.pop("CharItem2");s.setData(n);var o=0,a=0,r=0,l="|";if(this.itemPos[e+l+i]||!GameMap.checkWalkable(e,i)){for(r=0;r<this.orderX.length&&(o=e+this.orderX[r],a=i+this.orderY[r],0==GameMap.checkWalkable(o,a)||null!=this.itemPos[o+l+a]);r++);if(r>=this.orderX.length)for(var h=2,u=!0;u;){for(var p=e-h;e+h>p&&u;p++)for(var c=i-h;i+h>c&&u;c++)o=p,a=c,0!=GameMap.checkWalkable(o,a)&&null==this.itemPos[o+l+a]&&(u=!1);h++}}else o=e,a=i;s.x=GameMap.grip2Point(o),s.y=GameMap.grip2Point(a),this.itemPos[o+l+a]=s,GameLogic.ins().addEntity(s),s.addRoatEffect(),s.addFloatEffect()},e.clearAllDropTween=function(){if(this.itemPos){var t=null;for(var e in this.itemPos)t=this.itemPos[e],t&&t instanceof CharItem2&&t.removeRoatEffect()}},e.clearDrop=function(){e.clearAllDropTween(),this.stop();
for(var t in this.itemPos)DisplayUtils.removeFromParent(this.itemPos[t]),this.itemPos[t]&&this.itemPos[t].destruct(),ObjectPool.push(this.itemPos[t]),delete this.itemPos[t];this.curTarget=null,this.completeFunc&&(this.completeFunc.func.call(this.completeFunc.funcThis),this.completeFunc=null)},e.findDrop=function(){var t=e.mainEntity;if(t){var i=EntityManager.ins().getEntityByTeam(Team.My);if(e.curTarget&&(!t||t.action==EntityAction.RUN||t.atking))return void(t&&t.action==EntityAction.RUN&&(t.x==e.lastPoint.x&&t.y==e.lastPoint.y?t.playAction(EntityAction.STAND):(e.lastPoint.x=t.x,e.lastPoint.y=t.y)));if(RoleAI.ins().isFindDrop=!0,i.length>1)for(var n=0,s=[-1,1],o=0;o<i.length;o++){var a=i[o];if(a!=t&&a.action!=EntityAction.RUN){var r=t;if(a.infoModel.masterHandle){var l=EntityManager.ins().getEntityByHandle(a.infoModel.masterHandle);l&&(r=l)}2==i.length&&(s=[0]);var h=DirUtil.getGridByDir(isNaN(r.dir+s[n])?0:s[n]);n+=1,GameMap.checkWalkableByPixel(r.x+h.x,r.y+h.y)&&GameMap.moveEntity(a,r.x+h.x,r.y+h.y)}}if(!(egret.getTimer()-e.waitTime<200)){var u=null;if(e.curTarget){if(u=e.curTarget,MathUtils.getDistance(t.x,t.y,u.x,u.y)<GameMap.CELL_SIZE>>1){for(var p in e.itemPos)if(e.itemPos[p]==u){var c=e.itemPos[p];c&&c instanceof CharItem2&&c.removeRoatEffect(),delete e.itemPos[p];break}return egret.Tween.get(u).wait(100).call(function(){if(u&&u.parent){var t=u.parent.localToGlobal(u.x,u.y);GameLogic.ins().postFlyItem({item:u,gp:t}),DisplayUtils.removeFromParent(u)}u=null}),e.curTarget=null,void(e.waitTime=egret.getTimer())}e.curTarget=null}var d=null,g=Number.MAX_VALUE;for(var p in e.itemPos){u=e.itemPos[p];var f=MathUtils.getDistance(t.x,t.y,u.x,u.y);g>f&&(g=f,d=e.itemPos[p])}if(d)return e.curTarget=d,void GameMap.moveEntity(t,d.x,d.y);e.checkDrop(),0==GameMap.fubenID&&FbCT.ins().sendGetReward()}}},e.checkDrop=function(){return this.getItemCount()?void 0:(this.stop(),void(this.completeFunc&&(this.completeFunc.func.call(this.completeFunc.funcThis),this.completeFunc=null)))},e.addCompleteFunc=function(t,e){this.completeFunc={func:t,funcThis:e}},e.tempDropPoint=new egret.Point,e.itemPos={},e.orderX=[-1,1,-1,0,1,-1,0,1],e.orderY=[0,0,1,1,1,-1,-1,-1],e.waitTime=0,e.lastPoint=new egret.Point,e}(BaseClass);__reflect(DropHelp.prototype,"DropHelp"),window.DropHelp=DropHelp;var EaseToFollowUtils=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.startTweenMove=function(t,i,n,s){var o=[];if(e.followTarget=i,"object"==typeof t)for(var a in t)o.push(t[a]);else Array.isArray(t)&&(o=t);e.arrowArray=o,e.callBack=n,e.finishFunc=s,Timer.stop(e.onEnterFrame,e.ins()),Timer.start(10,0,e.onEnterFrame,e.ins())},e.onEnterFrame=function(){if(!Assert(e.followTarget,"the easeToFollow followTarget is null"))for(var t=e.arrowArray,i=t.length<5,n=0;n<t.length;n++)if(n>0&&i)e.calEvery(t[n-1].x,t[n-1].y,t[n]);else{if(null==t[n])return;e.calEvery(e.followTarget.x,e.followTarget.y-50,t[n])}},e.calEvery=function(t,i,n){if(e.dx=t-n.x,e.dy=i-n.y,Math.abs(e.dx)<30&&Math.abs(e.dy)<30){e.vx=0,e.vy=0;var s=e.arrowArray.indexOf(n);if(s>-1&&(e.arrowArray.splice(s,1),e.callBack&&e.callBack(n)),0==e.arrowArray.length)return void e.dispose(n)}else e.easing+=.004,e.vx=e.dx*e.easing,e.vy=e.dy*e.easing;n.x+=e.vx,n.y+=e.vy},e.dispose=function(t){Timer.stop(e.onEnterFrame,e.ins()),e.followTarget=null,e.callBack=null,e.arrowArray=[],e.easing=.04,e.finishFunc&&(e.finishFunc(),e.finishFunc=null)},e.easing=.04,e.vx=0,e.vy=0,e.isFirst=!0,e}(BaseClass);__reflect(EaseToFollowUtils.prototype,"EaseToFollowUtils"),window.EaseToFollowUtils=EaseToFollowUtils;var GameSceneView=function(t){function e(){var e=t.call(this)||this;return e.skillWordList=[],e.mijingpassTime=0,e._shap=new egret.Shape,e.gwStartTimes=0,e.leftTimeMj=0,e._miCurFloor=0,e.leftTime=0,e.isStartTime=!1,e.leftFlyExp=0,e.curAddExp=0,e.curExp=0,e.skinName="GameFightSceneSkin",e.touchEnabled=!1,e.map=new MapView,e.map.initMap(),e.addChildAt(e.map,0),e.pkBossBtn.touchEnabled=!0,e.pkBossBtn.visible=!1,e.escBtn.visible=!1,e.skillWordImg=new eui.Image,e.skillWordImg.x=100,e.skillWordImg.visible=!1,e.skillWordImg.touchEnabled=!1,e.addChild(e.skillWordImg),e.GwRankGroup.addChild(e._shap),e._shap.rotation=-90,e._shap.x=48,e._shap.y=50,e.schedule.mask=e._shap,e.riseupBtn.visible=!1,e}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return this._ins||(this._ins=new e),this._ins},enumerable:!0,configurable:!0}),e.prototype.addDisplay=function(){this.observe(GameLogic.ins().postHookStateChange,this.upDataGuajiState),this.observe(GameLogic.ins().postHpChange,this.updateExpGroup),this.observe(SkillCT.ins().postShowSkillWord,this.showSkillWord),this.observe(FbCT.ins().postFbExpTotal,this.updateKill),this.observe(GameLogic.ins().postEnterMap,this.onEnterMap),this.observe(KFSmyjBossCT.ins().postBelong,this.showSmyj),this.observe(FbCT.ins().postFbTime,this.onSetTime),this.observe(GodWeaponCC.ins().postFubenInfo,this.updateMijingAdd),this.observe(Actor.ins().postExp,this.expChange),this.addTouchEvent(this.pkBossBtn,this.onTap),this.addTouchEvent(this.escBtn,this.onTap),this.addTouchEvent(this.riseup,this.onTap),this.addTouchEvent(this.sbsyBtn,this.onTap),this.addTouchEvent(this.mapBtn,this.onTap),this.stage.addEventListener(egret.Event.RESIZE,this.changeHeight,this),this.changeHeight()},e.prototype.changeHeight=function(){this.height=Main.ins.height},e.prototype.removeDisplay=function(){this.skillWordList=[],egret.Tween.removeTweens(this.skillWordImg),this.skillWordImg.visible=!1,Timer.stop(this.updateTime,this),Timer.stop(this.updateMijingTime,this),this.mijingpassTime=0,this.stage.removeEventListener(egret.Event.RESIZE,this.changeHeight,this)},e.prototype.expChange=function(t){if((GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS||GameMap.fbType==FbCT.FB_TYPE_TIAOZHAN)&&t){var e=SubRoles.lookAtTar;if(e){var i=new eui.Group;i.y=e.y-e.typeface-30,i.x=e.x,this.map.addChild(i);var n=new eui.Image;n.source="g3j_png",n.x=-55,i.addChild(n);var s=new eui.BitmapLabel;s.font="num_g3_fnt",s.text="+"+t,i.addChild(s),egret.Tween.get(i).to({y:i.y-80,scaleX:2,scaleY:2},200).to({scaleX:1.2,scaleY:1.2},100).wait(1e3).to({alpha:0,y:i.y-140},1e3).call(function(){DisplayUtils.removeFromParent(i),DisplayUtils.removeFromParent(n),DisplayUtils.removeFromParent(s)})}}},e.prototype.onEnterMap=function(){GlobalConfig.InstanceConfig[GameMap.fubenID]&&GlobalConfig.InstanceConfig[GameMap.fubenID].stopai&&ViewManager.ins().open(ControlView),Timer.stop(this.updateTime,this),ViewManager.ins().close(GwMijingRiseUpView),Timer.stop(this.updateMijingTime,this),this.mijingpassTime=0,this.isStartTime=!1,GameMap.fbType==FbCT.FB_TYPE_EXP?(this.curExp=0,this.expTxt||(this.expTxt=new eui.BitmapLabel,this.expTxt.font="num_r0_fnt",this.expTxt.letterSpacing=-5,this.expTxt.text="0",this.expTxt.horizontalCenter=0,this.expTxt.y=65,this.flyExpGroup.addChild(this.expTxt)),this.updateKill(),this.setExp(this.curExp),this.leftFlyExp=0,this.totleExp.source="chuangtianguan_json.fbljjy",this.killNumImg.source="chuangtianguan_json.fbjsgw",this.flyExpGroup.visible=!0,this.flyExpGroup1.visible=!0):(this.flyExpGroup.visible=!1,this.flyExpGroup1.visible=!1),this.guildBossGroup.visible=!1,this.escBtn.visible=GameMap.fubenID&&GameMap.fbType!=FbCT.FB_TYPE_GUANQIABOSS&&GameMap.fbType!=FbCT.FB_TYPE_CITY&&GameMap.fbType!=FbCT.FB_TYPE_FIRE_RING&&GameMap.fbType!=FbCT.FB_TYPE_PEAK&&GameMap.fbType!=FbCT.FB_TYPE_XMHJ,SkillCT.ins().hejiLevel>=0&&this.checkHJState(),GameMap.fbType==FbCT.FB_TYPE_MIJING?(this.GwRankGroup.visible=!1,this.showMijing()):this.GwRankGroup.visible=!1,GameMap.fbType==FbCT.FB_TYPE_GUARD_WEAPON?ViewManager.ins().open(GuardMainUI):(ViewManager.ins().close(GuardMainUI),ViewManager.ins().close(GuardCallBossWin)),this.sbsyBtn.visible=Guild.ins().guildID&&GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON,this.showSmyj()},e.prototype.showSmyj=function(){this.mapBtn.visible=GameMap.fbType==FbCT.FB_TYPE_SMYJ&&!!KFSmyjBossCT.ins().fbKind&&KFSmyjBossCT.ins().fbKind<Object.keys(GlobalConfig.DevilRuinsBossConfig).length},e.prototype.checkHJState=function(){GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.autoPunch()?ViewManager.ins().open(BtnHejiWin):ViewManager.ins().close(BtnHejiWin)},e.prototype.updateMijingAdd=function(){if(GameMap.fbType==FbCT.FB_TYPE_MIJING)for(var t=GodWeaponCC.ins().fubenInfoData,e=t.listData,i=0;i<e.length;i++)if(e[i].config.fbId==GameMap.fubenID){FbCT.ins().oldMijingPoint=e[i].curPoint;break}},e.prototype.showMijing=function(){var t,e=1;for(var i in GlobalConfig.GodWeaponFubenConfig)if(GlobalConfig.GodWeaponFubenConfig[i].fbId==GameMap.fubenID){e=parseInt(i),t=GlobalConfig.GodWeaponFubenConfig[i];break}this._miCurFloor=e;var n=GodWeaponCC.ins().fubenInfoData;if(n){for(var s=n.listData,o=0;o<s.length;o++)if(s[o].config.fbId==GameMap.fubenID){FbCT.ins().oldMijingPoint=s[o].curPoint;break}}else GodWeaponCC.ins().requestFubenInfo()},e.prototype.removeMiingTimeFun=function(){Timer.stop(this.updateMijingTime,this)},e.prototype.updateMijingTime=function(){if(this.leftTimeMj<=0)return ViewManager.ins().close(GwMijingRiseUpView),this.mijingpassTime=0,FbCT.ins().sendExitFb(),ViewManager.ins().open(GwResultView,GameMap.fubenID,4),void Timer.stop(this.updateMijingTime,this);for(var t=360-this.leftTimeMj,e=void 0,i=0;i<GlobalConfig.GodWeaponBaseConfig.fbGrade.length;i++)if(t<=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]){this.mijingpassTime=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]-t,e=GodWeaponCC.ins().getPinfenTime(i),FbCT.ins().mijingFingfen=i+1,FbCT.ins().mijingUseTime=t,this.updateMijingTimeView(e,i);break}this.leftTimeMj=360-(Math.floor((new Date).getTime()/1e3)-this.gwStartTimes)},e.prototype.updateMijingTimeView=function(t,e){this.GwRankGroup.visible||(this.GwRankGroup.visible=!0,this.schedule.source="godweapon_rankschedule",this.rankbg.source="GodWeapon_rankball");var i=360*this.mijingpassTime/t;360==i?i=0:0==i&&(i=360),DisplayUtils.drawCir(this._shap,this.schedule.width/2,360-i,!0),this.rank.source="godweapon_rank"+(e+1),this.time.text=DateUtils.getFormatBySecond(this.mijingpassTime,DateUtils.TIME_FORMAT_1);var n;n=GlobalConfig.GodWeaponBaseConfig.fbGrade[e]+"秒";var s="";switch(e+1){case 1:s="S";break;case 2:s="A";break;case 3:s="B";break;case 4:s="C"}this.requireTime.textFlow=(new egret.HtmlTextParser).parser(n+'<font color="#FFFFFF">内通关将保持</font>'+s+'<font color="#FFFFFF">评价</font>');var o=GlobalConfig.GodWeaponFubenConfig[this._miCurFloor];if(o){var a=o.award[e+1];a?this.rewardExp.text=""+a[0].count:this.rewardExp.text=""}else this.rewardExp.text=""},e.prototype.setMJPingfen=function(t){var e="godweapon_rank"+t;this.rank.source!=e&&(this.rank.source=e)},e.prototype.upDataGuajiState=function(t){0!=GameMap.fubenID&&1==t&&(t=0),this.stateImg.source=t?"zy_20":""},e.prototype.onSetTime=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GameMap.fbType==FbCT.FB_TYPE_GUILD_BOSS?t&&t[0]&&(this.leftTime=t[0][1],this.leftTimeImg.source="lastcount",this.guildBossGroup.visible=!0,this.isStartTime||(Timer.start(1e3,0,this.updateTime,this),this.isStartTime=!0,this.updateTime())):GameMap.fbType==FbCT.FB_TYPE_MIJING?t&&t[0]&&(this.leftTimeMj=t[0][1],this.leftTimeMj>=2&&(this.leftTimeMj=this.leftTimeMj-2),this.gwStartTimes=Math.floor((new Date).getTime()/1e3)-(360-this.leftTimeMj),Timer.start(1e3,0,this.updateMijingTime,this),this.updateMijingTime()):GameMap.fbType==FbCT.FB_TYPE_SOULS&&(this.leftTime=GlobalConfig.GuildAllSoulLandBossInfoConfig[GuildSoulsLandCT.ins().cur].leavetime,this.leftTimeImg.source="lastcount",this.guildBossGroup.visible=!0,this.isStartTime||(Timer.start(1e3,0,this.updateTime,this),this.isStartTime=!0,this.updateTime()))},e.prototype.updateTime=function(){return this.leftTime<0?(Timer.stop(this.updateTime,this),this.isStartTime=!1,this.guildBossGroup.visible=!1,this.leftTimePic.text="0",void FbCT.ins().sendExitFb()):(this.leftTimePic.text=this.leftTime+"",void this.leftTime--)},e.prototype.updateKill=function(){this.lbNum.textFlow=TextFlowMaker.generateTextFlow1("|C:0x35e62b&T:"+FbCT.ins().expMonterCountKill+"||C:0xF8B141&T:/"+FbCT.ins().fbExpTotal+"|")},e.prototype.flyExp=function(t,e){var i=this,n=new eui.Image;n.source="point2",n.anchorOffsetX=20,n.anchorOffsetY=20,n.x=t.x,n.y=t.y,this.addChild(n);var s=this.flyExpGroup.x+this.expTxt.x,o=this.flyExpGroup.y+this.expTxt.y+this.expTxt.height/2,a=egret.Tween.get(n);a.to({x:s,y:o,alpha:.5},800).call(function(){i.addExp(e),i.removeChild(n),egret.Tween.removeTweens(n)},this);var r=egret.Tween.get(n,{loop:!0});r.to({rotation:n.rotation+360},800)},e.prototype.rollExp=function(){var t=this.leftFlyExp>this.curAddExp?this.curAddExp:this.leftFlyExp;this.leftFlyExp=this.leftFlyExp-t,this.curExp+=t,this.setExp(this.curExp),this.leftFlyExp<=0&&Timer.stop(this.rollExp,this)},e.prototype.addExp=function(t){this.leftFlyExp+=t,this.curAddExp=Math.floor(this.leftFlyExp/10),Timer.has(this.rollExp,this)||Timer.start(30,0,this.rollExp,this)},e.prototype.setExp=function(t){this.expTxt.text=t+""},e.prototype.updateExpGroup=function(t){var e=t[0],i=t[1];if(!(i>0||GameMap.fbType!=FbCT.FB_TYPE_EXP)){var n=e.infoModel.configID,s=GlobalConfig.ExpFbMonsterConfig[n];if(s){var o=e.parent;if(!o){var a=SubRoles.lookAtTar;a&&(o=a.parent)}if(o){var r=GlobalConfig.MonthCardConfig.expFubenPrecent/100,l=Recharge.ins().getIsForeve()?1+r:1,h=o.localToGlobal(e.x,e.y);this.flyExp(h,Math.ceil(s.exp*l))}this.updateKill()}}},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.sbsyBtn:ViewManager.ins().open(GwbossqzWin);break;case this.mapBtn:ViewManager.ins().open(KFSmyjBossMapWin,KFSmyjBossCT.ins().fbKind-1);break;case this.pkBossBtn:break;case this.escBtn:if(GameMap.fbType==FbCT.FB_TYPE_GUARD_WEAPON)return void ViewManager.ins().open(GuardQuitTips);if(MineFight.ins().isFighting)return void TipsCT.ins().showTips("掠夺矿中不可以退出");if(GameMap.fbType==FbCT.FB_TYPE_GUANQIABOSS&&PlayFun.ins().closeAuto(),GuildWar.ins().getModel().checkinAppoint())return void ViewManager.ins().open(GuileWarReliveWin,3);if(CrossGuildBattleCT.ins().getCurMapLevel()>0)return void ViewManager.ins().open(CrossGuileWarReliveWin,3);if(BattleCC.ins().isBattle())return void WarnWin.show("是否退出阵营副本，退出后有30秒进入CD",function(){FbCT.ins().sendExitFb()},this);if(PaoDianCC.ins().isPaoDian)return void WarnWin.show("是否确定退出激情泡点？退出后将损失大量经验、威望奖励且有30秒进入CD",function(){FbCT.ins().sendExitFb()},this);if(KfArenaSys.ins().isKFArena)return void WarnWin.show("战场未结束，退出将扣除大量竞技场积分，是否退出？",function(){FbCT.ins().sendExitFb()},this);WarnWin.show("是否离开当前场景？",function(){FbCT.ins().sendExitFb(),Timer.stop(e.updateMijingTime,e),e.mijingpassTime=0},this);break;case this.riseup:ViewManager.ins().open(GwMijingRiseUpView)}},e.prototype.showSkillWord=function(t){if(t){egret.Tween.removeTweens(this.skillWordImg);var e=egret.Tween.get(this.skillWordImg);this.skillWordImg.source=null,this.skillWordImg.source=t,this.skillWordImg.visible=!0,this.skillWordImg.scaleX=3,this.skillWordImg.scaleY=3,this.skillWordImg.alpha=1,this.skillWordImg.y=250,e.to({y:250,scaleX:1,scaleY:1},200).wait(600).to({alpha:0},350)}},e}(BaseEuiView);__reflect(GameSceneView.prototype,"GameSceneView"),window.GameSceneView=GameSceneView;var BloodLabel=function(t){function e(){var e=t.call(this)||this;return e.urlDic={256:"wydEffectIcon",512:["j0z","j4z","j5z"]},e.containers=[],e.imgs=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createBloodLabel=function(t,e,i,n,s,o){void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=1);var a=this.getContainer();return a.createBlood(t,e,i,n,s,o),a},e.prototype.getTypeUrl=function(t,e){void 0===e&&(e=1);var i=this.urlDic[t];return i?"string"!=typeof i?i[e-1]:i:void 0},e.prototype.getImage=function(){return this.imgs.pop()||new eui.Image},e.prototype.getContainer=function(){return this.containers.pop()||new BloodContainer},e.prototype.pushImage=function(t){t&&-1==this.imgs.indexOf(t)&&this.imgs.push(t)},e.prototype.pushContainer=function(t){t&&-1==this.containers.indexOf(t)&&this.containers.push(t)},e}(BaseClass);__reflect(BloodLabel.prototype,"BloodLabel");var BloodContainer=function(t){function e(){var e=t.call(this)||this;return e.offset=3,e}return __extends(e,t),e.prototype.createBlood=function(t,e,i,n,s,o){void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=1),256==(256&t)&&this.addImage(256,o),512==(512&t)&&this.addImage(512,o),this.addBmpNumber(e,i,n,s),this.resetPosition()},e.prototype.addImage=function(t,e){void 0===e&&(e=1);var i=BloodLabel.ins().getTypeUrl(t,e);if(!i)return void console.log("伤害类型:"+t+"未设置资源");var n=BloodLabel.ins().getImage();n.addEventListener(egret.Event.COMPLETE,this.onLoaded,this),n.width=0/0,n.height=0/0,n.source=i,this.addChild(n)},e.prototype.addBmpNumber=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.bmpContainer?BitmapNumber.ins().changeNum(this.bmpContainer,t,e,i,n):this.bmpContainer=BitmapNumber.ins().createNumPic(t,e,i,n),this.addChild(this.bmpContainer)},e.prototype.onLoaded=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this),this.resetPosition()},e.prototype.resetPosition=function(){for(var t=0,e=0,i=this.numChildren,n=0;i>n;n++){var s=this.getChildAt(n);s.x=t,t+=s.width+this.offset,e=Math.max(e,s.height)}for(var n=0;i>n;n++){var s=this.getChildAt(n);s.y=(e-s.height)/2}this.width=t-this.offset,this.height=e},e.prototype.destroy=function(){for(;this.numChildren;){var t=this.removeChildAt(this.numChildren-1);t instanceof eui.Image?(t.removeEventListener(egret.Event.COMPLETE,this.onLoaded,this),BloodLabel.ins().pushImage(t)):t instanceof egret.DisplayObjectContainer&&BitmapNumber.ins().desstroyNumPic(t)}this.bmpContainer=null,BloodLabel.ins().pushContainer(this)},e}(egret.DisplayObjectContainer);__reflect(BloodContainer.prototype,"BloodContainer"),window.BloodLabel=BloodLabel;var BloodView=function(t){function e(){var e=t.call(this)||this;return e.offY=0,e.offsetY=0,e._lastType=0,e.bloodNum=50,e.tempBloodViews=[],e.tick=0,e.delayCount=0,e.bv2=new BloodView2,e.addChild(e.bv2),MessageCenter.addListener(GameLogic.ins().postEntityHpChange,e.showBlood,e),egret.startTick(function(){return e.tick++,!1},e),Timer.start(1e3,0,function(){var t=e.tick;return e.tick=0,e.delayCount<=0?void e.delayCount--:(t>=25?e.bloodNum=50:t>=15?e.bloodNum=10:t>=10?e.bloodNum=5:e.bloodNum=0,void(25>t&&(e.delayCount=5)))},e),e}return __extends(e,t),e.prototype.showBlood=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];if(!this.bv2.showBlood([e,i,n,s])){if(this.tempBloodViews.length>=this.bloodNum){var o=this.tempBloodViews[0];o&&(egret.Tween.removeTweens(o),DisplayUtils.removeFromParent(o),this.destroyBlood(o))}if(e&&i&&(e.team==Team.My||i.team==Team.My)){e.team==Team.My&&(n=1);var a=64&n&&i.isMy,r=2&n&&!a,l=8&n,h=16&n,u=4&n,p=512&n;if(p&&(r=!1),this.offY=EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this._lastType!=n&&(this.offsetY=0),this._lastType=n,0!=s||u){var c="";if(i instanceof CharRole)switch(i.infoModel.job){case JobConst.ZhanShi:c="j"+(r||a?0:1);break;case JobConst.FaShi:c="j"+(r||a?4:2);break;case JobConst.DaoShi:c="j"+(r||a?5:3)}else if(i instanceof CharMonster){c="j3";var d=GlobalConfig.MonstersConfig[i.infoModel.configID];d&&d.type==MonsterType.Ring&&(c="j9",r=!0)}(h||l)&&(c="j0");var g=e.team==Team.My?"2":c;u&&(g="j0");var f="";f=u?"s":h?0>s?"+"+Math.abs(s):"h"+(s>>0):0>s?"+"+Math.abs(s):(r?"b":a?"d":l?"b":"")+(s>>0);var v=0>s?"g3":g,y=3.5;32&n||128&n?this.offsetY+=25:this.offsetY=0;var m=this.offsetY,T=BloodLabel.ins().createBloodLabel(n,f,v,y,m,i.infoModel.job||1);T.touchChildren=!1,16&n?this.addChildAt(T,1e3):this.addChild(T),T.x=e.x-T.width/2,T.y=e.y-50-m;var C=0>s;"6"==c&&(C=!0),this.floatImg(T,n,e,i,C),this.tempBloodViews.push(T)}}}},e.prototype.removeFloatTarget=function(t){DisplayUtils.removeFromParent(t),this.destroyBlood(t)},e.prototype.injuredCritLucky=function(t,i){t.scaleX=t.scaleY=e.sc_s0;var n=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2,s=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);t.y=n,i.to({y:s,scaleX:e.sc_s1,scaleY:e.sc_s1},e.sc_sp1,e.sc_fun1).wait(e.sc_sp2).to({alpha:0,scaleX:e.sc_s2,scaleY:e.sc_s2},e.sc_sp3,e.sc_fun2).call(this.removeFloatTarget,this,[t])},e.prototype.injured=function(t,i){t.scaleX=t.scaleY=e.sn_s0;var n=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-80)/2,s=t.y-(EntityManager.CHAR_DEFAULT_TYPEFACE-30);t.y=n,i.to({y:s,scaleX:e.sn_s1,scaleY:e.sn_s1},e.sn_sp1,e.sn_fun1).wait(e.sn_sp2).to({alpha:0,scaleX:e.sn_s2,scaleY:e.sn_s2},e.sn_sp3,e.sn_fun2).call(this.removeFloatTarget,this,[t])},e.prototype.atkCritLucky=function(t,i){var n=0,s=0;t.x+=e.c_posX1,n=t.x+e.c_posX2,s=t.x+e.c_posX3,t.scaleX=t.scaleY=e.c_s0,t.y=t.y-e.c_posY1+this.offY,t.alpha=e.c_alpha0;var o=t.y-e.c_posY2;i.to({x:n,y:o,scaleX:e.c_s1,scaleY:e.c_s1,alpha:e.c_alpha1},e.c_sp1,e.c_fun1).to({scaleX:e.c_s2,scaleY:e.c_s2,alpha:e.c_alpha2},e.c_sp2,e.c_fun2).to({scaleX:e.c_s3,scaleY:e.c_s3,alpha:e.c_alpha3},e.c_sp3,e.c_fun3).wait(100).to({alpha:e.c_alpha4,y:t.y+e.c_posY3,x:s,scaleX:e.c_s4,scaleY:e.c_s4},e.c_sp4,e.c_fun4).to({alpha:e.c_alpha5,y:t.y+e.c_posY4,scaleX:e.c_s5,scaleY:e.c_s5},e.c_sp5,e.c_fun5).call(this.removeFloatTarget,this,[t])},e.prototype.atkHeJi=function(t,i){var n=0,s=0,o=ViewManager.gamescene.map,a=this.localToGlobal();a.x=StageUtils.ins().getWidth()/2,o.globalToLocal(a.x,a.y,a);var r=100*Math.random()-50,l=200*Math.random()-100;t.x=a.x-100-t.width/2+r,t.x+=e.h_posX1,n=t.x+e.h_posX2,s=t.x+e.h_posX3,t.scaleX=t.scaleY=e.h_s0,t.y=t.y-e.h_posY1+this.offY+l,t.alpha=e.h_alpha0;var h=t.y-e.h_posY2;i.to({x:n,y:h,scaleX:e.h_s1,scaleY:e.h_s1,alpha:e.h_alpha1},e.h_sp1,e.h_fun1).to({scaleX:e.h_s2,scaleY:e.h_s2,alpha:e.h_alpha2},e.h_sp2,e.h_fun2).to({scaleX:e.h_s3,scaleY:e.h_s3,alpha:e.h_alpha3},e.h_sp3,e.h_fun3).wait(100).to({alpha:e.h_alpha4,y:t.y+e.h_posY3,x:s,scaleX:e.h_s4,scaleY:e.h_s4},e.h_sp4,e.h_fun4).to({alpha:e.h_alpha5,y:t.y+e.h_posY4,scaleX:e.h_s5,scaleY:e.h_s5},e.h_sp5,e.h_fun5).call(this.removeFloatTarget,this,[t])},e.prototype.atk=function(t,i){var n=0,s=0;t.x+=e.posX1,n=t.x+e.posX2,s=t.x+e.posX3,t.scaleX=t.scaleY=e.s0,t.y=t.y-e.posY1+this.offY,t.alpha=e.alpha0;var o=t.y-e.posY2;i.to({x:n,y:o,scaleX:e.s1,scaleY:e.s1,alpha:e.alpha1},e.sp1,e.fun1).to({scaleX:e.s2,scaleY:e.s2,alpha:e.alpha2},e.sp2,e.fun2).to({scaleX:e.s3,scaleY:e.s3,alpha:e.alpha3},e.sp3,e.fun3).wait(100).to({alpha:e.alpha6,y:t.y+e.posY6,x:t.x+e.posX6,scaleX:e.s6,scaleY:e.s6},e.sp6,e.fun6).to({alpha:e.alpha7,y:t.y+e.posY7,x:t.x+e.posX7,scaleX:e.s7,scaleY:e.s7},e.sp7,e.fun7).to({alpha:e.alpha8,y:t.y+e.posY8,x:t.x+e.posX8,scaleX:e.s8,scaleY:e.s8},e.sp8,e.fun8).to({alpha:e.alpha9,y:t.y+e.posY9,x:t.x+e.posX9,scaleX:e.s9,scaleY:e.s9},e.sp9,e.fun9).to({alpha:e.alpha5,y:t.y+e.posY4,scaleX:e.s5,scaleY:e.s5},e.sp5,e.fun5).call(this.removeFloatTarget,this,[t])},e.prototype.floatImg=function(t,e,i,n,s){var o=egret.Tween.get(t);if(null==n||i.team==Team.My)2==(2&e)||8==(8&e)?this.injuredCritLucky(t,o):this.injured(t,o);else{var a=64==(64&e)&&n&&n.isMy,r=a&&2==(2&e);r||2==(2&e)||8==(8&e)?this.atkCritLucky(t,o):16==(16&e)?this.atkHeJi(t,o):this.atk(t,o)}},e.prototype.destroyBlood=function(t){t.x=0,t.y=0,t.alpha=1,t.scaleX=t.scaleY=1,t.touchChildren=!1,t instanceof BloodContainer?t.destroy():BitmapNumber.ins().desstroyNumPic(t);var e=this.tempBloodViews.indexOf(t);~e&&this.tempBloodViews.splice(e,1)},e.prototype.removeChildren=function(){for(var t=this.$children,e=t.length-1;e>=0;e--)e?this.$doRemoveChild(e):this.getChildAt(e).removeChildren()},e.sp1=60,e.sp2=80,e.sp3=80,e.sp4=400,e.sp5=720,e.fun1=egret.Ease.circInOut,e.fun2=egret.Ease.circInOut,e.fun3=egret.Ease.sineIn,e.fun4=null,e.fun5=egret.Ease.sineIn,e.s0=1.2,e.s1=.4,e.s2=.75,e.s3=.6,e.s4=.6,e.s5=.6,e.posX6=-18,e.posX7=-20,e.posX8=-23,e.posX9=-30,e.posY6=10,e.posY7=13,e.posY8=16,e.posY9=20,e.alpha6=.6,e.alpha7=.5,e.alpha8=.4,e.alpha9=0,e.sp6=600,e.sp7=200,e.sp8=400,e.sp9=400,e.fun6=null,e.fun7=null,e.fun8=null,e.fun9=null,e.s6=.6,e.s7=.6,e.s8=.6,e.s9=.6,e.posX1=90,e.posX2=0,e.posX3=0,e.posY1=100,e.posY2=0,e.posY3=0,e.posY4=10,e.alpha0=1,e.alpha1=1,e.alpha2=1,e.alpha3=.9,e.alpha4=.5,e.alpha5=0,e.startX=70,e.startY=75,e.changeTime1=300,e.changeTime2=1e3,e.changeY=.5,e.bigScale=3,e.endScale=.6,e.bigAlpha=1,e.endAlpha1=1,e.endAlpha2=.3,e.endTime1=600,e.endTime2=500,e.c_sp1=80,e.c_sp2=200,e.c_sp3=200,e.c_sp4=1e3,e.c_sp5=1200,e.c_fun1=egret.Ease.circInOut,e.c_fun2=egret.Ease.circInOut,e.c_fun3=egret.Ease.sineIn,e.c_fun4=null,e.c_fun5=egret.Ease.sineIn,e.c_s0=.1,e.c_s1=.8,e.c_s2=.8,e.c_s3=.8,e.c_s4=.6,e.c_s5=.1,e.c_posX1=0,e.c_posX2=100,e.c_posX3=120,e.c_posY1=120,e.c_posY2=10,e.c_posY3=10,e.c_posY4=10,e.c_alpha0=1,e.c_alpha1=1,e.c_alpha2=1,e.c_alpha3=.6,e.c_alpha4=0,e.c_alpha5=0,e.h_sp1=80,e.h_sp2=300,e.h_sp3=200,e.h_sp4=1e3,e.h_sp5=1200,e.h_fun1=egret.Ease.circInOut,e.h_fun2=egret.Ease.circInOut,e.h_fun3=egret.Ease.sineIn,e.h_fun4=null,e.h_fun5=egret.Ease.sineIn,e.h_s0=.1,e.h_s1=1.2,e.h_s2=1.2,e.h_s3=1.2,e.h_s4=1.2,e.h_s5=1.2,e.h_posX1=0,e.h_posX2=100,e.h_posX3=120,e.h_posY1=150,e.h_posY2=10,e.h_posY3=-30,e.h_posY4=-30,e.h_alpha0=1,e.h_alpha1=1,e.h_alpha2=1,e.h_alpha3=.6,e.h_alpha4=0,e.h_alpha5=0,e.NORMAL_SCALE_1=1.1,e.NORMAL_SCALE_2=.95,e.sn_sp1=600,e.sn_sp2=200,e.sn_sp3=200,e.sn_fun1=null,e.sn_fun2=null,e.sn_s0=1.3,e.sn_s1=1.3,e.sn_s2=1.3,e.sc_sp1=600,e.sc_sp2=200,e.sc_sp3=200,e.sc_fun1=null,e.sc_fun2=null,e.sc_s0=1.5,e.sc_s1=1.5,e.sc_s2=1.5,e.C_END_DES=0,e.C_YPOS1=120,e.C_YPOS2=0,e.C_YPOS3=-20,e.C_WAIT1=200,e.C_SPEED1=100,e.C_SPEED2=600,e}(egret.DisplayObjectContainer);__reflect(BloodView.prototype,"BloodView"),window.BloodView=BloodView;var BloodView2=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offY=0,e}return __extends(e,t),e.prototype.addDisplay=function(){},e.prototype.showBlood=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return i&&i.infoModel&&i.isMy&&s?(this.offY=EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this[n]?(this[n]([e,i,n,s]),!0):void 0):!1},e.prototype[1024]=function(t){var e=t[0],i=(t[1],t[2],t[3]),n=new eui.Group,s=new eui.Image;s.source="ljt_png",s.x=-74,s.y=-12,n.addChild(s);var o=new eui.BitmapLabel;o.font="lj_fnt",o.text=i+"",n.addChild(o),n.x=e.x-n.width/2,n.y=e.y-100+EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this.addChild(n),n.scaleX=1.1,n.scaleY=1.1,egret.Tween.get(n).to({scaleX:1,scaleY:1},600,egret.Ease.elasticOut).wait(50).to({x:n.x-20,y:n.y+20,alpha:.2},1e3).call(function(){return DisplayUtils.removeFromParent(n)})},e.prototype[2048]=function(t){var e=t[0],i=(t[1],t[2],t[3]),n=new eui.Group,s=new eui.Image;s.source="ljtb_png",s.x=-115,s.y=-40,n.addChild(s);var o=new eui.BitmapLabel;o.font="lj_fnt",o.text=i+"",n.addChild(o),n.x=e.x-n.width/2,n.y=e.y-100+EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this.addChild(n),n.scaleX=1.1,n.scaleY=1.1,egret.Tween.get(n).to({scaleX:1,scaleY:1},600,egret.Ease.elasticOut).wait(50).to({x:n.x-20,y:n.y+20,alpha:.2},1e3).call(function(){return DisplayUtils.removeFromParent(n)})},e.prototype[4096]=function(t){var e=t[0],i=(t[1],t[2],t[3]),n=new eui.Group,s=new eui.Image;s.source="j0a_png",s.x=-145,s.y=-80,n.addChild(s);var o=new eui.BitmapLabel;o.font="lj_fnt",o.text=i+"",o.letterSpacing=-4,n.addChild(o),n.x=e.x-n.width/2,n.y=e.y-100+EntityManager.CHAR_DEFAULT_TYPEFACE-e.typeface,this.addChild(n),n.scaleX=1.1,n.scaleY=1.1,egret.Tween.get(n).to({scaleX:1,scaleY:1},600,egret.Ease.elasticOut).wait(50).to({x:n.x-20,y:n.y+20,alpha:.2},1e3).call(function(){return DisplayUtils.removeFromParent(n)})},e}(BaseView);__reflect(BloodView2.prototype,"BloodView2"),window.BloodView2=BloodView2;var UIView1=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="UIView1Skin",e.fireMC=new eui.Group,e}return __extends(e,t),e.prototype.skinComplete=function(){LocationProperty.isIosTS&&(this.currentState="iosTS",this.eBtn0.icon="shf_jinbi_png",this.eBtn1.icon="shf_yuanbao_png"),OpenSystem.ins().checkSysOpen(SystemType.VIP_ENTRY)&&Recharge.ins().isOpenIosRecharge||(this.currentState="noVip"),LocationProperty.isTSServer&&(this.eBtn0.icon="shf_jinbi_png",this.eBtn1.icon="shf_yuanbao_png"),this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eVipBtn,this.onTap),this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eBtn0,this.onTap),this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eBtn1,this.onTap),this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eFace,this.onTap),this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eMName,this.onTap),this.addChildAt(this.fireMC,this.getChildIndex(this.ePow)-1),this.fire=new MovieClip,this.fireMC.horizontalCenter=-100,this.fireMC.y=80,this.fire.playFile(RES_DIR_EFF+"PowerFire",-1),this.fireMC.addChild(this.fire)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.eVipBtn:ViewManager.ins().open(VipWin);break;case this.eBtn0:Shop.openBuyGoldWin();break;case this.eBtn1:var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win);break;case this.eFace:ViewManager.ins().open(SettingView);break;case this.eMName:ViewManager.ins().open(EffectivenessTip,1)}},e.prototype.addDisplay=function(){var t=Actor.ins(),e=VipCT.ins();this.observe(t.postLevelChange,this.setName,!0),this.observe(t.postPowerChange,this.setPower,!0),this.observe(FbCT.ins().postGuanqiaInfo,this.setMapInfo,!0),this.associated(this.setMoney,t.postGoldChange,t.postYbChange),this.associated(this.setVrp,e.postUpdateVipData,e.postUpdataExp,e.postUpdateVipAwards,e.postUpdateWeekAwards),this.setMoney(),this.setVrp();var i=SubRoles.ins().getSubRoleByIndex(0);this.eFace.source="",this.eFace.source="yuanhead"+i.job+i.sex},e.prototype.setName=function(t){t=t||Actor.level;var e=ZsCT.ins().lv,i=e?e+"转":"";this.eName.text=i+t+"级"},e.prototype.setMoney=function(){CommonUtils.labelIsOverLenght(this.eTxt0,Actor.gold),CommonUtils.labelIsOverLenght(this.eTxt1,Actor.yb)},e.prototype.setPower=function(){this.ePow.text=Actor.power+""},e.prototype.setMapInfo=function(){var t=FbCT.ins(),e=t.guanqiaID,i=t.fbConfig,n=t.expEff,s=e>=1e5;this.eExp.visible=!s,s?this.eMName.text=i.desc:this.eMName.text="第"+e+"关\n"+n+"/小时"},e.prototype.setVrp=function(){this.eVrp.visible=VipCT.ins().getVipState(),this.eVipNum.text=(Actor.vip>10?Actor.vip-10:Actor.vip)+"",this.eVipIcon.source=VipCT.isSVIP()?"zjmsvipzi":"zjmvipzi",this.eQQVipIcon.showGray=!0,this.eQQVipIcon.handle=Actor.handle,this.eQQVipIcon.setVip(Actor.myPFVipInfo)},e}(BaseView);__reflect(UIView1.prototype,"UIView1"),window.UIView1=UIView1;var UIView2=function(t){function e(){var e=t.call(this)||this;return e.lastLevel=0,e.flyExpLevel=[],e._sn_="UIView2Skin",e.canClick=!0,e.radius=0,e._curAngle=0,e._toAngle=0,e._oldAngle=360,e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchEnabled=!1,this.touchChildren=!0,this.expBar.slideDuration=0,this.navBtn=[this.roleBtn,this.furnaceBtn,this.taskBtn,this.forgingBtn,this.bagBtn];for(var t=0;t<this.navBtn.length;t++)this.navBtn[t].redPoint.visible=!1;this.navBind=[RoleWin,SkillWin,LiLianWin,ForgeWin,BagWin],this.hpBall=new MovieClip,this.hpBall.x=66,this.hpBall.y=46,this.mpBall=new MovieClip,this.mpBall.x=66,this.mpBall.y=46,this.hjMc=new MovieClip,this.hjMc.x=41,this.hjMc.y=40,this.hjMc.touchEnabled=!1,this.circleImg=new MovieClip,this.circleImg.x=39,this.circleImg.y=40,this.circleImg.touchEnabled=!1,this.taskItemImg=new eui.Image,this.taskItemImg.x=250,this.taskItemImg.y=730,this.taskItemImg.visible=!1,this.flyItemGroup.addChild(this.taskItemImg),this.backMc=new MovieClip,this.backMc.x=47,this.backMc.y=47,this.isExitUsedItem=!1,this.isItemCountChange=!1,this.backBtnGroup.visible=!1,this.powerGroup.visible=!0,this.circleImg.touchEnabled=!1,this.backBtnGroup.touchEnabled=this.backMc.touchEnabled=!1,this.initPFUI()},e.prototype.initPFUI=function(){LocationProperty.isFromQQBLUE?this.eLab.text="用户ID:"+(urlParam.channel_openId||"")+"【热血沙城】应用由北京指上缤纷提供。若你使用中遇到问题，请通过进入【":(this.eTopGroup.bottom=0,DisplayUtils.removeFromParent(this.eKFTip))},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastLevel=Actor.level||0;for(var i=0;i<this.navBtn.length;i++)this.addTouchEvent(this.navBtn[i],this.onClick);
this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.powerGroup,this.onClick),this.addTouchEvent(this.lockImg,this.onClick),this.observe(Actor.ins().postExp,this.expChange),this.observe(Actor.init,this.setExp),this.observe(RoleCT.ins().postRoleHint,this.showRoleBtnRedPoint),this.observe(GameLogic.ins().postMpChange,this.updateHuShen),this.observe(GameLogic.ins().postCreateOtherEntity,this.updateHuShen),this.observe(GameLogic.ins().postHpChange,this.readyUpdateHp),this.observe(GameLogic.ins().postHpChange,this.flyGQBossExpToBar),this.observe(GameLogic.ins().postCreateOtherEntity,this.readyUpdateHp),this.observe(TaskCT.ins().postParabolicItem,this.runItem),this.observe(BagCT.ins().postItemCountChange,this.showBagBtnRedPoint),this.observe(ForgeRedPoint.ins().postForgeRedPoint,this.showForgingBtnRedPoint),this.observe(BagCT.ins().postBagWillFull,this.setBagTips),this.observe(BagCT.ins().postHasItemCanUse,this.setIsExitUsedItem),this.observe(BossCT.ins().postBossAppear,this.onBossAppear),this.observe(MonsterSpeak.ins().postMonsterSpeak,this.onMonsterSpeak),this.observe(FbCT.ins().postExpFly,this.flyExpToBar),this.observe(Encounter.ins().postFightResult,this.onFightResult),this.observe(NeiGong.ins().postNeiGongDataChange,this.startUpdateRedPoint),this.observe(JingMaiCT.ins().postUpdate,this.startUpdateRedPoint),this.observe(BagCT.ins().postItemAdd,this.startUpdateRedPoint),this.observe(ZsCT.ins().postZsData,this.startUpdateRedPoint),this.observe(Actor.ins().postLevelChange,this.startUpdateRedPoint),this.observe(Actor.ins().postGoldChange,this.startUpdateRedPoint),this.observe(SkillCT.ins().postSkillUpgradeAll,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingComposeItem,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingInfo,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingUpExp,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingDrug,this.startUpdateRedPoint),this.observe(ZhanLing.ins().postZhanLingWear,this.startUpdateRedPoint),this.observe(SoulSuitRedPoint.ins().postRedPoint,this.startUpdateRedPoint),this.observe(GameLogic.ins().postViewOpen,this.checkViewOpen),this.observe(BagCT.ins().postItemAdd,this.setLilianRedPoint),this.observe(LiLian.ins().postLilianData,this.setLilianRedPoint),this.observe(LiLian.ins().postNobilityData,this.setLilianRedPoint),this.observe(TaskCT.ins().postTaskChangeData,this.setLilianRedPoint),this.observe(Artifact.ins().postNewArtifactUpdate,this.setLilianRedPoint),this.observe(Artifact.ins().postNewArtifactInit,this.setLilianRedPoint),this.observe(BookRedPoint.ins().postRedPoint,this.setLilianRedPoint),this.observe(Actor.ins().postLevelChange,this.setLilianRedPoint),this.observe(LiLian.ins().postJadeLv,this.setLilianRedPoint),this.observe(BagCT.ins().postItemChange,this.setLilianRedPoint),this.observe(SkillCT.ins().postHejiRemove,this.resetHejiCd),this.observe(SkillCT.ins().postHejiStartCD,this.resetHejiCd),this.observe(SkillCT.ins().postHejiUpdate,this.checkHejiOpen),this.observe(LiLian.ins().postGetLilianReward,this.lilianRewardFlash),this.observe(Guild.ins().postGuildCreate,this.setRedPiont),this.observe(Guild.ins().postProcessJoin,this.setRedPiont),this.observe(GameLogic.ins().postFlyItem,this.flyItemToBag),this.observe(GameLogic.ins().postFlyItemEx,this.flyItemToBagEx),this.observe(Recharge.ins().postRecharge1Data,this.setRedPiont),this.observe(BagCT.ins().postItemAdd,this.setRedPiont),this.observe(BagCT.ins().postItemDel,this.setRedPiont),this.observe(BagCT.ins().postItemChange,this.setRedPiont),this.observe(OtherCT.ins().postYBCardTime,this.upBagTips),this.observe(GameLogic.ins().postEnterMap,this.cleanPowerGuilderEff),this.hpBall.playFile(RES_DIR_EFF+"HpEff1",-1),this.mpBall.playFile(RES_DIR_EFF+"MpEff1",-1),this.hPGroup.addChild(this.hpBall),this.hPGroup.addChild(this.mpBall),this.powerGroup.addChildAt(this.circleImg,1),this.checkHejiOpen(),SkillCT.ins().hejiLevel>0&&SkillCT.ins().postHejiStartCD(),this.startUpdateRedPoint(),this.showForgingBtnRedPoint(),this.upBagTips(),this.setExp()},e.prototype.checkHejiOpen=function(){SkillCT.ins().hejiLevel>0?(this.powerGroup.touchEnabled=!1,this.circleImg.playFile(RES_DIR_EFF+"HeJiEff1",-1),this.powerImg.visible=!0,this.lockImg.visible=!1,this.powerImg.source=SkillCT.ins().getHejiSkillIdIcon(),this.powerImg.scaleX=.7,this.powerImg.scaleY=.7):(this.powerGroup.touchEnabled=!1,this.powerImg.visible=!1,this.lockImg.visible=!0)},e.prototype.checkViewOpen=function(t){void 0===t&&(t=0),1==t?(this.backBtnGroup.visible=!0,this.powerGroup.visible=!1,this.backMc.parent||(this.backMc.playFile(RES_DIR_EFF+"ReturnEff",-1),this.backBtnGroup.addChild(this.backMc))):(this.backBtnGroup.visible=!1,this.powerGroup.visible=!0,DisplayUtils.removeFromParent(this.backMc)),this.checkShowHejiIcon(t)},e.prototype.checkShowHejiIcon=function(t){2==Artifact.ins().openHeji&&(0==t?Timer.start(50,1,this.showHejiIcon,this):Timer.stop(this.showHejiIcon,this))},e.prototype.showHejiIcon=function(){if(2==Artifact.ins().openHeji&&SkillCT.ins().hejiLevel>0){var t=SubRoles.ins().getSubRoleByIndex(0);if(!t)return;Artifact.ins().openHeji=-1;var e=t.job,i=GlobalConfig.TogetherHitConfig[SkillCT.ins().hejiLevel],n=new SkillData(i.skill_id[e-1]),s=new eui.Image(n.id+"_png");s.anchorOffsetX=32,s.anchorOffsetY=32,s.scaleX=4,s.scaleY=4,s.x=this.width/2,s.y=this.height/2,this.addChild(s);var o=this.powerGroup.x+this.powerGroup.width/2,a=this.powerGroup.y+this.powerGroup.height/2;egret.Tween.get(s).to({scaleX:1,scaleY:1},200).to({x:o,y:a},600).to({scaleX:0,scaleY:0},200).call(function(){s.parent.removeChild(s)})}},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.showRoleBtnRedPoint=function(t){this.roleBtn.redPoint.visible=t>0},e.prototype.showBagBtnRedPoint=function(t){this.isItemCountChange=t>0,this.setRedPiont()},e.prototype.showForgingBtnRedPoint=function(){this.forgingBtn.redPoint.visible=ForgeRedPoint.ins().redPoint},e.prototype.setLilianRedPoint=function(){var t=LiLian.ins(),e=LiLian.ins().getNobilityIsMaxLevel();this.taskBtn.redPoint.visible=t.getLilianShenGongStast()||t.isGetTrainDayAwardAll()||Artifact.ins().showRedPoint()||t.checkXunZhangOpen()&&t.getNobilityIsUpGrade()&&!e||Artifact.ins().showRedPoint()||BookRedPoint.ins().redpoint||t.checkJadeRed()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:SoundUtil.play(SoundEnum.WINDOW);var e=ViewManager.ins().getView(RoleWin);if(e&&e.getWingPanelInfo())e.doOpenHintWin(2);else{var i=ViewManager.ins().getView(Recharge1Win);i&&TipsCT.goodsId&&ViewManager.ins().open(BuyWin,TipsCT.goodsId);var n=RareAnimalCT.ins();n.isBackShow&&(n.isBackShow=!1,ViewManager.ins().open(RareAnimalResultWin,n.fbType,n.attackTimes,n.teamInfo)),ViewManager.ins().closeLastTopView()||win.closeLast()}break;case this.lockImg:TipsCT.ins().showTips("闯关达到"+SkillCT.ACTIVE_LEVEL+"开启合击");break;case this.powerImg:case this.powerGroup:if(SkillCT.ins().hejiLevel<=0)return;if(!this.hjMc||!this.hjMc.parent)return void TipsCT.ins().showTips("怒气未满，无法释放合击");var s=this.useHejiSkill();-1==s?TipsCT.ins().showTips("释放距离过远，无法释放"):-2==s?TipsCT.ins().showTips("请先选择攻击目标"):-3==s&&TipsCT.ins().showTips("麻痹状态中，无法释放");break;default:var o=this.navBtn.indexOf(t.currentTarget);if(this.navBtn[o].selected){var a=this.openWindow(o);a||(this.navBtn[o].selected=!1)}else this.closeWindow(o);for(var r=0;r<this.navBtn.length;r++)o!=r&&this.closeWindow(r)}},e.prototype.useHejiSkill=function(){if(SkillCT.ins().hejiEnable&&this.canClick){var t=SkillCT.ins().getHejiSkillId(),e=SubRoles.lookAtTar;if(!e)return;var i=EntityManager.ins().screeningTargetByPos(e,!1,t.affectCount,t.castRange);if(!i||0==i.length)return-1;if(GameMap.fbType==FbCT.FB_TYPE_GUILD_WAR||GameMap.fbType==FbCT.FB_TYPE_ZHUANSHENGBOSS||GameMap.fbType==FbCT.FB_TYPE_ALLHUMENBOSS||GameMap.fbType==FbCT.FB_TYPE_HOMEBOSS||CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||KfArenaSys.ins().isKFArena||KFBossSys.ins().isKFBossBattle){var n=GameLogic.ins().currHandle,s=EntityManager.ins().getEntityByHandle(n);if(!n||!s||s.infoModel.getAtt(AttributeType.atHp)<=0||s.infoModel.type==EntityType.CollectionMonst)return-2}if(this.canClick=!1,Timer.start(50,1,this.setClickDelay,this),0==GameMap.fubenID||GameMap.sceneInMine())SkillCT.ins().fieldUse=!0;else{for(var o=SubRoles.ins().subRolesLen,a=void 0,r=!1,l=0;o>l&&(a=EntityManager.ins().getMainRole(l),!(a&&a.infoModel&&a.infoModel.getAtt(AttributeType.atHp)>0));l++);if(!a)return;if(a.hasEffById(1)&&(r=!0),r||a.hasBuff(51001)||a.hasBuff(14001)||a.hasBuff(70001))return-3;SkillCT.ins().sendUseHejiSkill()}}this.cleanPowerGuilderEff()},e.prototype.setClickDelay=function(){this.canClick=!0},e.prototype.openWindow=function(t){return KFServerSys.ins().checkIsKFBattle("跨服战场内，无法操作!")?void 0:ViewManager.ins().open(this.navBind[t])},e.prototype.closeWindow=function(t){ViewManager.ins().close(this.navBind[t])},e.prototype.setExp=function(){this.expBar.maximum=GlobalConfig.ExpConfig[Actor.level]?GlobalConfig.ExpConfig[Actor.level].exp:0,this.expBar.value=Actor.exp?Actor.exp:0},e.prototype.expChange=function(t){var e=this;if(void 0===t&&(t=!1),t||GameMap.fbType!=FbCT.FB_TYPE_GUANQIABOSS&&GameMap.fbType!=FbCT.FB_TYPE_TIAOZHAN){this.lastLevel||(this.lastLevel=Actor.level),this.flyExpLevel.length?(this.flyExpLevel[this.flyExpLevel.length-1][0]=Actor.level,this.flyExpLevel[this.flyExpLevel.length-1][1]=Actor.exp):this.flyExpLevel.push([Actor.level,Actor.exp]);var i=this.flyExpLevel[0][0],n=this.flyExpLevel[0][1];if(this.lastLevel<i){var s=GlobalConfig.ExpConfig[this.lastLevel].exp;egret.Tween.removeTweens(this.expBar);var o=egret.Tween.get(this.expBar);o.to({value:this.expBar.maximum},300).wait(100).call(function(){e.expBar.maximum=s,e.expBar.value=0,e.lastLevel+=1,GameLogic.ins().postLevelBarChange(e.lastLevel),SoundUtil.play(SoundEnum.LEVEL_UP),e.expChange()},this)}else{egret.Tween.removeTweens(this.expBar);var a=GlobalConfig.ExpConfig[i].exp;this.expBar.maximum!=a&&(this.expBar.maximum=a);var o=egret.Tween.get(this.expBar);o.to({value:n},400),this.flyExpLevel.shift()}}},e.prototype.closeNav=function(t){this.navBtn[t].selected=!1},e.prototype.onBossAppear=function(){GameMap.fbType!=FbCT.FB_TYPE_HUN_SHOU&&GameMap.fbType!=FbCT.FB_TYPE_GUILD_WAR&&GameMap.fbType!=FbCT.FB_TYPE_XMHJ&&GameMap.fbType!=FbCT.FB_TYPE_SOULS&&GameMap.fbType!=FbCT.FB_TYPE_SPIRIT&&GameMap.fbType!=FbCT.FB_TYPE_Legend&&this.showEffectTips("zdbossskin_json.bosstishi")},e.prototype.onMonsterSpeak=function(t){this.showEffectTips(t)},e.prototype.onFightResult=function(t){t?this.showEffectTips("pktishi_png"):this.showEffectTips("pktishi1_png")},e.prototype.showEffectTips=function(t){var e=this;this.tips.source=t,egret.Tween.removeTweens(this.tips),this.tips.visible=!0,this.tips.alpha=1,this.tips.touchEnabled=!1,egret.Tween.get(this.tips).wait(4e3).to({alpha:0},1e3).call(function(){e.tips.visible=!1})},e.prototype.readyUpdateHp=function(t){if(t){if(t instanceof EntityModel){if(!t.isMy)return}else if(!t[0].isMy)return;this.updateHp()}},e.prototype.updateHp=function(){for(var t=SubRoles.ins().subRolesLen,e=0,i=0,n=0;t>n;n++){var s=SubRoles.ins().getSubRoleByIndex(n);if(s){var o=s.getAtt(AttributeType.atHp)||0,a=s.getAtt(AttributeType.atMaxHp)||0;e+=o,i+=a}}e>i&&(e=i),this.hpBall.drawRect(e/i)},e.prototype.updateHuShen=function(t){if(!t||t.team==Team.My){for(var e=SubRoles.ins().subRolesLen,i=0,n=0,s=0;e>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s);i+=o.getAtt(AttributeType.atMp),n+=o.getAtt(AttributeType.atMaxMp)}i>n&&(i=n),this.mpBall.drawRect(i/n)}},e.prototype.runItem=function(){var t=TaskCT.ins(),e=t.taskTrace,i=t.getAchieveConfById(e.id).awardList;i&&this.runStrat(i,0)},e.prototype.runStrat=function(t,e){var i=this,n="";if(0==t[e].type)switch(t[e].id){case MoneyConst.exp:n="";break;case MoneyConst.gold:n="icgoods117_png";break;case MoneyConst.yuanbao:n="icgoods121_png"}else n=GlobalConfig.ItemConfig[t[e].id].icon+"_png";this.taskItemImg.visible=!0,this.taskItemImg.source=n;var s=this;this.tweenTaskObj||(this.tweenTaskObj={get factor(){return 0},set factor(t){s.taskItemImg.x=(1-t)*(1-t)*250+2*t*(1-t)*380+t*t*426,s.taskItemImg.y=(1-t)*(1-t)*730+2*t*(1-t)*630+t*t*820}}),egret.Tween.removeTweens(this.tweenTaskObj);var o=egret.Tween.get(this.tweenTaskObj);o.to({factor:1},400).call(function(){if(i.taskItemImg.visible=!1,t.length>++e){var n=SubRoles.ins().getSubRoleByIndex(0);t[e].job?t[e].job==n.job&&i.runStrat(t,e):i.runStrat(t,e)}},this)},e.prototype.setBagTips=function(t){return this.bagBtn.visible?(this.groupBagTips.visible=t>0,void(t&&(2==t?this.tipsText.text="有装备可以"+GlobalConfig.ClientGlobalConfig.smeltBtn:this.tipsText.text="背包将满，请熔炼"))):void(this.groupBagTips.visible=!1)},e.prototype.setIsExitUsedItem=function(){this.isExitUsedItem=BagCT.ins().getIsExitUsedItem(),this.setRedPiont()},e.prototype.setRedPiont=function(t){return t?void(this.bagBtn.redPoint.visible=t):void(this.bagBtn.redPoint.visible=this.isExitUsedItem||this.isItemCountChange||BagCT.ins().getBagGoodsCountByType()||BagCT.ins().getRuneBagGoodsCountByType()||MergeCC.ins().isOpen()&&MergeCC.ins().redPoint())},e.prototype.resetHejiCd=function(){this.reset(),DisplayUtils.removeFromParent(this.hjMc),Timer.has(this.showAni,this)||Timer.start(500,0,this.showAni,this),this.drawProgress(0)},e.prototype.reset=function(){this._curAngle=0,this._toAngle=0,this._oldAngle=360,SkillCT.ins().hejiEnable=!1,SkillCT.ins().fieldUse=!1,this.radius=this.powerGroup.width>>1},e.prototype.showAni=function(){var t=SkillCT.ins().getHejiSkillId(),e=1-(SkillCT.ins().hejiCD-GameServer.serverTime)/(t.cd-SkillCT.ins().reduceCD),i=360*e;this.drawProgress(i)},e.prototype.drawProgress=function(t){var e=this;return t>360&&(t=360),0>t&&(t=0),0==t||360==this.curAngle?(360==this.curAngle&&(SkillCT.ins().hejiEnable=!0,this.addAutoUse(),this.addPowerEff()),void egret.Tween.removeTweens(this)):(this.removeAutoUse(),this._toAngle=t,egret.Tween.removeTweens(this),void egret.Tween.get(this).to({curAngle:this._toAngle},500).call(function(){360==e.curAngle&&(SkillCT.ins().hejiEnable=!0,e.addAutoUse())},this))},e.prototype.addPowerEff=function(){this.hjMc&&this.hjMc.parent||(this.hjMc.playFile(RES_DIR_EFF+"HeJiEff2",-1),this.powerGroup.addChild(this.hjMc),this.powerGuilderEff())},e.prototype.powerGuilderEff=function(){var t=this;return FbCT.ins().guanqiaID>13?void this.cleanPowerGuilderEff():FbCT.ins().pkGqboss?void(this.arrow||(this.arrow=new GuideArrow,this.arrow.touchEnabled=!1,this.arrow.lab.text="点击释放合击",this.addChild(this.arrow),this.arrow.bottom=0,this.arrow.horizontalCenter=330,this.eff||(this.eff=new MovieClip,this.eff.playFile(RES_DIR_EFF+"NoviceEff",-1),this.powerGroup.addChild(this.eff),this.eff.x=this.powerGroup.width/2,this.eff.y=this.powerGroup.height/2),egret.Tween.get(this.arrow,{loop:!0}).to({horizontalCenter:370},1e3).to({horizontalCenter:330},1e3),egret.Tween.get(this.powerGroup,{loop:!1}).wait(5e3).call(function(){t.cleanPowerGuilderEff()}))):void this.cleanPowerGuilderEff()},e.prototype.cleanPowerGuilderEff=function(){this.arrow&&egret.Tween.removeTweens(this.arrow),this.eff&&egret.Tween.removeTweens(this.eff),DisplayUtils.removeFromParent(this.arrow),DisplayUtils.removeFromParent(this.eff),this.removeAutoUse(),this.arrow=null,this.eff=null},e.prototype.addAutoUse=function(){SkillCT.ins().hejiEnable&&this.checkIsAutoUse()&&(Timer.has(this.autoUseHeji,this)||Timer.start(400,0,this.autoUseHeji,this))},e.prototype.checkIsAutoUse=function(){if(GameMap.autoPunch()){var t=GameLogic.ins().currHandle,e=void 0;if(t)e=EntityManager.ins().getEntityByHandle(t);else{var i=SubRoles.lookAtTar;if(!i)return;var n=RoleAI.ins().curTarget;e=n[i.infoModel.handle]}return e&&e.infoModel.type!=EntityType.CollectionMonst?Setting.ins().getValue(ClientSet.autoHeji):!1}return Setting.ins().getValue(ClientSet.autoHeji)&&GameMap.fbType!=FbCT.FB_TYPE_HOMEBOSS&&GameMap.fbType!=FbCT.FB_TYPE_NEW_WORLD_BOSS&&GameMap.fbType!=FbCT.FB_TYPE_ALLHUMENBOSS&&GameMap.fbType!=FbCT.FB_TYPE_ZHUANSHENGBOSS&&GameMap.fbType!=FbCT.FB_TYPE_GUILD_WAR&&GameMap.fbType!=FbCT.FB_TYPE_PEAKED&&GameMap.fbType!=FbCT.FB_TYPE_KF_BOSS&&GameMap.fbType!=FbCT.FB_TYPE_KF_BOSS2&&!CityCC.ins().isCity&&!BattleCC.ins().isBattle()&&!PaoDianCC.ins().isPaoDian&&!GwBoss.ins().isGwBoss&&!GwBoss.ins().isGwTopBoss&&!DarkMjBoss.ins().isDarkBoss},e.prototype.removeAutoUse=function(){Timer.stop(this.autoUseHeji,this)},e.prototype.autoUseHeji=function(){this.useHejiSkill()},Object.defineProperty(e.prototype,"curAngle",{get:function(){return this._curAngle},set:function(t){this._curAngle=t,this.circleImg.drawAngle(t)},enumerable:!0,configurable:!0}),e.prototype.getToggleBtn=function(t){return this.validateNow(),this.navBtn[t]},e.prototype.lilianRewardFlash=function(t){for(var e=this,i=t.length,n=function(i){var n=new eui.Image;n.source=t[i],n.x=74+91*i,n.y=260,e.addChild(n),n.visible=!1,n.scaleX=n.scaleY=1;var s=egret.Tween.get(n);s.wait(130*i).to({visible:!0},1).to({x:441,y:872,scaleX:.6,scaleY:.6},900).call(function(){e.removeChild(n)})},s=0;i>s;s++)n(s)},e.prototype.startUpdateRedPoint=function(){Timer.has(this.updateRedPoint,this)||Timer.start(50,1,this.updateRedPoint,this)},e.prototype.updateRedPoint=function(){var t=!1;(!t&&this.and(SkillCT.ins().canGrewupSkill())||SkillCT.ins().checkAllTupo()||SkillCT.ins().checkHechengRed())&&(t=!0),!t&&SkillCT.ins().canHejiEquip()&&(t=!0),!t&&SkillCT.ins().canExchange()&&(t=!0),!t&&SkillCT.ins().canSolve()&&(t=!0),FbCT.ins().guanqiaID>2&&this.and(SkillCT.ins().canGrewupSkill())&&(t=!0),t||(t=MijiCT.ins().isMjiSum()),t||(t=ZhanLing.ins().checkRedPoint()),t||(t=this.jingMaiCanUp()),this.furnaceBtn.redPoint.visible=t},e.prototype.jingMaiCanUp=function(){var t;for(var e in SubRoles.ins().roles)if(t=SubRoles.ins().roles[e].jingMaiData,t.jingMaiCanUp()){var i=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level>=i)return!0}return!1},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.getBagBtn=function(){return this.bagBtn},e.prototype.flyGQBossExpToBar=function(t){var e=this,i=(t[0],t[1]);if(!(GameMap.fbType||i>0)){var n=new eui.Image;n.source="point2",n.anchorOffsetX=20,n.anchorOffsetY=20,n.x=100,n.y=100,this.addChild(n);var s=Math.ceil(StageUtils.ins().getWidth()/2),o=Math.ceil(StageUtils.ins().getHeight())+60,a=egret.Tween.get(n);a.to({x:s,y:o,alpha:.5},800).call(function(){e.removeChild(n),egret.Tween.removeTweens(n)},this);var r=egret.Tween.get(n,{loop:!0});r.to({rotation:n.rotation+360},800)}},e.prototype.flyExpToBar=function(t){for(var e=this,i=t[0],n=t[1],s=t[2],o=this.globalToLocal(i.x,i.y),a=this.expBar.x+this.expBar.width/2,r=this.expBar.y,l=new egret.Point(a,r),h=function(t){var i=egret.Point.interpolate(o,l,MathUtils.limit(.2,.8));i.x+=MathUtils.limitInteger(-120,120),i.y+=MathUtils.limitInteger(-120,120);var n=new eui.Image;n.source="point2",n.anchorOffsetX=20,n.anchorOffsetY=20,n.x=o.x,n.y=o.y,u.addChild(n);var a=Bezier.pop(o,l);a.display=n,a.centerPoint=i,a.start(1e3,function(){Bezier.push(a),e.removeChild(n),egret.Tween.removeTweens(n),t||e.expChange(!0)},u,t*s),egret.Tween.get(n).to({alpha:.5},1e3);var r=egret.Tween.get(n,{loop:!0});r.to({rotation:n.rotation+360},500)},u=this,p=0;n>p;p++)h(p)},e.prototype.flyItemToBag=function(t){var e=t.item,i=t.gp;if(ViewManager.ins().hasTopView()){var n=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2,this.bagBtn.y+this.bagBtn.height/2);e.reset(),e.setItemParent(this),e.x=i.x,e.y=i.y,egret.Tween.get(e).to({x:n.x,y:n.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(e),e.destruct(),ObjectPool.push(e)})}},e.prototype.flyItemToBagEx=function(t){if(t.parent){var e=t.parent.localToGlobal(t.x,t.y),i=this.bagBtn.parent.localToGlobal(this.bagBtn.x+this.bagBtn.width/2-t.width/4,this.bagBtn.y+this.bagBtn.height/2-t.width/4);DisplayUtils.removeFromParent(t),t.x=e.x,t.y=e.y,this.addChild(t),egret.Tween.get(t).to({x:i.x,y:i.y},1700,egret.Ease.sineOut).call(function(){DisplayUtils.removeFromParent(t)})}else DisplayUtils.removeFromParent(t)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.isHideNavBtn=function(t){for(var e=0,i=this.navBtn;e<i.length;e++){var n=i[e];n.visible=t}this.expBar.visible=t},e.prototype.upBagTips=function(){this.eBagTips.visible=OtherCT.ins().hasDouble},e.NAV_ROLE=0,e.NAV_SKILL=1,e.NAV_LILIAN=2,e.NAV_SMITH=3,e.NAV_BAG=4,__decorate([callLater],e.prototype,"setLilianRedPoint",null),__decorate([callLater],e.prototype,"updateHp",null),e}(BaseEuiView);__reflect(UIView2.prototype,"UIView2"),ViewManager.ins().reg(UIView2,LayerManager.UI_Popup),window.UIView2=UIView2;var GodWeaponCC=function(t){function e(){var e=t.call(this)||this;return e.curExp=0,e._firstExp=!0,e.weaponDataAry=[],e._isFirst=!1,e.exattrDesObj={43:"施放刺杀剑法附加吸血效果，恢复%s%%伤害值的生命",48:"白虎会吸收其他角色的亡魂，每死亡一个角色，其伤害提高%s%%",44:"攻击时有几率触发武神之怒效果",45:"攻击时有几率触发武神之怒效果",46:"攻击时有几率触发武神之怒效果",47:"白虎攻击时有10%机率狂暴，增加自身%s%%攻击力并且必暴击，持续3秒"},e.sysId=PackageID.GodWeapon,e.gwTask=new GwTaskData,e.regNetMsg(1,e.postUpdateExp),e.regNetMsg(2,e.postUpdateInfo),e.regNetMsg(6,e.postFubenInfo),e.regNetMsg(9,e.postRankInfo),e.regNetMsg(13,e.doGetAward),e.regNetMsg(10,e.postGwTask),e.regNetMsg(15,e.postSweepGw),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.createData=function(){0==this._isFirst&&(this.initData(),this._isFirst=!0)},e.prototype.initData=function(){this.maxSkillIdAry=[],this.weaponDataAry=[],this.allSkillData={},this.allSkillData2={},this.allGodItemData={};for(var t in GlobalConfig.GodWeaponLineConfig){var e={},i={},n=GlobalConfig.GodWeaponLineConfig[t];this.allSkillData[t]=e,this.allSkillData2[t]=i;var s=0;for(var o in n){var a=new GwSkillData;a.skillId=parseInt(o),a.skillLv=0,a.config=n[o],a.weaponId=parseInt(t),i[a.skillId]=a,e[a.config.skinId]=a,s++}this.maxSkillIdAry.push(s);for(var r=[],l=0;l<GlobalConfig.GodWeaponBaseConfig.weaponItemCount;l++){var h=new GwItem;h.pos=l+1,h.itemId=void 0,h.config=null,h.weaponId=parseInt(t),r.push(h)}this.allGodItemData[t]=r}this.gwSkillConfig={};for(var t in GlobalConfig.GWSkillReviseConfig){var n=GlobalConfig.GWSkillReviseConfig[t];this.gwSkillConfig[n.skill]||(this.gwSkillConfig[n.skill]={}),this.gwSkillConfig[n.skill][n.gwIndex]=n}},e.prototype.godWeaponIsOpen=function(){return ZsCT.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay},e.prototype.getReviseBySkill=function(t){if(!this.allSkillData2)return null;var e=(""+t).charAt(0),i=this.allSkillData2[e];if(!i)return null;var n=Math.floor(t/1e3),s=[];for(var o in i){var a=i[o];if(a.config.skill==n){if(0==a.skillLv)continue;var r=a.skillLv+a.addLv,l=1e3*a.skillId+r;this.gwSkillConfig[n]&&this.gwSkillConfig[n][l]&&s.push(this.gwSkillConfig[n][l])}}return s},e.prototype.getJobGWNewSkill=function(t){if(!this.allSkillData2)return null;var e=this.allSkillData2[t];if(!e)return null;var i=SubRoles.ins().getSubRoleByJob(t);if(!i)return null;i.godWeaponSkills||(i.godWeaponSkills=[]);var n=0;for(var s in e){var o=e[s];if(o.config.newskill||o.config.passiveskill){var a=o.config.newskill||o.config.passiveskill,r=1e3*a+(o.skillLv+o.addLv);i.godWeaponSkills[n]=i.godWeaponSkills[n]||new SkillData(r),i.godWeaponSkills[n].configID=r,n+=1}}return i.godWeaponSkills},e.prototype.getWeaponSkinIdData=function(t,e){return this.allSkillData[t][e]},e.prototype.getWeaponSkillidData=function(t,e){return this.allSkillData2[t][e]},e.prototype.getGodItemData=function(t,e){return this.allGodItemData[t][e-1]},e.prototype.postUpdateExp=function(t){var e=this.curExp;this.curExp=t.readInt(),this._firstExp||this.curExp-e>0&&TipsCT.ins().showTips("|C:0xffd93f&T:神兵经验  +"+(this.curExp-e)+"|"),this._firstExp=!1},e.prototype.postUpdateInfo=function(t){this.createData();for(var e,i=t.readInt(),n=0;i>n;n++)this.weaponDataAry[n]?(e=this.weaponDataAry[n],e.parse(t)):(e=new GodWeaponData(t),this.weaponDataAry.push(e))},e.prototype.getWeaponData=function(t){if(this.weaponDataAry)for(var e=0,i=this.weaponDataAry;e<i.length;e++){var n=i[e];if(n.weaponId==t)return n}return null},e.prototype.checkNewskillOpen=function(t,e){if(this.weaponDataAry)for(var i=0,n=this.weaponDataAry;i<n.length;i++){var s=n[i];if(s.weaponId==t)for(var o=s.openSkillAry,a=0,r=o;a<r.length;a++){var l=r[a];if(l.config.newskill&&l.config.newskill==e)return l.isOpen}}return!1},e.prototype.checkSkillOpen=function(t,e){var i=this.getWeaponSkillidData(t,e);return i.skillLv>0||i.addLv>0||i.isOpen?!0:!1},e.prototype.upSkill=function(t,e){var i=this.getBytes(3);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.inlayItem=function(t,e,i){var n=this.getBytes(4);n.writeInt(t),n.writeInt(e),n.writeInt(i),this.sendToServer(n)},e.prototype.upWeapon=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.hadRedPoint=function(){this.createData();var t=!1;if(GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay)return t;if(GodWeaponRedPoint.ins().gwTaskRed)t=!0;else for(var e=0;e<this.weaponDataAry.length;e++)if(this.weaponDataAry[e]&&1==this.weaponDataAry[e].hasRedPoint||this.getSwRedPoint(this.weaponDataAry[e].weaponId)){t=!0;break}return t=t||this.mijintHadRedPoint()||this.maxLvRedPoint()},e.prototype.maxLvRedPoint=function(){if(!this.weaponDataAry)return!1;var t=this.weaponDataAry.concat();t.sort(function(t,e){return t.curLv-e.curLv});var i=t[t.length-1];return i&&i.config&&e.ins().curExp>=2*i.config.everyExp?!0:!1},e.prototype.mijintHadRedPoint=function(){return this.godWeaponIsOpen()&&this.fubenInfoData&&this.fubenInfoData.hadChallengeNum>0?!0:!1},e.prototype.getSwRedPoint=function(t){for(var e,i=this.allGodItemData[t],n=0;n<i.length;n++)if(e=i[n],e.isOpen&&!e.itemId&&GwShengWuChooseView.getGwItemType(e).length>0)return!0;return!1},e.prototype.gwAddAttr=function(t){var e=this.getWeaponData(t+1);if(!e)return[];for(var i,n=e.addAttr.concat(),s=0;s<this.maxSkillIdAry[t];s++)if(i=this.getWeaponSkillidData(t+1,s+1),i.skillLv+i.addLv>0&&i.config.attr)for(var o=0,a=i.config.attr;o<a.length;o++){var r=a[o],l={value:0,type:0};l.value=r.value*(i.skillLv+i.addLv),l.type=r.type,n.push(l)}for(var h=this.allGodItemData[t+1],u=0,p=h;u<p.length;u++){var c=p[u];if(c.itemId)for(var d=0,g=c.config.attr;d<g.length;d++){var r=g[d],l={value:0,type:0};l.value=r.value,l.type=r.type,n.push(l)}}for(var f=[],v=0,y=n;v<y.length;v++){for(var l=y[v],m=!1,T=0,C=f;T<C.length;T++){var b=C[T];if(b.type==l.type){b.value+=l.value,m=!1;break}m=!0}if(1==m||0==f.length){var r={value:l.value,type:l.type};f.push(r)}}return f},e.prototype.postFubenInfo=function(t){this.fubenInfoData||(this.fubenInfoData=new GwFubenData),this.fubenInfoData.parse(t)},e.prototype.postRankInfo=function(t){this.rankInfoDataAry||(this.rankInfoDataAry=[]);for(var e,i=t.readInt(),n=0;i>n;n++)e=this.rankInfoDataAry[n],e||(e=new GwRankInfoData,this.rankInfoDataAry[n]=e),e.parse(t);this.rankInfoDataAry.sort(this.sortFun)},e.prototype.sortFun=function(t,e){return t.rank-e.rank},e.prototype.postGwTask=function(t){this.gwTask.parser(t)},e.prototype.requestFubenInfo=function(){var t=this.getBytes(6);this.sendToServer(t)},e.prototype.joinFuben=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.buybuff=function(t){var e=this.getBytes(8);e.writeInt(t),this.sendToServer(e)},e.prototype.requestRanInfo=function(){var t=this.getBytes(9);this.sendToServer(t)},e.prototype.doGetAward=function(t){var e=t.readByte(),i=t.readByte();ViewManager.gamescene&&(ViewManager.gamescene.removeMiingTimeFun(),ViewManager.gamescene.setMJPingfen(i)),e?ViewManager.ins().open(GwResultView,GameMap.fubenID,i,FbCT.ins().mijingUseTime):ViewManager.ins().open(GwResultView,GameMap.fubenID,4)},e.prototype.requestGetAward=function(){var t=this.getBytes(13);this.sendToServer(t)},e.prototype.requestReceiveTask=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.requestActiveWeapon=function(){this.sendBaseProto(12)},e.prototype.getPinfenTime=function(t){var e;if(!this._timeMijinAry){this._timeMijinAry=[];for(var i in GlobalConfig.GodWeaponBaseConfig.fbGrade)e?(this._timeMijinAry.push(GlobalConfig.GodWeaponBaseConfig.fbGrade[i]-e),e=GlobalConfig.GodWeaponBaseConfig.fbGrade[i]):(e=GlobalConfig.GodWeaponBaseConfig.fbGrade[i],this._timeMijinAry.push(e))}return this._timeMijinAry[t]},e.prototype.weaponIsActive=function(t){if(this.createData(),this.weaponDataAry)for(var e=0,i=this.weaponDataAry;e<i.length;e++){var n=i[e];if(n.weaponId==t)return!0}return!1},e.prototype.taskIsOpen=function(){return GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:!1},e.prototype.sendReset=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.sendSweepGW=function(){var t=this.getBytes(15);this.sendToServer(t)},e.prototype.postSweepGw=function(t){var e=t.readByte(),i=GlobalConfig.GodWeaponFubenConfig[e].fbId;ViewManager.ins().open(GwResultView,i,1,null,e)},__decorate([post()],e.prototype,"postUpdateExp",null),__decorate([post()],e.prototype,"postUpdateInfo",null),__decorate([post()],e.prototype,"postFubenInfo",null),__decorate([post()],e.prototype,"postRankInfo",null),__decorate([post()],e.prototype,"postGwTask",null),__decorate([post()],e.prototype,"postSweepGw",null),e}(BaseSystem);__reflect(GodWeaponCC.prototype,"GodWeaponCC"),System.GodWeaponCC=function(){return GodWeaponCC.ins()},window.GodWeaponCC=GodWeaponCC;var GodWeaponItemCC=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.GodWeaponItem,e.regNetMsg(1,e.postCompound),e.regNetMsg(2,e.postFuse),e}return __extends(e,t),e.prototype.requestCompound=function(t,e,i){var n=this.getBytes(1);n.writeInt(t),n.writeInt(e),n.writeInt(i),this.sendToServer(n)},e.prototype.postCompound=function(t){var e=t.readBoolean(),i=(t.readShort(),t.readInt());return{id:i,isSuccess:e}},e.prototype.requestFuse=function(t,e,i){var n=this.getBytes(2);n.writeInt(t),n.writeInt(e),n.writeShort(i),this.sendToServer(n)},e.prototype.postFuse=function(t){var e=t.readBoolean(),i=0;if(e){t.readShort();i=t.readInt()}return{id:i,isSuccess:e}},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postCompound",null),__decorate([post()],e.prototype,"postFuse",null),e}(BaseSystem);__reflect(GodWeaponItemCC.prototype,"GodWeaponItemCC"),System.GodWeaponItemCC=function(){return GodWeaponItemCC.ins()},window.GodWeaponItemCC=GodWeaponItemCC;var GodWeaponData=function(){function t(t){this.parse(t)}return t.prototype.parse=function(t){if(this.weaponId=t.readInt(),this.curLv=t.readInt(),this.curExp=t.readInt(),this.skillPoint=t.readInt(),this.openCount=t.readInt(),this.openCount<=0&&this.openSkillAry&&this.openSkillAry.length>0)for(var e=this.openSkillAry.length,i=0;e>i;i++)this.openSkillAry[i].skillLv=0;this.openSkillAry=[];var n=GodWeaponCC.ins().allSkillData2[this.weaponId];for(var s in n)n[s].skillLv=0;for(var o,a,i=0;i<this.openCount;i++)a=t.readInt(),o=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,a),o.addLv=0,o.skillLv=t.readInt(),this.openSkillAry.push(o);for(var r in n)0==n[r].skillLv&&(n[r].addLv=0);this.inlayCount=t.readInt();for(var l,h,i=0;i<this.inlayCount;i++){h=t.readInt(),l=GodWeaponCC.ins().getGodItemData(this.weaponId,h),l.itemId=t.readInt();for(var u=0;u<l.config.skill.length;u++){var p=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,l.config.skill[u]);p.addLv+=1}}this.config=GlobalConfig.GodWeaponLevelConfig[this.curLv]},Object.defineProperty(t.prototype,"hasRedPoint",{get:function(){return this.skillPoint>0?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"addAttr",{get:function(){return null==this.config["attr"+this.weaponId]?[]:this.config["attr"+this.weaponId]},enumerable:!0,configurable:!0}),t.prototype.getResetPoint=function(){for(var t=this.openSkillAry?this.openSkillAry.length:0,e=0,i=0;t>i;i++)e+=this.openSkillAry[i].skillLv;return e},t.getWeaponName=function(t){switch(t){case 1:return"至尊屠龙刀";
case 2:return"赤血饮魔剑";case 3:return"逍遥无极扇"}return""},t}();__reflect(GodWeaponData.prototype,"GodWeaponData");var GwSkillData=function(){function t(t,e){this._skillLv=0,this.addLv=0,this.skillId=t,this.skillLv=e}return Object.defineProperty(t.prototype,"skillLv",{get:function(){return this._skillLv},set:function(t){this._skillLv=t},enumerable:!0,configurable:!0}),t.prototype.lvLabel=function(t){void 0===t&&(t=!1);var e,i=this._skillLv+this.addLv;return e=this.isOpen?this.config.upLevel+this.addLv:0!=this._skillLv?this.config.upLevel+this.addLv:this.addLv,t?""+i:i+"/"+e},Object.defineProperty(t.prototype,"skillPower",{get:function(){var t=this.config.exPower||0,e=this._skillLv+this.addLv;return t*e},enumerable:!0,configurable:!0}),t.prototype.addAttrValyeType=function(t){var e="";if(this.config.attr)for(var i=0;i<this.config.attr.length;i++)e.length>0&&(e+="\n"),e+=AttributeData.getAttrStrByType(this.config.attr[i].type)+"提升"+('<font color="#35E62D">'+this.config.attr[i].value*t+"</font>");return e},t.prototype.addExAttrstr=function(t){var e="";if(this.config.exattr)for(var i="",n="",s=0;s<this.config.exattr.length;s++){switch(e.length>0&&(e+="\n"),i=GodWeaponCC.ins().exattrDesObj[this.config.exattr[s].type],this.config.exattr[s].type){case 43:case 48:n='<font color="#35E62D">'+this.config.exattr[s].value*t/100+"</font>";break;case 44:case 45:case 46:n='<font color="#35E62D">'+(1+this.config.exattr[s].value*t/100)+"</font>";break;case 47:var o=GlobalConfig.EffectsConfig[100400+this.config.exattr[s].value*t];o&&o.args&&(n='<font color="#35E62D">'+100*o.args.a+"</font>")}i=i.replace("%s%",n),e+=i}return e},t.prototype.addatrStr=function(t){this._addStr="";var e=t+this.addLv;this._addStr+=this.addAttrValyeType(e),this._addStr+=this.addExAttrstr(e);var i,n;return this.config.newskill&&(i=1e3*this.config.newskill+e,n=new SkillData(i),this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=SkillUtil.getDesc(n.config)),this.config.passiveskill&&(i=1e3*this.config.passiveskill+e,n=new SkillData(i),this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=SkillUtil.getDesc(n.config)),this._addStr+=this.specialSkill(e),this._addStr},t.prototype.specialSkill=function(t){var e=t+this.addLv,i="";if(this.config.skill){var n=void 0,s=1e3*this.skillId+e;for(var o in GlobalConfig.GWSkillReviseConfig)if(n=GlobalConfig.GWSkillReviseConfig[o],n.skill==this.config.skill&&n.gwIndex==s){i=n.desc;break}}return i},Object.defineProperty(t.prototype,"isOpen",{get:function(){var t=!0;if(this.config.condition){for(var e in this.config.condition){var i=void 0;if(i=0==parseInt(e)?GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(e)+1):GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(e)),i.skillLv<this.config.condition[e]){t=!1;break}}return t}return t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openTip",{get:function(){if(!this._openTip)if(this._openTip="",this.skillId==GodWeaponCC.ins().maxSkillIdAry[this.weaponId-1])this._openTip="所有技能满级后解锁";else for(var t in this.config.condition){var e=void 0;e=0==parseInt(t)?GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(t)+1):GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,parseInt(t)),this._openTip.length>0&&(this._openTip+="\n"),this._openTip+=e.config.skillName+("达到"+this.config.condition[t]+"解锁")}return this._openTip},enumerable:!0,configurable:!0}),t}();__reflect(GwSkillData.prototype,"GwSkillData");var GwItem=function(){function t(){this.isCur=!1}return Object.defineProperty(t.prototype,"itemId",{get:function(){return this._itemId},set:function(t){this._itemId=t,this.config=GlobalConfig.GodweaponItemConfig[this.itemId],this.itemConfig=GlobalConfig.ItemConfig[this.itemId]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openLv",{get:function(){return GlobalConfig.GodWeaponBaseConfig.openLevel[this.pos-1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpen",{get:function(){var t=GodWeaponCC.ins().getWeaponData(this.weaponId);return t&&t.curLv<this.openLv?!1:!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"addatrStr",{get:function(){if(null==this._addStr){this._addStr="";for(var t=0;t<this.config.attr.length;t++)this._addStr.length>0&&(this._addStr+="\n"),this._addStr+=AttributeData.getAttrStrByType(this.config.attr[t].type)+" +"+this.config.attr[t].value}return this._addStr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillName",{get:function(){if(null==this._skillName){this._skillName="";for(var t=0;t<this.config.skill.length;t++)this._skillName.length>0&&(this._skillName+="、"),this._skillName+=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[t]).config.skillName}return this._skillName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillPower",{get:function(){if(!this._skillPower){this._skillPower=0;for(var t=void 0,e=0;e<this.config.skill.length;e++)if(t=GodWeaponCC.ins().getWeaponSkillidData(this.weaponId,this.config.skill[e]),t.config.exPower&&(this._skillPower+=t.config.exPower),t.config.attr){for(var i=[],n=0;n<t.config.attr.length;n++)i.push(new AttributeData(t.config.attr[n].type,t.config.attr[n].value));this._skillPower+=BagCT.getAttrPower(i)}}return this._skillPower},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"power",{get:function(){if(!this._power){this._power=0,this._power+=this.skillPower;for(var t=[],e=0;e<this.config.attr.length;e++)t.push(new AttributeData(this.config.attr[e].type,this.config.attr[e].value));this._power+=BagCT.getAttrPower(t)}return this._power},enumerable:!0,configurable:!0}),t}();__reflect(GwItem.prototype,"GwItem"),window.GodWeaponData=GodWeaponData;var GodweaponItemData=function(){function t(t,e,i){this.id=t,this.count=e,this.quality=i}return t}();__reflect(GodweaponItemData.prototype,"GodweaponItemData"),window.GodweaponItemData=GodweaponItemData;var GodweaponItemModel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){if(!this._qualityItemMap&&!this._jobItemMap){this._qualityItemMap={},this._jobItemMap={};for(var t in GlobalConfig.GodweaponItemConfig){var e=GlobalConfig.GodweaponItemConfig[t],i=GlobalConfig.ItemConfig[e.id],n=ItemUtil.getQuality(i);if(4>n){var s=this._qualityItemMap[n];void 0==s&&(s=[]),s.push(e.id),this._qualityItemMap[n]=s}else if(4==n&&(!e.skill||e.skill.length<=1)){var o=ItemUtil.getJob(i),a=this._jobItemMap[o];void 0==a&&(a=[]),a.push(e.id),this._jobItemMap[o]=a}}}},Object.defineProperty(e.prototype,"qualityItemMap",{get:function(){return this._qualityItemMap||this.init(),this._qualityItemMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jobItemMap",{get:function(){return this._jobItemMap||this.init(),this._jobItemMap},enumerable:!0,configurable:!0}),e.prototype.isCanCompound=function(){var t=!1,e=this.qualityItemMap;for(var i in e)if(parseInt(i)<4&&(t=this.checkNum(e[i])))return t;return t},e.prototype.checkNum=function(t){for(var e=t.length,i=0,n=0;e>n;n++)i+=BagCT.ins().getBagGoodsCountById(0,t[n]);return i>=3},e.prototype.getCompoundItemList=function(){var t={},e=!1,i=this.qualityItemMap;for(var n in i)e=this.checkNum(i[n]),e&&(t[n]=this.getItemList(i[n]));return t},e.prototype.filterCompoundItemList=function(t,e){var i=[];for(var n in e){var s=new GodweaponItemData(e[n].id,e[n].count,e[n].quality);s.quality==t.quality&&(s.id==t.id?s.count>1&&(s.count--,i.push(s)):i.push(s))}return i},e.prototype.toList=function(t){var e=[];for(var i in t)e=e.concat(t[i]);return e},e.prototype.getItemList=function(t){for(var e=t.length,i=[],n=0;e>n;n++){var s=t[n],o=BagCT.ins().getBagGoodsCountById(0,s),a=ItemUtil.getQuality(GlobalConfig.ItemConfig[s]);o>0&&i.push(new GodweaponItemData(s,o,a))}return i},e.prototype.isCanFuse=function(){var t=!1;return t},e.prototype.checkFuseNum=function(t){for(var e=0,i=0,n=0;n<t.length;n++)if(i=BagCT.ins().getBagGoodsCountById(0,t[n]),i>0&&(e++,e>1))return!0;return!1},e.prototype.getFuseItemList=function(){var t={},e=!1,i=this.jobItemMap;for(var n in i)e=this.checkFuseNum(i[n]),e&&(t[n]=this.getJobFuseItemList(i[n]));return t},e.prototype.getJobFuseItemList=function(t){for(var e=t.length,i=[],n=0;e>n;n++){var s=t[n],o=ItemUtil.getQuality(GlobalConfig.ItemConfig[s]),a=BagCT.ins().getBagGoodsCountById(0,t[n]);a>0&&i.push(new GodweaponItemData(s,a,o))}return i},e.prototype.filterFuseItemList=function(t,e){var i=[],n=ItemUtil.getJob(GlobalConfig.ItemConfig[t.id]);for(var s in e){var o=new GodweaponItemData(e[s].id,e[s].count,e[s].quality),a=ItemUtil.getJob(GlobalConfig.ItemConfig[o.id]);n==a&&t.id!=o.id&&i.push(o)}return i},e.prototype.getFuseTargetItem=function(t,e){var i=ItemUtil.getJob(GlobalConfig.ItemConfig[t]),n=4e5+1e4*i+Math.max(t,e)-Math.min(t,e)+100*(Math.min(t,e)%20);return n},e}(BaseClass);__reflect(GodweaponItemModel.prototype,"GodweaponItemModel"),window.GodweaponItemModel=GodweaponItemModel;var GodWeaponRedPoint=function(t){function e(){var e=t.call(this)||this;return e.gwTaskRed=!1,e.gwTaskRed1=!1,e.gwTaskRed2=!1,e.gwTaskRed3=!1,e.godWeaponRed=!1,e.gwMjRed=!1,e.gwSbRed=!1,e.gwSbRed1=!1,e.gwSbRed2=!1,e.gwSbRed3=!1,e.gwBossRp=!1,e.gwItem=!1,e.associated(e.postGodWeapon,e.postGwSb,e.postGwMj,e.postgGwBossRp,e.postGodWeaponItem),e.associated(e.postGwSb,e.postGwTab1,e.postGwTab2,e.postGwTab3),e.associated(e.postGwTask,GodWeaponCC.ins().postGwTask,GodWeaponCC.ins().postUpdateInfo,GameLogic.ins().postSubRoleChange),e.associated(e.postGwMj,GodWeaponCC.ins().postFubenInfo),e.associated(e.postGwTab1,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postGwTab2,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postGwTab3,e.postGwTask,GodWeaponCC.ins().postUpdateInfo,GodWeaponCC.ins().postUpdateExp),e.associated(e.postgGwBossRp,BossCT.ins().postWorldBoss,GodWeaponCC.ins().postUpdateInfo,BossCT.ins().postWorldNotice,BossCT.ins().postUpdateWorldPlayList,Actor.ins().postYbChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e.associated(e.postGodWeaponItem,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemCountChange),e}return __extends(e,t),e.prototype.postGodWeaponItem=function(){return!1},e.prototype.postGodWeapon=function(){var t=this.godWeaponRed;return this.godWeaponRed=this.gwSbRed||this.gwMjRed||this.gwItem||this.gwBossRp,t!=this.godWeaponRed},e.prototype.postGwSb=function(){var t=this.gwSbRed;return(this.gwSbRed=ZsCT.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay)?(this.gwSbRed=this.gwSbRed1||this.gwSbRed2||this.gwSbRed3,t!=this.gwSbRed):!1},e.prototype.postGwTab1=function(){var t=this.gwSbRed1;return this.gwTaskRed1?this.gwSbRed1=!0:GodWeaponCC.ins().getWeaponData(1)?(this.gwSbRed1=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(1).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(1),this.gwSbRed1||(this.gwSbRed1=GodWeaponCC.ins().weaponIsActive(1)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed1=!1,t!=this.gwSbRed1},e.prototype.postGwTab2=function(){var t=this.gwSbRed2;return this.gwTaskRed2?this.gwSbRed2=!0:GodWeaponCC.ins().getWeaponData(2)?(this.gwSbRed2=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(2).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(2),this.gwSbRed2||(this.gwSbRed2=GodWeaponCC.ins().weaponIsActive(2)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed2=!1,t!=this.gwSbRed2},e.prototype.postGwTab3=function(){var t=this.gwSbRed3;return this.gwTaskRed3?this.gwSbRed3=!0:GodWeaponCC.ins().getWeaponData(3)?(this.gwSbRed3=GodWeaponCC.ins().maxLvRedPoint()||GodWeaponCC.ins().getWeaponData(3).hasRedPoint||GodWeaponCC.ins().getSwRedPoint(3),this.gwSbRed3||(this.gwSbRed3=GodWeaponCC.ins().weaponIsActive(3)&&GodWeaponCC.ins().maxLvRedPoint())):this.gwSbRed3=!1,t!=this.gwSbRed3},e.prototype.postGwMj=function(){var t=this.gwMjRed;return this.gwMjRed=GodWeaponCC.ins().mijintHadRedPoint(),t!=this.gwMjRed},e.prototype.postGwTask=function(){this.gwTaskRed;if(this.gwTaskRed=!1,GodWeaponCC.ins().taskIsOpen()){var t=GodWeaponCC.ins().gwTask;if(t.statue==GwTaskData.DONE||t.statue==GwTaskData.FINISH?this.gwTaskRed=!0:0==t.taskIdx&&SubRoles.ins().subRolesLen>GodWeaponCC.ins().weaponDataAry.length&&(this.gwTaskRed=!0),this.gwTaskRed)for(var e=1;3>=e;e++)GodWeaponCC.ins().getWeaponData(e)?this["gwTaskRed"+e]=!1:SubRoles.ins().getSubRoleByJob(e)&&0==t.taskIdx||t.weapon==e?this["gwTaskRed"+e]=!0:this["gwTaskRed"+e]=!1;else this.gwTaskRed1=!1,this.gwTaskRed2=!1,this.gwTaskRed3=!1}return!0},e.prototype.postgGwBossRp=function(){var t=this.gwBossRp;return this.gwBossRp=GodWeaponCC.ins().godWeaponIsOpen()&&(BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_GODWEAPON)||BossCT.ins().checkWorldBossRedPoint(BossCT.BOSS_SUBTYPE_GODWEAPON_TOP)),t!=this.gwBossRp},__decorate([post()],e.prototype,"postGodWeaponItem",null),__decorate([post()],e.prototype,"postGodWeapon",null),__decorate([post()],e.prototype,"postGwSb",null),__decorate([post()],e.prototype,"postGwTab1",null),__decorate([post()],e.prototype,"postGwTab2",null),__decorate([post()],e.prototype,"postGwTab3",null),__decorate([post()],e.prototype,"postGwMj",null),__decorate([post()],e.prototype,"postGwTask",null),__decorate([post()],e.prototype,"postgGwBossRp",null),e}(BaseSystem);__reflect(GodWeaponRedPoint.prototype,"GodWeaponRedPoint"),System.GodWeaponRedPoint=function(){return GodWeaponRedPoint.ins()},window.GodWeaponRedPoint=GodWeaponRedPoint;var GwFubenData=function(){function t(){}return t.prototype.parse=function(t){this.hadBuyData=[],this.hadChallengeNum=t.readInt(),this.vipBuyNum=t.readInt(),this.hadPass=t.readInt(),this.curPoint=t.readInt();for(var e=t.readInt(),i=0;e>i;i++){var n=[];n.push(t.readInt()),n.push(t.readInt()),this.hadBuyData[i]=n}this.getList()},Object.defineProperty(t.prototype,"hadPass",{get:function(){return this._hadPass},set:function(t){this._hadPass=t},enumerable:!0,configurable:!0}),t.prototype.getList=function(){var t,e=this.getMaxGird();t=1==this.curPoint?Math.min(this._hadPass+1,e):this._hadPass,this.listData=[];for(var i,n=t;n>0;n--)i=new GwfubenFloorData,i.gridNum=n,i.gridNum>this._hadPass?i.curPoint=0:i.gridNum==this._hadPass?i.curPoint=this.curPoint:i.curPoint=1,this.listData.push(i)},t.prototype.getMaxGird=function(){if(!this._maxGird){this._maxGird=0;for(var t in GlobalConfig.GodWeaponFubenConfig)this._maxGird++}return this._maxGird},t.prototype.buyTypeData=function(t){for(var e=0;e<this.hadBuyData.length;e++)if(this.hadBuyData[e][0]==t)return this.hadBuyData[e];return[t,0]},Object.defineProperty(t.prototype,"getBuyCount",{get:function(){for(var t=0,e=0;e<this.hadBuyData.length;e++)t+=this.hadBuyData[e][1];return t},enumerable:!0,configurable:!0}),t}();__reflect(GwFubenData.prototype,"GwFubenData");var GwfubenFloorData=function(){function t(){}return Object.defineProperty(t.prototype,"gridNum",{get:function(){return this._gridNum},set:function(t){this._gridNum=t,this.config=GlobalConfig.GodWeaponFubenConfig[t]},enumerable:!0,configurable:!0}),t}();__reflect(GwfubenFloorData.prototype,"GwfubenFloorData"),window.GwFubenData=GwFubenData;var GwRankInfoData=function(){function t(){}return t.prototype.parse=function(t){this.rank=t.readInt(),this.nameStr=t.readString();var e=t.readInt();this.floorNum=Math.floor(e/1e4),this.timeNum=1e4-e%1e4},t.prototype.getgetTimeStr=function(){var t="";return t=DateUtils.getFormatBySecond(this.timeNum,DateUtils.TIME_FORMAT_3)},t}();__reflect(GwRankInfoData.prototype,"GwRankInfoData"),window.GwRankInfoData=GwRankInfoData;var GwTaskData=function(){function t(){}return t.prototype.parser=function(t){this.weaponIdx=t.readInt(),this.weapon=t.readInt(),this.taskIdx=t.readInt(),this.progress=t.readInt(),this.statue=t.readInt()},t.DOING=0,t.DONE=1,t.FINISH=2,t}();__reflect(GwTaskData.prototype,"GwTaskData"),window.GwTaskData=GwTaskData;var GodweaponItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=GlobalConfig.ItemConfig[this.data.id];this.shengwuImg.source=t.icon+"_png",this.shengwuName.text=t.name,this.shengwuName.textColor=ItemUtil.getQualityColor(t),this.frame.source="godweapon_quality"+(ItemUtil.getQuality(t)+1),this.imgJob.source="job"+ItemUtil.getJob(t)+"Item",this.data.count?this.count.text=this.data.count:this.count.text=""},e}(BaseItemRender);__reflect(GodweaponItem.prototype,"GodweaponItem"),window.GodweaponItem=GodweaponItem;var GodweaponItemMixView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isHintEffectPlay=!1,e.isPlay=!1,e.COMPOUND_STATE="mix",e.FUSE_STATE="ultramix",e.PAGE_SIZE=5,e}return __extends(e,t),e.prototype.open=function(){this.mix1.touchChildren=!1,this.mix2.touchChildren=!1,this.mix3.touchChildren=!1,this.targetGroup.touchChildren=!1,this.mix.enabled=!1,this.list.itemRenderer=GodweaponItem,this.labelEffect=new MovieClip,this.labelEffect.scaleX=.6,this.labelEffect.scaleY=.5,this.labelEffect.touchEnabled=!1,this.hintEffect=new MovieClip,this.hintEffect.touchEnabled=!1,this.descTxt.alpha=1,this.MaterialItemId=ItemConst.GODWEAPON_ITEM,this.addCustomEvent(),this.updateView()},e.prototype.close=function(){this.cleanTween()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.turn,this.changeState),this.addTouchEvent(this.leftButton,this.prevPage),this.addTouchEvent(this.rightButton,this.nextPage),this.addTouchEvent(this.mix1,this.touchMixItem),this.addTouchEvent(this.mix2,this.touchMixItem),this.addTouchEvent(this.mix3,this.touchMixItem),this.addTouchEvent(this.targetGroup,this.touchTargetItem),this.addTouchEvent(this.mix,this.operate),this.addTouchEvent(this.mixMaterial,this.onTouch),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.observe(GodWeaponItemCC.ins().postCompound,this.onCompound),this.observe(GodWeaponItemCC.ins().postFuse,this.onFuse)},e.prototype.operate=function(){this.mix.enabled&&(this.currentState==this.FUSE_STATE?GodWeaponItemCC.ins().requestFuse(this.mixData1.id,this.mixData2.id,this.isMaterial?1:0):GodWeaponItemCC.ins().requestCompound(this.mixData1.id,this.mixData2.id,this.mixData3.id))},e.prototype.onCompound=function(t){var e=this;this.mix.enabled=!1,this.isMaterial=!1,this.addEffect(),Timer.start(300,1,function(){e.addEffect(function(){e.updateView(),e.updateTargetItem(t.id),e.addResultEffect(t.isSuccess,t.id,!0)})},this)},e.prototype.addResultEffect=function(t,e,i){var n=this;void 0===i&&(i=!1);var s=new MovieClip;s.x=this.targetGroup.width/2,this.targetGroup.addChild(s);var o;t?(o=RES_DIR_EFF+"UpEff1",s.y=this.targetGroup.height/2-15):(o=RES_DIR_EFF+"BoomEff",s.y=this.targetGroup.height/2),s.playFile(o,1,function(){i||n.cleanEff(),e&&(i||t)&&n.flyItem(e)})},e.prototype.playEff=function(t){var e=this;if(!this.isPlay){var i=RES_DIR_EFF+"ProgressEff5";this.isPlay=!0;var n=1,s=new MovieClip;s.playFile(i,-1),this.leftEff.addChild(s),s.scaleX=0,s.scaleY=.6;var o=new MovieClip;o.playFile(i,-1),this.rightEff.addChild(o),o.scaleX=0,o.scaleY=.6;var a=new MovieClip;a.playFile(i,-1),this.buttonEff.addChild(a),a.x+=14,a.scaleX=0,a.scaleY=.6,a.$setRotation(90);var r=.23,l=egret.Tween.get(s),h=egret.Tween.get(o);h.to({scaleX:r},250*n),l.to({scaleX:r},250*n).call(function(){var i=egret.Tween.get(a);i.to({scaleX:.35},250*n).call(function(){e.isPlay=!1,t&&t.call(e)})})}},e.prototype.cleanEff=function(){this.leftEff.removeChildren(),this.rightEff.removeChildren(),this.buttonEff.removeChildren()},e.prototype.addEffect=function(t){var e=this,i=new MovieClip;i.scaleX=3,i.scaleY=3,i.x=this.targetGroup.width/2-4,i.y=this.targetGroup.height/2-7,this.targetGroup.addChild(i);var n=DisplayUtils.getEffectPath("PromptEFF1");i.playFile(n,1,function(){t&&t.call(e)})},e.prototype.onFuse=function(t){var e=this;this.mix.enabled=!1,this.isMaterial=!1;var i,n=t.isSuccess;!n&&this.mixData1&&(i=new GodweaponItemData(this.mixData1.id,this.mixData1.count,this.mixData1.quality)),this.playEff(function(){e.updateView(),e.updateTargetItem(t.id),!n&&i&&(e.updateMixItem(1,i),e.mixData1&&e.currentState==e.FUSE_STATE&&(e.dataSource=new PageArray(e.updateMixData(),e.PAGE_SIZE),e.setPageData())),e.addResultEffect(n,t.id)})},e.prototype.flyItem=function(t){var e=new ItemBase;e.x=this.targetGroup.x,e.y=this.targetGroup.y,e.data=t,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,this.targetGroup.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.touchMixItem=function(t){var e=t.target,i=1;e==this.mix1?i=1:e==this.mix2?i=2:e==this.mix3&&(i=3),this["mixData"+i]||this.addHintEffect(),this.updateMixItem(i),this.currentState!=this.FUSE_STATE?this.setCompoundState(!1):(this.updateTargetItem(),1==i&&this.updateMixItem(2)),this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE),this.setPageData()},e.prototype.touchTargetItem=function(){var t=this.isCanFuse();t||this.updateTargetItem()},e.prototype.updateTargetItem=function(t){if(void 0===t&&(t=0),t){var e=GlobalConfig.ItemConfig[t];this.targetImg.visible=!0,this.targetImg.source=e.icon+"_png",this.targetLabel.text=e.name,this.targetLabel.textColor=ItemUtil.getQualityColor(e)}else{var i=this.isCanCompound();this.setCompoundState(i),this.targetLabel.textColor=13746831,this.targetImg.source="",this.targetImg.visible=!1}},e.prototype.setCompoundState=function(t){var e;e=t?"随机圣物":"",this.targetLabel.text=e,this.targetRandom.visible=t,this.mixline0Effect.visible=t,this.mixline1Effect.visible=t},e.prototype.updateMixItem=function(t,e){void 0===e&&(e=null);var i=this["mix"+t+"Img"],n=this["mix"+t+"Name"];if(e){i.visible=!0;var s=GlobalConfig.ItemConfig[e.id];i.source=s.icon+"_png",n.text=s.name,n.textColor=ItemUtil.getQualityColor(s)}else n.text="",i.visible=!1;this["mixData"+t]=e},e.prototype.addHintEffect=function(){var t=this;if(!this.isHintEffectPlay){DisplayUtils.removeFromParent(this.hintEffect),this.list.addChild(this.hintEffect),this.isHintEffectPlay=!0,this.hintEffect.x=241,this.hintEffect.y=49;var e=DisplayUtils.getEffectPath("PromptEff3");this.hintEffect.playFile(e,1,function(){t.isHintEffectPlay=!1})}},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=this.setMixData(t);if(e){var i=this.isCanFuse();i||this.updateTargetItem(),this.dataSource=new PageArray(this.updateMixData(),this.PAGE_SIZE),this.setPageData()}else TipsCT.ins().showTips("物品格已满")},e.prototype.setMixData=function(t){if(this.currentState==this.FUSE_STATE){var e=this.isCanFuse();if(e)return!1;var i=1;return this.mixData1?this.mixData2||(this.mixData2=t,i=2):(this.mixData1=t,i=1),this.updateMixItem(i,t),!0}var n=this.isCanCompound();if(n)return!1;var i=1;return this.mixData1?this.mixData2?this.mixData3||(this.mixData3=t,i=3):(this.mixData2=t,i=2):(this.mixData1=t,i=1),this.updateMixItem(i,t),!0},e.prototype.isCanCompound=function(){return this.mixData1&&this.mixData2&&this.mixData3&&this.currentState!=this.FUSE_STATE},e.prototype.isCanFuse=function(){return this.mixData1&&this.mixData2&&this.currentState==this.FUSE_STATE},e.prototype.updateMixData=function(){var t=this.dataList.concat();if(this.currentState==this.FUSE_STATE){this.mixData1&&(t=GodweaponItemModel.ins().filterFuseItemList(this.mixData1,t)),this.mixData2&&(t=GodweaponItemModel.ins().filterFuseItemList(this.mixData2,t));var e=this.isCanFuse();this.mix.enabled=e,e&&this.updateTargetItem(GodweaponItemModel.ins().getFuseTargetItem(this.mixData1.id,this.mixData2.id))}else this.mixData1&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData1,t)),this.mixData2&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData2,t)),this.mixData3&&(t=GodweaponItemModel.ins().filterCompoundItemList(this.mixData3,t)),this.mix.enabled=this.isCanCompound();return t},e.prototype.changeState=function(){this.currentState==this.FUSE_STATE?this.currentState=this.COMPOUND_STATE:this.currentState=this.FUSE_STATE,this.validateNow(),this.mix.enabled=!1,this.updateView()},e.prototype.prevPage=function(){this.dataSource.prev(),this.setPageData()},e.prototype.nextPage=function(){this.dataSource.next(),this.setPageData()},e.prototype.setPageData=function(){this.leftButton.visible=this.dataSource.havePre(),this.rightButton.visible=this.dataSource.haveNext(),this.list.dataProvider=new eui.ArrayCollection(this.dataSource.pageData)},e.prototype.clearView=function(){for(var t=1;4>t;t++)this["mixData"+t]=null,this.updateMixItem(t);this.updateTargetItem()},e.prototype.updateView=function(){var t,e,i;this.clearView(),this.currentState==this.FUSE_STATE?(t=GodweaponItemModel.ins().getFuseItemList(),e="圣物合成",i=GodweaponItemModel.ins().isCanCompound(),this.startTween()):(t=GodweaponItemModel.ins().getCompoundItemList(),e="圣物融合",i=GodweaponItemModel.ins().isCanFuse(),this.cleanTween()),i?this.addLabelEffect():this.removeLabelEffect(),this.turn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e+"</u></a>"),this.dataList=GodweaponItemModel.ins().toList(t),this.noItemDesc.visible=0==this.dataList.length,this.dataSource=new PageArray(this.dataList,this.PAGE_SIZE),this.setPageData(),this.updateShengWu()},e.prototype.addLabelEffect=function(){var t=this;egret.callLater(function(){DisplayUtils.removeFromParent(t.labelEffect),t.labelEffect.x=t.turn.x+37,t.labelEffect.y=t.turn.y+11,null==t.labelEffect.parent&&t.turn.parent.addChild(t.labelEffect),t.labelEffect.playFile(RES_DIR_EFF+"BtnPrompt1",-1)},this)},e.prototype.removeLabelEffect=function(){this.labelEffect.stop(),DisplayUtils.removeFromParent(this.labelEffect)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.mixMaterial:if(this.isMaterial)this.isMaterial=!1,this.addShengWu();else{var e=BagCT.ins().getBagItemById(this.MaterialItemId);e?(this.isMaterial=!0,this.addShengWu()):(this.isMaterial=!1,WarnCT.ins().setBuyGoodsWarn(this.MaterialItemId))}}},e.prototype.updateShengWu=function(){this.descTxt.text=this.isMaterial?"100%成功率":"点击添加",this.isMaterial?(this.setLight(this.mixMaterialImg),this.setLight(this.mixlabel)):(this.setGray(this.mixMaterialImg),this.setGray(this.mixlabel))},e.prototype.addShengWu=function(){this.updateShengWu(),this.isMaterial?this.cleanTween():this.startTween()},e.prototype.startTween=function(){this.isMaterial||(this.cleanTween(),this.descTxt.alpha=0,this.playTween())},e.prototype.playTween=function(){if(!this.tw){this.tw=egret.Tween.get(this.descTxt,{loop:!0});var t=this.descTxt.alpha?0:1;this.tw.to({alpha:t},600).to({alpha:1-t},600)}},e.prototype.cleanTween=function(){this.descTxt.alpha=1,this.tw&&egret.Tween.removeTweens(this.descTxt),this.tw=null},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)],this.materialTxt.visible=this.materialTxtImg.visible=!0},e.prototype.setLight=function(t){t.filters=[],this.materialTxt.visible=this.materialTxtImg.visible=!1},e}(BaseView);__reflect(GodweaponItemMixView.prototype,"GodweaponItemMixView"),window.GodweaponItemMixView=GodweaponItemMixView;var GodWeaponWin=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=-1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwSkin",this.isTopLevel=!0,this.gwRp.visible=!1,this.mjRp.visible=!1,this.gwBossRp.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GodWeaponRedPoint.ins().postGwMj,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postGwSb,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postgGwBossRp,this.updateRedPoint),this.observe(GodWeaponRedPoint.ins().postGodWeaponItem,this.updateRedPoint),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.help,this.onTap),this.gwadImg.visible=!1,this.gwadImg.source="",this.tab.visible=!0,this.timeBp.visible=!1,this.addChangeEvent(this.tab,this.itemTouchHandler),this.addChangingEvent(this.tab,this.itemTouching),t[0]&&this.checkIsOpen(t[0])?(this.viewStack.selectedIndex=t[0],this.selectIndex=this.tab.selectedIndex=t[0]):(this.viewStack.selectedIndex=0,this.selectIndex=this.tab.selectedIndex=0),this.updateRedPoint()},e.prototype.updateAward=function(){if(this.totalNumber<=0)return Timer.stop(this.updateAward,this),void this.updateOpen();var t=DateUtils.getFormatBySecond(this.totalNumber,DateUtils.TIME_FORMAT_1),e=t.split(":");t=e.join("."),this.timeBp.text=t,this.totalNumber--},e.prototype.updateOpen=function(){this.gwadImg.visible=!1,this.gwadImg.source="",this.tab.visible=!0,this.timeBp.visible=!1,this.viewStack.selectedIndex=0,this.selectIndex=0},e.prototype.updateRedPoint=function(){this.gwRp.visible=GodWeaponRedPoint.ins().gwSbRed,this.mjRp.visible=GodWeaponRedPoint.ins().gwMjRed,this.gwBossRp.visible=GodWeaponRedPoint.ins().gwBossRp,this.mixRp.visible=GodWeaponRedPoint.ins().gwItem},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._selectIndex>-1&&this.viewStack.getChildAt(this._selectIndex).close()},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex>-1&&this.viewStack.getChildAt(this._selectIndex).close(),this._selectIndex=t,this.viewStack.getChildAt(this._selectIndex).open(),this.help.visible=3==this._selectIndex},enumerable:!0,configurable:!0}),e.prototype.itemTouchHandler=function(t){this.selectIndex=this.tab.selectedIndex},e.prototype.itemTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return t>=1?ZsCT.ins().lv>=GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel&&GameServer.serverOpenDay>=GlobalConfig.GodWeaponBaseConfig.openDay?!0:(ZsCT.ins().lv<GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel?TipsCT.ins().showTips("角色转生等级"+GlobalConfig.GodWeaponBaseConfig.zhuanshengLevel+"开启"):GameServer.serverOpenDay<GlobalConfig.GodWeaponBaseConfig.openDay&&TipsCT.ins().showTips("开服"+GlobalConfig.GodWeaponBaseConfig.openDay+"天开启"),!1):!0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:3==this._selectIndex&&ViewManager.ins().open(ZsBossRuleSpeak,23)}},e}(BaseEuiView);__reflect(GodWeaponWin.prototype,"GodWeaponWin"),ViewManager.ins().reg(GodWeaponWin,LayerManager.UI_Main),window.GodWeaponWin=GodWeaponWin;var GwAddAttrView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._ary=new eui.ArrayCollection,e._sn_="GwAttrskin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.dataProvider=this._ary,this.list.itemRenderer=GwAddAttrRender,this.addTouchEvent(this.rect,this.onTap)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ary.replaceAll(GodWeaponCC.ins().gwAddAttr(t[0])),this.GwName.text=GodWeaponData.getWeaponName(t[0]+1)},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwAddAttrView.prototype,"GwAddAttrView");var GwAddAttrRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this._thisData=this.data,this.labelInfo.text=AttributeData.getAttrStrByType(this._thisData.type)+"："+this._thisData.value)},e}(BaseItemRender);__reflect(GwAddAttrRender.prototype,"GwAddAttrRender"),ViewManager.ins().reg(GwAddAttrView,LayerManager.UI_Popup),window.GwAddAttrView=GwAddAttrView;var GwBossChallengeView=function(t){function e(){var e=t.call(this)||this;return e._cdTime=0,e.skinName="GwBossChallengeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.reward.itemRenderer=ItemBase,this._awardAC=new eui.ArrayCollection,this.reward.dataProvider=this._awardAC},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.notBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.challengeBtn,this.onTap),this._bossData=t[0],this.initView()
},e.prototype.initView=function(){var t=this._bossData,e=GlobalConfig.WorldBossConfig[t.id];this.title.text=e.showName,this._awardAC.source=e.showReward.concat();var i=GlobalConfig.WorldBossBaseConfig.challengeItemYb[e.type-1];this.yuanbao.text=""+i;var n=GlobalConfig.WorldBossBaseConfig.challengeItem[e.type-1];this.ticket.source=n+"_png";var s=BagCT.ins().getBagGoodsByTypeAndId(0,n),o=0;s&&(o=s.count),this.num.text=""+o,o?this.num.textColor=ColorUtil.GREEN_COLOR_N:this.num.textColor=ColorUtil.RED_COLOR_N;var a=Math.ceil((BossCT.ins().worldBossCd[e.type]-egret.getTimer())/1e3);a>0?(this.leftCDText.visible=!0,this.updateCDTime(a)):this.leftCDText.visible=!1},e.prototype.updateCDTime=function(t){this._cdTime=t,Timer.stop(this.updateBtnLabel,this),t>0&&Timer.start(1e3,t,this.updateBtnLabel,this),this.updateBtnLabel()},e.prototype.updateBtnLabel=function(){this.leftCDText.text="挑战CD："+this._cdTime+"秒",this._cdTime-=1,this._cdTime<=0&&(this.leftCDText.text="")},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.notBtn||e==this.bgClose?ViewManager.ins().close(this):e==this.challengeBtn&&this.onChallenge()},e.prototype.onChallenge=function(){if(FbCT.ins().checkInFB())return!1;if(KfArenaSys.ins().checkIsMatching()){var t=GlobalConfig.WorldBossConfig[this._bossData.id];if(this._bossData.canInto)if(this._bossData.isDie)TipsCT.ins().showTips("BOSS未复活");else{if(!(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)){var e=Math.ceil((BossCT.ins().worldBossCd[t.type]-egret.getTimer())/1e3);if(e>0)return TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+e+"秒后可进行挑战|"),!1;var i=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t.type-1],n=GlobalConfig.WorldBossBaseConfig.challengeItem[t.type-1],s=BagCT.ins().getBagGoodsByTypeAndId(0,n);return s&&s.count||!(Actor.yb<i)?(BossCT.ins().sendChallengWorldBoss(this._bossData.id,t.type),ViewManager.ins().close(this),!0):(TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this),!1)}ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH)}else TipsCT.ins().showTips("|C:0xf3311e&T:等级不足，无法挑战|");return!1}},e.prototype.close=function(){},e}(BaseEuiView);__reflect(GwBossChallengeView.prototype,"GwBossChallengeView"),ViewManager.ins().reg(GwBossChallengeView,LayerManager.UI_Popup),window.GwBossChallengeView=GwBossChallengeView;var GwBossItem=function(t){function e(){var e=t.call(this)||this;return e.states=["cannot","already","havetime"],e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.WorldBossConfig[t.id];this.fbname.text=e.showName,this.selected?this.bg0.visible=!0:this.bg0.visible=!1,this.enabled=!0,Timer.stop(this.updateTime,this),t.canChallenge?this.currentState=this.states[1]:t.isDie&&t.canInto?(this.updateTime(),Timer.start(1e3,0,this.updateTime,this),this.currentState=this.states[2]):(this.enabled=!1,this.currentState=this.states[0]),this.levelNeed.text="("+e.zsLevel[0]+"转-"+e.zsLevel[1]+"转)"},e.prototype.updateTime=function(){var t=this.data.relieveTime-egret.getTimer();this.timeTxt.text=""+DateUtils.getFormatBySecond(Math.floor(t/1e3),1),0>=t&&(Timer.stop(this.updateTime,this),this.timeTxt.text="")},e.prototype.onRemove=function(t){Timer.stop(this.updateTime,this)},e}(BaseItemRender);__reflect(GwBossItem.prototype,"GwBossItem"),window.GwBossItem=GwBossItem;var GwBossView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.numToStr=["一","二","三","四","五"],e}return __extends(e,t),e.prototype.skinComplete=function(){this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.addTouchEvent(this.gw0,this.onTap),this.addTouchEvent(this.gw1,this.onTap),this.addTouchEvent(this.gw2,this.onTap),this.addTouchEvent(this.tower,this.onTap),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this)},e.prototype.addDisplay=function(){this.observe(ZsCT.ins().postZsLv,this.initData),this.observe(BossCT.ins().postWorldBoss,this.onUpdateBoss),Timer.start(3e3,0,this.onUpdateTime,this),Timer.start(1e3,0,this.initData,this),this.initData()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onUpdateTime=function(){BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_GODWEAPON),BossCT.ins().sendWorldBossInfo(BossCT.BOSS_SUBTYPE_GODWEAPON_TOP)},e.prototype.initData=function(){var t=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_GODWEAPON].concat();t.sort(this.compareFn);var e=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_GODWEAPON_TOP].concat();e.sort(this.compareFn);for(var i=0,n=0;n<t.length;n++){var s=t[n],o=GlobalConfig.WorldBossConfig[s.id],a="("+o.zsLevel[0]+"转-"+o.zsLevel[1]+"转)";if(this["redPoint"+n].visible=!1,i=o.type,s.canInto)if(this.setGwState(n,2),s.isDie){var r=s.relieveTime-egret.getTimer();r=0>r?0:r,a+="\n"+DateUtils.getFormatBySecond(Math.floor(r/1e3),1)}else this["redPoint"+n].visible=this.checkCanInto1(o.type)&&BossCT.ins().getBossRemindByIndex(s.id);else this.setGwState(n,0);this["info"+n].text=a}for(var n=0;n<e.length;n++){var s=e[n],o=GlobalConfig.WorldBossConfig[s.id],a=this.numToStr[n]+"层("+o.zsLevel[0]+"转-"+o.zsLevel[1]+"转)";if(this["towerRedPoint"+n].visible=!1,s.canInto)if(this.setTopState(n,2),s.isDie){var r=s.relieveTime-egret.getTimer();r=0>r?0:r,a+="\n"+DateUtils.getFormatBySecond(Math.floor(r/1e3),1)}else this["towerRedPoint"+n].visible=this.checkCanInto(o.type)&&BossCT.ins().getBossRemindByIndex(s.id);else this.setTopState(n,0);this["towerInfo"+n].text=a}this.leftTime.text="今日剩余圣域归属次数："+BossCT.ins().worldBossBelongTime[i]},e.prototype.checkCanInto=function(t){var e=GlobalConfig.WorldBossBaseConfig.challengeItemYb[t-1];if(Actor.yb>=e)return!0;var i=GlobalConfig.WorldBossBaseConfig.challengeItem[t-1],n=BagCT.ins().getBagGoodsByTypeAndId(0,i);return n&&n.count},e.prototype.checkCanInto1=function(t){return BossCT.ins().worldBossBelongTime[t]>0},e.prototype.setGwState=function(t,e){var i=["locked","normal","selected"];this["img"+t].source="gw_field_"+i[e]+"_"+t,this["titleBg"+t].source="gw_title_bg_"+(0==e?1:0),this["title"+t].source="gw_title_"+(0==e?"locked_":"")+(t+1),this["info"+t].textColor=0==e?11119017:65280},e.prototype.setTopState=function(t,e){this["tower"+t].visible=0!=e,this["towerInfo"+t].textColor=0==e?11119017:65280},e.prototype.onUpdateBoss=function(t){(t==BossCT.BOSS_SUBTYPE_GODWEAPON||t==BossCT.BOSS_SUBTYPE_GODWEAPON_TOP)&&this.initData()},e.prototype.compareFn=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_GODWEAPON)},e.prototype.onTap=function(t){var e=t.currentTarget;if(e!=this.tower){var i=this.getClickGwIndex(e);if(i>-1){if(!KfArenaSys.ins().checkIsMatching())return;var n=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_GODWEAPON].concat();if(n.sort(this.compareFn),n[i].canInto){var s=n[i],o=GlobalConfig.WorldBossConfig[s.id];if(s.isDie)TipsCT.ins().showTips("BOSS未复活");else if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);else{var a=Math.ceil((BossCT.ins().worldBossCd[o.type]-egret.getTimer())/1e3);if(a>0)return TipsCT.ins().showTips("|C:0xf3311e&T:冷却中，"+a+"秒后可进行挑战|"),!1;BossCT.ins().worldBossBelongTime[o.type]>0?RexueDideCT.checkEnoughTimeById(RexueID.GwBoss,BossCT.ins().worldBossBelongTime[o.type],function(){BossCT.ins().sendChallengWorldBoss(s.id,o.type)}):BossCT.ins().sendChallengWorldBoss(s.id,o.type)}}}else if(i=this.getClickTowerIndex(e),i>-1){var n=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_GODWEAPON_TOP].concat();n.sort(this.compareFn),n[i].canInto&&ViewManager.ins().open(GwBossChallengeView,n[i])}}else for(var n=BossCT.ins().worldInfoList[BossCT.BOSS_SUBTYPE_GODWEAPON_TOP].concat(),r=0,l=n;r<l.length;r++){var h=l[r];h.canInto&&ViewManager.ins().open(GwBossChallengeView,h)}},e.prototype.getClickTowerIndex=function(t){for(var e=0;5>e;e++)if(t==this["tower"+e])return e;return-1},e.prototype.getClickGwIndex=function(t){for(var e=0;3>e;e++)if(t==this["gw"+e])return e;return-1},e}(BaseView);__reflect(GwBossView.prototype,"GwBossView"),window.GwBossView=GwBossView;var GwMijingRankView=function(t){function e(){var e=t.call(this)||this;return e.skinName="GwMijingRankSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.touchEnabled=!0,this.addTouchEvent(this.bgClose,this.touchHandler),this._ary=new eui.ArrayCollection,this.list.dataProvider=this._ary,this.list.itemRenderer=GwMijingRankItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._ary.replaceAll(GodWeaponCC.ins().rankInfoDataAry)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.touchHandler),this.list.dataProvider=null},e.prototype.touchHandler=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwMijingRankView.prototype,"GwMijingRankView");var GwMijingRankItemRender=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this._thisData=this.data,this.playerName.text=this._thisData.nameStr,this.storeyCount.text="第"+this._thisData.floorNum+"层",this.time.text=this._thisData.getgetTimeStr(),this._thisData.rank<=3?(this.rank.visible=!1,this.qiansan.visible=!0,this.qiansan.source="paihang"+this._thisData.rank):(this.rank.text=""+this._thisData.rank,this.rank.visible=!0,this.qiansan.visible=!1))},e}(BaseItemRender);__reflect(GwMijingRankItemRender.prototype,"GwMijingRankItemRender"),ViewManager.ins().reg(GwMijingRankView,LayerManager.UI_Popup),window.GwMijingRankView=GwMijingRankView;var GwMijingRiseUpView=function(t){function e(){var e=t.call(this)||this;return e.isMax1=!1,e.isMax2=!1,e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GwRiseUpSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gold.selected=!0,this.addTouchEvent(this.gold,this.onTap),this.addTouchEvent(this.yuanbao,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.cancelBtn,this.onTap),this.observe(GodWeaponCC.ins().postFubenInfo,this.updateView),this.updateView()},e.prototype.updateView=function(){var t=GodWeaponCC.ins().fubenInfoData,e=10*t.getBuyCount;this.now.text="当前鼓舞  伤害 +"+e+"%",this.goldCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount+"",this.yuanbaoCost.text=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount+"";var i=t.buyTypeData(1);i[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount&&(this.gold.visible=!1,this.goldImg.visible=!1,this.goldCost.visible=!1,this.goldText.text="金币鼓舞次数已满",this.isMax1=!0,this.gold.selected=!1),i=t.buyTypeData(2),i[1]>=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount&&(this.yuanbao.visible=!1,this.yuanbaoCost.visible=!1,this.yuanbaoImg.visible=!1,this.yuanbaoText.text="元宝鼓舞次数已满",this.isMax2=!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.gold,this.onTap),this.removeTouchEvent(this.yuanbao,this.onTap),this.removeTouchEvent(this.cancelBtn,this.onTap),this.removeTouchEvent(this.cancelBtn,this.onTap),this.removeObserve()},e.prototype.onTap=function(t){switch(t.target){case this.gold:this.yuanbao.selected=!1,this.gold.selected=!0;break;case this.yuanbao:this.yuanbao.selected=!0,this.gold.selected=!1;break;case this.cancelBtn:ViewManager.ins().close(this);break;case this.sureBtn:if(this.isMax2&&this.isMax1)return void TipsCT.ins().showTips("鼓舞次数已满");if(!this.yuanbao.selected&&!this.gold.selected)return void TipsCT.ins().showTips("请选择兑换的货币类型");if(this.gold.selected){if(Actor.gold<GlobalConfig.GodWeaponBaseConfig.buyBuff[0].moneyCount)return void TipsCT.ins().showCenterTips("金币不足")}else if(Actor.yb<GlobalConfig.GodWeaponBaseConfig.buyBuff[1].moneyCount)return void TipsCT.ins().showCenterTips("元宝不足");GodWeaponCC.ins().buybuff(this.gold.selected?1:2);var e=GlobalConfig.GodWeaponBaseConfig.buyBuff[1].maxCount+GlobalConfig.GodWeaponBaseConfig.buyBuff[0].maxCount;GodWeaponCC.ins().fubenInfoData.getBuyCount==e-1&&ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GwMijingRiseUpView.prototype,"GwMijingRiseUpView"),ViewManager.ins().reg(GwMijingRiseUpView,LayerManager.UI_Popup),window.GwMijingRiseUpView=GwMijingRiseUpView;var GwResetWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GwResetSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.price.setType(MoneyConst.yuanbao)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgclose,this.onTouch),this.addTouchEvent(this.resetBtn,this.onTouch),this.price.setPrice(GlobalConfig.GodWeaponBaseConfig.skillResetCost),this._dataWeapon=t[0];var i=this._dataWeapon.getResetPoint();this.resetDesc.text=i>0?"重置后可返还"+i+"技能点":"目前没有可重置的技能",this.gwName.text=GodWeaponData.getWeaponName(this._dataWeapon.weaponId),this.resetBtn.enabled=i>0&&Actor.yb>=GlobalConfig.GodWeaponBaseConfig.skillResetCost},e.prototype.onTouch=function(t){switch(t.target){case this.bgclose:ViewManager.ins().close(this);break;case this.resetBtn:GodWeaponCC.ins().sendReset(this._dataWeapon.weaponId),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GwResetWin.prototype,"GwResetWin"),ViewManager.ins().reg(GwResetWin,LayerManager.UI_Main),window.GwResetWin=GwResetWin;var GwResultView=function(t){function e(){var e=t.call(this)||this;return e._pFNum=4,e.secNum=5,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="GwResultSkin",this.addTouchEvent(this.closeBtn,this.touchHandler),this.addTouchEvent(this.get,this.touchHandler),this.addTouchEvent(this.closenoget,this.touchHandler),this._ary=new eui.ArrayCollection,this.listCoin.dataProvider=this._ary,this.listCoin.itemRenderer=MijingItemBase2},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._fubenId=t[0],this._pFNum=t[1];var i,n,s=null==t[2]?-1:t[2];for(var o in GlobalConfig.GodWeaponFubenConfig)if(GlobalConfig.GodWeaponFubenConfig[o].fbId==this._fubenId){i=GlobalConfig.GodWeaponFubenConfig[o],n=parseInt(o);break}var a=t[3];this.txt.text=a?"第"+a+"层":"通关评价",this.time.visible=this.timeTitle.visible=!a;var r;if(a)this.closeBtn.label="领取奖励",this.get.visible=this.closenoget.visible=this.noget.visible=this.gaptime.visible=!1,this.closeBtn.visible=!0;else if(-1==s)this.time.text="未击杀BOSS",this.gaptime.visible=!1,this.get.visible=!0,this.closenoget.visible=!0,this.closeBtn.visible=!1,this.noget.visible=!0,r=!1;else if(this.time.text=DateUtils.getFormatBySecond(s,DateUtils.TIME_FORMAT_3),1!=this._pFNum){this.gaptime.visible=!0,this.get.visible=!0,this.closenoget.visible=!0,this.closeBtn.visible=!1;var l=Math.abs(s-GlobalConfig.GodWeaponBaseConfig.fbGrade[0]);this.gaptime.text="（距离S只差"+l+"秒）",this.noget.visible=!0,r=!1}else this.gaptime.visible=!1,this.get.visible=!1,this.closenoget.visible=!1,this.closeBtn.visible=!0,this.noget.visible=!1,r=!0;this._isB=r;var h=i.award[this._pFNum].concat();if(a);else if(1!=FbCT.ins().oldMijingPoint&&1==this._pFNum){var u=i.firstAward.concat();h=h.concat(u)}for(var p=[],c=0;c<h.length;c++){var d=new MijinglistData;d.data=h[c],d.index=c+1,d.start=i.award[1].length,d.floorNum=n,p.push(d)}if(this._ary.replaceAll(p),this.rank.source="godweapon_rank"+this._pFNum,r){this.updateCloseBtnLabel();var g=this.secNum;Timer.start(1e3,g,this.updateCloseBtnLabel,this)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.touchHandler),this.removeTouchEvent(this.get,this.touchHandler),this.removeTouchEvent(this.closenoget,this.touchHandler),this.listCoin.dataProvider=null,Timer.stop(this.updateCloseBtnLabel,this),GameMap.fubenID>0&&FbCT.ins().sendExitFb(),GameMap.fbType==FbCT.FB_TYPE_MIJING&&ViewManager.ins().open(FbWin,0,2)},e.prototype.updateCloseBtnLabel=function(){this.secNum--,this.secNum<=0&&(ViewManager.ins().close(this),GodWeaponCC.ins().requestGetAward()),this.closeBtn.label="退出("+this.secNum+"s)"},e.prototype.touchHandler=function(t){t.currentTarget==this.closeBtn?(GodWeaponCC.ins().requestGetAward(),ViewManager.ins().close(this)):t.currentTarget==this.get?(GodWeaponCC.ins().requestGetAward(),ViewManager.ins().close(this)):t.currentTarget==this.closenoget&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwResultView.prototype,"GwResultView");var MijingItemBase2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.getImg.visible=!1},e}(MijingItemBase);__reflect(MijingItemBase2.prototype,"MijingItemBase2"),ViewManager.ins().reg(GwResultView,LayerManager.UI_Popup),window.GwResultView=GwResultView;var GwShengWuChooseView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwShengWuChooseSkin",this._aryDate=new eui.ArrayCollection,this.list.dataProvider=this._aryDate,this.list.itemRenderer=GwShengwurenderItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._data=t[0],this.addTouchEvent(this.bgClose,this.closeHandler),this.addTouchEvent(this.list,this.clickHandler),this.updateView()},e.prototype.updateView=function(){var t=e.getGwItemType(this._data);if(t.sort(this.sortFun),this._data.itemId){var i=new GwItem;i.itemId=this._data.itemId,i.weaponId=this._data.weaponId,i.isCur=!0,t.unshift(i)}0==t.length?this.tipLabel2.visible=!0:this.tipLabel2.visible=!1,this._aryDate.replaceAll(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.closeHandler),this.removeTouchEvent(this.list,this.clickHandler),this.list.dataProvider=null},e.prototype.closeHandler=function(t){ViewManager.ins().close(this)},e.prototype.clickHandler=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;GodWeaponCC.ins().inlayItem(this._data.weaponId,this._data.pos,e.datathis.itemId),ViewManager.ins().close(this)}},e.getGwItemType=function(t){var i=[],n=BagCT.ins().bagModel[BagCT.BAG_TYPE_OTHTER],s=0;if(n)for(var o=0;o<n.length;o++){ItemUtil.getType(n[o].itemConfig),ItemUtil.getJob(n[o].itemConfig);if(15==ItemUtil.getType(n[o].itemConfig)&&ItemUtil.getJob(n[o].itemConfig)==t.weaponId)for(s=0;s<n[o].count;s++){var a=new GwItem;a.itemId=n[o].configID,a.weaponId=t.weaponId,i.push(a)}}var r=GodWeaponCC.ins().allGodItemData[t.weaponId];r=r.concat();var l={};for(s=0;s<r.length;s++)r[s].itemId&&(void 0==l[r[s].itemId]?l[r[s].itemId]=1:l[r[s].itemId]++);for(s=0;s<r.length;s++)if(r[s].itemId&&r[s].config.onlyOne){r[s].config.onlyOne;r[s].config.onlyOne==l[r[s].itemId]&&(e.deleteItemData(r[s].itemId,i),delete l[r[s].itemId])}return i},e.prototype.sortFun=function(t,e){return e.power-t.power},e.deleteItemData=function(t,e){for(var i=0;i<e.length;i++)e[i].itemId==t&&e.splice(i--,1)},e}(BaseEuiView);__reflect(GwShengWuChooseView.prototype,"GwShengWuChooseView"),ViewManager.ins().reg(GwShengWuChooseView,LayerManager.UI_Popup);var GwShengwurenderItem=function(t){function e(){var e=t.call(this)||this;return e.qualityName=["凡品","精品","极品","神品"],e.skinName="GWChooseItemSkin",e.best.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(t.prototype.dataChanged.call(this),this.data){this.datathis=this.data;var e=ItemUtil.getQuality(this.datathis.itemConfig);this.nameTxt.text=this.datathis.itemConfig.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.datathis.itemConfig),this.attr.text=this.datathis.addatrStr,this.power.text="评分："+this.datathis.power,this.itemIcon.imgJob.source="job"+this.datathis.weaponId+"Item",this.itemIcon.imgIcon.source=this.datathis.itemConfig.icon+"_png",this.itemIcon.imgBg.source="quality"+e,0>e-1?this.quality.text=this.qualityName[0]:this.quality.text=this.qualityName[e-1],this.quality.textColor=ItemUtil.getQualityColor(this.datathis.itemConfig),this.addNameLb.text="装备该圣物可提升"+this.datathis.skillName+"等级",1==this.datathis.isCur?(this.now.visible=!0,this.changeBtn.visible=!1):(this.now.visible=!1,this.changeBtn.visible=!0)}},e}(BaseItemRender);__reflect(GwShengwurenderItem.prototype,"GwShengwurenderItem");var Gwshengwuitem_icon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);__reflect(Gwshengwuitem_icon.prototype,"Gwshengwuitem_icon"),window.GwShengWuChooseView=GwShengWuChooseView;var GwSkillTipView=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GwSkillTipSkin",this.bgClose.touchEnabled=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._dataInfo=t[0],this.addTouchEvent(this.update,this.touchHandler),this.addTouchEvent(this.bgClose,this.closeHandler),this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView),this.updateView()},e.prototype.updateView=function(){var t=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId);16==this._dataInfo.skillId?(this.currentState="max",this._dataInfo.isOpen?(this.update.visible=!0,this.pointCount.visible=!0,this.unlockDesc.visible=!1,this.unlcokTitle.visible=!1,this.validateNow(),t&&0!=t.skillPoint?this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+t.skillPoint):this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>'),0==this._dataInfo.skillLv?(this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能",this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1))):(this.nowskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv)),this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(this._dataInfo.skillLv))),this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1)),this.skillImg.source=this._dataInfo.config.iconId+"_N"):(this.validateNow(),this.update.visible=!1,this.pointCount.visible=!1,this.unlcokTitle.visible=!0,this.unlockDesc.visible=!0,this.unlockDesc.text=this._dataInfo.openTip,this.skillImg.source=this._dataInfo.config.iconId+"_L",this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能",this.ultraskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addExAttrstr(1)),this.nextskillDesc.textFlow=(new egret.HtmlTextParser).parser(this._dataInfo.addAttrValyeType(this._dataInfo.skillLv+1)))):this._dataInfo.isOpen?(this.validateNow(),this._dataInfo.skillLv<this._dataInfo.config.upLevel?(this.currentState="normal",t&&0!=t.skillPoint?this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+t.skillPoint):this.pointCount.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>')):this.currentState="fullLv",0==this._dataInfo.skillLv?this.nowskillDesc.text="提升等级可学会"+this._dataInfo.config.skillName+"技能":(this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.addatrStr(this._dataInfo.skillLv)),this._dataInfo.config.skill&&(this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv))),this.descTextAlign(this.nowskillDesc)),this.nextskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.addatrStr(this._dataInfo.skillLv+1)),this._dataInfo.config.skill&&(this.nextskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.specialSkill(this._dataInfo.skillLv+1))),this.descTextAlign(this.nextskillDesc),this.skillImg.source=this._dataInfo.config.iconId+"_N"):(this.validateNow(),this.currentState="lock",this.nowskillDesc.textFlow=TextFlowMaker.generateTextFlow(this._dataInfo.config.lockDesc),this.descTextAlign(this.nowskillDesc),this.unlockDesc.text=this._dataInfo.openTip,this.skillImg.source=this._dataInfo.config.iconId+"_L"),this.skillName.text=this._dataInfo.config.skillName,16==this._dataInfo.skillId?this.lvCount.text=this._dataInfo.lvLabel(!0):this.lvCount.text=this._dataInfo.lvLabel();var e=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId),i=e&&e.skillPoint||0;0>=i?this.update.enabled=!1:this.update.enabled=!0},e.prototype.descTextAlign=function(t){this._dataInfo.config.attr?t.textAlign="center":t.numLines>=2?t.textAlign="left":t.textAlign="center"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.update,this.touchHandler),this.removeTouchEvent(this.bgClose,this.closeHandler)},e.prototype.touchHandler=function(t){if(this._dataInfo.skillLv>=this._dataInfo.config.upLevel)return void TipsCT.ins().showTips("已达到最大等级");var e=GodWeaponCC.ins().getWeaponData(this._dataInfo.weaponId),i=e&&e.skillPoint||0;return 0>=i?void TipsCT.ins().showTips("当前可用技能点不足"):(GodWeaponCC.ins().gwshowTips=!0,GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen,void GodWeaponCC.ins().upSkill(this._dataInfo.weaponId,this._dataInfo.skillId))},e.prototype.closeHandler=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GwSkillTipView.prototype,"GwSkillTipView"),ViewManager.ins().reg(GwSkillTipView,LayerManager.UI_Popup),window.GwSkillTipView=GwSkillTipView;var GwTaskView=function(t){function e(){var e=t.call(this)||this;return e._state=0,e._weaponId=1,e.weaponTxt=["至尊屠龙刀","赤血饮魔剑","逍遥无极扇"],e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this.btn,this.onTap)},e.prototype.addDisplay=function(){this.setSelectIndex()},e.prototype.open=function(t){this._weaponId=t+1,this.skin&&this.setSelectIndex()},e.prototype.setSelectIndex=function(){var t=this._weaponId-1,e=this._weaponId;this.initSkill();var i="激活|C:0xFFCC00&T:"+this.weaponTxt[t]+"|，需要先完成神兵任务",n=["领取任务","前往","完成任务","激活"];this.BG.source="godweapon_weaponBG"+e+"_jpg";for(var s=["zhanshi","fashi","daoshi"],o=0;2>=o;o++){var a=this[s[o]];a.visible=o==t}for(var r=["renwuchushi","renwuneirong","quanbuwancheng"],l=0,h=r;l<h.length;l++){var u=h[l];this[u].visible=!1}var p=GodWeaponCC.ins().gwTask;if(!GodWeaponCC.ins().weaponIsActive(e))if(p.taskIdx&&p.weapon==e){var c=GlobalConfig.GodWeaponTaskConfig[p.weaponIdx][p.taskIdx];p.statue==GwTaskData.DOING?(i+="|C:0xff0000&T:("+(p.taskIdx-1)+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuneirong.visible=!0,this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(p.taskIdx+"."+c.desc+(c.itemName[p.weapon-1]||"")+"|C:0xff0000&T:("+p.progress+"/"+c.target+")|"),this.btn.label=n[1],this._state=1,this.removeTaskMc()):p.statue==GwTaskData.DONE?(i+="|C:0xff0000&T:("+(p.taskIdx-1)+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuneirong.visible=!0,this.renwuneirong.textFlow=TextFlowMaker.generateTextFlow1(p.taskIdx+"."+c.desc+(c.itemName[p.weapon-1]||"")+"|C:0x00ff00&T:("+p.progress+"/"+c.target+")|"),this.btn.label=n[2],this._state=2,this.addTaskMc()):(i+="|C:0x00ff00&T:("+p.taskIdx+"/5)|",this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.quanbuwancheng.visible=!0,this.btn.label=n[3],this._state=3,this.addTaskMc())}else this.taskLabel.textFlow=TextFlowMaker.generateTextFlow1(i),this.renwuchushi.visible=!0,this.btn.label=n[0],this._state=0,this.removeTaskMc()},e.prototype.addTaskMc=function(){this.taskMc=new MovieClip,this.taskMc.x=this.btn.width/2,this.taskMc.y=this.btn.height/2,this.taskMc.scaleX=1,this.taskMc.scaleY=.85,this.taskMc.touchEnabled=!1,this.btn.parent.addChild(this.taskMc),this.taskMc.playFile(RES_DIR_EFF+"BtnPrompt1",-1)},e.prototype.removeTaskMc=function(){Timer.stopAll(this),DisplayUtils.removeFromParent(this.taskMc)},e.prototype.initSkill=function(){for(var t=this._weaponId,e=GlobalConfig.GodWeaponBaseConfig.noticeSkillId[t-1],i=GlobalConfig.GodWeaponLineConfig[t],n=0,s=0,o=e;s<o.length;s++){var a=o[s],r=GodWeaponCC.ins().getWeaponSkinIdData(t,i[a].skinId);this["item"+n].imgLight=!0,this["item"+n].updateView(r,t-1),this["skillName"+n].text=i[a].skillName,this["skillDesc"+n].text=i[a].lockDesc,n+=1}},e.prototype.onTap=function(t){var e=this,i=t.currentTarget,n=GodWeaponCC.ins().gwTask;if(i==this.btn)if(0==this._state){var s=SubRoles.ins().getSubRoleByJob(this._weaponId);if(!s){var o=["0","战士","法师","道士"];return void TipsCT.ins().showTips("未激活"+o[this._weaponId]+"，无法领取任务")}n.weapon?TipsCT.ins().showTips("有已领取的神兵任务，请先完成"):WarnWin.show("领取<font color='#FFCC00'>"+this.weaponTxt[this._weaponId-1]+"</font>任务后，需要全部任务做完，才能再次领取其他神兵任务，是否确定领取？",function(){GodWeaponCC.ins().requestReceiveTask(e._weaponId)},this)}else if(1==this._state){var a=GlobalConfig.GodWeaponTaskConfig[n.weaponIdx][n.taskIdx];a.controlTarget&&ViewManager.ins().open(a.controlTarget[0],a.controlTarget[1],a.controlTarget[2])}else(2==this._state||3==this._state)&&(GodWeaponCC.ins().requestActiveWeapon(),2==this._state&&(this.taskComMc=this.taskComMc||ObjectPool.pop("MovieClip"),this.taskComMc.playFile(RES_DIR_EFF+"MissionFinish",1,function(){e.taskComMc.parent&&(e.taskComMc.parent.removeChild(e.taskComMc),e.taskComMc=null)}),this.taskComMc.y=this.btn.y-80,this.taskComMc.x=this.btn.x+this.btn.width/2,this.GwTask.addChild(this.taskComMc)))},e}(BaseView);__reflect(GwTaskView.prototype,"GwTaskView"),window.GwTaskView=GwTaskView;var GwWeaponView=function(t){function e(){var e=t.call(this)||this;return e._selectIndex=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.clickRect.touchEnabled=!0,this.expschedule.mask=this.maskRect,this.detailBtn.touchEnabled=!0,this.maskPro.touchEnabled=!1,this.progressImg.mask=this.maskPro,this.progressHeadImg=new eui.Image,this.exp.addChild(this.progressHeadImg),this.progressHeadImg.y=39,this.powerPanel.setPower(0),this.rpImg0.visible=!1,this.rpImg1.visible=!1,this.rpImg2.visible=!1,this.rpImgExp.visible=!1,this.reset.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.reset.text),this.addTouchEvent(this.weapon0,this.touchHandler),this.addTouchEvent(this.weapon1,this.touchHandler),this.addTouchEvent(this.weapon2,this.touchHandler),this.addTouchEvent(this.clickRect,this.touchHandler),this.addTouchEvent(this.detailBtn,this.touchHandler),this.addTouchEvent(this.reset,this.touchHandler),this.addTouchEvent(this.mixGroup,this.gwmixtap);for(var t=1;5>=t;t++)this["shengwu"+t].touchEnabled=!0,this["shengwu"+t].touchChildren=!1,this.addTouchEvent(this["shengwu"+t],this.touchHandler)},e.prototype.addDisplay=function(){this.viewStack2.visible=!1,this.observe(GodWeaponCC.ins().postUpdateInfo,this.updateView),this.observe(GodWeaponCC.ins().postUpdateExp,this.updateGwExp),this.observe(GodWeaponCC.ins().postGwTask,this.updateView),this.observe(GodWeaponRedPoint.ins().postGwTab1,this.showRedPoint),this.observe(GodWeaponRedPoint.ins().postGwTab2,this.showRedPoint),this.observe(GodWeaponRedPoint.ins().postGwTab3,this.showRedPoint),this.selectIndex=this.getSelectedIndex()},e.prototype.getSelectedIndex=function(t){return void 0==t&&(t=GodWeaponCC.ins().gwTask.taskIdx?GodWeaponCC.ins().gwTask.weapon-1:0),t},e.prototype.gwmixtap=function(){this.viewStack2.visible=!0,this.godweaponItemMix.open()},Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t;var e=GodWeaponCC.ins().weaponIsActive(t+1);this.mixGroup.visible=e,e?this.showWeapon():this.showTask(),this.selectBtnImage(),this.showRedPoint(),this.reset.visible=e},enumerable:!0,configurable:!0}),e.prototype.showTask=function(){this.currentState="task",this.gwTask.open(this._selectIndex)},e.prototype.showWeapon=function(){this.currentState="active",this.validateNow();var t=this._selectIndex;this._curWeapon=GodWeaponCC.ins().getWeaponData(t+1),this.godweaponskill.selectIndex=t;
var e=t+1;this.weaponName.source="godweapon_name"+e,this.needExp.text="("+this._curWeapon.curExp+"/"+this._curWeapon.config.exp+")",this.lvCount.text="Lv."+this._curWeapon.curLv,0==this._curWeapon.skillPoint?this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">神兵等级每提升10级可获得1个技能点</font>'):this.curPointLabel.textFlow=(new egret.HtmlTextParser).parser('<font color="#d1c28f">当前可用的技能点：</font>'+this._curWeapon.skillPoint),this.updateGwExp(),this.expschedule.visible=!0;var i,n=this._curWeapon.config.everyExp,s=2*n,o=GodWeaponCC.ins().curExp;s>o?(i=1*o/s,0>i&&(i=0)):i=1;var a=egret.Tween.get(this.maskRect);a.to({scaleY:i},200),this.updateGodItemView(),this.progressHeadImg.source="godweapon_expfront",i=1*this._curWeapon.curExp/this._curWeapon.config.exp,a=egret.Tween.get(this.maskPro,{onChange:this.funcChange,onChangeObj:this}),a.to({scaleX:i},200)},e.prototype.selectBtnImage=function(){switch(this["selectIcon"+this._selectIndex].visible=!0,this._selectIndex){case 0:this.selectIcon1.visible=!1,this.selectIcon2.visible=!1;break;case 1:this.selectIcon0.visible=!1,this.selectIcon2.visible=!1;break;case 2:this.selectIcon0.visible=!1,this.selectIcon1.visible=!1}},e.prototype.showRedPoint=function(){var t=GodWeaponCC.ins().maxLvRedPoint();t?(this.rpImg0.visible=GodWeaponCC.ins().weaponIsActive(1),this.rpImg1.visible=GodWeaponCC.ins().weaponIsActive(2),this.rpImg2.visible=GodWeaponCC.ins().weaponIsActive(3),this.rpImgExp.visible=!0):(this.rpImg0.visible=GodWeaponRedPoint.ins().gwSbRed1,this.rpImg1.visible=GodWeaponRedPoint.ins().gwSbRed2,this.rpImg2.visible=GodWeaponRedPoint.ins().gwSbRed3,this.rpImgExp.visible=!1)},e.prototype.funcChange=function(){341*this.maskPro.scaleX<18?(this.progressHeadImg.x=130,this.progressHeadImg.scaleX=1*(341*this.maskPro.scaleX)/18):(this.progressHeadImg.x=130+341*this.maskPro.scaleX-18,this.progressHeadImg.scaleX=1)},e.prototype.updateGodItemView=function(){for(var t=0;5>t;t++)this["shengwu"+(t+1)].updateView(GodWeaponCC.ins().getGodItemData(this._selectIndex+1,t+1))},e.prototype.updatePower=function(){for(var t=GodWeaponCC.ins().gwAddAttr(this.selectIndex),e=[],i=0;i<t.length;i++)e.push(new AttributeData(t[i].type,t[i].value));var n=BagCT.getAttrPower(e);if(GodWeaponCC.ins().weaponIsActive(this._selectIndex+1)){for(var s=0,o=void 0,a=GodWeaponCC.ins().maxSkillIdAry[this.selectIndex],i=0;a>i;i++)o=GodWeaponCC.ins().getWeaponSkinIdData(this.selectIndex+1,i),(o.isOpen||o.addLv+o.skillLv>0)&&(s+=o.skillPower);n+=s}this.powerPanel.setPower(n)},e.prototype.updateView=function(){this.selectIndex=this.selectIndex},e.prototype.updateGwExp=function(){this.updatePower(),this.expcount.text=""+GodWeaponCC.ins().curExp},e.prototype.touchHandler=function(t){if(t.target instanceof eui.Button)switch(t.target){case this.weapon0:this.selectIndex=0;break;case this.weapon1:this.selectIndex=1;break;case this.weapon2:this.selectIndex=2}else if(t.target instanceof GwshengwuItem){var e=void 0;switch(t.target){case this.shengwu1:e=1;break;case this.shengwu2:e=2;break;case this.shengwu3:e=3;break;case this.shengwu4:e=4;break;case this.shengwu5:e=5}this.inlayItem(e)}else if(t.target==this.clickRect){var i=GodWeaponCC.ins().getWeaponData(this.selectIndex+1);if(i&&i.config.everyExp>GodWeaponCC.ins().curExp)return void TipsCT.ins().showTips("当前经验不足");GodWeaponCC.ins().gwshowTips=!0,GodWeaponCC.ins().roleshowTips=SubRoles.ins().subRolesLen,GodWeaponCC.ins().upWeapon(this.selectIndex+1)}else t.target==this.detailBtn?ViewManager.ins().open(GwAddAttrView,this.selectIndex):t.target==this.reset&&ViewManager.ins().open(GwResetWin,GodWeaponCC.ins().getWeaponData(this.selectIndex+1))},e.prototype.inlayItem=function(t){var e=GodWeaponCC.ins().getGodItemData(this._selectIndex+1,t);e.isOpen?ViewManager.ins().open(GwShengWuChooseView,e):TipsCT.ins().showTips("神兵等级达到"+e.openLv+"级开启")},e}(BaseView);__reflect(GwWeaponView.prototype,"GwWeaponView");var GwshengwuItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.updateView(this.data)},e.prototype.updateView=function(t){this.data=t,this.skin&&(t?t.isOpen?t.itemConfig?(this.shengwuImg.source=t.itemConfig.icon+"_png",this.shengwuImg.visible=!0,this.add.visible=!1,this.rpImgAdd.visible=!1,this.frame.source="godweapon_quality"+(ItemUtil.getQuality(t.itemConfig)+1)):(this.shengwuImg.visible=!1,this.add.visible=!0,this.frame.source="godweapon_quality1",GwShengWuChooseView.getGwItemType(t).length<=0?this.rpImgAdd.visible=!1:this.rpImgAdd.visible=!0):(this.shengwuImg.visible=!1,this.add.visible=!1,this.rpImgAdd.visible=!1,this.frame.source="godweapon_quality0"):(this.frame.source="godweapon_quality0",this.add.visible=!1,this.shengwuImg.visible=!1,this.rpImgAdd.visible=!1))},e}(BaseView);__reflect(GwshengwuItem.prototype,"GwshengwuItem");var GwGodWeaponSkillView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._selectIndex=0,e.max=16,e}return __extends(e,t),Object.defineProperty(e.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(t){this._selectIndex=t,this.skin&&this.updateWp()},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.touchEnabled=!1,this.addTouchEvent(this,this.touchHandler),this.updateWp()},e.prototype.updateWp=function(t){void 0===t&&(t=this._selectIndex),this.currentState="wp"+(t+1);for(var e,i,n=[],s=0;s<this.max;s++)if(e=this["wp1_skill"+s],i=GodWeaponCC.ins().getWeaponSkinIdData(t+1,s),e.updateView(i,t),i&&(i.isOpen||i.skillLv>0||i.addLv>0)&&i.config.lineId)for(var o=0;o<i.config.lineId.length;o++)this["wp1_lock"+i.config.lineId[o]].visible=!1,this["wp1_unlock"+i.config.lineId[o]].visible=!0,-1==n.indexOf(i.config.lineId[o])&&n.push(i.config.lineId[o]);else-1==n.indexOf(s)&&(this["wp1_lock"+s].visible=!0,this["wp1_unlock"+s].visible=!1)},e.prototype.touchHandler=function(t){t.target instanceof GwWeaponSkillIcon&&ViewManager.ins().open(GwSkillTipView,t.target.dataThis)},e}(BaseView);__reflect(GwGodWeaponSkillView.prototype,"GwGodWeaponSkillView");var GwWeaponSkillIcon=function(t){function e(){var e=t.call(this)||this;return e.imgLight=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.touchChildren=!1,this.glowImg.visible=!1,this._effect=new MovieClip},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateView(this.dataThis,this.wpId)},e.prototype.removeDisplay=function(){this.dataThis=null},e.prototype.updateView=function(t,e){if(this.dataThis=t,this.wpId=e,this.skin&&t){if(DisplayUtils.removeFromParent(this._effect),t.isOpen||t.skillLv>0||t.addLv>0||this.imgLight){var i=GodWeaponCC.ins().getWeaponData(e+1);if(t.skillLv<t.config.upLevel&&i&&i.skillPoint>0){switch(this._effect.name||(this._effect.playFile(RES_DIR_EFF+"CirclePrompt",-1),this._effect.x=45,this._effect.y=45),this.dataThis.skillId){case 16:case 15:case 14:case 13:this._effect.scaleX=this._effect.scaleY=1.1;break;default:this._effect.scaleX=this._effect.scaleY=.6}this.addChildAt(this._effect,3)}this.Img.source=t.config.iconId+"_N"}else this.glowImg.visible=!1,this.Img.source=t.config.iconId+"_L";t.addLv>0||t.skillLv>0||t.isOpen?(this.lvCount.visible=!0,this.lvFrame.visible=!0,t.addLv>0&&(this.lvCount.textColor=3531373),16==this.dataThis.skillId?this.lvCount.text=t.lvLabel(!0):this.lvCount.text=t.lvLabel()):(this.lvCount.visible=!1,this.lvFrame.visible=!1)}},e}(BaseView);__reflect(GwWeaponSkillIcon.prototype,"GwWeaponSkillIcon"),window.GwWeaponView=GwWeaponView,window.GwGodWeaponSkillView=GwGodWeaponSkillView,window.GwWeaponSkillIcon=GwWeaponSkillIcon,window.GwshengwuItem=GwshengwuItem;var GodWingRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.keYinRoles=[],e.tabs={},e.roleTabs={},e.redPoint=!1,e.associated(e.postGodWingRedPoint,e.postGodWingItem),e.associated(e.postGodWingItem,WingCT.ins().postWingWear,WingCT.ins().postGodWingData,WingCT.ins().postWingUpgrade,WingCT.ins().postActivate,BagCT.ins().postItemChange,BagCT.ins().postItemAdd),e.associated(e.postGodWingCompose,BagCT.ins().postItemChange,BagCT.ins().postItemAdd),e.associated(e.postKeYinRedPoint,WingCT.ins().postKeYin,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.prototype.postKeYinRedPoint=function(){this.keYinRedPoint=!1;for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=this.postKeYinRoles(t);e&&(this.keYinRedPoint=!0)}return!0},e.prototype.postKeYinRoles=function(t){this.keYinRoles[t]=!1;var e=!1,i=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(!i||i.lv<WingCT.WingMaxLv)return e;var n=WingCT.ins().getGodWing(t);if(!n)return e;var s=n.keYinLv,o=GlobalConfig.GodWingSignetLevelConfig[s+1];if(!o)return e;var a=o?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o.itemInfo.id):0;return a>=o.itemInfo.count&&(e=this.keYinRoles[t]=!0),e},e.prototype.postGodWingRedPoint=function(){var t=this.redPoint;return this.redPoint=this.tabs[0]||this.tabs[1],t!=this.redPoint},e.prototype.postGodWingItem=function(){var t=0;this.roleTabs[t]||(this.roleTabs[t]={});for(var e=3,i=0;e>i;i++)this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][i]=WingCT.ins().isWearGodWing(i);this.tabs[t]=!1;for(var n in this.roleTabs[t])this.roleTabs[t][n]&&(this.tabs[t]=!0);return!0},e.prototype.postGodWingCompose=function(){var t=1;return this.tabs[t]=WingCT.ins().isComposeGodWingAll(),this.roleTabs[t]||(this.roleTabs[t]={}),!0},e.prototype.postGodWingTransfer=function(){var t=2;this.roleTabs[t]||(this.roleTabs[t]={}),this.tabs[t]=Boolean(BagCT.ins().getBagGoodsByType(ItemType.TYPE_16))},e.prototype.getGodWingRedPoint=function(){if(GameServer.serverOpenDay+1<GlobalConfig.WingCommonConfig.openDay)return!1;for(var t=0;t<SubRoles.ins().subRolesLen;t++){var e=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(e.openStatus)return this.redPoint}return!1},__decorate([post()],e.prototype,"postKeYinRedPoint",null),__decorate([post()],e.prototype,"postKeYinRoles",null),__decorate([post()],e.prototype,"postGodWingRedPoint",null),__decorate([post()],e.prototype,"postGodWingItem",null),__decorate([post()],e.prototype,"postGodWingCompose",null),__decorate([post()],e.prototype,"postGodWingTransfer",null),e}(BaseSystem);__reflect(GodWingRedPoint.prototype,"GodWingRedPoint"),System.GodWingRedPoint=function(){return GodWingRedPoint.ins()},window.GodWingRedPoint=GodWingRedPoint;var GodWingComposeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuComposeItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.suitConfig,e=this.data.slot,i=GlobalConfig.GodWingLevelConfig[t.lv][e],n=GlobalConfig.ItemConfig[i.itemId];this.nameTxt.text=n.name}},e.prototype.setRedPoint=function(t){this.redPoint.visible=t},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GodWingComposeItem.prototype,"GodWingComposeItem"),window.GodWingComposeItem=GodWingComposeItem;var GodWingComposePanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="ShenYuComposeSkin",e}return __extends(e,t),e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.compose,this.onClick),this.removeObserve();for(var i=0;i<WingCT.GodWingMaxSlot;i++)this.removeTouchEvent(this["item"+i],this.onSlot)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.compose,this.onClick),this.addTouchEvent(this.now,this.onClick),this.addTouchEndEvent(this.next,this.onClick),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.observe(GodWingRedPoint.ins().postGodWingCompose,this.updateItem),this.slot=1;for(var i in GlobalConfig.GodWingSuitConfig){this.curIndex=GlobalConfig.GodWingSuitConfig[i].lv;break}for(var i=0;i<WingCT.GodWingMaxSlot;i++)this.addTouchEvent(this["item"+i],this.onSlot),this["item"+i].setSelect(!1);this.item0.setSelect(!0),this.list.itemRenderer=GodWingComposeItem,this.itemList=new eui.ArrayCollection([]),this.updateGodWing()},e.prototype.onListTap=function(t){if(t&&t.itemRenderer&&t.item){var e=t.item;this.curIndex=e.suitConfig.lv,this.updateItem()}},e.prototype.onSlot=function(t){for(var e=0;e<WingCT.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?(this["item"+e].setSelect(!0),this.slot=e+1,this.updateItem()):this["item"+e].setSelect(!1)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.compose:var e=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];if(WingCT.ins().isComposeGodWingOnly(e.itemId)){var i=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];WingCT.ins().sendWingCompose(2,i.itemId)}else TipsCT.ins().showTips("|C:0xff0000&T:材料不足");break;case this.now:var n=void 0;if(t.currentTarget.data instanceof ItemConfig){var s=t.currentTarget.data,o=BagCT.ins().getBagItemById(s.id),a=o?o.count:0;ViewManager.ins().open(ItemDetailedWin,0,s.id,a)}else{var r=t.currentTarget.data;n=GlobalConfig.GodWingItemConfig[r.itemId],ViewManager.ins().open(GodWingTipsWin,n)}break;case this.next:var l=t.currentTarget.data;n=GlobalConfig.GodWingItemConfig[l.itemId],ViewManager.ins().open(GodWingTipsWin,n)}},e.prototype.updateGodWing=function(){this.dataList=[];var t=1;for(var e in GlobalConfig.GodWingSuitConfig){var i=GlobalConfig.GodWingSuitConfig[e];this.dataList.push({slot:t,suitConfig:i})}this.itemList.replaceAll(this.dataList),this.list.dataProvider=this.itemList,this.list.validateNow(),this.list.selectedIndex=0,this.updateItem()},e.prototype.updateItem=function(){var t=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot],e=0,i=0;if(this.power0.visible=this.attr0.visible=!1,t){this.next.data=t,this.next.setCountVisible(!1);var n=GlobalConfig.GodWingItemConfig[t.itemId];if(n=GlobalConfig.GodWingItemConfig[n.composeItem.id]){var s=WingCT.ins().getPreLevel(this.curIndex),o=GlobalConfig.GodWingLevelConfig[s][this.slot];this.now.data=o,this.now.setCountVisible(!1);var a=GlobalConfig.GodWingItemConfig[o.itemId],r=AttributeData.getAttStr(a.attr,0,1,"：")+"\n";r+=AttributeData.getExAttrNameByAttrbute(a.exattr[0],!0),this.attr1.text=r;var l=Math.floor(BagCT.getAttrPower(a.attr));this.power1.text="战斗力："+(l+a.exPower),n=GlobalConfig.GodWingItemConfig[t.itemId];var h=AttributeData.getAttStr(n.attr,0,1,"：")+"\n";h+=AttributeData.getExAttrNameByAttrbute(n.exattr[0],!0),this.attr2.text=h;var u=Math.floor(BagCT.getAttrPower(n.attr));this.power2.text="战斗力："+(u+n.exPower);var p=BagCT.ins().getBagItemById(n.composeItem.id);e=p?p.count:0,i=n.composeItem.count}else{n=GlobalConfig.GodWingItemConfig[t.itemId];var c=GlobalConfig.ItemConfig[n.composeItem.id];this.now.data=c,this.now.setCountVisible(!1);var h=AttributeData.getAttStr(n.attr,0,1,"：")+"\n";h+=AttributeData.getExAttrNameByAttrbute(n.exattr[0],!0),this.attr0.text=h;var d=Math.floor(BagCT.getAttrPower(n.attr));this.power0.text="战斗力："+(d+n.exPower);var p=BagCT.ins().getBagItemById(c.id);e=p?p.count:0,i=n.composeItem.count,this.power0.visible=this.attr0.visible=!0}}this.attr1.visible=this.attr2.visible=!this.attr0.visible,this.power1.visible=this.power2.visible=!this.power0.visible;var g;g=e>=i?ColorUtil.GREEN:ColorUtil.RED,this.number.textFlow=TextFlowMaker.generateTextFlow1("|C:"+g+"&T:"+e+"|/|C:0xD1C28F&T:"+i);for(var f=0;f<this.dataList.length;f++)this.dataList[f].slot=this.slot;this.itemList.replaceAll(this.dataList),this.list.dataProvider=this.itemList,this.updateRedPoint(),this.updateGodWingItem()},e.prototype.updateGodWingItem=function(){for(var t=0;t<WingCT.GodWingMaxSlot;t++){var e=GlobalConfig.GodWingLevelConfig[this.curIndex][t+1],i=GlobalConfig.GodWingItemConfig[e.itemId];this["item"+t].data=i,this["item"+t].setImgIcon("sybg"+(t+1)),this["item"+t].setCountVisible(!1),this["item"+t].setNameVisible(!1)}},e.prototype.updateRedPoint=function(){var t=GlobalConfig.GodWingLevelConfig[this.curIndex][this.slot];this.redPoint.visible=WingCT.ins().isComposeGodWingOnly(t.itemId);for(var e=0;e<this.list.numElements;e++){var i=this.list.getVirtualElementAt(e),n=this.list.dataProvider.getItemAt(e),s=WingCT.ins().isComposeGodWingLevel(n.suitConfig.lv,this.slot);i.setRedPoint(s)}for(var e=1;e<=WingCT.GodWingMaxSlot;e++){var s=WingCT.ins().isComposeGodWingSlot(this.curIndex,e);this["item"+(e-1)].updateRedPoint(s)}},e}(BaseView);__reflect(GodWingComposePanel.prototype,"GodWingComposePanel"),window.GodWingComposePanel=GodWingComposePanel;var GodWingItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.setSelect=function(t){this.select.visible=t},e.prototype.dataChanged=function(){if(this.data){if(this.itemId=0,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.source="",this.data instanceof GodWingItemConfig){var t=GlobalConfig.ItemConfig[this.data.itemId];this.itemIcon.imgIcon.source=t.icon+"_png",this.nameTxt.text=t.name,this.itemId=this.data.itemId,this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(t),this.nameTxt.textColor=ItemUtil.getQualityColor(t)}else if(this.data instanceof ItemData){var t=GlobalConfig.ItemConfig[this.data.configID];this.itemIcon.imgIcon.source=t.icon+"_png",this.nameTxt.text=t.name,this.itemId=t.id,this.count.text=this.data.count+"",this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(t),this.nameTxt.textColor=ItemUtil.getQualityColor(t)}else if(this.data instanceof ItemConfig)this.itemIcon.imgIcon.source=this.data.icon+"_png",this.nameTxt.text=this.data.name,this.itemId=this.data.id,this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(this.data),this.nameTxt.textColor=ItemUtil.getQualityColor(this.data);else if(this.data instanceof GodWingSuitConfig){if(!this.data.skillname)for(var e in GlobalConfig.GodWingSuitConfig)if(GlobalConfig.GodWingSuitConfig[e].skillname){this.data=GlobalConfig.GodWingSuitConfig[e];break}this.itemIcon.imgIcon.source=this.data.skillicon,this.nameTxt.text=this.data.skillname}else if(this.data instanceof GodWingLevelConfig){var i=GlobalConfig.ItemConfig[this.data.itemId];this.itemIcon.imgIcon.source=i.icon+"_png",this.nameTxt.text=i.name,this.itemIcon.imgBg.source="quality"+ItemUtil.getQuality(i),this.nameTxt.textColor=ItemUtil.getQualityColor(i)}this.itemIcon.imgIcon.visible=!!this.itemIcon.imgIcon.source}},e.prototype.setCountVisible=function(t){this.count.visible=t},e.prototype.setNameVisible=function(t){this.nameTxt.visible=t,t||this.setQuality("quality0")},e.prototype.setImgIcon=function(t){this.itemIcon.imgIcon.source=t,this.itemIcon.imgJob.visible=!1,this.itemIcon.imgIcon.visible=!!this.itemIcon.imgIcon.source},e.prototype.updateRedPoint=function(t){this.redPoint.visible=t},e.prototype.setNameText=function(t){this.nameTxt.text=t},e.prototype.setQuality=function(t){this.itemIcon.imgBg.source=t},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GodWingItem.prototype,"GodWingItem"),window.GodWingItem=GodWingItem;var GodWingKeYinPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isEnough=!1,e._sn_="ShenYuKeYinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.onClick),this.schedule0=new ProgressBarEff,this.schedule0.setWidth(525),this.barGroup.addChild(this.schedule0)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.observe(WingCT.ins().postKeYin,this.update),this.update()},e.prototype.update=function(){var t=WingCT.ins().getGodWing(this.curRole),e=t.keYinLv;this.eLvLab.text="刻印等级Lv"+e;var i=GlobalConfig.GodWingSignetLevelConfig[e],n=GlobalConfig.GodWingSignetLevelConfig[e+1],s=null==n;if(this.redPoint.visible=!1,this.eBtn.visible=!0,this.eFullLab.visible=!1,this.compose.visible=!0,this.eArrow.visible=!0,this.eLvLab.visible=!0,this.barGroup.visible=!0,i)if(s)this.eFullLab.visible=!0,this.attr0.visible=!0,this.attr0.text=AttributeData.getAttStr(i.arrts,4,1,":"),this.barGroup.visible=this.compose.visible=this.eArrow.visible=this.eNumLab.visible=this.eIcon.visible=this.attr1.visible=this.attr2.visible=!1;else{this.eIcon.source=GlobalConfig.ItemConfig[n.itemInfo.id].icon+"_png";var o=n?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.itemInfo.id):0;this.isEnough=o>=n.itemInfo.count;var a=this.isEnough?ColorUtil.GREEN:ColorUtil.RED,r='<font color="'+a+'">'+o+"</font>/"+n.itemInfo.count;this.eNumLab.textFlow=(new egret.HtmlTextParser).parser(r),this.attr1.text=i?AttributeData.getAttStr(i.arrts,4,1,":"):"",this.attr2.text=AttributeData.getAttStr(n.arrts,4,1,":"),this.attr0.visible=!1,this.redPoint.visible=this.isEnough,this.eNumLab.visible=this.eIcon.visible=this.attr1.visible=this.attr2.visible=!0,this.schedule0.getMaxValue()!=n.exp?this.schedule0.setData(t.keYinExp,n.exp):this.schedule0.setValue(t.keYinExp)}else this.redPoint.visible=this.isEnough=!0,this.eBtn.visible=this.eNumLab.visible=this.eIcon.visible=this.eLvLab.visible=this.attr0.visible=this.attr1.visible=this.attr2.visible=!1;this.compose.label=i?"刻印":"开启",this.powerPanel.setPower(i?BagCT.getAttrPower(i.arrts):0)},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&this.update()},enumerable:!0,configurable:!0}),e.prototype.onClick=function(t){switch(t.target){case this.compose:this.isEnough?WingCT.ins().sendKeYin(this._curRole):TipsCT.ins().showTips("材料不足");break;case this.eBtn:var e=WingCT.ins().getGodWing(this.curRole);e&&ViewManager.ins().open(ShenYuKeYinTipsWin,e.keYinLv)}},e}(BaseEuiView);__reflect(GodWingKeYinPanel.prototype,"GodWingKeYinPanel"),ViewManager.ins().reg(GodWingKeYinPanel,LayerManager.UI_Main),window.GodWingKeYinPanel=GodWingKeYinPanel;var GodWingPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="ShenYuEquipSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.attr,this.onClick),this.addTouchEndEvent(this.skill,this.onTouch),this.addTouchEndEvent(this.replace,this.onClick),this.addTouchEndEvent(this.replace0,this.onClick),this.addTouchEndEvent(this.getItemTxt,this.onClick),this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateItem);for(var i=0;i<WingCT.GodWingMaxSlot;i++)this.addTouchEvent(this["item"+i],this.onTab);this.slot=1,this.updateGodWing()},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&this.updateGodWing()},enumerable:!0,configurable:!0}),e.prototype.onTab=function(t){for(var e=0;e<WingCT.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?(this.slot=e+1,this["item"+e].setSelect(!0),this.updateGodWing()):this["item"+e].setSelect(!1)},e.prototype.onClick=function(t){switch(t.target){case this.attr:ViewManager.ins().open(GodWingSuitTipsWin,this.curRole);break;case this.replace:var e=this["item"+(this.slot-1)].data;if(e){if(e=GlobalConfig.GodWingLevelConfig[e.level][e.slot],!WingCT.ins().wearItemRedPoint(this.curRole,this.slot))return void TipsCT.ins().showTips("无可穿戴的高阶神羽");var i=WingCT.ins().getWearItem(this.curRole,this.slot);i||(i=e.itemId),WingCT.ins().sendWingWear(this.curRole,i)}break;case this.replace0:var n=WingCT.ins().getCurLevelItemId(this.curRole,this.slot);if(WingCT.ins().isQuicComposeGodWing(this.curRole,this.slot)){if(n){var s=WingCT.ins().getNextLevel(n.level);n=GlobalConfig.GodWingLevelConfig[s][this.slot]}else{var s=WingCT.ins().getStartLevel(this.slot);n=GlobalConfig.GodWingLevelConfig[s][this.slot]}if(!WingCT.ins().checkGodWingLevel(this.curRole,n.itemId))return void TipsCT.ins().showTips("不符合穿戴要求");if(!WingCT.ins().checkGodWingItem(this.curRole,n.itemId,this.slot))return void TipsCT.ins().showTips("没有足够的材料");WingCT.ins().sendWingCompose(1,n.itemId,this.curRole)}else n&&n.level&&!WingCT.ins().getNextLevel(n.level)?TipsCT.ins().showTips("当前道具已是最高等级无法继续合成"):TipsCT.ins().showTips("道具不足或穿戴等级不足");break;case this.getItemTxt:var o=this["item"+(this.slot-1)].data;if(o){o=GlobalConfig.GodWingItemConfig[o.itemId];var a=o.itemId;WingCT.ins().getGodWing(this.curRole).getLevel(this.slot)||o instanceof GodWingItemConfig&&(a=o.composeItem.id),WarnCT.ins().setBuyGoodsWarn(a)}}},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.skill:ViewManager.ins().open(GodWingSkillTipsWin,this.skill.data,this.isActive)}},e.prototype.updateGodWing=function(){this.updateItem()},e.prototype.updateItem=function(){var t=WingCT.ins().getGodWing(this.curRole),e=t.getData(),i=t.getLevel(this.slot);if(this.attr0.visible=i?!1:!0,this.attr1.visible=this.attr2.visible=!this.attr0.visible,this.state0.visible=this.power0.visible=this.attr0.visible,this.power1.visible=this.power2.visible=!this.power0.visible,this.state1.visible=this.state2.visible=!this.state0.visible,this.attr3.visible=this.power3.visible=this.state3.visible=!1,i&&!WingCT.ins().getNextLevel(i)){this.attr3.visible=this.power3.visible=this.state3.visible=!0;for(var n=0;3>n;n++)this["attr"+n].visible=this["power"+n].visible=this["state"+n].visible=!this.attr3.visible}var s,o,a=0,r=t.getSuitSum();if(r>=WingCT.GodWingMaxSlot){var l=t.getSuitLevel(),h=GlobalConfig.GodWingSuitConfig[l];h&&(a=h.precent/1e4)}var u=GlobalConfig.GodWingLevelExtraConfig[t.keYinSuitLv],p=0;if(u&&(p=u.attrsRate/1e4,a+=p),this.attr0.visible){var c=WingCT.ins().getStartLevel(this.slot),d=GlobalConfig.GodWingLevelConfig[c][this.slot];s=GlobalConfig.GodWingItemConfig[d.itemId];var g=Math.floor(BagCT.getAttrPower(s.attr));this.power0.text="战斗力："+(g+s.exPower),this.power0.visible=!0,this.attr0.text=AttributeData.getAttStr(s.attr,0,1,"：");var f=AttributeData.getAttStr(s.attr,0,1,"：")+"\n";f+=AttributeData.getExAttrNameByAttrbute(s.exattr[0],!0),this.attr0.text=f}if(this.attr1.visible){var v=WingCT.ins().getCurLevelItemId(this.curRole,this.slot);if(v){s=GlobalConfig.GodWingItemConfig[v.itemId];var y=AttributeData.getPercentAttr(s.attr,a),m=Math.floor(BagCT.getAttrPower(y));this.power1.text="战斗力："+(m+s.exPower);var T=AttributeData.getPercentAttr(s.attr,p),f=AttributeData.getAttStr(T,0,1,"：")+"\n";f+=AttributeData.getExAttrNameByAttrbute(s.exattr[0],!0),this.attr1.text=f}if(v=WingCT.ins().getNextLevelItemId(this.curRole,this.slot)){o=GlobalConfig.GodWingItemConfig[v.itemId];var y=AttributeData.getPercentAttr(o.attr,a),C=Math.floor(BagCT.getAttrPower(y));this.power2.text="战斗力："+(C+o.exPower);var T=AttributeData.getPercentAttr(o.attr,p),f=AttributeData.getAttStr(T,0,1,"：")+"\n";f+=AttributeData.getExAttrNameByAttrbute(o.exattr[0],!0),this.attr2.text=f}}if(this.attr3.visible){var v=WingCT.ins().getCurLevelItemId(this.curRole,this.slot);s=GlobalConfig.GodWingItemConfig[v.itemId];var y=AttributeData.getPercentAttr(s.attr,a),g=Math.floor(BagCT.getAttrPower(y));this.power3.text="战斗力："+(g+s.exPower),this.power3.visible=!0;var T=AttributeData.getPercentAttr(s.attr,p),f=AttributeData.getAttStr(T,0,1,"：")+"\n";f+=AttributeData.getExAttrNameByAttrbute(s.exattr[0],!0),this.attr3.text=f}var b=s;if(this.costName.visible=this.costImg0.visible=this.cost0.visible=!0,!this.attr0.visible){var I=WingCT.ins().getNextLevel(s.level);if(I){var w=GlobalConfig.GodWingLevelConfig[I][this.slot];b=GlobalConfig.GodWingItemConfig[w.itemId]}else this.costName.visible=this.costImg0.visible=this.cost0.visible=!1}this.updateCost(b);for(var n=0;4>n;n++){this["item"+n].data=null,this["item"+n].setSelect(!1),this["item"+n].setCountVisible(!1);var S=WingCT.ins().getGodWing(this.curRole).getLevel(n+1);this["item"+n].setNameVisible(S)}this["item"+(this.slot-1)].data=s,WingCT.ins().getCurLevelItemId(this.curRole,this.slot)||this["item"+(this.slot-1)].setImgIcon("sybg"+this.slot),this["item"+(this.slot-1)].setSelect(!0),this["item"+(this.slot-1)].setCountVisible(!1);var _=WingCT.ins().getGodWing(this.curRole).getLevel(this.slot);this["item"+(this.slot-1)].setNameVisible(_);for(var n=1;4>=n;n++)if(n!=this.slot){var B=void 0,D=!1;e[n]?(B=e[n].level,D=!0):B=WingCT.ins().getStartLevel(n);var x=GlobalConfig.GodWingLevelConfig[B][n],R=GlobalConfig.GodWingItemConfig[x.itemId];R&&(this["item"+(n-1)].data=R,D||(this["item"+(n-1)].setImgIcon("sybg"+n),this["item"+(n-1)].setQuality("quality0")))}this.updatePower(),this.updateRedPoint(),this.updateSkill()},e.prototype.setNnactive=function(){for(var t in GlobalConfig.GodWingSuitConfig){var e=GlobalConfig.GodWingSuitConfig[t];this.skill.data=e,this.skill.setCountVisible(!1),this.skill.setImgIcon("sy100000");break}},e.prototype.updateSkill=function(){var t,e=WingCT.ins().getGodWing(this.curRole),i=e.getSuitLevel();if(this.isActive=!1,!i)return this.setNnactive(),0;var n=GlobalConfig.GodWingSuitConfig[i];if(n.skillname&&(this.isActive=!0),t=n,this.skill.data=t,this.skill.setCountVisible(!1),!this.isActive){this.skill.setImgIcon("sy100000");for(var s in GlobalConfig.GodWingSuitConfig){var o=GlobalConfig.GodWingSuitConfig[s];o.skillname&&this.skill.setNameText(o.skillname)}}},e.prototype.updateCost=function(t){if(t){var e=BagCT.ins().getBagItemById(t.composeItem.id),i=e?e.count:0,n=WingCT.ins().getGodWing(this.curRole).getLevel(this.slot);if(n){var s=GlobalConfig.GodWingLevelConfig[n][this.slot];s.itemId==t.composeItem.id&&(i+=1)}var o=GlobalConfig.ItemConfig[t.composeItem.id];this.costImg0.source=o.icon+"_png",this.costImg0.visible=!1;var a;a=i>=t.composeItem.count?ColorUtil.GREEN:ColorUtil.RED,this.cost0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:"+i+"|/|C:0xD1C28F&T:"+t.composeItem.count),this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text);var r=GlobalConfig.ItemConfig[t.composeItem.id];a=ItemUtil.getQualityColor(r),this.costName.textFlow=TextFlowMaker.generateTextFlow1("消耗|C:"+a+"&T:"+r.name+"|C:65280&T::")}},e.prototype.updateRedPoint=function(){for(var t=0;t<WingCT.GodWingMaxSlot;t++)this["item"+t].updateRedPoint(WingCT.ins().gridRedPoint(this.curRole,t+1));this.redPointReplace.visible=WingCT.ins().wearItemRedPoint(this.curRole,this.slot),this.redPointReplace0.visible=WingCT.ins().quickComposeRedPoint(this.curRole,this.slot)},e.prototype.updatePower=function(){var t=WingCT.ins().getGodWing(this.curRole),e=t.getData(),i=0,n=0,s=t.getSuitSum();if(s>=WingCT.GodWingMaxSlot){var o=t.getSuitLevel(),a=GlobalConfig.GodWingSuitConfig[o];a&&(n=a.precent/1e4)}var r=GlobalConfig.GodWingLevelExtraConfig[t.keYinSuitLv];r&&(n+=r.attrsRate/1e4);for(var l in e){var h=GlobalConfig.GodWingLevelConfig[e[l].level][e[l].slot],u=GlobalConfig.GodWingItemConfig[h.itemId],p=u.exPower?u.exPower:0,c=AttributeData.getPercentAttr(u.attr,n);i+=Math.floor(BagCT.getAttrPower(c))+p}this.powerPanel.setPower(i)},e}(BaseView);__reflect(GodWingPanel.prototype,"GodWingPanel"),window.GodWingPanel=GodWingPanel;var GodWingSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuSkillTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.gwsConfig=t[0];var i=t[1];for(var n in GlobalConfig.GodWingSuitConfig){var s=GlobalConfig.GodWingSuitConfig[n];if(s.skillname&&s.lv>this.gwsConfig.lv){this.nextConfig=s;break}}i?this.nextConfig?this.currentState="active":this.currentState="max":this.currentState="unactive",this.validateNow(),this.updateDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeObserve()},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.updateDesc=function(){this.setCurDesc(),this.setNextDesc()},e.prototype.setCurDesc=function(){this.icon.data=this.gwsConfig,this.icon.setNameVisible(!1),this.icon.setCountVisible(!1),this.content.textFlow=TextFlowMaker.generateTextFlow1(this.gwsConfig.skilldesc),this.lv.text="等级："+(this.gwsConfig.skilllevel?this.gwsConfig.skilllevel:0);
var t=GlobalConfig.GodWingLevelConfig[this.gwsConfig.lv][1],e=GlobalConfig.GodWingItemConfig[t.itemId].showlv;this.condition.text="所有神羽达到"+e+"阶"},e.prototype.setNextDesc=function(){if(this.nextConfig){this.icon0.data=this.nextConfig,this.icon0.setNameVisible(!1),this.icon0.setCountVisible(!1),this.content0.textFlow=TextFlowMaker.generateTextFlow1(this.nextConfig.skilldesc),this.lv0.text="等级："+this.nextConfig.skilllevel;var t=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1],e=GlobalConfig.GodWingItemConfig[t.itemId].showlv;this.condition0.text="所有神羽达到"+e+"阶"}},e}(BaseEuiView);__reflect(GodWingSkillTipsWin.prototype,"GodWingSkillTipsWin"),ViewManager.ins().reg(GodWingSkillTipsWin,LayerManager.UI_Popup),window.GodWingSkillTipsWin=GodWingSkillTipsWin;var GodWingSuitTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuSuitTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.roleIndex=t[0];var i=WingCT.ins().getGodWing(this.roleIndex).getSuitLevel(),n=0;if(i&&(n=WingCT.ins().getNextLevel(i)),this.gwsConfig=GlobalConfig.GodWingSuitConfig[i],!this.gwsConfig)for(var s in GlobalConfig.GodWingSuitConfig){this.gwsConfig=GlobalConfig.GodWingSuitConfig[s];break}i?(this.nextConfig=GlobalConfig.GodWingSuitConfig[n],this.nextConfig?this.currentState="active":this.currentState="max"):this.currentState="unactive",this.validateNow(),this.updateDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.updateDesc=function(){this.setCurDesc(),this.setNextDesc()},e.prototype.setCurDesc=function(){if("unactive"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100),e=WingCT.GodWingMaxSlot,i=WingCT.ins().getGodWing(this.roleIndex).getSuitSum();this.content0.text="激活条件：全部神羽1阶可激活（"+i+"/"+e+"）\n激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else if("max"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else{var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}},e.prototype.setNextDesc=function(){if("active"==this.currentState){for(var t=Math.floor(this.nextConfig.precent/100),e=WingCT.GodWingMaxSlot,i=WingCT.ins().calcGodWingSlot(this.roleIndex),n=0,s=0;s<i.length;s++)i[s].level>=this.nextConfig.lv&&n++;var o=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1],a=GlobalConfig.GodWingItemConfig[o.itemId].showlv;this.content1.text="激活条件：全部神羽"+a+"阶可激活（"+n+"/"+e+"）\n激活属性：翅膀全属性+"+t+"%",this.name1.text=this.nextConfig.suitname}},e}(BaseEuiView);__reflect(GodWingSuitTipsWin.prototype,"GodWingSuitTipsWin"),ViewManager.ins().reg(GodWingSuitTipsWin,LayerManager.UI_Popup),window.GodWingSuitTipsWin=GodWingSuitTipsWin;var GodWingTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShenYuTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.otherClose),this.gwConfig=t[0],this.updateTips()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.updateTips=function(){var t=GlobalConfig.ItemConfig[this.gwConfig.itemId];this.nameLabel.text=t.name,this.type.text=WingCT.ins().getNameFromSlot(this.gwConfig.slot),this.lv.text="翅膀"+this.gwConfig.level+"阶可穿戴";for(var e=16711680,i=0;i<SubRoles.ins().subRolesLen;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(n&&n.wingsData.lv+1>=this.gwConfig.level){e=65280;break}}this.lv.textColor=e,this.nameLabel.textColor=ItemUtil.getQualityColor(t);for(var s=this.gwConfig.attr,o=this.gwConfig.exattr,a="",r=this.gwConfig.exPower,i=0;i<s.length;i++)a+=AttributeData.getAttrStrByType(s[i].type)+": ",a+=s[i].value+"\n";for(var i=0;i<o.length;i++){a+=AttributeData.getExtAttrStrByType(o[i].type)+": ";var l=o[i].value;(26==o[i].type||42==o[i].type)&&(l/=100,a+=l,a+="%"),a+="\n"}var h=a.lastIndexOf("\n");a=a.substring(0,h),this.attr0.text=a;var u=s,p=Math.floor(BagCT.getAttrPower(u))+r;this.score.text="评分："+p,this.powerPanel.setPower(p),this.itemIcon.data=this.gwConfig,this.itemIcon.setNameVisible(!1),this.itemIcon.setCountVisible(!1),this.quali.source="quali"+ItemUtil.getQuality(t)},e}(BaseEuiView);__reflect(GodWingTipsWin.prototype,"GodWingTipsWin"),ViewManager.ins().reg(GodWingTipsWin,LayerManager.UI_Popup),window.GodWingTipsWin=GodWingTipsWin;var GodWingTransferPanel=function(t){function e(){var e=t.call(this)||this;return e._sn_="ShenYuTransferSkin",e}return __extends(e,t),e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.transfer,this.onClick),this.removeTouchEvent(this.have,this.onListTap),this.removeTouchEvent(this.item0,this.onClick),this.removeObserve(),this.reset();for(var i=1;i<WingCT.GodWingMaxSlot;i++)this.removeTouchEvent(this["item"+i],this.onTouchItem)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.transfer,this.onClick),this.addTouchEvent(this.have,this.onListTap),this.addTouchEvent(this.item0,this.onClick),this.observe(BagCT.ins().postItemAdd,this.callbackUpdate),this.itemList=new eui.ArrayCollection,this.have.itemRenderer=GodWingItem,this.have.dataProvider=new eui.ArrayCollection([]),this.updateGodWing()},e.prototype.reset=function(){if(this.skin){for(var t=1;t<WingCT.GodWingMaxSlot;t++)this.addTouchEvent(this["item"+t],this.onTouchItem),this["item"+t].setCountVisible(!1),this["item"+t].setNameVisible(!1),this["item"+t].setImgIcon(""),this["item"+t].setSelect(!1),this["item"+t].data=null;this.item0.setCountVisible(!1),this.item0.setImgIcon(""),this.item0.setNameVisible(!1),this.item0.data=null,this.updateBagList(),this.warn.visible=!this.itemList.length,this.curItemId=0,this.desId=0}},e.prototype.updateBagList=function(){var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_16);this.itemList.replaceAll(t),this.have.dataProvider=this.itemList},e.prototype.callbackUpdate=function(){if(this.item0.itemId){var t=BagCT.ins().getBagItemById(this.item0.itemId);t||this.reset(),this.updateBagList(),this.updateCost()}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.transfer:Boolean(BagCT.ins().getBagGoodsByType(ItemType.TYPE_16))?this.item0.itemId&&this.desId?WingCT.ins().sendResetGodWing(this.item0.itemId,this.desId):TipsCT.ins().showTips("请确认转换源和转换目标"):TipsCT.ins().showTips("不可转换");break;case this.item0:if(this.curItemId){var e=GlobalConfig.GodWingItemConfig[this.curItemId];ViewManager.ins().open(GodWingTipsWin,e)}}},e.prototype.onTouchItem=function(t){for(var e=1;e<WingCT.GodWingMaxSlot;e++)t.currentTarget==this["item"+e]?t.currentTarget.itemId&&(this.desId=t.currentTarget.itemId,this["item"+e].setSelect(!0)):this["item"+e].setSelect(!1)},e.prototype.onListTap=function(t){if(t&&t.currentTarget&&this.have.selectedItem){var e=this.have.selectedItem;this.curItemId=e.configID;var i=GlobalConfig.GodWingItemConfig[e._configID],n=GlobalConfig.GodWingLevelConfig[i.level];this.item0.data=i,this.item0.setNameVisible(!0);var s=GlobalConfig.ItemConfig[e._configID];this.item0.setImgIcon(s.icon+"_png");var o=1;for(var a in n)if(n[a].slot!=i.slot&&(this["item"+o].data=GlobalConfig.GodWingItemConfig[n[a].itemId],this["item"+o].setNameVisible(!0),this["item"+o].setSelect(!1),o++,o>3))break;this.updateCost()}},e.prototype.updateGodWing=function(){this.reset(),this.updateCost()},e.prototype.updateCost=function(){if(!this.curItemId)return void(this.costImg0.visible=this.cost.visible=!1);this.costImg0.visible=this.cost.visible=!0;var t=GlobalConfig.GodWingItemConfig[this.curItemId];this.cost.text=t.needMoney+""},e}(BaseView);__reflect(GodWingTransferPanel.prototype,"GodWingTransferPanel"),window.GodWingTransferPanel=GodWingTransferPanel;var GodWingWin=function(t){function e(){var e=t.call(this)||this;return e.roleIndex=0,e._sn_="ShenYuSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(GodWingRedPoint.ins().postGodWingRedPoint,this.updateRedPoint),this.observe(GodWingRedPoint.ins().postGodWingItem,this.updateRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.updateRedPoint),this.roleIndex=t[0]?t[0]:0,this.roleSelect.setCurRole(this.roleIndex),this.setRoleId(this.roleIndex),this.setOpenIndex(0),this.updateRedPoint()},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return!0},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setRoleId=function(t){this.godWingPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.roleSelect.openRole();break;case 1:this.roleSelect.hideRole();break;case 2:this.roleSelect.hideRole();break;case 3:this.roleSelect.openRole()}this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.updateRedPoint=function(){if(GodWingRedPoint.ins().tabs||(GodWingRedPoint.ins().tabs={}),this.redPoint0.visible=GodWingRedPoint.ins().tabs[0],this.redPoint1.visible=GodWingRedPoint.ins().tabs[1],!this.tab.selectedIndex)for(var t=0;t<SubRoles.ins().subRolesLen;t++)this.roleSelect.showRedPoint(t,GodWingRedPoint.ins().roleTabs[this.tab.selectedIndex][t])},e}(BaseEuiView);__reflect(GodWingWin.prototype,"GodWingWin"),ViewManager.ins().reg(GodWingWin,LayerManager.UI_Main),window.GodWingWin=GodWingWin;var ShenYuKeYinTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ShenYuKeYinTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEndEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(t[0])},e.prototype.update=function(t){var e=null,i=null;for(var n in GlobalConfig.GodWingLevelExtraConfig)t>=GlobalConfig.GodWingLevelExtraConfig[n].level&&(e=GlobalConfig.GodWingLevelExtraConfig[n]),!i&&t<GlobalConfig.GodWingLevelExtraConfig[n].level&&(i=GlobalConfig.GodWingLevelExtraConfig[n]);var s="";e&&(s+="当前阶段：刻印等级：lv"+t+"\n",s+="       效果：神羽基础属性|C:"+ColorUtil.GREEN+"&T:+"+e.attrsRate/100+"%|\n"),i&&(s+="下一阶段：刻印等级：lv"+i.level+" （未激活）\n",s+="       效果：神羽基础属性|C:"+ColorUtil.RED+"&T:+"+i.attrsRate/100+"%|"),this.eTxt.textFlow=TextFlowMaker.generateTextFlow(s)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShenYuKeYinTipsWin.prototype,"ShenYuKeYinTipsWin"),ViewManager.ins().reg(ShenYuKeYinTipsWin,LayerManager.UI_Main),window.ShenYuKeYinTipsWin=ShenYuKeYinTipsWin;var GuardMainUI=function(t){function e(){var e=t.call(this)||this;return e.isDelayBuff=!1,e.skillCd1=0,e.skillCd2=0,e.skillCd3=0,e.isDelayUpdateInfo=!1,e.skinName="guardGodWeaponUISkind",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.help,this.onHelp),this.addTouchEvent(this.luckyBossBtn,this.onLuckBoss),this.addTouchEvent(this.skillBtn1,this.useSkill),this.addTouchEvent(this.skillBtn2,this.useSkill),this.addTouchEvent(this.skillBtn3,this.useSkill),this.observe(GameLogic.ins().postHpChange,this.updateHead),this.observe(FbCT.ins().postGuardCopyInfo,this.delayUpdateInfo),this.observe(SkillCT.ins().postDoBuff,this.doBuff),this.observe(SkillCT.ins().postDoRemoveBuff,this.doBuff),this.observe(FbCT.ins().postGuardUseSkill,this.useSkillHandler),void 0!=GuardWeaponModel.ins().leftTime?this.beginTime():this.observe(FbCT.ins().postGuardLeftTime,this.beginTime),this.updateHeadIcon(),this.initHp(),this.updateInfo(),this.skillBtn1.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[0],this.skillBtn2.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[1],this.skillBtn3.icon=""+GlobalConfig.GuardGodWeaponConf.sSkillIcon[2],this.skillcostnum1.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[0],this.skillcostnum2.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[1],this.skillcostnum3.text=""+GlobalConfig.GuardGodWeaponConf.sSkillCost[2],this.shortcutCD1=new ShortcutCD(40),this.cdGroup1.addChild(this.shortcutCD1),this.shortcutCD2=new ShortcutCD(40),this.cdGroup2.addChild(this.shortcutCD2),this.shortcutCD3=new ShortcutCD(40),this.cdGroup3.addChild(this.shortcutCD3)},e.prototype.close=function(){},e.prototype.updateHeadIcon=function(){for(var t=(SubRoles.ins().subRolesLen,0);3>t;t++){var e=this["player"+(t+1)+"touxiang"],i=SubRoles.ins().getSubRoleByIndex(t);i?e.source="yuanhead"+i.job+i.sex:e.visible=!1}},e.prototype.onHelp=function(){ViewManager.ins().open(ZsBossRuleSpeak,29)},e.prototype.updateBuffInfo=function(){this.isDelayBuff=!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)this.setBuff(e)},e.prototype.doBuff=function(){this.isDelayBuff||(this.isDelayBuff=!0,Timer.start(80,1,this.updateBuffInfo,this))},e.prototype.setBuff=function(t){var e=EntityManager.ins().getMainRole(t);e&&(this["littleBuff"+(t+1)].visible=e.hasBuff(59100))},e.prototype.useSkill=function(t){var e=t.target,i=1;switch(e){case this.skillBtn1:i=1;break;case this.skillBtn2:i=2;break;case this.skillBtn3:if(i=3,SkillCT.ins().hejiEnable)return void TipsCT.ins().showTips("怒气已满")}var n=GuardWeaponModel.ins().guardCopyInfo,s=this["skillCd"+i];s>0?TipsCT.ins().showTips("技能CD中,还剩"+s+"秒"):n.score<GlobalConfig.GuardGodWeaponConf.sSkillCost[i-1]?TipsCT.ins().showTips("技能积分不足"):FbCT.ins().guardUseSkill(i)},e.prototype.useSkillHandler=function(t){this["shortcutCD"+t].play(GlobalConfig.GuardGodWeaponConf.sSkillCd[t-1]),this["skillCd"+t]=GlobalConfig.GuardGodWeaponConf.sSkillCd[t-1];var e="|C:0x00ff00&T:"+GlobalConfig.GuardGodWeaponConf.sSkillUseText[t-1]+"|";TipsCT.ins().showTips(e)},e.prototype.delayUpdateInfo=function(){this.isDelayUpdateInfo||(this.isDelayUpdateInfo=!0,Timer.start(200,1,this.updateInfo,this))},e.prototype.updateInfo=function(){this.isDelayUpdateInfo=!1;var t=GuardWeaponModel.ins().guardCopyInfo;this.refreshHints0.text="（"+t.wave+"/"+GuardWeaponModel.ins().getMaxWaves()+"）";var e;this.lastWave!=t.wave&&(e=GuardWeaponModel.ins().getWaveTime(t.wave),this.refreshHints1.text=""+e),this.lastWave=t.wave,this.dangqianbo1.text=""+t.minMonsterWave,this.dangqianbo2.text=""+t.minMonsteNums,this.zongshu2.text=""+t.monsterNum,this.zongshu0.text=""+t.score,this.redPoint.visible=GuardWeaponModel.ins().isCanCallBoss();var i;if(i=void 0==this.lastScore?t.score:t.score-this.lastScore,this.lastScore=t.score,i>0){var n="|C:0x00ff00&T:积分+"+i+"|";TipsCT.ins().showTips(n)}},e.prototype.initHp=function(){for(var t=0;3>t;t++){var e=this["bloodBar"+t],i=SubRoles.ins().getSubRoleByIndex(t);if(i){var n=i.getAtt(AttributeType.atHp),s=i.getAtt(AttributeType.atMaxHp);e.maximum=100,e.value=Math.floor(100*n/s)}else e.visible=!1}},e.prototype.updateHead=function(t){var e=t[0],i=t[1],n=t[2];if(e instanceof CharRole&&i!=n){var s=e.infoModel,o=this["bloodBar"+s.index],a=s.getAtt(AttributeType.atHp),r=s.getAtt(AttributeType.atMaxHp);o.maximum=100,o.value=100*a/r;var l=this["player"+(s.index+1)+"touxiang"];0==a?(l.filters=FilterUtil.ARRAY_GRAY_FILTER,this["time"+(s.index+1)]=GlobalConfig.GuardGodWeaponConf.recoverCD):(l.filters=null,this["time"+(s.index+1)]=0,this["CountDown"+(s.index+1)].visible=!1)}},e.prototype.setTimeLabel=function(t){this["time"+t]--,this["time"+t]>0?(this["CountDown"+t].visible=!0,this["CountDown"+t].text=this["time"+t].toString()):this["CountDown"+t].visible=!1},e.prototype.onLuckBoss=function(){ViewManager.ins().open(GuardCallBossWin)},e.prototype.beginTime=function(){this.isBegin||(this.time=GuardWeaponModel.ins().leftTime,this.isBegin=!0,Timer.start(1e3,0,this.runTime,this))},e.prototype.runTime=function(){this.time-=1,this.time>0?this.lastTime.text=DateUtils.getFormatBySecond(this.time,DateUtils.TIME_FORMAT_12):(this.lastTime.text="",Timer.stop(this.runTime,this));var t=this.refreshHints1.text,e=+t;e>0&&(e--,this.refreshHints1.text=""+e);for(var i=1;3>=i;i++)this["time"+i]>0&&this.setTimeLabel(i),this.setSkillCd(i)},e.prototype.setSkillCd=function(t){this["skillCd"+t]>0&&this["skillCd"+t]--},e}(BaseEuiView);__reflect(GuardMainUI.prototype,"GuardMainUI"),ViewManager.ins().reg(GuardMainUI,LayerManager.UI_Main),window.GuardMainUI=GuardMainUI;var GuardCopyInfo=function(){function t(){this.wave=0,this.score=0,this.callBossNum=0,this.monsterNum=0,this.minMonsterWave=0,this.minMonsteNums=0}return t.prototype.parser=function(t,e,i,n,s,o){this.wave=t,this.score=e,this.callBossNum=i,this.monsterNum=n,this.minMonsterWave=s,this.minMonsteNums=o},t}();__reflect(GuardCopyInfo.prototype,"GuardCopyInfo"),window.GuardCopyInfo=GuardCopyInfo;var GuardWeaponModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShowSweep=!1,e.guardCopyInfo=new GuardCopyInfo,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.canChallenge=function(){return this.isOpen()&&GlobalConfig.GuardGodWeaponConf.dailyCount>this.challengeTimes},e.prototype.isOpen=function(){var t=GlobalConfig.GuardGodWeaponConf.opencondition,e=t[0],i=t[1];return ZsCT.ins().lv>=e&&GameServer.serverOpenDay+1>=i},e.prototype.getCanSee=function(){var t=GlobalConfig.GuardGodWeaponConf.opencondition,e=t[1];return GameServer.serverOpenDay+1>=e},e.prototype.getDesc=function(){var t=GlobalConfig.GuardGodWeaponConf.opencondition,e=t[0],i=t[1];return"开服第"+i+"天并达到"+e+"转开启"},e.prototype.getMaxWaves=function(){var t=GlobalConfig.GGWWaveConf[ZsCT.ins().lv]||{};return Object.keys(t).length},e.prototype.getWaveTime=function(t){return 0==t?GlobalConfig.GuardGodWeaponConf.starDelayRsf:GlobalConfig.GGWWaveConf[ZsCT.ins().lv][t].time},e.prototype.isCanCallBoss=function(){return this.getCallBossTimes()>0},e.prototype.getCallBossTimes=function(){var t=this.guardCopyInfo.wave,e=0;for(var i in GlobalConfig.GuardGodWeaponConf.sSummonLimit)t>=+i&&(e+=GlobalConfig.GuardGodWeaponConf.sSummonLimit[i]);return e-this.guardCopyInfo.callBossNum},e.prototype.callBossMoney=function(){var t=this.getCallBossTimes();return GlobalConfig.GuardGodWeaponConf.sSummonCost[t-1]},e.prototype.getKillWave=function(){return this.guardCopyInfo.wave},e}(BaseClass);__reflect(GuardWeaponModel.prototype,"GuardWeaponModel"),window.GuardWeaponModel=GuardWeaponModel;var GuardCallBossWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponBossTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){var t=GuardWeaponModel.ins().getCallBossTimes(),e=GuardWeaponModel.ins().callBossMoney();this.callTimesLable.text=""+t,0==t&&(e=0),this.zb0.text=""+e,this.time=t,this.money=e,this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.up,this.callBoss)},e.prototype.callBoss=function(){this.time>0?Actor.yb<this.money?TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):FbCT.ins().callGuardBoss():TipsCT.ins().showTips("没有召唤BOSS次数"),this.closeWin()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardCallBossWin.prototype,"GuardCallBossWin"),ViewManager.ins().reg(GuardCallBossWin,LayerManager.UI_Popup),window.GuardCallBossWin=GuardCallBossWin;var GuardLogsListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="UIshowDropNoticeSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=GlobalConfig.GuardGodWeaponConf.UIshowDrop[this.data.noticeId];t=t?t:16777215;var e=GlobalConfig.GuardGodWeaponConf.UIshowDropNotice;e=StringUtils.replace(e,this.data.roleName,this.data.monsterName,"|C:"+t+"&T:"+this.data.itemName),this.showText.textFlow=TextFlowMaker.generateTextFlow1(e)}},e}(BaseItemRender);__reflect(GuardLogsListRenderer.prototype,"GuardLogsListRenderer"),window.GuardLogsListRenderer=GuardLogsListRenderer;var GuardQuitTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponQuiteTip",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.BG,this.closeWin),this.addTouchEvent(this.up,this.onQuit)},e.prototype.onQuit=function(){FbCT.ins().sendExitFb(),this.closeWin()},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardQuitTips.prototype,"GuardQuitTips"),ViewManager.ins().reg(GuardQuitTips,LayerManager.UI_Popup),window.GuardQuitTips=GuardQuitTips;var GuardRewardWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponTishiSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.giveUp,this.closeWin)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(GuardRewardWin.prototype,"GuardRewardWin"),ViewManager.ins().reg(GuardRewardWin,LayerManager.UI_Popup),window.GuardRewardWin=GuardRewardWin;var GuardWeaponPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.itemList.itemRenderer=ItemBase,this.noticeList.itemRenderer=GuardLogsListRenderer,this.addTouchEvent(this.btnChallenge,this.challenge)},e.prototype.addDisplay=function(){this.observe(FbCT.ins().postGuardWeaponLogs,this.updateLogs),this.observe(FbCT.ins().postGuardInfo,this.updateChallgeTimes),this.updateChallgeTimes(),this.itemList.dataProvider=new eui.ArrayCollection(GlobalConfig.GuardGodWeaponConf.showReward[ZsCT.ins().lv]),FbCT.ins().sendGuardWeaponLogs(),this.btnChallenge.label=GuardWeaponModel.ins().isShowSweep?"扫  荡":"挑  战"},e.prototype.updateChallgeTimes=function(){this.lbTime.text=(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes).toString()},e.prototype.challenge=function(){if(GuardWeaponModel.ins().isShowSweep){if(GlobalConfig.GuardGodWeaponConf.dailyCount-GuardWeaponModel.ins().challengeTimes<=0)return void TipsCT.ins().showCenterTips("今天次数已用完，请明天再参加");ViewManager.ins().open(BuySpecialWin)}else{if(!KfArenaSys.ins().checkIsMatching())return;FbCT.ins().challengeGuard()}},e.prototype.updateLogs=function(t){this.noticeList.dataProvider=new eui.ArrayCollection(t)},e}(BaseView);__reflect(GuardWeaponPanel.prototype,"GuardWeaponPanel"),window.GuardWeaponPanel=GuardWeaponPanel;var ShortcutCD=function(t){function e(e){var i=t.call(this)||this;return i.setSize(e),i}return __extends(e,t),e.prototype.setSize=function(t){this.radius=t,this.graphics.clear(),this.graphics.beginFill(0,.9),this.graphics.drawCircle(0,0,t),this.graphics.endFill(),this.visible=!1},e.prototype.play=function(t){t*=1e3,t>0&&(this.visible=!0,this.duration=t,this.startTime=egret.getTimer(),egret.startTick(this.onUpdate,this))},e.prototype.onUpdate=function(){var t=egret.getTimer(),e=t-this.startTime;return e>=this.duration?(this.stop(),!1):(this.graphics.clear(),this.graphics.beginFill(0,.7),this.graphics.moveTo(0,0),this.graphics.lineTo(this.radius,0),this.graphics.drawArc(0,0,this.radius,e/this.duration*2*Math.PI-Math.PI/2,2*Math.PI-Math.PI/2),this.graphics.lineTo(0,0),this.graphics.endFill(),!1)},e.prototype.stop=function(){this.visible=!1,egret.stopTick(this.onUpdate,this),this.graphics.clear()},e}(egret.Shape);__reflect(ShortcutCD.prototype,"ShortcutCD"),window.ShortcutCD=ShortcutCD;var Guild=function(t){function e(){var e=t.call(this)||this;return e.guildID=0,e.guildName="",e.guildLv=0,e._buildingLevels=[],e.money=0,e.notice="",e.records=[],e.guildListInfos=[],e._guildMembers=[],e.applyGuilds=[],e._guillRoleSkillInfo=[],e.guildTaskInfos=new eui.ArrayCollection,e.isFirstGetMessageInfo=!0,e._memberSortType=0,e.pageMax=1,e.hasApply=!1,e.changeNameNum=0,e.hasNewMsg=!1,e.sendToFireCount=[],e.isAuto=1,e.attrLimit=99999,e._conCount=[],e.sysId=PackageID.Guild,e.regNetMsg(1,e.postGuildInfo),e.regNetMsg(2,e.postGuildMembers),e.regNetMsg(3,e.postGuildList),e.regNetMsg(4,e.postGuildCreate),e.regNetMsg(6,e.postJoinGuild),e.regNetMsg(7,e.postApplyInfos),e.regNetMsg(8,e.postProcessJoin),e.regNetMsg(9,e.doChangeOffice),e.regNetMsg(11,e.postQuitGuild),e.regNetMsg(12,e.doUpdateGuildInfo),e.regNetMsg(13,e.postGuildMoney),e.regNetMsg(14,e.postChangeNotice),e.regNetMsg(15,e.doGuildSkillInfo),e.regNetMsg(16,e.postLearnGuildSkill),e.regNetMsg(17,e.postUpBuilding),e.regNetMsg(18,e.doPracticeGuildSkill),e.regNetMsg(19,e.doGuildTaskInfos),e.regNetMsg(20,e.doGuildTaskUpdate),e.regNetMsg(22,e.postManageList),e.regNetMsg(23,e.doManage),e.regNetMsg(24,e.postConCount),e.regNetMsg(25,e.postMyGuildInfo),e.regNetMsg(26,e.doGuildMessage),e.regNetMsg(27,e.postAllGuildMessage),e.regNetMsg(28,e.doAddGuildlimit),e.regNetMsg(30,e.postUpdateFire),e.observe(GameLogic.ins().postEnterMap,e.startCheckShow),e.observe(GameLogic.ins().postGuildChange,e.setGuild),e.observe(RoleMgr.ins().postEnterGame,e.initData),e.initData(),e}return __extends(e,t),e.prototype.initData=function(){this.guildMessageInfoData||(this.guildMessageInfoData=new eui.ArrayCollection),this.guildMessageInfoData.removeAll(),this.isFirstGetMessageInfo=!0},e.prototype.setGuild=function(t){var e=t[0],i=t[1];this.guildID!=e&&(this.guildID=e,this.guildName=i,this.sendGuildInfo(),0!=this.guildID&&ViewManager.ins().isShow(GuildApplyWin)&&(ViewManager.ins().close(GuildApplyWin),ViewManager.ins().open(GuildMap)))},e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGuildInfo(),this.sendMyGuildInfo()},e.prototype.getSkllInfoByIndex=function(t){return this._guillRoleSkillInfo[t]},e.prototype.getGuildMembersByIndex=function(t){return this._guildMembers[t]},e.prototype.getGuildTaskInfosByIndex=function(t){return this.guildTaskInfos.getItemAt(t)},e.prototype.getBuildingLevels=function(t){return void 0===t&&(t=-1),-1==t?this._buildingLevels:this._buildingLevels[t]},e.prototype.getConCount=function(t){return void 0===t&&(t=-1),-1==t?this._conCount:this._conCount[t]},e.prototype.sendGuildInfo=function(){this.sendBaseProto(1)},e.prototype.postGuildInfo=function(t){if(this._buildingLevels=[],1==t.readByte()){this.guildID=t.readInt(),this.guildName=t.readString();for(var e=t.readUnsignedByte(),i=0;e>i;i++)this._buildingLevels.push(t.readUnsignedByte());return this.money=t.readInt(),this.notice=t.readString(),this.doAddGuildlimit(t),this.guildLv=this._buildingLevels[0],this.sendGuildMembers(),this.sendGuildSkillInfo(),this.postUpdateFire(t),this.changeNameNum=t.readInt(),[this.guildID,this.guildName]}return!1},e.prototype.sendGuildMembers=function(){this.sendBaseProto(2)},e.prototype.postGuildMembers=function(t){var e=t.readInt();this._guildMembers=[];for(var i=0;e>i;i++){var n=new GuildMemberInfo;n.roleID=t.readInt(),n.name=t.readString(),n.office=t.readUnsignedByte(),n.office==GuildLanguage.guildOffice.length&&(this.guildMaster=n),n.office==GuildLanguage.guildOffice.length-1&&(this.deputyMaster=n),n.job=t.readUnsignedByte(),n.sex=t.readUnsignedByte(),n.vipLevel=t.readInt(),n.monthCard=t.readUnsignedByte(),n.contribution=t.readInt(),n.curContribution=t.readInt(),n.attack=t.readDouble(),n.downTime=t.readUnsignedInt(),n.level=t.readInt(),n.zsLevel=t.readInt(),this._guildMembers.push(n)}},e.prototype.sendGuildList=function(t,e){this.sendBaseProto(3)},e.prototype.postGuildList=function(t){this.guildListInfos=[];for(var e=t.readInt(),i=0;e>i;i++){var n=new GuildListInfo;n.guildRank=i+1,n.guildID=t.readUnsignedInt(),n.guildLevel=t.readUnsignedByte(),n.commentLv=t.readUnsignedByte(),n.guildMember=t.readInt(),n.guildName=t.readString(),n.guildPresident=t.readString(),n.attr=t.readInt(),this.guildListInfos.push(n)}},e.prototype.sendGuildCreate=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(s){switch(s.label){case 0:return[4,platform.checkStr(e,3)];case 1:return i=s.sent().content,n=this.getBytes(4),n.writeByte(t),n.writeString(i),n.writeByte(1),this.sendToServer(n),[2]}})})},e.prototype.postGuildCreate=function(t){var e=t.readUnsignedByte();return 0==e?(this.guildID=t.readUnsignedInt(),ViewManager.ins().close(GuildCreateWin),ViewManager.ins().close(GuildApplyWin),ViewManager.ins().open(GuildMap),TipsCT.ins().showTips("公会创建成功"),this.sendGuildInfo(),!0):!1},e.prototype.sendQuitGuild=function(){this.sendBaseProto(5)},e.prototype.sendJoinGuild=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.postJoinGuild=function(t){this.hasApply=!0},e.prototype.sendApplyInfos=function(){this.sendBaseProto(7)},e.prototype.postApplyInfos=function(t){for(var e=t.readInt(),i=[],n=0;e>n;n++){var s=new GuildApplyInfo;s.roleID=t.readInt(),s.vipLevel=t.readInt(),s.job=t.readUnsignedByte(),s.sex=t.readUnsignedByte(),s.attack=t.readDouble(),s.name=t.readString(),i.push(s)}return this.hasApply=e>0,i},e.prototype.sendProcessJoin=function(t,e){var i=this.getBytes(8);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postProcessJoin=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedByte(),n=this.applyGuilds,s=n.indexOf(e);return-1!=s&&0==i&&n.splice(s,1),1==i?!0:!1},e.prototype.sendChangeOffice=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.doChangeOffice=function(t){for(var e=t.readInt(),i=t.readUnsignedByte(),n=0;n<this._guildMembers.length;n++){var s=this.getGuildMembersByIndex(n);if(s.roleID==e)return void(s.office=i)}},e.prototype.sendDemise=function(){this.sendBaseProto(10)},e.prototype.sendKick=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.postQuitGuild=function(t){var e=t.readInt();return e==Actor.actorID?(this.clearGuildInfo(),ViewManager.ins().close(GuildWin),ViewManager.ins().close(GuildMap),!0):!1},e.prototype.doUpdateGuildInfo=function(t){var e=t.readUnsignedByte();switch(e){case 1:break;case 2:this.sendGuildInfo();break;case 3:this.sendGuildMembers();break;case 4:break;case 5:this.sendApplyInfos();break;case 6:}},e.prototype.sendCon=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.postGuildMoney=function(t){this.money=t.readInt()},e.prototype.sendChangeNotice=function(t){var e=this.getBytes(14);e.writeString(t),this.sendToServer(e)},e.prototype.postChangeNotice=function(t){var e=t.readUnsignedByte();0==e&&(this.notice=t.readString())},e.prototype.sendGuildSkillInfo=function(){this.sendBaseProto(15)},e.prototype.doGuildSkillInfo=function(t){var e=t.readUnsignedByte();this._guillRoleSkillInfo=[];for(var i=0;e>i;i++){for(var n=new GuildRoleSkillInfo,s=t.readUnsignedByte(),o=0;s>o;o++){var a=new GuildSkillInfo;a.level=t.readInt(),n.guildSkillInfo.push(a)}s=t.readUnsignedByte();for(var r=0;s>r;r++){var a=(s[r],new GuildSkillInfo);a.level=t.readInt(),a.exp=t.readInt(),n.practiceSkillInfo.push(a)}this._guillRoleSkillInfo.push(n)}this.postGuildSkillInfo()},e.prototype.postGuildSkillInfo=function(){},e.prototype.sendLearnGuildSkill=function(t,e){var i=this.getBytes(16);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postLearnGuildSkill=function(t){var e=t.readShort(),i=t.readUnsignedByte();this.getSkllInfoByIndex(e).guildSkillInfo[i-1].level=t.readInt(),this.postGuildSkillInfo(),TipsCT.ins().showTips("升级成功")},e.prototype.sendPracticeGuildSkill=function(t,e){var i=this.getBytes(18);
i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.doPracticeGuildSkill=function(t){var e=t.readShort(),i=t.readUnsignedByte();this.getSkllInfoByIndex(e).practiceSkillInfo[i-1].level=t.readInt(),this.getSkllInfoByIndex(e).practiceSkillInfo[i-1].exp=t.readInt();var n=t.readInt();this.postGuildSkillInfo(),TipsCT.ins().showTips("|C:0x23CA23&T:修炼值 +"+n+"|")},e.prototype.sendUpBuilding=function(t){var e=this.getBytes(17);e.writeByte(t),this.sendToServer(e)},e.prototype.postUpBuilding=function(t){var e=t.readByte();this._buildingLevels[e-1]=t.readByte(),this.guildLv=this._buildingLevels[0]},e.prototype.doGuildTaskInfos=function(t){this.guildTaskInfos.removeAll(),this.initTaskInfos();for(var e=t.readInt(),i=0;e>i;i++){var n=new GuildTaskInfo;n.taskID=t.readInt(),n.param=t.readInt(),n.state=t.readInt(),n.stdTask=GlobalConfig.GuildTaskConfig[n.taskID],this.guildTaskInfos.addItem(n)}this.updateTaskList()},e.prototype.postGuildTaskUpdate=function(){},e.prototype.doGuildTaskUpdate=function(t){for(var e=t.readInt(),i=t.readInt(),n=t.readInt(),s=0;s<this.guildTaskInfos.length;s++){var o=this.guildTaskInfos.getItemAt(s);if(o&&o.taskID==e){o.param=i,o.state=n;break}}this.updateTaskList()},e.prototype.updateTaskList=function(){for(var t=this.guildTaskInfos.source,e=t.length-1;e>=0;e--)0==t[e].stdTask.type&&t.splice(e,1);t.sort(this.taskInfosSortFunc),this.guildTaskInfos.replaceAll(t),this.postGuildTaskUpdate()},e.prototype.sendGetTaskAward=function(t){var e=this.getBytes(21);e.writeByte(t),this.sendToServer(e)},e.prototype.sendManageList=function(){this.sendBaseProto(22)},e.prototype.postManageList=function(t){this.records=[];for(var e=t.readInt(),i=0;e>i;i++)this.parserManage(t)},e.prototype.doManage=function(t){},e.prototype.sendConCount=function(){this.sendBaseProto(24)},e.prototype.postConCount=function(t){for(var e=t.readUnsignedByte(),i=0;e>i;i++)this._conCount[i]=t.readInt()},e.prototype.sendMyGuildInfo=function(){this.sendBaseProto(25)},e.prototype.postMyGuildInfo=function(t){this.myCon=t.readInt(),this.myTotalCon=t.readInt(),this.myOffice=t.readUnsignedByte()},e.prototype.sendGuildMessage=function(t){return __awaiter(this,void 0,void 0,function(){var e,i,n,s,o;return __generator(this,function(a){switch(a.label){case 0:return[4,platform.checkStr(t,1,2)];case 1:return e=a.sent(),i=e.result,n=e.content,s=2+("self"==i?1:0),o=this.getBytes(26),o.writeString(n),o.writeByte(s),this.sendToServer(o),[2]}})})},e.prototype.doGuildMessage=function(t){var e=new GuildMessageInfo;if(e.parserMessage(t),-1==Friends.ins().indexOfBlackList(e.roleId)){if(this.guildMessageInfoData.length>=50){var i=this.guildMessageInfoData.removeItemAt(0);ChatCT.ins().removeAllChatMsg(i)}this.guildMessageInfoData.addItem(e),ChatCT.ins().insertAllChatMsg(e),ChatCT.ins().postNewChatMsg(e),1==e.type&&e.roleId!=Actor.actorID&&(this.hasNewMsg=!0)}if(1==e.type){var i=new ChatInfoData(null);i.name=e.name,i.type=7,i.str=e.content,ChatCT.ins().postNewChatMsg(i)}2==e.type&&this.postGuildBossHaveRelive(!0,e.content)},e.prototype.postGetNewGuildMessage=function(t){return t},e.prototype.postGuildBossHaveRelive=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendAllGuildMessage=function(){this.isFirstGetMessageInfo&&(this.isFirstGetMessageInfo=!1,this.sendBaseProto(27))},e.prototype.postAllGuildMessage=function(t){this.guildMessageInfoData.removeAll();for(var e=t.readInt(),i=0;e>i;i++){var n=new GuildMessageInfo;n.parserMessage(t),-1==Friends.ins().indexOfBlackList(n.roleId)&&(this.guildMessageInfoData.addItem(n),ChatCT.ins().insertAllChatMsg(n))}this.guildMessageInfoData.length&&ChatCT.ins().postNewChatMsg(this.guildMessageInfoData.getItemAt(this.guildMessageInfoData.length-1))},e.prototype.sendAddGuildLimit=function(t,e){var i=this.getBytes(28);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doAddGuildlimit=function(t){this.isAuto=t.readUnsignedByte(),this.attrLimit=t.readInt()},e.prototype.sendToFire=function(t,e){var i=this.getBytes(30);i.writeShort(t),this.sendToServer(i),this.sendToFireCount.push([t,e])},e.prototype.postUpdateFire=function(t){this.fireDic=this.fireDic||{};var e=t.readShort(),i=t.readInt(),n=this.fireDic.fireLvl!=e||this.fireDic.fireVal!=i;if(this.fireDic.fireLvl=e,this.fireDic.fireVal=i,n)for(var s=GlobalConfig.GuildConfig,o=BagCT.ins().getBagItemById(s.bonfireItem),a=o?o.count:0,r=0;r<this.sendToFireCount.length;r++)if(a==this.sendToFireCount[r][1]){for(;r>=0;){var l=this.sendToFireCount.shift()[0];TipsCT.ins().showCenterTips("行会总篝火值 +"+5*l+" 个人行会贡献 +"+30*l),r-=1}break}},e.prototype.sendGuildChangeName=function(t){var e=this.getBytes(31);e.writeString(t),this.sendToServer(e)},e.prototype.parserManage=function(t){if(this.records){var e="",i=DateUtils.getFormatBySecond(.001*DateUtils.formatMiniDateTime(t.readUnsignedInt()),8);i=StringUtils.complementByChar(i,16);var n=t.readUnsignedByte(),s=t.readInt(),o=t.readInt(),a=(t.readInt(),t.readString());t.readString();switch(n){case 1:e=i+"  ["+a+"]加入";break;case 2:e=i+"  ["+a+"]离开";break;case 3:e=i+"  ["+a+"]被任命副会长";break;case 4:e=i+"  ["+a+"]成为新的会长";break;case 5:e=i+"  ["+a+"]发起弹劾";break;case 6:e=i+"  ["+a+"]公会副本进度首通";break;case 7:e=i+"  ["+a+"]捐献了"+o+(2==s?"元宝":"金币");break;case 8:e=i+"  ["+a+"]把"+GlobalConfig.GuildConfig.buildingNames[s-1]+"升级到"+o+"级";break;case 9:var r=GlobalConfig.ItemConfig[s];e=i+"  ["+a+"]在公会商店获得了<font color="+ItemUtil.getQualityColor(r)+">"+r.name+"</font>";break;case 10:e=i+"  <font color='#35e62d'>公会强盗已经全部击杀</font>";break;case 11:e=i+"  ["+a+"]被降职了"}this.records.unshift(e)}},e.prototype.hasApplys=function(){return this.myOffice>=GuildOffice.GUILD_FUBANGZHU&&this.hasApply},e.prototype.hasDonate=function(){return!1},e.prototype.clearGuildInfo=function(){this.guildID=0,this.guildName="",this.guildListInfos=[],this._guildMembers=[],this.applyGuilds=[],this.pageMax=1,this.hasNewMsg=!1},e.prototype.removeMsgWithId=function(t){for(var e=[],i=0;i<this.guildMessageInfoData.length;i++){var n=this.guildMessageInfoData.getItemAt(i);n.roleId!=t&&e.push(n)}this.guildMessageInfoData.source=e,this.guildMessageInfoData.refresh()},e.prototype.initTaskInfos=function(){if(null==this.guildTaskInfos){var t=[],e=GlobalConfig.GuildTaskConfig;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i],s=new GuildTaskInfo;s.taskID=n.id,s.param=0,s.state=0,s.stdTask=n,t.push(s)}this.guildTaskInfos.replaceAll(t)}},e.prototype.taskInfosSortFunc=function(t,e){if(t.state==e.state)return Algorithm.sortAsc(t.taskID,e.taskID);if(2==t.state)return 1;if(2==e.state)return-1;if(2!=t.state&&2!=e.state){if(t.taskID<e.taskID)return-1;if(t.taskID>e.taskID)return 1}return 0},e.prototype.getMemberNum=function(){return this._guildMembers.length},e.prototype.getGuildMembers=function(t){return 0==t||this._memberSortType==t?this._guildMembers:1==t?this._guildMembers.sort(this.memberSortFunc):2==t?this._guildMembers.sort(this.memberSortFunc2):this._guildMembers},e.prototype.getOfficeNum=function(t){for(var e=this._guildMembers.length,i=0,n=0;e>n;n++){var s=this._guildMembers[n];s.office==t&&i++}return i},e.prototype.canAppointFHZ=function(){return this.getOfficeNum(GuildOffice.GUILD_FUBANGZHU)<GlobalConfig.GuildConfig.posCounts[this.guildLv-1][1]},e.prototype.memberSortFunc=function(t,e){return t.office>e.office?-1:t.office<e.office?1:t.office==e.office?t.contribution==e.contribution?0:t.contribution>e.contribution?-1:1:0},e.prototype.memberSortFunc2=function(t,e){return t.curContribution==e.curContribution?0:t.curContribution>e.curContribution?-1:1},e.prototype.checkIsInGuild=function(t){for(var e in this._guildMembers){var i=this._guildMembers[e];if(i.roleID==t)return!0}return!1},e.prototype.startCheckShow=function(){GuildWar.ins().getModel().checkinAppoint()?(ViewManager.ins().closeTopLevel(),ViewManager.ins().open(GuildWarUiInfo)):ViewManager.ins().close(GuildWarUiInfo)},e.prototype.isUpGradeBuilding=function(){if(e.ins().myOffice<GuildOffice.GUILD_FUBANGZHU)return!1;for(var t=[GuildBuilding.GUILD_HALL,GuildBuilding.GUILD_LIANGONGFANG],i=0;i<t.length;i++){var n=t[i],s=e.ins().getBuildingLevels(n-1)||0,o=GlobalConfig.GuildLevelConfig[n],a=0,r=null,l=null,h=0;for(var u in o)if(o.hasOwnProperty(u)){var p=o[u];a=p.level>a?p.level:a,p.level==s&&(r=p),p.level==s+1&&(l=p)}if((r||l||n==GuildBuilding.GUILD_LIANGONGFANG)&&l&&a>s&&(h=l.upFund),!(n==GuildBuilding.GUILD_HALL&&s>=a||n!=GuildBuilding.GUILD_HALL&&s>=e.ins().guildLv||e.ins().money<h))return!0}return!1},e.prototype.getMemberByRoleId=function(t){for(var e in this._guildMembers)if(this._guildMembers[e].roleID==t)return this._guildMembers[e];return null},__decorate([post()],e.prototype,"postGuildInfo",null),__decorate([post()],e.prototype,"postGuildMembers",null),__decorate([post()],e.prototype,"postGuildList",null),__decorate([post()],e.prototype,"postGuildCreate",null),__decorate([post()],e.prototype,"postJoinGuild",null),__decorate([post()],e.prototype,"postApplyInfos",null),__decorate([post()],e.prototype,"postProcessJoin",null),__decorate([post()],e.prototype,"postQuitGuild",null),__decorate([post()],e.prototype,"postGuildMoney",null),__decorate([post()],e.prototype,"postChangeNotice",null),__decorate([post()],e.prototype,"postGuildSkillInfo",null),__decorate([post()],e.prototype,"postLearnGuildSkill",null),__decorate([post()],e.prototype,"postUpBuilding",null),__decorate([post()],e.prototype,"postGuildTaskUpdate",null),__decorate([post()],e.prototype,"postManageList",null),__decorate([post()],e.prototype,"postConCount",null),__decorate([post()],e.prototype,"postMyGuildInfo",null),__decorate([post()],e.prototype,"postGetNewGuildMessage",null),__decorate([post()],e.prototype,"postGuildBossHaveRelive",null),__decorate([post()],e.prototype,"postAllGuildMessage",null),__decorate([post()],e.prototype,"postUpdateFire",null),e}(BaseSystem);__reflect(Guild.prototype,"Guild"),System.Guild=function(){return Guild.ins()},window.Guild=Guild;var GuildBoss=function(t){function e(){var e=t.call(this)||this;return e.leftTimes=0,e.canChallenge=0,e.isKilled=0,e.passId=0,e.challengeTime=0,e.bossHP=0,e.otherGuildId=0,e.otherGuildName="",e.otherGuildBossHp=0,e.winnerId=0,e.guildRankDic=[],e.guildPersonRankDic=[],e.guildBossState=0,e.sysId=PackageID.GuildBoss,e.regNetMsg(1,e.postGuildBossInfoChange),e.regNetMsg(2,e.doRewardRecord),e.regNetMsg(3,e.postGuildBossDetailChange),e.regNetMsg(4,e.doGuildChallengeBack),e.regNetMsg(5,e.postGuildBossRankInfoChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postGuildBossInfoChange=function(t){this.leftTimes=t.readInt();var e=t.readUnsignedByte();this.passRecord=[];for(var i=0;e>i;i++)this.passRecord[t.readByte()]=t.readByte();this.canChallenge=t.readByte()},e.prototype.doRewardRecord=function(t){this.isKilled=t.readByte();for(var e=t.readInt(),i=[],n=0;e>n;n++){var s=new RewardData;s.parser(t),i.push(s)}Timer.start(800,1,function(){ResultManager.ins().create(GameMap.fbType,1,i,"获得奖励如下：")},this)},e.prototype.postGuildBossDetailChange=function(t){this.passId=t.readInt();var e=t.readInt();this.challengeTime=GameServer.serverTime+1e3*e,this.bossHP=t.readInt(),this.otherGuildId=t.readInt(),this.otherGuildName=t.readString(),this.otherGuildBossHp=t.readInt(),this.winnerId=t.readInt()},e.prototype.doGuildChallengeBack=function(t){this.guildBossState=t.readInt(),0==this.guildBossState?(this.leftTimes--,this.postChallengeSuccess()):5==this.guildBossState&&this.sendGetBossInfo()},e.prototype.postGuildBossRankInfoChange=function(t){var e=t.readInt(),i=t.readByte();this.guildRankDic[e]=[],this.guildPersonRankDic[e]=[];for(var n=0;i>n;n++){var s=new guildBossRankData;s.name=t.readString(),s.damage=t.readDouble(),s.rank=n+1,this.guildRankDic[e].push(s)}i=t.readInt();for(var n=0;i>n;n++){var s=new guildBossRankData;s.name=t.readString(),s.damage=t.readDouble(),s.devote=t.readInt(),s.rank=n+1,this.guildPersonRankDic[e].push(s)}},e.prototype.sendChallengeBoss=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendGetBossReward=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetBossInfo=function(){this.sendBaseProto(3)},e.prototype.sendGetBossRankInfo=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.getBossRewardState=function(){for(var t in e.ins().passRecord)if(1==e.ins().passRecord[t])return!0;return!1},e.prototype.getBossChallenge=function(){if(!this.isOpen())return!1;if(e.ins().leftTimes<=0)return!1;for(var t in e.ins().passRecord)if(0==e.ins().passRecord[t])return!0;return!1},e.prototype.isOpen=function(){return new Date(GameServer.serverTime).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek&&GameServer.serverOpenDay>=1},e.prototype.postChallengeSuccess=function(){},__decorate([post()],e.prototype,"postGuildBossInfoChange",null),__decorate([post()],e.prototype,"postGuildBossDetailChange",null),__decorate([post()],e.prototype,"postGuildBossRankInfoChange",null),__decorate([post()],e.prototype,"postChallengeSuccess",null),e}(BaseSystem);__reflect(GuildBoss.prototype,"GuildBoss");var guildBossRankData=function(){function t(){this.name="",this.damage=0,this.rank=0,this.devote=0}return t}();__reflect(guildBossRankData.prototype,"guildBossRankData"),System.GuildBoss=function(){return GuildBoss.ins()},window.GuildBoss=GuildBoss;var GuildFB=function(t){function e(){var e=t.call(this)||this;return e.bossTimer=1,e.sysId=PackageID.GuildFB,e.regNetMsg(1,e.doGuildFBInfo),e.regNetMsg(2,e.doGuildFBRankInfo),e.regNetMsg(3,e.doGuildFBMaxGKInfo),e.regNetMsg(4,e.doGuildFBGKInfo),e.regNetMsg(5,e.doGuildFBChangeInfo),e.regNetMsg(6,e.doGuildFBRewardInfo),e.regNetMsg(7,e.postGuildFBBossInfo),e.regNetMsg(8,e.postGuildFBBossTimerEndInfo),e.regNetMsg(9,e.postGuildFBSweepEnd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getGkDatas=function(t){return void 0===t&&(t=-1),-1==t?this._gkDatas:this._gkDatas[t]},e.prototype.doGuildFBInfo=function(t){this.fbNum=t.readShort(),this.sweep=t.readByte(),this.sweepNum=t.readShort(),this.tongguan=t.readByte(),this.zuwei=t.readByte(),this.nextFb=t.readByte(),this.postGuildFubenInfo()},e.prototype.postGuildFubenInfo=function(){},e.prototype.doGuildFBRankInfo=function(t){this.rankDatas=[];for(var e=t.readByte(),i=0;e>i;i++){var n=new GuildFBRankInfo;n.rank=i+1,n.name=t.readString(),n.guanka=t.readShort(),this.rankDatas.push(n)}this.postGuildFubenInfo()},e.prototype.doGuildFBMaxGKInfo=function(t){this.isMaxGK=t.readByte(),0!=this.isMaxGK&&(this.maxName=t.readString(),this.maxCareer=t.readByte(),this.maxSex=t.readByte(),this.maxNum=t.readShort(),this.maxZhuwei=t.readByte()),this.postGuildFubenInfo()},e.prototype.doGuildFBGKInfo=function(t){this.fbgkNum=t.readShort();var e=t.readByte();this._gkDatas=[];for(var i=0;e>i;i++)this._gkDatas.push(t.readString());this.postGuildFubenInfo(),this.postGuildFubenRoleInfo()},e.prototype.postGuildFubenRoleInfo=function(){},e.prototype.doGuildFBChangeInfo=function(t){this.change=t.readByte(),ViewManager.ins().getView(GuildActivityWin)&&ViewManager.ins().getView(GuildActivityWin).isShow()&&(1==this.change?this.sendGuildFBRankInfo():2==this.change&&this.sendGuildFBMaxGKInfo(),this.change=0)},e.prototype.doGuildFBRewardInfo=function(t){this.rewardNum=t.readShort(),this.rewardRoleNum=t.readShort(),this.postGuildFubenInfo()},e.prototype.postGuildFBBossInfo=function(t){this.bossGKNum=t.readShort()},e.prototype.postGuildFBBossTimerEndInfo=function(t){this.bossGKNum=t.readShort(),this.bossTimer=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.postGuildFBSweepEnd=function(t){},e.prototype.sendGuildFBRankInfo=function(){this.sendBaseProto(2)},e.prototype.sendGuildFBMaxGKInfo=function(){this.sendBaseProto(3)},e.prototype.sendGuildFBGKRoleInfo=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.sendGuildFBChallange=function(){this.sendBaseProto(5)},e.prototype.sendGuildFBSweep=function(){this.sendBaseProto(6)},e.prototype.sendGuildFBZhuwei=function(){this.sendBaseProto(7)},e.prototype.sendGuildFBReward=function(){this.sendBaseProto(8)},e.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(0==this.sweep&&this.fbNum>0||0==this.tongguan&&this.rewardNum>0)},Object.defineProperty(e.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:!0,configurable:!0}),__decorate([post()],e.prototype,"postGuildFubenInfo",null),__decorate([post()],e.prototype,"postGuildFubenRoleInfo",null),__decorate([post()],e.prototype,"postGuildFBBossInfo",null),__decorate([post()],e.prototype,"postGuildFBBossTimerEndInfo",null),__decorate([post()],e.prototype,"postGuildFBSweepEnd",null),e}(BaseSystem);__reflect(GuildFB.prototype,"GuildFB"),System.GuildFB=function(){return GuildFB.ins()},window.GuildFB=GuildFB;var GuildRedPoint=function(t){function e(){var e=t.call(this)||this;return e.hanghui=!1,e.sendReward=!1,e.redBag=!1,e.sczb=!1,e.hhdt=!1,e.gldt=!1,e.hhBoss=!1,e.dayReward=!1,e.guildFire=!1,e.roleTabs={},e.roleSkillTabs={},e.liangongRed=!1,e.roleTabs={},e.roleSkillTabs={},e.associated(e.postDayReward,GuildWar.ins().postDayRewardInfo),e.associated(e.postSczb,e.postDayReward,e.postRedBag),e.associated(e.postSendReward,GuildWar.ins().postAssignsReward,GuildWar.ins().postSendRewardSuccess),e.associated(e.postRedBag,GuildWar.ins().postRedBagInfo),e.associated(e.postHhdt,Guild.ins().postApplyInfos,Guild.ins().postJoinGuild,Guild.ins().postMyGuildInfo,Guild.ins().postConCount,e.postLianGongRedPoint,e.postGldt),e.associated(e.postGldt,Guild.ins().postUpBuilding,Guild.ins().postManageList,Guild.ins().postGuildMoney,Guild.ins().postMyGuildInfo),e.associated(e.postHanghui,e.postSendReward,e.postSczb,e.postHhdt,e.postGuildFire,e.postLianGongRedPoint,Actor.ins().postLevelChange,GuildFB.ins().postGuildFubenInfo,GuildRobber.ins().postGuildRobberInfo,GuildWar.ins().postGuildWarStarInfo,Guild.ins().postGuildInfo,e.postHanghuiBoss),e.associated(e.postHanghuiBoss,GuildBoss.ins().postGuildBossDetailChange,GuildBoss.ins().postGuildBossInfoChange),e.associated(e.postGuildFire,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,Guild.ins().postUpdateFire),e.associated(e.postLianGongRedPoint,Guild.ins().postLearnGuildSkill,Guild.ins().postUpBuilding,Guild.ins().postGuildSkillInfo,Guild.ins().postMyGuildInfo),e}return __extends(e,t),e.prototype.postGuildFire=function(){var t=this.guildFire,e=GlobalConfig.GuildConfig,i=BagCT.ins().getBagItemById(e.bonfireItem);return i&&i.count>=(e.bonfirecaution||1)?this.guildFire=!0:this.guildFire=!1,this.guildFire!=t},e.prototype.postHhdt=function(){var t=this.hhdt;return this.hhdt=Guild.ins().hasDonate()||Guild.ins().hasApplys()||this.gldt,this.hhdt!=t},e.prototype.postGldt=function(){var t=this.gldt;return this.gldt=Guild.ins().isUpGradeBuilding(),this.gldt!=t},e.prototype.postDayReward=function(){var t=this.dayReward;return this.dayReward=GuildWar.ins().getModel().canGetDay&&!GuildWar.ins().getModel().getDayReward,this.dayReward!=t},e.prototype.postSczb=function(){var t=this.sczb;return this.sczb=this.dayReward||this.redBag,this.sczb!=t},e.prototype.postRedBag=function(){var t=this.redBag;return this.redBag=GuildWar.ins().getModel().isHaveRedBag(),this.redBag!=t},e.prototype.postSendReward=function(){var t=this.sendReward;return this.sendReward=GuildWar.ins().getModel().canSendReward,this.sendReward!=t},e.prototype.postHanghui=function(){var t=this.hanghui,e=!1;return GuildFB.ins().hasbtn()&&(e=!0),(void 0==Guild.ins().guildID||0==Guild.ins().guildID)&&Actor.level>69&&(e=!0),this.hanghui=e||this.sendReward||this.redBag||this.sczb||this.hhBoss||this.guildFire||this.liangongRed||GuildSoulsRedPoint.ins().redPoint||GuildWar.ins().getModel().isWatStart||this.hhdt,this.hanghui!=t},e.prototype.postHanghuiBoss=function(){var t=this.hhBoss;return this.hhBoss=GuildBoss.ins().getBossRewardState()||GuildBoss.ins().getBossChallenge(),this.hhBoss!=t},e.prototype.postLianGongRedPoint=function(){this.liangongRed=!1;for(var t=e.Tab_LianGong,i=SubRoles.ins().subRolesLen,n=0;i>n;n++){var s=SubRoles.ins().getSubRoleByIndex(n);if(s){var o=Guild.ins().getSkllInfoByIndex(s.index);if(o){this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][n]=!1;for(var a=1;3>=a;a++){this.roleSkillTabs[n]||(this.roleSkillTabs[n]={}),this.roleSkillTabs[n][a]=!1;var r=GlobalConfig.GuildCommonSkillConfig[a].length,l=o.guildSkillInfo[a-1].level;if(!(l>=r)){var h=this.getCommonSkillDP(a,l+1);if(h&&!(h.contribute>Guild.ins().myCon||Actor.gold<h.money)){var u=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1),p=1>u||l>=GlobalConfig.GuildConfig.commonSkillLevels[u-1];p||(this.roleSkillTabs[n][a]=!0,this.liangongRed=!0)}}}for(var c in this.roleSkillTabs[n])if(this.roleSkillTabs[n][c]){this.roleTabs[t][n]=!0;break}}}}},e.prototype.getCommonSkillDP=function(t,e){var i=GlobalConfig.GuildCommonSkillConfig[t];if(0==e)return i[1];for(var n in i){var s=i[n];if(s.level==e)return s}return null},e.Tab_LianGong=0,__decorate([post()],e.prototype,"postGuildFire",null),__decorate([post()],e.prototype,"postHhdt",null),__decorate([post()],e.prototype,"postGldt",null),__decorate([post()],e.prototype,"postDayReward",null),__decorate([post()],e.prototype,"postSczb",null),__decorate([post()],e.prototype,"postRedBag",null),__decorate([post()],e.prototype,"postSendReward",null),__decorate([post()],e.prototype,"postHanghui",null),__decorate([post()],e.prototype,"postHanghuiBoss",null),__decorate([post()],e.prototype,"postLianGongRedPoint",null),e}(BaseSystem);__reflect(GuildRedPoint.prototype,"GuildRedPoint"),System.GuildRedPoint=function(){return GuildRedPoint.ins()},window.GuildRedPoint=GuildRedPoint;var GuildRobber=function(t){function e(){var e=t.call(this)||this;return e.robberNum=0,e.robberTotal=0,e.robberDealNum=0,e._robberList=[],e.robberChanllge=0,e.isUpdateRobber=!1,e.sysId=PackageID.GuildRobber,e.regNetMsg(1,e.doGuildRobberInfo),e.regNetMsg(2,e.doGuildRobberStarts),e.regNetMsg(3,e.doGuildRobberSX),e.regNetMsg(4,e.doGuildRobberChangller),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRobberList=function(t){return void 0===t&&(t=-1),-1==t?this._robberList:this._robberList[t]},e.prototype.doGuildRobberInfo=function(t){if(this.robberNum=t.readByte(),this.robberNum>0){this.robberTotal=t.readByte(),this.robberDealNum=t.readByte(),this._robberList=[];for(var e=0;e<this.robberTotal;e++){var i=new RobberStartInfo;i.robberStart=t.readByte(),i.robberType=t.readByte(),this._robberList.push(i)}}this.postGuildRobberInfo()},e.prototype.postGuildRobberInfo=function(){},e.prototype.doGuildRobberStarts=function(t){var e=t.readByte();if(this._robberList.length>0){var i=this._robberList[e-1];i.robberStart=t.readByte()}this.robberDealNum=t.readByte(),this.postGuildRobberInfo()},e.prototype.doGuildRobberSX=function(t){this.robberNum=t.readByte(),ViewManager.ins().getView(GuildMap)?this.sendRobberInfo():this.isUpdateRobber=!0},e.prototype.doGuildRobberChangller=function(t){this.robberChanllge=t.readByte()},e.prototype.sendRobberInfo=function(){this.sendBaseProto(1)},e.prototype.sendRobberChanger=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.hasbtn=function(){return this.robberTotal>0&&this.robberTotal>this.robberDealNum},__decorate([post()],e.prototype,"postGuildRobberInfo",null),e}(BaseSystem);__reflect(GuildRobber.prototype,"GuildRobber"),System.GuildRobber=function(){return GuildRobber.ins()},window.GuildRobber=GuildRobber;var GuildStore=function(t){function e(){var e=t.call(this)||this;return e.guildStoreLv=0,e.guildStoreNum=0,e._recordInfoAry=[],e._guildStoreItemData=[],e.sysId=PackageID.GuildStore,e.regNetMsg(1,e.postGuildStoreInfo),e.regNetMsg(2,e.postGuildStoreBoxInfo),e.regNetMsg(3,e.postGuildStoreBox),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRecordInfoAry=function(t){return void 0===t&&(t=-1),-1==t?this._recordInfoAry:this._recordInfoAry[t]},e.prototype.getGuildStoreItemData=function(t){return void 0===t&&(t=-1),-1==t?this._guildStoreItemData:this._guildStoreItemData[t]},e.prototype.postGuildStoreInfo=function(t){this.guildStoreLv=t.readByte(),this.guildStoreNum=t.readByte()},e.prototype.postGuildStoreBoxInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=new GuildStoreRecordInfo;n.times=t.readInt(),n.roleName=t.readString(),n.itemId=t.readInt(),this._recordInfoAry.length>=50&&this._recordInfoAry.pop(),this._recordInfoAry.unshift(n)}},e.prototype.postGuildStoreBox=function(t){var e=t.readByte();this._guildStoreItemData=[];for(var i=0;e>i;i++){var n=new GuildStoreItemData;n.itemId=t.readInt(),n.num=t.readInt(),this._guildStoreItemData.push(n)}this.guildStoreNum-=1},e.prototype.doGuildStoreAddBoxInfo=function(t){this._recordInfo=new GuildStoreRecordInfo,this._recordInfo.roleName=t.readString(),this._recordInfo.itemId=t.readInt()},e.prototype.getGuildStoreInfo=function(){this.sendBaseProto(1)},e.prototype.sendGuildStoreBoxInfo=function(){var t=this.getBytes(2);null==this._recordInfoAry||0==this._recordInfoAry.length?t.writeInt(0):t.writeInt(this.getRecordInfoAry(0).times),this.sendToServer(t)},e.prototype.sendGuildStoreBox=function(){this.sendBaseProto(3)},__decorate([post()],e.prototype,"postGuildStoreInfo",null),__decorate([post()],e.prototype,"postGuildStoreBoxInfo",null),__decorate([post()],e.prototype,"postGuildStoreBox",null),e}(BaseSystem);__reflect(GuildStore.prototype,"GuildStore"),System.GuildStore=function(){return GuildStore.ins()},window.GuildStore=GuildStore;var GuildWar=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.GuildWar,e.regNetMsg(1,e.postRedBagInfo),e.regNetMsg(2,e.doSendRedBack),e.regNetMsg(3,e.doRobRedBack),e.regNetMsg(4,e.postJoinPlayBack),e.regNetMsg(5,e.doPlayNextCard),e.regNetMsg(6,e.doGetPointInfo),e.regNetMsg(7,e.doGetGongXunChange),e.regNetMsg(8,e.doGuildRankinfo),e.regNetMsg(9,e.postGuildPersonalRank),e.regNetMsg(10,e.doGuildWarKillInfo),e.regNetMsg(11,e.doGuildWarCityOwn),e.regNetMsg(12,e.postDayRewardInfo),e.regNetMsg(14,e.doMyActivityRankInfo),e.regNetMsg(15,e.postFlagInfoChange),e.regNetMsg(17,e.doGuildWarResult),e.regNetMsg(18,e.doHuDunInfoChange),e.regNetMsg(19,e.postAssignsReward),e.regNetMsg(20,e.postSendRewardSuccess),e.regNetMsg(21,e.postWinGuildInfo),e.regNetMsg(22,e.postGuildWarStarInfo),e.regNetMsg(23,e.doGuildWarDoorHuDun),e.regNetMsg(24,e.doLotteryInfo),e.regNetMsg(25,e.doGetMyPoint),e.regNetMsg(26,e.doRankInfoChange),e.regNetMsg(27,e.doChangeAttrHandle),e.regNetMsg(28,e.doChangeShowList),e.regNetMsg(29,e.doPointRewardInfo),e.regNetMsg(31,e.doDoorEndtime),e.regNetMsg(32,e.doTalkMaxPoint),e.regNetMsg(33,e.postKillHuman),e.regNetMsg(34,e.postHeFuBelong),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getModel=function(){return this._guildWarModel||(this._guildWarModel=new GuildWarModel),this._guildWarModel},e.prototype.requestSendRedBag=function(t,e){var i=this.getBytes(2);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.requestRobRedBag=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.requestJoinAc=function(){var t=this.getBytes(4);this.sendToServer(t)},e.prototype.requestPlayNextMap=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.requestGuildRank=function(){var t=this.getBytes(8);this.sendToServer(t)},e.prototype.requestOwnGuildRank=function(){var t=this.getBytes(9);this.sendToServer(t)},e.prototype.postGuildPersonalRank=function(t){for(var e=[],i=t.readInt(),n=0;i>n;n++){var s=new RankGuildInfo;s.parse(t),e[n]=s}return e},e.prototype.requestDayReward=function(t){var e=this.getBytes(13);e.writeInt(t),this.sendToServer(e)},e.prototype.requestOwnMyGuildRank=function(){var t=this.getBytes(14);this.sendToServer(t)},e.prototype.requestStartGetFlag=function(){var t=this.getBytes(16);this.sendToServer(t)},e.prototype.requestWinGuildInfo=function(){var t=this.getBytes(21);this.sendToServer(t)},e.prototype.postRedBagInfo=function(t){this.getModel().getRedbagInfo(t)},e.prototype.doSendRedBack=function(t){t.readBoolean()&&(ViewManager.ins().close(RedBagWin),TipsCT.ins().showTips("|C:0x35e62d&T:发送红包成功|"))},e.prototype.doRobRedBack=function(t){t.readBoolean()&&(ViewManager.ins().close(RedBagWin),ViewManager.ins().open(RedBagDetailsWin,1))},e.prototype.postJoinPlayBack=function(t){var e=t.readBoolean();this.getModel().doorDie=t.readBoolean(),this.getModel().rewardFlag=t.readByte(),e&&(ViewManager.ins().close(GuildWarMainWin),ViewManager.ins().close(GuildMap))},e.prototype.doPlayNextCard=function(t){},e.prototype.doGetPointInfo=function(t){this.getModel().ownPoint=t.readInt(),this.getModel().guildPoint=t.readInt();var e=t.readInt();e>0&&TipsCT.ins().showTips("获得 "+e+" 积分"),this.postPointUpdate()},e.prototype.postPointUpdate=function(){},e.prototype.doGetGongXunChange=function(t){this.getModel().gongXun=t.readInt(),this.postPointUpdate()},e.prototype.doGuildRankinfo=function(t){this.getModel().decodeGuildRankInfo(t)},e.prototype.doGuildWarKillInfo=function(t){var e=t.readInt();this.getModel().killName=t.readString(),this.getModel().killGuild=t.readString(),ViewManager.ins().open(GuileWarReliveWin,2,e)},e.prototype.doGuildWarCityOwn=function(t){this.getModel().cityOwn=t.readString(),this.postCityownChange()},e.prototype.postCityownChange=function(){},e.prototype.doMyActivityRankInfo=function(t){this.getModel().decodeMyGuildRankInfo(t)},e.prototype.postDayRewardInfo=function(t){this.getModel().canGetDay=t.readBoolean(),this.getModel().getDayReward=t.readBoolean(),this.getModel().rewardDay=t.readInt()},e.prototype.postFlagInfoChange=function(t){this.getModel().flagAcId=0,this.getModel().flagStatu=t.readShort(),0==this.getModel().flagStatu?this.getModel().endTime=t.readInt():2==this.getModel().flagStatu&&(this.getModel().flagName=t.readString(),this.getModel().flagAcId=t.readInt(),this.getModel().endTime=t.readInt(),this.getModel().flagGuild=t.readString(),this.getModel().flagAcId==Actor.actorID&&TipsCT.ins().showTips("开始采集"))},e.prototype.doGuildWarResult=function(t){this.getModel().decodeGulidWarResult(t)},e.prototype.doHuDunInfoChange=function(t){this.postHudunInfo(t.readInt(),t.readInt())},e.prototype.postHudunInfo=function(t,e){return[t,e]},e.prototype.postAssignsReward=function(t){this.getModel().guildWarRank=t.readInt(),this.getModel().canSendReward=t.readBoolean(),this.getModel().rewardFlag=t.readByte()},e.prototype.sendFenReward=function(t,e){var i=this.getModel().sendNumList,n=this.getBytes(20);n.writeInt(t);for(var s=1;t>=s;s++){n.writeInt(s);var o=s-1,a=e[o].length;n.writeInt(a);for(var r=0;a>r;r++){var l=e[o][r];n.writeInt(l.roleID),n.writeInt(i[o][r])}}this.sendToServer(n)},e.prototype.postSendRewardSuccess=function(t){t.readBoolean()&&(ViewManager.ins().close(SelectMemberRewardWin),this.getModel().canSendReward=!1,TipsCT.ins().showTips("奖励已分配完"))},e.prototype.postWinGuildInfo=function(t){this.getModel().winGuildInfo||(this.getModel().winGuildInfo=new WinGuildInfo),this.getModel().winGuildInfo.parse(t)},e.prototype.postGuildWarStarInfo=function(t){this.getModel().isWatStart=t.readBoolean(),this.getModel().startTime=DateUtils.formatMiniDateTime(t.readInt())/1e3,this.getModel().acEndTime=t.readInt()},e.prototype.doGuildWarDoorHuDun=function(t){BossCT.ins().curShield=t.readInt(),BossCT.ins().postShieldPer()},e.prototype.doLotteryInfo=function(t){BossCT.ins().worldPrize=t.readInt(),ViewManager.ins().open(WorldBossJiangLiWin,1)},e.prototype.sendPlayLotteryInfo=function(){var t=this.getBytes(25);this.sendToServer(t)},e.prototype.doRankInfoChange=function(t){this.getModel().rankListChange(t)},e.prototype.doChangeAttrHandle=function(t){if(14==GameMap.fbType){var e=t.readDouble();CrossGuildBattleCT.ins().getCurMapLevel()>0?CrossGuildBattleCT.ins().attHandle!=e&&(CrossGuildBattleCT.ins().attHandle=e,EntityShowMgr.ins().showHideSomeOne(e),console.log("add-----------:"+e)):this.getModel().attHandle!=e&&(this.getModel().attHandle=e,EntityShowMgr.ins().showHideSomeOne(e),console.log("add-----------:"+e)),this.postWeixieChange(1)
}},e.prototype.postWeixieChange=function(t){return t},e.prototype.postGuildRedPointChange=function(t){return t},e.prototype.doChangeShowList=function(t){if(14==GameMap.fbType){var e=t.readDouble();this.getModel().changeWeiXieList(e,!1),this.getModel().changecanPlayList(e,!1),this.getModel().setMyGuildNum(e,!1),this.getModel().attHandle&&this.getModel().attHandle==e&&(this.getModel().attHandle=0,console.log("cancel------------:"+e))}},e.prototype.doPointRewardInfo=function(t){this.getModel().decodePointRewardInfo(t)},e.prototype.sendPointReward=function(){var t=this.getBytes(30);this.sendToServer(t)},e.prototype.doDoorEndtime=function(t){this.getModel().doEndDoorTime(t.readByte())},e.prototype.doGetMyPoint=function(t){var e=t.readShort();BossCT.ins().postLotteryRan(e)},e.prototype.postLotteryPoint=function(t){return t},e.prototype.doTalkMaxPoint=function(t){var e=t.readInt(),i=t.readString();BossCT.ins().postLotteryResult(i,e)},e.prototype.postKillHuman=function(t){var e=t.readInt();return e},e.prototype.postHeFuBelong=function(t){var e=t.readShort();this.GuildNameBelongs=[];for(var i=0;e>i;i++){var n=t.readString();this.GuildNameBelongs.push(n)}},e.prototype.sendHeFuBelong=function(){this.sendBaseProto(34)},e.prototype.postLotteryMaxPost=function(t,e){return[t,e]},e.prototype.postMyRankChange=function(){},e.prototype.postPointRewardChange=function(){},e.prototype.postCanplayChange=function(){},e.prototype.postRankListChange=function(){},e.prototype.postGuildNumChange=function(){},e.prototype.postSendListChange=function(){},e.prototype.postRankInfo=function(){},__decorate([post()],e.prototype,"postGuildPersonalRank",null),__decorate([post()],e.prototype,"postRedBagInfo",null),__decorate([post()],e.prototype,"postJoinPlayBack",null),__decorate([post()],e.prototype,"postPointUpdate",null),__decorate([post()],e.prototype,"postCityownChange",null),__decorate([post()],e.prototype,"postDayRewardInfo",null),__decorate([post()],e.prototype,"postFlagInfoChange",null),__decorate([post()],e.prototype,"postHudunInfo",null),__decorate([post()],e.prototype,"postAssignsReward",null),__decorate([post()],e.prototype,"postSendRewardSuccess",null),__decorate([post()],e.prototype,"postWinGuildInfo",null),__decorate([post()],e.prototype,"postGuildWarStarInfo",null),__decorate([post()],e.prototype,"postWeixieChange",null),__decorate([post()],e.prototype,"postGuildRedPointChange",null),__decorate([post()],e.prototype,"postLotteryPoint",null),__decorate([post()],e.prototype,"postKillHuman",null),__decorate([post()],e.prototype,"postHeFuBelong",null),__decorate([post()],e.prototype,"postLotteryMaxPost",null),__decorate([post()],e.prototype,"postMyRankChange",null),__decorate([post()],e.prototype,"postPointRewardChange",null),__decorate([post()],e.prototype,"postCanplayChange",null),__decorate([post()],e.prototype,"postRankListChange",null),__decorate([post()],e.prototype,"postGuildNumChange",null),__decorate([post()],e.prototype,"postSendListChange",null),__decorate([post()],e.prototype,"postRankInfo",null),e}(BaseSystem);__reflect(GuildWar.prototype,"GuildWar"),System.GuildWar=function(){return GuildWar.ins()},window.GuildWar=GuildWar;var GuildBuilding;!function(t){t[t.GUILD_HALL=1]="GUILD_HALL",t[t.GUILD_LIANGONGFANG=2]="GUILD_LIANGONGFANG",t[t.GUILD_SHOP=3]="GUILD_SHOP",t[t.GUILD_COMMENT=4]="GUILD_COMMENT"}(GuildBuilding||(GuildBuilding={}));var GuildLanguage=function(){function t(){}return t.guildOffice=["成员","精英","堂主","护法","长老","副会长","会长"],t.guildOfficeColor=["d1c3a8","00c832","1694ec","8e2abc","f4b12a","ffff00","ffff00"],t.guildBuilding=["","管理大厅","练功房"],t}();__reflect(GuildLanguage.prototype,"GuildLanguage"),window.GuildLanguage=GuildLanguage;var GuildOffice;!function(t){t[t.GUILD_MEMBER=0]="GUILD_MEMBER",t[t.GUILD_JINGYING=1]="GUILD_JINGYING",t[t.GUILD_TANGZHU=2]="GUILD_TANGZHU",t[t.GUILD_HUFA=3]="GUILD_HUFA",t[t.GUILD_ZHANGLAO=4]="GUILD_ZHANGLAO",t[t.GUILD_FUBANGZHU=5]="GUILD_FUBANGZHU",t[t.GUILD_BANGZHU=6]="GUILD_BANGZHU"}(GuildOffice||(GuildOffice={})),window.GuildOffice=GuildOffice;var GuildApplyInfo=function(){function t(){}return t}();__reflect(GuildApplyInfo.prototype,"GuildApplyInfo"),window.GuildApplyInfo=GuildApplyInfo;var GuildFBModel=function(){function t(){this.bossTimer=1}return t.prototype.parserBaseInfo=function(t){this.fbNum=t.readShort(),this.sweep=t.readByte(),this.sweepNum=t.readShort(),this.tongguan=t.readByte(),this.zuwei=t.readByte(),this.nextFb=t.readByte()},t.prototype.parserRankInfo=function(t){this.rankDatas=[];for(var e=t.readByte(),i=0;e>i;i++){var n=new GuildFBRankInfo;n.rank=i+1,n.name=t.readString(),n.guanka=t.readShort(),this.rankDatas.push(n)}},t.prototype.parserMaxGkInfo=function(t){this.isMaxGK=t.readByte(),0!=this.isMaxGK&&(this.maxName=t.readString(),this.maxCareer=t.readByte(),this.maxSex=t.readByte(),this.maxNum=t.readShort(),this.maxZhuwei=t.readByte())},t.prototype.parserGkInfo=function(t){this.fbgkNum=t.readShort();var e=t.readByte();this.gkDatas=[];for(var i=0;e>i;i++)this.gkDatas.push(t.readString())},t.prototype.parserRewardInfo=function(t){this.rewardNum=t.readShort(),this.rewardRoleNum=t.readShort()},t.prototype.hasbtn=function(){return GameServer.serverOpenDay>0&&(0==this.sweep&&this.fbNum>0||0==this.tongguan&&this.rewardNum>0)},Object.defineProperty(t.prototype,"bossTimerEnd",{get:function(){return this.bossTimer+egret.getTimer()},enumerable:!0,configurable:!0}),t}();__reflect(GuildFBModel.prototype,"GuildFBModel"),window.GuildFBModel=GuildFBModel;var GuildFBRankInfo=function(){function t(){}return t}();__reflect(GuildFBRankInfo.prototype,"GuildFBRankInfo"),window.GuildFBRankInfo=GuildFBRankInfo;var GuildListInfo=function(){function t(){}return t}();__reflect(GuildListInfo.prototype,"GuildListInfo"),window.GuildListInfo=GuildListInfo;var GuildMemberInfo=function(){function t(){this.level=0,this.zsLevel=0}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.vipLevel=t.readInt(),this.attack=t.readInt(),this.sex=t.readUnsignedByte(),this.job=t.readUnsignedByte(),this.name=t.readString(),this.zsLevel=t.readInt(),this.score=t.readInt(),this.winRate=t.readInt()/100>>0,this.KfArenaCount=t.readUnsignedByte(),this.isJoinkfArena=1==t.readUnsignedByte()},t.prototype.copyData=function(t){for(var e in t)this[e]=t[e]},t}();__reflect(GuildMemberInfo.prototype,"GuildMemberInfo"),window.GuildMemberInfo=GuildMemberInfo;var GuildMessageInfo=function(){function t(){this.pfVipInfo={}}return t.prototype.parserMessage=function(t){this.type=t.readUnsignedByte(),this.content=t.readString(),this.cd=0,1==this.type&&(this.roleId=t.readInt(),this.name=t.readString(),this.job=t.readUnsignedByte(),this.sex=t.readUnsignedByte(),this.vipLevel=t.readInt(),this.monthCard=t.readUnsignedByte(),this.office=t.readUnsignedByte(),this.zsLevel=t.readUnsignedByte(),this.lv=t.readShort(),this.guildName=t.readString(),this.pfVipInfo=PFVipCT.parserPFVipInfo(t))},t}();__reflect(GuildMessageInfo.prototype,"GuildMessageInfo"),window.GuildMessageInfo=GuildMessageInfo;var GuildSkillInfo=function(){function t(){}return t}();__reflect(GuildSkillInfo.prototype,"GuildSkillInfo"),window.GuildSkillInfo=GuildSkillInfo;var GuildStoreItemData=function(){function t(){}return t}();__reflect(GuildStoreItemData.prototype,"GuildStoreItemData"),window.GuildStoreItemData=GuildStoreItemData;var GuildStoreModel=function(){function t(){this.guildStoreLv=0,this.recordInfoAry=[],this.recordMax=50}return t.prototype.parserBaseInfo=function(t){this.guildStoreLv=t.readByte(),this.guildStoreNum=t.readByte()},t.prototype.parserRecordInfo=function(t){var e,i=t.readByte(),n=[];if(null!=this.recordInfoAry&&this.recordInfoAry.length>0&&this.recordInfoAry.length+i>this.recordMax){var s=this.recordMax-i>0?this.recordMax-i:0;this.recordInfoAry.length=s}for(var o=0;i>o;o++)e=new GuildStoreRecordInfo,e.times=t.readInt(),e.roleName=t.readString(),e.itemId=t.readInt(),n.push(e);this.recordInfoAry=n.concat(this.recordInfoAry)},t.prototype.parserBoxItemInfo=function(t){var e=t.readByte();this.guildStoreItemData=[];for(var i=0;e>i;i++){var n=new GuildStoreItemData;n.itemId=t.readInt(),n.num=t.readInt(),this.guildStoreItemData.push(n)}},t.prototype.parserRecord=function(t){this.recordInfo=new GuildStoreRecordInfo,this.recordInfo.roleName=t.readString(),this.recordInfo.itemId=t.readInt()},t}();__reflect(GuildStoreModel.prototype,"GuildStoreModel"),window.GuildStoreModel=GuildStoreModel;var GuildStoreRecordInfo=function(){function t(){}return t}();__reflect(GuildStoreRecordInfo.prototype,"GuildStoreRecordInfo"),window.GuildStoreRecordInfo=GuildStoreRecordInfo;var GuildTaskInfo=function(){function t(){}return t}();__reflect(GuildTaskInfo.prototype,"GuildTaskInfo"),window.GuildTaskInfo=GuildTaskInfo;var GuildWarModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.guildPoint=0,e.ownPoint=0,e.gongXun=0,e.rewardDay=1,e.remainYB=-1,e.robYbNum=0,e.guildRankList=[],e.killName="",e.killGuild="",e.cityOwn="虚位以待",e.myRankList=[],e.weixieList=[],e.canPlayList=[],e.flagStatu=0,e.endTime=0,e.flagName="",e.flagAcId=0,e.flagGuild="",e.canClick=!0,e._canSendReward=!1,e.rewardIndex=0,e.sendList=[],e.sendNumList=[],e.rewardFlag=0,e.winGuildInfo=new WinGuildInfo,e.guildWarNumDaXie=["日","一","二","三","四","五","六"],e.rankList=[],e._doorEndtime=0,e.attHandle=0,e.myGuildPointRank=[],e.guildHandleList=[],e.guildNum=0,e}return __extends(e,t),e.prototype.creatGuildRankReward=function(t,e){void 0===e&&(e=-1),this.rewardList=[];var i=GlobalConfig.GuildBattleDistributionAward[t];for(var n in i)if(!i[n].rewardFlag||this.rewardFlag==GuildFlag.hf){if(Number(n)==e+1)return i[n].awardShow;var s=i[n].awardShow;for(var o in s)this.checkIsHave(s[o])}return this.rewardList},e.prototype.creatGuildRewardList=function(){if(this.configList)return this.configList;this.configList=[];var t=GlobalConfig.GuildBattleDistributionAward;for(var e in t)-1==this.configList.lastIndexOf(t[e][1].rank)&&this.configList.push(t[e][1].rank);return this.configList},e.prototype.checkIsHave=function(t){for(var e=!1,i=this.rewardList.length,n=0;i>n;n++){var s=this.rewardList[n];s.id==t.id&&s.type==t.type&&(e=!0,this.rewardList[n].count+=t.count)}e||this.rewardList.push(t)},e.prototype.getRedbagInfo=function(t){this.remainYB=t.readInt(),this.canSend=t.readBoolean(),this.canRod=t.readBoolean(),this.sendYbNum=t.readInt(),this.maxRedNum=t.readInt(),this.remainRedNum=t.readInt();var e=t.readInt();this.rebList=[];for(var i,n=0;e>n;n++)i=new GuildRedRobInfo,i.parse(t),Actor.actorID==i.acId&&(this.robYbNum=i.robNum),this.rebList.push(i)},e.prototype.isHaveRedBag=function(){return this.canSend||this.canRod},e.prototype.checkinAppoint=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=!1),!GuildWar.ins().getModel().isWatStart||0==GameMap.fubenID||0==Guild.ins().guildID)return!1;var i=GlobalConfig.GuildBattleLevel;for(var n in i)if(i[n].fbId==GameMap.fubenID)return 0==t?!0:e&&i[n].id>=t?!0:i[n].id==t?!0:!1;return!1},e.prototype.decodeGuildRankInfo=function(t){this.lastGuildName=t.readString();var e=(t.readByte(),t.readInt());this.guildRankList=[];for(var i,n=0;e>n;n++)i=new RankGuildInfo,i.parse(t),this.guildRankList.push(i);GuildWar.ins().postRankInfo()},e.prototype.getNextMapName=function(t){void 0===t&&(t=1);var e=(GameMap.fubenID,GlobalConfig.GuildBattleLevel),i=1;for(var n in e)t==e[n].id&&(i=t);return e[i].name},e.prototype.getIntoNextMapGongxun=function(){var t=GameMap.fubenID,e=GlobalConfig.GuildBattleLevel,i=1;for(var n in e)if(t==e[n].fbId){if(!(e[n].id<4))return 0;i=e[n].id+1}return e[i].feats},e.prototype.getMapLevelInfo=function(){var t=GameMap.fubenID,e=GlobalConfig.GuildBattleLevel,i=1;for(var n in e)t==e[n].fbId&&(i=e[n].id);return e[i]},e.prototype.decodeMyGuildRankInfo=function(t){var e=t.readInt();this.myRankList=[];for(var i,n=0;e>n;n++)i=new MyRankGuildInfo,i.parse(t),this.myRankList.push(i);GuildWar.ins().postMyRankChange()},e.prototype.changeWeiXieList=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=""),Actor.handle!=t){var n=this.checkListElements(t,this.weixieList);e?-1==n&&(this.weixieList.push(t),TipsCT.ins().showTips("|C:0xf3311e&T:"+i+" 正在攻击你|")):-1!=n&&this.weixieList.splice(n,1),GuildWar.ins().postWeixieChange(0)}},e.prototype.changecanPlayList=function(t,e){if(void 0===e&&(e=!0),Actor.handle!=t){var i=this.checkListElements(t,this.canPlayList);e?-1==i&&this.canPlayList.push(t):-1!=i&&this.canPlayList.splice(i,1),GuildWar.ins().postCanplayChange()}},e.prototype.decodeGulidWarResult=function(t){ViewManager.ins().open(GuildWarResultWin,t.readString(),t.readInt(),t.readInt(),t.readInt(),t.readInt())},e.prototype.checkListElements=function(t,e){if(e.length<=0)return-1;for(var i=0;i<e.length;i++)if(e[i]==t)return i;return-1},e.prototype.getRewardByPoint=function(t){var e=[];if(!this.dataList){this.dataList=[];var i=GlobalConfig.GuildBattlePersonalAward;for(var n in i)this.dataList.push(i[n])}for(var s=this.dataList.length,o=0;s>o;o++)t>=this.dataList[o].integral&&(e=e.concat(this.dataList[o].award));return e},e.prototype.getMyPointReward=function(){var t,e=GlobalConfig.GuildBattlePersonalAward;for(var i in e)if(t=e[i],t.id==this.pointInfo.id)return t;return null},e.prototype.getMaxReward=function(){var t,e,i=GlobalConfig.GuildBattlePersonalAward,n=0;for(var s in i)t=i[s],t.integral>n&&(n=t.integral,e=t);return e},Object.defineProperty(e.prototype,"clickTime",{get:function(){return this._clickTime},set:function(t){this.canClick=!1,this._clickTime=t,Timer.stop(this.endTimeChangeStatu,this),Timer.start(1e3,this._clickTime,this.endTimeChangeStatu,this)},enumerable:!0,configurable:!0}),e.prototype.endTimeChangeStatu=function(){--this._clickTime,this._clickTime<=0&&(this.canClick=!0,Timer.stop(this.endTimeChangeStatu,this))},Object.defineProperty(e.prototype,"canSendReward",{get:function(){return Guild.ins().myOffice==GuildOffice.GUILD_BANGZHU&&this._canSendReward},set:function(t){this._canSendReward=t},enumerable:!0,configurable:!0}),e.prototype.getCanSendNumByRank=function(t){void 0===t&&(t=-1);var e=GlobalConfig.GuildBattleDistributionAward[this.guildWarRank],i=0;for(var n in e)if(!e[n].rewardFlag||this.rewardFlag==GuildFlag.hf){if(n==t+1+"")return e[n].count;++i}return i},e.prototype.checkISSendAll=function(){for(var t=this.getCanSendNumByRank(),e=0;t>e;e++){var i=this.getCanSendNumByRank(e);if(!this.sendList[e])return TipsCT.ins().showTips("|C:0xf3311e&T:|请先选择需要分配奖励的成员"),!1;for(var n=0,s=0;s<this.sendNumList[e].length;s++)n+=this.sendNumList[e][s];if(i>n)return TipsCT.ins().showTips("|C:0xf3311e&T:|请先选择需要分配奖励的成员"),!1;for(var s=0;s<this.sendList[e].length;s++)if(!Guild.ins().checkIsInGuild(this.sendList[e][s].roleID))return TipsCT.ins().showTips("|C:0xf3311e&T:|"+this.sendList[e][s].name+" 已退出公会"),!1}return!0},Object.defineProperty(e.prototype,"acEndTime",{get:function(){return this._acEndTime},set:function(t){this._acEndTime=t,this._acEndTime>0&&(Timer.stop(this.reduceTime,this),Timer.start(1e3,t,this.reduceTime,this))},enumerable:!0,configurable:!0}),e.prototype.reduceTime=function(){--this._acEndTime,this._acEndTime<=0&&Timer.stop(this.reduceTime,this)},e.prototype.setOpenDesc=function(){if(0==this.startTime)return"";var t=new Date(1e3*(this.startTime+1));return t.getMonth()+1+"月"+t.getDate()+"号(周"+this.guildWarNumDaXie[t.getDay()]+")"+(t.getHours()+":"+t.getMinutes()+"开启沙城争霸")},e.prototype.getCdByType=function(t){if(0==GameMap.fubenID)return 0;var e=GlobalConfig.GuildBattleLevel;for(var i in e)if(e[i].fbId==GameMap.fubenID&&(1==t||3==t))return e[i].switchSceneCd;return 0},e.prototype.getIsShowGuildWarBtn=function(){if(0==this.startTime||GlobalConfig.GuildBattleConst.openLevel>Actor.level)return 0;var t=new Date(1e3*this.startTime),e=new Date(GameServer.serverTime);return t.getDate()==e.getDate()&&(e.getHours()<20||20==e.getHours()&&e.getMinutes()<=15)||this.isWatStart?1:0},e.prototype.rankListChange=function(t){var e=t.readInt();this.rankList=[];for(var i,n=0;e>n;n++)i=new WarRankInfo,i.parse(t),this.rankList.push(i);GuildWar.ins().postRankListChange()},e.prototype.decodePointRewardInfo=function(t){this.pointInfo||(this.pointInfo=new PointRewarddInfo),this.pointInfo.parse(t),GuildWar.ins().postPointRewardChange()},e.prototype.getSelectDataByIndex=function(t){var e,i,n=[];if(this.sendList&&this.sendList[t]&&this.sendList[t].length>0){e=this.sendList[t],i=this.sendNumList[t];for(var s=void 0,o=0;o<e.length;o++)s=new SelectInfoData,s.data=e[o],s.num=i[o],n.push(s)}return n},e.prototype.getMyPointRankReward=function(t){var e=GlobalConfig.GuildBattlePersonalRankAward;for(var i in e)if(e[i].rank==t)return e[i].award;return[]},e.prototype.doEndDoorTime=function(t){this._doorEndtime=t,Timer.stop(this.timeDo,this),Timer.start(1e3,this._doorEndtime,this.timeDo,this)},e.prototype.timeDo=function(){--this._doorEndtime,this._doorEndtime<=0&&(this._doorEndtime=0,Timer.stop(this.timeDo,this))},Object.defineProperty(e.prototype,"doorEndtime",{get:function(){return this._doorEndtime},enumerable:!0,configurable:!0}),e.prototype.getMyGuildPointRank=function(){var t,e,i=Guild.ins().getGuildMembers(0),n=i.length;this.myGuildPointRank=[];for(var s=0;n>s;s++)t=i[s],e=new SelectInfoData,e.data=t,e.num=this.getPointByAcId(t.roleID),this.myGuildPointRank.push(e);return this.myGuildPointRank.sort(this.sort),this.myGuildPointRank},e.prototype.getPointByAcId=function(t){for(var e=this.myRankList.length,i=0;e>i;i++)if(this.myRankList[i].roleID==t)return this.myRankList[i].point;return 0},e.prototype.sort=function(t,e){var i=t.num,n=e.num;return i>n?-1:n>i?1:0},e.prototype.setMyGuildNum=function(t,e){void 0===e&&(e=!0);var i=this.checkListElements(t,this.guildHandleList);e?-1==i&&this.guildHandleList.push(t):i>-1&&this.guildHandleList.splice(i,1),this.guildNum=this.guildHandleList.length,GuildWar.ins().postGuildNumChange()},e.prototype.clearGuildWarList=function(){this.checkinAppoint()&&(this.weixieList=[],this.canPlayList=[],this.attHandle=0,this.guildHandleList=[])},e}(egret.HashObject);__reflect(GuildWarModel.prototype,"GuildWarModel");var GuildRedRobInfo=function(){function t(){}return t.prototype.parse=function(t){this.robNum=t.readInt(),this.robName=t.readString(),this.acId=t.readInt()},t}();__reflect(GuildRedRobInfo.prototype,"GuildRedRobInfo");var RankGuildInfo=function(){function t(){}return t.prototype.parse=function(t){this.guildName=t.readString(),this.ownName=t.readString(),this.guildPoint=t.readInt()},t}();__reflect(RankGuildInfo.prototype,"RankGuildInfo");var MyRankGuildInfo=function(){function t(){}return t.prototype.parse=function(t){this.roleID=t.readInt(),this.myName=t.readString(),this.mapName=t.readString(),this.point=t.readInt(),this.attr=t.readInt(),this.office=t.readInt(),this.job=t.readInt(),this.sex=t.readInt()},t}();__reflect(MyRankGuildInfo.prototype,"MyRankGuildInfo");var WinGuildInfo=function(){function t(){this.guildId=0,this.guildName="",this.guildOwnName="",this.guildOwnId=0,this.guildOwnJob=0,this.guildOwnSex=0,this.clothID=0,this.wapenId=0,this.wingOpen=0,this.winId=0}return t.prototype.parse=function(t){this.guildId=t.readInt(),this.guildName=t.readString(),this.guildOwnName=t.readString(),this.guildOwnId=t.readInt(),this.guildOwnJob=t.readByte(),this.guildOwnSex=t.readByte(),this.clothID=t.readInt(),this.wapenId=t.readInt(),this.wingOpen=t.readInt(),this.winId=t.readInt()},t}();__reflect(WinGuildInfo.prototype,"WinGuildInfo");var WarRankInfo=function(){function t(){}return t.prototype.parse=function(t){this.name=t.readString(),this.point=t.readInt()},t}();__reflect(WarRankInfo.prototype,"WarRankInfo");var PointRewarddInfo=function(){function t(){}return t.prototype.parse=function(t){this.isCan=t.readBoolean(),this.id=t.readInt(),this.point=t.readInt()},t}();__reflect(PointRewarddInfo.prototype,"PointRewarddInfo");var GuildFlag;!function(t){t[t.act=0]="act",t[t.hf=1]="hf",t[t.kf=2]="kf"}(GuildFlag||(GuildFlag={}));var SelectInfoData=function(){function t(){}return t}();__reflect(SelectInfoData.prototype,"SelectInfoData"),window.SelectInfoData=SelectInfoData;var GuildRoleSkillInfo=function(){function t(){this.guildSkillInfo=[],this.practiceSkillInfo=[]}return t}();__reflect(GuildRoleSkillInfo.prototype,"GuildRoleSkillInfo"),window.GuildRoleSkillInfo=GuildRoleSkillInfo;var RobberStartInfo=function(){function t(){}return t}();__reflect(RobberStartInfo.prototype,"RobberStartInfo"),window.RobberStartInfo=RobberStartInfo;var GuildActityItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildActityItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.goBtn0:this.conBtnOnCLick()}},e.prototype.conBtnOnCLick=function(){var t=this.data;return GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum<=0?void TipsCT.ins().showTips("|C:0xf3311e&T:公会兽人军团已经全部被击杀了！|"):void(1==t.id&&ViewManager.ins().close(GuildActivityWin))},e.prototype.dataChanged=function(){var t=this.data;if(t){if(t.id&&(this.taskIcon.source="guildActity_"+t.id),t.context){var e=t.context;if(t.openDay&&GameServer.serverOpenDay<t.openDay-1){var i=TextFlowMaker.getCStr(t.openDay);e=e.replace("\n","|C:0x35e62d&S:14&T:（开服第"+i+"天开启）|\n")}this.nameLab.textFlow=TextFlowMaker.generateTextFlow1(e)}1==t.id&&(this.descLab.text="本轮剩余强盗："+(GuildRobber.ins().robberTotal-GuildRobber.ins().robberDealNum)+"/"+GuildRobber.ins().robberTotal)}},e}(BaseItemRender);__reflect(GuildActityItemRender.prototype,"GuildActityItemRender"),window.GuildActityItemRender=GuildActityItemRender;var GuildActityPanel=function(t){function e(){var e=t.call(this)||this;return e.initUI(),e.name="公会活动",e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GuildActitySkin",this.list.itemRenderer=GuildActityItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.updateData(),this.addTouchEvent(this.list,this.onListTouch)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.list,this.onListTouch)},e.prototype.updateData=function(){var t=[];for(var e in GlobalConfig.GuildActivityConfig){var i=GlobalConfig.GuildActivityConfig[e];t.push(i)}this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent.parent;e.onTap(t.target)}},e}(BaseView);__reflect(GuildActityPanel.prototype,"GuildActityPanel"),window.GuildActityPanel=GuildActityPanel;var GuildActivityWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildActivityBgSkin",this.tab.dataProvider=this.viewStack,this.activityPanel=new GuildActityPanel},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||TipsCT.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,GameServer.serverOpenDay>=GlobalConfig.GuildActivityConfig[1].openDay-1&&this.viewStack.addChild(this.activityPanel),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(GuildFB.ins().postGuildFubenInfo,this.updateRedpoint),this.viewStack.getElementAt(this.lastSelect).open(),this.updateRedpoint()},e.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildFB.ins().hasbtn()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e}(BaseEuiView);__reflect(GuildActivityWin.prototype,"GuildActivityWin"),ViewManager.ins().reg(GuildActivityWin,LayerManager.UI_Main),window.GuildActivityWin=GuildActivityWin;var GuildAppltListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberApplyItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("战期间,不允许对申请玩家进行操作",function(){},this);switch(t){case this.ok:var e=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_COMMENT-1)||0,i=e?GlobalConfig.GuildConfig.affairMember[e-1]:0;if(Guild.ins().getMemberNum()>=GlobalConfig.GuildConfig.maxMember[Guild.ins().guildLv-1]+i)return void TipsCT.ins().showTips("|C:0xf3311e&T:公会成员已满|");Guild.ins().sendProcessJoin(this.data.roleID,1);break;case this.cancel:Guild.ins().sendProcessJoin(this.data.roleID,0)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildApplyInfo){var t=this.data;t.vipLevel>0?this.nameLab.x=162:this.nameLab.x=109;var e="<font color='#C2BAA5'>"+t.name+"</font>";this.nameLab.textFlow=(new egret.HtmlTextParser).parser(e),this.attack0.text=t.attack+"",this.myFace.source="head_"+t.job+t.sex,this.vipTitle.visible=t.vipLevel>0}},e}(BaseItemRender);__reflect(GuildAppltListItemRender.prototype,"GuildAppltListItemRender"),window.GuildAppltListItemRender=GuildAppltListItemRender;var GuildApplyListWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberApplySkin",e.list.itemRenderer=GuildAppltListItemRender,e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.attrNum.restrict="0-9",this.attrNum.maxChars=8},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postApplyInfos,this.updateList),Guild.ins().sendApplyInfos(),this.addTouchEvent(this.checkBoxs,this.onTap),this.addChangeEvent(this.attrNum,this.onTxtChange),this.checkBoxs.selected=1==Guild.ins().isAuto,this.attrNum.text=Guild.ins().attrLimit+""},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.attrNum.removeEventListener(egret.Event.CHANGE,this.onTxtChange,this)},e.prototype.onTxtChange=function(t){Guild.ins().sendAddGuildLimit(this.checkBoxs.selected?1:0,parseInt(this.attrNum.text))},e.prototype.updateList=function(t){t.sort(this.sort),this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap(t.target)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.checkBoxs:this.onTxtChange(null)}},e.prototype.sort=function(t,e){return t.attack>e.attack?-1:t.attack<e.attack?1:0},e}(BaseEuiView);__reflect(GuildApplyListWin.prototype,"GuildApplyListWin"),ViewManager.ins().reg(GuildApplyListWin,LayerManager.UI_Main),window.GuildApplyListWin=GuildApplyListWin;var GuildApplyWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.dataArr=new eui.ArrayCollection([]),e.skinName="GuildApplySkin",e.list.itemRenderer=GuildListItemRender,e.list.dataProvider=e.dataArr,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.createBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onListTouch),this.observe(Guild.ins().postGuildList,this.updateList),Guild.ins().sendGuildList()},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;e.onTap()}},e.prototype.updateList=function(){this.noGuild.visible=0==Guild.ins().guildListInfos.length,this.dataArr.replaceAll(Guild.ins().guildListInfos)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.createBtn:ViewManager.ins().open(GuildCreateWin)}},e.prototype.destoryView=function(){t.prototype.destoryView.call(this);for(var e=0;e<this.list.numElements;e++)this.list.getElementAt(e)&&this.list.getElementAt(e).destruct()},e}(BaseEuiView);__reflect(GuildApplyWin.prototype,"GuildApplyWin"),window.GuildApplyWin=GuildApplyWin,ViewManager.ins().reg(GuildApplyWin,LayerManager.UI_Popup);var GuildBuildItemRender=function(t){function e(){var e=t.call(this)||this;return e._maxLevel=0,e._curLevel=0,e._nextMoney=0,e.skinName="GuildManageItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.upBtn:var e=this.data;if(Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU)return void TipsCT.ins().showTips("仅会长可操作");if(e==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel)return void TipsCT.ins().showTips("等级已满");if(e!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv)return void TipsCT.ins().showTips("请先升级管理大厅");if(Guild.ins().money<this._nextMoney)return void TipsCT.ins().showTips("资金不足");Guild.ins().sendUpBuilding(e)}},e.prototype.dataChanged=function(){var t=this.data;this.buildImg.visible=1==t,this._curLevel=Guild.ins().getBuildingLevels(t-1)||0;var e=GlobalConfig.GuildLevelConfig[t],i=null,n=null;for(var s in e)if(e.hasOwnProperty(s)){var o=e[s];this._maxLevel=o.level>this._maxLevel?o.level:this._maxLevel,o.level==this._curLevel&&(i=o),o.level==this._curLevel+1&&(n=o)}(i||n||t==GuildBuilding.GUILD_LIANGONGFANG)&&(this.nameLab.text=GlobalConfig.GuildConfig.buildingNames[t-1],this.levelLab.text="等级 "+(null==this._curLevel?0:this._curLevel),n&&this._curLevel<this._maxLevel?(this._nextMoney=n.upFund,this.upLevelLab.text=t==GuildBuilding.GUILD_HALL?"":"升级要求：管理大厅达到"+(this._curLevel+1)+"级",this.money.text=Guild.ins().money+"/"+n.upFund,this.needMoney.text="需资金："+n.upFund,this.progress.maximum=n.upFund,this.progress.value=Guild.ins().money,this.progress.visible=!0):(this.upLevelLab.text="等级已满",i?this.money.text=Guild.ins().money+"/"+i.upFund:this.money.text="已满级",this.needMoney.text="",this.progress.visible=!1),this.buildingLab.text=GlobalConfig.GuildConfig.buildingTips[t-1]),this.manege.source="guildmn"+t+"_png",t==GuildBuilding.GUILD_SHOP&&(this.progress.visible=this.progressbg.visible=this.progressblack.visible=this.levelLab.visible=this.needMoney.visible=this.money.visible=!1,this.upBtn.touchEnabled=!1,this.upBtn.label="敬请期待",this.upBtn.currentState="disabled",this.upBtn.verticalCenter=0),this.updateRedPoint()},e.prototype.updateRedPoint=function(){var t=this.data;return t==GuildBuilding.GUILD_SHOP?void(this.redPoint.visible=!1):Guild.ins().myOffice<GuildOffice.GUILD_FUBANGZHU?void(this.redPoint.visible=!1):t==GuildBuilding.GUILD_HALL&&this._curLevel>=this._maxLevel?void(this.redPoint.visible=!1):t!=GuildBuilding.GUILD_HALL&&this._curLevel>=Guild.ins().guildLv?void(this.redPoint.visible=!1):Guild.ins().money<this._nextMoney?void(this.redPoint.visible=!1):void(this.redPoint.visible=!0)},e}(BaseItemRender);__reflect(GuildBuildItemRender.prototype,"GuildBuildItemRender"),window.GuildBuildItemRender=GuildBuildItemRender;var GuildChangeNameView=function(t){function e(){var e=t.call(this)||this;return e.skinName="guildNameChange",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:this.onChangeName()}},e.prototype.onChangeName=function(){if(""==this.input.text)TipsCT.ins().showTips("请输入行会名字");else{if(!RoleMgr.ins().checkName(this.input.text))return;Guild.ins().sendGuildChangeName(this.input.text),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildChangeNameView.prototype,"GuildChangeNameView"),ViewManager.ins().reg(GuildChangeNameView,LayerManager.UI_Popup),window.GuildChangeNameView=GuildChangeNameView;var GuildConWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildConSkin",this.desc0.text="捐献"+GlobalConfig.GuildDonateConfig[1].count+"元宝",this.desc1.text="捐献"+GlobalConfig.GuildDonateConfig[2].count+"金币",this.info0.text="贡献 +"+GlobalConfig.GuildDonateConfig[1].awardContri+"	资金 +"+GlobalConfig.GuildDonateConfig[1].awardFund,this.info1.text="贡献 +"+GlobalConfig.GuildDonateConfig[2].awardContri+"	资金 +"+GlobalConfig.GuildDonateConfig[2].awardFund
},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.update=function(){var t=GlobalConfig.GuildDonateConfig[1].dayCount[Actor.vip],e=GlobalConfig.GuildDonateConfig[1].dayCount[Actor.vip+1],i=Guild.ins().getConCount();i[0]<=0?(e&&e-t>0?this.count0.textFlow=(new egret.HtmlTextParser).parser("<font color='#f3311e'>"+VipCT.getVipStr(Actor.vip+1,!0)+"</font>额外捐献"+(e-t)+"次"):this.count0.text=t-i[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[Actor.vip],this.btn0.enabled=!1):(this.btn0.enabled=!0,this.count0.text=t-i[0]+"/"+GlobalConfig.GuildDonateConfig[1].dayCount[Actor.vip]),this.btn1.enabled=i[1]>0,this.count1.text=GlobalConfig.GuildDonateConfig[2].dayCount-i[1]+"/"+GlobalConfig.GuildDonateConfig[2].dayCount,this.redPoint0.visible=!!GlobalConfig.GuildDonateConfig[1].count&&i[0]>0&&Actor.yb>=GlobalConfig.GuildDonateConfig[1].count,this.redPoint1.visible=!!GlobalConfig.GuildDonateConfig[2].count&&i[1]>0&&Actor.gold>=GlobalConfig.GuildDonateConfig[2].count},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Guild.ins().postConCount,this.update),Guild.ins().sendConCount(),0==Actor.vip?this.btn0.label="成为VIP":this.btn0.label="捐 献"},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){var e=Guild.ins().getConCount();switch(t.currentTarget){case this.btn0:0==Actor.vip?ViewManager.ins().open(VipWin):e[0]<=0?TipsCT.ins().showTips("次数不足"):Actor.yb>=GlobalConfig.GuildDonateConfig[1].count?Guild.ins().sendCon(1):(TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this));break;case this.btn1:e[1]<=0?TipsCT.ins().showTips("次数不足"):Actor.gold>=GlobalConfig.GuildDonateConfig[2].count?Guild.ins().sendCon(2):TipsCT.ins().showTips("金币不足");break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildConWin.prototype,"GuildConWin"),ViewManager.ins().reg(GuildConWin,LayerManager.UI_Popup),window.GuildConWin=GuildConWin;var GuildCreateWin=function(t){function e(){var e=t.call(this)||this;return e.selectLevel=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildBuildSkin",this.leftLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(1)),this.rightLab.textFlow=(new egret.HtmlTextParser).parser(this.formatLab(2))},e.prototype.changeSelect=function(t){this.selectLevel=t,this.selectBmp.x=1==this.selectLevel?this.bg1.x:this.bg2.x},e.prototype.formatLab=function(t){var e=GlobalConfig.GuildCreateConfig,i=GlobalConfig.GuildConfig,n=e[t].vipLv,s=n>0?"<font color='#3a8fee'>("+VipCT.getVipStr(n,!0)+"可创建)</font>":"",o=0==e[t].award?"\n":"\n返还<font color='#0FEE27'>"+e[t].award.toString()+"</font>公会贡献",a="<font color='#FFDB00' size='20'>"+e[t].level.toString()+"级</font>公会\n"+s+"\n容纳<font color='#0FEE27'>"+i.maxMember[t-1]+"</font>公会成员"+o+"\n\n创建消耗:<font color='#FFDB00'>"+e[t].moneyCount.toString()+"</font>元宝",r="<font color='#DFD1B5' size='16'>"+a+"</font>";return r},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),this.addTouchEvent(this.leftLab,this.onTap),this.addTouchEvent(this.rightLab,this.onTap),this.addTouchEvent(this.okBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.textInput.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.updateInputText=function(t){this.textInput.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.textInput.text&&(this.textInput.text="")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.textInput.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.okBtn:var i=GlobalConfig.GuildCreateConfig,n=i[this.selectLevel],s=i[n.level].vipLv;if(Actor.vip<s)return void TipsCT.ins().showTips(VipCT.getVipStr(s)+"等级不足");if(""==this.textInput.text)TipsCT.ins().showTips("请输入行会名字");else if(Actor.yb<n.moneyCount)TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this);else{if(!RoleMgr.ins().checkName(this.textInput.text))return;WarnWin.show("你将消耗"+n.moneyCount+"元宝，创建"+n.level+"级公会["+this.textInput.text+"]，确定创建？",function(){Guild.ins().sendGuildCreate(e.selectLevel,e.textInput.text)},this)}break;case this.leftLab:this.changeSelect(1);break;case this.rightLab:this.changeSelect(2);break;case this.chatGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.textInput.text+""||"")}},e}(BaseEuiView);__reflect(GuildCreateWin.prototype,"GuildCreateWin"),ViewManager.ins().reg(GuildCreateWin,LayerManager.UI_Popup),window.GuildCreateWin=GuildCreateWin;var GuildEventItenRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildEventItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if("string"==typeof this.data){var t=this.data;t&&""!=t&&(this.info.text=t)}},e}(BaseItemRender);__reflect(GuildEventItenRender.prototype,"GuildEventItenRender"),window.GuildEventItenRender=GuildEventItenRender;var GuildFirePanel=function(t){function e(){var e=t.call(this)||this;return e.itemCount=0,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.give,this.onGive),this.observe(Guild.ins().postUpdateFire,this.update),this.update()},e.prototype.close=function(){},e.prototype.update=function(){var t=Guild.ins().fireDic;t.fireLvl>0?this.firestar.visible=!0:this.firestar.visible=!1;for(var e=0;;){if(!this["lv"+e])break;this["lv"+e].visible=t.fireLvl>=e,this["fire"+e]&&(this["fire"+e].visible=t.fireLvl==e),e+=1}var i=GlobalConfig.GuildBonFireConfig[t.fireLvl],n=GlobalConfig.GuildBonFireConfig[t.fireLvl+1];i?(this.progressBar.maximum=i.value,this.progressBar.value=t.fireVal):(this.progressBar.maximum=100,this.progressBar.value=100);var s=GlobalConfig.GuildConfig,o=BagCT.ins().getBagItemById(s.bonfireItem);o?(this.count.text=""+o.count,this.cha.textColor=this.count.textColor=3532333,this.itemCount=o.count,this.redPoint.visible=!0):(this.count.text="0",this.cha.textColor=this.count.textColor=16711680,this.itemCount=0,this.redPoint.visible=!1),n?(this.desc1.textFlow=TextFlowMaker.generateTextFlow1("每捐献 1 个柴火增加 |C:0x35E62D&T:"+s.bonfireValue+"| 点篝火值以及 |C:0x35E62D&T:"+s.bonfireReward[0].count+"| 点行会贡献"),this.desc2.textFlow=TextFlowMaker.generateTextFlow1("再捐献总计 |C:0x35E62D&T:"+(i.value-t.fireVal)/s.bonfireValue+"| 个柴火可增加 |C:0x35E62D&T:"+n.reward+"| 行会资金")):(this.desc1.textFlow=TextFlowMaker.generateTextFlow1("每捐献 1 个柴火增加 |C:0x35E62D&T:"+s.bonfireValue+"| 点篝火值以及 |C:0x35E62D&T:"+s.bonfireReward[0].count+"| 点行会贡献"),this.desc2.textFlow=TextFlowMaker.generateTextFlow1("篝火值已达到最大 次日可增加 |C:0x35E62D&T:"+i.reward+"| 行会资金"))},e.prototype.onGive=function(){if(this.itemCount>0){var t=GlobalConfig.GuildConfig.bonfirecount;this.itemCount<t&&(t=this.itemCount),this.itemCount-=t,Guild.ins().sendToFire(t,this.itemCount)}else TipsCT.ins().showTips("道具不足")},e}(BaseView);__reflect(GuildFirePanel.prototype,"GuildFirePanel"),window.GuildFirePanel=GuildFirePanel;var GuildListItem2Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildListItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var t=this.data,e=GlobalConfig.GuildConfig;if(t&&e){t.guildRank<4?(this.numImg.source="guildshop_json.guildpaihang"+t.guildRank,this.numLab.visible=!1,this.numImg.visible=!0):(this.numLab.text=t.guildRank+"",this.numLab.visible=!0,this.numImg.visible=!1),this.nameLab.textFlow=(new egret.HtmlTextParser).parser(t.guildName),this.member0.text=""+t.guildLevel,this.president.text=t.guildPresident;var i=t.commentLv,n=i?GlobalConfig.GuildConfig.affairMember[i-1]:0;this.member.text=t.guildMember+"/"+(e.maxMember[t.guildLevel-1]+n),this.attrLab.text=""+t.attr}}},e}(BaseItemRender);__reflect(GuildListItem2Render.prototype,"GuildListItem2Render"),window.GuildListItem2Render=GuildListItem2Render;var GuildListItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ApplyItemSkin",e}return __extends(e,t),e.prototype.onTap=function(){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("战期间,不允许申请加入公会",function(){},this);var t=this.data;if(-1==Guild.ins().applyGuilds.indexOf(t.guildID)){if(this.data.attr>Actor.power)return void TipsCT.ins().showTips("|C:0xf3311e&T:战斗力过低|");this.applyBtn.enabled=!1,this.applyBtn.label="已申请",Guild.ins().applyGuilds.push(t.guildID),Guild.ins().sendJoinGuild(t.guildID)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildListInfo){var t=this.data,e=GlobalConfig.GuildConfig;if(t&&e){this.numLab.text=t.guildRank+"",this.nameLab.textFlow=(new egret.HtmlTextParser).parser(t.guildName+("<font color='#0FEE27'>(Lv."+t.guildLevel+")</font>")),this.president.text=t.guildPresident;var i=t.commentLv?GlobalConfig.GuildConfig.affairMember[t.commentLv-1]:0;this.member.textColor=t.guildMember<e.maxMember[t.guildLevel-1]+i?5226466:15937822,this.member.text=t.guildMember+"/"+(e.maxMember[t.guildLevel-1]+i);var n=CommonUtils.overLength(t.attr);this.attrLabel.visible=n?!0:!1,n&&(this.attrLabel.text="战力要求："+n),Guild.ins().applyGuilds.indexOf(t.guildID)>-1?(this.applyBtn.enabled=!1,this.applyBtn.label="已申请"):(this.applyBtn.enabled=!0,this.applyBtn.label="申请")}}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(GuildListItemRender.prototype,"GuildListItemRender"),window.GuildListItemRender=GuildListItemRender;var GuildMap=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="GuildSkin",this.list.itemRenderer=GuildMapMemberItemRender,this.guildWarEffect2=new MovieClip,this.guildRewardEff=new MovieClip,this.guildRewardEff.touchEnabled=!0,this.guildRewardEff2=new MovieClip,this.guildRewardEff2.touchEnabled=!0},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;var i=0!=Guild.ins().guildID;return i||ViewManager.ins().open(GuildApplyWin),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.manageBtn,this.onTap),this.addTouchEvent(this.practiseBtn,this.onTap),this.addTouchEvent(this.shopBtn,this.onTap),this.addTouchEvent(this.cityBtn,this.onTap),this.addTouchEvent(this.chatBtn,this.onTap),this.addTouchEvent(this.guildRewardEff,this.onTap),this.addTouchEvent(this.guildRewardEff2,this.onTap),this.observe(GuildRedPoint.ins().postGuildFire,this.updateRedpoint),this.observe(GuildSoulsRedPoint.ins().postRedPoint,this.updateRedpoint),this.observe(GuildBoss.ins().postGuildBossDetailChange,this.updateRedpoint),Guild.ins().sendMyGuildInfo(),GuildWar.ins().requestGuildRank(),GuildBoss.ins().sendGetBossInfo(),this.updateRedpoint(),GuildRobber.ins().isUpdateRobber&&(GuildRobber.ins().isUpdateRobber=!1,GuildRobber.ins().sendRobberInfo()),this.observe(GuildWar.ins().postGuildWarStarInfo,this.refushGuildwarEffect),this.refushGuildwarEffect(),this.observe(GuildRedPoint.ins().postSendReward,this.updateSendBtnStatu),this.updateSendBtnStatu(),this.observe(GuildRedPoint.ins().postSczb,this.updateGuildPoint),this.updateGuildPoint(),this.observe(GuildRedPoint.ins().postHhdt,this.hhdtRed),this.hhdtRed(),this.observe(GuildRedPoint.ins().postHanghuiBoss,this.updateBossPoint),this.updateBossPoint(),this.observe(Guild.ins().postGuildMembers,this.updateList),this.updateList(),this.observe(CrossGuildBattleCT.ins().postAssignInfo,this.updateSendBtnStatu2),this.updateSendBtnStatu2()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.guildWarEffect2),DisplayUtils.removeFromParent(this.guildRewardEff),DisplayUtils.removeFromParent(this.guildRewardEff2)},e.prototype.hhdtRed=function(){this.redPoint0.visible=GuildRedPoint.ins().hhdt},e.prototype.updateRedpoint=function(){this.redPoint1.visible=GuildRedPoint.ins().guildFire||GuildRedPoint.ins().liangongRed||GuildSoulsRedPoint.ins().redPoint},e.prototype.updateGuildPoint=function(){this.redPoint2.visible=GuildRedPoint.ins().sczb},e.prototype.updateBossPoint=function(){this.redPoint3.visible=GuildRedPoint.ins().hhBoss},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(Guild.ins().getGuildMembers(2))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.practiseBtn:ViewManager.ins().close(e),ViewManager.ins().open(GuildSkillWin);break;case this.manageBtn:ViewManager.ins().close(e),ViewManager.ins().open(GuildWin);break;case this.cityBtn:GuildWar.ins().requestWinGuildInfo(),ViewManager.ins().close(e),ViewManager.ins().open(GuildWarMainWin);break;case this.shopBtn:ViewManager.ins().open(GuildBossWin);break;case this.chatBtn:ViewManager.ins().open(ChatWin);break;case this.guildRewardEff:ViewManager.ins().open(SelectMemberRewardWin);break;case this.guildRewardEff2:ViewManager.ins().open(SelectMemberRewardWinEx)}},e.prototype.updateSendBtnStatu=function(){GuildRedPoint.ins().sendReward?(this.guildRewardEff.playFile(RES_DIR_EFF+"Gifteff",-1),this.reward.addChild(this.guildRewardEff)):DisplayUtils.removeFromParent(this.guildRewardEff)},e.prototype.updateSendBtnStatu2=function(){CrossGuildBattleCT.ins().guildRewards&&CrossGuildBattleCT.ins().guildRewards.length>0?(this.guildRewardEff2.playFile(RES_DIR_EFF+"Gifteff",-1),this.reward2.addChild(this.guildRewardEff2)):DisplayUtils.removeFromParent(this.guildRewardEff2)},e.prototype.refushGuildwarEffect=function(){GuildWar.ins().getModel().isWatStart?(this.guildWarEffect2.playFile(RES_DIR_EFF+"BattlEff3",-1),this.guildWarEffect2.x=28,this.guildWarEffect2.y=30,this.cityBtn.addChild(this.guildWarEffect2)):DisplayUtils.removeFromParent(this.guildWarEffect2)},e}(BaseEuiView);__reflect(GuildMap.prototype,"GuildMap"),window.GuildMap=GuildMap,ViewManager.ins().reg(GuildMap,LayerManager.UI_Popup);var GuildMapMemberItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="gongxianitemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var t=this.data;t&&(this.nameLab.text=t.name,this.office.text=GuildLanguage.guildOffice[t.office],this.conLab.text=t.curContribution+"")}},e}(BaseItemRender);__reflect(GuildMapMemberItemRender.prototype,"GuildMapMemberItemRender"),window.GuildMapMemberItemRender=GuildMapMemberItemRender;var GuildMemberItem1Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data instanceof GuildMemberInfo&&(this.nameLab.text=this.data.name,this.office.text=GuildLanguage.guildOffice[this.data.office],this.conLab.text=this.data.contribution+"",this.vipTitle.visible=this.data.vipLevel>0)},e}(BaseItemRender);__reflect(GuildMemberItem1Render.prototype,"GuildMemberItem1Render"),window.GuildMemberItem1Render=GuildMemberItem1Render;var GuildMemberItem2Render=function(t){function e(){var e=t.call(this)||this;return e.skinName="MemberItem2Skin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){MessageCenter.ins().removeAll(e)},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){t.target instanceof eui.Button||e.data&&ViewManager.ins().open(PlayerTipsWin,e.data)},this)},e.prototype.onTap=function(t){if(GuildWar.ins().getModel().isWatStart)return void WarnWin.show("战期间,不允许禅让/降职/任命副会长/踢出操作",function(){},this);var e=this.data,i=e.roleID;switch(t){case this.impeachBtn:WarnWin.show("是否消耗"+GlobalConfig.GuildConfig.impeachCost+"元宝弹劾会长？（弹劾后成为会长）",function(){Actor.yb>=GlobalConfig.GuildConfig.impeachCost?Guild.ins().sendDemise():TipsCT.ins().showTips("元宝不足")},this);break;case this.demiseBtn:WarnWin.show("是否禅让会长职位给["+e.name+"]",function(){Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_BANGZHU)},this);break;case this.downBtn:WarnWin.show("是否免除["+e.name+"]副会长之职",function(){Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_MEMBER)},this);break;case this.kickBtn:WarnWin.show("确定将["+e.name+"]踢出公会？",function(){Guild.ins().sendKick(i)},this);break;case this.appointBtn:WarnWin.show("确定任命["+e.name+"]为副会长？",function(){Guild.ins().canAppointFHZ()?Guild.ins().sendChangeOffice(i,GuildOffice.GUILD_FUBANGZHU):TipsCT.ins().showTips("副会长人数已达上限")},this);break;default:ViewManager.ins().open(PlayerTipsWin,this.data)}},e.prototype.dataChanged=function(){if(this.data instanceof GuildMemberInfo){var t=this.data;this.nameLab.textFlow=(new egret.HtmlTextParser).parser("["+GuildLanguage.guildOffice[t.office]+"]<font color='#DFDCDC'>"+t.name+"</font>"),this.conLab.text="贡献度："+t.contribution,this.attack.text="战斗力："+t.attack,this.face.source="head_"+t.job+t.sex,this.headBG.source=ChatListItemRenderer.HEAD_BG[t.sex];var e=0,i=Guild.ins().myOffice;switch(i==GuildOffice.GUILD_BANGZHU||i==GuildOffice.GUILD_FUBANGZHU?(this.onLine.visible=!0,t.downTime>0?(e=.001*(GameServer.serverTime-DateUtils.formatMiniDateTime(t.downTime)),this.onLine.textFlow=TextFlowMaker.generateTextFlow1("|C:0xf3311e&T:"+DateUtils.getFormatBySecond(e,7))):this.onLine.textFlow=(new egret.HtmlTextParser).parser("<font color='#13CE0C'>在线</font>")):this.onLine.visible=!1,this.group1.visible=!1,this.group2.visible=!1,this.group3.visible=!1,this.impeachBtn.visible=e>=432e3,this.vipTitle.visible=t.vipLevel>0,i){case GuildOffice.GUILD_BANGZHU:if(t.office==GuildOffice.GUILD_BANGZHU)break;t.office==GuildOffice.GUILD_FUBANGZHU?this.group2.visible=!0:(this.group3.visible=!0,this.appointBtn.visible=!0);break;case GuildOffice.GUILD_FUBANGZHU:if(t.office==GuildOffice.GUILD_BANGZHU)this.group1.visible=!0;else{if(t.office==GuildOffice.GUILD_FUBANGZHU)break;this.group3.visible=!0,this.appointBtn.visible=!1}break;case GuildOffice.GUILD_ZHANGLAO:case GuildOffice.GUILD_HUFA:case GuildOffice.GUILD_TANGZHU:t.office==GuildOffice.GUILD_BANGZHU&&(this.group1.visible=!0)}}},e}(BaseItemRender);__reflect(GuildMemberItem2Render.prototype,"GuildMemberItem2Render"),window.GuildMemberItem2Render=GuildMemberItem2Render;var GuildMosterPanel=function(t){function e(){var e=t.call(this)||this;return e.bossmc=new MovieClip,e.bossmc.scaleX=-.5,e.bossmc.scaleY=.5,e.bossmc.x=0,e.bossmc.y=0,e.addChild(e.bossmc),e.staticMc=new MovieClip,e.addChild(e.staticMc),e.staticMc.y=-60,e.addTouchEvent(e,e.onTap),e}return __extends(e,t),e.prototype.onTap=function(t){return 1==this.start.robberStart?void TipsCT.ins().showTips("|C:0xf3311e&T:正在被挑战中|"):(GuildRobber.ins().sendRobberChanger(this.index),void ViewManager.ins().close(GuildMap))},e.prototype.update=function(t,e,i){this.start=t;var n="";this.bossmc.playFile(RES_DIR_EFF+(n+"_"+i+"s"),-1),this.index=e+1,this.staticMc.playFile(RES_DIR_EFF+(0==t.robberStart?"AllowEff2":"BattlEff4"),-1)},e}(BaseView);__reflect(GuildMosterPanel.prototype,"GuildMosterPanel"),window.GuildMosterPanel=GuildMosterPanel;var GuildNoticeWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildNoticeSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.saveBtn,this.onTap),this.addTouchEvent(this.bgrect,this.onTap),this.textInput.text=Guild.ins().notice},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.saveBtn,this.onTap),this.removeTouchEvent(this.bgrect,this.onTap)},e.prototype.onTap=function(t){return __awaiter(this,void 0,void 0,function(){var e,i;return __generator(this,function(n){switch(n.label){case 0:switch(e=t.currentTarget){case this.closeBtn0:return[3,1];case this.closeBtn1:return[3,1];case this.bgrect:return[3,1];case this.saveBtn:return[3,2]}return[3,4];case 1:return ViewManager.ins().close(this),[3,4];case 2:return[4,ReportData.chackParty(this.textInput.text)];case 3:return i=n.sent(),Guild.ins().notice=i,Guild.ins().sendChangeNotice(i),ViewManager.ins().close(this),[3,4];case 4:return[2]}})})},e}(BaseEuiView);__reflect(GuildNoticeWin.prototype,"GuildNoticeWin"),ViewManager.ins().reg(GuildNoticeWin,LayerManager.UI_Main),window.GuildNoticeWin=GuildNoticeWin;var GuildShopPanel=function(t){function e(){var e=t.call(this)||this;return e.isOpenEff=!1,e.initUI(),e}return __extends(e,t),e.prototype.initUI=function(){this.skinName="GuildStoreWinSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.guildshopkaiqi,this.onTap),this.addTouchEvent(this.useBtn,this.onTap),this.addTouchEvent(this.guildMore,this.onTap),GuildStore.ins().getGuildStoreInfo(),GuildStore.ins().sendGuildStoreBoxInfo(),this.observe(GuildStore.ins().postGuildStoreInfo,this.onupdateData),this.observe(GuildStore.ins().postGuildStoreBox,this.onItemInfo),this.observe(GuildStore.ins().postGuildStoreBoxInfo,this.onReadInfo),this.onupdateData(),this.guildshopitem_7.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onupdateData=function(){if(GuildStore.ins().guildStoreLv>0){this.guildshopopen.visible=!0,this.guildshopclose.visible=!1,this.guildshopclose.touchEnabled=!1,this.guildshopopen.touchEnabled=!0,GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon?this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+""):this.guildshoplabel.textFlow=(new egret.HtmlTextParser).parser(Guild.ins().myCon+""),this.guildshopxiaolabel.text=""+GlobalConfig.GuildStoreConfig.needContrib;var t=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv-1],e=GlobalConfig.GuildStoreConfig.time[GuildStore.ins().guildStoreLv],i="";i=GuildStore.ins().guildStoreNum<=0?"<font color='#f3311e'>"+GuildStore.ins().guildStoreNum+"/"+t+"</font>":GuildStore.ins().guildStoreNum+"/"+t,e?this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser("本日剩余次数:"+i):this.guildshopshengyulabel.textFlow=(new egret.HtmlTextParser).parser("本日剩余次数:"+i)}else this.guildshopopen.visible=!1,this.guildshopopen.touchEnabled=!1,this.guildshopclose.touchEnabled=!0,this.guildshopclose.visible=!0,this.guildshopkaiqi.textFlow=(new egret.HtmlTextParser).parser("<u>前往提升</u>");for(var n in GlobalConfig.GuildStoreConfig.item)this["guildshopitem_"+n].data=GlobalConfig.GuildStoreConfig.item[n];this.guildMore.textFlow=(new egret.HtmlTextParser).parser("<u>更多记录</u>")},e.prototype.onReadInfo=function(){var t=GuildStore.ins().getRecordInfoAry();if(t.length>0){this.record.visible=!0;var e=GlobalConfig.ItemConfig[t[0].itemId],i=ItemUtil.getQualityColor(e);if(this.record.textFlow=(new egret.HtmlTextParser).parser(t[0].roleName+" 获得了 <font color="+i+">"+e.name+"</font>"),t.length>1){this.record1.visible=!0;var n=GlobalConfig.ItemConfig[t[1].itemId];this.record1.textFlow=(new egret.HtmlTextParser).parser(t[1].roleName+" 获得了 <font color="+i+">"+n.name+"</font>")}if(t.length>2){this.record2.visible=!0;var s=GlobalConfig.ItemConfig[t[2].itemId];this.record2.textFlow=(new egret.HtmlTextParser).parser(t[2].roleName+" 获得了 <font color="+i+">"+s.name+"</font>")}}else this.record.visible=!1,this.record1.visible=!1,this.record2.visible=!1},e.prototype.onItemInfo=function(){this.guildshopitem_7.visible=!0;var t=GuildStore.ins().getGuildStoreItemData(0);this.guildshopitem_7.num=t.num,this.guildshopitem_7.data=t.itemId,this.onupdateData()},e.prototype.startEff=function(){var t=this;this.guildshopitem_7.visible=!1,this.isOpenEff=!0,this.openBoxEff=new MovieClip,this.openBoxEff.x=232,this.openBoxEff.y=287,this.openBoxEff.playFile(RES_DIR_EFF+"OpenBox",1,function(){GuildStore.ins().sendGuildStoreBox(),t.isOpenEff=!1}),this.addChild(this.openBoxEff)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.guildshopkaiqi:ViewManager.ins().open(GuildWin,1);break;case this.useBtn:if(GuildStore.ins().guildStoreNum<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:本日剩余次数为0|");if(GlobalConfig.GuildStoreConfig.needContrib>Guild.ins().myCon)return void TipsCT.ins().showTips("|C:0xf3311e&T:贡献度不足|");if(BagCT.ins().getSurplusCount()<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:背包已满，请先清理背包|");0==this.isOpenEff&&this.startEff();break;case this.guildMore:ViewManager.ins().open(GuildShopRecordWin)}},e}(BaseView);__reflect(GuildShopPanel.prototype,"GuildShopPanel"),window.GuildShopPanel=GuildShopPanel;var GuildShopRecordItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildStoreItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof GuildStoreRecordInfo){var t=GlobalConfig.ItemConfig[this.data.itemId];t?this.rank.textFlow=(new egret.HtmlTextParser).parser(this.data.roleName+"   获得了   <font color="+ItemUtil.getQualityColor(t)+">"+t.name+"</font>"):this.rank.text=""}},e}(BaseItemRender);__reflect(GuildShopRecordItemRender.prototype,"GuildShopRecordItemRender"),window.GuildShopRecordItemRender=GuildShopRecordItemRender;var GuildShopRecordWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildStoreInfoSkin",this.list.itemRenderer=GuildShopRecordItemRender,this.arrList=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.arrList.replaceAll(GuildStore.ins().getRecordInfoAry()),this.list.dataProvider=this.arrList},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn1:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildShopRecordWin.prototype,"GuildShopRecordWin"),ViewManager.ins().reg(GuildShopRecordWin,LayerManager.UI_Main),window.GuildShopRecordWin=GuildShopRecordWin;var GuildSkillPanel=function(t){function e(){var e=t.call(this)||this;return e.selectBmpX=[0,30,162,296],e.selectBmpY=[0,227,-20,227],e.curRole=0,e.selectIconID=2,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.learnLab.textFlow=(new egret.HtmlTextParser).parser("无法升级技能，请先提升练功房等级  <a href=\"event:\"><font color='#0FEE27'><u>前往提升</u></font></a>")},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||TipsCT.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.praBtn,this.onTap),this.addTouchEvent(this.skillBmp1,this.onTap),this.addTouchEvent(this.skillBmp2,this.onTap),this.addTouchEvent(this.skillBmp3,this.onTap),this.learnLab.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.observe(Guild.ins().postGuildSkillInfo,this.update),this.observe(Guild.ins().postMyGuildInfo,this.updateMyInfo),this.observe(GameLogic.ins().postSubRoleChange,this.updateRole),this.observe(Guild.ins().postGuildInfo,this.update),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRedPoint),Guild.ins().sendGuildSkillInfo(),Guild.ins().sendMyGuildInfo(),this.praBtnMc.touchEnabled=!1,this.update()},e.prototype.close=function(){},e.prototype.updateRedPoint=function(){GuildRedPoint.ins().roleSkillTabs[this.curRole]||(GuildRedPoint.ins().roleSkillTabs[this.curRole]={},GuildRedPoint.ins().roleSkillTabs[this.curRole][1]=!1,GuildRedPoint.ins().roleSkillTabs[this.curRole][2]=!1,GuildRedPoint.ins().roleSkillTabs[this.curRole][3]=!1),this.redPoint1.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][1],this.redPoint2.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][2],this.redPoint3.visible=GuildRedPoint.ins().roleSkillTabs[this.curRole][3],this.updateMc()},e.prototype.onLink=function(){ViewManager.ins().open(GuildWin,1)},e.prototype.updateRole=function(){Guild.ins().sendGuildSkillInfo()},e.prototype.updateMyInfo=function(){this.praCon.text=""+Guild.ins().myCon},e.prototype.update=function(t){void 0===t&&(t=-1),this.curRole=t>-1?t:this.curRole,this.updateMyInfo(),this.updateRedPoint(),this.selectSkill(this.selectIconID)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.skillBmp1:this.selectSkill(1),this.selectSkillBmp.source="guildskill_1";break;case this.skillBmp2:this.selectSkill(2),this.selectSkillBmp.source="guildskill_2";break;case this.skillBmp3:this.selectSkill(3),this.selectSkillBmp.source="guildskill_3";break;case this.praBtn:this.learnBtnOnClick()}},e.prototype.learnBtnOnClick=function(){var t=Guild.ins().getSkllInfoByIndex(this.curRole);if(!Assert(t.guildSkillInfo[this.selectSkillID-1],"行会技能学习报错 curRole:"+this.curRole+",selectSkillID:"+this.selectSkillID)){var e=t.guildSkillInfo[this.selectSkillID-1].level,i=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1),n=GlobalConfig.GuildCommonSkillConfig[this.selectSkillID].length,s=e>=n?null:this.getCommonSkillDP(this.selectSkillID,e+1);return 0==i||e>=GlobalConfig.GuildConfig.commonSkillLevels[i-1]?void TipsCT.ins().showTips("达到上限，请先提升练功房"):s.contribute>Guild.ins().myCon?void TipsCT.ins().showTips("贡献不足"):Actor.gold<s.money?void TipsCT.ins().showTips("金币不足"):void Guild.ins().sendLearnGuildSkill(this.curRole,this.selectSkillID)}},e.prototype.selectSkill=function(t){this.selectIconID=t,this.selectBmp.x=this.selectBmpX[t],this.selectBmp.y=this.selectBmpY[t],this.selectPraSkill(t)},e.prototype.getTotalPower=function(){for(var t=Guild.ins().getSkllInfoByIndex(this.curRole),e=0,i=1;4>i;i++){var n=t.guildSkillInfo[this.selectSkillID-1].level;if(n>0){var s=this.getCommonSkillDP(i,n);e+=BagCT.getAttrPower(s.attrs)}}return e},e.prototype.selectPraSkill=function(t){this.praGroup.visible=!0,this.selectSkillID=t,this.selectSkillType=1;var e=Guild.ins().getSkllInfoByIndex(this.curRole);if(e){var i=e.guildSkillInfo[this.selectSkillID-1].level,n=this.getCommonSkillDP(this.selectSkillID,i),s=this.getCommonSkillLength(this.selectSkillID),o=Guild.ins().getBuildingLevels(GuildBuilding.GUILD_LIANGONGFANG-1);if(this.praCurBase.textColor=0==i?7526155:14605776,this.praCurBase.text=0==i?"未学习":AttributeData.getAttStr(n.attrs,0,1,"：",!0),this.praName.text=GlobalConfig.GuildConfig.commonSkillNames[this.selectSkillID-1],this.learnLab.visible=1>o||i>=GlobalConfig.GuildConfig.commonSkillLevels[o-1],this.praBtn.visible=!this.learnLab.visible,s>i){var a=this.getCommonSkillDP(this.selectSkillID,i+1);this.praNextLab.text=AttributeData.getAttStr(a.attrs,0,1,"：",!0);var r=Guild.ins().myCon>=a.contribute?"DEDDD0":"f3311e",l="<font color='#"+r+"'>"+a.contribute+"</font>";this.praCost.textFlow=(new egret.HtmlTextParser).parser(l),this.praCost0.text=a.money+"",this.praCost0.textColor=Actor.gold>=a.money?14605776:15937822,this.updateMc()
}else this.praNextLab.text="已满级",this.praCost.text="0",this.praCost0.text="0",this.praCost0.textColor=14605776,DisplayUtils.removeFromParent(this.mc);this.lvTxt.text="等级"+i}},e.prototype.updateMc=function(){return!GuildRedPoint.ins().roleSkillTabs[this.curRole][this.selectSkillID]||this.learnLab.visible?void DisplayUtils.removeFromParent(this.mc):(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.mc.x=this.praBtnMc.width/2,this.mc.y=this.praBtnMc.height/2,this.praBtnMc.addChild(this.mc)),void this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1))},e.prototype.getCommonSkillDP=function(t,e){var i=GlobalConfig.GuildCommonSkillConfig[t];if(0==e)return i[1];for(var n in i){var s=i[n];if(s.level==e)return s}return null},e.prototype.getCommonSkillLength=function(t){var e=GlobalConfig.GuildCommonSkillConfig[t],i=0;for(var n in e)i++;return i},e}(BaseView);__reflect(GuildSkillPanel.prototype,"GuildSkillPanel"),window.GuildSkillPanel=GuildSkillPanel;var GuildSkillShopWin=function(){function t(){}return t}();__reflect(GuildSkillShopWin.prototype,"GuildSkillShopWin"),window.GuildSkillShopWin=GuildSkillShopWin;var GuildSkillWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSkillSkin",e.isTopLevel=!0,e.addTouchEvent(e,e.onClick),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addChangeEvent(this.tab,this.setSelectedIndex),this.addChangingEvent(this.tab,this.onTabTouching),this.observe(GuildRedPoint.ins().postGuildFire,this.updateRed),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRoleRedPoint),this.observe(GuildRedPoint.ins().postLianGongRedPoint,this.updateRed),this.observe(GuildSoulsRedPoint.ins().postRedPoint,this.updateRed),t[0]?(this.lastSelect=t[0],this.selectedIndex(this.lastSelect)):this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,this.addChangeEvent(this.roleSelect,this.update),this.viewStack.getElementAt(this.lastSelect).open(),this.guildskill.curRole=this.roleSelect.getCurRole(),this.updateRed(),this.updateRoleRedPoint()},e.prototype.onClick=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[54].text)}},e.prototype.onTabTouching=function(t){return this.viewStack.getElementAt(t.target.selectedIndex)==this.jackPot&&GlobalConfig.GuildGoldPoolConfig.openserverday>GameServer.serverOpenDay+1?void t.preventDefault():this.viewStack.getElementAt(t.target.selectedIndex)==this.soulsLand&&(GlobalConfig.AllSoulLandBaseConfig.openserverday>GameServer.serverOpenDay+1||GlobalConfig.AllSoulLandBaseConfig.zslevel>ZsCT.ins().lv)?(TipsCT.ins().showTips("角色达到"+GlobalConfig.AllSoulLandBaseConfig.zslevel+"转且开服 "+GlobalConfig.AllSoulLandBaseConfig.openserverday+"天后开启"),void t.preventDefault()):void 0},e.prototype.setSelectedIndex=function(t){this.selectedIndex(this.viewStack.selectedIndex)},e.prototype.selectedIndex=function(t){void 0!=this.lastSelect&&this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=t,this.viewStack.getElementAt(this.lastSelect).open(),this.seeRule.visible=this.viewStack.getElementAt(this.lastSelect)instanceof GuildSoulsLandPanel,0==this.lastSelect?this.roleSelect.openRole():this.roleSelect.hideRole()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.guildskill&&this.guildskill.close(),this.guildcampfire&&this.guildcampfire.close(),this.jackPot&&this.jackPot.close(),this.soulsLand&&this.soulsLand.close(),ViewManager.ins().open(GuildMap)},e.prototype.update=function(){this.guildskill&&this.guildskill.update(this.roleSelect.getCurRole())},e.prototype.updateRed=function(){this.redPoint1.visible=GuildRedPoint.ins().guildFire,this.redPoint0.visible=GuildRedPoint.ins().liangongRed,this.redPoint2.visible=GuildSoulsRedPoint.ins().redPoint},e.prototype.updateRoleRedPoint=function(){for(var t=[!1,!1,!1],e=0;e<t.length;e++)this.roleSelect.showRedPoint(e,t[e]);for(var e=0;1>e;e++)if(GuildRedPoint.ins().roleTabs[e])for(var i=0;i<SubRoles.ins().subRolesLen;i++)this.roleSelect.showRedPoint(i,GuildRedPoint.ins().roleTabs[e][i])},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Guild.ins().getSkllInfoByIndex(0)||Guild.ins().fireDic?!0:(TipsCT.ins().showTips("网络不佳，请稍后"),!1)},e}(BaseEuiView);__reflect(GuildSkillWin.prototype,"GuildSkillWin"),window.GuildSkillWin=GuildSkillWin,ViewManager.ins().reg(GuildSkillWin,LayerManager.UI_Main);var GuildTaskItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildTaskItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){switch(t){case this.conBtn:case this.goBtn:this.conBtnOnCLick()}},e.prototype.conBtnOnCLick=function(){var t=this.data;switch(t.stdTask.type){case 31:t.param>=t.stdTask.target?TipsCT.ins().showTips("本日捐献次数已满"):Actor.yb>=t.stdTask.param?Guild.ins().sendCon(t.stdTask.conID):TipsCT.ins().showTips("元宝不足");break;case 32:t.param>=t.stdTask.target?TipsCT.ins().showTips("本日捐献次数已满"):Actor.gold>=t.stdTask.param?Guild.ins().sendCon(t.stdTask.conID):WarnCT.ins().setBuyGoodsWarn(1);break;case 33:t.param>=t.stdTask.target?TipsCT.ins().showTips("本日捐献次数已满"):BagCT.ins().getBagGoodsCountById(0,t.stdTask.param)>=1?Guild.ins().sendCon(t.stdTask.conID):TipsCT.ins().showTips("道具不足");break;default:GameGuider.guidance(t.stdTask.controlTarget[0],t.stdTask.controlTarget[1])}},e.prototype.goBtnOnClick=function(){var t=this.data;switch(t.state){case 0:GameGuider.guidance(t.stdTask.controlTarget[0],t.stdTask.controlTarget[1]);break;case 1:Guild.ins().sendGetTaskAward(t.taskID);break;case 2:}},e.prototype.dataChanged=function(){if(this.data instanceof GuildTaskInfo){var t=this.data;if(t)if(this.taskIcon.source="guildtask_"+t.taskID,this.nameLab.text=t.stdTask.name,this.descLab.text=t.stdTask.desc,this.conGroup.visible=!0,this.getGroup.visible=!1,this.numLab.text=t.param+"/"+t.stdTask.target,this.conBtn.enabled=t.param<t.stdTask.target,t.param<t.stdTask.target)switch(t.stdTask.type){case 31:case 32:case 33:this.conBtn.label="捐 献";break;default:this.conBtn.label="前 往"}else this.conBtn.label="完 成"}},e}(BaseItemRender);__reflect(GuildTaskItemRender.prototype,"GuildTaskItemRender"),window.GuildTaskItemRender=GuildTaskItemRender;var GuildWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBgSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.tab.dataProvider=this.viewStack},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0!=Guild.ins().guildID;return i||TipsCT.ins().showTips("还未加入公会！"),i},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t.length>0?this.lastSelect=t[0]:this.lastSelect=0,this.viewStack.selectedIndex=this.lastSelect,this.addChangeEvent(this.tab,this.setSelectedIndex),this.observe(GuildRedPoint.ins().postGldt,this.updateRedPoint),this.observe(Guild.ins().postConCount,this.updateRedPoint),Guild.ins().sendMyGuildInfo(),Guild.ins().sendGuildMembers(),this.updateRedPoint(),this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().open(GuildMap)},e.prototype.setSelectedIndex=function(t){this.viewStack.getElementAt(this.lastSelect).close&&this.viewStack.getElementAt(this.lastSelect).close(),this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.updateRedPoint=function(){this.redPoint0.visible=Guild.ins().hasDonate(),this.redPoint1.visible=GuildRedPoint.ins().gldt},e}(BaseEuiView);__reflect(GuildWin.prototype,"GuildWin"),ViewManager.ins().reg(GuildWin,LayerManager.UI_Main),window.GuildWin=GuildWin;var GuildBossDetailWin=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="GuildBossTipSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.addTouchEvent(this.chanllage,this.onTap),this.addTouchEvent(this.chanllageOme,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.rankBtn,this.onTap),this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView),this.observe(GuildBoss.ins().postGuildBossInfoChange,this.upInfo),this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess),this.observe(GuildBoss.ins().postGuildBossRankInfoChange,this.setRank),this.upInfo(),GuildBoss.ins().sendGetBossRankInfo(this.index+1)},e.prototype.upInfo=function(){GuildBoss.ins().sendGetBossInfo()},e.prototype.setView=function(){this.chanllagecount.text="挑战次数"+GuildBoss.ins().leftTimes+"/"+GlobalConfig.GuildBossConfig.dayTimes;var t=GuildBoss.ins().passId;this.chanllagecount.visible=GuildBoss.ins().isOpen()&&t==this.index,this.chanllage.visible=GuildBoss.ins().isOpen()&&this.index<=t,this.cantchanllage.visible=GuildBoss.ins().isOpen()&&!this.chanllage.visible;var e=GlobalConfig.GuildBossInfoConfig[this.index+1],i=GlobalConfig.MonstersConfig[e.boss.monId];this.bossname.text=i.name,this.bossImage.source=e.ShowImg;for(var n=GuildBoss.ins().passRecord[this.index+1],s=0;s<e.passAwards.length;s++)this["itemicon"+s].isShowName(!1),this["itemicon"+s].data=e.passAwards[s];for(var o=GlobalConfig.GuildBossHpAwardsConfig[this.index+1],s=3;7>s;s++)this["itemicon"+s].isShowName(!1),this["itemicon"+s].data=o[s-2].awards[0];if(this.index<t)this.bosshp.value=0,this.bosshp.maximum=0,this.rewardBar.value=100,this.rewardBar.maximum=100;else if(this.index==t){var a=0;a=Math.ceil((i.hp-GuildBoss.ins().bossHP)/i.hp*1e4/100),this.bosshp.maximum=100,this.bosshp.value=a,this.rewardBar.value=100-a,this.rewardBar.maximum=100}else this.bosshp.value=100,this.bosshp.maximum=100,this.rewardBar.value=0,this.rewardBar.maximum=100;this.chanllage.enabled=!0,this.chanllage.x=166,this.chanllageOme.visible=!1,t==this.index?Guild.ins().guildLv>=GlobalConfig.GuildBossConfig.radisLv&&this.chanllage.visible&&(this.chanllageOme.visible=!0,this.chanllage.x=54):1==n?this.chanllage.label="领 取":(this.chanllage.label="已领取",this.chanllage.enabled=!1),this.state.visible=!GuildBoss.ins().isOpen(),this.state.visible&&(this.cantchanllage.visible=this.chanllageOme.visible=this.chanllage.visible=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.chanllageOme:case this.chanllage:if(0==GuildBoss.ins().passRecord[this.index+1]||this.bosshp.value){if(!KfArenaSys.ins().checkIsMatching())return;if(GuildBoss.ins().challengeTime>GameServer.serverTime)return void TipsCT.ins().showTips("|C:0x35e62d&T:正在挑战中，请稍后|");if(GuildBoss.ins().leftTimes<=0)return void TipsCT.ins().showTips("没有挑战次数");GuildBoss.ins().sendChallengeBoss(t.currentTarget==this.chanllageOme?1:0)}else"领 取"==this.chanllage.label&&GuildBoss.ins().sendGetBossReward(this.index+1);break;case this.rankBtn:ViewManager.ins().open(GuildBossRankWin,this.index);break;case this.bgClose:ViewManager.ins().close(e)}},e.prototype.challengeSuccess=function(){ViewManager.ins().close(GuildBossWin),ViewManager.ins().close(GuildMap),ViewManager.ins().close(e)},e.prototype.setRank=function(){for(var t=GuildBoss.ins().guildRankDic[this.index+1],e=GlobalConfig.GuildBossInfoConfig[this.index+1],i=GlobalConfig.MonstersConfig[e.boss.monId],n=0;3>n;n++)if(t&&t[n]){this["rankGroup"+n].visible=!0,this["guildname"+n].text=t[n].name;var s=0,o=Math.ceil(t[n].damage/i.hp*1e4)/100;s=o>100?100:o,this["hpbar"+n].value=s,this["hpbar"+n].maximum=100,this["bosshpbg"+n].visible=this["hpbar"+n].visible=!0}else this["bosshpbg"+n].visible=this["hpbar"+n].visible=!1},e}(BaseEuiView);__reflect(GuildBossDetailWin.prototype,"GuildBossDetailWin"),ViewManager.ins().reg(GuildBossDetailWin,LayerManager.UI_Popup),window.GuildBossDetailWin=GuildBossDetailWin;var GuildBossItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBossItemSkin",e.bosshp.maximum=100,e.bosshp.slideDuration=0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GuildBoss.ins().passId,e=this.data+1,i=GlobalConfig.GuildBossInfoConfig[e],n=GlobalConfig.MonstersConfig[i.boss.monId];if(this.bossImage.source=i.ShowImg,this.data<t){this.bossname.textColor=10458221,this.bosshp.value=0;var s=GuildBoss.ins().passRecord[e];this.passImg.visible=!0,this.redPoint0.visible=GuildBoss.ins().isOpen()&&1==s}else this.data==t?(this.bossname.textColor=13746831,this.bosshp.value=Math.ceil((n.hp-GuildBoss.ins().bossHP)/n.hp*1e4)/100>>0,this.redPoint0.visible=GuildBoss.ins().isOpen()&&GuildBoss.ins().leftTimes>0?!0:!1,this.passImg.visible=!1):(this.bossname.textColor=13746831,this.bosshp.value=100,this.redPoint0.visible=!1,this.passImg.visible=!1);this.bossname.text=e+"."+n.name},e.prototype.isOpen=function(){return(new Date).getDay()!=GlobalConfig.GuildBossConfig.notOpenDayOfWeek},e}(BaseItemRender);__reflect(GuildBossItemRender.prototype,"GuildBossItemRender"),window.GuildBossItemRender=GuildBossItemRender;var GuildBossRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBossHarmItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.rank.text=this.data.rank,this.playerName.text=this.data.name,this.harm.text=this.data.damage;var t,e=!1,i=GlobalConfig.GuildBossRankConfig;for(var n in i){if(i[n].srank<=this.data.rank&&i[n].erank>=this.data.rank){e=!0,this.reward.text=i[n].awards[0].count+"";break}0==i[n].srank&&0==i[n].erank&&(t=i[n])}e||(this.reward.text=t.awards[0].count+"")},e}(BaseItemRender);__reflect(GuildBossRankItemRender.prototype,"GuildBossRankItemRender"),window.GuildBossRankItemRender=GuildBossRankItemRender;var GuildBossRankWin=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="GuildBossHarmSkin",e.isTopLevel=!0,e.list.itemRenderer=GuildBossRankItemRender,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.setView=function(){for(var t=[],e=GuildBoss.ins().guildPersonRankDic[this.index+1]||[],i=0;i<e.length;i++)e[i]&&(e[i].name==Actor.myName&&(this.myData=e[i]),t.push(e[i]));this.list.dataProvider=new eui.ArrayCollection(t),this.myData?(this.qiansan.visible=!0,this.myrank.visible=!0,this.myname.visible=!0,this.myharm.visible=!0,this.myreword.visible=!0,this.myData.rank<=3?this.qiansan.source="guildpaihang"+this.myData.rank:this.qiansan.source="",this.myrank.text=this.myData.rank+"",this.myname.text=this.myData.name,this.myharm.text=this.myData.damage+"",this.myreword.text=GuildBoss.ins().leftTimes+"/"+GlobalConfig.GuildBossConfig.dayTimes):(this.qiansan.visible=!1,this.myrank.visible=!1,this.myname.visible=!1,this.myharm.visible=!1,this.myreword.visible=!1)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildBossRankWin.prototype,"GuildBossRankWin"),ViewManager.ins().reg(GuildBossRankWin,LayerManager.UI_Popup),window.GuildBossRankWin=GuildBossRankWin;var GuildBossWin=function(t){function e(){var e=t.call(this)||this;return e.bossLen=0,e.itemLen=6,e.arrCount=0,e.currentArr=[],e.currentIndex=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="guildBossSkin",this.itemArr=[];for(var e=0;6>e;e++)this.itemArr.push(this["bossItem"+e]);this.bossLen=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig),this.arrCount=0,this.bossArr=[];for(var i=0;i<this.bossLen;i++)this.bossArr[this.arrCount]||(this.bossArr[this.arrCount]=[]),i<(this.arrCount+1)*this.itemLen?this.bossArr[this.arrCount].push(i):i==(this.arrCount+1)*this.itemLen&&(this.arrCount++,this.bossArr[this.arrCount]=[],this.bossArr[this.arrCount].push(i))},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GameServer.serverOpenDay>=1;if(!i)return void TipsCT.ins().showTips("开服第2天开启");var n=!!Guild.ins().guildID;return n||TipsCT.ins().showTips("请加入一个行会"),i&&n},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.imgleft,this.onTap),this.addTouchEvent(this.imgRight,this.onTap);for(var i=0;i<this.itemLen;i++)this.addTouchEvent(this.itemArr[i],this.onItemTap);this.observe(GuildBoss.ins().postGuildBossDetailChange,this.setView),this.observe(GuildBoss.ins().postGuildBossInfoChange,this.setView),this.observe(GuildBoss.ins().postChallengeSuccess,this.challengeSuccess),this.currentIndex=this.getRuleIndex(),GuildBoss.ins().sendGetBossInfo()},e.prototype.getRuleIndex=function(){for(var t=0,e=0;e<GuildBoss.ins().passRecord.length;e++)if(1==GuildBoss.ins().passRecord[e]){t=e;break}var i=Object.keys(GlobalConfig.GuildBossInfoConfig).length,n=GuildBoss.ins().passId;return t>0&&n>=t&&(n=t-1),n>=i&&(n-=1),Math.floor(n/this.itemLen)},e.prototype.setView=function(){var t=GuildBoss.ins().passId+1,e=Object.keys(GlobalConfig.GuildBossInfoConfig).length;t=t>=e?e:t,this.currentArr=this.bossArr[this.currentIndex];var i=GlobalConfig.GuildBossInfoConfig[t];this.fightboss.source=i.ShowImg;for(var n=0;n<this.itemLen;n++)null!=this.currentArr[n]?(this.itemArr[n].data=this.currentArr[n],this.itemArr[n].visible=!0):this.itemArr[n].visible=!1;this.selfname.text=Guild.ins().guildName,this.enemyname.text=GuildBoss.ins().otherGuildName;var s=CommonUtils.getObjectLength(GlobalConfig.GuildBossInfoConfig),o=GuildBoss.ins().passId+1>s?s:GuildBoss.ins().passId+1,a=GlobalConfig.GuildBossInfoConfig[o],r=GlobalConfig.MonstersConfig[a.boss.monId],l=0,h=0;l=Math.ceil((r.hp-GuildBoss.ins().bossHP)/r.hp*1e4)/100,this.sbhpbar.value=l,this.sbhpbar.maximum=100,this.ebhpbar.value=h,this.ebhpbar.maximum=100,this.state.visible=!GuildBoss.ins().isOpen(),this.currentIndex?this.currentIndex==this.arrCount?(this.imgleft.visible=!0,this.imgRight.visible=!1):(this.imgleft.visible=!0,this.imgRight.visible=!0):(this.imgleft.visible=!1,this.imgRight.visible=!0)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.imgleft:this.currentIndex--,this.currentIndex<=0&&(this.imgleft.visible=!1),this.setView(),this.imgRight.visible=!0;break;case this.imgRight:this.currentIndex++,this.currentIndex>=this.arrCount&&(this.imgRight.visible=!1),this.setView(),this.imgleft.visible=!0}},e.prototype.onItemTap=function(t){ViewManager.ins().open(GuildBossDetailWin,t.currentTarget.data)},e.prototype.challengeSuccess=function(){ViewManager.ins().close(e),ViewManager.ins().close(GuildMap)},e}(BaseEuiView);__reflect(GuildBossWin.prototype,"GuildBossWin"),ViewManager.ins().reg(GuildBossWin,LayerManager.UI_Popup),window.GuildBossWin=GuildBossWin;var DailyAwardPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailyAwardSkin",this.isTopLevel=!0,this.list.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.sure,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.list.dataProvider=new eui.ArrayCollection(GlobalConfig.GuildBattleDayAward[GuildWar.ins().getModel().rewardDay].award),GuildWar.ins().getModel().getDayReward?(this.sure.label="已领取",this.sure.enabled=!1):(this.sure.label="领取",this.sure.enabled=!0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.sure,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn1:ViewManager.ins().close(e);break;case this.sure:if(GuildWar.ins().getModel().getDayReward)return void TipsCT.ins().showTips("|C:0xf3311e&T:已领取奖励，无法再次领取|");if(!GuildWar.ins().getModel().canGetDay)return void TipsCT.ins().showTips("|C:0xf3311e&T:沙城占领公会才能领取每日奖励|");GuildWar.ins().requestDayReward(GuildWar.ins().getModel().rewardDay),ViewManager.ins().close(e);break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DailyAwardPanel.prototype,"DailyAwardPanel"),ViewManager.ins().reg(DailyAwardPanel,LayerManager.UI_Main),window.DailyAwardPanel=DailyAwardPanel;var DailypresidentAwardPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="DailypresidentAwardSkin",this.list.itemRenderer=ItemBase,this.dataArr=new eui.ArrayCollection},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap);var i=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=i,this.list.dataProvider=this.dataArr},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(DailypresidentAwardPanel.prototype,"DailypresidentAwardPanel"),ViewManager.ins().reg(DailypresidentAwardPanel,LayerManager.UI_Main),window.DailypresidentAwardPanel=DailypresidentAwardPanel;var GuildWarMainWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.redEff=new MovieClip,this.enterEff=new MovieClip,this.titleEff=new MovieClip,this.skinName="GuildWarMainSkin",this.roleEff=new MovieClip,this.player.addChild(this.roleEff)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.practiseBtn,this.onTap),this.addTouchEvent(this.redBag,this.onTap),this.addTouchEvent(this.play,this.onTap),this.addTouchEvent(this.practiseBtn2,this.onTap),this.addTouchEvent(this.practiseBtn0,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.practiseBtn1,this.onTap),this.observe(GuildWar.ins().postDayRewardInfo,this.refushRewardStatu),this.observe(GuildWar.ins().postGuildRedPointChange,this.refushRewardStatu),this.observe(GuildWar.ins().postJoinPlayBack,this.refushStartEffect),this.practiseBtn1.visible=GuildWar.ins().getModel().guildRankList.length>0&&!GuildWar.ins().getModel().isWatStart,this.refushPanelInfo(),this.refushStartEffect(),this.refushTitleEffect(),this.observe(GuildRedPoint.ins().postRedBag,this.updateRedBag),this.observe(GuildRedPoint.ins().postDayReward,this.updateRedBag),this.updateRedBag()},e.prototype.updateRedBag=function(){this.redBag.visible=GuildRedPoint.ins().redBag,this.redPoint0.visible=GuildRedPoint.ins().dayReward},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().open(GuildMap)},e.prototype.refushPanelInfo=function(){GuildWar.ins().getModel().isWatStart?this.openDesc.text="":this.openDesc.text=GuildWar.ins().getModel().setOpenDesc(),this.refushRewardStatu(),this.refushWinGuild()},e.prototype.refushStartEffect=function(){GuildWar.ins().getModel().isWatStart?(this.enterEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.enterEff.x=this.play.width>>1,this.enterEff.y=this.play.height>>1,this.play.addChild(this.enterEff)):DisplayUtils.removeFromParent(this.enterEff)},e.prototype.refushTitleEffect=function(){this.titleEff.playFile(RES_DIR_EFF+"Titlelcbz",-1),this.titleGroup.addChild(this.titleEff)},e.prototype.refushRewardStatu=function(){GuildWar.ins().getModel().canSend||GuildWar.ins().getModel().canRod?(this.redEff.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.redEff.x=this.redEff.y=28,this.redBag.addChild(this.redEff)):DisplayUtils.removeFromParent(this.redEff)},e.prototype.refushWinGuild=function(){var t=GuildWar.ins().getModel().winGuildInfo.guildId>0;if(this.guildOwn.visible=t,this.guildName.visible=t,this.roleEff.visible=t,this.none.visible=!t,t){var e=GuildWar.ins().getModel().winGuildInfo;this.guildName.text=e.guildName,this.guildOwn.text=e.guildOwnName;var i=1==e.guildOwnSex?"KingModel2":"KingModel1";this.roleEff.playFile(RES_DIR_EFF+i,-1)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.practiseBtn:ViewManager.ins().open(GuildWarRewardWin);break;case this.redBag:GuildWar.ins().getModel().canRod||GuildWar.ins().getModel().canSend?ViewManager.ins().open(RedBagWin):ViewManager.ins().open(RedBagDetailsWin);break;case this.play:if(!GuildWar.ins().getModel().isWatStart)return void TipsCT.ins().showTips("|C:0xf3311e&T:活动未开启|");if(!KfArenaSys.ins().checkIsMatching())return;ViewManager.ins().close(GuildMap),ViewManager.ins().close(e),GuildWar.ins().requestJoinAc();break;case this.practiseBtn0:ViewManager.ins().open(DailypresidentAwardPanel);break;case this.practiseBtn2:ViewManager.ins().open(DailyAwardPanel);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,8);break;case this.practiseBtn1:ViewManager.ins().open(GuildWarRewardWin,0,1)}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=!!Guild.ins().guildID;return i||TipsCT.ins().showTips("请加入一个行会"),i},e}(BaseEuiView);__reflect(GuildWarMainWin.prototype,"GuildWarMainWin"),ViewManager.ins().reg(GuildWarMainWin,LayerManager.UI_Main),window.GuildWarMainWin=GuildWarMainWin;var GuildWarMemWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildWarMemSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){t.prototype.initUI.call(this),this.list.itemRenderer=GuildWarMemListRenderer,this.eListDP=new eui.ArrayCollection,this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GuildWar.ins().postMyRankChange,this.refushList),GuildWar.ins().requestOwnMyGuildRank()},e.prototype.refushList=function(){this.eListDP.replaceAll(GuildWar.ins().getModel().myRankList)},e.prototype.onTap=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(GuildWarMemWin.prototype,"GuildWarMemWin"),window.GuildWarMemWin=GuildWarMemWin,ViewManager.ins().reg(GuildWarMemWin,LayerManager.UI_Popup);var GuildWarResultWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="GuildWarResultSkin",this.closeBtn.label="确定",this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase,this.titleMC=new MovieClip,this.titleMC.x=165,this.titleMC.y=50,this.titleMC.touchEnabled=!1,this.guildName.parent.addChild(this.titleMC),this.titleMC.playFile(RES_DIR_EFF+"Titlelcbz",-1)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.guildName.text=""==t[0]?"虚位以待":t[0],this.myPoint.text=t[1]+"",this.guildPoint.text=""+t[2],this.guildRank.text="第"+t[3]+"名",this.myRank.text=t[4]>0?"第"+t[4]+"名":"未上榜";var i=GuildWar.ins().getModel().getRewardByPoint(t[1]),n=GuildWar.ins().getModel().getMyPointRankReward(t[4]);this.list1.dataProvider=new eui.ArrayCollection(n.concat(i));var s=GuildWar.ins().getModel().creatGuildRankReward(t[3]);this.list2.dataProvider=new eui.ArrayCollection(s),this.s=10,this.addTouchEvent(this.closeBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap)},e.prototype.onTap=function(){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(GuildWarResultWin.prototype,"GuildWarResultWin"),ViewManager.ins().reg(GuildWarResultWin,LayerManager.UI_Popup),window.GuildWarResultWin=GuildWarResultWin;var GuildWarRewardWin=function(t){function e(){var e=t.call(this)||this;return e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GuildWarRewardSkin",this.isTopLevel=!0},e.prototype.addPanelList=function(){this.guildInteRankInfo=new GuildInteRankInfo,this.viewStack.addChild(this.guildInteRankInfo),this.personalInteRankInfo=new PersonalInteRankInfo,this.viewStack.addChild(this.personalInteRankInfo),this.guildInteRewardInfo=new GuildInteRewardInfo,this.viewStack.addChild(this.guildInteRewardInfo),this.personInteRewardInfo=new PersonInteRewardInfo,this.viewStack.addChild(this.personInteRewardInfo),this.cruPanel=this.viewStack.getChildAt(0),this.tab.dataProvider=this.viewStack},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&t[1]&&(this.type=t[1]),this.addPanelList(),t&&t[0]?this.viewStack.selectedIndex=t[0]:this.viewStack.selectedIndex=0,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addChangeEvent(this.tab,this.onTabTouch),this.cruPanel.open()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.closeBtn0,this.onTap),this.cruPanel.close(),this.viewStack.removeChildren(),this.type=0},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.onTabTouch=function(t){this.cruPanel&&this.cruPanel.close(),this.cruPanel=this.viewStack.selectedChild,this.cruPanel.open()},e}(BaseEuiView);__reflect(GuildWarRewardWin.prototype,"GuildWarRewardWin"),ViewManager.ins().reg(GuildWarRewardWin,LayerManager.UI_Main),window.GuildWarRewardWin=GuildWarRewardWin;var GuildWarRulesWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuleTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bigBg,this.onTap),this.addTouchEvent(this.bg,this.onTap),this.addTouchEvent(this.attr,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.cruIndex=GuildWar.ins().getModel().getMapLevelInfo().id,this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bigBg,this.onTap),this.removeTouchEvent(this.bg,this.onTap),this.removeTouchEvent(this.attr,this.onTap),this.removeTouchEvent(this.leftBtn,this.onTap),this.removeTouchEvent(this.rightBtn,this.onTap)},e.prototype.refushInfo=function(){var t=GlobalConfig.GuildBattleLevel,e=t[this.cruIndex];this.mapName.text=e.name,this.attr.textFlow=TextFlowMaker.generateTextFlow(e.help),this.rightBtn.visible=this.cruIndex<4,this.leftBtn.visible=this.cruIndex>1},e.prototype.onTap=function(t){switch(t.currentTarget){case this.leftBtn:--this.cruIndex,this.refushInfo();break;case this.rightBtn:++this.cruIndex,this.refushInfo();break;case this.bigBg:ViewManager.ins().close(e);break;default:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuildWarRulesWin.prototype,"GuildWarRulesWin"),ViewManager.ins().reg(GuildWarRulesWin,LayerManager.UI_Main),window.GuildWarRulesWin=GuildWarRulesWin;var GuildwarTipsPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GameTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];
this.removeTouchEvent(this,this.onTap)},e.prototype.onTap=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(GuildwarTipsPanel.prototype,"GuildwarTipsPanel"),ViewManager.ins().reg(GuildwarTipsPanel,LayerManager.UI_Main),window.GuildwarTipsPanel=GuildwarTipsPanel;var GuildWarUiInfo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GuildWarUiSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(GameLogic.ins().postEnterMap,this.refushShowInfo),this.observe(GuildWar.ins().postPointUpdate,this.refushPoint),this.observe(GuildWar.ins().postPointRewardChange,this.refushPointReward),this.observe(GuildWar.ins().postCityownChange,this.cityOwnChange),this.observe(GuildWar.ins().postWeixieChange,this.refushWeixieList),this.observe(GuildWar.ins().postCanplayChange,this.refushcanPlayList),this.observe(GuildWar.ins().postFlagInfoChange,this.refushFlagStatu),this.observe(GuildWar.ins().postHudunInfo,this.hudunChange),this.observe(GuildWar.ins().postRankListChange,this.rankListChange),this.observe(GuildWar.ins().postGuildNumChange,this.refushGuildNum),this.observe(GuildWar.ins().postJoinPlayBack,this.doorStatuChange),this.observe(GuildWar.ins().postKillHuman,this.showSkill),this.observe(GameLogic.ins().postEntityHpChange,this.updateHP),this.observe(GameLogic.ins().postChangeTarget,this.updateTarget)},e.prototype.skinComplete=function(){this.clickEffc=new MovieClip,this.pointEff=new MovieClip,this.pointEff.x=61,this.pointEff.y=34,this.list1.itemRenderer=GuildWarMemberHeadRender,this.list2.itemRenderer=GuildWarMemberHeadRender,this.sceneBar.maximum=300,this.sceneBar.labelFunction=function(){return""},this.bloodBar1.slideDuration=0,this.bloodBar.labelDisplay.visible=!1,this.addTouchEvent(this.Nextchengnei,this.onTap),this.addTouchEvent(this.Nextchengnei0,this.onTap),this.addTouchEvent(this.Nextdianqian,this.onTap),this.addTouchEvent(this.Nexthuanggong,this.onTap),this.addTouchEvent(this.seeRank,this.onTap),this.addTouchEvent(this.seeMyGuild,this.onTap),this.addTouchEvent(this.list1,this.listTap),this.addTouchEvent(this.list2,this.listTap),this.addTouchEvent(this.btn,this.onTap),this.addTouchEvent(this.palaceFlag,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.mon,this.onTap),this.addTouchEvent(this.guid2,this.onTap),this.addTouchEvent(this.taskTraceBtn,this.onTap),this.addTouchEvent(this.ruleDesc,this.onTap),this.belongGroup.visible=!1,this.ruleDesc.textFlow=(new egret.HtmlTextParser).parser("<u>玩法说明</u>"),this.refushShowInfo(),this.refushPoint(),this.cityOwnChange(),this.refushWeixieList(),this.refushcanPlayList(),this.rankListChange(),this.doorStatuChange(),this.refushFlagStatu(),this.refushGuildNum()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().isShow(GuileWarReliveWin)&&ViewManager.ins().close(GuileWarReliveWin),ViewManager.ins().isShow(TargetPlayerBigBloodPanel)&&ViewManager.ins().close(TargetPlayerBigBloodPanel),this.currAttackHandle=0,Timer.stopAll(this),DisplayUtils.removeFromParent(this.clickEffc),DisplayUtils.removeFromParent(this.pointEff),this.clearRendererItem()},e.prototype.refushShowInfo=function(){var t=this;this.gongxun.visible=GuildWar.ins().getModel().checkinAppoint(2),this.mon.visible=GuildWar.ins().getModel().checkinAppoint(2),this.bar1.y=this.mon.visible?99:30,this.flagGroup.visible=GuildWar.ins().getModel().checkinAppoint(4),this.flag.visible=GuildWar.ins().getModel().checkinAppoint(4),this.flag.y=103,this.scene.text=GuildWar.ins().getModel().getNextMapName(0),this.guid.visible=GuildWar.ins().getModel().checkinAppoint(2)&&GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun,this.guid.visible?(this.clickEffc.playFile(RES_DIR_EFF+"PromptEff5"),this.clickEffc.x=this.guid.x-23,this.clickEffc.y=this.guid.y+this.guid.height/2-5,this.addChild(this.clickEffc)):DisplayUtils.removeFromParent(this.clickEffc);var e=GuildWar.ins().getModel().getMapLevelInfo();this.sceneBar.value=100*(e.id-1),this.weijihuo1.visible=!(e.id>=1),this.jihuo1.visible=e.id>=1,this.weijihuo2.visible=!(e.id>=2),this.jihuo2.visible=e.id>=2,this.weijihuo3.visible=!(e.id>=3),this.jihuo3.visible=e.id>=3,this.hgweijihuo.visible=!(e.id>=4),this.hgjh.visible=e.id>=4,this.Nextdianqian.visible=!1,this.Nextchengnei.visible=1==e.id,this.Nexthuanggong.visible=3==e.id,this.Nextchengnei0.visible=3==e.id,4==e.id&&(this.Nextdianqian.visible=!0),this.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4),Timer.start(1e3,GuildWar.ins().getModel().acEndTime,function(){t.lastTime.text=DateUtils.getFormatTimeByStyle(GuildWar.ins().getModel().acEndTime,DateUtils.STYLE_4)},this),this.refushcanPlayList(),this.refushWeixieList()},e.prototype.refushGuildNum=function(){this.comNum.text=GuildWar.ins().getModel().guildNum+"人"},e.prototype.refushPoint=function(){this.guildPoint.text=GuildWar.ins().getModel().guildPoint+"",this.ownPoint.text=GuildWar.ins().getModel().ownPoint+"",this.point.text=GuildWar.ins().getModel().gongXun+"/"+GuildWar.ins().getModel().getIntoNextMapGongxun();var t=GuildWar.ins().getModel().getMapLevelInfo();GuildWar.ins().getModel().gongXun>=GuildWar.ins().getModel().getIntoNextMapGongxun()?2==t.id&&(this.Nextdianqian.visible=!0,this.point.visible=!1,this.gongxun.visible=!1):4!=t.id&&(this.Nextdianqian.visible=!1,this.point.visible=!0),this.refushPointReward(),this.doorStatuChange()},e.prototype.refushPointReward=function(){var t=GuildWar.ins().getModel().getMyPointReward();if(t){this.taskTraceName0.y=16;var e="积分目标：\r"+GuildWar.ins().getModel().ownPoint+"/"+t.integral;e+=GuildWar.ins().getModel().pointInfo.isCan?StringUtils.addColor("(完成)","#35e62d"):"",this.taskTraceName0.textFlow=(new egret.HtmlTextParser).parser(e);t.award[0];GuildWar.ins().getModel().pointInfo.isCan?(this.taskTraceBtn.visible=!0,this.pointEff.playFile(RES_DIR_EFF+"CirclePrompt",-1),this.taskTraceBtn.addChild(this.pointEff)):DisplayUtils.removeFromParent(this.pointEff)}else this.taskTraceAwards0.visible=!1,DisplayUtils.removeFromParent(this.pointEff),this.taskTraceBtn.visible=!1;this.scorePoint.visible=!!this.pointEff.parent},e.prototype.cityOwnChange=function(){this.guildName.text=""==GuildWar.ins().getModel().cityOwn?"虚位以待":GuildWar.ins().getModel().cityOwn},e.prototype.refushWeixieList=function(t){void 0===t&&(t=0),this.list2.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().weixieList),1==t&&this.refushcanPlayList(),this.weixie.visible=GuildWar.ins().getModel().checkinAppoint(2,!0)&&GuildWar.ins().getModel().weixieList.length>0},e.prototype.refushcanPlayList=function(t){t=t||GuildWar.ins().getModel().canPlayList,this.list1.dataProvider=new eui.ArrayCollection(t),this.attList.visible=GuildWar.ins().getModel().checkinAppoint(2,!0)&&(t.length>0||this.mon.visible)},e.prototype.doorStatuChange=function(){this.Nextchengnei.enabled=GuildWar.ins().getModel().doorDie},e.prototype.rankListChange=function(){for(var t,e=GuildWar.ins().getModel().rankList,i=0;3>i;i++)t=e[i],t?(this["rankName"+(i+1)].text=t.name,this["rankPoint"+(i+1)].text=t.point+""):(this["rankName"+(i+1)].text="暂无",this["rankPoint"+(i+1)].text="0")},e.prototype.refushFlagStatu=function(){if(Timer.stop(this.runTime,this),this.hudun1.visible=!1,0==GuildWar.ins().getModel().flagStatu?(this.clearTimeBar(),this.runTime(),Timer.start(1e3,GuildWar.ins().getModel().endTime,this.runTime,this)):1==GuildWar.ins().getModel().flagStatu?(this.clearTimeBar(),this.timeDesc.text="当前皇旗可采集"):(this.runTime(),this.bloodBar.maximum=GlobalConfig.GuildBattleConst.gatherTime,Timer.start(1e3,GuildWar.ins().getModel().endTime,this.runTime,this),this.hudun1.visible=!0),this.palaceFlag.enabled=1==GuildWar.ins().getModel().flagStatu,this.flagStatu.visible=2==GuildWar.ins().getModel().flagStatu&&!this.flagGroup.visible,this.flagStatu.visible){var t=egret.Tween.get(this.flagStatu);this.flagStatu.x=480,t.to({x:106},500).call(function(){},this)}},e.prototype.clearTimeBar=function(){this.bloodBar.maximum=0,this.bloodBar.value=0,this.bloodBar.labelFunction=function(){return""}},e.prototype.hudunChange=function(t){this.hudun.maximum=t[1],this.hudun.value=t[0],this.hudun.labelFunction=function(){return Math.ceil(100*t[0]/t[1])+"%"}},e.prototype.runTime=function(){if(--GuildWar.ins().getModel().endTime,GuildWar.ins().getModel().endTime>=0)if(2!=GuildWar.ins().getModel().flagStatu)this.timeDesc.text=Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"秒后可采集";else if(this.timeDesc.text=GuildWar.ins().getModel().flagName+" 采集中.....",this.bloodBar.value=GuildWar.ins().getModel().endTime,this.bloodBar.labelFunction=function(){return"采集成功剩余时间："+Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"秒"},this.flagStatu.visible){var t="<font color = '#FFB82A'>"+GuildWar.ins().getModel().flagName+"</font>采集皇旗中（<font color = '#35e62d'>"+Math.floor(GuildWar.ins().getModel().endTime/60)+"分"+GuildWar.ins().getModel().endTime%60+"</font>秒）";this.flagTime.textFlow=(new egret.HtmlTextParser).parser(t),this.guildName1.text="公会："+GuildWar.ins().getModel().flagGuild}GuildWar.ins().getModel().endTime<=0&&Timer.stop(this.runTime,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.Nextchengnei:case this.Nextchengnei0:case this.Nextdianqian:case this.Nexthuanggong:if(""!=GuildWar.ins().getModel().killName)return void TipsCT.ins().showTips("|C:0xf3311e&T:复活状态，不能切换地图|");if(GuildWar.ins().getModel().getIntoNextMapGongxun()>GuildWar.ins().getModel().gongXun)return void TipsCT.ins().showTips("|C:0xf3311e&T:战功不满足条件，不能进入下一层|");if(!GuildWar.ins().getModel().doorDie)return void TipsCT.ins().showTips("|C:0xf3311e&T:击破城门后可进入下一关|");var e=1;t.currentTarget==this.Nextchengnei||t.currentTarget==this.Nextchengnei0?e=2:t.currentTarget==this.Nextdianqian?e=3:t.currentTarget==this.Nexthuanggong&&(e=4),ViewManager.ins().open(GuileWarReliveWin,1,e);break;case this.seeRank:ViewManager.ins().open(GuildWarRewardWin);break;case this.seeMyGuild:ViewManager.ins().open(GuildWarMemWin);break;case this.btn:"down"==this.btn.currentState?this.refushcanPlayList([]):this.refushcanPlayList();break;case this.palaceFlag:0!=GuildWar.ins().getModel().flagStatu?GuildWar.ins().requestStartGetFlag():TipsCT.ins().showTips("|C:0xf3311e&T:皇旗当前不可采集|");break;case this.mon:this.clickEffc.playFile(RES_DIR_EFF+"PromptEff5",1),this.mon.addChild(this.clickEffc),this.clickEffc.x=this.mon.width/2,this.clickEffc.y=35,GameLogic.ins().postChangeAttrPoint(0),this.guid.visible=!1;break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,7);break;case this.taskTraceBtn:GuildWar.ins().getModel().pointInfo.isCan&&GuildWar.ins().sendPointReward();break;case this.guid2:ViewManager.ins().open(GuildwarTipsPanel)}},e.prototype.listTap=function(t){if(t.target.parent instanceof GuildWarMemberHeadRender){var e=t.target.parent;if(e.showEffect(),!GuildWar.ins().getModel().canClick)return;if(GuildWar.ins().getModel().flagAcId==Actor.actorID)return void WarnWin.show("采集中攻击玩家会导致采集<font color='#FFB82A'>进度归0</font>，确定要攻击玩家嘛？",function(){GameLogic.ins().postChangeAttrPoint(e.data),EntityShowMgr.ins().showHideSomeOne(e.data)},this);GameLogic.ins().postChangeAttrPoint(e.data),this.guid.visible&&DisplayUtils.removeFromParent(this.clickEffc),this.guid.visible=!1,GuildWar.ins().getModel().attHandle!=e.data&&EntityShowMgr.ins().showHideSomeOne(e.data)}},e.prototype.clearRendererItem=function(){for(var t=this.list1.numChildren,e=0;t>e;e++){var i=this.list1.getChildAt(e);i.clearEffect()}t=this.list2.numChildren;for(var e=0;t>e;e++){var i=this.list2.getChildAt(e);i.clearEffect()}},e.prototype.showSkill=function(t){if(!t)return egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup),void(this.skillGroup.visible=!1);this.skillGroup.visible&&(egret.Tween.removeTweens(this.lzlabel),egret.Tween.removeTweens(this.skillGroup)),this.skillGroup.visible=!0,this.skillGroup.alpha=1,this.lzlabel.scaleX=this.lzlabel.scaleY=1,this.lzlabel.text=t+"";var e=this;egret.Tween.get(this.lzlabel).to({scaleX:2,scaleY:2},200).to({scaleX:1,scaleY:1},100).call(function(){egret.Tween.get(e.skillGroup).wait(1e3).to({alpha:0},1e3).call(function(){egret.Tween.removeTweens(e.lzlabel),egret.Tween.removeTweens(e.skillGroup),e.skillGroup.visible=!1})})},e.prototype.updateTarget=function(){var t=GuildWar.ins().getModel().getMapLevelInfo();if(1==t.id?this.belongGroup.visible=!1:this.belongGroup.visible=!0,0==GameLogic.ins().currAttackHandle&&(this.belongGroup.visible=!1),0!=GameLogic.ins().currAttackHandle&&this.currAttackHandle!=GameLogic.ins().currAttackHandle){this.currAttackHandle=GameLogic.ins().currAttackHandle;var e=void 0,i=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(i&&i.length>0){e=i[0].infoModel;var n=e.name,s=n.split("\n");n=s[1]?s[1]:s[0],this.belongNameTxt0.textFlow=TextFlowMaker.generateTextFlow(n),this.roleHead0.source="yuanhead"+e.job+e.sex,this.changeHp()}}this.belongGroup.visible&&this.changeHp()},e.prototype.updateHP=function(t){var e=t[0];t[1],t[2],t[3];e&&e.infoModel.masterHandle==this.currAttackHandle&&this.changeHp()},e.prototype.changeHp=function(){var t=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(t&&t.length>0){for(var e=t.length,i=0,n=0,s=0,o=0,a=0;e>a;a++){var r=t[a];if(r){var l=r.infoModel.getAtt(AttributeType.atHp)||0,h=r.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=l,n+=h;var u=r.infoModel.getAtt(AttributeType.cruNeiGong)||0,p=r.infoModel.getAtt(AttributeType.maxNeiGong)||0;s+=u,o+=p}}this.neigongBar1.maximum=o,this.neigongBar1.value=s,this.bloodBar1.maximum=n,this.bloodBar1.value=i,0>=i&&(this.belongGroup.visible=!1)}},e}(BaseEuiView);__reflect(GuildWarUiInfo.prototype,"GuildWarUiInfo"),ViewManager.ins().reg(GuildWarUiInfo,LayerManager.UI_Main),window.GuildWarUiInfo=GuildWarUiInfo;var GuileWarReliveWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SwitchCDSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];switch(this.type=t[0],this.sceneIndex=t[1],this.act.text="即将退出沙城争霸活动",this.type){case 1:this.currentState="switch",this.defaultStr="秒后自动切换区域",this.s=GuildWar.ins().getModel().getCdByType(this.type);break;case 2:this.currentState="revive",this.defaultStr="秒后在沙城城门复活",this.s=t[1];break;case 3:this.currentState="exit",this.defaultStr="秒后自动退出活动",this.s=GuildWar.ins().getModel().getCdByType(this.type);break;case 4:this.currentState="exit",this.defaultStr="秒后即将退出圣灵禁地",this.s=SpiritBossCT.ins().getCdByType(this.type),this.act.text="即将退出圣灵禁地"}this.addTouchEvent(this.closeBtn,this.onTap),this.timeDown.text=""+this.s+this.defaultStr,Timer.stop(this.updateCloseBtnLabel,this),Timer.start(1e3,this.s,this.updateCloseBtnLabel,this),this.refushMapInfo()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),Timer.stop(this.updateCloseBtnLabel,this),1!=this.type&&(GuildWar.ins().getModel().killName="")},e.prototype.refushMapInfo=function(){1==this.type?this.mapName.text=GuildWar.ins().getModel().getNextMapName(this.sceneIndex):2==this.type&&(this.killName.text="你被 "+GuildWar.ins().getModel().killName+" 玩家击败！",this.guildName.text="所属公会："+GuildWar.ins().getModel().killGuild+" ")},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&(1==this.type&&GuildWar.ins().requestPlayNextMap(this.sceneIndex),3==this.type&&FbCT.ins().sendExitFb(),ViewManager.ins().close(e)),this.timeDown.text=""+this.s+this.defaultStr},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(GuileWarReliveWin.prototype,"GuileWarReliveWin"),window.GuileWarReliveWin=GuileWarReliveWin,ViewManager.ins().reg(GuileWarReliveWin,LayerManager.UI_Main);var SelectMemberPanelWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="SelectMemberPanelSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=MemberItem3Renderer},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],this.maxNum=t[1],this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.list,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),GuildWar.ins().getModel().sendList[this.index]=[],GuildWar.ins().getModel().sendNumList[this.index]=[],this.selectList=[],this.numList=[],this.selectItemList=[],this.selectMarkList=[],this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.selectList.length==this.maxNum,this.refushList()},e.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().getMyGuildPointRank())},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.list,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap),GuildWar.ins().postSendListChange()},e.prototype.countNum=function(){var t=0;if(this.numList)for(var e in this.numList)t+=this.numList[e];return t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sureBtn:GuildWar.ins().getModel().sendList[this.index]=this.selectList,GuildWar.ins().getModel().sendNumList[this.index]=this.numList,ViewManager.ins().close(e);break;case this.list:var i=t.target.parent;if(i&&i.data){var n=this.selectMarkList.lastIndexOf(i.data.data.name);switch(t.target){case i.btn1:--i.chooseNum,i.chooseNum<1&&(i.chooseNum=1),this.numList[n]=i.chooseNum;break;case i.btn2:if(this.countNum()>=this.maxNum)return void TipsCT.ins().showTips("|C:0xf3311e&T:分配人数已满|");this.numList[n]=++i.chooseNum;break;default:if(n>=0)i.checkBoxs.selected=!1,i.data.isSelect=!1,i.chooseNum=1,this.selectMarkList.splice(n,1),this.selectItemList.splice(n,1),this.selectList.splice(n,1),this.numList.splice(n,1);else{if(this.countNum()>=this.maxNum)return i.checkBoxs.selected=!1,void TipsCT.ins().showTips("|C:0xf3311e&T:分配人数已满|");i.checkBoxs.selected=!0,i.data.isSelect=!0,this.selectItemList.push(i),this.selectMarkList.push(i.data.data.name),this.selectList.push(i.data.data),this.numList.push(i.chooseNum),i.chooseNum=1}}i.num1.text=i.chooseNum+"",this.setAddInfoShow(i,i.checkBoxs.selected),this.chooseNum.text="已选择 "+this.countNum()+"/"+this.maxNum,this.sureBtn.enabled=this.countNum()==this.maxNum}}},e.prototype.setAddInfoShow=function(t,e){void 0===e&&(e=!1),t.btn1.visible=t.btn2.visible=t.num1.visible=t.inputBg.visible=e},e.prototype.toNumList=function(){if(this.selectItemList)for(var t in this.selectMarkList)this.selectList.push(this.selectItemList[t].data.data),this.numList.push(this.selectItemList[t].chooseNum)},e}(BaseEuiView);__reflect(SelectMemberPanelWin.prototype,"SelectMemberPanelWin"),window.SelectMemberPanelWin=SelectMemberPanelWin,ViewManager.ins().reg(SelectMemberPanelWin,LayerManager.UI_Popup);var SelectMemberRewardWin=function(t){function e(){var e=t.call(this)||this;return e.dataLen=[],e._sn_="SelectMemberRewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=SelectRewardItemRenderer},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];GuildWar.ins().requestOwnMyGuildRank(),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.sendReward,this.onTap),this.observe(GuildWar.ins().postSendListChange,this.refushList),this.refushPanelInfo()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().open(GuildMap)},e.prototype.refushPanelInfo=function(){this.rankLabel.text="本次沙城争霸公会排名：第"+GuildWar.ins().getModel().guildWarRank+"名",this.dataLen.length=GuildWar.ins().getModel().getCanSendNumByRank(),this.refushList()},e.prototype.refushList=function(){this.list.dataProvider=new eui.ArrayCollection(this.dataLen)},e.prototype.onTap=function(t){var i=this;switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sendReward:Timer.start(100,1,function(){GuildWar.ins().getModel().checkISSendAll()&&GuildWar.ins().sendFenReward(i.dataLen.length,GuildWar.ins().getModel().sendList)},this)}},e}(BaseEuiView);__reflect(SelectMemberRewardWin.prototype,"SelectMemberRewardWin"),ViewManager.ins().reg(SelectMemberRewardWin,LayerManager.UI_Popup),window.SelectMemberRewardWin=SelectMemberRewardWin;var GuildInteRankInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRankSkin",e.name="公会排行",e.list.itemRenderer=GuildInteRankItemRenderer,e.data=new eui.ArrayCollection([]),e.model=GuildWar.ins().getModel(),e.lastName.text=e.model.isWatStart?"本届排行":"上届排行",e.lastNameJie.text=e.model.isWatStart?"本届攻城结果":"上届攻城结果",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=this.data,this.observe(GuildWar.ins().postRankInfo,this.refushList),GuildWar.ins().requestGuildRank()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushList=function(){this.data.replaceAll(this.model.guildRankList),this.model.guildRankList.length>0?this.guildName.text=this.model.guildRankList[0].guildName:this.guildName.text="虚位以待"},e}(BaseView);__reflect(GuildInteRankInfo.prototype,"GuildInteRankInfo"),window.GuildInteRankInfo=GuildInteRankInfo;var GuildInteRewardInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRewardSkin",e.name="公会奖励",e.dataArr=new eui.ArrayCollection,e.dataArr1=new eui.ArrayCollection,e.itemList.itemRenderer=ItemBase,e.list1.itemRenderer=GuildInteRewardItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GuildWar.ins().getModel().creatGuildRewardList();this.dataArr1.source=i,this.list1.dataProvider=this.dataArr1;var n=GlobalConfig.GuildBattleConst.occupationAward;this.dataArr.source=n,this.itemList.dataProvider=this.dataArr},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataArr.source=null,this.dataArr1.source=null},e}(BaseView);__reflect(GuildInteRewardInfo.prototype,"GuildInteRewardInfo"),window.GuildInteRewardInfo=GuildInteRewardInfo;var PersonalInteRankInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonalInteRankSkin",e.name="个人排行",e.list.itemRenderer=GuildInteRankItemRenderer,e.data=new eui.ArrayCollection([]),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.dataProvider=this.data,this.observe(GuildWar.ins().postGuildPersonalRank,this.refushList),GuildWar.ins().requestOwnGuildRank()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refushList=function(t){this.data.replaceAll(t)},e}(BaseView);__reflect(PersonalInteRankInfo.prototype,"PersonalInteRankInfo"),window.PersonalInteRankInfo=PersonalInteRankInfo;var PersonInteRewardInfo=function(t){function e(){var e=t.call(this)||this;return e.skinName="PersonInteRewardSkin",e.name="个人奖励",e.list.itemRenderer=PersonRewardRenderer,e.list1.itemRenderer=GuildInteRewardItemRenderer,e.dataArr=new eui.ArrayCollection,e.dataArr1=new eui.ArrayCollection,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!this.dataList){this.dataList=[];var i=GlobalConfig.GuildBattlePersonalAward;for(var n in i)this.dataList.push(i[n])}if(this.dataArr.source=this.dataList,this.list.dataProvider=this.dataArr,!this.dataList1){this.dataList1=[];var i=GlobalConfig.GuildBattlePersonalRankAward;for(var n in i)this.dataList1.push(i[n])}this.dataArr1.source=this.dataList1,this.list1.dataProvider=this.dataArr1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseView);__reflect(PersonInteRewardInfo.prototype,"PersonInteRewardInfo"),window.PersonInteRewardInfo=PersonInteRewardInfo;var RedBagDetailsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RedBagDetailsSkin",this.list.itemRenderer=RedBagRenderer,this.effect=new MovieClip,this.effect.x=244,this.effect.y=300},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.num.text=GuildWar.ins().getModel().robYbNum+"",this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().rebList),t[0]&&(this.effect.playFile(RES_DIR_EFF+"FireWork",1),this.addChild(this.effect))},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),DisplayUtils.removeFromParent(this.effect)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(RedBagDetailsWin.prototype,"RedBagDetailsWin"),ViewManager.ins().reg(RedBagDetailsWin,LayerManager.UI_Main),window.RedBagDetailsWin=RedBagDetailsWin;var RedBagWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RedBagWinSkin",this.model=GuildWar.ins().getModel(),this.num1.restrict="0-9",this.num2.restrict="0-9"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.rob,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.send,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.btn2,this.onTap),this.addTouchEvent(this.btn3,this.onTap),this.addTouchEvent(this.btn4,this.onTap),this.addTouchEvent(this.btn5,this.onTap),this.addTouchEvent(this.btn6,this.onTap),this.addChangeEvent(this.num1,this.onTxtChange),this.addChangeEvent(this.num2,this.onTxtChange),this.model.canRod?(this.currentState="rob",this.refushInfo()):(this.currentState="send",this.refushSendInfo())},e.prototype.onTxtChange=function(t){var e=this,i=1;switch(t.currentTarget){case this.num1:i=1;break;case this.num2:i=2}Timer.start(500,1,function(){e.checkInputChange(i)},this)},e.prototype.checkInputChange=function(t){var e;switch(t){case 1:e=Number(this.num1.text),e>this.sendYBMaxNum&&(e=this.sendYBMaxNum),this.sendYb=e,this.num1.text=this.sendYb+"";break;case 2:e=Number(this.num2.text),e>this.sendMaxNum&&(e=this.sendMaxNum),this.sendNum=e,this.num2.text=this.sendNum+""}this.checkPercentage()},e.prototype.refushSendInfo=function(){this.sendYb=this.sendYBMaxNum=this.model.remainYB,this.sendMaxNum=this.sendNum=Guild.ins().getMemberNum(),this.price.setPrice(this.sendYb),this.num1.text=this.sendYb+"",this.num2.text=this.sendNum+""},e.prototype.refushInfo=function(){this.remainBag.text=this.model.remainRedNum+"/"+this.model.maxRedNum},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.rob:GuildWar.ins().requestRobRedBag();break;case this.send:GuildWar.ins().requestSendRedBag(this.sendYb,this.sendNum);break;case this.btn1:--this.sendYb,this.sendYb<this.sendNum&&(this.sendYb=this.sendNum),this.num1.text=this.sendYb+"";break;case this.btn2:++this.sendYb,this.sendYb>this.sendYBMaxNum&&(this.sendYb=this.sendYBMaxNum),this.num1.text=this.sendYb+"";break;case this.btn3:--this.sendNum,this.sendNum<1&&(this.sendNum=1),this.num2.text=this.sendNum+"";break;case this.btn4:++this.sendNum,this.sendNum>this.sendMaxNum&&(this.sendNum=this.sendMaxNum),this.num2.text=this.sendNum+"";break;case this.btn5:this.sendYb=this.sendYBMaxNum,this.num1.text=this.sendYb+"";break;case this.btn6:this.sendNum=this.sendMaxNum,this.num2.text=this.sendNum+""}},e.prototype.checkPercentage=function(){this.sendYb<this.sendNum&&(this.sendYb=this.sendNum,this.num1.text=this.sendYb+"")},e}(BaseEuiView);__reflect(RedBagWin.prototype,"RedBagWin"),ViewManager.ins().reg(RedBagWin,LayerManager.UI_Main),window.RedBagWin=RedBagWin;var GuildInteRankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRankItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.rank.text=this.itemIndex+1+"",this.guildName.text=this.data.guildName,this.guildOwn.text=this.data.ownName,this.point.text=this.data.guildPoint},e}(BaseItemRender);__reflect(GuildInteRankItemRenderer.prototype,"GuildInteRankItemRenderer"),window.GuildInteRankItemRenderer=GuildInteRankItemRenderer;var GuildInteRewardItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInteRewardItemSkin",e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){this.itemIndex<3?(this.numImg.visible=!0,this.rankLabel.visible=!1,this.numImg.source="guildshop_json.guildpaihang"+(this.itemIndex+1)):(this.numImg.visible=!1,this.rankLabel.visible=!0,this.rankLabel.text="第"+(this.itemIndex+1)+"名"),this.data.rank?this.list.dataProvider=new eui.ArrayCollection(this.data.award):this.list.dataProvider=new eui.ArrayCollection(GuildWar.ins().getModel().creatGuildRankReward(this.data))},e}(BaseItemRender);__reflect(GuildInteRewardItemRenderer.prototype,"GuildInteRewardItemRenderer"),window.GuildInteRewardItemRenderer=GuildInteRewardItemRenderer;var GuildWarMemListRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="WarMemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.face.source="head_"+this.data.job+this.data.sex,this.nameLab.text="["+GuildLanguage.guildOffice[this.data.office]+"]",this.nameLab0.text=this.data.myName,this.conLab.text=this.data.point+"",this.attack.text=this.data.attr+"",this.onLine.text=""==this.data.mapName?"不在沙城":this.data.mapName},e}(BaseItemRender);__reflect(GuildWarMemListRenderer.prototype,"GuildWarMemListRenderer"),window.GuildWarMemListRenderer=GuildWarMemListRenderer;var MemberItem3Renderer=function(t){function e(){var e=t.call(this)||this;return e.chooseNum=1,e.skinName="MemberItem3Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data instanceof SelectInfoData){var t=this.data;this.job.text="["+GuildLanguage.guildOffice[t.data.office]+"]",this.nameLable.text=t.data.name,this.payNum.text=""+t.num,this.attr.text=""+t.data.attack,this.face.source="head_"+t.data.job+t.data.sex,this.headBg.source="touxiangkuang"+t.data.sex}this.checkBoxs.selected=this.data.isSelect||!1,this.btn1.visible=this.btn2.visible=this.num1.visible=this.inputBg.visible=this.data.isSelect||!1},e}(BaseItemRender);__reflect(MemberItem3Renderer.prototype,"MemberItem3Renderer"),window.MemberItem3Renderer=MemberItem3Renderer;var SelectRewardItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="SelectRewardItemSkin",e.choosePeople.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.list.itemRenderer=GuildWarMemberHeadRender,e.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GuildWar.ins().getModel().creatGuildRankReward(GuildWar.ins().getModel().guildWarRank,this.itemIndex);this.goods.data=t[0],this.boxname.text=GlobalConfig.ItemConfig[t[0].id].name,this.sendNum=GuildWar.ins().getModel().getCanSendNumByRank(this.itemIndex);var e=GuildWar.ins().getModel().getSelectDataByIndex(this.itemIndex),i=0;if(e.length>0)for(var n in e)i+=e[n].num;this.chooseNum.text=i+"/"+this.sendNum,this.list.dataProvider=new eui.ArrayCollection(e)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.choosePeople:GuildWar.ins().getModel().rewardIndex=this.itemIndex,ViewManager.ins().open(SelectMemberPanelWin,this.itemIndex,this.sendNum);break;case this.rightBtn:var e=this.list.layout.gap,i=this.list.getChildAt(0);
if(!i)return;var n=i.width+e,s=Math.ceil(this.list.width/n);if(this.index=Math.ceil(this.list.scrollH/n),this.index+s>=this.list.numElements)return;this.index++,egret.Tween.removeTweens(this.list);var o=egret.Tween.get(this.list);o.to({scrollH:n*this.index},100);break;case this.leftBtn:if(e=this.list.layout.gap,i=this.list.getChildAt(0),!i)return;if(n=i.width+e,s=Math.ceil(this.list.width/n),this.index=Math.ceil(this.list.scrollH/n),this.index<=0)return;this.index--,egret.Tween.removeTweens(this.list),o=egret.Tween.get(this.list),o.to({scrollH:n*this.index},100)}},e}(BaseItemRender);__reflect(SelectRewardItemRenderer.prototype,"SelectRewardItemRenderer"),window.SelectRewardItemRenderer=SelectRewardItemRenderer;var HeartMethod=function(t){function e(){var e=t.call(this)||this;return e._proShowList=[],e.sysId=PackageID.HeartMethod,e.regNetMsg(1,e.postHeartInfo),e.regNetMsg(2,e.postHeartUpLevel),e.regNetMsg(5,e.postOneKeyDecompose),e.HeartMethodInfo=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"proShowList",{get:function(){return this._proShowList.length||(this._proShowList=GlobalConfig.HeartMethodBaseConfig.proShowList),this._proShowList},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.heartOpenCondition=function(t){var e=GlobalConfig.HeartMethodConfig[t];return e.openCondition?GameServer.serverOpenDay+1<e.openCondition.day?!1:ZsCT.ins().lv<e.openCondition.zs?!1:!0:!0},e.prototype.heartUpCondition=function(t,e){var i=GlobalConfig.HeartMethodConfig[e];if(!i.upGradeCondition)return!0;var n=this.HeartMethodInfo[t];if(!n)return!1;var s=n[e];if(!s)return!1;for(var o=0,a=0;a<s.slots.length;a++)s.slots[a]&&o++;return o<i.upGradeCondition?!1:!0},e.prototype.checkOpen=function(){return GameServer.serverOpenDay<GlobalConfig.HeartMethodBaseConfig.serverDay-1?!1:ZsCT.ins().lv<GlobalConfig.HeartMethodBaseConfig.zsLv?!1:!0},e.prototype.getHeartCfg=function(t,e){void 0===e&&(e=!1);var i=GlobalConfig.HeartMethodStarConfig;if(Assert(i,"HeartMethodStarConfig is null"))return null;var n=e?t.configID+1:t.configID;return i[n]},e.prototype.calcHeartSlotValue=function(t,e){var i=[];return i},e.prototype.getHeartSlotItemIdWear=function(t,e,i){var n=this.HeartMethodInfo[t];if(!n)return 0;var s=n[e];if(!s)return 0;var o=BagCT.ins().getBagGoodsByType(ItemType.TYPE_18);o.sort(this.changeSort);for(var a=0,r=o;a<r.length;a++){var l=r[a],h=GlobalConfig.HeartMethodStarConfig[l.configID];if(h.heartmethodId==e){var u=l.itemConfig,p=u.level?u.level:0,c=u.zsLevel?u.zsLevel:0;if(!(Actor.level<p||ZsCT.ins().lv<c)){var d=this.getSuitPosFromItemId(l.configID);if(i==d)return l.configID}}}return 0},e.prototype.getHeartSlotItemId=function(t,e,i){var n=this.HeartMethodInfo[t];if(!n)return 0;var s=n[e];return s&&s.slots[i-1]?s.slots[i-1]:0},e.prototype.calcHeartSlotChange=function(t,e,i){var n=this.HeartMethodInfo[t];if(!n)return 0;var s=n[e];if(!s)return 0;var o=GlobalConfig.HeartMethodStarConfig[i];if(!o)return 0;var a=s.slots.indexOf(i);if(-1==a)return 0;var r=this.getSuitPosFromItemId(i);if(!r)return 0;var l=BagCT.ins().getBagGoodsByType(ItemType.TYPE_18);l.sort(this.changeSort);for(var h=0,u=l;h<u.length;h++){var p=u[h];if(GlobalConfig.HeartMethodStarConfig[p.configID].posSort==r&&GlobalConfig.HeartMethodStarConfig[p.configID].heartmethodId==e){var c=GlobalConfig.ItemConfig[p.configID],d=c.level?c.level:0,g=c.zsLevel?c.zsLevel:0;if(!(Actor.level<d||ZsCT.ins().lv<g)){var f=GlobalConfig.HeartMethodStarConfig[c.id];if(f.quality>o.quality)return c.id;if(f.quality==o.quality&&f.star>o.star)return c.id}}}return 0},e.prototype.changeSort=function(t,e){if(ItemUtil.getQuality(t.itemConfig)>ItemUtil.getQuality(e.itemConfig))return-1;var i=GlobalConfig.HeartMethodStarConfig[t.configID],n=GlobalConfig.HeartMethodStarConfig[e.configID];return Algorithm.sortDesc(i.star,n.star)},e.prototype.getSuitPosFromItemId=function(t){var e=GlobalConfig.HeartMethodStarConfig[t];return e?e.posSort:0},e.prototype.calcHeartSlotCost=function(t){var e=!1,i=GlobalConfig.HeartMethodStarConfig[t];if(!i||!i.nextItem)return e;var n=BagCT.ins().getBagItemById(i.costItem);return n&&n.count>=i.costNum&&(e=!0),e},e.prototype.calcHeartTotalValue=function(t,e){for(var i=this.proShowList,n=[],s=0;s<i.length;s++)n.push(0);var o=this.HeartMethodInfo[t];if(!o||!o[e])return n;for(var a=this.calcHeartAttrs(t,e),s=0;s<i.length;s++)if(i[s].filter){var r=this.calcHeartSkillLevel(t,e);if(r){var l=GlobalConfig.HeartMethodSuitConfig[e][r];l&&i[s].id==l.attr[0].type&&(n[s]+=l.attr[0].value/100)}}else{for(var h=0;h<o[e].slots.length;h++){var u=o[e].slots[h],p=GlobalConfig.HeartMethodStarConfig[u];if(p)for(var c=0;c<p.attr.length;c++)i[s].id==p.attr[c].type&&(n[s]+=p.attr[c].value)}for(var d=0;d<a.length;d++)if(i[s].id==a[d].type){n[s]+=a[d].value;break}}return n},e.prototype.getHeartSuitCount=function(t,e,i){var n=this.HeartMethodInfo[t];if(!n||!n[e])return 0;for(var s=0,o=0;o<n[e].slots.length;o++){var a=n[e].slots[o];if(a){var r=GlobalConfig.HeartMethodStarConfig[a];r.quality>=i&&s++}}return s},e.prototype.calcHeartSkillLevel=function(t,e){var i=0,n=this.HeartMethodInfo[t];if(!n||!n[e])return i;for(var s,o=0;o<n[e].slots.length;o++){var a=n[e].slots[o];if(!a)return 0;var r=GlobalConfig.HeartMethodStarConfig[a];if(r){var l=r.quality;(!s||s>l)&&(s=l)}}return s&&(i=s),i},e.prototype.calcHeartAttrs=function(t,e){var i=this.HeartMethodInfo[t],n=[];if(!i||!i[e]||!i[e].id)return n;var s=i[e],o=GlobalConfig.HeartMethodStageConfig[s.id];if(o&&o[s.stage])for(var a=o[s.stage].attr,r=0,l=a;r<l.length;r++){var h=l[r],u=new AttributeData;u.type=h.type,u.value=h.value,n.push(u)}var p=GlobalConfig.HeartMethodLevelConfig[s.id];if(p&&p[s.lv])for(var a=p[s.lv].attr,c=0,d=a;c<d.length;c++){for(var h=d[c],g=!1,f=0;f<n.length;f++)if(n[f].type==h.type){n[f].value+=h.value,g=!0;break}if(!g){var u=new AttributeData;u.type=h.type,u.value=h.value,n.push(u)}}return n},e.prototype.calcHeartAttrsNext=function(t,e){var i=this.HeartMethodInfo[t],n=[];if(!i||!i[e]||!i[e].id)return n;var s=i[e],o=GlobalConfig.HeartMethodStageConfig[s.id],a=GlobalConfig.HeartMethodLevelConfig[s.id],r=[],l=[];if(s.isUp?(r=o[s.stage+1]?o[s.stage+1].attr:o[s.stage].attr,l=a[s.lv].attr):(r=o[s.stage].attr,l=a[s.lv+1]?a[s.lv+1].attr:a[s.lv].attr),r&&r.length)for(var h=r,u=0,p=h;u<p.length;u++){var c=p[u],d=new AttributeData;d.type=c.type,d.value=c.value,n.push(d)}if(l.length)for(var h=l,g=0,f=h;g<f.length;g++){for(var c=f[g],v=!1,y=0;y<n.length;y++)if(n[y].type==c.type){n[y].value+=c.value,v=!0;break}if(!v){var d=new AttributeData;d.type=c.type,d.value=c.value,n.push(d)}}return n},e.prototype.calcHeartCost=function(t,e){var i=null,n=this.HeartMethodInfo[t];if(!n||!n[e]||!n[e].id||this.isHeartMax(t,e)||n[e].isUp)return i;var s=GlobalConfig.HeartMethodLevelConfig[n[e].id][n[e].lv+1];return s&&(i={itemid:s.costItem,count:s.costNum}),i},e.prototype.isHeartMax=function(t,e){var i=this.HeartMethodInfo[t];if(!i||!i[e]||!i[e].id)return!1;var n=GlobalConfig.HeartMethodLevelConfig[i[e].id][i[e].lv+1];return n?!1:!0},e.prototype.getAttrStrByType=function(t){for(var e="",i=0,n=this.proShowList;i<n.length;i++){var s=n[i];if(s.id==t){e=s.name;break}}return e},e.prototype.sendHeartUpLevel=function(t,e,i){var n=this.getBytes(3);n.writeByte(t),n.writeShort(e),n.writeShort(i),this.sendToServer(n)},e.prototype.sendHeartChange=function(t,e,i,n){var s=this.getBytes(4);s.writeByte(t),s.writeShort(e),s.writeShort(i),s.writeInt(n),this.sendToServer(s)},e.prototype.sendOneKeyDecompose=function(t,e){var i=e.length,n=this.getBytes(5);n.writeShort(t),n.writeInt(i);for(var s=0;i>s;s++)n.writeInt(e[s].configID);this.sendToServer(n)},e.prototype.postHeartInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readByte();this.HeartMethodInfo[n]||(this.HeartMethodInfo[n]={});for(var s=t.readShort(),o=0;s>o;o++){var a=t.readShort(),r=t.readShort(),l=t.readByte(),h=t.readShort(),u=new HearMethodData;u.id=a,u.lv=r,u.stage=l;for(var p=0;h>p;p++){var c=t.readInt();u.slots.push(c)}this.HeartMethodInfo[n][a]=u}}},e.prototype.postHeartUpLevel=function(t){var e=t.readUnsignedByte();this.HeartMethodInfo[e]||(this.HeartMethodInfo[e]={});var i,n=t.readShort();this.HeartMethodInfo[e][n]?i=this.HeartMethodInfo[e][n]:(i=new HearMethodData,i.id=n);var s=t.readShort();i.lv=s;var o=t.readByte();i.stage=o;var a=t.readShort();i.slots=[];for(var r=0;a>r;r++){var l=t.readInt();i.slots.push(l)}this.HeartMethodInfo[e][n]=i},e.prototype.postOneKeyDecompose=function(t){var e=t.readByte(),i=0,n=0;return e&&(i=t.readShort(),n=t.readShort()),[e,i,n]},__decorate([post()],e.prototype,"postHeartInfo",null),__decorate([post()],e.prototype,"postHeartUpLevel",null),__decorate([post()],e.prototype,"postOneKeyDecompose",null),e}(BaseSystem);__reflect(HeartMethod.prototype,"HeartMethod");var HearMethodData=function(){function t(){this.id=0,this.lv=0,this.stage=0,this.slots=[]}return Object.defineProperty(t.prototype,"stage",{get:function(){return this.isUp?Math.floor(this.lv/10):Math.floor(this.lv/10)+1},set:function(t){this.isUp=t},enumerable:!0,configurable:!0}),t}();__reflect(HearMethodData.prototype,"HearMethodData");var HeartTypeData=function(){function t(){}return t}();__reflect(HeartTypeData.prototype,"HeartTypeData"),System.HeartMethod=function(){return HeartMethod.ins()},window.HeartMethod=HeartMethod;var HeartMethodRedPoint=function(t){function e(){var e=t.call(this)||this;return e.roleTabs={},e.roleTabs={},e.redPoint=!1,e.associated(e.postHeartMethodRedPoint,e.postHeartRoleRedPoint),e.associated(e.postHeartRoleRedPoint,HeartMethod.ins().postHeartInfo,HeartMethod.ins().postHeartUpLevel,HeartMethod.ins().postOneKeyDecompose,BagCT.ins().postItemCountChange,ZsCT.ins().postZsLv,GameLogic.ins().postSubRoleChange),e}return __extends(e,t),e.prototype.postHeartMethodRedPoint=function(){var t=this.redPoint;if(!HeartMethod.ins().checkOpen())return this.redPoint=!1,t!=this.redPoint;for(var e=0;e<SubRoles.ins().subRolesLen;e++)if(this.roleTabs[e])for(var i in this.roleTabs[e])if(this.roleTabs[e][i])return this.redPoint=!0,this.redPoint;return this.redPoint=!1,t!=this.redPoint},e.prototype.postHeartRoleRedPoint=function(){if(HeartMethod.ins().checkOpen())for(var t=0;t<SubRoles.ins().subRolesLen;t++){this.roleTabs[t]||(this.roleTabs[t]={});var e=HeartMethod.ins().HeartMethodInfo[t];e||(e={});for(var i in GlobalConfig.HeartMethodConfig){var n=e[i];if(n)if(this.roleTabs[t][n.id]||(this.roleTabs[t][n.id]=!1),n.id){if(this.roleTabs[t][n.id]=!1,!HeartMethod.ins().heartOpenCondition(n.id))continue;var s=HeartMethod.ins().calcHeartCost(t,n.id);if(s){var o=BagCT.ins().getBagItemById(s.itemid),a=o?o.count:0;if(this.roleTabs[t][n.id]=a>=GlobalConfig.HeartMethodStageConfig[n.id][n.stage].normalCostTip,this.roleTabs[t][n.id]){if(HeartMethod.ins().heartUpCondition(t,n.id))continue;this.roleTabs[t][n.id]=!1}}if(n.isUp&&!HeartMethod.ins().isHeartMax(t,n.id)){this.roleTabs[t][n.id]=!0;continue}var r=GlobalConfig.HeartMethodConfig[n.id];t:for(var l=0;l<r.posList.length;l++){var h=HeartMethod.ins().getHeartSlotItemId(t,n.id,l+1);if(h)if(HeartMethod.ins().calcHeartSlotCost(h))this.roleTabs[t][n.id]=!0;else for(var u=0;u<n.slots.length;u++){var p=n.slots[u],c=HeartMethod.ins().calcHeartSlotChange(t,n.id,p);if(this.roleTabs[t][n.id]=c?!0:!1,c)break t}else{var d=HeartMethod.ins().getHeartSlotItemIdWear(t,n.id,l+1);if(this.roleTabs[t][n.id]=d?!0:!1,d)break}}if(this.roleTabs[t][n.id])continue}else this.roleTabs[t][n.id]=!0;else HeartMethod.ins().heartOpenCondition(GlobalConfig.HeartMethodConfig[i].id)?this.roleTabs[t][GlobalConfig.HeartMethodConfig[i].id]=!0:this.roleTabs[t][GlobalConfig.HeartMethodConfig[i].id]=!1}}},e.prototype.checkHeartRedPoint=function(t,e){return this.roleTabs[t]||(this.roleTabs[t]={}),this.roleTabs[t][e]?!0:!1},__decorate([post()],e.prototype,"postHeartMethodRedPoint",null),__decorate([post()],e.prototype,"postHeartRoleRedPoint",null),e}(BaseSystem);__reflect(HeartMethodRedPoint.prototype,"HeartMethodRedPoint"),System.HeartMethodRedPoint=function(){return HeartMethodRedPoint.ins()},window.HeartMethodRedPoint=HeartMethodRedPoint;var HeartMethodAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[],e.skinName="heartmethodAttrSkin",e.isTopLevel=!0,e.proShowList=HeartMethod.ins().proShowList,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.heartId=t[1],this.setRoleAttr(this.curRole);var i=SubRoles.ins().subRolesLen;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=SubRoles.ins().subRolesLen;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i="",n="",s=0,o=0,a=HeartMethod.ins().calcHeartTotalValue(e.index,this.heartId),r=0;r<this.proShowList.length;r++)o=this.proShowList[r].id,s=a[r],s&&(i+=this.proShowList[r].id==AttributeType.atZhuiMingPro?s+"%":s+"",n+=HeartMethod.ins().getAttrStrByType(o)+":",r<this.proShowList.length-1&&(i+="\n",n+="\n"));this.attr.text=i,this.attrName.text=n,this.setBtn()},e.prototype.setBtn=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(HeartMethodAttrWin.prototype,"HeartMethodAttrWin"),ViewManager.ins().reg(HeartMethodAttrWin,LayerManager.UI_Popup),window.HeartMethodAttrWin=HeartMethodAttrWin;var HeartMethodDecomposeItemData=function(){function t(){this.itemData=null,this.isSelected=!1}return t}();__reflect(HeartMethodDecomposeItemData.prototype,"HeartMethodDecomposeItemData"),window.HeartMethodDecomposeItemData=HeartMethodDecomposeItemData;var HeartMethodDecomposeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.cb.touchChildren=!1,this.cb.touchEnabled=!1;var t=this.data,e=t.itemData;if(e&&e instanceof ItemData){var i=HeartMethod.ins().getHeartCfg(e);i?this.itemIcon.data=e:this.resetView()}else this.resetView();this.cb.selected=t.isSelected},e.prototype.resetView=function(){this.itemIcon.data=null},e.prototype.playEffect=function(){!this.cb.selected},e}(eui.ItemRenderer);__reflect(HeartMethodDecomposeItemRenderer.prototype,"HeartMethodDecomposeItemRenderer"),window.HeartMethodDecomposeItemRenderer=HeartMethodDecomposeItemRenderer;var HeartMethodDecomposePanel=function(t){function e(){var e=t.call(this)||this;return e.cardList=null,e.cardCollection=null,e.checkBoxNum=4,e.itemListScrollV=0,e.resolveIng=!1,e._addNum=0,e._chipNum=0,e.skinName="heartmethodDecomposeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.itemList.itemRenderer=HeartMethodDecomposeItemRenderer,this.itemList.useVirtualLayout=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.checkBoxNum;i++)this["cb"+i]&&this.addTouchEvent(this["cb"+i],this.onCBTap);this.addTouchEvent(this.decomposeBtn,this.onTap),this.addTouchEvent(this.itemList,this.onListTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(HeartMethod.ins().postOneKeyDecompose,this.onDecomposeResult),this.heartId=t[0],this.initCardList(),this.resetCheckBox(),this.updateShatter()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cleanCardList()},e.prototype.onDecomposeResult=function(t){var e=this;if(t[0]){t[1],t[2];Timer.start(500,1,function(){e.initCardList(),e.updateShatter(),e.updateAddShatter(),e.resolveIng=!1},this)}else TipsCT.ins().showTips("分解失败，请稍后再试")},e.prototype.playEffect=function(){for(var t=this.itemList.numChildren,e=0;t>e;e++){var i=this.itemList.getChildAt(e);i&&i.playEffect()}},e.prototype.onShatterChange=function(){this.updateShatter()},e.prototype.onListTap=function(t){if(t&&t.currentTarget){var e=this.itemList.selectedIndex;if(0>e)return;var i=this.itemList.getVirtualElementAt(e);if(i&&i instanceof HeartMethodDecomposeItemRenderer&&i.cb){var n=i.data;n&&(n.isSelected=!n.isSelected,this.cardCollection.itemUpdated(n))}this.itemList.selectedIndex=-1,this.updateAddShatter()}},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.decomposeBtn:this.decomposeHeart();break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.decomposeHeart=function(){if(!this.resolveIng){if(this.cardList&&this.cardList.length>0){for(var t=[],e=0,i=this.cardList;e<i.length;e++){var n=i[e];n&&n.isSelected&&n.itemData&&n.itemData.itemConfig&&t.push(n.itemData)}if(t.length>0)return this.resolveIng=!0,void HeartMethod.ins().sendOneKeyDecompose(this.heartId,t)}TipsCT.ins().showTips("当前无选择任何心法")}},e.prototype.onCBTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(e&&e instanceof eui.CheckBox)for(var i=null,n=0;n<this.checkBoxNum;n++)if(i=this["cb"+n],i&&i===e)return void this.setQualitySelected(n+1,e.selected)}},e.prototype.updateShatter=function(){var t=GlobalConfig.HeartMethodConfig[this.heartId].splitItem,e=GlobalConfig.ItemConfig[t];this.suipianIcon.source=e.icon+"_png";var i=BagCT.ins().getBagItemById(e.id);this.suipianNum.text=(i?i.count:0)+""},e.prototype.updateAddShatter=function(){var t=0,e=null;if(this.cardList&&this.cardList.length>0)for(var i=0,n=this.cardList;i<n.length;i++){var s=n[i];s&&s.isSelected&&s.itemData&&s.itemData.itemConfig&&(e=HeartMethod.ins().getHeartCfg(s.itemData),e&&(t+=e.splitNum))}this._addNum=t,this.suipianAdd.text=t?"+"+t:""},e.prototype.setQualitySelected=function(t,e){if(0>t)for(var i=0,n=this.cardList;i<n.length;i++){var s=n[i];s.itemData&&s.itemData.itemConfig&&(s.isSelected=!1)}else for(var o=0,a=this.cardList;o<a.length;o++){var s=a[o];s.itemData&&s.itemData.itemConfig&&ItemUtil.getQuality(s.itemData.itemConfig)==t&&(s.isSelected=e)}for(var r=this.cardCollection.length,l=0;r>l;l++)this.cardCollection.itemUpdated(this.cardList[l]);this.updateAddShatter()},e.prototype.getCheckBoxSelected=function(t){var e=this["cb"+(t-1)];return e?e.selected:!1},e.prototype.resetCheckBox=function(t){void 0===t&&(t=1);for(var e=null,i=0;i<this.checkBoxNum;i++)e=this["cb"+i],e&&e instanceof eui.CheckBox&&(e.selected=i+1==t);this.setQualitySelected(t,!0)},e.prototype.selectHeartItem=function(t){for(var e=[],i=0;i<t.length;i++){var n=GlobalConfig.HeartMethodStarConfig[t[i].configID];this.heartId==n.heartmethodId&&e.push(t[i])}return e},e.prototype.initCardList=function(){this.cleanCardList(),this.cardList=[];var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_18),e=this.selectHeartItem(t);if(e&&e.length>0){for(var i=null,n=0,s=e;n<s.length;n++)for(var o=s[n],a=0;a<o.count;a++)i=new HeartMethodDecomposeItemData,i.itemData=o,this.cardList.push(i);this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList),this.itemList.dataProvider=this.cardCollection},e.prototype.cleanCardList=function(){this.cardList=null,this.cardCollection=null,this.itemList&&(this.itemList.dataProvider=null)},e.prototype.sortList=function(t,e){var i=ItemUtil.getQuality(t.itemData.itemConfig),n=ItemUtil.getQuality(e.itemData.itemConfig);if(i>n)return-1;if(n>i)return 1;var s=HeartMethod.ins().getHeartCfg(t.itemData),o=HeartMethod.ins().getHeartCfg(e.itemData);return s.star>o.star?-1:1},e}(BaseEuiView);__reflect(HeartMethodDecomposePanel.prototype,"HeartMethodDecomposePanel"),ViewManager.ins().reg(HeartMethodDecomposePanel,LayerManager.UI_Popup),window.HeartMethodDecomposePanel=HeartMethodDecomposePanel;var HeartMethodDisplay=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodItemIconSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof ItemData){var t=this.data,e=GlobalConfig.ItemConfig[t.itemConfig.id];this.itemIcon.setData(e);var i=ItemUtil.getQualityColor(e);this.nameTF.textFlow=TextFlowMaker.generateTextFlow1("|C:"+i+"&T:"+e.name)}},e.prototype.destruct=function(){},e}(BaseItemRender);__reflect(HeartMethodDisplay.prototype,"HeartMethodDisplay"),window.HeartMethodDisplay=HeartMethodDisplay;var HeartMethodItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodPosSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){t&&this.skin&&(t.itemid?(this.itemIcon.setData(GlobalConfig.ItemConfig[t.itemid]),this.itemIcon.visible=!0,this.blank.visible=!1):(this.itemIcon.visible=!1,this.blank.source=t.blank,this.blank.visible=!0),this.redPoint.visible=t.redPoint)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(HeartMethodItemRenderer.prototype,"HeartMethodItemRenderer"),window.HeartMethodItemRenderer=HeartMethodItemRenderer;var HeartMethodSkillTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodSkillTipSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI),this.roleId=t[0],this.heartId=t[1],this.skillMc=new MovieClip,this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.updateUI=function(){var t,e=HeartMethod.ins().calcHeartSkillLevel(this.roleId,this.heartId),i=GlobalConfig.HeartMethodSuitConfig[this.heartId],n=Object.keys(i).length;e?e>=n?(this.currentState="max",t=i[n]):(this.currentState="normal",t=i[e]):(this.currentState="initial",t=i[1]),this.validateNow();var s=GlobalConfig.HeartMethodConfig[this.heartId];if(s){this.skillName.text=s.name;var o=void 0;switch(this.skill.addChild(this.skillMc),this.heartId){case 1:o="wuying";break;case 2:o="wuxiang";break;case 3:o="Duomin";break;case 4:o="Tianxin"}this.skillMc.x=250,this.skillMc.y=270,this.skillMc.playFile(RES_DIR_EFF+o,-1)}var a=ItemBase.QUALITY_COLOR[t.level];this.curskillDesc0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:【"+t.skillname+"】");var r="",l=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,t.level),h=GlobalConfig.HeartMethodConfig[this.heartId].posList.length;if(r="("+l+"/"+h+")","initial"==this.currentState)this.curskillDesc2.text=this.getColorDesc(t.level)+r,this.curskillDesc3.text=t.skilldesc;else if("normal"==this.currentState){var u=i[e+1];this.curskillDesc3.text=t.skilldesc,l=HeartMethod.ins().getHeartSuitCount(this.roleId,this.heartId,u.level),r="("+l+"/"+h+")",a=ItemBase.QUALITY_COLOR[u.level],this.nextskillTitle0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:【"+u.skillname+"】"),this.nextskillTitle2.text=this.getColorDesc(u.level)+r,this.nextskillTitle3.text=u.skilldesc}else"max"==this.currentState&&(this.nextskillTitle0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+a+"&T:【"+t.skillname+"】"),this.nextskillTitle3.text=t.skilldesc)},e.prototype.getColorDesc=function(t){var e="";switch(t){case 0:e="白色";break;case 1:e="绿色";break;case 2:e="紫色";break;case 3:e="橙色";break;case 4:e="红色"}return e&&(e="收集一套"+e+"心法残页激活"),e},e}(BaseEuiView);__reflect(HeartMethodSkillTips.prototype,"HeartMethodSkillTips"),ViewManager.ins().reg(HeartMethodSkillTips,LayerManager.UI_Popup),window.HeartMethodSkillTips=HeartMethodSkillTips;var HeartMethodTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="heartmethodTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.addStar,this.onClick),this.addTouchEvent(this.replace,this.onClick),this.observe(HeartMethod.ins().postHeartUpLevel,this.updateUI),this.roleId=t[0],this.heartId=t[1],this.id=t[2],this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick),this.removeTouchEvent(this.addStar,this.onClick),this.removeTouchEvent(this.replace,this.onClick),DisplayUtils.removeFromParent(this.starList),this.starList=null},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.addStar:if(this.isMax)return void TipsCT.ins().showTips("已满星");this.isAdd?HeartMethod.ins().sendHeartUpLevel(this.roleId,this.heartId,this.pId):TipsCT.ins().showTips("|C:0xff0000&T:材料不足");break;case this.replace:var e=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id);if(!e)return void TipsCT.ins().showTips("没有更好的部位被替换");if(!this.pId)return void TipsCT.ins().showTips("道具:"+this.id+"套装部位数据异常");HeartMethod.ins().sendHeartChange(this.roleId,this.heartId,this.pId,e)}},e.prototype.updateUI=function(){if(this.pId=HeartMethod.ins().getSuitPosFromItemId(this.id),this.pId){this.id=HeartMethod.ins().HeartMethodInfo[this.roleId][this.heartId].slots[this.pId-1];var t=GlobalConfig.HeartMethodStarConfig[this.id];if(t){this.icon.source=t.bigIcon,this.mc||(this.mc=new MovieClip),this.mc.parent||this.effGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+t.effect,-1);var e=GlobalConfig.ItemConfig[this.id];this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemUtil.getQualityColor(e)+"&T:"+e.name);var i=BagCT.getAttrPower(t.attr);this.powerPanel.setPower(i);for(var n="",s="",o=0,a=HeartMethod.ins().proShowList;o<a.length;o++)for(var r=a[o],l=0,h=t.attr;l<h.length;l++){var u=h[l];if(r.id==u.type){var p=HeartMethod.ins().getAttrStrByType(u.type);if(!p)continue;if(!u.value)continue;n+=p,s+="+"+u.value,n+="\n",s+="\n"}}if(n){var c=n.lastIndexOf("\n");n=n.substring(0,c)}if(s){var c=s.lastIndexOf("\n");s=s.substring(0,c)}this.attr.text=n,this.value.text=s;var d="";if(this.isMax=!1,t.nextItem){var g=GlobalConfig.ItemConfig[t.costItem];if(g){var f=ItemUtil.getQualityColor(g);d="|C:0xFFFFCC&T:消耗 |C:"+f+"&T:"+g.name+"|C:0xFFFFCC&T: X"+t.costNum,this.cost.textFlow=TextFlowMaker.generateTextFlow1(d)}this.isAdd=HeartMethod.ins().calcHeartSlotCost(this.id)}else this.isMax=!0,this.isAdd=!1;this.cost.visible=d?!0:!1;var v=GlobalConfig.HeartMethodPosConfig[t.posId][t.quality];if(v){var y=Object.keys(v).length-1;this.starList?this.starList.setlistLength(y,t.star):(this.starList=new StarList(y),this.starList.horizontalCenter=0,this.starList.y=0,this.starGroup.addChild(this.starList)),this.starList.setStarNum(t.star)}this.updateRedPoint()}}},e.prototype.updateRedPoint=function(){this.redPoint1.visible=this.isAdd,this.redPoint2.visible=HeartMethod.ins().calcHeartSlotChange(this.roleId,this.heartId,this.id)?!0:!1},e}(BaseEuiView);__reflect(HeartMethodTips.prototype,"HeartMethodTips"),ViewManager.ins().reg(HeartMethodTips,LayerManager.UI_Popup),window.HeartMethodTips=HeartMethodTips;var HeartMethodWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heartId=1,e.heartPages=[],e}return __extends(e,t),e.prototype.removeDisplay=function(){this.stopIconTween()},e.prototype.skinComplete=function(){this.addTouchEvent(this.xiangxishuxing,this.onTap),this.addTouchEvent(this.skill,this.onTap),this.addTouchEvent(this.fenjie,this.onTap),this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.activeBtn0,this.onTap),this.addTouchEvent(this.boostBtn,this.onTap),this.addTouchEvent(this.getItemTxt0,this.onTap);for(var t=0;5>t;t++)this.addTouchEvent(this["item"+(t+1)],this.onSlot);this.curRole=this.curRole},e.prototype.addDisplay=function(){this.stopIconTween(),this.observe(HeartMethodRedPoint.ins().postHeartRoleRedPoint,this.updateUI)},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.init(),this.updateUI())},enumerable:!0,configurable:!0}),e.prototype.onSlot=function(t){for(var e=this.getHeartId(this.heartPos),i=0;5>i;i++)if(t.currentTarget==this["item"+(i+1)]){var n=HeartMethod.ins().getHeartSlotItemId(this.curRole,e,i+1);if(n)ViewManager.ins().open(HeartMethodTips,this.curRole,e,n);else{var s=BagCT.ins().getBagGoodsByType(ItemType.TYPE_18);s.sort(HeartMethod.ins().changeSort);for(var o=!1,a=0,r=s;a<r.length;a++){var l=r[a],h=GlobalConfig.HeartMethodStarConfig[l.configID];if(h.heartmethodId==e){var u=GlobalConfig.HeartMethodConfig[e].posList.indexOf(h.posId);if(-1!=u&&u==i){o=!0,HeartMethod.ins().sendHeartChange(this.curRole,e,i+1,h.posItem);break}}}o||TipsCT.ins().showTips("身上没有适合的道具穿戴")}break}},e.prototype.onTap=function(t){var e=this.getHeartId(this.heartPos);switch(t.currentTarget){case this.boostBtn:if("narmal"==this.currentState){if(!HeartMethod.ins().heartUpCondition(this.curRole,e))return void TipsCT.ins().showTips("|C:0xff0000&T:条件不足");if(!this.isHeartUp)return void TipsCT.ins().showTips("|C:0xff0000&T:材料不足");HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0)}else"stage"==this.currentState&&HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0);break;case this.activeBtn0:this.isAct=!0,HeartMethod.ins().sendHeartUpLevel(this.curRole,e,0);break;case this.xiangxishuxing:ViewManager.ins().open(HeartMethodAttrWin,this.curRole,e);break;case this.skill:ViewManager.ins().open(HeartMethodSkillTips,this.curRole,e);break;case this.fenjie:ViewManager.ins().open(HeartMethodDecomposePanel,e);break;case this.leftBtn:var i=this.getHeartId(this.heartPos-1),n=GlobalConfig.HeartMethodConfig[i];n?(this.heartPos--,this.heartId=i,this.updateUI()):TipsCT.ins().showTips("没有上一个秘籍");break;case this.rightBtn:var s=this.getHeartId(this.heartPos+1),o=GlobalConfig.HeartMethodConfig[s];o?(this.heartPos++,this.heartId=s,this.updateUI()):TipsCT.ins().showTips("没有下一个秘籍");break;case this.getItemTxt0:if(this.conditionDesc.visible){var a=GlobalConfig.HeartMethodConfig[this.getHeartId(this.heartPos)];WarnCT.ins().setBuyGoodsWarn(a.posGainGuide)}else WarnCT.ins().setBuyGoodsWarn(this.costId)}},e.prototype.init=function(){this.showGroupY=this.showGroup.y,this.showGroupMoveY=this.showGroupY-10,this.heartPages=[];for(var t in GlobalConfig.HeartMethodConfig)this.heartPages.push(GlobalConfig.HeartMethodConfig[t]);this.heartPages.sort(function(t,e){return t.sort<e.sort?-1:1}),this.heartPos=0;for(var e=0;e<this.heartPages.length;e++)if(this.heartPages[e].id==this.heartId){this.heartPos=e;
break}},e.prototype.getHeartId=function(t){return this.heartPages[t]?this.heartPages[t].id:0},e.prototype.updateUI=function(){this.updateAct(),this.updateState(),this.updatePower(),this.updateHeart(),this.updateRedPoint(),this.updateBtn()},e.prototype.updateAct=function(){this.isAct&&Activationtongyong.show(0,GlobalConfig.HeartMethodConfig[this.heartId].name,GlobalConfig.HeartMethodConfig[this.heartId].pic),this.isAct=!1},e.prototype.updateBtn=function(){this.leftBtn.visible=this.rightBtn.visible=!0;var t=this.getHeartId(this.heartPos-1),e=GlobalConfig.HeartMethodConfig[t];e?HeartMethod.ins().heartOpenCondition(t)||(this.leftBtn.visible=!1):this.redPoint2.visible=this.leftBtn.visible=!1,t=this.getHeartId(this.heartPos+1),e=GlobalConfig.HeartMethodConfig[t],e?HeartMethod.ins().heartOpenCondition(t)||(this.rightBtn.visible=!1):this.redPoint3.visible=this.rightBtn.visible=!1,t=this.getHeartId(this.heartPos),e=GlobalConfig.HeartMethodConfig[t];var i=e.openCondition?e.openCondition.zs:GlobalConfig.HeartMethodBaseConfig.zsLv;this.sysDescText0.text=e.openTips+"\n\n"+i+"转可学习"},e.prototype.updateState=function(){var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().HeartMethodInfo[this.curRole];e&&e[t]&&e[t].id?HeartMethod.ins().isHeartMax(this.curRole,t)?this.currentState="max":e[t].isUp?this.currentState="stage":this.currentState="narmal":this.currentState="open",this.validateNow()},e.prototype.updatePower=function(){for(var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().proShowList,i=HeartMethod.ins().calcHeartTotalValue(this.curRole,t),n=[],s=0;s<e.length;s++){var o=new AttributeData;o.type=e[s].id,o.value=i[s],n.push(o)}var a=BagCT.getAttrPower(n),r=HeartMethod.ins().HeartMethodInfo[this.curRole];if(r){var l=r[t];if(l){var h=GlobalConfig.HeartMethodLevelConfig[t][l.lv];if(h){var u=h.power?h.power:0;a+=u}}}var p=HeartMethod.ins().calcHeartSkillLevel(this.curRole,t);if(p){var c=GlobalConfig.HeartMethodSuitConfig[t][p],d=c.power?c.power:0;a+=d}this.powerPanel.setPower(a)},e.prototype.updateHeart=function(){var t=this.getHeartId(this.heartPos),e=HeartMethod.ins().HeartMethodInfo[this.curRole],i=GlobalConfig.HeartMethodConfig[t];if(i){this.bigIcon.source=i.pic,this.bigEff||(this.bigEff=new MovieClip),this.bigEff.parent||this.effGroup.addChild(this.bigEff);var n=HeartMethod.ins().calcHeartSkillLevel(this.curRole,t);if(n){var s=GlobalConfig.HeartMethodSuitConfig[t][n];this.bigEff.playFile(RES_DIR_EFF+s.inside,-1)}else this.bigEff.playFile(RES_DIR_EFF+i.inside,-1)}if(e&&e[t]?(this.heartmethodStage.visible=!0,this.heartmethodStage.setValue(e[t].stage),this.xinfaName.text=i?i.name:""):this.heartmethodStage.visible=!1,i&&e&&e[t]){for(var o=0;o<i.posList.length;o++){var a=i.posList[o],r=!1,l=HeartMethod.ins().getHeartSlotItemId(this.curRole,t,o+1);if(r=!!l,l){for(var h=!0,u=0;u<e[t].slots.length;u++){var p=e[t].slots[u],c=HeartMethod.ins().calcHeartSlotChange(this.curRole,t,p);r=!!c,!r&&p&&(r=HeartMethod.ins().calcHeartSlotCost(p));var d=GlobalConfig.HeartMethodStarConfig[p];if(d&&d.posId==a){h=!1,this["item"+(o+1)].data={itemid:p,redPoint:r};break}}h&&(ErrorLog.Assert(!h,"Bug定位:角色id:"+this.curRole+" 秘籍id:"+t+" 部位索引:"+(o+1)+" 部位id:"+a+" itemId:"+l+"数据异常"),this["item"+(o+1)].data=null)}else{var g=HeartMethod.ins().getHeartSlotItemIdWear(this.curRole,t,o+1);r=!!g,this["item"+(o+1)].data={blank:i.blankIcon[o],redPoint:r}}}var f=HeartMethod.ins().calcHeartAttrs(this.curRole,t),v=HeartMethod.ins().calcHeartAttrsNext(this.curRole,t);this.curAtt0.text=AttributeData.getAttStr(f,0,1,"："),this.nextAtt0.text=AttributeData.getAttStr(v,0,1,"：");var y=HeartMethod.ins().calcHeartCost(this.curRole,t);this.redPoint0.visible=!1,this.isHeartUp=!1;var m=void 0;if(y){this.costId=y.itemid;var T=this.getItemTxt0.text;this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+T),this.icon0.source=GlobalConfig.ItemConfig[y.itemid].icon+"_png",m=BagCT.ins().getBagItemById(y.itemid);var C="";m&&m.count>=y.count?(C="|C:0x00ff00&T:",this.redPoint0.visible=m.count>=GlobalConfig.HeartMethodStageConfig[t][e[t].stage].normalCostTip,this.isHeartUp=!0):C="|C:0xff0000&T:";var b=m?m.count:0;this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1(""+C+b+"|C:0xD1C28F&T:/"+y.count)}this.redPoint0.visible||(this.redPoint0.visible=!!e[t].isUp),"max"==this.currentState?this.redPoint0.visible=!1:"narmal"==this.currentState&&this.conditionDesc&&(this.costGroup0.visible=HeartMethod.ins().heartUpCondition(this.curRole,t),this.conditionDesc.visible=!this.costGroup0.visible,this.conditionDesc.visible&&(this.redPoint0.visible=!1,this.conditionDesc.text="需要集齐"+i.upGradeCondition+"个心法部位,才能修炼")),this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0,this.starList.y=0,this.starGroup.addChild(this.starList));var I=e[t].lv;I>0?this.starList.setStarNum(I%10==0?10:I%10):this.starList.setStarNum(0),I>0&&I%10==0&&(e[t].isUp?this.starList.setStarNum(10):this.starList.setStarNum(0))}},e.prototype.updateRedPoint=function(){var t=this.getHeartId(this.heartPos-1),e=this.getHeartId(this.heartPos+1),i=GlobalConfig.HeartMethodConfig[t];if(i){for(var n=!1,s=this.heartPos-1;s>0;s--){var o=this.getHeartId(s);if(!o)break;if(HeartMethod.ins().heartOpenCondition(o)&&(n=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,o)),n)break}this.redPoint2.visible=n}else this.redPoint2.visible=!1;var a=GlobalConfig.HeartMethodConfig[e];if(a){for(var n=!1,r=CommonUtils.getObjectLength(GlobalConfig.HeartMethodConfig),s=this.heartPos+1;r>=s;s++){var l=this.getHeartId(s);if(!l)break;if(HeartMethod.ins().heartOpenCondition(l)&&(n=HeartMethodRedPoint.ins().checkHeartRedPoint(this.curRole,l)),n)break}this.redPoint3.visible=n}else this.redPoint3.visible=!1;var h=this.getHeartId(this.heartPos);this.redPoint.visible=!1;var u=GlobalConfig.HeartMethodConfig[h];this.skill.source=u.skillButton},e.prototype.stopIconTween=function(){this.showGroup&&egret.Tween.removeTweens(this.showGroup)},e}(BaseView);__reflect(HeartMethodWin.prototype,"HeartMethodWin"),window.HeartMethodWin=HeartMethodWin;var Heirloom=function(t){function e(){var e=t.call(this)||this;return e.huntTimes=0,e.huntBoxInfo=[],e.huntHope=0,e.huntFreeTimes=0,e.huntRecords=[],e.upRequest=!1,e.sysId=PackageID.Heirloom,e.regNetMsg(1,e.postHeirloomInfo),e.regNetMsg(4,e.doHuntBack),e.regNetMsg(5,e.postHuntRecord),e.regNetMsg(7,e.postHuntBoxInfo),e.regNetMsg(8,e.postInitPower),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getThunderSuitPower=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(t),i=[],n=[3,4,5,6,7],s=GlobalConfig.LeitingEquipConf,o=function(t){if(EquipCT.ins().thunderUnlockIndex[t]){var o=e.thunderData[t];if(o.configID){var a=s[o.configID].level;if(a>=3)for(var r=function(t){a>=t&&(i[t]||(i[t]=0),i[t]++)},l=0,h=n;l<h.length;l++){var u=h[l];r(u)}}}},a=0;8>a;a++)o(a);for(var r={2:0,4:0,6:0,8:0},a=0;a<i.length;a++){var l=i[a];l&&(8==l&&r[8]<a&&(r[8]=a),l>=6&&r[6]<a&&(r[6]=a),l>=4&&r[4]<a&&(r[4]=a),l>=2&&r[2]<a&&(r[2]=a))}for(var h=GlobalConfig.LeitingEquipStarSuitConf,u=0,a=0;4>a;a++){var p=2*a+2;r[p]&&(u+=h[r[p]][p].power)}return u},e.prototype.thunderBoostElse=function(){for(var t=SubRoles.ins(),e=t.subRolesLen,i=[],n=0;3>n;n++)if(e>n)for(var s=t.getSubRoleByIndex(n).thunderData,o=0;8>o;o++)s[o].configID||(i[o]||(i[o]=0),i[o]++);else for(var o=0;8>o;o++)i[o]||(i[o]=0),i[o]++;var a=BagCT.ins().getBagEquipByType(ThunderEquipPanel.TYPE);a.sort(function(t,e){return e.point-t.point});for(var n=0;n<a.length;n++){var r=ItemUtil.getSubType(a[n].itemConfig);r>7?a[n]=null:i[r]>0&&(a[n]=null,i[r]--)}a.sort(function(t,e){return t&&e?t.configID-e.configID:void 0});for(var l=[],n=0;e>n;n++)for(var h=t.getSubRoleByIndex(n),o=0;8>o;o++){var u=h.thunderData[o];u&&l.push(u.handle)}for(var p=[],c=0,d=a;c<d.length;c++){var g=d[c];g&&-1==l.indexOf(g.handle)&&p.push(g)}return p},e.prototype.thunderExtraElse=function(t,e){var i=GlobalConfig.LeitingEquipTrimConf[t][e+1];if(i&&i.consume){var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_EQUIP,i.consume.id);return n>=i.consume.count}return!1},e.prototype.thunderRoleRed=function(t){return ThunderRedPoint.ins().roleTabs[t]||this.thunderBoostDo(t).ifRed||!!e.ins().thunderEquipRedList(t,!0).length},e.prototype.thunderEquipRedList=function(t,e){void 0===e&&(e=!1);for(var i=SubRoles.ins().getSubRoleByIndex(t),n=[],s=BagCT.ins().getBagEquipByType(ThunderEquipPanel.TYPE),o=[],a=Actor.level,r=ZsCT.ins().lv,l=0;l<s.length;l++){var h=s[l],u=ItemUtil.getSubType(h.itemConfig);if(!(!EquipCT.ins().thunderUnlockIndex[u]||r<(h.itemConfig.zsLevel||0)||a<(h.itemConfig.level||1))){if(o[u]&&h.point>o[u]||!i.thunderData[u]||!i.thunderData[u].configID||h.point>i.thunderData[u].point){if(e)return[h];n[u]=h,o[u]=h.point}if(u>7&&!n[u]&&i.thunderData[u]&&i.thunderData[u].configID&&this.thunderExtraElse(u,GlobalConfig.LeitingEquipConf[i.thunderData[u].configID].level)&&(n[u]=h,e))return[h]}}return n},e.prototype.thunderBoostDo=function(t){for(var e,i=EquipCT.ins().thunderEquipLv[t],n=0,s=0;8>s;s++){var o=i[s]||0;e?e>o&&(n=s,e=o):e=o}var a=GlobalConfig.LeitingEquipSlotConf,r=a[e],l=!1,h=0,u=0;if(r)if(a[e+1]){u=a[e+1].consume;var p=BagCT.ins().getBagItemById(GlobalConfig.LeitingEquipBaseConf.slotItem);p&&(h=p.count,l=h&&h>=u)}else h=0,l=!1;var c=l;return{boostRed:c,ifRed:l,itemCount:h,costCount:u,minLvI:n,minLv:e}},e.prototype.HeirloomEquipRed=function(t){for(var e=!1,i=SubRoles.ins().getSubRoleByIndex(t),n=0;8>n;n++){var s=i.heirloom.getInfoBySolt(n),o=void 0;o=s.lv?GlobalConfig.HeirloomEquipConfig[s.slot][s.lv]:GlobalConfig.HeirloomEquipFireConfig[n+1];var a=0,r=0;if(o){var l=o.expend;if(!l||0==l.id&&0==l.count)continue;var h=BagCT.ins().getBagItemById(l.id);if(a=h?h.count:0,r=l.count,a>=r&&(e=!0),!e){var u=GlobalConfig.HeirloomEquipItemConfig[o.slot],p=BagCT.ins().getBagItemById(u.item);e=!!p}if(e)break}}return e},e.prototype.checkRoleRedPoint=function(t){return this.HeirloomEquipRed(t)||this.thunderRoleRed(t)},e.prototype.checkRedPoint=function(){if(ZsCT.ins().lv<3)return!1;for(var t=SubRoles.ins().subRolesLen,e=!1,i=0;t>i&&!(e=this.checkRoleRedPoint(i));i++);return e},e.prototype.sendHeirloomAdd=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendHeirloomAct=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendHeirloomUpLevel=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeByte(e),this.upRequest=!0,this.sendToServer(i)},e.prototype.postHeirloomInfo=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),n=t.readUnsignedByte(),s=t.readDouble(),o=SubRoles.ins().getSubRoleByIndex(e);return o&&(o.heirloom.update(i,n),o.hlPower=s),e},e.prototype.sendHunt=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.sendHuntRecord=function(){this.sendBaseProto(5)},e.prototype.sendHuntAward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.doHuntBack=function(t){for(var e=t.readUnsignedByte(),i=t.readUnsignedByte(),n=[],s=0;i>s;s++)n[s]=[t.readInt(),t.readUnsignedByte()];ViewManager.ins().isShow(HuntResultWin)?this.postHuntResult(e,n,2):(ViewManager.ins().open(HuntResultWin,e,n,2),this.postHuntResult(e,n,2))},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postHuntRecord=function(t){this.huntRecords=[];for(var e=t.readUnsignedByte(),i=0;e>i;i++)this.huntRecords[i]=[t.readString(),t.readInt()];this.huntRecords.reverse()},e.prototype.postHuntBoxInfo=function(t){var i=t.readInt();this.huntTimes=t.readInt(),this.huntHope=t.readInt(),this.huntFreeTimes=t.readShort();var n,s=0;for(var o in GlobalConfig.HeirloomTreasureRewardConfig)n=GlobalConfig.HeirloomTreasureRewardConfig[o],this.huntBoxInfo[s]=i>>n.id&1?e.ISNGET:this.huntTimes>=n.needTime?e.CANGET:e.UNGET,s++},e.prototype.postInitPower=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readByte(),s=t.readDouble(),o=SubRoles.ins().getSubRoleByIndex(n);o&&(o.hlPower=s)}},e.prototype.getIsGetBox=function(){return-1!=this.huntBoxInfo.indexOf(e.CANGET)||this.huntFreeTimes>0},e.prototype.isHeirloomHuntOpen=function(){return ZsCT.ins().lv>=GlobalConfig.HeirloomTreasureConfig.openZSlevel&&GameServer.serverOpenDay>=GlobalConfig.HeirloomTreasureConfig.openDay},e.UNGET=0,e.CANGET=1,e.ISNGET=2,__decorate([post()],e.prototype,"postHeirloomInfo",null),__decorate([post()],e.prototype,"postHuntResult",null),__decorate([post()],e.prototype,"postHuntRecord",null),__decorate([post()],e.prototype,"postHuntBoxInfo",null),__decorate([post()],e.prototype,"postInitPower",null),e}(BaseSystem);__reflect(Heirloom.prototype,"Heirloom"),System.Heirloom=function(){return Heirloom.ins()},window.Heirloom=Heirloom;var HeirloomData=function(){function t(){this.heirloomData=[]}return t.prototype.parser=function(t){for(var e=0;8>e;e++){var i=t.readInt();this.heirloomData[e]=GlobalConfig.HeirloomEquipConfig[e+1][i]||new HeirloomEquipConfig}},t.prototype.update=function(t,e){this.heirloomData[t-1]=GlobalConfig.HeirloomEquipConfig[t][e]||new HeirloomEquipConfig},t.prototype.getData=function(){return this.heirloomData},t.prototype.getInfoBySolt=function(t){if(t>=0&&8>t){var e=this.heirloomData[t];if(e)return e}return null},t.getInfoBySoltFirst=function(t){if(t>=0&&8>t){var e=GlobalConfig.HeirloomEquipConfig[t+1][1];return e}return null},t.getEquipName=function(t){var e="";switch(t+1){case 1:e="武器";break;case 2:e="头盔";break;case 3:e="衣服";break;case 4:e="项链";break;case 5:e="护腕";break;case 6:e="腰带";break;case 7:e="戒指";break;case 8:e="鞋子"}return e},t.prototype.getSuitConfig=function(t){for(var e=t.heirloom.getData(),i=0,n=!0,s=0;s<e.length;s++){var o=e[s];0==s&&(i=o.lv),!o.lv&&n&&(n=!1),o.lv<=i&&(i=o.lv)}var a;return n&&(a=GlobalConfig.HeirloomEquipSetConfig[i]),a},t}();__reflect(HeirloomData.prototype,"HeirloomData"),window.HeirloomData=HeirloomData;var HeirloomCom=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomCom",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.curIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemDel,this.updateData),this.observe(BagCT.ins().postItemCountChange,this.updateData),this.observe(Heirloom.ins().postHeirloomInfo,this.updateData),this.addTouchEvent(this.rect,this.onClick),this.addTouchEvent(this.getItemTxt0,this.onClick),this.addTouchEvent(this.jihuo0,this.onClick);for(var i=0;8>i;i++)this.addTouchEvent(this["item"+i],this.onTap);this.initData()},e.prototype.initData=function(){this.model.visible=!1;for(var t=0;8>t;t++){var e=HeirloomData.getInfoBySoltFirst(t);this["item"+t].data={pos:t,info:e},this["item"+t].cleanEff()}this.item0.selectIcon.visible=!0;var i=HeirloomData.getInfoBySoltFirst(0);this.setModel(i),this.setCost(i)},e.prototype.updateData=function(){var t=this.curIndex,e=HeirloomData.getInfoBySoltFirst(t);this["item"+t].data={pos:t,info:e},this["item"+t].cleanEff(),this.setCost(e)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeAni()},e.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni),this.modelAni=null},e.prototype.onClick=function(t){var e,i;switch(t.currentTarget){case this.rect:ViewManager.ins().close(this);break;case this.getItemTxt0:i=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],ViewManager.ins().open(ShopGoodsWarn).setData(i.expend.id);break;case this.jihuo0:if(i=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],(this.curIndex+1==1||this.curIndex+1==3)&&(e=BagCT.ins().getBagItemById(i.item)))return void TipsCT.ins().showTips("|C:0x00ff00&T:已拥有该道具 请激活穿戴");e=BagCT.ins().getBagItemById(i.expend.id);var n=e?e.count:0;n>=i.expend.count?Heirloom.ins().sendHeirloomAdd(this.curIndex+1):TipsCT.ins().showTips("材料不足")}},e.prototype.onTap=function(t){for(var e=0;8>e;e++)switch(this["item"+e].selectIcon.visible=!1,t.currentTarget){case this["item"+e]:if(this.curIndex==e){this["item"+e].selectIcon.visible=!0;break}this.curIndex=e,this["item"+e].selectIcon.visible=!0;var i=HeirloomData.getInfoBySoltFirst(e);this.setModel(i),this.setCost(i)}},e.prototype.setModel=function(t){var e="";if(t)return e=t.model,this.modelAni?void this.modelAni.playFile(RES_DIR_EFF+e,-1):(this.modelAni=new MovieClip,this.modelAni.playFile(RES_DIR_EFF+e,-1),this.modelAni.x=this.model.x+this.model.width/2,this.modelAni.y=this.model.y+this.model.height/2,void this.model.parent.addChildAt(this.modelAni,this.model.parent.getChildIndex(this.model)))},e.prototype.setCost=function(t){if(t){var e=GlobalConfig.HeirloomEquipItemConfig[t.slot],i=e.expend,n=GlobalConfig.ItemConfig[i.id];if(n){this.icon0.source=n.icon.toString()+"_png";var s=BagCT.ins().getBagItemById(i.id),o=s?s.count:0,a=o,r="";r=a>=i.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel0.textFlow=TextFlowMaker.generateTextFlow("<font color="+r+">"+a+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+i.count+"</font> ");var l="|U&T:获取宝钻";1==t.slot?l="|U&T:获取龍之神刃":3==t.slot&&(l="|U&T:获取龍之神甲"),this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow(l)}}},e}(BaseEuiView);__reflect(HeirloomCom.prototype,"HeirloomCom"),ViewManager.ins().reg(HeirloomCom,LayerManager.UI_Popup),window.HeirloomCom=HeirloomCom;var HeirloomDownItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.configID=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var t=this.data.itemConfig,e=GlobalConfig.HeirloomEquipItemConfig;for(var i in e)if(e[i].item==t.id){var n=e[i].pos,s=GlobalConfig.HeirloomEquipConfig[n][1];this.itemicon.data={pos:n,info:s},this.itemicon.cleanEff();var o=GlobalConfig.ItemConfig[e[i].downitem.id],a=o.name?o.name:"龍装宝钻";this.desc.text=a+" x"+e[i].downitem.count;break}this.tip.visible=this.data.isSuggest,this.equipName.text=t.name,this.equipName.textColor=ItemUtil.getQualityColor(t)},e}(BaseItemRender);__reflect(HeirloomDownItemRenderer.prototype,"HeirloomDownItemRenderer"),window.HeirloomDownItemRenderer=HeirloomDownItemRenderer;var HeirloomDownView=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomDownSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listData=new eui.ArrayCollection,this.equipList.itemRenderer=HeirloomDownItemRenderer,this.equipList.dataProvider=this.listData,this.gainList.itemRenderer=GainGoodsItem,this.goList=new eui.ArrayCollection,this.gainList.dataProvider=this.goList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(BagCT.ins().postItemDel,this.updateData),this.observe(BagCT.ins().postItemCountChange,this.updateData),this.observe(BagCT.ins().postUseItemSuccess,this.updateData),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.curInfo=t[0],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.getHeirloomSource=function(){for(var t=BagCT.ins().getBagEquipsByQuality(5,BagCT.BAG_DESC_TYPE_HEIR,BagCT.BAG_TYPE_OTHTER),e=0;e<t.length;e++){t[e].isSuggest=!0;for(var i=0;3>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(!n)break;var s=GlobalConfig.HeirloomEquipItemConfig,o=!1;for(var a in s)if(s[a].item==t[e].configID){var r=s[a].pos,l=n.heirloom.getInfoBySolt(r-1);l&&l.lv>0?o=!1:(t[e].isSuggest=!1,o=!0);break}if(o)break}}return t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],n=GlobalConfig.ItemConfig[e.configID];return 1==t.isSuggest&&0==e.isSuggest?1:0==t.isSuggest&&1==e.isSuggest?-1:i.id<n.id?1:i.id>n.id?-1:0}),t},e.prototype.getHeirloomGoSource=function(){if(this.itemList)return this.itemList;var t,e=BagCT.ins().getBagItemById(200141);if(e)t=GlobalConfig.GainItemConfig[e.configID];else{if(!this.curInfo)return this.itemList;var i=0;i=this.curInfo.expend?this.curInfo.expend.id:GlobalConfig.HeirloomEquipConfig[this.curInfo.slot][this.curInfo.lv-1].expend.id,t=GlobalConfig.GainItemConfig[i]}return t?(this.gainList.dataProvider=new eui.ArrayCollection(t.gainWay),this.itemList=t.gainWay):(this.gainList.dataProvider=new eui.ArrayCollection([]),this.itemList=[]),this.itemList},e.prototype.updateData=function(){var t,e;t=this.getHeirloomSource(),e=this.getHeirloomGoSource(),e=e?e:[],this.listData.source=t,this.goList.source=e;var i=e.length;this.refushPos(i)},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":this.onHandler(t.target.parent.data)}}},e.prototype.onHandler=function(t){for(var e=[t],i=0;i<e.length&&(!e[i]||!BagCT.ins().sendUseItem(e[i].configID,e[i].count));i++);},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e}(BaseEuiView);__reflect(HeirloomDownView.prototype,"HeirloomDownView"),ViewManager.ins().reg(HeirloomDownView,LayerManager.UI_Popup),window.HeirloomDownView=HeirloomDownView;var HeirloomEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomitemtips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.index=t[1],this.curRole&&this.curRole.heirloom&&(this.info=this.curRole.heirloom.getInfoBySolt(this.index)),this.info&&this.info.lv||(this.info=GlobalConfig.HeirloomEquipConfig[this.index+1][1]),this.addTouchEndEvent(this.bgClose,this.onClick),this.init()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.init=function(){this.equipItem.data={pos:this.index,info:this.info},this.equipItem.setTipsVisible(),this.equipName.text=this.info.name,this.slot.text=HeirloomData.getEquipName(this.index);var t=this.setBasicsDesc();this.setSpecialDesc(),this.setSkillDesc();var e=Math.floor(BagCT.getAttrPower(t));this.power.text="评分:"+e,this.curRole&&(e=this.curRole.getHeirloomSlotPower(this.index)),this.powerPanel.setPower(e)},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.setBasicsDesc=function(){for(var t=[],e=0;e<this.info.attr.length&&!(e>3);e++){var i=new AttributeData,n=this.info.attr[e],s=AttributeData.getAttrStrByType(n.type);s+="+"+n.value,this["value"+e].text=s,i.type=n.type,i.value=n.value,t.push(i)}return t},e.prototype.setSpecialDesc=function(){for(var t=4;t<this.info.attr.length;t++)if(this["value"+t]){var e=this.info.attr[t],i=AttributeData.getAttrStrByType(e.type);i+="+"+e.value,this["value"+t].text=i}var n=HeirloomData.getEquipName(this.index);n+="部件所有属性+"+this.info.attr_add+"%",this.value6.text=n},e.prototype.setSkillDesc=function(){var t="";t=this.info.skillname?this.info.skillname+"\n"+this.info.skilldesc:"无",this.skilldesc.textFlow=TextFlowMaker.generateTextFlow1(t)},e}(BaseEuiView);__reflect(HeirloomEquipTipsWin.prototype,"HeirloomEquipTipsWin"),ViewManager.ins().reg(HeirloomEquipTipsWin,LayerManager.UI_Popup),window.HeirloomEquipTipsWin=HeirloomEquipTipsWin;var HeirloomMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="HeirloomMainWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.viewStack.selectedIndex=0,this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.switchRole)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0;this.roleSelect.setCurRole(i),this.observe(BagCT.ins().postItemDel,this.setRedPoint),this.observe(BagCT.ins().postItemCountChange,this.setRedPoint),this.observe(Heirloom.ins().postHeirloomInfo,this.setRedPoint),this.observe(ThunderRedPoint.ins().postRedPoint,this.setRedPoint),this.observe(SpiritEquipRedPoint.ins().postRedPoint,this.setRedPoint),this.tab.validateNow(),this.setSelectedIndex(0)},e.prototype.setRoleRed=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i){var n=i.job,s=Heirloom.ins().thunderRoleRed(e);s||(s=Heirloom.ins().HeirloomEquipRed(e)),s||(s=ExtremeEquipModel.ins().getRedPointByJob(n)),s||(s=WushuangRP.ins().getRoleRp(e)),this.roleSelect.showRedPoint(e,s)}}},e.prototype.setRedPoint=function(){for(var t=0;t<this.tab.numChildren;t++){var e=this.tab.getChildAt(t),i=e.eRp;switch(t){case 0:i.visible=Heirloom.ins().HeirloomEquipRed(this.roleSelect.getCurRole());break;case 1:i.visible=Heirloom.ins().thunderBoostDo(this.roleSelect.getCurRole()).ifRed,i.visible||(i.visible=!!Heirloom.ins().thunderEquipRedList(this.roleSelect.getCurRole(),!0).length),i.visible||(i.visible=ThunderRedPoint.ins().roleTabs[this.roleSelect.getCurRole()]);break;case 2:i.visible=ExtremeEquipModel.ins().getRedPoint();break;case 3:i.visible=SpiritEquipRedPoint.ins().redPoint;break;case 4:i.visible=WushuangRP.ins().getRoleRp();break;default:i.visible=!1}}this.setRoleRed()},e.prototype.setSelectedIndex=function(t){this.viewStack.selectedIndex=t,this.roleSelect.noMoveChange=this.viewStack.selectedChild==this.extremeEquipPanel,3==t?this.roleSelect.hideRole():(this.roleSelect.openRole(),this.switchRole()),this.setTitle()},e.prototype.onTabTouch=function(t){var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){switch(this.viewStack.getElementAt(t)){case this.thunderEquipPanel:if(!ThunderEquipPanel.openCheck())return!1;break;case this.heirloomPanel:if(!HeirloomPanel.openCheck())return!1;break;case this.extremeEquipPanel:if(!OpenSystem.ins().checkSysOpen(SystemType.ZHIZUN))return!1;break;case this.spiritEquipPanel:if(!SpiritEquipCT.ins().checkOpen(!0))return!1;break;case this.wushuangEquipPanel:if(!WushuangEquipCT.isOpen(!0))return!1}return!0},e.prototype.switchRole=function(){var t=this.viewStack.selectedChild;t&&t.setRoleId&&t.setRoleId(this.roleSelect.getCurRole()),this.setRedPoint()},e.prototype.openCheck=function(){return ThunderEquipPanel.openCheck()||HeirloomPanel.openCheck()||ExtremeEquipPanel.openCheck()},e.prototype.setTitle=function(){switch(this.viewStack.selectedIndex){case 0:this.title.source="leit_biaoti";break;case 1:this.title.source="biaoti_chuanshi";break;case 2:this.title.source="biaoti_chengzhuang";break;case 3:this.title.source="spiritTitle";break;case 4:this.title.source="wushuang_bt_png"}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},__decorate([callDelay(100)],e.prototype,"setRedPoint",null),e}(BaseEuiView);__reflect(HeirloomMainWin.prototype,"HeirloomMainWin"),ViewManager.ins().reg(HeirloomMainWin,LayerManager.UI_Main),window.HeirloomMainWin=HeirloomMainWin;var HeirloomPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.icon0.visible=!1},e.openCheck=function(){return!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curIndex=0,this.observe(BagCT.ins().postItemDel,this.updateData),this.observe(BagCT.ins().postItemCountChange,this.updateData),this.observe(Heirloom.ins().postHeirloomInfo,this.updateData),this.isFullLv();for(var i=0;8>i;i++)this.addTouchEvent(this["pos"+i],this.onTap);this.addTouchEvent(this.rightBtn,this.onClick),this.addTouchEvent(this.leftBtn,this.onClick),this.addTouchEvent(this.getItemTxt,this.onClick),this.addTouchEvent(this.jihuo,this.onClick),this.addTouchEvent(this.attrSet,this.onClick),this.addTouchEvent(this.neatSet,this.onClick),this.addTouchEvent(this.skill,this.onSkill),this.addTouchEvent(this.icon0.parent,this.onClick),this.initData()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeAni(),this.clearEff()},e.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni),this.modelAni=null},e.prototype.onSkill=function(t){switch(t.currentTarget){case this.skill:ViewManager.ins().open(HeirloomSkillItem,this.skill.itemIcon.imgIcon.source,this.skill.skillname,this.skill.skilldesc)}},e.prototype.onClick=function(t){switch(t.target){case this.leftBtn:this.leftBtn.visible=!1,this.rightBtn.visible=!0,this.pre();break;case this.rightBtn:this.rightBtn.visible=!1,this.leftBtn.visible=!0,this.next();break;case this.getItemTxt:var i=0;if("获取龍之神刃"==this.getItemTxt.text?i=1:"获取龍之神甲"==this.getItemTxt.text&&(i=3),i){var n=GlobalConfig.HeirloomEquipItemConfig[i];return void ViewManager.ins().open(ShopGoodsWarn).setData(n.item)}if("合成道具"==this.getItemTxt.text)ViewManager.ins().open(HeirloomCom);else{var s=this.currentRoleIndex,o=SubRoles.ins().getSubRoleByIndex(s),a=o.heirloom.getInfoBySolt(this.curIndex);ViewManager.ins().open(HeirloomDownView,a)}break;case this.jihuo:var r=this.getInitInfo(),l=this.currentRoleIndex,h=SubRoles.ins().getSubRoleByIndex(l),u=h.heirloom.getInfoBySolt(this.curIndex),p=this.curIndex+1;if(u&&u.lv>0){var c=this.check(r);c==e.Heir_TIPS_1?Heirloom.ins().sendHeirloomUpLevel(l,p):c==e.Heir_TIPS_2?(TipsCT.ins().showTips("已满级"),this.jihuo.visible=!1,this.costGroup.visible=!1,this.maxDesc.visible=!0):(this.jihuo.visible=!0,this.costGroup.visible=!0,this.maxDesc.visible=!1)}else{var c=this.check(r);if(c==e.Heir_TIPS_1)Heirloom.ins().sendHeirloomAct(l,p);else{var n=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];ViewManager.ins().open(ShopGoodsWarn).setData(n.item)}}break;case this.attrSet:var d=this.currentRoleIndex;ViewManager.ins().open(RoleAttrWin,d);break;case this.neatSet:var g=this.currentRoleIndex;ViewManager.ins().open(HeirloomSuit,g);break;case this.icon0.parent:var f=this.currentRoleIndex,v=SubRoles.ins().getSubRoleByIndex(f);ViewManager.ins().open(HeirloomEquipTipsWin,v,this.curIndex)}},e.prototype.isFullLv=function(){var t=this.currentRoleIndex,i=SubRoles.ins().getSubRoleByIndex(t),n=i.heirloom.getInfoBySolt(this.curIndex);if(n&&n.lv>0){var s=this.check(n);s==e.Heir_TIPS_1||s==e.Heir_TIPS_0?(this.jihuo.visible=!0,this.costGroup.visible=!0,this.maxDesc.visible=!1):s==e.Heir_TIPS_2&&(this.jihuo.visible=!1,this.costGroup.visible=!1,this.maxDesc.visible=!0)}else this.jihuo.visible=!0,this.costGroup.visible=!0,this.maxDesc.visible=!1},e.prototype.pre=function(){var t=this.getInitInfo();this.setHeirloom(this.curIndex,e.Heir_LRBtn,t)},e.prototype.next=function(){var t=this.getInitInfo(),i=this.curIndex+1,n=t.lv?t.lv+1:t.lv+2,s=this.getSlotInfoByLv(i,n);this.setHeirloom(this.curIndex,e.Heir_LRBtn,s)},e.prototype.onTap=function(t){for(var i=this.currentRoleIndex,n=SubRoles.ins().getSubRoleByIndex(i),s=0;8>s;s++)switch(this["pos"+s].setSelectIconVisible(!1),t.currentTarget){case this["pos"+s]:if(this.curIndex==s){this["pos"+s].setSelectIconVisible(!0),ViewManager.ins().open(HeirloomEquipTipsWin,n,s);break}this.curIndex=s,this.setHeirloom(s,e.Heir_Select),this["pos"+s].setSelectIconVisible(!0)}this.isFullLv()},e.prototype.updateData=function(){var t=Heirloom.ins().upRequest;this.setHeirloom(this.curIndex,e.Heir_Select,null,t),t&&(Heirloom.ins().upRequest=!1),this.isFullLv(),this.setSuitLvIcon(),this.setRedPoint(),this.updateRedPoint(),this.setPower()},e.prototype.initData=function(){for(var t=this.getInitInfo(),i=0;8>i;i++)this.setHeirloom(i,e.Heir_Init,t);this.pos0.setSelectIconVisible(!0),this.setSuitLvIcon(),this.setRedPoint(),this.setPower(),this.updateRedPoint()},e.prototype.updateRedPoint=function(){for(var t=!1,e=0;8>e;e++){var i=this.getInitInfo(e),n=void 0;n=i.lv?GlobalConfig.HeirloomEquipConfig[i.slot][i.lv]:GlobalConfig.HeirloomEquipFireConfig[e+1];
var s=0,o=0;if(n){var a=n.expend;if(!a||0==a.id&&0==a.count){this["pos"+e].redPoint.visible=!1;continue}var r=BagCT.ins().getBagItemById(a.id);s=r?r.count:0,o=a.count}if(this["pos"+e].redPoint.visible=s>=o,t=this["pos"+e].redPoint.visible)break}return t},e.prototype.setRoleId=function(t){this.currentRoleIndex=t,this.curIndex=0,this.skin&&(this.initData(),this.isFullLv())},e.prototype.setHeirloom=function(t,i,n,s){var o;if(i==e.Heir_Init)o=n;else if(i==e.Heir_Select){if(o=this.getInitInfo(t),!o.lv){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o.skillname=a.skillname,o.skilldesc=a.skilldesc,o.skillicon=a.skillicon,o.name=a.name}}else o=n;if(o&&(this.setModel(i,t,o),this.setUI(i,t,o),this.setDesc(i,t,o),this.setCost(i,t,o)),i!=e.Heir_LRBtn){if(i==e.Heir_Init&&t>0&&(o=this.getInitInfo(t)),!o.lv){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o.name=a.name}this["pos"+t].selectIcon.visible=!1,this["pos"+t].data={pos:t,info:o,uplevel:s}}if(i==e.Heir_Init&&0==t||i==e.Heir_LRBtn||i==e.Heir_Select){var a=GlobalConfig.HeirloomEquipConfig[t+1][1];o&&o.skillicon&&(a=o),a&&a.skillicon&&(this.skill.visible=!0,this.skill.data={pos:t,info:o,icon:a.skillicon,skillname:a.skillname,skilldesc:a.skilldesc},this.skill.cleanEff())}},e.prototype.setUI=function(t,i,n){var s;if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select){if(this.curIndex!=i)return}else if(t==e.Heir_LRBtn)return void(this.itemName.text=n.name);s=n;var o=this.curIndex+1,a=s.lv?s.lv+1:s.lv+2,r=this.getSlotInfoByLv(o,a);if(this.rightBtn.visible=!(!s.expend||!s.lv||!r),this.leftBtn.visible=!1,t==e.Heir_LRBtn&&(s=this.getInitInfo()),s.lv>0){this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow("|U&T:分解道具"),this.jihuo.label="升  级";var l=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1],h=BagCT.ins().getBagItemById(l.item);h?this.setEff():this.clearEff()}else{this.clearEff();var u="合成道具",p=GlobalConfig.HeirloomEquipItemConfig[this.curIndex+1];if(1==p.pos){var h=BagCT.ins().getBagItemById(p.item);h&&(u="获取龍之神刃")}else if(3==p.pos){var h=BagCT.ins().getBagItemById(p.item);h&&(u="获取龍之神甲")}this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow("|U&T:"+u),this.jihuo.label="激  活"}s.skillicon?(this.skill.visible=!0,this.skill.data={pos:i,info:s,icon:s.skillicon,skillname:s.skillname,skilldesc:s.skilldesc},this.skill.cleanEff()):this.skill.visible=!1,this.itemName.text=s.name},e.prototype.setEff=function(){this.resolveMc||(this.resolveMc=new MovieClip),this.resolveMc.parent||(this.getItemTxt.parent.addChild(this.resolveMc),this.resolveMc.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.resolveMc.touchEnabled=!1,this.resolveMc.scaleY=.6,this.resolveMc.scaleX=.6),this.resolveMc.x=this.getItemTxt.x+38,this.resolveMc.y=this.getItemTxt.y+9},e.prototype.clearEff=function(){DisplayUtils.removeFromParent(this.resolveMc)},e.prototype.setModel=function(t,i,n){var s,o="";if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select&&this.curIndex!=i)return;if(this.removeAni(),s=n,s&&s.lv>0)o=s.model;else{var a=GlobalConfig.HeirloomEquipConfig[i+1][1];o=a.model}return this.modelAni?void this.modelAni.playFile(RES_DIR_EFF+o,-1):(this.modelAni=new MovieClip,this.modelAni.playFile(RES_DIR_EFF+o,-1),this.modelAni.x=this.icon0.x+this.icon0.width/2,this.modelAni.y=this.icon0.y+this.icon0.height/2,void this.icon0.parent.addChildAt(this.modelAni,this.icon0.parent.getChildIndex(this.icon0)))},e.prototype.setDesc=function(t,i,n){var s;if(t==e.Heir_Init){if(i>0)return}else if(t==e.Heir_Select&&this.curIndex!=i)return;s=n;var o,a=[];s&&s.lv>0?a=s.attr:(o=GlobalConfig.HeirloomEquipConfig[i+1][1],a=o.attr);for(var r=0;6>r;r++)switch(a[r].type){case AttributeType.atAttack:this.desc0.text="攻击",this.attr0.text="+"+a[r].value;break;case AttributeType.atMaxHp:this.desc1.text="生命",this.attr1.text="+"+a[r].value;break;case AttributeType.atDef:this.desc2.text="物防",this.attr2.text="+"+a[r].value;break;case AttributeType.atRes:this.desc3.text="法防",this.attr3.text="+"+a[r].value;break;case AttributeType.atCrit:case AttributeType.atCritHurt:this.desc4.text="暴击",this.attr4.text="+"+a[r].value;break;case AttributeType.cruNeiGong:case AttributeType.maxNeiGong:this.desc5.text="内功",this.attr5.text="+"+a[r].value}var l=s.slot?s.slot:o.slot,h="";switch(l){case 1:h="武器";break;case 2:h="头盔";break;case 3:h="衣服";break;case 4:h="项链";break;case 5:h="手镯";break;case 6:h="腰带";break;case 7:h="戒指";break;case 8:h="鞋子"}var u=s.attr_add?s.attr_add:o.attr_add;this.desc6.text=h+"部件所有属性",this.attr6.text="+"+u+"%",this.attr6.x=this.desc6.x+this.desc6.width+20},e.prototype.setCost=function(t,i,n){var s;if(t==e.Heir_Init){if(i>0)return;s=n}else if(t==e.Heir_Select){if(this.curIndex!=i)return;s=n}else t==e.Heir_LRBtn&&(s=this.getInitInfo());var o;if(o=s.lv>0?GlobalConfig.HeirloomEquipConfig[s.slot][s.lv]:GlobalConfig.HeirloomEquipFireConfig[i+1]){var a=o.expend;if(this.expendLabel.text="消耗: ",!a)return this.expendLabel.text="",this.countLabel.text="已满级",void(this.jihuo.visible=!1);var r=GlobalConfig.ItemConfig[a.id];if(!r)return;this.icon.source=r.icon.toString()+"_png";var l=BagCT.ins().getBagItemById(a.id),h=l?l.count:0,u="";u=h>=a.count?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.countLabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+u+">"+h+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+a.count+"</font> ")}},e.prototype.check=function(t){var i,n=0,s=0;if(i=t.lv>0?GlobalConfig.HeirloomEquipConfig[t.slot][t.lv]:GlobalConfig.HeirloomEquipFireConfig[this.curIndex+1]){var o=i.expend;if(!o)return e.Heir_TIPS_2;var a=GlobalConfig.ItemConfig[o.id];if(!a)return e.Heir_TIPS_2;var r=BagCT.ins().getBagItemById(o.id);n=r?r.count:0,s=o.count}return n>=s?e.Heir_TIPS_1:e.Heir_TIPS_0},e.prototype.getInitInfo=function(t){var e=null!=t?t:this.curIndex,i=this.currentRoleIndex||0,n=SubRoles.ins().getSubRoleByIndex(i);return n.heirloom.getInfoBySolt(e)},e.prototype.getSlotInfoByLv=function(t,e){return GlobalConfig.HeirloomEquipConfig[t][e]},e.prototype.setSuitLvIcon=function(){for(var t=this.currentRoleIndex,e=SubRoles.ins().getSubRoleByIndex(t),i=e.heirloom.getData(),n=0,s=!0,o=0;o<i.length;o++){var a=i[o];0==o&&(n=a.lv),!a.lv&&s&&(s=!1),a.lv<=n&&(n=a.lv)}this.neatSet.currentState=n.toString()},e.prototype.setRedPoint=function(){for(var t=!1,e=0;8>e;e++){var i=this.getInitInfo(e),n=void 0;n=i.lv?GlobalConfig.HeirloomEquipConfig[i.slot][i.lv]:GlobalConfig.HeirloomEquipFireConfig[e+1];var s=0,o=0;if(n){var a=n.expend;if(!a||0==a.id&&0==a.count){this["pos"+e].redPoint.visible=!1;continue}var r=BagCT.ins().getBagItemById(a.id);s=r?r.count:0,o=a.count}if(this["pos"+e].redPoint.visible=s>=o,!this["pos"+e].redPoint.visible){var l=GlobalConfig.HeirloomEquipItemConfig[n.slot],r=BagCT.ins().getBagItemById(l.item);this["pos"+e].redPoint.visible=!!r}t||(t=this["pos"+e].redPoint.visible)}},e.prototype.setPower=function(){var t=this.currentRoleIndex,e=SubRoles.ins().getSubRoleByIndex(t).hlPower;this.powerPanel.setPower(e)},e.Heir_Init=1,e.Heir_Select=2,e.Heir_LRBtn=3,e.Heir_TIPS_0=0,e.Heir_TIPS_1=1,e.Heir_TIPS_2=2,e}(BaseView);__reflect(HeirloomPanel.prototype,"HeirloomPanel"),window.HeirloomPanel=HeirloomPanel;var HeirloomSkillItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="heirloomTipsSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2];this.addTouchEndEvent(this,this.onClick),this.setData(i,n,s)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t,e,i){this.itemIcon.setSkillData(t),this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(e),this.description.textFlow=TextFlowMaker.generateTextFlow1(i)},e}(BaseEuiView);__reflect(HeirloomSkillItem.prototype,"HeirloomSkillItem"),ViewManager.ins().reg(HeirloomSkillItem,LayerManager.UI_Popup),window.HeirloomSkillItem=HeirloomSkillItem;var HeirloomSuit=function(t){function e(){var e=t.call(this)||this;return e.skinName="heirloomSuit",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.model1=new MovieClip,this.model1.x=this.eff1.x,this.model1.y=this.eff1.y,this.eff1.parent.addChild(this.model1),this.model2=new MovieClip,this.model2.x=this.eff2.x,this.model2.y=this.eff2.y,this.eff2.parent.addChild(this.model2)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onClick);var i=t[0];this.curRole=SubRoles.ins().getSubRoleByIndex(i),this.setData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this),DisplayUtils.removeFromParent(this.model1),DisplayUtils.removeFromParent(this.model2),this.model1=null,this.model2=null},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(){var t=this.curRole.heirloom.getData();if(!t)return null;var e=this.getMinEquipLv(t),i=this.getInfoMation(t,e);this.setCurSuit(e,i.str1,i.lv1),this.setNextSuit(e,i.str2,i.lv2)},e.prototype.setCurSuit=function(t,e,i){if(!t){for(var n=0;8>n;n++)this["desc"+n].visible=!1,this["attr"+n].visible=!1;return this.informationname0.visible=!1,this.num0.visible=!1,void(this.name0.text="当前没有激活套装效果")}this.informationname0.textFlow=TextFlowMaker.generateTextFlow(e);for(var s=t?t:1,o=GlobalConfig.HeirloomEquipSetConfig[s],n=0;n<o.attr.length;n++){var a=o.attr[n];8>i&&(this["attr"+n].textColor=ColorUtil.GRAY_COLOR2,this["desc"+n].textColor=ColorUtil.GRAY_COLOR2),this["desc"+n].text=this.getAttrName(a.type);var r=a.value;a.type==AttributeType.atCritEnhance&&(r+=15e3);var l="+"+r;n>=4&&(r/=100,l="+"+r+"%"),this["attr"+n].text=l,this["attr"+n].x=this["desc"+n].x+this["desc"+n].width}for(var n=o.attr.length;8>n;n++)this["cgroup"+n].visible=!1;this.name0.text=o.name,this.num0.text="（"+i+"/8）",this.model1.playFile(RES_DIR_EFF+o.neff,-1)},e.prototype.setNextSuit=function(t,e,i){this.informationname1.textFlow=TextFlowMaker.generateTextFlow(e);var n=t?t+1:1,s=GlobalConfig.HeirloomEquipSetConfig[n];if(s){for(var o=0;o<s.attr.length;o++){var a=s.attr[o];this["ndesc"+o].text=this.getAttrName(a.type);var r=a.value;a.type==AttributeType.atCritEnhance&&(r+=15e3);var l="+"+r;o>=4&&(r/=100,l="+"+r+"%"),this["nattr"+o].text=l,this["nattr"+o].x=this["ndesc"+o].x+this["ndesc"+o].width}for(var o=s.attr.length;8>o;o++)this["ngroup"+o].visible=!1;this.name1.text=s.name,this.num1.text="（"+i+"/8）",this.model2.playFile(RES_DIR_EFF+s.neff,-1)}else{this.name1.text="没有下级可预览",this.num1.visible=!1,this.informationname1.visible=!1;for(var o=0;8>o;o++)this["ngroup"+o].visible=!1}},e.prototype.getInfoMation=function(t,e){for(var i="",n="",s=0,o=0,a=e?e+1:1,r=0;r<t.length;r++){var l=t[r],h=HeirloomData.getEquipName(r);l.lv?(l.lv>=e?(s++,i+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+h+"|   "):i+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"|   ",l.lv>=a?(o++,n+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+h+"|   "):n+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"|   "):(i+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"|   ",n+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"|   ")}return{str1:i,str2:n,lv1:s,lv2:o}},e.prototype.getMinEquipLv=function(t){for(var e=0,i=!0,n=0;n<t.length;n++){var s=t[n];0==n&&(e=s.lv),!s.lv&&i&&(i=!1),s.lv<=e&&(e=s.lv)}if(!i)for(var n=0;8>n;n++)this["desc"+n].textColor=ColorUtil.GRAY_COLOR2,this["attr"+n].textColor=ColorUtil.GRAY_COLOR2;return e},e.prototype.getAttrName=function(t){var e="";switch(t){case AttributeType.atAttack:e="攻击";break;case AttributeType.atMaxHp:e="生命";break;case AttributeType.atDef:e="物防";break;case AttributeType.atRes:e="魔防";break;case AttributeType.atRoleDamageEnhance:e="攻击玩家伤害加深";break;case AttributeType.atRoleDamageReduction:e="受到玩家伤害减免";break;case AttributeType.atCritEnhance:e="暴击伤害加强";break;case AttributeType.atPenetrate:e="穿透（无视防御）"}return e},e}(BaseEuiView);__reflect(HeirloomSuit.prototype,"HeirloomSuit"),ViewManager.ins().reg(HeirloomSuit,LayerManager.UI_Popup),window.HeirloomSuit=HeirloomSuit;var ThunderBoostTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ThunderBoostTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this.bgClose,this.onClick),this.roleIndex=t[0];var i=WingCT.ins().getGodWing(this.roleIndex).getSuitLevel(),n=0;if(i&&(n=WingCT.ins().getNextLevel(i)),this.gwsConfig=GlobalConfig.GodWingSuitConfig[i],!this.gwsConfig)for(var s in GlobalConfig.GodWingSuitConfig){this.gwsConfig=GlobalConfig.GodWingSuitConfig[s];break}i?(this.nextConfig=GlobalConfig.GodWingSuitConfig[n],this.nextConfig?this.currentState="active":this.currentState="max"):this.currentState="unactive",this.validateNow(),this.updateDesc()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onClick=function(){ViewManager.ins().close(this)},e.prototype.updateDesc=function(){this.setCurDesc(),this.setNextDesc()},e.prototype.setCurDesc=function(){if("unactive"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100),e=WingCT.GodWingMaxSlot,i=WingCT.ins().getGodWing(this.roleIndex).getSuitSum();this.content0.text="激活条件：全部神羽1阶可激活（"+i+"/"+e+"）\n激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else if("max"==this.currentState){var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}else{var t=Math.floor(this.gwsConfig.precent/100);this.content0.text="激活属性：翅膀全属性+"+t+"%",this.name0.text=this.gwsConfig.suitname}},e.prototype.setNextDesc=function(){if("active"==this.currentState){for(var t=Math.floor(this.nextConfig.precent/100),e=WingCT.GodWingMaxSlot,i=WingCT.ins().calcGodWingSlot(this.roleIndex),n=0,s=0;s<i.length;s++)i[s].level>=this.nextConfig.lv&&n++;var o=GlobalConfig.GodWingLevelConfig[this.nextConfig.lv][1],a=GlobalConfig.GodWingItemConfig[o.itemId].showlv;this.content1.text="激活条件：全部神羽"+a+"阶可激活（"+n+"/"+e+"）\n激活属性：翅膀全属性+"+t+"%",this.name1.text=this.nextConfig.suitname}},e}(BaseEuiView);__reflect(ThunderBoostTipsWin.prototype,"ThunderBoostTipsWin"),ViewManager.ins().reg(ThunderBoostTipsWin,LayerManager.UI_Popup),window.ThunderBoostTipsWin=ThunderBoostTipsWin;var ThunderBoostWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.indexInfo=[],e.isPlaying=!1,e._sn_="ThunderBoostSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleSelect.setCurRole(t[0]),this.observe(EquipCT.ins().postThunderEquipLv,this.updateView),this.observe(BagCT.ins().postItemDel,this.updateView),this.updateView(1)},e.prototype.skinComplete=function(){for(var t=0;8>t;t++){var e=this["eff_"+t];if(this.indexInfo[t]=[e.x,e.y,e.scaleX,e.scaleY,e.alpha],!this["fnt"+t]){this["fnt"+t]=new eui.BitmapLabel,this["fnt"+t].font="kuangdongfont_fnt",this["fnt"+t].horizontalCenter=1,this["fnt"+t].y=80;new eui.BitmapLabel;e.addChild(this["fnt"+t])}}this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this.getItemTxt,this.onClick),this.addTouchEvent(this.upGradeBtn,this.onClick),this.addChangeEvent(this.roleSelect,this.switchRole)},e.prototype.updateView=function(t){if(void 0===t&&(t=0),t)this.doUpdate();else{this.isPlaying=!0;var e=new MovieClip;e.scaleX=1.5,e.scaleY=1.5,e.x=55,e.y=10,this["eff_"+this.nowEquipIndex].addChild(e),e.playFile(RES_DIR_EFF+"pulse8",1),this.moveEquip()}},e.prototype.moveEquip=function(){for(var t=0;8>t;t++){var e=this["eff_"+t],i=egret.Tween.get(e),n=(this.nowEquipIndex+1>7?0:this.nowEquipIndex+1)-t,s=0>n?8+n:n;i.to({x:this.indexInfo[s][0],y:this.indexInfo[s][1],scaleX:this.indexInfo[s][2],scaleY:this.indexInfo[s][3],alpha:this.indexInfo[s][4]},500).call(this.doUpdate,this)}},e.prototype.doUpdate=function(){for(var t=Heirloom.ins().thunderBoostDo(this.roleSelect.getCurRole()),e=EquipCT.ins().thunderEquipLv[this.roleSelect.getCurRole()],i=0;8>i;i++){var n=e[i]||0;this["fnt"+i].text=n+""}this.redPoint.visible=t.boostRed;var s=GlobalConfig.LeitingEquipSlotConf;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1(""+(t.boostRed?"|C:0x00ff00&T:":"|C:0xff0000&T:")+t.itemCount+"|C:0xD1C28F&T:/"+t.costCount),this.costGroup.visible=s[t.minLv+1]&&s[t.minLv+1].consume>0,this.upGradeBtn.visible=this.costGroup.visible,this.maxDesc.visible=!this.upGradeBtn.visible;for(var o=AttributeData.getAttrFromCfg(s[t.minLv]),a=s[t.minLv+1]?AttributeData.getAttrFromCfg(s[t.minLv+1]):null,i=0;4>i;i++){this["attr"+i].text="",this["addAttr"+i].text="";var r=!1;o[i]&&(this["attr"+i].text=AttributeData.getAttStrByType1(o[i]),a&&a[i].value>o[i].value&&(r=!0,this["addAttr"+i].text=a[i].value)),this["arrow"+i].visible=r}for(var l=0,i=0;8>i;i++){var h=t.minLvI-i,u=0>h?8+h:h,p=this.indexInfo[u],c=this["eff_"+i];c.x=p[0],c.y=p[1],c.scaleX=p[2],c.scaleY=p[3],c.alpha=p[4],this["point_"+i+"g"].visible=i==t.minLvI;var d=e[i];d&&(l+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(s[d])))}this.equipname.text=this["name"+t.minLvI].text,this.powerPanel.setPower(l),this.nowEquipIndex=t.minLvI,this.isPlaying=!1,Heirloom.ins().thunderBoostElse().length?(this.mc||(this.mc=new MovieClip,this.mc.scaleX=.7,this.mc.scaleY=.7,this.getItemEff.addChild(this.mc)),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.mc),this.mcCenter||(this.mcCenter=new MovieClip,this.mcCenter.scaleX=.8,this.mcCenter.scaleY=.8,this.centerPic.addChild(this.mcCenter)),this.mcCenter.playFile(RES_DIR_EFF+("lt"+(this.nowEquipIndex>9?this.nowEquipIndex:"0"+this.nowEquipIndex)),-1)},e.prototype.switchRole=function(){this.updateView(1)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.getItemTxt:ViewManager.ins().open(BreakDownView,BreakDownView.type_thunder,ThunderEquipPanel.TYPE);break;case this.upGradeBtn:if(this.isPlaying)break;if(!this.redPoint.visible){TipsCT.ins().showTips("材料不足");break}EquipCT.ins().sendThunderLv(this.roleSelect.getCurRole(),this.nowEquipIndex)}},e.prototype.close=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ThunderBoostWin.prototype,"ThunderBoostWin"),ViewManager.ins().reg(ThunderBoostWin,LayerManager.UI_Main),window.ThunderBoostWin=ThunderBoostWin;var ThunderChooseEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e.roleSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="ThunderChooseEquipSkin",this.list.itemRenderer=ThunderEquipChooseItem,this.wearItem=new ThunderEquipChooseItem,this.itemGroup.addChild(this.wearItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleSelect=t[0],this.pos=t[1];var i=SubRoles.ins().getSubRoleByIndex(this.roleSelect),n=i.thunderData[this.pos];this.wearItem.setUpImage(!1),this.wearItem.data=n,this.wearItem.setBtnStatu();var s=0;if(n&&0!=n.configID){this.scroll.y=170,this.scroll.height=400,this.wearItem.visible=!0,s=n.point;var o=0==ItemUtil.getJob(n.itemConfig)?i.job:ItemUtil.getJob(n.itemConfig);BagCT.ins().setEquipPowerDic(o,ItemUtil.getSubType(n.itemConfig),s)}else this.scroll.y=50,this.scroll.height=520,this.wearItem.visible=!1;this.itemList=BagCT.ins().getThundersByPos(this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.validateNow(),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this,this.itemTap)},e.prototype.itemTap=function(t){if("changeBtn"==t.target.name){var e=t.target.parent.data;if(e&&e instanceof ItemData){var i=Actor.level,n=ZsCT.ins().lv;if(e.itemConfig&&(n<(e.itemConfig.zsLevel||0)||i<(e.itemConfig.level||1)))return void TipsCT.ins().showTips("|C:0xF3311E&T:等级不足，无法穿戴|");EquipCT.ins().sendThunderWear(e.handle,this.pos,this.roleSelect),ViewManager.ins().close(this)}}},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ThunderChooseEquipWin.prototype,"ThunderChooseEquipWin"),ViewManager.ins().reg(ThunderChooseEquipWin,LayerManager.UI_Popup),window.ThunderChooseEquipWin=ThunderChooseEquipWin;var ThunderComposeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ThunderComposeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currRoleIndex=t[0]||0,this.itemIcons=[this.itemIconNext3,this.itemIconNext2,this.itemIconNext1,this.itemIconNext4],this.itemLabs=[this.nextName3,this.nextName2,this.nextName1,this.nextName4];for(var i in this.itemIcons)this.addTouchEvent(this.itemIcons[i],this.onClick);this.addTouchEvent(this.itemIconCost0,this.onClick),this.addTouchEvent(this.itemIconCost1,this.onClick),this.addTouchEvent(this.itemIconNext0,this.onClick),this.addTouchEvent(this.soulBtn,this.onClick),this.observe(EquipCT.ins().postThunderEquipUpdate,this.updateView),this.observe(EquipCT.ins().postThunderEquipLv,this.updateView),this.observe(ThunderRedPoint.ins().postRoleRedPoint,this.updateRed),this.changeSelect(8),this.initView(),this.updateRed()},e.prototype.updateRed=function(){this.redPoint1.visible=ThunderRedPoint.ins().getComposeItemPoints(this.currRoleIndex,8),this.redPoint2.visible=ThunderRedPoint.ins().getComposeItemPoints(this.currRoleIndex,9),this.redPoint3.visible=ThunderRedPoint.ins().getComposeItemPoints(this.currRoleIndex,10),this.redPoint4.visible=ThunderRedPoint.ins().getComposeItemPoints(this.currRoleIndex,11),this.redPoint.visible=ThunderRedPoint.ins().composeItemPoints[this.currRoleIndex][this.select]||!1},e.prototype.onClick=function(t){switch(t.target){case this.itemIconNext3:this.changeSelect(8);break;case this.itemIconNext2:this.changeSelect(9);break;case this.itemIconNext1:this.changeSelect(10);break;case this.itemIconNext4:this.changeSelect(11);break;case this.itemIconCost0:if(this.itemIconCost0.config){var e=ItemUtil.getSubType(this.itemIconCost0.config);ViewManager.ins().open(ThunderEquipTipsWin,0,e,this.itemIconCost0.config.id)}break;case this.itemIconCost1:if(this.itemIconCost1.config){var e=ItemUtil.getSubType(this.itemIconCost1.config);ViewManager.ins().open(ThunderEquipTipsWin,this.currRoleIndex,e)}break;case this.itemIconNext0:if(this.itemIconNext0.config){var e=ItemUtil.getSubType(this.itemIconNext0.config);ViewManager.ins().open(ThunderEquipTipsWin,0,e,this.itemIconNext0.config.id)}break;case this.soulBtn:if(this.itemIconCost0.config)if(this.isEnough){var e=ItemUtil.getSubType(this.itemIconNext0.config);EquipCT.ins().sendThunderExtraLv(this.currRoleIndex,e)}else TipsCT.ins().showTips("材料不足");else TipsCT.ins().showTips("未穿着，不能融合")}},e.prototype.initView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.currRoleIndex);if(!t)return[];for(var e=t.thunderData,i=8;12>i;i++){var n=this.itemIcons[i-8],s=this.itemLabs[i-8],o=e[i];s.text=o.itemConfig?o.itemConfig.name:"",this.setItemIcon(n,o.itemConfig,i)}},e.prototype.changeSelect=function(t){this.select!=t&&(this.select=t,this.updateView(),this.redPoint.visible=ThunderRedPoint.ins().composeItemPoints[this.currRoleIndex][this.select]||!1)},e.prototype.setItemIcon=function(t,e,i){void 0===i&&(i=0);var n=GlobalConfig.LeitingEquipConf;if(t.imgJob.source="",e){if(!t.mc){var s=t.mc=new MovieClip;s.x=39,s.y=38,s.playFile(RES_DIR_EFF+"leitkuang",-1),t.addChild(s)}if(!t.equipStar){var o=t.equipStar=new eui.Image;t.addChild(o),o.left=5,o.top=5}t.equipStar.source="leit"+n[e.id].level+"x",t.setData(e),t.imgBg.source="quality6"}else t.setData(null),t.mc&&(DisplayUtils.removeFromParent(t.mc),t.mc=null),t.equipStar&&(DisplayUtils.removeFromParent(t.equipStar),t.equipStar=null),0!=i&&(t.imgIcon.source="lt"+(i>9?i:"0"+i))},e.prototype.updateView=function(){this.initView();var t=SubRoles.ins().getSubRoleByIndex(this.currRoleIndex);if(!t)return[];var e=t.thunderData,i=this.select;this.isEnough=!1;var n;if(n=e[i],this.numInfo1.textFlow=TextFlowMaker.generateTextFlow1("|C:0xff0000&T:未穿戴装备"),this.numInfo0.textFlow=TextFlowMaker.generateTextFlow1(""),n&&n.itemConfig){this.setItemIcon(this.itemIconCost1,n.itemConfig,i),this.powerPanel0.setPower(n.point),this.costName1.text=n.itemConfig.name;var s=SubRoles.ins().getSubRoleByIndex(this.currRoleIndex);this.attr0.text=AttributeData.getAttrInfoByItemData(n,s);var o=GlobalConfig.LeitingEquipConf,a=GlobalConfig.LeitingEquipTrimConf[i][o[n.configID].level+1];if(a&&a.consume){var r=GlobalConfig.ItemConfig[a.consume.id];this.costName0.text=r.name,this.setItemIcon(this.itemIconCost0,r,i);var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_EQUIP,a.consume.id);this.numInfo1.textFlow=TextFlowMaker.generateTextFlow1("穿戴中"),this.numInfo0.textFlow=TextFlowMaker.generateTextFlow1(""+(l>=a.consume.count?"|C:0x00ff00&T:":"|C:0xff0000&T:")+l+"|C:0xD1C28F&T:/"+a.consume.count),this.isEnough=l>=a.consume.count;var h=GlobalConfig.ItemConfig[a.toid];this.setItemIcon(this.itemIconNext0,h,i),this.nextName0.text=h.name;var u=new ItemData;u.init(),u.configID=h.id,this.powerPanel1.setPower(u.point),this.attr1.text=AttributeData.getAttrInfoByItemData(u,s)}else this.costName0.text="",this.setItemIcon(this.itemIconCost0,null,i),this.attr1.text="",this.powerPanel1.setPower(0),this.setItemIcon(this.itemIconNext0,null,i),this.nextName0.text="",this.numInfo1.textFlow=TextFlowMaker.generateTextFlow1("穿戴中")}else this.attr0.text="",this.attr1.text="",this.powerPanel0.setPower(0),this.powerPanel1.setPower(0),this.setItemIcon(this.itemIconCost0,null,i),this.costName0.text="",this.setItemIcon(this.itemIconCost1,null,i),this.costName1.text="",this.setItemIcon(this.itemIconNext0,null,i),this.nextName0.text="";this.failtext.visible=!(n&&n.itemConfig),this.soulBtn.enabled=this.isEnough,this.soulBtn.visible=!this.failtext.visible},__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(ThunderComposeWin.prototype,"ThunderComposeWin"),window.ThunderComposeWin=ThunderComposeWin,ViewManager.ins().reg(ThunderComposeWin,LayerManager.UI_Main);var ThunderEquipChooseItem=function(t){function e(){var e=t.call(this)||this;return e.showUpimage=!0,e.skinName="RoleChooseEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.itemConfig){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var t=this.data;this.itemIcon.setData(this.data.itemConfig),this.nameTxt.text=t.itemConfig.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.data.itemConfig);var e=BagCT.ins().getEquipAttrs(this.data),i=(GlobalConfig.EquipConfig[this.data.itemConfig.id],0),n=this.data.point+i;this.power.text="评分："+n;var s=ItemUtil.getSubType(this.data.itemConfig);this.upImg.x=this.power.x+this.power.textWidth+10;var o=Actor.level>=(this.data.itemConfig.level||1)&&ZsCT.ins().lv>=(this.data.itemConfig.zsLevel||0),a=o?"0x35E62D":"0xfe4444";this.levelStrText.text="等级:";var r=isNaN(this.data.itemConfig.zsLevel)?(this.data.itemConfig.level||1)+"级":this.data.itemConfig.zsLevel+"转";this.levelText.textFlow=TextFlowMaker.generateTextFlow("|C:"+a+"&T:"+r+"|");var l=0;if(this.now.visible=!this.showUpimage,this.data.itemConfig.job)l=ItemUtil.getJob(this.data.itemConfig);else{var h=ViewManager.ins().getView(ThunderChooseEquipWin),u=h.roleSelect,p=SubRoles.ins().getSubRoleByIndex(u);l=p.job}var c=BagCT.ins().getEquipPowerDic(l,s);if(n>c&&this.showUpimage&&o){this.upImg.visible=!0;var d=egret.Tween.get(this.upImg,{loop:!0});d.to({y:this.upImg.y-3},250).to({y:this.upImg.y+3},250)}else this.upImg.visible=!1;0==this.itemIndex&&this.showUpimage&&o&&n>c?(this.best.visible=!0,this.best.x=this.upImg.x+this.upImg.width+9):this.best.visible=!1;for(var g="",f=0;f<e.length;f++)if(0!=e[f].type&&0!=e[f].value){var v=AttributeData.getAttrNameByAttrbute(e[f],!0);g+=v+"\n"}this.attr1.textFlow=(new egret.HtmlTextParser).parser(g),ZsCT.ins().lv<(this.data.itemConfig.zsLevel||0)||Actor.level<(this.data.itemConfig.level||1)?this.changeBtn.visible=!1:this.changeBtn.visible=!0}},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.Tween.removeTweens(this.upImg)},e.prototype.setUpImage=function(t){this.showUpimage=t},e.prototype.setBtnStatu=function(){this.changeBtn.visible=!1,this.now.visible=!0},e}(eui.ItemRenderer);__reflect(ThunderEquipChooseItem.prototype,"ThunderEquipChooseItem"),window.ThunderEquipChooseItem=ThunderEquipChooseItem;var ThunderEquipPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lockImages=[],e}return __extends(e,t),e.prototype.skinComplete=function(){this.highLight=new eui.Image},e.prototype.addDisplay=function(){this.currEquipIndex=0,this.addTouchEvent(this.leizhu_entry,this.onClick),this.addTouchEvent(this.neatSet,this.onClick),this.addTouchEvent(this.centerPic,this.onClick),this.addTouchEvent(this.upGradeBtn,this.onClick),this.addTouchEvent(this.eMergeBtn,this.onClick),this.observe(EquipCT.ins().postThunderEquipUpdate,this.updateView),this.observe(EquipCT.ins().postThunderEquipLv,this.updateView),this.observe(EquipCT.ins().postThunderAwakeLevel,this.updateView),this.observe(ThunderRedPoint.ins().postRedPoint,this.updateView),this.firstUpdate=!0,this.updateView()},e.prototype.getThundersByRoleId=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);return e?e.thunderData:[]},e.prototype.cleanEff=function(t){this["mc"+t]&&(DisplayUtils.removeFromParent(this["mc"+t]),this["mc"+t]=null),this["equipStar"+t]&&(DisplayUtils.removeFromParent(this["equipStar"+t]),this["equipStar"+t]=null)},e.prototype.updateView=function(){this.totalPower=0,this.redPoint0.visible=ThunderRedPoint.ins().composePoint[this.currRoleIndex];var t=this.getThundersByRoleId(this.currRoleIndex);this.redList=Heirloom.ins().thunderEquipRedList(this.currRoleIndex);for(var e,i=!1,n=GlobalConfig.LeitingEquipConf,s=!1,o=GlobalConfig.LeitingEquipBaseConf.towerUnlock,a=0;a<o.length;a++)EquipCT.ins().thunderUnlockIndex[o[a][1]]||(this["equip"+o[a][1]].unlockN=o[a][0],(!e||o[a][0]<e[0])&&(e=o[a]));this.nowMinLevel=0;for(var a=0;12>a;a++){var r=t[a],l=this["equip"+a],h=l.itemIcon;if(this.firstUpdate&&(l.name=""+a,h.imgJob.visible=!1,this.lockImages[a]||(this.lockImages[a]=new eui.Image,this.lockImages[a].source="ltsuo",l.addChild(this.lockImages[a])),this.addTouchEvent(l,this.onClick)),l.level.text="",l.plus.text="",EquipCT.ins().thunderUnlockIndex[a])if(r.configID){this["equipStar"+a]||(this["equipStar"+a]=new eui.Image,l.addChildAt(this["equipStar"+a],2),this["equipStar"+a].left=5,this["equipStar"+a].top=5);var u=EquipCT.ins().thunderEquipLv[this.currRoleIndex][a];u&&(l.plus.text="+"+u),this["equipStar"+a].source="leit"+n[r.configID].level+"x",h.imgIcon.source=GlobalConfig.ItemConfig[r.configID].icon+"_png",h.imgBg.source="quality6",l.level.text=r.itemConfig.name,this["mc"+a]||(this["mc"+a]=new MovieClip,this["mc"+a].x=39,this["mc"+a].y=38,l.addChildAt(this["mc"+a],1)),this["mc"+a].playFile(RES_DIR_EFF+"leitkuang",-1),this.totalPower+=r.point,8>a&&(this.nowMinLevel?this.nowMinLevel=Math.min(n[r.configID].level,this.nowMinLevel):this.nowMinLevel=n[r.configID].level)}else h.imgIcon.source="lt"+(a>9?a:"0"+a),this.cleanEff(a),8>a&&(s=!0);else 8>a&&(s=!0),h.imgIcon.source="lt"+(a>9?a:"0"+a),this.cleanEff(a);if(l.redPoint.visible=!!this.redList[a]||null!=r.itemConfig&&ThunderRedPoint.ins().awakeItemPoints[this.currRoleIndex][a],this.lockImages[a].visible=!EquipCT.ins().thunderUnlockIndex[a],l.select.visible=this.currEquipIndex==a,8>a){var p=EquipCT.ins().thunderEquipLv[this.currRoleIndex][a];p&&(this.totalPower+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(GlobalConfig.LeitingEquipSlotConf[p]))),i||(i=!!this.redList[a])}}if(this.lockText||(this.lockText=new eui.Label,this.equipGroup.addChildAt(this.lockText,0),this.addTouchEvent(this.lockText,this.onClick)),e){var c=this["equip"+e[1]];
this.lockText.textFlow=(new egret.HtmlTextParser).parser("<u><font color='#00ff00' size=18>雷霆塔"+e[0]+"层解锁</font></u>"),this.lockText.right=c.right,this.lockText.y=c.y+80}else this.lockText.text="";s&&(this.nowMinLevel=0),i?(this.btnMcGroup.visible=!0,this.mcBtn||(this.mcBtn=new MovieClip,this.mcBtn.x=63,this.mcBtn.y=23,this.mcBtn.scaleX=.8,this.mcBtn.scaleY=.8,this.btnMcGroup.addChild(this.mcBtn)),this.mcBtn.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):this.btnMcGroup.visible=!1;for(var d=GlobalConfig.LeitingEquipStarSuitConf,g=this.nowMinLevel<3?3:this.nowMinLevel,f=d[g][8].skill,a=0;3>a;a++){var v=this["skill_"+a];v.name=a+"",this["skill"+a].source=1e3*Math.floor(f[a][0]/1e3)+"_png",this["blackImg"+a].visible=this.nowMinLevel<f[a][1],this.firstUpdate&&this.addTouchEvent(v,this.onClick)}this.updateElse(),this.firstUpdate=!1},e.prototype.updateElse=function(){this.totalPower+=Heirloom.ins().getThunderSuitPower(this.currRoleIndex),this.powerPanel.setPower(this.totalPower),this.mc||(this.mc=new MovieClip,this.centerPic.addChild(this.mc)),this.mc.playFile(RES_DIR_EFF+("lt"+(this.currEquipIndex>9?this.currEquipIndex:"0"+this.currEquipIndex)),-1),this.redPoint.visible=Heirloom.ins().thunderBoostDo(this.currRoleIndex).ifRed},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.LeitingEquipBaseConf.levelUnlock;return 1e3*ZsCT.ins().lv+Actor.level<i?(TipsCT.ins().showTips("雷霆装备功能"+(i>=1e3?i/1e3+"转":i+"级")+"开启"),!1):!0},e.prototype.upgradBtn=function(){for(var t=this,e=0;8>e;e++)this.redList[e]&&EquipCT.ins().sendThunderWear(this.redList[e].handle,e,this.currRoleIndex);Timer.start(1e3,1,function(){t.btnMcGroup.visible&&t.upgradBtn()},this)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.eMergeBtn:ViewManager.ins().open(ThunderComposeWin,this.currRoleIndex);break;case this.upGradeBtn:this.upgradBtn();break;case this.neatSet:ViewManager.ins().open(ThunderSuitWin,this.currRoleIndex);break;case this.lockText:ViewManager.ins().open(FbWin,0,DailyFBPage.Page_Thundre);break;case this.leizhu_entry:ViewManager.ins().open(ThunderBoostWin,this.currRoleIndex);break;case this.skill_0:case this.skill_1:case this.skill_2:ViewManager.ins().open(ThunderSkillTipsWin,this.currRoleIndex,this.nowMinLevel,t.currentTarget.name);break;case this.centerPic:default:var e=this.currEquipIndex;if(this.centerPic!=t.currentTarget&&(this.currEquipIndex=+t.currentTarget.name),e==this.currEquipIndex)if(EquipCT.ins().thunderUnlockIndex[this.currEquipIndex])if(this.currEquipIndex<8)""==this["equip"+e].level.text&&this.redList[e]?ViewManager.ins().open(ThunderChooseEquipWin,this.currRoleIndex,e):ViewManager.ins().open(ThunderEquipTipsWin,this.currRoleIndex,e);else{var i=this.getThundersByRoleId(this.currRoleIndex)[e];""!=this["equip"+e].level.text||!this.redList[e]||i&&i.configID?ViewManager.ins().open(ThunderEquipTipsWin,this.currRoleIndex,e):EquipCT.ins().sendThunderWear(this.redList[e].handle,e,this.currRoleIndex)}else 8>e?TipsCT.ins().showTips("通关雷霆塔"+this["equip"+e].unlockN+"层解锁"):TipsCT.ins().showTips("开服第"+GlobalConfig.LeitingEquipBaseConf.opendayUnlock[e][1]+"天解锁");else this.updateView()}},e.prototype.setRoleId=function(t){this.currRoleIndex=t,this.skin&&this.updateView()},e.TYPE=26,__decorate([callDelay(100)],e.prototype,"updateView",null),e}(BaseView);__reflect(ThunderEquipPanel.prototype,"ThunderEquipPanel"),window.ThunderEquipPanel=ThunderEquipPanel;var log=egret.log,ThunderEquipTipsWin=function(t){function e(){var e=t.call(this)||this;return e.notMine=0,e.isOtherRole=!1,e.showGain=!1,e.skinName="thunderitemtips",e.gainList.itemRenderer=GainGoodsItem,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.roleIndex=t[0],this.equipIndex=t[1],this.data=t[2],this.role=t[3],this.isOtherRole=null!=this.role,this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.changeBtn,this.btnChange),this.addTouchEndEvent(this.offBtn,this.btnOff),this.showGain=!1,this.isOtherRole&&(this.offBtn.visible=this.changeBtn.visible=!1),this.showInfo()},e.prototype.showInfo=function(){var t;if(this.data){if(this.data.type&&(this.data=this.data.id),"[object Number]"==toString.apply(this.data)){t=new ItemData;var e=GlobalConfig.EquipConfig[this.data];t.att=[];for(var i in e)t.att.push({type:Role.getAttrTypeByName(AttributeData.translate[i]),value:e[i]});t.itemConfig=GlobalConfig.ItemConfig[this.data],t.configID=this.data,this.data=t}else t=this.data;this.notMine=t.configID,this.changeBtn.visible=!1,this.offBtn.visible=!1,this.attrs.text=AttributeData.getAttrInfoByItemData(t)}else{if(this.role||(this.role=SubRoles.ins().getSubRoleByIndex(this.roleIndex)),t=this.role.thunderData[this.equipIndex],!t.itemConfig){var n=this.creatItemData(this.equipIndex);n&&(t=n,this.changeBtn.visible=!1,this.offBtn.visible=!1,this.showGain=!0)}this.attrs.text=AttributeData.getAttrInfoByItemData(t,this.role);var s=Heirloom.ins().thunderEquipRedList(this.roleIndex),o=ItemUtil.getSubType(t.itemConfig);o>=8&&11>=o?(this.redPoint.visible=!1,this.redPoint1.visible=!1,this.offBtn.visible=!1,this.changeBtn.visible=!1):(this.redPoint.visible=!this.isOtherRole&&!this.showGain&&ThunderRedPoint.ins().awakeItemPoints[this.roleIndex][ItemUtil.getSubType(t.itemConfig)],this.redPoint1.visible=!this.isOtherRole&&!this.showGain&&!!s[ItemUtil.getSubType(t.itemConfig)])}this._bottomY=0,this._bottomY=this.attrs.y+this.attrs.height;var a=t.itemConfig;this.nameLabel.text=ThunderCT.getEquipName(a.id,ThunderCT.getThundersAwakeLv(this.role,ItemUtil.getSubType(a))),this.nameLabel.textColor=ItemUtil.getQualityColor(a);var r=ItemUtil.getQuality(a);if(this.quali.source=r>0?"quali"+r:"",this.score.text="评分："+ThunderCT.calculateThunderItemScore(t,this.role),this.itemIcon.setData(a),this.type.text=ThunderCT.equipNames[this.equipIndex],this.lv.text=a.zsLevel+"转",this.career.text="通用",this.addTips(t.extAtt,"extAtt"),this.equipIndex<8)if(this.showGain&&this.addTips([],"extAtt2"),this.notMine)t.extAtt||this.addTips([],"extAtt3"),this.powerPanel.setPower(t.point);else{var l=void 0;l=this.isOtherRole?AttributeData.getAttrFromCfg(GlobalConfig.LeitingEquipSlotConf[this.role.thunderEquipLv[this.equipIndex]]):AttributeData.getAttrFromCfg(GlobalConfig.LeitingEquipSlotConf[EquipCT.ins().thunderEquipLv[this.roleIndex][this.equipIndex]]),this.addTips(l,"lvAtt");var h=ThunderCT.getThundersAwakeLv(this.role,ItemUtil.getSubType(t.itemConfig));if(h>0){var n=new AttributeData;n.type=t.itemConfig.id,n.value=h,this.addTips([n],"awakeLv")}this.powerPanel.setPower(ThunderCT.calculateThunderItemScore(t,this.role))}else this.powerPanel.setPower(t.point),this.addTips([],"extra"),this.notMine||(this.offBtn.visible=!1,this.changeBtn.visible=!1);this.updateGain(t.configID),this.gainListGroup.y=210+this._bottomY,this.bgGroup.y=this.gainListGroup.y+(this.showGain?this.gainListGroup.height+10:0)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);if(i){var n=!0;if("Recharge2Win"==e[1]){var s=Recharge.ins().getRechargeData(0);s&&0!=s.num||(n=!1,ViewManager.ins().open(Recharge1Win))}n&&""!=e[1]&&GameGuider.guidance(e[1],e[2],e[3]),ViewManager.ins().close(this)}}},e.prototype.updateGain=function(t){if(this.gainListGroup.visible=this.showGain,this.showGain){var e=GlobalConfig.GainItemConfig[t];e?this.gainList.dataProvider=new eui.ArrayCollection(e.gainWay):this.gainList.dataProvider=new eui.ArrayCollection([]),this.gainList.validateNow()}},e.prototype.creatItemData=function(t){for(var e in GlobalConfig.LeitingEquipConf)if(GlobalConfig.LeitingEquipConf[e].slot==t){var i=e,n=new ItemData;return n.init(),n.configID=+i,n}return null},e.prototype.addTips=function(t,e){if(t){var i=new eui.Label;i.size=20,i.bold=!0,i.x=24,i.y=this._bottomY-10,i.touchEnabled=!1,this.forgeGroup.addChild(i);var n=new eui.Label;n.size=18,n.lineSpacing=8,n.x=46,n.y=i.y+24,n.touchEnabled=!1,this.forgeGroup.addChild(n);var s="";switch(e){case"extra":var o=GlobalConfig.LeitingEquipConf,a=[],r=void 0;if(this.notMine)a[this.equipIndex]=1,r=o[this.notMine].level;else{r=this.role.thunderData[this.equipIndex].itemConfig?o[this.role.thunderData[this.equipIndex].configID].level:3;for(var l=8;12>l;l++){var h=this.role.thunderData[l];h.configID&&o[h.configID].level>=r&&(a[l-8]=1)}}i.textFlow=(new egret.HtmlTextParser).parser("<font color='#FCF537'>雷霆·内饰套装"+r+'★</font><font color="'+(4==Object.keys(a).length?"#04FE2A":"#ff0000")+'">('+Object.keys(a).length+"/4)</font>");for(var u=["面具","护肩","护膝","吊坠"],l=0;4>l;l++)s+=' <font color="'+(a[l]?"#04FE2A":"#ff0000")+'">'+u[l]+"</font> ";s+='\n<font color="'+(4==Object.keys(a).length?"#04FE2A":"#9f946d")+'">',u=["雷霆之刃","雷霆之盔","雷霆之甲","雷霆之链","雷霆之腕","雷霆之带","雷霆之戒","雷霆之靴"];for(var p=Math.floor(100*GlobalConfig.LeitingEquipBaseConf.trimSuitAttrAdd[r-3][1]/1e4),l=0;8>l;l++)s+=u[l]+"基础属性+"+p+"%\n";s+="</font>",n.textFlow=(new egret.HtmlTextParser).parser(s);break;case"lvAtt":i.text="雷铸属性",i.textColor=16577847,n.textColor=15054355;for(var l=0;l<t.length;l++)t[l].value&&(s+=AttributeData.getAttStrByType1(t[l])+"\n");n.text=s;break;case"extAtt":i.text="元素属性",i.textColor=13779707;for(var c=GlobalConfig.LeitingEquipEffConf,l=0;l<t.length;l++)if(t[l].value){var d=c[t[l].type].desc,g=t[l].value,f=void 0;f=(2==this.equipIndex||0==this.equipIndex)&&2>l?"#ff750f":2e3>g?"#5186fd":5e3>g?"#d242fb":"#ff750f",s+='<font color="'+f+'">'+d.replace("d",g/100+"")+"</font>",l+1!=t.length&&(s+="\n")}n.textFlow=(new egret.HtmlTextParser).parser(s);break;case"extAtt2":i.text="元素属性",i.textColor=13779707,s+="<font color=0xd242fb>增加战士一项技能的伤害？？？\n增加法师一项技能的伤害？？？\n增加道士一项技能的伤害？？？\n</font>",n.textFlow=(new egret.HtmlTextParser).parser(s);break;case"extAtt3":var v=this.data.itemConfig.name.replace(/[^0-9]/gi,"");if(!v)break;0!=this.data.subType&&2!=this.data.subType&&(v-=2),i.text="元素属性",i.textColor=13253357;for(var l=0;v>l;l++)s+="<font color=0xca3aed>随机获得技能增强效果\n</font>";n.textFlow=(new egret.HtmlTextParser).parser(s);break;case"awakeLv":var y=t[0].value;i.text="雷神之怒Lv"+y,i.textColor=14316818;var m=GlobalConfig.LeiTingSoulLevel[t[0].type][y];s="为该部位注入雷霆之力，提升基础属性"+m.precent/100+"%",n.text=s,n.textColor=14316818}return""==s?void(i.text=""):void(this._bottomY=n.y+n.height)}},e.prototype.btnOff=function(){EquipCT.ins().sendThunderOff(this.roleIndex,this.equipIndex),ViewManager.ins().close(this)},e.prototype.btnChange=function(){ViewManager.ins().open(ThunderJueXingWin,this.roleIndex,this.equipIndex),ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ThunderEquipTipsWin.prototype,"ThunderEquipTipsWin"),ViewManager.ins().reg(ThunderEquipTipsWin,LayerManager.UI_Popup),window.ThunderEquipTipsWin=ThunderEquipTipsWin;var ThunderJueXingWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pos=0,e.roleSelect=0,e._sn_="ThunderJueXingSKin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.eBtn,this.onClick),this.addTouchEvent(this.eCloseRect,this.onClick),this.attrLabs=[this.attr0,this.attr1,this.attr2,this.attr3],this.arrows=[this.arrow0,this.arrow1,this.arrow2,this.arrow3],this.addAttrLabs=[this.addAttr0,this.addAttr1,this.addAttr2,this.addAttr3]},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleSelect=t[0],this.pos=t[1],this.role=SubRoles.ins().getSubRoleByIndex(this.roleSelect),this.initItems(),this.observe(EquipCT.ins().postThunderAwakeLevel,this.updateUI),this.updateElse(),this.update()},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:EquipCT.ins().sendThunderAwakeLevel(this.roleSelect,this.pos);break;case this.eCloseRect:ViewManager.ins().close(this)}},e.prototype.initItems=function(){this.itemIds=[];for(var t in GlobalConfig.LeitingEquipConf){var e=GlobalConfig.LeitingEquipConf[t];e.slot==this.pos&&this.itemIds.push(+t)}this.itemIds.sort(this.sort)},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t,e)},e.prototype.updateUI=function(){var t=this.role.thunderData,e=t[this.pos],i=ThunderCT.getThundersAwakeLv(this.role,this.pos),n=GlobalConfig.LeiTingSoulLevel[e.configID][i+1];if(this.eNameLab.text=ThunderCT.getEquipName(e.configID,i),this.eBtn.label=i>0?"觉醒":"激活",n){var s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.materialInfo.id);this.eBtn.enabled=s>=n.materialInfo.count;var o=this.eBtn.enabled?ColorUtil.GREEN:ColorUtil.RED,a='<font color="'+o+'">'+s+"</font>/"+n.materialInfo.count;this.eTips.textFlow=(new egret.HtmlTextParser).parser(a),this.eItemIcon.visible=!0,this.eItemIcon.source=n.materialInfo.id+"_png"}else this.eTips.text="",this.eBtn.enabled=!1,this.eItemIcon.visible=!1;this.redPoint.visible=this.eBtn.enabled,this.skilllv.text="lv."+i,this.powerPanel.setPower(ThunderCT.calculateThunderItemScore(e,this.role)),this.updateAttrData(e,i),this.updateSkill(e,i)},e.prototype.updateAttrData=function(t,e){for(var i=GlobalConfig.LeiTingSoulLevel[t.configID][e],n=GlobalConfig.LeiTingSoulLevel[t.configID][e+1],s=null==n,o=0;4>o;o++)i&&(this.attrLabs[o].text=AttributeData.getAttStrByType(i.attrs[o],.5)),s||(this.addAttrLabs[o].text=n.attrs[o].value+""),this.addAttrLabs[o].visible=this.arrows[o].visible=!s;this.addSkilltext.visible=this.eArrowGroup.visible=!s},e.prototype.updateSkill=function(t,e){for(var i="",n="",s=0;s<this.itemIds.length;s++){var o=this.itemIds[s],a=GlobalConfig.LeiTingSoulLevel[o][e],r=GlobalConfig.LeiTingSoulLevel[o][e+1],l=null==r,h=t.configID==o?375860:10855294;i+='<font color="'+h+'">'+(s+3)+"星："+ThunderCT.equipNames[this.pos]+"全属性+"+(a?a.precent/100:0)+"%</font> \n",l||(n+='<font color="'+h+'">'+r.precent/100+"%</font>\n")}this.skilltext.textFlow=(new egret.HtmlTextParser).parser(i),this.addSkilltext.textFlow=(new egret.HtmlTextParser).parser(n)},e.prototype.update=function(){this.updateUI()},e.prototype.updateElse=function(){this.mc||(this.mc=new MovieClip,this.centerPic.addChild(this.mc)),this.mc.playFile(RES_DIR_EFF+("lt"+(this.pos>9?this.pos:"0"+this.pos)),-1)},__decorate([callLater],e.prototype,"updateUI",null),e}(BaseEuiView);__reflect(ThunderJueXingWin.prototype,"ThunderJueXingWin"),window.ThunderJueXingWin=ThunderJueXingWin,ViewManager.ins().reg(ThunderJueXingWin,LayerManager.UI_Popup);var ThunderSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ThunderSkillTipSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleIndex=t[0],this.minLv=t[1],this.skillIndex=+t[2],this.otherRole=t[3],this.addTouchEvent(this.bgClose,this.onClick),this.mc=new MovieClip,this.skill.addChild(this.mc),this.updateUI()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.transEffName=function(){switch(this.skillIndex){case 0:return"leiliezhanshi";case 1:return"jileizhidun";case 2:return"leitingpaoxiao"}},e.prototype.updateUI=function(){var t=GlobalConfig.LeitingEquipStarSuitConf,e=this.minLv<3?3:this.minLv,i=t[e][8].skill[this.skillIndex];this.setInfo(i,""),this.suitStatus_N.visible=!1,this.curskillDescTitle_N.text="",this.curskillDescDetail_N.text="",this.mc.playFile(RES_DIR_EFF+this.transEffName(),-1);var n=!0;if(this.minLv>=i[1]&&t[e+1]){var s=t[e+1][8].skill[this.skillIndex];s[0]!=i[0]&&(n=!1,this.setInfo(s,"_N"))}n&&(this.anigroup.height=700,this.anigroup.$children[0].height=700)},e.prototype.setInfo=function(t,e){this["suitStatus"+e].visible=!0,this["curskillDescTitle"+e].text=this.minLv<t[1]?"全身穿戴"+t[1]+"星雷霆装备即可激活":"技能已激活",this["curskillDescTitle"+e].textColor=this.minLv<t[1]?15978507:327210;for(var i=this.otherRole?this.otherRole:SubRoles.ins().getSubRoleByIndex(this.roleIndex),n=0;8>n;n++){var s=this["curskillDesc"+n+e],o=i.thunderData[n],a=GlobalConfig.LeitingEquipConf;!o.configID||a[o.configID].level<t[1]?s.textColor=11645079:s.textColor=327210}var r=GlobalConfig.SkillsConfig[t[0]];this["curskillDescDetail"+e].textFlow=TextFlowMaker.generateTextFlow1(SkillUtil.getDesc(r)),this.skillName.text=SkillUtil.getName(r)},e}(BaseEuiView);__reflect(ThunderSkillTipsWin.prototype,"ThunderSkillTipsWin"),ViewManager.ins().reg(ThunderSkillTipsWin,LayerManager.UI_Popup),window.ThunderSkillTipsWin=ThunderSkillTipsWin;var ThunderSuitWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ThunderSuitTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleIndex=t[0],this.addTouchEndEvent(this.bgClose,this.otherClose),this.showInfo()},e.prototype.showInfo=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.roleIndex),e=[],i=[],n=[3,4,5,6,7],s=[],o=GlobalConfig.LeitingEquipConf,a=function(a){if(EquipCT.ins().thunderUnlockIndex[a]){var r=t.thunderData[a];if(r.configID){s.push(a);var l=o[r.configID].level;if(l>=3){for(var h=0;l-2>h;h++)e[h]||(e[h]=[]),e[h].push(a);for(var u=function(t){l>=t&&(i[t]||(i[t]=0),i[t]++)},p=0,c=n;p<c.length;p++){var d=c[p];u(d)}}}}},r=0;8>r;r++)a(r);for(var l=[],h=[],u=function(t,e){l.push(t),h?h.length<t&&(h=e):h=e},r=e.length-1;r>=0;r--){var p=e[r],c=p.length;8==c?u(c,p):c>=6?u(c,p):c>=4?u(c,p):c>=2?u(c,p):l.push(c)}h.length||(h=s);for(var r=0;8>r;r++){var d=this["curskillDesc"+r];-1==h.indexOf(r)?d.textColor="0xb1b097":d.textColor="0x04FE2A"}for(var g={2:0,4:0,6:0,8:0},r=0;r<i.length;r++){var p=i[r];p&&(8==p&&g[8]<r&&(g[8]=r),p>=6&&g[6]<r&&(g[6]=r),p>=4&&g[4]<r&&(g[4]=r),p>=2&&g[2]<r&&(g[2]=r))}for(var f=GlobalConfig.LeitingEquipStarSuitConf,v=0,r=0;4>r;r++){var y=new eui.Group;y.y=v;var m=new eui.Label;m.x=10,m.size=20,m.bold=!0;var T=2*r+2;m.text=(g[T]||3)+"星雷霆套装-"+T+"件套"+(g[T]?"【已激活】":"激活属性"),m.textColor=10855294,y.addChild(m);var C=new eui.Label;C.x=20,C.y=25,C.size=18,C.verticalAlign="justify",C.textAlign="left",C.textColor=g[T]?327210:10458221;for(var b="",I=f[g[T]||3][T].ex_attrs,w=0;w<I.length;w++)b+=AttributeData.getExtAttStrByType(I[w],1,"")+"\n";C.text=b,y.addChild(C),this.content.addChild(y),v=y.y+y.height+10}this.anigroup.height=155+v},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this.bgClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ThunderSuitWin.prototype,"ThunderSuitWin"),ViewManager.ins().reg(ThunderSuitWin,LayerManager.UI_Popup),window.ThunderSuitWin=ThunderSuitWin;var HejiProgressData=function(){function t(){this.id=0,this.progress=0}return t.prototype.parser=function(t){this.id=t.readByte(),this.progress=t.readUnsignedInt()},t}();__reflect(HejiProgressData.prototype,"HejiProgressData"),window.HejiProgressData=HejiProgressData;var HejiUseMgr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.register=function(t){this.root=t,this.reset(),this.root.getSkillLvl()&&this.start()},e.prototype.unregister=function(t){this.root=null,this.reset(),this.stop()},e.prototype.start=function(){this.stop(),Timer.start(1e3,0,this.updateTime,this)},e.prototype.stop=function(){Timer.stop(this.updateTime,this)},e.prototype.updateTime=function(){this.cool>0&&(this.cool-=1)},e.prototype.getSkillData=function(){if(!this.root.getSkillLvl())return null;var t=GlobalConfig.TogetherHitConfig[this.root.getSkillLvl()],e=this.getRoles()[0];if(!e)return null;if(!Assert(t,"使用合击，合击等级："+this.root.getSkillLvl())){var i=GlobalConfig.SkillsConfig[t.skill_id[e.job-1]];return new SkillData(i.id)}},e.prototype.getRoles=function(){return this.root.getRoles()||[]},e.prototype.getMaster=function(){for(var t=this.getRoles(),e=0;e<t.length;e++)if(t[e].getAtt(AttributeType.atHp)>0)return EntityManager.ins().getEntityByHandle(t[e].handle);return null},e.prototype.canUse=function(){return this.cool<=0},e.prototype.useSuccess=function(){this.cool=60},e.prototype.reset=function(){this.cool=7},e}(BaseClass);__reflect(HejiUseMgr.prototype,"HejiUseMgr"),window.HejiUseMgr=HejiUseMgr;var PunchEquipListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchEquipChangeSkinItem",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.itemConfig){var t=this.data,e=(t.att,GlobalConfig.EquipConfig[t.configID]),i="",n="";this.now.visible=!1;var s=0;for(var o in AttributeData.translate)if(e[o]&&!(e[o]<=0)){var a=new AttributeData(AttributeData.translate[o],e[o]),r="";r=AttributeData.getAttStrByType(a,0,"  "),i+=s%2==0?StringUtils.complementByChar(r,32):r+"\n",s++}this.attr1.textFlow=(new egret.HtmlTextParser).parser(i),n=e.baseAttr1?AttributeData.getAttStrByType(e.baseAttr1,1,""):AttributeData.getExtAttStrByType(e.exAttr1,1,""),this.attr2.text=n,this.changeBtn.visible=!0,this.nameTxt.text=t.itemConfig.name}},e.prototype.setBtnStatu=function(){this.changeBtn.visible=!1,this.now.visible=!0},e}(eui.ItemRenderer);__reflect(PunchEquipListItem.prototype,"PunchEquipListItem"),window.PunchEquipListItem=PunchEquipListItem;var PunchEquipAttrWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipAttrSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.title.text=1==t[0]?"觉醒属性":"符文属性",t[0]?this.showAttr():this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.showAttr=function(){var t=PunchAwakeCT.ins().awakeData,e=[];for(var i in t){var n=t[i].level,s=GlobalConfig.RunesawareLevelConfig[Number(i)+1][n];for(var o in s.attrs)if(0!=s.attrs[o].type&&0!=s.attrs[o].value){var a=s.attrs[o];e[a.type]?e[a.type]+=a.value:e[a.type]=a.value}}var r="",l="",h=0,u=0;if(0==e.length)this.baseAttr.text="无";else{for(var i in e)u=Number(i),h=e[i],l=AttributeData.getAttrStrByType(u),r+=l+"："+h+"\n";this.baseAttr.text=r}},e.prototype.setView=function(){for(var t=[],e=[],i=0;8>i;i++){var n=SkillCT.ins().equipListData[i];for(var s in n.att)if(0!=n.att[s].type&&0!=n.att[s].value){var o=n.att[s];t[o.type]?t[o.type]+=o.value:t[o.type]=o.value}if(n.configID){var a=GlobalConfig.EquipConfig[n.configID];for(var r in AttributeData.translate)if(a[r]&&!(a[r]<=0)){var l=Role.getAttrTypeByName(r);t[l]?t[l]+=a[r]:t[l]=a[r]}a.baseAttr1&&(t[a.baseAttr1.type]?t[a.baseAttr1.type]+=a.baseAttr1.value:t[a.baseAttr1.type]=a.baseAttr1.value),a.baseAttr2&&(t[a.baseAttr2.type]?t[a.baseAttr2.type]+=a.baseAttr2.value:t[a.baseAttr2.type]=a.baseAttr2.value),a.exAttr1&&(e[a.exAttr1.type]?e[a.exAttr1.type]+=a.exAttr1.value:e[a.exAttr1.type]=a.exAttr1.value),a.exAttr2&&(e[a.exAttr2.type]?e[a.exAttr2.type]+=a.exAttr2.value:e[a.exAttr2.type]=a.exAttr2.value)}}var h="",u="",p=0,c=0;for(var d in t){if(c=Number(d),p=t[d],u=AttributeData.getAttrStrByType(c),u.length<3&&(u=AttributeData.inserteBlank(u,4)),c>1&&9>c)h+=7==c||8==c?u+"："+p/100+"%":u+"："+p;else{if(!(c>12&&15>c||c>15))continue;h+=c==AttributeType.atCritEnhance?u+"："+(p/100+150)+"%":u+"："+p/100+"%"}h+="\n"}for(var d in e)c=Number(d),p=e[d],u=AttributeData.getExtAttrStrByType(c),h+=u+"："+p/100+"%",h+="\n";""==h&&(h="无"),this.baseAttr.text=h,this.anigroup.height=this.baseAttr.height+150},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchEquipAttrWin.prototype,"PunchEquipAttrWin"),ViewManager.ins().reg(PunchEquipAttrWin,LayerManager.UI_Popup),window.PunchEquipAttrWin=PunchEquipAttrWin;var PunchEquipChooseWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipChangeSkin",this.list.itemRenderer=PunchEquipListItem,this.wearItem=new PunchEquipListItem,this.itemGroup.addChild(this.wearItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.pos=t[0];var i=t[1],n=SkillCT.ins().equipListData[this.pos];this.wearItem.data=n,this.wearItem.setBtnStatu(),this.itemList=BagCT.ins().getHejiEquipsByType(this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemTap,this),this.addTouchEvent(this.bgClose,this.onTap),this.observe(SkillCT.ins().postHejiEquipChange,this.changeEquipSuccess),1==i?(this.scroll.y=232,this.scroll.height=410,this.wearItem.visible=!0):(this.scroll.y=50,this.scroll.height=590,this.wearItem.visible=!1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.changeEquipSuccess=function(){ViewManager.ins().close(e)},e.prototype.itemTap=function(t){var e=SkillCT.ins().equipListData[this.pos],i=t.item;if(e){if(e.itemConfig&&i.itemConfig.useCond!=e.itemConfig.id){var n=GlobalConfig.ItemConfig[e.itemConfig.id+10];return void TipsCT.ins().showTips("|C:0xff0000&T:请先更换"+n.name)}}else if(i.itemConfig.useCond){var n=GlobalConfig.ItemConfig[91e4+this.pos+1];return void TipsCT.ins().showTips("|C:0xff0000&T:必须装备前一个等级的符文，才可进行装备")}var s=i.itemConfig.level?i.itemConfig.level:0,o=i.itemConfig.zsLevel?i.itemConfig.zsLevel:0;return o>ZsCT.ins().lv||s>Actor.level?void TipsCT.ins().showTips("|C:0xff0000&T:符文需要"+o+"转"+s+"级可进行装备"):void SkillCT.ins().sendDressHejiEquip(i.handle,this.pos)},e.prototype.onTap=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchEquipChooseWin.prototype,"PunchEquipChooseWin"),ViewManager.ins().reg(PunchEquipChooseWin,LayerManager.UI_Main),window.PunchEquipChooseWin=PunchEquipChooseWin;var PunchEquipDetailWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offY=150,e.data=null,e.duanwei=["高","初","中"],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchEquipTipsSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.forgeGroup.visible=t[1],this.forgeGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(SkillCT.ins().postHejiEquipChange,this.refushInfo),this.refushInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.forgeGroup.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.refushInfo=function(){var t,e="",i="";t=this.data.itemConfig;var n=0;n=this.data.point,this.score.text="评分："+n;var s=0;this.powerPanel.setPower(Math.floor(n*(100+s)/100));for(var o=this.data.att,a=0;a<o.length;a++)if(0!=o[a].type){var r=AttributeData.getAttrNameByAttrbute(o[a],!0);e+=r+"\n"}for(var l=this.data.extAtt,h=!1,u=0;u<l.length;u++)if(0!=l[u].type){h=!0;var r=AttributeData.getAttrNameByAttrbute(l[u],!0);i+=r+"\n"}h?(this.tupoDesc.visible=!0,this.group.height=600,this.forgeGroup.y=530):(this.tupoDesc.visible=!1,this.group.height=600-this.offY,this.forgeGroup.y=530-this.offY),this.desc1.text="基础属性:",this.nameLabel.text=t.name,this.nameLabel.textColor=ItemUtil.getQualityColor(t),this.itemIcon.setData(t);t.level%3;this.lv.text=t.zsLevel>0?"等级："+t.zsLevel+"转":"等级："+t.level+"级",this.attr1.text=e,this.attr0.text=i},e.prototype.onTap=function(t){switch(t.target){case this.forgeGroup:ViewManager.ins().close(e),ViewManager.ins().open(PunchEquipChooseWin,this.data.itemConfig.subType,1);break;default:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(PunchEquipDetailWin.prototype,"PunchEquipDetailWin"),ViewManager.ins().reg(PunchEquipDetailWin,LayerManager.UI_Main),window.PunchEquipDetailWin=PunchEquipDetailWin;var PunchEquipForge=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(SkillCT.ins().postUpgradeForge,this.UpgradeForgeCallback),this.observe(EquipCT.ins().postSmeltEquipComplete,this.callback),this.updateDate()},e.prototype.skinComplete=function(){this.addTouchEvent(this.getItemTxt,this.onClick),this.addTouchEvent(this.btn,this.onClick);var t=this.getItemTxt.text;this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+t),this.maxPos=8,this.mcs=[]},e.prototype.removeDisplay=function(){if(DisplayUtils.removeFromParent(this.mc),this.mcs)for(var t=0;t<this.mcs.length;t++)DisplayUtils.removeFromParent(this.mcs[t])},e.prototype.updateAttrDesc=function(t,e){if("full"==this.currentState){for(var i=SkillCT.ins().getPunchForge().getSuitlevel(),n=GlobalConfig.PunchEquipMasterConfig[i],s=SkillCT.ins().getPunchForge().getAttributeData(),o=0;o<s.length;o++)if(this["attr"+o]){for(var a="",r=0,l=0;l<s.length;l++)if(s[l].type==s[o].type){r=s[l].value;break}r+=n.attr&&n.attr[o]?n.attr[o].value:0,a=AttributeData.getAttrStrByType(s[o].type),a+="+",a+=r,this["attr"+o].text=a}var h="";return h="合击伤害减免",h+=n.exattr[0].value/100,void(this.exattr0.text=h+"%")}var u=GlobalConfig.PunchEquipConfig[t][e];if(u){var i=SkillCT.ins().getPunchForge().getSuitlevel(),n=GlobalConfig.PunchEquipMasterConfig[i],p=!0;if(!n){p=!1;for(var c in GlobalConfig.PunchEquipMasterConfig){n=GlobalConfig.PunchEquipMasterConfig[c];break}}for(var d=SkillCT.ins().getPunchForge().getPosNextLevelConfig(t),s=SkillCT.ins().getPunchForge().getAttributeData(),o=0;o<u.attr.length;o++)if(this["attr"+o]){for(var a="",r=0,l=0;l<s.length;l++)if(s[l].type==u.attr[o].type){r=s[l].value;break}if(r+=n.attr&&n.attr[o]?n.attr[o].value:0,a=AttributeData.getAttrStrByType(u.attr[o].type),a+="+",a+=r,this["attr"+o].text=a,d&&this["arrow"+o]&&this["addAttr"+o]&&d.attr[o].value){this["addAttr"+o].visible=this["arrow"+o].visible=!0;var g="";g+=r+(d.attr[o].value-u.attr[o].value),this["addAttr"+o].text=g,this["arrow"+o].x=this["attr"+o].x+this["attr"+o].width,this["addAttr"+o].x=this["arrow"+o].x+this["arrow"+o].width}else this["addAttr"+o].visible=this["arrow"+o].visible=!1}var f=void 0,v=void 0,h="";if(h="合击伤害减免",p?(h+=n.exattr[0].value/100,f=SkillCT.ins().getPunchForge().getNextSuitlevel(),v=GlobalConfig.PunchEquipMasterConfig[f]):(h+=0,v=n,f=i),this.exattr0.text=h+"%",this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width,this.exattr1.x=this.arrow4.x+this.arrow4.width,v){this.exattr1.text=v.exattr[0].value/100+"%",this.exattr2.x=this.exattr1.x+this.exattr1.width;var y=Math.floor(SkillCT.ins().getPunchForge().level/this.maxPos);this.exattr2.text="(注灵等级达到 "+y+"/"+f+")"}}else{var s=SkillCT.ins().getPunchForge().getAttributeData();u=GlobalConfig.PunchEquipConfig[t][1];for(var o=0;o<u.attr.length;o++)if(this["attr"+o]){for(var a="",r=0,l=0;l<s.length;l++)if(s[l].type==u.attr[o].type){r=s[l].value;break}if(a=AttributeData.getAttrStrByType(u.attr[o].type),a+="+",a+=r,this["attr"+o].text=a,this["arrow"+o]&&this["addAttr"+o]&&u.attr[o].value){this["addAttr"+o].visible=this["arrow"+o].visible=!0;var g="";g+=u.attr[o].value,this["addAttr"+o].text=g,this["arrow"+o].x=this["attr"+o].x+this["attr"+o].width,this["addAttr"+o].x=this["arrow"+o].x+this["arrow"+o].width}else this["addAttr"+o].visible=this["arrow"+o].visible=!1}var n=void 0;for(var c in GlobalConfig.PunchEquipMasterConfig){n=GlobalConfig.PunchEquipMasterConfig[c];break}var h="";h="合击伤害减免",h+=0,this.exattr0.text=h+"%",this.arrow4.x=this.exattr0.x+this.exattr0.width+this.arrow4.width,this.exattr1.x=this.arrow4.x+this.arrow4.width,n&&(this.exattr1.text=n.exattr[0].value/100+"%",this.exattr2.x=this.exattr1.x+this.exattr1.width,this.exattr2.text="(注灵等级达到 0/"+n.level+")")
}},e.prototype.updateCost=function(t,e){var i;i=t||e?SkillCT.ins().getPunchForge().getPosNextLevelConfig(t):GlobalConfig.PunchEquipConfig[0][1],i||(i=GlobalConfig.PunchEquipConfig[t][1]),this.costicon.source=RewardData.getCurrencyRes(i.cost.id);var n="",s=SkillCT.ins().getPunchForge().isUpgradePunchForge(t);s==PunchEquipForgeData.TYPE_OK?(n=ColorUtil.GREEN_COLOR,this.redPoint.visible=!0):(this.redPoint.visible=!1,n=ColorUtil.RED_COLOR);var o=0;i.cost.id==MoneyConst.punch1?o=Actor.togeatter1:i.cost.id==MoneyConst.punch2&&(o=Actor.togeatter2),this.costcount.textFlow=TextFlowMaker.generateTextFlow("<font color="+n+">"+o+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+i.cost.count+"</font> ")},e.prototype.setPower=function(){var t=SkillCT.ins().getPunchForge().getAttributeData(),e=BagCT.getAttrPower(t),i=SkillCT.ins().getPunchForge().getSuitlevel(),n=GlobalConfig.PunchEquipMasterConfig[i];n&&n.attr&&(e+=BagCT.getAttrPower(n.attr),e+=n.exPower),e*=SubRoles.ins().subRolesLen,this.powerPanel.setPower(e)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.getItemTxt:WarnCT.ins().setBuyGoodsWarn(909998);break;case this.btn:var e=SkillCT.ins().getPunchForge().calcSelectPos(),i=SkillCT.ins().getPunchForge().isUpgradePunchForge(e);if(i==PunchEquipForgeData.TYPE_NO)return void TipsCT.ins().showTips("|C:0xff0000&T:碎片不足");if(i==PunchEquipForgeData.TYPE_MAX)return void TipsCT.ins().showTips("|C:0x00ff00&T:已满级");SkillCT.ins().sendUpgradeForge(e)}},e.prototype.callback=function(){this.updateDate()},e.prototype.UpgradeForgeCallback=function(){this.updateDate(!0)},e.prototype.updateDate=function(t){for(var e=SkillCT.ins().getPunchForge().calcSelectPos(),i=0,n=PunchEquipForgeData.TYPE_MAX,s=0;s<this.maxPos;s++){var o=SkillCT.ins().getPunchForge().isUpgradePunchForge(e);if(o!=PunchEquipForgeData.TYPE_MAX){n=0;break}}n==PunchEquipForgeData.TYPE_MAX?this.currentState="full":(this.currentState="normal",i=SkillCT.ins().getPunchForge().getPunchLevel(e)),this.validateNow(),this.setSelect(e),this.setEff(),this.updateAttrDesc(e,i),this.updateCost(e,i),this.setPower(),t&&this.setPosEff(e)},e.prototype.setPosEff=function(t){var e=t-1;0>e&&(e=this.maxPos-1),this.mcs[e]||(this.mcs[e]=new MovieClip),this.mcs[e].parent||this["eff"+e].addChild(this.mcs[e]),this.mcs[e].playFile(RES_DIR_EFF+"UpEff1",1)},e.prototype.setSelect=function(t){for(var e=0;e<this.maxPos;e++)this["pEquip"+e].visible=!1,this["pELv"+e].text="+"+SkillCT.ins().getPunchForge().getPunchLevel(e);"normal"==this.currentState&&(this["pEquip"+t].visible=!0)},e.prototype.setEff=function(){return"normal"!=this.currentState?void DisplayUtils.removeFromParent(this.mc):SkillCT.ins().canSolve()?(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.getItemTxt.parent.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.mc.touchEnabled=!1,this.mc.scaleY=.5,this.mc.scaleX=.6),this.mc.x=0,void(this.mc.y=0)):void DisplayUtils.removeFromParent(this.mc)},e}(BaseView);__reflect(PunchEquipForge.prototype,"PunchEquipForge"),window.PunchEquipForge=PunchEquipForge;var PunchExchangeBtn=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchExchangeBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.btnText.text=this.data.config.name,this.redPoint.visible=SkillCT.ins().getPunchExchangePageRedPoint(this.data.index)},e.prototype.setBtnStatu=function(){},e}(eui.ItemRenderer);__reflect(PunchExchangeBtn.prototype,"PunchExchangeBtn"),window.PunchExchangeBtn=PunchExchangeBtn;var PunchExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.count=0,e.exchangeNum=0,e.skinName="PunchExchangeItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return e.count<e.exchangeNum?(TipsCT.ins().showTips("|C:0x35e62d&T:材料数量不足|"),void ViewManager.ins().open(ShopGoodsWarn).setData(e.data.exchangeMaterial[0].id==MoneyConst.punch1?909998:909999)):BagCT.ins().getSurplusCount()<1?void TipsCT.ins().showTips("背包已满"):void SkillCT.ins().sendExchangeHejiEquip(e.data.id)},this),this.itemIcon0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.dataChanged=function(){var t=GlobalConfig.ItemConfig[this.data.getItem.id],e=this.data.exchangeMaterial[0];this.exchangeNum=e.count,e.id==MoneyConst.punch1?this.count=Actor.togeatter1:this.count=Actor.togeatter2,this.icon.source=RewardData.getCurrencyRes(e.id),this.redPoint.visible=SkillCT.ins().getPunchExchangeItemRedPoint(this.data.id);this.data.zsLevel>0?this.data.zsLevel+"转":this.data.level+"级";this.nameLab.text=t.name;var i=this.count<this.exchangeNum?"#F3311E":"#35E62D";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+i+"'>"+this.count+"</font><font color = '#9F946D'>/"+this.exchangeNum+"</font>"),this.itemConfig=t,this.itemIcon0.setData(t),this.data.zsLevel>0?this.goBtn.visible=ZsCT.ins().lv>=this.data.zsLevel:this.goBtn.visible=Actor.level>=this.data.level},e.prototype.onClick=function(){if(this.itemConfig)switch(ItemUtil.getType(this.itemConfig)){case 5:ViewManager.ins().open(HejiEquipTipsWin,{id:this.itemConfig.id},!1,!0);break;default:TipsCT.ins().showTips("没有找到道具类型提示页")}},e.prototype.setBtnStatu=function(){},e}(eui.ItemRenderer);__reflect(PunchExchangeItem.prototype,"PunchExchangeItem"),window.PunchExchangeItem=PunchExchangeItem;var PunchExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentSelect=0,e._sn_="PunchExchangeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){this.goturn.textFlow=[{text:"碎片兑换",style:{underline:!0}}],this.exchangelist.itemRenderer=PunchExchangeItem,this.equiplist.itemRenderer=PunchExchangeBtn,this.initMenu(),this.equiplist.addEventListener(egret.Event.CHANGING,this.checkIsOpen,this),this.observe(Actor.ins().postUpdateTogeatter,this.onListChange),this.addTouchEvent(this.goturn,this.onTap),this.equiplist.selectedIndex=this.currentSelect,this.refushInfo()},e.prototype.onListChange=function(t){this.currentSelect=this.equiplist.selectedIndex,this.refushInfo()},e.prototype.initMenu=function(){this.menuArr=[],this.exchangeArr=[];var t=GlobalConfig.TogetherHitEquipPageConfig,e=0,i=SkillCT.ins().getMaxzLv();for(var n in t){var s=t[n].id[0],o=GlobalConfig.TogetherHitEquipExchangeConfig[s];if(o.zsLevel>i[0]||o.level>i[1])break;this.menuArr.push({config:t[n],index:t[n].index}),this.exchangeArr[e]=[];for(var a in t[n].id){var r=GlobalConfig.TogetherHitEquipExchangeConfig[t[n].id[a]];this.exchangeArr[e].push(r)}e++}},e.prototype.refushInfo=function(){this.suipian.text=""+Actor.togeatter1,this.suipian1.text=""+Actor.togeatter2,this.equiplist.dataProvider=new eui.ArrayCollection(this.menuArr);var t=this.exchangeArr[this.currentSelect];this.exchangelist.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){var e=t.currentTarget;e==this.goturn&&ViewManager.ins().open(PunchTransformWin)},e.prototype.checkIsOpen=function(t){var e=t.target,i=this.exchangeArr[e.selectedIndex][0],n=i.zsLevel||0,s=i.level,o=!0;if(!o){var a=Actor.level>=s?n+"转开启":s+"级开启";return TipsCT.ins().showTips(a+"开启"),t.$cancelable=!0,void t.preventDefault()}this.onListChange(null)},__decorate([callLater],e.prototype,"onListChange",null),e}(BaseEuiView);__reflect(PunchExchangeWin.prototype,"PunchExchangeWin"),ViewManager.ins().reg(PunchExchangeWin,LayerManager.UI_Main),window.PunchExchangeWin=PunchExchangeWin;var PunchExtShowWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.colorWhite="#f8b141",e.colorGray="#444134",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchExtShowSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.setView=function(){var t="",e=GlobalConfig.TogetherHitEquipQmConfig,i=SkillCT.ins().qimingAttrDic,n=new Object,s=0;for(var o in i)n=i[o],s=Number(o);var a=n?CommonUtils.getObjectLength(n):0,r=this.colorWhite,l=!1;for(var h in e)for(var u in e[h]){var p=e[h][u];t+=0!=Number(h)?"<font color="+this.colorWhite+">"+h+"转套装属性(三角色时):</font>\n":"<font color="+this.colorWhite+">"+u+"级套装属性(三角色时):</font>\n";var o=0,c=1e4*Number(h)+Number(u);for(var d in p){p[d].exAttr;c>s?(r=this.colorGray,l=!0):c==s&&o+1>a&&(r=this.colorGray,l=!0),t+="<font color="+r+">"+p[d].num+"件套："+this.getDescTextFlow(p[d].desc,!l)+"</font>\n",o++,3==o&&(t+="\n")}}this.baseAttr.textFlow=(new egret.HtmlTextParser).parser(t)},e.prototype.getDescTextFlow=function(t,e){for(var i=TextFlowMaker.generateTextFlow1(t),n="",s=0,o=i;s<o.length;s++){var a=o[s];n+=e&&a.style&&void 0!=a.style.textColor?"<font color="+a.style.textColor+">"+a.text+"</font>":a.text}return n},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchExtShowWin.prototype,"PunchExtShowWin"),ViewManager.ins().reg(PunchExtShowWin,LayerManager.UI_Main),window.PunchExtShowWin=PunchExtShowWin;var PunchResWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="PunchResSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.smeltEquips=[],this.smeltEquips.length=9,this.itemList.itemRenderer=SmeltEquipItem,this.dataInfo=new eui.ArrayCollection(this.smeltEquips),this.itemList.dataProvider=this.dataInfo},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.itemList,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(EquipCT.ins().postSmeltEquipComplete,this.smeltComplete),this.observe(EquipCT.ins().postEquipCheckList,this.setItemList),this.setItemData()},e.prototype.smeltComplete=function(){for(var t=this.itemList.numChildren;t--;)this.itemList.getChildAt(t).playEff();this.setItemData()},e.prototype.setItemData=function(){this.smeltEquips=BagCT.ins().getHejiOutEquips(),this.dataInfo.replaceAll(this.smeltEquips)},e.prototype.setItemList=function(t){this.dataInfo.replaceAll(t),this.itemList.dataProvider=this.dataInfo},e.prototype.onTap=function(t){switch(t.currentTarget){case this.smeltBtn:EquipCT.ins().sendSmeltEquip(0,this.smeltEquips);break;case this.itemList:var i=t.target;if(i&&i.data){var n=this.smeltEquips.indexOf(i.data);n>=0&&(this.smeltEquips.splice(n,1),i.data=null)}break;case this.bgClose:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(PunchResWin.prototype,"PunchResWin"),ViewManager.ins().reg(PunchResWin,LayerManager.UI_Popup),window.PunchResWin=PunchResWin;var PunchSkillItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchSkillItem",e}return __extends(e,t),e.prototype.setData=function(t){this.iconBG.source=t.id+"_png"},e}(eui.Component);__reflect(PunchSkillItemRender.prototype,"PunchSkillItemRender"),window.PunchSkillItemRender=PunchSkillItemRender;var PunchSkillTipsWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="PunchskillTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.setView=function(){var t=GlobalConfig.TogetherHitConfig[SkillCT.ins().hejiLevel],e=SubRoles.ins().getSubRoleByIndex(0),i=new SkillData(t.skill_id[e.job-1]);this.skillitem.setData(i),this.nameLabel0.text=i.name,this.desc0.text=SkillUtil.getDesc(i.config);var n=SkillCT.ins().qimingValueDic,s=0;for(var o in n){var a=n[o].value/100,r=void 0;r=2>s?StringUtils.substitute(SkillCT.descArr[s],"|C:0x00ff00&T:"+3*a+"%|"):StringUtils.substitute(SkillCT.descArr[s],"|C:0x00ff00&T:"+a+"%|"),this["desc"+o].textFlow=TextFlowMaker.generateTextFlow1(r),s++}0==s&&(this.desc3.text="无")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PunchSkillTipsWin.prototype,"PunchSkillTipsWin"),ViewManager.ins().reg(PunchSkillTipsWin,LayerManager.UI_Popup),window.PunchSkillTipsWin=PunchSkillTipsWin;var PunchTransformWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PunchTransformSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(Actor.ins().postUpdateTogeatter,this.checkChange),this.update()},e.prototype.close=function(){},e.prototype.checkChange=function(t){t&&2==t.type&&this.update()},e.prototype.update=function(){this.count0.text=Actor.togeatter2+"",this.count1.text="0",this.changeBar.value=0,this.changeBar.maximum=Actor.togeatter2,this.transformBtn.enabled=Actor.togeatter2>0,this.quicklytransformBtn.enabled=!1},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.transformBtn:SkillCT.ins().sendChangeTogeatterHigh(Actor.togeatter2);break;case this.quicklytransformBtn:SkillCT.ins().sendChangeTogeatterHigh(this.changeBar.value);break;case this.add:this.changeBar.value<Actor.togeatter2?(this.changeBar.value++,this.count1.text=this.changeBar.value*GlobalConfig.TogerherHitBaseConfig.TogExgRate+"",this.quicklytransformBtn.enabled=!0):0==Actor.togeatter2?TipsCT.ins().showTips("高级符文碎片不足"):TipsCT.ins().showTips("已达到最大转换数量");break;case this.minus:this.changeBar.value>0&&(this.changeBar.value--,this.count1.text=this.changeBar.value*GlobalConfig.TogerherHitBaseConfig.TogExgRate+""),this.changeBar.value<=0&&(this.quicklytransformBtn.enabled=!1)}},e}(BaseEuiView);__reflect(PunchTransformWin.prototype,"PunchTransformWin"),ViewManager.ins().reg(PunchTransformWin,LayerManager.UI_Main),window.PunchTransformWin=PunchTransformWin;var Hint=function(t){function e(){var e=t.call(this)||this;return e.presceneid=-1,e.prefbId=-1,e.observe(GameLogic.ins().postEnterMap,e.seceneIn),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkHint=function(t,i,n,s){if(!t){switch(i){case e.TARTYPE_WELCOME:return this.showHint(i),!0;case e.TARTYPE_KILL_BOSS:for(var o in GlobalConfig.HintConfig){var a=GlobalConfig.HintConfig[o];if(a.target[0].guanqiaId==s.gqid)return this.showHint(i,a.image),!0}}return!1}if(t){var r=this.HitConfig(t,i);if(null!=r)return this.showHint(i,r),!0}else for(var o in n){var l=n[o],r=this.HitConfig(l,i);if(null!=r)return this.showHint(i,r),!0}return!1},e.prototype.HitConfig=function(t,i){var n=t;for(var s in GlobalConfig.HintConfig){var o=GlobalConfig.HintConfig[s];if(o.targetType==i)switch(i){case e.TARTYPE_ACH_BEF:if(n.achievementId==o.target[0].achievementId&&n.taskId==o.target[0].taskId&&o.target[0].isfull&&o.target[0].isfull>0&&BagCT.ins().getSurplusCount())return o.image;break;case e.TARTYPE_ACH_AFT:if(n.achievementId==o.target[0].achievementId&&n.taskId==o.target[0].taskId)return o.image;break;case e.TARTYPE_SCE_IN:if(GameMap.mapID==o.target[0].sceneid&&GameMap.fubenID==o.target[0].fbId&&this.presceneid==o.target[0].presceneid&&this.prefbId==o.target[0].prefbId)return o.image}}return null},e.prototype.showHint=function(t,i){if(!i&&t==e.TARTYPE_WELCOME){var n=GlobalConfig.HintConfig[1];return i=n.image,void TipsCT.ins().showHintTips(i)}i&&""!=i&&TipsCT.ins().showHintTips(i)},e.prototype.postWelcome=function(){this.checkHint(null,e.TARTYPE_WELCOME)},e.prototype.postAchievementBef=function(t){t&&this.checkHint(t,e.TARTYPE_ACH_BEF)},e.prototype.postAchievementAft=function(t){if(t){var i;for(var n in GlobalConfig.AchievementTaskConfig){var s=GlobalConfig.AchievementTaskConfig[n];if(s.achievementId==t.achievementId&&s.taskId==t.id){i=s;break}}i&&this.checkHint(i,e.TARTYPE_ACH_AFT)}},e.prototype.seceneIn=function(){-1==this.presceneid&&(this.presceneid=GameMap.mapID),-1==this.prefbId&&(this.prefbId=GameMap.fubenID);var t=GlobalConfig.ScenesConfig[GameMap.mapID];t&&(this.checkHint(t,e.TARTYPE_SCE_IN),this.presceneid=GameMap.mapID,this.prefbId=GameMap.fubenID)},e.prototype.postKillBoss=function(t){this.checkHint(t,e.TARTYPE_KILL_BOSS)},e.prototype.postKillBossEx=function(t){this.checkHint(null,e.TARTYPE_KILL_BOSS,null,{gqid:t})},e.TARTYPE_WELCOME=1,e.TARTYPE_ACH_BEF=2,e.TARTYPE_ACH_AFT=3,e.TARTYPE_SCE_IN=4,e.TARTYPE_KILL_BOSS=5,__decorate([post()],e.prototype,"postWelcome",null),__decorate([post()],e.prototype,"postAchievementBef",null),__decorate([post()],e.prototype,"postAchievementAft",null),__decorate([post()],e.prototype,"postKillBoss",null),__decorate([post()],e.prototype,"postKillBossEx",null),e}(BaseSystem);__reflect(Hint.prototype,"Hint"),System.Hint=function(){return Hint.ins()},window.Hint=Hint;var HongBaoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="NewHongbaoUISkin",e.isTopLevel=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.DownHongbao()},e.prototype.DownHongbao=function(){var t=this,e=new eui.Image;this.addChild(e),e.source="newhongbaoicon_png",e.x=400*Math.random()+50,e.y=230,e.scaleX=e.scaleY=.5,this.addTouchEvent(e,this.openNewHongbaoWin),egret.Tween.get(e).to({y:700},5e3).wait(5e3).call(function(){t.removeTouchEvent(e,t.openNewHongbaoWin),t.removeChildren(),ViewManager.ins().close(t)})},e.prototype.openNewHongbaoWin=function(){egret.Tween.removeTweens(this),ViewManager.ins().close(this),Activity.ins().sendGetHongBao(1,Activity.ins().activityId)},e}(BaseEuiView);__reflect(HongBaoWin.prototype,"HongBaoWin"),window.HongBaoWin=HongBaoWin,ViewManager.ins().reg(HongBaoWin,LayerManager.Main_View);var NewHongBaoOpenWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="NewhongbaoOpenSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onThouch),this.eBeVipLab.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.eBeVipLab.text+"</u></a>"),this.eBeVipLab.touchEnabled=!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.upDateView()},e.prototype.onThouch=function(t){switch(t.target){case this.eBeVipLab:var e=Recharge.ins().getRechargeData(0);e&&0!=e.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win);break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.upDateView=function(){var t=Activity.ins().activityData[Activity.ins().activityId];if(this.eNoVIPShowGroup.visible=!1,t.hasRecharge){if(this.desc1.text="",this.desc1.visible=!0,0==t.num)return;for(var e=t.num>50?t.num-50:0,i=t.num-1;i>=e;i--)this.desc1.text+=t.datas[i]+"\n",this.desc1.height+=18;this.eGetMoneyLab.textFlow=TextFlowMaker.generateTextFlow1(t.getMoney+"+|C:0xFFD93F&T:"+t.vipGetMoney+"|")}else this.eNoVIPShowGroup.visible=!0,this.desc1.visible=!1,this.eGetMoneyLab.text=t.getMoney+"";this.eNoVIPGetMoney.text=t.currVipTotal+""},e}(BaseEuiView);__reflect(NewHongBaoOpenWin.prototype,"NewHongBaoOpenWin"),window.NewHongBaoOpenWin=NewHongBaoOpenWin,ViewManager.ins().reg(NewHongBaoOpenWin,LayerManager.UI_Main);var NewHongBaoWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="NewhongbaoSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(NewHongBaoWin.prototype,"NewHongBaoWin"),window.NewHongBaoWin=NewHongBaoWin,ViewManager.ins().reg(NewHongBaoWin,LayerManager.UI_Main);var HotBloodCT=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkHotBlood=function(){0==Setting.ins().getValue(ClientSet.hotBlood)&&Recharge.ins().franchise<=0&&1==Setting.ins().getValue(ClientSet.useHotBlood)?this.showIcon(!0):this.showIcon(!1)},e.prototype.showIcon=function(t){if(!this.icon&&t){var e=ViewManager.ins().getView(PlayFunView);if(!e)return void Timer.start(1e3,1,this.checkHotBlood,this);this.icon=new eui.Image,this.icon.source="hotBlood_png",this.icon.horizontalCenter="0",this.icon.bottom="250",this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openHotBloodWin,this),e.addChild(this.icon)}else this.icon&&!t&&(DisplayUtils.removeFromParent(this.icon),this.icon.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.openHotBloodWin,this),this.icon=null)},e.prototype.openHotBloodWin=function(){ViewManager.ins().open(HotBloodWin)},e}(BaseSystem);__reflect(HotBloodCT.prototype,"HotBloodCT"),System.HotBloodCT=function(){return HotBloodCT.ins()},window.HotBloodCT=HotBloodCT;var HotBloodWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="bloodhover",e}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this,this.onTaps)},e.prototype.onTaps=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.btn1:ViewManager.ins().close(this),ViewManager.ins().open(CardWin,1);break;case this.btn2:ViewManager.ins().close(this),HotBloodCT.ins().showIcon(!1),Setting.ins().setValue(ClientSet.hotBlood,1)}},e}(BaseEuiView);__reflect(HotBloodWin.prototype,"HotBloodWin"),ViewManager.ins().reg(HotBloodWin,LayerManager.UI_Popup),window.HotBloodWin=HotBloodWin;var Hungu=function(t){function e(){var e=t.call(this)||this;return e.hunShouFBTimes=0,e.hunShouFBPassID=0,e.sysId=PackageID.Hungu,e.regNetMsg(1,e.postHunguInfo),e.regNetMsg(2,e.postHunguItems),e.regNetMsg(3,e.postHunyu),e.regNetMsg(4,e.postHunguItemUpgrade),e.regNetMsg(6,e.postSweepHunShouFB),e.regNetMsg(7,e.postHunShouFBInfo),e.regNetMsg(8,e.postHunShouFBEndTime),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"hunguData",{get:function(){return this._hunguData||(this._hunguData=[]),this._hunguData},enumerable:!0,configurable:!0}),e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.HunGuConf,i=e.openserverday,n=e.openzhuanshenglv,s=GameServer.serverOpenDay-i+1;return 0>s?(t&&TipsCT.ins().showTips("还需要"+-s+"天开启"),!1):ZsCT.ins().lv<n?(t&&TipsCT.ins().showTips("角色"+n+"转开启"),!1):!0},e.prototype.checkShowOpen=function(){return GameServer.serverOpenDay<GlobalConfig.HunGuConf.openserverday-1?!1:ZsCT.ins().lv<GlobalConfig.HunGuConf.showzhuanshenglv?!1:!0},e.prototype.getHunguItemsPos=function(t){var e=-1,i=GlobalConfig.ItemConfig[t];return i&&(e=ItemUtil.getSubType(i)),e},e.prototype.getHunguItemsList=function(t){for(var e=[],i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_24),n=0;n<i.length;n++)this.getHunguItemsPos(i[n].itemConfig.id)==t&&e.push(i[n]);return e.sort(function(t,e){var i=GlobalConfig.HunGuEquip[t.configID],n=GlobalConfig.HunGuEquip[e.configID];return i.stage>n.stage?-1:1}),e},e.prototype.getHunyuRedPoint=function(t,e){if(!this.hunguData[t])return!1;for(var i=0;i<this.hunguData[t].items[e].hunyu.length;i++){var n=this.getHunyuKongRedPoint(t,e,i);if(n)return!0}return!1},e.prototype.getHunyuKongRedPoint=function(t,e,i){if(!this.hunguData[t])return!1;if(!this.hunguData[t].items[e].itemId||i+1>GlobalConfig.HunGuEquip[this.hunguData[t].items[e].itemId].hunyuNum)return!1;var n=GlobalConfig.HunGuConf.hunyuType[e][i],s=this.hunguData[t].items[e].hunyu[i],o=GlobalConfig.HunYuEquip[n][s+1];if(!o)return!1;var a=GlobalConfig.HunGuConf.unlockCost[i+1];if(!s&&a);else{var r=BagCT.ins().getBagItemById(o.cost.id);if(r&&r.count>=o.cost.count)return!0}return!1},e.prototype.getHunguPosHyPower=function(t,e){var i=0;if(!this.hunguData[t]||!this.hunguData[t].items[e].itemId)return i;var n=GlobalConfig.HunGuEquip[this.hunguData[t].items[e].itemId];if(!n)return i;for(var s=n.hunyuNum,o=0;s>o;o++){var a=GlobalConfig.HunGuConf.hunyuType[e][o],r=this.hunguData[t].items[e].hunyu[o],l=GlobalConfig.HunYuEquip[a][r];if(l){i+=BagCT.getAttrPower(l.attrs,SubRoles.ins().getSubRoleByIndex(t));var h=l.expower?l.expower:0;i+=h}}return i},e.prototype.getHunguItemPower=function(t){var e=0,i=GlobalConfig.HunGuEquip[t];if(i){e+=BagCT.getAttrPower(i.attrs);var n=i.expower?i.expower:0;e+=n}return e},e.prototype.getHunguPosPower=function(t,e,i,n){var s=0;if(!this.hunguData[t])return s;var o=0;n&&(o+=this.getHunguPosHyPower(t,e));var a=[],r=this.hunguData[t].items[e].itemId,l=GlobalConfig.HunGuEquip[r];if(l){s+=BagCT.getAttrPower(l.attrs,SubRoles.ins().getSubRoleByIndex(t));var h=l.expower?l.expower:0;if(s+=h,i)for(var u=0;u<l.attrs.length;u++){for(var p=!1,c=0;c<a.length;c++)if(a[c].type==l.attrs[u].type){a[c].value+=l.attrs[u].value,p=!0;break}p||a.push(new AttributeData(l.attrs[u].type,l.attrs[u].value))}}var d=[];if(i){var g=[];for(var f in i)for(var u in i[f])if(i[f][u].count.length>=+u){var v=i[f][u].stage,y=GlobalConfig.HunGuSuit[f][u][v];y&&y.specialAttrs&&g.push(y.specialAttrs/1e4)}g.length||g.push(0);for(var f=0;f<g.length;f++)for(var u=0;u<a.length;u++)d[u]||(d[u]=new AttributeData(a[u].type,0)),d[u].value+=a[u].value*g[f]}return s+=o+BagCT.getAttrPower(d)},e.prototype.getResonancePower=function(t){var e=0;if(!this.hunguData[t])return e;var i=this.getSuitData(t);for(var n in i)for(var s in i[n]){var o=i[n][s].stage;if(o){var a=i[n][s].count;if(!(a.length<+s)){var r=GlobalConfig.HunGuSuit[n][s][o];r.attrs&&(e+=BagCT.getAttrPower(r.attrs,SubRoles.ins().getSubRoleByIndex(t)));var l=r.expower?r.expower:0;e+=l}}}return e},e.prototype.getSuitData=function(t){var e={};if(!this.hunguData[t])return e;var i=[];for(var n in GlobalConfig.HunGuConf.suit)if(GlobalConfig.HunGuSuit[n]){i[+n]=[];for(var s in GlobalConfig.HunGuConf.suit[n]){var o=GlobalConfig.HunGuConf.suit[n][s],a=this.hunguData[t].items[o].itemId;a&&i[+n].push(GlobalConfig.HunGuEquip[a])}i[+n].sort(function(t,e){return Algorithm.sortDesc(t.stage,e.stage)})}for(var s in GlobalConfig.HunGuSuit){e[s]={};for(var r in GlobalConfig.HunGuSuit[s]){e[s][r]={},e[s][r].count=[],e[s][r].stage=0;for(var l=0;+r>l&&i[+s][l];l++)e[s][r].count.push(i[+s][l].id),e[s][r].stage||(e[s][r].stage=i[+s][l].stage),e[s][r].stage>i[+s][l].stage&&(e[s][r].stage=i[+s][l].stage)}}return e},e.prototype.getHunguPosName=function(t){return GlobalConfig.HunGuConf.hunguName[t]},e.prototype.getHunguItemQualityName=function(t,e){var i="",n=e;switch(n||(n=GlobalConfig.HunGuEquip[t]?GlobalConfig.HunGuEquip[t].stage:1),n){case 1:i="凡品";break;case 2:i="中品";break;case 3:i="上品";break;case 4:i="极品";break;case 5:i="神品"}return i},e.prototype.calcHunguTotalValue=function(t){var e=[],i=this.hunguData[t];if(!i)return e;for(var n=[],s=0;s<i.items.length;s++){var o=i.items[s],a=o.itemId,r=GlobalConfig.HunGuEquip[a];if(r){for(var l=0,h=r.attrs;l<h.length;l++){for(var u=h[l],p=!1,c=0,d=n;c<d.length;c++){var g=d[c];if(g.type==u.type){g.value+=u.value,p=!0;break}}p||n.push(new AttributeData(u.type,u.value))}for(var f=0;f<o.hunyu.length;f++){var v=o.hunyu[f];if(v)for(var y=GlobalConfig.HunGuConf.hunyuType[s][f],m=GlobalConfig.HunYuEquip[y][v],T=0,C=m.attrs;T<C.length;T++){for(var u=C[T],p=!1,b=0,I=e;b<I.length;b++){var g=I[b];if(g.type==u.type){g.value+=u.value,p=!0;break}}p||e.push(new AttributeData(u.type,u.value))}}}}var w=this.getSuitData(t),S=[];for(var s in w)for(var f in w[s])if(w[s][f].count.length>=+f){var _=w[s][f].stage,B=GlobalConfig.HunGuSuit[s][f][_];if(B&&B.attrs)for(var D=0,x=B.attrs;D<x.length;D++){for(var u=x[D],p=!1,R=0,E=e;R<E.length;R++){var g=E[R];if(g.type==u.type){g.value+=u.value,p=!0;break}}p||e.push(new AttributeData(u.type,u.value))}B&&B.specialAttrs&&S.push(B.specialAttrs/1e4)}for(var s=0;s<S.length;s++)for(var f=0;f<n.length;f++)n[f].value*=1+S[s];for(var A=0,P=n;A<P.length;A++){for(var u=P[A],p=!1,k=0,M=e;k<M.length;k++){var g=M[k];if(g.type==u.type){g.value+=u.value,g.value=Math.floor(g.value),p=!0;break}}p||e.push(new AttributeData(u.type,Math.floor(u.value)))}return e},e.prototype.getAttrStrByType=function(t){var e="";switch(t){case AttributeType.atMaxHp:e="生       命";break;case AttributeType.atAttack:e="攻       击";break;case AttributeType.atDef:e="物       防";break;case AttributeType.atRes:e="魔       防"}return e},e.prototype.getCurHunguId=function(t,i){var n=e.ins(),s=n.hunguData[t];if(!s)return 0;var o=s.items[i];return o?o.itemId:0},e.prototype.getNextHunguId=function(t,i){var n=e.ins(),s=n.hunguData[t];if(!s)return 0;var o=s.items[i];return o?GlobalConfig.HunGuEquip[o.itemId].nextId:0},e.prototype.getNextHunyuLvConfig=function(t,e,i){if(!this.hunguData[t])return null;var n=GlobalConfig.HunGuConf.hunyuType[e][i],s=this.hunguData[t].items[e].hunyu[i];return GlobalConfig.HunYuEquip[n][s+1]},e.prototype.getUpgradeRedPoint=function(t){var e=GlobalConfig.HunGuEquip[t];if(!e||!e.addStageCost)return!1;var i=BagCT.ins();for(var n in e.addStageCost){var s=i.getBagItemById(e.addStageCost[n].id);if(!s||s.count<e.addStageCost[n].count)return!1}return!0},e.prototype.sendHunguItems=function(t,e,i){var n=this.getBytes(2);n.writeByte(t),n.writeByte(e),n.writeInt(i),this.sendToServer(n)},e.prototype.sendHunyu=function(t,e,i){var n=this.getBytes(3);n.writeByte(t),n.writeByte(e),n.writeByte(i),this.sendToServer(n)},e.prototype.sendHunguItemUpgrade=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postHunguInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=t.readByte(),s=t.readByte(),o=void 0;o=this.hunguData[n]?this.hunguData[n]:new HunguData;for(var a=0;s>a;a++){o.items[a].itemId=t.readInt();for(var r=t.readByte(),l=0;r>l;l++)o.items[a].hunyu[l]=t.readInt()}this.hunguData[n]=o}},e.prototype.postHunguItems=function(t){var e=t.readByte(),i=t.readByte(),n=t.readInt();this.hunguData[e]||(this.hunguData[e]=new HunguData);var s=this.hunguData[e],o=s.items[i].itemId;s&&(s.items[i].itemId=n),0==o&&0!=n&&this.postNothing2Wear(1,i),0==n&&0!=o&&this.postWear2Noting(0,i)},e.prototype.postNothing2Wear=function(t,e){return[t,e]},e.prototype.postWear2Noting=function(t,e){return[t,e]},e.prototype.postHunyu=function(t){var e=t.readByte(),i=t.readByte(),n=t.readByte(),s=t.readInt();this.hunguData[e]&&(this.hunguData[e].items[i].hunyu[n-1]=s)},e.prototype.postHunguItemUpgrade=function(t){var e=t.readByte(),i=t.readByte(),n=t.readInt();this.hunguData[e]&&(this.hunguData[e].items[i].itemId=n),this.postNothing2Wear(1,i)},e.prototype.enterHunShouFB=function(){this.sendBaseProto(5)},e.prototype.sweepHunShouFB=function(){this.sendBaseProto(6)},e.prototype.postSweepHunShouFB=function(t){var e=t.readInt();this.hunShouFBTimes=t.readInt();for(var i,n=t.readInt(),s=[],o=0;n>o;o++)i=new RewardData,i.type=t.readInt(),i.id=t.readInt(),i.count=t.readInt(),s.push(i);ViewManager.ins().open(HunShouSweepWin,e,s)},e.prototype.postHunShouFBInfo=function(t){this.hunShouFBPassID=t.readInt(),this.hunShouFBTimes=GlobalConfig.HunGuConf.dayRewardCount-t.readInt()},e.prototype.postHunShouFBEndTime=function(t){this._hunShouFBEndTime=t.readInt()},e.prototype.getHunShouFbLeftTime=function(){return Math.floor((1e3*this._hunShouFBEndTime+1e3*DateUtils.SECOND_2020-GameServer.serverTime)/1e3)},__decorate([post()],e.prototype,"postHunguInfo",null),__decorate([post()],e.prototype,"postHunguItems",null),__decorate([post()],e.prototype,"postNothing2Wear",null),__decorate([post()],e.prototype,"postWear2Noting",null),__decorate([post()],e.prototype,"postHunyu",null),__decorate([post()],e.prototype,"postHunguItemUpgrade",null),__decorate([post()],e.prototype,"postSweepHunShouFB",null),__decorate([post()],e.prototype,"postHunShouFBInfo",null),__decorate([post()],e.prototype,"postHunShouFBEndTime",null),e}(BaseSystem);__reflect(Hungu.prototype,"Hungu"),System.Hungu=function(){return Hungu.ins()},window.Hungu=Hungu;var HunguRedPoint=function(t){function e(){var e=t.call(this)||this;return e.itemPoints=[],e.roleTabs=[],e.redPoint=!1,e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,Hungu.ins().postHunguInfo,Hungu.ins().postHunguItems,Hungu.ins().postHunyu,Hungu.ins().postHunguItemUpgrade,BagCT.ins().postItemCountChange,ZsCT.ins().postZsLv,GameLogic.ins().postSubRoleChange),e
}return __extends(e,t),e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=(Hungu.ins(),0);3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e)for(var i=0;i<GlobalConfig.HunGuConf.equipCount&&(this.roleTabs[t]=this.HunguItemRedPoint(e.index,i),!this.roleTabs[t]);i++);else this.roleTabs[t]=!1}return!0},e.prototype.HunguItemRedPoint=function(t,e){var i=Hungu.ins(),n=!1,s=i.getHunguItemsList(e);if(s.length){if(!i.hunguData[t]||!i.hunguData[t].items[e].itemId)return n=!0;var o=GlobalConfig.HunGuEquip[Hungu.ins().hunguData[t].items[e].itemId].stage;if(GlobalConfig.HunGuEquip[s[0].configID].stage>o)return n=!0}return n=i.getHunyuRedPoint(t,e),n?!0:i.hunguData[t]&&i.hunguData[t].items[e].itemId&&(n=i.getUpgradeRedPoint(i.hunguData[t].items[e].itemId))?n:n},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),e}(BaseSystem);__reflect(HunguRedPoint.prototype,"HunguRedPoint"),System.HunguRedPoint=function(){return HunguRedPoint.ins()},window.HunguRedPoint=HunguRedPoint;var HunguData=function(){function t(){}return Object.defineProperty(t.prototype,"items",{get:function(){if(!this._items){this._items=[];for(var t=0;t<GlobalConfig.HunGuConf.equipCount;t++){var e=new HungguItems;this._items.push(e)}}return this._items},set:function(t){this._items=t},enumerable:!0,configurable:!0}),t}();__reflect(HunguData.prototype,"HunguData");var HungguItems=function(){function t(){this.itemId=0,this.hunyu=[];for(var t=0;t<GlobalConfig.HunGuConf.hunyuCount;t++)this.hunyu.push(0)}return t}();__reflect(HungguItems.prototype,"HungguItems");var HGPOS;!function(t){t[t.ITEM0=0]="ITEM0",t[t.ITEM1=1]="ITEM1",t[t.ITEM2=2]="ITEM2",t[t.ITEM3=3]="ITEM3",t[t.ITEM4=4]="ITEM4",t[t.ITEM5=5]="ITEM5",t[t.ITEM6=6]="ITEM6",t[t.ITEM7=7]="ITEM7"}(HGPOS||(HGPOS={})),window.HunguData=HunguData;var HunguAttrWin=function(t){function e(){var e=t.call(this)||this;return e._lastX=0,e.proShowList=[],e.skinName="heartmethodAttrSkin",e.isTopLevel=!0,e.proShowList=[2,4,5,6],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this.setRoleAttr(this.curRole);var i=SubRoles.ins().subRolesLen;i>1&&(this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.rightBtn,this.onTouch),this.bg.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.addTouchEndEvent(this.bg,this.onMove)),this.addTouchEndEvent(this,this.otherClose)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=SubRoles.ins().subRolesLen;i>1&&(this.removeTouchEvent(this.leftBtn,this.onTouch),this.removeTouchEvent(this.rightBtn,this.onTouch),this.bg.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onMove,this),this.bg.removeEventListener(egret.TouchEvent.TOUCH_END,this.onMove,this)),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.otherClose,this)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200)):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200))}},e.prototype.moveAttr=function(t){var e,i=egret.Tween.get(this.attrGroup);e=t>0?0:242,i.to({x:this.attrGroup.x+t,alpha:0},200).to({x:e},200).to({x:80,alpha:1},200)},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.leftBtn:this.curRole>0&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(200));break;case this.rightBtn:this.curRole<2&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-200))}},e.prototype.setRoleAttr=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i="",n="",s=0,o=0,a=Hungu.ins().calcHunguTotalValue(e.index),r=0;r<this.proShowList.length;r++){o=this.proShowList[r],s=0;for(var l=0;l<a.length;l++)if(a[l].type==o){s=a[l].value;break}i+=Math.floor(s)+"",n+=Hungu.ins().getAttrStrByType(o)+":",r<this.proShowList.length-1&&(i+="\n",n+="\n")}this.attr.text=i,this.attrName.text=n,this.setBtn()},e.prototype.setBtn=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,3>t?this.rightBtn.visible=!1:this.rightBtn.visible=!0):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))},e}(BaseEuiView);__reflect(HunguAttrWin.prototype,"HunguAttrWin"),ViewManager.ins().reg(HunguAttrWin,LayerManager.UI_Popup),window.HunguAttrWin=HunguAttrWin;var HunguChooseEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e.roleSelect=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="hunguChooseSkin",this.list.itemRenderer=HunguEquipChooseItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback),this.roleSelect=t[0],this.pos=t[1];var i=0;this.itemGroup.visible=!1,Hungu.ins().hunguData[this.roleSelect]&&(this.itemGroup.visible=!0,i=Hungu.ins().hunguData[this.roleSelect].items[this.pos].itemId,i&&(this.scroll.y=160,this.scroll.height=410,this.wearItem=new HunguEquipChooseItem,this.itemGroup.addChild(this.wearItem),this.wearItem.data={id:i,roleId:this.roleSelect},this.wearItem.setWearVisible(!0))),this.itemList=this.getHunguItemList(this.roleSelect,this.pos),this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.validateNow()},e.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)},e.prototype.getHunguItemList=function(t,e){for(var i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_24),n=[],s=0;s<i.length;s++){var o=Hungu.ins().getHunguItemsPos(i[s].itemConfig.id);o==e&&n.push({id:i[s].configID,roleId:this.roleSelect})}return n.sort(function(t,e){var i=GlobalConfig.HunGuEquip[t.id],n=GlobalConfig.HunGuEquip[e.id];return i.stage>n.stage?-1:1}),n},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(HunguChooseEquipWin.prototype,"HunguChooseEquipWin"),ViewManager.ins().reg(HunguChooseEquipWin,LayerManager.UI_Popup),window.HunguChooseEquipWin=HunguChooseEquipWin;var HunguEquipChooseItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguChooseItem",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.changeBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data&&this.data.id&&!isNaN(this.data.roleId)){var t=BagCT.getAttrPower(GlobalConfig.HunGuEquip[this.data.id].attrs),e=GlobalConfig.HunGuEquip[this.data.id].expower;e=e?e:0,t+=e,this.now.visible=!1,this.power.text="评分："+t;var i=GlobalConfig.ItemConfig[this.data.id],n=ItemUtil.getQualityColor(i);this.quality.textFlow=TextFlowMaker.generateTextFlow1("|C:"+n+"&T:"+Hungu.ins().getHunguItemQualityName(i.id)),this.itemIcon.setData(i);for(var s=0;3>s;s++)if(this["group"+s]&&this["attr"+s])if(GlobalConfig.HunGuEquip[this.data.id].attrs[s]){if(this["group"+s].parent||this.addChild(this["group"+s]),this["attr"+s].text=AttributeData.getAttrNameByAttrbute(GlobalConfig.HunGuEquip[this.data.id].attrs[s],!0),this["betterArrow"+s]&&this["forgeAttr"+s]){this["betterArrow"+s].visible=this["forgeAttr"+s].visible=!1;var o=ItemUtil.getSubType(i);if(Hungu.ins().hunguData[this.data.roleId]&&Hungu.ins().hunguData[this.data.roleId].items[o].itemId){for(var a=Hungu.ins().hunguData[this.data.roleId].items[o].itemId,r=0;r<GlobalConfig.HunGuEquip[a].attrs.length;r++)if(GlobalConfig.HunGuEquip[a].attrs[r].type==GlobalConfig.HunGuEquip[this.data.id].attrs[s].type){GlobalConfig.HunGuEquip[a].attrs[r].value>GlobalConfig.HunGuEquip[this.data.id].attrs[s].value&&(this["betterArrow"+s].visible=this["forgeAttr"+s].visible=!0);break}}else this["betterArrow"+s].visible=this["forgeAttr"+s].visible=!0,this["forgeAttr"+s].text="+"+GlobalConfig.HunGuEquip[this.data.id].attrs[s].value}}else DisplayUtils.removeFromParent(this["group"+s])}},e.prototype.setWearVisible=function(t){void 0===t&&(t=!1),this.now.visible=t,this.changeBtn.visible=!this.now.visible},e.prototype.onClick=function(){var t=GlobalConfig.ItemConfig[this.data.id],e=ItemUtil.getSubType(t);Hungu.ins().sendHunguItems(this.data.roleId,e,this.data.id)},e}(eui.ItemRenderer);__reflect(HunguEquipChooseItem.prototype,"HunguEquipChooseItem"),window.HunguEquipChooseItem=HunguEquipChooseItem;var HunguGroupItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguGroupItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.qualityName.textFlow=TextFlowMaker.generateTextFlow1(this.data.qualityName),this.posName.textFlow=TextFlowMaker.generateTextFlow1(this.data.posName);for(var t=0;3>t;t++)this["suit"+t]&&this.data.suits[t]?this["suit"+t].textFlow=TextFlowMaker.generateTextFlow1(this.data.suits[t]):DisplayUtils.removeFromParent(this["suit"+t])}},e}(BaseItemRender);__reflect(HunguGroupItem.prototype,"HunguGroupItem"),window.HunguGroupItem=HunguGroupItem;var HunguGroupWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguGroupSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.roleId=t[0],this.id=t[1],this.updateShow()},e.prototype.updateShow=function(){this.itemData=[],this.init();var t=Hungu.ins().getSuitData(this.roleId);if(CommonUtils.getObjectLength(t)&&t[this.id]){this.itemData=[],this.suit2="",this.suit4="",this.suit6="";var e=this.getPosColorName(this.id),i=[];for(var n in t[this.id])-1==i.indexOf(t[this.id][n].stage)&&i.push(t[this.id][n].stage);for(var s="",o=0;o<i.length;o++){var a=i[o];s=GlobalConfig.HunGuConf.suitName[this.id-1][1>=a?0:a-1];var r=[],l=[];for(var n in GlobalConfig.HunGuSuit[this.id]){for(var h=0;h<t[this.id][n].count.length;h++){var u=t[this.id][n].count[h],p=ItemUtil.getSubType(GlobalConfig.ItemConfig[u]);-1==r.indexOf(p)&&r.push(p)}var c=GlobalConfig.HunGuSuit[this.id][n][a],d=0;d=t[this.id][n].stage==a&&t[this.id][n].count.length>=+n?ColorUtil.GREEN_COLOR_N:ColorUtil.GRAY_COLOR2,c||(c=GlobalConfig.HunGuSuit[this.id][n][1]),c.dec&&l.push("|C:"+d+"&T:"+n+"件:"+c.dec)}for(var g="",n=0;n<e.length;n++){var d=0;d=-1==r.indexOf(e[n])?ColorUtil.GRAY_COLOR2:ColorUtil.GREEN_COLOR_N,g+="|C:"+d+"&T:"+Hungu.ins().getHunguPosName(e[n])+"  "}this.itemData.push({qualityName:s,posName:g,suits:l})}if(1==i.length){var f=!0;if(Hungu.ins().hunguData[this.roleId])for(var n in Hungu.ins().hunguData[this.roleId].items)if(-1!=e.indexOf(Number(n))){var u=Hungu.ins().hunguData[this.roleId].items[n].itemId;if(!u||GlobalConfig.HunGuEquip[u].stage!=i[0]){f=!1;break}}if(f){var v=[];for(var n in GlobalConfig.HunGuSuit[this.id])if(t[this.id][+n]){var y=CommonUtils.getObjectLength(GlobalConfig.HunGuSuit[this.id][+n]),m=t[this.id][+n].stage;if(m!=y){for(var T=m+1,C=GlobalConfig.HunGuConf.suitName[this.id-1][1>=T?0:T-1],g="",h=0;h<e.length;h++)g+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+Hungu.ins().getHunguPosName(e[h])+"  ";for(var h in GlobalConfig.HunGuSuit[this.id]){var c=GlobalConfig.HunGuSuit[this.id][h][T];c.dec&&v.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+h+"件:"+c.dec)}this.itemData.push({qualityName:C,posName:g,suits:v});break}}}}}for(var n=0;n<this.itemData.length;n++){var b=new HunguGroupItem;b.data={qualityName:this.itemData[n].qualityName,posName:this.itemData[n].posName,suits:this.itemData[n].suits},this.content.addChild(b)}},e.prototype.getPosColorName=function(t){for(var e=[],i=0;i<GlobalConfig.HunGuConf.suit[t].length;i++)e.push(GlobalConfig.HunGuConf.suit[t][i]);return e},e.prototype.init=function(t){void 0===t&&(t=this.id);var e=1==t?"特殊":"魂骨",i="【凡品"+e+"共鸣】",n=GlobalConfig.HunGuConf.suit[t],s="";this.suit2="",this.suit4="",this.suit6="";for(var o=0;o<n.length;o++)s+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+Hungu.ins().getHunguPosName(n[o])+"  ";var a=[];for(var r in GlobalConfig.HunGuSuit[t]){var l=GlobalConfig.HunGuSuit[t][r][1];if(l.specialAttrs)a.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+r+"件:装备基础属性+"+l.specialAttrs/100+"%");else{for(var h="",u=0;u<l.attrs.length;u++)h+=AttributeData.getAttrStrByType(l.attrs[u].type)+"+"+l.attrs[u].value+"  ";l.dec&&a.push("|C:"+ColorUtil.GRAY_COLOR2+"&T:"+r+"件:"+l.dec)}}this.itemData.push({qualityName:i,posName:s,suits:a})},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(HunguGroupWin.prototype,"HunguGroupWin"),ViewManager.ins().reg(HunguGroupWin,LayerManager.UI_Popup),window.HunguGroupWin=HunguGroupWin;var HunguItemIcon=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunyuItemSkin",e}return __extends(e,t),e.prototype.setData=function(t){this.config=t,t&&(this.icon.source=t.icon+"_png")},e}(eui.Component);__reflect(HunguItemIcon.prototype,"HunguItemIcon"),window.HunguItemIcon=HunguItemIcon;var HunguStageWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguStageSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleId=t[0],this.pos=t[1],this.getItemList.itemRenderer=ItemBase,this.addTouchEvent(this.lvUpBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.observe(Hungu.ins().postHunguItemUpgrade,this.updateUI),this.attrNow=[this.attr1Now0,this.attr2Now0,this.attr3Now0],this.arrtNext=[this.attr1Next0,this.attr2Next0,this.attr3Next0],this.updateUI()},e.prototype.updateUI=function(){var t=Hungu.ins(),e=t.getCurHunguId(this.roleId,this.pos),i=t.getNextHunguId(this.roleId,this.pos),n=GlobalConfig.HunGuEquip[e],s=GlobalConfig.HunGuEquip[i];for(var o in this.attrNow)n&&n.attrs[o]?(this.attrNow[o].visible=!0,this.attrNow[o].text=this.parserStr(n.attrs[o])):this.attrNow[o].visible=!1,s&&s.attrs[o]?(this.arrtNext[o].visible=!0,this.arrtNext[o].text=this.parserStr(s.attrs[o])):this.arrtNext[o].visible=!1;var a=n&&n.hunyuNum?n.hunyuNum:0,r=s&&s.hunyuNum?s.hunyuNum:0;if(this.hunyuNow.text="魂玉数量："+a,this.hunyuNext.text="魂玉数量："+r,this.redPoint.visible=t.getUpgradeRedPoint(n&&n.id?n.id:0),n&&n.addStageCost){this.getItemList.dataProvider=new eui.ArrayCollection(n.addStageCost),this.getItemList.validateNow();for(var o=0;o<this.getItemList.numElements;o++){var l=this.getItemList.getVirtualElementAt(o),h=this.getItemList.dataProvider.getItemAt(o),u=ColorUtil.GREEN_COLOR_N,p=BagCT.ins().getBagItemById(h.id),c=p?p.count:0;c<h.count&&(u=ColorUtil.RED_COLOR_N),l.setName("|C:"+u+"&T:"+c+"/"+h.count)}}if(n){this.nowItemIcon.data=n.id,this.nowItemIcon.isShowJob(!1),this.nowItemIcon.showNum(!1);var d=0;d+=BagCT.getAttrPower(n.attrs);var g=n.expower?n.expower:0;d+=g,this.powerPanel0.setPower(d)}if(s){this.nextItemIcon.data=s.id,this.nextItemIcon.isShowJob(!1),this.nextItemIcon.showNum(!1);var d=0;d+=BagCT.getAttrPower(s.attrs);var g=s.expower?s.expower:0;d+=g,this.powerPanel1.setPower(d)}},e.prototype.parserStr=function(t){return AttributeData.getAttrStrByType(t.type)+":"+t.value},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.lvUpBtn:this.redPoint.visible?Hungu.ins().sendHunguItemUpgrade(this.roleId,this.pos):TipsCT.ins().showTips("材料不足");break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunguStageWin.prototype,"HunguStageWin"),ViewManager.ins().reg(HunguStageWin,LayerManager.UI_Popup),window.HunguStageWin=HunguStageWin;var HunguTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="hunguTipsSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currentState=t[0]?"shenshang":"putong",this.validateNow(),this.addTouchEvent(this.bgClose,this.onTap),"shenshang"==this.currentState&&(this.addTouchEvent(this.takeoffBtn,this.onTap),this.addTouchEvent(this.changeBtn,this.onTap),this.addTouchEvent(this.hunyuBtn,this.onTap),this.wear=!0),this.observe(Hungu.ins().postHunguItems,this.HunguItemsCallback),this.observe(Hungu.ins().postHunguItemUpgrade,this.HunguItemUpgradeCallback),this.roleId=t[1],this.itemId=t[2],this.updateUI()},e.prototype.HunguItemsCallback=function(){ViewManager.ins().close(this)},e.prototype.HunguItemUpgradeCallback=function(){var t=ItemUtil.getSubType(GlobalConfig.ItemConfig[this.itemId]);this.itemId=Hungu.ins().hunguData[this.roleId].items[t].itemId,this.updateUI()},e.prototype.updateUI=function(){var t=GlobalConfig.ItemConfig[this.itemId];this.equipIcon.setData(t);var e=ItemUtil.getQualityColor(t);this.nameTxt.textFlow=TextFlowMaker.generateTextFlow1("|C:"+e+"&T:"+t.name);var i=ItemUtil.getQuality(t);this.quali.source=i>0?"quali"+i:"",this.toubuhungu.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguPosName(ItemUtil.getSubType(t))),this.fanpin.textFlow=TextFlowMaker.generateTextFlow1(""+Hungu.ins().getHunguItemQualityName(t.id)),this.tongyong.textFlow=TextFlowMaker.generateTextFlow1(""+Role.getJobNameByJob(ItemUtil.getJob(t)));var n=0,s=Hungu.ins().getSuitData(this.roleId);n+=this.wear?Hungu.ins().getHunguPosPower(this.roleId,ItemUtil.getSubType(t),s,!0):Hungu.ins().getHunguItemPower(t.id),this.powerPanel.setPower(n);for(var o=[],a=[],r=[],l=GlobalConfig.HunGuEquip[this.itemId],h=0;h<l.attrs.length;h++){for(var u=!1,p=0;p<o.length;p++)if(o[p].type==l.attrs[h].type){o[p].value+=l.attrs[h].value,u=!0;break}u||o.push(new AttributeData(l.attrs[h].type,l.attrs[h].value))}if(this.wear&&Hungu.ins().hunguData[this.roleId]){var c=[];for(var d in s)for(var h in s[d])if(s[d][h].count.length>=+h){var g=s[d][h].stage,f=GlobalConfig.HunGuSuit[d][h][g];f&&f.specialAttrs&&c.push(f.specialAttrs/1e4)}if(c.length)for(var d=0;d<c.length;d++)for(var h=0;h<o.length;h++)a.push(new AttributeData(o[h].type,Math.floor(o[h].value*c[d])));this.updateRedPoint();for(var d=0;d<Hungu.ins().hunguData[this.roleId].items[ItemUtil.getSubType(t)].hunyu.length;d++){var v=Hungu.ins().hunguData[this.roleId].items[ItemUtil.getSubType(t)].hunyu[d],y=GlobalConfig.HunGuConf.hunyuType[ItemUtil.getSubType(t)][d],m=GlobalConfig.HunYuEquip[y][v];if(m)for(var h=0;h<m.attrs.length;h++){for(var u=!1,p=0;p<r.length;p++)if(r[p].type==m.attrs[h].type){r[p].value+=m.attrs[h].value,u=!0;break}u||r.push(new AttributeData(m.attrs[h].type,m.attrs[h].value))}}}for(var T=[2,4,5,6],C=0,b=0,d=0;d<T.length;d++){if(this["attr"+d]&&this["forgeAttr"+d]&&(this["attr"+d].visible=this["forgeAttr"+d].visible=!1),this["starAttr"+d]&&(this["starAttr"+d].visible=!1),this["attr"+C]&&this["forgeAttr"+C]){this["attr"+C].visible=this["forgeAttr"+C].visible=!1;for(var h=0;h<o.length;h++)if(o[h].type==T[d]){this["attr"+C].visible=!0,this["attr"+C].text=AttributeData.getAttStr(o[h],0,1,":"),"shenshang"==this.currentState&&a[h]&&(this["forgeAttr"+C].visible=!0,this["forgeAttr"+C].text="+"+a[h].value);break}this["attr"+C].visible&&C++}if(this["starAttr"+b]){this["starAttr"+b].visible=!1;for(var h=0;h<r.length;h++)if(r[h].type==T[d]){this["starAttr"+b].visible=!0,this["starAttr"+b].text=AttributeData.getAttStr(r[h],0,1,":");break}this["starAttr"+b].visible&&b++}}for(var d=0;3>=d;d++)this["attr"+d]&&!this["attr"+d].visible&&DisplayUtils.removeFromParent(this["attr"+d].parent),this["starAttr"+d]&&!this["starAttr"+d].visible&&DisplayUtils.removeFromParent(this["starAttr"+d]);this.starAttr.numElements<=1&&DisplayUtils.removeFromParent(this.starAttr)},e.prototype.updateRedPoint=function(){var t=GlobalConfig.ItemConfig[this.itemId],e=ItemUtil.getSubType(t);this.changeRedPoint.visible=Hungu.ins().getUpgradeRedPoint(t.id),this.takeoffRP.visible=!1;var i=Hungu.ins().getHunguItemsList(e);if(i.length&&Hungu.ins().hunguData[this.roleId]&&Hungu.ins().hunguData[this.roleId].items[e].itemId){var n=GlobalConfig.HunGuEquip[Hungu.ins().hunguData[this.roleId].items[e].itemId].stage;GlobalConfig.HunGuEquip[i[0].configID].stage>n&&(this.takeoffRP.visible=!0)}this.forgeRedPoint.visible=Hungu.ins().getHunyuRedPoint(this.roleId,e)},e.prototype.onTap=function(t){var e=GlobalConfig.ItemConfig[this.itemId],i=ItemUtil.getSubType(e);switch(t.currentTarget){case this.takeoffBtn:if("shenshang"!=this.currentState)return void TipsCT.ins().showTips("不在身上卸载异常");if(Hungu.ins().hunguData[this.roleId]&&Hungu.ins().hunguData[this.roleId].items[i])return void Hungu.ins().sendHunguItems(this.roleId,i,0);TipsCT.ins().showTips("没有可卸载的装备");break;case this.changeBtn:Hungu.ins().getNextHunguId(this.roleId,i)?ViewManager.ins().open(HunguStageWin,this.roleId,i):TipsCT.ins().showTips("已满级");break;case this.hunyuBtn:if("shenshang"!=this.currentState)return void TipsCT.ins().showTips("不在身上魂玉异常");ViewManager.ins().open(HunyuWin,this.roleId,this.itemId);break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunguTipsWin.prototype,"HunguTipsWin"),ViewManager.ins().reg(HunguTipsWin,LayerManager.UI_Popup),window.HunguTipsWin=HunguTipsWin;var HunguWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wireEffs=[],e}return __extends(e,t),e.prototype.removeDisplay=function(){if(this.skin){this.cleanWireEff();for(var t=0;t<GlobalConfig.HunGuConf.equipCount;t++)this.cleanEff(t)}},e.prototype.skinComplete=function(){this.addTouchEvent(this.getItemTxt0,this.onTap),this.addTouchEvent(this.executeBtn,this.onTap),this.addTouchEvent(this.executeBtn0,this.onTap),this.addTouchEvent(this.xiangxishuxing,this.onTap),this.addTouchEvent(this.fenjie,this.onTap);for(var t=0;t<GlobalConfig.HunGuConf.equipCount;t++)this.addTouchEvent(this["equip"+t],this.onSelect);this.posXian0=[this.HGliangxianzhi0,this.HGliangxianxie0],this.posXian1=[this.HGliangxianzhi1],this.posXian2=[this.HGliangxianzhi2,this.HGliangxianxie2],this.posXian3=[this.HGliangxianzhi3,this.HGliangxianxie3],this.posXian4=[this.HGliangxianzhi4,this.HGliangxianxie4],this.posXian5=[this.HGliangxianzhi5,this.HGliangxianxie5],this.posXian6=[this.HGliangxianzhi6,this.HGliangxianxie6],this.posXian7=[this.HGliangxianzhi7,this.HGliangxianxie7],this.effectPos=[this.effectPos0,this.effectPos1,this.effectPos2,this.effectPos3,this.effectPos4,this.effectPos5,this.effectPos6,this.effectPos7],this.liangdian=[this.liangdian0,this.liangdian1,this.liangdian2,this.liangdian3,this.liangdian4,this.liangdian5,this.liangdian6,this.liangdian7];var e=new MovieClip;e.playFile(RES_DIR_EFF+"PromptEFF2",-1),this.effect1quanshen.addChild(e),this.curRole=this.curRole},e.prototype.addDisplay=function(){this.observe(HunguRedPoint.ins().postRoleRedPoint,this.updateUI),this.observe(Hungu.ins().postNothing2Wear,this.HunguItemsResult),this.observe(Hungu.ins().postWear2Noting,this.HunguItemsResult),this.updateEff()},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.updateEff(),this.updateUI())},enumerable:!0,configurable:!0}),e.prototype.updateEff=function(){var t=Hungu.ins().hunguData[this.curRole];if(t){for(var e=!0,i=0;8>i;i++)if(t.items[i].itemId){for(var n in this["posXian"+i])this["posXian"+i][n].visible=!0;this.liangdian[i].visible=!0}else e=!1;var s=[null,this.effect2toubu,this.effect3xia];for(var o in GlobalConfig.HunGuConf.suit){var a=+o;if(a&&s[a]){var r=Hungu.ins().getSuitData(this.curRole);for(var i in r[a])if(!(r[a][i].count.length<+i)){var l=r[a][i].stage,h=GlobalConfig.HunGuSuit[a][i][l];if(h.effectId){var u=void 0;s[a].numElements?u=s[a].getChildAt(0):(u=new MovieClip,s[a].addChild(u)),u.playFile(RES_DIR_EFF+h.effectId,-1)}}}}}},e.prototype.onSelect=function(t){for(var e=0;e<GlobalConfig.HunGuConf.equipCount;e++)if(this["equip"+e]&&(this["equip"+e].select.visible=!1,t.currentTarget==this["equip"+e])){this.pos=e,this["equip"+e].select.visible=!0;var i=Hungu.ins().hunguData[this.curRole];if(i&&i.items[e].itemId)ViewManager.ins().open(HunguTipsWin,!0,this.curRole,i.items[e].itemId);else{var n=Hungu.ins().getHunguItemsList(e);n.length?Hungu.ins().sendHunguItems(this.curRole,e,n[0].configID):TipsCT.ins().showTips("未拥有当前部位魂骨")}}},e.prototype.updateUI=function(){for(var t=Hungu.ins(),e=t.getResonancePower(this.curRole),i=t.getSuitData(this.curRole),n=0;n<GlobalConfig.HunGuConf.equipCount;n++)this.updateItem(n),e+=t.getHunguPosPower(this.curRole,n,i,!0),this.powerPanel0.setPower(e);this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)},e.prototype.updateItem=function(t){void 0===t&&(t=0);var e=this["equip"+t];if(e){var i=Hungu.ins(),n=e.itemIcon;n.imgJob.visible=!1,e.level.visible=!1,n.imgIcon.source="hungu"+t,e.select.visible=this.pos==t,n.imgBg.source=1>=t?"wupingkuangNB":"quality0";var s=i.hunguData[this.curRole];if(s&&s.items[t].itemId){var o=s.items[t].itemId,a=GlobalConfig.ItemConfig[o];n.imgIcon.source=a.icon+"_png",e.level.visible=!0;var r=0;for(var l in s.items[t].hunyu)r+=s.items[t].hunyu[l];e.level.text=r+"级"}else for(var h in this["posXian"+t])this["posXian"+t][h].visible=!1;e.redPoint.visible=this.getRedPoint(t)}},e.prototype.getRedPoint=function(t){return HunguRedPoint.ins().HunguItemRedPoint(this.curRole,t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.getItemTxt0:WarnCT.ins().setBuyGoodsWarn(GlobalConfig.HunGuConf.gainItemId);break;case this.executeBtn:ViewManager.ins().open(HunguGroupWin,this.curRole,1);break;case this.executeBtn0:ViewManager.ins().open(HunguGroupWin,this.curRole,2);break;case this.xiangxishuxing:ViewManager.ins().open(HunguAttrWin,this.curRole);break;case this.fenjie:ViewManager.ins().open(SmeltItemTotalWin,this.getSmeltList())}},e.prototype.getSmeltList=function(){var t=[],e=GlobalConfig.HunGuConf.canFenjieItem;for(var i in e){var n=BagCT.ins().getBagItemById(e[i]);n&&t.push(n)}return t},e.prototype.HunguItemsResult=function(t){var e=t[0],i=t[1];e?this.playEff(i):this.cleanEff(i)},e.prototype.cleanEff=function(t){void 0===t&&(t=0);for(var e in this["posXian"+t])this["posXian"+t][e].visible=!1;this.liangdian[t].visible=!1;var i=0,n=GlobalConfig.HunGuConf.suit;for(var e in n)if(n[e].length&&~n[e].indexOf(t)){i=+e;break}var s=[null,this.effect2toubu,this.effect3xia];if(s[i])for(;s[i].numChildren>0;){var o=s[i].getChildAt(0);o instanceof MovieClip&&o.stop(),DisplayUtils.removeFromParent(o)}},e.prototype.playEff=function(t){void 0===t&&(t=0);var e=1e3,i=[],n=0;for(var s in this["posXian"+t])n+=this["posXian"+t][s].width,this["posXian"+t][s].scrollRect=new egret.Rectangle(0,0,0,this["posXian"+t][s].height),this["posXian"+t][s].visible=!0;var o=0;for(var s in this["posXian"+t])+s==this["posXian"+t].length-1?i[s]=e-o:(i[s]=this["posXian"+t][s].width/n*e,o+=i[s]);this.playWireEff(this["posXian"+t],i,0,t);var a=[null,this.effect2toubu,this.effect3xia],r=0,l=GlobalConfig.HunGuConf.suit;for(var s in l)if(l.length&&~l[s].indexOf(t)){r=+s;break}if(a[r]){var h=Hungu.ins().getSuitData(this.curRole);for(var s in h[r])if(!(h[r][s].count.length<+s)){var u=h[r][s].stage,p=GlobalConfig.HunGuSuit[r][s][u];if(p.effectId){var c=void 0;a[r].numElements?c=a[r].getChildAt(0):(c=new MovieClip,a[r].addChild(c)),c.playFile(RES_DIR_EFF+p.effectId,-1)}}}},e.prototype.playWireEff=function(t,e,i,n){var s=this;if(void 0===i&&(i=0),void 0===n&&(n=0),t[i]){var o=egret.Tween.get(t[i].scrollRect);o.to({width:t[i].width},e[i]).call(function(){if(egret.Tween.removeTweens(o),t[i].scrollRect.width=t[i].width,i++,i>=t.length){var a=new MovieClip;a.playFile(RES_DIR_EFF+"NeigongEff2",1),s.effectPos[n].addChild(a),s.liangdian[n].visible=!0}else s.playWireEff(t,e,i,n)},this),this.wireEffs[n]||(this.wireEffs[n]=[]),this.wireEffs[n][i]&&egret.Tween.removeTweens(this.wireEffs[n][i]),this.wireEffs[n][i]=o}},e.prototype.cleanWireEff=function(){if(this.wireEffs)for(var t=0;t<this.wireEffs.length;t++)if(this.wireEffs[t])for(var e in this.wireEffs[t])egret.Tween.removeTweens(this.wireEffs[t][e])},e}(BaseView);__reflect(HunguWin.prototype,"HunguWin"),window.HunguWin=HunguWin;var HunyuWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="hunguJewelSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().close(HunguTipsWin),this.addTouchEvent(this.executeBtn0,this.onTap),this.addTouchEvent(this.executeBtn,this.onTap),this.addTouchEvent(this.getItemTxt0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Hungu.ins().postHunyu,this.updateShow),this.observe(Hungu.ins().postHunyu,this.playEff);for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++)this.addTouchEvent(this["equip"+i],this.onSelect);this.roleId=t[0],this.itemId=t[1],this.kong=t[2]||0,this["equip"+this.kong].select.visible=!0,this.updateShow()},e.prototype.onSelect=function(t){for(var e=0;e<GlobalConfig.HunGuConf.hunyuCount;e++){var i=this["equip"+e];if(i.select.visible=!1,i&&t.currentTarget==i){var n=GlobalConfig.ItemConfig[this.itemId],s=ItemUtil.getSubType(n);if(e+1>GlobalConfig.HunGuEquip[Hungu.ins().hunguData[this.roleId].items[s].itemId].hunyuNum){var o=Hungu.ins().getHunguItemQualityName(0,e+1);o&&TipsCT.ins().showTips("融合"+o+"魂骨后开启"),this["equip"+this.kong].select.visible=!0}else this.kong!=e?(i.select.visible=!0,this.kong=e,this.updateShow()):i.select.visible=!0}}},e.prototype.updateShow=function(){this.updateAct(),this.updateUI(),this.getItemTxt0.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt0.text)},e.prototype.playEff=function(){var t=this["equip"+this.kong];if(t){var e=new MovieClip;e.playFile(RES_DIR_EFF+"UpEff1",1),t.eff.addChild(e)}},e.prototype.updateUI=function(){this.hide(),this.updateItems()},e.prototype.updateItems=function(){var t=this.equip,e=t.itemIcon,i=GlobalConfig.ItemConfig[this.itemId];e.setData(i);for(var n=ItemUtil.getSubType(i),s=Hungu.ins(),o=0;o<GlobalConfig.HunGuConf.hunyuCount;o++){var a=this["equip"+o],r=a.openText;if(a){var l=s.getHunyuKongRedPoint(this.roleId,n,o);a.redPoint.visible=l;var h=a.itemIcon;h.icon.visible=!1,a.kejihuo.visible=!1,h.lock.visible=!1,r.visible=!1,a.level.visible=!1,a.lvBg.visible=!0;var u=GlobalConfig.HunGuEquip[s.hunguData[this.roleId].items[n].itemId].hunyuNum;if(o+1>u)if(h.lock.visible=!0,o==u){r.visible=!0;var p=Hungu.ins().getHunguItemQualityName(0,o+1);p&&(r.text=p+"开启")}else a.lvBg.visible=!1;else{a.level.visible=!0,h.icon.visible=!0;var c=s.hunguData[this.roleId].items[n].hunyu[o];if(c){var d=GlobalConfig.HunGuConf.hunyuType[n][o];h.icon.source=GlobalConfig.HunYuEquip[d][c].icon,a.level.text=c+"级"}else a.level.text="0级",l&&(a.kejihuo.visible=!0,h.icon.visible=!1,a.lvBg.visible=!1,a.level.visible=!1)}}}var g=0;if(s.hunguData[this.roleId]&&s.hunguData[this.roleId].items[n].hunyu)for(var f=GlobalConfig.HunGuConf.hunyuType[n][this.kong],o=0;o<s.hunguData[this.roleId].items[n].hunyu.length;o++){var v=s.hunguData[this.roleId].items[n].hunyu[o],y=GlobalConfig.HunYuEquip[f][v];if(y){g+=BagCT.getAttrPower(y.attrs,SubRoles.ins().getSubRoleByIndex(this.roleId));var m=y.expower?y.expower:0;g+=m}}this.powerPanel0.setPower(g);var T=GlobalConfig.HunGuConf.hunyuType[n][this.kong];if("activation"==this.currentState){var C=GlobalConfig.HunYuEquip[T][1],b=GlobalConfig.HunGuConf.unlockCost[this.kong+1],I=ColorUtil.RED_COLOR_N;
if(b)this.actRMB=!0,this.icon0.source="szyuanbao",Actor.yb>=b&&(I=ColorUtil.GREEN_COLOR_N),this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+Actor.yb+"|/"+b);else{this.actRMB=!1,b=C.cost.count;var w=BagCT.ins().getBagItemById(C.cost.id),S=w?w.count:0;S>=b&&(I=ColorUtil.GREEN_COLOR_N),this.icon0.source=GlobalConfig.ItemConfig[C.cost.id].icon+"_png",this.countLabel0.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+S+"|/"+b)}this.name0.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][1].name),this.att0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][1].attrs,1)}else if("max"==this.currentState){var v=s.hunguData[this.roleId].items[n].hunyu[this.kong];this.name1.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v].name),this.att1.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v].attrs,1)}else{var v=s.hunguData[this.roleId].items[n].hunyu[this.kong];this.curname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v].name),this.curAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v].attrs,1),this.nextname.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HunYuEquip[T][v+1].name),this.nextAtt0.text=AttributeData.getAttStr(GlobalConfig.HunYuEquip[T][v+1].attrs,1);var _=Hungu.ins().getNextHunyuLvConfig(this.roleId,n,this.kong);if(_){var I=ColorUtil.RED_COLOR_N,B=_.cost.count,w=BagCT.ins().getBagItemById(_.cost.id),D=w?w.count:0;D>=B&&(I=ColorUtil.GREEN_COLOR_N),this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+I+"&T:"+D+"|/"+B),this.icon1.source=GlobalConfig.ItemConfig[_.cost.id].icon+"_png"}}},e.prototype.hide=function(){var t=this.equip,e=t.itemIcon;t.level.visible=!1;for(var i=0;i<GlobalConfig.HunGuConf.hunyuCount;i++){var n=this["equip"+i];e=n.itemIcon,n.level.visible=!1}},e.prototype.updateAct=function(){var t=Hungu.ins(),e=GlobalConfig.ItemConfig[this.itemId],i=ItemUtil.getSubType(e);if(t.hunguData[this.roleId]&&t.hunguData[this.roleId].items[i].hunyu[this.kong]){var n=GlobalConfig.HunGuConf.hunyuType[i][this.kong],s=t.hunguData[this.roleId].items[i].hunyu[this.kong];s>=CommonUtils.getObjectLength(GlobalConfig.HunYuEquip[n])?this.currentState="max":this.currentState="upgrade"}else this.currentState="activation";this.validateNow()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.executeBtn0:if("activation"==this.currentState)if(this.actRMB){var e=GlobalConfig.HunGuConf.unlockCost[this.kong+1];if(Actor.yb>=e){var i=GlobalConfig.ItemConfig[this.itemId],n=ItemUtil.getSubType(i);Hungu.ins().sendHunyu(this.roleId,n,this.kong+1)}else TipsCT.ins().showTips("元宝不足")}else{var s=GlobalConfig.ItemConfig[this.itemId],o=ItemUtil.getSubType(s),a=GlobalConfig.HunGuConf.hunyuType[o][this.kong],r=GlobalConfig.HunYuEquip[a][1],l=BagCT.ins().getBagItemById(r.cost.id),h=l?l.count:0;h>=r.cost.count?Hungu.ins().sendHunyu(this.roleId,o,this.kong+1):TipsCT.ins().showTips("材料不足")}else TipsCT.ins().showTips("非可激活状态");break;case this.executeBtn:if("upgrade"==this.currentState){var i=GlobalConfig.ItemConfig[this.itemId],n=ItemUtil.getSubType(i),u=Hungu.ins().getNextHunyuLvConfig(this.roleId,n,this.kong);if(u&&u.cost){var l=BagCT.ins().getBagItemById(u.cost.id),p=l?l.count:0;p>=u.cost.count?Hungu.ins().sendHunyu(this.roleId,n,this.kong+1):TipsCT.ins().showTips("材料不足")}else TipsCT.ins().showTips("魂玉消耗数据异常")}else TipsCT.ins().showTips("非可升级状态");break;case this.getItemTxt0:if("upgrade"==this.currentState){var i=GlobalConfig.ItemConfig[this.itemId],n=ItemUtil.getSubType(i),c=GlobalConfig.HunGuConf.hunyuType[n][this.kong],d=Hungu.ins().hunguData[this.roleId].items[n].hunyu[this.kong],u=GlobalConfig.HunYuEquip[c][d+1];u&&u.cost&&WarnCT.ins().setBuyGoodsWarn(u.cost.id)}else TipsCT.ins().showTips("非获取道具状态");break;case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(HunyuWin.prototype,"HunyuWin"),ViewManager.ins().reg(HunyuWin,LayerManager.UI_Main),window.HunyuWin=HunyuWin;var KuaFuRankData=function(){function t(){this.actorId=0,this.rmb=0,this.rank=0,this.serverName=0,this.serverId=0,this.roleName="",this.job=0,this.sex=0}return t}();__reflect(KuaFuRankData.prototype,"KuaFuRankData"),window.KuaFuRankData=KuaFuRankData;var KfCostRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostRankItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){this.data&&this.data instanceof KuaFuRankData?(this.pos.text=this.data.rank+"",this.player.text="s"+this.data.serverName+"."+this.data.roleName,this.value.text="已消费："+this.data.rmb):this.data&&this.data instanceof QiongQiRankData&&(this.pos.text=this.data.rank+"",this.player.text="s"+this.data.serverId+"."+this.data.roleName,this.value.text=""+GlobalConfig.ActivityBaseConfig.Type54Item+this.data.level)},e}(BaseItemRender);__reflect(KfCostRankItemRender.prototype,"KfCostRankItemRender"),window.KfCostRankItemRender=KfCostRankItemRender;var KfCostRankRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ISCostRewardItemSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.reward.itemRenderer=ItemBase},e.prototype.onClick=function(t){},e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.pos.text=t.rank+"",this.need.text=t.desc,this.reward.dataProvider=new eui.ArrayCollection(t.rewards)}},e}(BaseItemRender);__reflect(KfCostRankRewardItemRender.prototype,"KfCostRankRewardItemRender"),window.KfCostRankRewardItemRender=KfCostRankRewardItemRender;var KfRankPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e.actorIds=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Activity.ins().postKuaFuRank,this.updateData),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.addTouchEvent(this.rechargeBtn,this.onClick),Timer.start(1e3,0,this.setTime,this),this.activityID=t[0],this.list.itemRenderer=KfCostRankItemRender,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,Activity.ins().sendKuaFuRank(this.activityID)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.rechargeBtn:ViewManager.ins().open(Recharge1Win)}},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=t.GetRankList();if(e.length?this.currentState="normal":this.currentState="none",this.validateNow(),this.myNumber.text=t.mycost+"",this.myRanking.text="未上榜","none"!=this.currentState){var i=[],n=e.length>3?e.length:3;this.actorIds=[];for(var s=0,o=0;n>o;o++){var a=e[o];if(3>o){if(a&&a.actorId){var r={actorId:a.actorId,serverId:a.serverId};this.actorIds.push(r),this["playName"+o].text="s"+a.serverName+"."+a.roleName,this["recharge"+o].text="已消费："+a.rmb,this["playName"+o].visible=this["recharge"+o].visible=!0}else{var r={actorId:0,serverId:0};this.actorIds.push(r),this["playName"+o].visible=this["recharge"+o].visible=!1}this["rank"+o].data=null}else a&&i.push(a);a&&Actor.actorID==a.actorId&&(s=a.rank)}for(var l=0;l<this.actorIds.length;l++)this.actorIds[l]&&this.actorIds[l].actorId&&ReadPlayerCT.ins().sendFindPlayer(this.actorIds[l].actorId,this.actorIds[l].serverId);this.listdata.replaceAll(i),this._time=t.getleftTime(),this.myNumber.text=t.mycost+"",this.myRanking.text=s?s+"":"未上榜";var h=this.list.parent;h.stopAnimation(),this.list.scrollV=0,this.setTime()}}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.actorIds.length;e++)this.actorIds[e].actorId==t.id&&(this["rank"+e].data={otherPlayerData:t})},e}(BaseView);__reflect(KfRankPanel.prototype,"KfRankPanel"),window.KfRankPanel=KfRankPanel;var KfRankRewardPanel=function(t){function e(){var e=t.call(this)||this;return e._time=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.close=function(){Timer.stopAll(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.activityID=t[0],this.list.itemRenderer=KfCostRankRewardItemRender,this.listdata=new eui.ArrayCollection,this.list.dataProvider=this.listdata,this.updateData()},e.prototype.updateData=function(){var t=Activity.ins().activityData[this.activityID];if(t){var e=GlobalConfig.ActivityType19Config[this.activityID],i=[];for(var n in e){var s="";s=e[n].range[0]==e[n].range[1]?""+e[n].range[0]:e[n].range[0]+"-"+e[n].range[1];var o=e[n].condition?"（消费≥"+e[n].condition+"元宝即可参与本排行）":"",a=e[n].rewards,r={rank:s,desc:o,rewards:a};i.push(r)}this.listdata.replaceAll(i),this._time=t.getleftTime();var l=this.list.parent;l.stopAnimation(),this.list.scrollV=0,this.setTime();var h=GlobalConfig.ActivityConfig[this.activityID];this.actInfo.textFlow=TextFlowMaker.generateTextFlow1(""+h.desc)}},e.prototype.setTime=function(){this._time>0&&(this._time-=1,this.actTime.text=DateUtils.getFormatBySecond(this._time,DateUtils.TIME_FORMAT_5,3))},e}(eui.Component);__reflect(KfRankRewardPanel.prototype,"KfRankRewardPanel"),window.KfRankRewardPanel=KfRankRewardPanel;var KillBossCT=function(t){function e(){var e=t.call(this)||this;return e.observe(GameLogic.ins().postEnterMap,e.update),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.update=function(){GameMap.fbType==FbCT.FB_TYPE_XUANWU||GameMap.fbType==FbCT.FB_TYPE_GOD_WEAPON||GameMap.fbType==FbCT.FB_TYPE_STARBOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS||GameMap.fbType==FbCT.FB_TYPE_KF_BOSS2||GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.fbType==FbCT.FB_TYPE_GUILDFB||ViewManager.ins().isShow(KillBossBtnWin)&&ViewManager.ins().close(KillBossBtnWin)},e}(BaseSystem);__reflect(KillBossCT.prototype,"KillBossCT"),System.KillBossCT=function(){return KillBossCT.ins()},window.KillBossCT=KillBossCT;var KillBossBtnWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KillBossBtnSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this.eKillBossBtn,this.onClick),this.touchEnabled=!1},e.prototype.onClick=function(t){ViewManager.ins().open(KillBossWin)},e}(BaseEuiView);__reflect(KillBossBtnWin.prototype,"KillBossBtnWin"),window.KillBossBtnWin=KillBossBtnWin,ViewManager.ins().reg(KillBossBtnWin,LayerManager.UI_Main);var KillBossItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="KillBossItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eBg.source=t.bg,this.jihuo.visible=t.isActive,this.btn.visible=!this.jihuo.visible}},e}(BaseItemRender);__reflect(KillBossItemRender.prototype,"KillBossItemRender"),window.KillBossItemRender=KillBossItemRender;var KillBossWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="KillbossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=KillBossItemRender,this.cfgs=[];var t=GlobalConfig.AdditionBossConfig;for(var e in t){var i=t[e];i.open&&1==i.open&&!urlParam.isMiniGame||this.cfgs.push(i)}},e.prototype.addDisplay=function(){this.addTouchEvent(this,this.onClick),this.update()},e.prototype.onClick=function(t){if(t.target.parent.parent instanceof KillBossItemRender){var e=t.target.parent.parent.data;ViewManager.ins().open(e.turn[0],e.turn[1],e.turn[2]),ViewManager.ins().close(this)}else t.target==this.closeBtn&&ViewManager.ins().close(this)},e.prototype.update=function(){var t=0;for(var e in this.cfgs){switch(this.cfgs[e].id){case 1:var i=Recharge.ins().getRechargeData(0);this.cfgs[e].isActive=!(!i||2!=i.num);break;case 2:this.cfgs[e].isActive=Recharge.ins().monthDay>0;break;case 3:this.cfgs[e].isActive=Recharge.ins().franchise>0;break;case 4:this.cfgs[e].isActive=Recharge.ins().weekDay>0}t+=this.cfgs[e].isActive?this.cfgs[e].add:0}this.jiacheng.text="当前boss伤害加成："+t+"%",this.eList.dataProvider=new eui.ArrayCollection(this.cfgs)},e}(BaseEuiView);__reflect(KillBossWin.prototype,"KillBossWin"),window.KillBossWin=KillBossWin,ViewManager.ins().reg(KillBossWin,LayerManager.UI_Popup);var Ladder=function(t){function e(){var e=t.call(this)||this;return e.isCanReward=!1,e.upLevel=0,e.upId=0,e.upWin=0,e.todayBuyTime=0,e.upWeekRank=0,e.upRankList=[],e._actorInfo=[],e.sysId=PackageID.Ladder,e.regNetMsg(1,e.doLadderInfo),e.regNetMsg(2,e.doGetPlayer),e.regNetMsg(3,e.doPlayResule),e.regNetMsg(5,e.postRankInfoList),e.regNetMsg(6,e.doChallageNum),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=e.ins().isCanReward||e.ins().isOpen?e.ins().challgeNum>0:!1;return t},e.prototype.getActorInfo=function(t){return void 0===t&&(t=-1),-1==t?this._actorInfo:this._actorInfo[t]},e.prototype.sendGetSomeOne=function(){this.sendBaseProto(2)},e.prototype.sendStarPlay=function(t,e){var i=this.getBytes(3);i.writeInt(e),i.writeInt(t),this.sendToServer(i),this._actorInfo=[]},e.prototype.sendGetWeekReward=function(){this.sendBaseProto(4)},e.prototype.sendGetRankInfo=function(){this.sendBaseProto(5)},e.prototype.sendBuyChallgeTime=function(){this.sendBaseProto(6)},e.prototype.doLadderInfo=function(t){this.docodeInfo(t)},e.prototype.postTadderChange=function(){},e.prototype.doGetPlayer=function(t){var e=t.readInt(),i=t.readInt();this._actorInfo.length=0,this._actorInfo.push(e,i),i>0&&(this._actorInfo.push(t.readString()),this._actorInfo.push(t.readByte()),this._actorInfo.push(t.readByte()),this._actorInfo.push(t.readInt()),this._actorInfo.push(t.readInt()))},e.prototype.doPlayResule=function(t){this.doPlayResult(t),e.ins().postRedPoint()},e.prototype.postRankInfoList=function(t){var e=Rank.ins().getRankModel(RankDataType.TYPE_LADDER),i=t.readShort();e.getDataList().length=i;var n=e.getDataList(),s=0;for(s=0;i>s;++s)this.setRankData(n,s,t);var o=this.getMyRankInfo(n);for(e.selfPos=o?o.pos:0,this.upRankList=[],this.upweekLength=0,i=t.readShort(),s=0;i>s;++s)this.setRankData(this.upRankList,s,t,!0);return this.fillingList(),e},e.prototype.setRankData=function(t,e,i,n){void 0===n&&(n=!1),e in t||(t[e]=new RankDataLadder),t[e].parser(i,null),t[e].pos=e+1,n&&t[e].id==Actor.actorID&&(this.upWeekRank=t[e].pos)},e.prototype.doChallageNum=function(t){this.todayBuyTime=t.readInt(),e.ins().postRedPoint()},e.prototype.docodeInfo=function(t){this.isOpen=t.readBoolean(),this.level=t.readInt(),this.nowId=t.readInt(),this.challgeNum=t.readInt();var i=t.readInt();this.challgeCd=1e3*i+egret.getTimer(),this.winNum=t.readInt(),this.lianWin=t.readBoolean(),this.playUpTime=t.readBoolean(),this.playUpTime&&(this.isCanReward=t.readBoolean(),this.upLevel=t.readInt(),this.upId=t.readInt(),this.upWin=t.readInt()),e.ins().postTadderChange()},e.prototype.doPlayResult=function(t){for(var e,i=t.readBoolean(),n=t.readShort(),s=[],o=0;n>o;o++)e=new RewardData,e.parser(t),s.push(e);var a=t.readInt(),r=t.readInt(),l=t.readInt();Timer.start(1e3,1,function(){ViewManager.ins().open(LadderResultWin,i,s.reverse(),a,r,l)},this)},e.prototype.fillingList=function(){0==this.upweekLength&&(this.upweekLength=this.checkObjListLength());var t=this.upweekLength-this.upRankList.length;if(t>0)for(var e=1;t>e;e++)this.upRankList.push(null);this.configList||(this.configList=this.cloneConfigDataList(GlobalConfig.TianTiDanConfig),this.configList.reverse())},e.prototype.getUpRankList=function(){var t=[];for(var e in this.upRankList)this.upRankList[e]&&t.push(this.upRankList[e]);return t},e.prototype.checkObjListLength=function(){for(var t=1;200>t;t++)if(!GlobalConfig.TianTiRankAwardConfig[t+""])return t;return 0},e.prototype.getMyRankInfo=function(t){for(var e=0;e<t.length;e++)if(t[e].id==Actor.actorID)return t[e];return null},e.prototype.getLevelDuanWeiLength=function(t){var e=0,i=GlobalConfig.TianTiDanConfig;for(var n in i[t+""])i[t+""][n]&&e++;return e},e.prototype.getDuanWeiDesc=function(){var t="",e=this.getLevelConfig();return e&&(t=e.showLevel+this.getZhongwenNumber(e.showDan)+"段"),t},e.prototype.getLevelConfig=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=-1),-1==t&&(t=this.level),-1==e&&(e=this.nowId);var i=GlobalConfig.TianTiDanConfig;for(var n in i[t+""])if(i[t+""][n].id==e)return i[t+""][n];return null},e.prototype.creatRewardData=function(t){var e;return e=new RewardData,e.count=t.count,e.type=t.type,e.id=t.id,e},e.prototype.getZhongwenNumber=function(t){var e="";switch(t){case 1:e="一";break;case 2:e="二";break;case 3:e="三";break;case 4:e="四";break;case 5:e="五";break;case 6:e="六";break;case 7:e="七";break;case 8:e="八";break;case 9:e="九";break;case 10:e="十"}return e},e.prototype.cloneConfigDataList=function(t){var e,i=[];for(var n in t)for(var s in t[n])e=new TianTiDanConfig,e.level=parseInt(n),e.id=t[n][s].id,e.showStar=t[n][s].showStar,e.showDan=t[n][s].showDan,e.showLevel=t[n][s].showLevel,e.winAward=t[n][s].winAward,e.danAward=t[n][s].danAward,this.checkIshaveOne(i,e)&&i.push(e);return i},e.prototype.checkRedShow=function(){return this.challgeNum>0&&this.isOpen?1:0},e.prototype.checkIshaveOne=function(t,e){for(var i=t.length,n=0;i>n;n++)if(t[n].level==e.level)return!1;return!0},e.prototype.getStatuByLevel=function(t){var e;switch(t){case 1:e=3;break;case 2:e=4;break;case 3:e=5;break;case 4:e=0}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postTadderChange",null),__decorate([post()],e.prototype,"postRankInfoList",null),e}(BaseSystem);__reflect(Ladder.prototype,"Ladder"),System.Ladder=function(){return Ladder.ins()},window.Ladder=Ladder;var LadderChallengeWin=function(t){function e(){var e=t.call(this)||this;return e.num=-1,e.sendCount=0,e.skinName="ChallengeSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Rank.ins().postRankingData,this.updataHeadInfo),Ladder.ins().sendGetSomeOne(),this.setMyHead(),this.startScrollHead(),this.ingImg.visible=!0,this.enterTime.visible=!1,PlayFun.ins().closeAuto()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ingImg.visible=!0,this.enterTime.visible=!1},e.prototype.setMyHead=function(){var t=SubRoles.ins().getSubRoleByIndex(0);this.myhead.source="head_"+t.job+t.sex;var e=Ladder.ins().getLevelConfig();this.myname.text=Actor.myName,this.mylv.text=""+e.showLevel+(e.showDan||"")+"段"},e.prototype.startScrollHead=function(){this.refushROllInfo(),Timer.start(500,7,this.changestr,this)},e.prototype.changestr=function(){this.num++;var t=[".","..","..."];this.ingImg.text="正在匹配中"+t[this.num%3],this.num>=6&&(this.showPointPlayerInfo(),this.rollOver())},e.prototype.updataHeadInfo=function(t){t.type==RankDataType.TYPE_POWER&&t.type==RankDataType.TYPE_BAOSHI&&t.type==RankDataType.TYPE_LONGHUN&&t.type==RankDataType.TYPE_WING&&t.type==RankDataType.TYPE_BOOK&&t.type==RankDataType.TYPE_ZS&&t.type==RankDataType.TYPE_SCORE&&t.type==RankDataType.TYPE_POWER&&this.refushROllInfo()},e.prototype.rollOver=function(){this.ingImg.visible=!1,this.enterTime.visible=!0,this.rollTime=3,this.enterTime.text="进入倒计时"+this.rollTime+"秒",0==Ladder.ins().getActorInfo(1)&&0==Ladder.ins().getActorInfo(0)?(TipsCT.ins().showTips("|C:0xf3311e&T:未匹配到对手|"),ViewManager.ins().close(this)):Timer.start(1e3,0,this.refushLabel,this)},e.prototype.refushLabel=function(){this.rollTime--,this.enterTime.text="进入倒计时"+this.rollTime+"秒",this.rollTime<1&&(this.sendStarPlay(),Timer.stop(this.refushLabel,this))},e.prototype.refushROllInfo=function(){this.otherlv.text="段位：？",this.scrollHead.visible=!1;var t=this.getRankListOne()},e.prototype.showPointPlayerInfo=function(){var t=Ladder.ins().getActorInfo();if(0!=t.length&&(0!=t[1]||0!=t[0])){this.otherHead.source="head_"+(t[3]||1)+(t[4]||0),this.scrollHead.visible=!1;var e=Ladder.ins().getLevelConfig(t[5],t[6]);this.otherlv.text=""+e.showLevel+(e.showDan||"")+"段",this.othername.textFlow=TextFlowMaker.generateTextFlow1(t[2])}},e.prototype.sendStarPlay=function(){Ladder.ins().sendStarPlay(Ladder.ins().getActorInfo(1),Ladder.ins().getActorInfo(0)),ViewManager.ins().close(LadderWin),ViewManager.ins().close(this)},e.prototype.getRankListOne=function(){var t=Rank.ins().getRankModel(RankDataType.TYPE_POWER);if(t&&t.getDataList().length<=0)return this.sendCount<2?(Rank.ins().sendGetRankingData(RankDataType.TYPE_POWER),this.sendCount++,null):null;this.sendCount=0;var e=t.getDataList(),i=e[Math.floor(Math.random()*e.length)];return i&&i.id==Actor.actorID?1==e.length?i:this.getRankListOne():i},e}(BaseEuiView);__reflect(LadderChallengeWin.prototype,"LadderChallengeWin"),ViewManager.ins().reg(LadderChallengeWin,LayerManager.UI_Popup),window.LadderChallengeWin=LadderChallengeWin;var LadderInfoPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.rewardList.itemRenderer=ItemBase,this.buyTime.textFlow=(new egret.HtmlTextParser).parser("<u>购买匹配次数</u>"),this.showNomber.textFlow=(new egret.HtmlTextParser).parser("<u>查看排名</u>"),this.showReward.textFlow=(new egret.HtmlTextParser).parser("<u>查看奖励</u>"),this.showNomber0.textFlow=(new egret.HtmlTextParser).parser("<u>上周排名</u>"),this.addTouchEvent(this.flowPlayer,this.onTap),this.addTouchEvent(this.buyTime,this.onTap),this.addTouchEvent(this.showNomber,this.onTap),this.addTouchEvent(this.showReward,this.onTap),this.addTouchEvent(this.showNomber0,this.onTap)},e.prototype.addDisplay=function(){this.observe(Ladder.ins().postTadderChange,this.tadderInfoChange),this.observe(Ladder.ins().postRankInfoList,this.tadderInfoChange),Ladder.ins().sendGetRankInfo(),this.tadderInfoChange()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.updateTime=function(){var t=Ladder.ins().challgeNum,e=GlobalConfig.TianTiConstConfig.maxRestoreChallengesCount,i=t>0?"2ECA22":"f3311e",n=Math.round((Ladder.ins().challgeCd-egret.getTimer())/1e3);n=0>=n?0:n;var s=t>=e?"(2小时恢复1次)":"(恢复倒计时："+DateUtils.getFormatBySecond(n)+")";this.lastNum.textFlow=(new egret.HtmlTextParser).parser('<font color="#'+i+'">剩余次数：'+t+"/"+e+' <font color="#7E6437">'+s+"</font></font>")},e.prototype.tadderInfoChange=function(){Timer.stop(this.updateTime,this),Timer.start(500,0,this.updateTime,this),this.updateTime();var t=Rank.ins().rankModel[RankDataType.TYPE_LADDER];t&&(this.winNum0.text=t.selfPos>0?""+t.selfPos:"未上榜"),this.winNum.text=""+Ladder.ins().winNum,this.duanwei.text=Ladder.ins().getDuanWeiDesc();var e=Ladder.ins().getLevelConfig();e&&(this.rewardList.dataProvider=new eui.ArrayCollection(e.danAward)),this.winImg.visible=Ladder.ins().lianWin,this.starInfo.updataStarInfo(e),this.starInfo.setLvAndRank(e),this.noOpenDesc.visible=!Ladder.ins().isOpen,this.openInfo.visible=Ladder.ins().isOpen},e.prototype.onTap=function(t){switch(ViewManager.ins().close(LimitTaskView),t.currentTarget){case this.flowPlayer:if(FbCT.ins().checkInFB())return;if(!KfArenaSys.ins().checkIsMatching())return;if(Ladder.ins().challgeNum<=0)return void TipsCT.ins().showTips("|C:0xf3311e&T:挑战次数不足|");if(ViewManager.ins().isShow(LadderChallengeWin))return;ViewManager.ins().open(LadderChallengeWin);break;case this.buyTime:if(Ladder.ins().todayBuyTime==GlobalConfig.TianTiConstConfig.maxBuyChallengesCount)return void TipsCT.ins().showTips("|C:0xf3311e&T:今日兑换次数已达上限|");if(Actor.yb<GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");WarnWin.show("确定花费<font color='#FFB82A'>"+GlobalConfig.TianTiConstConfig.buyChallengesCountYuanBao+"元宝</font>购买1次王者争霸挑战次数吗？\n"+("今日已购买："+Ladder.ins().todayBuyTime+"/"+GlobalConfig.TianTiConstConfig.maxBuyChallengesCount),function(){Ladder.ins().sendBuyChallgeTime()},this);break;case this.showReward:ViewManager.ins().open(LadderRewardShowWin);break;case this.showNomber:ViewManager.ins().open(LadderLastRankWin,1);break;case this.showNomber0:Ladder.ins().upLevel>0?ViewManager.ins().open(LadderLastRankWin,0):TipsCT.ins().showTips("|C:0xf3311e&T:暂无上周排行数据|")}},e}(BaseView);__reflect(LadderInfoPanel.prototype,"LadderInfoPanel"),window.LadderInfoPanel=LadderInfoPanel;var LadderLastRankWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ladderinforankingskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list.itemRenderer=LadderRankItemRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.setPanelInfo(i),this.titleDesc.text=1==i?"本周排名":"上周排名",this.rankDesc.text=1==i?"我的战绩":"我的上周战绩"},e.prototype.close=function(){},e.prototype.setPanelInfo=function(t){var e=Ladder.ins().getLevelConfig();if(1==t){var i=Rank.ins().rankModel[RankDataType.TYPE_LADDER];this.list.dataProvider=new eui.ArrayCollection(i.getDataList()?i.getDataList():[]),this.myRank.text=i.selfPos>0?"排名："+i.selfPos:"排名：未上榜",this.WinNum.text="净胜场："+Ladder.ins().winNum+"场",this.myDwIng.source="ladder_rank_"+Ladder.ins().level,e=Ladder.ins().getLevelConfig()}else this.list.dataProvider=new eui.ArrayCollection(Ladder.ins().getUpRankList()),this.myRank.text=Ladder.ins().upWeekRank>0?"排名："+Ladder.ins().upWeekRank:"排名：未上榜",this.WinNum.text="净胜场："+Ladder.ins().upWin+"场",this.myDwIng.source="ladder_rank_"+Ladder.ins().upLevel,e=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId);e.showDan>0?(this.levelBg.visible=!0,this.level.source="laddergradnum_"+e.showDan):(this.levelBg.visible=!1,this.level.source=null)},e}(BaseEuiView);__reflect(LadderLastRankWin.prototype,"LadderLastRankWin"),ViewManager.ins().reg(LadderLastRankWin,LayerManager.UI_Main),window.LadderLastRankWin=LadderLastRankWin;var LadderRankItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="TiantiRankItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t.pos<=3?(this.rankImg.source="paihang"+t.pos,this.rank.text=""):(this.rank.text=t.pos+"",this.rankImg.source=""),this.nameLabel.text=t.player,this.winNum.text=t.winNum+"场",this.dwImg.source="ladder_rank_"+t.challgeLevel;var e=Ladder.ins().getLevelConfig(t.challgeLevel,t.challgeId);e&&e.showDan>0?(this.level.source="laddergradnum_"+e.showDan,this.levelBg.visible=!0):(this.level.source=null,this.levelBg.visible=!1)},e}(BaseItemRender);__reflect(LadderRankItemRenderer.prototype,"LadderRankItemRenderer"),window.LadderRankItemRenderer=LadderRankItemRenderer;var LadderResultWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="ladderresultwinskin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.listData=new eui.ArrayCollection,this.mc=new MovieClip,this.mc.scaleX=this.mc.scaleY=1.2,this.starList.addChildAt(this.mc,0)},e.prototype.open=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];t.prototype.open.call(this,e),this.isWin=e[0];var n=e[1],s=e[2],o=e[3],a=e[4];this.bg.source=this.isWin?"win_png":"lost_png",this.result.source=this.isWin?"win_02":"lost_02",this.sureBtn.name=this.isWin?"领取奖励":"退出",this.s=5,this.updateCloseBtnLabel(),Timer.start(1e3,5,this.updateCloseBtnLabel,this),this.listData.source=n,this.list.itemRenderer=ItemBase,this.list.dataProvider=this.listData,this.refushStarInfo(s,o,a),this.addTouchEvent(this.sureBtn,this.onTap),this.playEffect()},e.prototype.playEffect=function(){this.isWin&&(this.mc.playFile(RES_DIR_EFF+"RankWar1",-1),this.mc.x=this.starList.width>>1,this.mc.y=this.starList.height>>1)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.updateCloseBtnLabel,this),this.removeTouchEvent(this.sureBtn,this.onTap),egret.Tween.removeTweens(this.starList),DisplayUtils.removeFromParent(this.mc),GameMap.fubenID>0&&(FbCT.ins().sendExitFb(),ViewManager.ins().open(LadderWin,2))},e.prototype.refushStarInfo=function(t,e,i){var n=this,s=Ladder.ins().getLevelConfig(t,e);this.upLevel=t,this.upId=e,this.starList.updataStarInfo(s),this.lastlevel=s.showDan,this.lastRank=s.level,this.star1.visible=!1,this.star2.visible=!1;for(var o=0;i>o;o++)this["star"+(o+1)].visible=!0,this["star"+(o+1)].currentState=this.isWin?"light":"black";this.upStar.visible=Ladder.ins().getLevelConfig().showDan>0,i>0&&Timer.start(500,1,function(){n.setStarInfoChange(s.showStar,i)},this)},e.prototype.setStarInfoChange=function(t,e){e>0&&this.starList.upStarStatu(t+1,e,this.isWin)},e.prototype.cheackIsChangeLevel=function(t){var e=this;if(this.upLevel!=Ladder.ins().level||this.upId!=Ladder.ins().nowId){var i=egret.Tween.get(this.starList);i.to({alpha:1},300).call(function(){e.isWin&&t>=1&&e.starList.upStarStatu(1,t,e.isWin);var i=Ladder.ins().getLevelConfig(),n=i.showDan,s=i.level;e.lastRank<s?(e.starList.showRankUp(s),e.starList.showLvUp(n)):e.lastlevel<n?e.starList.showLvDown(n):e.lastlevel>n&&e.starList.showLvUp(n),e.starList.updataStarInfo(i,!1),egret.Tween.removeTweens(e.starList)},this)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sureBtn:ViewManager.ins().close(this)}},e.prototype.updateCloseBtnLabel=function(){this.s--,this.s<=0&&ViewManager.ins().close(this),this.sureBtn.label=this.sureBtn.name+"("+this.s+"s)"},e}(BaseEuiView);__reflect(LadderResultWin.prototype,"LadderResultWin"),ViewManager.ins().reg(LadderResultWin,LayerManager.UI_Popup),window.LadderResultWin=LadderResultWin;var LadderRewardShowWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ladderinforewardskin",e}return __extends(e,t),e.prototype.createChildren=function(){this.list0.itemRenderer=LastWeekRankItemRenderer,this.list1.itemRenderer=ItemBase},e.prototype.open=function(){this.setPanelInfo()},e.prototype.close=function(){},e.prototype.setPanelInfo=function(){var t=Ladder.ins().upRankList;t.length>5&&(t=t.slice(0,5)),this.list0.dataProvider=new eui.ArrayCollection(t);var e=Ladder.ins().configList,i=this.getRewardDataList(e);if(this.list1.dataProvider=new eui.ArrayCollection(i),this.winNum.text="净胜场："+Ladder.ins().upWin+"场",this.winNum0.text="排名："+(Ladder.ins().upWeekRank>0?""+Ladder.ins().upWeekRank:"未上榜"),Ladder.ins().playUpTime){this.upImg.source="ladder_rank_"+Ladder.ins().upLevel;var n=Ladder.ins().getLevelConfig(Ladder.ins().upLevel,Ladder.ins().upId);n.showDan>0?(this.levelbg.visible=!0,this.level.source="laddergradnum_"+n.showDan):(this.levelbg.visible=!1,this.level.source=null)}else this.upImg.source="ladder_rank_1",this.level.source="laddergradnum_5"},e.prototype.getRewardDataList=function(t){for(var e=[],i=0;i<t.length;i++)e=e.concat(t[i].danAward);return e},e.openCheck=function(){return Ladder.ins().configList?!0:(TipsCT.ins().showTips("网络不佳，请稍后"),!1)},e}(BaseEuiView);__reflect(LadderRewardShowWin.prototype,"LadderRewardShowWin"),ViewManager.ins().reg(LadderRewardShowWin,LayerManager.UI_Main),window.LadderRewardShowWin=LadderRewardShowWin;var LadderWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ladderwinskin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.help,this.onTap),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.selectIndexChange),this.addChangingEvent(this.tab,this.checkIsBack),this.addTouchEvent(this.closeBtn,this.onTap)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Mine.ins().postRedPoint,this.updateMineRedPoint),this.observe(PlayWayRedPoint.ins().postRedPoint,this.refushredPoint),this.observe(Ladder.ins().postRedPoint,this.refushredPoint);var i=t[0]?t[0]:0;this.tab.selectedIndex=i,this.viewStack.selectedIndex=i,this.selectIndexChange(),this.refushredPoint()},e.prototype.selectIndexChange=function(t){void 0===t&&(t=null),this.title.source="biaoti_jingji"+this.tab.selectedIndex},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()
},e.prototype.checkIsOpen=function(t){return!0},e.prototype.refushredPoint=function(){this.redPoint1.visible=!!Encounter.ins().isHasRed(),this.redPoint2.visible=Mine.redpointCheck(),this.redPoint3.visible=Ladder.ins().isCanReward||Ladder.ins().isOpen?Ladder.ins().challgeNum>0:!1,this.redPoint4.visible=PlayWayRedPoint.ins().redPoint},e.prototype.updateMineRedPoint=function(t){this.redPoint3.visible=!!t},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:0==this.tab.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,10):1==this.tab.selectedIndex?ViewManager.ins().open(ZsBossRuleSpeak,4):2==this.tab.selectedIndex&&ViewManager.ins().open(ZsBossRuleSpeak,14);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.checkIsBack=function(t){var i=t.target;e.openCheck([i.selectedIndex])?ViewManager.ins().close(LimitTaskView):(t.$cancelable=!0,t.preventDefault())},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0;if(0==i){var n=GlobalConfig.SkirmishBaseConfig.openLevel,s=FbCT.ins().guanqiaID>=n;return s||TipsCT.ins().showTips("通关到第"+n+"关开启遭遇战"),s}if(2==i){var n=GlobalConfig.TianTiConstConfig.openLevel,s=Actor.level>=n;return s||TipsCT.ins().showTips(n+"级开启"),s}return 1==i?Mine.openCheck(!0):3==i?!0:void 0},e}(BaseEuiView);__reflect(LadderWin.prototype,"LadderWin"),ViewManager.ins().reg(LadderWin,LayerManager.UI_Main),window.LadderWin=LadderWin;var LastWeekRankItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.index=this.itemIndex+1,this.index<=3?(this.rankImg.source="paihang"+this.index,this.rank.text=""):(this.rank.text=this.index+"",this.rankImg.source=""),this.data instanceof RankDataLadder){var t=this.data;this.dwImg.source="ladder_rank_"+t.challgeLevel,this.nameLabel.text=t.player,this.winNum.text=t.winNum+"场",this.head.source="head_"+t.job+t.sex;var e=Ladder.ins().getLevelConfig(t.challgeLevel,t.challgeId);this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]),this.level.text=e.showDan+"",this.setlevelInfo(t.challgeLevel<4),1==this.index}else if(this.data instanceof TianTiDanConfig){var i=this.data;this.winNum.text="",this.nameLabel.text=i.showLevel+"段位",this.item1.data=Ladder.ins().creatRewardData(i.danAward[0]),this.setlevelInfo(!0),this.dwImg.source="ladder_rank_"+i.level,this.level.text=i.showDan+"",this.setlevelInfo(!1),this.rankImg.source="",this.rank.text=""}else this.winNum.text="",this.nameLabel.text="钻石段位第"+this.index+"名",this.item1.data=Ladder.ins().creatRewardData(GlobalConfig.TianTiRankAwardConfig[this.index+""].award[0]),this.dwImg.source="ladder_rank_4",this.setlevelInfo(!1),1==this.index},e.prototype.setlevelInfo=function(t){this.levelBg.visible=this.level.visible=t},e}(BaseItemRender);__reflect(LastWeekRankItemRenderer.prototype,"LastWeekRankItemRenderer"),window.LastWeekRankItemRenderer=LastWeekRankItemRenderer;var LevelUpWayWin=function(t){function e(){var e=t.call(this)||this;return e.gainWay=[["通关关卡","GuanQiaRewardWin",[0],3],["通天塔","FbWin",[1],5],["击杀附近的人","LadderWin",[0],4],["经验副本","FbWin",[0,1],5]],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="LevelUpWaySkin",this.gainList.itemRenderer=GainGoodsItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.gainList.dataProvider=new eui.ArrayCollection(this.gainWay),this.gainList.validateNow();for(var i=0;i<this.gainList.numElements;i++){var n=this.gainList.getElementAt(i);if(n){var s=!1,o=void 0,a=void 0,r=void 0;0>=i?s=!0:1==i?(s=ZsCT.ins().lv>=GlobalConfig.FbChallengeConfig[1].zsLevelLimit&&Actor.level>=GlobalConfig.FbChallengeConfig[1].levelLimit,o=GlobalConfig.FbChallengeConfig[1].levelLimit,a=GlobalConfig.FbChallengeConfig[1].zsLevelLimit):2==i?(s=FbCT.ins().guanqiaID>=GlobalConfig.SkirmishBaseConfig.openLevel,r=GlobalConfig.SkirmishBaseConfig.openLevel):3==i&&(s=Actor.level>=GlobalConfig.ExpFubenBaseConfig.openLv,o=GlobalConfig.ExpFubenBaseConfig.openLv),n.gainData(s,this.gainWay[i][3],{needLv:o,needZs:a,guanka:r})}}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this)},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var n=ViewManager.ins().viewOpenCheck(i[1],i[2][0],i[2][1]);if(n){if(ViewManager.ins().closeTopLevel(),"GuanQiaRewardWin"==i[1])return FbCT.ins().guanqiaID<FbCT.AUTO_GUANQIA?(FbCT.ins().setAutoPk(),void ViewManager.ins().close(e)):(PlayFun.ins().openAuto(),GameGuider.challengeBoss(),void ViewManager.ins().close(e));GameGuider.guidance(i[1],i[2]),ViewManager.ins().close(e)}}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(LevelUpWayWin.prototype,"LevelUpWayWin"),ViewManager.ins().reg(LevelUpWayWin,LayerManager.UI_Popup),window.LevelUpWayWin=LevelUpWayWin;var LianJiCT=function(t){function e(){var e=t.call(this)||this;return e.value=0,e.skillIndex=0,e.et=0,e.sysId=PackageID.LianJi,e.regNetMsg(2,e.baseInfo),e.regNetMsg(5,function(t){return e.updateValue(t.readInt())}),e.regNetMsg(3,e.onYuanshenData),e.observe(SkillCT.ins().doSkillResult,e.showCD),e.observe(RoleAI.ins().useSkill,e.addValue),e.observe(GameLogic.ins().postEnterMap,e.cancelAuto),e.observe(Actor.init,e.showLianji),e.observe(Actor.ins().postLevelChange,e.showLianji),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.showLianji=function(){if(e.ins().activation){this.lianjiUI=this.lianjiUI||new LianjiUI;var t=ViewManager.ins().getView(UIView2);return t?void t.addChild(this.lianjiUI):void egret.setTimeout(this.showLianji,this,500)}},e.prototype.useLianji=function(){var t=SubRoles.lookAtTar;if(t){var e=t.infoModel.index;this.sendUse(e)}},Object.defineProperty(e.prototype,"activation",{get:function(){var t=GlobalConfig.LianJiSysConf.unLockLvl;return t[0]>0&&Actor.level>=t[0]},enumerable:!0,configurable:!0}),e.prototype.cancelAuto=function(){Timer.stopAll(this),this.showLianji()},e.prototype.updateValue=function(t){this.value=t},e.prototype.sendAuto=function(t){var e=this.getBytes(4);this.auto=!!t,e.writeByte(t),this.sendToServer(e)},e.prototype.doActiveSkill=function(t){var e=this.getBytes(3);e.writeByte(t),this.sendToServer(e)},e.prototype.onYuanshenData=function(t){return YuanshenData.ins().parse(t)},e.prototype.baseInfo=function(t){var e=this.pointCount;return this.pointCount=t.readByte(),this.auto=!!t.readByte(),YuanshenData.ins().parseSkillData(t),e},e.prototype.sendUse=function(t){if(GameMap.fubenID&&!GameMap.sceneInMine()){var e=this.getBytes(1);return e.writeInt(t),void this.sendToServer(e)}if(!(this.et&&egret.getTimer()-this.et<500)){var i=SubRoles.lookAtTar;if(i){var n=RoleAI.ins().curTarget,s=n[i.infoModel.handle];if(s){var o=GlobalConfig.LianJiSysConf,a=o.singleSlotVal,r=o.skillsId;if(!(this.value<a)){var l=new SkillData(r[this.skillIndex%r.length]),h=MathUtils.getDistance(i.x,i.y,s.x,s.y);h>l.castRange*GameMap.CELL_SIZE||(this.skillIndex++,this.updateValue(this.value-a),RoleAI.ins().useSkill(i,s,l),this.showCD([l,i,s]),this.et=egret.getTimer())}}}}},e.prototype.showCD=function(t){var e=t[0],i=t[1];t[2];e.isLianJi&&i.isMy&&ViewManager.ins().open(LianJiCDView,e.lv1ConfigID)},e.prototype.addValue=function(t){var e=t[0],i=t[1];t[2];if(i.isMy&&this.activation&&!ViewManager.ins().isShow(LianJiCDView)){var n=[11e3,12e3,13e3,14e3,15e3,21e3,22e3,23e3,24e3,25e3,31e3,32e3,33e3,34e3,35e3];if(~n.indexOf(e.id)){for(var s=0,o=SubRoles.ins().roles,a=EntityManager.ins(),r=0,l=o;r<l.length;r++){var h=l[r],u=a.getEntityByHandle(h.handle);u&&u.getHP()>0&&s++}if(s){var p=GlobalConfig.LianJiSysConf,c=p.energyRecovery,d=p.singleSlotVal,g=d*this.pointCount,f=this.value+c[s-1];this.updateValue(Math.min(f,g)),f>=g&&this.auto&&(Timer.has(this.useLianji,this)||Timer.start(600,this.pointCount,this.useLianji,this))}}}},e.prototype.doYuanshenLevelUp=function(){this.sendBaseProto(2)},__decorate([post()],e.prototype,"updateValue",null),__decorate([post()],e.prototype,"onYuanshenData",null),__decorate([post()],e.prototype,"baseInfo",null),e}(BaseSystem);__reflect(LianJiCT.prototype,"LianJiCT"),System.LianJiCT=function(){return LianJiCT.ins()},window.LianJiCT=LianJiCT;var LianJiTPCT=function(t){function e(){var e=t.call(this)||this;return e.data={},e.sysId=PackageID.LianJi,e.regNetMsg(11,e.tupoInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){var t=GlobalConfig.LianJiSysConf.tpSkill,i=function(i){var n=function(n){var s=t[i][n];return s.$name?"break":(s.$name=s.name,s.j=n,void Object.defineProperties(s,{name:{get:function(){return this.$name+(this.lv?"Lv"+this.lv:"")}},lv:{get:function(){return e.ins().getSkillLv(+i,+n)}}}))};for(var s in t[i]){var o=n(s);if("break"===o)break}};for(var n in t)i(n)},e.prototype.sendUpgrade=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.tupoInfo=function(t){for(var e=t.readInt(),i=0;e>i;i++)this.data[t.readInt()]=t.readInt()},e.prototype.getSkillLv=function(t,e){return Math.ceil(Math.floor(((this.data[t]||0)-6*e)/6)/5)},__decorate([post()],e.prototype,"tupoInfo",null),e}(BaseSystem);__reflect(LianJiTPCT.prototype,"LianJiTPCT"),System.LianJiTPCT=function(){return LianJiTPCT.ins()},window.LianJiTPCT=LianJiTPCT;var LianJiTPRPCT=function(t){function e(){var e=t.call(this)||this;return e.tp=!1,e.skill=[],e.associated(e.tpRP,e.skillRP),e.associated(e.skillRP,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.skillRP=function(){var t=!1,e=GlobalConfig.LianjiBreakConfig,i=LianJiTPCT.ins().data,n=BagCT.ins(),s=GlobalConfig.LianJiSysConf.skillsId;for(var o in s){var a=Math.floor(s[o]/1e3),r=i[a]||0,l=e[a][r+1];if(l){var h=n.getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,l.item.id),u=l.item.count;t=t||this.skill[o]!=h>=u,this.skill[o]=h>=u}else t=t||0!=this.skill[o],this.skill[o]=!1}return t},e.prototype.tpRP=function(){var t=this.tp;return this.tp=!!~this.skill.indexOf(!0),this.tp!=t},__decorate([post()],e.prototype,"skillRP",null),__decorate([post()],e.prototype,"tpRP",null),e}(BaseSystem);__reflect(LianJiTPRPCT.prototype,"LianJiTPRPCT"),System.LianJiTPRPCT=function(){return LianJiTPRPCT.ins()},window.LianJiTPRPCT=LianJiTPRPCT;var SkillItemRender=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.red.visible=!1,this.lock.visible=!1,this.rect.visible=!1,this.skillName.text="",this.lv.text=""},e.prototype.dataChanged=function(){this.icon.source=this.data.icon,this.skillName.text=this.data.name,this.icon.filters=this.data.lv?[]:FilterUtil.ARRAY_GRAY_FILTER},e}(BaseItemRender);__reflect(SkillItemRender.prototype,"SkillItemRender"),window.SkillItemRender=SkillItemRender;var YuanshenBreakWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.eCAHorizontal=-145,e.isTopLevel=!0,e._sn_="YuanshenbreakSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.pSkill.red.visible=!1,this.pSkill.lock.visible=!1,this.pSkill.rect.visible=!1,this.pSkill.skillName.text="",this.pSkill.lv.text="",this.ps=[this.p0,this.p1,this.p2,this.p3,this.p4],this.eLj.itemRenderer=SkillItemRender;for(var e=[],i=GlobalConfig.LianJiSysConf.skillsId,n=0,s=i;n<s.length;n++){var o=s[n];e.push(new SkillData(o))}this.eLj.dataProvider=new eui.ArrayCollection(e),this.eLj.selectedIndex=0,this.validateNow(),this.addEvent(egret.Event.CHANGE,this.eLj,this.selectSkill),this.eJsl.itemRenderer=SkillItemRender,this.addEvent(egret.Event.CHANGING,this.eJsl,function(e){e.$cancelable=!0,e.preventDefault();var i=ViewManager.ins().open(WingSkillTipPanel),n=t.eJsl.selectedItem,s=t.eLj.selectedItem,o=LianJiTPCT.ins().getSkillLv(s.id/1e3,t.eJsl.selectedIndex)||1;i.eNameText=n.name,i.eStText=" ",i.eDescText=n.desc.replace("%s",GlobalConfig.LianjiDescConfig[s.id/1e3][t.eJsl.selectedIndex+1][o].value+"")}),this.selectSkill(),this.addTouchEvent(this.eTp,this.onTap),this.addTouchEvent(this.eJH,this.onTap),this.refreshRP()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.eTp:case this.eJH:var e=this.eLj.selectedItem;LianJiTPCT.ins().sendUpgrade(e.id/1e3),this.eJH.enabled=!1}},e.prototype.addDisplay=function(){this.associated(this.updateNeed,BagCT.ins().postItemChange,BagCT.ins().postItemAdd,BagCT.ins().postItemDel),this.observe(LianJiTPCT.ins().tupoInfo,this.upgrade),this.observe(LianJiTPRPCT.ins().skillRP,this.refreshRP)},e.prototype.upgrade=function(){var t=this,e=LianJiTPCT.ins().data,i=this.eLj.selectedItem,n=e[i.id/1e3]||0,s=n%6;for(var o in this.ps)if(+o==s-1){var a=new MovieClip;a.playFile(RES_DIR_EFF+"pulse10",1,function(){var e=new MovieClip;e.playFile(RES_DIR_EFF+"pulse9",-1),t.ps[o].addChild(e)}),this.addChild(a),this.ps[o].addChild(a);break}if(s)this.selectSkill();else{var r=new MovieClip;r.x=65,r.y=40,r.playFile(RES_DIR_EFF+"UpEff1",1,function(){return t.selectSkill()});var l=Math.floor(n/6)-1;l%=5;var h=this.eJsl.getChildAt(l);h.addChild(r)}},e.prototype.selectSkill=function(){var t=LianJiTPCT.ins().data,e=GlobalConfig.LianjiBreakConfig,i=GlobalConfig.LianJiSysConf,n=this.eLj.selectedItem,s=n.id/1e3,o=t[s]||0,a=e[s][o],r=e[s][o+1],l=!r;this.jianTou.visible=!0,this.eCA.horizontalCenter=this.eCAHorizontal,this.eName.text=n.name,this.eStage.visible=!!o,this.eStage.data=StringUtils.NumberToChinese(o)+"阶";var h=i.tpSkill[s],u=Math.floor(o/6);u%=h.length,u=l?h.length-1:u;var p=h[u];this.pSkill.skillName.text=p.$name+"Lv"+(LianJiTPCT.ins().getSkillLv(s,u)+(l?0:1)),this.pSkill.icon.source=p.icon,this.eCA.text=n.name+("攻击： +"+(a?a.bfb/10:0)+"%"),this.eNA.text=l?"":n.name+("攻击： +"+r.bfb/10+"%"),this.ePow.setPower(a?a.spower:0),this.updateNeed();var c=o%6;if(this.eTpG.visible=5>c&&!l,this.eJH.visible=c>=5&&!l,this.eJH.visible){if(!this.eHJEff){this.eHJEff=new eui.Group,this.eHJEff.verticalCenter=this.eHJEff.horizontalCenter=0;var d=new MovieClip;this.eHJEff.addChild(d)}this.eHJEff.getChildAt(0).playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eJH.addChild(this.eHJEff)}this.eMax.visible=l,this.eMax.visible&&(this.jianTou.visible=!1,this.eCA.horizontalCenter=0,this.eCA.verticalCenter=0),this.eJsl.dataProvider=new eui.ArrayCollection(h);for(var g in this.ps)if(c>+g||l){if(1==this.ps[g].numChildren){var d=new MovieClip;d.playFile(RES_DIR_EFF+"pulse9",-1),this.ps[g].addChild(d)}}else{var f=this.ps[g].getChildAt(0);this.ps[g].removeChildren(),this.ps[g].addChild(f)}this.eTpRed.visible=LianJiTPRPCT.ins().skill[this.eLj.selectedIndex],this.eJH.enabled=!0},e.prototype.updateNeed=function(){var t=LianJiTPCT.ins().data,e=GlobalConfig.LianjiBreakConfig,i=this.eLj.selectedItem,n=t[i.id/1e3]||0,s=e[i.id/1e3][n+1];if(s){var o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.item.id),a=s.item.count,r=16711680;o>=a&&(r=65280),this.eNeed.textColor=r,this.eNeed.text=o+"/"+a,this.eIcon.source=s.item.id+"_png"}},e.prototype.refreshRP=function(){for(var t=this.eLj.numChildren,e=LianJiTPRPCT.ins().skill,i=0;t>i;i++){var n=this.eLj.getChildAt(i);n.red.visible=e[i],this.eLj.selectedIndex==i&&(this.eTpRed.visible=e[i])}},e}(BaseEuiView);__reflect(YuanshenBreakWin.prototype,"YuanshenBreakWin"),ViewManager.ins().reg(YuanshenBreakWin,LayerManager.UI_Main),window.YuanshenBreakWin=YuanshenBreakWin;var LianJiCDView=function(t){function e(){var e=t.call(this)||this;return e.img=new eui.Image,e.p=new eui.ProgressBar,e.img.left=75,e.img.verticalCenter=-170,e.addChild(e.img),e.p.left=50,e.p.verticalCenter=-128,e.p.width=200,e.p.height=15,e.p.skinName="bar8Skin",e.addChild(e.p),e}return __extends(e,t),e.prototype.open=function(t){var i=egret.Tween;i.removeTweens(this.img),this.img.source=RES_DIR_IMG+t+".png",this.img.scaleX=2,this.img.scaleY=2,this.img.alpha=1,i.get(this.img).wait(10).to({scaleX:1,scaleY:1},400,egret.Ease.elasticOut).to({alpha:0},2e3);var n=GlobalConfig.LianJiSysConf.skillsId;this.p.visible=n[n.length-1]!=t,i.removeTweens(this.p),this.p.value=100,i.get(this.p).to({value:0},2e3).call(function(){ViewManager.ins().close(e)})},e.prototype.close=function(){LianJiCT.ins().skillIndex=0},e.prototype.destoryView=function(t){void 0===t&&(t=!0)},e}(BaseEuiView);__reflect(LianJiCDView.prototype,"LianJiCDView"),System.ViewManager=function(){return ViewManager.ins()},window.LianJiCDView=LianJiCDView;var LianjiUI=function(t){function e(){var e=t.call(this)||this;e.quan=new MovieClip,e.point=[],e.isPause=!1,e.showCount=0,e._cir=0,e.horizontalCenter=-225,e.bottom=(LocationProperty.isFromQQBLUE?18:0)+64;for(var i=GlobalConfig.LianJiSysConf.skillsId,n=0;n<i.length;n++)e.point[n]=new MovieClip;var s=new egret.Shape;return DisplayUtils.drawCir(s,55,360),s.alpha=0,e.addChild(s),e.addChild(e.quan),e.addTouchEvent(e,function(){DisplayUtils.removeFromParent(e.arrow),LianJiCT.ins().useLianji()}),e}return __extends(e,t),e.prototype.addDisplay=function(){var t=this,e=LianJiCT.ins();this.observe(e.updateValue,this.updateQuan),this.observe(e.baseInfo,function(i){0==i&&e.pointCount>0&&(t.showCount=5)}),this.updateQuan()},Object.defineProperty(e.prototype,"cir",{get:function(){return this._cir},set:function(t){this._cir=t,this.quan.drawAngle(t)},enumerable:!0,configurable:!0}),e.prototype.updateQuan=function(){var t=this,e=LianJiCT.ins(),i=e.value,n=e.pointCount,s=GlobalConfig.LianJiSysConf.singleSlotVal,o=i/s%1*360;if(n&&i>=n*s){o=360;var a=RES_DIR_EFF+"lianji_max";if(this.quan.filters=[],this.quan.name!=a&&this.quan.playFile(a,-1),this.showCount>0){this.showCount--,this.arrow||(this.arrow=new GuideArrow,this.arrow.currentState="right",this.arrow.lab.text="连续点击释放连击技能",this.arrow.horizontalCenter=-100,this.arrow.bottom=25),this.parent.addChild(this.arrow);var r="horizontalCenter";egret.Tween.get(this.arrow,{loop:!0}).to((h={},h[r]=-140,h),1e3).to((u={},u[r]=-100,u),1e3)}}else{DisplayUtils.removeFromParent(this.arrow);var a=RES_DIR_EFF+"lianji_p";this.quan.name!=a&&this.quan.playFile(a,-1)}if(this.lastAngle=o,!this.isPause){egret.Tween.removeTweens(this);var l=egret.Tween.get(this);this.cir>o?this.isPause||(this.isPause=!0,l.to({cir:360},(360-this.cir)/360*1e3).call(function(){t.cir=0}).to({cir:this.lastAngle},this.lastAngle/360*1e3).call(function(){t.updatePoint(),t.isPause=!1})):l.to({cir:o},(o-this.cir)/360*1e3),this.updatePoint()}var h,u},e.prototype.updatePoint=function(){for(var t=LianJiCT.ins(),e=t.value,i=t.pointCount,n=GlobalConfig.LianJiSysConf.singleSlotVal,s=Math.floor(e/n)-1,o=0;o<this.point.length;o++)s>=o&&i-1>o?(this.point[o].playFile(RES_DIR_EFF+"lianji_"+o,-1),this.addChild(this.point[o])):DisplayUtils.removeFromParent(this.point[o])},e}(BaseView);__reflect(LianjiUI.prototype,"LianjiUI"),window.LianjiUI=LianjiUI;var LiLian=function(t){function e(){var e=t.call(this)||this;return e.lilianReward=0,e.nobilityIsUpGrade=0,e.nobilityLv=0,e.xunzhangJF=0,e.liLianExpDay=0,e.liLianExpDayReward=0,e.jadeLv=0,e.isShow=!1,e.isXZShow=!1,e.skillCfgList=[],e.sysId=PackageID.Train,e.regNetMsg(1,e.postLilianData),e.regNetMsg(5,e.postNobilityData),e.regNetMsg(3,e.postTrainsDayAward),e.regNetMsg(10,e.postJadeLv),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendLilianUpgrade=function(){this.sendBaseProto(1)},e.prototype.sendNobilityUpgrade=function(){this.sendBaseProto(6)},e.prototype.sendNobilityStageUpgrade=function(){this.sendBaseProto(7)},e.prototype.sendGetLilianReward=function(){this.sendBaseProto(2)},e.prototype.postLilianData=function(t){var e=t.readInt();return this.liLianExp=t.readInt(),this.lilianReward=t.readInt(),this.liLianExpDay=t.readInt(),this.liLianExpDayReward=t.readInt(),this.liLianLv=e,TaskCT.ins().postUpdataTaskPoint(),this.getTraining?{flag:!1}:{flag:!0}},e.prototype.postNobilityData=function(t){this.isXZShow=!1;var e=t.readInt(),i=this.nobilityLv!=e;return this.nobilityLv=e,{refush:i}},e.prototype.postTrainsDayAward=function(t){var e=t.readBoolean();return this.getTraining=!1,e},e.prototype.sendTrainsDayAward=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.setXunzhangJF=function(t){if(this.xunzhangJF!=t){if(this.xunzhangJF>0){var e=t-this.xunzhangJF,i=parseInt(e.toString());if(i>0){var n="|C:0xffd93f&T:获得"+i+"成就积分|";TipsCT.ins().showTips(n)}}this.xunzhangJF=t}},e.prototype.getLiLianStast=function(){return this.getLilianShenGongStast()?!0:this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel?this.getNobilityIsUpGrade():Artifact.ins().showRedPoint()?!0:TaskCT.ins().getIsHaveChengjiuReward()?!0:this.checkJueWeiOpen()&&this.getNobilityIsUpGrade()&&!this.getNobilityIsMaxLevel()?!0:this.checkJadeRed()?!0:this.checkShowRedPoint2()},e.prototype.checkJueWeiOpen=function(){var t=GlobalConfig.TrainBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.checkXunZhangOpen=function(){var t=GlobalConfig.KnighthoodBasicConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.checkBookOpen=function(){return OpenSystem.ins().checkSysOpen(SystemType.BOOK)},e.prototype.checkShowRedPoint2=function(){if(this.lilianReward<=0)return!1;var t=GlobalConfig.GuanYinAwardConfig[this.lilianReward-1];return this.liLianLv>=t.level},e.prototype.getLilianActiveState=function(){var t=GlobalConfig.TrainBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.getLilianShenGongStast=function(){if(!this.getLilianActiveState())return!1;var t=GlobalConfig.TrainLevelConfig[this.liLianLv+1];return t&&this.liLianExp>=t.exp?!0:this.checkShowRedPoint2()},e.prototype.getLilianBtnState=function(){if(!this.getLilianActiveState())return!1;var t=GlobalConfig.TrainLevelConfig[this.liLianLv+1];return t&&this.liLianExp>=t.exp},e.prototype.getNobilityIsUpGrade=function(){for(var t=GlobalConfig.KnighthoodConfig[this.nobilityLv],e=0;e<t.achievementIds.length;e++){var i=t.achievementIds[e].taskId;if(i>0){var n=TaskCT.ins().getAchieveByTaskId(i);if(!n)return!1;var s=TaskCT.ins().getAchieveConfById(n.id);if(s.target>n.value)return!1}}return!0},e.prototype.getNobilityIsMaxLevel=function(){var t=GlobalConfig.KnighthoodConfig[this.nobilityLv+1];return!t},e.prototype.getAllChengjiuData=function(){if(this._achievementTaskAllConfig)return this._achievementTaskAllConfig;this._achievementTaskAllConfig=[];var t=GlobalConfig.AchievementTaskConfig;for(var i in GlobalConfig.AchievementTaskConfig)t[i].achievementType>0&&this._achievementTaskAllConfig.push(t[i]);return this._achievementTaskAllConfig.sort(e.sort),this._achievementTaskAllConfig},e.sort=function(t,e){return t.achievementType>e.achievementType?1:t.achievementType<e.achievementType?-1:0},e.prototype.getChengjiuData=function(t){for(var e=this.getAllChengjiuData(),i=[],n=0,s=e;n<s.length;n++){var o=s[n];o.achievementType==t&&i.push(o)}return i},e.prototype.chengjiuMaxData=function(){if(this._chengjiuMaxData)return this._chengjiuMaxData;this._chengjiuMaxData=[];for(var t=this.getAllChengjiuData(),e=-1,i=0,n=t;i<n.length;i++){var s=n[i];e!=s.achievementType&&(e=s.achievementType,this._chengjiuMaxData.push(e))}return this._chengjiuMaxData},e.prototype.getPower=function(){return GlobalConfig.TrainLevelConfig[this.liLianLv].power},e.prototype.getCruLevelSkillCfg=function(t){void 0===t&&(t=!1);var e=GlobalConfig.TrainLevelAwardConfig;if(this.skillCfgList.length<=0)for(var i in e)this.skillCfgList.push(e[i]);for(var n=null,s=0,o=this.skillCfgList;s<o.length;s++){var i=o[s];if(i.level>this.liLianLv){n=i;break}}if(t)return n;var a=n?n.id-1:0;return e[a]},e.prototype.postGetLilianReward=function(t){return t},e.prototype.getTrainDayAwardConfigs=function(t){var e=Object.keys(GlobalConfig.TrainDayAwardConfig);e.sort(this.setSortTrainAwards);for(var i=0;i<e.length;i++)if(t>=+e[i])return GlobalConfig.TrainDayAwardConfig[e[i]];return null},e.prototype.jadeUpgrade=function(){this.sendBaseProto(10)},e.prototype.setSortTrainAwards=function(t,e){return+t>+e?-1:1},e.prototype.isGetTrainDayAward=function(t){var e=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!e||!e[t])return!1;if(this.liLianExpDayReward>>t&1);else if(this.liLianExpDay>=e[t].score)return!0;return!1},e.prototype.isGetTrainDayAwardAll=function(){if(!this.getLilianActiveState())return!1;var t=this.getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(!t)return!1;for(var e in t)if(this.liLianExpDayReward>>+e&1);else if(this.liLianExpDay>=t[+e].score)return!0;return!1},e.prototype.postJadeLv=function(t){this.jadeLv=t.readInt()},e.prototype.isJadeMax=function(){return this.jadeLv>=Object.keys(GlobalConfig.YuPeiConfig).length-1},e.prototype.checkJadeRed=function(){return!1},__decorate([post()],e.prototype,"postLilianData",null),__decorate([post()],e.prototype,"postNobilityData",null),__decorate([post()],e.prototype,"postTrainsDayAward",null),__decorate([post()],e.prototype,"postGetLilianReward",null),__decorate([post()],e.prototype,"postJadeLv",null),e}(BaseSystem);__reflect(LiLian.prototype,"LiLian"),System.LiLian=function(){return LiLian.ins()},window.LiLian=LiLian;var WeiWangCC=function(t){function e(){var e=t.call(this)||this;return e._weiWangBack=0,e.sysId=PackageID.WeiWang,e.regNetMsg(1,e.postWeiWangBack),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postWeiWangBack=function(t){this._weiWangBack=t.readInt()},Object.defineProperty(e.prototype,"weiWangBack",{get:function(){return this._weiWangBack},enumerable:!0,configurable:!0}),e.prototype.sendFindWeiWang=function(){this.sendBaseProto(2)},e.prototype.getWeiWangCfg=function(t){for(var e=Object.keys(GlobalConfig.PrestigeLevel).length,i=1;e>=i;i++)if(t<GlobalConfig.PrestigeLevel[i].exp)return GlobalConfig.PrestigeLevel[i-1];return GlobalConfig.PrestigeLevel[t?e:1]},Object.defineProperty(e.prototype,"isOpen",{get:function(){return Actor.level<GlobalConfig.PrestigeBase.openLevel||GameServer.serverOpenDay<GlobalConfig.PrestigeBase.openDay-1?!1:!0},enumerable:!0,configurable:!0}),__decorate([post()],e.prototype,"postWeiWangBack",null),e}(BaseSystem);__reflect(WeiWangCC.prototype,"WeiWangCC"),System.WeiWangCC=function(){return WeiWangCC.ins()},window.WeiWangCC=WeiWangCC;var ChengjiuPanel=function(t){function e(){var e=t.call(this)||this;return e._chengjiuData=[],e.skinName="ChengjiuPanelSkin",e.name="成就",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.list.itemRenderer=ChengjiuItem,this.list.dataProvider=this.listArrColl=new eui.ArrayCollection,this.tab.itemRenderer=ChengjiuTagItem,this.tabArrColl=new eui.ArrayCollection(LiLian.ins().chengjiuMaxData()),this.tab.dataProvider=this.tabArrColl,this.tab.visible=!1},e.prototype.open=function(){this.addTouchEvent(this.list,this.onTab),this.addChangeEvent(this.tab,this.onTabChange),this.observe(TaskCT.ins().postTaskChangeData,this.updateAchieve),this.tab.visible=!0,this.tab.selectedIndex=0,this.updateAchieve()},e.prototype.close=function(){},e.prototype.onTab=function(t){if(t.target instanceof eui.Button){var e=t.target.parent;switch(e.btn.labelDisplay.text){case"前往":GameGuider.taskGuidance(e.id,1);break;case"领取":TaskCT.ins().sendGetAchieve(e.achievementId)}}},e.prototype.onTabChange=function(t){this.listArrColl.source=TaskCT.ins().getChengjiuDataByType(this.tab.selectedItem)},e.prototype.updateAchieve=function(){this.tabArrColl.replaceAll(LiLian.ins().chengjiuMaxData()),this.nextCanTab(this.tab.selectedItem),this.listArrColl.source=TaskCT.ins().getChengjiuDataByType(this.tab.selectedItem)},e.prototype.nextCanTab=function(t){if(!this.canReceive(t)){for(var e=this.tab.selectedIndex,i=0,n=this.tab.numChildren;n>i;i++)if(this.tab.selectedIndex=i,this.canReceive(this.tab.selectedItem))return;this.tab.selectedIndex=e}},e.prototype.canReceive=function(t){var e=TaskCT.ins().getChengjiuDataByType(t);for(var i in e)if(1==e[i].state)return!0;return!1},e}(BaseView);__reflect(ChengjiuPanel.prototype,"ChengjiuPanel");var ChengjiuTagItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChengjiuTagSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.nameImg.source="task_json.name_"+this.data,this.redPoint.visible=TaskCT.ins().getIsHaveChengjiuRewardBytype(this.data)},e}(BaseItemRender);__reflect(ChengjiuTagItem.prototype,"ChengjiuTagItem");var ChengjiuItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChengjiuItemSkin",e.mc=e.mc||new MovieClip,e.mc.x=e.btn.x+46,e.mc.y=e.btn.y+45,e.mc.scaleY=.8,e.mc.scaleX=.9,e.list.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=TaskCT.ins().getAchieveConfById(this.data.id);this.id=this.data.id,this.achievementId=this.data.achievementId,this.list.dataProvider=new eui.ArrayCollection(e.awardList),this.titleTF.textFlow=TextFlowMaker.generateTextFlow(e.name);var i="进度：|C:0x35e62d&T:"+CommonUtils.overLengthChange(this.data.value)+"/"+CommonUtils.overLengthChange(e.target)+"|";switch(this.progressTF.textFlow=TextFlowMaker.generateTextFlow(i),this.btn.visible=!0,this.mc&&this.mc.parent&&DisplayUtils.removeFromParent(this.mc),this.data.state){case 0:this.btn.labelDisplay.text="前往",this.btn.enabled=!0,0==e.control&&(this.btn.visible=!1);break;case 1:this.btn.labelDisplay.text="领取",this.btn.enabled=!0,this.mc&&(this.mc.playFile(RES_DIR_EFF+"BtnPrompt6",-1),this.addChild(this.mc));break;case 2:this.btn.labelDisplay.text="已完成",this.btn.enabled=!1}},e}(BaseItemRender);__reflect(ChengjiuItem.prototype,"ChengjiuItem"),window.ChengjiuPanel=ChengjiuPanel;var JadeItem=function(t){function e(){var e=t.call(this)||this;return e.perLevel=11,e._mcList=[],e._oldLevel=-1,e._oldJade=0,e.skinName="YuPei0Skin",e}return __extends(e,t),e.prototype.setLevel=function(t,e){var i=this;if(t!=this._oldLevel){this._oldLevel=t;var n=Math.floor(t/(9*this.perLevel)),s=(Math.floor(t/this.perLevel)+1)%9;this.icon.smoothing=!0,0==s&&(s=9),this._nexMc&&this._nexMc.parent&&this._nexMc.parent.removeChild(this._nexMc);for(var o,a,r=1;9>=r;r++){if(o=this._mcList[r-1],o&&o.parent&&o.parent.removeChild(o),this._oldJade!=n&&o&&o.stop(),r>1&&(this["line"+(r-2)].visible=!1),a=!1,s>=r)if(s>r||t%this.perLevel==10){if(o||(o=new MovieClip,this._mcList[r-1]=o),this["processEff"+(r-1)].addChild(o),r==s&&e){if(!o.isPlaying){var l=egret.Tween.get(this);o.playFile(RES_DIR_EFF+"pulse3",1,null,!1),l.wait(800).call(function(){i._mcList[s-1].playFile(RES_DIR_EFF+"pulse6",-1)})}}else o.isPlaying||o.playFile(RES_DIR_EFF+"pulse6",-1);r>1&&(this["line"+(r-2)].visible=!0)}else a=!0;else a=!this._nexMc||!this._nexMc.parent;a&&(this._nexMc||(this._nexMc=new MovieClip),this["processEff"+(r-1)].addChild(this._nexMc),this._nexMc.isPlaying||this._nexMc.playFile(RES_DIR_EFF+"pulse7",-1),r>1&&(this["line"+(r-2)].visible=!0))}this._oldJade=n}},e.prototype.removeDisplay=function(){egret.Tween.removeTweens(this)},e}(BaseView);__reflect(JadeItem.prototype,"JadeItem"),window.JadeItem=JadeItem;var JadeSkillWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="YupeiSkillTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose);var i=GlobalConfig.YuPeiConfig[LiLian.ins().jadeLv],n="0";for(var s in i.attrs)if(i.attrs[s].type==AttributeType.atYuPeiDeterDam){n=(i.attrs[s].value/100).toFixed(1);
break}this.content.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.YuPeiBasicConfig.deterDesc.replace("{0}",n+"%"))},e.prototype.close=function(){this.removeTouchEvent(this.bgClose,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(JadeSkillWin.prototype,"JadeSkillWin"),ViewManager.ins().reg(JadeSkillWin,LayerManager.UI_Main),window.JadeSkillWin=JadeSkillWin;var LiLianItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LiLianItemSkin",e.isClose=!1,e.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.goOnTxt.text+"</u></a>"),e.goOnTxt.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.DailyConfig[t.id];this.nameTxt.text=e.name,this.descTxt.textFlow=TextFlowMaker.generateTextFlow("|C:0x35e62d&T:"+t.value+"/"+e.target+"|"),this.liLianNumTxt.text=e.trainExp+"历练",t.state>0?(this.sureImg.visible=!0,this.goOnTxt.visible=!1):(this.sureImg.visible=!1,this.goOnTxt.visible=!0),(1==t.id||3==t.id||4==t.id||5==t.id||6==t.id||7==t.id||8==t.id||9==t.id||10==t.id)&&(this.isClose=!0)}},e}(BaseItemRender);__reflect(LiLianItem.prototype,"LiLianItem"),window.LiLianItem=LiLianItem;var LiLianTips=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="LiLianTipsSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.setPanel()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.setPanel=function(){var t=LiLian.ins().getCruLevelSkillCfg(),e=LiLian.ins().getCruLevelSkillCfg(!0);if(t){this.skillIcon.source=t.icon+"",this.skillName.text=t.skillname,this.cruDesc.textFlow=TextFlowMaker.generateTextFlow(t.desc);var i=GlobalConfig.TrainLevelConfig[t.level],n="·"+i.trainName;this.currTrainName.textFlow=TextFlowMaker.generateTextFlow(n)}if(e){this.nextDesc.textFlow=TextFlowMaker.generateTextFlow(e.desc);var s=GlobalConfig.TrainLevelConfig[e.level],o="·"+s.trainName;this.nextTrainName.textFlow=TextFlowMaker.generateTextFlow(o)}else this.nextDesc.text=""},e.prototype.onTap=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(LiLianTips.prototype,"LiLianTips"),ViewManager.ins().reg(LiLianTips,LayerManager.UI_Popup),window.LiLianTips=LiLianTips;var LiLianWin=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i._sn_="LiLianWinSkin",i.isTopLevel=!0,i.oldIndex=e.JUEWEI,i}return __extends(e,t),e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=void 0==t[0]?e.SHENQI:t[0];switch(n){case e.JUEWEI:if(!LiLian.ins().checkJueWeiOpen())return TipsCT.ins().showTips("激活神器 天命印玺 后开启"),!1;break;case e.XUNZHANG:if(!LiLian.ins().checkXunZhangOpen())return TipsCT.ins().showTips("激活神器 太初勋章 后开启"),!1;break;case e.BOOK:if(!LiLian.ins().checkBookOpen())return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK)),!1;break;case e.WEIWANG:if(!WeiWangCC.ins().isOpen)return TipsCT.ins().showTips("开服第"+GlobalConfig.PrestigeBase.openDay+"天"+GlobalConfig.PrestigeBase.openLevel+"级开启"),!1}return!0},e.prototype.addDisplay=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.observe(LiLian.ins().postLilianData,this.delayRedPoint),this.observe(LiLian.ins().postNobilityData,this.delayRedPoint),this.observe(TaskCT.ins().postTaskChangeData,this.delayRedPoint),this.observe(Artifact.ins().postNewArtifactUpdate,this.delayRedPoint),this.observe(Artifact.ins().postNewArtifactInit,this.delayRedPoint),this.observe(BookRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(BookRedPoint.ins().postLvlUp,this.delayRedPoint),this.observe(LiLian.ins().postJadeLv,this.delayRedPoint),this.observe(BagCT.ins().postItemAdd,this.delayRedPoint),this.observe(BagCT.ins().postItemChange,this.delayRedPoint);var n=e.JUEWEI;LiLian.ins().checkJueWeiOpen()||(n=e.SHENQI),t[0]&&(n=t[0]),this._ext=t[1],this.help.visible=!1,this.setOpenTabIndex(n)},e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTapTouching),this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.help,this.onTouch);var t=e.JUEWEI;LiLian.ins().checkJueWeiOpen()||(t=e.SHENQI),this.viewStack.selectedIndex=t,this.tab.dataProvider=this.viewStack,this.tab.validateNow()},e.prototype.removeDisplay=function(){var t=ViewManager.ins().getView(UIView2);t&&t.closeNav(UIView2.NAV_LILIAN)},e.prototype.setOpenTabIndex=function(t){this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.setOpenIndex(t),this.setRedPoint()},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case e.JUEWEI:LiLian.ins().checkJueWeiOpen()||(TipsCT.ins().showTips("激活神器 天命印玺 后开启"),this.tab.selectedIndex=this.oldIndex);break;case e.XUNZHANG:LiLian.ins().checkXunZhangOpen()?this.xunzhangPanel.open():(TipsCT.ins().showTips("激活神器 霸者之怒 后开启"),this.tab.selectedIndex=this.oldIndex);break;case e.BOOK:LiLian.ins().checkBookOpen()?this._ext&&(this.bookPanel.param=this._ext,this._ext=null):(TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.BOOK)),this.tab.selectedIndex=this.oldIndex);break;case e.WEIWANG:WeiWangCC.ins().isOpen?this.WeiWang.open():(TipsCT.ins().showTips("开服第"+GlobalConfig.PrestigeBase.openDay+"天"+GlobalConfig.PrestigeBase.openLevel+"级开启"),this.tab.selectedIndex=this.oldIndex)}this.oldIndex=this.tab.selectedIndex},e.prototype.delayRedPoint=function(){Timer.has(this.setRedPoint,this)||Timer.start(60,1,this.setRedPoint,this)},e.prototype.setRedPoint=function(){var t=LiLian.ins();this.redPoint0.visible=Artifact.ins().showRedPoint(),this.redPoint1.visible=t.getLilianShenGongStast()||t.isGetTrainDayAwardAll();var e=LiLian.ins().getNobilityIsMaxLevel();this.redPoint2.visible=t.checkXunZhangOpen()&&t.getNobilityIsUpGrade()&&!e,this.redPoint3.visible=BookRedPoint.ins().redpoint||BookRedPoint.ins().canLvlUp,this.redPoint4.visible=!1},e.prototype.onTapTouching=function(t){return e.openCheck(t.currentTarget.selectedIndex)?void ViewManager.ins().close(LimitTaskView):void t.preventDefault()},e.SHENQI=1,e.JUEWEI=0,e.XUNZHANG=2,e.BOOK=3,e.WEIWANG=4,e}(BaseEuiView);__reflect(LiLianWin.prototype,"LiLianWin"),ViewManager.ins().reg(LiLianWin,LayerManager.UI_Main),window.LiLianWin=LiLianWin;var NewLilianWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.barbc=new ProgressBarEff,e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(TaskCT.ins().postTaskChangeData,this.setWinData),this.observe(LiLian.ins().postLilianData,this.onListChange),this.observe(LiLian.ins().postTrainsDayAward,this.updateProgress)},e.prototype.skinComplete=function(){this.addTouchEvent(this.list,this.onListTouch),this.addTouchEvent(this.upgradeBtn,this.onUpgrade),this.addTouchEvent(this.UplevelBtn0,this.onActive),this.addTouchEvent(this.reward,this.sendGetReward);for(var t=1;5>=t;t++)this.addTouchEvent(this["isget"+t],this.onGiftClick);this.list.itemRenderer=LiLianItem,this.itemList.itemRenderer=ItemBase,this.barbc.setWidth(525),this.barbc.x=3,this.barbc.y=-15,this.expGroup.addChild(this.barbc),this.eff=new MovieClip,this.eff.x=468,this.eff.y=47,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.item4.isShowName(!1),this.trainMc={},this.barbc.reset(),this.setWinData(),this.showActPanel(),this.activeTipsTxt0.text="激活神器 天命印玺 可开启爵位晋升之路"},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.eff);for(var t in this.trainMc)DisplayUtils.removeFromParent(this.trainMc[t])},e.prototype.sendGetReward=function(){BagCT.ins().getSurplusCount()>=1?LiLian.ins().sendGetLilianReward():TipsCT.ins().showTips("|C:0xff0000&T:背包已满，请清理背包|")},e.prototype.showActPanel=function(){this.Activation.visible=!1,this.showAct.visible=!this.Activation.visible},e.prototype.onActive=function(t){switch(t.currentTarget){case this.UplevelBtn0:LiLian.ins().getLilianActiveState()||(TipsCT.ins().showTips("激活神器 天命印玺 后开启"),t.$cancelable=!0,t.preventDefault())}},e.prototype.onGiftClick=function(t){for(var e=1;5>=e;e++)if(t.currentTarget==this["isget"+e]){var i=this["gift"+e].getItemIcon();LiLian.ins().getTraining=!0,this.flyItem(i),LiLian.ins().sendTrainsDayAward(e);break}},e.prototype.flyItem=function(t){var e=new eui.Image(t.imgIcon.source);e.x=t.imgIcon.x,e.y=t.imgIcon.y,e.width=t.imgIcon.width,e.height=t.imgIcon.height,e.scaleX=t.imgIcon.scaleX,e.scaleY=t.imgIcon.scaleY,t.imgIcon.parent.addChild(e),GameLogic.ins().postFlyItemEx(e)},e.prototype.onUpgrade=function(t){var e=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];if(e){var i=LiLian.ins().liLianExp;i>=e.exp?LiLian.ins().sendLilianUpgrade():TipsCT.ins().showTips("|C:0xf3311e&T:历练不足，无法升级|")}},e.prototype.onSeeSkill=function(t){ViewManager.ins().open(LiLianTips)},e.prototype.onListTouch=function(t){if(t.target instanceof eui.Label){var e=t.target.parent;e.isClose||ViewManager.ins().close(LiLianWin),FbWin.isClose=e.isClose,GameGuider.taskGuidance(e.data.id,0),ViewManager.ins().close(LimitTaskView)}},e.prototype.onListChange=function(t){var e=t.flag;if(e&&(this.lilianUpgradeSuccess(),this.setWinData()),this.showActPanel(),LiLian.ins().isShow){var i=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1],n="juewei_"+i.type+"_1";Activationtongyong.show(0,i.trainName,n+"_png")}},e.prototype.setWinData=function(){var t=LiLian.ins().liLianLv;this._totalPower=LiLian.ins().getPower(),this.powerPanel.setPower(this._totalPower);var e=GlobalConfig.TrainLevelConfig[t];if(!ErrorLog.Assert(e,"LiLianPanel  config is null  lv = "+t)){var i=e.type>14?14:e.type;this.imgMedal.source="juewei_1_"+i+"_png",this.levelImg.source=e.img?e.img:"juewei_0_"+i+"_png",this.levelLabel.text=e.trainlevel+"等";LiLian.ins().getCruLevelSkillCfg();this.attrTxt.text=AttributeData.getAttStr(e.attrAward,0,1,"：");var n=GlobalConfig.TrainLevelConfig[t+1];if(n){for(var s="",o=0;o<n.attrAward.length;o++)s+=n.attrAward[o].value,o<n.attrAward.length-1&&(s+="\n");this.nextTxt.text=s,this.itemList.dataProvider=new eui.ArrayCollection(n.itemAward),this.currentState="nomax";var a=1==e.trainlevel?n.trainName:"";this.levelLabel0.text=n.trainlevel+"等"+a}else this.currentState="max",this.itemList.dataProvider=new eui.ArrayCollection([]);this.expChange();var r=TaskCT.ins().task;this.list.dataProvider=new eui.ArrayCollection(r),this.list.validateNow(),this.addRewardRefush(),this.updateProgress()}},e.prototype.addRewardRefush=function(){if(LiLian.ins().lilianReward>0){this.addReward.visible=!0;var t=LiLian.ins().lilianReward,e=GlobalConfig.GuanYinAwardConfig,i=e[t-1];if(Assert(i,"获取神功达标奖励异常"))return;var n=new ItemData;n.configID=i.award.id,this.item4.data=n,this.reward.visible=this.reward.enabled=LiLian.ins().checkShowRedPoint2(),this.tipsGroup.visible=!this.reward.visible,this.targetLevel.text=i.level-LiLian.ins().liLianLv+""}else this.addReward.visible=!1,this.reward.enabled=!1,this.tipsGroup.visible=!1},e.prototype.expChange=function(){var t=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv+1];t||(t=GlobalConfig.TrainLevelConfig[LiLian.ins().liLianLv]);var e=t.exp,i=LiLian.ins().liLianExp,n=i>=e;n?(this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.parent||this.upInfo.addChild(this.eff)):DisplayUtils.removeFromParent(this.eff),this.barbc.setData(i,e),this.redPoint.visible=LiLian.ins().getLilianBtnState(),this.redPoint0.visible=LiLian.ins().checkShowRedPoint2()},e.prototype.lilianUpgradeSuccess=function(){for(var t=this.itemList.dataProvider.length,e=[],i=0;t>i;i++){var n=this.itemList.getVirtualElementAt(i);e.push(n.getItemSoure())}LiLian.ins().postGetLilianReward(e)},e.prototype.updateProgress=function(){var t=LiLian.ins().getTrainDayAwardConfigs(GameServer.serverOpenDay+1);if(t){this.lilianed.text=LiLian.ins().liLianExpDay+"";for(var e in t){var i=t[e];if(i){this["lilian"+e].text=i.score+"历练";GlobalConfig.ItemConfig[i.reward[0].id];if(this["gift"+e].data={id:i.reward[0].id,type:i.reward[0].type,count:i.reward[0].count},this["gift"+e].isShowName(!1),this["bar"+e].maximum=100,this["lingqu"+e].touchEnabled=!1,LiLian.ins().liLianExpDayReward>>i.id&1)this["bar"+e].value=100,this["lingqu"+e].visible=!0,this["isget"+e].touchEnabled=!1;else if(this["lingqu"+e].visible=!1,LiLian.ins().liLianExpDay>=i.score)this["bar"+e].value=100,this["isget"+e].touchEnabled=!0;else{var n=t[Number(e)-1],s=LiLian.ins().liLianExpDay,o=i.score;n&&(s=LiLian.ins().liLianExpDay-n.score,o=i.score-n.score),s=s>0?s:0,this["bar"+e].value=Math.floor(s/o*100),this["isget"+e].touchEnabled=!1}this.updateTrainEff(i.id)}}}},e.prototype.updateTrainEff=function(t){this.trainMc[t]||(this.trainMc[t]=new MovieClip);var e=LiLian.ins().isGetTrainDayAward(t);this["redPoint"+t].visible=e,e?this.trainMc[t].parent||(this["eff"+t].parent.addChild(this.trainMc[t]),this.trainMc[t].playFile(RES_DIR_EFF+"OpenRole3",-1),this.trainMc[t].x=this["eff"+t].x,this.trainMc[t].y=this["eff"+t].y):DisplayUtils.removeFromParent(this.trainMc[t])},e}(BaseView);__reflect(NewLilianWin.prototype,"NewLilianWin"),ViewManager.ins().reg(NewLilianWin,LayerManager.UI_Popup),window.NewLilianWin=NewLilianWin;var NobilityItem=function(t){function e(){var e=t.call(this)||this;return e.goOnTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.goOnTxt.text+"</u></a>"),e.goOnTxt.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=TaskCT.ins().getAchieveConfById(t.id),i=e.name+"|C:0x35e62d&T:("+t.value+"/"+e.target+")|";this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(i),t.state>0?(this.sureImg.visible=!0,this.goOnTxt.visible=!1):(this.sureImg.visible=!1,this.goOnTxt.visible=Boolean(e.control))}},e}(BaseItemRender);__reflect(NobilityItem.prototype,"NobilityItem"),window.NobilityItem=NobilityItem;var XunzhangPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastEffId=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.starList=new StarList(10,0,60),this.starList.x=-5,this.starList.y=-40,this.starList.scaleX=.7,this.starList.scaleY=.7,this.mc1=new MovieClip,this.mc1.x=this.btn.width/2,this.mc1.y=this.btn.height/2,this.mc1.touchEnabled=!1,this.taskList.itemRenderer=XunZhangTaskItemRenderer,this.XunzhangEff=new MovieClip,this.xunzhangMcGroup.addChild(this.XunzhangEff),this.group.addChild(this.starList),this.addTouchEvent(this.btn,this.onTab),this.addTouchEvent(this.UplevelBtn1,this.onTab),this.taskList.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onListTouch,this)},e.prototype.addDisplay=function(){this.observe(LiLian.ins().postNobilityData,this.update),this.observe(TaskCT.ins().postTaskChangeData,this.setTaskList),this.update()},e.prototype.removeDisplay=function(){},e.prototype.onListTouch=function(t){var e=t.target.parent;e.data&&GameGuider.taskGuidance(e.data.id,1)},e.prototype.onTab=function(t){switch(t.currentTarget){case this.btn:this.onBtnDeal()}},e.prototype.onBtnDeal=function(){LiLian.ins().getNobilityIsUpGrade()?LiLian.ins().sendNobilityUpgrade():TipsCT.ins().showTips("|C:0xf3311e&T:任务未完成，无法升级|")},e.prototype.setTaskList=function(){var t=LiLian.ins().nobilityLv,e=GlobalConfig.KnighthoodConfig[t];if(this.nameTF.text=e.type,this.lastEffId!=e.effid){if(!GlobalConfig.DefineEff[e.effid])return void egret.log(e.effid+"特效ID出错啦");var i=GlobalConfig.DefineEff[e.effid].souce;this.XunzhangEff.playFile(RES_DIR_EFF+i,-1),this.lastEffId=e.effid,this.stageImg.source="jieji"+e.effid%100+"_png"}for(var n=[],s=0;s<e.achievementIds.length;s++){var o=e.achievementIds[s].taskId;o>0&&n.push(TaskCT.ins().getAchieveByTaskId(o))}this.taskList.dataProvider=new eui.ArrayCollection(n);var a=n.length>0;for(var s in n){var r=n[s];if(r&&r.value<TaskCT.ins().getAchieveConfById(r.id).target){a=!1;break}}a?(this.btn.addChild(this.mc1),this.mc1.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.mc1)},e.prototype.showActPanel=function(){this.Activation.visible=!1,this.showAct.visible=!this.Activation.visible},e.prototype.update=function(t){this.setTaskList();var e=t?t.refush:!1;this.showActPanel();var i=LiLian.ins().nobilityLv,n=GlobalConfig.KnighthoodConfig[i];if(LiLian.ins().isXZShow){var s=n.effid;Activationtongyong.show(0,n.desc,"j"+s+"_png"),LiLian.ins().isXZShow=!1}if(!LiLian.ins().checkJueWeiOpen())return this.com1.visible=!1,this.com2.visible=!1,void(this.group.visible=!1);this.com1.visible=!0,this.com2.visible=!0,this.group.visible=!0,this.nameTF.text=n.type;var o=GlobalConfig.KnighthoodBasicConfig.perLevel,a=Math.ceil((i-o)/(o+1)+1),r=i-(o+(a-2)*(o+1)+1);this.starList.setStarNum(r,Number(e)),this.btn.label="升级勋章",i>0&&(i-o)%(o+1)==0&&(this.btn.label="升阶"),this.com1.updateInfo1(n,this.starList.starNum),n=GlobalConfig.KnighthoodConfig[i+1],this.btn.visible=!0,this.manjiTF.visible=!1,this.com2.visible=!0,this.arrow.visible=!0,n?(this.com1.x=10,this.com2.updateInfo2(n,this.starList.starNum)):(this.btn.visible=!1,this.manjiTF.visible=!0,this.com2.visible=!1,this.arrow.visible=!1,this.com1.x=137)},e.prototype.getPower=function(){var t=LiLian.ins().nobilityLv,e=GlobalConfig.KnighthoodConfig[t];return BagCT.getAttrPower(e.attrs)},__decorate([callLater],e.prototype,"setTaskList",null),e}(BaseEuiView);__reflect(XunzhangPanel.prototype,"XunzhangPanel");var XunzhangItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){switch(this.info){case 1:this.updateInfo1(this.conf,this.starNum,this.isStageUpgrade);break;case 2:this.updateInfo2(this.conf,this.starNum,this.isStageUpgrade)}},e.prototype.updateInfo1=function(t,e,i){if(void 0===i&&(i=!1),this.conf=t,this.starNum=e,this.isStageUpgrade=i,this.info=1,this.skin){var n=t.attrs,s=AttributeData.getAttStr1(n,AttributeFormat.FORMAT_1());if(t.exattrs&&t.exattrs.length>0)for(var o=0;o<t.exattrs.length;o++)s+="\n",s+=AttributeData.getExAttrNameByAttrbute(t.exattrs[o],!0)+"\n";this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(s),this.addNameTF(this.nameTF,t,e,i)}},e.prototype.updateInfo2=function(t,e,i){if(void 0===i&&(i=!1),this.conf=t,this.starNum=e,this.isStageUpgrade=i,this.info=2,this.skin){var n=t.attrs,s=AttributeData.getAttStr1(n,AttributeFormat.FORMAT_2());if(t.exattrs&&t.exattrs.length>0){s+="\n";for(var o=0;o<t.exattrs.length;o++)s+=AttributeData.getExAttrNameByAttrbute(t.exattrs[o],!0,"：",3532333)+"\n"}this.attrTxt.textFlow=TextFlowMaker.generateTextFlow(s),this.addNameTF(this.nameTF,t,e+1,i)}},e.prototype.addNameTF=function(t,e,i,n){void 0===n&&(n=!1),t&&(i>9&&(i=9),n&&(i=0),t.text=e.desc)},e}(BaseView);__reflect(XunzhangItem.prototype,"XunzhangItem"),window.XunzhangPanel=XunzhangPanel,window.XunzhangItem=XunzhangItem;var XunZhangTaskItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="XunzhangTaskSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=TaskCT.ins().getAchieveConfById(t.id);this.nameTF.textFlow=TextFlowMaker.generateTextFlow(e.name);var i=Math.min(t.value,e.target);this.expLabel.text=i+"/"+e.target,this.expBar.maximum=e.target,this.expBar.value=i,this.taskIcon.source="xunzhang"+t.achievementId+"_png",this.currentState=t.value>=e.target?"done":"goon"}},e}(BaseItemRender);__reflect(XunZhangTaskItemRenderer.prototype,"XunZhangTaskItemRenderer"),window.XunZhangTaskItemRenderer=XunZhangTaskItemRenderer;var WeiWangItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="WeiWangItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.title.source=t.res,this.value.text=t.exp+""},e}(BaseItemRender);__reflect(WeiWangItemRender.prototype,"WeiWangItemRender"),window.WeiWangItemRender=WeiWangItemRender;var WeiWangOverViewWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WeiWangOverViewSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.update()},e.prototype.skinComplete=function(){this.list.itemRenderer=WeiWangItemRender,this.addTouchEvent(this.bgClose,this.onOtherClose)},e.prototype.update=function(){for(var t=[],e=Object.keys(GlobalConfig.PrestigeLevel).length,i=1;e>=i;i++)t.push(GlobalConfig.PrestigeLevel[i]);this.list.dataProvider=new eui.ArrayCollection(t.reverse())},e.prototype.onOtherClose=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(WeiWangOverViewWin.prototype,"WeiWangOverViewWin"),ViewManager.ins().reg(WeiWangOverViewWin,LayerManager.UI_Popup),window.WeiWangOverViewWin=WeiWangOverViewWin;var WeiWangPanel=function(t){function e(){var e=t.call(this)||this;return e.expBarEff=new ProgressBarEff,e}return __extends(e,t),e.prototype.skinComplete=function(){this.getItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.getItemTxt.text),this.findItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.findItemTxt.text),this.overViewTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.overViewTxt.text),this.bodyMc0=new MovieClip,this.bodyMc0.visible=!1,this.eBodyMCGroup0.addChild(this.bodyMc0),this.bodyMc1=new MovieClip,this.bodyMc1.visible=!1,this.eBodyMCGroup1.addChild(this.bodyMc1),this.bodyMc2=new MovieClip,this.bodyMc2.visible=!1,this.eBodyMCGroup2.addChild(this.bodyMc2)},e.prototype.addDisplay=function(){this.addTouchEvent(this,this.onTouch),this.observe(Actor.ins().postWeiWang,this.update),this.observe(WeiWangCC.ins().postWeiWangBack,this.updateBack),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.observe(Rank.ins().postRankingData,this.updateRank),this.addBarEff(),this.update(),this.updateBack(),Rank.ins().sendGetRankingData(RankDataType.TYPE_WEIWANG),this.updateRank(Rank.ins().getRankModel(RankDataType.TYPE_WEIWANG))},e.prototype.removeDisplay=function(){this.removeEffect(),this._topThree&&(this._topThree.length=0),this._topThree=null},e.prototype.updateRank=function(t){if(!t||t.type==RankDataType.TYPE_WEIWANG){var e,i,n=t?t.getDataList():null,s=n?n.length:0;this._topThree=[];for(var o=1;3>=o;o++)i=o-1,s>=o?(e=n[i],this["praiseGroup"+i].visible=!0,this["name"+i].text=e.player,this._topThree[i]=e.id,this["bodyImg"+i].name=e.id+"",ReadPlayerCT.ins().sendFindPlayer(e.id)):(this["praiseGroup"+i].visible=!1,this["name"+i].text="暂无");i=this._topThree.indexOf(Actor.actorID),this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.skillTips[-1==i?0:i+1])}},e.prototype.update=function(){this._weiWangCfg=WeiWangCC.ins().getWeiWangCfg(Actor.weiWang);var t=this._weiWangCfg.level==Object.keys(GlobalConfig.PrestigeLevel).length;this.notMaxGroup.visible=!t,this.maxShowGroup.visible=t;var e=[];for(var i in this._weiWangCfg.attr)e.push(new AttributeData(this._weiWangCfg.attr[i].type,this._weiWangCfg.attr[i].value));var n;if(t)this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"："));else{this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"：")),e=[],n=GlobalConfig.PrestigeLevel[this._weiWangCfg.level+1];for(var i in n.attr)e.push(new AttributeData(n.attr[i].type,n.attr[i].value));this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(e,0,1,"："))}this._weiWangCfg.retrieve?this.info.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrestigeBase.recycle.replace("%s",this._weiWangCfg.retrieve+"")):this.info.text="",this.barGroup.visible=!1;var s=n?n.exp:this._weiWangCfg.exp;this.expBarEff.setData(Actor.weiWang,s),this.myTitle.source=this._weiWangCfg.res},e.prototype.addBarEff=function(){this.expBarEff.setWidth(525),this.expBarEff.x=-15,this.expBarEff.y=75,this.attrGroup.addChild(this.expBarEff)},e.prototype.updateBack=function(){this.findItemTxt.visible=WeiWangCC.ins().weiWangBack>0,this.findItemTxt.visible?(this._backEff||(this._backEff=ObjectPool.pop("MovieClip")),this._backEff.parent||(this.findItemTxt.parent.addChild(this._backEff),this._backEff.x=this.findItemTxt.x+this.findItemTxt.width/2,this._backEff.y=this.findItemTxt.y+this.findItemTxt.height/2,this._backEff.touchEnabled=!1,this._backEff.scaleY=.5,this._backEff.scaleX=.6),this._backEff.isPlaying||this._backEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):this.removeEffect()},e.prototype.removeEffect=function(){this._backEff&&(DisplayUtils.removeFromParent(this._backEff),this._backEff=null)},e.prototype.onTouch=function(t){switch(t.target){case this.getItemTxt:WarnCT.ins().setBuyGoodsWarn(MoneyConst.weiWang);break;case this.findItemTxt:WarnWin.show("是否确定花费"+WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost+"元宝找回"+WeiWangCC.ins().weiWangBack+"点威望值？",function(){Actor.yb<WeiWangCC.ins().weiWangBack*GlobalConfig.PrestigeBase.cost?TipsCT.ins().showTips("元宝不足，请充值！"):WeiWangCC.ins().sendFindWeiWang()},this);break;case this.overViewTxt:ViewManager.ins().open(WeiWangOverViewWin);break;case this.closeBtn:ViewManager.ins().close(LiLianWin);break;case this.title0:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[0]);break;case this.title1:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[1]);break;case this.title2:ViewManager.ins().open(WeiWangTitleTipsWin,GlobalConfig.PrestigeBase.topThree[2]);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[24].text);break;case this.bodyImg0:case this.bodyImg1:case this.bodyImg2:this._openOtherWin=!0,ReadPlayerCT.ins().sendFindPlayer(Number(t.target.name));break;case this.checkBtn:ViewManager.ins().open(RankingWin,RankDataType.TYPE_WEIWANG)}},e.prototype.openOtherPlayerView=function(t){if(this._openOtherWin)ViewManager.ins().open(RRoleWin,t),this._openOtherWin=!1;else{var e=this._topThree.indexOf(t.id);if(0>e)return;var i=t.roleData[0],n=i.getZhuangBanNG(),s=void 0,o=n[0],a=n[1],r=i.getEquipByIndex(0),l=r.item.configID,h=i.getEquipByIndex(2),u=h.item.configID;if(this["weaponImg"+e].source=null,this["bodyImg"+e].source=null,l>0){var p=GlobalConfig.EquipConfig[l].appearance;p&&p.indexOf("[job]")>-1&&(p=p.replace("[job]",i.job+"")),this["weaponImg"+e].source=p+"_"+i.sex+"_c_png"}if(u>0){var p=GlobalConfig.EquipConfig[u].appearance;p&&p.indexOf("[job]")>-1&&(p=p.replace("[job]",i.job+"")),this["bodyImg"+e].source=p+"_"+i.sex+"_c_png",s=!0}if(s||(this["bodyImg"+e].source="body000_"+i.sex+"_c_png"),a>0&&(this["weaponImg"+e].source=this.getZhuangbanById(a).res+"_"+i.sex+"_c_png"),o>0){var c=this.getZhuangbanById(o);c.useMc>0?(this["bodyImg"+e].visible=!1,this["bodyMc"+e].visible=!0,this["bodyMc"+e].playFile(RES_DIR_DRESS+c.res+"_"+i.sex+"_c_m",-1)):(this["bodyMc"+e].visible=!1,this["bodyImg"+e].visible=!0,this["bodyImg"+e].source=c.res+"_"+i.sex+"_c_png")}else this["bodyMc"+e].visible=!1,this["bodyImg"+e].visible=!0;this["wingImg"+e].source=null;var d=i.wingsData,g=n[2];g>0?this["wingImg"+e].source=GlobalConfig.ZhuangBanId[g].res+"_png":d.openStatus&&(this["wingImg"+e].source=GlobalConfig.WingLevelConfig[d.lv].appearance+"_png")}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e}(BaseEuiView);__reflect(WeiWangPanel.prototype,"WeiWangPanel"),window.WeiWangPanel=WeiWangPanel;var WeiWangTitleTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WeiWangTitleTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.bgClose,this.onOtherClose)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.title.source=t[0].res,this.content.textFlow=TextFlowMaker.generateTextFlow1(t[0].des)},e.prototype.onOtherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(WeiWangTitleTipsWin.prototype,"WeiWangTitleTipsWin"),ViewManager.ins().reg(WeiWangTitleTipsWin,LayerManager.UI_Popup),window.WeiWangTitleTipsWin=WeiWangTitleTipsWin;var JadeDataNew=function(){function t(){this.lv=0,this.exp=0,this._isUpdate=!0}return t.prototype.parser=function(t){this.lv=t.readShort(),this.exp=t.readShort();var e=t.readShort();this.danDate=new Object;for(var i=0;e>i;i++)this.danDate[t.readInt()]=t.readShort();this._isUpdate=!0},t.prototype.parserOther=function(t){this.lv=t.readShort(),this._isUpdate=!0},t.prototype.getSkillList=function(){if(this._isUpdate){this._isUpdate=!1,this._skillList=[];var t=JadeNew.ins().getSkillsByLv(this.lv);if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this._skillList.push(new SkillData(n))}}return this._skillList},t}();__reflect(JadeDataNew.prototype,"JadeDataNew"),window.JadeDataNew=JadeDataNew;var JadeNew=function(t){function e(){var e=t.call(this)||this;return e.jadeData=[],e.sysId=PackageID.JadeNew,e.regNetMsg(1,e.postJadeData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postJadeData=function(t){var e=t.readShort(),i=this.jadeData[e];return i||(i=new JadeDataNew,this.jadeData[e]=i),i.parser(t),e},e.prototype.sendUseDan=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendUpgrade=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getJadeDataByID=function(t){return this.jadeData&&this.jadeData.length?this.jadeData[t]:null},e.prototype.isJadeMax=function(t){var e=this.getJadeDataByID(t);return e?e.lv>=Object.keys(GlobalConfig.JadePlateLevelConfig).length-1:!1},e.prototype.checkRed=function(){for(var t=0;3>t;t++)if(this.checkRedByRoleID(t))return!0;return!1},e.prototype.checkOpen=function(){return Actor.level<GlobalConfig.JadePlateBaseConfig.openlv?!1:GameServer.serverOpenDay<GlobalConfig.JadePlateBaseConfig.openDay-1?!1:!0},e.prototype.checkRedByRoleID=function(t){if(!this.checkOpen())return!1;if(!SubRoles.ins().getSubRoleByIndex(t))return!1;var e=this.getJadeDataByID(t);if(!e)return!1;if(this.isJadeMax(t))return!1;var i,n=e.lv,s=0;for(var o in GlobalConfig.JadePlateBaseConfig.itemInfo)i=BagCT.ins().getBagItemById(+o),s+=+GlobalConfig.JadePlateBaseConfig.itemInfo[o]*(i?i.count:0);if(s+e.exp>=GlobalConfig.JadePlateLevelConfig[n].exp)return!0;var a,r=Math.floor(n/GlobalConfig.JadePlateBaseConfig.perLevel)+1,l=0,h=0,u=0;for(var o in GlobalConfig.JadePlateBaseConfig.upgradeInfo){i=BagCT.ins().getBagItemById(+o),h=i?i.count:0,l=e.danDate&&e.danDate[o]?+e.danDate[o]:0,a=GlobalConfig.JadePlateLevelConfig[(r-1)*GlobalConfig.JadePlateBaseConfig.perLevel];var p=a.upgradeItemInfo&&a.upgradeItemInfo[o]?+a.upgradeItemInfo[o]:0,c=Number(o)-204067,d=ExpansionCardCT.ins().useDanData,g=d&&d[c]?d[c].addNum:0;if(u=g+p,u>l&&h)return!0}return!1},e.prototype.getSkillsByLv=function(t){var e=Math.floor(t/GlobalConfig.JadePlateBaseConfig.perLevel)+1,i=GlobalConfig.JadePlateLevelConfig[(e-1)*GlobalConfig.JadePlateBaseConfig.perLevel],n=i.skillIdList?i.skillIdList.length:0;if(0>=n)return null;for(var s,o=GlobalConfig.JadePlateBaseConfig.skillUnlock.length,a=[],r=0;o>r;r++)for(var l=0;n>l;l++)s=i.skillIdList[l],s==GlobalConfig.JadePlateBaseConfig.skillUnlock[r].id&&s>100&&a.push(s);return a.length?a:null},__decorate([post()],e.prototype,"postJadeData",null),e}(BaseSystem);__reflect(JadeNew.prototype,"JadeNew"),System.JadeNew=function(){return JadeNew.ins()},window.JadeNew=JadeNew;var LongHun=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.LoongSoul,e.regNetMsg(1,e.postDateUpdate),e.regNetMsg(2,e.postStageUpgrade),e.regNetMsg(3,e.postStageActive),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(1);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postDateUpdate=function(t){var i=t.readShort(),n=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(i),o=t.readInt(),a=t.readInt(),r=0;
switch(n+1){case e.TYPE_LONG_HUN:r=s.loongSoulData.level==o?0:1,s.loongSoulData.level=o,s.loongSoulData.exp=a;break;case e.TYPE_HU_DUN:s.shieldData.level=o,s.shieldData.exp=a;break;case e.TYPE_XUE_YU:s.xueyuData.level=o,s.xueyuData.exp=a}return r},e.prototype.sendStageUpgrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postStageUpgrade=function(t){var i=t.readShort(),n=t.readShort(),s=t.readInt(),o=SubRoles.ins().getSubRoleByIndex(i);switch(n+1){case e.TYPE_LONG_HUN:o.loongSoulData.stage=s;break;case e.TYPE_HU_DUN:o.shieldData.stage=s;break;case e.TYPE_XUE_YU:o.xueyuData.stage=s}},e.prototype.sendStageActive=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postStageActive=function(t){var i=t.readShort(),n=t.readShort(),s=t.readByte(),o=SubRoles.ins().getSubRoleByIndex(i);switch(n+1){case e.TYPE_LONG_HUN:o.loongSoulData.state=s;break;case e.TYPE_HU_DUN:o.shieldData.state=s;break;case e.TYPE_XUE_YU:o.xueyuData.state=s}Activationtongyong.show(0,"魂印","jlonghun_01_png")},e.prototype.canShowRedPointByType=function(t,i){var n=SubRoles.ins().getSubRoleByIndex(t);if(!n)return!1;var s=0,o=null,a=null,r=null;switch(i){case e.TYPE_LONG_HUN:if(0==n.loongSoulData.state){var l=GlobalConfig.LoongSoulBaseConfig.openlv;return Actor.level<l?!1:!0}o=GlobalConfig.LoongSoulConfig[n.loongSoulData.level],a=GlobalConfig.LoongSoulConfig[n.loongSoulData.level+1],r=GlobalConfig.LoongSoulStageConfig[n.loongSoulData.stage],s=n.loongSoulData.exp;break;case e.TYPE_HU_DUN:o=GlobalConfig.ShieldConfig[n.shieldData.level],a=GlobalConfig.ShieldConfig[n.shieldData.level+1],r=GlobalConfig.ShieldStageConfig[n.shieldData.stage],s=n.shieldData.exp}if(!a)return!1;if(this.assert(o&&r,"config or stageConfig is null"))return!1;var h=BagCT.ins().getBagGoodsCountById(0,o.itemId);return void 0==r.normalCostTip?!1:h>=r.normalCostTip},e.prototype.canShowRedPointInRole=function(t){for(var i=[e.TYPE_LONG_HUN],n=0,s=i;n<s.length;n++){var o=s[n];if(this.canShowRedPointByType(t,o))return!0}return!1},e.prototype.canShowRedPointInAll=function(){for(var t=0;3>t;t++)if(this.canShowRedPointInRole(t))return!0;return HeartMethodRedPoint.ins().redPoint?!0:HunguRedPoint.ins().redPoint?!0:!1},e.prototype.canUpgradeByType=function(t,i){var n=SubRoles.ins().getSubRoleByIndex(t);if(n){var s=null,o=null;switch(i){case e.TYPE_LONG_HUN:s=GlobalConfig.LoongSoulConfig[n.loongSoulData.level],o=GlobalConfig.LoongSoulStageConfig[n.loongSoulData.stage];break;case e.TYPE_HU_DUN:s=GlobalConfig.ShieldConfig[n.shieldData.level],o=GlobalConfig.ShieldStageConfig[n.shieldData.stage]}var a=BagCT.ins().getBagGoodsCountById(0,s.itemId);return a>0}return!1},e.prototype.canUpgradeinAll=function(){for(var t=[e.TYPE_LONG_HUN,e.TYPE_HU_DUN,e.TYPE_XUE_YU],i=0;3>i;i++)for(var n=0,s=t;n<s.length;n++){var o=s[n];if(1==this.canUpgradeByType(i,o))return!0}return!1},e.prototype.canGradeupLoongSoul=function(t){for(var e=[!1,!1,!1],i=SubRoles.ins().subRolesLen,n=0;i>n;n++)e[n]=this.canShowRedPointInRole(n);return e},e.prototype.assert=function(t,e){return Assert(t,"["+egret.getQualifiedClassName(this)+"] "+e)},e.TYPE_LONG_HUN=2,e.TYPE_HU_DUN=3,e.TYPE_XUE_YU=4,__decorate([post()],e.prototype,"postDateUpdate",null),__decorate([post()],e.prototype,"postStageUpgrade",null),__decorate([post()],e.prototype,"postStageActive",null),e}(BaseSystem);__reflect(LongHun.prototype,"LongHun"),System.LongHun=function(){return LongHun.ins()},window.LongHun=LongHun;var LongHunData=function(){function t(){this.level=0,this.stage=0,this.exp=0,this.state=0}return t.prototype.parser=function(t){this.stage=t.readInt(),this.level=t.readInt(),this.exp=t.readInt(),this.state=t.readByte()},t.getLongHunAllLevel=function(){for(var t=0,e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i).loongSoulData;t+=n.level}return t},t}();__reflect(LongHunData.prototype,"LongHunData"),window.LongHunData=LongHunData;var LongHunWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.starList=null,e.barbc=new ProgressBarEff,e.log="LongHunWin ",e.isclick=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.log+="skinComplete ",this.barbc.setWidth(525),this.barbc.x=-15,this.barbc.y=-12,this.expGroup.addChild(this.barbc),this.iconMC=new MovieClip,this.eEffGroup.addChild(this.iconMC),this.starList=new StarList(10),this.starList.x=15,this.starList.y=0,this.starGroup.addChild(this.starList),this.iconY=this.icon.y,this.iconMoveY=this.iconY-10,this.eff=new MovieClip,this.eff.x=this.activeBtnMc.width/2,this.eff.y=this.activeBtnMc.height/2,this.eff.scaleX=1.17,this.eff.touchEnabled=!1,this.activeBtnMc.touchEnabled=!1,this.icon.smoothing=!0,this.addTouchEvent(this.activeBtn,this.onTap),this.maxShowGroup.visible=!1,this.index=LongHun.TYPE_LONG_HUN,this.curRole=this.curRole},e.prototype.addDisplay=function(){this.log+="addDisplay ",this.observe(BagCT.ins().postItemAdd,this.roleChange),this.observe(LongHun.ins().postDateUpdate,this.roleChange),this.observe(LongHun.ins().postStageUpgrade,this.roleChange),this.observe(LongHun.ins().postStageActive,this.roleChange),this.addTouchEvent(this.upgradeBtn,this.updateDown,!0),this.upgradeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this),this.playIconTween()},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){this.isclick||("提升"==this.upgradeBtn.label?this.sendUpgrade():"升阶"==this.upgradeBtn.label?(this.isclick=!0,this.sendStageUpgrade()):(this.isclick=!0,this.openBuyGoods()))},e.prototype.removeDisplay=function(){this.log+="removeDisplay ",this.stopIconTween(),DisplayUtils.removeFromParent(this.eff),this.removeTouchEvent(this.upgradeBtn,this.updateDown,!0),this.upgradeBtn&&this.upgradeBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.log+="curRole ",this.barbc.reset(),this.roleChange(),this.onTabChange(),this.playIconTween())},enumerable:!0,configurable:!0}),e.prototype.playIconTween=function(){this.icon.y=this.iconY,egret.Tween.removeTweens(this.icon),egret.Tween.get(this.icon,{loop:!0}).to({y:this.iconMoveY},1e3).to({y:this.iconY},1e3)},e.prototype.stopIconTween=function(){this.icon&&egret.Tween.removeTweens(this.icon)},e.prototype.onTabChange=function(t){void 0===t&&(t=null),this.roleChange()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.closeBtn0:case this.closeBtn:ViewManager.ins().close(this);break;case this.activeBtn:var e=GlobalConfig.LoongSoulBaseConfig.openlv;Actor.level>=e?this.sendStageActive():TipsCT.ins().showTips("等级达到"+e+"级可激活")}},e.prototype.onTaps=function(t){if(null!=this._config){var e=GlobalConfig.VipConfig[this.index>2?13:14].attrAddition.percent;e=this.index==LongHun.TYPE_XUE_YU?0:e;var i=[];this._config.attr.forEach(function(t){i.push(t.value*e/100>>0)}),ViewManager.ins().open(ForgeTipsWin,i,AttributeData.getAttStr(this._config.attr,1,1,""))}},e.prototype.maxControll=function(t){this.maxGroup.visible=t,this.material.visible=t,this.barbc.visible=t,this.powerPanel.visible=!0,this.maxLevel.visible=!t,this.activeGroup.visible=!1,this.stairImg.visible=!0,this.maxShowGroup.visible=!t,t?(this.curAtt.x=62,this.curAtt.y=408):(this.curAtt.x=170,this.curAtt.y=408)},e.prototype.sendUpgrade=function(){LongHun.ins().sendUpGrade(this.curRole,this.index-1)},e.prototype.sendStageUpgrade=function(){LongHun.ins().sendStageUpgrade(this.curRole,this.index-1)},e.prototype.openBuyGoods=function(){WarnCT.ins().setBuyGoodsWarn(this._config.itemId,this._missingNum)},e.prototype.sendStageActive=function(){LongHun.ins().sendStageActive(this.curRole,this.index-1)},e.prototype.updateStageInfo=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);if(this.icon.visible=!0,!this.iconMC)return this.log+="updateStageInfo skinName="+this.skinName+",skin="+!!this.skin+" ",void platform.reportError(this.log);switch(this.iconMC.stop(),this.iconMC.visible=!1,this.index){case LongHun.TYPE_LONG_HUN:this.icon.visible=!1,this.iconMC.visible=!0,this._stageConfig=GlobalConfig.LoongSoulStageConfig[t.loongSoulData.stage],this.iconMC.playFile(RES_DIR_EFF+"DragonSeal",-1);break;case LongHun.TYPE_HU_DUN:this._stageConfig=GlobalConfig.ShieldStageConfig[t.shieldData.stage];break;case LongHun.TYPE_XUE_YU:this._stageConfig=GlobalConfig.XueyuStageConfig[t.xueyuData.stage]}this.icon.source=this._stageConfig.icon},e.prototype.roleChange=function(t){void 0===t&&(t=0),this.updateStageInfo();var e,i=0,n=0,s=SubRoles.ins().getSubRoleByIndex(this.curRole),o=null;if(this.index==LongHun.TYPE_HU_DUN)if(i=s.shieldData.level,n=s.shieldData.exp,this._config=GlobalConfig.ShieldConfig[i],e=GlobalConfig.ShieldConfig[i+1],Actor.vip>=13){this.addTouchEvent(this.vipLabel,this.onTaps);var a=AttributeData.getAttrStrAdd(this._config.attr,13);this.curAtt.text=AttributeData.getAttStr(a,0,1,"：")}else o=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr),this.curAtt.text=AttributeData.getAttStr(o,0,1,"：");else if(this.index==LongHun.TYPE_LONG_HUN){if(i=s.loongSoulData.level,n=s.loongSoulData.exp,this._config=GlobalConfig.LoongSoulConfig[i],e=GlobalConfig.LoongSoulConfig[i+1],this.stairImg.setValue(s.loongSoulData.stage+1),Actor.vip>=14){var a=AttributeData.getAttrStrAdd(this._config.attr,14);this.curAtt.text=AttributeData.getAttStr(a,0,1,"：")}else o=AttributeData.AttrAddition(this._config.attr,this._stageConfig.attr),o=DemonCir.ins().getAttrsBySysID(o,4),this.curAtt.text=AttributeData.getAttStr(o,0,1,"：");this.maxCurAtt.text=this.curAtt.text}i>0?this.starList.setStarNum(i%10==0?10:i%10,t):this.starList.setStarNum(0);var r=GlobalConfig.LoongSoulBaseConfig.openlv;this.sysDescText.text="开启魂印获得大量攻击防御\n\n"+r+"级可开启",this.barbc.setData(n,this._config.exp);var l=BagCT.getAttrPower(this._config.attr);l+=Math.floor(l*DemonCir.ins().getAddPerBySysIDRoleId(4,this._curRole)/1e4),this.powerPanel.setPower(l);var h=CommonUtils.getObjectLength(GlobalConfig.LoongSoulConfig)-1;if(s.loongSoulData.state){if(i==h)return void this.maxControll(!1);this.maxControll(!0)}else this.maxGroup.visible=!1,this.material.visible=!1,this.barbc.visible=!1,this.maxLevel.visible=!1,this.stairImg.visible=!1,this.activeGroup.visible=!0,this.powerPanel.visible=!1,this.redPoint.visible=!1,Actor.level>=r?(this.activeBtn.enabled=!0,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.parent||this.activeBtnMc.addChild(this.eff),this.redPoint.visible=!0):(this.activeBtn.enabled=!1,DisplayUtils.removeFromParent(this.eff));var u=BagCT.ins().getBagGoodsCountById(0,this._config.itemId);this.upgradeBtn.label=1>u?"获得材料":"提升",u<this._stageConfig.normalCost?this._missingNum=this._stageConfig.normalCost-u:this._missingNum=0;var p="";p=u>=this._stageConfig.normalCost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.material.textFlow=TextFlowMaker.generateTextFlow("拥有碎片:<font color="+p+">"+u+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+this._stageConfig.normalCost+"</font> "),this.material.visible=!0,this.showStageUpgradeBtn(i);var c,d,g=0,f="升阶"==this.upgradeBtn.label,v=f?this._config:e;this.index==LongHun.TYPE_LONG_HUN?(c=AttributeData.getAttrStrAdd(v.attr,13),g=f?s.loongSoulData.stage+1:s.loongSoulData.stage,d=GlobalConfig.LoongSoulStageConfig[g]):this.index==LongHun.TYPE_HU_DUN?(c=AttributeData.getAttrStrAdd(v.attr,14),g=f?s.shieldData.stage+1:s.shieldData.stage,d=GlobalConfig.ShieldStageConfig[g]):this.index==LongHun.TYPE_XUE_YU&&(c=AttributeData.getAttrStrAdd(v.attr,15),g=f?s.xueyuData.stage+1:s.xueyuData.stage,d=GlobalConfig.XueyuStageConfig[g]),c=AttributeData.AttrAddition(c,d.attr),this.nextAtt.text=AttributeData.getAttStr(c,0,1,"：")},e.prototype.showStageUpgradeBtn=function(t){var e=0,i=SubRoles.ins().getSubRoleByIndex(this.curRole);switch(this.index){case LongHun.TYPE_LONG_HUN:e=i.loongSoulData.stage;break;case LongHun.TYPE_HU_DUN:e=i.shieldData.stage;break;case LongHun.TYPE_XUE_YU:e=i.xueyuData.stage}t>0&&t%10==0&&(t/10-1>=e?(this.upgradeBtn.label="升阶",this.material.visible=!1,this.starList.setStarNum(10),this.barbc.visible=!1):(this.starList.setStarNum(0),this.barbc.visible=!0))},e}(BaseView);__reflect(LongHunWin.prototype,"LongHunWin"),window.LongHunWin=LongHunWin;var TreasureWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="TreasureWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(HeartMethodRedPoint.ins().postHeartMethodRedPoint,this.showRoleRedPoint),this.observe(ShenshouRedpoint.ins().postRedPoint,this.showTabRedPoint),this.observe(BagCT.ins().postItemAdd,this.delayRedPoint),this.observe(BagCT.ins().postItemChange,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LongHun.ins().postDateUpdate,this.delayRedPoint),this.observe(LongHun.ins().postStageUpgrade,this.delayRedPoint),this.observe(LongHun.ins().postStageActive,this.delayRedPoint),this.observe(HunguRedPoint.ins().postRedPoint,this.showTabRedPoint),this.observe(HunguRedPoint.ins().postRoleRedPoint,this.showRoleRedPoint),this.lastSelect=t[0]||0,this.curRole=t[1]||0,this.viewStack.selectedIndex=this.lastSelect,this.tab.validateNow(),this.roleSelect.setCurRole(this.curRole),this.checkYuPeiRed(),this.checkPanel()},e.prototype.skinComplete=function(){this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEvent(this.help,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap)},e.prototype.checkPanel=function(){Hungu.ins().checkShowOpen()?this.HunguPanel.parent||this.viewStack.addChild(this.HunguPanel):DisplayUtils.removeFromParent(this.HunguPanel)},e.prototype.delayRedPoint=function(){Timer.has(this.checkYuPeiRed,this)||Timer.start(60,1,this.checkYuPeiRed,this)},e.prototype.checkYuPeiRed=function(){var t=this.viewStack.getChildIndex(this.ShenluPanel),e=this.tab.getChildAt(t),i=e.eRp;i.visible=!1;for(var n=0;n<SubRoles.ins().subRolesLen;n++){var s=LongHun.ins().canShowRedPointInRole(n);if(s){i.visible=s;break}}t=this.viewStack.getChildIndex(this.YupeiPanel),e=this.tab.getChildAt(t),i=e.eRp,i.visible=JadeNew.ins().checkRed(),this.showRoleRedPoint()},e.prototype.onTabTouching=function(t){e.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setRoleId=function(t){this.curRole=t,this.HeartPanel.curRole=this.HunguPanel.curRole=this.YupeiPanel.curRole=this.ShenluPanel.curRole=this.curRole,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.help:this.viewStack.selectedIndex==e.Longhun||(this.viewStack.selectedIndex==e.Yupei?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[30].text):this.viewStack.selectedIndex==e.Xinfa?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[27].text):this.viewStack.selectedIndex==e.Hungu&&ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[36].text));break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setOpenIndex=function(t){this.help.visible=!0,this.roleSelect.currentState="yhead";var i=[];switch(this.viewStack.selectedIndex){case e.Longhun:this.title.source="biaoti_longhun",this.help.visible=!1;break;case e.Yupei:this.title.source="biaoti_yupei";break;case e.Xinfa:this.title.source="heartmethodName";break;case e.Shenshou:this.help.visible=!1,this.title.source="biaoti_shoushen",this.roleSelect.currentState="nohead";break;case e.Hungu:this.title.source="hunguName",i[0]=HGPOS.ITEM0,this.HunguPanel.pos=i[1]||0}this.lastSelect=t,this.showRoleRedPoint()},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t&&t.length){if(2==t[0]){if(!HeartMethod.ins().checkOpen())return TipsCT.ins().showTips("开服第"+GlobalConfig.HeartMethodBaseConfig.serverDay+"天并达到"+GlobalConfig.HeartMethodBaseConfig.zsLv+"转开启"),!1}else if(3==t[0]&&!ShenshouModel.ins().checkOpen())return TipsCT.ins().showTips("开服第"+GlobalConfig.ShenShouConfig.openserverday+"天并达到"+GlobalConfig.ShenShouConfig.openzhuanshenglv+"转开启"),!1;return!0}},e.checkIsOpen=function(t){return t!=e.Yupei||JadeNew.ins().checkOpen()?t!=e.Xinfa||HeartMethod.ins().checkOpen()?t!=e.Shenshou||ShenshouModel.ins().checkOpen()?t!=e.Hungu||Hungu.ins().checkOpen()?!0:(TipsCT.ins().showTips("开服第"+GlobalConfig.HunGuConf.openserverday+"天并达到"+GlobalConfig.HunGuConf.openzhuanshenglv+"转开启"),!1):(TipsCT.ins().showTips("开服第"+GlobalConfig.ShenShouConfig.openserverday+"天并达到"+GlobalConfig.ShenShouConfig.openzhuanshenglv+"转开启"),!1):(TipsCT.ins().showTips("开服第"+GlobalConfig.HeartMethodBaseConfig.serverDay+"天并达到"+GlobalConfig.HeartMethodBaseConfig.zsLv+"转开启"),!1):(TipsCT.ins().showTips("开服第"+GlobalConfig.JadePlateBaseConfig.openDay+"天并达到"+GlobalConfig.JadePlateBaseConfig.openlv+"级开启"),!1)},e.prototype.showTabRedPoint=function(){var t,e,i=this.viewStack.getChildIndex(this.HeartPanel);i>-1&&(t=this.tab.getChildAt(i),e=t.eRp,e.visible=HeartMethodRedPoint.ins().redPoint),i=this.viewStack.getChildIndex(this.shenshouPanel),i>-1&&(t=this.tab.getChildAt(i),e=t.eRp,e.visible=ShenshouRedpoint.ins().redpoint),i=this.viewStack.getChildIndex(this.HunguPanel),i>-1&&(t=this.tab.getChildAt(i),e=t.eRp,e.visible=HunguRedPoint.ins().redPoint)},e.prototype.showRoleRedPoint=function(){var t=SubRoles.ins().subRolesLen;switch(this.viewStack.selectedIndex){case e.Longhun:for(var i=0;t>i;i++)this.roleSelect.showRedPoint(i,LongHun.ins().canShowRedPointInRole(i));break;case e.Yupei:for(var i=0;t>i;i++)this.roleSelect.showRedPoint(i,JadeNew.ins().checkRedByRoleID(i));break;case e.Xinfa:for(var i=0;t>i;i++){var n=!1;for(var s in HeartMethodRedPoint.ins().roleTabs[i])if(HeartMethodRedPoint.ins().roleTabs[i][s]){n=!0;break}this.roleSelect.showRedPoint(i,n)}break;case e.Hungu:for(var i=0;t>i;i++){var n=HunguRedPoint.ins().roleTabs[i];this.roleSelect.showRedPoint(i,n)}}this.showTabRedPoint()},e.Longhun=0,e.Yupei=1,e.Xinfa=2,e.Shenshou=3,e.Hungu=4,e}(BaseEuiView);__reflect(TreasureWin.prototype,"TreasureWin"),ViewManager.ins().reg(TreasureWin,LayerManager.UI_Main),window.TreasureWin=TreasureWin;var JadeNewPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curRole=0,e._oldLevel=0,e._curMaterail=-1,e._oneKeyUp=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this._iconY=this.yupei.y,this._iconMoveY=this.yupei.y-30,this.yupei.perLevel=GlobalConfig.JadePlateBaseConfig.perLevel,this._danInfo=[];var t,e=0;for(var i in GlobalConfig.JadePlateBaseConfig.upgradeInfo)this["up"+e].name=e,t=GlobalConfig.ItemConfig[i],this["up"+e].source=t.icon+"_png",this._danInfo.push({id:+i,used:0,curMax:0,jade:0,count:0}),e++;this._materialInfo=[],e=0;for(var i in GlobalConfig.JadePlateBaseConfig.itemInfo)this["checkBoxs"+e].name=e,t=GlobalConfig.ItemConfig[i],this["lvImg"+e].source=t.icon+"_png",this["lvImg"+e].name=i,this._materialInfo.push({id:+i,count:0,addExp:+GlobalConfig.JadePlateBaseConfig.itemInfo[i]}),e++;for(e=0;5>e;e++)this["skillIcon"+e].name=e,this["skillIcon"+e].touchEnabled=!0,this["skillIcon"+e].touchChildren=!1;this._expBar=new ProgressBarEff,this._expBar.setWidth(525),this.barGroup.addChild(this._expBar),this._expBar.x=-15,this._expBar.y=-10,this.addTouchEvent(this,this.onTouch),this.curRole=this.curRole},e.prototype.addDisplay=function(){this.observe(JadeNew.ins().postJadeData,this.jadeChange),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(ExpansionCardCT.ins().postActive,this.updateMaterial),this.observe(ExpansionCardCT.ins().postInit,this.updateMaterial),this.playIconTween()},e.prototype.removeDisplay=function(){this.stopIconTween(),this._curMaterail=-1,this.stopOneKyUp()},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this._jadeData=JadeNew.ins().getJadeDataByID(t),this._jadeData&&(this._oldLevel=this._jadeData.lv,this.reset(),this.update(),this.playIconTween()))},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._curMaterail=-1,this.stopOneKyUp(),this.checkBoxs0.selected=this.checkBoxs1.selected=this.checkBoxs2.selected=!1,this.stopIconTween(),this._expBar.reset()},e.prototype.jadeChange=function(t){this.curRole==t&&(this._jadeData=JadeNew.ins().getJadeDataByID(this.curRole),this.update())},e.prototype.playIconTween=function(){this.yupei.y=this._iconY,egret.Tween.removeTweens(this.yupei),egret.Tween.get(this.yupei,{loop:!0}).to({y:this._iconMoveY},1e3).to({y:this._iconY},1e3)},e.prototype.stopIconTween=function(){this.yupei&&egret.Tween.removeTweens(this.yupei)},e.prototype.update=function(){var t,e=this._jadeData.lv,i=[],n=GlobalConfig.JadePlateLevelConfig[e];for(var s in n.attrs)t=n.attrs[s],i.push(new AttributeData(t.type,t.value));i=this.addDanAtt(i),this.powerPanel.setPower(BagCT.getAttrPower(i,SubRoles.ins().getSubRoleByIndex(this.curRole)));var o=Math.floor(e/GlobalConfig.JadePlateBaseConfig.perLevel)+1;this.lv.text=this.getNumStr(o)+"阶"+this.getNumStr(e%GlobalConfig.JadePlateBaseConfig.perLevel)+"级";var a,r=JadeNew.ins().isJadeMax(this.curRole);if(this.maxShowGroup.visible=this.maxLevel.visible=r,this.updateMaterial(),r)this.maxGroup.visible=!1,this.maxCurAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："));else{this.maxGroup.visible=!0,a=this._oldLevel!=e,this._oldLevel=e,this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"：")),i=[];var l=GlobalConfig.JadePlateLevelConfig[e+1];for(var s in l.attrs)i.push(new AttributeData(l.attrs[s].type,l.attrs[s].value));i=this.addDanAtt(i),this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："))}this.yupei.setLevel(e,a&&e%GlobalConfig.JadePlateBaseConfig.perLevel==10),e%GlobalConfig.JadePlateBaseConfig.perLevel==10?this.barGroup.visible=!1:(this.barGroup.visible=!0,this._expBar.getMaxValue()!=n.exp?this._expBar.setData(this._jadeData.exp,n.exp):this._expBar.setValue(this._jadeData.exp)),n=GlobalConfig.JadePlateLevelConfig[(o-1)*GlobalConfig.JadePlateBaseConfig.perLevel];for(var h=GlobalConfig.JadePlateBaseConfig.skillUnlock.length,u=n.skillIdList?n.skillIdList.length:0,p=0;h>p;p++){this["blackImg"+p].visible=!0;for(var c=0;u>c;c++)n.skillIdList[c]==GlobalConfig.JadePlateBaseConfig.skillUnlock[p].id&&(this["blackImg"+p].visible=!1)}},e.prototype.getNumStr=function(t){var e=[];if(Math.floor(t/10)){var i=Math.floor(t/10);i>1&&e.push(i),e.push(10),t%10!=0&&e.push(t%10)}else e.push(t%10);for(var n="",s=e.length,o=0;s>o;o++)switch(e[o]){case 0:n+="零";break;case 1:n+="一";break;case 2:n+="二";break;case 3:n+="三";break;case 4:n+="四";break;case 5:n+="五";break;case 6:n+="六";break;case 7:n+="七";break;case 8:n+="八";break;case 9:n+="九";break;case 10:n+="十"}return n},e.prototype.addDanAtt=function(t){if(this._jadeData.danDate&&Object.keys(this._jadeData.danDate).length){var e=t.concat(),i=void 0,n=void 0;for(var s in this._jadeData.danDate){if(i=GlobalConfig.JadePlateBaseConfig.upgradeInfo[s],i.precent)for(var o=e.length,a=0;o>a;a++)e[a].type!=AttributeType.atHuiXinDamage&&t.push(new AttributeData(e[a].type,Math.floor(e[a].value*+this._jadeData.danDate[s]*i.precent/1e4)));if(i.attr){n=i.attr.length;for(var r=0;n>r;r++)t.push(new AttributeData(i.attr[r].type,i.attr[r].value*+this._jadeData.danDate[s]))}}e=[],n=t.length;for(var l=new Object,h=0;n>h;h++)void 0==l[t[h].type]&&(l[t[h].type]=0),l[t[h].type]+=t[h].value;for(var s in l)e.push(new AttributeData(+s,+l[s]));return e}return t},e.prototype.updateMaterial=function(){if(this._jadeData){for(var t,e,i,n=this._jadeData.lv,s=this._danInfo.length,o=Math.floor(n/GlobalConfig.JadePlateBaseConfig.perLevel)+1,a=0;s>a;a++){t=this._danInfo[a],e=BagCT.ins().getBagItemById(t.id),t.count=e?e.count:0,t.used=this._jadeData.danDate&&this._jadeData.danDate[t.id]?+this._jadeData.danDate[t.id]:0,t.jade=o,i=GlobalConfig.JadePlateLevelConfig[(o-1)*GlobalConfig.JadePlateBaseConfig.perLevel];var r=t.id-204067,l=i.upgradeItemInfo&&i.upgradeItemInfo[t.id]?+i.upgradeItemInfo[t.id]:0,h=ExpansionCardCT.ins().useDanData,u=h&&h[r]?h[r].addNum:0;t.curMax=u+l,this["used"+a].text=t.used,this["redPoint"+a].visible=t.used<t.curMax&&t.count}s=this._materialInfo.length;for(var p,c=0,a=0;s>a;a++)p=this._materialInfo[a],e=BagCT.ins().getBagItemById(p.id),p.count=e?e.count:0,this["lvNum"+a].textFlow=TextFlowMaker.generateTextFlow1("|C:"+(p.count?65280:16711680)+"&T:"+p.count),c+=p.addExp*p.count;this.normal.visible=n%GlobalConfig.JadePlateBaseConfig.perLevel!=10,this.upLv.visible=!this.normal.visible,this.upgradeBtn0.visible=this.upgradeBtn.visible}},e.prototype.onTouch=function(t){switch(t.target){case this.upgradeBtn:this.onUpgrade();break;case this.upgradeBtn0:this.onUpgrade(!0);break;case this.upgradeBtn1:this.onUpgrade();break;case this.up0:case this.up1:case this.up2:var e=this._danInfo[t.target.name];e.used<e.curMax&&e.count?JadeNew.ins().sendUseDan(this.curRole,e.id):ViewManager.ins().open(JadeUpTipsWin,e);break;case this.checkBoxs0:case this.checkBoxs1:case this.checkBoxs2:this._oneKeyUp&&this.stopOneKyUp();var i=+t.target.name;this._curMaterail=-1;for(var n=void 0,s=0;3>s;s++)n=this["checkBoxs"+s],s==i?this._curMaterail=n.selected?i:-1:n.selected=!1;break;case this.skillIcon0:case this.skillIcon1:case this.skillIcon2:case this.skillIcon3:case this.skillIcon4:var o=GlobalConfig.JadePlateBaseConfig.skillUnlock[t.target.name];ViewManager.ins().open(YupeiSkillTipsWin,o.name,o.desc);break;case this.lvImg0:case this.lvImg1:case this.lvImg2:ViewManager.ins().open(ItemDetailedWin,0,t.target.name)}},e.prototype.onUpgrade=function(t){if(void 0===t&&(t=!1),this._jadeData){if(t&&this._oneKeyUp)return void this.stopOneKyUp();if(this._oneKeyUp&&this.stopOneKyUp(),this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10)JadeNew.ins().sendUpgrade(this.curRole,this._materialInfo[0].id);else if(-1==this._curMaterail)TipsCT.ins().showTips("请先选择需要消耗的道具");else if(this._materialInfo[this._curMaterail].count<=0)TipsCT.ins().showTips("|C:16711680&T:材料不足"),WarnCT.ins().setBuyGoodsWarn(this._materialInfo[this._curMaterail].id);else{var e=this._materialInfo[this._curMaterail].count;e>1&&t?(Timer.start(150,e,this.sendUp,this,this.stopOneKyUp,this),this.upgradeBtn0.label="停  止",this._oneKeyUp=!0):JadeNew.ins().sendUpgrade(this.curRole,this._materialInfo[this._curMaterail].id)}}},e.prototype.stopOneKyUp=function(){this.skin&&(this._oneKeyUp=!1,this.upgradeBtn0.label="一键升级",Timer.stop(this.sendUp,this))},e.prototype.sendUp=function(){return this._jadeData.lv%GlobalConfig.JadePlateBaseConfig.perLevel==10?void this.stopOneKyUp():void JadeNew.ins().sendUpgrade(this.curRole,this._materialInfo[this._curMaterail].id)},e}(BaseView);__reflect(JadeNewPanel.prototype,"JadeNewPanel"),window.JadeNewPanel=JadeNewPanel;var JadeUpTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YuPeiUpTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.data=t[0],this.update(),this.observe(ExpansionCardCT.ins().postActive,this.update),this.observe(ExpansionCardCT.ins().postInit,this.update)},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.data.id];this.itemIcon.setData(t),this.nameLabel.text=t.name,this.use.text=this.data.used+"/"+this.data.curMax,this.num.text=this.data.count+"",this.attr.textFlow=TextFlowMaker.generateTextFlow1(t.desc);var e,i,n=Math.floor((Object.keys(GlobalConfig.JadePlateLevelConfig).length-1)/GlobalConfig.JadePlateBaseConfig.perLevel)+1,s=!1;for(i=this.data.jade;n>=i;i++)if(e=GlobalConfig.JadePlateLevelConfig[(i-1)*GlobalConfig.JadePlateBaseConfig.perLevel],e.upgradeItemInfo&&e.upgradeItemInfo[this.data.id]&&+e.upgradeItemInfo[this.data.id]>this.data.curMax){s=!0;break}s?(this.info.visible=!0,this.num0.text=i+"阶"):this.info.visible=!1},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(JadeUpTipsWin.prototype,"JadeUpTipsWin"),ViewManager.ins().reg(JadeUpTipsWin,LayerManager.UI_Main),window.JadeUpTipsWin=JadeUpTipsWin;var YupeiSkillTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YupeiSkillTipsNewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.bgClose,this.onTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.nameLabel.text=t[0],this.description.textFlow=TextFlowMaker.generateTextFlow1(t[1])},e.prototype.onTouch=function(t){ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(YupeiSkillTipsWin.prototype,"YupeiSkillTipsWin"),window.YupeiSkillTipsWin=YupeiSkillTipsWin,ViewManager.ins().reg(YupeiSkillTipsWin,LayerManager.UI_Main);var MailCT=function(t){function e(){var e=t.call(this)||this;return e.currentMailHandle=0,e.mailData=[],e._mailListData=new eui.ArrayCollection,e.sysId=PackageID.Mail,e.regNetMsg(1,e.doMailData),e.regNetMsg(2,e.doMailDetailedData),e.regNetMsg(3,e.doDeleteMail),e.regNetMsg(4,e.doGetItemMail),e.regNetMsg(5,e.doAddMail),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"mailListData",{get:function(){return this.mailData.sort(this.mailSort2),this._mailListData.source=this.mailData,this._mailListData},enumerable:!0,configurable:!0}),e.prototype.sendMailContentData=function(t){var e=this.getBytes(2);e.writeDouble(t),this.sendToServer(e)},e.prototype.sendGetItem=function(t){var e=this.getBytes(4);e.writeInt(t.length);for(var i=0;i<t.length;i++)e.writeDouble(t[i]);this.sendToServer(e)},e.prototype.doMailData=function(t){this.parser(t,1),this.postMailData()},e.prototype.postMailData=function(){},e.prototype.doMailDetailedData=function(t){var e=new MailData;e.parser(t);for(var i=0;i<this.mailData.length;i++)if(this.mailData[i].handle==e.handle){this.mailData.splice(i,1,e);break}this.currentMailHandle=e.handle,this.isAllReceive||ViewManager.ins().open(MailDetailedWin),this.postMailDetail(e)},e.prototype.postMailDetail=function(t){return t},e.prototype.doDeleteMail=function(t){this.deleteMailDataByHandle(t.readDouble()),this.postMailData()},e.prototype.doGetItemMail=function(t){this.setMailListData(t)},e.prototype.postGetItemFromMail=function(){},e.prototype.doAddMail=function(t){this.parser(t,0),this.postMailData()},e.prototype.parser=function(t,e){if(e){this.mailData=[];for(var i=t.readInt(),n=0;i>n;n++){var s=new MailData;s.disposeData(t),this.mailData.push(s)}this.mailSort(1)}else{var s=new MailData;s.disposeData(t),this.mailData.unshift(s)}},e.prototype.getMailDataByHandle=function(t){for(var e=0,i=this.mailData;e<i.length;e++){var n=i[e];if(n.handle==t)return n}return null},e.prototype.deleteMailDataByHandle=function(t){for(var e=0;e<this.mailData.length;e++)if(this.mailData[e].handle==t)return void this.mailData.splice(e,1)},e.prototype.getMailByReceive=function(t){void 0===t&&(t=0);for(var e=[],i=this.mailData.length-1;i>=0;i--)this.mailData[i].receive==t&&e.push(this.mailData[i]);return e},e.prototype.getUnreadMail=function(){for(var t=0,e=this.mailData.length-1;e>=0;e--){var i=this.mailData[e];(0==i.type||0==i.receive)&&(t+=1)}return t},e.prototype.getCurrentMail=function(){return this.getMailDataByHandle(this.currentMailHandle)},e.prototype.setMailListData=function(t){for(var e=t.readInt(),i=0;e>i;i++)for(var n=t.readDouble(),s=0,o=this.mailData;s<o.length;s++){var a=o[s];if(a.handle==n){a.type=t.readInt(),a.receive=t.readInt(),this.postMailDetail(a);
break}}this.postGetItemFromMail()},e.prototype.sortDesc=function(t,e){var i=t.times,n=e.times;return Algorithm.sortDesc(i,n)},e.prototype.sortAsc=function(t,e){var i=t.times,n=e.times;return Algorithm.sortAsc(i,n)},e.prototype.mailSort=function(t){var e=this.mailData;return t?e.sort(this.sortDesc):e.sort(this.sortAsc),e},e.prototype.mailSort2=function(t,e){var i=0;return i=Algorithm.sortAsc(t.type,e.type),0!=i?i:0==t.receive&&0!=e.receive?-1:0!=t.receive&&0==e.receive?1:(i=Algorithm.sortDesc(t.times,e.times),0!=i?i:i)},__decorate([post()],e.prototype,"postMailData",null),__decorate([post()],e.prototype,"postMailDetail",null),__decorate([post()],e.prototype,"postGetItemFromMail",null),e}(BaseSystem);__reflect(MailCT.prototype,"MailCT"),System.MailCT=function(){return MailCT.ins()},window.MailCT=MailCT;var MailData=function(){function t(){}return t.prototype.parser=function(t){this.disposeData(t),this.item=[],this.text=t.readString();for(var e=t.readInt(),i=0;e>i;i++){var n=new RewardData;n.parser(t),this.item.push(n)}},t.prototype.disposeData=function(t){this.handle=t.readDouble(),this.title=t.readString(),this.times=DateUtils.formatMiniDateTime(t.readInt())/1e3,this.type=t.readInt(),this.receive=t.readInt()},t}();__reflect(MailData.prototype,"MailData"),window.MailData=MailData;var MailDetailedWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MailContentSkin",this.itemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.rect,this.onTap),this.textLabel.addEventListener(egret.TextEvent.LINK,this.linkClick,this),this.addTouchEvent(this.receiveBtn,this.onTap),this.observe(MailCT.ins().postGetItemFromMail,this.setMailData),this.setMailData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.linkClick=function(t){var e=t.text.split(","),i=e.slice(1);e[0]&&(ViewManager.ins().open(e[0],i[0]?i:null),ViewManager.ins().close(this),ViewManager.ins().close(FriendBgWin))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.receiveBtn:var e=[];e.push(MailCT.ins().currentMailHandle),MailCT.ins().sendGetItem(e);case this.closeBtn:case this.closeBtn0:case this.rect:ViewManager.ins().close(this)}},e.prototype.otherClose=function(t){var e=this.background;t.localX>=e.x&&t.localX<=e.x+e.width&&t.localY>=e.y&&t.localY<=e.y+e.height||ViewManager.ins().close(this)},e.prototype.setMailData=function(){var t=MailCT.ins().getCurrentMail();this.textLabel.textFlow=TextFlowMaker.generateTextFlow1(t.text),this.setReceiveBtn(t.receive,t.item.length>0);for(var e=t.item,i=[],n=[],s=[],o=[],a=[],r=0;r<e.length;r++){var l=GlobalConfig.ItemConfig[e[r].id];if(1!=ItemUtil.getType(l))0==e[r].type?e[r].id==MoneyConst.soul?a.push(e[r]):n.push(e[r]):o.push(e[r]);else if(s.length){for(var h=!1,u=0;u<s.length;u++)if(s[u].id==e[r].id){s[u].count+=e[r].count,h=!0;break}h||s.push(e[r])}else s.push(e[r])}o.sort(this.RuleSortByItem),i=a.concat(n,s,o),this.itemList.dataProvider=new eui.ArrayCollection(i)},e.prototype.RuleSortByItem=function(t,e){var i=GlobalConfig.ItemConfig[t.id],n=GlobalConfig.ItemConfig[e.id],s=ItemUtil.getQuality(i),o=ItemUtil.getQuality(n);return s>o?-1:o>s?1:0},e.prototype.setReceiveBtn=function(t,e){void 0===e&&(e=!1);var i="";this.receiveBtn.visible=t>=0,i=t?"已领取":"领取附件",this.receiveBtn.label=i,this.receiveBtn.enabled=!Boolean(t),this.receiveBtn.visible=e,this.desc.visible=!e},e}(BaseEuiView);__reflect(MailDetailedWin.prototype,"MailDetailedWin"),ViewManager.ins().reg(MailDetailedWin,LayerManager.UI_Popup),window.MailDetailedWin=MailDetailedWin;var MailItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MailItemSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this)},e.prototype.dataChanged=function(){var t=this.data;if(t instanceof MailData){var e="|C:0xA89C88&T:"+t.title+"|";e=e+"|C:"+(t.type?"0X5b5b5b":"0X00cc33")+"&T:"+(t.type?"(已读)":"(未读)")+"|",this.nameLabel.textFlow=TextFlowMaker.generateTextFlow(e),this.dateLabel.text=DateUtils.getFormatBySecond(t.times,2),this.treasure.source=0==t.receive?"220003_png":""}},e}(BaseItemRender);__reflect(MailItem.prototype,"MailItem"),window.MailItem=MailItem;var MailWin=function(t){function e(){var e=t.call(this)||this;return e.name="邮件",e}return __extends(e,t),e.prototype.childrenCreated=function(){this._mails=[],this.mailList.itemRenderer=MailItem,this.mailScroller.viewport=this.mailList},e.prototype.open=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.allReceiveBtn,this.onTap),this.addTouchEvent(this.mailList,this.onSendMail),this.observe(MailCT.ins().postMailDetail,this.setOpenMail),this.observe(MailCT.ins().postGetItemFromMail,this.mailCall),this.setMailData()},e.prototype.mailCall=function(){if(MailCT.ins().isAllReceive)for(var t=0;t<this._mails.length;t++)MailCT.ins().sendMailContentData(this._mails[t].handle);this.setMailData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.allReceiveBtn:MailCT.ins().isAllReceive=!0;for(var e=[],i=MailCT.ins().getMailByReceive(),n=0;n<i.length;n++)e.push(i[n].handle);MailCT.ins().sendGetItem(e)}},e.prototype.onSendMail=function(t){if(t){MailCT.ins().isAllReceive=!1;var e=t.target.parent;if(e){var i=e.data;i&&MailCT.ins().sendMailContentData(i.handle)}}},e.prototype.setMailData=function(){this._mails=MailCT.ins().mailData,this.mailList.dataProvider=new eui.ArrayCollection(this._mails),this.allReceiveBtn.visible=Boolean(MailCT.ins().getMailByReceive().length),MailCT.ins().mailData.length>0&&(this.noMailTip.visible=!1)},e.prototype.setOpenMail=function(t){for(var e=0;e<this.mailList.numChildren;e++){var i=this.mailList.getChildAt(e);if(i.data.handle==t.handle)return void(i.data=t)}},__decorate([callLater],e.prototype,"setMailData",null),e}(BaseView);__reflect(MailWin.prototype,"MailWin"),window.MailWin=MailWin;var MergeCC=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.isOpen=function(){var t=GlobalConfig.MergeTotal;for(var e in t)if((t[e].openZs||0)<=ZsCT.ins().lv&&(t[e].openLv||0)<=Actor.level)return!0;return!1},e.prototype.redPoint=function(){var t=!1;return SamsaraModel.ins().isOpen()&&(t=SamsaraModel.ins().isCanCompose()),!t&&ZhanLingModel.ins().ZhanLingOpen()&&(t=this.isZlCanMerge()),!t&&Rune.ins().isOpen()&&(t=Rune.ins().isRuneCanMerge()),!t&&ShenshouModel.ins().checkOpen()&&(t=this.isShenShouCanMerge()),!t&&ThunderCT.isThunderCanMerge()&&(t=ThunderCT.isThunderCanMerge()),t},e.prototype.getMergeMenu=function(){var t=GlobalConfig.MergeTotal,e=Actor.level,i=ZsCT.ins().lv,n=[];for(var s in t)t[s].type==MergeType.SamsareEquip?SamsaraModel.ins().isOpen()&&n.push(t[s]):(t[s].openZs||0)<=i&&(t[s].openLv||0)<=e&&n.push(t[s]);return n.sort(this.sortMenu),n},e.prototype.getMergeSecMenu=function(t){var e=GlobalConfig.MergeConfig[t],i=Actor.level,n=ZsCT.ins().lv,s=[];for(var o in e)(e[o].openZs||0)<=n&&(e[o].openLv||0)<=i&&s.push(e[o]);return s.sort(this.sortMenu),s},e.prototype.sortMenu=function(t,e){return Algorithm.sortAsc(t.sort,e.sort)},e.prototype.getListData=function(t,e){var i=GlobalConfig.MergeTotal[t],n=GlobalConfig.MergeConfig[t][e];return i.type==MergeType.SamsareEquip?SamsaraModel.ins().composeEquipMap[n.lv][n.openZs]:i.type==MergeType.ZhanlingEquip?this.getZlMergeEquipByLv(n.lv):i.type==MergeType.Rune?Rune.ins().getRuneMergeEquipByLv(n.lv):i.type==MergeType.Thunder?ThunderCT.getMergeEquipByType(n.sort):i.type==MergeType.MergeType_6?ShenshouSys.getMergeEquipByType(n.lv):i.type==MergeType.Shield?ShieldCT.getMergeEquipByType(n.lv):[]},e.prototype.isCanMergeById=function(t){var e=GlobalConfig.MergeTotal[t].type,i=!1;switch(e){case MergeType.SamsareEquip:i=SamsaraModel.ins().isCanTypeCompose(t);break;case MergeType.ZhanlingEquip:i=this.isZlCanMerge();break;case MergeType.Rune:i=Rune.ins().isRuneCanMerge();break;case MergeType.MergeType_6:i=ShenshouSys.isShenShouCanMerge();break;case MergeType.Shield:i=ShieldCT.isShieldCanMerge();break;case MergeType.Thunder:i=ThunderCT.isThunderCanMerge()}return i},e.prototype.isCanMergeByIndex=function(t,e){var i=GlobalConfig.MergeTotal[t].type,n=!1;switch(i){case MergeType.SamsareEquip:n=SamsaraModel.ins().isCanZsLvCompose(GlobalConfig.MergeConfig[t][e].lv,GlobalConfig.MergeConfig[t][e].openZs);break;case MergeType.ZhanlingEquip:n=this.isZlCanMergeByIndex(t,e);break;case MergeType.Rune:n=Rune.ins().isRuneCanMergeByType(e);break;case MergeType.MergeType_6:n=ShenshouSys.isShenShouCanMergeByIdIndex(e);break;case MergeType.Shield:n=ShieldCT.isShieldCanMergeByIdIndex(e);break;case MergeType.Thunder:n=ThunderCT.isThunderCanMergeByIdIndex(e)}return n},e.prototype.getCanMergeTargetId=function(t,e){var i=GlobalConfig.MergeTotal[t].type,n=0;switch(i){case MergeType.SamsareEquip:var s=GlobalConfig.MergeConfig[t][e];n=SamsaraModel.ins().getComposeEquipId(s.lv,s.openZs);break;case MergeType.ZhanlingEquip:n=this.getZlCanMergeTargetId(t,e)}return n},e.prototype.isCanMergeTargetId=function(t,e){if(t==MergeType.SamsareEquip){var i=GlobalConfig.ReincarnateEquipCompose[e];return SamsaraModel.ins().isCanEquipCompose(i.material.id)}return t==MergeType.ZhanlingEquip?this.isZlEquipIdCanMerge(e):t==MergeType.Rune?Rune.ins().isRuneCanMergeByID(e):t==MergeType.Thunder?ThunderCT.isCanMergeById(e):!1},e.prototype.getZlMergeEquipByLv=function(t){if(!this._zlMergeEquip){this._zlMergeEquip={};var e=GlobalConfig.ZhanLingEquip;for(var i in e)this._zlMergeEquip[e[i].level]||(this._zlMergeEquip[e[i].level]=[]),this._zlMergeEquip[e[i].level].push({type:MergeType.ZhanlingEquip,id:e[i].id})}return this._zlMergeEquip[t+1]},e.prototype.getZlCanMergeTargetId=function(t,e){for(var i=GlobalConfig.MergeConfig[t][e].lv,n=this.getZlMergeEquipByLv(i),s=0,o=n;s<o.length;s++){var a=o[s];if(this.isZlEquipIdCanMerge(a.id))return a.id}return 0},e.prototype.isZlCanMerge=function(){var t=GlobalConfig.ZhanLingEquip;for(var e in t)if(this.isZlEquipIdCanMerge(e))return!0;return!1},e.prototype.isZlCanMergeByIndex=function(t,e){return!!this.getZlCanMergeTargetId(t,e)},e.prototype.isShenShouCanMerge=function(){var t=GlobalConfig.ShenShouCompose;for(var e in t)if(ShenshouSys.isCanMergeById(t[e].id))return!0;return!1},e.prototype.isShieldCanMerge=function(){var t=GlobalConfig.AegisCompose;for(var e in t)if(ShieldCT.isCanMergeById(t[e].id))return!0;return!1},e.prototype.isZlEquipIdCanMerge=function(t){var e=GlobalConfig.ZhanLingEquip[t],i=e.mat;if(i){var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i[0].id)+this.getZlHadEquipCount(i[0].id);if(n>=i[0].count)return!0}return!1},e.prototype.getZlHadEquipCount=function(t){var e=GlobalConfig.ZhanLingEquip[t];return ZhanLingModel.ins().getZhanLingDataByItem(0,e.pos)==t?1:0},e}(BaseSystem);__reflect(MergeCC.prototype,"MergeCC");var MergeType;!function(t){t[t.SamsareEquip=1]="SamsareEquip",t[t.ZhanlingEquip=2]="ZhanlingEquip",t[t.Rune=3]="Rune",t[t.Thunder=5]="Thunder",t[t.MergeType_6=6]="MergeType_6",t[t.Shield=7]="Shield"}(MergeType||(MergeType={})),window.MergeType=MergeType,System.MergeCC=function(){return MergeCC.ins()},window.MergeCC=MergeCC;var ComposeMenuItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=ComposeSecMenuItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=ViewManager.ins().getView(BagWin).reinComposePanel;e.updateView(t.id,t.index,MergeCC.ins().getCanMergeTargetId(t.id,t.index)),e.unSelectList(),this.list.getVirtualElementAt(this.list.selectedIndex).setSelect(!0)},e.prototype.selectList=function(t){this.list.selectedIndex=t;var e=this.list.getVirtualElementAt(this.list.selectedIndex);e.selected=!0,e.setSelect(!0)},e.prototype.dataChanged=function(){var t=this.data;this.list.dataProvider=new eui.ArrayCollection(MergeCC.ins().getMergeSecMenu(t.id)),this.redPoint.visible=MergeCC.ins().isCanMergeById(t.id),this.rein_equips.source=t.btn_source},e}(BaseItemRender);__reflect(ComposeMenuItem.prototype,"ComposeMenuItem"),window.ComposeMenuItem=ComposeMenuItem;var ComposePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=-1,e._index=-1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.list.itemRenderer=ComposeMenuItem,this.list0.itemRenderer=SamsaraComposeItem,this._listData=new eui.ArrayCollection,this.list0.dataProvider=this._listData,this._tabListData=new eui.ArrayCollection,this.list.dataProvider=this._tabListData},e.prototype.addDisplay=function(){this.observe(BagCT.ins().postItemAdd,this.buffUpdata),this.observe(BagCT.ins().postItemDel,this.buffUpdata),this.observe(BagCT.ins().postItemChange,this.buffUpdata),this._tabListData.source=MergeCC.ins().getMergeMenu(),this.updateState(),this.param&&(this.selectList(this.param[0],this.param[1],this.param[2]),this.param=null)},e.prototype.setParam=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.param=t},e.prototype.removeDisplay=function(){this._id=-1,this._index=-1},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),e.prototype.buffUpdata=function(){Timer.stop(this.updateState,this),Timer.start(100,1,this.updateState,this)},e.prototype.updateState=function(){if(0!=this._tabListData.length){this._tabListData.refresh();var t=this._id,e=this._index,i=0;if(-1==this._id||-1==this._index){for(var n=0;n<this._tabListData.length;n++){t=this._tabListData.getItemAt(n).id;for(var s=MergeCC.ins().getMergeSecMenu(t),o=0;o<s.length;o++)if(i=MergeCC.ins().getCanMergeTargetId(s[o].id,s[o].index)){e=s[o].index;break}if(i)break}if(!i){t=this._tabListData.getItemAt(0).id;var s=MergeCC.ins().getMergeSecMenu(t);e=s[0].index}}else i=MergeCC.ins().getCanMergeTargetId(t,e);this.updateView(t,e,i)}},e.prototype.updateView=function(t,e,i){void 0===i&&(i=0),this._id=t,this._index=e;var n=MergeCC.ins().getListData(t,e);this._listData.source=n,this.refushBarList(i)},e.prototype.refushBarList=function(t){if(!t)return void(this.contentScroller.viewport.scrollV=0);for(var e=this.list0.dataProvider,i=0;i<e.length;i++)if(t==e.getItemAt(i).id){this.contentScroller.viewport.validateNow();var n=101*i;n>this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.height&&(n=this.contentScroller.viewport.contentHeight-this.contentScroller.height),0>n&&(n=0),this.contentScroller.viewport.scrollV=n;break}},e.prototype.unSelectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++)for(var i=this.list.getVirtualElementAt(e),n=i.list,s=0;s<n.dataProvider.length;s++){var o=n.getVirtualElementAt(s);o&&o.setSelect(!1)}},e.prototype.selectList=function(t,e,i){for(var n,s=0,o=0;o<this._tabListData.length;o++){var a=this._tabListData.getItemAt(o).type;if(t==a){s=o,n=this._tabListData.getItemAt(o).id;break}}var r=this.list.getVirtualElementAt(s),l=r.list,h=l.getVirtualElementAt(e-1);h&&h.setSelect(!0),this.updateView(n,e,h.data.id)},e}(BaseView);__reflect(ComposePanel.prototype,"ComposePanel"),window.ComposePanel=ComposePanel;var ComposeSecMenuItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.lv.text=""+t.btn_name,this.redPoint.visible=MergeCC.ins().isCanMergeByIndex(t.id,t.index);var e=ViewManager.ins().getView(BagWin).reinComposePanel;e.id==t.id&&e.index==t.index&&this.setSelect(!0)},e.prototype.setSelect=function(t){this.chosen.visible=t},e}(BaseItemRender);__reflect(ComposeSecMenuItem.prototype,"ComposeSecMenuItem"),window.ComposeSecMenuItem=ComposeSecMenuItem;var MoveCC=function(t){function e(){var i=t.call(this)||this;return i._stepIndex={},i.moveObjDic={},i.observe(MapView.onGridClick,i.mapClick),i.observe(e.moveComplete,i.touchTarget),i.observe(GameLogic.ins().postMoveEntity,i.moveEntity),egret.startTick(i.onEnterFrame,i),i}return __extends(e,t),e.prototype.myMoveTo=function(t,i,n){var s=this;GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY);for(var o=SubRoles.ins().subRolesLen,a=0;o>a;a++){var r=EntityManager.ins().getMainRole(a);r&&GameMap.moveEntity(r,t,i)}this.comFun=n;var l=function(t){t.team==Team.My&&(s.removeObserve(e.moveComplete,l),s.comFun&&s.comFun(),s.comFun=null,GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_HOOK))};this.observe(e.moveComplete,l)},e.prototype.mapClick=function(t){var e=t.target,i=t.x,n=t.y;this.findTarget=e;var s=SubRoles.lookAtTar;if(null!=s&&!s.isHardStraight){if(GameLogic.ins().stopAI(),e&&e.infoModel&&(e.infoModel.type==EntityType.Npc||e.infoModel.type==EntityType.Mine||GameMap.fbType==FbCT.FB_TYPE_XMHJ&&this.findTarget.infoModel.type==EntityType.Transfer)){var o=GameMap.getPosRangeRandom(e.x,e.y,DirUtil.get8DirBy2Point(e,s));i=o[0]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE),n=o[1]*GameMap.CELL_SIZE+Math.floor(MathUtils.limit(.2,1)*GameMap.CELL_SIZE)}EntrustManager.ins().cancelEntrusTask(EntrustType.Transfer),GameMap.moveTo(i,n)}},e.prototype.touchTarget=function(t){if(t.team==Team.My){if(this.findTarget&&this.findTarget.infoModel){var e=SubRoles.lookAtTar,i=GameMap.CELL_SIZE,n=SysSetting.ins().getValue("mapClickTx")*i,s=SysSetting.ins().getValue("mapClickTy")*i;if(this.findTarget.infoModel.type==EntityType.Npc){if(null==e||e.isHardStraight)return;if(!(Math.abs(e.x-n)<=i&&Math.abs(e.y-s)<=i))return;var o=GlobalConfig.NpcBaseConfig[this.findTarget.infoModel.configID],a=o.controlTarget;a&&a[0]&&ViewManager.ins().open(a[0])}else if(this.findTarget.infoModel.type==EntityType.Mine)ViewManager.ins().open(MineRobWin,this.findTarget.infoModel);else if(this.findTarget.infoModel.type==EntityType.Transfer&&(GameMap.sceneInMine()&&Mine.ins().sendSceneChange(this.findTarget.infoModel.configID),GameMap.fbType==FbCT.FB_TYPE_XMHJ)){if(!(Math.abs(e.x-n)<=i&&Math.abs(e.y-s)<=i))return;XinMoFbCT.ins().CGscenChange()}}this.findTarget=null}},e.prototype.moveEntity=function(t){var e=t[0],i=t[1],n=void 0==t[2]?!0:!!t[2];i&&i.length?(this._stepIndex[e.hashCode]=i.length-1,this.moveNextStep(e,i,n)):e.playAction(EntityAction.STAND)},e.moveComplete=function(t){return t},e.prototype.moveNextStep=function(t,i,n){if(void 0===n&&(n=!0),t.stopMove(),t.action!=EntityAction.DIE){if(this._stepIndex[t.hashCode]<0)return delete this._stepIndex[t.hashCode],t.playAction(EntityAction.STAND),void e.moveComplete(t);var s=i[this._stepIndex[t.hashCode]],o={x:0,y:0},a=s.nDir;n?(o.x=GameMap.grip2Point(s.nX),o.y=GameMap.grip2Point(s.nY)):(o.x=s.nX,o.y=s.nY),a=t instanceof CharRole||2!=t.infoModel.dirNum?DirUtil.get8DirBy2Point(t,o):DirUtil.get4DirBy2Point(t,o),t.dir=a,t.playAction(EntityAction.RUN),this.moveToPoint(t,o,i,n)}},e.prototype.moveToPoint=function(t,e,i,n){var s=egret.getTimer(),o=this.moveObjDic[t.hashCode],a=0;o&&s>o.total&&(a=o.total-s),t.canMove=!0;var r={x:e.x-t.x,y:e.y-t.y},l=t.moveSpeed/1e3,h=Math.sqrt(r.x*r.x+r.y*r.y),u=h/l;r.x=r.x/u,r.y=r.y/u;var p={entity:t,endPoint:e,vec:r,path:i,isGrid:n,time:s+a,total:s+u+a};this.moveObjDic[t.hashCode]=p,0>a&&this.moveObj(p,s),t==SubRoles.lookAtTar&&SoundUtil.play(SoundEnum.RUN,0)},e.prototype.onEnterFrame=function(t){for(var e in this.moveObjDic){var i=this.moveObjDic[e];i.entity.canMove?this.moveObj(this.moveObjDic[e],egret.getTimer()):delete this.moveObjDic[e]}return!1},e.prototype.moveObj=function(t,e){var i=t.entity;if(e>=t.total)i.x=t.endPoint.x,i.y=t.endPoint.y,this.onChange(t),this.onComplete(t);else{var n=e-t.time,s=t.vec.x*n,o=t.vec.y*n;t.time=e,i.x+=s,i.y+=o,this.onChange(t)}i.zIndex=i.y},e.prototype.onChange=function(t){var e=t.entity,i=GameMap.point2Grip(e.x),n=GameMap.point2Grip(e.y);e.alpha=GameMap.checkAlpha(i,n)?.7:1},e.prototype.onComplete=function(t){var e=t.entity.hashCode;this._stepIndex[e]--,this._stepIndex[e]<0&&delete this.moveObjDic[e],this.moveNextStep(t.entity,t.path,t.isGrid)},__decorate([post()],e,"moveComplete",null),e}(BaseSystem);__reflect(MoveCC.prototype,"MoveCC"),System.MoveCC=function(){return MoveCC.ins()},window.MoveCC=MoveCC;var NeiGong=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e.sysId=PackageID.NeiGong,e.regNetMsg(1,e.postNeiGongDataChange),e.regNetMsg(3,e.postNeiGongAct),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postNeiGongDataChange=function(t){var e=new NeiGongData(t);NeiGongModel.ins().neiGongList[e.roleId]=e},e.prototype.postNeiGongAct=function(t){var e=t.readShort();NeiGongModel.ins().neiGongList[e].activation=!!t.readInt(),Activationtongyong.show(0,"内功","jneigong_png")},e.prototype.sendNeiGongUpLevel=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendNeiGongUpStage=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.sendNeiGongAct=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},__decorate([post()],e.prototype,"postNeiGongDataChange",null),__decorate([post()],e.prototype,"postNeiGongAct",null),e}(BaseSystem);__reflect(NeiGong.prototype,"NeiGong"),System.NeiGong=function(){return NeiGong.ins()},window.NeiGong=NeiGong;var NeiGongModel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.neiGongList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.NeiGongCanUp=function(){var t=[!1,!1,!1];for(var e in SubRoles.ins().roles)this.canUpById(+e)&&(t[e]=!0);return t},e.prototype.canUp=function(){if(FbCT.ins().guanqiaID<GlobalConfig.NeiGongBaseConfig.openGuanqia)return!1;for(var t=Math.min(SubRoles.ins().subRolesLen,this.neiGongList.length),e=0;t>e;e++)if(this.canUpById(e))return!0;return!1},e.prototype.canUpById=function(t){if(this.neiGongList[t]){if(FbCT.ins().guanqiaID<=GlobalConfig.NeiGongBaseConfig.openGuanqia)return!1;if(this.neiGongList[t].stage>=GlobalConfig.NeiGongBaseConfig.maxStage)return!1;if(this.neiGongList[t].canMix||this.neiGongList[t].getCanLevelUp())return!0}return!1},e}(BaseClass);__reflect(NeiGongModel.prototype,"NeiGongModel");var NeiGongData=function(){function t(t){this.roleId=0,this.level=0,this.stage=0,this.exp=0,this.activation=!1,this.roleId=t.readShort(),this.level=t.readInt(),this.stage=t.readInt(),this.exp=t.readInt(),this.activation=t.readBoolean(),this.canMix=this.level>0&&this.level%GlobalConfig.NeiGongBaseConfig.levelPerStage==0}return t.prototype.getCanLevelUp=function(){var t=GlobalConfig.NeiGongStageConfig[this.stage][this.level];if(!t)return!1;var e=t.totalExp-this.exp,i=Math.ceil(e/t.addExp);return Actor.gold>=i*t.costMoney&&Actor.gold>=1e6},t}();__reflect(NeiGongData.prototype,"NeiGongData"),window.NeiGongModel=NeiGongModel;var NeiGongWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._curRole=0,e.canUp=!1,e.isLights=[],e.effs={},e.starPoint=[],e.isNext=!1,e.mcPos=[[58,77,0],[40,55,18],[50,25,36],[65,10,54],[105,0,72],[75,15,108],[105,30,126],[115,60,144],[105,95,162],[80,120,180]],e.isclick=!1,e.toHeight=0,e.mcWidth=140,e.mcHeight=140,e._currHeight=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"currHeight",{get:function(){return this._currHeight},set:function(t){this._currHeight=t},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.jingmai_entry.visible=this.jingmaiEff.visible=!1,this.upLevelMc=new MovieClip,this._shap=new egret.Shape,this.lineGroup.addChild(this._shap),this.lineBg.mask=this._shap,this._shap.x=this._shap.y=this.lineGroup.width>>1,this._shap.rotation=-196,this.circleMc=new MovieClip,this.circleMc.x=80,this.circleMc.y=75,this.circleMc.scaleX=this.circleMc.scaleY=1.07,this.mcGroup.addChild(this.circleMc),this.moveInMc=new MovieClip,this.moveInMc.x=66,this.moveInMc.y=80,this.ball.addChild(this.moveInMc);for(var t=NeiGongModel.ins().neiGongList[this.curRole],e=t?t.level:0,i=0;10>i;i++)this.starPoint[i]=new egret.Point(this["eff_"+i].x,this["eff_"+i].y),this.isLights[i]=e>i;this.eff=new MovieClip,this.eff.x=this.UplevelBtn0.x+this.UplevelBtn0.width/2,this.eff.y=this.UplevelBtn0.y+this.UplevelBtn0.height/2,this.eff.scaleX=1.15,this.eff.scaleY=1,this.eff.touchEnabled=!1,this.addTouchEvent(this.mixBtn,this.onClick),this.addTouchEvent(this.UplevelBtn0,this.onClick),this.addTouchEvent(this.jingmai_entry,this.enterJingmai),this.curRole=this.curRole},e.prototype.addDisplay=function(){this.lastLevel=-1,this.circleMc.playFile(RES_DIR_EFF+"NeigongEff4",-1),this.moveInMc.parent||this.ball.addChild(this.moveInMc),this.observe(NeiGong.ins().postNeiGongDataChange,this.refushPanelInfo),this.observe(Actor.ins().postLevelChange,this.setBtnStatuBarinfo),this.observe(NeiGong.ins().postNeiGongAct,this.updateActPanel),this.addTouchEvent(this.upBtn,this.updateDown,!0),this.upBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.removeDisplay=function(){this.removeTouchEvent(this.upBtn,this.updateDown,!0),this.upBtn&&this.upBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){this.isclick||(this.canUp?(NeiGong.ins().sendNeiGongUpLevel(this.curRole),SoundUtil.play(SoundEnum.SKILL_UP)):(this.isclick=!0,Shop.openBuyGoldWin(!1)||TipsCT.ins().showTips("金币不足")))},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&(this.refushPanelInfo(!0),this.updateActPanel())},enumerable:!0,configurable:!0}),e.openCheck=function(){var t=GlobalConfig.NeiGongBaseConfig.openLevel;return Actor.level<t?(TipsCT.ins().showTips(t+"级开启内功"),!1):!0},e.prototype.refushPanelInfo=function(t){var e=NeiGongModel.ins().neiGongList[this.curRole];e.activation&&(this.cruLevelCfg=GlobalConfig.NeiGongStageConfig[e.stage][e.level],this.cruLevelCfg&&(this.lastLevel!=e.level&&this.effectShow(t),this.lastLevel=e.level,this.setAttrCost(),this.setPowerShow(),this.setBtnStatuBarinfo(),this.seteffectPost()))},e.prototype.seteffectPost=function(){for(var t=NeiGongModel.ins().neiGongList[this.curRole],e=t?t.level:0,i=0;10>i;i++){var n=this.starPoint[i];n&&(this["eff_"+i].x=e>i?n.x:280,this["eff_"+i].y=e>i?n.y:320,this["eff_"+i].scaleX=1,this["eff_"+i].scaleY=1,this["eff_"+i].alpha=1)}},e.prototype.enterJingmai=function(){var t=GlobalConfig.JingMaiCommonConfig.openLevel;return Actor.level<t?void TipsCT.ins().showTips(t+"级开启"):void ViewManager.ins().open(JingMaiPanel,this.curRole)},e.prototype.setPowerShow=function(){this._totalPower=BagCT.getAttrPower(this.cruLevelCfg.attribute),this.powerPanel.setPower(this._totalPower)},e.prototype.setAttrCost=function(){var t=NeiGongModel.ins().neiGongList[this.curRole];this.stageImg.text=t.stage+"";var e=0,i=GlobalConfig.MonthCardConfig.neiGongGoldPrecent/100,n=Recharge.ins().getIsForeve()?1-i:1;t.canMix||(e=Math.floor(this.cruLevelCfg.costMoney*n));var s="";s=Actor.gold>=e?"|C:0x35e62d&T:":"|C:0xf3311e&T:",this.canUp=Actor.gold>=e,this.costlable.textFlow=TextFlowMaker.generateTextFlow(s+e);var o=this.cruLevelCfg.attribute;o.sort(AttributeData.sortAttribute);for(var a=o.length,r=0;3>r;r++)this["attr"+r].text=a>r?AttributeData.getAttStrByType(o[r],1):"";var l=0,h=0;t.level==GlobalConfig.NeiGongBaseConfig.levelPerStage?(l=t.stage+1,h=0):(l=t.stage,h=t.level+1);var u=GlobalConfig.NeiGongStageConfig[l],p=u?u[h]:null;if(p){var c="",d=p.attribute;d.sort(AttributeData.sortAttribute);for(var r=0;3>r;r++){if(a>r){var g=o[r];c=this.getAttrByType(d,g)}this["addAttr"+r].text=c,this["arrow"+r].visible=""!=c}this.isNext=!0}else{for(var r=0;3>r;r++)this["addAttr"+r].text="",this["arrow"+r].visible=!1;this.isNext=!1}},e.prototype.effectShow=function(t){for(var e=NeiGongModel.ins().neiGongList[this.curRole],i=e.level,n=0;10>n;n++)this["point_"+n].source=n>=i?"neigongzhuzi2":"neigongzhuzi1";i>0?DisplayUtils.drawCir(this._shap,(this.lineGroup.width>>1)+2,212*(i-1)/9):this._shap.graphics.clear();for(var n in this.effs)DisplayUtils.removeFromParent(this.effs[n]),this.effs[n]=null;if(t)for(var s=NeiGongModel.ins().neiGongList[this.curRole],o=s?s.level:0,n=0;10>n;n++)this.isLights[n]=o>n;for(var n=0;i>n;n++){var a=this.effs[n]||new MovieClip;a.x=1,a.y=30,a.scaleX=1,a.scaleY=1,this.effs[n]=a,this["eff_"+n].addChild(a),this.isLights[n]?a.playFile(RES_DIR_EFF+"NeigongEff1",-1):(this.isLights[n]=!0,this.moveEffectOut(n))}},e.prototype.setBtnStatuBarinfo=function(){var t=NeiGongModel.ins().neiGongList[this.curRole],e=t.canMix;this.upBtn.visible=!e&&this.isNext,this.mixBtn.visible=e,e&&(this.mixBtn.touchEnabled=!0),this.costInfo.visible=!e&&this.isNext,this.maxDesc.visible=!this.isNext,e?(this.expLabel.text="",this.upDataExpMcBall(this.cruLevelCfg.totalExp,this.cruLevelCfg.totalExp)):this.cruLevelCfg&&(this.upDataExpMcBall(t.exp,this.cruLevelCfg.totalExp),this.expLabel.text=t.exp+"/"+this.cruLevelCfg.totalExp)},e.prototype.onClick=function(t){var e=this;switch(t.target){case this.mixBtn:this.moveEffectIn(),this.mixBtn.touchEnabled=!1,Timer.start(400,1,function(){NeiGong.ins().sendNeiGongUpStage(e.curRole),SoundUtil.play(SoundEnum.SKILL_UP)},this);break;case this.UplevelBtn0:NeiGong.ins().sendNeiGongAct(this.curRole)}},e.prototype.updateActPanel=function(){var t=NeiGongModel.ins().neiGongList[this.curRole];this.showAct.visible=t.activation,this.showAct.visible&&this.refushPanelInfo(),this.Activation.visible=!t.activation;var e=GlobalConfig.NeiGongBaseConfig.openGuanqia;FbCT.ins().guanqiaID<=e?(this.activeTipsTxt0.text="闯关达到 第"+(e+1)+" 即可激活内功",DisplayUtils.removeFromParent(this.eff)):(this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.UplevelBtn0.parent.addChild(this.eff))},e.prototype.moveEffectOut=function(t){var e=this,i=NeiGongModel.ins().neiGongList[this.curRole],n=egret.Tween.get(this.eff_9);n.call(function(){e.moveInMc.playFile(RES_DIR_EFF+"NeigongEff3",1,null,!1)},this).wait(100).call(function(){DisplayUtils.removeFromParent(e.upLevelMc),e.ball.addChild(e.upLevelMc),e.upLevelMc.x=e.mcPos[t][0],e.upLevelMc.y=e.mcPos[t][1],e.upLevelMc.rotation=e.mcPos[t][2],e.upLevelMc.playFile(RES_DIR_EFF+"NeigongEff5",1,function(){e.effs[t]&&e.effs[t].playFile(RES_DIR_EFF+"NeigongEff1",-1);for(var n=i.level,s=0;10>s;s++)e["point_"+s].source=s>=n?"neigongzhuzi2":"neigongzhuzi1";n>0?DisplayUtils.drawCir(e._shap,(e.lineGroup.width>>1)+2,212*(n-1)/9):e._shap.graphics.clear()},!0)},this)},e.prototype.getAttrByType=function(t,e){for(var i=t.length,n=0;i>n;n++)if(t[n].type==e.type&&t[n].value!=e.value)return" "+AttributeData.getAttStrByType(t[n],1,"",!1,!1);return""},e.prototype.upDataExpMcBall=function(t,e){this.toHeight=this.mcHeight*(t/e),this.currHeight=this.toHeight>=this.mcHeight?this.mcHeight:this.toHeight},e.prototype.moveEffectIn=function(){var t=this;for(var e in this.effs){var i=egret.Tween.get(this["eff_"+e]);i.to({x:280,y:280,scaleX:1,scaleY:1},390).to({alpha:0},10)}for(var e=0;10>e;e++)this.isLights[e]=!1;var n=egret.Tween.get(this.eff_9);n.wait(400).call(function(){t.moveInMc.playFile(RES_DIR_EFF+"NeigongEff3",1,null,!1)},this);for(var e=0;10>e;e++)this["point_"+e].source="neigongzhuzi2"},e}(BaseView);__reflect(NeiGongWin.prototype,"NeiGongWin"),window.NeiGongWin=NeiGongWin;var NewEquip=function(t){function e(){var e=t.call(this)||this;return e.observe(EquipCT.ins().postEquipChange,e.callBack),e.equipsList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.check=function(){return OpenSystem.ins().checkSysOpen(SystemType.NEWEQUIP)},e.prototype.callBack=function(){},e.prototype.addItem=function(t){if(t&&this.check()&&!(GameMap.fubenID>0&&(FbCT.ins().guanqiaID>1e5||FbCT.ins().guanqiaID<4))){var e=ItemUtil.getSubType(t.itemConfig),i=ItemUtil.getJob(t.itemConfig),n=SubRoles.ins().getSubRoleByJob(i);
if(n&&n.job==i&&ZsCT.ins().lv>=(t.itemConfig.zsLevel||0)&&Actor.level>=(t.itemConfig.level||1)){for(var s=!1,o=0;o<this.equipsList.length;o++){var a=this.equipsList[o],r=ItemUtil.getSubType(a.itemConfig);if(0==o&&e==r){if(e==r){s=!0,this.compareEquip(a,t)&&this.equipsList.push(t);break}}else if(e==r){s=!0,this.compareEquip(a,t)&&(this.equipsList[o]=t);break}}if(!s){var l=n.equipsData[e];l&&l.item&&l.item.itemConfig?this.compareEquip(l.item,t)&&this.equipsList.push(t):this.equipsList.push(t)}if(this.equipsList.length){var h=this.equipsList.shift();this.equipsList.sort(this.sortByPos),this.equipsList.unshift(h),ViewManager.ins().open(NewEquipWin)}}}},e.prototype.sortByPos=function(t,e){var i=ItemUtil.getQuality(t.itemConfig),n=ItemUtil.getQuality(e.itemConfig),s=ItemUtil.getSubType(t.itemConfig),o=ItemUtil.getSubType(e.itemConfig);return i>n?-1:n>i?1:o>s?-1:s==o?0:1},e.prototype.compareEquip=function(t,e){var i=t.point,n=e.point;return n>i},e}(BaseSystem);__reflect(NewEquip.prototype,"NewEquip"),System.NewEquip=function(){return NewEquip.ins()},window.NewEquip=NewEquip;var NewEquipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="newEquipSkin",e}return __extends(e,t),e.openCheck=function(){var t=!KFServerSys.ins().checkIsKFBattle();return t=!1},e.prototype.close=function(){Timer.stop(this.init,this)},e.prototype.open=function(){ViewManager.ins().isShow(e)||SoundUtil.play("longlin_a_dkjm_mp3"),this.time=FbCT.ins().guanqiaID>1e5||FbCT.ins().guanqiaID<4&&-1!=FbCT.ins().guanqiaID?3:5,this.addTouchEvent(this.go,this.sendWear),this.observe(FbCT.ins().postGuanKaIdChange,this.check),this.check()},e.prototype.check=function(){this.isNewHand=FbCT.ins().guanqiaID>1e5||FbCT.ins().guanqiaID<4,this.tick=this.time+1,Timer.has(this.init,this)||Timer.start(1e3,0,this.init,this),this.init()},e.prototype.init=function(){if(this.tick<=0){if(0==NewEquip.ins().equipsList.length)return void this.close();this.tick=this.time}this.tick--,this.tick<=0&&this.sendWear(!1),NewEquip.ins().equipsList.length>0&&(this.go.label="装备("+this.tick+")",this.itemdata=NewEquip.ins().equipsList[0],this.itemdata&&this.itemdata.itemConfig&&(this.equip.data=this.itemdata.configID,this.equip.isShowName(!1),this.equipName.text=this.itemdata.itemConfig.name,this.equipName.textColor=ItemUtil.getQualityColor(this.itemdata.itemConfig),this.powerCount.text=this.itemdata.point+""))},e.prototype.sendWear=function(t){if(void 0===t&&(t=!0),this.itemdata){var e=ItemUtil.getSubType(this.itemdata.itemConfig);if(this.isNewHand)EquipCT.ins().sendWearEquipment(this.itemdata.handle,e,0);else{if(t){var i=ItemUtil.getJob(this.itemdata.itemConfig),n=SubRoles.ins().getSubRoleByJob(i);ViewManager.ins().open(RoleWin,0,n.index)}NewEquip.ins().equipsList.length=0}NewEquip.ins().equipsList.shift(),0==NewEquip.ins().equipsList.length?ViewManager.ins().close(this):this.init(),this.tick=this.time}},e}(BaseEuiView);__reflect(NewEquipWin.prototype,"NewEquipWin"),ViewManager.ins().reg(NewEquipWin,LayerManager.Main_View),window.NewEquipWin=NewEquipWin;var NewRoleWin=function(t){function e(){var e=t.call(this)||this;e.roleBody=[["op_zs0_png","op_zs1_png"],["op_fs0_png","op_fs1_png"],["op_ds0_png","op_ds1_png"]],e.roleWeapon=["","",""],e.rolePos=[[100,0,1,3],[-4,79,.7,2],[336,79,.7,2]],e.beginPoint=0,e.isTopLevel=!0,e.VipConfig=[];var i=urlParam.appid,n=GlobalConfig.VipConfig;for(var s in n)for(var o in n[s].appid)n[s].appid&&n[s].appid[o]+""==i&&(e.VipConfig[n[s].level]=n[s]);if(0==e.VipConfig.length)for(var s in n)n[s].appid||(e.VipConfig[n[s].level]=n[s]);return e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="OpenRoleSkin",this.roles=[this.role0,this.role1,this.role2];var e=SubRoles.ins().getSubRoleByIndex(0);e&&e.sex?(this.sexBtn0.selected=!0,this.sexBtn1.selected=!1):(this.sexBtn0.selected=!1,this.sexBtn1.selected=!0),this.updateRole()},e.prototype.updateRole=function(){for(var t=0;t<this.roles.length;t++)this.setRole(this.roles[t],t)},e.prototype.setRole=function(t,e){var i=this.sexBtn0.selected?0:1;t.weapon.source=this.roleWeapon[e],t.job.source="op_"+(e+1);for(var n,s=SubRoles.ins().subRolesLen,o=0;s>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(a.job==e+1){n=!0,i=a.sex;break}}t.body.source=this.roleBody[e][i],t.openedImg.visible=n},e.prototype.setNeedTxt=function(){var t,e,i=SubRoles.ins().subRolesLen,n=GlobalConfig.NewRoleConfig[i],s="";if(n.zsLevel?(s=n.zsLevel+"转",this.canOpen=ZsCT.ins().lv>=n.zsLevel,t=this.canOpen?3532333:15937822,s='<font color="#'+t.toString(16)+'">'+s+"</font>"):(s=n.level+"级",this.canOpen=Actor.level>=n.level,t=this.canOpen?3532333:15937822,s='<font color="#'+t.toString(16)+'">'+s+"</font>"),n.vip){e=Actor.vip>=n.vip,this.canOpen=this.canOpen||e,t=e?3532333:15937822;var o=this.VipConfig&&this.VipConfig[n.vip]?this.VipConfig[n.vip].needYb:0;s+=LocationProperty.isTSServer?"":' 或 <font color="#'+t.toString(16)+'">累计充值'+o+"元宝达到"+VipCT.getVipStr(n.vip,!0)+"</font>"}this.needTxt.textFlow=(new egret.HtmlTextParser).parser("解锁需要："+s)},e.prototype.selectJob=function(t,e){var i=this;void 0===e&&(e=!1);for(var n=function(n){var o=(t+t+n)%3;if(e)s.roles[n].x=s.rolePos[o][0],s.roles[n].y=s.rolePos[o][1],s.roles[n].scaleX=s.roles[n].scaleY=s.rolePos[o][2];else{var a=egret.Tween.get(s.roles[n]);a.to({x:s.rolePos[o][0],y:s.rolePos[o][1],scaleX:s.rolePos[o][2],scaleY:s.rolePos[o][2]},500).call(function(){i.roles[n].touchEnabled=0!=o},s)}0==o&&(s.roleGroup.addChild(s.roles[n]),s.openBtn.visible=!s.roles[n].openedImg.visible)},s=this,o=0;3>o;o++)n(o);this.openBtn.visible&&(this.canOpen||(this.openBtn.visible=!1,this.chargebtn.visible=!LocationProperty.isTSServer))},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.updateRole(),this.setNeedTxt();for(var i=[0,1,2],n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s),a=i.indexOf(o.job-1);a>-1&&i.splice(a,1)}this.job=i[0]},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},e.prototype.onBegin=function(t){this.stop||(this.beginPoint=t.stageX)},e.prototype.onMove=function(t){if(0!=this.beginPoint){var e=t.stageX-this.beginPoint;if(!(Math.abs(e)<5)){var i=this.job-e/Math.abs(e);if(i=i>2?i-3:0>i?i+3:i,this.addTouchEndEvent(this,this.onEnd),Math.abs(e)>=120)return this.job=i,this.beginPoint=0,void this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this);for(var n=0;3>n;n++){var s=this.roles[n],o=(i+i+n)%3,a=(this.job+this.job+n)%3,r=MathUtils.getRadian2(this.rolePos[a][0],this.rolePos[a][1],this.rolePos[o][0],this.rolePos[o][1]),l=MathUtils.getAngle(r),h=MathUtils.getDirMove(l,Math.abs(e));s.x=this.rolePos[a][0]+h.x,s.y=this.rolePos[a][1]+h.y;var u=Math.abs(e)/MathUtils.getDistance(this.rolePos[a][0],this.rolePos[a][1],this.rolePos[o][0],this.rolePos[o][1]);s.scaleX=s.scaleY=this.rolePos[a][2]-(this.rolePos[a][2]-this.rolePos[o][2])*u}}}},e.prototype.onEnd=function(t){this.job=this.job,this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this)},e.prototype.onTap=function(t){switch(t.target){case this.openBtn:if(!this.canOpen){var e=SubRoles.ins().subRolesLen,i=GlobalConfig.NewRoleConfig[e];if(i){var n=WarnWin.show(VipCT.getVipStr(i.vip)+"等级不足，"+VipCT.getVipStr(i.vip,!0)+"可以提前开启第"+(e+1)+"角色，是否前往开启？",null,null,function(){ViewManager.ins().open(VipWin,i.vip)},this);n.setBtnLabel("取消","前往")}return}GameLogic.ins().sendNewRole(this.job+1,this.sexBtn0.selected?0:1),ViewManager.ins().close(LimitTaskView);case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.sexBtn0:this.sexBtn1.selected=!1,this.updateRole();break;case this.sexBtn1:this.sexBtn0.selected=!1,this.updateRole();break;case this.chargebtn:var s=Recharge.ins().getRechargeData(0);s&&0!=s.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win);break;default:var o=this.roles.indexOf(t.target);o>-1&&!this.stop&&(this.job=o)}},Object.defineProperty(e.prototype,"job",{get:function(){return this._job},set:function(t){var e=this;this._job=t,this.stop=!0,this.selectJob(t),Timer.start(500,1,function(){e.stop=!1},this)},enumerable:!0,configurable:!0}),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return SubRoles.ins().subRolesLen>=3?!1:(ViewManager.ins().close(LiLianWin),!0)},e}(BaseEuiView);__reflect(NewRoleWin.prototype,"NewRoleWin"),ViewManager.ins().reg(NewRoleWin,LayerManager.UI_Main),window.NewRoleWin=NewRoleWin;var NoticeCT=function(t){function e(){var e=t.call(this)||this;return e.isFirstEnter=!0,e.sysId=PackageID.Notice,e.regNetMsg(1,e.doNotice),e.regNetMsg(2,e.doNoticeOpen),e.observe(GameLogic.ins().postEnterMap,function(){e.isFirstEnter&&(e.isFirstEnter=!1,Timer.start(3e3,1,e.checkUpdata,e))}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkUpdata=function(){var t=GlobalConfig.UpdateRemindConfig;if(t.appearTime&&t.disappearTime&&t.isShow&&!(1e3*ZsCT.ins().lv+Actor.level<t.appearLv||GameServer.serverOpenDay+1<t.serverDayLimit)){var e=GameServer.serverTime;DateUtils.formatStrTimeToMs(t.appearTime)<=e&&e<DateUtils.formatStrTimeToMs(t.disappearTime)&&ViewManager.ins().open(UpdateRemindWin,t.lotteryNotice)}},e.prototype.doNotice=function(t){var e=t.readShort(),i=t.readString(),n=t.readUnsignedByte();1==e?0==n&&ViewManager.ins().open(NoticeView).showNotice(i):2==e?(this.data||(this.data=new ChatInfoData(null)),this.data.str=i,this.data.type=7):4==e&&SysSetting.ins().getBool(SysSetting.BARRAGE)&&TipsCT.ins().showCenterTips4(i),3==e&&ViewManager.ins().open(NoticeView).showNotice(i),ChatCT.ins().postSysChatMsg(new ChatSystemData(e,i))},e.prototype.doNoticeOpen=function(t){FuLiCT.ins().isOpenNotice=t.readBoolean(),e.ins().postGameNotice()},e.prototype.setNoticeOPen=function(){this.sendBaseProto(2)},e.prototype.postGameNotice=function(){},__decorate([post()],e.prototype,"postGameNotice",null),e}(BaseSystem);__reflect(NoticeCT.prototype,"NoticeCT"),System.NoticeCT=function(){return NoticeCT.ins()},window.NoticeCT=NoticeCT;var NoticeView=function(t){function e(){var e=t.call(this)||this;return e.list=[],e.startX=0,e.endX=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.frame=new eui.Image,this.frame.source="zjmgonggaobg",this.frame.width=480,this.frame.height=28,this.frame.y=240,this.frame.x=StageUtils.ins().getWidth()/2-this.frame.width/2,this.addChild(this.frame),this.frame.visible=!1,this.touchChildren=!1,this.touchEnabled=!1,this.startX=this.frame.x+this.frame.width,this.endX=this.frame.x},e.prototype.removeDisplay=function(){egret.Tween.removeTweens(this)},e.prototype.showNotice=function(t){if(!LocationProperty.isIosTS){this.frame.visible=!0;var e=new eui.Label;e.size=20,e.textColor=16705792,e.stroke=1,e.strokeColor=0,e.x=this.startX,e.y=this.frame.y+4,e.textFlow=TextFlowMaker.generateTextFlow(t),this.addChild(e),this.list.push(e),e.visible=!1,1==this.list.length&&this.tweenLab()}},e.prototype.tweenLab=function(){var t=this,e=this.list[0],i=this.endX-e.width,n=egret.Tween.get(e);e.visible=!0,n.to({x:i},20*e.width).call(function(){t.removeChild(e),t.list.shift(),t.list.length<1?t.frame.visible=!1:t.tweenLab()},this)},e}(BaseEuiView);__reflect(NoticeView.prototype,"NoticeView"),ViewManager.ins().reg(NoticeView,LayerManager.UI_Tips),window.NoticeView=NoticeView;var UpdateRemindWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="updateRemindSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.onTouch);var i=t[0];i&&i!=this.skinName&&(this.skinName=i)},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.btn:ViewManager.ins().close(this),t.target==this.btn&&ViewManager.ins().open(FuliWin,2)}},e}(BaseEuiView);__reflect(UpdateRemindWin.prototype,"UpdateRemindWin"),ViewManager.ins().reg(UpdateRemindWin,LayerManager.UI_Popup),window.UpdateRemindWin=UpdateRemindWin;var EffectivenessTip=function(t){function e(){var e=t.call(this)||this;return e.showType=0,e.skinName="CheckEfficienSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.showType=t[0]?t[0]:0,this.update(),this.addTouchEvent(this,this.onTap),Timer.start(3e3,1,this.playTween,this)},e.prototype.playTween=function(){var t=this,e=egret.Tween.get(this.mainGroup);e.to({scaleX:0,scaleY:0,horizontalCenter:170,top:52},500).call(function(){ViewManager.ins().close(t)})},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];FbCT.ins().showAni=!1,this.removeTouchEvent(this,this.onTap),Timer.stop(this.playTween,this),egret.Tween.removeTweens(this.mainGroup),egret.Tween.removeTweens(this)},e.prototype.onTap=function(t){this.removeTouchEvent(this,this.onTap),Timer.stop(this.playTween,this),this.playTween()},e.prototype.update=function(){FbCT.ins().guanqiaID;FbCT.ins().expEff==FbCT.ins().expEffLast?this.groupExp.visible=!1:(this.groupExp.visible=!0,this.curExp.text=FbCT.ins().expEffLast+"",this.nextExp.text=FbCT.ins().expEff+""),FbCT.ins().goldEff==FbCT.ins().goldEffLast?this.groupGold.visible=!1:(this.groupGold.visible=!0,this.curMoney.text=FbCT.ins().goldEffLast+"",this.nextMoney.text=FbCT.ins().goldEff+""),this.showType?(this.groupGold.visible=this.groupExp.visible=!1,this.groupInfoGold.visible=this.groupInfoExp.visible=!0,this.nextInfoExp.text=FbCT.ins().expEff+"",this.nextInfoMoney.text=FbCT.ins().goldEff+"",this.descTxt.text="关卡效率"):(this.groupGold.visible=this.groupExp.visible=!0,this.groupInfoGold.visible=this.groupInfoExp.visible=!1,this.descTxt.text="关卡效率提升")},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return FbCT.ins().guanqiaID<1e5},e}(BaseEuiView);__reflect(EffectivenessTip.prototype,"EffectivenessTip"),ViewManager.ins().reg(EffectivenessTip,LayerManager.UI_Main),window.EffectivenessTip=EffectivenessTip;var OfflineRewardWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.skinName="OfflineRewardSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.arr=t[0],this.coin=t[1];for(var i=0;i<this.coin.length;i++)if(this.coin[i].id==MoneyConst.soul){this.arr.push(this.coin[i].count);break}this.update()},e.prototype.update=function(){if(this.time.text="离线时间："+DateUtils.getFormatBySecond(this.arr[0],DateUtils.TIME_FORMAT_9),this.exp.text=""+this.arr[1],this.money.text=""+this.arr[2],this.equipNum.text=""+(this.arr[3]+this.arr[4]),this.jinglianshiNum.text=""+(this.arr[6]?this.arr[6]:0),0==this.arr[4]?this.bagFull.visible=!1:(this.bagFull.visible=!0,this.bagFull.textFlow=(new egret.HtmlTextParser).parser("背包已满，自动熔炼<a color=0x35e62d>"+this.arr[4]+"</a>件装备")),this.arr[5].length>0){for(var t=0;t<this.arr[5].length;t++){var e=this.arr[5][t];1==e.type?(this.label4.text=e.gold,this.label6.text=e.exp):2==e.type?(this.label3.text=e.gold,this.label5.text=e.exp):3==e.type?(this.exp.text=""+(this.arr[1]+e.exp),this.arr[2]+=e.gold):4==e.type&&(this.exp.text=""+(this.arr[1]+e.exp),this.arr[2]+=e.gold)}this.money.text=""+this.arr[2]}},e.prototype.onClick=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(OfflineRewardWin.prototype,"OfflineRewardWin"),ViewManager.ins().reg(OfflineRewardWin,LayerManager.UI_Main2),window.OfflineRewardWin=OfflineRewardWin;var ContestCT=function(t){function e(){var e=t.call(this)||this;return e.isSignUp=!1,e.myCurRecord=-1,e.myCurStage=-1,e.qualityInfos=[],e.contestInfos=[],e.myBetLogs=[],e.betTimes=0,e.betTotal=0,e.profit=0,e.stageType=0,e.sysId=PackageID.Contest,e.regNetMsg(1,e.postSignUp),e.regNetMsg(2,e.postQualityInfo),e.regNetMsg(3,e.updateOneContestInfo),e.regNetMsg(4,e.updateContestInfos),e.regNetMsg(5,e.postBetLogs),e.regNetMsg(6,e.postMatchInfo),e.regNetMsg(7,e.postFBOverTime),e.regNetMsg(8,e.postResult),e.regNetMsg(9,e.postBetInfo),e.regNetMsg(10,e.postMyQualityInfo),e.regNetMsg(25,e.postContestStatus),e.observe(Actor.init,e.init),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.init=function(){this.sendQualityInfo()},e.prototype.postSignUp=function(t){this.isSignUp=1==t.readUnsignedByte()},e.prototype.sendSignUp=function(){this.sendBaseProto(1)},e.prototype.sendQualityInfo=function(){this.sendBaseProto(2)},e.prototype.postQualityInfo=function(t){this.qualityInfos=[];for(var e=t.readUnsignedShort(),i=!1,n=0;e>n;n++){var s={rank:t.readUnsignedShort(),actorId:t.readUnsignedInt(),serverName:t.readUnsignedInt(),name:t.readString(),score:t.readUnsignedInt(),winNum:t.readUnsignedShort(),loseNum:t.readUnsignedShort(),drawNum:t.readUnsignedShort(),serverId:t.readUnsignedInt()};s.actorId==Actor.actorID&&(i=!0,this.myRank=s.rank,this.myScore=s.score,this.myWin=s.winNum,this.myLose=s.loseNum,this.myDraw=s.drawNum),this.qualityInfos.push(s)}i||this.sendMyQualityInfo()},e.prototype.updateOneContestInfo=function(t){var e=t.readUnsignedInt();for(var i in this.contestInfos){var n=this.contestInfos[i];if(n.actorId==e)return n.stage=t.readByte(),n.record=t.readByte(),n.time=t.readUnsignedInt(),0!=n.record&&egret.callLater(this.sortCB,this),n.actorId==Actor.actorID&&(this.myCurStage=n.stage,this.myCurRecord=n.record),void this.postContestInfo()}},e.prototype.sortCB=function(){this.contestInfos.sort(this.sort);for(var t=0;t<this.contestInfos.length;t++)this.contestInfos[t].rank=t+1;this.postContestInfo()},e.prototype.sort=function(t,e){return t.stage>e.stage?-1:t.stage<e.stage?1:t.record>e.record?-1:t.record<e.record?1:3==t.record&&t.time<e.time?-1:3==t.record&&t.time>e.time?1:1==t.record&&t.time>e.time?-1:1==t.record&&t.time<e.time?1:0},e.prototype.updateContestInfos=function(t){this.contestInfos=[];for(var e=t.readUnsignedShort(),i=0;e>i;i++){var n={rank:i+1,actorId:t.readUnsignedInt(),serverName:t.readUnsignedInt(),name:t.readString(),job:t.readByte(),sex:t.readByte(),stage:t.readByte(),record:t.readByte(),time:t.readUnsignedInt()};n.actorId==Actor.actorID&&(this.myCurStage=n.stage,this.myCurRecord=n.record),this.contestInfos.push(n)}this.postContestInfo()},e.prototype.postContestInfo=function(){},e.prototype.sendBet=function(t,e){var i=this.getBytes(5);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postBetLogs=function(t){this.betTimes=t.readUnsignedShort(),this.betTotal=t.readUnsignedInt(),this.profit=t.readUnsignedInt();var e=t.readShort();this.myBetLogs=[];for(var i=0;e>i;i++){var n={title:t.readString(),msg:t.readString(),result:t.readString()};this.myBetLogs.push(n)}},e.prototype.postMatchInfo=function(t){for(var e=DateUtils.formatMiniDateTime(t.readUnsignedInt()),i=t.readUnsignedShort(),n=[],s=0;i>s;s++){var o={name:t.readString(),serverName:t.readUnsignedByte(),job:t.readUnsignedByte(),sex:t.readUnsignedByte()};n.push(o)}ViewManager.ins().open(ContestVSWin,e,n)},e.prototype.postFBOverTime=function(t){var e=DateUtils.formatMiniDateTime(t.readUnsignedInt());ViewManager.ins().open(LeftTimeWin,e)},e.prototype.postResult=function(t){var e=t.readByte(),i=t.readUnsignedInt();ViewManager.ins().open(ContestResultWin,e,i)},e.prototype.postBetInfo=function(t){this.curBetStage=t.readByte();t.readUnsignedInt(),t.readUnsignedInt()},e.prototype.sendMyQualityInfo=function(){this.sendBaseProto(10)},e.prototype.postMyQualityInfo=function(t){this.myRank=t.readUnsignedShort(),this.myScore=t.readUnsignedInt(),this.myWin=t.readUnsignedShort(),this.myLose=t.readUnsignedShort(),this.myDraw=t.readUnsignedShort()},e.prototype.postContestStatus=function(t){this.stageType=t.readByte(),this.betStage=1==t.readByte(),this.stageOverTime=DateUtils.formatMiniDateTime(t.readUnsignedInt())},e.prototype.checkOpen=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ProtectArenaBase,i="";return GameServer.serverOpenDay+1<e.openDay?i="开服"+e.openDay+"天开启":ZsCT.ins().lv<e.needZsLv?i=e.needZsLv+"转开启":0==this.stageType&&(i="活动暂未开放"),t&&""!=i&&TipsCT.ins().showTips(i),""==i},e.getTotalRecord=function(t,e,i){return void 0===t&&(t=0),t+"胜"+e+"平"+i+"负"},e.getRecord=function(t){var e=["暂无","淘汰","比赛中","胜利"];return e[t]||""},e.getStageName=function(t){var e=["","","资格赛","1V2","1V3","1V4","1V5","1V6","1V7","1V8",""];return e[t]},e.prototype.getRemainderNum=function(){var t=0;for(var e in this.contestInfos)1!=this.contestInfos[e].record&&t++;return t},__decorate([post()],e.prototype,"postSignUp",null),__decorate([post()],e.prototype,"postQualityInfo",null),__decorate([post()],e.prototype,"postContestInfo",null),__decorate([post()],e.prototype,"postBetLogs",null),__decorate([post()],e.prototype,"postMatchInfo",null),__decorate([post()],e.prototype,"postFBOverTime",null),__decorate([post()],e.prototype,"postResult",null),__decorate([post()],e.prototype,"postBetInfo",null),__decorate([post()],e.prototype,"postMyQualityInfo",null),__decorate([post()],e.prototype,"postContestStatus",null),e}(BaseSystem);__reflect(ContestCT.prototype,"ContestCT");var Contest_Status;!function(t){t[t.None=0]="None",t[t.Sign=1]="Sign",t[t.Knockout=2]="Knockout",t[t.Prom2=3]="Prom2",t[t.Prom3=4]="Prom3",t[t.Prom4=5]="Prom4",t[t.Prom5=6]="Prom5",t[t.Prom6=7]="Prom6",t[t.Prom7=8]="Prom7",t[t.Prom8=9]="Prom8",t[t.Over=10]="Over"}(Contest_Status||(Contest_Status={})),System.ContestCT=function(){return ContestCT.ins()},window.ContestCT=ContestCT;var ContestRedPoint=function(t){function e(){var e=t.call(this)||this;return e.betReds={},e.associated(e.postRedPoint,e.postSignRed,e.postBetRed),e.associated(e.postSignRed,ContestCT.ins().postSignUp,ContestCT.ins().postContestStatus),e.associated(e.postBetRed,ContestCT.ins().postContestStatus,ContestCT.ins().postBetInfo,ContestCT.ins().postContestInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;if(this.redPoint=this.signRed,!this.redPoint)for(var e in this.betReds)if(this.betReds[e]){this.redPoint=!0;break}return t!=this.redPoint},e.prototype.postSignRed=function(){this.signRed=ContestCT.ins().checkOpen()&&ContestCT.ins().stageType==Contest_Status.Sign&&!ContestCT.ins().isSignUp},e.prototype.postBetRed=function(){this.betReds={};var t=ContestCT.ins();if(t.checkOpen()&&t.betStage&&t.curBetStage!=t.stageType)for(var e in t.contestInfos)1!=t.contestInfos[e].record&&(this.betReds[t.contestInfos[e].actorId]=!0)},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postSignRed",null),__decorate([post()],e.prototype,"postBetRed",null),e}(BaseSystem);__reflect(ContestRedPoint.prototype,"ContestRedPoint"),System.ContestRedPoint=function(){return ContestRedPoint.ins()},window.ContestRedPoint=ContestRedPoint;var ContestBetWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestbetSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.money=GlobalConfig.ProtectArenaBase.betCount},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postContestStatus,this.updateBtn),this.observe(ContestCT.ins().postBetInfo,this.updateBtn),this.contestInfo=t[0]||null,this.update(),this.updateBtn()},e.prototype.updateBtn=function(){this.eBtn.enabled=ContestCT.ins().curBetStage!=ContestCT.ins().stageType,this.eBtn.label=this.eBtn.enabled?"下注":"已下注"},e.prototype.update=function(){this.contestInfo&&(this.eHead.source="head_"+this.contestInfo.job+this.contestInfo.sex,this.eNameLab.text=this.contestInfo.serverName+"区\n"+this.contestInfo.name,this.updateBet(0))},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.eSubBtn:this.updateBet(-GlobalConfig.ProtectArenaBase.betCount);break;case this.eAddBtn:this.updateBet(GlobalConfig.ProtectArenaBase.betCount);break;case this.eMaxBtn:this.updateBet(GlobalConfig.ProtectArenaBase.maxBett);break;case this.eBtn:ContestCT.ins().betStage&&this.contestInfo.stage==ContestCT.ins().stageType?GlobalFun.checkMoney(this.money)&&ContestCT.ins().sendBet(this.contestInfo.actorId,this.money):TipsCT.ins().showTips("下注已过期")}},e.prototype.updateBet=function(t){this.money+=t,this.money>GlobalConfig.ProtectArenaBase.maxBett?this.money=GlobalConfig.ProtectArenaBase.maxBett:this.money<GlobalConfig.ProtectArenaBase.betCount&&(this.money=GlobalConfig.ProtectArenaBase.betCount),this.eNumLab.text=this.money+"",this.eWinLab.text="胜利获得    守擂点"+this.money*GlobalConfig.ProtectArenaBase.betPrice,this.eLoseLab.text="失败获得    守擂点"+this.money},e}(BaseEuiView);__reflect(ContestBetWin.prototype,"ContestBetWin"),window.ContestBetWin=ContestBetWin,ViewManager.ins().reg(ContestBetWin,LayerManager.UI_Popup);var ContestPlayoffItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ContestplayoffItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;t.rank>0&&t.rank<4?(this.eRankImg.source="paihang"+t.rank,this.eRankImg.visible=!0,this.eRank.text=""):(this.eRankImg.visible=!1,this.eRank.text=t.rank+""),this.eServer.text=t.serverName+"区",this.eName.text=t.name,this.eScoreLab.text=ContestCT.getStageName(t.stage),this.eStateLab.text=ContestCT.getRecord(t.record),this.redPoint.visible=this.eBtn.visible=1!=t.record&&ContestCT.ins().betStage&&ContestCT.ins().curBetStage!=ContestCT.ins().stageType}},e}(BaseItemRender);__reflect(ContestPlayoffItemRender.prototype,"ContestPlayoffItemRender"),window.ContestPlayoffItemRender=ContestPlayoffItemRender;var ContestPlayoffPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestplayoffSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=ContestPlayoffItemRender,this.eList.dataProvider=this.listDP,this.eDescLab.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.ProtectArenaBase.contestDesc),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postContestStatus,this.updateStatus),this.observe(ContestCT.ins().postContestInfo,this.updateList),this.observe(ContestCT.ins().postBetInfo,this.updateList),this.update(),this.updateList(),this.updateStatus()},e.prototype.update=function(){this.eJieDuanLab.text=ContestCT.getStageName(ContestCT.ins().stageType)},e.prototype.updateStatus=function(){var t=ContestCT.ins();t.stageType==Contest_Status.Over||t.stageType==Contest_Status.Prom8&&!t.betStage?this.eGroup.visible=!1:this.eGroup.visible=!0,this.eTimeImg.visible=!this.eGroup.visible,this.eGroup2.visible=t.stageType>=Contest_Status.Prom2,this.eGroup1.visible=!this.eGroup2.visible,this.eImg.source=t.betStage?"conteststagetxt_png":"slsbettxt_png",this.eTime0.text=t.stageType+(t.betStage?-1:0)+""},e.prototype.updateList=function(){this.updateMyRecord(),this.ePeopleLab.text=ContestCT.ins().getRemainderNum()+"",this.listDP.replaceAll(ContestCT.ins().contestInfos)},e.prototype.updateMyRecord=function(){var t="",e=ContestCT.ins().myCurRecord,i=ContestCT.ins().myCurStage;switch(e){case-1:t="你不是守擂者";break;case 0:t="";break;case 1:case 2:case 3:t=ContestCT.getStageName(i)+ContestCT.getRecord(e)}this.eTips.text=t},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof ContestPlayoffItemRender)return void ViewManager.ins().open(ContestBetWin,t.target.parent.data);switch(t.target){case this.eBtn:ViewManager.ins().open(MyBetRecordWin)}},e.prototype.updateTime=function(){if(!(ContestCT.ins().stageType<Contest_Status.Prom2||ContestCT.ins().stageType>Contest_Status.Prom8)&&this.skin){var t=Math.floor((ContestCT.ins().stageOverTime-GameServer.serverTime)/1e3);this.eTime.text=(t>0?t:0)+""}},__decorate([callLater],e.prototype,"updateList",null),e}(BaseView);__reflect(ContestPlayoffPanel.prototype,"ContestPlayoffPanel"),window.ContestPlayoffPanel=ContestPlayoffPanel;var ContestRankItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ContestRankItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eRank.text=t.rank+"",this.eName.text=t.name,this.eServer.text=t.serverName+"区",this.eScore.text=t.score+"",this.eRecord.text=ContestCT.getTotalRecord(t.winNum,t.drawNum,t.loseNum)}},e}(BaseItemRender);__reflect(ContestRankItemRender.prototype,"ContestRankItemRender"),window.ContestRankItemRender=ContestRankItemRender;var ContestRankPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.topThreeId=[],e._sn_="ContestRankSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.ranks=[this.rank0,this.rank1,this.rank2],this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=ContestRankItemRender,this.eList.dataProvider=this.listDP},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postQualityInfo,this.update),this.observe(ContestCT.ins().postContestStatus,this.updateStatus),this.observe(ContestCT.ins().postMyQualityInfo,this.updateMyInfo),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.update()},e.prototype.update=function(){var t=ContestCT.ins(),e=t.qualityInfos.concat();this.topThreeId=[];for(var i=0;i<this.ranks.length;i++)this.ranks[i].data=null,e&&e[i]&&(ReadPlayerCT.ins().sendFindPlayer(e[i].actorId,e[i].serverId),this.topThreeId.push(e[i].actorId));this.state.visible=null==e;var n=e&&e.length>0?e.shift():null;this.eRank.text=n?n.rank+"":"",this.eName.text=n?n.name:"",this.sServer.text=n?n.serverName+"区":"",this.eScore.text=n?n.score+"":"",this.eRecord.text=n?ContestCT.getTotalRecord(n.winNum,n.drawNum,n.loseNum):"",this.listDP.source=e,this.updateStatus(),this.updateMyInfo()},e.prototype.updateStatus=function(){var t=ContestCT.ins();this.eTime.visible=t.stageType==Contest_Status.Knockout,this.eTimeImg.source=t.stageType==Contest_Status.Knockout?"zgstimetxt_png":"zgsclosetxt_png"},e.prototype.updateMyInfo=function(){var t=ContestCT.ins();this.eMyRank.text=t.myRank>0?t.myRank+"":"未参赛",this.eMymark.text=t.myScore+"",this.eMyrecord.text=ContestCT.getTotalRecord(t.myWin,t.myDraw,t.myLose)},e.prototype.updateTime=function(){if(ContestCT.ins().stageType==Contest_Status.Knockout&&this.skin){var t=Math.floor((ContestCT.ins().stageOverTime-GameServer.serverTime)/1e3);this.eTime.text=(t>0?t:0)+""}},e.prototype.openOtherPlayerView=function(t){if(t)for(var e=0;e<this.ranks.length;e++)this.topThreeId[e]==t.id&&(this.ranks[e].data={otherPlayerData:t})},e}(BaseView);__reflect(ContestRankPanel.prototype,"ContestRankPanel"),window.ContestRankPanel=ContestRankPanel;var ContestResultWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.closeTime=5,e._sn_="ContestResultSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eSureBtn.name=this.eSureBtn.label},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.start(1e3,this.closeTime,this.updateTimer,this),this.eBg.source=2==t[0]?"lost_png":"win_png",this.eResult.source=2==t[0]?"lost_02":"win_02";var i="";i=2!=t[0]?"恭喜你"+ContestCT.getStageName(ContestCT.ins().stageType)+(ContestCT.ins().stageType>2?"守擂":"")+"胜利":"很遗憾，"+ContestCT.getStageName(ContestCT.ins().stageType)+(ContestCT.ins().stageType>2?"守擂":"")+"失败",i+="\n用时："+DateUtils.getFormatBySecond(t[1]||0,DateUtils.TIME_FORMAT_5),this.eLab.text=i},e.prototype.updateTimer=function(){this.closeTime--,this.closeTime<=0&&ViewManager.ins().close(this),this.eSureBtn.label=this.eSureBtn.name+"("+this.closeTime+"秒)"
},e.prototype.onClick=function(t){switch(t.target){case this.eSureBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ContestResultWin.prototype,"ContestResultWin"),window.ContestResultWin=ContestResultWin,ViewManager.ins().reg(ContestResultWin,LayerManager.UI_Popup);var ContestRewardItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ContestRewardItemSkin",e.awardslist.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;0==t.idx?this.typeLabel.text="参与奖":this.typeLabel.text=ContestCT.getStageName(10-t.idx)+(1==t.type?"胜利":"失败"),this.awardslist.dataProvider=new eui.ArrayCollection(t.award),t.rewardpic&&""!=t.rewardpic?(this.eTitleBg.visible=!0,this.eTitleBg.source=t.rewardpic):this.eTitleBg.visible=!1}},e}(BaseItemRender);__reflect(ContestRewardItemRender.prototype,"ContestRewardItemRender"),window.ContestRewardItemRender=ContestRewardItemRender;var ContestRewardPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestRewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ContestRewardItemRender;var t=[];for(var e in GlobalConfig.ProtectArenaAward){var i=GlobalConfig.ProtectArenaAward[e];for(var n in i)t.push(i[n])}var s={idx:0,type:0,award:GlobalConfig.ProtectArenaBase.joinReward,rewardpic:""};t.push(s),this.eList.dataProvider=new eui.ArrayCollection(t),this.groups=[this.eGroup1,this.eGroup2,this.eGroup3];for(var e in GlobalConfig.ProtectArenaBase.rankRewardShow){var o=GlobalConfig.ProtectArenaBase.rankRewardShow[e];if(""!=o){var a=new MovieClip;this.groups[e].addChild(a),a.playFile(RES_DIR_EFF+o,-1)}}},e}(BaseView);__reflect(ContestRewardPanel.prototype,"ContestRewardPanel"),window.ContestRewardPanel=ContestRewardPanel;var ContestSignPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestSignupSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eDescLab.textFlow=TextFlowMaker.generateTextFlow(GlobalConfig.ProtectArenaBase.signDesc),this.mc=new MovieClip,this.mc.playFile(RES_DIR_EFF+"ProgressEff6",-1),this.mc.scaleX=this.eMCGroup.width/466,this.mc.x=this.eMCGroup.width/2,this.eMCGroup.addChild(this.mc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postSignUp,this.update),this.observe(ContestRedPoint.ins().postSignRed,this.updateRed),this.update(),this.updateRed()},e.prototype.updateTime=function(){if(ContestCT.ins().stageType==Contest_Status.Sign&&this.skin){var t=(ContestCT.ins().stageOverTime-GameServer.serverTime)/1e3;0>t&&(t=0),this.eTimeLab.text="报名剩余时间："+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_1)}},e.prototype.update=function(){this.eBtn.enabled=!ContestCT.ins().isSignUp,this.eBtn.label=ContestCT.ins().isSignUp?"已报名":"报名"},e.prototype.updateRed=function(){this.redPoint.visible=ContestRedPoint.ins().signRed},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:ContestCT.ins().sendSignUp()}},e}(BaseView);__reflect(ContestSignPanel.prototype,"ContestSignPanel"),window.ContestSignPanel=ContestSignPanel;var ContestVSItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ContestVSItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eHead.source="yuanhead"+t.job+t.sex,this.eNameLab.text="s"+t.serverName+"."+t.name}},e}(BaseItemRender);__reflect(ContestVSItemRender.prototype,"ContestVSItemRender"),window.ContestVSItemRender=ContestVSItemRender;var ContestVSWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestVSSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ContestVSItemRender;var t=SubRoles.ins().getSubRoleByIndex(0);this.eMyHead.source="headvs_"+t.job+t.sex+"_png",this.eMyName.text="s"+Actor.serverName+"."+Actor.myName,this.ePower.text="战力："+Actor.power},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.overTime=t[0]||0;var i=t[1]||null;this.eList.dataProvider=new eui.ArrayCollection(i),Timer.start(1e3,0,this.updateTime,this)},e.prototype.updateTime=function(){var t=Math.floor((this.overTime-GameServer.serverTime)/1e3);this.eTime.text=(t>0?t:0)+"秒后进入"},e}(BaseEuiView);__reflect(ContestVSWin.prototype,"ContestVSWin"),window.ContestVSWin=ContestVSWin,ViewManager.ins().reg(ContestVSWin,LayerManager.UI_Popup);var ContestWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ContestMainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postContestStatus,this.update),this.observe(ContestRedPoint.ins().postSignRed,this.updateRed),this.observe(ContestRedPoint.ins().postBetRed,this.updateRed),this.update(),this.updateTime(),Timer.start(1e3,0,this.updateTime,this),this.updateRed()},e.prototype.updateRed=function(){this.redPoint0.visible=ContestRedPoint.ins().signRed,this.redPoint1.visible=!1;for(var t in ContestRedPoint.ins().betReds)if(ContestRedPoint.ins().betReds[t]){this.redPoint1.visible=!0;break}},e.prototype.updateTime=function(){this.eSignPanel.updateTime(),this.eRankPanel.updateTime(),this.ePlayoffPanel.updateTime()},e.prototype.update=function(){this.eSignPanel.visible=ContestCT.ins().stageType==Contest_Status.Sign,this.eRankPanel.visible=!this.eSignPanel.visible},e.prototype.onClick=function(t){switch(t.target){case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[51].text)}},e}(BaseEuiView);__reflect(ContestWin.prototype,"ContestWin"),window.ContestWin=ContestWin,ViewManager.ins().reg(ContestWin,LayerManager.UI_Main);var LeftTimeWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="LeftTimeSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.overTime=t[0]||0,Timer.start(1e3,0,this.updateTime,this),this.updateTime()},e.prototype.updateTime=function(){var t=(this.overTime-GameServer.serverTime)/1e3;0>t&&(t=0,ViewManager.ins().close(this)),this.eLeftTime.text=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_3)},e}(BaseEuiView);__reflect(LeftTimeWin.prototype,"LeftTimeWin"),window.LeftTimeWin=LeftTimeWin,ViewManager.ins().reg(LeftTimeWin,LayerManager.UI_Main);var MyBetRecordItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="MyBetRecordItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.eTitle.text=t.title,this.eLab.textFlow=TextFlowMaker.generateTextFlow(t.msg+(t.result.length>0?","+t.result:"")),this.eResult.text=""}},e}(BaseItemRender);__reflect(MyBetRecordItemRender.prototype,"MyBetRecordItemRender"),window.MyBetRecordItemRender=MyBetRecordItemRender;var MyBetRecordWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MyBetRecordSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=MyBetRecordItemRender},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ContestCT.ins().postBetLogs,this.updateLog),this.updateLog()},e.prototype.updateLog=function(){this.eList.dataProvider=new eui.ArrayCollection(ContestCT.ins().myBetLogs),this.infoLabel.textFlow=TextFlowMaker.generateTextFlow1("你已经下注"+ContestCT.ins().betTimes+"场比赛，下注总额：|C:"+ColorUtil.GREEN+"&T:"+ContestCT.ins().betTotal+"|元宝，|C:"+ColorUtil.GREEN+"&T:获利："+ContestCT.ins().profit+"|守擂点")},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(MyBetRecordWin.prototype,"MyBetRecordWin"),window.MyBetRecordWin=MyBetRecordWin,ViewManager.ins().reg(MyBetRecordWin,LayerManager.UI_Popup);var OpenSystem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkSysOpen=function(t){var e=GlobalConfig.OpenSystemConfig[t];if(!e)return!1;var i=e.than,n=e.openzs,s=e.openlevel,o=e.opencheck,a=e.power,r=e.appType,l=e.appTypeNoShow,h=e.recharge,u=e.wxgame,p=e.closeSrvId,c=Actor.level;if(!urlParam.debugTS&&p&&-1!=p.indexOf(+urlParam.srvid))return!1;if(urlParam.isWXiOS){if(h&&VipCT.ins().exp>0)return!1;if(r&&!isNaN(parseInt(urlParam.apptype))&&r.indexOf(+urlParam.apptype)<0)return!1;var d=Actor.power,g=GameServer.serverOpenDay;if(a)for(var f=0,v=a;f<v.length;f++){var y=v[f];if(!(y.day-1>g)&&d<y.power)return!1}}if(u)switch(u){case 1:if(!urlParam.isMiniGame)return!1;break;case 2:if(urlParam.isWXiOS)return!1;break;case 3:if(!urlParam.isWXiOS)return!1}var m=ZsCT.ins().lv,T=FbCT.ins().guanqiaID;return l&&!isNaN(parseInt(urlParam.apptype))&&-1!=l.indexOf(+urlParam.apptype)?!1:i?n>=m&&s>=c&&o>=T:m>=n&&c>=s&&T>=o},e.prototype.getNoOpenTips=function(t){var e=GlobalConfig.OpenSystemConfig[t],i="";return e&&(e.judge?e.than||(ZsCT.ins().lv<e.openzs&&(i+=e.openzs+"转"),Actor.level<e.openlevel&&(i+=e.openlevel+"级"),FbCT.ins().guanqiaID<e.opencheck&&(i+="通过第"+e.opencheck+"关"),""!=i&&(i+="开启"+e.funName)):i=""+e.funName+e.openlevel+"级开启"),i},e}(BaseSystem);__reflect(OpenSystem.prototype,"OpenSystem"),window.OpenSystem=OpenSystem;var PaoDianCC=function(t){function e(){var e=t.call(this)||this;return e._openLeftTime=0,e._openTimer=0,e._enterCD=0,e._enterCDTimer=0,e._leftTime=0,e._areaId=0,e._shenBingExp=0,e._jadeChips=0,e.scores={},e.paoDianType=1,e.isOpenWin=!1,e.sysId=PackageID.PaoDian,e.observe(GameLogic.ins().postEnterMap,e.mapChange),e.regNetMsg(1,e.postEnterSuccess),e.regNetMsg(2,e.postBelongChange),e.regNetMsg(3,e.doEnterCD),e.regNetMsg(4,e.postOpenInfo),e.regNetMsg(5,e.doRelive),e.regNetMsg(6,e.postMyInfo),e.regNetMsg(7,e.postAreaChange),e.regNetMsg(8,e.doResult),e.regNetMsg(9,e.doKfResult),e.regNetMsg(10,e.postScore),e.regNetMsg(11,e.postPaoDianType),e}return __extends(e,t),Object.defineProperty(e.prototype,"areaId",{get:function(){return this._areaId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shenBingExp",{get:function(){return this._shenBingExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"jadeChips",{get:function(){return this._jadeChips},enumerable:!0,configurable:!0}),e.prototype.mapChange=function(){this.isPaoDian&&this.enterBattle(),this._isPaoDian&&GameMap.fubenID!=GlobalConfig.PassionPointConfig.fbId&&this.escBattle(),this.gotoNpc&&GameMap.fbType==FbCT.FB_TYPE_CITY&&(this.gotoNpc=!1,MoveCC.ins().myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete),GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE))},e.prototype.findComplete=function(){ViewManager.ins().open(PaoDianNpcTalkWin)},e.prototype.enterBattle=function(){this._isPaoDian=!0,ViewManager.ins().isShow(PaoDianWin)||ViewManager.ins().open(PaoDianWin),ViewManager.ins().close(PaoDianNpcTalkWin)},e.prototype.escBattle=function(){this._isPaoDian=!1,this.scores={},ViewManager.ins().close(PaoDianWin)},e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"isPaoDian",{get:function(){return GameMap.fubenID==GlobalConfig.PassionPointConfig.fbId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isKFOpen",{get:function(){return 2==this._isOpen},enumerable:!0,configurable:!0}),e.prototype.enterPaoDian=function(){this.sendBaseProto(1)},e.prototype.postEnterSuccess=function(t){this._leftTime=DateUtils.formatMiniDateTime(t.readInt())},e.prototype.getLeftTime=function(){return Math.floor((this._leftTime-GameServer.serverTime)/1e3)},e.prototype.postBelongChange=function(t){this._belongs=[];var e=t.readInt();this._belongs.length=e;for(var i=0;e>i;i++)this._belongs[i]={id:t.readShort(),handler:t.readDouble()}},e.prototype.doEnterCD=function(t){this._enterCD=t.readInt(),this._enterCDTimer=egret.getTimer()},e.prototype.getEnterCD=function(){return Math.ceil(this._enterCD-(egret.getTimer()-this._enterCDTimer)/1e3)},e.prototype.postOpenInfo=function(t){this._isOpen=t.readUnsignedByte(),this._openLeftTime=t.readInt(),this._openTimer=egret.getTimer(),this._isOpen&&!this.isOpenWin&&(this.isOpenWin=!0,ViewManager.ins().open(PlayTipsWin,PlayTipsWin.TYPE_Paodian))},e.prototype.getOpenLeftTime=function(){return this._openLeftTime-(egret.getTimer()-this._openTimer)/1e3},e.prototype.sendReLive=function(){this.sendBaseProto(5)},e.prototype.doRelive=function(t){BossCT.ins().reliveTime=t.readInt(),BossCT.ins().killerHandler=t.readDouble(),ViewManager.ins().close(TargetPlayerBigBloodPanel),BossCT.ins().reliveTime>0?(BossCT.ins().clearWorldBossList(),ViewManager.ins().open(WorldBossBeKillWin)):ViewManager.ins().close(WorldBossBeKillWin)},e.prototype.sendCheckMyInfo=function(){this.sendBaseProto(6)},e.prototype.postMyInfo=function(t){this._shenBingExp=t.readInt(),this._jadeChips=t.readInt()},e.prototype.postAreaChange=function(t){this._areaId=t.readShort()},e.prototype.doResult=function(t){var e=t.readInt(),i=[];i.length=e;for(var n=0;e>n;n++)i[n]=new PaoDianRankVo(t);ViewManager.ins().open(PaoDianResultWin,i)},e.prototype.doKfResult=function(t){for(var e=t.readInt(),i=t.readInt(),n=t.readUnsignedByte(),s=[],o=0;n>o;o++){var a=new RewardData;a.type=t.readByte(),a.id=t.readInt(),a.count=t.readUnsignedInt(),s.push(a)}n=t.readUnsignedByte();var r=[];r.length=n;for(var o=0;n>o;o++)r[o]=new PaoDianRankVo(t);ViewManager.ins().open(PaoDianResultKFWin,e,i,s,r)},e.prototype.postScore=function(t){var e=t.readInt(),i=t.readInt();this.scores[e]=i},e.prototype.postPaoDianType=function(t){this.paoDianType=t.readUnsignedByte()},e.prototype.checkRedPoint=function(){return this.isOpen&&Actor.level+1e3*ZsCT.ins().lv>=GlobalConfig.PassionPointConfig.openLv},e.prototype.getBelongById=function(t){if(!this._belongs||0==this._belongs.length)return null;for(var e=this._belongs.length,i=0;e>i;i++)if(this._belongs[i].id==t)return this._belongs[i];return null},e.prototype.checkPaodianOpen=function(){if(!this.isOpen)return TipsCT.ins().showTips(GlobalConfig.PassionPointConfig.openTips),!1;if(KfArenaSys.ins().checkIsMatching()){var t=GlobalConfig.PassionPointConfig.openLv;return Actor.level+1e3*ZsCT.ins().lv<t?(TipsCT.ins().showTips((1e3>t?t+"级":t%1e3==0?t/1e3+"转":t/1e3+"转"+t%1e3+"级")+"可参与激情泡点"),!1):CityCC.ins().enterCD<1?CityCC.ins().isCity?(MoveCC.ins().myMoveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE,this.findComplete),GameMap.moveTo(GlobalConfig.PassionPointConfig.npcPos[0]*GameMap.CELL_SIZE,GlobalConfig.PassionPointConfig.npcPos[1]*GameMap.CELL_SIZE),!1):(this.gotoNpc=!0,CityCC.ins().sendEnter(),!0):(TipsCT.ins().showTips("冷却中，"+CityCC.ins().enterCD+"秒后可进入主城"),!1)}},__decorate([post()],e.prototype,"postEnterSuccess",null),__decorate([post()],e.prototype,"postBelongChange",null),__decorate([post()],e.prototype,"postOpenInfo",null),__decorate([post()],e.prototype,"postMyInfo",null),__decorate([post()],e.prototype,"postAreaChange",null),__decorate([post()],e.prototype,"postScore",null),__decorate([post()],e.prototype,"postPaoDianType",null),e}(BaseSystem);__reflect(PaoDianCC.prototype,"PaoDianCC"),System.PaoDianCC=function(){return PaoDianCC.ins()},window.PaoDianCC=PaoDianCC;var PaoDianCurrentWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointCurrentTipsSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClose),this.observe(PaoDianCC.ins().postMyInfo,this.update),this.observe(PaoDianCC.ins().postAreaChange,this.update),this.update()},e.prototype.update=function(){this.yupeiNum.text="威望"+PaoDianCC.ins().jadeChips,this.gwexpNum.text="经验"+PaoDianCC.ins().shenBingExp;var t=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.text=t?t.times+"倍区域":"";var e=t?t.reward[1].count:0;e=Math.floor(e/1e3)/10,this.Speed.text=GlobalConfig.PassionPointConfig.efficiencyDesc.replace("%s",(t?t.reward[0].count:0)+"").replace("%s",e+""),this.currentArea.textColor=this.yupeiNum.textColor=this.gwexpNum.textColor=this.Speed.textColor=t?t.color:this.Speed.textColor},e.prototype.close=function(){},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PaoDianCurrentWin.prototype,"PaoDianCurrentWin"),ViewManager.ins().reg(PaoDianCurrentWin,LayerManager.Main_View),window.PaoDianCurrentWin=PaoDianCurrentWin;var PaoDianIconItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointResultAwardSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.icon.source=this.data[0];var t=this.data[1];t=Math.floor(t/1e3)/10,this.count.text=0==t?"0":t+"万"},e}(BaseItemRender);__reflect(PaoDianIconItemRender.prototype,"PaoDianIconItemRender"),window.PaoDianIconItemRender=PaoDianIconItemRender;var PaoDianNpcTalkWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointTipsSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onGoto),this.update()},e.prototype.close=function(){this.removeTouchEvent(this.goTo,this.onGoto)},e.prototype.update=function(){this.desc.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PassionPointConfig.desc),this.rule.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.HelpInfoConfig[2==PaoDianCC.ins().paoDianType?49:20].text),this.redPoint.visible=PaoDianCC.ins().isOpen},e.prototype.onGoto=function(t){if(t.target==this.goTo){if(!KfArenaSys.ins().checkIsMatching())return;if(!PaoDianCC.ins().isOpen)return void TipsCT.ins().showTips(GlobalConfig.PassionPointConfig.openTips);var e=GlobalConfig.PassionPointConfig.openLv;if(Actor.level+1e3*ZsCT.ins().lv<e)return void TipsCT.ins().showTips((1e3>e?e+"级":e%1e3==0?e/1e3+"转":e/1e3+"转"+e%1e3+"级")+"可参与激情泡点");var i=PaoDianCC.ins().getEnterCD();if(i>0)return void TipsCT.ins().showTips(i+"秒后才可进入激情泡点");PaoDianCC.ins().enterPaoDian()}else t.target==this.bgClose&&ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(PaoDianNpcTalkWin.prototype,"PaoDianNpcTalkWin"),ViewManager.ins().reg(PaoDianNpcTalkWin,LayerManager.UI_Main),window.PaoDianNpcTalkWin=PaoDianNpcTalkWin;var PaoDianResultItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="PointResultItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.award.itemRenderer=PaoDianIconItemRender},e.prototype.dataChanged=function(){var t=this.data;this.ranking.text=t.rank+"",this.roleName.text=t.roleName,this.guild.text=t.unionName,this.award.dataProvider=new eui.ArrayCollection([["ZSprestige",t.jadeChips],["ZSexp",t.shenBingExp]])},e}(BaseItemRender);__reflect(PaoDianResultItemRender.prototype,"PaoDianResultItemRender"),window.PaoDianResultItemRender=PaoDianResultItemRender;var PaoDianResultKFWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._time=5,e._sn_="PointResultCrossSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ItemBase,this.rankList.itemRenderer=PaoDianResultItemRender,this.myRewarrd.itemRenderer=PaoDianIconItemRender,this._arrayCollect=new eui.ArrayCollection,this.myRewarrd.dataProvider=this._arrayCollect,this.addTouchEvent(this,this.onTap)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1],s=t[2],o=t[3];this.timerGroup.visible=!0,this.info.text=this._time+"",Timer.start(1e3,this._time,this.repeat,this),this._arrayCollect.source=[["ZSprestige",n],["ZSexp",i]],this.rankList.dataProvider=new eui.ArrayCollection(o),this.eList.dataProvider=new eui.ArrayCollection(s)},e.prototype.repeat=function(){this._time--,this._time>0?this.info.text=this._time+"":(this.timerGroup.visible=!1,FbCT.ins().sendExitFb(),ViewManager.ins().close(this))},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:FbCT.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PaoDianResultKFWin.prototype,"PaoDianResultKFWin"),window.PaoDianResultKFWin=PaoDianResultKFWin,ViewManager.ins().reg(PaoDianResultKFWin,LayerManager.UI_Main);var PaoDianResultWin=function(t){function e(){var e=t.call(this)||this;return e._time=5,e.skinName="PointResultSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rankList.itemRenderer=PaoDianResultItemRender,this.myRewarrd.itemRenderer=PaoDianIconItemRender,this._arrayCollect=new eui.ArrayCollection,this.myRewarrd.dataProvider=this._arrayCollect},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(PaoDianCC.ins().postMyInfo,this.updateMyScore),this.timerGroup.visible=!0,this.info.text=this._time+"",Timer.start(1e3,5,this.repeat,this),this.updateMyScore(),this.rankList.dataProvider=new eui.ArrayCollection(t[0])},e.prototype.updateMyScore=function(){this._arrayCollect.source=[["ZSprestige",PaoDianCC.ins().jadeChips],["ZSexp",PaoDianCC.ins().shenBingExp]]},e.prototype.repeat=function(){this._time--,this._time>0?this.info.text=this._time+"":this.timerGroup.visible=!1},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.target){case this.closeBtn:FbCT.ins().sendExitFb(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(PaoDianResultWin.prototype,"PaoDianResultWin"),ViewManager.ins().reg(PaoDianResultWin,LayerManager.UI_Main),window.PaoDianResultWin=PaoDianResultWin;var PaoDianWin=function(t){function e(){var e=t.call(this)||this;return e._leftTime=0,e._stateList=["one","two","three","","five"],e.skinName="PointFightSkin",e.scoreLabs=[e.eScore0,e.eScore1],e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(PaoDianCC.ins().postEnterSuccess,this.updateTime),this.observe(PaoDianCC.ins().postBelongChange,this.update),this.observe(PaoDianCC.ins().postAreaChange,this.updateCurrentArea),this.observe(PaoDianCC.ins().postScore,this.updateScore),this.eScoreGroup.visible=PaoDianCC.ins().isKFOpen,this.update(),this.updateTime(),this.updateCurrentArea(),this.updateScore()},e.prototype.updateScore=function(){this.eScore0.text="",this.eScore1.text="";var t=0;for(var e in PaoDianCC.ins().scores){if(!this.scoreLabs[t])return;this.scoreLabs[t].text="S."+e+" "+PaoDianCC.ins().scores[e]+"积分",t++}},e.prototype.update=function(){for(var t,e,i,n,s,o=0;5>o;o++)t=GlobalConfig.PassionPointConfig.expPoint[o],e=t[2],i=PaoDianCC.ins().getBelongById(e),n=this["area"+o],n.name=i?i.handler+"":t[0]+","+t[1],this["occupy"+o].visible=null==i,i?(s=EntityManager.ins().getEntityBymasterhHandle(i.handler),s?(this["name"+o].text=s.infoModel.getNameWithServer2(),this["guild"+o].text=s.infoModel.guildName):(this["name"+o].text="",this["guild"+o].text="")):(this["name"+o].text="",this["guild"+o].text="")},e.prototype.updateTime=function(){Timer.stop(this.repeat,this),this._leftTime=PaoDianCC.ins().getLeftTime(),this._leftTime>0?(Timer.start(1e3,0,this.repeat,this),this.repeat()):this.wholeLeftTime.text=""},e.prototype.repeat=function(){return this._leftTime<=0?(this.wholeLeftTime.text="",void Timer.stop(this.repeat,this)):(this.wholeLeftTime.text=DateUtils.getFormatBySecond(this._leftTime,DateUtils.TIME_FORMAT_5,4),void this._leftTime--)},e.prototype.updateCurrentArea=function(){var t=GlobalConfig.PassionPointAwardConfig[PaoDianCC.ins().areaId];this.currentArea.currentState=this._stateList[t?t.times-1:0]},e.prototype.close=function(){Timer.stop(this.repeat,this)},e.prototype.onTouch=function(t){switch(t.target){case this.area0:case this.area1:case this.area2:case this.area3:case this.area4:var e=t.target.name.split(",");1==e.length?Number(e[0])==Actor.handle?TipsCT.ins().showTips("你已占据了当前点位"):GameLogic.ins().postChangeAttrPoint(Number(e[0])):(GameLogic.ins().stopAI(),SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),GameMap.moveTo(Number(e[0])*GameMap.CELL_SIZE,Number(e[1])*GameMap.CELL_SIZE));break;case this.currentArea:PaoDianCC.ins().sendCheckMyInfo(),ViewManager.ins().open(PaoDianCurrentWin);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[2==PaoDianCC.ins().paoDianType?49:20].text)}},e}(BaseEuiView);__reflect(PaoDianWin.prototype,"PaoDianWin"),ViewManager.ins().reg(PaoDianWin,LayerManager.Main_View),window.PaoDianWin=PaoDianWin;var PaoDianRankVo=function(){function t(t){this.rank=t.readShort(),this.roleName=t.readString(),this.unionName=t.readString(),this.shenBingExp=t.readInt(),this.jadeChips=t.readInt()}return t}();__reflect(PaoDianRankVo.prototype,"PaoDianRankVo"),window.PaoDianRankVo=PaoDianRankVo;var PlatFormID=function(){function t(){}return t.SDK_TYPE=window.ourPlatform,t.WAN_BA="7000024",t.QQ_BROWSER="2000001",t.ZHI_SHANG="2000003",t.FENG_KUANG="2000004",t.AI_WEI_YOU="2000005",t.GE_TUI="2000006",t.XIN_LANG="2000007",t.$9G="2000012",t.QUN_HEI="2000013",t.$1758="2000014",t.ZI_JIE="7000172",t.WX_MINI="7000006",t.QQ_MINI="7000175",t.ZHONG_SHOU_YOU="7000179",t.QQ_BLUE="7000178",t.OPPO="7000169",t.OPPO_FENG="7000182",t.OPPO_MI="7000181",t.UC="7000223",t}();__reflect(PlatFormID.prototype,"PlatFormID"),window.PlatFormID=PlatFormID;var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.text=new eui.Label,this.text.text="资源加载中...",this.addChild(this.text)},e.prototype.setProgress=function(t,e){this.text.text="资源加载中..."+t+"/"+e},e}(BaseEuiView);__reflect(LoadingView.prototype,"LoadingView"),window.LoadingView=LoadingView;var PfActivity=function(t){function e(){var e=t.call(this)||this;return e.wxInviteCount=0,e.isShowInviteHint=!0,e.focusState=-1,e.isShowGameDesktop=0,e.bangDingRewardState=-1,e.hasBang=!1,e.sendSuc=!0,e.shareNum=0,e.recordNum=0,e.qqZoneAward={},e.fpVipAward={},e.pfVipAllTask=[],e.PFHallAwards=[],e.sysId=PackageID.pfActivity,e.regNetMsg(1,e.postWanBaGift),e.regNetMsg(3,e.doZhiShangData),e.regNetMsg(4,e.postInviteInfoUpdate),e.regNetMsg(5,e.postProveInfo),e.regNetMsg(16,e.postBangingInfo),e.regNetMsg(17,e.postWanBaGiftState),e.regNetMsg(18,e.postScreenRecording),e.regNetMsg(19,e.postQQZoneAward),e.regNetMsg(20,e.postPFVipAward),e.regNetMsg(21,e.postPFVipTask),e.regNetMsg(22,e.postOnePFVipTask),e.regNetMsg(23,e.postPFHallAward),e.observe(RecordScreenCT.ins().postShareSuc,e.onShareSuc),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendWanBaGift(),this.getFocus(),this.getVerify(),this.getInviteType()},e.prototype.getInviteType=function(){var t=this,e=window.isOpenShare;e&&e(function(e){2==e&&(t.isShowInviteHint=!1)})},e.prototype.getFocus=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=window.getFocusState,t?[4,new Promise(function(e){t(urlParam,e)})]:[2];case 1:return e=i.sent(),this.postGuanZhu(e),[2]}})})},e.prototype.getVerify=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=window.isOpenVerify,t?[4,new Promise(function(e){t(e)})]:[2];case 1:return e=i.sent(),this.postVerify(e),[2]}})})},e.prototype.postGuanZhu=function(t){this.focusState=t,1==this.focusState&&this.sendGuanZhuGift()},e.prototype.postGameDesktop=function(t){return this.isShowGameDesktop=t,t},e.prototype.saveGameDesktop=function(){var t=this;window.saveGameDesktop(function(){SysSetting.ins().setValue("isSaveGameDesktop",1),t.postGameDesktop(0)})},e.prototype.postWanBaGift=function(t){for(var e=this,i=t.readUnsignedInt(),n=t.readBoolean(),s=t.readByte(),o="",a=0;s>a;a++){var r=new RewardData;r.parser(t);var l=void 0;l=0==r.type?RewardData.CURRENCY_NAME[r.id]:GlobalConfig.ItemConfig[r.id].name,o+=l+"×"+CommonUtils.overLength(r.count)+"；"}var h,u,p,c,d=window.h5gamecn,g=function(){c||(c='<b><font size="20">'+h+"：</font></b>\n\n"+o+"\n\n\n\n"+p);var t=WarnWin.show(c,null,e,null,e,"sure");t.title.text=u,t.setBtnLabel("关闭")};switch(i){case 1:case 2:case 11:case 12:case 13:case 14:case 15:case 16:case 17:n?(h="恭喜你获得",u="领取成功"):(h="你今天已经领取过",u="每天只能领取一次哦"),p="记得明天继续到玩吧礼包中心领取新的礼包哦！",g(h,p,u,o,c);break;case 3:case 10001:case 10002:case 10003:case 10004:case 10005:case 10006:d&&d.getWanBaVip&&d.getWanBaVip(function(t){t.ret?(u="领取失败",c=t.msg):(n?(h="恭喜你，获得"+VipCT.getVipStr()+"特权礼包",u="领取成功"):(h="你今天已经领取过"+VipCT.getVipStr()+"特权礼包",u="领取失败"),p="明天请记得再来领取喔~"),g(h,p,u,o,c)});break;case 4:case 5:case 6:case 7:case 8:case 9:d&&d.checkGift&&d.checkGift(function(t){t.num?(n?(h="恭喜你，获得"+VipCT.getVipStr(t.num-3,!0)+"礼包",u="领取成功"):(h="你今天已经领取过"+VipCT.getVipStr(t.num-3,!0)+"礼包",u="领取失败"),p="明天请记得再来领取喔~"):(u="领取失败",c=t.msg),g(h,p,u,o,c)},i)}},e.prototype.sendWanBaGift=function(t,e){void 0===t&&(t=0),void 0===e&&(e=1),0==t?urlParam.GIFT&&this.sendWanBaGiftId(+urlParam.GIFT,e):this.sendWanBaGiftId(t,e)},e.prototype.sendWanBaGiftId=function(t,e){void 0===e&&(e=1);var i=this.getBytes(1);i.writeUnsignedInt(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendGuanZhuGift=function(){this.sendBaseProto(2)},e.prototype.doZhiShangData=function(t){urlParam.appid==PlatFormID.ZHI_SHANG&&ReportData.report("LV5")},e.prototype.sendWeiXinInviteGift=function(){this.sendBaseProto(4)},e.prototype.postInviteInfoUpdate=function(t){this.wxInviteCount=t.readInt(),this.inviteTime=t.readInt()},e.prototype.copyMsgToBoard=function(t){if(document&&document.createElement){var e=document.createElement("input");return e.value=t,document.body.appendChild(e),e.select(),e.setSelectionRange(0,e.value.length),document.execCommand("Copy"),document.body.removeChild(e),!0}return!1},e.prototype.postProveInfo=function(t){this.giftState=t.readByte()},e.prototype.sendProveInfo=function(){this.sendBaseProto(5)},e.prototype.postVerify=function(t){this.proveState=t,t||this.sendProveInfo()},e.prototype.showVerify=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return t=window.showVerify,t?[4,new Promise(function(e){t(e)})]:[2];case 1:return e=i.sent(),e&&(this.sendProveInfo(),ViewManager.ins().close(ProveWin)),[2]}})})},e.prototype.postBangingInfo=function(t){this.bangDingRewardState=t.readByte()},e.prototype.sendBangingReward=function(t){var e=this.getBytes(16);e.writeByte(t),this.sendToServer(e)},e.prototype.postWanBaGiftState=function(t){var e=t.readUnsignedInt(),i=t.readByte();return[e,i]},e.prototype.sendScreenRecordAward=function(t){var e=this.getBytes(18);return e.writeByte(t),this.sendToServer(e)},e.prototype.postScreenRecording=function(t){this.shareNum=t.readInt(),this.recordNum=t.readInt()},e.prototype.onShareSuc=function(){this.shareNum<GlobalConfig.RecordShareRewardConfig.shareCount?this.sendSuc=e.ins().sendScreenRecordAward(2):this.sendSuc=!0},e.prototype.sendQQZoneAward=function(t,e){var i=this.getBytes(19);i.writeString(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postQQZoneAward=function(t){this.qqZoneAward[t.readString()]=t.readUnsignedByte()},e.prototype.getQQZoneAwardState=function(t){return this.qqZoneAward[t]},e.prototype.sendPFVipAward=function(t){var e=this.getBytes(20);e.writeByte(t),this.sendToServer(e)
},e.prototype.postPFVipAward=function(t){var e=t.readInt(),i={appId:e,newAward:1==t.readByte(),award:1==t.readByte(),awardSuper:1==t.readByte(),awardYear:1==t.readByte()};this.fpVipAward[e]=i},e.prototype.getCurPFVipAwardInfo=function(){return this.fpVipAward[urlParam.appid]},e.prototype.getCurPFVipAwardStatus=function(t){var e=this.getCurPFVipAwardInfo(),i=Actor.myPFVipInfo;if(!e||!i)return 0;switch(t){case 1:if(e.newAward)return 2;if(i.pfVip>0||i.pfVipSuper>0)return 1;break;case 2:if(e.award)return 2;if(i.pfVip>0)return 1;break;case 3:if(e.awardSuper)return 2;if(i.pfVipSuper>0)return 1;break;case 4:if(e.awardYear)return 2;if(i.pfVipYear>0)return 1}return 0},e.prototype.sendPFVipTaskData=function(t,e){var i=this.getBytes(21);i.writeInt(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postPFVipTask=function(t){var e=t.readUnsignedShort();this.pfVipAllTask=[];for(var i=0;e>i;i++){var n=t.readInt(),s={appId:n,tasks:this.parserPFVipTask(t,n)};this.pfVipAllTask[n]=s}},e.prototype.postOnePFVipTask=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedShort(),n=t.readInt(),s=t.readByte(),o=this.getVipTask(e,i);if(o){var a=GlobalConfig.DiamondTaskConfig[e][o.taskIndex].target||n+1;o.param=n,o.status=1==s?2:o.param<a?0:1}},e.prototype.parserPFVipTask=function(t,e){for(var i=t.readUnsignedInt(),n=[],s=0;i>s;s++){var o={taskIndex:t.readUnsignedShort(),param:t.readUnsignedInt(),status:t.readByte(),isAct:!0},a=GlobalConfig.DiamondTaskConfig[e][o.taskIndex].target||0;o.status=1==o.status?2:o.param<a?0:1,n[o.taskIndex]=o}return n},e.prototype.getVipAllTask=function(t){return this.pfVipAllTask[t]},e.prototype.getVipTask=function(t,e){var i=this.getVipAllTask(t);return i&&i.tasks?i.tasks[e]:null},e.prototype.sendPFHallAward=function(t,e){var i=this.getBytes(22);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postPFHallAward=function(t){var e=t.readUnsignedByte();this.PFHallAwards=[];for(var i=0;e>i;i++){var n=t.readByte();this.PFHallAwards[n]=[];for(var s=t.readByte(),o=0;s>o;o++){var a=t.readByte();this.PFHallAwards[n].push(a)}}},e.prototype.getPfHallAwardStatus=function(t,e){if(!LocationProperty.isFromQQBLUE)return 0;var i=this.PFHallAwards[t]&&this.PFHallAwards[t].indexOf(e)>-1;switch(t){case 1:case 3:return i?2:1;case 2:if(i)return 2;if(!GlobalConfig.QQHallGiftConfig[urlParam.appid])return 0;var n=GlobalConfig.QQHallGiftConfig[urlParam.appid][2][e];return n&&Actor.level>=n.param?1:0}},__decorate([post()],e.prototype,"postGuanZhu",null),__decorate([post()],e.prototype,"postGameDesktop",null),__decorate([post()],e.prototype,"postWanBaGift",null),__decorate([post()],e.prototype,"postInviteInfoUpdate",null),__decorate([post()],e.prototype,"postProveInfo",null),__decorate([post()],e.prototype,"postVerify",null),__decorate([post()],e.prototype,"postBangingInfo",null),__decorate([post()],e.prototype,"postWanBaGiftState",null),__decorate([post()],e.prototype,"postScreenRecording",null),__decorate([post()],e.prototype,"postQQZoneAward",null),__decorate([post()],e.prototype,"postPFVipAward",null),__decorate([post()],e.prototype,"postPFVipTask",null),__decorate([post()],e.prototype,"postOnePFVipTask",null),__decorate([post()],e.prototype,"postPFHallAward",null),e}(BaseSystem);__reflect(PfActivity.prototype,"PfActivity"),System.PfActivity=function(){return PfActivity.ins()},window.PfActivity=PfActivity;var FocusWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="UpToDesktopSkin",e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.focusBtn,this.onTap),this.initList()},e.prototype.initList=function(){var t=GlobalConfig.WeiXiGuanZhuConst.awards;this.reward.itemRenderer=ItemBase,this.reward.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){var e=t.currentTarget;switch(e){case this.bgClose:case this.closeBtn:ViewManager.ins().close(this);break;case this.focusBtn:window.showQRCode&&window.showQRCode(),ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(FocusWin.prototype,"FocusWin"),ViewManager.ins().reg(FocusWin,LayerManager.UI_Popup),window.FocusWin=FocusWin;var FranchiseWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SpecialCardSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.btn0.label=this.btn1.label=LocationProperty.isFromQQBLUE?"原价:110元\n蓝钻:88":"88元抢购",this.eGroup.visible=LocationProperty.isFromQQBLUE,this.observe(Recharge.ins().postFranchiseInfo,this.updateView),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.btn0,this.onTap),this.addTouchEvent(this.eBtn0,this.onTap),this.depictLabel.textFlow=TextFlowMaker.generateTextFlow1(GlobalConfig.PrivilegeData.rightDesc),this.updateView(),Timer.start(500,0,this.setTimeLbel,this)},e.prototype.updateView=function(){var t=Recharge.ins(),e=t.franchise,i=t.firstBuy;e>0?(this.setView(),this.setTimeLbel()):(this.btn1.enabled=!0,this.btn1.label=LocationProperty.isFromQQBLUE?"原价:110元\n蓝钻:88":"88元抢购"),(i||0>=e)&&DisplayUtils.removeFromParent(this.eTy),this.leftTime.visible=e>0,this.first.visible=!i&&!this.leftTime.visible,this.setIconEff()},e.prototype.setView=function(){Recharge.ins().franchiseget?(this.btn1.enabled=!0,this.btn1.label="领取奖励"):(this.btn1.label="已领取",this.btn1.enabled=!1)},e.prototype.setTimeLbel=function(){var t=Recharge.ins().franchise;this.leftTime.text="剩余时间："+DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5),0>=t&&this.updateView()},e.prototype.removeDisplay=function(){Timer.stop(this.setTimeLbel,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.eBtn0:PFVipCT.channelVipPay();break;case this.btn0:var e=GlobalConfig.PrivilegeData.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.MonthCardConfig.privilegeMoney,ShowRechargeType.Type_SpecialCard):Recharge.ins().sendPayOrder(e),Setting.ins().setValue(ClientSet.hotBlood,1);break;case this.btn1:if("领取奖励"!=this.btn1.label){var i=GlobalConfig.PrivilegeData.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(GlobalConfig.MonthCardConfig.privilegeMoney,ShowRechargeType.Type_SpecialCard):Recharge.ins().sendPayOrder(i),Setting.ins().setValue(ClientSet.hotBlood,1)}else Recharge.ins().sendGetFranchise()}},e.prototype.setIconEff=function(){var t=GlobalConfig.TitleConf[17];if(t){t.eff?(this.mc||(this.mc=new MovieClip),this.mc.parent||this.titleMcGroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"Titlezztq_big",-1)):(this.titleImg||(this.titleImg=new eui.Image(RES_DIR_CHENGHAO+t.img)),this.titleImg.parent||this.titleMcGroup.addChild(this.titleImg));var e=3*BagCT.getAttrPower(t.attrs);this.powerPanel.setPower(e)}},e}(BaseView);__reflect(FranchiseWin.prototype,"FranchiseWin"),window.FranchiseWin=FranchiseWin;var MonthCardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="MonthCardSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.eGroup.visible=LocationProperty.isFromQQBLUE;var t=GlobalConfig.MonthCardConfig.monthCardMoney/GlobalConfig.ClientGlobalConfig.rate;this.btn1.label=LocationProperty.isFromQQBLUE?"原价:31.25元\n蓝钻:"+t+"元":t+"元抢购",this.observe(Recharge.ins().postUpdateRecharge,this.setView),this.observe(Recharge.ins().postGetMonthDay,this.update),this.addTouchEvent(this.eBtn,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.update()},e.prototype.update=function(){urlParam.showDiamond&&(this.btn1.label="250钻\n石抢购"),this.feng.visible?this.btn1.visible=!1:(Timer.stop(this.setTimeLbel,this),Recharge.ins().monthDay>0&&(Timer.start(1e3,0,this.setTimeLbel,this),this.setTimeLbel()),this.leftTime.visible=Recharge.ins().monthDay>0,this.setView())},e.prototype.setView=function(){this.first.visible=!Setting.ins().getValue(ClientSet.firstMonthCard)},e.prototype.setTimeLbel=function(){var t=Recharge.ins().monthDay;if(t>0){var e=DateUtils.getFormatBySecond(t,DateUtils.TIME_FORMAT_5,1);e="<font color='#35e62d'>剩余时间:"+e+"</font>",this.leftTime.textFlow=(new egret.HtmlTextParser).parser(e)}else Timer.stop(this.setTimeLbel,this),this.leftTime.visible=!1},e.prototype.removeDisplay=function(){Timer.stop(this.setTimeLbel,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.btn1:var e=GlobalConfig.MonthCardConfig.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!e?Recharge.ins().showReCharge(GlobalConfig.MonthCardConfig.monthCardMoney,ShowRechargeType.Type_MonthCard):Recharge.ins().sendPayOrder(e);break;case this.eBtn:PFVipCT.channelVipPay()}},e}(BaseView);__reflect(MonthCardWin.prototype,"MonthCardWin"),window.MonthCardWin=MonthCardWin;var ProveWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="certificate",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postVerify,this.updateInfo),this.observe(PfActivity.ins().postProveInfo,this.updateInfo),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.needget,this.onTap),this.rewards.itemRenderer=ItemBase,this.updateInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.needget:PfActivity.ins().showVerify()}},e.prototype.updateInfo=function(){this.rewards.dataProvider=new eui.ArrayCollection(GlobalConfig.SDKConfig.identficateReward)},e}(BaseEuiView);__reflect(ProveWin.prototype,"ProveWin"),ViewManager.ins().reg(ProveWin,LayerManager.UI_Popup),window.ProveWin=ProveWin;var WanBaVipPrivilegeItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipWanBaSkinItem",e.eList.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.id>0){var t=this.data;switch(this.eVipLv.text=t.vipLv+"",this.eList.dataProvider=new eui.ArrayCollection(t.items),this.redPoint.visible=1==t.state,this.eBtn.enabled=1==t.state||3==t.state,t.state){case 0:this.eBtn.label="不可领取";break;case 1:this.eBtn.label="领取";break;case 2:this.eBtn.label="已领取";break;case 3:this.eBtn.label="前往充值"}}},e}(BaseItemRender);__reflect(WanBaVipPrivilegeItemRender.prototype,"WanBaVipPrivilegeItemRender"),window.WanBaVipPrivilegeItemRender=WanBaVipPrivilegeItemRender;var WanBaVipPrivilegeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wanBaVipLv=0,e._sn_="VipWanBaSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=WanBaVipPrivilegeItemRender,this.eList.dataProvider=new eui.ArrayCollection([]),this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postWanBaGiftState,this.update),this.observe(PfActivity.ins().postWanBaGift,this.checkState),this.updateVip()},e.prototype.updateVip=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n;return __generator(this,function(s){switch(s.label){case 0:return[4,new Promise(function(t){var e=window.h5gamecn;e&&e.getWanBaVip?e.getWanBaVip(function(e){t(e)}):t(null)})];case 1:t=s.sent(),!t||t.ret?this.wanBaVipLv=0:this.wanBaVipLv=t.level&&t.level>0?+t.level:0,this.vipValue.text=this.wanBaVipLv+"",this.infos=[],e=1;for(i in GlobalConfig.WanBaPrivilegeCfg)n={id:GlobalConfig.WanBaPrivilegeCfg[i].id,vipLv:e,state:0,items:GlobalConfig.WanBaPrivilegeCfg[i].items},e==this.wanBaVipLv&&(this.curInfo=n),this.infos.push(n),e++;return this.curInfo?this.checkState():this.updateList(),[2]}})})},e.prototype.checkState=function(){PfActivity.ins().sendWanBaGift(this.curInfo.id,2)},e.prototype.update=function(t){if(t&&this.curInfo.id==t[0])for(var e in this.infos){var i=this.infos[e];i.vipLv==this.wanBaVipLv?i.state=0==t[1]?1:2:i.vipLv<this.wanBaVipLv?i.state=0:i.state=3}this.updateList()},e.prototype.updateList=function(){this.eList.dataProvider=new eui.ArrayCollection(this.infos)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof WanBaVipPrivilegeItemRender){var e=t.target.parent.parent.data;if(1==e.state)PfActivity.ins().sendWanBaGift(e.id);else if(3==e.state){var i=Recharge.ins().getRechargeData(0);i&&0!=i.num?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge1Win),ViewManager.ins().close(this)}}else switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WanBaVipPrivilegeWin.prototype,"WanBaVipPrivilegeWin"),window.WanBaVipPrivilegeWin=WanBaVipPrivilegeWin,ViewManager.ins().reg(WanBaVipPrivilegeWin,LayerManager.UI_Popup);var WeiBoShareWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WeiboShareSkin",this.input.textDisplay.size=16,this.input.textDisplay.lineSpacing=0,this.input.textDisplay.multiline=!0,this.input.textDisplay.wordWrap=!0,this.input.textDisplay.height=171,this.input.textDisplay.maxChars=40},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.fxBtn,this.onTap)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn1,this.onTap),this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.fxBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.fxBtn:if(this.input.text.length<=0)return void TipsCT.ins().showTips("请输入分享内容");window.weiboShare(this.input.text,LocationProperty.openID,LocationProperty.openKey);case this.closeBtn1:case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WeiBoShareWin.prototype,"WeiBoShareWin"),ViewManager.ins().reg(WeiBoShareWin,LayerManager.UI_Popup),window.WeiBoShareWin=WeiBoShareWin;var YqWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="InviteFriendsSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.eInviteGroup.visible=t?t[0]:!0,Timer.start(1e3,0,this.updateInfo,this),this.observe(PfActivity.ins().postInviteInfoUpdate,this.updateInfo)},e.prototype.skinComplete=function(){this.addTouchEvent(this.closeBtn1,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.fxBtn,this.onTap),this.updateInfo()},e.prototype.removeDisplay=function(){Timer.stopAll(this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn1:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.fxBtn:ViewManager.ins().open(WeiBoShareWin)}},e.prototype.updateInfo=function(){if(PfActivity.ins().wxInviteCount>=3)return void ViewManager.ins().close(this);PfActivity.ins().isShowInviteHint||(this.group.visible=!1);var t=3;this.count.text="("+PfActivity.ins().wxInviteCount+"/"+t+")",this.fxBtn.enabled=PfActivity.ins().wxInviteCount<t;var e=GlobalConfig.SDKConfig.shareReward,i=e[0];if(0==i.type)this.icon.source=RewardData.getCurrencyRes(i.id);else{var n=GlobalConfig.ItemConfig[i.id];n&&(this.icon.source=n.icon+"_png")}if(this.item.source=this.icon.source,this.ybCountTxt.text=""+i.count,PfActivity.ins().wxInviteCount){var s=DateUtils.formatMiniDateTime(PfActivity.ins().inviteTime)-GameServer.serverTime;this.time.text=s>0?DateUtils.getFormatBySecond(s/1e3)+"后可再次邀请":""}else this.time.text=""},e}(BaseEuiView);__reflect(YqWin.prototype,"YqWin"),ViewManager.ins().reg(YqWin,LayerManager.UI_Popup),window.YqWin=YqWin;var BlueHallRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,e.postAwardPoint),e.associated(e.postAwardPoint,PfActivity.ins().postPFHallAward,Actor.ins().postLevelChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.newAwardRed||this.everyAwardRed||this.lvAwardRed,t!=this.redPoint},e.prototype.postAwardPoint=function(){this.newAwardRed=1==PfActivity.ins().getPfHallAwardStatus(1,1),this.everyAwardRed=1==PfActivity.ins().getPfHallAwardStatus(3,1),this.lvAwardRed=!1;var t=GlobalConfig.QQHallGiftConfig[urlParam.appid];if(t&&t[2]){var e=t[2];for(var i in e)if(1==PfActivity.ins().getPfHallAwardStatus(e[i].type,e[i].index))return void(this.lvAwardRed=!0)}},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postAwardPoint",null),e}(BaseSystem);__reflect(BlueHallRedPoint.prototype,"BlueHallRedPoint"),System.BlueHallRedPoint=function(){return BlueHallRedPoint.ins()},window.BlueHallRedPoint=BlueHallRedPoint;var BlueVipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.associated(e.postRedPoint,e.postAwardPoint,e.postlvAwardRed),e.associated(e.postAwardPoint,PfActivity.ins().postPFVipAward,PfActivity.ins().postOnePFVipTask,Actor.postPFVipInfo),e.associated(e.postlvAwardRed,PfActivity.ins().postPFVipTask,PfActivity.ins().postOnePFVipTask,Actor.postPFVipInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.newAwardRed||this.everyDayAwardRed||this.lvAwardRed,t!=this.redPoint},e.prototype.postAwardPoint=function(){this.newAwardRed=1==PfActivity.ins().getCurPFVipAwardStatus(1);var t=[1==PfActivity.ins().getCurPFVipAwardStatus(2),1==PfActivity.ins().getCurPFVipAwardStatus(3),1==PfActivity.ins().getCurPFVipAwardStatus(4)];this.everyDayAwardRed=!1;for(var e in t)t[e]&&(this.everyDayAwardRed=!0)},e.prototype.postlvAwardRed=function(){this.lvAwardRed=!1;var t=Actor.myPFVipInfo?Actor.myPFVipInfo.pfVip>0:!1,e=CommonUtils.objectToArray(GlobalConfig.DiamondTaskConfig[urlParam.appid]);if(e&&t)for(var i=0;i<e.length;i++){var n=e[i],s=PfActivity.ins().getVipTask(n.appid,n.index);if(s&&1==s.status)return void(this.lvAwardRed=!0)}},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postAwardPoint",null),__decorate([post()],e.prototype,"postlvAwardRed",null),e}(BaseSystem);__reflect(BlueVipRedPoint.prototype,"BlueVipRedPoint"),System.BlueVipRedPoint=function(){return BlueVipRedPoint.ins()},window.BlueVipRedPoint=BlueVipRedPoint;var PFVipCT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.parserPFVipInfo=function(t){for(var e=t.readUnsignedShort(),i={},n=0;e>n;n++){var s={appId:t.readInt(),pfVip:t.readByte(),pfVipSuper:t.readByte(),pfVipYear:t.readByte(),pfLv:t.readInt()};i[s.appId]=s}return i},e.getCurPFVipInfo=function(t){return t?t[urlParam.appid]:null},e.getCurPFVipStr=function(t){var e=this.getCurPFVipInfo(t);if(!(e&&e.pfVip>0))return"";var i="",n="";switch(urlParam.appid){case PlatFormID.QQ_BLUE:i="1",n=e.pfVipYear>0?"#1999#":"";break;default:return i}var s="";return e.pfVip>0&&(s="#"+i+"0"+((e.pfLv<10?"0":"")+e.pfLv)+"#"),s+=n},e.channelVipPay=function(){LocationProperty.isFromQQBLUE&&(window.h5gamecn&&window.h5gamecn.channelVipPay?window.h5gamecn.channelVipPay(function(){e.getQQVipInfo()}):console.log("调用QQ大厅充值"))},e.getQQVipInfo=function(){var t=this;return new Promise(function(e,i){return __awaiter(t,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:return"7000178"!=urlParam.appid?[3,2]:(t=null,window.h5gamecn&&window.h5gamecn.channelVipInfo&&(t=window.h5gamecn.channelVipInfo),t?[4,new Promise(function(e){t(e)})]:(console.log("channelVipInfo No Fun"),e(),[2]));case 1:return i=n.sent(),i&&(urlParam.pfVip=i.is_blue_vip+"",urlParam.pfVipSuper=i.is_super_blue_vip+"",urlParam.pfVipYear=i.is_blue_year_vip+"",urlParam.pfVipLv=i.blue_vip_level+"",Actor.postPFVipInfo(),OtherCT.ins().sendPFVipInfo()),console.log("channelVipInfo.Actor:",Actor),e(),[3,3];case 2:console.log("NoQQ"),e(),n.label=3;case 3:return[2]}})})})},e}(BaseSystem);__reflect(PFVipCT.prototype,"PFVipCT"),System.PFVipCT=function(){return PFVipCT.ins()},window.PFVipCT=PFVipCT;var QQMemberWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QQVIPbatcSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.rewardList.itemRenderer=ItemBase},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=LocationProperty.QQZoneChannel;return""!=i},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postQQZoneAward,this.update),this.channel=LocationProperty.QQZoneChannel;var i=GlobalConfig.TencentSpaceGiftBagConf[this.channel];i&&(this.rewardList.dataProvider=new eui.ArrayCollection(i.rewards))},e.prototype.update=function(){0!=PfActivity.ins().getQQZoneAwardState(this.channel)&&ViewManager.ins().close(this)},e.prototype.onClick=function(t){switch(t.target){case this.BG:ViewManager.ins().close(this);break;case this.shoucang:PfActivity.ins().sendQQZoneAward(this.channel,2)}},e}(BaseEuiView);__reflect(QQMemberWin.prototype,"QQMemberWin"),window.QQMemberWin=QQMemberWin,ViewManager.ins().reg(QQMemberWin,LayerManager.UI_Main);var QQVipIcon=function(t){function e(){var e=t.call(this)||this;return e.showGray=!1,e.skinName="QQVipIconSkin",e.setVip(null),e.observe(Actor.postPFVipInfo,e.updateMyInfo),e}return __extends(e,t),e.prototype.updateMyInfo=function(){this.handle==Actor.handle&&this.setVip(Actor.myPFVipInfo)},e.prototype.setVip=function(t){if(this.eIcon.filters=null,t&&t.pfVip){var e="";switch(urlParam.appid){case PlatFormID.QQ_BLUE:e="b";break;default:return this.eIcon.source="",void(this.eIcon2.source="")}t.pfVipSuper>0?this.eIcon.source=(e+"h"+t.pfLv||"0")+"_png":t.pfVip>0?this.eIcon.source=(""+e+t.pfLv||"0")+"_png":this.eIcon.source="",this.eIcon2.source=t.pfVipYear>0?e+"n_png":""}else if(this.eIcon.source="",this.eIcon2.source="",this.showGray)switch(urlParam.appid){case PlatFormID.QQ_BLUE:this.eIcon.filters=FilterUtil.ARRAY_GRAY_FILTER,this.eIcon.source="b0_png"}},e}(BaseView);__reflect(QQVipIcon.prototype,"QQVipIcon"),window.QQVipIcon=QQVipIcon;var BlueHallEverydayPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QQDTEveryDaySkin",e}return __extends(e,t),e.prototype.skinComplete=function(){if(this.addTouchEvent(this,this.onClick),GlobalConfig.QQHallGiftConfig[urlParam.appid]){var t=GlobalConfig.QQHallGiftConfig[urlParam.appid][3][1];this.eList.dataProvider=new eui.ArrayCollection(t.awards)}},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFHallAward,this.update),this.observe(BlueHallRedPoint.ins().postAwardPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRp.visible=BlueHallRedPoint.ins().newAwardRed},e.prototype.update=function(){switch(PfActivity.ins().getPfHallAwardStatus(3,1)){case 2:this.eBtn.label="已领取",this.eBtn.enabled=!1;break;default:this.eBtn.enabled=!0,this.eBtn.label="领取礼包"}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:PfActivity.ins().sendPFHallAward(3,1)}},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseView);__reflect(BlueHallEverydayPanel.prototype,"BlueHallEverydayPanel"),window.BlueHallEverydayPanel=BlueHallEverydayPanel;var BlueHallLevelItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BlueVIPitemSkin",e.eL.itemRenderer=ItemBase,e.eRp.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;switch(this.eTxt.text="等级："+t.param,this.eL.dataProvider=new eui.ArrayCollection(t.awards),this.eBtn.enabled=!1,this.eRp.visible=!1,PfActivity.ins().getPfHallAwardStatus(t.type,t.index)){case 0:this.eBtn.label="未完成";break;case 1:this.eBtn.label="领取",this.eBtn.enabled=!0,this.eRp.visible=!0;break;case 2:this.eBtn.label="已领取"}}},e}(BaseItemRender);__reflect(BlueHallLevelItem.prototype,"BlueHallLevelItem"),window.BlueHallLevelItem=BlueHallLevelItem;var BlueHallLevelPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QQDTLevelSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList0.itemRenderer=BlueHallLevelItem,this.eList0.dataProvider=this.listDP=new eui.ArrayCollection},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFHallAward,this.update),this.observe(BlueHallRedPoint.ins().postAwardPoint,this.update),this.update()},e.prototype.update=function(){var t=GlobalConfig.QQHallGiftConfig[urlParam.appid];if(!t||!t[2])return void this.listDP.replaceAll(null);var e=CommonUtils.objectToArray(t[2]);e.sort(this.sort),this.listDP.source=e},e.prototype.sort=function(t,e){var i=PfActivity.ins().getPfHallAwardStatus(t.type,t.index),n=PfActivity.ins().getPfHallAwardStatus(e.type,e.index);return 2==i&&2!=n?1:2!=i&&2==n?-1:t.index<e.index?-1:t.index<e.index?1:0},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof BlueHallLevelItem){var e=t.target.parent.data;PfActivity.ins().sendPFHallAward(e.type,e.index)}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(BlueHallLevelPanel.prototype,"BlueHallLevelPanel"),window.BlueHallLevelPanel=BlueHallLevelPanel;var BlueHallNewPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QQDTNewPlayerSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){if(this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=ItemBase,GlobalConfig.QQHallGiftConfig[urlParam.appid]){var t=GlobalConfig.QQHallGiftConfig[urlParam.appid][1][1];this.eList.dataProvider=new eui.ArrayCollection(t.awards)}},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFHallAward,this.update),this.observe(BlueHallRedPoint.ins().postAwardPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRp.visible=BlueHallRedPoint.ins().newAwardRed},e.prototype.update=function(){switch(PfActivity.ins().getPfHallAwardStatus(1,1)){case 2:this.eBtn.label="已领取",this.eBtn.enabled=!1;break;default:this.eBtn.enabled=!0,this.eBtn.label="领取礼包"}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:PfActivity.ins().sendPFHallAward(1,1)}},__decorate([callLater],e.prototype,"updateRed",null),e}(BaseView);__reflect(BlueHallNewPanel.prototype,"BlueHallNewPanel"),window.BlueHallNewPanel=BlueHallNewPanel;var BlueHallWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="QQDTSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isFromQQBLUE},e.prototype.skinComplete=function(){this.tab.validateNow()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BlueHallRedPoint.ins().postAwardPoint,this.updateRed),this.updateRed()},e.prototype.updateRed=function(){this.tab.getChildAt(0).eRp.visible=BlueHallRedPoint.ins().newAwardRed,this.tab.getChildAt(1).eRp.visible=BlueHallRedPoint.ins().lvAwardRed,this.tab.getChildAt(2).eRp.visible=BlueHallRedPoint.ins().everyAwardRed},e}(BaseEuiView);__reflect(BlueHallWin.prototype,"BlueHallWin"),window.BlueHallWin=BlueHallWin,ViewManager.ins().reg(BlueHallWin,LayerManager.UI_Main);var BlueVIPeverydayItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BlueVIPitemSkin",e.eL.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){var t=this.data[0];this.eL.dataProvider=new eui.ArrayCollection(this.data[1]);var e=PfActivity.ins().getCurPFVipAwardStatus(t);switch(this.eBtn.enabled=!0,this.eRp.visible=1==e,e){case 0:case 1:this.eBtn.label="领取";break;case 2:this.eBtn.label="已领取",this.eBtn.enabled=!1}var i="";switch(t){case 2:i="蓝钻lv"+(Actor.myPFVipInfo&&Actor.myPFVipInfo.pfLv>0?Actor.myPFVipInfo.pfLv:1)+"可领取";break;case 3:i="豪华蓝钻可领取";break;case 4:i="年费蓝钻可领取"}this.eTxt.text=i}},e}(BaseItemRender);__reflect(BlueVIPeverydayItem.prototype,"BlueVIPeverydayItem"),window.BlueVIPeverydayItem=BlueVIPeverydayItem;var BlueVIPeverydayPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BlueVIPeverydaySkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=BlueVIPeverydayItem;var t=GlobalConfig.DiamondGiftBagConfig[urlParam.appid],e=t?[[2,t.diamondDailyReward[Actor.myPFVipInfo.pfLv]],[3,t.diamondLuxuryReward],[4,t.diamondAnnualReward]]:null;this.eList.dataProvider=this.listDP=new eui.ArrayCollection(e)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFVipAward,this.update),this.observe(BlueVipRedPoint.ins().postAwardPoint,this.update)},e.prototype.update=function(){this.listDP.refresh()},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof BlueVIPeverydayItem){var e=t.target.parent.data[0],i=PfActivity.ins().getCurPFVipAwardStatus(e);if(0==i){var n="";switch(e){case 2:n="你不是蓝钻用户，无法领取";break;case 3:n="你不是豪华蓝钻用户，无法领取";break;case 4:n="你不是年费蓝钻用户，无法领取";break;default:return}TipsCT.ins().showTips(n)}else 1==i&&PfActivity.ins().sendPFVipAward(e)}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);__reflect(BlueVIPeverydayPanel.prototype,"BlueVIPeverydayPanel"),window.BlueVIPeverydayPanel=BlueVIPeverydayPanel;var BlueVIPlevelItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="BlueVIPitemSkin",e.eL.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e="";switch(t.type){case 8:e="等级："+t.target;break;case 19:e="等级："+t.target+"转"}this.eTxt.text=e,this.eL.dataProvider=new eui.ArrayCollection(t.reward);var i=PfActivity.ins().getVipTask(t.appid,t.index);if(this.eBtn.enabled=!1,this.eBtn.label="未完成",this.eRp.visible=!1,i)switch(i.status){case 0:this.eBtn.label="未完成";break;case 1:this.eBtn.enabled=!0,this.eBtn.label="领取",this.eRp.visible=Actor.myPFVipInfo.pfVip>0;break;case 2:this.eBtn.label="已领取"}}},e}(BaseItemRender);__reflect(BlueVIPlevelItem.prototype,"BlueVIPlevelItem"),window.BlueVIPlevelItem=BlueVIPlevelItem;var BlueVIPlevelPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BlueVIPlevelSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=BlueVIPlevelItem,this.eList.dataProvider=this.listDP=new eui.ArrayCollection},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFVipTask,this.update),this.observe(PfActivity.ins().postOnePFVipTask,this.update),this.update()},e.prototype.update=function(){var t=CommonUtils.objectToArray(GlobalConfig.DiamondTaskConfig[urlParam.appid]);t.sort(this.sort),this.listDP.source=t},e.prototype.sort=function(t,e){var i=PfActivity.ins().getVipTask(t.appid,t.index),n=PfActivity.ins().getVipTask(e.appid,e.index);return i&&n?2==i.status&&2!=n.status?1:2!=i.status&&2==n.status?-1:t.index<e.index?-1:t.index<e.index?1:0:0},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof BlueVIPlevelItem){var e=t.target.parent.data;Actor.myPFVipInfo.pfVip>0?PfActivity.ins().sendPFVipTaskData(e.appid,e.index):TipsCT.ins().showTips("你不是蓝钻用户，无法领取")}},__decorate([callLater],e.prototype,"update",null),e}(BaseView);
__reflect(BlueVIPlevelPanel.prototype,"BlueVIPlevelPanel"),window.BlueVIPlevelPanel=BlueVIPlevelPanel;var BlueVIPlogonPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BlueVIPlogonSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=ItemBase;var t=GlobalConfig.DiamondGiftBagConfig[urlParam.appid];this.eList.dataProvider=new eui.ArrayCollection(t?t.diamondNoviceReward:null)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(PfActivity.ins().postPFVipAward,this.update),this.observe(BlueVipRedPoint.ins().postAwardPoint,this.updateRed),this.update(),this.updateRed()},e.prototype.updateRed=function(){this.eRp.visible=BlueVipRedPoint.ins().newAwardRed},e.prototype.update=function(){switch(this.eBtn.enabled=!0,PfActivity.ins().getCurPFVipAwardStatus(1)){case 0:this.eBtn.label="开通蓝钻";break;case 1:this.eBtn.label="领取礼包";break;case 2:this.eBtn.label="已领取",this.eBtn.enabled=!1}},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:switch(PfActivity.ins().getCurPFVipAwardStatus(1)){case 1:PfActivity.ins().sendPFVipAward(1);break;default:PFVipCT.channelVipPay()}}},e}(BaseView);__reflect(BlueVIPlogonPanel.prototype,"BlueVIPlogonPanel"),window.BlueVIPlogonPanel=BlueVIPlogonPanel;var BlueVipPsPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BlueVipPsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:window.open("https://gamevip.qq.com/?ADTAG=VIP.WEB.rxsc")}},e}(BaseView);__reflect(BlueVipPsPanel.prototype,"BlueVipPsPanel"),window.BlueVipPsPanel=BlueVipPsPanel;var BlueVipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BlueVipSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isFromQQBLUE},e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.tab.validateNow()},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BlueVipRedPoint.ins().postAwardPoint,this.updateRed),this.observe(BlueVipRedPoint.ins().postlvAwardRed,this.updateRed),this.updateRed()},e.prototype.updateRed=function(){this.tab.getChildAt(1).eRp.visible=BlueVipRedPoint.ins().newAwardRed,this.tab.getChildAt(2).eRp.visible=BlueVipRedPoint.ins().everyDayAwardRed,this.tab.getChildAt(3).eRp.visible=BlueVipRedPoint.ins().lvAwardRed},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:case this.eBtn2:PFVipCT.channelVipPay()}},e}(BaseEuiView);__reflect(BlueVipWin.prototype,"BlueVipWin"),window.BlueVipWin=BlueVipWin,ViewManager.ins().reg(BlueVipWin,LayerManager.UI_Main);var PlayerAttrManager=function(t){function e(){var e=t.call(this)||this;return e.moduleAry=[],e.count=0,e.roleIndex=0,e.descAry=[],e.attrData=[],e.dressPower=0,e.dressCount=9,e.score=0,e.power=0,e.specialPower=0,e.descAry.push("总装备"),e.descAry.push("装备分"),e.descAry.push("龍装"),e.descAry.push("魂印"),e.descAry.push("图腾"),e.descAry.push("装扮"),e.descAry.push("称号"),e.descAry.push("合击"),e.descAry.push("转生"),e.descAry.push("羽毛"),e.descAry.push("两个戒指"),e.descAry.push("烈焰戒指"),e.descAry.push("烈焰戒指技能"),e.descAry.push("官印"),e.descAry.push("内功"),e.descAry.push("经脉"),e.descAry.push("秘籍"),e.descAry.push("爵位"),e.descAry.push("神器"),e.descAry.push("勋章"),e.descAry.push("图鉴"),e.descAry.push("强化"),e.descAry.push("精炼"),e.descAry.push("淬炼"),e.descAry.push("兵魂"),e.descAry.push("行会技能"),e.descAry.push("VIP"),e.descAry.push("等级"),e}return __extends(e,t),e.prototype.doSave=function(t,e,i){var n;if("function"==typeof window.Blob)n=new Blob([t],{type:e});else{var s=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder,o=new s;o.append(t),n=o.getBlob(e)}var a=window.URL||window.webkitURL,r=a.createObjectURL(n),l=document.createElement("a");if("download"in l){l.style.visibility="hidden",l.href=r,l.download=i,document.body.appendChild(l);var h=document.createEvent("MouseEvents");h.initEvent("click",!0,!0),l.dispatchEvent(h),document.body.removeChild(l)}else navigator.msSaveBlob?navigator.msSaveBlob(n,i):location.href=r},e.prototype.save=function(t,e){this.doSave(t,"text/latex",e+".txt")},e.prototype.getAttrStr=function(){for(var t="",e=this.attrData.length,i=0;e>i;i++){var n=this.attrData[i];t+=this.descAry[n.module]+"	"+n.soldierPower+"	"+n.magePower+"	"+n.immortalPower+"\n"}return t},e.prototype.getModuleIndex=function(t){for(var e=this.descAry.length,i=0;e>i;i++)if(this.descAry[i]==t)return i;return 0},e.prototype.updateData=function(t,e,i){var n=this.getModuleIndex(t);void 0==i&&(i=0);var s=SubRoles.ins().getSubRoleByIndex(i).job,o=this.attrData[n];switch(void 0==o&&(o=new PlayerAttrModel),s){case JobConst.ZhanShi:o.soldierPower=e;break;case JobConst.FaShi:o.magePower=e;break;case JobConst.DaoShi:o.immortalPower=e}o.module=n,this.attrData[n]=o},e.prototype.isHaveRole=function(t){return t<SubRoles.ins().subRolesLen},e.prototype.getAttr=function(){var t=this;ViewManager.ins().open(LiLianWin,3),Timer.start(850,1,function(){t.updateData("图鉴",Book.ins().getBookPowerNumEx()),ViewManager.ins().close(LiLianWin)},this),Timer.start(850,1,function(){ViewManager.ins().open(LiLianWin,2),Timer.start(860,1,function(){var e=ViewManager.ins().getView(LiLianWin);t.updateData("勋章",e.xunzhangPanel.getPower()),ViewManager.ins().close(LiLianWin)},t)},this),Timer.start(1e3,1,function(){ViewManager.ins().open(LiLianWin,1)},this),Timer.start(1150,1,function(){for(var e=parseInt(Artifact.ins().getMaxIndex()+""),i=0,n=0;e>n&&(Artifact.ins().getNewArtifactBy(n+1).open||0!=Artifact.ins().getNewArtifactPower(n+1));n++)i+=Artifact.ins().getNewArtifactPower(n+1);t.updateData("神器",i)},this),Timer.start(1500,1,function(){ViewManager.ins().close(LiLianWin),ViewManager.ins().open(LiLianWin)},this),Timer.start(1600,1,function(){t.updateData("爵位",LiLian.ins().getPower()),ViewManager.ins().close(LiLianWin)},this),Timer.start(1700,1,function(){ViewManager.ins().open(DressWin,0,3),Timer.start(10,1,function(){t.updateData("称号",Title.ins().getTotalPower(),0),ViewManager.ins().close(DressWin)},t)},this),Timer.start(1800,1,function(){ViewManager.ins().open(DressWin,1,3),Timer.start(20,1,function(){t.updateData("称号",Title.ins().getTotalPower(),1),ViewManager.ins().close(DressWin)},t)},this),Timer.start(1900,1,function(){ViewManager.ins().open(DressWin,2,3),Timer.start(20,1,function(){t.updateData("称号",Title.ins().getTotalPower(),2),ViewManager.ins().close(DressWin)},t)},this),Timer.start(2e3,1,function(){ViewManager.ins().open(GuildSkillWin,0),Timer.start(20,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),0),ViewManager.ins().close(GuildSkillWin)},t)},this),Timer.start(2100,1,function(){ViewManager.ins().open(GuildSkillWin,1),Timer.start(20,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),1),ViewManager.ins().close(GuildSkillWin)},t)},this),Timer.start(2200,1,function(){ViewManager.ins().open(GuildSkillWin,2),Timer.start(20,1,function(){var e=ViewManager.ins().getView(GuildSkillWin);t.updateData("行会技能",e.guildskill.getTotalPower(),2),ViewManager.ins().close(GuildSkillWin),ViewManager.ins().close(GuildMap),ViewManager.ins().open(RoleWin,0),t.getRoleInfo()},t)},this),this.updateData("VIP",this.getVipPower());for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i).job,s=this.getRolePower(Actor.level,n);this.updateData("等级",s,i)}},e.prototype.getVipPower=function(){var t=0;if(Actor.vip>0){var e=VipCT.ins().getVipCfg(Actor.vip);t=BagCT.getAttrPower(e.attrAddition)}return t},e.prototype.getRolePower=function(t,e){var i,n=0;for(var s in GlobalConfig.RoleConfig)if(s==t.toString())for(var o in GlobalConfig.RoleConfig[s])o==e.toString()&&(i=GlobalConfig.RoleConfig[s][o],n=this.getAttrPower(i));return n},e.prototype.getAttrPower=function(t){var e=[];e.push(new AttributeData(AttributeType.atHp,t.hp)),e.push(new AttributeData(AttributeType.atMp,t.mp)),e.push(new AttributeData(AttributeType.atAttack,t.atk)),e.push(new AttributeData(AttributeType.atDef,t.def)),e.push(new AttributeData(AttributeType.atRes,t.res)),e.push(new AttributeData(AttributeType.atCrit,t.crit)),e.push(new AttributeData(AttributeType.atTough,t.tough)),e.push(new AttributeData(AttributeType.atAttackSpeed,t.as)),e.push(new AttributeData(AttributeType.atMoveSpeed,t.ms));var i=0;return i=BagCT.getAttrPower(e)},e.prototype.getRoleInfo=function(){var t=this;Timer.start(20,1,function(){var e=ViewManager.ins().getView(RoleWin),i=e.roleInfoPanel;Timer.start(10,1,function(){i["item"+t.count].showPower(),Timer.start(20,1,function(){var e=ViewManager.ins().getView(EquipDetailedWin);void 0!=e&&("官印"==e.getType()?t.updateData("官印",e.getPower(),t.roleIndex):(t.score+=e.getScore(),t.power+=e.getPower()),ViewManager.ins().close(EquipDetailedWin)),t.count++,t.count<9?t.getRoleInfo():(t.updateData("总装备",t.power,t.roleIndex),t.updateData("装备分",t.score,t.roleIndex),t.count=0,t.power=0,t.score=0,t.roleIndex++,ViewManager.ins().close(RoleWin),Timer.start(20,1,function(){t.roleIndex<3?(ViewManager.ins().open(RoleWin,0,t.roleIndex),t.getRoleInfo()):(t.count=0,t.roleIndex=0,t.getSpecialRingPower())},t))},t)},t)},this)},e.prototype.getSpecialRingPower=function(){var t=this;ViewManager.ins().open(SpecialRingWin,this.count,this.roleIndex),Timer.start(20,1,function(){var e=ViewManager.ins().getView(SpecialRingWin);Timer.start(10,1,function(){t.specialPower+=e.getPower(),ViewManager.ins().close(SpecialRingWin),t.count++,t.count<2?t.getSpecialRingPower():(t.updateData("两个戒指",t.specialPower,t.roleIndex),t.specialPower=0,t.count=0,t.roleIndex++,Timer.start(20,1,function(){t.roleIndex<3?(ViewManager.ins().open(SpecialRingWin,t.count,t.roleIndex),t.getSpecialRingPower()):(t.count=0,t.roleIndex=0,t.delayRun())},t))},t)},this)},e.prototype.delayRun=function(){this.moduleAry.push({tips:"烈焰戒指",cls:FireRingWin}),this.moduleAry.push({tips:"烈焰戒指技能",cls:FireRingWin,param:1}),this.addRoleAttr({tips:"龙魂",cls:TreasureWin}),this.addRoleNextAttr({tips:"内功",cls:SkillWin,param:1}),this.addRoleNextAttr({tips:"经脉",cls:SkillWin,param:2}),this.addRoleNextAttr({tips:"秘籍",cls:SkillWin,param:3}),this.addRoleNextAttr({tips:"强化",cls:ForgeWin,param:0}),this.addRoleNextAttr({tips:"精炼",cls:ForgeWin,param:1}),this.addRoleNextAttr({tips:"铸造",cls:ForgeWin,param:2}),this.addRoleNextAttr({tips:"兵魂",cls:ForgeWin,param:3}),this.moduleAry.push({tips:"合击",cls:RoleWin,param:1}),this.moduleAry.push({tips:"转生",cls:RoleWin,param:2}),this.addRoleNextAttr({tips:"羽毛",cls:RoleWin,param:3}),this.addRoleAttr({tips:"龍装",cls:HeirloomMainWin}),this.addRoleAttr({tips:"图腾",cls:RuneWin}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:0}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:1}),this.addRoleNextAttr({tips:"装扮",cls:DressWin,param:2}),this.onGetAttr()},e.prototype.addRoleAttr=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)this.moduleAry.push({tips:t.tips,cls:t.cls,roleIndex:i,param:i})},e.prototype.addRoleNextAttr=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)this.moduleAry.push({tips:t.tips,cls:t.cls,roleIndex:i,param:[t.param,i]})},e.prototype.onGetAttr=function(){var t=this;this.moduleAry.length&&(this.data=this.moduleAry.shift(),void 0!=this.data.param?this.data.param instanceof Array?ViewManager.ins().open(this.data.cls,this.data.param[0],this.data.param[1]):ViewManager.ins().open(this.data.cls,this.data.param):ViewManager.ins().open(this.data.cls),Timer.start(100,1,function(){t.getPlayerAttr()},this))},e.prototype.getPlayerAttr=function(){var t=ViewManager.ins().getView(this.data.cls);this.getValue(t,this.data,this.data.cls),this.onGetAttr()},e.prototype.getValue=function(t,e,i){for(var n=0;n<t.numChildren;n++){var s=t.getChildAt(n);if(s instanceof PowerPanel){if(s.visible){var o=0;if(this.data.roleIndex&&(o=this.data.roleIndex),"装扮"==this.data.tips)this.dressCount--,this.dressPower+=s.power,0==this.dressCount&&(this.updateData(this.data.tips,this.dressPower,o),this.dressPower=0,this.dressCount=9,this.save(this.getAttrStr(),Actor.myName+"的战斗力"));else{var a=0;s.power&&(a=s.power),this.updateData(this.data.tips,a,o)}}return void ViewManager.ins().close(i)}if(s instanceof egret.DisplayObjectContainer)if(s instanceof eui.ViewStack){var r=s.selectedChild;r&&this.getValue(r,e,i)}else this.getValue(s,e,i)}ViewManager.ins().close(i)},e.ins=function(){return t.ins.call(this)},e}(BaseClass);__reflect(PlayerAttrManager.prototype,"PlayerAttrManager"),window.PlayerAttrManager=PlayerAttrManager;var PlayerAttrModel=function(){function t(){this.module=0,this.soldierPower=0,this.magePower=0,this.immortalPower=0}return t}();__reflect(PlayerAttrModel.prototype,"PlayerAttrModel"),window.PlayerAttrModel=PlayerAttrModel;var PlayWayRedPoint=function(t){function e(){var e=t.call(this)||this;return e.battleRed=!1,e.paodianRed=!1,e.redPoint=!1,e.associated(e.postRedPoint,e.postBattleRed,e.postPaodianRed),e.associated(e.postBattleRed,BattleCC.ins().postOpenInfo,Actor.ins().postLevelChange),e.associated(e.postPaodianRed,PaoDianCC.ins().postOpenInfo,Actor.ins().postLevelChange),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;return this.redPoint=this.battleRed||this.paodianRed,t!=this.redPoint},e.prototype.postBattleRed=function(){var t=this.battleRed;return this.battleRed=BattleCC.ins().checkRedPoint(),t!=this.battleRed},e.prototype.postPaodianRed=function(){var t=this.paodianRed;return this.paodianRed=PaoDianCC.ins().checkRedPoint(),t!=this.paodianRed},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postBattleRed",null),__decorate([post()],e.prototype,"postPaodianRed",null),e}(BaseSystem);__reflect(PlayWayRedPoint.prototype,"PlayWayRedPoint"),System.PlayWayRedPoint=function(){return PlayWayRedPoint.ins()},window.PlayWayRedPoint=PlayWayRedPoint;var Rank=function(t){function e(){var e=t.call(this)||this;return e.rankModel=[],e.rankTypeList=[],e.sysId=PackageID.Ranking,e.regNetMsg(1,e.postRankingData),e.regNetMsg(2,e.postPraiseData),e.regNetMsg(3,e.postPraiseResult),e.regNetMsg(4,e.postAllPraiseData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){this.sendGetAllPraiseData()},e.prototype.sendGetRankingData=function(t){void 0===t&&(t=0);var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.postRankingData=function(t){var e=this.getRankModel(t.readShort());return e.parser(t),e},e.prototype.sendGetPraiseData=function(t){void 0===t&&(t=0);var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.postPraiseData=function(t){var i=e.ins().getRankModel(t.readShort());return i.praise.praiseTime=t.readShort(),i.praise.parser(t),i.type},e.prototype.sendGetAllPraiseData=function(){this.sendBaseProto(4)},e.prototype.postAllPraiseData=function(t){for(var i=t.readShort(),n=0;i>n;n++){var s=e.ins().getRankModel(t.readShort());s.praise.praiseTime=t.readShort()}},e.prototype.sendPraise=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.postPraiseResult=function(t){var i=e.ins().getRankModel(t.readShort());return i.praise.praiseTime=t.readShort(),[i.type,i.praise.getLastMobaiNum()]},e.prototype.getRankModel=function(t){if(!(t in this.rankModel)){var e=void 0;e=t==RankDataType.TYPE_SKIRMISH?RankDataSkirmish:t==RankDataType.TYPE_LADDER?RankDataLadder:t==RankDataType.TYPE_BAOSHI?RankDataZhuZao:t==RankDataType.TYPE_LONGHUN?RankDataLongHun:t==RankDataType.TYPE_WING?RankDataWing:t==RankDataType.TYPE_BOOK?RankDataBook:t==RankDataType.TYPE_ZS?RankDataZhuan:t==RankDataType.TYPE_SCORE?RankDataScore:t==RankDataType.TYPE_WEIWANG?RankDataWeiWang:t==RankDataType.TYPE_LUCKYNUMBER?RankDataLuckyNum:t==RankDataType.TYPE_RING?RankDataRing:t==RankDataType.TYPE_YUANSHEN?RankDataYuanShen:t==RankDataType.TYPE_37KFBOSS?RankData37Boss:t==RankDataType.TYPE_DART?RankDataDart:t==RankDataType.TYPE_GUILDDART?RankDataGuildDart:t==RankDataType.TYPE_HEIRLOOM?RankDataHeirloom:t==RankDataType.TYPE_SHENSHOU?RankDataShenShou:t==RankDataType.TYPE_HEARTMETHOD?RankDataHeartMethod:t==RankDataType.TYPE_MOSHEN?RankDataMoShen:RankDataBase,this.rankModel[t]=new RankModel(t,e)}return this.rankModel[t]},e.prototype.canPraiseByType=function(t){return!1},e.prototype.canPraiseInAll=function(){this.rankTypeList.length<=0&&(this.rankTypeList=[RankDataType.TYPE_POWER,RankDataType.TYPE_SKIRMISH,RankDataType.TYPE_LEVEL,RankDataType.TYPE_LILIAN,RankDataType.TYPE_XUNZHANG]);for(var t=0,e=this.rankModel;t<e.length;t++){var i=e[t];if(i&&this.rankTypeList.lastIndexOf(i.type)>-1&&i.praise&&i.praise.praiseTime<1)return!0}return!1},__decorate([post()],e.prototype,"postRankingData",null),__decorate([post()],e.prototype,"postPraiseData",null),__decorate([post()],e.prototype,"postAllPraiseData",null),__decorate([post()],e.prototype,"postPraiseResult",null),e}(BaseSystem);__reflect(Rank.prototype,"Rank");var RankModel=function(){function t(t,e){this.type=t,this._dataClass=e,this._dataList=[],this.praise=new PraiseData}return t.prototype.getDataList=function(t){return void 0===t&&(t=-1),-1==t?this._dataList:this._dataList[t]},t.prototype.parser=function(t){var e=RankDataType.ITEMS[this.type],i=t.readShort();this._dataList.length=i;for(var n=0;i>n;++n)n in this._dataList||(this._dataList[n]=new this._dataClass),this._dataList[n].PFVipInfo=PFVipCT.parserPFVipInfo(t),this._dataList[n].parser(t,e);this.selfPos=t.readShort()},t}();__reflect(RankModel.prototype,"RankModel"),System.Rank=function(){return Rank.ins()},window.Rank=Rank;var RankDataType;!function(t){t.TYPE_POWER=0,t.TYPE_ARENA=1,t.TYPE_SKIRMISH=2,t.TYPE_PASS=3,t.TYPE_COPY=4,t.TYPE_LEVEL=5,t.TYPE_WING=16,t.TYPE_JOB_ZS=7,t.TYPE_JOB_FS=8,t.TYPE_JOB_DS=9,t.TYPE_LILIAN=10,t.TYPE_LADDER=11,t.TYPE_BAOSHI=12,t.TYPE_ZHANLING=13,t.TYPE_LONGHUN=14,t.TYPE_XUNZHANG=15,t.TYPE_XIAOFEI=-1,t.TYPE_BOOK=17,t.TYPE_ZS=18,t.TYPE_SCORE=19,t.TYPE_HF_XIAOFEI=21,t.TYPE_WEIWANG=22,t.TYPE_XIAYI=23,t.TYPE_RING=24,t.TYPE_YUANSHEN=25,t.TYPE_LUCKYNUMBER=50,t.TYPE_37KFBOSS=52,t.TYPE_DART=53,t.TYPE_GUILDDART=54,t.TYPE_HEIRLOOM=59,t.TYPE_SHENSHOU=60,t.TYPE_HEARTMETHOD=61,t.TYPE_MOSHEN=62,t.DATA_POS="pos",t.DATA_ID="id",t.DATA_PLAYER="player",t.DATA_LEVEL="level",t.DATA_ZHUAN="zhuan",t.DATA_VIP="vip",t.DATA_MONTH="month",t.DATA_POWER="power",t.DATA_COUNT="count",t.DATA_EXP="exp",t.DATA_JOB="job",t.DATA_SEX="sex",t.DATA_WEIWANG="weiWang",t.ITEMS=[],t.ITEMS[t.TYPE_POWER]=t.ITEMS[t.TYPE_WING]=t.ITEMS[t.TYPE_JOB_ZS]=t.ITEMS[t.TYPE_JOB_FS]=t.ITEMS[t.TYPE_JOB_DS]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_POWER],t.ITEMS[t.TYPE_SKIRMISH]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_JOB,t.DATA_SEX,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_COUNT,t.DATA_MONTH],t.ITEMS[t.TYPE_LEVEL]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH],t.ITEMS[t.TYPE_PASS]=t.ITEMS[t.TYPE_COPY]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_POWER,t.DATA_VIP,t.DATA_COUNT,t.DATA_MONTH],t.ITEMS[t.TYPE_LILIAN]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_COUNT,t.DATA_EXP],t.ITEMS[t.TYPE_XUNZHANG]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_LEVEL,t.DATA_ZHUAN,t.DATA_VIP,t.DATA_MONTH,t.DATA_COUNT],t.ITEMS[t.TYPE_XIAYI]=[t.DATA_POS,t.DATA_ID,t.DATA_PLAYER,t.DATA_VIP,t.DATA_COUNT],t.readFunc={},t.readFunc[t.DATA_JOB]=t.readFunc[t.DATA_SEX]="readByte",t.readFunc[t.DATA_POS]=t.readFunc[t.DATA_LEVEL]=t.readFunc[t.DATA_ZHUAN]=t.readFunc[t.DATA_VIP]=t.readFunc[t.DATA_MONTH]="readShort",t.readFunc[t.DATA_ID]=t.readFunc[t.DATA_POWER]=t.readFunc[t.DATA_COUNT]=t.readFunc[t.DATA_EXP]="readInt",t.readFunc[t.DATA_POWER]="readDouble",t.readFunc[t.DATA_PLAYER]="readString"}(RankDataType||(RankDataType={})),window.RankDataType=RankDataType;var ReadPlayerCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Default,e.regNetMsg(16,e.postPlayerResult),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendFindPlayer=function(t,e){void 0===e&&(e=0);var i=this.getBytes(16);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postPlayerResult=function(t){var i=e.ins().otherPlayerData;return i||(i=new OtherPlayerData),i.parser(t),i},__decorate([post()],e.prototype,"postPlayerResult",null),e}(BaseSystem);__reflect(ReadPlayerCT.prototype,"ReadPlayerCT");var OtherPlayerData=function(){function t(){this.roleData=[],this.lilianLv=0,this.zhanlingID=0,this.zhanlingLevel=0}return t.prototype.parser=function(t){this.id=t.readInt(),this.serverId=t.readInt(),this.name=t.readString(),this.level=t.readShort(),this.vipLevel=t.readShort(),this.zhuan=t.readShort(),this.lilianLv=t.readInt(),this.ce=t.readDouble(),this.guildId=t.readInt(),this.guildName=t.readString(),this.zhanlingID=t.readInt(),this.zhanlingLevel=t.readInt();for(var e=t.readShort(),i=0;e>i;i++)this.roleData[i]=new Role,this.roleData[i].parser(t)},t}();__reflect(OtherPlayerData.prototype,"OtherPlayerData"),System.ReadPlayerCT=function(){return ReadPlayerCT.ins()},window.ReadPlayerCT=ReadPlayerCT;var SubRole=function(){function t(){this.pos1=0,this.pos2=0,this.pos3=0,this.deCirShowID=0,this.soulId=0}return t.prototype.parser=function(t){this.job=t.readByte(),this.sex=t.readByte(),this.clothID=t.readInt(),this.swordID=t.readInt(),this.wingLevel=t.readInt(),0==t.readInt()&&(this.wingLevel=-1),this.pos1=t.readInt(),this.pos2=t.readInt(),this.pos3=t.readInt(),this.deCirShowID=t.readInt(),this.soulId=t.readInt(),this.godWingData=new GodWingData,this.godWingData.parser(t)},t.prototype.getZhuangBanNG=function(){for(var t=[this.pos1,this.pos2,this.pos3],e=[0,0,0],i=0;3>i;i++){var n=GlobalConfig.ZhuangBanId[t[i]||0];n&&(n.otherId>0&&t.indexOf(n.otherId)>-1?e[i]=n.changeId||0:e[i]=t[i])}return e},t.prototype.hideNeff=function(){var t=!1,e=this.getZhuangBanNG();for(var i in e){var n=GlobalConfig.ZhuangBanId[e[i]];if(n&&1==n.hideNeff){t=!0;break}}return t},t.prototype.hideWeapons=function(){var t=!1,e=this.getZhuangBanNG();for(var i in e){var n=GlobalConfig.ZhuangBanId[e[i]];if(n&&1==n.hideWeapon){t=!0;break}}return t},t}();__reflect(SubRole.prototype,"SubRole");var PraiseData=function(){function t(){this.subRole=[]}return t.prototype.getLastMobaiNum=function(){var t=ZsCT.ins().lv>0?1e3*ZsCT.ins().lv:Actor.level,e=GlobalConfig.MorshipConfig[t].count;return e-this.praiseTime},t.prototype.parser=function(t){if(this.id=t.readInt(),this.id>0){this.name=t.readString(),this.ce=t.readDouble(),this.level=t.readShort(),this.zhuan=t.readShort(),this.vipLevel=t.readShort();for(var e=t.readShort(),i=0;e>i;i++)this.subRole[i]=new SubRole,this.subRole[i].parser(t)}},t.prototype.getRoleByJob=function(t){if(t>0)for(var e in this.subRole)if(this.subRole[e].job==t)return this.subRole[e];return this.subRole[0]},t}();__reflect(PraiseData.prototype,"PraiseData"),window.PraiseData=PraiseData;var CompressTextureProcessor=function(){function t(t,e,i){this.usePackEtc1Ktx=!1,this.ignoreResource=t,this.usePackEtc1Ktx=e,this.savedProcessor=i}return t.prototype.convertURL=function(e,i){for(var n=t.fileSuffix,s=0,o=n;s<o.length;s++){var a=o[s];if(-1!==e.indexOf(a))return e.replace(a,i)}return e},t.prototype.createCompressTextureResourceInfo=function(t){if(this.ignoreResource&&this.ignoreResource(t))return t;var e=egret.Capabilities.supportedCompressedTexture;if(e.pvrtc){var i=this.convertURL(t.url,".pvr.ktx");return{name:i,url:i,type:"pvrtc.ktx",root:t.root}}if(e.etc1){var i=this.convertURL(t.url,".ktx"),n={name:i,url:i,type:"etc1.ktx",root:t.root};return this.usePackEtc1Ktx&&(n.url=this.convertURL(t.url,".pack.etc1.ktx"),n.type="pack.etc1.ktx"),-1!==t.url.indexOf(".png")&&(n.etc1_alpha_url=this.convertURL(t.url,"_alpha.ktx")),n}return t},t.prototype.onLoadStart=function(t,e){var i=this.createCompressTextureResourceInfo(e);return"pvrtc.ktx"===i.type||"etc1.ktx"===i.type||"pack.etc1.ktx"===i.type?t.load(i,i.type):t.load(e,this.savedProcessor)},t.prototype.onRemoveStart=function(t,e){var i=this.createCompressTextureResourceInfo(e);if("pvrtc.ktx"===i.type||"etc1.ktx"===i.type||"pack.etc1.ktx"===i.type)return t.unload(i);var n=t.get(e);n&&n.dispose()},t.fileSuffix=[".png",".jpg","jpeg"],t}();__reflect(CompressTextureProcessor.prototype,"CompressTextureProcessor",["RES.processor.Processor"]);var RankData37Boss=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.serverId=t.readInt(),this.name=t.readString(),this.vipLevel=t.readUnsignedShort(),this.times=t.readUnsignedShort()},e}(RankDataBase);__reflect(RankData37Boss.prototype,"RankData37Boss"),window.RankData37Boss=RankData37Boss;var RankDataBook=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readDouble()},e}(RankDataBase);__reflect(RankDataBook.prototype,"RankDataBook"),window.RankDataBook=RankDataBook;var RankDataDart=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.serverName=t.readInt(),this.name=t.readString(),this.vipLevel=t.readUnsignedShort(),this.score=t.readUnsignedInt(),this.serverId=t.readInt()},t}();__reflect(RankDataDart.prototype,"RankDataDart"),window.RankDataDart=RankDataDart;var RankDataGuildDart=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.guildId=t.readInt(),this.serverId=t.readInt(),this.guildName=t.readString(),this.score=t.readUnsignedInt()},t}();__reflect(RankDataGuildDart.prototype,"RankDataGuildDart"),window.RankDataGuildDart=RankDataGuildDart;var RankDataHeartMethod=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.value=t.readInt()},t}();__reflect(RankDataHeartMethod.prototype,"RankDataHeartMethod"),window.RankDataHeartMethod=RankDataHeartMethod;var RankDataHeirloom=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.value=t.readDouble()},t}();__reflect(RankDataHeirloom.prototype,"RankDataHeirloom"),window.RankDataHeirloom=RankDataHeirloom;var RankDataLadder=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.id=t.readInt(),this.player=t.readString(),this.challgeLevel=t.readInt(),this.challgeId=t.readInt(),this.winNum=t.readInt(),this.job=t.readByte(),this.sex=t.readByte()},e}(RankDataBase);__reflect(RankDataLadder.prototype,"RankDataLadder"),window.RankDataLadder=RankDataLadder;var RankDataLongHun=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataLongHun.prototype,"RankDataLongHun"),window.RankDataLongHun=RankDataLongHun;var RankDataLuckyNum=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.name=t.readString(),this.vipLevel=t.readUnsignedShort(),this.score=t.readUnsignedShort()},e}(RankDataBase);__reflect(RankDataLuckyNum.prototype,"RankDataLuckyNum"),window.RankDataLuckyNum=RankDataLuckyNum;var RankDataMoShen=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.value=t.readInt()},t}();__reflect(RankDataMoShen.prototype,"RankDataMoShen"),window.RankDataMoShen=RankDataMoShen;var RankDataRing=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.vipLevel=t.readUnsignedShort(),this.monthCard=t.readUnsignedShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataRing.prototype,"RankDataRing"),window.RankDataRing=RankDataRing;var RankDataScore=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readDouble()},e}(RankDataBase);__reflect(RankDataScore.prototype,"RankDataScore"),window.RankDataScore=RankDataScore;var RankDataShenShou=function(){function t(){}return t.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.value=t.readDouble()},t}();__reflect(RankDataShenShou.prototype,"RankDataShenShou"),window.RankDataShenShou=RankDataShenShou;var RankDataSkirmish=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(e,i){t.prototype.parser.call(this,e,i);var n=GameServer.serverOpenDay+1;for(var s in GlobalConfig.SkirmishRankConfig){var o=GlobalConfig.SkirmishRankConfig[s];if(o.minRank<=this.pos&&this.pos<=o.maxRank){var a=1;for(var r in o.rewards)n>=+r&&(a=+r);var l=o.rewards[a];return this.reward=l[0].count,void(this.money=l[1].count)}}this.money=this.reward=0,this.value=this.pos},e}(RankDataBase);__reflect(RankDataSkirmish.prototype,"RankDataSkirmish"),window.RankDataSkirmish=RankDataSkirmish;var RankDataWeiWang=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.weiWang=t.readInt()},e}(RankDataBase);__reflect(RankDataWeiWang.prototype,"RankDataWeiWang"),window.RankDataWeiWang=RankDataWeiWang;var RankDataWing=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataWing.prototype,"RankDataWing"),window.RankDataWing=RankDataWing;var RankDataYuanShen=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readUnsignedShort(),this.id=t.readInt(),this.player=t.readString(),this.vipLevel=t.readUnsignedShort(),this.monthCard=t.readUnsignedShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataYuanShen.prototype,"RankDataYuanShen"),window.RankDataYuanShen=RankDataYuanShen;var RankDataZhuan=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()},e}(RankDataBase);__reflect(RankDataZhuan.prototype,"RankDataZhuan"),window.RankDataZhuan=RankDataZhuan;var RankDataZhuZao=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.parser=function(t,e){this.pos=t.readShort(),this.id=t.readInt(),this.player=t.readString(),this.level=t.readShort(),this.zslevel=t.readShort(),this.viplevel=t.readShort(),this.monthCard=t.readShort(),this.value=t.readInt()
},e}(RankDataBase);__reflect(RankDataZhuZao.prototype,"RankDataZhuZao"),window.RankDataZhuZao=RankDataZhuZao;var RankingWin=function(t){function e(){var e=t.call(this)||this;return e.firstId=0,e.skinName="RankSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.praiseBtn.touchEnabled=!0,this.praiseBtn.icon="xphb_json.phb_2",this.list.itemRenderer=RankItemRenderer,this.tab.itemRenderer=RankTabItemRenderer,this.mobaiEff=new MovieClip,this.mobaiEff.x=35,this.mobaiEff.y=-35,this.mobaiEff.scaleX=this.mobaiEff.scaleY=.65,this.bodyMc0=new MovieClip,this.bodyMc0.visible=!1,this.eBodyMCGroup0.addChild(this.bodyMc0),this.bodyMc1=new MovieClip,this.bodyMc1.visible=!1,this.eBodyMCGroup1.addChild(this.bodyMc1),this.bodyMc2=new MovieClip,this.bodyMc2.visible=!1,this.eBodyMCGroup2.addChild(this.bodyMc2)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.praiseBtn,this.onClick),this.addTouchEvent(this.list,this.onClick),this.addChangeEvent(this.tab,this.onClick),this.addTouchEvent(this.firstGroup,this.onClick),this.addTouchEvent(this.praiseGroup,this.onClick),this.addTouchEvent(this.praiseGroup2,this.onClick),this.addTouchEvent(this.praiseGroup3,this.onClick),this.addTouchEvent(this.help,this.onClick),this.setOpenType(void 0==t[0]?-1:t[0]),this.observe(Rank.ins().postRankingData,this.updateList),this.observe(ReadPlayerCT.ins().postPlayerResult,this.openOtherPlayerView),this.observe(Rank.ins().postPraiseResult,this.refushMoBaiStatu),this.observe(Rank.ins().postPraiseData,this.updatePraise),this.observe(Rank.ins().postAllPraiseData,this.updateTab),Rank.ins().sendGetAllPraiseData()},e.prototype.updateList=function(t){if(t.type==this._type){this.selfPos.text=0<t.selfPos&&t.selfPos<=1e3?t.selfPos+"":"未上榜";var e=t.getDataList();if(this.list.dataProvider=new eui.ArrayCollection(e.slice(1)),this.refushMoBaiStatu(),this.refushFirstInfo(t.getDataList(0)),this.state.visible=e&&!e.length,this.titleMcGroup.visible=this.titleImg.visible=this.firstGroup.visible=!this.state.visible,!this.state.visible){var i=this.tab.selectedItem,n=GlobalConfig.TitleConf[i.title];n?n.eff?(this.titleMc||(this.titleMc=ObjectPool.pop("MovieClip"),this.titleMc.x=0,this.titleMc.y=0,this.titleMc.scaleX=1.5,this.titleMc.scaleY=1.5,this.titleMcGroup.addChild(this.titleMc)),this.titleImg.source="",this.titleMc.visible=!0,this.titleMc.playFile(RES_DIR_EFF+n.eff,-1)):(this.titleImg.source=RES_DIR_CHENGHAO+n.img,this.titleMc&&(this.titleMc.visible=!1)):(this.titleImg.source="",this.titleMc&&(DisplayUtils.removeFromParent(this.titleMc),this.titleMc=null))}}},e.prototype.refushFirstInfo=function(t){if(t){this.firstId=t.id,this.firstNameTxt.text=t.player,this.eFPVipIcon.setVip(PFVipCT.getCurPFVipInfo(t.PFVipInfo)),this.vip.visible=t.vip>0,this.vip.source="xvip_v2_png";var e="";if(Rank.ins().curType==RankDataType.TYPE_XUNZHANG){var i=GlobalConfig.KnighthoodConfig[t.count];e=i.type}else if(Rank.ins().curType==RankDataType.TYPE_LILIAN){var i=GlobalConfig.TrainLevelConfig[t.count];e=i.trainlevel+"等"+i.trainName}else e=Rank.ins().curType==RankDataType.TYPE_SKIRMISH?"杀意："+t.count:Rank.ins().curType==RankDataType.TYPE_XIAYI?"魅力值："+t.count:t[RankDataType.DATA_LEVEL]+"级";Rank.ins().curType==RankDataType.TYPE_WEIWANG?(this.weiwang.visible=!0,this.weiwang.source=WeiWangCC.ins().getWeiWangCfg(t.weiWang).res,this.firstLevelTxt.visible=!1):(this.firstLevelTxt.visible=!0,this.weiwang.visible=!1),this.firstLevelTxt.text=e}else this.firstId=0,this.weiwang.visible=!1},e.prototype.refushMoBaiStatu=function(){Rank.ins().canPraiseByType(this._type)?(this.praiseBtn.icon="xphb_json.phb_2",this.mobaiEff.playFile(RES_DIR_EFF+"OpenRole3",-1),this.mobai.addChild(this.mobaiEff)):(this.praiseBtn.icon="xphb_json.phb_23",DisplayUtils.removeFromParent(this.mobaiEff)),this.updateTab()},e.prototype.setOpenType=function(t){for(var e=this.tab.dataProvider,i=0,n=0;n<e.length;n++){var s=e.getItemAt(n);if(s.type==t){i=n;break}}this.setOpenIndex(i)},e.prototype.setOpenIndex=function(t){this.tab.selectedIndex=t;var e=this.tab.selectedItem;this._type=e.type,Rank.ins().curType=this._type,RankItemRenderer.dataFormat=e,this.selfPos.text=null,this.list.dataProvider=null,this.list.itemRendererSkinName=e.skin||"RankItemPowerSkin",this._type==RankDataType.TYPE_LADDER?Ladder.ins().sendGetRankInfo():Rank.ins().sendGetRankingData(this._type),Rank.ins().sendGetPraiseData(this._type)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.praiseBtn:Rank.ins().rankModel[this._type].praise.praiseTime<1?Rank.ins().sendPraise(this._type):TipsCT.ins().showTips("|C:0xf3311e&T:已膜拜|");break;case this.list:this.list.selectedItem&&(this._openOtherWin=!0,ReadPlayerCT.ins().sendFindPlayer(this.list.selectedItem[RankDataType.DATA_ID]));break;case this.tab:this.setOpenIndex(this.tab.selectedIndex);break;case this.firstGroup:case this.praiseGroup:case this.praiseGroup2:case this.praiseGroup3:this.firstId&&(this._openOtherWin=!0,ReadPlayerCT.ins().sendFindPlayer(this.firstId));break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[21].text)}},e.prototype.openOtherPlayerView=function(t){this._openOtherWin&&(this._openOtherWin=!1,ViewManager.ins().open(RRoleWin,t))},e.prototype.updatePraise=function(t){for(var e,i=0;3>i;i++)this["wingEffect"+i].removeChildren(),this["wingEffect"+i+0].removeChildren();if(Rank.ins().rankModel[t].praise.id>0){for(var n=0;3>n;n++)if(e=Rank.ins().rankModel[t].praise.subRole[n],this["deEff"+n]&&(this["deEff"+n].stop(),DisplayUtils.removeFromParent(this["deEff"+n])),e){var s=GlobalConfig.ClientGlobalConfig.useManRes?0:e.sex,o=GlobalConfig.EquipConfig[e.clothID];if(o){var a=o.appearance;a&&a.indexOf("[job]")>-1&&(a=a.replace("[job]",e.job+"")),this["bodyImg"+n].source=(e.clothID>0?a+"_":e.job+"00_")+e.sex+"_c_png"}else this["bodyImg"+n].source="body000_"+e.sex+"_c_png";var r=GlobalConfig.EquipConfig[e.swordID];if(r){var a=GlobalConfig.EquipConfig[e.swordID].appearance;a&&a.indexOf("[job]")>-1&&(a=a.replace("[job]",e.job+"")),this["weaponImg"+n].source=this.hideWeapon(e.swordID,e.sex)?"":e.swordID>0?a+"_"+s+"_c_png":""}else this["weaponImg"+n].source="";var l=GlobalConfig.WingLevelConfig[e.wingLevel];l?this["wingImg"+n].source=e.wingLevel>=0?l.appearance+"_png":"":this["wingImg"+n].source="";var h=e.godWingData,u=h.getSuitSum();if(u>=WingCT.GodWingMaxSlot){var p=h.getSuitLevel(),c=GlobalConfig.GodWingSuitConfig[p];this["godWingEff"+n]||(this["godWingEff"+n]=new MovieClip,this["godWingEff"+n+0]=new MovieClip),this["godWingEff"+n].parent||(this["wingEffect"+n].addChild(this["godWingEff"+n]),this["wingEffect"+n+0].addChild(this["godWingEff"+n+0])),c.suiteff&&c.lv>=2?(this["godWingEff"+n].visible=!0,this["godWingEff"+n].playFile(RES_DIR_EFF+c.suiteff,-1),this["godWingEff"+n+0].visible=!0,this["godWingEff"+n+0].playFile(RES_DIR_EFF+c.suiteff,-1)):(this["godWingEff"+n].visible=!1,this["godWingEff"+n+0].visible=!1)}if(e.pos1>0){var d=this.getZhuangbanById(e.pos1);d.useMc>0?(this["bodyImg"+n].visible=!1,this["bodyMc"+n].visible=!0,this["bodyMc"+n].playFile(RES_DIR_DRESS+d.res+"_"+e.sex+"_c_m",-1)):(this["bodyMc"+n].visible=!1,this["bodyImg"+n].visible=!0,this["bodyImg"+n].source=d.res+"_"+e.sex+"_c_png"),DisplayUtils.removeFromParent(this["_bodyEff"+n])}else this["_bodyEff"+n]||(this["_bodyEff"+n]=new MovieClip),this.setWeaponEffect(e.clothID,"bPos"+n+"_",e.sex,this["bodyEffect"+n],this["_bodyEff"+n]);if(e.pos2>0){this["_weaponEff"+n]||(this["_weaponEff"+n]=new MovieClip);var d=this.getZhuangbanById(e.pos2);d.useMc>0?(this["weaponImg"+n].visible=!1,this.setWeaponEffect(e.pos2,"wPos"+n+"_",s,this["weaponEffect"+n],this["_weaponEff"+n],!0)):(this["weaponImg"+n].visible=!0,this["weaponImg"+n].source=this.getZhuangbanById(e.pos2).res+"_"+s+"_c_png",DisplayUtils.removeFromParent(this["_weaponEff"+n]))}else this["_weaponEff"+n]||(this["_weaponEff"+n]=new MovieClip),this.setWeaponEffect(e.swordID,"wPos"+n+"_",s,this["weaponEffect"+n],this["_weaponEff"+n]);if(e.pos3>0&&(this["wingImg"+n].source=this.getZhuangbanById(e.pos3).res+"_png"),e.deCirShowID>0&&(this["deEff"+n]||(this["deEff"+n]=ObjectPool.pop("MovieClip")),this["demonCirEff"+n].addChild(this["deEff"+n]),this["deEff"+n].playFile(""+RES_DIR_EFF+GlobalConfig.DemonCirBase[e.deCirShowID].footEff,-1)),e.soulId>0&&e.pos1<=0&&GlobalConfig.EquipConfig[e.swordID]&&!GlobalConfig.EquipConfig[e.swordID].noWSoulEff&&!e.hideWeapons()){var g=GlobalConfig.WeaponSoulConfig[e.soulId];g&&(this["_soulEff"+n]||(this["_soulEff"+n]=new MovieClip),this["_soulEff"+n].playFile(RES_DIR_EFF+g.inside[e.job-1],-1),this["soldierSoulEff"+n].addChild(this["_soulEff"+n]))}else DisplayUtils.removeFromParent(this["_soulEff"+n])}else this["bodyMc"+n].visible=!1,this["bodyImg"+n].visible=!0,this["bodyImg"+n].source="body00_png",this["weaponImg"+n].source="",this["wingImg"+n].source="",this["_weaponEff"+n]&&DisplayUtils.removeFromParent(this["_weaponEff"+n]),this["_bodyEff"+n]&&DisplayUtils.removeFromParent(this["_bodyEff"+n]),this["_soulEff"+n]&&DisplayUtils.removeFromParent(this["_soulEff"+n]);this.refushMoBaiStatu()}else for(var n=0;3>n;n++)this["bodyImg"+n].visible=!0,this["bodyMc"+n].visible=!1,this["bodyImg"+n].source="body00_png",this["weaponImg"+n].source="",this["wingImg"+n].source="",DisplayUtils.removeFromParent(this["_weaponEff"+n]),DisplayUtils.removeFromParent(this["_bodyEff"+n]),DisplayUtils.removeFromParent(this["_soulEff"+n]),DisplayUtils.removeFromParent(this["deEff"+n]);this.updateTab()},e.prototype.updateTab=function(){var t=this.tab.selectedIndex;this.tab.dataProvider.refresh(),this.tab.selectedIndex=t},e.openCheck=function(){if(LocationProperty.isIosTS)return!1;var t=Actor.level;return 60>t?(TipsCT.ins().showTips("60级开启排行榜"),!1):!0},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.hideWeapon=function(t,e){return!!GlobalConfig.EquipWithEffConfig[t+"_"+e]},e.prototype.setWeaponEffect=function(t,e,i,n,s,o){void 0===o&&(o=!1);var a=o?this.getZhuangbanById(t):GlobalConfig.EquipWithEffConfig[t+"_"+i];if(a)if(s.scaleX=s.scaleY=o?.9:a.scaling,s.parent||n.addChild(s),s.x=o?this[e+i].x-20:this[e+i].x+a.offX-2,s.y=o?this[e+i].y+65:this[e+i].y+a.offY+42,o){var r=this.getZhuangbanById(t);s.playFile(RES_DIR_DRESS+r.res+"_"+i+"_c_m",-1)}else s.playFile(RES_DIR_EFF+a.inShowEff,-1);else s.parent&&s.parent.removeChild(s)},e}(BaseEuiView);__reflect(RankingWin.prototype,"RankingWin"),ViewManager.ins().reg(RankingWin,LayerManager.UI_Main),window.RankingWin=RankingWin;var RankTabItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="BtnTab3Skin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.redPoint.visible=Rank.ins().canPraiseByType(this.data.type),this.labelDisplay.text=this.data.name},e}(BaseItemRender);__reflect(RankTabItemRenderer.prototype,"RankTabItemRenderer"),window.RankTabItemRenderer=RankTabItemRenderer;var RExtremeEquipItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.redPoint.visible=!1;var t=this.data[0],e=this.data[1];this.filters=0>=e?FilterUtil.ARRAY_GRAY_FILTER:[],this.nameLabel.text=ExtremeEquipModel.ins().descNames[t],this.selectIcon.visible=this.selected,this.itemIcon.source="icon_extreme_0"+t},e.prototype.setSelect=function(t){this.selectIcon.visible=t},e}(eui.ItemRenderer);__reflect(RExtremeEquipItem.prototype,"RExtremeEquipItem"),window.RExtremeEquipItem=RExtremeEquipItem;var RExtremeEquipPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.listWidth=726,e.curRole=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.menuList.itemRenderer=RExtremeEquipItem,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.addTouchEvent(this.leftBtn,this.onLeft),this.addTouchEvent(this.rightBtn,this.onRight),this.addTouchEvent(this.skillIcon2,this.onClick),this.addTouchEvent(this.chainImg2,this.onClick),this.addTouchEvent(this.skill,this.onClick),this.menuList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.addChangeEvent(this.menuScroller,this.onChange)},e.prototype.addDisplay=function(){this.menuList.selectedIndex=0,this.updateMenuListData(),this.pos=this.pos?this.pos:EquipPos.WEAPON,this.selectEquip(this.pos)},Object.defineProperty(e.prototype,"otherPlayerData",{set:function(t){this._otherPlayerData=t},enumerable:!0,configurable:!0}),e.prototype.updateMenuListData=function(){for(var t=ExtremeEquipModel.ins().positions.length,e=[],i=0;t>i;i++){var n=ExtremeEquipModel.ins().positions[i],s=this.getZhiZunLvByRoleID(this.curRole,n);e.push([n,s])}this.menuListData.replaceAll(e)},e.prototype.onListChange=function(){var t=this.menuList.selectedItem;this.pos=t[0],this.selectEquip(t[0]),this.selectList()},e.prototype.setRoleId=function(t,e){t=t?t:0,this.curRole=t,this.skin&&(this.updateMenuListData(),e=e?e:this.pos?this.pos:EquipPos.WEAPON,this.pos=e,this.selectEquip(e))},e.prototype.getZhiZunLvByRoleID=function(t,e){var i=this._otherPlayerData.roleData[t],n=i.getEquipByIndex(e),s=n.item.configID;return s?n.soulLv:0},e.prototype.getZhiZunLinkLevelConfig=function(t,e,i){var n=t,s=this.getZhiZunLvByRoleID(e,n);s||(s=1);var o=ExtremeEquipModel.ins().getLinkEquipPos(n);return i&&(s+=1),GlobalConfig.ZhiZunLinkLevel[n][o][s]},e.prototype.selectEquip=function(t){this.extremeName.source="extreme_name_0"+t;var e=this.getZhiZunLvByRoleID(this.curRole,t);if(e){this.attrGroup1.visible=!0;var i=GlobalConfig.ZhiZunEquipLevel[t][e],n=AttributeData.getAttStr(i.attrs,0,1,"  :  ");this.attr2.text=n;var s=this._otherPlayerData.roleData[this.curRole];this.skillChain2.text="灵魂锁链Lv."+this.getZhiZunLinkLvShow(s.index,t,e);var o=ExtremeEquipModel.ins().getSkillName(t);o&&(this.skillName2.text=o+"Lv."+e,this.skillIcon2.source=SkillCT.ins().getSkillIdIcon(i.skillId));var a=Math.floor(BagCT.getAttrPower(i.attrs))+i.ex_power;a+=this.getChainAddPower(t,e),this.powerPanel2.setPower(a)}else this.attrGroup1.visible=!1;t==EquipPos.WEAPON||t==EquipPos.CLOTHES?this.skill_2_0.parent||this.group3.addChild(this.skill_2_0):this.skill_2_0.parent&&this.skill_2_0.parent.removeChild(this.skill_2_0);for(var r=ExtremeEquipModel.ins().positions.length,l=this._otherPlayerData.roleData[this.curRole],h=0,u=0;r>u;u++){var p=0,c=l.getEquipByIndex(ExtremeEquipModel.ins().positions[u]),d=c.item.configID;d&&(p=c.soulLv),p>0&&h++}h>=GlobalConfig.ZhiZunSuitSkillConf.kitCount?this.skill.filters=[]:this.skill.filters=FilterUtil.ARRAY_GRAY_FILTER,this.setEff(t),this.selectList(),this.onChange()},e.prototype.setEff=function(t){this.mc1||(this.mc1=new MovieClip),this.mc1.parent||this.extreme_eff.addChild(this.mc1),this.mc2||(this.mc2=new MovieClip),this.mc2.parent||this.extreme_eff_bottom.addChild(this.mc2),this.mc1.playFile(RES_DIR_EFF+("extrme_eff_0"+t),-1),this.mc2.playFile(RES_DIR_EFF+"extrme_eff_bottom",-1)},e.prototype.selectList=function(){for(var t=this.menuList.dataProvider.length,e=0;t>e;e++){var i=this.menuList.getElementAt(e);i&&(e!=this.menuList.selectedIndex?i.setSelect(!1):i.setSelect(!0))}},e.prototype.onChange=function(){this.menuList.scrollH<46?(this.leftGroup.visible=!1,this.rightGroup.visible=!0):this.menuList.scrollH>=this.listWidth-this.menuList.width-46?(this.leftGroup.visible=!0,this.rightGroup.visible=!1):(this.leftGroup.visible=!0,this.rightGroup.visible=!0)},e.prototype.getChainAddPower=function(t,e){if(!e)return 0;var i=GlobalConfig.ZhiZunEquipLevel[t][e];if(!i)return 0;var n=ExtremeEquipModel.ins().getLinkEquipPos(t),s=GlobalConfig.ZhiZunLinkLevel[t][n][i.soulLinkLevel];if(!s)return 0;var o=0,a=this._otherPlayerData.roleData[this.curRole];if(s.attrs){o+=BagCT.getAttrPower(s.attrs);for(var r in s.attrs)o+=ItemUtil.relatePower(s.attrs[r],a)}var l=s.ex_power?s.ex_power:0;return o=Math.floor(o)+l},e.prototype.onLeft=function(){var t=410,e=this.menuList.scrollH-t;e=82*Math.round(e/82),0>e&&(e=0),this.menuList.scrollH=e,this.onChange()},e.prototype.onRight=function(){var t=410,e=this.menuList.scrollH+t;e=82*Math.round(e/82),e>this.listWidth-this.menuScroller.width&&(e=this.listWidth-this.menuScroller.width),this.menuList.scrollH=e,this.onChange()},e.prototype.onClick=function(t){var e,i,n,s,o;switch(t.currentTarget){case this.skillIcon2:e=this.getZhiZunLinkLevelConfig(this.menuList.selectedItem[0],ExtremeEquipModel.ins().selectJob),n=this.getZhiZunLvByRoleID(this.curRole,this.menuList.selectedItem[0]),i=ExtremeEquipModel.ins().getZhiZunEquipLevelConfig(this.menuList.selectedItem[0],n),s=GlobalConfig.SkillsConfig[i.skillId],o=SkillUtil.getDesc(s),ViewManager.ins().open(YupeiSkillTipsWin,SkillUtil.getName(s)+("Lv."+e.level),o);break;case this.chainImg2:e=this.getZhiZunLinkLevelConfig(this.menuList.selectedItem[0],this.curRole),ViewManager.ins().open(YupeiSkillTipsWin,"灵魂锁链Lv."+e.level,e.chainDesc);break;case this.skill:ViewManager.ins().open(ExtremeBuffTips,this._otherPlayerData.roleData[this.curRole])}},e.prototype.getZhiZunLinkLvShow=function(t,e,i){var n=this._otherPlayerData.roleData[t],s=n.getEquipByIndex(e);if(s&&i){var o=GlobalConfig.ZhiZunEquipLevel[e][i];return o.soulLinkLevel}return 1},e}(BaseView);__reflect(RExtremeEquipPanel.prototype,"RExtremeEquipPanel"),window.RExtremeEquipPanel=RExtremeEquipPanel;var RHeirloomMainWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSelectIndex=0,e._sn_="RHeirloomMainWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.switchRole)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.otherPlayerData=t[1],this.roleSelect.otherPlayerData=this.otherPlayerData,this.roleSelect.setCurRole(t[0]),this.roleSelect.open(),this.panelArr=[this.thunderEquipPanel,this.heirloomPanel,this.extremeEquipPanel],this.thunderEquipPanel.otherPlayerData=this.otherPlayerData,this.heirloomPanel.otherPlayerData=this.otherPlayerData,this.extremeEquipPanel.otherPlayerData=this.otherPlayerData,this.touchEnabled=!1,this.viewStack.selectedIndex=0,this.tab.validateNow(),this.setSelectedIndex(0),this.switchRole()},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t;this.roleSelect.getCurRole();this.viewStack.selectedIndex=t,this.setTitle()},e.prototype.setTitle=function(){switch(this.curSelectIndex){case 0:this.title.source="leit_biaoti";break;case 1:this.title.source="biaoti_chuanshi";break;case 2:this.title.source="biaoti_chengzhuang"}},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.onTabTouch=function(t){var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.switchRole=function(){this.panelArr[this.curSelectIndex].setRoleId(this.roleSelect.getCurRole())},__decorate([callLater],e.prototype,"switchRole",null),e}(BaseEuiView);__reflect(RHeirloomMainWin.prototype,"RHeirloomMainWin"),ViewManager.ins().reg(RHeirloomMainWin,LayerManager.UI_Main),window.RHeirloomMainWin=RHeirloomMainWin;var RHeirloomPanel=function(t){function e(){var e=t.call(this)||this;return e.currentRoleIndex=0,e.curIndex=0,e}return __extends(e,t),e.prototype.addDisplay=function(){this.curIndex=0,this.icon0.visible=!1;for(var t=0;8>t;t++)this.addTouchEvent(this["pos"+t],this.onTap);this.addTouchEvent(this.rightBtn,this.onClick),this.addTouchEvent(this.leftBtn,this.onClick),this.addTouchEvent(this.skill,this.onSkill),this.addTouchEvent(this.icon0.parent,this.onClick),this.initData()},e.prototype.removeDisplay=function(){this.removeAni()},e.prototype.onSkill=function(t){switch(t.currentTarget){case this.skill:ViewManager.ins().open(HeirloomSkillItem,this.skill.itemIcon.imgIcon.source,this.skill.skillname,this.skill.skilldesc)}},e.prototype.onClick=function(t){switch(t.target){case this.leftBtn:this.leftBtn.visible=!1,this.rightBtn.visible=!0,this.pre();break;case this.rightBtn:this.rightBtn.visible=!1,this.leftBtn.visible=!0,this.next();break;case this.icon0.parent:var e=this.currentRoleIndex,i=SubRoles.ins().getSubRoleByIndex(e);ViewManager.ins().open(HeirloomEquipTipsWin,i,this.curIndex)}},e.prototype.pre=function(){var t=this.getInitInfo();this.setHeirloom(this.curIndex,HeirloomPanel.Heir_LRBtn,t)},e.prototype.next=function(){var t=this.getInitInfo(),e=this.curIndex+1,i=t.lv?t.lv+1:t.lv+2,n=this.getSlotInfoByLv(e,i);this.setHeirloom(this.curIndex,HeirloomPanel.Heir_LRBtn,n)},e.prototype.getSlotInfoByLv=function(t,e){return GlobalConfig.HeirloomEquipConfig[t][e]},e.prototype.onTap=function(t){for(var e=this.currentRoleIndex,i=this._otherPlayerData.roleData[e],n=0;8>n;n++)switch(this["pos"+n].setSelectIconVisible(!1),t.currentTarget){case this["pos"+n]:if(this.curIndex==n){this["pos"+n].setSelectIconVisible(!0),ViewManager.ins().open(HeirloomEquipTipsWin,i,n);break}this.curIndex=n,this.setHeirloom(n,HeirloomPanel.Heir_Select),this["pos"+n].setSelectIconVisible(!0)}},Object.defineProperty(e.prototype,"otherPlayerData",{set:function(t){this._otherPlayerData=t,this.curIndex=0,this.initData()},enumerable:!0,configurable:!0}),e.prototype.setRoleId=function(t){this.currentRoleIndex=t,this.curIndex=0,this.initData()},e.prototype.getInitInfo=function(t){var e=null!=t?t:this.curIndex,i=this.currentRoleIndex,n=this._otherPlayerData.roleData[i];return n.heirloom.getInfoBySolt(e)},e.prototype.initData=function(){if(this.skin){for(var t=this.getInitInfo(),e=0;8>e;e++)this.setHeirloom(e,HeirloomPanel.Heir_Init,t);this.pos0.setSelectIconVisible(!0),this.setSuitLvIcon(),this.setPower()}},e.prototype.setHeirloom=function(t,e,i,n){var s;if(e==HeirloomPanel.Heir_Init)s=i;else if(e==HeirloomPanel.Heir_Select){if(s=this.getInitInfo(t),!s.lv){var o=GlobalConfig.HeirloomEquipConfig[t+1][1];s.skillname=o.skillname,s.skilldesc=o.skilldesc,s.skillicon=o.skillicon,s.name=o.name}}else s=i;if(s&&(this.setModel(e,t,s),this.setUI(e,t,s),this.setDesc(e,t,s)),e!=HeirloomPanel.Heir_LRBtn){if(e==HeirloomPanel.Heir_Init&&t>0&&(s=this.getInitInfo(t)),!s.lv){var o=GlobalConfig.HeirloomEquipConfig[t+1][1];s.name=o.name}this["pos"+t].selectIcon.visible=!1,this["pos"+t].data={pos:t,info:s,uplevel:n}}if(e==HeirloomPanel.Heir_Init&&0==t||e==HeirloomPanel.Heir_LRBtn||e==HeirloomPanel.Heir_Select){var o=GlobalConfig.HeirloomEquipConfig[t+1][1];s.skillicon&&(o=s),o.skillicon&&(this.skill.visible=!0,this.skill.data={pos:t,info:s,icon:o.skillicon,skillname:o.skillname,skilldesc:o.skilldesc},this.skill.cleanEff())}},e.prototype.setSuitLvIcon=function(){for(var t=this.currentRoleIndex,e=this._otherPlayerData.roleData[t],i=e.heirloom.getData(),n=0,s=!0,o=0;o<i.length;o++){var a=i[o];0==o&&(n=a.lv),!a.lv&&s&&(s=!1),a.lv<=n&&(n=a.lv)}},e.prototype.setPower=function(){var t=this.currentRoleIndex,e=this._otherPlayerData.roleData[t].hlPower;this.powerPanel.setPower(e)},e.prototype.setModel=function(t,e,i){var n,s="";if(t==HeirloomPanel.Heir_Init){if(e>0)return}else if(t==HeirloomPanel.Heir_Select&&this.curIndex!=e)return;if(this.removeAni(),n=i,n&&n.lv>0)s=n.model;else{var o=GlobalConfig.HeirloomEquipConfig[e+1][1];s=o.model}return this.modelAni?void this.modelAni.playFile(RES_DIR_EFF+s,-1):(this.modelAni=new MovieClip,this.modelAni.playFile(RES_DIR_EFF+s,-1),this.modelAni.x=this.icon0.x+this.icon0.width/2,this.modelAni.y=this.icon0.y+this.icon0.height/2,void this.icon0.parent.addChildAt(this.modelAni,this.icon0.parent.getChildIndex(this.icon0)))},e.prototype.setDesc=function(t,e,i){var n;if(t==HeirloomPanel.Heir_Init){if(e>0)return}else if(t==HeirloomPanel.Heir_Select&&this.curIndex!=e)return;n=i;var s,o=[];n&&n.lv>0?o=n.attr:(s=GlobalConfig.HeirloomEquipConfig[e+1][1],o=s.attr);for(var a=0;6>a;a++)switch(o[a].type){case AttributeType.atAttack:this.desc0.text="攻击",this.attr0.text="+"+o[a].value;break;case AttributeType.atMaxHp:this.desc1.text="生命",this.attr1.text="+"+o[a].value;break;case AttributeType.atDef:this.desc2.text="物防",this.attr2.text="+"+o[a].value;break;case AttributeType.atRes:this.desc3.text="法防",this.attr3.text="+"+o[a].value;break;case AttributeType.atCrit:case AttributeType.atCritHurt:this.desc4.text="暴击",this.attr4.text="+"+o[a].value;break;case AttributeType.cruNeiGong:case AttributeType.maxNeiGong:this.desc5.text="内功",this.attr5.text="+"+o[a].value}var r=n.slot?n.slot:s.slot,l="";switch(r){case 1:l="武器";break;case 2:l="头盔";break;case 3:l="衣服";break;case 4:l="项链";break;case 5:l="手镯";break;case 6:l="腰带";break;case 7:l="戒指";break;case 8:l="鞋子"}var h=n.attr_add?n.attr_add:s.attr_add;this.desc6.text=l+"部件所有属性",this.attr6.text="+"+h+"%",this.attr6.x=this.desc6.x+this.desc6.width+20},e.prototype.setUI=function(t,e,i){var n;if(t==HeirloomPanel.Heir_Init){if(e>0)return}else if(t==HeirloomPanel.Heir_Select){if(this.curIndex!=e)return}else if(t==HeirloomPanel.Heir_LRBtn)return void(this.itemName.text=i.name);n=i,n.expend&&n.lv?this.rightBtn.visible=!0:this.rightBtn.visible=!1,this.leftBtn.visible=!1,t==HeirloomPanel.Heir_LRBtn&&(n=this.getInitInfo()),n.skillicon?(this.skill.visible=!0,this.skill.data={pos:e,info:n,icon:n.skillicon,skillname:n.skillname,skilldesc:n.skilldesc},this.skill.cleanEff()):this.skill.visible=!1,this.itemName.text=n.name},e.prototype.removeAni=function(){DisplayUtils.removeFromParent(this.modelAni),this.modelAni=null},e}(BaseView);__reflect(RHeirloomPanel.prototype,"RHeirloomPanel"),window.RHeirloomPanel=RHeirloomPanel;var RRoleInfoPanel=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.beforeIndex=-1,e.name="角色",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.touchEnabled=!1,this.touchChildren=!0,this.groupRole.touchEnabled=!1,this.groupRoleNext.touchEnabled=!1,this.groupRole.touchChildren=!1,this.groupRoleNext.touchChildren=!1,this.equips=[];for(var t=0;t<EquipPos.MAX;t++)this.equips[t]=this["item"+t],this.equips[t].touchEnabled=!0,this.equips[t].isShowJob(!1),this.equips[t].isShowTips(!1);this.suitEff1=new MovieClip,this.suitEff1.x=this.suitImg.x,this.suitEff1.y=this.suitImg.y,this.suitEff=new MovieClip,this.suitEff5=new MovieClip,this.suitEff6=new MovieClip,this.suitEff7=new MovieClip,this.suitEff8=new MovieClip,this.suitEff9=new MovieClip,this.suitEff10=new MovieClip,this.wefbodyMc=new MovieClip,this.wefbodyMc.visible=!1,this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eBodyMCGroup.addChild(this.bodyMc),this.wingMc=new MovieClip,this.wingMc.visible=!1,this.eWingMCGroup.addChild(this.wingMc)},e.prototype.clear=function(){this.beforeIndex=-1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._otherPlayerData=t[0],this.addTouchEvent(this.roleInfoItem0,this.onClick),this.addTouchEvent(this.roleInfoItem1,this.onClick),this.addTouchEvent(this.juesexiangxi,this.onClick),this.addTouchEvent(this.heirloom,this.onClick),this.updateRing(),this.updataEquip(!1),this.updateSamsaraEquip(),this.clearChangeEff(),-1!=this.beforeIndex?this.roleChange(this.beforeIndex,this.curRole):(this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setSuit(this.curRole,this.suitImg,this.suitEff1),this.setWing()),this.beforeIndex=this.curRole,this.setDemonCir()},e.prototype.close=function(){},e.prototype.setDemonCir=function(){var t=this._otherPlayerData.roleData[this.curRole].deCirShowID;t>0?(this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.demonCirEff.addChild(this.deEff),this.deEff.playFile(""+RES_DIR_EFF+GlobalConfig.DemonCirBase[t].footEff,-1)):this.clearDemonEff()},e.prototype.clearDemonEff=function(){this.deEff&&(DisplayUtils.removeFromParent(this.deEff),this.deEff=null)},e.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole),egret.Tween.removeTweens(this.groupRoleNext),this.groupRole.x=0,this.groupRoleNext.x=580,this.groupRole.alpha=1,this.groupRoleNext.alpha=0,this.groupRoleNext.visible=!1,this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setSuit(this.curRole,this.suitImg,this.suitEff1),this.setWing(this.curRole,this.wingImg)},e.prototype.roleChange=function(t,e){if(t==e)return void this.clearChangeEff();this.groupRoleNext.visible=!0,this.setWing(t,this.wingImg),this.setWing(e,this.nextWingImg),this.setSuit(t,this.suitImg,this.suitEff1),this.setRole(t,this.bodyImg,this.weaponImg),this.setRole(e,this.nextBodyImg,this.nextWeaponImg),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(e,"nwsef",this.nsoulEff,this.suitEff6),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWeaponEffect(e,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var i=egret.Tween.get(this.groupRole),n=egret.Tween.get(this.groupRoleNext);e>t?(this.groupRoleNext.x=580,i.to({x:-580,alpha:0},600),n.to({x:0,alpha:1},600).call(this.clearChangeEff,this)):(this.groupRoleNext.x=-580,i.to({x:580,alpha:0},600),n.to({x:0,alpha:1},600).call(this.clearChangeEff,this))},e.prototype.updateRing=function(){var t=this._otherPlayerData.roleData[this.curRole].exRingsData;t[0]>0?(this.roleInfoItem0.setImgSource(0,1),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality4")):(this.roleInfoItem0.setImgSource(0,0),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality0")),t[1]>0?(this.roleInfoItem1.setImgSource(1,1),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality4")):(this.roleInfoItem1.setImgSource(1,0),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality0"))},e.prototype.updataEquip=function(t){void 0===t&&(t=!0);var e=this._otherPlayerData.roleData[this.curRole];this.setEquip(e)},e.prototype.updateSamsaraEquip=function(){for(var t=this._otherPlayerData.zhuan,e=this._otherPlayerData.level,i=1e3*t+e,n=i>=GlobalConfig.ReincarnationBase.openLevel,s=9;13>s;s++)this["item"+s].visible=n},e.prototype.setEquip=function(t){if(t){var e=t.getEquipLen();this.weaponImg.source="";for(var i=0;e>i;i++){var n=t.getEquipByIndex(i);if(t.tempVipLv=this._otherPlayerData.vipLevel,this.equips[i].setModel(t),this.equips[i].setIndex(i),this.equips[i].data=n.item,0==n.item.configID?(this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]),this.equips[i].isShowTips(!1)):this.equips[i].isShowTips(!0),i>=EquipPos.HAT&&i<=EquipPos.SHIELD)n.soulLv>0?this["item"+i].setTag("rein_soul_tag"):this["item"+i].setTag("");else if(i>=EquipPos.WEAPON&&i<=EquipPos.SHOE){var s=this["item"+i].getItemIcon();s.extreme.visible=ExtremeEquipModel.ins().getZhiZunLvByRoleID(t,i)>0}}this.powerPanel.setPower(t.power),this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)}},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var n,s=this._otherPlayerData.roleData[t],o=s.getZhuangBanNG(),a=o[0],r=o[1],l=s.getEquipByIndex(0),h=l.item.configID,u=s.getEquipByIndex(2),p=u.item.configID,c=s.getEquipByIndex(0).item.configID,d=GlobalConfig.ClientGlobalConfig.useManRes?0:s.sex;if(h>0){var g=GlobalConfig.EquipConfig[h].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),i.source=GlobalConfig.EquipWithEffConfig[c+"_"+d]?null:g+"_"+d+"_c_png"}if(p>0){var g=GlobalConfig.EquipConfig[p].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),e.source=g+"_"+s.sex+"_c_png",n=!0
}if(n||(e.source="body000_"+s.sex+"_c_png"),r>0){var f=this.getZhuangbanById(r);f.useMc>0?(i.visible=!1,this.wefbodyMc.visible=!0,this.wefbodyMc.playFile(RES_DIR_DRESS+f.res+"_"+d+"_c_m",-1),this.wefbodyMc.x=10,this.wefbodyMc.y=-40,this.wefbodyMc.scaleX=.9,this.wefbodyMc.scaleY=.9,this.soulEff.addChild(this.wefbodyMc)):(this.wefbodyMc.visible=!1,i.visible=!0,i.source=this.getZhuangbanById(r).res+"_"+d+"_c_png",DisplayUtils.removeFromParent(this.wefbodyMc))}else this.wefbodyMc.visible=!1,i.visible=!0;if(a>0){var f=this.getZhuangbanById(a);f.useMc>0?(e.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+f.res+"_"+s.sex+"_c_m",-1)):(this.bodyMc.visible=!1,e.visible=!0,e.source=f.res+"_"+s.sex+"_c_png")}else this.bodyMc.visible=!1,e.visible=!0;this.setWeaponsSuit(s)},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var n=this._otherPlayerData.roleData[t],s=n.heirloom.getSuitConfig(n);if(s&&!n.hideNeff()){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[s.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.onClick=function(t){switch(t.currentTarget){case this.juesexiangxi:ViewManager.ins().open(RoleAttrWin,this.curRole,this._otherPlayerData);break;case this.roleInfoItem0:ViewManager.ins().open(RSpecialRingWin,0,this.curRole,this._otherPlayerData);break;case this.roleInfoItem1:ViewManager.ins().open(RSpecialRingWin,1,this.curRole,this._otherPlayerData);break;case this.heirloom:ViewManager.ins().open(RHeirloomMainWin,this.curRole,this._otherPlayerData)}},e.prototype.setWing=function(t,e){void 0===t&&(t=this.curRole),void 0===e&&(e=this.wingImg),e.source=null,this.godWingEff=new MovieClip,this.godWingEff1=new MovieClip,this.wingEffGrp.removeChildren(),this.wingEffGrp1.removeChildren();var i=this._otherPlayerData.roleData[t].wingsData,n=this._otherPlayerData.roleData[t].godWingData,s=n.getSuitSum();if(s>=WingCT.GodWingMaxSlot){var o=n.getSuitLevel(),a=GlobalConfig.GodWingSuitConfig[o];this.godWingEff.parent||(this.wingEffGrp.addChild(this.godWingEff),this.wingEffGrp1.addChild(this.godWingEff1)),a.suiteff&&a.lv>=2?(this.godWingEff.visible=!0,this.godWingEff.playFile(RES_DIR_EFF+a.suiteff,-1),this.godWingEff1.visible=!0,this.godWingEff1.playFile(RES_DIR_EFF+a.suiteff,-1)):(this.godWingEff.visible=!1,this.godWingEff1.visible=!1)}var r=this._otherPlayerData.roleData[this.curRole].getZhuangBanNG()[2];if(e.visible=!0,this.wingMc.visible=!1,r>0){var l=this.getZhuangbanById(r);l.useMc?this.wingMc.playFile(RES_DIR_DRESS+l.res+"_c_m",-1):e.source=l.res+"_png",this.wingMc.visible=l.useMc>0,e.visible=!this.wingMc.visible}else i.openStatus?e.source=GlobalConfig.WingLevelConfig[i.lv].appearance+"_png":e.source=""},e.prototype.setWeaponsSuit=function(t){var e=t.weapons.weaponsId,i=t.hideWeapons();if(!i&&e){this.suitEff.x=this["sef"+t.job].x,this.suitEff.y=this["sef"+t.job].y,this.suitEff.rotation=this["sef"+t.job].rotation,this.suitEff.parent||this.soldierSoulEff.addChild(this.suitEff);var n=GlobalConfig.WeaponSoulConfig[e];this.suitEff.playFile(RES_DIR_EFF+n.inside[t.job-1],-1)}else this.suitEff.parent&&this.suitEff.parent.removeChild(this.suitEff)},e.prototype.setWeaponEffect=function(t,e,i,n,s){void 0===s&&(s=0);var o=this._otherPlayerData.roleData[t],a=o.getEquipByIndex(s).item.configID,r=0==s&&GlobalConfig.ClientGlobalConfig.useManRes?0:o.sex,l=GlobalConfig.EquipWithEffConfig[a+"_"+r];DisplayUtils.removeFromParent(n);var h=o.getZhuangBanNG(),u=n;u==this.suitEff5?0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):u=this.suitEff9:u==this.suitEff6&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff10):u=this.suitEff10),l&&(0==s&&h[1]<=0||2==s&&h[0]<=0)?(u.x=this[e+o.sex].x+l.offX-2,u.y=this[e+o.sex].y+l.offY+32,u.rotation=this[e+o.sex].rotation,u.scaleX=u.scaleY=.9,u.playFile(RES_DIR_EFF+l.inShowEff,-1),i.addChild(u),h[1]<=0&&DisplayUtils.removeFromParent(this.wefbodyMc)):DisplayUtils.removeFromParent(u)},e.prototype.showZhanling=function(t){var e=t.zhanlingID,i=t.zhanlingLevel;if(!(0>i)){this.fileName=GlobalConfig.ZhanLingBase[e].appearance,this.warMc||(this.warMc=new MovieClip,this.warMc.x=140,this.warMc.y=220,this.wsGroup.addChildAt(this.warMc,1),this.warMc.scaleX=.7,this.warMc.scaleY=.9,this.warMc.playFile(RES_DIR_EFF+this.fileName,-1),this.warMc.touchEnabled=!1);var n=GlobalConfig.ZhanLingConfig.anchorOffset[0];this.warMc.anchorOffsetX=n[0]||0,this.warMc.anchorOffsetY=n[1]||0,Timer.stop(this.startShowZhanling,this),Timer.start(200,1,this.playZhanLingAttack,this)}},e.prototype.playZhanLingAttack=function(){var t=this;if(this.warMc){var e=RES_DIR_EFF+this.fileName;this.warMc.scaleX=.7,this.warMc.scaleY=.9,this.warMc.playFile(e,1,function(){var e=RES_DIR_EFF+t.fileName;t.warMc.scaleX=.7,t.warMc.scaleY=.9,t.warMc.playFile(e,-1,null,!1),Timer.stop(t.playZhanLingAttack,t),Timer.start(2800,1,t.hideZhanling,t)},!1)}},e.prototype.hideZhanling=function(){var t=this;this.warMc&&egret.Tween.get(this.warMc).to({alpha:0},GlobalConfig.ZhanLingConfig.disappearTime||1500).call(function(){DisplayUtils.removeFromParent(t.warMc),t.warMc=null,Timer.stop(t.hideZhanling,t),Timer.start(7e3,1,t.startShowZhanling,t)})},e.prototype.startShowZhanling=function(){this.showZhanling(this._otherPlayerData)},e}(BaseView);__reflect(RRoleInfoPanel.prototype,"RRoleInfoPanel"),window.RRoleInfoPanel=RRoleInfoPanel;var RRoleSelectPanel=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="RoleSelectPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.roles=[this.role0,this.role1,this.role2]},e.prototype.open=function(){this.setCurRole(0),this.addTouchEvent(this,this.onClick)},Object.defineProperty(e.prototype,"otherPlayerData",{set:function(t){this._otherPlayerData=t,this.updateRole()},enumerable:!0,configurable:!0}),e.prototype.getCurRole=function(){return this._curRole},e.prototype.setCurRole=function(t){this._curRole=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this._curRole)},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);if(e>-1){var i=t.target;this._otherPlayerData.roleData[e]?this.setCurRole(e):i.selected=!1}},e.prototype.updateRole=function(){for(var t,e,i=0;i<this.roles.length;i++)t=this.roles[i],e=this._otherPlayerData.roleData[i],e?(t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.icon="yuanhead"+e.job+e.sex):(t.icon="",t.jobImg.visible=!1)},e.prototype.close=function(){this.removeTouchEvent(this,this.onClick)},e}(BaseView);__reflect(RRoleSelectPanel.prototype,"RRoleSelectPanel"),window.RRoleSelectPanel=RRoleSelectPanel;var RRoleWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="RRoleWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.viewStack.selectedIndex=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.otherPlayerData=t[0],this.roleSelect.otherPlayerData=this.otherPlayerData,this.nameTxt.text=this.otherPlayerData.name,this.roleSelect.open(),this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.observe(PeakedSys.ins().postSignUp,this.upLikeDt),this.roleSelect.setCurRole(0),this.setRoleInfo(),this.upLikeDt(),this.roleInfoPanel.showZhanling(this.otherPlayerData)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClick),this.roleInfoPanel.clear(),this.closeFun&&this.closeFun()},e.prototype.destoryView=function(){t.prototype.destoryView.call(this),this.roleSelect.close(),this.roleInfoPanel.close()},e.prototype.upLikeDt=function(){this.likeBtn&&(this.likeBtn.enabled=PeakedSys.ins().kideNum<GlobalConfig.PeakRaceBase.likeCount&&PeakedRedpoint.ins().redpoint2>0)},e.prototype.setRoleInfo=function(){var t=this,e=this.otherPlayerData.roleData[0],i="[S"+this.otherPlayerData.serverId+"]";this.otherPlayerData.serverId&&this.otherPlayerData.serverId!=LocationProperty.srvid||(i=""),this.nameTxt.text=this.otherPlayerData.name+i,egret.callLater(function(){t.guildNameText.x=t.nameTxt.x+t.nameTxt.textWidth+10},this),this.guildNameText.text=this.otherPlayerData.guildName?"公会："+this.otherPlayerData.guildName:"";var n=this.otherPlayerData.zhuan?this.otherPlayerData.zhuan+"转":"";this.levelText.text=""+n+this.otherPlayerData.level+"级",this.headIcon.source="head_"+e.job+e.sex;var s=this.otherPlayerData.lilianLv,o=GlobalConfig.TrainLevelConfig[s];this.jueweiIcon.source="juewei_1_"+o.type+"_png"},e.prototype.onChange=function(t){this.setView(this.roleSelect.getCurRole())},e.prototype.setView=function(t){void 0===t&&(t=0),this.roleInfoPanel.curRole=this.roleSelect.getCurRole(),this.roleInfoPanel.open(this.otherPlayerData)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);var e=ViewManager.ins().getView(UIView2);e&&e.closeNav(UIView2.NAV_ROLE);break;case this.likeBtn:PeakedSys.ins().isKf()?PeakedSys.ins().sendKFToLikes(this.otherPlayerData.id):PeakedSys.ins().sendToLikes(this.otherPlayerData.id)}},e.prototype.hideEx=function(t){switch(void 0===t&&(t=1),t){case 1:this.roleInfoPanel.juesexiangxi.visible=!1,this.roleInfoPanel.powerPanel.visible=!1,this.likeBtn&&(this.likeBtn.visible=!0);break;case 2:this.roleInfoPanel.juesexiangxi.visible=!1,this.roleInfoPanel.powerPanel.visible=!1,this.likeBtn&&(this.likeBtn.visible=!1)}},e}(BaseEuiView);__reflect(RRoleWin.prototype,"RRoleWin"),ViewManager.ins().reg(RRoleWin,LayerManager.UI_Main),window.RRoleWin=RRoleWin;var RSpecialRingWin=function(t){function e(){var e=t.call(this)||this;return e.ringLv=0,e.skinName="RingTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.iconMc=new MovieClip,this.iconMc.x=170,this.iconMc.y=160,this.gainList0.itemRenderer=RingGainItem,this.btnUse.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],null==t[1]&&(t[1]=0),this._otherPlayerData=t[2],this.roleSelect.setCurRole(t[1]),this.iconMc&&!this.iconMc.parent&&this.mcGroup.addChild(this.iconMc),this.addTouchEvent(this.colorCanvas0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addChangeEvent(this.roleSelect,this.roleChange),this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this);var i=GlobalConfig.ExRingConfig[this.index],n=GlobalConfig.GainItemConfig[i.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(n.gainWay),this.roleChange()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.iconMc)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&GameGuider.guidance(e[1],e[2],!0)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this)}},e.prototype.showIcon=function(){var t=this.index?"tjiehs":"tjiemb";this.iconMc.playFile(RES_DIR_EFF+t,-1)},e.prototype.roleChange=function(t){void 0===t&&(t=!1);var e=this.roleSelect.getCurRole();this.ringLv=this._otherPlayerData.roleData[e].getExRingsData(this.index),this.showIcon();var i=GlobalConfig.ExRingConfig[this.index],n=(GlobalConfig["ExRing"+this.index+"Config"][0],GlobalConfig["ExRing"+this.index+"Config"][1]);if(0==this.ringLv?(this.currentState="lock",this.tips.source="tjweijihuo"):(this.currentState="actived",this.tips.source="tjyijihuo"),n){for(var s="",o=0,a=0,r=0,l="",h=0;h<n.attrAward.length;h++)a=n.attrAward[h].type,15!=a&&13!=a&&(s=AttributeData.getAttrStrByType(a),o=n.attrAward[h].value,s.length<3&&(s=AttributeData.inserteBlank(s,7)),this["attr"+r].text=s+"：",a>1&&9>a?l=7==a||8==a?o/100+"%":o.toString():(a>12&&15>a||a>15)&&(l=a==AttributeType.atCritEnhance?o/100+150+"%":o/100+"%"),this["value"+r].text=l,r++);var u=BagCT.getAttrPower(n.attrAward);this.powerPanel.setPower(u),this.powerPanel.setMcVisible(!1),this.validateNow();var p=GlobalConfig.ItemConfig[i.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(p.desc),this.nameLabel.text=""+i.name}},e}(BaseEuiView);__reflect(RSpecialRingWin.prototype,"RSpecialRingWin"),ViewManager.ins().reg(RSpecialRingWin,LayerManager.UI_Main),window.RSpecialRingWin=RSpecialRingWin;var RThunderEquipPanel=function(t){function e(){var e=t.call(this)||this;return e.lockImages=[],e.name="雷霆",e}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this.centerPic,this.onClick),this.firstUpdate=!0,this.currEquipIndex=0,this.updateView()},e.prototype.removeDisplay=function(){},Object.defineProperty(e.prototype,"otherPlayerData",{set:function(t){this._otherPlayerData=t,this.updateView()},enumerable:!0,configurable:!0}),e.prototype.setRoleId=function(t){this.currRoleIndex=t,this.updateView()},e.prototype.updateView=function(){if(this.totalPower=0,this.nowMinLevel,this.skin){var t=this.getThundersByRoleId(this.currRoleIndex),e=GlobalConfig.LeitingEquipConf,i=!1;this.nowMinLevel=0;for(var n=0;12>n;n++){var s=t[n],o=this["equip"+n],a=o.itemIcon;if(this.firstUpdate&&(o.name=""+n,a.imgJob.visible=!1,this.lockImages[n]||(this.lockImages[n]=new eui.Image,this.lockImages[n].source="ltsuo",o.addChild(this.lockImages[n])),this.addTouchEvent(o,this.onClick)),this.lockImages[n].visible=!1,o.level.text="",o.plus.text="",t[n].itemConfig)if(s.configID){this["equipStar"+n]||(this["equipStar"+n]=new eui.Image,o.addChildAt(this["equipStar"+n],2),this["equipStar"+n].left=5,this["equipStar"+n].top=5);var r=this.getThundersLvByRoleId(this.currRoleIndex)[n];r&&(o.plus.text="+"+r),this["equipStar"+n].source="leit"+e[s.configID].level+"x",a.imgIcon.source=GlobalConfig.ItemConfig[s.configID].icon+"_png",a.imgBg.source="quality6",o.level.text=s.itemConfig.name,this["mc"+n]||(this["mc"+n]=new MovieClip,this["mc"+n].x=39,this["mc"+n].y=38,o.addChildAt(this["mc"+n],1)),this["mc"+n].playFile(RES_DIR_EFF+"leitkuang",-1),this.totalPower+=s.point,8>n&&(this.nowMinLevel?this.nowMinLevel=Math.min(e[s.configID].level,this.nowMinLevel):this.nowMinLevel=e[s.configID].level)}else a.imgIcon.source="lt"+(n>9?n:"0"+n),this.cleanEff(n),8>n&&(i=!0);else 8>n&&(i=!0),a.imgIcon.source="lt"+(n>9?n:"0"+n),this.cleanEff(n);if(8>n){var l=this.getThundersLvByRoleId(this.currRoleIndex)[n];l&&(this.totalPower+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(GlobalConfig.LeitingEquipSlotConf[l])))}}i&&(this.nowMinLevel=0);for(var h=GlobalConfig.LeitingEquipStarSuitConf,u=this.nowMinLevel<3?3:this.nowMinLevel,p=h[u][8].skill,n=0;3>n;n++){var c=this["skill_"+n];c.name=n+"",this["skill"+n].source=1e3*Math.floor(p[n][0]/1e3)+"_png",this["blackImg"+n].visible=this.nowMinLevel<p[n][1],this.firstUpdate&&this.addTouchEvent(c,this.onClick)}this.updateElse(),this.firstUpdate=!1}},e.prototype.updateElse=function(){this.totalPower+=this.getThunderSuitPower(this.currRoleIndex),this.powerPanel.setPower(this.totalPower),this.mc||(this.mc=new MovieClip,this.centerPic.addChild(this.mc)),this.mc.playFile(RES_DIR_EFF+("lt"+(this.currEquipIndex>9?this.currEquipIndex:"0"+this.currEquipIndex)),-1)},e.prototype.getThunderSuitPower=function(t){for(var e=this._otherPlayerData.roleData[t],i=[],n=[3,4,5,6,7],s=GlobalConfig.LeitingEquipConf,o=this.getThundersByRoleId(this.currRoleIndex),a=function(t){if(o[t].itemConfig){var a=e.thunderData[t];if(a.configID){var r=s[a.configID].level;if(r>=3)for(var l=function(t){r>=t&&(i[t]||(i[t]=0),i[t]++)},h=0,u=n;h<u.length;h++){var p=u[h];l(p)}}}},r=0;8>r;r++)a(r);for(var l={2:0,4:0,6:0,8:0},h=0;h<i.length;h++){var u=i[h];u&&(8==u&&l[8]<h&&(l[8]=h),u>=6&&l[6]<h&&(l[6]=h),u>=4&&l[4]<h&&(l[4]=h),u>=2&&l[2]<h&&(l[2]=h))}for(var p=GlobalConfig.LeitingEquipStarSuitConf,c=0,d=0;4>d;d++){var g=2*d+2;l[g]&&(c+=p[l[g]][g].power)}return c},e.prototype.cleanEff=function(t){this["mc"+t]&&(DisplayUtils.removeFromParent(this["mc"+t]),this["mc"+t]=null),this["equipStar"+t]&&(DisplayUtils.removeFromParent(this["equipStar"+t]),this["equipStar"+t]=null)},e.prototype.getThundersByRoleId=function(t){var e=this._otherPlayerData.roleData[t];return e?e.thunderData:[]},e.prototype.getThundersLvByRoleId=function(t){var e=this._otherPlayerData.roleData[t];return e?e.thunderEquipLv:[]},e.prototype.onClick=function(t){switch(t.currentTarget){case this.skill_0:case this.skill_1:case this.skill_2:ViewManager.ins().open(ThunderSkillTipsWin,this.currRoleIndex,this.nowMinLevel,t.currentTarget.name,this._otherPlayerData.roleData[this.currRoleIndex]);break;case this.centerPic:default:var e=this.currEquipIndex;if(this.centerPic!=t.currentTarget&&(this.currEquipIndex=+t.currentTarget.name),e==this.currEquipIndex){var i=this.getThundersByRoleId(this.currRoleIndex);null!=i[this.currEquipIndex].itemConfig&&(this.currEquipIndex<8&&""==this["equip"+e].level.text?ViewManager.ins().open(ThunderChooseEquipWin,this.currRoleIndex,e):ViewManager.ins().open(ThunderEquipTipsWin,this.currRoleIndex,e,null,this._otherPlayerData.roleData[this.currRoleIndex]))}else{this.getThundersByRoleId(this.currRoleIndex);this.updateView()}}},e}(BaseView);__reflect(RThunderEquipPanel.prototype,"RThunderEquipPanel"),window.RThunderEquipPanel=RThunderEquipPanel;var GameApp=function(){function t(){this.inited=!1}return t.ins=function(){return this._ins=this._ins||new t,this._ins},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n;return __generator(this,function(s){switch(s.label){case 0:return this.inited?[2]:(this.inited=!0,LocationProperty.init(),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){SoundUtil.enable=!1},egret.lifecycle.onResume=function(){SoundUtil.enable=SysSetting.ins().getBool(SysSetting.SOUND_EFFECT)},[4,RES.getResByUrl(MAP_DIR+"maps.json")]);case 1:t=s.sent(),GameMap.init(t);for(e in System)System[e]();return GlobalConfig.init(),ResourceMgr.ins().setValue(GlobalConfig.ClientGlobalConfig.resourceMax),console.log("egret.Capabilities.supportedCompressedTexture",egret.Capabilities.supportedCompressedTexture),i=function(t){return t&&!(t.url.indexOf("map/")>-1||t.url.indexOf("res/model/")>-1||t.url.indexOf("res/skilleff/")>-1||t.url.indexOf("image/item/")>-1)},(urlParam.isMiniGame&&1==GlobalConfig.ClientGlobalConfig.miniktx||!urlParam.isMiniGame&&1==GlobalConfig.ClientGlobalConfig.ktx)&&egret.Capabilities&&egret.Capabilities.supportedCompressedTexture&&egret.Capabilities.supportedCompressedTexture.etc1&&(n=RES.processor._map.image,RES.processor.map("pack.etc1.ktx",new PackETC1KTXProcessor),RES.processor.map("image",new CompressTextureProcessor(i,!0,n)),console.log("openKTX",egret.Capabilities.supportedCompressedTexture.etc1)),win.openCall=function(){GameLogic.ins().postViewOpen(0)},win.closeCall=function(){GameLogic.ins().postViewOpen(1)},[2]}})})},t.prototype.postLoginInit=function(){},t.prototype.postZeroInit=function(){},__decorate([post()],t.prototype,"postLoginInit",null),__decorate([post()],t.prototype,"postZeroInit",null),t}();__reflect(GameApp.prototype,"GameApp"),window.GameApp=GameApp;var RechargeRewardData=function(){function t(){}return t}();__reflect(RechargeRewardData.prototype,"RechargeRewardData"),window.RechargeData=RechargeData;var ChargeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChargeItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.yuanbaoImg.source=this.data.icon;var t=this.data.cash/100;LocationProperty.isFromQQBLUE?(this.BlueVippay.text="￥"+t,this.eLab.visible=this.eGroup.visible=!0,t*=Recharge.getChannelMulti()):this.eLab.visible=this.eGroup.visible=!1,urlParam.showDiamond?this.pay.text=10*t+"钻":this.pay.text="￥"+t;var e=Recharge.ins().getOrderByIndex(this.itemIndex+1);e?this.eBl.text=this.data.amount+"":this.eBl.text=this.data.sa+"",this.give.visible=!e},e}(BaseItemRender);__reflect(ChargeItemRenderer.prototype,"ChargeItemRenderer"),window.ChargeItemRenderer=ChargeItemRenderer;var ChargeTipsWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="ChargeTipsSkin"},e}(BaseEuiView);__reflect(ChargeTipsWin.prototype,"ChargeTipsWin"),ViewManager.ins().reg(ChargeTipsWin,LayerManager.UI_Tips),window.ChargeTipsWin=ChargeTipsWin;var Recharge1Win=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectDay=0,e._sn_="FirstChargeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listDP=new eui.ArrayCollection,this.elist.itemRenderer=ItemBase,this.elist.dataProvider=this.listDP,this.eBtnList.itemRenderer=RechargeBtnRenderer,this.eBtnList.dataProvider=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.ChongZhiBaseConfig.activitys)),this.configs=this.getFirstRechargeConfig(),this.btnArr=[];for(var t=0;t<this.configs.length;t++)this.btnArr.push(this["chong"+t]);var e=[];for(var t in GlobalConfig.FirstRechargeClientConfig)e.push(+t-1);this.eTab.dataProvider=new eui.ArrayCollection(e),this.eff=new MovieClip,this.eff.x=this.buyed.x+77,this.eff.y=this.buyed.y+32,this.eff.scaleX=1.15,this.eff.scaleY=1.5,this.eff.touchEnabled=!1,urlParam.showDiamond&&this.addChild(CommonUtils.getDimond()),this.eGroup.visible=LocationProperty.isFromQQBLUE},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isTSServer)return!1;if(LocationProperty.isIosTS)return!1;if(urlParam.nofr)return ViewManager.ins().open(RechargeWin),!1;if(!Recharge.ins().isOpenIosRecharge)return!1;if(!OpenSystem.ins().checkSysOpen(SystemType.FIRSTCHARGE))return TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.FIRSTCHARGE)),!1;var i=Recharge.ins().getRechargeData(0);if(!t[0]){if(2==i.num){var n=Recharge.ins().getCurDailyRechargeIsAllGet();return n?ViewManager.ins().open(RechargeWin):ViewManager.ins().open(Recharge2Win),!1}return!0}return 2==i.num?(ViewManager.ins().open(t[0][0]),!1):!0},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyed,this.onTouch),this.addTouchEvent(this.eBtn0,this.onTouch);for(var i=0;i<this.btnArr.length;i++)this.addTouchEvent(this.btnArr[i],this.onTouch);this.addChangeEvent(this.eBtnList,this.onBtnListChange),this.addTouchEvent(this.eTab,this.onClickTab),this.observe(Recharge.ins().postUpdateRechargeEx,this.onUpdateRechargeEx);var n=0;for(var s in this.configs){var o=this.configs[s],a=void 0;urlParam.showDiamond&&(a=10*+o.paydesc.substring(0,o.paydesc.indexOf("元"))+"钻石");var r=Recharge.getChannelMulti();a=+o.paydesc.substring(0,o.paydesc.indexOf("元"))*r+"元",this.btnArr[n].rmb.text=LocationProperty.isFromQQBLUE?"":a,this.btnArr[n].yuanbao.text=o.payReturn,this.btnArr[n].money=o.pay,this.btnArr[n].rid=o.rid,this.btnArr[n].lz.text=LocationProperty.isFromQQBLUE?"原价:"+.0125*o.pay+"元\n蓝钻:"+o.pay/100+"元":"",n++}this._data=Recharge.ins().getRechargeData(Recharge.ins().recharge_type);for(var l=CommonUtils.getObjectLength(GlobalConfig.FirstRechargeClientConfig),h=0;l>h;h++){var u=this._data.firstRewardStateByDay(h);if(2!=u){this.eTab.selectedIndex=this.selectDay=h;break}}this.setWinData(),this.updateList()},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.eff),DisplayUtils.removeFromParent(this.mc),egret.Tween.removeTweens(this),this.closeFun&&this.closeFun()},e.prototype.onBtnListChange=function(){var t=this.eBtnList.selectedItem;t&&t.length>1&&ViewManager.ins().open(t[1],t[2]||0)&&ViewManager.ins().close(this)},e.prototype.onClickTab=function(){this.selectDay!=this.eTab.selectedIndex&&(this.selectDay=this.eTab.selectedIndex,this.updateList(),this.setWinData())},e.prototype.onUpdateRechargeEx=function(){var t=this._data.firstRewardStateByDay(this.selectDay);if(2==t){var e=CommonUtils.getObjectLength(GlobalConfig.FirstRechargeClientConfig);this.selectDay+1<e&&(this.selectDay++,this.eTab.selectedIndex=this.selectDay)}this.updateList(),this.setWinData()},e.prototype.updateList=function(){var t=SubRoles.ins().getSubRoleByIndex(0).job;this.listDP.source=this.getRechargeRewardDatas(t,this.selectDay)},e.prototype.getFirstRechargeConfig=function(){var t=urlParam&&urlParam.apptype&&!isNaN(parseInt(urlParam.apptype))?parseInt(urlParam.apptype):1,e=[];for(var i in GlobalConfig.FirstRechargeConfig){var n=GlobalConfig.FirstRechargeConfig[i],s=n.appType;s&&-1!=s.indexOf(t)&&e.push(n)}return e.sort(function(t,e){return t.pay<e.pay?-1:1}),e},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.eBtn0:PFVipCT.channelVipPay();break;case this.buyed:if(this.selectDay>this._data.firstPayDay())return void TipsCT.ins().showTips("首充后第"+(this.selectDay+1)+"天才可领取");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);Recharge.ins().changeRecharge1Data(this.selectDay+1);break;default:if(urlParam.isWXiOS&&8==+urlParam.apptype)return void ViewManager.ins().open(SuperVipWin);if(~this.btnArr.indexOf(t.currentTarget)){var e=+t.currentTarget.money,i=+t.currentTarget.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(e,ShowRechargeType.Type_FirstRecharge):Recharge.ins().sendPayOrder(i)}}},e.prototype.setWinData=function(t){var i=t?t.type:Recharge.ins().recharge_type;this._data=Recharge.ins().getRechargeData(i),this.buyed.enabled=!0,this.eTipsGroup.visible=0==this.selectDay,this.eTipsGroup1.visible=1==this.selectDay,this.eTipsGroup2.visible=2==this.selectDay;var n=GlobalConfig.FirstRechargeClientConfig[this.selectDay+1][1];if(this.eImg.source=n.weaponshow?n.weaponshow:"",DisplayUtils.removeFromParent(this.mc),this.eBtnGrp.visible=this._data.num>0,this.warn.visible=!this.eBtnGrp.visible,n.weaponEff&&this["eMc"+this.selectDay]&&(this.mc=new MovieClip,this["eMc"+this.selectDay].addChild(this.mc),this.mc.playFile(RES_DIR_EFF+(""+n.weaponEff),-1)),this._data.num){if(1==this._data.num)if(this.unbuy.visible=!1,this.buyed.visible=!0,this.selectDay<=this._data.firstPayDay()){var s=this._data.firstRewardStateByDay(this.selectDay);2==s?(this.buyed.label="已领取",this.buyed.enabled=!1,this.eff.stop(),DisplayUtils.removeFromParent(this.eff)):(this.buyed.label="领取充值礼包",this.eff.parent||(this.buyGroup.addChild(this.eff),this.eff.x=this.buyed.width/2,this.eff.y=this.buyed.height/2,this.eff.touchEnabled=this.buyGroup.touchEnabled=!1,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)))}else this.buyed.label="充值第"+(this.selectDay+1)+"天领取",this.eff.stop(),DisplayUtils.removeFromParent(this.eff);else if(2==this._data.num){this.buyed.visible=!1,this.unbuy.visible=!1,DisplayUtils.removeFromParent(this.eff);var o=egret.Tween.get(this);o.wait(1e3).call(function(){ViewManager.ins().close(e);var t=RareAnimalCT.ins();t.isBackShow&&(t.isBackShow=!1,ViewManager.ins().open(RareAnimalResultWin,t.fbType,t.attackTimes,t.teamInfo))})}}else this.buyed.visible=!1,this.unbuy.visible=!0,DisplayUtils.removeFromParent(this.eff)},e.prototype.getRechargeRewardDatas=function(t,e){var i=GlobalConfig.FirstRechargeClientConfig[e+1];for(var n in i)if(i[n].job==t)return i[n].RechargeRewardData;return null},e}(BaseEuiView);__reflect(Recharge1Win.prototype,"Recharge1Win"),window.Recharge1Win=Recharge1Win,ViewManager.ins().reg(Recharge1Win,LayerManager.UI_Main);var Recharge2Win=function(t){function e(){var e=t.call(this)||this;return e.skinName="DailyChargeSkin2",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.goUpBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(Recharge.ins().postUpdateRechargeEx,this.setWinData),this.setWinData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.bgClose:ViewManager.ins().close(e);break;case this.goUpBtn:"领取大礼包"==this.goUpBtn.label?this.currData&&this.getReward():"充点小钱玩玩"==this.goUpBtn.label&&ViewManager.ins().open(RechargeWin)}},e.prototype.getReward=function(){this.playGet(void 0,this.currData),Recharge.ins().getDayReward(this.currData.index)},e.prototype.playGet=function(t,e){for(var i=ViewManager.ins().getView(UIView2),n=i.getBagBtn(),s=n.x-50,o=n.y-this.mainGroup.y-110,a=function(t){var e=new ItemBase;e.data=r["item"+(t+1)].data,e.x=r["item"+(t+1)].x,e.y=r["item"+(t+1)].y,r["item"+(t+1)].parent.addChild(e);var i=egret.Tween.get(e);i.to({x:s,y:o,scaleX:0,scaleY:0},500).call(function(){DisplayUtils.removeFromParent(e)})},r=this,l=0;4>l;l++)a(l)},e.prototype.setWinData=function(){var t=Recharge.ins().getRechargeData(0),e=Recharge.ins().getCurRechargeConfig();this.currData=null;var i=Number.MAX_VALUE;for(var n in e){var s=t.isAwards>>e[n].index&1;!s&&i>e[n].pay&&(i=e[n].pay,this.currData=e[n])}if(this.currData||(this.currData=e[0]),this.currData){var o=this.currData.pay-t.curDayPay;o>0?this.goUpBtn.label="充点小钱玩玩":this.goUpBtn.label="领取大礼包",this.setItem(),this.totalPower.text=(0>o?0:o)+"",this.totalPower.scaleX=.8}},e.prototype.setItem=function(){this.listCon.removeChildren();for(var t=0;t<this.currData.awardList.length;t++){var e=this.currData.awardList[t],i=this["item"+(t+1)];i.data=e,this.listCon.addChild(i)}},e}(BaseEuiView);__reflect(Recharge2Win.prototype,"Recharge2Win"),ViewManager.ins().reg(Recharge2Win,LayerManager.UI_Popup),window.Recharge2Win=Recharge2Win;var RechargeBtnRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="MainButtonSkin",e.redPoint.visible=!1,e.selectIcon.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.iconDisplay.source=t[0]}},e}(BaseItemRender);__reflect(RechargeBtnRenderer.prototype,"RechargeBtnRenderer"),window.RechargeBtnRenderer=RechargeBtnRenderer;var RechargeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.barbc=new ProgressBarEff,e._sn_="ChargeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(Recharge.ins().postUpDataItem,this.refushInfo)},e.prototype.skinComplete=function(){this.list.itemRenderer=ChargeItemRenderer,this.scrollBar.viewport=this.list,LocationProperty.isFromQQBLUE?this.scrollBar.top+=150:this.eGroup.visible=!1,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.barbc.setWidth(340),this.barbc.x=80,this.barbc.y=12,this.topGroup.addChild(this.barbc),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.vipBtn,this.onTap),this.addTouchEvent(this.eBtn,this.onTap),this.addTouchEvent(this.eBtn2,this.onTap),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListTap,this),this.barbc.reset(),this.refushInfo(),urlParam.showDiamond&&this.addChild(CommonUtils.getDimond())},e.prototype.onListTap=function(t){var e=t.item,i=e.rid;GlobalConfig.ClientGlobalConfig.oldRecharge||!i?Recharge.ins().showReCharge(e.amount):Recharge.ins().sendPayOrder(i)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(e);break;case this.vipBtn:ViewManager.ins().open(VipWin);break;case this.eBtn:case this.eBtn2:PFVipCT.channelVipPay()}},e.prototype.updateList=function(){var t=urlParam&&urlParam.apptype&&!isNaN(parseInt(urlParam.apptype))?parseInt(urlParam.apptype):1,e=GlobalConfig.RechargeItemsConfig,i=[];for(var n in e){var s=e[n].appType,o=e[n].funId;o||-1==s.indexOf(t)||i.push(e[n])}i.sort(function(t,e){return t.amount<e.amount?-1:1}),this.listData.replaceAll(i)},e.prototype.refushInfo=function(){this.updateList(),this.setView()},e.prototype.setView=function(){var t=Actor.vip,e=VipCT.ins().getVipCfg(t+1),i=0,n="",s=VipCT.ins().exp;VipCT.ins().vipIsMax(Actor.vip)?(n=VipCT.getVipStr()+"等级已满",this.barbc.max()):(i=e.needYb-s,n="再充值|C:0xFFAA24&T:"+i+"元宝|成为|C:0xFFAA24&T:"+VipCT.getVipStr(t+1,!0)+"|",this.barbc.setData(s,e.needYb)),this.vipValue.text=t+"",this.tipsText.textFlow=TextFlowMaker.generateTextFlow(n)
},e.openCheck=function(){return LocationProperty.isTSServer?!1:LocationProperty.isIosTS?!1:urlParam.isWXiOS&&8==+urlParam.apptype?(ViewManager.ins().open(SuperVipWin),!1):Recharge.ins().isOpenIosRecharge?!0:!1},e}(BaseEuiView);__reflect(RechargeWin.prototype,"RechargeWin"),window.RechargeWin=RechargeWin,ViewManager.ins().reg(RechargeWin,LayerManager.UI_Popup);var RecordScreenCT=function(t){function e(){var e=t.call(this)||this;return e.videoUrl="",e.isRecording=!1,e.isShare=!1,e.isCD=!1,e.recordingtime=0,e.startTime=0,e.recordMaxtime=15,e.openCheck()&&e.observe(GameLogic.ins().postEnterMap,e.onChangeScene),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.openCheck=function(){return urlParam.appid==PlatFormID.ZI_JIE},e.prototype.initLogin=function(){PfActivity.ins().sendSuc||e.ins().postShareSuc()},e.prototype.shareVedio=function(){if(this.isShare=!1,!this.videoUrl||""==this.videoUrl)return void TipsCT.ins().showCenterTips("分享视频失败。");var t={videoPath:this.videoUrl};window.platform.shareVedio({channel:"video",extra:t,success:function(){console.log("分享视频成功"),e.ins().postShareSuc()},fail:function(t){console.log("分享视频失败")}})},e.prototype.postShareSuc=function(){},e.prototype.startRecord=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.isShare=!1,this.isCD?[2]:(this.isCD=!0,this.recordingtime=0,[4,window.platform.startRecord()]);case 1:return t=e.sent(),t?(this.postChangeState(!0),this.startTime=egret.getTimer(),Timer.has(this.recordingCB,this)||Timer.start(1e3,0,this.recordingCB,this)):this.startTime=0,Timer.start(3e3,1,this.postChangeCD,this),[2]}})})},e.prototype.recordingCB=function(){this.recordingtime=Math.floor((egret.getTimer()-this.startTime)/DateUtils.MS_PER_SECOND),this.startTime>0&&this.recordingtime>=this.recordMaxtime&&e.ins().stopRecord(),this.postRecording()},e.prototype.postRecording=function(){},e.prototype.postChangeCD=function(){this.isCD=!1},e.prototype.stopRecord=function(t){return void 0===t&&(t=!1),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.isShare=!1,this.isCD?[2]:(this.isCD=!0,0==this.startTime||egret.getTimer()-this.startTime<3e3||!this.isRecording?(TipsCT.ins().showTips("录屏失败"),[2]):[3,1]);case 1:return Timer.stop(this.recordingCB,this),t=this,[4,window.platform.stopRecord()];case 2:t.videoUrl=e.sent(),this.postShare(),e.label=3;case 3:return this.postChangeState(!1),this.postChangeCD(),[2]}})})},e.prototype.postShare=function(){this.isShare=!0,this.isCD||(this.isCD=!0,this.postChangeState(!1))},e.prototype.shareRecord=function(){this.videoUrl&&""!=this.videoUrl?this.shareVedio():TipsCT.ins().showTips("录屏失败。"),this.postChangeState(!1),this.postChangeCD()},e.prototype.postChangeState=function(t){this.isRecording=t},e.prototype.onChangeScene=function(){this.openCheck()&&!ViewManager.ins().isShow(RecordScreenWin)&&ViewManager.ins().open(RecordScreenWin)},__decorate([post()],e.prototype,"postShareSuc",null),__decorate([post()],e.prototype,"postRecording",null),__decorate([post()],e.prototype,"postChangeCD",null),__decorate([post()],e.prototype,"postShare",null),__decorate([post()],e.prototype,"postChangeState",null),e}(BaseSystem);__reflect(RecordScreenCT.prototype,"RecordScreenCT"),System.RecordScreenCT=function(){return RecordScreenCT.ins()},window.RecordScreenCT=RecordScreenCT;var RecordScreenWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="BtnFenXianSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postEnterMap,this.update),this.observe(PfActivity.ins().postScreenRecording,this.updateTips),this.observe(RecordScreenCT.ins().postRecording,this.onRecording),this.observe(RecordScreenCT.ins().postChangeState,this.update),this.observe(RecordScreenCT.ins().postChangeCD,this.update),this.update()},e.prototype.update=function(){this.onChangeBtn(),this.onRecording()},e.prototype.onChangeBtn=function(){this.eRecordBtn.enabled=!RecordScreenCT.ins().isCD,this.eRecordBtn.icon="luping_"+(RecordScreenCT.ins().isRecording?2:RecordScreenCT.ins().isShare?3:1)+"_png",this.updateTips()},e.prototype.updateTips=function(){this.eShareTips.visible=!(PfActivity.ins().shareNum>=GlobalConfig.RecordShareRewardConfig.shareCount)},e.prototype.onRecording=function(){var t=RecordScreenCT.ins();t.isRecording?this.eLab.text="录屏中（"+(RecordScreenCT.ins().recordMaxtime-t.recordingtime)+"s）":this.eLab.text=""},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return RecordScreenCT.ins().openCheck()},e.prototype.onClick=function(t){var e=RecordScreenCT.ins();switch(t.target){case this.eRecordBtn:e.isRecording?e.stopRecord():e.isShare?e.shareRecord():e.startRecord()}},__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(RecordScreenWin.prototype,"RecordScreenWin"),window.RecordScreenWin=RecordScreenWin,ViewManager.ins().reg(RecordScreenWin,LayerManager.UI_Main);var RenameWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="NameChangeSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.input.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.updateInputText=function(t){this.input.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.input.text&&(this.input.text="")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.input.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(e);break;case this.sureBtn:if(0==this.input.text.length)TipsCT.ins().showTips("您尚未输入名字！");else if(null!=BagCT.ins().getBagItemById(ItemConst.RENAME)){if(!RoleMgr.ins().checkName(this.input.text))return;GameLogic.ins().sendRename(this.input.text)}break;case this.chatGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.input.text+""||"")}},e}(BaseEuiView);__reflect(RenameWin.prototype,"RenameWin"),ViewManager.ins().reg(RenameWin,LayerManager.UI_Popup),window.RenameWin=RenameWin;var ReportData=function(){function t(){}return t.qqCheckChat=function(e,i){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(s){return[2,new Promise(function(s){return __awaiter(n,void 0,void 0,function(){var n,o,a,r;return __generator(this,function(l){switch(l.label){case 0:return[4,t.sendText(e,i)];case 1:return n=l.sent(),"error"==n?(TipsCT.ins().showCenterTips("输入存在非法敏感词!"),[2]):(o=JSON.parse(n),a=o.text_result_list_[0].check_ret_,r=o.text_result_list_[0].result_text_,s({ret:a,result_text:r}),[2])}})})})]})})},t.sendText=function(t,e){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return[4,sendHttp("https://pass.h5eco.com/pass_a/jdk/psma/7000178p/7000178/uicFilter?passOpenId="+urlParam.openId+"&text="+t+"&text_scene="+e)];case 1:return i=n.sent(),[2,i]}})})},t.checkChat=function(t,e,i){return new Promise(function(n){if(!ChatCT.ins().isCanSpeak())return void n({result:"",content:""});var s=window.checkChat;if(!s){var o="success",a=t;return void n({result:o,content:a})}s({server_id:GameServer.serverID,server_name:"",chat_type:1,chat_channel:e,chat_content:t,sender_openId:urlParam.openId,sender_level:1e3*ZsCT.ins().lv+Actor.level,sender_name:Actor.myName,sender_vip_level:Actor.vip,receiver_openId:i&&i.openId,receiver_name:i&&i.name,receiver_appId:i&&i.appId,open_time:GameServer.serverOpenDay},function(t){var e=t.result,i=(t.code,t.content),s=t.failMsg;"self"==e||"success"==e?n({result:e,content:i}):TipsCT.ins().showCenterTips(s||"未配置提示")})})},t.chackParty=function(t){return new Promise(function(e){var i=window.checkParty;return i?void i({server_id:GameServer.serverID,server_name:"",op_type:1,name:Guild.ins().guildName,leader_rid:Guild.ins().guildMaster&&Guild.ins().guildMaster.roleID,leader_name:Guild.ins().guildMaster&&Guild.ins().guildMaster.name,vice_leader_rid:Guild.ins().deputyMaster&&Guild.ins().deputyMaster.roleID,vice_leader_name:Guild.ins().deputyMaster&&Guild.ins().deputyMaster.roleID,edit_rid:Actor.actorID,edit_name:Actor.myName,notice:t},function(t){var i=t.result,n=t.code,s=t.content;"success"==i?e(s):TipsCT.ins().showCenterTips("内容涉及敏感词或被禁止该操作! "+n)}):void e(t)})},t.report=function(t,e){switch(t){case"entergame":t="login";break;case"createRole":t="create_role";break;case"levelup":break;case"power":t="power";break;default:t=""}if(t){var i=window.reprot;i&&i({action:t,app_openid:"",server:urlParam.srvid,serverName:"",openId:urlParam.openId,nickName:Actor.myName,roleName:Actor.myName,openKey:urlParam.openKey,level:Actor.level||1,relifeLevel:ZsCT.ins().lv||0,power:Actor.power,vip:Actor.vip,gangName:Guild.ins().guildName,balance:Actor.yb})}},t.ERROR="error",t}();__reflect(ReportData.prototype,"ReportData"),window.ReportData=ReportData;var EquipCT=function(t){function e(){var e=t.call(this)||this;return e.thunderUnlockIndex=[],e.thunderEquipLv=[],e.isFind=!1,e.sysId=PackageID.Equip,e.regNetMsg(1,e.doUpDataEquip),e.regNetMsg(2,e.postSmeltEquipComplete),e.regNetMsg(3,e.doGrewupEquipResult),e.regNetMsg(4,e.doGrewupEquipResult),e.regNetMsg(5,e.postAddSpirit),e.regNetMsg(7,e.postAddSoul),e.regNetMsg(8,e.postZhiZunUpgrade),e.regNetMsg(9,e.postThunderEquipUpdate),e.regNetMsg(11,e.postThunderEquipData),e.thunderEquipLv[0]=[],e.thunderEquipLv[1]=[],e.thunderEquipLv[2]=[],e.regNetMsg(12,e.postThunderEquipLv),e.regNetMsg(14,e.postThunderUnlock),e.regNetMsg(19,e.postThunderAwakeLevel),e.regNetMsg(20,e.postEquipAwakeLevel),e.regNetMsg(24,e.postEquipLegenLevel),e.regNetMsg(25,e.postPowerEquip),e.regNetMsg(26,e.postPowerEquipUpdate),e.regNetMsg(27,e.postPowerEquipQucheUpDate),e.regNetMsg(29,e.postPowerEquipDecompose),e.observe(BagCT.ins().postItemChange,e.delayCheckHaveCan),e.observe(BagCT.ins().postItemAdd,e.delayCheckHaveCan),e.observe(BagCT.ins().postItemDel,e.delayCheckHaveCan),e.observe(BagCT.ins().postHuntStore,e.delayCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.delayCheckHaveCan),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postThunderEquipUpdate=function(t){var e=t.readShort(),i=t.readShort(),n=new ItemData;n.parser(t);var s=SubRoles.ins().getSubRoleByIndex(e);s&&(s.thunderData[i]=n,s.calcThunderMinLevel())},e.prototype.sendThunderWear=function(t,e,i){var n=this.getBytes(9);n.writeDouble(t),n.writeShort(i),n.writeShort(e),this.sendToServer(n)},e.prototype.sendThunderOff=function(t,e){var i=this.getBytes(10);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postThunderEquipData=function(t){var e=t.readUnsignedByte();this.thunderUnlockIndex=[];for(var i=0;e>i;i++)this.thunderUnlockIndex[t.readByte()]=1;for(var n=t.readUnsignedByte(),i=0;n>i;i++)for(var s=t.readByte(),o=SubRoles.ins().getSubRoleByIndex(s),a=t.readByte(),r=0;a>r;r++){var l=t.readByte();this.thunderEquipLv[s][l]=t.readUnsignedShort(),o.thunderEquipAwakeLv[l]=t.readUnsignedShort()}},e.prototype.sendThunderExtraLv=function(t,e){var i=this.getBytes(11);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postThunderEquipLv=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte();this.thunderEquipLv[e][i]=t.readUnsignedShort()},e.prototype.sendThunderLv=function(t,e){var i=this.getBytes(12);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendThunderBreak=function(t){var e=this.getBytes(13);e.writeDouble(t),this.sendToServer(e)},e.prototype.sendThunderCompose=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.sendLegenCompose=function(t,e){var i=this.getBytes(24);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendPowerEquipWear=function(t,e,i){var n=this.getBytes(26);n.writeDouble(t),n.writeByte(e),n.writeByte(i),this.sendToServer(n)},e.prototype.sendPowerEquipRefine=function(t,e,i){var n=this.getBytes(27);n.writeByte(t),n.writeByte(e),n.writeByte(i),this.sendToServer(n)},e.prototype.sendPowerEquipUp=function(t,e){var i=this.getBytes(28);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendPowerEquipDecompose=function(t){var e=this.getBytes(29);e.writeInt(t.length);for(var i=0;i<t.length;i++)e.writeDouble(t[i]);this.sendToServer(e)},e.prototype.postPowerEquipDecompose=function(t){PowerEquipCT.ins().decomposeIds=[]},e.prototype.postThunderUnlock=function(t){for(var e=t.readUnsignedByte(),i=0;e>i;i++)this.thunderUnlockIndex[t.readByte()]=1},e.prototype.upgradeZhiZunEquip=function(t,e){var i=this.getBytes(8);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postZhiZunUpgrade=function(t){var e=t.readShort(),i=t.readShort(),n=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);s.soulLv=n},e.prototype.sendThunderAwakeLevel=function(t,e){var i=this.getBytes(19);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postThunderAwakeLevel=function(t){var e=t.readUnsignedShort(),i=t.readUnsignedShort(),n=SubRoles.ins().getSubRoleByIndex(e);n&&(n.thunderEquipAwakeLv[i]=t.readUnsignedShort())},e.prototype.sendEquipAwakeLevel=function(t,e){var i=this.getBytes(20);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postEquipAwakeLevel=function(t){var e=t.readUnsignedShort(),i=t.readUnsignedShort(),n=SubRoles.ins().getSubRoleByIndex(e);return n?(n.equipAwakeLv[i]=t.readUnsignedShort(),!0):!1},e.prototype.postEquipLegenLevel=function(t){var e=t.readUnsignedShort(),i=t.readUnsignedShort(),n=SubRoles.ins().getSubRoleByIndex(e);return n?(n.legenEquipDate[i]=t.readUnsignedShort(),!0):!1},e.prototype.postPowerEquip=function(t){PowerEquipCT.ins().powerEquipLevel=t.readInt(),PowerEquipCT.ins().powerEquipGodLevel=t.readInt();for(var e=t.readByte(),i=0;e>i;i++){var n=t.readByte(),s=SubRoles.ins().getSubRoleByIndex(n),o=t.readByte();if(s)for(var a=0;o>a;a++){var r=t.readByte();s.powerEquipDate[r]=[],s.powerEquipDate[r].push(t.readShort()),s.powerEquipDate[r].push(t.readShort()),s.powerEquipDate[r].push(t.readShort()),s.powerEquipAwakeLv[r]=t.readShort()}}return e>0?!0:!1},e.prototype.postPowerEquipUpdate=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),n=t.readShort(),s=new ItemData;return s.parser(t),i?(i.powerEquipItemData[n]=s,!0):!1},e.prototype.postPowerEquipQucheUpDate=function(t){var e=t.readByte(),i=SubRoles.ins().getSubRoleByIndex(e);if(i){var n=t.readByte(),s=t.readByte(),o=t.readInt();return i.powerEquipDate[n][s-1]=o,!0}return!1},e.prototype.getBodyEquipAwakeLv=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t);return i?i.equipAwakeLv[e]||0:0},e.prototype.sendWearEquipment=function(t,e,i){var n=this.getBytes(1);n.writeDouble(t),n.writeShort(i),n.writeShort(e),this.sendToServer(n)},e.prototype.sendSmeltEquip=function(t,e){var i=this.getBytes(2);i.writeInt(t);var n=i.position;i.position+=4;for(var s=0,o=0;o<e.length;o++)null!=e[o]&&(i.writeDouble(e[o].handle),++s);return 0==s?!1:(i.position=n,i.writeInt(s),this.sendToServer(i),!0)},e.prototype.doUpDataEquip=function(t){var e=t.readShort(),i=t.readShort(),n=new ItemData;n.parser(t);var s=SubRoles.ins().getSubRoleByIndex(e),o=s.getEquipByIndex(i);o.item=n,this.postEquipChange(e,i)},e.prototype.postEquipChange=function(t,e){return SoundUtil.play(SoundEnum.EQUIP),[t,e]},e.prototype.postSmeltEquipComplete=function(t){var e=t.readInt();if(0==e)return void TipsCT.ins().showTips("|C:0xf3311e&T:熔炼失败！|");for(var i=(t.readInt(),t.readInt()),n=[],s=0;i>s;s++){var o={};o.itemId=t.readInt(),o.count=t.readInt(),n.push(o)}return i>0&&200007==n[0].itemId&&ShowImgCT.ins().showImg(n[0].itemId+"_png",{horizontalCenter:150,y:StageUtils.ins().getHeight()-80}),n},e.contrastEquip=function(t,e){if(!t||0==t.handle)return e;if(!e||0==e.handle)return t;var i=t.point,n=e.point;return n>i?e:t},e.prototype.postEquipCheckList=function(t){return t},e.prototype.getEquipsByJobNPos=function(t,e){for(var i=SubRoles.ins().subRolesLen,n=0;i>n;n++){var s=SubRoles.ins().getSubRoleByIndex(n);if(s.job==t)return s.getEquipByIndex(e)}return null},e.prototype.getEquipConfigIDByPosAndQuality=function(t,e,i){void 0===i&&(i=1);for(var n=ZsCT.ins().lv||0,s=Actor.level,o=1e5+1+1e4*t+100*e+1e3*i,a=2;99>a;a++){var r=1e5+a+1e4*t+100*e+1e3*i,l=GlobalConfig.ItemConfig[r];if(void 0==l)break;var h=l.zsLevel?l.zsLevel:0,u=l.level?l.level:1;if(!(n>=h&&s>=u))break;o=r}return o},e.prototype.getEquipConfigIDByPosAndQualityByLegend=function(t,e,i,n){void 0===n&&(n=1);for(var s=ZsCT.ins().lv||0,o=Actor.level,a=1e5+1+1e4*e+100*i+1e3*n,r=SubRoles.ins().getSubRoleByIndex(t),l=r.getEquipByIndex(e),h=1;99>h;h++){var u=1e5+h+1e4*e+100*i+1e3*n,p=GlobalConfig.ItemConfig[u];if(void 0==p)break;a=u;var c=p.zsLevel?p.zsLevel:0,d=p.level?p.level:1;if(!(s>=c&&o>=d))break;if(l&&l.item.configID){var g=ItemUtil.pointCalNumber(GlobalConfig.ItemConfig[u]);if(l.item.point<g){a=u;break}}else a=u}return a},e.prototype.getEquipConfigIDByPosAndQualityByGod=function(t,e,i,n){void 0===n&&(n=1);for(var s=ZsCT.ins().lv||0,o=Actor.level,a=t.getEquipByIndex(e),r=a.item.configID,l=1;99>l;l++){var h=1e5+l+1e4*e+100*i+1e3*n,u=GlobalConfig.ItemConfig[h];if(void 0==u)break;var p=u.zsLevel?u.zsLevel:0,c=u.level?u.level:1;if(!(s>=p&&o>=c))break;if(a&&a.item.configID){var d=ItemUtil.pointCalNumber(GlobalConfig.ItemConfig[h]);if(a.item.point<d){r=h;break}}else r=h}return r},e.prototype.checkEquipsIsWear=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(n.job==ItemUtil.getJob(t.itemConfig)||0==ItemUtil.getJob(t.itemConfig))for(var s=n.getEquipLen(),o=0;s>o;o++)if(t.handle==n.getEquipByIndex(o).item.handle)return!0}return!1},e.prototype.doGrewupEquipResult=function(t){var e=t.readShort(),i=t.readInt(),n=t.readInt();4==ItemUtil.getQuality(GlobalConfig.ItemConfig[n])?this.postMixEquip(e,i,n):this.postMixGodEquip(e,i,n)},e.prototype.postMixEquip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postMixGodEquip=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.sendGrewupEquip=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendMixEquip=function(t,e,i){var n=this.getBytes(4);n.writeShort(t),n.writeInt(e),n.writeInt(i),this.sendToServer(n)},e.prototype.delayCheckHaveCan=function(){Timer.has(this.postCheckHaveCan,this)||Timer.start(60,1,this.postCheckHaveCan,this)},e.prototype.postCheckHaveCan=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e&&(this.isFind=this.checkRedPoint(4,e),!this.isFind);e++);if(!this.isFind)for(var i=0;t>i;i++)for(var e=0;8>e;e++)if(this.isFind=this.setOrangeEquipItemState(e,SubRoles.ins().getSubRoleByIndex(i)),this.isFind)return 1;if(!this.isFind){for(var e=0;t>e&&(this.isFind=this.checkRedPoint(5,e),!this.isFind);e++);if(!this.isFind)for(var i=0;t>i;i++)for(var e=0;2>e;e++)if(this.isFind=this.setLegendEquipItemUpState(e>0?2:0,SubRoles.ins().getSubRoleByIndex(i)),this.isFind=this.setLegendEquipItemState(e>0?2:0,SubRoles.ins().getSubRoleByIndex(i))||this.isFind,this.isFind)return 1}return this.isFind||(this.isFind=Boolean(BagCT.ins().getHuntGoods(0).length)),this.isFind?1:0},e.prototype.checkRedPointEx=function(t,e){for(var i=BagCT.ins().getBagEquipsByQuality(t),n=i.length,s=0;n>s;s++){var o=void 0,a=void 0;if(!isNaN(e)&&(o=ItemUtil.getJob(i[s].itemConfig),a=SubRoles.ins().getSubRoleByIndex(e),a.job!=o))return!1;if(!a)return!1;var r=this.getEquipConfigIDByPosAndQualityByGod(a,ItemUtil.getSubType(i[s].itemConfig),ItemUtil.getQuality(i[s].itemConfig)),l=GlobalConfig.ItemConfig[r];if(l){var h=i[s].itemConfig.zsLevel?i[s].itemConfig.zsLevel:0,u=i[s].itemConfig.level?i[s].itemConfig.level:0,p=l.zsLevel?l.zsLevel:0,c=l.level?l.level:0,d=1e4*h+u,g=1e4*p+c;if(g>d){if(4!=t)return!0;var f=BagCT.ins().getBagGoodsCountById(0,r),v=GlobalConfig.LegendComposeConfig[r],y=v?v.count:0;if(v&&f>=y)return!0}}}return!1},e.prototype.checkRedPointExOrg=function(t,e){var i=BagCT.ins().getBagEquipsByQuality(t),n=i.length;if(n)this.checkRedPoint(t,e);else if(isNaN(e)){if(this.IsEnoughChip(e))return!0}else for(var s=0;s<SubRoles.ins().subRolesLen;s++)if(this.IsEnoughChip(s))return!0;return!1},e.prototype.IsEnoughChip=function(t){for(var e=[EquipPos.WEAPON,EquipPos.CLOTHES],i=SubRoles.ins().getSubRoleByIndex(t),n=0;n<e.length;n++){var s=this.getMixConfig(i.index,e[n]);if(s){var o=s.count,a=s.itemId,r=BagCT.ins().getBagGoodsCountById(0,a);if(r>=o)return!0}}return!1},e.prototype.getMixConfig=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t),n=this.getEquipConfigIDByPosAndQualityByLegend(i.index,e,5),s=GlobalConfig.LegendComposeConfig[n];return s},e.prototype.checkRedPoint=function(t,e){for(var i=BagCT.ins().getBagEquipsByQuality(t),n=i.length,s=0;n>s;s++){var o=void 0,a=void 0;if(!isNaN(e)&&(o=ItemUtil.getJob(i[s].itemConfig),a=SubRoles.ins().getSubRoleByIndex(e),a.job!=o))return!1;if(!a)return!1;var r=this.getEquipConfigIDByPosAndQualityByGod(a,ItemUtil.getSubType(i[s].itemConfig),ItemUtil.getQuality(i[s].itemConfig)),l=GlobalConfig.ItemConfig[r];if(l){var h=i[s].itemConfig.zsLevel?i[s].itemConfig.zsLevel:0,u=i[s].itemConfig.level?i[s].itemConfig.level:0,p=l.zsLevel?l.zsLevel:0,c=l.level?l.level:0,d=1e4*h+u,g=1e4*p+c;if(g>d)return!0}}return!1},e.prototype.setOrangeEquipItemState=function(t,e){var i,n=e.getEquipByIndex(t);i=n.item.itemConfig&&ItemUtil.getQuality(n.item.itemConfig)<4?null:GlobalConfig.LegendLevelupConfig[n.item.configID]?GlobalConfig.ItemConfig[GlobalConfig.LegendLevelupConfig[n.item.configID].newEquipId]:null;var s=0,o=0;if(n.item.itemConfig&&4==ItemUtil.getQuality(n.item.itemConfig)&&n.item.itemConfig.zsLevel>=13)return!1;if(n.item.itemConfig&&5==ItemUtil.getQuality(n.item.itemConfig))return!1;if(null!=i&&(i.level>Actor.level||i.zsLevel>ZsCT.ins().lv))return!1;if(void 0!=i&&0!=n.item.handle&&4==ItemUtil.getQuality(n.item.itemConfig)&&1!=n.item.itemConfig.level){var a=GlobalConfig.LegendLevelupConfig[n.item.configID];a&&(s=a.count,o=a.itemId)}else{var r=this.getEquipConfigIDByPosAndQualityByGod(e,t,4,e.job),l=e.getEquipByIndex(t);if(l&&l.item.configID){var h=ItemUtil.pointCalNumber(GlobalConfig.ItemConfig[r]);if(l.item.point>h)return!1}var u=GlobalConfig.LegendComposeConfig[r];u&&(s=u.count,o=u.itemId)}var p=BagCT.ins().getBagGoodsCountById(0,o);return p>0&&p>=s},e.prototype.setLegendEquipItemState=function(t,e){var i=e.getEquipByIndex(t),n=null,s=ItemUtil.getQuality(i.item.itemConfig);if(i.item.itemConfig&&5==s){if(i.item.itemConfig.zsLevel>=10)return!1;n=GlobalConfig.ItemConfig[i.item.configID+1]}else n=null;var o=0,a=0;if(null!=n&&n.zsLevel>ZsCT.ins().lv)return!1;if(null!=n&&0!=i.item.handle&&5==s){var r=GlobalConfig.LegendLevelupConfig[i.item.configID];o=r.count,a=r.itemId}else{var l=this.getEquipConfigIDByPosAndQualityByLegend(e.index,t,5),h=GlobalConfig.LegendComposeConfig[l];if(!h)return!1;o=h.count,a=h.itemId}var u=BagCT.ins().getBagGoodsCountById(0,a);return ZsCT.ins().lv>=3?u>=o:!1},e.prototype.setLegendEquipItemUpState=function(t,e){var i=e.getEquipByIndex(t),n=GlobalConfig.ItemConfig[i.item.configID+1],s=ItemUtil.getQuality(i.item.itemConfig);if(void 0==n&&0!=i.item.handle&&5==s)return!1;if(void 0!=n&&0!=i.item.handle&&5==s){var o=e.getEquipByIndex(t).item.configID,a=GlobalConfig.ItemConfig[o+1];if(a.level>Actor.level||a.zsLevel>ZsCT.ins().lv)return!1;var r=GlobalConfig.LegendLevelupConfig[o],l=BagCT.ins().getBagGoodsCountById(0,r.itemId);return l>=r.count}return!1},e.prototype.getLegendEquipItemUpMax=function(t){for(var e=0;8>e;e++)if(0==e||2==e){var i=SubRoles.ins().getSubRoleByIndex(t).getEquipByIndex(e);if(!i)return!0;var n=GlobalConfig.ItemConfig[i.item.configID+1],s=ItemUtil.getQuality(i.item.itemConfig);if(void 0!=n||0==i.item.handle||5!=s)return!1}return!0},e.prototype.requestAddSpirit=function(t,e,i){var n=this.getBytes(5);n.writeShort(t),n.writeShort(e),n.writeShort(i.length);for(var s=0;s<i.length;s++)n.writeDouble(i[s]);this.sendToServer(n)},e.prototype.postAddSpirit=function(t){var e=t.readShort(),i=t.readShort(),n=t.readShort(),s=t.readInt(),o=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);o.spiritLv=n,o.spiritExp=s},e.prototype.requestAddSoul=function(t,e){var i=this.getBytes(7);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postAddSoul=function(t){var e=t.readShort(),i=t.readShort(),n=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(e).getEquipByIndex(i);s.soulLv=n},e.getOrangeSuitLv=function(t){var e={zsLv:0,lv:0,num:0};if(!t)return e;for(var i=0;8>i;i++){var n=t.getEquipByIndex(i);if(n&&n.item.itemConfig&&4==ItemUtil.getQuality(n.item.itemConfig)){var s=n.item.itemConfig.zsLevel;e.zsLv=0==e.zsLv?s:Math.min(e.zsLv,s);var o=n.item.itemConfig.level;e.lv=0==e.lv?o:Math.min(e.lv,o)}}var a=GlobalConfig.EquipStarSuit;if(!a[e.lv])for(var i in a){e.lv=+i;break}var r=a[e.lv];if(!r[e.zsLv])for(var i in r){e.zsLv=+i;break}for(var l=0,i=0;8>i;i++){var n=t.getEquipByIndex(i);n&&n.item.itemConfig&&this.isReachSuitLv(n.item.itemConfig,e)&&l++}return e.num=l,e},e.isReachSuitLv=function(t,e){if(!t||!e)return!1;var i=ItemUtil.getQuality(t);return 4>i?!1:5==i?!0:t.level>=e.lv||t.zsLevel&&t.zsLevel>=e.zsLv},e.LegendToLevelgenDescID=function(t,i){var n=e.getLegendJINengLevel(),s=0;GlobalConfig.HotBloodStarSuit;return s=t>=n[2]&&i>=n[2]?Number(GlobalConfig.HotBloodStarSuit[n[2]][2].skill):t>=n[1]&&i>=n[1]?Number(GlobalConfig.HotBloodStarSuit[n[1]][2].skill):t>=n[0]&&i>=n[0]?Number(GlobalConfig.HotBloodStarSuit[n[0]][2].skill):Number(GlobalConfig.HotBloodStarSuit[n[0]][2].skill)},e.getLegendJINengLevel=function(){var t=[];for(var e in GlobalConfig.HotBloodStarSuit)t.push(Number(e));return t},e.getDescToSkillID=function(t){var e=void 0,i=GlobalConfig.SkillsConfig[t];return i&&0!=i.id&&(e=GlobalConfig.SkillsDescConfig[i.id].desc),e},e.FOEGE_MAX=8,__decorate([post()],e.prototype,"postThunderEquipUpdate",null),__decorate([post()],e.prototype,"postThunderEquipData",null),__decorate([post()],e.prototype,"postThunderEquipLv",null),__decorate([post()],e.prototype,"postPowerEquipDecompose",null),__decorate([post()],e.prototype,"postThunderUnlock",null),__decorate([post()],e.prototype,"postZhiZunUpgrade",null),__decorate([post()],e.prototype,"postThunderAwakeLevel",null),__decorate([post()],e.prototype,"postEquipAwakeLevel",null),__decorate([post()],e.prototype,"postEquipLegenLevel",null),__decorate([post()],e.prototype,"postPowerEquip",null),__decorate([post()],e.prototype,"postPowerEquipUpdate",null),__decorate([post()],e.prototype,"postPowerEquipQucheUpDate",null),__decorate([post()],e.prototype,"getBodyEquipAwakeLv",null),__decorate([post()],e.prototype,"postEquipChange",null),__decorate([post()],e.prototype,"postSmeltEquipComplete",null),__decorate([post()],e.prototype,"postEquipCheckList",null),__decorate([post()],e.prototype,"postMixEquip",null),__decorate([post()],e.prototype,"postMixGodEquip",null),__decorate([post()],e.prototype,"postCheckHaveCan",null),__decorate([post()],e.prototype,"postAddSpirit",null),__decorate([post()],e.prototype,"postAddSoul",null),e}(BaseSystem);__reflect(EquipCT.prototype,"EquipCT"),System.EquipCT=function(){return EquipCT.ins()},window.EquipCT=EquipCT;var JingMaiCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.JingMai,e.regNetMsg(1,e.doUpData),e.regNetMsg(4,e.doBigUpLevel),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendBoost=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendUpgrade=function(t){var e=this.getBytes(2);e.writeShort(t),this.sendToServer(e)},e.prototype.doUpData=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).jingMaiData.parser(t),this.postUpdate()},e.prototype.postUpdate=function(){},e.prototype.sendBigUpLevel=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.doBigUpLevel=function(t){var e,i=t.readInt();if(i)e="道具不足够";else{var n=t.readInt();n||(e="使用成功，经脉等阶+1")}e&&TipsCT.ins().showTips(e)},e.prototype.canGradeupJingMai=function(){for(var t,e=[!1,!1,!1],i=0,n=0,s=SubRoles.ins().subRolesLen,o=0;s>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(t=GlobalConfig.JingMaiLevelConfig[a.jingMaiData.level],i=t.count){var r=BagCT.ins().getBagGoodsCountById(0,200103);if(r){e[o]=!0;break}n=BagCT.ins().getBagGoodsCountById(0,t.itemId),e[o]=n>=i}else e[o]=!1}return e},__decorate([post()],e.prototype,"postUpdate",null),e}(BaseSystem);__reflect(JingMaiCT.prototype,"JingMaiCT"),System.JingMaiCT=function(){return JingMaiCT.ins()},window.JingMaiCT=JingMaiCT;var RoleCT=function(t){function e(){var e=t.call(this)||this;return e.timeID=0,e.canChangeEquips=[[],[],[]],e.observe(BagCT.ins().postItemChange,e.startCheckHaveCan),e.observe(BagCT.ins().postItemAdd,e.startCheckHaveCan),e.observe(BagCT.ins().postItemDel,e.startCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.startCheckHaveCan),e.observe(GameLogic.ins().postSubRoleChange,e.startCheckHaveCan),e.observe(EquipCT.ins().postEquipChange,e.startCheckHaveCan),e.observe(JadeNew.ins().postJadeData,e.startCheckHaveCan),e.observe(LyMark.ins().postMarkData,e.startCheckHaveCan),e.observe(WingCT.ins().postUseDanSuccess,e.startCheckHaveCan),e.observe(WingCT.ins().postWingUpgrade,e.startCheckHaveCan),e.observe(Actor.ins().postGoldChange,e.delayShowNavBtnRedPoint),e.observe(GameLogic.ins().postRuneExchange,e.delayShowNavBtnRedPoint),e.observe(GameLogic.ins().postRuneShatter,e.delayShowNavBtnRedPoint),e.observe(BagCT.ins().postHuntStore,e.delayShowNavBtnRedPoint),e.observe(FbCT.ins().postFbRingInfo,e.delayShowNavBtnRedPoint),e.observe(Actor.init,e.delayShowNavBtnRedPoint),e.observe(DemonCirRedPoint.ins().postRedPoint,e.delayShowNavBtnRedPoint),e.observe(ShieldRedPoint.ins().postRedPoint,e.delayShowNavBtnRedPoint),e.observe(EightRefuseRedPoint.ins().postRedPoint,e.delayShowNavBtnRedPoint),e.observe(SpiritEquipRedPoint.ins().postRedPoint,e.delayShowNavBtnRedPoint),e}return __extends(e,t),e.prototype.startCheckHaveCan=function(t,e){var i=this;void 0===t&&(t=!1),void 0===e&&(e=-1),this.timeID||(this.timeID=1,Timer.start(50,1,function(){i.checkHaveCan(t,e)},this))},e.ins=function(){return t.ins.call(this)},e.prototype.checkHaveCan=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=-1),this.timeID=0;for(var i=BagCT.ins().getBagEquipByType(0),n=SubRoles.ins(),s=e>=0?e:0,o=e>=0?e+1:n.subRolesLen,a=[[],[],[]],r=n.subRolesLen,l=0;r>l;l++)for(var h=0,u=n.getSubRoleByIndex(l).equipsData;h<u.length;h++){var p=u[h];a[l].push(p.item)}for(var c=0,d=i;c<d.length;c++)for(var g=d[c],f=s;o>f;f++){var v=ItemUtil.getJob(g.itemConfig);if((0==v||SubRoles.ins().getSubRoleByIndex(f).job==v)&&!(ZsCT.ins().lv<g.itemConfig.zsLevel||Actor.level<g.itemConfig.level)){var y=BagCT.ins().getLowEquipIndex(a[f],ItemUtil.getSubType(g.itemConfig));y>=0&&(a[f][y]=this.contrastEquip(a[f][y]||n.getSubRoleByIndex(f).equipsData[y].item,g))}}for(var m=a.length,l=0;m>l;l++){for(var f=0;f<a[l].length;f++)this.canChangeEquips[l][f]=!1,a[l][f]&&a[l][f].handle!=n.getSubRoleByIndex(l).equipsData[f].item.handle&&(t&&e==l?(EquipCT.ins().sendWearEquipment(a[l][f].handle,f,e),this.canChangeEquips[l][f]=!1):this.canChangeEquips[l][f]=!0);this.canChangeEquips[l].indexOf(!0)<0&&(this.canChangeEquips[l].length=0)}this.showNavBtnRedPoint()},e.prototype.contrastEquip=function(t,e){if(!t||0==t.handle)return e;if(!e||0==e.handle)return t;
var i=t.point,n=e.point;return n>i?e:t},e.prototype.getCanChangeEquips=function(){for(var t=0,e=this.canChangeEquips;t<e.length;t++)for(var i=e[t],n=0,s=i;n<s.length;n++){var o=s[n];if(o)return!0}return!1},e.prototype.delayShowNavBtnRedPoint=function(){this.showNavBtnRedPoint()},e.prototype.showNavBtnRedPoint=function(t){if(void 0===t&&(t=!1),t=this.getCanChangeEquips(),!t&&SamsaraModel.ins().isCanAddSpirit()&&(t=!0),!t&&OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed())&&(t=!0),!t&&LongHun.ins().canShowRedPointInAll()?t=!0:!t&&ZsCT.ins().canOpenZSWin()&&!ZsCT.ins().isMaxLv()&&(ZsCT.ins().canGet()>0||ZsCT.ins().canUpgrade())?t=!0:(!t&&this.and(WingCT.ins().canGradeupWing())||this.and(WingCT.ins().canItemGradeupWing())||WingCT.ins().isHaveActivationWing())&&(t=!0),t||(t=GodWingRedPoint.ins().keYinRedPoint),!t&&Dress.ins().redPoint()&&(t=!0),!t&&RuneRedPointMgr.ins().checkAllSituation(!1)&&(t=!0),!t){for(var e=0,i=SubRoles.ins().roles;e<i.length;e++){for(var n=i[e],s=0;8>s;s++){if(t=EquipCT.ins().setOrangeEquipItemState(s,n),!t&&2>s&&(t=EquipCT.ins().setLegendEquipItemState(s>0?2:0,n)),t){var o=BagCT.ins().checkEqRedPoint(s,n);t=null!=o?o:t}if(t)break}if(t)break}if(!t)for(var s=0;s<SubRoles.ins().subRolesLen&&!(t=EquipCT.ins().checkRedPointEx(5,s));s++);t||(t=BagCT.ins().getLegendHasResolve())}t||(t=SubRoles.ins().isLockRole()),t||(t=ShenshouRedpoint.ins().redpoint),t||(t=GodWingRedPoint.ins().getGodWingRedPoint()),t||(t=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||SamsaraModel.ins().isCanUpgradeSoul()||NeiGongModel.ins().canUp()),t||(t=JadeNew.ins().checkRed()),t||(t=WingCT.ins().canUseFlyUp()),t||(t=WingCT.ins().canUseAptitude()),t||(t=ThunderRedPoint.ins().redPoint),t||(t=DemonCirRedPoint.ins().redPoint),t||(t=OrangeEquipRedPoint.ins().redPoint),t||(t=MoJianRedPoint.ins().redPoint),t||(t=WushuangRP.ins().getRoleRp()),t||(t=FireRingRedPoint.ins().changePoint),t||(t=ShieldRedPoint.ins().redPoint),t||(t=EightRefuseRedPoint.ins().redPoint),t||(t=SpiritEquipRedPoint.ins().redPoint),t||(t=SmRedPoint.ins().redPoint),t||(t=BloodstainRedPoint.ins().redPoint),this.postRoleHint(t)},e.prototype.postRoleHint=function(t){return t?1:0},e.prototype.and=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(1==n)return!0}return!1},e.prototype.seekRoleItem=function(){for(var t=!1,e=BagCT.ins().getBagItemNum(0),i=0;e>i;i++){if(t)return t;var n=BagCT.ins().getBagGoodsByIndex(0,i);switch(n.itemConfig.id){case 200001:break;case 200004:t=this.roleHint(5);break;case 200013:t=this.roleHint(0);break;case 200014:t=this.roleHint(1)}}return t},e.prototype.roleHint=function(t){for(var e=0,i=SubRoles.ins().roles;e<i.length;e++){var n=i[e];if(this.roleHintCheck(n,t))return!0}return!1},e.prototype.roleHintCheck=function(t,e){var i=1,n=0,s=0,o=0;switch(e){case 0:i=t.getExRingsData(0);var a=GlobalConfig.ExRing0Config[i];if(i>=1)return!1;a&&(n=a.cost,o=GlobalConfig.ExRingConfig[0].costItem);break;case 1:i=t.getExRingsData(1);var r=GlobalConfig.ExRing1Config[i];if(i>=1)return!1;r&&(n=r.cost,o=GlobalConfig.ExRingConfig[1].costItem);break;case LongHun.TYPE_LONG_HUN:i+=t.loongSoulData.level;var l=GlobalConfig.LoongSoulConfig[i],h=GlobalConfig.LoongSoulStageConfig[t.loongSoulData.stage];l&&(n=h.normalCost,o=l.itemId);break;case LongHun.TYPE_HU_DUN:i+=t.shieldData.level;var u=GlobalConfig.ShieldConfig[i],p=GlobalConfig.ShieldStageConfig[t.loongSoulData.stage];u&&(n=p.normalCost,o=u.itemId);break;case 5:i=t.jingMaiData.level;var c=GlobalConfig.JingMaiLevelConfig[i];c&&(n=c.count,o=c.itemId)}return n&&(s=BagCT.ins().getBagGoodsCountById(0,o),s>=n)?!0:!1},e.prototype.setCanChange=function(){var t=ViewManager.ins().getView(RoleWin);t&&ViewManager.ins().isShow(RoleWin)&&(t.roleInfoPanel.setCanChange(this.canChangeEquips),t.canChangeEquips=this.canChangeEquips)},e.oneKeyOpenLevel=60,__decorate([callDelay(100)],e.prototype,"delayShowNavBtnRedPoint",null),__decorate([post()],e.prototype,"postRoleHint",null),e}(BaseSystem);__reflect(RoleCT.prototype,"RoleCT"),System.RoleCT=function(){return RoleCT.ins()},window.RoleCT=RoleCT;var SkillCT=function(t){function e(){var e=t.call(this)||this;return e.hejiLevel=-1,e.hejiCD=0,e.hejiEnable=!1,e.isFirst=!0,e.fieldUse=!1,e.equipListData=[],e.hejiProgressList=[],e.reduceCD=0,e.sysId=PackageID.Skill,e.regNetMsg(1,e.doSkillResult),e.regNetMsg(2,e.postDoBuff),e.regNetMsg(3,e.postDoRemoveBuff),e.regNetMsg(6,e.doAddEffect),e.regNetMsg(7,e.doRemoveEffect),e.regNetMsg(4,e.postSkillUpgrade),e.regNetMsg(5,e.postSkillUpgradeAll),e.regNetMsg(8,e.postTupo),e.regNetMsg(9,e.postHejiInfo),e.regNetMsg(10,e.doHejiEquipInfo),e.regNetMsg(11,e.doHejiEquipUpdate),e.regNetMsg(12,e.doHejiUpdateInfo),e.regNetMsg(13,e.postUpgradeForge),e.regNetMsg(14,function(t){return e.postShowSkillWord(t.readString())}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getPunchForge=function(){return this.punchEquipForge||(this.punchEquipForge=new PunchEquipForgeData),this.punchEquipForge},e.prototype.sendUseSkill=function(t,e,i){var n=this.getBytes(1);n.writeDouble(t),n.writeDouble(e),n.writeInt(i),this.sendToServer(n)},e.prototype.doSkillResult=function(t){var e=t.readDouble(),i=t.readInt(),n=t.readDouble(),s=EntityManager.ins().getEntityByHandle(e);if(!s)return!1;var o=EntityManager.ins().getEntityByHandle(n);if(!o)return!1;if(!o.parent&&s.isMy&&EntityShowMgr.ins().showHideSomeOne(n),!s.parent&&o.isMy&&EntityShowMgr.ins().showHideSomeOne(e),!s.parent)return!1;var a,r=new SkillData(i),l=t.readShort();if(s.isMy&&(o.showBlood(!0),o.showName(!0)),o.isMy){var h=GlobalConfig.MonstersConfig[s.infoModel.configID];(!h||h&&h.type!=MonsterType.Ring)&&(s.showBlood(!0),s.showName(!0))}for(var u=[],p=[],c=0;l>c;c++)a=t.readDouble(),p=[a],u[c]=p;return AIUtil.ins().userSkill(s,o,r),s instanceof CharRole&&GuildWar.ins().getModel().checkinAppoint(2,!0)&&SubRoles.ins().getIsMyPlayer(n)&&s.infoModel.name?GuildWar.ins().getModel().changeWeiXieList(s.infoModel.masterHandle,!0,s.infoModel.name):s instanceof CharRole&&CrossGuildBattleCT.ins().getCurMapLevel()>1&&SubRoles.ins().getIsMyPlayer(n)&&s.infoModel.name&&CrossGuildBattleCT.ins().changeWeiXieList(s.infoModel.masterHandle,!0,s.infoModel.name),[r,s,o]},e.prototype.postDoBuff=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var n=ObjectPool.pop("EntityBuff");n.effConfig=GlobalConfig.EffectsConfig[t.readInt()],n.value=0,n.addTime=egret.getTimer(),i.addBuff(n)}},e.prototype.postDoRemoveBuff=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var n=GlobalConfig.EffectsConfig[t.readInt()].group;i.hasBuff(n)&&i.removeBuff(i.buffList[n])}},e.prototype.doAddEffect=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);if(i){var n=t.readInt();i.addEffect(n)}},e.prototype.doRemoveEffect=function(t){var e=t.readDouble(),i=EntityManager.ins().getEntityByHandle(e);i&&i.removeEffect(t.readInt())},e.prototype.postSkillUpgrade=function(t){var e=t.readShort(),i=t.readShort(),n=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(e);if(s&&0!=s.skillsData.length){var o=s.skillsData[i].lv;return s.skillsData[i]=SkillData.getSkillByJob(s.job,i+1,n),0==o&&0!=n&&TipsCT.ins().showSkillTips(s.skillsData[i].configID),[e,i,n]}},e.prototype.sendGrewUpAllSkill=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=0);var n=this.getBytes(5);n.writeShort(e?1:0),n.writeShort(t),n.writeShort(i),this.sendToServer(n)},e.prototype.postSkillUpgradeAll=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e),n=i.skillsData;i.skillsData=[];for(var s=0;5>s;s++)i.skillsData.push(SkillData.getSkillByJob(i.job,s+1,t.readShort())),this.tupoData[i.skillsData[s].id/1e3]&&(i.skillsData[s].tupoLevel=this.tupoData[i.skillsData[s].id/1e3]);return[n,e]},e.prototype.sendTupo=function(t,e){var i=this.getBytes(8);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postTupo=function(t){this.tupoData||(this.tupoData={});for(var e={},i=(t.readByte(),t.readByte()),n=0;i>n;n++){var s=t.readShort(),o=t.readByte();this.tupoData[s]=o;var a=Math.floor(s/10),r=Math.floor(s%10),l=SubRoles.ins().getSubRoleByJob(a);l.skillsData[r-1].tupoLevel=o,SubRoles.ins().updateRoleByJob(a,l),e[s]=o}return e},e.prototype.checkAllTupo=function(){var t=GlobalConfig.SkillBreakOpenConfig;if(ZsCT.ins().lv<t.tupoLevel||GameServer.serverOpenDay<t.openDay)return!1;for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)if(this.checkTupoRed(i))return!0;return!1},e.prototype.checkTupoRed=function(t){var e=SubRoles.ins().getSubRoleByIndex(t),i=GlobalConfig.SkillBreakOpenConfig;if(ZsCT.ins().lv<i.tupoLevel||GameServer.serverOpenDay<i.openDay)return!1;if(e)for(var n=e.skillsData,s=0;s<n.length;s++){var o=n[s],a=GlobalConfig.SkillBreakConfig[Math.floor(o.id/1e3)];if(a[o.tupoLevel+1]){var r=BagCT.ins().getBagGoodsCountById(0,a[o.tupoLevel+1].item),l=a[o.tupoLevel+1].cost;if(r>=l)return!0}}return!1},e.prototype.checkHechengRed=function(){var t;for(var e in GlobalConfig.SkillMergeConfig)if(GlobalConfig.SkillMergeConfig[e]){t=GlobalConfig.SkillMergeConfig[e];break}var i=t.cost,n=BagCT.ins().getBagGoodsCountById(0,t.itemid);return n>=i},e.prototype.singleTupoRed=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=GlobalConfig.SkillBreakOpenConfig;if(ZsCT.ins().lv<n.tupoLevel||GameServer.serverOpenDay<n.openDay)return!1;var s=i.skillsData,o=s[e],a=GlobalConfig.SkillBreakConfig[Math.floor(o.id/1e3)];if(a[o.tupoLevel+1]){var r=BagCT.ins().getBagGoodsCountById(0,a[o.tupoLevel+1].item),l=a[o.tupoLevel+1].cost;if(r>=l)return!0}return!1},e.prototype.postHejiInfo=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedInt(),n=!1,s=t.readByte();return-1==this.hejiLevel&&1==e&&(n=!0),this.hejiLevel!=e&&(this.hejiLevel=e,this.postHejiUpdate()),this.setHejiCD(i,s),{isAct:n}},e.prototype.doHejiEquipInfo=function(t){this.equipListData=[];for(var e,i=0;8>i;i++)e=new ItemData,e.parser(t),this.equipListData.push(e);this.setQimingInfo(),this.postHejiEquipChange()},e.prototype.setQimingInfo=function(){if(this.qimingEquipDic={},!this.qmArr){this.qmArr=[];var t=GlobalConfig.TogetherHitEquipQmConfig;for(var e in t)for(var i in t[e])if(!isNaN(Number(e))&&!isNaN(Number(i))){var n=1e4*+e+ +i;this.qmArr.push(n)}}for(var s=0,o=this.equipListData;s<o.length;s++){var a=o[s];if(0!=a.configID)for(var r=a.itemConfig,l=1e4*(r.zsLevel||0)+r.level,h=0,u=this.qmArr;h<u.length;h++){var i=u[h];i>l||(this.qimingEquipDic[i]?this.qimingEquipDic[i].num++:(this.qimingEquipDic[i]={num:0},this.qimingEquipDic[i].num=1))}}this.setQmAttr()},e.prototype.setQmAttr=function(){var t=GlobalConfig.TogetherHitEquipQmConfig;this.qimingAttrDic={};for(var e in this.qimingEquipDic){var i=Math.floor(+e/1e4),n=Math.floor(+e%1e4),s=this.qimingEquipDic[e].num,o=t[i][n];if(o)for(var a in o)s>=+a&&(this.qimingAttrDic[e]||(this.qimingAttrDic[e]={}),this.qimingAttrDic[e][a]=o[a])}this.qimingValueDic={};for(var e in this.qimingAttrDic)for(var r in this.qimingAttrDic[e]){var l=this.qimingAttrDic[e][r],h=l.exAttr[0];this.qimingValueDic[r]||(this.qimingValueDic[r]=new Object),this.qimingValueDic[r].value||(this.qimingValueDic[r].value=0),this.qimingValueDic[r].type=h.type,this.qimingValueDic[r].value+=h.value}},e.prototype.doHejiEquipUpdate=function(t){var e=t.readShort(),i=new ItemData;i.parser(t),this.equipListData[e]=i,this.setQimingInfo(),this.postHejiEquipChange()},e.prototype.checkHejiOpen=function(){var t=GlobalConfig.TogerherHitBaseConfig.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1},e.prototype.canHejiEquip=function(){if(this.hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;if(!this.equipListData)return!1;for(var t=0;t<this.equipListData.length;t++)if(this.checkIsHaveBestEquip(t))return!0;return!1},e.prototype.canExchange=function(){if(this.hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;for(var t,i=this.getMaxzLv(),n=0;n<this.equipListData.length;n++){var s=this.equipListData[n];if(s&&s.configID)for(var o=n+1;;o+=8){var a=GlobalConfig.TogetherHitEquipExchangeConfig[o];if(!a)break;var r=s.itemConfig.level?s.itemConfig.level:0,l=s.itemConfig.zsLevel?s.itemConfig.zsLevel:0,h=a.level,u=a.zsLevel,p=a.getItem.id;if(!(r>=h&&l>=u||p%1e4<=s.configID%1e4||h>Actor.level||u>ZsCT.ins().lv)){if(u>i[0]||h>i[1])break;if(u>=l&&h>=r){if(t=a.exchangeMaterial[0].count,a.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=t)return!0;if(a.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=t)return!0}}}else{var c=GlobalConfig.TogetherHitEquipExchangeConfig[+n+1];if(c){if(t=c.exchangeMaterial[0].count,c.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=t)return!0;if(c.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=t)return!0}}}return!1},e.prototype.getMaxzLv=function(){var t=0,e=this.qimingEquipDic;for(var i in e)+i>t&&(t=+i);var n=Math.floor(t/1e4),s=t%1e4;if(0==t||8==e[t].num){var o=GlobalConfig.TogetherHitEquipQmConfig,a=[];for(var r in o)a.push(+r);a.sort(function(t,e){return e>t?-1:1}),0==t?n=a[0]:(n=a[a.indexOf(n)+1],void 0==n&&(n=a[a.length-1]));for(var l in o[n])s=+l}return[n,s]},e.prototype.getPunchExchangePageRedPoint=function(t){for(var e=8*(t-1)+1,i=e+8,n=e;i>n;n++)if(this.getPunchExchangeItemRedPoint(n))return!0;return!1},e.prototype.getPunchExchangeItemRedPoint=function(t){var e,i=(t-1)%8,n=Math.ceil(t/8),s=this.equipListData[i];if(1==n){if(s&&s.configID)return!1}else{if(!s||!s.configID)return!1;var o=GlobalConfig.TogetherHitEquipExchangeConfig[t-8];if(o.getItem.id!=s.configID)return!1}var a=GlobalConfig.TogetherHitEquipExchangeConfig[t];if(a){if(a.zsLevel>ZsCT.ins().lv||a.level>Actor.level)return!1;if(e=a.exchangeMaterial[0].count,a.exchangeMaterial[0].id==MoneyConst.punch1&&Actor.togeatter1>=e)return!0;if(a.exchangeMaterial[0].id==MoneyConst.punch2&&Actor.togeatter2>=e)return!0}return!1},e.prototype.canAcitve=function(){return!1},e.prototype.canSolve=function(){if(this.hejiLevel<=0)return!1;if(Actor.level<e.HEJI_SHOW_LEVEL)return!1;var t=[];return BagCT.ins().checkHejiEquipsTodestroy(t),!!t.length},e.prototype.doHejiUpdateInfo=function(t){var e=t.readByte();this.hejiProgressList=[];for(var i=0;e>i;i++){var n=new HejiProgressData;n.parser(t),this.hejiProgressList[n.id-1]=n}},e.prototype.setHejiCD=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),this.hejiLevel>0){var i=this.getHejiSkillId();this.reduceCD=0;var n=EntityManager.ins().getMainRole(0);n&&n.infoModel&&n.infoModel.getExAtt(23)>0&&(this.reduceCD=n.infoModel.getExAtt(23)/1e4*i.cd),-1==t?this.hejiCD=GameServer.serverTime+i.cd-this.reduceCD:this.hejiCD=GameServer.serverTime+t,0==e&&this.postHejiStartCD()}},e.prototype.getHejiSkillId=function(){var t=GlobalConfig.TogetherHitConfig[this.hejiLevel],e=SubRoles.ins().getSubRoleByIndex(0);if(!e)return new SkillData(GlobalConfig.SkillsConfig[t.skill_id[0]].id);var i=GlobalConfig.SkillsConfig[t.skill_id[e.job-1]];return new SkillData(i.id)},e.prototype.getHejiSkillIdIcon=function(){var t=GlobalConfig.TogetherHitConfig[this.hejiLevel],e=SubRoles.ins().getSubRoleByIndex(0);e||(e={job:1});var i=GlobalConfig.SkillsConfig[t.skill_id[e.job-1]],n=1e3*Math.floor(i.id/1e3)+"_png";return n},e.prototype.getSkillIdIcon=function(t){var e=GlobalConfig.SkillsConfig[t],i=1e3*Math.floor(e.id/1e3)+"_png";return i},e.prototype.sendGrewUpHejiSkill=function(){this.sendBaseProto(9)},e.prototype.sendUseHejiSkill=function(){this.sendBaseProto(10)},e.prototype.sendDressHejiEquip=function(t,e){var i=this.getBytes(11);i.writeDouble(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendExchangeHejiEquip=function(t){var e=this.getBytes(12);e.writeShort(t),this.sendToServer(e)},e.prototype.getWearEquipsData=function(t){return this.equipListData[t]?this.equipListData[t]:null},e.prototype.getSkillLimitLevel=function(){return ZsCT.ins().lv>0?80+10*ZsCT.ins().lv:Actor.level>80?80:Actor.level},e.prototype.getSingleSkillGrewUpCost=function(t,e){var i=this.getSkillLimitLevel(),n=SubRoles.ins().getSubRoleByIndex(t).skillsData[e],s=Actor.gold,o=0;if(n.lv>0){for(var a=n.lv;i>a;a++){var r=GlobalConfig.SkillsUpgradeConfig[a].cost;if(o+r>s)return o;o+=r}return o}return 0},e.prototype.canGrewupSkill=function(){for(var t=[],e=this.getSkillLimitLevel(),i=SubRoles.ins().subRolesLen,n=0;i>n;n++)for(var s=SubRoles.ins().getSubRoleByIndex(n),o=0;o<s.skillsData.length;o++){var a=s.skillsData[o];if(a.lv>0&&e>a.lv){var r=GlobalConfig.SkillsUpgradeConfig[a.lv].cost;if(Actor.gold>=r){t[n]=!0;break}}}return t},e.prototype.grewupAllSkillsCost=function(t){for(var e=this.getSkillLimitLevel(),i=SubRoles.ins().getSubRoleByIndex(t).skillsData,n=i.length,s=Actor.gold,o=0,a=[],r=0;n>r;r++)a[r]=i[r].lv;for(;;){for(var l=-1,h=1,r=0;n>r;r++)a[r]>0&&e>a[r]&&(-1==l||a[r]<h)&&(l=r,h=a[r]);if(-1==l)return o;var u=GlobalConfig.SkillsUpgradeConfig[h].cost;if(!(s>=u))return o;s-=u,o+=u,a[l]++}},e.prototype.canGrewupAllSkills=function(t){for(var e=this.getSkillLimitLevel(),i=SubRoles.ins().getSubRoleByIndex(t).skillsData,n=!1,s=Actor.gold,o=0;o<i.length;o++){var a=i[o];if(0!=a.configID){var r=GlobalConfig.SkillsUpgradeConfig[a.lv];r&&s>=r.cost&&a.configID!=e&&(n=!0)}}if(!n)return!1;for(var l=this.getSkillLimitLevel(),o=0;5>o;o++){var a=i[o];if(a.lv>0&&a.lv<l){var h=this.getSingleSkillGrewUpCost(t,o);if(h>0)return!0}}return!1},e.prototype.postShowSkillWord=function(t){return t},e.prototype.postHejiUpdate=function(){},e.prototype.postHejiStartCD=function(){},e.prototype.postHejiRemove=function(){},e.prototype.postHejiEquipChange=function(){},e.prototype.checkIsHaveBestEquip=function(t,e){void 0===e&&(e=-1);var i=this.equipListData[t],n=BagCT.ins().getHejiEquipsByType(t);if(n.length>0)for(var s=200,o=0,a=n;o<a.length;o++){var r=a[o],l=r.itemConfig,h=l.level?l.level:0,u=l.zsLevel?l.zsLevel:0;if(l.level<=s&&(h<=Actor.level||u<=ZsCT.ins().lv)&&l.level<=Actor.level&&u<=ZsCT.ins().lv){var p=0;if(!i||0==i.configID){if(l.useCond)continue;return!0}if(p=i.point,r.point>p&&l.useCond==i.itemConfig.id)return!0}}return!1},e.prototype.sendUpgradeForge=function(t){var e=this.getBytes(13);e.writeShort(t),this.sendToServer(e)},e.prototype.postUpgradeForge=function(t){this.getPunchForge().parser(t)},e.prototype.sendChangeTogeatterHigh=function(t){var e=this.getBytes(14);e.writeInt(t),this.sendToServer(e)},e.prototype.isHejiSkill=function(t){for(var e in GlobalConfig.TogetherHitConfig)if(GlobalConfig.TogetherHitConfig[e].skill_id.indexOf(t)>=0)return!0;return!1},e.ACTIVE_LEVEL=10,e.HEJI_SHOW_LEVEL=60,e.descArr=["合击技能对角色伤害+%s","合击技能对怪物伤害+%s","怒气恢复速度+%s"],__decorate([post()],e.prototype,"doSkillResult",null),__decorate([post()],e.prototype,"postDoBuff",null),__decorate([post()],e.prototype,"postDoRemoveBuff",null),__decorate([post()],e.prototype,"postSkillUpgrade",null),__decorate([post()],e.prototype,"postSkillUpgradeAll",null),__decorate([post()],e.prototype,"postTupo",null),__decorate([post()],e.prototype,"postHejiInfo",null),__decorate([post()],e.prototype,"postShowSkillWord",null),__decorate([post()],e.prototype,"postHejiUpdate",null),__decorate([post()],e.prototype,"postHejiStartCD",null),__decorate([post()],e.prototype,"postHejiRemove",null),__decorate([post()],e.prototype,"postHejiEquipChange",null),__decorate([post()],e.prototype,"postUpgradeForge",null),e}(BaseSystem);__reflect(SkillCT.prototype,"SkillCT"),System.SkillCT=function(){return SkillCT.ins()};var SHORT_SKILLID;!function(t){t[t.MAGIC=24]="MAGIC",t[t.CURE=32]="CURE",t[t.POISONING=33]="POISONING",t[t.ARMOR=34]="ARMOR",t[t.SUMMON=35]="SUMMON"}(SHORT_SKILLID||(SHORT_SKILLID={}));var SkillConst=function(){function t(){}return t.EFF_SKY_BALL=53001,t.HEJI_SKILLS=[71001,72001,73001],t}();__reflect(SkillConst.prototype,"SkillConst"),window.SkillCT=SkillCT;var SkillUtil=function(){function t(){}return t.getDesc=function(t,e){var i=GlobalConfig.SkillsDescConfig[t.desc],n=i?i.desc:"";if(e=e||t.desc_ex)for(var s=e.length,o=0;s>o;o++)n=n.replace("%s","|C:35E62D&T:"+e[o]+"|");return n},t.getName=function(t){var e=GlobalConfig.SkillsDescConfig[t.desc];return e?e.name:""},t.getCD=function(t){var e=GlobalConfig.SkillsDescConfig[t.desc];return e?e.cd:0},t}();__reflect(SkillUtil.prototype,"SkillUtil"),window.SkillUtil=SkillUtil;var WingCT=function(t){function e(){var e=t.call(this)||this;return e.timeID=0,e.godWing=[],e.isListen=!1,e.sysId=PackageID.Wing,e.regNetMsg(1,e.doUpDataWing),e.regNetMsg(2,e.doBoost),e.regNetMsg(3,e.postWingWear),e.regNetMsg(4,e.postActivate),e.regNetMsg(5,e.postGodWingData),e.regNetMsg(8,e.postUseDanSuccess),e.regNetMsg(11,e.postWingEquip),e.regNetMsg(13,e.postKeYin),e.observe(BagCT.ins().postItemAdd,e.startCheckHaveCan),e.observe(BagCT.ins().postItemDel,e.startCheckHaveCan),e.observe(GameLogic.ins().postSubRoleChange,e.startCheckHaveCan),e.observe(Actor.ins().postLevelChange,e.startCheckHaveCan),e.observe(e.postWingUpgrade,e.startCheckHaveCan),e.observe(BagCT.ins().postItemChange,e.startCheckHaveCan),e.observe(e.postUseDanSuccess,e.startCheckHaveCan),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initConfig=function(){if(!this.wingSkillDic){this.wingSkillDic=[];var t=GlobalConfig.WingLevelConfig;for(var e in t)t[e].pasSkillId&&this.wingSkillDic.push(t[e].pasSkillId)}},e.prototype.getWingSkillByIndex=function(t){return this.initConfig(),this.wingSkillDic[t]},e.prototype.startCheckHaveCan=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=-1),this.isListen||(this.isListen=!0,Timer.start(4e3,1,this.showNavBtnRedPoint,this))},e.prototype.sendBoost=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendUpgrade=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.sendActivate=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.dressWingEquip=function(t,e,i){var n=this.getBytes(11);n.writeDouble(e),n.writeShort(t),n.writeShort(i),this.sendToServer(n)},e.prototype.sendBigUpLevel=function(t){var e=this.getBytes(12);e.writeInt(t),this.sendToServer(e)},e.prototype.doBigUpLevel=function(t){var e,i=t.readInt();if(i)e="道具不足够";else{t.readInt()}TipsCT.ins().showTips(e)},e.prototype.doUpDataWing=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).wingsData.parser(t)},e.prototype.doBoost=function(t){var e=t.readShort(),i=SubRoles.ins().getSubRoleByIndex(e).wingsData.lv;SubRoles.ins().getSubRoleByIndex(e).wingsData.parserBoost(t);var n=0,s=t.readInt();if(SubRoles.ins().getSubRoleByIndex(e).wingsData.parserClearTime(t),n=t.readShort(),this.postBoost(n,s),i!=SubRoles.ins().getSubRoleByIndex(e).wingsData.lv){var o=GlobalConfig.WingLevelConfig[SubRoles.ins().getSubRoleByIndex(e).wingsData.lv];o.pasSkillId,SubRoles.ins().getSubRoleByIndex(e).setWingSkill();var a=EntityManager.ins().getMainRole(e);a&&a.updateModel(),this.postWingUpgrade(),Activationtongyong.show(1,o.name,"j"+o.appearance+"_png")}this.postWingTime()},e.prototype.postBoost=function(t,e){return[t,e]},e.prototype.postWingUpgrade=function(){},e.prototype.postActivate=function(t){var e=t.readShort();SubRoles.ins().getSubRoleByIndex(e).wingsData.parserOpenStatus(t);var i=GlobalConfig.WingLevelConfig[0];Activationtongyong.show(0,i.name,"j"+i.appearance+"_png");var n=EntityManager.ins().getMainRole(e);n&&n.updateModel()},e.prototype.postWingEquip=function(t){var e=t.readShort(),i=t.readShort(),n=new ItemData;n.parser(t),SubRoles.ins().getSubRoleByIndex(e).wingsData.getEquipByIndex(i).item=n;var s=EntityManager.ins().getMainRole(e);s&&s.updateModel()},e.prototype.postWingTime=function(){},e.prototype.sendKeYin=function(t){var e=this.getBytes(13);e.writeByte(t),this.sendToServer(e)},e.prototype.postKeYin=function(t){var e=t.readByte(),i=this.getGodWing(e);i.keYinLv=t.readUnsignedShort(),i.keYinExp=t.readUnsignedInt();for(var n in GlobalConfig.GodWingLevelExtraConfig){var s=GlobalConfig.GodWingLevelExtraConfig[n].level;i.keYinLv>=s&&(i.keYinSuitLv=s)}},e.prototype.showNavBtnRedPoint=function(){this.isListen=!1;var t=!1;return Actor.level>=GlobalConfig.WingCommonConfig.openLevel&&!t&&this.and(this.canGradeupWing())?void RoleCT.ins().showNavBtnRedPoint(!0):this.canUseFlyUp()?void RoleCT.ins().showNavBtnRedPoint(!0):this.canUseAptitude()?void RoleCT.ins().showNavBtnRedPoint(!0):void RoleCT.ins().showNavBtnRedPoint(!1)},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.getLevelBySkill=function(t){if(!this.wingSkillLevelDic){this.wingSkillLevelDic=[];var e=GlobalConfig.WingLevelConfig;for(var i in e)e[i].pasSkillId>0&&this.wingSkillLevelDic.push(e[i].level)}return this.wingSkillLevelDic[t]?this.wingSkillLevelDic[t]:0},e.prototype.canGradeupWing=function(){var t=[!1,!1,!1];return t},e.prototype.canItemGradeupWing=function(){for(var t=[!1,!1,!1],i=e.WingMaxLv,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s).wingsData.openStatus;if(o){var a=SubRoles.ins().getSubRoleByIndex(s).wingsData.lv;if(i>a&&a<e.WingExpRedPoint){var r=GlobalConfig.WingLevelConfig[a];if(Assert(r,"get WingLevelConfig null "+a))continue;var l=BagCT.ins().getBagGoodsCountById(0,r.itemId);t[s]=r.itemNum<=l}else t[s]=!1;if(!t[s]){var h=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.WingCommonConfig.levelItemid);t[s]=h>0&&a==e.WingExpRedPoint}}}return t},e.prototype.isHaveActivationWing=function(t){void 0===t&&(t=-1);var e=Actor.level,i=GlobalConfig.WingCommonConfig.openLevel;if(i>e)return!1;var n=SubRoles.ins().subRolesLen;if(-1==t)for(var s=0;n>s;s++){var o=SubRoles.ins().getSubRoleByIndex(s).wingsData;if(!o.openStatus)return!0}else{var o=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(!o.openStatus)return!0}return!1},e.prototype.canRoleOpenWing=function(){for(var t=[!1,!1,!1],e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i).wingsData.openStatus;t[i]=!n&&Actor.level>=16}return t},e.prototype.sendWingWear=function(t,e){var i=this.getBytes(3);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postWingWear=function(t){return t.readBoolean()},e.prototype.postGodWingData=function(t){var e=t.readShort();this.godWing[e]||(this.godWing[e]=new GodWingData),this.godWing[e].parser(t)},e.prototype.sendUseDan=function(t,e){var i=this.getBytes(8);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postUseDanSuccess=function(t){var e=SubRoles.ins().getSubRoleByIndex(t.readByte()).wingsData,i=t.readByte(),n=t.readShort();0==i?e.aptitudeDan=n:e.flyUpDan=n},e.prototype.canUseFlyUp=function(){for(var t=SubRoles.ins().roles.length,e=0;t>e;e++)if(this.canUseFlyUpByRoleID(e))return!0;return!1},e.prototype.canUseFlyUpByRoleID=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);if(e.wingsData&&1==e.wingsData.openStatus){var i=ExpansionCardCT.ins().useDanData,n=i&&i[6]?i[6].addNum:0;if(e.wingsData.flyUpDan<GlobalConfig.WingLevelConfig[e.wingsData.lv].flyPill+n){var s=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),o=s?s.count:0;if(o)return!0}}return!1},e.prototype.canUseAptitude=function(){for(var t=SubRoles.ins().roles.length,e=0;t>e;e++)if(this.canUseAptitudeByRoleID(e))return!0;return!1},e.prototype.canUseAptitudeByRoleID=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);if(e.wingsData&&1==e.wingsData.openStatus){var i=ExpansionCardCT.ins().useDanData,n=i&&i[5]?i[5].addNum:0;if(e.wingsData.aptitudeDan<GlobalConfig.WingLevelConfig[e.wingsData.lv].attrPill+n){var s=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),o=s?s.count:0;if(o)return!0}}return!1},e.prototype.userDans=function(t){for(var e,i,n,s=SubRoles.ins().roles.length,o=null,a=null,r=0,l=0,h=t==GlobalConfig.WingCommonConfig.attrPillId,u=0;s>u;u++)e=SubRoles.ins().getSubRoleByIndex(u),1==e.wingsData.openStatus?(i=GlobalConfig.WingLevelConfig[e.wingsData.lv],n=h&&e.wingsData.aptitudeDan>=i.attrPill||!h&&e.wingsData.flyUpDan>=i.flyPill,n?l++:(o||(o=e),e.wingsData.lv>o.wingsData.lv&&(o=e),a||(a=e),h&&e.wingsData.aptitudeDan>o.wingsData.aptitudeDan&&(a=e),!h&&e.wingsData.flyUpDan>o.wingsData.flyUpDan&&(a=e))):r++;if(r>=s)return void TipsCT.ins().showTips("所有角色均未开启翅膀");if(l>=s)return void TipsCT.ins().showTips("所有角色翅膀"+(h?"资质":"飞升")+"已满级");var p=o.index;o.index!=a.index&&o.wingsData.lv==a.wingsData.lv&&(p=a.index),ViewManager.ins().open(RoleWin,3,p)},e.prototype.sendWingCompose=function(t,e,i){var n=t,s=this.getBytes(6);s.writeShort(n),s.writeInt(e),1==n&&s.writeInt(i),this.sendToServer(s)},e.prototype.sendResetGodWing=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getCurLevelItemId=function(t,e){var i,n;return this.godWing[t]&&(n=this.godWing[t].getLevel(e))?i=GlobalConfig.GodWingLevelConfig[n][e]:null},e.prototype.getNextLevelItemId=function(t,e){var i;return i=this.godWing[t].getLevel(e),i=i?this.getNextLevel(i):0,GlobalConfig.GodWingLevelConfig[i]?GlobalConfig.GodWingLevelConfig[i][e]:null},e.prototype.quickComposeRedPoint=function(t,e){var i=this.getGodWing(t).getLevel(e),n=this.getNextLevel(i);if(!n)return!1;var s=GlobalConfig.GodWingLevelConfig[n][e];return this.checkGodWingLevel(t,s.itemId)?this.checkGodWingItem(t,s.itemId,e):!1},e.prototype.wearItemRedPoint=function(t,e){return this.checkSlotLevel(t,e)},e.prototype.gridRedPoint=function(t,e){return this.wearItemRedPoint(t,e)?!0:this.quickComposeRedPoint(t,e)},e.prototype.isWearGodWing=function(t){var i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;for(var n=1;n<=e.GodWingMaxSlot;n++)if(this.gridRedPoint(i.index,n))return!0;return!1},e.prototype.checkSlot=function(t,e){var i=this.getGodWing(t).getLevel(e);return i?!0:!1},e.prototype.getWearItem=function(t,e){for(var i=this.getGodWing(t).getLevel(e),n=BagCT.ins().getBagGoodsByType(ItemType.TYPE_16),s=0;s<n.length;s++){var o=GlobalConfig.GodWingItemConfig[n[s].configID];if(this.checkGodWingLevel(t,o.itemId)&&o.slot==e&&o.level>i)return o.itemId}return 0},e.prototype.checkSlotLevel=function(t,e){for(var i=this.getGodWing(t).getLevel(e),n=BagCT.ins().getBagGoodsByType(ItemType.TYPE_16),s=0;s<n.length;s++){var o=GlobalConfig.GodWingItemConfig[n[s].configID];if(this.checkGodWingLevel(t,o.itemId)&&o.slot==e&&o.level>i)return!0}return!1},e.prototype.checkGodWingLevel=function(t,e){var i=GlobalConfig.GodWingItemConfig[e],n=0,s=SubRoles.ins().getSubRoleByIndex(t).wingsData;return n+=s.lv,s.openStatus&&(n+=1),n>=i.level},e.prototype.checkGodWingItem=function(t,e,i){var n=GlobalConfig.GodWingItemConfig[e],s=n.composeItem.count,o=0,a=BagCT.ins().getBagItemById(n.composeItem.id);if(a&&(o=a.count),i){var r=this.getGodWing(t).getLevel(i);r&&(s-=1)}return o>=s},e.prototype.isQuicComposeGodWing=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;var n=this.godWing[t].getLevel(e);if(n||(n=this.getStartLevel(e)),!n)return!1;var s=0,o=SubRoles.ins().getSubRoleByIndex(t).wingsData;if(s+=o.lv,o.openStatus&&(s+=1),n>s)return!1;var a=this.getGodWing(t).getLevel(e);if(a&&(n=this.getNextLevel(n),!n))return!1;var r=GlobalConfig.GodWingLevelConfig[n][e].itemId,l=GlobalConfig.GodWingItemConfig[r],h=l.composeItem.count,u=0,p=BagCT.ins().getBagItemById(l.composeItem.id);p&&(u=p.count);var c=this.getGodWing(t).getLevel(e);if(c){var d=GlobalConfig.GodWingLevelConfig[c][e];d.itemId==l.composeItem.id&&(u+=1)}return u>=h},e.prototype.isComposeGodWingOnly=function(t){var e=GlobalConfig.GodWingItemConfig[t],i=e.composeItem.count,n=0,s=BagCT.ins().getBagItemById(e.composeItem.id);return s&&(n=s.count),n>=i},e.prototype.isComposeGodWingAll=function(){for(var t in GlobalConfig.GodWingSuitConfig)for(var i=GlobalConfig.GodWingSuitConfig[t],n=1;n<=e.GodWingMaxSlot;n++){var s=GlobalConfig.GodWingLevelConfig[i.lv][n];if(this.isComposeGodWingOnly(s.itemId))return!0}return!1},e.prototype.isComposeGodWingLevel=function(t,e){var i=GlobalConfig.GodWingLevelConfig[t][e];
return this.isComposeGodWingOnly(i.itemId)},e.prototype.isComposeGodWingSlot=function(t,e){var i=GlobalConfig.GodWingSuitConfig[t],n=GlobalConfig.GodWingLevelConfig[i.lv][e];return this.isComposeGodWingOnly(n.itemId)},e.prototype.isComposeGodWing=function(t){for(var e=(SubRoles.ins().subRolesLen,0);3>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);if(i)for(var n=this.calcGodWingSlot(e),s=0;s<n.length;s++){var o=GlobalConfig.GodWingLevelConfig[n[s].level][n[s].slot];if(t){var a=0,r=SubRoles.ins().getSubRoleByIndex(e).wingsData;if(a+=r.lv,r.openStatus&&(a+=1),a<o.level)continue}var l=GlobalConfig.GodWingItemConfig[o.itemId],h=l.composeItem.id,u=BagCT.ins().getBagItemById(h),p=l.composeItem.count,c=u?u.count:0;if(c>=p)return!0}}return!1},e.prototype.calcGodWingSlot=function(t){for(var i=[],n=1;n<=e.GodWingMaxSlot;n++){var s=this.getGodWing(t).getLevel(n),o={slot:0,level:0};o.slot=n,s||(s=this.getStartLevel(n)),o.level=s,i.push(o)}return i},e.prototype.getStartLevel=function(t){for(var e in GlobalConfig.GodWingLevelConfig){var i=GlobalConfig.GodWingLevelConfig[e];for(var n in i)if(i[n].slot==t)return i[n].level}return 0},e.prototype.getPreLevel=function(t){var e=0;for(var i in GlobalConfig.GodWingLevelConfig)if(e){if(Number(i)==t)return e;e=Number(i)}else e=Number(i);return e},e.prototype.getNextLevel=function(t){var e=[];for(var i in GlobalConfig.GodWingLevelConfig)e.push(+i);e.sort(function(t,e){return Algorithm.sortAsc(t,e)});for(var n=0,s=e;n<s.length;n++){var o=s[n];if(o>t)return o}return 0},e.prototype.getNameFromSlot=function(t){var e="";switch(t){case 1:e="飞羽";break;case 2:e="纤羽";break;case 3:e="绒羽";break;case 4:e="翎羽"}return e},e.prototype.getGodWing=function(t){return this.godWing[t]||(this.godWing[t]=new GodWingData),this.godWing[t]},e.WingMaxLv=9,e.WingExpRedPoint=3,e.GodWingMaxSlot=4,e.hint=!0,__decorate([post()],e.prototype,"postBoost",null),__decorate([post()],e.prototype,"postWingUpgrade",null),__decorate([post()],e.prototype,"postActivate",null),__decorate([post()],e.prototype,"postWingEquip",null),__decorate([post()],e.prototype,"postWingTime",null),__decorate([post()],e.prototype,"postKeYin",null),__decorate([post()],e.prototype,"postWingWear",null),__decorate([post()],e.prototype,"postGodWingData",null),__decorate([post()],e.prototype,"postUseDanSuccess",null),e}(BaseSystem);__reflect(WingCT.prototype,"WingCT");var GodWingData=function(){function t(){this.data={},this.keYinLv=0,this.keYinExp=0,this.keYinSuitLv=0}return t.prototype.parser=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort(),s=t.readInt();this.data[n]={slot:n,level:s}}},t.prototype.getLevel=function(t){return this.data[t]?this.data[t].level:0},t.prototype.getData=function(){return this.data},t.prototype.getSuitLevel=function(){var t=Number.MAX_VALUE,e=0;for(var i in this.data)this.data[i].level<t&&(e=this.data[i].slot,t=this.data[i].level);if(!e)return 0;var n=GlobalConfig.GodWingLevelConfig[t][e];if(!n)return 0;var s=[];for(var o in GlobalConfig.GodWingItemConfig){var a=GlobalConfig.GodWingItemConfig[o];if(s.length>=WingCT.GodWingMaxSlot)break;a.level>=n.level&&n.slot!=a.slot&&this.data[a.slot]&&this.data[a.slot].level>=a.level&&s.push(a.itemId)}return s.length>=WingCT.GodWingMaxSlot-1?t:0},t.prototype.getSuitSum=function(){var t=this.getSuitLevel(),e=0;for(var i in this.data)this.data[i].level>=t&&e++;return e},t}();__reflect(GodWingData.prototype,"GodWingData"),System.WingCT=function(){return WingCT.ins()},window.WingCT=WingCT;var EquipsData=function(){function t(){}return t.prototype.parser=function(t){this.strengthen=t.readInt(),this.spiritLv=t.readInt(),this.gem=t.readInt(),this.item=new ItemData,this.item.parser(t),this.zhuling=t.readInt(),this.soulLv=t.readInt(),this.bless=t.readInt(),this.spiritExp=t.readInt()},t}();__reflect(EquipsData.prototype,"EquipsData"),window.EquipsData=EquipsData;var JingMaiData=function(){function t(){}return t.prototype.parser=function(t){this.level=t.readInt(),this.stage=t.readInt()},t.prototype.jingMaiCanUp=function(){var t=GlobalConfig.JingMaiStageConfig[this.stage];if(t.stage>=GlobalConfig.JingMaiCommonConfig.stageMax)return!1;var e=GlobalConfig.JingMaiLevelConfig[this.level],i=BagCT.ins().getBagGoodsCountById(0,e.itemId);return i>=e.count},t}();__reflect(JingMaiData.prototype,"JingMaiData"),window.JingMaiData=JingMaiData;var PunchEquipForgeData=function(){function t(){this.data=[]}return t.prototype.parser=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort(),s=t.readInt();if(this.data[n])this.data[n].id=n,this.data[n].level=s;else{var o=new PunchEquipData;o.id=n,o.level=s,this.data[n]=o}}},Object.defineProperty(t.prototype,"level",{get:function(){for(var t=0,e=0;e<this.data.length;e++){var i=this.data[e];t+=i.level}return t},enumerable:!0,configurable:!0}),t.prototype.getSuitlevel=function(){var t=0;for(var e in GlobalConfig.PunchEquipMasterConfig){var i=GlobalConfig.PunchEquipMasterConfig[e];Math.floor(this.level/8)>=i.level&&(t=i.level)}return t},t.prototype.getNextSuitlevel=function(){var t=0;for(var e in GlobalConfig.PunchEquipMasterConfig){var i=GlobalConfig.PunchEquipMasterConfig[e];if(i.level>Math.floor(this.level/8)){t=i.level;break}}return t},t.prototype.getPunchLevel=function(t){return this.data[t].level},t.prototype.getCurCost=function(){for(var t,e,i=!0,n=0;8>n;n++){var s=this.data[n];n?e<s.level&&(i=!1,t=n,e=s.level):(t=n,e=s.level)}return i&&(t=0,e++),GlobalConfig.PunchEquipConfig[t][e]},t.prototype.getNextConfig=function(t){var e=t+1,i=this.getPunchLevel(t);return e>7&&(e=0,i=this.getPunchLevel(e)+1),GlobalConfig.PunchEquipConfig[e][i]},t.prototype.getPosNextLevelConfig=function(t){var e=this.getPunchLevel(t);return e++,GlobalConfig.PunchEquipConfig[t][e]},t.prototype.isShowPunchEquipForge=function(){for(var t=SkillCT.ins().equipListData,e=0;e<t.length;e++){var i=t[e];if(!i.itemConfig||!i.itemConfig.zsLevel||i.itemConfig.zsLevel<4)return!1}return!0},t.prototype.isUpgradePunchForge=function(e){var i=1;if(this.data[e]&&(i=this.data[e].level),!GlobalConfig.PunchEquipConfig[e][i+1])return t.TYPE_MAX;i||(i=1);var n=GlobalConfig.PunchEquipConfig[e][i+1],s=0;return n.cost.id==MoneyConst.punch1?s=Actor.togeatter1:n.cost.id==MoneyConst.punch2&&(s=Actor.togeatter2),s>=n.cost.count?t.TYPE_OK:t.TYPE_NO},t.prototype.calcSelectPos=function(){for(var t,e,i=!0,n=0;8>n;n++)if(this.data[n]){var s=this.data[n];n?e>s.level&&(i=!1,t=n,e=s.level):(t=n,e=s.level)}return i&&(t=0,e++),t},t.prototype.getRedPoint=function(){if(!this.isShowPunchEquipForge())return!1;for(var e=0,i=8,n=0;i>n;n++){var s=this.isUpgradePunchForge(n);if(s==t.TYPE_NO)return!1;s==t.TYPE_MAX&&e++}return e==i?!1:!0},t.prototype.getAttributeData=function(){for(var t=[],e=0;e<this.data.length;e++){var i=this.data[e].id,n=this.data[e].level,s=GlobalConfig.PunchEquipConfig[i][n];if(s)for(var o=0;o<s.attr.length;o++)if(t.length){for(var a=!1,r=0;r<t.length;r++)t[r].type==s.attr[o].type&&(a=!0,t[r].value+=s.attr[o].value);if(!a){var l=new AttributeData;l.type=s.attr[o].type,l.value=s.attr[o].value,t.push(l)}}else{var l=new AttributeData;l.type=s.attr[o].type,l.value=s.attr[o].value,t.push(l)}}return t},t.TYPE_NO=0,t.TYPE_OK=1,t.TYPE_MAX=2,t}();__reflect(PunchEquipForgeData.prototype,"PunchEquipForgeData");var PunchEquipData=function(){function t(){}return t}();__reflect(PunchEquipData.prototype,"PunchEquipData"),window.PunchEquipForgeData=PunchEquipForgeData;var WingsData=function(){function t(){this.openStatus=0,this.clearTime=0,this.aptitudeDan=0,this.flyUpDan=0}return t.prototype.getEquipByIndex=function(t){return this.equipdata[t]},Object.defineProperty(t.prototype,"equipsLen",{get:function(){return this.equipdata.length},enumerable:!0,configurable:!0}),t.prototype.parser=function(t){this.parserBoost(t),this.parserOpenStatus(t),this.parserClearTime(t),this.parserDans(t)},t.prototype.parserBoost=function(t){this.lv=t.readInt(),this.exp=t.readUnsignedInt()},t.prototype.parserOpenStatus=function(t){this.openStatus=t.readInt()},t.prototype.parserClearTime=function(t){this.clearTime=t.readUnsignedInt()},t.prototype.parserDans=function(t){this.aptitudeDan=t.readShort(),this.flyUpDan=t.readShort()},t.prototype.parserWingEqupip=function(t){this.equipdata=[];for(var e,i=0;4>i;i++)e=new EquipsData,e.parser(t),this.equipdata.push(e)},t.prototype.getImgSource=function(){return this.lv>WingCT.WingMaxLv||this.lv<0?"":GlobalConfig.WingLevelConfig[this.lv].appearance+"_png"},t.getWingAllLevel=function(){for(var t=0,e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i).wingsData;t+=n.lv,n.openStatus&&(t+=1)}return t},t}();__reflect(WingsData.prototype,"WingsData"),window.WingsData=WingsData;var RoleAttrItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleAttrItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&this.data instanceof Array&&2==this.data.length&&(this.eName.text=this.data[0],this.eVal.textFlow=TextFlowMaker.generateTextFlow(this.data[1]))},e}(BaseItemRender);__reflect(RoleAttrItem.prototype,"RoleAttrItem"),window.RoleAttrItem=RoleAttrItem;var RoleAttrWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isMove=!1,e._sn_="RoleAttrSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=RoleAttViewItem},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=t[0],this._otherPlayerData=t[1],this.roleNum=this._otherPlayerData?this._otherPlayerData.roleData.length:SubRoles.ins().subRolesLen,this.setRoleAttr(this.curRole),this.addTouchEndEvent(this,this.onClick)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.leftBtn:this.curRole>0&&!this.isMove&&(this.curRole--,this.setRoleAttr(this.curRole),this.moveAttr(this.eList.width/2));break;case this.rightBtn:this.curRole<this.roleNum&&!this.isMove&&(this.curRole++,this.setRoleAttr(this.curRole),this.moveAttr(-this.eList.width/2))}},e.prototype.setRoleAttr=function(t){var e=this._otherPlayerData?this._otherPlayerData.roleData[t]:SubRoles.ins().getSubRoleByIndex(t);this.job.source="op_"+e.job;for(var i=[],n=GlobalConfig.ClientGlobalConfig.showAttrs,s=0;s<n.length;s++)i.push([s,e]);this.eList.dataProvider=new eui.ArrayCollection(i),this.setBtn()},e.prototype.moveAttr=function(t){var e=this;this.job.visible=!1,this.isMove=!0;var i=egret.Tween.get(this.eList);i.to({horizontalCenter:t,alpha:0},200).to({horizontalCenter:-t},200).to({horizontalCenter:0,alpha:1},200).call(function(){e.job.visible=!0,e.isMove=!1})},e.prototype.setBtn=function(){this.leftBtn.visible=this.curRole>0,this.rightBtn.visible=this.curRole+1<this.roleNum},e}(BaseEuiView);__reflect(RoleAttrWin.prototype,"RoleAttrWin"),window.RoleAttrWin=RoleAttrWin,ViewManager.ins().reg(RoleAttrWin,LayerManager.UI_Popup);var RoleAttViewItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RoleAttrPanelSkin",e.eList.itemRenderer=RoleAttrItem,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array&&2==this.data.length){var t=this.data[0],e=this.data[1];this.eTitle.text=GlobalConfig.ClientGlobalConfig.attrsTitle[t];var i=[],n=GlobalConfig.ClientGlobalConfig.showAttrs[t],s=new AttributeData;for(var o in n){var a=n[o],r=AttributeData.getAttrStrByType(a),l=r;2==r.length&&(l=StringUtils.complementByChar(r[0],9)+r[1]);var h=e.getAtt(a);s.type=a,s.value=h;var u=AttributeData.getAttStrByType(s,0,"",!1,!1),p=void 0;switch(t){case 1:p=11416022;break;case 2:p=15713308;break;default:p=12691009}i.push([l+"：","|C:"+p+"&T:"+u+"|"])}this.eList.dataProvider=new eui.ArrayCollection(i)}},e}(BaseItemRender);__reflect(RoleAttViewItem.prototype,"RoleAttViewItem"),window.RoleAttViewItem=RoleAttViewItem;var RoleChooseEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemList=[],e.pos=0,e.roleSelect=0,e.itemType=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.skinName="RoleChooseEquipSkin",this.list.itemRenderer=RoleEquipChooseItem,this.wearItem=new RoleEquipChooseItem,this.itemGroup.addChild(this.wearItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleSelect=t[0],this.pos=t[1],this.itemType=t[2]?t[2]:0,this.data=t[3]||null;var i,n=SubRoles.ins().getSubRoleByIndex(this.roleSelect);switch(this.itemType){case ItemType.TYPE_28:i=n.getSoulSuitDataByPos(this.pos),this.itemList=BagCT.ins().getSoulSuitsByPos(this.pos);break;case ItemType.TYPE_33:i=n.getPowerEquipDataByPos(this.pos),this.itemList=BagCT.ins().getPowerEquipByPos(this.pos);break;case ItemType.TYPE_34:var s=ShieldCT.ins().getSkieldInfoByRoleIdPos(this.roleSelect,this.pos);s&&s.itemId>0&&(i=new ItemData,i.init(),i.configID=s.itemId),this.itemList=BagCT.ins().getBagGoodsByTypeAndSubType(ItemType.TYPE_34,this.pos),this.itemList.sort(this.itemListSort);break;case ItemType.TYPE_36:i=n.getXinmoEquipDataByPos(this.pos),this.itemList=BagCT.ins().getXMPowerEquipByPos(this.pos,ItemType.TYPE_36),this.itemList.sort(this.xinmoItemListSort);break;case ItemType.TYPE_41:this.itemList=[];var o=SmmzCT.ins().getBagSmItemBySmIdPos(this.data.smId,this.pos);for(var a in o){var r=o[a].copy();r.tempData=this.data,this.itemList.push(r)}break;default:this.itemList=BagCT.ins().getEquipByPos(this.roleSelect,this.pos);var l=n.getEquipDataByPos(this.pos);l&&(i=l.item)}this.wearItem.setUpImage(!1),this.wearItem.data=i,this.wearItem.setBtnStatu();var h=0;if(i&&0!=i.configID){this.scroll.y=170,this.scroll.height=400,this.wearItem.visible=!0,h=i.point;var u=0==ItemUtil.getJob(i.itemConfig)?n.job:ItemUtil.getJob(i.itemConfig);BagCT.ins().setEquipPowerDic(u,ItemUtil.getSubType(i.itemConfig),h)}else this.scroll.y=50,this.scroll.height=520,this.wearItem.visible=!1;this.list.dataProvider=new eui.ArrayCollection(this.itemList),this.list.validateNow(),this.eTips.visible=this.itemList.length<=0,this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this,this.itemTap)},e.prototype.itemListSort=function(t,e){return t.point<e.point?1:t.point>e.point?-1:0},e.prototype.xinmoItemListSort=function(t,e){if(t.point<e.point)return 1;if(t.point>e.point)return-1;var i=XinMoEquipCT.ins().getFmCount(t),n=XinMoEquipCT.ins().getFmCount(e);return n>i?1:i>n?-1:0},e.prototype.itemTap=function(t){if("changeBtn"==t.target.name){var e=t.target.parent.data;if(e&&e instanceof ItemData){if(this.itemType==ItemType.TYPE_28)SoulSuitCT.ins().sendSoulSuitWear(e.handle,this.pos,this.roleSelect);else if(this.itemType==ItemType.TYPE_33)EquipCT.ins().sendPowerEquipWear(e.handle,this.roleSelect,this.pos);else if(this.itemType==ItemType.TYPE_34)ShieldCT.ins().sendEquip(e.handle,this.roleSelect,this.pos);else if(this.itemType==ItemType.TYPE_36)XinMoEquipCT.ins().CGreplaceXmEquip(e.handle,this.roleSelect,this.pos);else if(this.itemType==ItemType.TYPE_41)SmmzCT.ins().sendPutOn(this.roleSelect,this.data.smId,e.configID);else{var i=Actor.level,n=ZsCT.ins().lv;if(e.itemConfig&&!(n>=(e.itemConfig.zsLevel||0)&&i>=(e.itemConfig.level||1)))return 5==ItemUtil.getQuality(e.itemConfig)?void TipsCT.ins().showTips("|C:0xF3311E&T:"+e.itemConfig.name+"）达到"+e.itemConfig.zsLevel+"转"+(e.itemConfig.level||1)+"级可穿戴|"):void TipsCT.ins().showTips("|C:0xF3311E&T:等级不足，无法穿戴|");EquipCT.ins().sendWearEquipment(e.handle,this.pos,this.roleSelect)}ViewManager.ins().close(this),SoundUtil.play(SoundEnum.EQUIP)}}},e.prototype.onTap=function(t){ViewManager.ins().close(this)},e.prototype.sortFun=function(t,e){var i=BagCT.ins().getEquipAttrs(t),n=BagCT.getAttrPower(i),s=BagCT.ins().getEquipAttrs(e),o=BagCT.getAttrPower(s);return Algorithm.sortDesc(n,o)},e}(BaseEuiView);__reflect(RoleChooseEquipWin.prototype,"RoleChooseEquipWin"),window.RoleChooseEquipWin=RoleChooseEquipWin,ViewManager.ins().reg(RoleChooseEquipWin,LayerManager.UI_Popup);var RoleChooseItemWin=function(t){function e(){var e=t.call(this)||this;return e.initMc(),e.skinName="weaponSoulUse",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.id=t[0],this.addTouchEvent(this,this.onClick),this.addTouchEvent(this.btntupo,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.observe(Weapons.ins().postWeaponsFlexibleCount,this.otherClose),this.init(),this.setCurRole(this.id)},e.prototype.init=function(){this.roles=[this.role1,this.role2,this.role3];for(var t=0;2>t;t++){var e=this.roleMovie[t];this.roles[t+1].addChild(e)}this.updateRole(),this.updateSelect(this.id)},e.prototype.getCurRole=function(){return this.id},e.prototype.setCurRole=function(t){this.id=t;for(var e=0;e<this.roles.length;e++){var i=this.roles[e];i.selected=e==t}this.dispatchEventWith(egret.Event.CHANGE,!1,this.id)},e.prototype.initMc=function(){this.roleMovie=[];for(var t=0;2>t;t++){var e=new MovieClip;e.x=44,e.y=44,e.touchEnabled=!1,this.roleMovie.push(e)}},e.prototype.onTouch=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this);break;case this.btntupo:var e=SubRoles.ins().getSubRoleByIndex(this.id);if(!e)return void TipsCT.ins().showTips("角色数据异常");if(e.weapons.flexibleCount-1>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum)return void TipsCT.ins().showTips("每角色兵魂之灵最大使用上限为"+GlobalConfig.WeaponSoulBaseConfig.maxItemNum);Weapons.ins().sendWeaponsFlexibleCount(this.id)}},e.prototype.onClick=function(t){var e=this.roles.indexOf(t.target);e>-1&&this.changeRole(e)},e.prototype.changeRole=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);e?(this.setCurRole(t),this.updateSelect(t)):(ViewManager.ins().open(NewRoleWin),this.roles[t].selected=!1,ViewManager.ins().close(this))},e.prototype.updateSelect=function(t){for(var e=1;3>=e;e++)this["selectrole"+e].visible=t+1==e;var i=SubRoles.ins().getSubRoleByIndex(t);this.btntupo.visible=i.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum;var n=i.weapons.flexibleCount;n=n?n-1:1,n=n>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:n;var s=GlobalConfig.WeaponSoulItemAttr[n],o=i.weapons.flexibleCount?n+1:n,a=GlobalConfig.WeaponSoulItemAttr[o],r=i.weapons.flexibleCount?n:0;r=r>=GlobalConfig.WeaponSoulBaseConfig.maxItemNum?GlobalConfig.WeaponSoulBaseConfig.maxItemNum:r,this.curUse.text=r+"",this.nextUse.visible=!0;for(var e=0;4>e;e++)this["name"+e].text=AttributeData.getAttrStrByType(s.attr[e].type),this["tpattr"+e].text=i.weapons.flexibleCount?s.attr[e].value:0,a?(this.nextUse.text=o+"",this["ntpattr"+e].visible=this["dir"+e].visible=!0,this["ntpattr"+e].text=a.attr[e].value):(this["ntpattr"+e].visible=this["dir"+e].visible=!1,this.nextUse.visible=!1);this.dir.visible=this.nextUse.visible,this.material.data=GlobalConfig.WeaponSoulBaseConfig.itemid},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateRole=function(){for(var t,e,i=this.roles.length,n=0;i>n;n++){if(t=this.roles[n],e=SubRoles.ins().getSubRoleByIndex(n))t.jobImg.visible=!0,t.jobImg.source="job"+e.job+"Item",t.stageImg.visible=!1,t.stageImg.source="",t.icon="yuanhead"+e.job+e.sex,this.roleMovie[n-1]&&DisplayUtils.removeFromParent(this.roleMovie[n-1]);else{var s=GlobalConfig.NewRoleConfig[n];if(!s){var o=egret.getQualifiedClassName(this.parent);Assert(!1,"角色索引"+n+"不存在，出错类："+o);continue}t.jobImg.visible=!1,t.stageImg.visible=!0,s.zsLevel?ZsCT.ins().lv<s.zsLevel?t.stageImg.source="toujiesuo"+s.zsLevel:t.stageImg.source="toujiesuo":Actor.level<s.level?t.stageImg.source="toujiesuo"+s.level:t.stageImg.source="toujiesuo",s.vip&&Actor.vip>=s.vip&&(t.stageImg.source="toujiesuo"),t.icon=""}this.roleMovie[n-1]&&"toujiesuo"==t.stageImg.source&&t.stageImg.visible&&(this.roleMovie[n-1].playFile(RES_DIR_EFF+"OpenRole2",-1),this.showRedPoint(n,!0))}},e.prototype.showRedPoint=function(t,e){null!=this.roles&&(this.roles[t].redPoint.visible=e)},e.prototype.otherClose=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RoleChooseItemWin.prototype,"RoleChooseItemWin"),ViewManager.ins().reg(RoleChooseItemWin,LayerManager.UI_Popup),window.RoleChooseItemWin=RoleChooseItemWin;var RoleEquipChooseItem=function(t){function e(){var e=t.call(this)||this;return e.showUpimage=!0,e.skinName="RoleChooseEquipItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.itemConfig){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this);var t,e,i=this.data,n=ItemUtil.getType(this.data.itemConfig);n==ItemType.TYPE_36?(this.nameTxt.visible=this.itemIcon.visible=!1,this.xinMoItemIcon.visible=!0,this.xinMoItemIcon.data=i,t=BagCT.ins().getEquipAttrs(this.data),e=this.data.point):n==ItemType.TYPE_41?(this.nameTxt.visible=this.itemIcon.visible=!0,this.xinMoItemIcon.visible=!1,this.itemIcon.setData(this.data.itemConfig),this.nameTxt.text=i.itemConfig.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.data.itemConfig),t=GlobalConfig.ShenmoEquipConfig[this.data.configID].attr,e=BagCT.getAttrPower(t)):(this.nameTxt.visible=this.itemIcon.visible=!0,this.xinMoItemIcon.visible=!1,this.itemIcon.setData(this.data.itemConfig),this.nameTxt.text=i.itemConfig.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.data.itemConfig),t=BagCT.ins().getEquipAttrs(this.data),e=this.data.point),this.power.text="评分："+e;var s=ItemUtil.getSubType(this.data.itemConfig);this.upImg.x=this.power.x+this.power.textWidth+10;var o=Actor.level>=(this.data.itemConfig.level||1)&&ZsCT.ins().lv>=(this.data.itemConfig.zsLevel||0),a=o?"0x35E62D":"0xfe4444";if(n==ItemType.TYPE_34)this.levelStrText.text="品质:",this.levelText.text=ShieldCT.getQualityLabByItemId(this.data.itemConfig.id);else if(s==EquipPos.DZI)this.levelStrText.text="等阶:",this.levelText.text=BagCT.ins().getGuanyinLevel(i.itemConfig);else if(n==ItemType.TYPE_36)this.levelStrText.text="阶级:",this.levelText.text=GlobalConfig.DemonsEquipSystemEquipConfig[this.data.itemConfig.id].stage+1+"阶";else if(n==ItemType.TYPE_41){this.levelStrText.text="品质:",this.levelText.textFlow=TextFlowMaker.generateTextFlow(SmmzCT.ins().getQualityLabByItemId(i.configID));var r=GlobalConfig.ShenmoEquipConfig[this.data.configID].pos,l=this.data.tempData;o=this.data.configID>l.itemIds[r]}else{this.levelStrText.text="等级:";var h=isNaN(this.data.itemConfig.zsLevel)?(this.data.itemConfig.level||1)+"级":this.data.itemConfig.zsLevel+"转";this.levelText.textFlow=TextFlowMaker.generateTextFlow("|C:"+a+"&T:"+h+"|")}var u=0;if(this.now.visible=!this.showUpimage,this.data.itemConfig.job)u=ItemUtil.getJob(this.data.itemConfig);else{var p=ViewManager.ins().getView(RoleChooseEquipWin),c=p.roleSelect,d=SubRoles.ins().getSubRoleByIndex(c);u=d.job}var g=BagCT.ins().getEquipPowerDic(u,s);if(e>g&&this.showUpimage&&o){this.upImg.visible=!0;var f=egret.Tween.get(this.upImg,{loop:!0});f.to({y:this.upImg.y-3},250).to({y:this.upImg.y+3},250)}else this.upImg.visible=!1;0==this.itemIndex&&this.showUpimage&&o&&e>g?(this.best.visible=!0,this.best.x=this.upImg.x+this.upImg.width+9):this.best.visible=!1;for(var v="",y=0;y<t.length;y++)if(0!=t[y].type&&0!=t[y].value){var h=AttributeData.getAttrNameByAttrbute(t[y],!0);v+=h+"\n"}this.attr1.textFlow=(new egret.HtmlTextParser).parser(v),ZsCT.ins().lv<(this.data.itemConfig.zsLevel||0)||Actor.level<(this.data.itemConfig.level||1)?this.changeBtn.visible=!1:this.changeBtn.visible=!0}},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),egret.Tween.removeTweens(this.upImg)},e.prototype.setUpImage=function(t){this.showUpimage=t},e.prototype.setBtnStatu=function(){this.changeBtn.visible=!1,this.now.visible=!0},e}(eui.ItemRenderer);__reflect(RoleEquipChooseItem.prototype,"RoleEquipChooseItem"),window.RoleEquipChooseItem=RoleEquipChooseItem;var RoleInfoPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.equips=[],e.beforeIndex=-1,e.log="RoleInfoPanel ",e}return __extends(e,t),e.prototype.addDisplay=function(){this.log+="addDisplay ",this.observe(EquipCT.ins().postEquipChange,this.updataEquip),this.observe(EquipCT.ins().postAddSpirit,this.updataEquip),this.observe(EquipCT.ins().postAddSoul,this.updataEquip),this.observe(SpecialRing.ins().postRingUpdate,this.updateRing),this.observe(ForgeCT.ins().postForgeTips,this.delayRedPoint),this.observe(GameLogic.ins().postRuneExchange,this.delayRedPoint),this.observe(GameLogic.ins().postRuneShatter,this.delayRedPoint),this.observe(Rune.ins().postInlayResult,this.delayRedPoint),this.observe(BagCT.ins().postHuntStore,this.delayRedPoint),this.observe(Dress.ins().postChangeWing,this.setWing),this.observe(LongHun.ins().postDateUpdate,this.updateLoongSoul),this.observe(LongHun.ins().postStageActive,this.updateLoongSoul),this.observe(ShenshouRedpoint.ins().postRedPoint,this.updateLoongSoul),this.observe(Dress.ins().postDressInfo,this.setFashionRetPoint),this.observe(SpecialRing.ins().postActiveRing,this.delayRedPoint),this.observe(FbCT.ins().postFbRingInfo,this.delayRedPoint),this.observe(Heirloom.ins().postHeirloomInfo,this.setRoleEff),this.observe(Weapons.ins().postWeaponsUse,this.setRoleEff),this.observe(BagCT.ins().postItemAdd,this.delayRedPoint),this.observe(BagCT.ins().postItemDel,this.delayRedPoint),this.observe(BagCT.ins().postItemChange,this.delayRedPoint),this.observe(BagCT.ins().postItemCountChange,this.delayRedPoint),this.observe(FbCT.ins().postFbRingInfo,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LyMark.ins().postMarkData,this.delayRedPoint),this.observe(LegendEquipRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(SpiritEquipRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(PowerEquipAwakeRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(SmRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(DemonCirRedPoint.ins().postRedPoint,this.delayRedPoint),this.observe(OfficalPostRedPoint.ins().postRoleRedPoint,this.setCanChange),this.updateOneKey(this.okc)},e.prototype.removeDisplay=function(){this.log+="removeDisplay "},Object.defineProperty(e.prototype,"curRole",{get:function(){return this._curRole},set:function(t){this._curRole=t,this.skin&&void 0!=t&&(this.updateRing(),this.updateLoongSoul(),this.setRetPoint(),this.updataEquip(!1),this.setFashionRetPoint(),this.clearChangeEff(),-1!=this.beforeIndex?this.roleChange(this.beforeIndex,this.curRole):(this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soldierSoulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWing()),this.beforeIndex=this.curRole,this.setSuitEquips(),this.setDemonCir())},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.log+="skinComplete ",this.touchEnabled=!1,this.touchChildren=!0,this.groupRole.touchEnabled=!1,this.groupRoleNext.touchEnabled=!1,this.groupRole.touchChildren=!1,this.groupRoleNext.touchChildren=!1;for(var t=0;t<EquipPos.MAX;t++)this.equips[t]=this["item"+t],this.equips[t].touchEnabled=!0,this.equips[t].isShowJob(!1),this.equips[t].isShowTips(!1),this["redPoint"+t].touchEnabled=!1;this.eff=new MovieClip,this.eff.x=this.oneKeyChange.width/2,this.eff.y=this.oneKeyChange.height/2,this.eff.scaleX=.85,this.eff.scaleY=.85,this.eff.touchEnabled=!1,this.suitEff=new MovieClip,this.suitEff.x=this.suitImg.x,this.suitEff.y=this.suitImg.y,this.suitEff3=new MovieClip,this.suitEff3.x=this.suitImg1.x,this.suitEff3.y=this.suitImg1.y,this.suitEff2=new MovieClip,this.suitEff4=new MovieClip,this.suitEff5=new MovieClip,this.suitEff6=new MovieClip,this.suitEff7=new MovieClip,this.suitEff8=new MovieClip,this.suitEff9=new MovieClip,this.suitEff10=new MovieClip,this.wefbodyMc=new MovieClip,this.wefbodyMc.visible=!1,this.eBodyMCGroup.addChild(this.wefbodyMc),this.bodyMc=new MovieClip,this.bodyMc.visible=!1,this.eBodyMCGroup.addChild(this.bodyMc),this.wingMc=new MovieClip,this.wingMc.visible=!1,this.eWingMCGroup.addChild(this.wingMc),this.addTouchEvent(this.shuzhuang,this.onClick),this.addTouchEvent(this.bless0,this.onClick),this.addTouchEvent(this.bless1,this.onClick),this.addTouchEvent(this.oneKeyChange,this.onClick),this.addTouchEvent(this.roleInfoItem0,this.onClick),this.addTouchEvent(this.roleInfoItem1,this.onClick),this.addTouchEvent(this.shenlu,this.onClick),this.addTouchEvent(this.orange,this.onClick),this.addTouchEvent(this.heirloom,this.onClick),this.addTouchEvent(this.rune,this.onClick),this.addTouchEvent(this.juesexiangxi,this.onClick),this.curRole=this.curRole},e.prototype.clear=function(){this.beforeIndex=-1},e.prototype.setDemonCir=function(){var t=DemonCir.ins().getRoleDataByID(this.curRole);t&&t.showID>0?(this.deEff||(this.deEff=ObjectPool.pop("MovieClip")),this.deEff.parent||this.demonCirEff.addChild(this.deEff),this.deEff.playFile(""+RES_DIR_EFF+GlobalConfig.DemonCirBase[t.showID].footEff,-1)):this.clearDemonEff()},e.prototype.clearDemonEff=function(){this.deEff&&(DisplayUtils.removeFromParent(this.deEff),this.deEff=null)},e.prototype.clearChangeEff=function(){egret.Tween.removeTweens(this.groupRole),egret.Tween.removeTweens(this.groupRoleNext),this.groupRole.x=0,this.groupRoleNext.x=580,this.groupRole.alpha=1,this.groupRoleNext.alpha=0,this.groupRoleNext.visible=!1,this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setWing(this.curRole,this.wingImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soldierSoulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.roleChange=function(t,e){if(t==e)return void this.clearChangeEff();this.groupRoleNext.visible=!0,this.setWing(t,this.wingImg),this.setWing(e,this.nextWingImg),this.setRole(t,this.bodyImg,this.weaponImg),this.setRole(e,this.nextBodyImg,this.nextWeaponImg),this.setSuit(t,this.suitImg,this.suitEff),this.setSuit(e,this.suitImg1,this.suitEff3),this.setWeaponsSuit(t,"sef",this.soldierSoulEff,this.suitEff2),this.setWeaponsSuit(e,"nsef",this.nsoulEff,this.suitEff4),this.setWeaponEffect(t,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(e,"nwsef",this.nsoulEff,this.suitEff6),this.setWeaponEffect(t,"bodyEffect",this.bodyEff,this.suitEff7,2),this.setWeaponEffect(e,"nbodyEffect",this.nbodyEff,this.suitEff8,2);var i=egret.Tween.get(this.groupRole),n=egret.Tween.get(this.groupRoleNext);e>t?(this.groupRoleNext.x=580,i.to({x:-580,alpha:0},600),n.to({x:0,alpha:1},600).call(this.clearChangeEff,this)):(this.groupRoleNext.x=-580,i.to({x:580,alpha:0},600),n.to({x:0,alpha:1},600).call(this.clearChangeEff,this))},e.prototype.updateLoongSoul=function(){this.redPointShenlu.visible=LongHun.ins().canShowRedPointInAll()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint},e.prototype.updateRing=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole).exRingsData;t[0]>0?(this.roleInfoItem0.setImgSource(0,1),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality4"),this.roleInfoItem0.setRedPointVisibel(!1)):(this.roleInfoItem0.setImgSource(0,0),this.roleInfoItem0.setLv(0),this.roleInfoItem0.setNameTxt("麻痹戒指"),this.roleInfoItem0.setBgValue("quality0"),this.roleInfoItem0.setRedPointVisibel(this.showRingRed(0))),t[1]>0?(this.roleInfoItem1.setImgSource(1,1),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality4"),this.roleInfoItem1.setRedPointVisibel(!1)):(this.roleInfoItem1.setImgSource(1,0),this.roleInfoItem1.setLv(0),this.roleInfoItem1.setNameTxt("护身戒指"),this.roleInfoItem1.setBgValue("quality0"),this.roleInfoItem1.setRedPointVisibel(this.showRingRed(1)))},e.prototype.showRingRed=function(t){var e=GlobalConfig["ExRing"+t+"Config"][0],i=GlobalConfig.ExRingConfig[t],n=BagCT.ins().getBagGoodsCountById(0,i.costItem);
return n>=e.cost},e.prototype.updataEquip=function(t){void 0===t&&(t=!0),this.log+="updataEquip-"+t+"  ";var e=SubRoles.ins().getSubRoleByIndex(this.curRole);this.setEquip(e),t?Timer.start(300,1,this.onDelayReflash,this):this.onDelayReflash(),this.setSuitEquips()},e.prototype.onDelayReflash=function(){RoleCT.ins().setCanChange()},e.prototype.setEquip=function(t){if(t){var e=t.getEquipLen();if(this.log+="setEquip ",0==this.equips.length)return this.log+="setEquip skinName="+this.skinName+",skin="+!!this.skin+" ",void platform.reportError(this.log);this.weaponImg.source="";for(var i=0;e>i;i++){var n=t.getEquipByIndex(i);this.equips[i].setModel(t),this.equips[i].setCurRole(this.curRole),this.equips[i].setIndex(i),this.equips[i].data=n.item,0==n.item.configID?(this.equips[i].setItemImg(i>EquipPos.MAX?"":"xb_1"+ForgeConst.EQUIP_POS_TO_SUB[i]),this.equips[i].isShowTips(!1),this.addTouchEvent(this.equips[i],this.onClick)):(this.equips[i].isShowTips(!0),this.removeTouchEvent(this.equips[i],this.onClick))}this.powerPanel.setPower(t.power),this.setRole(this.curRole,this.bodyImg,this.weaponImg),this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soldierSoulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)}},e.prototype.setRole=function(t,e,i){e.source=null,i.source=null;var n,s=SubRoles.ins().getSubRoleByIndex(t),o=s.getEquipByIndex(0).item.configID,a=s.getZhuangBanNG(),r=a[0],l=a[1],h=s.getEquipByIndex(0),u=h.item.configID,p=s.getEquipByIndex(2),c=p.item.configID,d=GlobalConfig.ClientGlobalConfig.useManRes?0:s.sex;if(u>0){var g=GlobalConfig.EquipConfig[u].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),i.source=GlobalConfig.EquipWithEffConfig[o+"_"+s.sex]?null:g+"_"+d+"_c_png"}if(c>0){var g=GlobalConfig.EquipConfig[c].appearance;g&&g.indexOf("[job]")>-1&&(g=g.replace("[job]",s.job+"")),e.source=g+"_"+s.sex+"_c_png",n=!0}if(n||(e.source="body000_"+s.sex+"_c_png"),l>0){var f=this.getZhuangbanById(l);f.useMc>0?(i.visible=!1,this.wefbodyMc.visible=!0,this.wefbodyMc.playFile(RES_DIR_DRESS+f.res+"_"+d+"_c_m",-1)):(this.wefbodyMc.visible=!1,i.visible=!0,i.source=this.getZhuangbanById(l).res+"_"+d+"_c_png")}else i.visible=!0,this.wefbodyMc.visible=!1;if(r>0){var f=this.getZhuangbanById(r);f.useMc>0?(e.visible=!1,this.bodyMc.visible=!0,this.bodyMc.playFile(RES_DIR_DRESS+f.res+"_"+s.sex+"_c_m",-1)):(this.bodyMc.visible=!1,e.visible=!0,e.source=f.res+"_"+s.sex+"_c_png")}else this.bodyMc.visible=!1,e.visible=!0},e.prototype.setRoleEff=function(){this.setSuit(this.curRole,this.suitImg,this.suitEff),this.setWeaponsSuit(this.curRole,"sef",this.soldierSoulEff,this.suitEff2),this.setWeaponEffect(this.curRole,"wsef",this.soulEff,this.suitEff5),this.setWeaponEffect(this.curRole,"bodyEffect",this.bodyEff,this.suitEff7,2)},e.prototype.setSuit=function(t,e,i){DisplayUtils.removeFromParent(i);var n=SubRoles.ins().getSubRoleByIndex(t),s=n.heirloom.getSuitConfig(n);if(s&&!n.hideNeff()){i.parent||e.parent.addChildAt(i,e.parent.getChildIndex(e));var o=GlobalConfig.HeirloomEquipSetConfig[s.lv];i.playFile(RES_DIR_EFF+o.neff,-1)}},e.prototype.setWeaponsSuit=function(t,e,i,n){var s=SubRoles.ins().getSubRoleByIndex(t);n.x=this[e+s.job].x,n.y=this[e+s.job].y,n.rotation=this[e+s.job].rotation,DisplayUtils.removeFromParent(n);var o=s.weapons.weaponsId,a=s.hideWeapons();if(!a&&o){n.parent||i.addChild(n);var r=GlobalConfig.WeaponSoulConfig[o];n.playFile(RES_DIR_EFF+r.inside[s.job-1],-1)}},e.prototype.setWeaponEffect=function(t,e,i,n,s){void 0===s&&(s=0);var o=SubRoles.ins().getSubRoleByIndex(t),a=o.getEquipByIndex(s).item.configID,r=GlobalConfig.EquipWithEffConfig[a+"_"+o.sex];DisplayUtils.removeFromParent(n);var l=o.getZhuangBanNG(),h=n;h==this.suitEff5?0==o.sex?DisplayUtils.removeFromParent(this.suitEff9):h=this.suitEff9:h==this.suitEff6&&(0==o.sex?DisplayUtils.removeFromParent(this.suitEff10):h=this.suitEff10),r&&(0==s&&l[1]<=0||2==s&&l[0]<=0)?(h.x=this[e+o.sex].x+r.offX,h.y=this[e+o.sex].y+r.offY,h.rotation=this[e+o.sex].rotation,"bodyEffect"==e?(h.scaleX=h.scaleY=.9,h.x=6,h.y=-20):(h.x=15,h.y=-70,h.scaleX=.9,h.scaleY=.9),h.playFile(RES_DIR_EFF+r.inShowEff,-1),i.addChild(h)):DisplayUtils.removeFromParent(h)},e.prototype.getZhuangbanById=function(t){for(var e in GlobalConfig.ZhuangBanId)if(GlobalConfig.ZhuangBanId[e].id==t)return GlobalConfig.ZhuangBanId[e];return null},e.prototype.setFashionRetPoint=function(){this.fashionPoint&&(this.fashionPoint.visible=Dress.ins().redPoint())},e.prototype.onClick=function(t){switch(t.currentTarget){case this.juesexiangxi:ViewManager.ins().open(RoleAttrWin,this.curRole);break;case this.oneKeyChange:RoleCT.ins().checkHaveCan(!0,this.curRole),this.setCanChange();break;case this.roleInfoItem0:ViewManager.ins().open(SpecialRingWin,0,this.curRole);break;case this.roleInfoItem1:ViewManager.ins().open(SpecialRingWin,1,this.curRole);break;case this.shuzhuang:ViewManager.ins().open(DressWin,this.curRole);break;case this.shenlu:ViewManager.ins().open(TreasureWin,0,this.curRole);break;case this.orange:ViewManager.ins().open(AdvanEquipWin,0,0),this.setRetPoint();break;case this.heirloom:var e=GlobalConfig.LeitingEquipBaseConf.levelUnlock;1e3*ZsCT.ins().lv+Actor.level>=e?ViewManager.ins().open(HeirloomMainWin,this.curRole):TipsCT.ins().showTips((e>=1e3?e/1e3+"转":e+"级")+"开启");break;case this.rune:ViewManager.ins().open(RuneWin,this.curRole);break;case this.bless0:SpecialRing.ins().isFireRingFuse()?ViewManager.ins().open(FireRingWin):SpecialRing.ins().checkRingOpen()?ViewManager.ins().open(RingInfoView):TipsCT.ins().showTips("激活神器 烈焰神戒 后开启");break;case this.bless1:break;default:var i=this.equips.indexOf(t.currentTarget);i>=0&&(i>8||ViewManager.ins().open(RoleChooseEquipWin,this.curRole,i))}},e.prototype.setWing=function(t,e){void 0===t&&(t=this.curRole),void 0===e&&(e=this.wingImg),e.source=null,this.godWingEff=new MovieClip,this.godWingEff1=new MovieClip,this.wingEffGrp.removeChildren(),this.wingEffGrp1.removeChildren();var i=SubRoles.ins().getSubRoleByIndex(t).wingsData,n=WingCT.ins().getGodWing(t),s=n.getSuitSum();if(s>=WingCT.GodWingMaxSlot){var o=n.getSuitLevel(),a=GlobalConfig.GodWingSuitConfig[o];this.godWingEff.parent||(this.wingEffGrp.addChild(this.godWingEff),this.wingEffGrp1.addChild(this.godWingEff1)),a.suiteff&&a.lv>=2?(this.godWingEff.visible=!0,this.godWingEff.playFile(RES_DIR_EFF+a.suiteff,-1),this.godWingEff1.visible=!0,this.godWingEff1.playFile(RES_DIR_EFF+a.suiteff,-1)):(this.godWingEff.visible=!1,this.godWingEff1.visible=!1)}var r=SubRoles.ins().getSubRoleByIndex(t).getZhuangBanNG()[2];if(e.visible=!0,this.wingMc.visible=!1,r>0){var l=this.getZhuangbanById(r);l.useMc?this.wingMc.playFile(RES_DIR_DRESS+l.res+"_c_m",-1):this.wingImg.source=l.res+"_png",this.wingMc.visible=l.useMc>0,e.visible=!this.wingMc.visible}else i.openStatus?e.source=GlobalConfig.WingLevelConfig[i.lv].appearance+"_png":e.source=""},e.prototype.delayRedPoint=function(){Timer.has(this.setRetPoint,this)||Timer.start(60,1,this.setRetPoint,this)},e.prototype.setRetPoint=function(){for(var t=SubRoles.ins(),e=EquipCT.ins(),i=BagCT.ins(),n=!1,s=t.subRolesLen,o=0;s>o;o++){for(var a=0;8>a&&!(n=e.setOrangeEquipItemState(a,t.getSubRoleByIndex(o)));a++);if(n)break;n||(n=OrangeEquipRedPoint.ins().roleTabs[o]||i.getLegendHasResolve())}if(!n)for(var o=0;s>o;o++)for(var a=0;2>a&&(n=EquipCT.ins().setLegendEquipItemUpState(a>0?2:0,SubRoles.ins().getSubRoleByIndex(o)),!(n=EquipCT.ins().setLegendEquipItemState(a>0?2:0,SubRoles.ins().getSubRoleByIndex(o))||n));a++);n||(n=e.checkRedPointEx(5,this.curRole)),n||(n=LegendEquipRedPoint.ins().totalRedPoint),n||(n=SmRedPoint.ins().redPoint),n||(n=PowerEquipRedPoint.ins().totalRedPoint||PowerEquipAwakeRedPoint.ins().redPoint),this.orangeRedPoint.visible=n,this.heirloomRedPoint.visible=Heirloom.ins().checkRedPoint()||ExtremeEquipModel.ins().getRedPoint()||WushuangRP.ins().getRoleRp()||SpiritEquipRedPoint.ins().redPoint,this.updateLoongSoul(),this.ringRedPoint.visible=OpenSystem.ins().checkSysOpen(SystemType.RING)&&(FireRingRedPoint.ins().changePoint||SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed()),this.zwRedPoint.visible=RuneRedPointMgr.ins().checkAllSituation(!1)||DemonCirRedPoint.ins().redPoint,this.setCanChange()},e.prototype.setSamsaraRedPoint=function(){if(this.skin){if(SamsaraModel.ins().isOpen())for(var t=EquipPos.HAT;t<EquipPos.MAX;t++){var e=this["redPoint"+t],i=SubRoles.ins().getSubRoleByIndex(this.curRole),n=i.getEquipByIndex(t);n.soulLv>0?this["item"+t].setTag("rein_soul_tag"):this["item"+t].setTag(""),e.visible||(e.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(i,t)||SamsaraModel.ins().checkUpgradeSoul(i,t))}for(var t=9;13>t;t++)this["item"+t]&&(this["item"+t].visible=SamsaraModel.ins().isOpen())}},e.prototype.setCanChange=function(t){var e=t?t[this.curRole]?t[this.curRole]:[]:RoleCT.ins().canChangeEquips[this.curRole],i=!1,n=this.equips.length;DisplayUtils.removeFromParent(this.eff);for(var s=0;n>s;s++){var o=e[s];!o&&BloodstainCT.checkItem(this.equips[s].data)&&(o=BloodstainRedPoint.ins().itemReds[this._curRole][s]),this["redPoint"+s].visible=8==s||o?o||OfficalPostRedPoint.ins().rolePoints[this._curRole]:!1,i||(i=e[s]?e[s]:!1)}this.updateOneKey(i),this.setSamsaraRedPoint()},e.prototype.updateOneKey=function(t){return FbCT.ins().guanqiaID>1e5||!OpenSystem.ins().checkSysOpen(SystemType.ONEKEY)?void(t=!1):(this.okc=t,void(this.skin&&(this.oneKeyChange.visible=t,this.oneKeyChange.visible?(this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.eff.parent||this.effGroup.addChild(this.eff)):DisplayUtils.removeFromParent(this.eff))))},e.prototype.setSuitEquips=function(){for(var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=0;e<EquipCT.FOEGE_MAX;e++){var i=this.equips[e],n=t.heirloom.getInfoBySolt(e);i&&n.lv>0?i.setItemHeirloomBgImg(!0,n.image):i.setItemHeirloomBgImg(!1)}},__decorate([callLater],e.prototype,"updataEquip",null),e}(BaseView);__reflect(RoleInfoPanel.prototype,"RoleInfoPanel"),window.RoleInfoPanel=RoleInfoPanel;var RoleWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.roleIndex=0,e._sn_="RoleWinSkin",e.isTopLevel=!0,e.oldIndex=0,e.roleSelectVis=!0,e}return __extends(e,t),e.prototype.addDisplay=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),ViewManager.ins().isShow(NewEquipWin)&&ViewManager.ins().close(NewEquipWin),this.observe(RoleCT.ins().postRoleHint,this.delayRedPoint),this.observe(ZsCT.ins().postZsData,this.delayRedPoint),this.observe(Actor.ins().postLevelChange,this.delayRedPoint),this.observe(Actor.ins().postUpdateTogeatter,this.delayRedPoint),this.observe(FbCT.ins().postGuanKaIdChange,this.delayRedPoint),this.observe(SkillCT.ins().postUpgradeForge,this.delayRedPoint),this.observe(BagCT.ins().postItemAdd,this.delayRedPoint),this.observe(BagCT.ins().postItemChange,this.delayRedPoint),this.observe(BagCT.ins().postItemDel,this.delayRedPoint),this.observe(JadeNew.ins().postJadeData,this.delayRedPoint),this.observe(LyMark.ins().postMarkData,this.delayRedPoint),this.observe(WingCT.ins().postUseDanSuccess,this.delayRedPoint),this.observe(WingCT.ins().postWingUpgrade,this.delayRedPoint),this.observe(SamsaraCC.ins().postSamsaraInfo,this.delayRedPoint),this.observe(JingMaiCT.ins().postUpdate,this.delayRedPoint),this.observe(OfficalPostRedPoint.ins().postRoleRedPoint,this.delayRedPoint),this.observe(KingEquipRedPoint.ins().postRoleRedPoint,this.delayRedPoint),this.oldIndex=this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.roleIndex=e;var i=this.viewStack.selectedIndex;this.roleSelect.setCurRole(this.roleIndex),4==i&&this.roleSelect.hideRole(),this.setOpenIndex(i),this.redPoint()},e.prototype.removeDisplay=function(){var t=ViewManager.ins().getView(UIView2);t&&t.closeNav(UIView2.NAV_ROLE)},e.prototype.skinComplete=function(){this.addExclusionWin(egret.getQualifiedClassName(SmeltEquipTotalWin)),this.addTouchEvent(this,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEvent(this.help,this.onClick)},e.prototype.openSamsara=function(){var t=this.viewStack.getChildIndex(this.reincarnationPanel);0>t&&this.viewStack.addChild(this.reincarnationPanel),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=42,this.redPoint4.visible=SamsaraModel.ins().isCanUpgrade()||SamsaraModel.ins().isCanExchange()||!SamsaraModel.ins().isMaxSamsara(Actor.samsaraLv)&&SamsaraModel.ins().isCanUpgradeSoul()},e.prototype.inactiveSamsara=function(){var t=this.viewStack.getChildIndex(this.reincarnationPanel);t>=0&&this.viewStack.removeChildAt(t),this.tab.dataProvider=this.viewStack,this.redPointGroup.horizontalCenter=104,this.redPoint4.visible=!1},e.prototype.checkIsOpen=function(t){GlobalConfig.TogetherHitConfig[1];if(1==t){var e=(GlobalConfig.NeiGongBaseConfig.openLevel,GlobalConfig.NeiGongBaseConfig.openGuanqia);if(FbCT.ins().guanqiaID<=e)return TipsCT.ins().showTips("通关"+e+"关开启"),!1}else if(2==t){if(Actor.level<GlobalConfig.ZhuanShengConfig.level)return TipsCT.ins().showTips(GlobalConfig.ZhuanShengConfig.level+"级开启转生"),!1}else if(3==t){if(Actor.level<GlobalConfig.WingCommonConfig.openLevel)return TipsCT.ins().showTips("翅膀"+GlobalConfig.WingCommonConfig.openLevel+"级开启"),!1}else if(4==t&&!SamsaraModel.ins().isOpen())return TipsCT.ins().showTips("轮回"+GlobalConfig.ReincarnationBase.openLevel/1e3+"转开启"),!1;return!0},e.prototype.onTabTouch=function(t){var e=this.tab.selectedIndex;4==e&&this.roleSelect.hideRole(),this.setOpenIndex(e)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){this.roleInfoPanel.curRole=this.wingPanel.curRole=this.neigongPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setTabSelectedIndex=function(t){this.tab.selectedIndex=t,this.oldIndex=t,this.setOpenIndex(t)},e.prototype.setOpenIndex=function(t){if(this.roleSelectVis=this.roleSelect.visible,this.oldIndex&&3==this.oldIndex&&this.oldIndex!=t&&this.getWingPanelInfo())return this.doOpenHintWin(1,this.tab.selectedIndex),void(this.tab.selectedIndex=this.oldIndex);switch(this.help.visible=!1,t){case 0:this.biaoti.source="biaoti_juese",this.roleSelect.openRole();break;case 1:this.roleSelect.openRole(),this.biaoti.source="biaoti_neigong",this.neigongPanel.curRole=this.roleSelect.getCurRole();break;case 2:Actor.level>=GlobalConfig.ZhuanShengConfig.level?(this.biaoti.source="biaoti_zhuansheng",this.roleSelect.hideRole()):(TipsCT.ins().showTips(GlobalConfig.ZhuanShengConfig.level+"级开启转生"),this.tab.selectedIndex=this.viewStack.selectedIndex);break;case 3:Actor.level>=GlobalConfig.WingCommonConfig.openLevel?(this.biaoti.source="biaoti_yuyi",this.roleSelect.openRole()):(TipsCT.ins().showTips("翅膀"+GlobalConfig.WingCommonConfig.openLevel+"级开启"),this.tab.selectedIndex=this.viewStack.selectedIndex);break;case 4:this.biaoti.source="biaoti_lunhui",this.tab.selectedIndex=this.viewStack.selectedIndex=4,this.help.visible=!0}this.oldIndex!=t?this.oldIndex=t:this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.redPoint()},e.prototype.onClick=function(t){switch(t.target){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);var e=ViewManager.ins().getView(UIView2);e&&e.closeNav(UIView2.NAV_ROLE);break;case this.help:ViewManager.ins().open(ZsBossRuleSpeak,9)}},e.prototype.delayRedPoint=function(){Timer.has(this.redPoint,this)||Timer.start(60,1,this.redPoint,this)},e.prototype.jingMaiCanUp=function(){var t,e=[!1,!1,!1];for(var i in SubRoles.ins().roles)if(t=SubRoles.ins().roles[i].jingMaiData,t.jingMaiCanUp()){var n=GlobalConfig.JingMaiCommonConfig.openLevel;Actor.level>=n&&(e[i]=!0)}return e},e.prototype.redPoint=function(){var t=[ZsCT.ins().canOpenZSWin()&&!ZsCT.ins().isMaxLv()&&(ZsCT.ins().canGet()>0||ZsCT.ins().canUpgrade())],e=this.canWingEquip(),i=NeiGongModel.ins().NeiGongCanUp(),n=this.canEquip(),s=(SamsaraModel.ins().isOpen(),OpenSystem.ins().checkSysOpen(SystemType.RING)&&(SpecialRing.ins().checkHaveUpRing()||SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||SpecialRing.ins().fireRingRedPoint()||LyMark.ins().checkRed())),o=[n,i,t,e];this.redPoint0.visible=this.and(n)||s||SubRoles.ins().isLockRole()||SamsaraModel.ins().isOpen()&&SamsaraModel.ins().isCanAddSpirit()||JadeNew.ins().checkRed()||ShenshouRedpoint.ins().redpoint||DemonCirRedPoint.ins().redPoint||OrangeEquipRedPoint.ins().redPoint||MoJianRedPoint.ins().redPoint||WushuangRP.ins().getRoleRp()||FireRingRedPoint.ins().changePoint||SpiritEquipRedPoint.ins().redPoint||SmRedPoint.ins().redPoint||BloodstainRedPoint.ins().redPoint,this.redPoint1.visible=NeiGongModel.ins().canUp(),this.redPoint2.visible=this.and(t),this.redPoint3.visible=this.and(e)||this.and(WingCT.ins().canGradeupWing())||this.and(WingCT.ins().canItemGradeupWing())||WingCT.ins().isHaveActivationWing()||GodWingRedPoint.ins().getGodWingRedPoint()||GodWingRedPoint.ins().keYinRedPoint,this.redPoint3.visible=Actor.level>=GlobalConfig.WingCommonConfig.openLevel?this.redPoint3.visible:!1;for(var a=SubRoles.ins().subRolesLen,r=0;a>r;r++){var l=!1;this.tab.selectedIndex<4&&(o[this.tab.selectedIndex][r]&&(l=!0),this.roleSelect.showRedPoint(r,l))}1e3*ZsCT.ins().lv+Actor.level>=5e3?(this.openSamsara(),this.setSamsaraEquipVisible(!0)):(this.inactiveSamsara(),this.setSamsaraEquipVisible(!1))},e.prototype.setSamsaraEquipVisible=function(t){this.roleInfoPanel&&4==this.viewStack.selectedIndex&&this.roleInfoPanel.skinName&&(this.roleInfoPanel.item9.visible=t,this.roleInfoPanel.item10.visible=t,this.roleInfoPanel.item11.visible=t,this.roleInfoPanel.item12.visible=t)},e.prototype.and=function(t){for(var e in t)if(1==t[e])return!0;return!1},e.prototype.canWingEquip=function(){for(var t=[!1,!1,!1],e=WingCT.ins().canGradeupWing(),i=WingCT.ins().canItemGradeupWing(),n=WingCT.ins().canRoleOpenWing(),s=SubRoles.ins().subRolesLen,o=0;s>o;o++)GlobalConfig.WingCommonConfig.openLevel>Actor.level?t[o]=!1:n[o]?t[o]=!0:((e[o]||i[o])&&(t[o]=!0),WingCT.ins().canUseAptitudeByRoleID(o)&&(t[o]=!0),WingCT.ins().canUseFlyUpByRoleID(o)&&(t[o]=!0));return t},e.prototype.canEquip=function(){var t=[!1,!1,!1];if(this.canChangeEquips&&this.canChangeEquips[0].length||(this.canChangeEquips=RoleCT.ins().canChangeEquips),this.canChangeEquips)for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++){var n=this.canChangeEquips[i];for(var s in n)if(n[s]){t[i]=!0;break}if(0==t[i])for(var o=0;5>o;o++){var a=[];if(a=o>1?LongHun.ins().canGradeupLoongSoul(o):SpecialRing.ins().canGradeupRing(o),a[i]){t[i]=a[i];break}}for(var r=SubRoles.ins().getSubRoleByIndex(i),l=!1,h=0;8>h;h++){if(l=EquipCT.ins().setOrangeEquipItemState(h,r),!l&&2>h&&(l=EquipCT.ins().setLegendEquipItemState(h>0?2:0,r)),l){var u=BagCT.ins().checkEqRedPoint(i,r);l=null!=u?u:l}if(l)break}l||(l=EquipCT.ins().checkRedPointEx(4,i)),l||(l=EquipCT.ins().checkRedPointEx(5,i)),l&&(t[i]=l),t[i]||(t[i]=SamsaraModel.ins().checkRoleCanAddSpirit(i)),t[i]||(t[i]=OfficalPostRedPoint.ins().rolePoints[i])}return t},e.prototype.getWingPanelInfo=function(){if(!this.isShow())return!1;if(3!=this.oldIndex)return!1;for(var t,e=SubRoles.ins().roles.length,i=0;e>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i).wingsData;t&&0!=t.clearTime?t.clearTime>n.clearTime&&n.clearTime>0&&(t=n):t=n}return this.wingData=t,t.clearTime>0&&WingCT.hint},e.prototype.doOpenHintWin=function(t,e){void 0===e&&(e=0),ViewManager.ins().open(WingHintWin,t,e,this.wingData)},e.prototype.playUIEff=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(RoleWin.prototype,"RoleWin"),ViewManager.ins().reg(RoleWin,LayerManager.UI_Main),window.RoleWin=RoleWin;var StarItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="StarItemSkin",e}return __extends(e,t),e.prototype.isShow=function(t){this.starImg.source=t?"star2":""},e.prototype.isShowFull=function(t){this.fullStarImg.source=t?"star1":""},e}(BaseView);__reflect(StarItem.prototype,"StarItem"),window.StarItem=StarItem;var StarList=function(t){function e(e,i,n,s){void 0===e&&(e=10),void 0===i&&(i=0),void 0===n&&(n=50),void 0===s&&(s=1);var o=t.call(this)||this;o._statListLength=e,o._starNum=i,o.list=[];for(var a=0;a<o._statListLength;a++){var r=new StarItem;r.x=a*n+10,o.addChild(r),a<=o._starNum-1&&r.isShow(1),r.isShowFull(s),o.list.push(r)}return o.mc=new MovieClip,o.mc.scaleX=1.5,o.mc.scaleY=1.5,o}return __extends(e,t),e.prototype.setStarNum=function(t,e){if(void 0===e&&(e=0),this._starNum!=t){this._starNum=t;for(var i=0;i<this._statListLength;i++)i<=this._starNum-1?(this.list[i].isShow(1),1==e&&i==this._starNum-1&&(this.mc.x=this.list[i].x+24,this.mc.y=this.list[i].y+28,this.mc.parent||this.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"StarMiss",1))):this.list[i].isShow(0)}},Object.defineProperty(e.prototype,"starNum",{get:function(){return this._starNum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listLength",{get:function(){return this._statListLength},enumerable:!0,configurable:!0}),e.prototype.setlistLength=function(t,e,i,n){void 0===t&&(t=10),void 0===e&&(e=0),void 0===i&&(i=50),void 0===n&&(n=1),this.removeChildren(),this.list=[];for(var s=0;t>s;s++){var o=new StarItem;o.x=s*i+10,this.addChild(o),e-1>=s&&o.isShow(1),o.isShowFull(n),this.list.push(o)}this._statListLength=t},e}(BaseView);__reflect(StarList.prototype,"StarList"),window.StarList=StarList;var WingChargeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WingChargeSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){this.addTouchEvent(this.bgClose,this.onClick),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.goUpBtn,this.onClick),Timer.start(1e3,0,this.setTime,this),this.item1.data=200150},e.prototype.onClick=function(t){switch(t.target){case this.goUpBtn:ViewManager.ins().open(ActivityWin),Timer.start(100,1,this.timeCB,this);break;case this.bgClose:case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.timeCB=function(){Activity.ins().postWingCharge(),ViewManager.ins().close(this)},e.prototype.setTime=function(){var t=Activity.ins().getActivityDataById(6),e=Math.floor((DateUtils.formatMiniDateTime(t.startTime)-GameServer.serverTime)/1e3),i=Math.floor((DateUtils.formatMiniDateTime(t.endTime)-GameServer.serverTime)/1e3);e>=0?(this.eTimeLab.text="活动未开启",Timer.stop(this.setTime,this)):0>=i?(this.eTimeLab.text="活动已结束",Timer.stop(this.setTime,this)):this.eTimeLab.text="活动剩余时间："+DateUtils.getFormatBySecond(i,DateUtils.TIME_FORMAT_5,3)},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(!e.isFirst)return!1;var n=6,s=3,o=Activity.ins().getActivityDataById(n);if(!o||o.buyData[s]>=1)return!1;for(var a=SubRoles.ins().subRolesLen,r=!1,l=0;a>l;l++){var h=SubRoles.ins().getSubRoleByIndex(l);if(h&&h.wingsData&&h.wingsData.lv>=4)return!1;1==h.wingsData.openStatus&&(r=!0)}return r?(e.isFirst=!1,!0):!1},e.isFirst=!0,e}(BaseEuiView);__reflect(WingChargeWin.prototype,"WingChargeWin"),window.WingChargeWin=WingChargeWin,ViewManager.ins().reg(WingChargeWin,LayerManager.UI_Popup);var WingHintWin=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="WingWarnTips"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.up,this.onClick),this.addTouchEvent(this.BG,this.onClick),this.type=t[0],this.index=t[1],this.data=t[2],this.lastTimeDown=(DateUtils.formatMiniDateTime(this.data.clearTime)-GameServer.serverTime)/1e3,this.lastTimeDown=Math.max(0,this.lastTimeDown),this.desc.textFlow=TextFlowMaker.generateTextFlow("你的翅膀有祝福值：|C:0xf8b141&T:"+this.data.exp+"|,将在|C:0xf3311e&T:"+DateUtils.getFormatBySecond(this.lastTimeDown,1)+"|清空，请尽快升阶?")},e.prototype.onClick=function(t){switch(ViewManager.ins().close(e),t.currentTarget){case this.closeBtn:if(1==this.type){var i=ViewManager.ins().getView(RoleWin);i.setTabSelectedIndex(this.index)}else 2==this.type&&ViewManager.ins().close(RoleWin)}WingCT.hint=!this.nextHint.selected},e}(BaseEuiView);__reflect(WingHintWin.prototype,"WingHintWin"),ViewManager.ins().reg(WingHintWin,LayerManager.UI_Popup),window.WingHintWin=WingHintWin;var WingSkillItemRender=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!1,e.skinName="WingSkillItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data&&(this.skillIcon.visible=!0,this.skillIcon.source=this.data+"_png",this.blackImg.visible=!1)},e}(BaseItemRender);__reflect(WingSkillItemRender.prototype,"WingSkillItemRender"),window.WingSkillItemRender=WingSkillItemRender;var WingSkillTipPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WingSkillTipsPanel",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.addTouchEndEvent(this,this.otherClose),void 0!=i&&this.setData(i),this.eNameText&&(this.eName.text=this.eNameText),this.eStText&&(this.eSt.text=this.eStText),this.eDescText&&(this.eDesc.textFlow=TextFlowMaker.generateTextFlow(this.eDescText))},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.setData=function(t){var e=new SkillData(t);e.name&&(this.eName.text=e.name),e.desc&&(this.eDesc.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(e.config)))},e}(BaseEuiView);__reflect(WingSkillTipPanel.prototype,"WingSkillTipPanel"),ViewManager.ins().reg(WingSkillTipPanel,LayerManager.UI_Popup),window.WingSkillTipPanel=WingSkillTipPanel;var PackETC1KTXProcessor=function(){function t(){}return t.prototype.onLoadStart=function(t,e){var i=this;return t.load(e,"bin").then(function(n){if(!n)return null;var s=n,o=new Uint32Array(s),a=(o[0],o[1]),r=o[2],l=12,h=new Uint8Array(s),u=new Uint8Array(h.slice(l,l+a));l+=a;var p=r>0?new Uint8Array(h.slice(l,l+r)):null,c=null;if(u){var d=new ArrayBuffer(u.byteLength),g=new Uint8Array(d);g.set(u),c=i.createCompressedTexture(t,e,d)}var f=null;if(p){var d=new ArrayBuffer(p.byteLength),g=new Uint8Array(d);g.set(p),f=i.createCompressedTexture(t,e,d)}return c&&c.$bitmapData&&f&&f.$bitmapData&&(c.$bitmapData.etcAlphaMask=f.$bitmapData),t.save(e,c),c},function(i){throw t.remove(e),i})},t.prototype.createCompressedTexture=function(t,e,i){if(!i)return null;var n=new egret.KTXContainer(i,1);if(n.isInvalid)return null;var s=new egret.BitmapData(i);s.debugCompressedTextureURL=e.root+e.url,s.format="ktx",n.uploadLevels(s,!1);var o=new egret.Texture;o._setBitmapData(s);var a=t.resourceConfig.getResource(e.name);if(a&&a.scale9grid){var r=a.scale9grid.split(",");o.scale9Grid=new egret.Rectangle(parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3]))}return o},t.prototype.onRemoveStart=function(t,e){var i=t.get(e);if(i){if(i.$bitmapData){var n=i.$bitmapData.etcAlphaMask;n&&(n.$dispose(),i.$bitmapData.etcAlphaMask=n=null)}i.dispose()}},t}();__reflect(PackETC1KTXProcessor.prototype,"PackETC1KTXProcessor",["RES.processor.Processor"]);var Rune=function(t){function e(){var e=t.call(this)||this;return e.runePower=[],e.sysId=PackageID.Rune,e.regNetMsg(1,e.doInlay),e.regNetMsg(2,e.doUpgrade),e.regNetMsg(3,e.doOneKeyDecompose),e.regNetMsg(5,e.postHuntRuneInfo),e.regNetMsg(6,e.postBestListInfo),e.regNetMsg(7,e.postUnlock),e.regNetMsg(8,e.postRuneBoxGift),e.regNetMsg(10,e.postDelRune),e.regNetMsg(11,e.postRuneInfo),e.boxs=[],e.unlockInfo=[[],[],[]],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendInlay=function(t,e,i){var n=this.getBytes(1);n.writeShort(t),n.writeShort(e),n.writeDouble(i),this.sendToServer(n)},e.prototype.doInlay=function(t){var e=Boolean(t.readShort()),i=0,n=0,s=0;e&&(i=t.readShort(),n=t.readShort(),s=t.readInt(),this.runePower[i]=t.readUnsignedInt()),this.postInlayResult([e,i,n,s])},e.prototype.postInlayResult=function(t){return t},e.prototype.sendUpgrade=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.doUpgrade=function(t){var e=Boolean(t.readByte());if(e){var i=t.readShort(),n=t.readShort(),s=t.readInt();RuneDataMgr.ins().replaceRune(i,n,s),this.postUpgradeResult([e,i,s,n])}},e.prototype.postUpgradeResult=function(t){return t},e.prototype.sendOneKeyDecompose=function(t){var e=t.length,i=this.getBytes(3);i.writeInt(e);for(var n=0;e>n;n++)i.writeInt(t[n].configID);this.sendToServer(i)},e.prototype.doOneKeyDecompose=function(t){var e=Boolean(t.readByte()),i=t.readInt();this.postOneKeyDecomposeResult([e,i])},e.prototype.postOneKeyDecomposeResult=function(t){return t},e.prototype.sendExchangeRune=function(t){var e=this.getBytes(4);e.writeUnsignedInt(t),this.sendToServer(e)},e.prototype.sendHuntRune=function(t){var e=this.getBytes(5);e.writeShort(t),this.sendToServer(e)},e.prototype.postHuntRuneInfo=function(t){for(var e=t.readUnsignedByte(),i=t.readUnsignedByte(),n=[],s=0;i>s;s++)n[s]=[t.readInt(),t.readUnsignedByte()];ViewManager.ins().isShow(HuntResultWin)?Hunt.ins().postHuntResult(e,n,1):ViewManager.ins().open(HuntResultWin,e,n,1)},e.prototype.sendRuneList=function(){var t=this.getBytes(6);this.sendToServer(t)},e.prototype.postBestListInfo=function(t){for(var e=t.readUnsignedByte(),i=[],n=0;e>n;n++)i[n]=[t.readString(),t.readInt()];return i.reverse(),i},e.prototype.sendRuneBoxGift=function(t){var e=this.getBytes(7);e.writeInt(t),this.sendToServer(e)},e.prototype.postRuneBoxGift=function(t){this.RuneRewards=t.readInt(),this.runeCount=t.readInt(),this.hope=t.readInt();var i=0;for(var n in GlobalConfig.FuwenTreasureRewardConfig){var s=GlobalConfig.FuwenTreasureRewardConfig[n];this.boxs[i]=this.RuneRewards>>s.id&1?e.ISNGET:this.runeCount>=s.needTime?e.CANGET:e.UNGET,i++}},e.prototype.getIsGetBox=function(){for(var t=0;t<e.BoxSum;t++)switch(e.ins().boxs[t]){case e.UNGET:break;case e.CANGET:return!0;case e.ISNGET:}return!1},e.prototype.sendRuneMerge=function(t){var e=this.getBytes(9);e.writeInt(t),this.sendToServer(e)},e.prototype.postDelRune=function(t){var e=RuneDataMgr.ins().getRune(t.readInt(),t.readInt());e.init()},e.prototype.isOpen=function(){var t=GlobalConfig.MergeTotal[4];return(t.openZs||0)<=ZsCT.ins().lv&&(t.openLv||0)<=Actor.level?!0:!1},e.prototype.sendUnlock=function(t,e){var i=this.getBytes(8);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postUnlock=function(t){var e=t.readShort(),i=t.readShort();return-1==this.unlockInfo[e].indexOf(i)?(this.unlockInfo[e].push(i),[e,i]):!1},e.prototype.postRuneInfo=function(t){this.unlockInfo=[[],[],[]],this.runePower=[];for(var e=t.readUnsignedByte(),i=0;e>i;i++){for(var n=t.readByte(),s=this.unlockInfo[i],o=0;n>o;o++){var a=t.readByte();s.push(a)}this.unlockInfo.push(s),this.runePower[i]=t.readUnsignedInt()}},e.prototype.hasUnclock=function(t,e){return-1!=this.unlockInfo[t].indexOf(e)},e.prototype.getRuneMergeEquipByLv=function(t){var e=[],i=GlobalConfig.RuneComposeConfig;for(var n in i)i[n].mixId[1]==t&&e.push({type:MergeType.Rune,id:i[n].id});return e},e.prototype.isRuneCanMergeByID=function(t){var e=GlobalConfig.RuneComposeConfig[t];if(!e)return!1;var i=BagCT.ins().getBagGoodsBySort(1);if(!i)return!1;for(var n=0,s=0,o=GlobalConfig.ItemConfig[e.material[0]],a=GlobalConfig.ItemConfig[e.material[1]],r=ItemUtil.getQuality(o),l=ItemUtil.getQuality(a),h=0,u=i;h<u.length;h++){var p=u[h],c=p.itemConfig,d=ItemUtil.getQuality(c);ItemUtil.getSubType(o)==ItemUtil.getSubType(c)&&r==d&&n++,ItemUtil.getSubType(a)==ItemUtil.getSubType(c)&&l==d&&s++}var g=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.RuneOtherConfig.goldItemId);
return n>0&&s>0&&g>=e.count?!0:!1},e.prototype.isRuneCanMergeByType=function(t){var e=GlobalConfig.RuneComposeConfig;for(var i in e)if(e[i].mixId[1]==t&&this.isRuneCanMergeByID(e[i].id))return!0;return!1},e.prototype.isRuneCanMerge=function(){var t=GlobalConfig.RuneComposeConfig;for(var e in t)if(this.isRuneCanMergeByID(t[e].id))return!0;return!1},e.prototype.getRuneMergeByID=function(t){var e=GlobalConfig.RuneComposeConfig;for(var i in e){var n=e[i];for(var s in n.material)if(n.material[s]==t)return n}return null},e.prototype.getIsMergeByID=function(t){var e=GlobalConfig.ItemConfig[t],i=GlobalConfig.RuneComposeConfig;for(var n in i){var s=GlobalConfig.ItemConfig[n];if(ItemUtil.getSubType(e)==ItemUtil.getSubType(s))return!0}return!1},e.prototype.getMergeIndexByType=function(t,e){var i=GlobalConfig.RuneComposeConfig,n=0;for(var s in i)if(i[s].mixId[1]==t){if(e==i[s].id)return n;n++}return n},e.prototype.isEquipMerge=function(t,e,i){var n=this.isMergeId(t),s=GlobalConfig.RuneComposeConfig[n];if(!s)return!1;var o=(GlobalConfig.ItemConfig[t],RuneDataMgr.ins().getRoleRune(e));if(!o)return!1;for(var a,r=RuneDataMgr.ins().getRune(e,i),l=o.length,h=0;l>h;h++){var u=o[h];if(a=RuneConfigMgr.ins().getBaseCfg(u))for(var p=this.getIsEquipMerge(s.checkMaterial,n),c=0;c<p.length;c++){var d=GlobalConfig.ItemConfig[p[c]];if(ItemUtil.getSubType(d)==ItemUtil.getSubType(u.itemConfig)&&r){if(r.configID<=0&&(this.getIsMergeByID(t)||this.getRoleIsHasMerge(p,e)))return!0;if(r.itemConfig){var g=this.getCurIsType(p,ItemUtil.getSubType(r.itemConfig));if(g&&(this.getIsMergeByID(t)||this.getRoleIsHasMerge(p,e)))return!0}}}}return!1},e.prototype.getRoleIsHasMerge=function(t,e){var i=RuneDataMgr.ins().getRoleRune(e);if(!i)return!1;for(var n,s=i.length,o=0;s>o;o++){var a=i[o];if(n=RuneConfigMgr.ins().getBaseCfg(a),n&&this.getIsMergeByID(n.id))for(var r=0;r<t.length;r++){var l=GlobalConfig.ItemConfig[t[r]];if(ItemUtil.getSubType(a.itemConfig)==ItemUtil.getSubType(l))return!0}}return!1},e.prototype.getCurIsType=function(t,e){for(var i=!0,n=0;n<t.length;n++){var s=GlobalConfig.ItemConfig[t[n]];if(ItemUtil.getSubType(s)==e){i=!1;break}}return i},e.prototype.getIsEquipMerge=function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(t[n]);return i.push(e),i},e.prototype.isMergeId=function(t){var e=t,i=GlobalConfig.ItemConfig[t],n=GlobalConfig.RuneComposeConfig;for(var s in n){var o=GlobalConfig.ItemConfig[s];if(ItemUtil.getSubType(i)==ItemUtil.getSubType(o))return parseInt(s);for(var a in n[s].material){var r=GlobalConfig.ItemConfig[n[s].material[a]];if(ItemUtil.getSubType(i)==ItemUtil.getSubType(r))return parseInt(s)}}return e},e.prototype.isCanEquip=function(t,e,i,n){var s=GlobalConfig.ItemConfig[t],o=RuneDataMgr.ins().getRoleRune(e);if(!o)return!0;for(var a,r=o.length,l=0;r>l;l++){var h=o[l];if(a=RuneConfigMgr.ins().getBaseCfg(h),a&&h.itemConfig){var u=GlobalConfig.RuneComposeConfig[a.id];if(!u)continue;for(var p=u.checkMaterial,c=0;c<p.length;c++){var d=GlobalConfig.ItemConfig[p[c]];if(ItemUtil.getSubType(d)==ItemUtil.getSubType(s)){if(0==i)return!1;var g=GlobalConfig.ItemConfig[i];if(ItemUtil.getSubType(g)==ItemUtil.getSubType(s))return!1}}}}return!0},e.prototype.getMergeRune=function(t,e,i){var n=this.isMergeId(t),s=(GlobalConfig.ItemConfig[t],GlobalConfig.RuneComposeConfig[n]),o=[];if(!s)return null;var a=RuneDataMgr.ins().getRoleRune(e);if(!a)return null;for(var r,l=a.length,h=0;l>h;h++){var u=a[h];if(r=RuneConfigMgr.ins().getBaseCfg(u))for(var p=this.getIsEquipMerge(s.checkMaterial,n),c=0;c<p.length;c++){var d=GlobalConfig.ItemConfig[p[c]];if(ItemUtil.getSubType(d)==ItemUtil.getSubType(u.itemConfig)&&i&&i.configID!=r.id&&this.getIsMergeByID(t))return o=["更换"+GlobalConfig.ItemConfig[s.id].name+"将同时脱下"+GlobalConfig.ItemConfig[r.id].name,""+h]}}return null},e.UNGET=0,e.CANGET=1,e.ISNGET=2,e.BoxSum=5,__decorate([post()],e.prototype,"postInlayResult",null),__decorate([post()],e.prototype,"postUpgradeResult",null),__decorate([post()],e.prototype,"postOneKeyDecomposeResult",null),__decorate([post()],e.prototype,"postHuntRuneInfo",null),__decorate([post()],e.prototype,"postBestListInfo",null),__decorate([post()],e.prototype,"postRuneBoxGift",null),__decorate([post()],e.prototype,"postDelRune",null),__decorate([post()],e.prototype,"postUnlock",null),__decorate([post()],e.prototype,"postRuneInfo",null),e}(BaseSystem);__reflect(Rune.prototype,"Rune"),System.Rune=function(){return Rune.ins()},window.Rune=Rune;var RunePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.runeList=null,e.curRole=0,e.selectedIndex=0,e.upgradeDifference=0,e.selectItem=null,e.openNum=0,e}return __extends(e,t),e.prototype.setCurRole=function(t){this.curRole!=t&&(this.curRole=t,this.skin&&this.update())},e.prototype.addDisplay=function(){this.addTouchEvent(this.replace,this.onTap),this.addTouchEvent(this.uplevel,this.onTap),this.addTouchEvent(this.runeBook,this.onTap),this.addTouchEvent(this.bookBtn,this.onTap),this.addTouchEvent(this.eBreakDowm,this.onTap),this.addTouchEvent(this.btn1,this.onTap),this.addTouchEvent(this.btn2,this.onTap),this.addTouchEvent(this.runeeff,this.onTap),this.observe(Rune.ins().postInlayResult,this.onInlayResult),this.observe(Rune.ins().postUpgradeResult,this.onUpgradeResult),this.observe(ZsCT.ins().postZsData,this.onLevelUp),this.observe(Actor.ins().postPowerChange,this.onLevelUp),this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange),this.observe(BagCT.ins().postItemAdd,this.onItemChange),this.observe(BagCT.ins().postItemDel,this.onItemChange),this.observe(BagCT.ins().postItemChange,this.onItemChange),this.observe(Rune.ins().postDelRune,this.onLevelUp),this.observe(Rune.ins().postUnlock,this.onUnlock),this.observe(Rune.ins().doInlay,this.updatePower),this.observe(Rune.ins().postRuneInfo,this.updatePower),this.update(),this.updatePower()},e.prototype.update=function(){this.initRunes();var t=this.runeList.length;this.selectedIndex<0&&(this.selectedIndex=0),this.selectedIndex>=t&&(this.selectedIndex=t-1),this.updateRunes(!0);for(var e=null,i=0;t>i;i++)e=this.runeList[i],this.addTouchEvent(e,this.onRuneTap),!e||e.currentState!=RuneDisplay.SKIN_STATE_UNLOCK&&e.currentState!=RuneDisplay.SKIN_STATE_LOCK?this["linebg"+i]&&(this["linebg"+i].source="zwfwline1"):this["linebg"+i]&&(this["linebg"+i].source="zwfwline2");this.updateRuneDetail(),this.updateSelectedEffect(),this.showRuneRedPoint(),this.setNextOpenInfo(),this.eBreakDowm.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eBreakDowm.text+"</u>")},e.prototype.initRunes=function(){this.runeList=[];for(var t=8,e=null,i=0;t>i;i++)e=this["rune"+i],e&&this.runeList.push(e)},e.prototype.setNextOpenInfo=function(){var t=RuneConfigMgr.ins().getLockCfg(this.openNum);t?this.levelsay.text="通过第"+t.lockLv+"关开启下一凹槽":this.levelsay.text=""},e.prototype.onLevelUp=function(){this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()},e.prototype.onUpgradeResult=function(t){t[0]?(TipsCT.ins().showTips("升级图腾成功"),this.curRole=t[1],this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()):TipsCT.ins().showTips("升级图腾失败，请稍后再试")},e.prototype.onInlayResult=function(t){if(t[0]){TipsCT.ins().showTips("镶嵌图腾成功");var e=t[1],i=t[2],n=t[3];RuneDataMgr.ins().replaceRune(e,i,n),this.curRole=e,this.updateRunes(),this.updateRuneDetail(),this.showRuneRedPoint(),this.showReplaceRedPoint()}else TipsCT.ins().showTips("镶嵌图腾失败，请稍后重试")},e.prototype.onShatterChange=function(){this.updateRuneDetail(),this.showRuneRedPoint()},e.prototype.onItemChange=function(){this.showRuneRedPoint(),this.showReplaceRedPoint()},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.runeeff:ViewManager.ins().open(RuneeffWin,SubRoles.ins().getSubRoleByIndex(this.curRole));break;case this.replace:this.showReplaceWin();break;case this.uplevel:this.upgradeRune();break;case this.runeBook:ViewManager.ins().open(RuneAttrWin,this.curRole);break;case this.bookBtn:ViewManager.ins().open(RuneBookWin);break;case this.btn1:ViewManager.ins().open(TreasureHuntWin,1);break;case this.btn2:ViewManager.ins().open(FbWin,1);break;case this.eBreakDowm:ViewManager.ins().open(RuneDecomposePanel)}},e.prototype.upgradeRune=function(){var t=this.getRuneDisplay(this.selectedIndex);if(t)switch(t.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:TipsCT.ins().showTips("请先解锁");break;case RuneDisplay.SKIN_STATE_UNLOCK:var e=this.getCurIC();if(e){var i=GlobalConfig.ItemConfig[e.id+1];i?this.upgradeDifference<=0?Rune.ins().sendUpgrade(this.curRole,this.selectedIndex):TipsCT.ins().showTips("图腾精华不足，分解图腾可获得图腾精华"):TipsCT.ins().showTips("图腾等级已满无法进行升级")}else TipsCT.ins().showTips("请先镶嵌一个图腾")}},e.prototype.showReplaceWin=function(){var t=this.getRuneDisplay(this.selectedIndex);if(t)switch(t.currentState){case RuneDisplay.SKIN_STATE_LOCK:case RuneDisplay.SKIN_STATE_READY:TipsCT.ins().showTips("请先解锁");break;case RuneDisplay.SKIN_STATE_UNLOCK:ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,t.data,this.runeTypeList)}},e.prototype.onRuneTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(this.selectedIndex=e.pos,this.updateRuneDetail(),this.updateSelectedEffect(),this.showReplaceRedPoint(),e.currentState==RuneDisplay.SKIN_STATE_UNLOCK){var i=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);i&&i.configID<=0&&ViewManager.ins().open(RuneReplaceWin,this.selectedIndex,this.curRole,e.data,this.runeTypeList)}else if(e.currentState==RuneDisplay.SKIN_STATE_LOCK){var n=SkyLevelModel.ins().cruLevel,s=RuneConfigMgr.ins().getLockCfg(e.pos).lockLv;n>s&&!Rune.ins().hasUnclock(this.curRole,e.pos)&&Rune.ins().sendUnlock(this.curRole,e.pos)}}},e.prototype.updateSelectedEffect=function(){if(this.runeList)for(var t=0,e=this.runeList;t<e.length;t++){var i=e[t];i&&i.showOrHideSelected(i.pos==this.selectedIndex)}},e.prototype.showLink=function(){this.linkGroup.visible=!1;var t=RuneDataMgr.ins().getRoleRune(this.curRole);if(t){for(var e,i=!0,n=this.runeList.length,s=0;n>s;s++){var o=t[s];if(e=RuneConfigMgr.ins().getBaseCfg(o)){i=!1;break}}this.linkGroup.visible=i}},e.prototype.updateRunes=function(t){var e=RuneDataMgr.ins().getRoleRune(this.curRole);if(e){this.openNum=0,this.runeTypeList=[];var i=0,n=null,s=null,o=null,a=this.runeList.length,r=0;this.runeBook.visible=!1;for(var l=0;a>l;l++)if(n=e[l],s=RuneConfigMgr.ins().getBaseCfg(n),s&&(r+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(s))+(s.power||0)),o=this.runeList[l],n.configID&&n.itemConfig&&this.runeTypeList.push(ItemUtil.getSubType(n.itemConfig)),o){o.setPos(this.curRole,l),n&&n.itemConfig&&n.itemConfig.id>0?(o.setData(n),this.runeBook.visible=!0):o.cleanData(),o.currentState==RuneDisplay.SKIN_STATE_UNLOCK&&(this.openNum+=1);var h=RuneConfigMgr.ins().getLockCfg(o.pos).lockLv,u=SkyLevelModel.ins().cruLevel;o.currentState==RuneDisplay.SKIN_STATE_LOCK&&h>u?(i+=1,1==i?o.setLockTF(!0):o.setLockTF(!1)):o.setLockTF(!1)}this.updatePower(),t&&this.setSelectedIndexRule(this.curRole),this.showLink()}},e.prototype.updatePower=function(){this.powerPanel.setPower(Rune.ins().runePower[this.curRole])},e.prototype.updateRuneDetail=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);if(this.selectItem=t,t&&t.configID>0){this.rune8.showName(!1),this.rune8.setData(t);var e=GlobalConfig.ItemConfig[t.itemConfig.id],i=GlobalConfig.RuneNameConfig[ItemUtil.getSubType(e)];this.nuneName.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemUtil.getQualityColor(e)+"&T:"+i.runeName+"Lv."+e.id%100);var n=RuneConfigMgr.ins().getBaseCfg(t),s=this.getCurIC();if(!s||!n)return;this.up.visible=!0,this.showReplaceRedPoint();var o=RuneConfigMgr.ins().getBaseCfg(t,!0);o?(this.attrDesc.text=RuneConfigMgr.ins().getcfgAttrDesc(o),this.setCost(n),this.costImg.visible=!0,this.cost.x=328,this.arrow.visible=!0):(this.attrDesc.text="",this.costImg.visible=!1,this.arrow.visible=!1,this.cost.textFlow=TextFlowMaker.generateTextFlow("|C:0xf3311e&T:等级已满|"),this.cost.x=310),this.addAttr.text=RuneConfigMgr.ins().getcfgAttrDesc(n)}else this.up.visible=!1},e.prototype.setCost=function(t){if(t){var e=GlobalConfig.RuneBaseConfig[t.id+1],i=e?e.gain-t.gain:0,n=Actor.runeShatter;this.upgradeDifference=i-n,this.upgradeDifference<0&&(this.upgradeDifference=0);var s="";s=n>=i?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.cost.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+n+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+i+"</font> ")}},e.prototype.getRuneDisplay=function(t){return this.runeList?this.runeList[t]:null},e.prototype.getCurIC=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);return t&&t.configID>0?GlobalConfig.ItemConfig[t.configID]:null},e.prototype.showRuneRedPoint=function(){for(var t=!1,e=0,i=this.runeList;e<i.length;e++){var n=i[e];if(n){if(t=RuneRedPointMgr.ins().checkSingleInlay(this.curRole,n.pos),!t){var s=n.data;s&&s instanceof ItemData&&s.configID>0&&(t=RuneRedPointMgr.ins().checkSingleUpgrade(s),t||(t=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,s)))}if(!t){var o=SkyLevelModel.ins().cruLevel,a=RuneConfigMgr.ins().getLockCfg(n.pos);t=a&&o>a.lockLv&&!Rune.ins().hasUnclock(this.curRole,n.pos)}n.redPoint&&(n.redPoint.visible=t)}}},e.prototype.showReplaceRedPoint=function(){var t=RuneDataMgr.ins().getRune(this.curRole,this.selectedIndex);t&&t.configID>0?(this.redPointReplace.visible=RuneRedPointMgr.ins().checkSingleReplace(this.curRole,t),this.upRed&&(this.upRed.visible=RuneRedPointMgr.ins().checkSingleUpgrade(t))):(this.redPointReplace.visible=!1,this.upRed&&(this.upRed.visible=!1))},e.prototype.setSelectedIndexRule=function(t){var e=RuneDataMgr.ins().getMinRune(t,!0);if(e)for(var i=0;i<this.runeList.length;i++)if(this.runeList[i].getItemConfig()&&this.runeList[i].getItemConfig().id==e.configID){this.selectedIndex=this.runeList[i].pos;break}},e.prototype.onUnlock=function(t){var e=this;if(t&&2==t.length){var i=t[0],n=t[1];this.runeList[n]&&(DisplayUtils.shakeIt(this.runeList[n].eLockImg,5,250,2),Timer.start(250,1,function(){return null!=n&&e.runeList[n]&&e.runeList[n].eLockImg?(e.runeList[n].eLockImg.alpha=1,void e.runeList[n].setPos(i,n)):void platform.reportError("onUnlock:"+n)},this))}this.showRuneRedPoint()},e}(BaseView);__reflect(RunePanel.prototype,"RunePanel"),window.RunePanel=RunePanel;var RuneWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onlyMoJianTaskPanel=!1,e._sn_="RuneSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.roleSelect,this.onChange),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching)},e.prototype.removeDisplay=function(){ViewManager.ins().isShow(RuneBookWin)&&ViewManager.ins().close(RuneBookWin)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postRuneExchange,this.refushRedPoint),this.observe(GameLogic.ins().postRuneShatter,this.refushRedPoint),this.observe(BagCT.ins().postHuntStore,this.refushRedPoint),this.observe(Rune.ins().postInlayResult,this.refushRedPoint),this.observe(Rune.ins().postUpgradeResult,this.refushRedPoint),this.observe(Rune.ins().postUnlock,this.refushRedPoint),this.observe(DemonCir.ins().postRoleDatas,this.checkPanel),this.observe(DemonCirRedPoint.ins().postRedPoint,this.refushRedPoint);var i=t&&t[0]?t[0]:0,n=t&&t[1]?t[1]:0;this.onlyDCTaskPanel=t&&t[2]?t[2]:!1,this.checkPanel(),this.roleSelect.setCurRole(i),this.switchTab(n),this.setRoleId(this.roleSelect.getCurRole()),this.refushRedPoint()},e.prototype.checkPanel=function(){for(var t,e=this.viewStack.selectedIndex;this.viewStack.numChildren>0;)t=this.viewStack.removeChildAt(0),t.visible=!1;this.onlyDCTaskPanel?this.addDemonPanel():(this.viewStack.addChild(this.runePanel),this.addDemonPanel()),this.viewStack.selectedIndex=e,this.viewStack.validateNow(),this.setOpenIndex(e)},e.prototype.addDemonPanel=function(){DemonCir.ins().checkActived()?this.demonCirMainPanel.parent||this.viewStack.addChild(this.demonCirMainPanel):(this.demonTask||(this.demonTask=new DCTaskPanel,this.demonTask.name=this.demonCirMainPanel.name),this.demonTask.parent||this.viewStack.addChild(this.demonTask))},e.prototype.addMoJianPanel=function(){MoJianCT.ins().checkActived()?this.moJianPanel.parent||this.viewStack.addChild(this.moJianPanel):(this.moJianTaskPanel||(this.moJianTaskPanel=new MoJianTaskPanel,this.moJianTaskPanel.name="魔剑"),this.moJianTaskPanel.parent||this.viewStack.addChild(this.moJianTaskPanel))},e.prototype.addShieldPanel=function(){this.viewStack.addChild(this.shieldPanel)},e.prototype.addEightRefusePanel=function(){this.viewStack.addChild(this.eightRefusePanel)},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole()),this.refushRedPoint()},e.prototype.switchTab=function(t){this.viewStack.selectedIndex=t,this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.onTabTouching=function(t){return this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){switch(this.viewStack.getElementAt(t)){case this.runePanel:break;case this.demonTask:case this.demonCirMainPanel:if(!DemonCir.ins().checkOpen())return TipsCT.ins().showTips("达到"+GlobalConfig.DemonCirConf.openzhuanshenglv+"转且开服 "+GlobalConfig.DemonCirConf.openserverday+"天后开启"),!1;break;case this.moJianPanel:case this.moJianTaskPanel:if(!MoJianCT.ins().checkOpen())return TipsCT.ins().showTips("达到"+GlobalConfig.MoJianSysConf.openzhuanshenglv+"转且开服 "+GlobalConfig.MoJianSysConf.openserverday+"天后开启"),!1;break;case this.shieldPanel:if(!ShieldCT.ins().checkOpen())return TipsCT.ins().showTips("达到"+GlobalConfig.AegisBaseConfig.openzhuanshenglv+"转且开服 "+GlobalConfig.AegisBaseConfig.openserverday+"天后开启"),!1;break;case this.eightRefusePanel:if(!EightRefuseCT.ins().checkOpen())return TipsCT.ins().showTips("达到"+GlobalConfig.EightGateBaseConfig.openzhuanshenglv+"转且开服 "+GlobalConfig.EightGateBaseConfig.openserverday+"天后开启"),!1}return!0},e.prototype.setRoleId=function(t){this.runePanel.setCurRole(t),this.demonCirMainPanel&&(this.demonCirMainPanel.curRole=t),this.moJianPanel&&(this.moJianPanel.curRole=t),this.shieldPanel&&(this.shieldPanel.curRole=t),this.eightRefusePanel&&(this.eightRefusePanel.curRole=t),this.setOpenIndex(this.viewStack.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(this.viewStack.getElementAt(t)){case this.runePanel:this.roleSelect.openRole(),this.eTitle.source="biaoti_zhanwen";break;case this.demonTask:case this.demonCirMainPanel:this.eTitle.source="dc_tasktitle",DemonCir.ins().checkActived()?this.roleSelect.openRole():this.roleSelect.hideRole();break;case this.moJianPanel:case this.moJianTaskPanel:this.eTitle.source="mojian_fbbt_png",MoJianCT.ins().checkActived()?this.roleSelect.openRole():this.roleSelect.hideRole();break;case this.shieldPanel:this.eTitle.source="biaoti_Shield_png",this.roleSelect.openRole();break;case this.eightRefusePanel:this.eTitle.source="eightRefuse_title_png",this.roleSelect.openRole()}this.refushRedPoint()},e.prototype.refushRedPoint=function(){this.redPoint1.visible=!this.onlyDCTaskPanel&&!this.onlyMoJianTaskPanel&&RuneRedPointMgr.ins().checkAllSituation(!1),this.redPoint2.visible=!this.onlyDCTaskPanel&&!this.onlyMoJianTaskPanel&&DemonCirRedPoint.ins().redPoint;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=RuneRedPointMgr.ins().checkRoleAllSituation(e),n=DemonCirRedPoint.ins().roleTabs[e],s=(MoJianRedPoint.ins().roleTabs[e],ShieldRedPoint.ins().rolePoints[e],EightRefuseRedPoint.ins().rolePoints[e],[i,n]);this.roleSelect.showRedPoint(e,s[this.tab.selectedIndex])}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.RuneOtherConfig.zsLevel;return Actor.level<i?(TipsCT.ins().showTips(i+"级开启"),!1):!0},e}(BaseEuiView);__reflect(RuneWin.prototype,"RuneWin"),ViewManager.ins().reg(RuneWin,LayerManager.UI_Main),window.RuneWin=RuneWin;var RuneConfigMgr=function(t){function e(){var e=t.call(this)||this;return e.exchangeList=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getBaseCfg=function(t,e){void 0===e&&(e=!1);var i=GlobalConfig.RuneBaseConfig;if(Assert(i,"RuneBaseConfigs is null"))return null;var n=e?t.configID+1:t.configID;return i[n]},e.prototype.getBaseCfgByItemConfig=function(t){var e=GlobalConfig.RuneBaseConfig;return Assert(e,"RuneBaseConfigs is null")?null:e[t.id]},e.prototype.getLockCfg=function(t){var e=GlobalConfig.RuneLockPosConfig;return Assert(e,"RuneLockPosConfigs is null")?null:e[t]},e.prototype.getOtherCfg=function(){var t=GlobalConfig.RuneOtherConfig;return Assert(t,"RuneOtherConfig is null")?null:t},e.prototype.getcfgAttrData=function(t,i){if(void 0===i&&(i=!0),!t)return"";var n="";return n+=this.getAttrNamesByList(AttributeData.getAttrFromCfg(t),0,i),n+=this.getAttrNamesByList(e.getEquipAttr(t),1,i),n+=this.getAttrNamesByList(e.getExAttr(t),2,i),n+=this.getAttrNamesByList(e.getSpecialAttr(t),3,i)},e.prototype.getAttrNamesByList=function(t,e,i){var n="";if(!t||t.length<=0)return"";switch(e){case 0:for(var s in t)t[s]&&(n+=i?AttributeData.getAttrStrByType(t[s].type)+"\n":"+"+t[s].value+"\n");break;case 1:for(var s in t)t[s]&&(n+=i?AttributeData.getEEquipAttrStrByType(t[s].type)+"\n":"+"+t[s].value+"%\n");break;case 2:for(var s in t)t[s]&&(n+=i?AttributeData.getExtAttrStrByType(t[s].type)+"\n":"+"+t[s].value+"\n");break;case 3:for(var s in t)t[s]&&(n+=i?(1==t[s].type?"金币":"经验")+"\n":"+"+t[s].value+"%\n")}return n},e.prototype.getcfgAttrDesc=function(t,i){if(void 0===i&&(i=!1),!t)return"";var n="";return n+=this.getAttrDescByList(AttributeData.getAttrFromCfg(t),0,i),n+=this.getAttrDescByList(e.getEquipAttr(t),1,i),n+=this.getAttrDescByList(e.getExAttr(t),2,i),n+=this.getAttrDescByList(e.getSpecialAttr(t),3,i),n.lastIndexOf("\n")==n.length-1&&(n=n.substring(0,n.length-1)),n},e.prototype.getAttrDescByList=function(t,e,i){void 0===i&&(i=!1);var n="";if(!t||t.length<=0)return"";switch(e){case 0:for(var s in t)t[s]&&(i?5==t[s].type||(n+=6==t[s].type?"物防、魔防 +"+t[s].value+"\n":AttributeData.getAttrNameByAttrbute(t[s],!0," + ")+"\n"):n+=AttributeData.getAttrNameByAttrbute(t[s],!0," + ")+"\n");break;case 1:for(var s in t)t[s]&&(n+=AttributeData.getEEquipAttrStrByType(t[s].type)+"  +"+t[s].value+"%\n");break;case 2:for(var s in t)t[s]&&(n+=AttributeData.getExAttrNameByAttrbute(t[s],!0," + ")+"\n");break;case 3:for(var s in t)t[s]&&(n+=(1==t[s].type?"金币":"经验")+"  +"+t[s].value+"%\n")}return n},e.prototype.getAttrByList=function(t,e,i){void 0===i&&(i=!1);var n="";if(!t||t.length<=0)return"";switch(e){case 0:for(var s in t)t[s]&&(n+=AttributeData.getAttrNameByAttrbute(t[s],!0,"：",!1,16298305)+"\n");break;case 1:for(var s in t)t[s]&&(n+=AttributeData.getEEquipAttrStrByType(t[s].type)+"：|C:16298305&T:"+t[s].value+"%\n");break;case 2:for(var s in t)t[s]&&(n+=AttributeData.getExAttrNameByAttrbute(t[s],!0,"：",16298305)+"\n");break;case 3:for(var s in t)t[s]&&(n+=(1==t[s].type?"金币":"经验")+"：|C:16298305&T:"+t[s].value+"%\n")}return n},e.prototype.getExchangeDataList=function(){if(this.exchangeList.length>0)return this.exchangeList;var t=GlobalConfig.RuneConverConfig;for(var e in t)this.exchangeList.push(t[e]);return this.exchangeList.sort(this.sortExchange),this.exchangeList},e.prototype.sortExchange=function(t,e){return t.checkpoint<e.checkpoint?-1:t.checkpoint>e.checkpoint?1:t.id-e.id},e.getEquipAttr=function(t){if(!t)return null;for(var e=[],i=0;9>i;i++)if(t["pos"+i]>0){var n=new AttributeData;n.type=i,n.value=t["pos"+i],e.push(n)}return e},e.getExAttr=function(t){if(!t)return null;var e=[];if(t.additionalHarm>0){var i=new AttributeData;i.type=24,i.value=t.additionalHarm,e.push(i)}if(t.reductionHarm>0){var i=new AttributeData;i.type=25,i.value=t.reductionHarm,e.push(i)}return e},e.getSpecialAttr=function(t){if(!t)return null;var e=[];if(t.goldAdd>0){var i=new AttributeData;i.type=1,i.value=t.goldAdd,e.push(i)}if(t.expAdd>0){var i=new AttributeData;i.type=2,i.value=t.expAdd,e.push(i)}return e},e}(BaseClass);__reflect(RuneConfigMgr.prototype,"RuneConfigMgr"),window.RuneConfigMgr=RuneConfigMgr;var RuneDataMgr=function(t){function e(){var e=t.call(this)||this;return e.posIsWear=null,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getRoleRune=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);return e?e.runeDatas:null},e.prototype.getRune=function(t,e){var i=this.getRoleRune(t);return i?i[e]:null},e.prototype.replaceRune=function(t,e,i){var n=this.getRoleRune(t);n&&e>=0&&(n[e].configID=i)},e.prototype.getMinRune=function(t,e){void 0===e&&(e=!1);var i=this.getRoleRune(t);if(!i)return null;for(var n=[],s=0;s<i.length;s++)i[s].itemConfig&&n.push(i[s]);if(n.sort(function(t,e){if(t.itemConfig.id%100<e.itemConfig.id%100)return-1;if(t.itemConfig.id%100>e.itemConfig.id%100)return 1;var i=ItemUtil.getQuality(t.itemConfig),n=ItemUtil.getQuality(e.itemConfig);return i>n?-1:n>i?1:0}),e)for(var o=0,a=n;o<a.length;o++){var r=a[o];if(RuneRedPointMgr.ins().checkSingleUpgrade(r))return r}return n[0]},e}(BaseClass);__reflect(RuneDataMgr.prototype,"RuneDataMgr"),window.RuneDataMgr=RuneDataMgr;var RuneDecomposeItemData=function(){function t(){this.itemData=null,this.isSelected=!1}return t}();__reflect(RuneDecomposeItemData.prototype,"RuneDecomposeItemData"),window.RuneDecomposeItemData=RuneDecomposeItemData;var RuneRedPointMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkSingleUpgrade=function(t){if(!this.checkOpen())return!1;var e=t.itemConfig;if(this.assert(e,"ItemConfig("+t.configID+")"))return!1;var i=RuneConfigMgr.ins().getBaseCfg(t,!0);if(!i)return!1;var n=RuneConfigMgr.ins().getBaseCfg(t);if(this.assert(n,"RuneBaseConfig"))return!1;var s=Actor.runeShatter;return s>=i.gain-n.gain},e.prototype.checkRoleUpgrade=function(t){if(!this.checkOpen())return!1;var e=RuneDataMgr.ins().getRoleRune(t);if(e)for(var i=0,n=e;i<n.length;i++){var s=n[i];if(s&&s.itemConfig&&s.itemConfig.id>0&&this.checkSingleUpgrade(s))return!0}return!1},e.prototype.checkAllUpgrade=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleUpgrade(e))return!0;return!1},e.prototype.checkSingleReplace=function(t,e){return!1},e.prototype.checkRoleReplace=function(t){if(!this.checkOpen())return!1;var e=RuneDataMgr.ins().getRoleRune(t);if(e)for(var i=0,n=e;i<n.length;i++){var s=n[i];if(s&&s.itemConfig&&s.itemConfig.id>0&&this.checkSingleReplace(t,s))return!0}return!1},e.prototype.checkAllReplace=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleReplace(e))return!0;return!1},e.prototype.checkSingleInlay=function(t,e){if(!this.checkOpen())return!1;var i=RuneConfigMgr.ins().getLockCfg(e);if(this.assert(i,"RuneLockPosConfig("+e+")"))return!1;var n=i.lockLv,s=SkyLevelModel.ins().cruLevel;if(s>n){var o=RuneDataMgr.ins().getRune(t,e);if(o&&o.configID<=0)for(var a=BagCT.ins().getBagGoodsBySort(1),r=0,l=RuneDataMgr.ins().getRoleRune(t),h=!0,u=0,p=a;u<p.length;u++){var c=p[u];if(c&&(r=ItemUtil.getSubType(c.itemConfig),r>0&&l)){if(h=!0)for(var d=0,g=l;d<g.length;d++){var f=g[d];if(f&&f.itemConfig&&f.itemConfig.id>0&&r==ItemUtil.getSubType(f.itemConfig)){h=!1;break}}if(h)return!0}}}return!1},e.prototype.checkRoleInlay=function(t){if(!this.checkOpen())return!1;for(var e=0;e<RuneConfigMgr.ins().getOtherCfg().maxEquip;e++)if(this.checkSingleInlay(t,e))return!0;return!1},e.prototype.checkAllInlay=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkRoleInlay(e))return!0;return!1},e.prototype.checkRoleAllSituation=function(t){if(!this.checkOpen())return!1;var e=this.checkRoleInlay(t);return e||(e=this.checkRoleUpgrade(t)),e||(e=this.checkRoleReplace(t)),e||(e=this.checkCanUnlock(t)),e},e.prototype.checkAllSituation=function(t){if(void 0===t&&(t=!0),!this.checkOpen())return!1;var e=this.checkAllInlay();return e||(e=this.checkAllUpgrade()),e||(e=this.checkAllReplace()),e||(e=this.checkAllCanUnlock()),t&&(e||(e=this.checkCanExchange())),e},e.prototype.checkCanExchange=function(){for(var t=RuneConfigMgr.ins().getExchangeDataList(),e=0;e<t.length;e++){var i=t[e];if(Actor.runeExchange>=i.conversion)return!0}return!1},e.prototype.checkAllCanUnlock=function(){if(!this.checkOpen())return!1;for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)if(this.checkCanUnlock(e))return!0;return!1},e.prototype.checkCanUnlock=function(t){for(var e=SkyLevelModel.ins().cruLevel,i=0;8>i;i++){var n=RuneConfigMgr.ins().getLockCfg(i).lockLv;if(e>n&&!Rune.ins().hasUnclock(t,i))return!0}return!1},e.prototype.checkOpen=function(){return Actor.level>=RuneConfigMgr.ins().getOtherCfg().zsLevel},e.prototype.assert=function(t,i){return Assert(t,"["+egret.getQualifiedClassName(e)+"] "+i+"is null")},e}(BaseClass);__reflect(RuneRedPointMgr.prototype,"RuneRedPointMgr"),window.RuneRedPointMgr=RuneRedPointMgr;var RuneAttrWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._lastX=0,e.proShowList=null,e.curRole=0,e._sn_="RuneAttrsSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.curRole=isNaN(t[0])?0:t[0],this.addTouchEvent(this.leftBtn,this.onTap),this.addTouchEvent(this.rightBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onClose),this.addTouchEndEvent(this.bg,this.onMove),this.addTouchEndEvent(this,this.otherClose),this.setAttrList(),this.setAttrs(),this.setBtns()},e.prototype.setAttrList=function(){this.proShowList=[];var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.runeDatas,i=GlobalConfig.RuneBaseConfig;if(!Assert(i,"RuneAttrTypeConfig is null"))for(var n in e){var s=e[n];if(s.configID){var o=i[s.configID];Assert(o,"cfg is null   id == "+s.configID)||this.setProShowList(o)}}},e.prototype.setProShowList=function(t){this.checkIsRepeat(AttributeData.getAttrFromCfg(t),0),this.checkIsRepeat(RuneConfigMgr.getEquipAttr(t),1),this.checkIsRepeat(RuneConfigMgr.getExAttr(t),2),this.checkIsRepeat(RuneConfigMgr.getSpecialAttr(t),3)},e.prototype.checkIsRepeat=function(t,e){this.proShowList[e]||(this.proShowList[e]=[]);var i=this.proShowList[e];if(t){var n,s=!1;for(var o in t){n=t[o],s=!1;for(var a in i)i[a].type==n.type&&(i[a].value=i[a].value+n.value,s=!0);s||i.push(n)}}},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.otherClose=function(t){t.target==this.bg||t.target instanceof eui.Button||ViewManager.ins().close(this)},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.leftBtn:this.curRole--,this.setAttrList(),this.setAttrs(),this.setBtns();break;case this.rightBtn:this.curRole++,this.setAttrList(),this.setAttrs(),this.setBtns()}},e.prototype.onMove=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._lastX=t.localX;break;case egret.TouchEvent.TOUCH_END:this._lastX>t.localX?this.curRole<3&&(this.curRole++,this.setAttrList(),this.setAttrs(),this.setBtns()):this._lastX<t.localX&&this.curRole>0&&(this.curRole--,this.setAttrList(),this.setAttrs(),this.setBtns())}},e.prototype.setAttrs=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);if(t){this.job.source="op_"+t.job;for(var e="",i=this.imgGroup.numChildren-1;i>=0;i--){var n=this.imgGroup.getChildAt(i);DisplayUtils.removeFromParent(n),n=null}for(var s=0,o=0;o<this.proShowList.length;o++){var a=this.proShowList[o];e+=RuneConfigMgr.ins().getAttrByList(a,o);for(var r in a){var l=new eui.Image;l.source="tongyongdian",l.y=28*s+2,this.imgGroup.addChild(l),s++}}e.length<=0&&(e="暂无属性\n"),this.attr.textFlow=TextFlowMaker.generateTextFlow(e),this.mainGroup.height=this.attr.height+190}},e.prototype.setBtns=function(){var t=SubRoles.ins().subRolesLen;1==t?(this.leftBtn.visible=!1,this.rightBtn.visible=!1):t>1&&(0==this.curRole?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):1==this.curRole?(this.leftBtn.visible=!0,this.rightBtn.visible=t>=3):2==this.curRole&&(this.leftBtn.visible=!0,this.rightBtn.visible=!1))
},e}(BaseEuiView);__reflect(RuneAttrWin.prototype,"RuneAttrWin"),ViewManager.ins().reg(RuneAttrWin,LayerManager.UI_Popup),window.RuneAttrWin=RuneAttrWin;var RuneBookItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.keys=["red","orange","purple","green","white"],e.skinName="RuneOverViewItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t.title)this.currentState="title",this.lbName.text=t.title;else{var e=t.data;if(e){if(0==e.checkpoint)this.currentState="rune";else{this.currentState="nune_lock";var i=GlobalConfig.FbChallengeConfig[e.checkpoint];this.lbName.text="通关通天塔"+GlobalConfig.FbChNameConfig[i.group].name+"解锁"}for(var n=e.id,s=0;s<this.keys.length;s++){var o=n-100*s,a=this[this.keys[s]];a.setDataByItemConfig(GlobalConfig.ItemConfig[o])}}}},e}(BaseItemRender);__reflect(RuneBookItemRenderer.prototype,"RuneBookItemRenderer");var RuneBookItemData=function(){function t(t,e){this.data=t,this.title=e,this.data&&(this._itemConfig=GlobalConfig.ItemConfig[this.data.id])}return t.prototype.getItemConfig=function(){return this._itemConfig},t}();__reflect(RuneBookItemData.prototype,"RuneBookItemData"),window.RuneBookItemRenderer=RuneBookItemRenderer;var RuneBookItemTipsWin=function(t){function e(){var e=t.call(this)||this;return e.QUALITY_LABEL_LIST=["零级","初级","中级","高级","顶级","神级"],e.SPECIAL_LABEL_LIST=["普通","特殊"],e.skinName="RuneGainTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){this.gainList.itemRendererSkinName="RuneGainTipsItemSkin",this.gainList.itemRenderer=GainGoodsNoSkinItem,t.prototype.initUI.call(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.setData(t[0])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.resetView()},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var n=ViewManager.ins().viewOpenCheck(i[1],i[2]);n&&(GameGuider.guidance(i[1],i[2]),ViewManager.ins().close(e))}},e.prototype.setData=function(t){if(t){var e=parseInt(t.id.toString().substring(0,3)+401),i=GlobalConfig.RuneConverConfig[e];this.nameLabel.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemUtil.getQualityColor(t)+"'>"+t.name+"Lv."+(t.level||1)+"</font>"),this.itemIcon.setData(t);var n=GlobalConfig.RuneBaseConfig[t.id];this.attrName.text=RuneConfigMgr.ins().getcfgAttrData(n),this.attrValue.text=RuneConfigMgr.ins().getcfgAttrData(n,!1),0==i.checkpoint?this.attrDes.text="默认解锁":this.attrDes.text="通关通天塔"+GlobalConfig.FbChNameConfig[Math.round(i.checkpoint/10)].name+"解锁";var s=GlobalConfig.GainItemConfig[t.id],o=0;s?(this.gainList.dataProvider=new eui.ArrayCollection(s.gainWay),o=60*s.gainWay.length):this.gainList.dataProvider=new eui.ArrayCollection([])}else this.resetView()},e.prototype.resetView=function(){this.nameLabel.text="",this.itemIcon.setData(null)},e}(BaseEuiView);__reflect(RuneBookItemTipsWin.prototype,"RuneBookItemTipsWin"),ViewManager.ins().reg(RuneBookItemTipsWin,LayerManager.UI_Popup),window.RuneBookItemTipsWin=RuneBookItemTipsWin;var RuneBookWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dataCollection=null,e._sn_="RuneOverViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){this.nuneList.itemRenderer=RuneBookItemRenderer,this.addTouchEvent(this,this.onListTap),this.showList()},e.prototype.removeDisplay=function(){this.cleanList()},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(e)}},e.prototype.onListTap=function(t){if(t.target instanceof RuneDisplay){var e=t.target.getItemConfig();ViewManager.ins().open(RuneBookItemTipsWin,e)}},e.prototype.showList=function(){if(!this.dataCollection){var t=[];t.push(new RuneBookItemData(null,"默认解锁"));var e=RuneConfigMgr.ins().getExchangeDataList();for(var i in e)t.push(new RuneBookItemData(e[i]));this.dataCollection=new eui.ArrayCollection(t)}this.nuneList.dataProvider=this.dataCollection},e.prototype.cleanList=function(){this.dataCollection&&(this.dataCollection=null),this.nuneList&&(this.nuneList.dataProvider=null)},e}(BaseEuiView);__reflect(RuneBookWin.prototype,"RuneBookWin"),ViewManager.ins().reg(RuneBookWin,LayerManager.UI_Main),window.RuneBookWin=RuneBookWin;var RuneDecomposeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneSeletctItemSkin",e.mc=new MovieClip,e.mc.scaleX=1.5,e.mc.scaleY=1.5,e.mc.x=e.itemIcon.width/2*1.5,e.mc.y=e.itemIcon.iconImg.height/2*1.5,e.addChild(e.mc),e}return __extends(e,t),e.prototype.dataChanged=function(){this.cb.touchChildren=!1,this.cb.touchEnabled=!1;var t=this.data,e=t.itemData;if(e&&e instanceof ItemData){var i=RuneConfigMgr.ins().getBaseCfg(e);i?(this.itemIcon.setData(e),this.power.text=RuneConfigMgr.ins().getcfgAttrDesc(i,!0)):this.resetView()}else this.resetView();this.cb.selected=t.isSelected},e.prototype.resetView=function(){this.itemIcon.setData(null),this.power.text=""},e.prototype.playEffect=function(){this.cb.selected&&this.mc.playFile(RES_DIR_EFF+"BoomEff",1)},e}(eui.ItemRenderer);__reflect(RuneDecomposeItemRenderer.prototype,"RuneDecomposeItemRenderer"),window.RuneDecomposeItemRenderer=RuneDecomposeItemRenderer;var RuneDecomposePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardList=null,e.cardCollection=null,e.checkBoxNum=5,e.itemListScrollV=0,e.resolveIng=!1,e._addNum=0,e._chipNum=0,e._sn_="DecomposeruneSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=0;t<this.checkBoxNum;t++)this["cb"+t]&&this.addTouchEvent(this["cb"+t],this.onCBTap);this.addTouchEvent(this.decomposeBtn,this.onTap),this.addTouchEvent(this.itemList,this.onListTap),this.observe(GameLogic.ins().postRuneShatter,this.onShatterChange),this.observe(GameLogic.ins().postRuneExchange,this.onShatterChange),this.observe(Rune.ins().postOneKeyDecomposeResult,this.onDecomposeResult),this.initCardList(),this.resetCheckBox(),this.updateShatter()},e.prototype.skinComplete=function(){this.itemList.itemRenderer=RuneDecomposeItemRenderer,this.itemList.useVirtualLayout=!0},e.prototype.removeDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.cleanCardList()},e.prototype.onDecomposeResult=function(t){var e=this;if(t[0]){var i=t[1],n=t[2],s="",o=0;i>0?(s="普通",o=i):n>0&&(s="特殊",o=n),this._addNum&&TipsCT.ins().showTips("分解成功，|C:0x35e62d&T:战纹精华x"+this._addNum+"|"),this._chipNum&&TipsCT.ins().showTips("分解成功，|C:0x35e62d&T:战纹碎片x"+this._chipNum+"|"),this.playEffect(),Timer.start(500,1,function(){e.initCardList(),e.updateShatter(),e.updateAddShatter(),e.resolveIng=!1},this)}else TipsCT.ins().showTips("分解失败，请稍后再试")},e.prototype.playEffect=function(){for(var t=this.itemList.numChildren,e=0;t>e;e++){var i=this.itemList.getChildAt(e);i&&i.playEffect()}},e.prototype.onShatterChange=function(){this.updateShatter()},e.prototype.onListTap=function(t){if(t&&t.currentTarget){var e=this.itemList.selectedIndex;if(0>e)return;var i=this.itemList.getVirtualElementAt(e);if(i&&i instanceof RuneDecomposeItemRenderer&&i.cb){var n=i.data;n&&(n.isSelected=!n.isSelected,this.cardCollection.itemUpdated(n))}this.itemList.selectedIndex=-1,this.updateAddShatter()}},e.prototype.onTap=function(t){if(t&&t.currentTarget)switch(t.currentTarget){case this.decomposeBtn:this.decomposeRune()}},e.prototype.decomposeRune=function(){var t=this;if(!this.resolveIng){if(this.cardList&&this.cardList.length>0){for(var e=!1,i=null,n=null,s=[],o=0,a=this.cardList;o<a.length;o++){var r=a[o];r&&r.isSelected&&r.itemData&&r.itemData.itemConfig&&(s.push(r.itemData),i=RuneConfigMgr.ins().getBaseCfg(r.itemData),n=r.itemData.itemConfig,ItemUtil.getQuality(n)>=RuneConfigMgr.ins().getOtherCfg().maxQuality&&(e=!0))}if(e){var l="",h="",u="";e&&(h="<font color = '"+ItemBase.QUALITY_COLOR[RuneConfigMgr.ins().getOtherCfg().maxQuality]+"' size = '22'>顶级战纹</font>");var p=l+u+h,c="当前分解战纹包括"+p+"，是否继续进行分解";return void WarnWin.show(c,function(){t.resolveIng=!0,Rune.ins().sendOneKeyDecompose(s)},this)}if(s.length>0)return this.resolveIng=!0,void Rune.ins().sendOneKeyDecompose(s)}TipsCT.ins().showTips("当前无选择任何战纹")}},e.prototype.onCBTap=function(t){if(t&&t.currentTarget){var e=t.currentTarget;if(e&&e instanceof eui.CheckBox)for(var i=null,n=0;n<this.checkBoxNum;n++)if(i=this["cb"+n],i&&i===e)return void this.setQualitySelected(n+1,e.selected)}},e.prototype.updateShatter=function(){var t=Actor.runeShatter;this.curLab.text=t.toString();var e=Actor.runeExchange;this.suipianNow.text=e.toString(),this.materialLab.text=""+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,ItemConst.JINGJIN)},e.prototype.updateAddShatter=function(){var t=0,e=0,i=0,n=null;GlobalConfig.ItemConfig[GlobalConfig.RuneOtherConfig.goldItemId].name;if(this.cardList&&this.cardList.length>0)for(var s=0,o=this.cardList;s<o.length;s++){var a=o[s];if(a&&a.isSelected&&a.itemData&&a.itemData.itemConfig&&(n=RuneConfigMgr.ins().getBaseCfg(a.itemData))){t+=n.gain;var r=GlobalConfig.RuneBaseConfig[n.id-n.id%100+1];r.chip&&(e+=r.chip);var l=GlobalConfig.RuneComposeConfig[n.id];l&&(i+=l.count)}}this._addNum=t,this._chipNum=e,this.addLab.text=t>0?"+"+t+"  ":"",this.suipianAdd.text=e?"+"+e:"",this.materialLab.text=""+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,ItemConst.JINGJIN),this.addMaterialLab.text=i>0?"  +"+i:""},e.prototype.setQualitySelected=function(t,e){if(0>t)for(var i=0,n=this.cardList;i<n.length;i++){var s=n[i];s.itemData&&s.itemData.itemConfig&&(s.isSelected=!1)}else for(var o=0,a=this.cardList;o<a.length;o++){var s=a[o];s.itemData&&s.itemData.itemConfig&&ItemUtil.getQuality(s.itemData.itemConfig)==t&&(s.isSelected=e)}for(var r=this.cardCollection.length,l=0;r>l;l++)this.cardCollection.itemUpdated(this.cardList[l]);this.updateAddShatter()},e.prototype.getCheckBoxSelected=function(t){var e=this["cb"+(t-1)];return e?e.selected:!1},e.prototype.resetCheckBox=function(t){void 0===t&&(t=1);for(var e=null,i=0;i<this.checkBoxNum;i++)e=this["cb"+i],e&&e instanceof eui.CheckBox&&(e.selected=i+1==t);this.setQualitySelected(t,!0)},e.prototype.initCardList=function(){this.cleanCardList(),this.cardList=[];var t=BagCT.ins().getBagGoodsByType(6);if(t&&t.length>0){for(var e=null,i=0,n=t;i<n.length;i++)for(var s=n[i],o=0;o<s.count;o++)e=new RuneDecomposeItemData,e.itemData=s,this.cardList.push(e);this.cardList.sort(this.sortList)}this.cardCollection=new eui.ArrayCollection(this.cardList),this.itemList.dataProvider=this.cardCollection},e.prototype.cleanCardList=function(){this.cardList=null,this.cardCollection=null,this.itemList&&(this.itemList.dataProvider=null)},e.prototype.sortList=function(t,e){var i=ItemUtil.getQuality(t.itemData.itemConfig),n=ItemUtil.getQuality(e.itemData.itemConfig);if(i>n)return-1;if(n>i)return 1;var s=RuneConfigMgr.ins().getBaseCfg(t.itemData),o=RuneConfigMgr.ins().getBaseCfg(e.itemData);if(s&&o){var a=s.id%100,r=o.id%100;if(a>r)return-1;if(r>a)return 1}return t.itemData.configID-e.itemData.configID},e}(BaseEuiView);__reflect(RuneDecomposePanel.prototype,"RuneDecomposePanel"),ViewManager.ins().reg(RuneDecomposePanel,LayerManager.UI_Main),window.RuneDecomposePanel=RuneDecomposePanel;var RuneDisplay=function(t){function e(){var e=t.call(this)||this;return e.pos=-1,e.isShowName=!0,e.unlockMc=new MovieClip,e.skinName="RuneItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){var e=t.target;e==this.noOpenTF&&ViewManager.ins().open(FbWin,1)},e.prototype.setPos=function(t,i){this.pos=i;var n=RuneConfigMgr.ins().getLockCfg(i);this.showUnlockEff(!1);var s=SkyLevelModel.ins().cruLevel,o=n.lockLv;s>o?Rune.ins().hasUnclock(t,i)?this.currentState=e.SKIN_STATE_UNLOCK:(this.showUnlockEff(!0),this.currentState=e.SKIN_STATE_LOCK):this.currentState=e.SKIN_STATE_LOCK},e.prototype.showUnlockEff=function(t){t&&!this.unlockMc.isPlaying&&this.eUnlockEff?(this.unlockMc.playFile(RES_DIR_EFF+"OpenRole",-1),this.eUnlockEff.addChild(this.unlockMc)):t||(this.unlockMc.stop(),DisplayUtils.removeFromParent(this.unlockMc))},e.prototype.setLockTF=function(t){if(!(this.pos<0||this.currentState!=e.SKIN_STATE_LOCK&&this.currentState!=e.SKIN_STATE_READY)){var i=RuneConfigMgr.ins().getLockCfg(this.pos),n=null;if(this.pos>=1&&(n=RuneConfigMgr.ins().getLockCfg(this.pos-1)),n&&n.lockLv<=SkyLevelModel.ins().cruLevel&&t){var s=GlobalConfig.FbChallengeConfig[i.lockLv],o=SkyLevelModel.ins(),a=o.getNextOpenLevel(),r=0;a&&(r=a.layer);var l="|U:&C:0x35e62d&T:通关通天塔"+GlobalConfig.FbChNameConfig[s.group].name+r+"层开启";this.noOpenTF&&(this.noOpenTF.textFlow=TextFlowMaker.generateTextFlow1(l),this.noOpenTF.hasEventListener(egret.TouchEvent.TOUCH_END)||this.addTouchEndEvent(this.noOpenTF,this.onTap))}else this.noOpenTF&&(this.noOpenTF.text="")}},e.prototype.setData=function(t){if(t&&!(t.itemConfig&&t.itemConfig.id<=0)&&this.skin){this.data=t;var e=GlobalConfig.ItemConfig[t.itemConfig.id];this._itemConfig=e,this.nameBG.visible=this.isShowName,this.nameTF.visible=this.isShowName,this.iconImg.source=e.icon+"_png";var i=GlobalConfig.RuneNameConfig[ItemUtil.getSubType(e)];this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemUtil.getQualityColor(e)+"&T:"+i.runeName+"Lv."+e.id%100)}},e.prototype.setDataByItemConfig=function(t){if(t){this._itemConfig=t,this.currentState=e.SKIN_STATE_UNLOCK,this.nameBG.visible=this.isShowName,this.nameTF.visible=this.isShowName,this.iconImg.source=t.icon+"_png";var i=GlobalConfig.RuneNameConfig[ItemUtil.getSubType(t)];t.level&&0!=t.level?this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemUtil.getQualityColor(t)+"&T:"+i.runeName+" Lv."+t.level%100+"|"):this.nameTF.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemUtil.getQualityColor(t)+"&T:"+i.runeName+" Lv.1|")}},e.prototype.getItemConfig=function(){return this._itemConfig},e.prototype.cleanData=function(){this.data=null,this._itemConfig=null,this.iconImg&&(this.iconImg.source=null),this.nameTF&&(this.nameTF.text="",this.nameTF.visible=!1),this.nameBG&&(this.nameBG.visible=!1)},e.prototype.showOrHideSelected=function(t){this.selectedImg&&(this.selectedImg.visible=t)},e.prototype.showName=function(t){this.isShowName=t},e.SKIN_STATE_LOCK="lock",e.SKIN_STATE_READY="ready",e.SKIN_STATE_UNLOCK="unlock",e}(BaseView);__reflect(RuneDisplay.prototype,"RuneDisplay"),window.RuneDisplay=RuneDisplay;var RuneeffWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="RuneeffSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.bgClose,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.role=t[0],this.update()},e.prototype.update=function(){if(this.role){var t=this.role.runeDatas,e=[];for(var i in t){var n=ItemUtil.getQuality(t[i].itemConfig);e[n]?e[n]++:e[n]=1}var s="",o=0;for(var i in GlobalConfig.RuneSuitConf){var a=GlobalConfig.RuneSuitConf[i];for(var r in a){var l=a[r],n=l.quality;o!=n-3&&(s=""),o=n-3;var h=l.count,u=e[n]>=h?ColorUtil.GREEN:11645079;s+="|C:"+u+"&T:"+ColorUtil.COLOR_STR[n]+("图腾"+h+"件套:")+AttributeData.getAttStr(l.attrs,0,0,"+",!1,!0,null," "),s+="("+(e[n]>=h?"已":"未")+"激活)|\n",this["Desc"+o].textFlow=TextFlowMaker.generateTextFlow("|C:"+u+"&T:"+s+"|")}}}},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RuneeffWin.prototype,"RuneeffWin"),ViewManager.ins().reg(RuneeffWin,LayerManager.UI_Popup),window.RuneeffWin=RuneeffWin;var RuneExchangeItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneExchangeItemSkin",e.goBtn.name="goBtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.ItemConfig[t.id];this.icon.setDataByItemConfig(e);var i=RuneConfigMgr.ins().getBaseCfgByItemConfig(e);this.descLab.text=RuneConfigMgr.ins().getcfgAttrDesc(i);var n=GlobalConfig.FbChallengeConfig[t.checkpoint];n?this.descLab1.text="通关通天塔"+GlobalConfig.FbChNameConfig[n.group].name+"解锁":this.descLab1.text="默认解锁";var s="";s=Actor.runeExchange>=t.conversion?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.nameLab0.textFlow=TextFlowMaker.generateTextFlow("<font color="+s+">"+Actor.runeExchange+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+t.conversion+"</font> "),this.setEff(e)}else this.retView()},e.prototype.setEff=function(t){var e=ItemUtil.getQuality(t);5==e&&(this.EquipEffect=this.EquipEffect||new MovieClip,this.EquipEffect.touchEnabled=!1,this.EquipEffect.parent||this.addChild(this.EquipEffect),this.EquipEffect.playFile(RES_DIR_EFF+"LegenEqui",-1),this.EquipEffect.x=this.effpos.x,this.EquipEffect.y=this.effpos.y,this.EquipEffect.scaleX=this.effpos.scaleX,this.EquipEffect.scaleY=this.effpos.scaleY)},e.prototype.close=function(){DisplayUtils.removeFromParent(this.EquipEffect)},e.prototype.retView=function(){this.descLab.text="",this.descLab1.text="",this.nameLab0.text="",this.icon.setData(null),this.close()},e}(eui.ItemRenderer);__reflect(RuneExchangeItemRenderer.prototype,"RuneExchangeItemRenderer"),window.RuneExchangeItemRenderer=RuneExchangeItemRenderer;var RuneExchangePanel=function(t){function e(){var e=t.call(this)||this;return e._scrollV=0,e.skinName="RuneSkinExchange",e.menulist0.itemRenderer=RuneExchangeItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postRuneExchange,this.updateList),this.addTouchEvent(this.menulist0,this.onListTap),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=0;i<this.menulist0.numElements;i++){var n=this.menulist0.getVirtualElementAt(i);n.close()}},e.prototype.updateList=function(){var t=RuneConfigMgr.ins().getExchangeDataList();this.menulist0.dataProvider=new eui.ArrayCollection(t);var e=this.menulist0.parent;e.validateNow(),e.stopAnimation(),this.menulist0.scrollV=this._scrollV},e.prototype.onListTap=function(t){if("goBtn"==t.target.name){var e=this.menulist0.selectedItem;if(!e||e&&e.conversion>Actor.runeExchange)return WarnCT.ins().setBuyGoodsWarn(500008,e.conversion-Actor.runeExchange),void TipsCT.ins().showTips("道具不足");if(!(SkyLevelModel.ins().lastPass||SkyLevelModel.ins().cruLevel>=e.checkpoint))return void TipsCT.ins().showTips("通关等级不足");Rune.ins().sendExchangeRune(e.id),this._scrollV=this.menulist0.scrollV}},e}(BaseView);__reflect(RuneExchangePanel.prototype,"RuneExchangePanel"),window.RuneExchangePanel=RuneExchangePanel;var RuneReplaceItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneEquipChangeSkinItem",e.changeBtn.name="changeBtn",e.changeBtn0.name="changeBtn",e.getBtn.name="getBtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=t.data;if(this.currentState="all",this.validateNow(),e&&e instanceof ItemData)if(e.configID){var i=RuneConfigMgr.ins().getBaseCfg(e);if(i){this.itemIcon.showName(!1),this.itemIcon.setData(e);var n=GlobalConfig.ItemConfig[e.itemConfig.id],s=GlobalConfig.RuneNameConfig[ItemUtil.getSubType(n)];if(this.runeName.textFlow=TextFlowMaker.generateTextFlow("|C:"+ItemUtil.getQualityColor(n)+"&T:"+s.runeName+"Lv."+n.id%100),this.back.text="回收可得"+i.gain+"精华",this.attr.text=RuneConfigMgr.ins().getcfgAttrDesc(i),this.changeBtn.visible=t.canEquip&&RuneDataMgr.ins().posIsWear,this.changeBtn0.visible=t.canEquip&&!RuneDataMgr.ins().posIsWear,this.now.visible=!t.canEquip&&RuneDataMgr.ins().posIsWear&&RuneDataMgr.ins().posIsWear.configID==e.configID,this.already.visible=!t.canEquip&&RuneDataMgr.ins().posIsWear!=e,!this.already.visible){var o=ViewManager.ins().getView(RuneReplaceWin);o&&(this.already.visible=Rune.ins().isEquipMerge(e.configID,o.roleIndex,o.posIndex),this.changeBtn.visible=this.changeBtn0.visible=!this.already.visible)}}else this.resetView()}else this.setBtnStatu(),this.resetView();else this.resetView()},e.prototype.setBtnStatu=function(){null==this.data||null==this.data.data?(this.currentState="dis",this.itemIcon.currentState="emp"):this.data.data.configID?(this.currentState="all",this.changeBtn.visible=!1,this.changeBtn0.visible=!1,this.now.visible=!0,this.already.visible=!1):this.currentState="get"},e.prototype.getItemId=function(){return this.data&&this.data.data?this.data.data.configID:0},e.prototype.resetView=function(){this.itemIcon.setData(null),this.nameLab.text="",this.attr.text=""},e}(eui.ItemRenderer);__reflect(RuneReplaceItemRenderer.prototype,"RuneReplaceItemRenderer");var RuneReplaceItemData=function(){function t(t){this.data=t}return t}();__reflect(RuneReplaceItemData.prototype,"RuneReplaceItemData"),window.RuneReplaceItemRenderer=RuneReplaceItemRenderer;var RuneReplaceSpecialItemRenderer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t&&t instanceof ItemData){var e=RuneConfigMgr.ins().getBaseCfg(t);this.itemIcon.setData(t.itemConfig),this.nameLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+ItemUtil.getQualityColor(t.itemConfig)+"'>"+t.itemConfig.name+"</font>");var i=AttributeData.getAttrFromCfg(e);i.length>0?this.power.text="评分："+BagCT.getAttrPower(i):this.power.text="评分："+e.power,this.numLab.text=t.count.toString(),this.specialEffLab.text=e.specialDesc}else this.resetView()},e.prototype.resetView=function(){this.itemIcon.setData(null),this.nameLab.text="",this.specialEffLab.text="",this.power.text="",this.numLab.text=""},e}(eui.ItemRenderer);__reflect(RuneReplaceSpecialItemRenderer.prototype,"RuneReplaceSpecialItemRenderer"),window.RuneReplaceSpecialItemRenderer=RuneReplaceSpecialItemRenderer;var RuneReplaceWin=function(t){function e(){var e=t.call(this)||this;return e.posIndex=0,e.roleIndex=0,e.item=null,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="RuneEquipChangeSkin",this.isTopLevel=!0,this.list.itemRenderer=RuneReplaceItemRenderer,this.myItem=new RuneReplaceItemRenderer,this.itemGroup.addChild(this.myItem)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.posIndex=isNaN(t[0])?0:t[0],this.roleIndex=isNaN(t[1])?0:t[1],this.item=t[2],this.runeTypeList=t[3],RuneDataMgr.ins().posIsWear=this.item,this.myItem.data=new RuneReplaceItemData(this.item),this.myItem.setBtnStatu(),this.addTouchEvent(this.list,this.onListTap),this.observe(Rune.ins().postInlayResult,this.onInlayResult),this.updateList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];MessageCenter.ins().removeAll(this),this.list.dataProvider=null},e.prototype.onListTap=function(t){var e=this;if("changeBtn"!=t.target.name)return void("getBtn"==t.target.name&&ViewManager.ins().open(FbWin,1));var i=null,n=this.list.selectedItem;n&&(i=n.data);var s=!1;if(i&&i instanceof ItemData){var o=GlobalConfig.ItemConfig[i.configID],a=RuneDataMgr.ins().getRune(this.roleIndex,this.posIndex);if(a){var r=null;if(a.configID>0&&(r=RuneConfigMgr.ins().getBaseCfg(a)),r&&a.itemConfig&&ItemUtil.getSubType(o)==ItemUtil.getSubType(a.itemConfig));else{var l=RuneDataMgr.ins().getRoleRune(this.roleIndex);if(l)for(var h=null,u=0,p=l;u<p.length;u++){var c=p[u];if(c&&c.itemConfig&&c.itemConfig.id>0&&(h=GlobalConfig.ItemConfig[c.configID],h&&ItemUtil.getSubType(h)==ItemUtil.getSubType(o))){s=!0;break}}}}if(s||!Rune.ins().isCanEquip(i.configID,this.roleIndex,this.myItem.getItemId(),this.posIndex))return void TipsCT.ins().showTips("每个角色同种属性的战纹只能镶嵌一个");var d=Rune.ins().getMergeRune(i.configID,this.roleIndex,this.item);if(d)return void WarnWin.show(d[0],function(){Rune.ins().sendInlay(e.roleIndex,e.posIndex,i.handle)},this);Rune.ins().sendInlay(this.roleIndex,this.posIndex,i.handle)}},e.prototype.updateList=function(){var t=BagCT.ins().getBagGoodsByType(6);if(t){for(var e=[],i=[],n=this.item&&this.item.itemConfig?ItemUtil.getSubType(this.item.itemConfig):-1,s=0,o=t;s<o.length;s++){var a=o[s];if(a&&RuneConfigMgr.ins().getBaseCfg(a)){var r=ItemUtil.getSubType(a.itemConfig);n==r||this.runeTypeList.indexOf(r)<0?n>-1&&this.item.configID==a.configID||(Rune.ins().isEquipMerge(a.configID,this.roleIndex,this.posIndex)?i.push(a):e.push(a)):i.push(a)}}e.sort(this.sortRunes),i.sort(this.sortRunes);var l=[].concat(e,i),h=new ItemData;l.push(h);for(var u=[],p=0;p<l.length;p++){var c=new RuneReplaceItemData(l[p]);c.canEquip=!1,p<e.length&&(c.canEquip=!0),u.push(c)}this.list.dataProvider=new eui.ArrayCollection(u)}},e.prototype.sortRunes=function(t,e){var i=ItemUtil.getQuality(t.itemConfig),n=ItemUtil.getQuality(e.itemConfig);if(i>n)return-1;if(n>i)return 1;var s=RuneConfigMgr.ins().getBaseCfg(t),o=RuneConfigMgr.ins().getBaseCfg(e);if(s&&o){var a=s.id%100,r=o.id%100;if(a>r)return-1;if(r>a)return 1}return t.configID-e.configID},e.prototype.onInlayResult=function(t){t[0]&&ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(RuneReplaceWin.prototype,"RuneReplaceWin"),ViewManager.ins().reg(RuneReplaceWin,LayerManager.UI_Main),window.RuneReplaceWin=RuneReplaceWin;var SamsaraCC=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Samsara,e.regNetMsg(1,e.postSamsaraInfo),e.regNetMsg(4,e.postCompose),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.exchangeSamsaraExp=function(t){var e=this.getBytes(2);e.writeByte(t),this.sendToServer(e)},e.prototype.upgradeSamsaraLv=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.postSamsaraInfo=function(t){var e=SamsaraModel.ins().samsaraInfo?!1:!0,i=SamsaraModel.ins().samsaraInfo?SamsaraModel.ins().samsaraInfo.exp:0;if(SamsaraModel.ins().samsaraInfo=new SamsaraVO(t.readInt(),t.readInt(),t.readShort(),t.readShort(),t.readShort()),!e){var n=SamsaraModel.ins().samsaraInfo.exp-i;n&&TipsCT.ins().showTips("|C:0x00ff00&T:获得业力"+n+"|")}},e.prototype.requestCompose=function(t,e){var i=this.getBytes(4);i.writeInt(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postCompose=function(t){},__decorate([post()],e.prototype,"postSamsaraInfo",null),__decorate([post()],e.prototype,"postCompose",null),e}(BaseSystem);__reflect(SamsaraCC.prototype,"SamsaraCC"),System.SamsaraCC=function(){return SamsaraCC.ins()};var SamsaraUpgradeType;!function(t){t[t.level=1]="level",t[t.normal=2]="normal",t[t.advanced=3]="advanced"}(SamsaraUpgradeType||(SamsaraUpgradeType={})),window.SamsaraCC=SamsaraCC;var ExchangeVO=function(){function t(){}return t}();__reflect(ExchangeVO.prototype,"ExchangeVO"),window.ExchangeVO=ExchangeVO;var ReincarnationDemonLevel=function(){function t(){}return t}();__reflect(ReincarnationDemonLevel.prototype,"ReincarnationDemonLevel"),window.ReincarnationDemonLevel=ReincarnationDemonLevel;var ReincarnationLinkLevel=function(){function t(){}return t}();__reflect(ReincarnationLinkLevel.prototype,"ReincarnationLinkLevel"),window.ReincarnationLinkLevel=ReincarnationLinkLevel;var ReincarnationSoulLevel=function(){function t(){}return t}();__reflect(ReincarnationSoulLevel.prototype,"ReincarnationSoulLevel"),window.ReincarnationSoulLevel=ReincarnationSoulLevel;var SamsaraModel=function(t){function e(){var e=t.call(this)||this;return e.composeEquipMap={},e.composeEquipTypes=[],e.equipCompose={},e.samsaraDescAry=GlobalConfig.ReincarnationBase.names,e.initComposeEquip(),e.composeEquipTypes=e.getComposeMenu(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.isCanUpgrade=function(){if(!this.samsaraInfo)return!1;var t=this.samsaraInfo.lv,e=t+1,i=GlobalConfig.ReincarnationLevel[e],n=!1;return i?(e<CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel)&&this.samsaraInfo.exp>=i.consume&&(n=!0),n):n},e.prototype.getExpExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.levelExchangeTimes-this.samsaraInfo.expUpgradeNum;return t},e.prototype.getNormalExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.normalItem.time-this.samsaraInfo.normalUpgradeNum;return t},e.prototype.getAdvancedExchangeTimes=function(){if(!this.samsaraInfo)return 0;var t=GlobalConfig.ReincarnationBase.advanceItem.time-this.samsaraInfo.advancedUpgradeNum;return t},e.prototype.isCanExpExchange=function(){var t=!1;return Actor.level>=GlobalConfig.ReincarnationBase.levelLimit&&this.getExpExchangeTimes()>0&&(t=!0),t},e.prototype.isCanItemExchange=function(){var t;return this.getNormalExchangeTimes()>0&&(t=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.normalItem.id),t>0)?!0:this.getAdvancedExchangeTimes()>0&&(t=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.ReincarnationBase.advanceItem.id),t>0)?!0:!1},e.prototype.isCanExchange=function(){return this.isMaxSamsara(Actor.samsaraLv)?!1:this.isCanExpExchange()||this.isCanItemExchange()},e.prototype.isOpen=function(){var t=1e3*ZsCT.ins().lv+Actor.level;return t>=GlobalConfig.ReincarnationBase.openLevel},e.prototype.isMaxSamsara=function(t){var e=CommonUtils.getObjectLength(GlobalConfig.ReincarnationLevel),i=GlobalConfig.ReincarnationLevel[e-1];return i?t>=i.level:!1},e.prototype.lowSuitEquips=function(t,e){for(var i=[],n=this.getEquipSamsaraLvByRole(t,e),s=EquipPos.HAT;s<EquipPos.MAX;s++){var o=this.getEquipSamsaraLvByRole(s,e);n>o?i.push(0):i.push(1)}return i},e.prototype.getEquipSamsaraLvByRole=function(t,e){var i=e.getEquipByIndex(t);return i.item.itemConfig?this.getEquipSamsaraLv(i.item.itemConfig.id):0},e.prototype.getEquipSamsaraLv=function(t){var e=GlobalConfig.ItemConfig[t].zsLevel;return e},e.prototype.getReincarnateSuit=function(t){var e=GlobalConfig.ItemConfig[t].zsLevel;return GlobalConfig.ReincarnateSuit[e]},e.prototype.getSamsara=function(t){var e=0;return t>=7&&(e=Math.ceil((t-6)/6)),e},e.prototype.getSamsaraDesc=function(t){return this.samsaraDescAry[t]},e.prototype.getSamsaraLv=function(t){var e=0;return e=0==t?-1:Math.ceil((t-1)%6)},e.prototype.getSamsaraLvDesc=function(t){var e=t+1;return GlobalConfig.ReincarnationBase.state[e]},e.prototype.getAddSpiritEquips=function(t,e,i){void 0===i&&(i=10);var n=[],s=SubRoles.ins(),o=BagCT.ins().bagModel[BagCT.BAG_TYPE_EQUIP],a=GlobalConfig.ReincarnateEquip,r=GlobalConfig.ReincarnateEquipCompose;if(!o||!o.length)return n;for(var l=0,h=o;l<h.length;l++){var u=h[l];if(a[u.configID]){var p=u.subType,c=u.job;if(t=s.getSubRoleByJob(c)){var d=t.getEquipByIndex(p),g=d.item;if(!g.itemConfig)break;var f=r[g.configID],v=(f?f.distinguishi:0)-1;if(u.itemConfig.zsLevel<g.itemConfig.zsLevel+v&&(n.push(u),n.length>=i))break}}}return n},e.prototype.isCanAddSpirit=function(){for(var t=0,e=SubRoles.ins().roles;t<e.length;t++)for(var i=e[t],n=EquipPos.HAT;n<EquipPos.MAX;n++){var s=i.getEquipByIndex(n);if(s.item.itemConfig){var o=this.getAddSpiritEquips(i,n,1);if(o.length>0)return!0}}return!1},e.prototype.checkRoleCanAddSpirit=function(t){for(var e=SubRoles.ins().getSubRoleByIndex(t),i=EquipPos.HAT;i<EquipPos.MAX;i++){var n=e.getEquipByIndex(i);if(n.item.itemConfig){var s=this.getAddSpiritEquips(e,i,1);if(s.length>0)return!0}}return!1},e.prototype.checkEquipPosCanAddSpirit=function(t,e){var i=t.getEquipByIndex(e);if(i.item.itemConfig&&!this.checkSpiritLvIsMax(i,e)){var n=this.getAddSpiritEquips(t,e,1);if(n.length>0)return!0}return!1},e.prototype.checkSpiritLvIsMax=function(t,e){var i=t.spiritLv;return!GlobalConfig.ReincarnateSpirit[e][i+1]},e.prototype.getExtraPower=function(t,e,i){for(var n=0,s=0,o=EquipPos.HAT;o<=EquipPos.SHIELD;o++){var a=t.getEquipByIndex(o);if(a.item.itemConfig){var r=a.item.itemConfig.id;if(r&&GlobalConfig.EquipConfig[r].baseAttr1){var l=GlobalConfig.EquipConfig[r].baseAttr1;s+=l.value}}}if(i){var h=GlobalConfig.AttrPowerConfig,u=h[i];n=s*u.relate_power*e}return n},e.prototype.initComposeEquip=function(){for(var t=GlobalConfig.ReincarnationBase.headName,e=t.length,i=1;e>=i;i++)this.composeEquipMap[i]||(this.composeEquipMap[i]={});
for(var n in GlobalConfig.ReincarnateEquipCompose){var s=GlobalConfig.ReincarnateEquipCompose[n];this.equipCompose[s.material.id]=s;var o=s.distinguishi,a=this.composeEquipMap[o],r=GlobalConfig.ItemConfig[s.id],l=r.zsLevel,h=a[l];h||(h=[]),h.push({type:MergeType.SamsareEquip,id:s.id}),a[l]=h,this.composeEquipMap[o]=a}},e.prototype.getComposeMenu=function(){for(var t=GlobalConfig.ReincarnationBase.headName,e=t.length,i=[],n=1;e>=n;n++)i.push(n);return i},e.prototype.getComposeZsList=function(t){var e=ZsCT.ins().lv,i=GlobalConfig.ReincarnationBase.equipsList[t-1],n=[];for(var s in i)i[s]<=e&&n.push({type:t,zsLv:i[s]});return n},e.prototype.getComposeDesc=function(t){return GlobalConfig.ReincarnationBase.headName[t-1]},e.prototype.isCanCompose=function(){return this.getComposeEquipList().length>0},e.prototype.getComposeEquipId=function(t,e){var i=0,n=this.getComposeEquipList();for(var s in n){var o=n[s],a=this.getComposeTarget(o);if(GlobalConfig.ItemConfig[a].zsLevel==e&&GlobalConfig.ReincarnateEquipCompose[a].distinguishi==t)return o}return i},e.prototype.getComposeEquipList=function(){var t=[],e=BagCT.ins().itemCount[1];for(var i in e)if(this.equipCompose[i]){var n=+i,s=this.composeMaxEquip(n);s&&this.isCanWear(s)&&t.push(n)}return t},e.prototype.isCanWear=function(t){if(!t)return!1;var e=GlobalConfig.ItemConfig[t],i=1e3*ZsCT.ins().lv+Actor.level,n=1e3*e.zsLevel+e.level;if(n>i)return!1;var s=ItemUtil.getJob(e),o=ItemUtil.getSubType(e),a=SubRoles.ins().getSubRoleByJob(s);if(!a)return!1;var r=a.getEquipByIndex(o),l=r.item.itemConfig;if(!l)return!0;var h=r.item.point,u=new ItemData;u.configID=t;var p=u.point;return p>h?!0:!1},e.prototype.composeMaxEquip=function(t){var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_EQUIP,t);if(e){var i=new RewardData;i.id=t,i.count=0;var n=this.composeEquip(i);if(n&&n.id!=t)return n.id}return 0},e.prototype.composeEquip=function(t){var e,i=t.id,n=t.count+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_EQUIP,i)+this.wearCount(i),s=this.equipCompose[i];return s&&n>=s.material.count?(e=new RewardData,e.id=s.id,e.count=Math.floor(n/s.material.count),this.composeEquip(e)):t},e.prototype.wearCount=function(t){var e=GlobalConfig.ItemConfig[t],i=ItemUtil.getJob(e),n=SubRoles.ins().getSubRoleByJob(i);if(!n)return 0;var s=ItemUtil.getSubType(e),o=n.getEquipByIndex(s),a=o.item.itemConfig;return a&&a.id==t?1:0},e.prototype.getRoleIndexByEquip=function(t){for(var e=GlobalConfig.ItemConfig[t],i=ItemUtil.getJob(e),n=ItemUtil.getSubType(e),s=SubRoles.ins().subRolesLen,o=0;s>o;o++){var a=SubRoles.ins().getSubRoleByIndex(o);if(a.job==i){var r=a.getEquipByIndex(n),l=r.item.itemConfig;if(l&&l.id==t)return o}}return-1},e.prototype.isCanTypeCompose=function(t){var e=this.getComposeEquipList();for(var i in e){var n=e[i],s=GlobalConfig.ReincarnateEquipCompose[this.getComposeTarget(n)];if(s.distinguishi==t)return!0}return!1},e.prototype.getComposeTarget=function(t){var e=this.equipCompose[t];return e?e.id:0},e.prototype.isCanZsLvCompose=function(t,e){var i=this.getComposeEquipList();for(var n in i){var s=i[n],o=this.getComposeTarget(s),a=GlobalConfig.ReincarnateEquipCompose[o],r=GlobalConfig.ItemConfig[o].zsLevel;if(e==r&&a.distinguishi==t)return!0}return!1},e.prototype.isCanEquipCompose=function(t){var e=this.getComposeEquipList();return e.indexOf(t)>=0},e.prototype.getReincarnationLinkLevel=function(t,e){for(var i in GlobalConfig.ReincarnationLinkLevel)if(i==t.toString())for(var n in GlobalConfig.ReincarnationLinkLevel[i])for(var s in GlobalConfig.ReincarnationLinkLevel[i][n])if(s==e.toString())return GlobalConfig.ReincarnationLinkLevel[i][n][s];return null},e.prototype.getSoulLinkDesc=function(t){var e;switch(t){case 11:e="生命";break;case 55:e="伤害加成";break;case 19:e="暴击伤害";break;case 56:e="暴击伤害减免率"}return e},e.prototype.getSoulMaxLevel=function(){return CommonUtils.getObjectLength(GlobalConfig.ReincarnationDemonLevel[EquipPos.HAT])},e.prototype.getSoulLinkLv=function(t,e,i){var n=this.getLinkEquipPos(e),s=t.getEquipByIndex(e),o=t.getEquipByIndex(n);return s&&o?Math.min(s.soulLv,o.soulLv):0},e.prototype.getLinkEquipPos=function(t){for(var e in GlobalConfig.ReincarnationLinkLevel)if(e==t.toString())for(var i in GlobalConfig.ReincarnationLinkLevel[e])return+i;return null},e.prototype.isCanUpgradeSoul=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++)for(var i=EquipPos.HAT;i<=EquipPos.SHIELD;i++){var n=this.checkUpgradeSoul(SubRoles.ins().getSubRoleByIndex(e),i);if(n)return!0}return!1},e.prototype.checkUpgradeSoul=function(t,e){var i=t.getEquipByIndex(e),n=i.soulLv;if(n!=this.getSoulMaxLevel()&&i.item.itemConfig){var s=GlobalConfig.ReincarnationSoulLevel[t.job][e][n+1],o=BagCT.ins().getBagGoodsCountById(0,s.materialInfo.id);return o>=s.materialInfo.count}return!1},e}(BaseClass);__reflect(SamsaraModel.prototype,"SamsaraModel"),window.SamsaraModel=SamsaraModel;var SamsaraVO=function(){function t(t,e,i,n,s){this.lv=t,this.exp=e,this.expUpgradeNum=i,this.normalUpgradeNum=n,this.advancedUpgradeNum=s}return t}();__reflect(SamsaraVO.prototype,"SamsaraVO"),window.SamsaraVO=SamsaraVO;var AddSpiritView=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="ReincarnateSpiritSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lunhuiList.itemRenderer=ItemBase,this.addTouchEvent(this.upBtn,this.addSpirit),this.addTouchEvent(this.bgClose,this.closeWin),this.observe(EquipCT.ins().postAddSpirit,this.updateView),this.index=t[1],this.roleIndex=t[0],this.updateView()},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleIndex),e=t.getEquipByIndex(this.index);this.setData(e)},e.prototype.addSpirit=function(){var t=this.lunhuiList.dataProvider;if(SamsaraModel.ins().checkSpiritLvIsMax(this.equipData,this.index))return void TipsCT.ins().showTips("装备附灵等级已满级");if(0==t.length)TipsCT.ins().showTips("没有可以附灵的装备");else{for(var e=[],i=0;i<t.length;i++){var n=t.getItemAt(i);e.push(n.handle)}e.length>0&&EquipCT.ins().requestAddSpirit(this.roleIndex,this.index,e)}},e.prototype.setData=function(t){this.equipData=t;var e=t.spiritLv;this.lvTxt.text="(Lv."+e+")";var i=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e),n=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e+1),s=0;this.attr4.text="0",this.attr5.text="0",this.attr6.text="0",this.attr7.text="0",i&&(s=BagCT.getAttrPower(i.attrs),this.attr4.text=i.attrs[0].value.toString(),this.attr5.text=i.attrs[1].value.toString(),this.attr6.text=i.attrs[2].value.toString(),this.attr7.text=i.attrs[3].value.toString()),this.powerPanel.setPower(s),e==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index])?(this.attrGroup2.visible=!1,this.expBar.maximum=100,this.expBar.value=100):(this.attrGroup2.visible=!0,this.attr8.text=n.attrs[0].value.toString(),this.attr9.text=n.attrs[1].value.toString(),this.attr10.text=n.attrs[2].value.toString(),this.attr11.text=n.attrs[3].value.toString(),this.expBar.maximum=n.consume,this.expBar.value=t.spiritExp),this.expLabel.text=this.expBar.value+"/"+this.expBar.maximum;var o=SubRoles.ins().getSubRoleByIndex(this.roleIndex),a=SamsaraModel.ins().getAddSpiritEquips(o,this.index);this.lunhuiList.dataProvider=new eui.ArrayCollection(a),this.redPoint.visible=SamsaraModel.ins().checkEquipPosCanAddSpirit(o,this.index)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(AddSpiritView.prototype,"AddSpiritView"),ViewManager.ins().reg(AddSpiritView,LayerManager.UI_Popup),window.AddSpiritView=AddSpiritView;var GetSamsaraExpPanel=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e.skinName="GainYeLiSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.redPoint1.visible=!1,this.redPoint2.visible=!1;var i=new RewardData;i.type=0,i.id=0,i.count=0,this.item0.data=i,this.item0.isShowName(!1),this.item1.isShowName(!1),this.item2.isShowName(!1),this.addTouchEvent(this.bgClose,this.closeWin),this.addTouchEvent(this.btn0,this.expUpgrade),this.addTouchEvent(this.btn1,this.normalUpgrade),this.addTouchEvent(this.btn2,this.advanceUpgrade),this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView),this.observe(Shop.ins().postBuyResult,this.updateView),this.observe(Shop.ins().postBuyCount,this.updateView),this.updateView()},e.prototype.expUpgrade=function(){this.btn0.enabled&&(Actor.level>=GlobalConfig.ReincarnationBase.levelLimit?(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.level)):TipsCT.ins().showTips("等级达到"+GlobalConfig.ReincarnationBase.levelLimit+"级可以兑换"))},e.prototype.normalUpgrade=function(){"购买"==this.btn1.label?this.buy(1,GlobalConfig.ReincarnationBase.normalItem.id):(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.normal))},e.prototype.advanceUpgrade=function(){"购买"==this.btn2.label?this.buy(2,GlobalConfig.ReincarnationBase.advanceItem.id):(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp,SamsaraCC.ins().exchangeSamsaraExp(SamsaraUpgradeType.advanced))},e.prototype.buy=function(t,e){var i=this["priceIcon"+t].getPrice();if(Actor.yb<i)TipsCT.ins().showTips("元宝不足"),ViewManager.ins().close(this);else{var n=CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",e);this.buyGoods(n.id)}},e.prototype.buyGoods=function(t){Shop.ins().shopData.checkBuyGoodsId(t)&&ViewManager.ins().open(BuyWin,t)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.updateView=function(){if(void 0!=this.lastYeli&&SamsaraModel.ins().samsaraInfo.exp-this.lastYeli>0&&(this.lastYeli=SamsaraModel.ins().samsaraInfo.exp),Actor.level>=GlobalConfig.ReincarnationBase.levelLimit){var t=GlobalConfig.ReincarnationExchange[Actor.level];this.yeli0.text=t.value.toString(),this.redPoint0.visible=SamsaraModel.ins().getExpExchangeTimes()>0,this.btn0.enabled=SamsaraModel.ins().getExpExchangeTimes()>0,this.limit.visible=!1}else this.yeli0.text=GlobalConfig.ReincarnationExchange[GlobalConfig.ReincarnationBase.levelLimit].value.toString(),this.redPoint0.visible=!1,this.limit.visible=!0;this.toDay0.text=SamsaraModel.ins().getExpExchangeTimes().toString(),this.updateItem(GlobalConfig.ReincarnationBase.normalItem,1,SamsaraModel.ins().getNormalExchangeTimes()),this.updateItem(GlobalConfig.ReincarnationBase.advanceItem,2,SamsaraModel.ins().getAdvancedExchangeTimes())},e.prototype.updateItem=function(t,e,i){var n=GlobalConfig.ItemConfig[t.id];this["item"+e].data=t.id,this["toDay"+e].text=i.toString(),i>0?this["toDay"+e].textColor=65280:this["toDay"+e].textColor=16711680,this["yeli"+e].text=t.value.toString();var s=BagCT.ins().getBagGoodsCountById(0,t.id);s>0?(this["name"+e].text=n.name+" 剩余："+s+"个",this["priceIcon"+e].visible=!1,this["redPoint"+e].visible=i>0,this["btn"+e].label="立即使用"):(this["name"+e].text=n.name,this["priceIcon"+e].visible=!0,this["priceIcon"+e].setPrice(CommonUtils.getObjectByAttr(GlobalConfig.ItemStoreConfig,"itemId",t.id).price),this["redPoint"+e].visible=!1,this["btn"+e].label="购买")},e}(BaseEuiView);__reflect(GetSamsaraExpPanel.prototype,"GetSamsaraExpPanel"),ViewManager.ins().reg(GetSamsaraExpPanel,LayerManager.UI_Popup),window.GetSamsaraExpPanel=GetSamsaraExpPanel;var SamsaraComposePanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.initUI()},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.list.itemRenderer=SamsaraComposeMenuItem,this.list0.itemRenderer=SamsaraComposeItem,this._listData=new eui.ArrayCollection,this.list0.dataProvider=this._listData,this._tabListData=new eui.ArrayCollection,this.list.dataProvider=this._tabListData},e.prototype.open=function(){this.updateState(),this.observe(BagCT.ins().postItemAdd,this.buffUpdata),this.observe(BagCT.ins().postItemDel,this.buffUpdata),this.observe(BagCT.ins().postItemCountChange,this.buffUpdata),this.observe(SamsaraCC.ins().postCompose,this.buffUpdata)},e.prototype.buffUpdata=function(){Timer.stop(this.updateState,this),Timer.start(100,1,this.updateState,this)},e.prototype.updateState=function(){var t,e,i=SamsaraModel.ins().getComposeEquipList();if(i&&i.length>0){this.materialId=i[0];var n=SamsaraModel.ins().getComposeTarget(this.materialId),s=GlobalConfig.ItemConfig[n],o=GlobalConfig.ReincarnateEquipCompose[n];t=o.distinguishi,e=s.zsLevel}else this.materialId=0,t=1,e=GlobalConfig.ReincarnationBase.equipsList[0][0];this.zsLv=e,this.type=t,this._tabListData.source=SamsaraModel.ins().getComposeMenu(),this.updateView(t,e,this.materialId)},e.prototype.selectList=function(t,e){for(var i=t.list,n=i.dataProvider.length,s=0;n>s;s++){var o=i.getElementAt(s);if(o&&e==o.data.zsLv)return void t.selectList(s)}},e.prototype.unSelectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++)for(var i=this.list.getElementAt(e),n=i.list,s=0;s<n.dataProvider.length;s++){var o=n.getElementAt(s);o&&o.setSelect(!1)}},e.prototype.updateView=function(t,e,i){void 0===i&&(i=0);var n=SamsaraModel.ins().composeEquipMap[t][e];this._listData.source=n,this.refushBarList(i)},e.prototype.refushBarList=function(t){if(!t)return void(this.contentScroller.viewport.scrollV=0);for(var e=SamsaraModel.ins().getComposeTarget(this.materialId),i=this.list0.dataProvider,n=0;n<i.length;n++)if(e==i.getItemAt(n)){this.contentScroller.viewport.validateNow(),this.contentScroller.viewport.scrollV=101*n,this.contentScroller.viewport.contentHeight-this.contentScroller.viewport.scrollV<this.contentScroller.viewport.height&&(this.contentScroller.viewport.scrollV=this.contentScroller.viewport.contentHeight-this.contentScroller.height);break}},e.prototype.close=function(){},e}(BaseEuiView);__reflect(SamsaraComposePanel.prototype,"SamsaraComposePanel"),window.SamsaraComposePanel=SamsaraComposePanel;var SamsaraEquipTips=function(t){function e(){var e=t.call(this)||this;return e.showXueYin=!1,e._sn_="ReincarnateEquipTipsSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(void 0!=t[1]){this.roleIndex=-1,this.roleModel=t[1],this.index=t[2];var i=t[0],n=!1;if(i>=0&&i<=SubRoles.ins().subRolesLen-1){var s=SubRoles.ins().getSubRoleByIndex(i);s.handle==this.roleModel.handle&&(n=!0,this.roleIndex=this.roleModel.index,this.showXueYin=!1)}var o=this.roleModel.getEquipByIndex(this.index),a=t[3]||!1,r=t[4]||!1;this.setData(o,a),n&&!r?(this.addTouchEvent(this.spiritBtn,this.addSpirit),this.addTouchEvent(this.soulBtn,this.addSoul),this.spiritBtn.visible=!0,this.soulBtn.visible=!0):(this.redPoint.visible=!1,this.redPoint1.visible=!1,this.spiritBtn.visible=!1,this.soulBtn.visible=!1)}else this.setTips(t[0]);this.showXueYin||DisplayUtils.removeFromParent(this.eXueyinBtn),this.addTouchEvent(this.bgClose,this.closeWin),this.addTouchEvent(this.eXueyinBtn,this.onXueyinBtn),this.observe(BloodstainRedPoint.ins().postRoleRedPoint,this.updateRed),this.updateBloodstain(),this.updateRed(),this.eScroller.height>590&&(this.eScroller.height=590)},e.prototype.setTips=function(t){this.spiritBtn.visible=!1,this.soulBtn.visible=!1,this.redPoint.visible=!1,this.redPoint1.visible=!1;var e=GlobalConfig.ItemConfig[t];this.updateBaseView(e);var i=new ItemData;i.itemConfig=e;var n=ItemUtil.calculateBagItemScore(i);this.powerPanel.setPower(n),this.score.text="评分："+n;var s,o=ItemUtil.getSubType(e);o==EquipPos.HAT?(this.currentState="noSpirit0",s=!0):(s=!1,this.currentState="noSpirit1"),this.updateBaseAttr(t,s),this.setSoulAttr(0),this.setSoulLink(0,0);var a=[0,0,0,0];switch(o){case EquipPos.HAT:a[0]=1;break;case EquipPos.VIZARD:a[1]=1;break;case EquipPos.CLOAK:a[2]=1;break;case EquipPos.SHIELD:a[3]=1}this.setSuitAttr(e.id,a)},e.prototype.setData=function(t,e){this.soulBtn.visible=!0,this.spiritBtn.visible=!0,this.redPoint.visible=this.roleIndex>=0&&SamsaraModel.ins().checkEquipPosCanAddSpirit(this.roleModel,this.index),this.redPoint1.visible=this.roleIndex>=0&&SamsaraModel.ins().checkUpgradeSoul(this.roleModel,this.index);var i=t.item.itemConfig;this.currentItem=i;var n=t.soulLv;e&&(n+=1),this.updateBaseView(i,n);var s,o=GlobalConfig.EquipConfig[i.id],a=t.spiritLv;if(0==a&&0==t.spiritExp)this.index==EquipPos.HAT?(this.currentState="noSpirit0",s=!0):(this.currentState="noSpirit1",s=!1);else{var r=a==CommonUtils.getObjectLength(GlobalConfig.ReincarnateSpirit[this.index]);this.index==EquipPos.HAT?(this.currentState="doSpirit0",s=!0):(this.currentState="doSpirit1",s=!1),this.setSpirit(t.spiritExp,t.spiritLv,r,s)}this.updateBaseAttr(i.id,s);var l=SamsaraModel.ins().lowSuitEquips(this.index,this.roleModel);this.setSuitAttr(i.id,l),this.score.text="评分："+t.item.point;for(var h=0,u=0;u<l.length;u++)l[u]&&h++;var p=4==h,c=SamsaraModel.ins().getReincarnateSuit(i.id),d=t.item.point;if(d=this.setSoulAttr(n,i.id,d),d=this.setSoulLink(n,SamsaraModel.ins().getSoulLinkLv(this.roleModel,this.index,n),i.id,d),this.roleModel&&o&&o.baseAttr2){var g=o.baseAttr2.value/100;d+=SamsaraModel.ins().getExtraPower(this.roleModel,g,o.baseAttr2.type)}if(p&&(d+=BagCT.getAttrPower(c.attrs)),a>0){var f=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,a);d+=BagCT.getAttrPower(f.attrs)}d>>=0,this.powerPanel.setPower(d)},e.prototype.updateBaseView=function(t,e){void 0===e&&(e=0);var i=ItemUtil.getQuality(t),n=ItemUtil.getSubType(t),s=ItemUtil.getJob(t);if(this.nameLabel.text=t.name,e>0){var o="热血";switch(e){case 1:o+="Ⅰ";break;case 2:o+="Ⅱ";break;case 3:o+="Ⅲ";break;case 4:o+="Ⅳ"}this.nameLabel.text=o+"."+t.name,this.itemIcon.setTag("rein_soul_tag")}this.nameLabel.textColor=ItemUtil.getQualityColor(t),this.quali.source=i>0?"quali"+i:"",this.itemIcon.setData(t),this.type.text=Role.getEquipNameByType(n),this.lv.text=t.zsLevel+"转",this.lv.textColor=ZsCT.ins().lv<t.zsLevel?15937822:3532333,this.career.text=Role.getJobNameByJob(s)},e.prototype.updateBaseAttr=function(t,e){var i=GlobalConfig.EquipConfig[t];this.attr0.text=i.atk.toString(),this.attr1.text=i.hp.toString(),this.attr2.text=i.def.toString(),this.attr3.text=i.res.toString(),this.attr4.text=i.baseAttr1.value.toString(),e&&(this.attr5.text=i.baseAttr2.value/100+"%")},e.prototype.setSuitAttr=function(t,e){var i=SamsaraModel.ins().getEquipSamsaraLv(t),n=SamsaraModel.ins().getSamsaraDesc(i-7),s=SamsaraModel.ins().getReincarnateSuit(t);this.suitName.text=n+"套装",this.attr12.text=this.getValue(s.attrs,AttributeType.atAttack),this.attr13.text=this.getValue(s.attrs,AttributeType.atMaxHp),this.attr14.text=this.getValue(s.attrs,AttributeType.atDef),this.attr15.text=this.getValue(s.attrs,AttributeType.atRes),this.attr16.text=s.exAttrs[0].value/100+"%";for(var o=e[0]?ColorUtil.GREEN_COLOR:"0xff0000",a=e[1]?ColorUtil.GREEN_COLOR:"0xff0000",r=e[2]?ColorUtil.GREEN_COLOR:"0xff0000",l=e[3]?ColorUtil.GREEN_COLOR:"0xff0000",h=0,u=0;u<e.length;u++)e[u]&&h++;this.suitState.textFlow=TextFlowMaker.generateTextFlow("<font color="+o+">"+Role.getEquipNameByType(EquipPos.HAT)+"、</font><font color="+a+">"+Role.getEquipNameByType(EquipPos.VIZARD)+"、</font><font color="+r+">"+Role.getEquipNameByType(EquipPos.CLOAK)+"、</font><font color="+l+">"+Role.getEquipNameByType(EquipPos.SHIELD)+"</font>");var p=4==h,c=p?ColorUtil.GREEN_COLOR_N:16711680;this.suitNum.textColor=c,this.suitNum.text="("+h+"/4)",this.setSuitAttrTextColor(p)},e.prototype.setSuitAttrTextColor=function(t){var e=t?16711935:6710886;this.attr12.textColor=e,this.attr13.textColor=e,this.attr14.textColor=e,this.attr15.textColor=e,this.attr16.textColor=e,this.attrDesc.textColor=e,this.attrDesc1.textColor=e},e.prototype.setSpirit=function(t,e,i,n){var s,o=CommonUtils.getObjectByUnionAttr(GlobalConfig.ReincarnateSpirit,this.index,e);s=i?"":"("+t+"/"+o.consume+")",this.spiritLv.text="Lv"+e,this.spiritCost.text=s,0==e?(this.attr6.text="0",this.attr7.text="0",this.attr8.text="0",this.attr9.text="0"):(this.attr6.text=this.getValue(o.attrs,AttributeType.atAttack),this.attr7.text=this.getValue(o.attrs,AttributeType.atMaxHp),this.attr8.text=this.getValue(o.attrs,AttributeType.atDef),this.attr9.text=this.getValue(o.attrs,AttributeType.atRes))},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e.prototype.addSpirit=function(){this.closeWin(),ViewManager.ins().open(AddSpiritView,this.roleIndex,this.index)},e.prototype.addSoul=function(){this.closeWin();var t=this.roleModel.getEquipByIndex(this.index);ViewManager.ins().open(SamsaraSoulWin,this.roleIndex,this.index,this.nameLabel.text,this.getSoulEquipName(this.currentItem,t.soulLv+1),this.nameLabel.textColor,this.roleModel,this.index)},e.prototype.getSoulEquipName=function(t,e){var i="热血";if(e>0){switch(e){case 1:i+="Ⅰ";break;case 2:i+="Ⅱ";break;case 3:i+="Ⅲ";break;case 4:i+="Ⅳ"}i=i+"."+t.name}return i},e.prototype.setSoulAttr=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0==t)this.soulDescLable.visible=!1,this.soulAddAttr0.text="",this.soulAddAttr1.text="",this.soulAddAttr2.text="",this.soulAddAttr3.text="",this.soulAddAttr4.text="";else{this.soulDescLable.visible=!0;var n=GlobalConfig.EquipConfig[e],s=n.atk,o=n.hp,a=n.def,r=n.res,l=n.baseAttr1.value,h=ItemUtil.getSubType(GlobalConfig.ItemConfig[e]),u=GlobalConfig.ReincarnationDemonLevel[h][t],p=u.precent/1e4;this.soulAddAttr0.text=Math.floor(s*p).toString(),this.soulAddAttr1.text=Math.floor(o*p).toString(),this.soulAddAttr2.text=Math.floor(a*p).toString(),this.soulAddAttr3.text=Math.floor(r*p).toString(),this.soulAddAttr4.text=Math.floor(l*p).toString();var c=0;if(n.baseAttr2&&(c=BagCT.getAttrPower([n.baseAttr2])),i=(i-c)*(1+p)+c,t>0){var d=GlobalConfig.ReincarnationSoulLevel[ItemUtil.getJob(GlobalConfig.ItemConfig[e])][h][t];i+=BagCT.getAttrPower(d.attrs)}i>>=0}return i},e.prototype.setSoulLink=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),0==t?(this.chainGroup.parent&&this.chainGroup.parent.removeChild(this.chainGroup),this.soulGroup.parent&&this.soulGroup.parent.removeChild(this.soulGroup)):(this.chainGroup.parent||this.suitGroup.parent.addChild(this.soulGroup),this.soulGroup.parent||this.suitGroup.parent.addChild(this.soulGroup)),this.soulLv.text="Lv"+t;var s=e;if(0==e&&(s=1),this.chainLv.text="Lv"+s,i){var o=ItemUtil.getSubType(GlobalConfig.ItemConfig[i]);if(s>0){var a=SamsaraModel.ins().getReincarnationLinkLevel(o,s);this.chainPos.text="[热血"+Role.getEquipNameByType(a.secondSlot)+"]",this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(a.attrs[0].type),this.chainValue.text=a.attrs[0].value/100+"%";var r=void 0;if(r=0==e?6710886:16776960,this.chainPos.textColor=r,this.chainAttr.textColor=r,this.chainState.textColor=r,this.chainValue.textColor=r,e>0){var l=this.roleModel,h=BagCT.getAttrPower([a.attrs[0]])+ItemUtil.relatePower(a.attrs[0],l);n+=h}}if(t>0){var u=GlobalConfig.ReincarnationDemonLevel[o][t],p=void 0,c=u.precent/100;c+=100,p=c+"%",this.soulAttr.text=p}}return n},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.onXueyinBtn=function(){ViewManager.ins().open(BloodstainWin,ItemUtil.getSubType(this.currentItem),this.roleIndex),this.closeWin()},e.prototype.updateBloodstain=function(){if(this.updateBloodGroup(),!this.showXueYin||!this.currentItem)return void DisplayUtils.removeFromParent(this.eXueyinGroup);var t=BloodstainCT.ins().getBloodstainEquip(this.roleIndex,ItemUtil.getSubType(this.currentItem));if(!(t&&t.lv>0))return void DisplayUtils.removeFromParent(this.eXueyinGroup);for(var e=BloodstainCT.ins().getEquipSuitLvs(this.roleIndex),i=1;4>i;i++){var n=this["xueyin"+i];n.filters=t.lv>=i?null:FilterUtil.ARRAY_GRAY_FILTER;var s=this["xiaoguo"+i],o=GlobalConfig.BloodstainSkillConfig[i];s.text="";for(var a in o){var r=o[a];if(r.skillId){s.text=SkillUtil.getDesc(GlobalConfig.SkillsConfig[r.skillId]),s.filters=e[r.equipCountLimit-1]>=r.levelLimit?null:FilterUtil.ARRAY_GRAY_FILTER;break}}}},e.prototype.updateBloodGroup=function(){if(!this.showXueYin||!this.currentItem)return void DisplayUtils.removeFromParent(this.eBloodGroup);var t=BloodstainCT.ins().getBloodstainEquip(this.roleIndex,ItemUtil.getSubType(this.currentItem));if(!(t&&t.lv>0))return void DisplayUtils.removeFromParent(this.eBloodGroup);var e=GlobalConfig.BloodstainLevelConfig[t.lv],i=AttributeData.getAttrFromCfg(e),n=["武器","头盔","衣服","项链","护腕","腰带","戒指","鞋子","","面甲","护肩","披风","护符"];this.sBloodAtt=AttributeData.getAttStr(i),this.sBloodAtt+=e.equipAdd>0?"\n"+n[t.pos]+"部位基础属性+"+MathUtils.toInteger(e.equipAdd/100)+"%":""},e.prototype.updateRed=function(){this.eXueyinBtn.eRp&&(this.showXueYin&&this.eXueyinBtn.visible?this.eXueyinBtn.eRp.visible=BloodstainRedPoint.ins().itemReds[this.roleIndex][ItemUtil.getSubType(this.currentItem)]:this.eXueyinBtn.eRp.visible=!1)},e}(BaseEuiView);__reflect(SamsaraEquipTips.prototype,"SamsaraEquipTips"),ViewManager.ins().reg(SamsaraEquipTips,LayerManager.UI_Popup),window.SamsaraEquipTips=SamsaraEquipTips;var SamsaraPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.skinComplete=function(){this.lvImgAry=[this.lv0,this.lv1,this.lv2,this.lv3,this.lv4,this.lv5],this.effectContainerAry=[this.eff0,this.eff1,this.eff2,this.eff3,this.eff4,this.eff5];for(var t in this.effectContainerAry){var e=new MovieClip;e.playFile(RES_DIR_EFF+"FireEff2",-1),this.effectContainerAry[t].addChild(e)}this.waterEffect=new MovieClip,this.waterEffect.playFile(RES_DIR_EFF+"LHEff2",-1),this.water.addChild(this.waterEffect),this.ballEffect=new MovieClip,this.ballEffect.playFile(RES_DIR_EFF+"LHEff1",-1),this.ball.addChild(this.ballEffect);var i=new egret.Sprite,n=new egret.Shape;n.graphics.beginFill(16777215),n.graphics.drawCircle(0,0,55),i.graphics.endFill(),i.addChild(n),this.water.parent.addChild(i),i.x=55,i.y=50,this.water.mask=i,this.labelEffect=new MovieClip,this.labelEffect.scaleX=.7,this.labelEffect.scaleY=.5,this.labelEffect.touchEnabled=!1,this.redPoint.visible=!1,this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getItemTxt.text+"</u></a>"),this.addTouchEvent(this.getItemTxt,this.getItem),this.addTouchEvent(this.upBtn,this.upgrade)},e.prototype.addDisplay=function(){this.observe(SamsaraCC.ins().postSamsaraInfo,this.updateView),this.updateView()},e.prototype.upgrade=function(){this.isExpEnough?SamsaraCC.ins().upgradeSamsaraLv():TipsCT.ins().showTips("业力不足")},e.prototype.getItem=function(){ViewManager.ins().open(GetSamsaraExpPanel)},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e.prototype.updateView=function(){var t=SamsaraModel.ins().samsaraInfo,e=t.lv,i=GlobalConfig.ReincarnationLevel[e],n=AttributeData.getAttStr(i.attrs,0,1,"  :  ");this.attr1.text=n;var s=3*BagCT.getAttrPower(i.attrs);this.powerPanel1.setPower(s);var o,a=e+1,r=!GlobalConfig.ReincarnationLevel[a],l=this.getBossNameByLevel(a);if(l){this.bossName.text=GlobalConfig.MonstersConfig[l.bossId].name;var h=l.samsaraLv,u=SamsaraModel.ins().getSamsara(h),p=SamsaraModel.ins().getSamsaraLv(h),c=SamsaraModel.ins().getSamsaraDesc(u)+"·"+SamsaraModel.ins().getSamsaraLvDesc(p);this.nextName.text=c,this.nextBossInfo.visible=!0}else this.nextBossInfo.visible=!1;if(r)this.powerPanel0.setPower(s),this.attr0.text=n,this.yeliValue.text="已满级",o=1;else{var d=GlobalConfig.ReincarnationLevel[a];if(!d||!d.attrs)return void platform.reportError("samsaraPanel:"+e+"="+a);var g=3*BagCT.getAttrPower(d.attrs);this.powerPanel2.setPower(g),n=AttributeData.getAttStr(d.attrs,0,1,"  :  "),this.attr2.text=n;var f=void 0,v=t.exp,y=d.consume;v>=y?(f=ColorUtil.GREEN_COLOR,this.isExpEnough=!0):(f=ColorUtil.RED_COLOR,this.isExpEnough=!1),this.yeliValue.textFlow=TextFlowMaker.generateTextFlow("<font color="+f+">"+v+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+y+"</font> "),o=v/y}this.setMaxSamsaraState(r),SamsaraModel.ins().isCanExchange()?this.addLabelEffect():this.removeLabelEffect();var m=SamsaraModel.ins().getSamsara(Actor.samsaraLv),T=SamsaraModel.ins().getSamsaraLv(Actor.samsaraLv),C=SamsaraModel.ins().getSamsaraDesc(m)+"·"+SamsaraModel.ins().getSamsaraLvDesc(T);this.lunhuiLv.text=C,this.setLvImgState(T),this.maskImage(o),this.redPoint.visible=this.upBtn.visible&&SamsaraModel.ins().isCanUpgrade()},e.prototype.getBossNameByLevel=function(t){var e=GlobalConfig.WorldBossConfig,i=null;return Object.keys(e).reverse().forEach(function(n){var s=e[n];s.samsaraLv>=t&&(i=s)}),i},e.prototype.setMaxSamsaraState=function(t){this.attrGroup0.visible=t,this.arrow.visible=!t,this.attrGroup1.visible=!t,this.attrGroup2.visible=!t,this.upBtn.visible=!t,this.getItemTxt.visible=!t,this.maxLevel.visible=t},e.prototype.setLvImgState=function(t){for(var e in this.lvImgAry)this.lvImgAry[e].visible=!1,this.effectContainerAry[e].visible=!1;for(var e=0;t>=e;e++)this.lvImgAry[e].visible=!0,this.effectContainerAry[e].visible=!0},e.prototype.addLabelEffect=function(){var t=this;egret.callLater(function(){DisplayUtils.removeFromParent(t.labelEffect),t.labelEffect.x=t.getItemTxt.x+t.getItemTxt.width/2,t.labelEffect.y=t.getItemTxt.y+t.getItemTxt.height/2,null==t.labelEffect.parent&&t.getItemTxt.parent.addChild(t.labelEffect),t.labelEffect.playFile(RES_DIR_EFF+"BtnPrompt1",-1)},this)},e.prototype.maskImage=function(t){if(t>=1)return DisplayUtils.removeFromParent(this.masksp),this.masksp=null,void(this.water.visible=!1);var e=103;if(!this.masksp){this.masksp=new egret.Sprite;var i=new egret.Shape;i.graphics.beginFill(16776960),i.graphics.drawRect(this.ball.x-60,this.ball.y-45,120,e),i.graphics.endFill(),this.masksp.addChild(i),this.ball.parent.addChild(this.masksp),this.ball.mask=this.masksp}this.masksp.y=e*(1-t),this.water.visible=!0,this.water.y=this.masksp.y+10},e.prototype.removeLabelEffect=function(){this.labelEffect.stop(),DisplayUtils.removeFromParent(this.labelEffect)},e}(BaseView);__reflect(SamsaraPanel.prototype,"SamsaraPanel"),window.SamsaraPanel=SamsaraPanel;var SamsaraSoulMaterialTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemRexueTipsSkin",e}return __extends(e,t),e.prototype.open=function(t,e,i,n,s,o){this.itemIcon.setData(t),this.nameLabel.text=t.name,this.nameLabel.textColor=i,this.desc.textFlow=TextFlowMaker.generateTextFlow(t.desc),this.addTouchEvent(this.bgClose,this.closeWin),this.power.visible=!1,this.num.text=n,this.chainDesc.text=s,this.soulDesc.text+=o},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(SamsaraSoulMaterialTips.prototype,"SamsaraSoulMaterialTips"),ViewManager.ins().reg(SamsaraSoulMaterialTips,LayerManager.UI_Popup),window.SamsaraSoulMaterialTips=SamsaraSoulMaterialTips;var SamsaraSoulWin=function(t){function e(){var e=t.call(this)||this;return e.chainDesc="",e.soulDesc="",e.skinName="ReincarnateSoulSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(EquipCT.ins().postAddSoul,this.updateView),this.addTouchEvent(this.soulBtn,this.addSoul),this.addTouchEvent(this.closeBtn,this.closeWin),this.addTouchEvent(this.itemIconCost,this.showMaterialTips),this.addTouchEvent(this.itemIconNow,this.showEquipTips),this.addTouchEvent(this.itemIconNext,this.showEquipTipsNext),this.roleIndex=t[0],this.subType=t[1],this.currentName.text=t[2],this.nextName.text=t[3],this.currentName.textColor=t[4],this.nextName.textColor=t[4],this.costName.textColor=t[4],this.roleModel=t[5],this.index=t[6],this.updateView()},e.prototype.showEquipTips=function(){ViewManager.ins().open(SamsaraEquipTips,this.roleIndex,this.roleModel,this.index,!1,!0)},e.prototype.showEquipTipsNext=function(){ViewManager.ins().open(SamsaraEquipTips,this.roleIndex,this.roleModel,this.index,!0,!0)},e.prototype.showMaterialTips=function(){ViewManager.ins().open(SamsaraSoulMaterialTips,this.itemCost,this.roleIndex,this.costName.textColor,this.num.text,this.chainDesc,this.soulDesc)},e.prototype.closeWin=function(){ViewManager.ins().close(this)},e.prototype.addSoul=function(){this.rongheEff=new MovieClip,this.rongheEff.x=190,this.rongheEff.y=145,this.iconsGroup.addChild(this.rongheEff),this.rongheEff.playFile(RES_DIR_EFF+"lhronghe"),EquipCT.ins().requestAddSoul(this.roleIndex,this.subType)
},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleIndex),e=t.getEquipByIndex(this.subType);this.itemId=e.item.itemConfig.id;var i=t.getEquipByIndex(this.subType);this.soulLv=i.soulLv,this.soulLinkLv=SamsaraModel.ins().getSoulLinkLv(t,this.subType,i.soulLv);var n=GlobalConfig.ItemConfig[this.itemId],s=ItemUtil.getSubType(n),o=ItemUtil.getJob(n),a=SamsaraModel.ins().getSoulMaxLevel(),r=this.soulLv==a,l=this.soulLinkLv==a;if(this.nextSoulTextGroup.visible=!(0==this.soulLv||r),this.nextChainTextGroup.visible=!(0==this.soulLinkLv||l),this.nextChainTextGroup.visible){var h=SamsaraModel.ins().getReincarnationLinkLevel(s,this.soulLinkLv+1);this.nextChain0.text=h.attrs[0].value/100+"%"}if(this.nextSoulTextGroup.visible){var h=GlobalConfig.ReincarnationDemonLevel[s][this.soulLv+1];this.nextChain1.text=100+h.precent/100+"%"}var u=0;u=0==this.soulLinkLv?1:this.soulLinkLv;var p=0;p=0==this.soulLv?1:this.soulLv;var c=SamsaraModel.ins().getReincarnationLinkLevel(s,u);this.chainPos.text="[热血"+Role.getEquipNameByType(c.secondSlot)+"]",this.chainAttr.text=SamsaraModel.ins().getSoulLinkDesc(c.attrs[0].type),this.chainState.text="增加",this.chainValue.text=c.attrs[0].value/100+"%";var d,g=GlobalConfig.ReincarnationDemonLevel[s][p],f=g.precent/100;f+=100,d=f+"%",this.soulAttr.text=d;var v=GlobalConfig.ReincarnationSoulLevel[o][s][p],y=AttributeData.getAttStr(v.attrs,0,1,"  :  "),m=BagCT.getAttrPower(v.attrs);m+=this.getChainAddPower(this.soulLinkLv),m+=this.getSoulAddPower(e,this.soulLv),r||this.powerPanel0.setPower(m),0==this.soulLv?(this.attr0.text="攻击：0\n物防：0\n魔防：0\n生命：0\n神圣伤害：0",this.powerPanel0.setPower(0)):this.attr0.text=y;var T;if(r)this.attrGroup0.visible=!1,this.attrGroup1.visible=!1,this.attrGroup3.visible=!0,this.attr3.text=y,this.powerPanel3.setPower(m);else{this.attrGroup0.visible=!0,this.attrGroup1.visible=!0,this.attrGroup3.visible=!1,T=GlobalConfig.ReincarnationSoulLevel[o][s][this.soulLv+1];var C=AttributeData.getAttStr(T.attrs,0,1,"  :  ");this.attr1.text=C;var b=BagCT.getAttrPower(T.attrs);b+=this.getChainAddPower(this.soulLinkLv+1),b+=this.getSoulAddPower(e,this.soulLv+1),this.powerPanel1.setPower(b)}this.chainLv0.text="Lv"+u,this.soulLvText.text="Lv"+p;var I=v.materialInfo.id,w=BagCT.ins().getBagGoodsCountById(0,I),S=!1;T&&(S=w>=T.materialInfo.count),this.materialLabel.text=GlobalConfig.ItemConfig[I].name,this.costImg.source=GlobalConfig.ItemConfig[I].icon+"_png",this.num.text=w.toString(),T?(this.needNum.text="/"+T.materialInfo.count.toString(),this.nextId=T.materialInfo.id):this.needNum.text="/0",this.soulBtn.enabled=S&&!r,S?this.num.textColor=ColorUtil.GREEN_COLOR_N:this.num.textColor=ColorUtil.RED_COLOR_N,this.redPoint.visible=S&&!r,this.arrow0.visible=!r,this.rein_title.source="rein_demon_soul_"+o+s,this.numInfo.text=w.toString()+"/"+(T?T.materialInfo.count.toString():0),w>(T?T.materialInfo.count:0)?this.numInfo.textColor=ColorUtil.GREEN:this.numInfo.textColor=ColorUtil.RED,this.chainDesc="",this.chainDesc+=this.chainPos.text,this.chainDesc+=this.chainAttr.text,this.chainDesc+=this.chainState.text,this.chainDesc+=this.chainValue.text,this.soulDesc="",this.soulDesc+=g.precent/100+"%",this.itemCost=GlobalConfig.ItemConfig[I],this.itemIconCost.setData(this.itemCost),this.costName.text=this.itemCost.name;var _=this.roleModel.getEquipByIndex(this.index),B=_.item.itemConfig;this.itemIconNow.setData(B),this.itemIconNext.setData(B),this.itemIconNext.setTag("rein_soul_tag"),this.soulLv>0&&this.itemIconNow.setTag("rein_soul_tag"),r?(this.nextName.text=this.getSoulEquipName(B,_.soulLv),this.removeTouchEvent(this.itemIconNext,this.showEquipTipsNext),this.addTouchEvent(this.itemIconNext,this.showEquipTips)):this.nextName.text=this.getSoulEquipName(B,_.soulLv+1),this.currentName.text=this.getSoulEquipName(B,_.soulLv)},e.prototype.getSoulEquipName=function(t,e){var i="";if(e>0)switch(e){case 1:i+="热血Ⅰ.";break;case 2:i+="热血Ⅱ.";break;case 3:i+="热血Ⅲ.";break;case 4:i+="热血Ⅳ."}return i+=t.name},e.prototype.getChainAddPower=function(t){if(0==t)return 0;var e=SamsaraModel.ins().getReincarnationLinkLevel(this.subType,t),i=SubRoles.ins().getSubRoleByIndex(this.roleIndex),n=BagCT.getAttrPower([e.attrs[0]])+ItemUtil.relatePower(e.attrs[0],i);return n>>0},e.prototype.getSoulAddPower=function(t,e){if(0==e)return 0;var i=GlobalConfig.ReincarnationDemonLevel[this.subType][e],n=i.precent/1e4,s=ItemUtil.getBaseAttrData(t.item.itemConfig);return BagCT.getAttrPower(s)*n>>0},e.prototype.getValue=function(t,e){var i=CommonUtils.getObjectByAttr(t,"type",e);return i.value.toString()},e}(BaseEuiView);__reflect(SamsaraSoulWin.prototype,"SamsaraSoulWin"),ViewManager.ins().reg(SamsaraSoulWin,LayerManager.UI_Main),window.SamsaraSoulWin=SamsaraSoulWin;var SamsaraComposeItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.compose.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.compose1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.compose21.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.dataChanged=function(){var t=this.data;if(t){var e=void 0,i=void 0,n=void 0;if(t.type==MergeType.SamsareEquip)e=GlobalConfig.ReincarnateEquipCompose[t.id],i=e.material.id,n=e.material.count,this.currentState="state1";else if(t.type==MergeType.ZhanlingEquip)e=GlobalConfig.ZhanLingEquip[t.id],i=e.mat[0].id,n=e.mat[0].count,this.currentState="state1";else{if(t.type==MergeType.Rune||t.type==MergeType.MergeType_6||t.type==MergeType.Shield)return this.currentState="state2",void this.setState2Info(t.type,t.id);t.type==MergeType.Thunder&&(e=GlobalConfig.LeitingEquipComposeConf[t.id],i=e.input[0].id,n=e.input[0].count,this.currentState="state1")}this.need.showName=!0,this.need.data=i,this.num.text=n.toString(),this.target.showName=!0,this.target.data=t.id;var s=MergeCC.ins().isCanMergeTargetId(t.type,t.id);this.redPoint.visible=s,s?this.content.filters=null:this.content.filters=FilterUtil.ARRAY_GRAY_FILTER}},e.prototype.onTouch=function(){if(this.redPoint.visible){var t=this.data,e=void 0;if(t.type==MergeType.SamsareEquip){e=GlobalConfig.ReincarnateEquipCompose[t.id];var i=SamsaraModel.ins().getRoleIndexByEquip(e.material.id);SamsaraCC.ins().requestCompose(t.id,i)}else t.type==MergeType.ZhanlingEquip?ZhanLing.ins().sendZhanLingComposeItem(t.id):this.data.type==MergeType.Thunder&&EquipCT.ins().sendThunderCompose(this.data.id)}else this.redPoint1.visible?this.data.type==MergeType.Rune?Rune.ins().sendRuneMerge(this.data.id):this.data.type==MergeType.MergeType_6?ShenshouSys.ins().sendCompose(this.data.id):this.data.type==MergeType.Shield&&ShieldCT.ins().sendCompose(this.data.id):TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|")},e.prototype.setState3Info=function(t){this.redPoint.visible=!1,this.redPoint1.visible=!1;var e=GlobalConfig.LeitingEquipComposeConf[t];this.need20.data=e.input[0].id,this.need21.data=e.input[1].id,this.need22.data=e.input[2].id,this.need23.data=e.input[3].id,this.need23.num=e.input[3].count,this.target21.data=t;var i=ThunderCT.isCanMergeById(t);this.redPoint21.visible=i,this.compose21.enabled=i},e.prototype.setState2Info=function(t,e){if(this.redPoint.visible=!1,this.need0.showName=!0,this.need1.showName=!0,this.need2.showName=!0,this.target1.showName=!0,t==MergeType.Rune){var i=GlobalConfig.RuneComposeConfig[e],n=GlobalConfig.RuneOtherConfig.goldItemId;this.need0.data=i.material[0],this.need1.data=i.material[1],this.need2.num=i.count,this.need2.data=n,this.target1.data=i.id;var s=MergeCC.ins().isCanMergeTargetId(t,e);this.redPoint1.visible=s,this.compose1.enabled=s}else if(t==MergeType.MergeType_6){var i=GlobalConfig.ShenShouCompose[e];this.need0.data=i.material[0],this.need1.data=i.material[1],this.need2.data=i.material[2],this.target1.data=i.id;var s=ShenshouSys.isCanMergeById(e);this.redPoint1.visible=s,this.compose1.enabled=s}else if(t==MergeType.Shield){var i=GlobalConfig.AegisCompose[e];this.need0.data=i.material[0],this.need1.data=i.material[1],this.need2.data=i.material[2],this.target1.data=i.id;var s=ShieldCT.isCanMergeById(e);this.redPoint1.visible=s,this.compose1.enabled=s}},e.prototype.onRemove=function(t){this.content&&(this.content.filters=null)},e}(BaseItemRender);__reflect(SamsaraComposeItem.prototype,"SamsaraComposeItem"),window.SamsaraComposeItem=SamsaraComposeItem;var SamsaraComposeMenuItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=SamsaraComposeSecMenuItem,this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this)},e.prototype.onListChange=function(){var t=this.list.selectedItem,e=ViewManager.ins().getView(BagWin).reinComposePanel;e.updateView(t.type,t.zsLv,SamsaraModel.ins().getComposeEquipId(t.type,t.zsLv)),e.unSelectList(),this.list.getElementAt(this.list.selectedIndex).setSelect(!0)},e.prototype.selectList=function(t){this.list.selectedIndex=t;var e=this.list.getElementAt(this.list.selectedIndex);e.selected=!0,e.setSelect(!0)},e.prototype.dataChanged=function(){var t=this.data;this.nameLabel.text=GlobalConfig.ReincarnationBase.headName[t-1]+".轮回装备",this.list.dataProvider=new eui.ArrayCollection(SamsaraModel.ins().getComposeZsList(t)),this.redPoint.visible=SamsaraModel.ins().isCanTypeCompose(t),1==t?this.rein_equips.source="rein_equip_shen":this.rein_equips.source="rein_equip_sheng"},e}(BaseItemRender);__reflect(SamsaraComposeMenuItem.prototype,"SamsaraComposeMenuItem"),window.SamsaraComposeMenuItem=SamsaraComposeMenuItem;var SamsaraComposeSecMenuItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data.type,e=this.data.zsLv,i=SamsaraModel.ins().getComposeDesc(t);this.head.text=i,this.lv.text=e+"转装备",this.redPoint.visible=SamsaraModel.ins().isCanZsLvCompose(t,e);var n=ViewManager.ins().getView(BagWin).reinComposePanel;n.type==t&&n.zsLv==e&&this.setSelect(!0)},e.prototype.setSelect=function(t){this.chosen.visible=t},e}(BaseItemRender);__reflect(SamsaraComposeSecMenuItem.prototype,"SamsaraComposeSecMenuItem"),window.SamsaraComposeSecMenuItem=SamsaraComposeSecMenuItem;var GameServer=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Default,e.regNetMsg(23,e.postServerOpenDay),e.regNetMsg(14,e.doServerTime),e.regNetMsg(39,e.doKFOpen),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e,"serverTime",{get:function(){return e._serverTime+egret.getTimer()},enumerable:!0,configurable:!0}),e.setServerTime=function(t){e._serverTime=DateUtils.formatMiniDateTime(t)-egret.getTimer()},e.prototype.postServerOpenDay=function(t){e.serverOpenDay=t.readInt(),e._serverZeroTime=t.readInt(),e._serverHeZeroTime=t.readInt(),e._hefuCount=t.readInt(),e.isOpenLF=t.readBoolean();var i=t.bytesAvailable>3?t.readInt():0;e.serverMaxOpenDay=0==i?e.serverOpenDay:i;var n=1==t.readByte(),s=t.readUnsignedShort();n&&(Actor.serverName=s)},e.prototype.doServerTime=function(t){e.setServerTime(t.readUnsignedInt())},e.prototype.doKFOpen=function(t){e.isOpenKF=0!=t.readInt()},e.isOpenKF=!1,__decorate([post()],e.prototype,"postServerOpenDay",null),e}(BaseSystem);__reflect(GameServer.prototype,"GameServer"),System.GameServer=function(){return GameServer.ins()},window.GameServer=GameServer;var ClientSet;!function(t){t[t.guidePart=0]="guidePart",t[t.guideStep=1]="guideStep",t[t.expFirst=2]="expFirst",t[t.headRed=3]="headRed",t[t.diedFirstTime=4]="diedFirstTime",t[t.recharge1=5]="recharge1",t[t.vip=6]="vip",t[t.role=7]="role",t[t.FB=8]="FB",t[t.recharge2=9]="recharge2",t[t.diedFirstTime2=10]="diedFirstTime2",t[t.mijiRedPoint=11]="mijiRedPoint",t[t.firstMonthCard=12]="firstMonthCard",t[t.firstrecharge1=13]="firstrecharge1",t[t.firstClickTreasure=14]="firstClickTreasure",t[t.autoHeji=15]="autoHeji",t[t.firstTouZi=16]="firstTouZi",t[t.shWing=17]="shWing",t[t.shMonster=18]="shMonster",t[t.hotBlood=19]="hotBlood",t[t.useHotBlood=20]="useHotBlood",t[t.shOtherWing=21]="shOtherWing",t[t.shTitle=22]="shTitle",t[t.shOtherTitle=23]="shOtherTitle",t[t.guide=23]="guide",t[t.gmActivity=24]="gmActivity"}(ClientSet||(ClientSet={})),window.ClientSet=ClientSet;var Setting=function(t){function e(){var e=t.call(this)||this;return e.map={},e.sysId=PackageID.Default,e.regNetMsg(19,e.postInitSetting),e}return __extends(e,t),Object.defineProperty(e,"currPart",{get:function(){return e.ins().getValue(ClientSet.guidePart)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"currStep",{get:function(){return e.ins().getValue(ClientSet.guideStep)},enumerable:!0,configurable:!0}),e.ins=function(){return t.ins.call(this)},e.prototype.postInitSetting=function(t){for(var e=t.readShort(),i=0;e>i;i++)this.map[t.readInt()]=t.readInt();GuideUtils.ins().init()},e.prototype.sendSave=function(t,e){var i=this.getBytes(19);i.writeInt(t),i.writeInt(e),this.sendToServer(i),this.map[t]=e},e.prototype.setValue=function(t,e){this.sendSave(t,e)},e.prototype.getValue=function(t,e){return void 0===e&&(e=0),void 0==this.map[t]?e:this.map[t]},__decorate([post()],e.prototype,"postInitSetting",null),__decorate([post()],e.prototype,"setValue",null),e}(BaseSystem);__reflect(Setting.prototype,"Setting"),System.Setting=function(){return Setting.ins()},window.Setting=Setting;var SettingView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="settingskin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eLogout.visible=!urlParam.isMiniGame,this.logoutCheck(),this.addTouchEvent(this.cbSound,this.onTouch),this.addTouchEvent(this.cbShake,this.onTouch),this.addTouchEvent(this.cbHeji,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.eLogout,this.onTouch),this.addTouchEvent(this.eWing,this.onTouch),this.addTouchEvent(this.eWing1,this.onTouch),this.addTouchEvent(this.eTitle,this.onTouch),this.addTouchEvent(this.eTitle1,this.onTouch),this.addTouchEvent(this.cbLianJI,this.onTouch),this.addTouchEvent(this.eMonster,this.onTouch),this.addTouchEvent(this.cbBarrage,this.onTouch)},e.prototype.logoutCheck=function(){if(this.eLight.visible=!1,this.eLogout.visible){var t=window.h5gamecn,e=!1;t&&t.checkLogout&&t.checkLogout(function(t){e=!0}),this.eLogout.visible=e}},e.prototype.addDisplay=function(){this.eLogout.visible=!urlParam.isMiniGame,this.logoutCheck(),this.cbSound.selected=SysSetting.ins().getBool(SysSetting.SOUND_EFFECT),this.cbShake.selected=SysSetting.ins().getBool(SysSetting.SHAKE_WIN),this.cbHeji.selected=!!Setting.ins().getValue(ClientSet.autoHeji),this.cbBarrage.selected=SysSetting.ins().getBool(SysSetting.BARRAGE),this.cbLianJI.selected=LianJiCT.ins().auto,this.eWing.selected=!!Setting.ins().getValue(ClientSet.shWing),this.eWing1.selected=!!Setting.ins().getValue(ClientSet.shOtherWing),this.eTitle.selected=!!Setting.ins().getValue(ClientSet.shTitle),this.eTitle1.selected=!!Setting.ins().getValue(ClientSet.shOtherTitle),this.eMonster.selected=!!Setting.ins().getValue(ClientSet.shMonster);var t=ZhiYin.ins().arrow;if(t){Setting.ins().setValue(ClientSet.guide,1),DisplayUtils.removeFromParent(t),ZhiYin.ins().arrow=null;var e=new MovieClip;e.playFile(RES_DIR_EFF+"BtnPrompt1",-1),e.x=100,e.y=25,e.scaleX=1.5,this.cbHeji.addChild(e)}},e.prototype.onTouch=function(t){var e=t.currentTarget;if(e==this.cbSound)SysSetting.ins().setBool(SysSetting.SOUND_EFFECT,e.selected),TipsCT.ins().showTips("");else if(e==this.cbShake)SysSetting.ins().setBool(SysSetting.SHAKE_WIN,e.selected);else if(e==this.cbHeji)Setting.ins().setValue(ClientSet.autoHeji,+e.selected);else if(e==this.cbBarrage)SysSetting.ins().setBool(SysSetting.BARRAGE,e.selected);else if(e==this.eWing)Setting.ins().setValue(ClientSet.shWing,+e.selected);else if(e==this.eWing1)Setting.ins().setValue(ClientSet.shOtherWing,+e.selected);else if(e==this.eTitle)Setting.ins().setValue(ClientSet.shTitle,+e.selected);else if(e==this.eTitle1)Setting.ins().setValue(ClientSet.shOtherTitle,+e.selected);else if(e==this.eMonster)Setting.ins().setValue(ClientSet.shMonster,+e.selected);else if(e==this.bgClose)ViewManager.ins().close(this);else if(e==this.eLogout){var i=window.logout;if(!i)return;i()}else e==this.cbLianJI&&LianJiCT.ins().sendAuto(+this.cbLianJI.selected)},e}(BaseEuiView);__reflect(SettingView.prototype,"SettingView"),ViewManager.ins().reg(SettingView,LayerManager.UI_Popup),window.SettingView=SettingView;var SysSetting=function(t){function e(){var e=t.call(this)||this;return e._storage={},e._tempStorage={},e.defaultValue={sound_effect:0,shake_win:1,auto_heji:0,dice:0,barrage:1},e.init(),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.setItem=function(t,i){this._storage[t]!=i&&(this._storage[t]=i,t==e.SOUND_EFFECT?SoundUtil.enable=this.getBool(t):t==e.SHAKE_WIN&&DisplayUtils.setShakeOn(this.getBool(t)),Timer.has(this.storage,this)||egret.callLater(this.storage,this))},e.prototype.getItem=function(t){return this._storage[t]},e.prototype.setBool=function(t,e){this.setItem(t,e?1:0)},e.prototype.getBool=function(t){return!!this.getItem(t)},e.prototype.setValue=function(t,e){this._tempStorage[t]=e},e.prototype.getValue=function(t){return this._tempStorage[t]},e.prototype.init=function(){try{var t=getLocation(this.getStorageKey());t?this._storage=JSON.parse(t)||{}:this._storage={}}catch(e){console.log(e),this._storage={}}this.initValue()},e.prototype.initValue=function(){for(var t in this.defaultValue)void 0==this._storage[t]&&(this._storage[t]=this.defaultValue[t]);SoundUtil.enable=this.getBool(e.SOUND_EFFECT),DisplayUtils.setShakeOn(this.getBool(e.SHAKE_WIN))},e.prototype.storage=function(){try{var t=JSON.stringify(this._storage);setLocation(this.getStorageKey(),t)}catch(e){}},e.prototype.getStorageKey=function(){return Actor.actorID+""||"game_longlin"},e.SOUND_EFFECT="sound_effect",e.SHAKE_WIN="shake_win",e.BARRAGE="barrage",e}(BaseClass);__reflect(SysSetting.prototype,"SysSetting"),window.SysSetting=SysSetting,System.SysSetting=function(){return SysSetting.ins()};var SevenDayLogItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="act14item1",e.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)||e.addEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.onRemove=function(){egret.Tween.removeTweens(this.eff),this.hasEventListener(egret.TouchEvent.REMOVED_FROM_STAGE)&&this.removeEventListener(egret.TouchEvent.REMOVED_FROM_STAGE,this.onRemove,this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data;if(this.item.source=t.img,this.day.source="dengluday"+(t.day<10?0:"")+t.day,this.get.visible=!1,this.eff.alpha=0,egret.Tween.removeTweens(this.eff),Activity.ins().dayNum>=t.day)if(1==(Activity.ins().isAwards>>t.day&1))this.get.visible=!0;else{var e=egret.Tween.get(this.eff,{loop:!0});e.to({alpha:1},500).to({alpha:0},500)}this.rare.source=t.iconImg?t.iconImg:""}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.choose.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(SevenDayLogItem.prototype,"SevenDayLogItem"),window.SevenDayLogItem=SevenDayLogItem;var SevenDayLogWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="act14logSkin1",e.card.itemRenderer=SevenDayLogItem,e.cardsData=new eui.ArrayCollection,e.card.dataProvider=e.cardsData,e.reward.itemRenderer=ItemBase,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dayNum=t[0],this.updateDayNum(),this.cardMoveTo(this.dayNum),this.addTouchEvent(this,this.onClick),this.card.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.observe(Activity.ins().postSevendayIsAwards,this.postSevendayIsAwards),this.update()},e.prototype.postSevendayIsAwards=function(){for(var t=GlobalConfig.LoginRewardsConfig,e=CommonUtils.getObjectLength(t),i=Activity.ins().isAwards,n=0,s=1;e>=s;s++)if(Activity.ins().dayNum>=t[s].day&&0==(i>>t[s].day&1)){n=s;break}0==n&&(n=Activity.ins().dayNum+1<=e?Activity.ins().dayNum+1:this.dayNum),this.dayNum=n,this.cardMoveTo(this.dayNum),this.update(),this.card.selectedIndex=this.dayNum-1,this.updateBtn()},e.prototype.updateCards=function(){this.cardsData.replaceAll(CommonUtils.objectToArray(GlobalConfig.LoginRewardsConfig))},e.prototype.onListChange=function(t){this.dayNum=t.itemIndex+1,this.updateUI(),this.updateBtn()},e.prototype.cardMoveTo=function(t){var e=this;egret.callLater(function(){var i=GlobalConfig.LoginRewardsConfig,n=CommonUtils.getObjectLength(i),s=120;e.eScroller.viewport.scrollH=s*(Math.min(t,n-3)-1)},this)},e.prototype.updateDayNum=function(){var t=GlobalConfig.LoginRewardsConfig,e=CommonUtils.getObjectLength(t);if(!this.dayNum){this.dayNum=Math.max(1,Activity.ins().dayNum);for(var i=Activity.ins().isAwards,n=1;e>=n;n++)if(this.dayNum>=t[n].day&&0==(i>>t[n].day&1)){this.dayNum=n;break}}this.card.selectedIndex=this.dayNum-1,this.updateBtn()},e.prototype.update=function(){this.updateCards(),this.updateUI()},e.prototype.updateUI=function(){var t=GlobalConfig.LoginRewardsConfig[this.dayNum];if(t){this.daylabel.visible=!0,this.daylabel.text="登陆天数："+Activity.ins().dayNum,this.eImg.source=t.img,this.reward.dataProvider=new eui.ArrayCollection(t.rewards);var e=1==(Activity.ins().isAwards>>this.dayNum&1);Activity.ins().dayNum>=this.dayNum?e?(this.daylabel.visible=!1,this.suerBtn.enabled=!1,this.redPoint.visible=!1):(this.suerBtn.enabled=!0,this.redPoint.visible=!0):(this.suerBtn.enabled=!1,this.redPoint.visible=!1)}},e.prototype.onClick=function(t){switch(t.target){case this.leftBtn:this.changePage(-1);break;case this.rightBtn:this.changePage(1);break;case this.suerBtn:Activity.ins().dayNum>=this.dayNum?Activity.ins().sendGetSevenDayAwards(this.dayNum):TipsCT.ins().showTips("|C:0xf3311e&T:登陆天数不足，无法领取|")}},e.prototype.changePage=function(t){var e=GlobalConfig.LoginRewardsConfig,i=this.dayNum+t;e[i]&&(this.dayNum=i,this.card.selectedIndex=this.dayNum-1,this.cardMoveTo(this.dayNum),this.updateBtn(),this.updateUI())},e.prototype.updateBtn=function(){var t=GlobalConfig.LoginRewardsConfig;this.leftBtn.visible=null!=t[this.dayNum-1],this.rightBtn.visible=null!=t[this.dayNum+1]},e.prototype.close=function(){this.removeObserve()},e}(BaseView);__reflect(SevenDayLogWin.prototype,"SevenDayLogWin"),window.SevenDayLogWin=SevenDayLogWin;var ShenshouRedpoint=function(t){function e(){var e=t.call(this)||this;return e.redpointEquips1=[],e.redpointEquips2=[],e.redpoints=[],e.redpoint=!1,e.redPointDan=!1,e.wearArr=[],e.associated(e.postRedPoint,e.postRedPoint1,e.postRedPoint2,e.postRedPoint3,ShenshouSys.ins().postBattleState),e.associated(e.postRedPoint1,ShenshouSys.ins().postInfo,BagCT.ins().postItemAdd,BagCT.ins().postItemDel,BagCT.ins().postItemCountChange),e.associated(e.postRedPoint2,ShenshouSys.ins().postInfo,ShenshouSys.ins().postUpdateExp,ShenshouSys.ins().postWearEquip),e.associated(e.postRedPoint3,ShenshouSys.ins().postInfo,ShenshouSys.ins().postBattleMaxLimit),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){if(!ShenshouModel.ins().checkOpen())return this.redpoint=!1,0;this.redpoints=[];for(var t in GlobalConfig.ShenShouBase)if(this.redpoints[t]=this.redpointEquips1[t]&&this.redpointEquips1[t].indexOf(1)>-1,!this.redpoints[t]&&this.redpointEquips2[t]&&(this.redpoints[t]=this.redpointEquips2[t].indexOf(1)>-1),!this.redpoints[t]){var e=ShenshouModel.ins().getDataById(parseInt(t));this.redpoints[t]=e&&e.state==ShenshouState.State_Can&&ShenshouModel.ins().isCanBattle()}return this.redpoint=this.redpoints.indexOf(!0)>-1||this.redPointDan,this.redpoint?1:0},e.prototype.postRedPoint1=function(){if(!ShenshouModel.ins().checkOpen())return void(this.redpointEquips1=[]);this.wearArr=[];for(var t in GlobalConfig.ShenShouBase){var e=ShenshouSys.ins().dataList[t];this.redpointEquips1[t]=[];for(var i=1;i<=GlobalConfig.ShenShouConfig.posCount;i++){this.redpointEquips1[t][i]=0;var n=ShenshouModel.ins().findCanWearEquips(+t,i);n.length>0&&(this.redpointEquips1[t][i]=1,this.wearArr.push([t,i]),e&&e.equipIDs[i]&&ShenshouModel.ins().checkEquipScore(e.equipIDs[i],n[0].id)&&(this.redpointEquips1[t][i]=0,this.wearArr.pop()))}}},e.prototype.postRedPoint2=function(){if(!ShenshouModel.ins().checkOpen())return void(this.redpointEquips2=[]);var t=ShenshouSys.ins().hasBattleList;t.sort(Algorithm.sortAsc);for(var e in ShenshouSys.ins().dataList){var i=ShenshouSys.ins().dataList[e];this.redpointEquips2[e]=[];for(var n=1;5>=n;n++)this.redpointEquips2[e][n]=0,t[0]&&t[0]>+e||i.equipIDs[n]&&this.getForgeRedpoint(i.equipIDs[n],ShenshouSys.ins().exp)&&i.state!=ShenshouState.State_No&&(this.redpointEquips2[e][n]=1)}},e.prototype.postRedPoint3=function(){var t=ShenshouModel.ins(),e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem);this.redPointDan=e>0&&t.getCountBattle()<GlobalConfig.ShenShouConfig.maxCount},e.prototype.getForgeRedpoint=function(t,e){return GlobalConfig.ShenShouEquipExp[ShenshouSys.getLvById(t+1)]&&e>=GlobalConfig.ShenShouEquipExp[ShenshouSys.getLvById(t)].exp},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRedPoint1",null),__decorate([post()],e.prototype,"postRedPoint2",null),__decorate([post()],e.prototype,"postRedPoint3",null),e}(BaseSystem);__reflect(ShenshouRedpoint.prototype,"ShenshouRedpoint"),System.ShenshouRedpoint=function(){return ShenshouRedpoint.ins()},window.ShenshouRedpoint=ShenshouRedpoint;var ShenshouSys=function(t){function e(){var e=t.call(this)||this;return e.maxLimit=0,e.dataList={},e.exp=0,e.hasBattleList=[],e.sysId=PackageID.Shenshou,e.regNetMsg(1,e.postInfo),e.regNetMsg(2,e.postWearEquip),e.regNetMsg(4,e.postBattleState),e.regNetMsg(5,e.postBattleMaxLimit),e.regNetMsg(6,e.postUpdateExp),e.regNetMsg(7,e.postUpEquip),e.regNetMsg(8,e.postDepartEquip),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postInfo=function(t){this.hasBattleList=[];for(var e=t.readByte(),i=0;e>i;i++){var n=new ShenshouData(t);this.dataList[n.id]=n,n.state==ShenshouState.State_Has&&this.hasBattleList.push(n.id)}this.maxLimit=t.readByte(),this.exp=t.readInt()},e.prototype.postWearEquip=function(t){var e=t.readByte(),i=t.readByte(),n=t.readInt(),s=t.readInt();if(this.dataList[e])this.dataList[e].equipIDs[i]=n,this.dataList[e].power=s;else{var o=new ShenshouData;o.equipIDs[i]=n,o.id=e,o.power=s,this.dataList[e]=o}this.dataList[e].checkState(),ViewManager.ins().close(ShenshouWearEquipWin)},e.prototype.postBattleState=function(t){var e=t.readByte();this.dataList[e].state=t.readByte(),this.dataList[e].state==ShenshouState.State_Has?this.hasBattleList.push(e):this.hasBattleList.indexOf(e)>-1&&this.hasBattleList.splice(this.hasBattleList.indexOf(e),1)},e.prototype.postBattleMaxLimit=function(t){this.maxLimit=t.readByte(),ViewManager.ins().close(ShenshouDanUseWin)},e.prototype.postUpdateExp=function(t){var e=this.exp;this.exp=t.readInt(),this.exp-e>0&&TipsCT.ins().showTips("|C:0xffd93f&T:兽神精魄  +"+(this.exp-e)+"|")},e.prototype.postUpEquip=function(t){var e=t.readByte(),i=t.readByte(),n=t.readInt(),s=t.readInt();return this.dataList[e].equipIDs[i]=n,this.dataList[e].power=s,n},e.prototype.postDepartEquip=function(t){},e.prototype.sendWearEquip=function(t,e,i){var n=this.getBytes(2);n.writeByte(t),n.writeByte(e),n.writeInt(i),this.sendToServer(n)},e.prototype.sendComposeEquip=function(t){for(var e=this.getBytes(3),i=t.length;--i>0;)e.writeInt(t[i]);this.sendToServer(e)},e.prototype.sendBattle=function(t){var e=this.getBytes(4);e.writeByte(t),this.sendToServer(e)},e.prototype.sendUpLimitMax=function(){this.sendBaseProto(5)},e.prototype.sendUpEquip=function(t,e){var i=this.getBytes(7);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendDepartEquip=function(t){var e=this.getBytes(8),i=t.length;e.writeByte(i);for(var n=0;i>n;n++)e.writeInt(t[n]);this.sendToServer(e)},e.prototype.sendCompose=function(t){var e=this.getBytes(9);e.writeInt(t),this.sendToServer(e)},e.isCanMergeById=function(t){for(var e=!0,i=GlobalConfig.ShenShouCompose[t],n={},s=0,o=i.material;s<o.length;s++){var a=o[s],r=a.id;n[r]?n[r]+=a.count:n[r]=a.count}for(var a in n){var r=+a,l=ItemUtil.isEquip(GlobalConfig.ItemConfig[r])?BagCT.BAG_TYPE_EQUIP:BagCT.BAG_TYPE_OTHTER;if(BagCT.ins().getBagGoodsCountById(l,r)<n[a]){e=!1;break}}return e},e.getMergeEquipByType=function(t){var e=[],i=GlobalConfig.ShenShouCompose;for(var n in i)i[n].mixId[1]==t&&e.push({type:MergeType.MergeType_6,id:i[n].id});return e},e.isShenShouCanMerge=function(){var t=GlobalConfig.ShenShouCompose;for(var e in t)if(this.isCanMergeById(t[e].id))return!0;return!1},e.isShenShouCanMergeByIdIndex=function(t){var e=GlobalConfig.ShenShouCompose;for(var i in e)if(e[i].mixId[1]==t&&this.isCanMergeById(e[i].id))return!0;return!1},e.getLvById=function(t){return t%1e3},e.starattrsById=function(t){return GlobalConfig.ShenShouEquip[1e3*MathUtils.toInteger(t/1e3)+1].starattrs},__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postWearEquip",null),__decorate([post()],e.prototype,"postBattleState",null),__decorate([post()],e.prototype,"postBattleMaxLimit",null),__decorate([post()],e.prototype,"postUpdateExp",null),__decorate([post()],e.prototype,"postUpEquip",null),__decorate([post()],e.prototype,"postDepartEquip",null),e}(BaseSystem);__reflect(ShenshouSys.prototype,"ShenshouSys"),System.ShenshouSys=function(){return ShenshouSys.ins()},window.ShenshouSys=ShenshouSys;var ShenshouData=function(){function t(t){this.equipIDs=[],this.state=0;for(var e=1;5>=e;e++)this.equipIDs[e]=0;t&&this.readData(t)}return t.prototype.readData=function(t){this.id=t.readByte(),this.power=t.readInt(),this.equipIDs=[];for(var e=t.readByte(),i=0;e>i;i++)this.equipIDs[i+1]=t.readInt();this.state=t.readByte(),this.equipIDs.indexOf(0)>-1&&this.state!=ShenshouState.State_Has&&(this.state=ShenshouState.State_No)},t.prototype.checkState=function(){this.state!=ShenshouState.State_Has&&(this.equipIDs.indexOf(0)>-1?this.state=ShenshouState.State_No:this.state=ShenshouState.State_Can)},t}();__reflect(ShenshouData.prototype,"ShenshouData");var ShenshouEquipData=function(){function t(){}return t}();__reflect(ShenshouEquipData.prototype,"ShenshouEquipData");var ShenshouState;!function(t){t[t.State_No=2]="State_No",t[t.State_Can=0]="State_Can",t[t.State_Has=1]="State_Has"}(ShenshouState||(ShenshouState={})),window.ShenshouData=ShenshouData;var ShenshouModel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.findCanWearEquips=function(t,e){var i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_23),n=[],s=0,o=ShenshouSys.ins().dataList[t];o&&o.equipIDs[e]&&(s=BagCT.getAttrPower(AttributeData.getAttrFromCfg(GlobalConfig.ShenShouEquip[o.equipIDs[e]])));for(var a=0,r=i;a<r.length;a++){var l=r[a],h=this.getEquipQuality(l.configID);if(GlobalConfig.ShenShouEquip[l.configID]&&ItemUtil.getSubType(l.itemConfig)==e-1&&GlobalConfig.ShenShouBase[t].minLevel[e-1]<=h){var u=new ShenshouEquipData;u.id=l.configID,u.pos=e,u.shenshuId=t;var p=GlobalConfig.ShenShouEquip[l.configID];u.sortIndex=BagCT.getAttrPower(AttributeData.getAttrFromCfg(p)),u.best=u.sortIndex>s,n.push(u)}}return n.sort(this.compareFun),n},e.prototype.checkEquipScore=function(t,e){var i=BagCT.getAttrPower(AttributeData.getAttrFromCfg(GlobalConfig.ShenShouEquip[t])),n=BagCT.getAttrPower(AttributeData.getAttrFromCfg(GlobalConfig.ShenShouEquip[e]));return i>=n},e.prototype.compareFun=function(t,e){return t.sortIndex>e.sortIndex?-1:t.sortIndex<e.sortIndex?1:0},e.prototype.calcEquipScore=function(t){var e=this.getDataById(t),i=0;if(e)for(var n=1;n<=e.equipIDs.length;n++){var s=GlobalConfig.ShenShouEquip[e.equipIDs[n]];s&&(i+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(s)),s.expower&&(i+=s.expower))}return i
},e.prototype.getDataById=function(t){var e=ShenshouSys.ins().dataList[t];return e},e.prototype.getAttrValue=function(t,e){var i=this.getDataById(t);if(i){var n=0;for(var s in i.equipIDs)if(s){var o=GlobalConfig.ShenShouEquip[i.equipIDs[s]];if(o)for(var a=AttributeData.getAttrFromCfg(o),r=0,l=a;r<l.length;r++){var h=l[r];e==h.type&&(n+=h.value)}}return n}return 0},e.prototype.getCurStatus=function(t){var e=this.getDataById(t);return e?e.state:ShenshouState.State_No},e.prototype.getWearStatus=function(t){var e=ShenshouRedpoint.ins().wearArr,i=this.getDataById(t);for(var n in e)if(e&&e[n]&&i&&e[n][0]==i.id)return 0;if(i&&i.equipIDs)for(var n in i.equipIDs)if(0!=i.equipIDs[n])return 1;return 0},e.prototype.getWearPos=function(t){var e=this.getDataById(t),i=[];if(e&&e.equipIDs)for(var n in e.equipIDs)0!=e.equipIDs[n]&&i.push(n);return i},e.prototype.getCurBattle=function(){var t=0;for(var e in ShenshouSys.ins().dataList)ShenshouSys.ins().dataList[e].state==ShenshouState.State_Has&&t++;return t},e.prototype.getCountBattle=function(){return GlobalConfig.ShenShouConfig.minCount+ShenshouSys.ins().maxLimit},e.prototype.isCanBattle=function(){return this.getCurBattle()<this.getCountBattle()},e.prototype.getNowAttr=function(t){for(var e=[],i=AttributeData.getAttrFromCfg(t),n=ShenshouSys.starattrsById(t.id),s=0;s<i.length;s++){var o=new AttributeData(i[s].type,i[s].value-n[s].value);e.push(o)}return e},e.prototype.getEquipLv=function(t){return parseInt((t+"").slice(4,7))},e.prototype.getEquipQuality=function(t){return parseInt((t+"").slice(2,4))},e.prototype.getEquipBaseId=function(t){return 1e3*(t/1e3>>0)+1},e.prototype.checkOpen=function(){return ZsCT.ins().lv>=GlobalConfig.ShenShouConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ShenShouConfig.openserverday},e.EQUIPE_QUALITY_CN=["平凡","精良","史诗","传奇","神话"],e}(BaseClass);__reflect(ShenshouModel.prototype,"ShenshouModel"),window.ShenshouModel=ShenshouModel;var ShenshouDanUseWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="SsItemUseTips",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemConfig=t[0],this.addTouchEvent(this.useBtn,this.onTouch),this.addTouchEvent(this.cancelBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.itemIcon.data=this.itemConfig.id,this.itemIcon.touchEnabled=!1,this.ownCount.text="当前可出战数量："+ShenshouModel.ins().getCountBattle(),this.itemIcon.hideName(),this.useBtn.enabled=ShenshouModel.ins().getCountBattle()<GlobalConfig.ShenShouConfig.maxCount},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:case this.cancelBtn:ViewManager.ins().close(this);break;case this.useBtn:ShenshouSys.ins().sendUpLimitMax()}},e}(BaseEuiView);__reflect(ShenshouDanUseWin.prototype,"ShenshouDanUseWin"),ViewManager.ins().reg(ShenshouDanUseWin,LayerManager.UI_Popup),window.ShenshouDanUseWin=ShenshouDanUseWin;var AIUtil=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.ins=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.ins.call(this,e)},e.prototype.userSkill=function(t,e,i,n){return void 0===n&&(n=null),t!=e&&(t.dir=DirUtil.get8DirBy2Point(t,e)),i?(GameLogic.ins().playSkillEff(i,t,[e],n),!SoundUtil.WINDOW_OPEN&&i.sound&&t.team==Team.My&&SoundUtil.play(i.sound),!0):!1},e}(BaseClass);__reflect(AIUtil.prototype,"AIUtil");var ShenshouEquipItem1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.playDepartMc=function(){this.mc||(this.mc=new MovieClip),this.mc.x=43,this.mc.y=44,this.mc.scaleX=1.5,this.mc.scaleY=1.5,this.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+"BoomEff",1)},e.prototype.dataChanged=function(){if(!isNaN(this.data)&&this.data){this.itemConfig=GlobalConfig.ItemConfig[this.data],this.nameTxt.text="",this.imgBg.source="quality"+ItemUtil.getQuality(this.itemConfig),this.imgIcon.source=this.itemConfig.icon+"_png";var t=ShenshouModel.ins().getEquipLv(this.itemConfig.id)-1;this.equipLv.text=t>0?"+"+t:""}},e}(ShenshouEquipItem);__reflect(ShenshouEquipItem1.prototype,"ShenshouEquipItem1"),window.ShenshouEquipItem1=ShenshouEquipItem1;var ShenshouEquipTip=function(t){function e(){var e=t.call(this)||this;return e.posType=["血瞳","魔躯","妖尾","圣角","鬼爪"],e.skinName="shenshouEquipTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.changeBtn,this.onTouch),this.addTouchEvent(this.takeoffBtn,this.onTouch),this.addTouchEvent(this.forgeBtn,this.onTouch),this.shenshouId=t[0],this.pos=t[1],this.shenshouId){this.refRedpoint();var i=ShenshouModel.ins().getDataById(this.shenshouId);i.state==ShenshouState.State_No&&(this.forgeBtn.visible=!1)}else this.changeBtn.visible=!1,this.forgeBtn.visible=!1,this.takeoffBtn.visible=!1,this.changeRedPoint.visible=!1,this.forgeRedPoint.visible=!1,this.anigroup.height=505;this.itemDp=GlobalConfig.ItemConfig[t[2]],this.initUi()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.initUi=function(){var t=ItemUtil.getQuality(this.itemDp);this.quali.source=t?"quali"+t:"",this.equipIcon.data=this.itemDp.id,this.equipIcon.hideName(),this.nameTxt.text=this.itemDp.name,this.nameTxt.textColor=ItemUtil.getQualityColor(this.itemDp),this.type.text=this.posType[ItemUtil.getSubType(this.itemDp)],this.lv.text=ShenshouModel.ins().getEquipLv(this.itemDp.id)+"级",this.career.text="兽神";var e=GlobalConfig.ShenShouEquip[this.itemDp.id],i=BagCT.getAttrPower(AttributeData.getAttrFromCfg(e));e.expower&&(i+=e.expower),this.powerPanel.setPower(i*SubRoles.ins().subRolesLen);for(var n=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.itemDp.id)],s=AttributeData.getAttrFromCfg(n),o=ShenshouModel.ins().getNowAttr(n),a=AttributeData.getAttrFromCfg(e),r=0;3>r;r++)if(o[r]&&a[r]){this["attr"+(r+1)].visible=!0,this["attr"+(r+1)].text=AttributeData.getAttStrByType(o[r],0,":");var l=a[r].value-s[r].value;this["forgeAttr"+(r+1)].visible=n&&n.id!=e.id&&l>0,n&&n.id!=e.id&&l>0&&(this["forgeAttr"+(r+1)].text="+"+l)}else this["attr"+(r+1)].visible=!1,this["forgeAttr"+(r+1)].visible=!1;for(var h=ShenshouSys.starattrsById(e.id),r=0;3>r;r++)h[r]?(this["starAttr"+(r+1)].visible=!0,this["starAttr"+(r+1)].text=AttributeData.getAttStrByType(h[r],0,":")):this["starAttr"+(r+1)].visible=!1},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:break;case this.changeBtn:ViewManager.ins().open(ShenshouWearEquipWin,this.shenshouId,this.pos,this.itemDp.id);break;case this.takeoffBtn:if(ShenshouModel.ins().getDataById(this.shenshouId).state==ShenshouState.State_Has)return void TipsCT.ins().showCenterTips("请先取消出战");ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,0);break;case this.forgeBtn:ViewManager.ins().open(ShenshouForgeWin,this.shenshouId,this.pos,this.itemDp)}ViewManager.ins().close(this)},e.prototype.refRedpoint=function(){var t=ShenshouRedpoint.ins(),e=t.redpointEquips1,i=t.redpointEquips2;this.changeRedPoint.visible=e[this.shenshouId]&&!!e[this.shenshouId][this.pos],this.forgeRedPoint.visible=i[this.shenshouId]&&!!i[this.shenshouId][this.pos]},e}(BaseEuiView);__reflect(ShenshouEquipTip.prototype,"ShenshouEquipTip"),ViewManager.ins().reg(ShenshouEquipTip,LayerManager.UI_Popup),window.ShenshouEquipTip=ShenshouEquipTip;var ShenshouForgeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SsEquipForgeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.list.itemRenderer=ShenshouEquipItem1,this.listDt=new eui.ArrayCollection,this.list.dataProvider=this.listDt,this.nowList=[],this.exp.value=0,this.exp.labelFunction=function(t,e){return ShenshouSys.ins().exp+"/"+e}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.shenshouId=t[0],this.pos=t[1],this.curItemDp=t[2],this.filterList=[],this.addTouchEvent(this.departBtn,this.onTouch),this.addTouchEvent(this.lvUpBtn,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.list,this.onList),this.observe(ShenshouSys.ins().postUpEquip,this.onUpEquip),this.observe(ShenshouSys.ins().postUpdateExp,this.refUIData),this.observe(ShenshouSys.ins().postDepartEquip,this.onDecompose),this.observe(ShenshouRedpoint.ins().postRedPoint2,this.refRedpoint),this.refRedpoint(),this.refUIData(),this.refList()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.forgetMC)},e.prototype.onUpExp=function(){this.exp.value=ShenshouSys.ins().exp,this.exp.maximum=GlobalConfig.ShenShouEquipExp[ShenshouSys.getLvById(this.curItemDp.id)].exp,this.exp.value=ShenshouSys.ins().exp,this.exp.labelDisplay.text=ShenshouSys.ins().exp+"/"+this.exp.maximum},e.prototype.onUpEquip=function(t){this.curItemDp=GlobalConfig.ItemConfig[t],this.refUIData(),this.forgetMC||(this.forgetMC=new MovieClip,this.forgetMC.x=62,this.forgetMC.y=62),this.forgetMC.playFile(RES_DIR_EFF+"UpEff1",1),this.iconGroup.addChild(this.forgetMC)},e.prototype.refUIData=function(){var t=GlobalConfig.ShenShouEquip[this.curItemDp.id];this.curScore=BagCT.getAttrPower(AttributeData.getAttrFromCfg(t)),t.expower&&(this.curScore+=t.expower),this.powerPanel.setPower(this.curScore*SubRoles.ins().subRolesLen),this.equipName.text=this.curItemDp.name,this.equipName.textColor=ItemUtil.getQualityColor(this.curItemDp),this.itemIcon.data=this.curItemDp.id,this.itemIcon.hideName();var e=ShenshouModel.ins().getEquipLv(this.curItemDp.id);this.attrPanel.lvNow.text="Lv."+e,this.attrPanel.lvNext.text="Lv."+(e+1),this.maxExpImg.visible=!1,this.maxExpTxt.visible=!1;var i=GlobalConfig.ShenShouEquip[this.curItemDp.id+1];i||(this.lvUpBtn.enabled=!1,this.attrPanel.currentState="max",this.exp.visible=!1,this.maxExpImg.visible=!0,this.maxExpTxt.visible=!0);for(var n=AttributeData.getAttrFromCfg(t),s=i?AttributeData.getAttrFromCfg(i):[],o=0;3>o;o++)n[o]?(this.attrPanel["attr"+(o+1)+"Now"].visible=!0,this.attrPanel["attr"+(o+1)+"Next"].visible=i&&s[o],this.attrPanel["attr"+(o+1)+"Now"].text=AttributeData.getAttStrByType(n[o],0,":"),i&&s[o]&&(this.attrPanel["attr"+(o+1)+"Next"].text=AttributeData.getAttStrByType(s[o],0,":"))):(this.attrPanel["attr"+(o+1)+"Next"].visible=!1,this.attrPanel["attr"+(o+1)+"Now"].visible=!1);this.onUpExp()},e.prototype.onDecompose=function(){for(var t=this.list.numChildren,e=0;t>e;e++){var i=this.list.getChildAt(e);i&&i.playDepartMc()}Timer.start(500,1,this.refList,this)},e.prototype.refList=function(){var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_23),e=[];for(var i in t){var n=ShenshouModel.ins().getEquipQuality(t[i].configID);GlobalConfig.ShenShouSmelt[n]&&e.push(t[i])}t=e.concat(BagCT.ins().getBagGoodsByType(ItemType.TYPE_32)),this.nowList=[];for(var s=12,o=++s;--o>=0;)if(t[o])if(t[o].count>1){for(var i=0;i<t[o].count;i++)if(!(this.filterList.indexOf(t[o].configID)>-1)&&this.checkCurEquip(t[o].configID)){if(this.nowList.length>=s)break;this.nowList.push(t[o].configID)}}else{if(this.filterList.indexOf(t[o].configID)>-1||!this.checkCurEquip(t[o].configID))continue;if(this.nowList.length>=s)break;this.nowList.push(t[o].configID)}this.listDt.replaceAll(this.nowList)},e.prototype.checkCurEquip=function(t){var e=GlobalConfig.ShenShouEquip[t],i=e?BagCT.getAttrPower(AttributeData.getAttrFromCfg(e)):0;return this.curScore>=i},e.prototype.onList=function(t){t.target instanceof ShenshouEquipItem1&&-1==this.filterList.indexOf(t.target.data)&&this.filterList.push(t.target.data),this.refList()},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;case this.lvUpBtn:if(ShenshouSys.ins().exp<this.exp.maximum)return void TipsCT.ins().showCenterTips("当前兽神精魄不足，无法升级！");ShenshouSys.ins().sendUpEquip(this.shenshouId,this.pos);break;case this.departBtn:if(!this.nowList.length)return void TipsCT.ins().showCenterTips("当前没有可分解的装备");ShenshouSys.ins().sendDepartEquip(this.nowList)}},e.prototype.refRedpoint=function(){this.rightRed.visible=!!ShenshouRedpoint.ins().redpointEquips2[this.shenshouId][this.pos]},__decorate([callLater],e.prototype,"onUpExp",null),__decorate([callLater],e.prototype,"refRedpoint",null),e}(BaseEuiView);__reflect(ShenshouForgeWin.prototype,"ShenshouForgeWin"),ViewManager.ins().reg(ShenshouForgeWin,LayerManager.UI_Popup),window.ShenshouForgeWin=ShenshouForgeWin;var ShenshouInfoPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setID=function(t){this.curId=t,this.currentState=""+t,this.skin&&(this.refState(),this.refEquipData())},e.prototype.removeDisplay=function(){this.stopBeatAnimat()},e.prototype.addDisplay=function(){void 0!=this.curId&&this.setID(this.curId),this.associated(this.refEquipData,ShenshouSys.ins().postWearEquip,ShenshouSys.ins().postUpEquip,ShenshouRedpoint.ins().postRedPoint),this.observe(ShenshouSys.ins().postBattleState,this.refState)},e.prototype.refEquipData=function(){if(this.skin)for(var t=GlobalConfig.ShenShouConfig.posCount,e=ShenshouRedpoint.ins(),i=e.redpointEquips1,n=e.redpointEquips2,s=0;t>s;s++){var o=s+1;this["item"+s].name=o;var a=ShenshouModel.ins().getDataById(this.curId);a&&a.equipIDs[o]?this["item"+s].data=a.equipIDs[o]:this["item"+s].setPosData(this.curId,o),this["item"+s].redPoint.visible=i[this.curId]&&i[this.curId][s+1]||n[this.curId]&&n[this.curId][s+1]}},e.prototype.refState=function(){var t=ShenshouModel.ins(),e=t.getCurStatus(this.curId),i="";switch(this.eff.touchEnabled=!1,this.startUpEff(!1,null),e){case ShenshouState.State_No:i="ss_"+this.curId+"b_png";break;case ShenshouState.State_Can:i="ss_"+this.curId+"a_png";break;case ShenshouState.State_Has:this.startUpEff(!0,"icon_s"+this.curId),i=""}this.shenshouImg.visible=!!i.length},e.prototype.startUpEff=function(t,e){this.upEff||(this.upEff=new MovieClip,this.eff.addChild(this.upEff),this.upEff.x=280,this.upEff.y=160),e&&(this.upEff.playFile(RES_DIR_EFF+e,-1),this.upEff.x=280,this.upEff.y=160),this.upEff.visible=t},e.prototype.runTween=function(){this.imgCopy.visible=!0,this.imgCopy.alpha=0,this.imgCopy.scaleX=this.imgCopy.scaleY=1,this.imgCopy.x=this.shenshouImg.x+(this.shenshouImg.width>>1),this.imgCopy.y=this.shenshouImg.y+(this.shenshouImg.height>>1),this.imgCopy.anchorOffsetX=this.shenshouImg.width>>1,this.imgCopy.anchorOffsetY=this.shenshouImg.height>>1,this.imgCopy.top=this.shenshouImg.top,this.imgCopy.horizontalCenter=this.shenshouImg.horizontalCenter,egret.Tween.get(this.imgCopy).to({alpha:1},250).to({alpha:0,scaleX:1.2,scaleY:1.2},2e3,egret.Ease.cubicInOut)},e.prototype.stopBeatAnimat=function(){Timer.stop(this.runTween,this),this.imgCopy&&(egret.Tween.removeTweens(this.imgCopy),this.imgCopy.visible=!1)},e}(BaseView);__reflect(ShenshouInfoPanel.prototype,"ShenshouInfoPanel"),window.ShenshouInfoPanel=ShenshouInfoPanel;var ShenshouSkillTip=function(t){function e(){var e=t.call(this)||this;return e.skinName="shenshouSkillTips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch);var i=t[0];this.quali.source=i.quality?"quali"+i.quality:"",this.equipIcon.skillQuality.source="quality"+i.quality,this.equipIcon.skillImg.source=i.icon,this.equipIcon.skillName.text="",this.nameTxt.text=i.name,this.targetTxt.text=1==i.target?"所有出战神兽生效":"仅本体出战神兽生效",this.targetTxt0.textFlow=TextFlowMaker.generateTextFlow1(i.desc)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShenshouSkillTip.prototype,"ShenshouSkillTip"),ViewManager.ins().reg(ShenshouSkillTip,LayerManager.UI_Tips),window.ShenshouSkillTip=ShenshouSkillTip;var ShenshouTab=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data.id){var t=ShenshouModel.ins().getDataById(this.data.id);this.redPoint.visible=ShenshouRedpoint.ins().redpoints[this.data.id],this.activityImg.visible=t&&t.state==ShenshouState.State_Has,t&&t.state!=ShenshouState.State_No?this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].activeImg:this.btnName.source=GlobalConfig.ShenShouBase[this.data.id].iconImg}},Object.defineProperty(e.prototype,"selected",{set:function(t){this.select.visible=t},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(ShenshouTab.prototype,"ShenshouTab"),window.ShenshouTab=ShenshouTab;var ShenshouWearEquipItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.dataChanged=function(){if(this.data instanceof ShenshouEquipData){this.itemIcon.data=this.data.id;var t=GlobalConfig.ItemConfig[this.data.id];this.quality.text=ShenshouModel.EQUIPE_QUALITY_CN[ItemUtil.getQuality(t)],this.quality.textColor=ItemUtil.getQualityColor(t),this.now.visible=!1,this.best.visible=!1,this.changeBtn.visible=!0,this.data.sortIndex==Number.MAX_VALUE&&(this.now.visible=!0,this.changeBtn.visible=!1),this.data.best&&(this.best.visible=!0);for(var e=GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(this.data.id)],i=AttributeData.getAttrFromCfg(e),n=GlobalConfig.ShenShouEquip[this.data.id],s=AttributeData.getAttrFromCfg(n),o=ShenshouModel.ins().getDataById(this.data.shenshuId),a=o?GlobalConfig.ShenShouEquip[ShenshouModel.ins().getEquipBaseId(o.equipIDs[this.data.pos])]:null,r=a?AttributeData.getAttrFromCfg(a):null,l=0;3>l;l++)s[l]?(this["attr"+l].visible=!0,this["attr"+l].text=AttributeData.getAttStrByType(i[l],0,":"),this["betterArrow"+l].visible=!a||a&&i[l].value>r[l].value,s[l].value>i[l].value?(this["forgeAttr"+l].visible=!0,this["forgeAttr"+l].text="+"+(s[l].value-i[l].value)):this["forgeAttr"+l].visible=!1):(this["attr"+l].visible=!1,this["betterArrow"+l].visible=!1,this["forgeAttr"+l].visible=!1);var h=BagCT.getAttrPower(s);n.expower&&(h+=n.expower),this.power.text="评分："+3*h}},e}(BaseItemRender);__reflect(ShenshouWearEquipItem.prototype,"ShenshouWearEquipItem"),window.ShenshouWearEquipItem=ShenshouWearEquipItem;var ShenshouWearEquipWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="SsEquipChooseSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTouch),this.addTouchEvent(this.list,this.onTouch),this.list.itemRenderer=ShenshouWearEquipItem,this.listDt=new eui.ArrayCollection,this.list.dataProvider=this.listDt,this.shenshouId=t[0],this.pos=t[1];var i=ShenshouModel.ins().findCanWearEquips(this.shenshouId,this.pos);if(i.length>0){if(t[2]){var n=new ShenshouEquipData;n.pos=this.pos,n.shenshuId=this.shenshouId,n.sortIndex=Number.MAX_VALUE,n.id=t[2],i.splice(0,0,n)}this.listDt.replaceAll(i),this.tipLabel2.visible=!1}else this.tipLabel2.visible=!0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onTouch=function(t){var e=this;switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button&&t.target.parent instanceof ShenshouWearEquipItem){var i=!1;if(this.listDt.source.length>0&&this.listDt.source[0].sortIndex==Number.MAX_VALUE){var n=this.listDt.source[0].id;n%100!=1&&ItemUtil.getQuality(GlobalConfig.ItemConfig[n])>=4&&(i=!0)}var s=t.target.parent.data;i?WarnWin.show("替换兽神装备，被替换的兽神装备等级会被重置\n<font color='#ffff00'>经验100%返还，</font>是否进行替换？",function(){ShenshouSys.ins().sendWearEquip(e.shenshouId,e.pos,s.id)},this):ShenshouSys.ins().sendWearEquip(this.shenshouId,this.pos,s.id)}}},e}(BaseEuiView);__reflect(ShenshouWearEquipWin.prototype,"ShenshouWearEquipWin"),ViewManager.ins().reg(ShenshouWearEquipWin,LayerManager.UI_Popup),window.ShenshouWearEquipWin=ShenshouWearEquipWin;var ShenshouWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curId=1,e.MAX_SKILL=4,e}return __extends(e,t),e.prototype.skinComplete=function(){this.listMenu.itemRenderer=ShenshouTab,this.listMenuDt=new eui.ArrayCollection(CommonUtils.objectToArray(GlobalConfig.ShenShouBase)),this.listMenu.dataProvider=this.listMenuDt,this.addTouchEvent(this.rightBtn,this.onTouch),this.addTouchEvent(this.leftBtn,this.onTouch),this.addTouchEvent(this.activityBtn,this.onTouch),this.addTouchEvent(this.shenshouItem,this.onTouch),this.addTouchEvent(this.eItemBtn,this.onTouch),this.addTouchEvent(this.oneBtnChange,this.onTouch),this.addEvent(eui.ItemTapEvent.ITEM_TAP,this.listMenu,this.onTouchMenu),this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange);for(var t=1;t<=this.MAX_SKILL;t++)this.addTouchEvent(this["skill"+t],this.onTouch)},e.prototype.addDisplay=function(){this.observe(ShenshouRedpoint.ins().postRedPoint,this.refRedPoint),this.observe(ShenshouSys.ins().postWearEquip,this.refEquipData),this.observe(ShenshouSys.ins().postUpEquip,this.refEquipData),this.observe(ShenshouSys.ins().postInfo,this.refEquipData),this.observe(ShenshouSys.ins().postBattleState,this.refData),this.observe(ShenshouSys.ins().postBattleMaxLimit,this.updateNum),this.listMenu.selectedIndex=0,this.showUI(this.curId),this.onChange(),this.refRedPoint()},e.prototype.onTouchMenu=function(t){this.curId=t.item.id,this.showUI(this.curId)},e.prototype.onChange=function(){this.listMenu.scrollH<20?(this.leftBtn.visible=!1,this.rightBtn.visible=!0):this.listMenu.scrollH>88*(this.listMenu.dataProvider.length-5)+2?(this.leftBtn.visible=!0,this.rightBtn.visible=!1):(this.leftBtn.visible=!0,this.rightBtn.visible=!0),this.listMenu.dataProvider.length<=5&&(this.leftBtn.visible=!1,this.rightBtn.visible=!1),this.refArrowRedpoint()},e.prototype.showUI=function(t){for(var e=GlobalConfig.ShenShouBase[t],i=0;i<this.MAX_SKILL;i++)if(e.skill&&e.skill[i]){this["skill"+(i+1)].visible=!0,this["skill"+(i+1)].touchChildren=!1;var n=GlobalConfig.ShenShouSkill[e.skill[i]];this["skill"+(i+1)].name=e.skill[i],this["skill"+(i+1)].skillImg.source=n.icon,this["skill"+(i+1)].skillName.text=n.name,this["skill"+(i+1)].skillQuality.source="quality"+n.quality}else this["skill"+(i+1)].visible=!1;this.shenshouItem.setID(t),this.refEquipData()},e.prototype.refEquipData=function(){this.powerPanel.setPower(0);var t=ShenshouModel.ins().getDataById(this.curId);t&&this.powerPanel.setPower(t.power),this.refData()},e.prototype.updateNum=function(){var t=ShenshouModel.ins();this.fightCount.text="当前出战："+t.getCurBattle()+"/"+t.getCountBattle();var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem);this.redPoint.visible=this.eItemBtn.enabled=e>0&&t.getCountBattle()<GlobalConfig.ShenShouConfig.maxCount},e.prototype.refData=function(){var t=ShenshouModel.ins();this.updateNum();var e=t.getCurStatus(this.curId);switch(e){case ShenshouState.State_No:this.activityBtn.enabled=!1,this.activityBtn.label="出战";break;case ShenshouState.State_Can:this.activityBtn.enabled=!0,this.activityBtn.label="出战";break;case ShenshouState.State_Has:this.activityBtn.enabled=!0,this.activityBtn.label="取消出战"}this.isWear=t.getWearStatus(this.curId),this.oneBtnChange.label=this.isWear?"一键卸下":"一键穿戴",this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase))},e.prototype.refArrowRedpoint=function(){if(this.rightRed.visible=!1,this.leftRed.visible=!1,this.leftBtn.visible){var t=ShenshouRedpoint.ins().redpoints.slice(0,4);this.leftRed.visible=t.indexOf(!0)>-1}if(this.rightBtn.visible){var t=ShenshouRedpoint.ins().redpoints.slice(5,9);this.rightRed.visible=t.indexOf(!0)>-1}},e.prototype.refRedPoint=function(){this.refArrowRedpoint(),this.listMenuDt.replaceAll(CommonUtils.objectToArray(GlobalConfig.ShenShouBase)),this.isWear=ShenshouModel.ins().getWearStatus(this.curId),this.oneBtnChange.label=this.isWear?"一键卸下":"一键穿戴"},e.prototype.onTouch=function(t){var e=460,i=0;switch(t.target){case this.eItemBtn:var n=GlobalConfig.ShenShouConfig.battleCountItem;ViewManager.ins().open(ShenshouDanUseWin,GlobalConfig.ItemConfig[n]);break;case this.rightBtn:i=this.listMenu.scrollH+e,i=92*Math.round(i/92),i>this.listMenu.contentWidth-this.listScroller.width&&(i=this.listMenu.contentWidth-this.listScroller.width),this.listMenu.scrollH=i,this.onChange();break;case this.leftBtn:i=this.listMenu.scrollH-e,i=92*Math.round(i/92),0>i&&(i=0),this.listMenu.scrollH=i,this.onChange();break;case this.activityBtn:if(ShenshouModel.ins().getCurStatus(this.curId)==ShenshouState.State_Can){var s=ShenshouModel.ins().getCurBattle();if(s<GlobalConfig.ShenShouConfig.maxCount&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.ShenShouConfig.battleCountItem)&&s>=ShenshouModel.ins().getCountBattle())return void ViewManager.ins().open(ShenshouDanUseWin,GlobalConfig.ItemConfig[GlobalConfig.ShenShouConfig.battleCountItem]);if(s>=ShenshouModel.ins().getCountBattle())return void TipsCT.ins().showCenterTips("兽神的出战总量已经达到上限")}ShenshouSys.ins().sendBattle(this.curId);break;case this.oneBtnChange:if(ShenshouModel.ins().getDataById(this.curId)&&ShenshouModel.ins().getDataById(this.curId).state==ShenshouState.State_Has&&this.isWear)return void TipsCT.ins().showCenterTips("请先取消出战");if(this.isWear){var o=ShenshouModel.ins().getWearPos(this.curId);for(var a in o)ShenshouSys.ins().sendWearEquip(this.curId,parseInt(o[a]),0)}else{var r=ShenshouRedpoint.ins().wearArr;if(0==r.length)return void TipsCT.ins().showTips("无可穿戴兽神装备");var l=void 0;for(var a in r)if(this.curId==r[a][0]){l=r[a][1];var h=ShenshouModel.ins().findCanWearEquips(this.curId,l);if(h.length>0){var u=h[0].id;ShenshouSys.ins().sendWearEquip(this.curId,l,u)}}}break;default:if("shenshouEquipItem"==t.target.skinName){var o=parseInt(t.target.name);t.target.data?ViewManager.ins().open(ShenshouEquipTip,this.curId,o,t.target.data):ViewManager.ins().open(ShenshouWearEquipWin,this.curId,o)}else("shenshouSkillItem"==t.target.parent.skinName||"shenshouSkillItem"==t.target.skinName)&&ViewManager.ins().open(ShenshouSkillTip,GlobalConfig.ShenShouSkill[t.target.name])}},__decorate([callLater],e.prototype,"refEquipData",null),e}(BaseView);__reflect(ShenshouWin.prototype,"ShenshouWin"),window.ShenshouWin=ShenshouWin;var Shop=function(t){function e(){var e=t.call(this)||this;return e.dartData=[],e.weekLimitDatas={},e.shopData=new ShopData,e.sysId=PackageID.Shop,e.regNetMsg(1,e.postUpdateShopData),e.regNetMsg(2,e.postBuyResult),e.regNetMsg(3,e.postBuyCount),e.regNetMsg(4,e.refreshGoodsSuccess),e.regNetMsg(5,e.postRefreshIntegrationSucc),e.regNetMsg(6,e.updateMedalMessage),e.regNetMsg(7,e.postUpdateBuyMedal),e.regNetMsg(8,e.postWeekLimitDatas),e.regNetMsg(9,e.postWeekLimitData),e.regNetMsg(10,e.postAllDartData),e.regNetMsg(11,e.postDartData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendBuy=function(t,e){var i=this.getBytes(2);i.writeInt(t),i.writeInt(e.length),this.shopBuyArr=[];for(var n=0;n<e.length;n++){i.writeInt(e[n][0]),i.writeInt(e[n][1]);var s=GlobalConfig.ItemStoreConfig[e[n][0]];if(s&&s.itemId==ItemConst.GOLD_BRICK){var o={id:ItemConst.GOLD_BRICK,count:e[n][1]};this.shopBuyArr.push(o)}}this.sendToServer(i)},e.prototype.sendRefreshShop=function(){var t=this.getBytes(3);this.sendToServer(t)},e.prototype.postUpdateShopData=function(t){e.ins().shopData.parser(t)},e.prototype.postBuyResult=function(t){var e=t.readInt();return e},e.prototype.postBuyCount=function(t){e.ins().shopData.parserBuyCount(t)},e.prototype.refreshGoodsSuccess=function(t){this.postRefreshGoodsSuccess(!0)},e.prototype.postRefreshGoodsSuccess=function(t){return t},e.prototype.postRefreshIntegrationSucc=function(t){var i=t.readBoolean();t.readInt();return[i,e.ins().shopData.point]},e.prototype.sendIntegrationShop=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.sendMedalMessage=function(){var t=this.getBytes(6);this.sendToServer(t)},e.prototype.updateMedalMessage=function(t){var i=t.readInt();this.medalData=new FeatsStoreData(i,t),e.ins().postRefresMedalMessage()},e.prototype.postRefresMedalMessage=function(){},e.prototype.sendBuyMedal=function(t,e){var i=this.getBytes(7);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postUpdateBuyMedal=function(t){var e=t.readInt(),i=t.readInt();return[e,i]},e.prototype.postAllDartData=function(t){var e=t.readInt();this.dartData=[];for(var i=0;e>i;i++)this.dartData[t.readUnsignedInt()]=t.readUnsignedInt()},e.prototype.postDartData=function(t){this.dartData[t.readUnsignedInt()]=t.readUnsignedInt()},e.prototype.sendBuyDart=function(t,e){var i=this.getBytes(11);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getDartBuyNumById=function(t){return this.dartData[t]||0},e.openBuyGoldWin=function(t){void 0===t&&(t=!0);var i=e.ins().shopData.getGoodsIdByItemId(200164);return e.ins().shopData.checkBuyGoodsId(i,t)?(ViewManager.ins().open(BuyWin,i),!0):!1},e.prototype.postWeekLimitDatas=function(t){var e=t.readInt();this.weekLimitDatas={};for(var i=0;e>i;i++)this.weekLimitDatas[t.readInt()]=t.readInt()},e.prototype.postWeekLimitData=function(t){this.weekLimitDatas[t.readInt()]=t.readInt()},e.prototype.sendBuyWeekLimit=function(t,e){var i=this.getBytes(9);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getWeekNumById=function(t){return this.weekLimitDatas[t]||0},__decorate([post()],e.prototype,"postUpdateShopData",null),__decorate([post()],e.prototype,"postBuyResult",null),__decorate([post()],e.prototype,"postBuyCount",null),__decorate([post()],e.prototype,"postRefreshGoodsSuccess",null),__decorate([post()],e.prototype,"postRefreshIntegrationSucc",null),__decorate([post()],e.prototype,"postRefresMedalMessage",null),__decorate([post()],e.prototype,"postUpdateBuyMedal",null),__decorate([post()],e.prototype,"postAllDartData",null),__decorate([post()],e.prototype,"postDartData",null),__decorate([post()],e.prototype,"postWeekLimitDatas",null),__decorate([post()],e.prototype,"postWeekLimitData",null),e}(BaseSystem);__reflect(Shop.prototype,"Shop");var ShopData=function(t){function e(){var e=t.call(this)||this;return e.shopEquipData=[],e.hadBuyCount=[],e}return __extends(e,t),Object.defineProperty(e.prototype,"refushTime",{get:function(){return this._refushTime},set:function(t){this._refushTime=t,Timer.stopAll(this),t>0&&Timer.start(1e3,t,this.enterTime,this)},enumerable:!0,configurable:!0}),e.prototype.parser=function(t){this.shopEquipData.length=0,this.refushTime=t.readInt(),this.point=t.readInt(),this.times=t.readInt();for(var e=t.readInt(),i=0;e>i;i++){var n=new ShopEquipData;n.parser(t),this.shopEquipData.push(n)}},e.prototype.parserBuyCount=function(t){var e=t.readShort();this.hadBuyCount.length=0;for(var i=0;e>i;i++){var n=new ShopHadBuyData;n.parser(t),this.hadBuyCount.push(n)}},e.prototype.enterTime=function(){this._refushTime<=0?this._refushTime=0:this._refushTime--},e.prototype.getHadBuyCountItem=function(t){for(var e=0,i=this.hadBuyCount;e<i.length;e++){var n=i[e];if(n.itemId==t)return n}return null},e.prototype.getHadBuyCount=function(t){var e=this.getHadBuyCountItem(t);return e?e.count:0},e.prototype.getShopEquipDataLength=function(){var t=0;return null!=this.shopEquipData&&(t=this.shopEquipData.length),t},e.prototype.getShopEquipDataByIndex=function(t){var e=null;return null!=this.shopEquipData&&t>=0&&t<this.shopEquipData.length&&(e=this.shopEquipData[t]),e},e.prototype.getShopEquipDataById=function(t){for(var e=0,i=this.shopEquipData;e<i.length;e++){var n=i[e];if(n.id==t)return n}return null},e.prototype.checkBuyGoodsId=function(t,e){void 0===e&&(e=!0);var i=GlobalConfig.ItemStoreConfig[t];if(i){if(i.viplv&&Actor.vip<i.viplv)return e&&TipsCT.ins().showTips(VipCT.getVipStr(i.viplv,!0)+"可购买"),!1;if(i.vipLimit){var n=i.vipLimit[Actor.vip],s=this.getHadBuyCount(i.itemId);if(s>=n)return e&&TipsCT.ins().showTips("今日购买次数已用完"),!1}}return!0},e.prototype.getGoodsIdByItemId=function(t){for(var e in GlobalConfig.ItemStoreConfig)if(GlobalConfig.ItemStoreConfig[e].itemId==t)return parseInt(e);
return 0},e}(egret.HashObject);__reflect(ShopData.prototype,"ShopData");var ShopEquipData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.costType=t.readInt(),this.costNum=t.readInt(),this.discountType=t.readInt(),this.item=new ItemData,this.item.parser(t)},t.discountDic={0:{discount:1,res:""},1:{discount:.8,res:"shangzk8"},2:{discount:.5,res:"shangzk5"}},t}();__reflect(ShopEquipData.prototype,"ShopEquipData");var ShopHadBuyData=function(){function t(){}return t.prototype.parser=function(t){this.itemId=t.readInt(),this.count=t.readInt()},t}();__reflect(ShopHadBuyData.prototype,"ShopHadBuyData"),System.Shop=function(){return Shop.ins()},window.Shop=Shop;var FeatsStoreData=function(){function t(t,e){this.exchangeCount=[];for(var i,n,s=0;t>s;s++)i=e.readInt(),n=e.readInt(),this.exchangeCount[i]=n}return t.prototype.checkHonorBuy=function(t){var e=GlobalConfig.FeatsStore[t];if(Actor.chip<e.costMoney.count)return!1;switch(e.buyType){case FEATS_TYPE.day:if(this.exchangeCount[e.index-1]>=e.daycount)return!0;break;case FEATS_TYPE.infinite:return!0;case FEATS_TYPE.forever:if(this.exchangeCount[e.index-1]>=e.daycount)return!0}return!1},t.prototype.checkHonorRedPoint=function(){for(var t in GlobalConfig.FeatsStore){var e=this.checkHonorBuy(GlobalConfig.FeatsStore[t].goods[0].id);if(e)return!0}return!1},t}();__reflect(FeatsStoreData.prototype,"FeatsStoreData");var FEATS_TYPE;!function(t){t[t.day=1]="day",t[t.infinite=2]="infinite",t[t.forever=3]="forever",t[t.week=4]="week"}(FEATS_TYPE||(FEATS_TYPE={}));var FEATS_SHOP_TYPE;!function(t){t[t.Money=1]="Money",t[t.Item=2]="Item"}(FEATS_SHOP_TYPE||(FEATS_SHOP_TYPE={})),window.FeatsStoreData=FeatsStoreData,window.FEATS_TYPE=FEATS_TYPE,window.FEATS_SHOP_TYPE=FEATS_SHOP_TYPE;var BlackMarketItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.goodsID=0,e.skinName="BlackMarketItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,i=t.item,n=GlobalConfig.ItemConfig[i.configID];this.goodsID=t.id;var s="";if(s=2==t.costType?t.costNum+"":t.costNum>1e5?Math.floor(t.costNum/1e4)+"万":t.costNum+"",this.money.text=s,this.itemName.text=n.name,this.itemName.textColor=ItemUtil.getQualityColor(n),n.zsLevel&&n.zsLevel>0?this.level.text="("+n.zsLevel+"转)":n.level&&n.level>0?this.level.text="(Lv."+n.level+")":this.level.text="",this.level.x=this.itemName.x+this.itemName.width,this.num.text=1==i.count?"":i.count+"",this.moneyIcon.source=e.moneyTypeToIcon[t.costType],this.itemIcon.setData(n),0!=ItemUtil.getJob(n)){var o=BagCT.ins().calculationScore(t.item);o>0?(this.arrowIcon.visible=!0,this.CEKey.visible=!0,this.CEValue.visible=!0,this.CEValue.text=o+""):(this.arrowIcon.visible=!1,this.CEKey.visible=!1,this.CEValue.visible=!1)}else this.arrowIcon.visible=!1,this.CEKey.visible=!1,this.CEValue.visible=!1;var a=ShopEquipData.discountDic[t.discountType];if(a)this.discount.source=a.res,this.wuzhe.visible=!1;else{var r=GlobalConfig.EquipItemConfig[this.goodsID];this.discount.source=r.discountImg,this.wuzhe.visible=!1}},e.prototype.showTip=function(){for(var t,e=Shop.ins().shopData,i=e.getShopEquipDataLength(),n=null,s=0;i>s;s++)if(n=e.getShopEquipDataByIndex(s),null!=n&&n.id==this.goodsID){t=n.item.configID;break}void 0==t&&new Error("竟然没有找到该商品ID");var o=GlobalConfig.ItemConfig[t],a=ItemUtil.getType(o);void 0!=a&&(0==a?ViewManager.ins().open(EquipDetailedWin,1,this.data.item.handle,o.id):ViewManager.ins().open(ItemDetailedWin,0,o.id,this.data.item.count))},e.moneyTypeToIcon=["占位","szjinbi","szyuanbao"],e}(BaseItemRender);__reflect(BlackMarketItemRenderer.prototype,"BlackMarketItemRenderer"),window.BlackMarketItemRenderer=BlackMarketItemRenderer;var BlackMarketPanel=function(t){function e(){var e=t.call(this)||this;return e.name="神秘商店",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.listView.itemRenderer=BlackMarketItemRenderer,this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.buyAllItemBtn,this.buyAllItem),this.addTouchEvent(this.refreshShopBtn,this.refreshShop),this.addTouchEvent(this.goodsOverView,this.onClick),this.observe(Shop.ins().postUpdateShopData,this.updateData),this.observe(Shop.ins().postBuyResult,this.buyResultCB),this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint),this.price.text=GlobalConfig.StoreCommonConfig.refreshYuanBao+"";var i=this.goodsOverView.text;this.goodsOverView.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+i),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stopAll(this)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.goodsOverView:ViewManager.ins().open(ShopBestTips)}},e.prototype.updateRedPoint=function(){this.redPoint.visible=ShopRedPoint.ins().blackMarketRedPoint},e.prototype.buyAllItem=function(t){for(var e=[],i=0,n=0,s=0,o=Shop.ins().shopData,a=o.getShopEquipDataLength(),r=null,l=0,h=0;a>h;h++)if(r=o.getShopEquipDataByIndex(h),null!=r){if(0==ItemUtil.getType(r.item.itemConfig)){if(l=BagCT.ins().calculationScore(r.item),!(l>0))continue;s+=1}e.push([r.id,1]),1==r.costType?i+=r.costNum:n+=r.costNum}if(BagCT.ins().getSurplusCount()<s){var u="背包已满，无法全部购买";return void TipsCT.ins().showTips(u)}return Actor.gold<i?void WarnCT.ins().setBuyGoodsWarn(1):Actor.yb<n?void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"):0==i&&0==n?void TipsCT.ins().showTips("|C:0xf3311e&T:没有物品可买！|"):void Shop.ins().sendBuy(2,e)},e.prototype.refreshShop=function(t){if(Shop.ins().shopData.times>GlobalConfig.StoreCommonConfig.refreshLimit)return void TipsCT.ins().showTips("|C:0xf3311e&T:今日刷新次数已用完！|");if(Shop.ins().shopData.refushTime<=0)Shop.ins().sendRefreshShop();else{var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem),i=e?e.count:0;if(i)Shop.ins().sendRefreshShop();else{if(Actor.yb<GlobalConfig.StoreCommonConfig.refreshYuanBao)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");Shop.ins().sendRefreshShop()}}},e.prototype.onTap=function(t){if("buy"==t.target.name){if(BagCT.ins().getSurplusCount()<=0){var e="背包已满，无法购买";return void TipsCT.ins().showTips(e)}var i=t.target.parent.goodsID,n=Shop.ins().shopData.getShopEquipDataById(i);if(Assert(n,"神秘商店找不到物品："+i))return;if(1==n.costType){if(Actor.gold<n.costNum)return void WarnCT.ins().setBuyGoodsWarn(1)}else if(Actor.yb<n.costNum)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");var s=n.item,o=ItemUtil.getJob(s.itemConfig),a=ItemUtil.getType(s.itemConfig);if(0==a&&0!=o){var r=BagCT.ins().calculationScore(s);if(r>0){var l=[i,1];Shop.ins().sendBuy(2,[l])}else WarnWin.show("购买失败\n\n<font color='#f3311e'>该装备评分过低无法购买</font>",function(){},this,null,null,"sure")}else{var l=[i,1];Shop.ins().sendBuy(2,[l])}}},e.prototype.buyResultCB=function(t){1==t?TipsCT.ins().showTips("购买成功"):TipsCT.ins().showTips("|C:0xf3311e&T:购买失败|"),this.updateOthersUI()},e.prototype.updateOthersUI=function(){var t=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.StoreCommonConfig.refreshItem),e=t?t.count:0,i="";i=e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.keylabel.textFlow=TextFlowMaker.generateTextFlow("<font color="+i+">"+e+"</font> "),Shop.ins().shopData.refushTime<=0?this.refreshShopBtn.label="免费刷新":this.refreshShopBtn.label="刷   新"},e.prototype.updateData=function(){for(var t=[],e=Shop.ins().shopData,i=e.getShopEquipDataLength(),n=null,s=0;i>s;s++)n=e.getShopEquipDataByIndex(s),null!=n&&t.push(n);this.listView.dataProvider=new eui.ArrayCollection(t),Timer.has(this.refushEndTime,this)||(Timer.start(1e3,Shop.ins().shopData.refushTime,this.refushEndTime,this),this.refushEndTime()),t.length<=0?this.noGoods.visible=!0:this.noGoods.visible=!1,this.point.text="我的积分："+Shop.ins().shopData.point,this.updateOthersUI(),this.updateRedPoint()},e.prototype.refushEndTime=function(){this.tip.text="下批商品刷新时间："+DateUtils.getFormatBySecond(Shop.ins().shopData.refushTime),this.tipsBg.visible=this.tip.visible=this.costGroup.visible=!0,Shop.ins().shopData.refushTime<=0&&(this.tipsBg.visible=this.tip.visible=this.costGroup.visible=!1)},e}(BaseView);__reflect(BlackMarketPanel.prototype,"BlackMarketPanel"),ViewManager.ins().reg(BlackMarketPanel,LayerManager.UI_Main),window.BlackMarketPanel=BlackMarketPanel;var BuySpecialWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BuySpecialSkin",this.num=3},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.add1Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.sub1Btn,this.onTap),this.addTouchEvent(this.sub10Btn,this.onTap),this.addTouchEvent(this.buyBtn,this.buy),this.addTouchEvent(this.bgClose,this.onTap),this.addChangeEvent(this.numLabel,this.inputOver),this.num=3,this.updateView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.add1Btn,this.onTap),this.removeTouchEvent(this.add10Btn,this.onTap),this.removeTouchEvent(this.sub1Btn,this.onTap),this.removeTouchEvent(this.sub10Btn,this.onTap),this.removeTouchEvent(this.buyBtn,this.buy),this.removeTouchEvent(this.bgClose,this.onTap),this.numLabel.removeEventListener(egret.Event.CHANGE,this.inputOver,this)},e.prototype.updateView=function(){this.numLabel.text=this.num+"",this.unitPrice.text=""+GlobalConfig.GuardGodWeaponConf.sSummonCost[0],this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this)}this.num<0&&(this.num=0),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.inputOver()},e.prototype.closeCB=function(t){ViewManager.ins().close(BuyWin)},e.prototype.buy=function(t){Actor.yb>=parseInt(this.allPrice.text)?(FbCT.ins().sendShSweep(parseInt(this.numLabel.text)),ViewManager.ins().close(this)):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.inputOver=function(t){this.num=parseInt(this.numLabel.text),(isNaN(this.num)||this.num<0)&&(this.num=0),this.num>3&&(this.num=3),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e}(BaseEuiView);__reflect(BuySpecialWin.prototype,"BuySpecialWin"),ViewManager.ins().reg(BuySpecialWin,LayerManager.UI_Popup),window.BuySpecialWin=BuySpecialWin;var BuyWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BuySkin",this.num=1,this.itemIcon.imgJob.visible=!1},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isIosTS?!1:!0},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),this.addTouchEvent(this.add1Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.sub1Btn,this.onTap),this.addTouchEvent(this.sub10Btn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.numLabel,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.addTouchEvent(this.buyBtn,this.buy),this.addChangeEvent(this.numLabel,this.inputOver),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.numLabel.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.num=1,this.shopID=t[0],e.goodsId=this.shopID,this.shopType=t[1]?t[1]:0,this.yuanbao0.visible=this.yuanbao1.visible=!0,2==this.shopType||3==this.shopType?(this.yuanbao0.visible=this.yuanbao1.visible=!1,this.num=this.getChipNumRule(),this.honor0.source=2==this.shopType?"ZSchip":"204076_png",this.honor1.source=2==this.shopType?"ZSchip":"204076_png"):4==this.shopType&&(this.yuanbao0.visible=this.yuanbao1.visible=!1,this.honor1.source=this.honor0.source=GlobalConfig.CrossDartCarStore[1].costItem.id+"_png"),this.honor0.visible=this.honor1.visible=!this.yuanbao0.visible,this.updateView()},e.prototype.updateInputText=function(t){this.numLabel.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.numLabel.text&&(this.numLabel.text="")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.numLabel.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.getChipNumRule=function(){var t=GlobalConfig.FeatsStore[this.shopID],e=0;if(t.shopType==FEATS_SHOP_TYPE.Money){if(Actor.chip<t.costMoney.count)return this.maxNum=1,this.maxNum;e=Math.floor(Actor.chip/t.costMoney.count)}else if(t.shopType==FEATS_SHOP_TYPE.Item){var i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.costItem.id);if(i<t.costItem.count)return this.maxNum=1,this.maxNum;e=Math.floor(i/t.costItem.count)}var n=0;if(!Shop.ins().medalData)return 0;var s=Shop.ins().medalData.exchangeCount[this.shopID];switch(s=s?s:0,t.buyType){case FEATS_TYPE.day:n=t.daycount-s,n=n>0?n:1,n=n>e?e:n;break;case FEATS_TYPE.infinite:n=e;break;case FEATS_TYPE.forever:n=t.daycount-s,n=n>0?n:1,n=n>e?e:n}return this.maxNum=n,this.maxNum},e.prototype.updateView=function(){var t,e;return 4==this.shopType?(t=GlobalConfig.CrossDartCarStore[this.shopID],e=GlobalConfig.ItemConfig[t.goods.id],this.itemIcon.setData(e),1==t.buyType||3==t.buyType||4==t.buyType?(this.maxNum=t.Maxcount-Shop.ins().getDartBuyNumById(t.index),this.itemName0.text="还可购买"+this.maxNum+"次",this.itemName0.visible=!0):(this.maxNum=Number.MAX_VALUE,this.itemName0.visible=!1),this.num>this.maxNum&&(this.num=this.maxNum),this.unitPrice.text=t.costItem.count+"",this.allPrice.text=this.num*t.costItem.count+"",this.numLabel.text=this.num+"",this.itemName.text=e.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(e)],this.used.text="",this.used.x=this.itemName.x+this.itemName.width,void(this.goodId=t.index)):2!=this.shopType&&3!=this.shopType?(t=GlobalConfig.ItemStoreConfig[this.shopID],e=GlobalConfig.ItemConfig[t.itemId],this.itemIcon.setData(e),t.vipLimit?(this.maxNum=t.vipLimit[Actor.vip]-Shop.ins().shopData.getHadBuyCount(t.itemId),this.itemName0.text="还可购买"+this.maxNum+"次",this.itemName0.visible=!0):(this.maxNum=Number.MAX_VALUE,this.itemName0.visible=!1),this.num>this.maxNum&&(this.num=this.maxNum),this.unitPrice.text=t.price+"",this.allPrice.text=this.num*t.price+"",this.numLabel.text=this.num+"",this.itemName.text=e.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(e)],this.used.text="（"+t.use+"）",void(this.used.x=this.itemName.x+this.itemName.width)):(this.itemName0.visible=!1,t=GlobalConfig.FeatsStore[this.shopID],e=GlobalConfig.ItemConfig[t.goods[0].id],this.itemIcon.setData(e),this.goodId=t.index,2==this.shopType?this.unitPrice.text=t.costMoney.count+"":3==this.shopType&&(this.unitPrice.text=t.costItem.count+""),this.allPrice.text=this.num*parseInt(this.unitPrice.text)+"",this.numLabel.text=this.num+"",this.itemName.text=e.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(e)],void(this.used.text="（"+t.use+"）"))},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sub10Btn:this.num-=10;break;case this.sub1Btn:this.num-=1;break;case this.add10Btn:this.num+=10;break;case this.add1Btn:this.num+=1;break;case this.bgClose:ViewManager.ins().close(this);break;case this.numLabel:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.numLabel.text||"")}this.num<1&&(this.num=1),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.inputOver()},e.prototype.closeCB=function(t){ViewManager.ins().close(e)},e.prototype.buy=function(t){if(2==this.shopType)Actor.chip>=parseInt(this.allPrice.text)?(Shop.ins().sendBuyMedal(this.goodId,this.num),ViewManager.ins().close(this)):TipsCT.ins().showTips("|C:0xf3311e&T:荣耀不足|");else if(3==this.shopType){var e=GlobalConfig.FeatsStore[this.shopID];BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.costItem.id)>=parseInt(this.allPrice.text)?(Shop.ins().sendBuyMedal(this.goodId,this.num),ViewManager.ins().close(this)):TipsCT.ins().showTips("|C:0xf3311e&T:巅峰令不足|")}else if(4==this.shopType){var i=GlobalConfig.CrossDartCarStore[this.shopID];BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.costItem.id)>=parseInt(this.allPrice.text)?(Shop.ins().sendBuyDart(this.goodId,this.num),ViewManager.ins().close(this)):TipsCT.ins().showTips("|C:0xf3311e&T:"+GlobalConfig.ItemConfig[i.costItem.id].name+"不足|")}else if(Actor.yb>=parseInt(this.allPrice.text)){var n=[this.shopID,this.num];Shop.ins().sendBuy(1,[n]),ViewManager.ins().close(this)}else TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.inputOver=function(t){this.num=parseInt(this.numLabel.text),(isNaN(this.num)||this.num<1)&&(this.num=1),this.num>9999&&(this.num=9999),this.num>this.maxNum&&(this.num=this.maxNum),this.numLabel.text=this.num+"",this.allPrice.text=this.num*parseInt(this.unitPrice.text)+""},e}(BaseEuiView);__reflect(BuyWin.prototype,"BuyWin"),window.BuyWin=BuyWin,ViewManager.ins().reg(BuyWin,LayerManager.UI_Popup);var HonorMarketPanel=function(t){function e(){var e=t.call(this)||this;return e.name="功勋商店",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=HonorMarketItemRenderer,this.dataArr=new eui.ArrayCollection,this.listView.dataProvider=this.dataArr},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.listView.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTap,this),this.addTouchEndEvent(this.get,this.onClick),this.observe(Shop.ins().postRefresMedalMessage,this.updateData),this.observe(Actor.ins().postFeatsChange,this.callback),this.observe(Shop.ins().postUpdateBuyMedal,this.callback),Shop.ins().sendMedalMessage()},e.prototype.callback=function(){Shop.ins().sendMedalMessage()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(){var t=[],e=GlobalConfig.FeatsStore;for(var i in e){var n=!0;if(e[i].buyType==FEATS_TYPE.forever)for(var s in Shop.ins().medalData.exchangeCount)if(e[i].index==Number(s)&&e[i].daycount){Shop.ins().medalData.exchangeCount[s]>=e[i].daycount&&(n=!1);break}n&&t.push(e[i])}this.dataArr.replaceAll(t),this.myAttrValue0.text=Actor.feats+"";var o=this.get.text;this.get.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+o)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.get:WarnCT.ins().setBuyGoodsWarn(7)}},e.prototype.onTap=function(t){},e}(BaseView);__reflect(HonorMarketPanel.prototype,"HonorMarketPanel"),ViewManager.ins().reg(HonorMarketPanel,LayerManager.UI_Main),window.HonorMarketPanel=HonorMarketPanel;var IntegrationItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShopPointItem",e.item=new ItemBase,e.item.x=21,e.item.y=8,e.item.isShowName(!1),e.addChild(e.item),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t.itemId];if(void 0!=e){this.goodsID=t.index,this.money.text=CommonUtils.overLength(t.price),this.integration.text=CommonUtils.overLength(t.integral),this.itemName.text=e.name,this.itemName.textColor=ItemUtil.getQualityColor(e),this.used.text="",this.used.x=this.itemName.x+this.itemName.width;var i=new RewardData;i.id=e.id,i.count=t.count,i.type=t.type,this.item.data=i}},e}(BaseItemRender);__reflect(IntegrationItemRenderer.prototype,"IntegrationItemRenderer"),window.IntegrationItemRenderer=IntegrationItemRenderer;var IntegrationPanel=function(t){function e(){var e=t.call(this)||this;return e.name="积分商店",e.skinName="ShopPointSkin",e.list.itemRenderer=IntegrationItemRenderer,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(Shop.ins().postRefreshIntegrationSucc,this.buyResultCB),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.buyResultCB=function(t,e){1==t[0]?TipsCT.ins().showTips("购买成功"):TipsCT.ins().showTips("|C:0xf3311e&T:购买失败|"),this.label1.text="我的积分："+CommonUtils.overLength(t[1])+"（在神秘商店购买商品或刷新获得）"},e.prototype.updateData=function(){var t=[],e=GlobalConfig.IntegralStore;for(var i in e)t.push(e[i]);this.list.dataProvider=new eui.ArrayCollection(t),this.label1.text="我的积分："+CommonUtils.overLength(Shop.ins().shopData.point)+"（在神秘商店购买商品或刷新获得）"},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID,i=GlobalConfig.IntegralStore,n=void 0;for(var s in i){var o=i[s];o.index==e&&(n=o)}if(1!=n.type&&BagCT.ins().getSurplusCount()<=0){var a="背包已满，无法购买";return void TipsCT.ins().showTips(a)}if(Actor.yb<n.price)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");if(Shop.ins().shopData.point<n.integral)return void TipsCT.ins().showTips("|C:0xf3311e&T:积分不足！|");Shop.ins().sendIntegrationShop(e)}},e}(BaseView);__reflect(IntegrationPanel.prototype,"IntegrationPanel"),window.IntegrationPanel=IntegrationPanel;var ItemShopPanel=function(t){function e(){var e=t.call(this)||this;return e.name="道具商城",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=ItemShopItemRenderer},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.observe(Shop.ins().postBuyCount,this.refreshList),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refreshList=function(){for(var t=this.listView.dataProvider.length,e=0;t>e;e++){var i=this.listView.dataProvider,n=i.getItemAt(e);i.itemUpdated(n)}},e.prototype.updateData=function(){var t=[],e=GlobalConfig.ItemStoreConfig;for(var i in e)e[i].notShow||t.push(e[i]);this.listView.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID;GlobalConfig.ItemStoreConfig[e];Shop.ins().shopData.checkBuyGoodsId(e)&&ViewManager.ins().open(BuyWin,e)}},e}(BaseView);__reflect(ItemShopPanel.prototype,"ItemShopPanel"),window.ItemShopPanel=ItemShopPanel;var MedalShopItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="FeatsShopItem",e.item=new ItemBase,e.item.x=21,e.item.y=8,e.item.isShowName(!1),e.addChild(e.item),e.btnGet&&(e.btnGet.name="buy"),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.goods[0],this.itemName.text=this.item.getText(),this.itemName.textColor=this.item.getTextColor(),this.labelPrice.text=""+t.costMoney.count,t.daycount?(this.labelTimes.visible=!0,this.labelTimes.text="今日已兑换"+t.exchangeCount+"/"+t.daycount):this.labelTimes.visible=!1},e}(BaseItemRender);__reflect(MedalShopItemRenderer.prototype,"MedalShopItemRenderer"),window.MedalShopItemRenderer=MedalShopItemRenderer;var MedalShopPanel=function(t){function e(){var e=t.call(this)||this;return e.coin=0,e.name="功勋商店",e.skinName="FeatsShopSkin",e.labelGetCoin.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+e.labelGetCoin.text+"</u></a>"),e.list.itemRenderer=MedalShopItemRenderer,e.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Shop.ins().sendMedalMessage(),this.observe(Shop.ins().postRefresMedalMessage,this.updataData),this.observe(Shop.ins().postUpdateBuyMedal,this.buyResult),this.addTouchEvent(this.list,this.onBuy),this.addTouchEvent(this.labelGetCoin,this.onGetCoin)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updataData=function(){var t=GlobalConfig.FeatsStore,e=Shop.ins().medalData;for(var i in t){var n=e.exchangeCount[t[i].index];isNaN(n)?t[i].exchangeCount=0:t[i].exchangeCount=n}this.setListData(t)},e.prototype.onBuy=function(t){if("buy"==t.target.name){var e=Actor.feats,i=t.target.parent,n=i.data;if(n.exchangeCount>=n.daycount&&0!=n.daycount){var s="今日可兑换次数用完，请明日再试";TipsCT.ins().showTips(s)}else if(n.costMoney.count>e){var s="功勋值不足，无法兑换物品";TipsCT.ins().showTips(s)}else Shop.ins().sendBuyMedal(n.index,1)}},e.prototype.buyResult=function(t){var e="成功兑换，消耗",i=0,n=GlobalConfig.FeatsStore;for(var s in n)n[s].index==t[0]&&(n[s].exchangeCount=t[1],i=n[s].costMoney.count);e=e+i+"功勋",TipsCT.ins().showTips(e),this.setListData(n)},e.prototype.setListData=function(t){var e=new eui.ArrayCollection;for(var i in t)e.addItem(t[i]);this.list.dataProvider=e;Actor.feats;this.labelCoin.text=Actor.feats.toString()},e.prototype.onGetCoin=function(t){ViewManager.ins().open(ShopGoodsWarn).setData(7,1)},e}(BaseView);__reflect(MedalShopPanel.prototype,"MedalShopPanel"),window.MedalShopPanel=MedalShopPanel;var NobleShopItemRender=function(t){function e(){var e=t.call(this)||this;return e.shopType=2,e.goodsID=0,e.skinName="NobleshoSkinItemShopItem",e.itemIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,e.showTip,e),e.itemIcon.imgJob.visible=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.ItemConfig[t.itemId];this.goodsID=t.index;var i="";i=t.price>1e5?Math.floor(t.price/1e4)+"万":t.price+"",this.money0.text=i,i=t.showYuanBao>1e5?Math.floor(t.showYuanBao/1e4)+"万":t.showYuanBao+"",this.money.text=i,this.itemName.text=e.name,this.itemName.textColor=ItemUtil.getQualityColor(e),this.used.text="（"+t.use+"）",this.used.x=this.itemName.x+this.itemName.width,this.itemIcon&&this.itemIcon.setData&&this.itemIcon.setData(e)}},e.prototype.showTip=function(){var t,e=GlobalConfig.IntegralStore;e[this.goodsID]&&(t=e[this.goodsID].itemId),void 0==t&&new Error("竟然没有找到该商品ID");var i=GlobalConfig.ItemConfig[t];ViewManager.ins().open(ItemDetailedWin,0,i.id,1)},e}(BaseItemRender);__reflect(NobleShopItemRender.prototype,"NobleShopItemRender"),window.NobleShopItemRender=NobleShopItemRender;var NobleShopPanel=function(t){function e(){var e=t.call(this)||this;return e.name="贵族商城",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.listView.itemRenderer=NobleShopItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]&&this.listView.addEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this),this.addTouchEvent(this,this.onTap),this.addTouchEvent(this.tipImg,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),this.removeTouchEvent(this.tipImg,this.onTap),this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this)},e.prototype.updateData=function(){var t=[],e=GlobalConfig.IntegralStore;for(var i in e)t.push(e[i]);this.listView.dataProvider=new eui.ArrayCollection(t)},e.prototype.onTap=function(t){if("buy"==t.target.name){var e=t.target.parent.goodsID,i=t.target.parent.shopType;Recharge.ins().getIsForeve()?ViewManager.ins().open(BuyWin,e,i):TipsCT.ins().showTips("没有激活贵族特权无法购买")}else t.currentTarget==this.tipImg&&ViewManager.ins().open(FuliWin,2)},e.prototype.scrollBottom=function(){this.listView.removeEventListener(egret.Event.ENTER_FRAME,this.scrollBottom,this),this.listView.scrollV=this.listView.contentHeight-this.listView.height},e}(BaseView);__reflect(NobleShopPanel.prototype,"NobleShopPanel"),window.NobleShopPanel=NobleShopPanel;var ShopBestTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="GoodsOverViewSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.shopList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick);var i=[];for(var n in GlobalConfig.TreasureOverViewConfig)i.push(GlobalConfig.TreasureOverViewConfig[n].itemId);this.shopList.dataProvider=new eui.ArrayCollection(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.onClick=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShopBestTips.prototype,"ShopBestTips"),ViewManager.ins().reg(ShopBestTips,LayerManager.UI_Popup),window.ShopBestTips=ShopBestTips;var ShopRedPoint=function(t){function e(){var e=t.call(this)||this;return e.shopRedPoint=!1,e.blackMarketRedPoint=!1,e.associated(e.postShopRedPoint,e.postBlackMarketRedPoint),e.associated(e.postBlackMarketRedPoint,Shop.ins().postUpdateShopData),e}return __extends(e,t),e.prototype.postShopRedPoint=function(){var t=this.shopRedPoint;return this.shopRedPoint=this.blackMarketRedPoint,this.shopRedPoint!=t},e.prototype.postBlackMarketRedPoint=function(){var t=this.blackMarketRedPoint;return this.blackMarketRedPoint=Shop.ins().shopData.refushTime<=0,this.blackMarketRedPoint!=t},__decorate([post()],e.prototype,"postShopRedPoint",null),__decorate([post()],e.prototype,"postBlackMarketRedPoint",null),e}(BaseSystem);__reflect(ShopRedPoint.prototype,"ShopRedPoint"),System.ShopRedPoint=function(){return ShopRedPoint.ins()},window.ShopRedPoint=ShopRedPoint;var ShopWin=function(t){function e(){var e=t.call(this)||this;return e.lastIndex=0,e.scrollBottom=!1,e.skinName="ShopSkin",e.isTopLevel=!0,e.addChangingEvent(e.tab,e.checkIsOpen),e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.checkIsOpen=function(t){if(3==t.target.selectedIndex){var e=GlobalConfig.IronStore[0];if(ZsCT.ins().lv<e.openzs||GameServer.serverOpenDay+1<e.openday)return TipsCT.ins().showTips("达到"+e.openzs+"转且开服"+e.openday+"天后开启"),t.$cancelable=!0,void t.preventDefault()}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.closeBtn0,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.observe(BagCT.ins().postItemAdd,this.buyToUse),this.observe(ShopRedPoint.ins().postBlackMarketRedPoint,this.updateRedPoint),this.observe(IronShopRedPoint.ins().postRedPoint,this.updateRedPoint),this.lastIndex=void 0==t[0]?this.lastIndex:t[0],t[1]&&(this.scrollBottom=t[1]),this.tab.selectedIndex=this.lastIndex,this.viewStack.selectedIndex=this.lastIndex,this.setOpenIndex(this.lastIndex),Shop.ins().postRefreshGoodsSuccess(!1),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.redPoint0.visible=ShopRedPoint.ins().blackMarketRedPoint,this.redPoint3.visible=IronShopRedPoint.ins().redPoint},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.viewStack.numChildren,n=0;i>n;n++)this.viewStack.getChildAt(n).close()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this)}},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.blackMarketPanel.open();break;case 1:this.itemShopPanel.open();break;case 2:this.weekMarketPanel.open();break;case 3:this.ironShopPanel.open()}this.lastIndex!=t?(this.viewStack.getElementAt(this.lastIndex).close(),this.lastIndex=t):this.tab.selectedIndex=this.viewStack.selectedIndex=t},e.prototype.buyToUse=function(){Shop.ins().shopBuyArr||(Shop.ins().shopBuyArr=[]);for(var t=0;t<Shop.ins().shopBuyArr.length;t++){var e=Shop.ins().shopBuyArr[t];
BagCT.ins().sendUseItem(e.id,e.count)}},e}(BaseEuiView);__reflect(ShopWin.prototype,"ShopWin"),ViewManager.ins().reg(ShopWin,LayerManager.UI_Main),window.ShopWin=ShopWin;var WeekMarketItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="WeekMarketItemSKin",e.itemIcon.imgJob.visible=!1,e.itemIcon.touchEnabled=!0,e.itemIcon.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data.goods){var t=this.data,e=GlobalConfig.ItemConfig[t.goods.id];this.eVip.text="",t.openvip>0&&(this.eVip.text=Actor.vip>=t.openvip?VipCT.getVipStr(t.openvip,!0)+"特权":VipCT.getVipStr(t.openvip,!0)+"以上可购买"),t.openmonthcard>0&&(this.eVip.text=Recharge.ins().monthDay>0?"月卡特权":"月卡用户可够买");var i=Math.max(0,t.Maxcount-Shop.ins().getWeekNumById(t.index));this.eNum.textFlow=TextFlowMaker.generateTextFlow("本周限购:|C:"+(i>0?ColorUtil.GREEN:ColorUtil.RED)+"&T:"+i+"|/"+t.Maxcount),this.itemIcon.setData(e),this.num.text=t.goods.count>1?t.goods.count+"":"",this.itemName.text=e.name,this.itemName.textColor=ItemUtil.getQualityColor(e),this.money.text=t.money+"",this.buyBtn.enabled=(!t.openvip||Actor.vip>=t.openvip)&&(!t.openmonthcard||Recharge.ins().monthDay>0),this.discountNum.text=t.discount+""}},e}(BaseItemRender);__reflect(WeekMarketItem.prototype,"WeekMarketItem"),window.WeekMarketItem=WeekMarketItem;var WeekMarketPanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.eList.itemRenderer=WeekMarketItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick),this.observe(Shop.ins().postWeekLimitDatas,this.refreshList),this.observe(Shop.ins().postWeekLimitData,this.refreshList),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.refreshList=function(){for(var t=this.eList.dataProvider.length,e=0;t>e;e++){var i=this.eList.dataProvider,n=i.getItemAt(e);i.itemUpdated(n)}},e.prototype.updateData=function(){var t=[],e=GlobalConfig.WeekLimitedStore;for(var i in e){var n=e[i];n.openday>0&&GameServer.serverOpenDay+1<n.openday||n.openlevel>0&&Actor.level<n.openlevel||n.openzs>0&&ZsCT.ins().lv<n.openzs||t.push(e[i])}this.eList.dataProvider=new eui.ArrayCollection(t)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent instanceof WeekMarketItem){var e=t.target.parent.data;Shop.ins().getWeekNumById(e.index)>=e.Maxcount?TipsCT.ins().showTips("无次数"):GlobalFun.checkMoney(e.money)&&Shop.ins().sendBuyWeekLimit(e.index,1)}else if(t.target instanceof ItemIcon&&t.target.parent instanceof WeekMarketItem){var e=t.target.parent.data;this.showTip(e.goods.id)}},e.prototype.showTip=function(t){var e=GlobalConfig.ItemConfig[t];ViewManager.ins().open(ItemDetailedWin,0,e.id,1)},__decorate([callLater],e.prototype,"refreshList",null),e}(BaseView);__reflect(WeekMarketPanel.prototype,"WeekMarketPanel"),window.WeekMarketPanel=WeekMarketPanel;var SkillBreachPanel=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.curIndex=0,e.skinName="SkillBreakSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t[0]&&(this.curIndex=t[0]),t[1]&&(this.curRole=t[1]),this.roleSelect.setCurRole(this.curRole),this.list.itemRenderer=SkillBreachskillItem,this.observe(SkillCT.ins().postTupo,this.refreshView),this.addTouchEndEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEndEvent(this.skillgrp,this.onSwitch),this.addTouchEndEvent(this.all,this.sendUpGrade),this.addTouchEvent(this.getmv,this.gotoHecheng),this.refreshView(null)},e.prototype.showEffect=function(){this.mv=new MovieClip,this.mv.playFile(RES_DIR_EFF+"BreachEff3",1),this.mvGrp.addChild(this.mv)},e.prototype.refreshView=function(t){t&&this.showEffect(),DisplayUtils.removeFromParent(this.getmv1),this.getmv1=null,SkillCT.ins().checkHechengRed()&&(this.getmv1=new MovieClip,this.getmv1.scaleX=.6,this.getmv1.scaleY=.5,this.getmv1.x=50,this.getmv1.y=30,this.getmv1.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.getmv.addChild(this.getmv1));for(var e=SubRoles.ins().getSubRoleByIndex(this.curRole),i=e.skillsData,n=0;5>n;n++){var s=this["skillItem"+(n+1)],o=i[n];o.tupoLevel?s.isActive.text=TextFlowMaker.getCStr(o.tupoLevel)+"阶":s.isActive.text="未突破",s.icon.source=o.icon,s.skillName.text=o.name,n==this.curIndex?(this.skill=o.id,this.setSelect(n,o.id,o.tupoLevel),s.select.visible=!0):s.select.visible=!1,s.red.visible=SkillCT.ins().singleTupoRed(this.curRole,n)}for(var a=SubRoles.ins().subRolesLen,n=0;a>n;n++)this.roleSelect.showRedPoint(n,SkillCT.ins().checkTupoRed(n))},e.prototype.setRoleId=function(t){this.curRole=t,this.refreshView(null)},e.prototype.setSelect=function(t,e,i){this.curIndex=t;var n,s=GlobalConfig.SkillBreakConfig[Math.floor(e/1e3)],o=[];for(var a in s){var r=s[a],l={desc:r.desc,level:r.level,cost:r.cost,skill:r.skill,item:r.item,isActive:r.level<=i};r.level<=i+1&&(n=l),o.push(l)}var h=BagCT.ins().getBagGoodsCountById(0,n.item),u=GlobalConfig.ItemConfig[n.item];this.costTool=u,this.cost=n.cost,this.have=h,this.curData=n,n.level==i?(this.countLabel0.visible=!1,this.all.enabled=!1,this.icon0.visible=!1,this.expendLabel0.visible=!1,this.listData=new eui.ArrayCollection(o),this.list.dataProvider=this.listData):(this.have>=this.cost?this.countLabel0.textColor=65280:this.countLabel0.textColor=16711680,this.countLabel0.text=h+"/"+n.cost,this.countLabel0.visible=!0,this.all.enabled=!0,this.icon0.visible=!0,this.icon0.source=u.icon+"_png",this.expendLabel0.visible=!0,this.listData=new eui.ArrayCollection(o),this.list.dataProvider=this.listData),0>=i?this.tupoLv.text="当前未突破":this.tupoLv.text="突破"+TextFlowMaker.getCStr(i)+"阶"},e.prototype.onSwitch=function(t){switch(t.target.parent){case this.skillItem1:this.curIndex=0;break;case this.skillItem2:this.curIndex=1;break;case this.skillItem3:this.curIndex=2;break;case this.skillItem4:this.curIndex=3;break;case this.skillItem5:this.curIndex=4}this.refreshView(null)},e.prototype.sendUpGrade=function(){if(this.cost>this.have)return void TipsCT.ins().showTips(this.costTool.name+"不足");var t=Math.floor(this.skill/1e3);SkillCT.ins().sendTupo(this.curRole,t)},e.prototype.gotoHecheng=function(){ViewManager.ins().open(SkillComposePanel,this)},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.onClick=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];ViewManager.ins().isShow(RuneBookWin)&&ViewManager.ins().close(RuneBookWin)},e}(BaseEuiView);__reflect(SkillBreachPanel.prototype,"SkillBreachPanel"),ViewManager.ins().reg(SkillBreachPanel,LayerManager.UI_Main),window.SkillBreachPanel=SkillBreachPanel;var SkillBreachskillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillBreachskill",e}return __extends(e,t),e.prototype.dataChanged=function(){this.lv.text=TextFlowMaker.getCStr(this.data.level),this.desc.text=this.data.desc,this.maskRect.visible=!this.data.isActive},e}(BaseItemRender);__reflect(SkillBreachskillItem.prototype,"SkillBreachskillItem"),window.SkillBreachskillItem=SkillBreachskillItem;var SkillComposePanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillComposeSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.breachPanel=t[0];for(var i in GlobalConfig.SkillMergeConfig)if(GlobalConfig.SkillMergeConfig[i]){this.itemData=GlobalConfig.SkillMergeConfig[i];break}this.addTouchEndEvent(this.bgClose,this.otherClose),this.addTouchEndEvent(this.smeltBtn,this.sendToCompose),this.observe(BagCT.ins().postMergeItemBack,this.refreshView),this.upDateView(this.itemData)},e.prototype.refreshView=function(t){var e=GlobalConfig.ItemConfig[t[0].id];this.icon0.source=e.icon+"_png",this.name1.text=e.name+"",this.upDateView(this.itemData)},e.prototype.upDateView=function(t){var e=t,i=GlobalConfig.ItemConfig[e.itemid];this.icon.source=i.icon+"_png",this.name0.text=i.name;var n=e.cost,s=BagCT.ins().getBagGoodsCountById(0,e.itemid);this.cost=n,this.have=s,n>s?this.count.textColor=16711680:this.count.textColor=65280,this.count.text=s+"/"+n},e.prototype.otherClose=function(t){this.breachPanel.refreshView(null),ViewManager.ins().close(e)},e.prototype.sendToCompose=function(){if(this.cost>this.have)return void TipsCT.ins().showTips("材料不足");var t=new MovieClip;t.x+=29,t.y+=29,t.playFile(RES_DIR_EFF+"UpEff1",1),this.eff.addChild(t),BagCT.ins().sendMergeItem(this.itemData.itemid,this.itemData.cost)},e}(BaseEuiView);__reflect(SkillComposePanel.prototype,"SkillComposePanel"),ViewManager.ins().reg(SkillComposePanel,LayerManager.UI_Popup),window.SkillComposePanel=SkillComposePanel;var SkillGodwapenItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillGodwapenIcon",e}return __extends(e,t),e.prototype.dataChanged=function(){this.icon.source=this.data.icon+"_png",this.maskbg.visible=!SkillTipsgodwapenView.checkIsOpen(this.data)},e}(BaseItemRender);__reflect(SkillGodwapenItem.prototype,"SkillGodwapenItem"),window.SkillGodwapenItem=SkillGodwapenItem;var SkillBreakConfig=function(){function t(){}return t}();__reflect(SkillBreakConfig.prototype,"SkillBreakConfig"),window.SkillBreakConfig=SkillBreakConfig;var SkillBreakOpenConfig=function(){function t(){}return t}();__reflect(SkillBreakOpenConfig.prototype,"SkillBreakOpenConfig"),window.SkillBreakOpenConfig=SkillBreakOpenConfig;var SkillData=function(){function t(t){this._specialCD=0,this._tupoLevel=0,this.configID=t}return Object.defineProperty(t.prototype,"lv",{get:function(){return this._id%1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"job",{get:function(){return Math.floor(this._id%1e5/1e4)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return 1e3*Math.floor(this._id/1e3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"icon",{get:function(){return this.id+"_png"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"configID",{get:function(){return this._id},set:function(t){this._id=t,this.config=GlobalConfig.SkillsConfig[t],this._preId=0/0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preId",{get:function(){return this._preId},set:function(t){this._preId=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tupoLevel",{get:function(){return this._tupoLevel},set:function(t){this._tupoLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lv1ConfigID",{get:function(){return this.id+1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castType",{get:function(){return isNaN(this.config.castType)?2:this.config.castType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targetType",{get:function(){return isNaN(this.config.targetType)?2:this.config.targetType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){var t=this.config||GlobalConfig.SkillsConfig[this.lv1ConfigID];return SkillUtil.getDesc(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"affectRange",{get:function(){return isNaN(this.config.affectRange)?1:this.config.affectRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"affectCount",{get:function(){return isNaN(this.config.affectCount)?1:this.config.affectCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"calcType",{get:function(){return isNaN(this.config.calcType)?1:this.config.calcType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"herdMonRate",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?isNaN(t.herdMonRate)?100:t.herdMonRate:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"herdPlayerRate",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?isNaN(t.herdPlayerRate)?10:t.herdPlayerRate:10},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cd",{get:function(){if(this._specialCD)return this._specialCD;var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.cd:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"specialCD",{set:function(t){this._specialCD=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPassive",{get:function(){return!!this.config.passive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rate",{get:function(){return this.config.passive&&this.config.passive.rate||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cond",{get:function(){return this.config.passive&&this.config.passive.cond||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"castRange",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.castRange:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"repelDistance",{get:function(){return this.config.repelDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"teleport",{get:function(){return this.config.teleport},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actionType",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.actionType:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tarEff",{get:function(){return this.config.tarEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otarEff",{get:function(){return this.config.otarEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfEff",{get:function(){return this.config.selfEff},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canUse",{get:function(){return this.config&&!!this.lv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"args",{get:function(){return this.config.args},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wordEff",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.wordEff:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effType",{get:function(){return this.config.effType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherSkills",{get:function(){return this.config.otherSkills},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectId",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.effectId:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sound",{get:function(){var t=GlobalConfig.SkillsDescConfig[this.descID];return t?t.sound:""},enumerable:!0,configurable:!0}),t.getSkillByJob=function(e,i,n){return void 0===i&&(i=1),void 0===n&&(n=1),new t(1e4*e+1e3*i+n)},Object.defineProperty(t.prototype,"descID",{get:function(){var t=GlobalConfig.SkillsConfig[this.configID]||GlobalConfig.SkillsConfig[this.lv1ConfigID];return t?t.desc:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLianJi",{get:function(){return 7==this.calcType},enumerable:!0,configurable:!0}),t}();__reflect(SkillData.prototype,"SkillData"),window.SkillData=SkillData;var SkillimbaIcon=function(){function t(){}return t}();__reflect(SkillimbaIcon.prototype,"SkillimbaIcon"),window.SkillimbaIcon=SkillimbaIcon;var SkillMergeConfig=function(){function t(){}return t}();__reflect(SkillMergeConfig.prototype,"SkillMergeConfig"),window.SkillMergeConfig=SkillMergeConfig;var MijiItemEx=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiWithNameItemSkin",e.init(),e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){this.miji.data=this.data;var t=GlobalConfig.MiJiSkillConfig[this.data],e=GlobalConfig.ItemConfig[t.item];this.nameTF.text=e.name}},e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){var t=GlobalConfig.MiJiSkillConfig[this.data];ViewManager.ins().open(PropGainTipsWin,0,t.item)},e}(BaseItemRender);__reflect(MijiItemEx.prototype,"MijiItemEx"),window.MijiItemEx=MijiItemEx;var MijiLookItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiOverViewItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data)if("string"==typeof this.data)this.currentState="title","middle"==this.data?this.name1.text="中级印记":this.name1.text="高级印记";else if("object"==typeof this.data&&this.data.length){this.currentState="miji";for(var t=5,e=0;t>e;e++){var i=this.data[e];if(this["item"+e]&&i){this["item"+e].visible=!0,this["item"+e].data=i.id;var n=GlobalConfig.ItemConfig[i.item];this.name1.text=n.name}else this["item"+e].visible=!1}}},e}(BaseItemRender);__reflect(MijiLookItem.prototype,"MijiLookItem"),window.MijiLookItem=MijiLookItem;var MijiLookWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiOverViewSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.list.itemRenderer=MijiLookItem;var i=[],n=[],s=[],o=[];for(var a in GlobalConfig.MiJiSkillConfig){var r=GlobalConfig.MiJiSkillConfig[a],l=GlobalConfig.ItemConfig[r.item];3==ItemUtil.getQuality(l)?(i.length||i.push("middle"),s.length<5?s.push(r):(i.push(s),s=[],s.push(r))):(n.length||n.push("high"),o.length<5?o.push(r):(n.push(o),o=[],o.push(r)))}s.length&&i.push(s),o.length&&n.push(o);var h=i.concat(n);this.list.dataProvider=new eui.ArrayCollection(h)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onTap)},e.prototype.setData=function(){},e}(BaseEuiView);__reflect(MijiLookWin.prototype,"MijiLookWin"),ViewManager.ins().reg(MijiLookWin,LayerManager.UI_Main),window.MijiLookWin=MijiLookWin;var SkillTipsgodwapenView=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillTipsgodwapen",e}return __extends(e,t),Object.defineProperty(e.prototype,"isOpen",{set:function(t){t?(this.activeLabel.text="(已激活)",this.activeLabel.textColor=16711680):(this.activeLabel.text="(未激活)",this.activeLabel.textColor=4670789)},enumerable:!0,configurable:!0}),e.checkIsOpen=function(t){var i,n=t.active[0];switch(n){case e.GodWeapon:i=GodWeaponCC.ins().checkSkillOpen(t.active[1],t.active[2]);break;case e.Imba:i=Artifact.ins().getNewArtifactBy(t.active[1]).open}return i},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.addTouchEndEvent(this.bgClose,this.otherClose);var n=t[0];this.nameLabel.text=n.name,this.skillProp.text=n.desc,this.gainLb.text=n.gain,this.isOpen=e.checkIsOpen(n)},e.prototype.otherClose=function(t){ViewManager.ins().close(e)},e.GodWeapon=1,e.Imba=0,e}(BaseEuiView);__reflect(SkillTipsgodwapenView.prototype,"SkillTipsgodwapenView"),ViewManager.ins().reg(SkillTipsgodwapenView,LayerManager.UI_Popup),window.SkillTipsgodwapenView=SkillTipsgodwapenView;var SkillWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZsSkin",e.isTopLevel=!0,e.lastIndex=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.help,this.onTap),this.addChangingEvent(this.tab,this.onTabTouching),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEvent(this.tab,this.onClick)},e.prototype.removeDisplay=function(){var t=ViewManager.ins().getView(UIView2);t&&t.closeNav(UIView2.NAV_SKILL)},e.prototype.addDisplay=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.observe(BagCT.ins().postItemAdd,this.updateRedPoint),this.observe(BagCT.ins().postItemDel,this.updateRedPoint),this.observe(BagCT.ins().postItemChange,this.updateRedPoint),this.observe(NeiGong.ins().postNeiGongDataChange,this.updateRedPoint),this.observe(Actor.ins().postGoldChange,this.updateRedPoint),this.observe(Actor.ins().postLevelChange,this.updateRedPoint),this.observe(SkillCT.ins().postSkillUpgradeAll,this.updateRedPoint),this.observe(MijiCT.ins().postBagUseMiji,this.onBagUseMiji),this.observe(ZhanLing.ins().postZhanLingComposeItem,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingInfo,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingUpExp,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingDrug,this.updateRedPoint),this.observe(ZhanLing.ins().postZhanLingWear,this.updateRedPoint),this.observe(ZhanLingRedPoint.ins().postRedPoint,this.updateRedPoint),this.observe(PunchAwakeRedPoint.ins().postRedPoint,this.updateRedPoint),this.checkPage();var n=t[0]||e.Panel_JINENG,s=t[1]||0;this.viewStack.selectedIndex=this.tab.selectedIndex=n,this.roleSelect.setCurRole(s),this.setOpenIndex(n),this.tab.validateNow()},e.prototype.onClick=function(t){2==t.currentTarget.selectedIndex&&PunchAwakeCT.ins().isActive&&(ViewManager.ins().open(PunchAwakeMainWin),ViewManager.ins().close(this))},e.prototype.checkPage=function(){ZhanLingModel.ins().ZhanLingOpen()?this.zhanlingPanel.parent||this.viewStack.addChild(this.zhanlingPanel):this.zhanlingPanel.parent&&this.viewStack.removeChild(this.zhanlingPanel)},e.prototype.onTabTouch=function(t){this.setOpenIndex(t.currentTarget.selectedIndex)},e.prototype.onTabTouching=function(t){return e.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.setOpenIndex=function(t){switch(this.roleSelect.openRole(),this.help.visible=!1,t){case e.Panel_JINENG:this.skillTitle.source="biaoti_jineng";break;case e.Panel_LIANJI:var i=GlobalConfig.LianJiSysConf;GameServer.serverOpenDay+1>=i.peiyangNeedOpenDay&&ZsCT.ins().lv>=i.peiyangNeedZsLevel?this.skillTitle.source="biaoti_yuanshen":this.skillTitle.source="biaoti_lianji",this.roleSelect.hideRole();break;case e.Panel_FUWEN:this.roleSelect.hideRole(),this.skillTitle.source="biaoti_heji";break;case e.Panel_MIJI:this.help.visible=!0;var n=MijiCT.ZsLv;ZsCT.ins().lv<n?(TipsCT.ins().showTips(n+"转开启"),t=this.tab.selectedIndex=this.viewStack.selectedIndex=this.lastIndex):this.skillTitle.source="biaoti_miji";break;case e.Panel_ZHANLING:ZhanLingModel.ins().ZhanLingOpen()?(this.help.visible=!0,this.roleSelect.hideRole(),this.skillTitle.source="biaoti_zhanling"):TipsCT.ins().showTips("开服第"+GlobalConfig.ZhanLingConfig.openserverday+"天并达到"+GlobalConfig.ZhanLingConfig.openzhuanshenglv+"转开启");break;case e.Panel_JINGMAI:this.skillTitle.source="biaoti_jingmai"}this.lastIndex!=t?this.lastIndex=t:this.tab.selectedIndex=this.viewStack.selectedIndex=t,this.updateRedPoint()},e.checkIsOpen=function(t){switch(t){case e.Panel_JINENG:break;case e.Panel_LIANJI:if(1e3*ZsCT.ins().lv+Actor.level<GlobalConfig.LianJiSysConf.openSysLimit)return TipsCT.ins().showTips("连击"+YuanshenPanel.lv2zs(GlobalConfig.LianJiSysConf.openSysLimit).lvStr+"级开启"),!1;break;case e.Panel_FUWEN:if(!SkillCT.ins().checkHejiOpen())return TipsCT.ins().showTips("激活神器 火龙之心 后开启"),!1;break;case e.Panel_MIJI:var i=MijiCT.ZsLv;if(ZsCT.ins().lv<i)return TipsCT.ins().showTips(i+"转开启"),!1;break;case e.Panel_ZHANLING:if(!ZhanLingModel.ins().ZhanLingOpen())return TipsCT.ins().showTips("开服第"+GlobalConfig.ZhanLingConfig.openserverday+"天并达到"+GlobalConfig.ZhanLingConfig.openzhuanshenglv+"转开启"),!1;break;case e.Panel_JINGMAI:var n=GlobalConfig.JingMaiCommonConfig.openLevel;if(Actor.level<n)return TipsCT.ins().showTips(n+"级开启"),!1}return!0},e.prototype.updateRedPoint=function(){Timer.has(this.updateRed,this)||Timer.start(100,1,this.updateRed,this)},e.prototype.onBagUseMiji=function(t){for(var e=SubRoles.ins().subRolesLen,i=0;e>i;i++)if(!MijiCT.ins().hasEquipMiji(t,i)){this.roleSelect.setCurRole(i),this.setRoleId(i);break}this.mijiPanel.onBagUseMiji(t)},e.prototype.updateRed=function(){var t=SkillCT.ins().canHejiEquip()||SkillCT.ins().canExchange()||SkillCT.ins().canSolve()||SkillCT.ins().canAcitve();this.tab.getChildAt(e.Panel_JINENG).eRp.visible=this.and(SkillCT.ins().canGrewupSkill())||SkillCT.ins().checkAllTupo()||SkillCT.ins().checkHechengRed();var i=this.jingMaiCanUp();this.tab.getChildAt(e.Panel_JINGMAI).eRp.visible=i.some(function(t,e,i){return t}),this.tab.getChildAt(e.Panel_FUWEN).eRp.visible=t||SkillCT.ins().getPunchForge().getRedPoint()||PunchAwakeRedPoint.ins().postRedPoint(),this.tab.getChildAt(e.Panel_MIJI).eRp.visible=MijiCT.ins().isMjiSum(),this.tab.numChildren>e.Panel_ZHANLING&&this.tab.getChildAt(e.Panel_ZHANLING)&&(this.tab.getChildAt(e.Panel_ZHANLING).eRp.visible=ZhanLing.ins().checkRedPoint());var n=SubRoles.ins().subRolesLen;this.roleSelect.clearRedPoint();for(var s=0;n>s;s++){var o=void 0;this.tab.selectedIndex==e.Panel_JINENG?o=SkillCT.ins().canGrewupAllSkills(s):this.tab.selectedIndex==e.Panel_NEIGONG?o=NeiGongModel.ins().canUpById(s):this.tab.selectedIndex==e.Panel_FUWEN||(this.tab.selectedIndex==e.Panel_MIJI?o=MijiCT.ins().isMjiSum():this.tab.selectedIndex==e.Panel_JINGMAI&&(o=i.some(function(t,e,i){return t}))),this.roleSelect.showRedPoint(s,o||SkillCT.ins().checkTupoRed(s))}},e.prototype.jingMaiCanUp=function(){var t,e=[!1,!1,!1];for(var i in SubRoles.ins().roles)if(t=SubRoles.ins().roles[i].jingMaiData,t.jingMaiCanUp()){var n=GlobalConfig.JingMaiCommonConfig.openLevel;Actor.level>=n&&(e[i]=!0)}return e},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.setRoleId=function(t){t!=this.skillPanel.curRole&&(this.mijiPanel.curRole=this.skillPanel.curRole=this.jingMaiPanel.curRole=t,this.setOpenIndex(this.viewStack.selectedIndex))},e.prototype.and=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];if(1==n)return!0}return!1},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.help:this.viewStack.selectedIndex==e.Panel_ZHANLING?ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text):this.viewStack.selectedIndex==e.Panel_MIJI&&ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[43].text)}},e.openCheck=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t[0]||e.Panel_JINENG;return e.checkIsOpen(n)},e.Panel_JINENG=0,e.Panel_NEIGONG=999,e.Panel_LIANJI=999,e.Panel_JINGMAI=1,e.Panel_FUWEN=2,e.Panel_MIJI=3,e.Panel_ZHANLING=4,e}(BaseEuiView);__reflect(SkillWin.prototype,"SkillWin"),ViewManager.ins().reg(SkillWin,LayerManager.UI_Main),window.SkillWin=SkillWin;var SoulSuitCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Equip,e.regNetMsg(15,e.postSoulSuitUpdate),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postSoulSuitUpdate=function(t){var e=t.readShort(),i=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e);if(n){var s=n.soulSuitData[i];s.parser(t)}},e.prototype.sendSoulSuitWear=function(t,e,i){var n=this.getBytes(15);n.writeDouble(t),n.writeShort(i),n.writeShort(e),this.sendToServer(n)},e.prototype.sendSoulSuitForge=function(t,e,i){var n=this.getBytes(16);n.writeShort(t),n.writeShort(e),n.writeInt(i),this.sendToServer(n)},e.prototype.sendSoulSuitExchange=function(t){var e=this.getBytes(17);e.writeInt(t),this.sendToServer(e)},e.prototype.sendSoulSuitBreak=function(t){var e=this.getBytes(18);e.writeDouble(t),this.sendToServer(e)},e.prototype.getSoulSuitLevel=function(t){var e=SubRoles.ins().getSubRoleByIndex(t);if(!e)return[0,0,0];for(var i=[],n=0;n<e.soulSuitData.length;n++){var s=e.soulSuitData[n];s.itemConfig?i.push(GlobalConfig.SoulSuitAttrConf[s.itemConfig.id].level):i.push(0)}return i.sort(this.sort),[i[2],i[4],i[7]]},e.prototype.sort=function(t,e){return e>t?1:t>e?-1:0},e.prototype.getSoulSuitSurplus=function(){for(var t=[],e=SubRoles.ins().getSubRoleByIndex(0),i=e&&e.soulSuitData&&e.soulSuitData.length?e.soulSuitData.length:0,n=0;i>n;n++){for(var s=n,o=BagCT.ins().getSoulSuitsByPos(s),a=0,r=0;3>r;r++){var l=SubRoles.ins().getSubRoleByIndex(r);l&&l.soulSuitData[s].itemConfig||a++}if(0==a)t=t.concat(o);else if(a<o.length)for(var h=a;h<o.length;h++)t.push(o[h])}return t},e.prototype.getExtAttrStr=function(t){var e="";if(!t)return e;for(var i=t.extAtt,n=0;n<i.length;n++)if(i[n].value&&1e3!=i[n].type){e+=AttributeData.getExtAttrStrByType(i[n].type)+": ";var s=i[n].value;(67==i[n].type||68==i[n].type||69==i[n].type||70==i[n].type||71==i[n].type||72==i[n].type)&&(e+=s/100,e+="%"),e+="\n"}return e},__decorate([post()],e.prototype,"postSoulSuitUpdate",null),e}(BaseSystem);__reflect(SoulSuitCT.prototype,"SoulSuitCT"),window.SoulSuitCT=SoulSuitCT;var SoulSuitRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.roleTabs=[],e.itemPoints=[],e.forgePoints=[],e.breakPoint=!1,e.associated(e.postRedPoint,e.postRoleRedPoint,e.postBreakPoint),e.associated(e.postBreakPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,SoulSuitCT.ins().postSoulSuitUpdate,Actor.init),e.associated(e.postRoleRedPoint,GameLogic.ins().postSubRoleChange,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,SoulSuitCT.ins().postSoulSuitUpdate,Actor.init),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=this.breakPoint;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.itemForgePoints(t);this.roleTabs[t]=this.itemRedPoint(t)||i}else this.roleTabs[t]=!1}return!0},e.prototype.itemRedPoint=function(t){var e=[];this.itemPoints[t]=[];var i=!1,n=SubRoles.ins().getSubRoleByIndex(t);if(!n)return!1;for(var s=n.soulSuitData.length,o=0;s>o;o++){var a=o;e=BagCT.ins().getSoulSuitsByPos(a);var r=n.soulSuitData[o];if(r.itemConfig){this.itemPoints[t][a]=!1;var l=GlobalConfig.SoulSuitAttrConf[r.itemConfig.id].level;this.itemPoints[t][a]=!1;for(var h in e){var u=GlobalConfig.SoulSuitAttrConf[e[h].itemConfig.id].level;if(u>l){this.itemPoints[t][a]=!0,i=!0;break}}}else e.length>0?(this.itemPoints[t][a]=!0,i=!0):this.itemPoints[t][a]=!1}return i},e.prototype.postBreakPoint=function(){var t=this.breakPoint,e=SoulSuitCT.ins().getSoulSuitSurplus();return this.breakPoint=e&&e.length>0,t!=this.breakPoint},e.prototype.itemForgePoints=function(t){this.forgePoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i)return!1;for(var n=i.soulSuitData.length,s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item1),o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item2),a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item3),r=0;n>r;r++){var l=r,h=i.soulSuitData[r];if(h.itemConfig){var u=GlobalConfig.SoulSuitAttrConf[h.itemConfig.id].level,p=(GlobalConfig.SoulSuitLevelConf[u],GlobalConfig.SoulSuitLevelConf[u+1]);p?p.item1[0]>0&&s>=p.item1[0]?(this.forgePoints[t][l]=!0,e=!0):p.item2[0]>0&&o>=p.item2[0]?(this.forgePoints[t][l]=!0,e=!0):p.item3[0]>0&&a>=p.item3[0]?(this.forgePoints[t][l]=!0,e=!0):this.forgePoints[t][l]=!1:this.forgePoints[t][l]=!1}else this.forgePoints[t][l]=!1}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),__decorate([post()],e.prototype,"postBreakPoint",null),e}(BaseSystem);__reflect(SoulSuitRedPoint.prototype,"SoulSuitRedPoint"),System.SoulSuitRedPoint=function(){return SoulSuitRedPoint.ins()},window.SoulSuitRedPoint=SoulSuitRedPoint;var EquipExchangeBtn=function(t){function e(){var e=t.call(this)||this;
return e.skinName="PunchExchangeBtnSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.btnText.text=this.data.name},e}(eui.ItemRenderer);__reflect(EquipExchangeBtn.prototype,"EquipExchangeBtn"),window.EquipExchangeBtn=EquipExchangeBtn;var EquipExchangeItem=function(t){function e(){var e=t.call(this)||this;return e.count=0,e.exchangeNum=0,e.skinName="PunchExchangeItemSkin",e.itemIcon0.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onClick,e),e.goBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GlobalConfig.ItemConfig[this.data];if(t){this.itemConfig=t,this.itemIcon0.setData(t),this.nameLab.text=t.name;var e=t.input[0];this.exchangeNum=e.count,this.count=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e.id);var i=this.count<e.count?"#F3311E":"#35E62D";this.descLab.textFlow=(new egret.HtmlTextParser).parser("<font color = '"+i+"'>"+this.count+"</font><font color = '#9F946D'>/"+this.exchangeNum+"</font>"),this.icon.source=GlobalConfig.ItemConfig[e.id].icon+"_png"}},e.prototype.onTap=function(t){return this.count<this.exchangeNum?void TipsCT.ins().showTips("|C:0x35e62d&T:材料数量不足|"):BagCT.ins().getSurplusCount()<1?void TipsCT.ins().showTips("背包已满"):void SoulSuitCT.ins().sendSoulSuitExchange(this.itemConfig.id)},e.prototype.onClick=function(){if(this.itemConfig)switch(ItemUtil.getType(this.itemConfig)){case ItemType.TYPE_28:var t=new ItemData;t.configID=this.itemConfig.id,ViewManager.ins().open(SoulSuitEquipTipWin,t,0,!1);break;default:TipsCT.ins().showTips("没有找到道具类型提示页")}},e}(eui.ItemRenderer);__reflect(EquipExchangeItem.prototype,"EquipExchangeItem"),window.EquipExchangeItem=EquipExchangeItem;var EquipExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentSelect=0,e._sn_="PunchExchangeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.equiplist,this.onListChange)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemIds=t[0],DisplayUtils.removeFromParent(this.goturn),this.exchangelist.itemRenderer=EquipExchangeItem,this.equiplist.itemRenderer=EquipExchangeBtn,this.eGroup2.visible=!0,this.initMenu(),this.observe(BagCT.ins().postItemDel,this.onListChange),this.observe(BagCT.ins().postItemCountChange,this.onListChange),this.equiplist.selectedIndex=this.currentSelect,this.refushInfo()},e.prototype.initMenu=function(){this.menuArr=[],this.exchangeArr=[];for(var t=[],e=0;e<this.itemIds.length;e++){var i=GlobalConfig.ItemConfig[this.itemIds[e]],n=GlobalConfig.ItemDescConfig[i.descIndex];i.input&&(t[n.quality]||(t[n.quality]=[]),t[n.quality].push(this.itemIds[e]))}var s=[];for(var e in t)!t[e]||t[e].length<=0||s.push(t[e]);s.sort(this.itemIdSort);var o="";ItemUtil.getType(GlobalConfig.ItemConfig[this.itemIds[0]])==ItemType.TYPE_28&&(o="阶");for(var e in s){var a=s[e],r=GlobalConfig.SoulSuitAttrConf[a[0]].level;this.menuArr.push({name:r+o}),this.exchangeArr.push(a)}},e.prototype.onListChange=function(t){this.currentSelect=this.equiplist.selectedIndex,this.refushInfo()},e.prototype.itemIdSort=function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0},e.prototype.refushInfo=function(){this.eItem1.source=GlobalConfig.ItemConfig[GlobalConfig.SoulSuitBaseConf.item1].icon+"_png",this.suipian1.text=""+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item1),this.eItem.source=GlobalConfig.ItemConfig[GlobalConfig.SoulSuitBaseConf.item2].icon+"_png",this.suipian.text=""+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item2),this.eItem2.source=GlobalConfig.ItemConfig[GlobalConfig.SoulSuitBaseConf.item3].icon+"_png",this.suipian2.text=""+BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item3),this.equiplist.dataProvider=new eui.ArrayCollection(this.menuArr);var t=this.exchangeArr[this.currentSelect];this.exchangelist.dataProvider=new eui.ArrayCollection(t)},__decorate([callLater],e.prototype,"onListChange",null),e}(BaseEuiView);__reflect(EquipExchangeWin.prototype,"EquipExchangeWin"),ViewManager.ins().reg(EquipExchangeWin,LayerManager.UI_Main),window.EquipExchangeWin=EquipExchangeWin;var SoulSoutSkillTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cfg=[],e._sn_="YuanshenSkillTipSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.skillId=t[0],this.topLv=t[1],this.curRoleId=t[2],this.initCfg(),this.addTouchEvent(this.bgClose,this.onClick),this.updateView()},e.prototype.initCfg=function(){var t=GlobalConfig.SoulSuitBaseConf;this.cfg[1]={icon:t.icon1,name:t.name1,desc:t.desc1,num:3},this.cfg[2]={icon:t.icon2,name:t.name2,desc:t.desc2,num:5},this.cfg[3]={icon:t.icon3,name:t.name3,desc:t.desc3,num:8}},e.prototype.updateView=function(){var t=this.cfg[this.skillId];if(t){this.skill0.source=t.icon,this.skillName.text=t.name,0==this.topLv&&this.topLv++,this.curskillDescTitle.text="穿戴"+this.topLv+"阶"+t.num+"件魂装激活套装效果";var e=GlobalConfig.SoulSuitSuitConf[this.topLv][t.num];if(this.curskillDescDetail.textFlow=TextFlowMaker.generateTextFlow("当前技能效果："+t.desc.replace("$d$",e.ex_attrs[0].value/100+"%")),GlobalConfig.SoulSuitSuitConf[this.topLv+1]){this.curskillDescTitle1.visible=this.curskillDescL1.visible=this.curskillDescDetail1.visible=!0;var i=GlobalConfig.SoulSuitSuitConf[this.topLv+1][t.num];this.curskillDescDetail1.textFlow=TextFlowMaker.generateTextFlow("下阶技能效果："+t.desc.replace("$d$",i.ex_attrs[0].value/100+"%")),this.curskillDescTitle1.text="穿戴"+(this.topLv+1)+"阶"+t.num+"件魂装激活套装效果"}else this.curskillDescTitle1.visible=this.curskillDescL1.visible=this.curskillDescDetail1.visible=!1;var n=SubRoles.ins().getSubRoleByIndex(this.curRoleId),s=[],o=[];for(var a in n.soulSuitData){var r=n.soulSuitData[a],l=r.itemConfig?GlobalConfig.SoulSuitAttrConf[r.itemConfig.id].level:0;s.push(l>=this.topLv?"0x04FE2A":"0xB1B097"),o.push(l>=this.topLv+1?"0x04FE2A":"0xB1B097")}var h="【 |C:"+s[0]+"&T:武器|  |C:"+s[1]+"&T:头盔|  |C:"+s[2]+"&T:衣服|  |C:"+s[3]+"&T:项链|  |C:"+s[4]+"&T:手镯|  |C:"+s[5]+"&T:腰带|  |C:"+s[6]+"&T:戒指|  |C:"+s[7]+"&T:鞋子| 】";if(this.curskillDescL.textFlow=TextFlowMaker.generateTextFlow(h),this.curskillDescL1.visible){var u="【 |C:"+o[0]+"&T:武器|  |C:"+o[1]+"&T:头盔|  |C:"+o[2]+"&T:衣服|  |C:"+o[3]+"&T:项链|  |C:"+o[4]+"&T:手镯|  |C:"+o[5]+"&T:腰带|  |C:"+o[6]+"&T:戒指|  |C:"+o[7]+"&T:鞋子| 】";this.curskillDescL1.textFlow=TextFlowMaker.generateTextFlow(u)}}},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(SoulSoutSkillTipWin.prototype,"SoulSoutSkillTipWin"),ViewManager.ins().reg(SoulSoutSkillTipWin,LayerManager.UI_Popup),window.SoulSoutSkillTipWin=SoulSoutSkillTipWin;var SoulSuitEquipTipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curRole=0,e.showBtn=!0,e._sn_="YuanshenEquipTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.barbc=new ProgressBarEff,this.barbc.setWidth(this.eBar.width),this.eBar.addChild(this.barbc)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];if(i.type&&(i=i.id),"[object Number]"==toString.apply(i)){var n=new ItemData;n.init(),n.configID=i;var s=GlobalConfig.SoulSuitAttrConf[i],o=new AttributeData(s.attr_type,s.attr_value);n.extAtt.length=0,n.extAtt.push(o),this.item=n}else this.item=i;this.curRole=t[1],this.showBtn=t[2],this.forgeBtn.visible=this.changeBtn.visible=this.showBtn,this.addTouchEndEvent(this.bgClose,this.onClick),this.addTouchEndEvent(this.forgeBtn,this.onClick),this.addTouchEndEvent(this.changeBtn,this.onClick),this.updateView()},e.prototype.onClick=function(t){var e=this.item.itemConfig;switch(ViewManager.ins().close(this),t.target){case this.bgClose:break;case this.forgeBtn:if(!this.item)return;ViewManager.ins().open(SoulSuitForgeWin,ItemUtil.getSubType(e),this.curRole);break;case this.changeBtn:if(!this.item)return;ViewManager.ins().open(RoleChooseEquipWin,this.curRole,ItemUtil.getSubType(e),ItemUtil.getType(e))}},e.prototype.updateView=function(){if(this.item){var t=this.item.itemConfig;this.nameLabel.text=t.name,this.nameLabel.textColor=ItemUtil.getQualityColor(t),this.score.text="评分："+this.item.point,this.type.text=ThunderCT.equipNames[ItemUtil.getSubType(t)],this.itemIcon.setData(t),this.career.text="通用",this.attrs.text=AttributeData.getAttrInfoByItemData(this.item);var e=this.item.extAtt;this.barbc.setMaxValue(GlobalConfig.SoulSuitLevelConf[GlobalConfig.SoulSuitAttrConf[this.item.itemConfig.id].level].blessMax);var i=0;for(var n in this.item.extAtt)1e3==this.item.extAtt[n].type&&(i=this.item.extAtt[n].value);this.barbc.setValue(i);for(var s="",n=0;n<e.length;n++)if(e[n].value&&1e3!=e[n].type){s+=AttributeData.getExtAttrStrByType(e[n].type)+": ";var o=e[n].value;(67==e[n].type||68==e[n].type||69==e[n].type||70==e[n].type||71==e[n].type||72==e[n].type)&&(s+=o/100,s+="%"),s+="\n"}this.spiritGroup.visible=""!=s,this.exAttrs.text=s,this.redPoint0.visible=this.forgeBtn.visible&&SoulSuitRedPoint.ins().forgePoints[this.curRole][ItemUtil.getSubType(t)],this.redPoint2.visible=this.changeBtn.visible&&SoulSuitRedPoint.ins().itemPoints[this.curRole][ItemUtil.getSubType(this.item.itemConfig)]}},e}(BaseEuiView);__reflect(SoulSuitEquipTipWin.prototype,"SoulSuitEquipTipWin"),ViewManager.ins().reg(SoulSuitEquipTipWin,LayerManager.UI_Popup),window.SoulSuitEquipTipWin=SoulSuitEquipTipWin;var SoulSuitEquipWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currRoleId=0,e.soulSuitLVs=[0,0,0],e._sn_="YuanshenEquipSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.SoulSuitBaseConf.openDay,n=GlobalConfig.SoulSuitBaseConf.yuanshenLevel;return GameServer.serverOpenDay+1<i?(TipsCT.ins().showTips("开服"+i+"天后开启"),!1):YuanshenData.ins().isEnough(n)?!0:(TipsCT.ins().showTips("元神达到"+YuanshenData.getName(n)+"阶开启，距离"+YuanshenData.getName(n)+"阶还差"+(n-YuanshenData.ins().yuanShenLv)+"阶"),!1)},e.prototype.skinComplete=function(){this.itemMCs=[],this.itemGroups=[this.eItem0,this.eItem1,this.eItem2,this.eItem3,this.eItem4,this.eItem5,this.eItem6,this.eItem7],this.redPoints=[this.redPoint0,this.redPoint1,this.redPoint2,this.redPoint3,this.redPoint4,this.redPoint5,this.redPoint6,this.redPoint7],this.addTouchEvent(this.skill1,this.onClick),this.addTouchEvent(this.skill2,this.onClick),this.addTouchEvent(this.skill3,this.onClick),this.addChangeEvent(this.roleSelect,this.switchRole),this.addTouchEvent(this.fenjieBtn,this.onClick),this.addTouchEvent(this.punchtogether1,this.onClick);var t=EquipPos.WEAPON;for(var e in this.itemGroups)this.addTouchEvent(this.itemGroups[e],this.onItemClick),this.itemGroups[e].name=t+"",t++},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(SoulSuitCT.ins().postSoulSuitUpdate,this.updateView),this.observe(SoulSuitRedPoint.ins().postBreakPoint,this.updateRedpoint),this.observe(SoulSuitRedPoint.ins().postRoleRedPoint,this.updateRedpoint),this.roleSelect.setCurRole(t&&t[0]?t[0]:0),this.currRoleId=this.roleSelect.getCurRole(),this.punchtogether1.visible=!1,this.updateView()},e.prototype.updateRedpoint=function(){for(var t=this.redPoints.length,e=0;t>e;e++)this.redPoints[e].visible=SoulSuitRedPoint.ins().itemPoints[this.currRoleId][e]||SoulSuitRedPoint.ins().forgePoints[this.currRoleId][e];this.redPointF.visible=SoulSuitRedPoint.ins().breakPoint,t=SubRoles.ins().subRolesLen;for(var e=0;t>e;e++)this.roleSelect.showRedPoint(e,SoulSuitRedPoint.ins().roleTabs[e])},e.prototype.switchRole=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.updateSkill=function(){var t=GlobalConfig.SoulSuitBaseConf;this.skill1.source=t.icon1,this.skill2.source=t.icon2,this.skill3.source=t.icon3,this.soulSuitLVs=SoulSuitCT.ins().getSoulSuitLevel(this.currRoleId),this.blackImg1.visible=0==this.soulSuitLVs[0],this.blackImg2.visible=0==this.soulSuitLVs[1],this.blackImg3.visible=0==this.soulSuitLVs[2]},e.prototype.onClick=function(t){switch(t.target){case this.fenjieBtn:ViewManager.ins().open(BreakDownView,BreakDownView.type_soulSuit,ItemType.TYPE_28);break;case this.punchtogether1:var e=[];for(var i in GlobalConfig.SoulSuitAttrConf)e.push(GlobalConfig.SoulSuitAttrConf[i].id);ViewManager.ins().open(EquipExchangeWin,e);break;case this.skill1:ViewManager.ins().open(SoulSoutSkillTipWin,1,this.soulSuitLVs[0],this.currRoleId);break;case this.skill2:ViewManager.ins().open(SoulSoutSkillTipWin,2,this.soulSuitLVs[1],this.currRoleId);break;case this.skill3:ViewManager.ins().open(SoulSoutSkillTipWin,3,this.soulSuitLVs[2],this.currRoleId)}},e.prototype.onItemClick=function(t){var e=SubRoles.ins().getSubRoleByIndex(this.currRoleId);if(e&&null!=t.target.name&&""!=t.target.name){var i=parseInt(t.target.name),n=e.soulSuitData[i];if(n.itemConfig)ViewManager.ins().open(SoulSuitEquipTipWin,n,this.currRoleId,!0);else{var s=BagCT.ins().getSoulSuitsByPos(i);s.length>0&&SoulSuitCT.ins().sendSoulSuitWear(s[0].handle,i,this.currRoleId)}}},e.prototype.setRoleId=function(t){this.currRoleId=t,this.updateView()},e.prototype.updateView=function(){this.updateSkill(),this.updateRedpoint();var t=SubRoles.ins().getSubRoleByIndex(this.currRoleId);if(t){var e=0;for(var i in this.itemGroups){var n=this.itemGroups[i],s=parseInt(n.name),o=t.soulSuitData[s],a=this.itemMCs[s];o.itemConfig?(a||(a=new MovieClip,a.x=n.width/2,a.y=n.height/2,n.addChild(a),this.itemMCs[s]=a),e+=o.point,a.playFile(RES_DIR_EFF+("ys_"+s+"_"+GlobalConfig.SoulSuitAttrConf[o.itemConfig.id].level),-1)):a&&(a.stop(),DisplayUtils.removeFromParent(a),this.itemMCs[s]=null)}this.powerPanel.setPower(e)}},__decorate([callLater],e.prototype,"updateRedpoint",null),__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(SoulSuitEquipWin.prototype,"SoulSuitEquipWin"),ViewManager.ins().reg(SoulSuitEquipWin,LayerManager.UI_Main),window.SoulSuitEquipWin=SoulSuitEquipWin;var SoulSuitForgeWin=function(t){function e(){var e=t.call(this)||this;return e.selcet=0,e.curRole=0,e._sn_="YuanshenForge",e.isTopLevel=!0,e.nextItem=new ItemData,e.nextItem.init(),e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.pos=t[0],this.curRole=t[1],this.addTouchEvent(this.boostBtn,this.onClick),this.addTouchEvent(this.checkBoxs0,this.onClick),this.addTouchEvent(this.checkBoxs1,this.onClick),this.addTouchEvent(this.checkBoxs2,this.onClick),this.addTouchEvent(this.itemIconCost,this.onClick),this.addTouchEvent(this.itemIconNext,this.onClick),this.observe(SoulSuitCT.ins().postSoulSuitUpdate,this.updateView),this.updateView(),this.itemIconNext.touchEnabled=!0,this.itemIconNext.touchChildren=!1,this.itemIconCost.touchEnabled=!0,this.itemIconCost.touchChildren=!1},e.prototype.skinComplete=function(){this.barbc=new ProgressBarEff,this.barbc.setWidth(this.eBar.width),this.eBar.addChild(this.barbc)},e.prototype.updateSelcet=function(){this.checkBoxs0.selected=this.checkBoxs1.selected=this.checkBoxs2.selected=!1;var t=SubRoles.ins().getSubRoleByIndex(this.curRole),e=t.soulSuitData[this.pos],i=GlobalConfig.SoulSuitAttrConf[e.itemConfig.id].level,n=GlobalConfig.SoulSuitLevelConf[i+1];if(n){switch(this.selcet){case 0:this.checkBoxs0.selected=!0,this.materialId=GlobalConfig.SoulSuitBaseConf.item1,this.rate=n&&n.item1?n.item1[1]:0,this.isEnough=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item1)>=n.item1[0];break;case 1:this.checkBoxs1.selected=!0,this.materialId=GlobalConfig.SoulSuitBaseConf.item2,this.rate=n&&n.item2?n.item2[1]:0,this.isEnough=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item2)>=n.item2[0];break;case 2:this.checkBoxs2.selected=!0,this.materialId=GlobalConfig.SoulSuitBaseConf.item3,this.rate=n&&n.item3?n.item3[1]:0,this.isEnough=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item3)>=n.item3[0]}this.eSuccessRate.text="当前直接升阶概率:"+this.rate+"%"}},e.prototype.updateView=function(){var t=SubRoles.ins().getSubRoleByIndex(this.curRole);this.item=t.soulSuitData[this.pos],this.itemIconCost.setData(this.item.itemConfig),this.costName.text=this.item.itemConfig.name,this.costName.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(this.item.itemConfig)],this.attr3.text=AttributeData.getAttrInfoByItemData(this.item),this.exattr0.text=SoulSuitCT.ins().getExtAttrStr(this.item),this.powerPanel3.setPower(this.item.point);var e=GlobalConfig.SoulSuitAttrConf[this.item.itemConfig.id].level,i=GlobalConfig.SoulSuitLevelConf[e+1];this.updateSelcet();var n=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item1),s=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item2),o=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.SoulSuitBaseConf.item3);if(this.nextItemCfg=GlobalConfig.ItemConfig[this.item.itemConfig.id+1],!this.nextItemCfg||ItemUtil.getSubType(this.nextItemCfg)!=ItemUtil.getSubType(this.item.itemConfig))return this.eFullLab.visible=!0,this.eGroup.visible=!1,this.itemIconNext.visible=this.nextName.visible=this.attr0.visible=this.powerPanel4.visible=this.eSuccessRate.visible=this.arrow.visible=this.arrow1.visible=this.exattr1.visible=this.boostBtn.visible=!1,this.eLeftItem.horizontalCenter="0",void(this.attrGroup3.horizontalCenter="0");var a=n>i.item1[0]?ColorUtil.GREEN:ColorUtil.RED,r="|C:"+a+"&T:"+n+"|/"+i.item1[0];this.eCheckLab0.textFlow=TextFlowMaker.generateTextFlow(r),a=s>i.item2[0]?ColorUtil.GREEN:ColorUtil.RED,r="|C:"+a+"&T:"+s+"|/"+i.item2[0],this.eCheckLab1.textFlow=TextFlowMaker.generateTextFlow(r),a=o>i.item3[0]?ColorUtil.GREEN:ColorUtil.RED,r="|C:"+a+"&T:"+o+"|/"+i.item3[0],this.eCheckLab2.textFlow=TextFlowMaker.generateTextFlow(r),this.eFullLab.visible=!1,this.boostBtn.visible=!0,this.barbc.visible=!0,this.attr0.visible=!0,this.barbc.setMaxValue(i.blessMax);var l=0;for(var h in this.item.extAtt)1e3==this.item.extAtt[h].type&&(l=this.item.extAtt[h].value);this.barbc.setValue(l),this.nextItem.configID=this.nextItemCfg.id;var u=GlobalConfig.SoulSuitAttrConf[this.nextItemCfg.id],p=new AttributeData(u.attr_type,u.attr_value);this.nextItem.extAtt.length=0,this.nextItem.extAtt.push(p),this.attr0.text=AttributeData.getAttrInfoByItemData(this.nextItem),this.exattr1.text=SoulSuitCT.ins().getExtAttrStr(this.nextItem),this.exattr1.visible=!0,this.itemIconNext.setData(this.nextItemCfg),this.nextName.text=this.nextItemCfg.name,this.nextName.textColor=ItemBase.QUALITY_COLOR[ItemUtil.getQuality(this.nextItemCfg)],this.powerPanel4.setPower(this.nextItem.point)},e.prototype.onClick=function(t){switch(t.target){case this.boostBtn:return void(0==this.rate?this.materialId==GlobalConfig.SoulSuitBaseConf.item1?TipsCT.ins().showTips("不能使用低级材料"):TipsCT.ins().showTips("不能使用中级材料"):this.isEnough?SoulSuitCT.ins().sendSoulSuitForge(this.curRole,this.pos,this.materialId):TipsCT.ins().showTips("材料不足"));case this.itemIconCost:return void ViewManager.ins().open(SoulSuitEquipTipWin,this.item,0,!1);case this.itemIconNext:return void ViewManager.ins().open(SoulSuitEquipTipWin,this.nextItem,0,!1);case this.checkBoxs0:this.selcet=0;break;case this.checkBoxs1:this.selcet=1;break;case this.checkBoxs2:this.selcet=2}egret.callLater(this.updateSelcet,this)},__decorate([callLater],e.prototype,"updateView",null),e}(BaseEuiView);__reflect(SoulSuitForgeWin.prototype,"SoulSuitForgeWin"),ViewManager.ins().reg(SoulSuitForgeWin,LayerManager.UI_Main),window.SoulSuitForgeWin=SoulSuitForgeWin;var PlatformSound=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.play=function(t,e){void 0===e&&(e=!1);var i=this.getSoundIAC();e&&this.effCache[t]||i&&(i.src=getUrl(RES_RESOURCE+"/"+RES.getResourceInfo(t).url),i.loop=e,this.effCache[t]=i,this.url2url[i.src]=t,i.play())},e.stop=function(t){var e=this.effCache[t];e&&(e.stop(),this.back(e),delete this.url2url[e.src]),delete this.effCache[t]},e.back=function(t){this.soundIACPool.indexOf(t)<=-1&&this.soundIACPool.push(t),delete this.effCache[this.url2url[t.src]],delete this.url2url[t.src]},e.getSoundIAC=function(){var t;return this.soundIACPool.length>0?t=this.soundIACPool.pop():(t=window.platform.createInnerAudioContext(),t.onStop(function(){e.back(t)}),t.onEnded(function(){e.back(t)})),t},e.stopAll=function(){for(var t in this.effCache)this.stop(t)},e.soundIACPool=[],e.effCache={},e.url2url={},e}(BaseSystem);__reflect(PlatformSound.prototype,"PlatformSound"),window.PlatformSound=PlatformSound;var SoundEnum;!function(t){t.RUN="longlin_a_pd_mp3",t.WINDOW="longlin_a_dkjm_mp3",t.TASK="longlin_b_renwu_mp3",t.LEVEL_UP="longlin_b_shengji_mp3",t.SCENE="longlin_a_zyz_mp3",t.EQUIP="longlin_a_chuandai_mp3",t.CREATE_ROLE="longlin_a_chuangjue_mp3",t.FORGE="longlin_a_qianghua_mp3",t.SMELT="longlin_b_ronglian_mp3",t.SKILL_UP="longlin_b_jineng_mp3"}(SoundEnum||(SoundEnum={})),window.SoundEnum=SoundEnum;var SoundUtil=function(){function t(){}return Object.defineProperty(t,"enable",{get:function(){return this._enable},set:function(t){this._enable=t,t?this.bgSound&&(this.bgSC=this.bgSound.play(0,0)):this.stopAll()},enumerable:!0,configurable:!0}),t.play=function(t,e){return void 0===e&&(e=1),__awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(s){switch(s.label){case 0:return this._enable?window&&window.platform&&window.platform.createInnerAudioContext&&urlParam.isMiniGame?(PlatformSound.play(t,0>=e),[2]):[4,RES.getResAsync(t)]:[2];case 1:return(i=s.sent())?0>=e&&null!=this.effCache[t]?[2]:(i.type=egret.Sound.EFFECT,n=i.play(0,e),this.effCache[t]=n,this.url2url[n.$url]=t,n.once(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),[2]):[2]}})})},t.playBg=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this._enable?(e=this,[4,RES.getResAsync(t)]):[2];case 1:return e.bgSound=i.sent(),this.bgSound?(this.bgSound.type=egret.Sound.MUSIC,this.bgSC&&this.bgSC.stop(),this.bgSC=this.bgSound.play(0,0),[2]):[2]}})})},t.stop=function(t){if(window&&window.platform&&window.platform.createInnerAudioContext&&urlParam.isMiniGame)return void PlatformSound.stop(t);var e=this.effCache[t];e&&(e.stop(),delete this.url2url[e.$url]),delete this.effCache[t]},t.stopAll=function(){if(window&&window.platform&&window.platform.createInnerAudioContext&&urlParam.isMiniGame)return void PlatformSound.stopAll();this.bgSC&&this.bgSC.stop();for(var t in this.effCache)this.stop(t)},t.onSoundComplete=function(t){delete this.effCache[this.url2url[t.currentTarget.$url]],delete this.url2url[t.currentTarget.$url]},t.WINDOW_OPEN=!1,t._enable=!0,t.effCache={},t.url2url={},t}();__reflect(SoundUtil.prototype,"SoundUtil"),window.SoundUtil=SoundUtil;var FireRingRedPoint=function(t){function e(){var e=t.call(this)||this;return e.changePoint=!1,e.associated(e.postChangeRedPoint,SpecialRing.ins().postSkillInfo,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postChangeRedPoint=function(){var t=this.changePoint;if(this.changePoint=!1,SpecialRing.ins().hasMaxSkill()){var e=GlobalConfig.ExRingBookExchangeConfig;for(var i in e)BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,e[i].consume.id)>=e[i].consume.count&&(this.changePoint=!0)}return t!=this.changePoint},__decorate([post()],e.prototype,"postChangeRedPoint",null),e}(BaseSystem);__reflect(FireRingRedPoint.prototype,"FireRingRedPoint"),System.FireRingRedPoint=function(){return FireRingRedPoint.ins()},window.FireRingRedPoint=FireRingRedPoint;var LyMark=function(t){function e(){var e=t.call(this)||this;return e._lyMarkLv=0,e._lyMarkExp=0,e._isMax=!1,e.sysId=PackageID.LyMark,e.regNetMsg(1,e.postMarkData),e.regNetMsg(2,e.postUpgrade),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"lyMarkLv",{get:function(){return this._lyMarkLv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lyMarkExp",{get:function(){return this._lyMarkExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skills",{get:function(){return this._skills},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMax",{get:function(){return this._isMax},enumerable:!0,configurable:!0}),e.prototype.getSkillLvById=function(t){return!this._skills||this._skills.length<t?0:this._skills[t-1]},e.prototype.postMarkData=function(t){this._lyMarkLv=t.readShort(),this._lyMarkExp=t.readInt();var e=t.readByte();this._skills=[],this._skills.length=e;for(var i=0;e>i;i++)this._skills[i]=t.readShort();this._isMax=this._lyMarkLv>=Object.keys(GlobalConfig.FlameStampLevel).length},e.prototype.postUpgrade=function(t){var e=t.readByte();return[e]},e.prototype.sendUpgrade=function(){this.sendBaseProto(2)},e.prototype.sendUpSkill=function(t){var e=this.getBytes(3);e.writeByte(t),this.sendToServer(e)},e.prototype.sendCompound=function(t){var e=this.getBytes(4);e.writeInt(t),this.sendToServer(e)},e.prototype.checkOpen=function(){if(!SpecialRing.ins().isFireRingActivate())return!1;var t=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID);return!t||t.level<GlobalConfig.FlameStamp.openLevel?!1:!0},e.prototype.checkRed=function(){if(!this.checkOpen())return!1;if(!this.lyMarkLv)return!1;if(!this.isMax){var t=GlobalConfig.FlameStampLevel[this.lyMarkLv];if(Assert(t,"LyMark lv:"+this.lyMarkLv+", exp:"+this.lyMarkExp))return!1;var e=BagCT.ins().getBagItemById(t.costItem),i=e?e.count:0,n=t.exp-this._lyMarkExp;if(i>=t.costCount&&i*GlobalConfig.FlameStampMat[t.costItem].exp>=n)return!0}for(var s,o,a=0;6>=a;a++)if(0!=a){o=this.getSkillLvById(a+1);var r=o>=Object.keys(GlobalConfig.FlameStampEffect[a+1]).length;if(!r&&(s=GlobalConfig.FlameStampEffect[a+1][0>=o?1:o+1],s.costItem)){var e=BagCT.ins().getBagItemById(s.costItem),i=e?e.count:0;if(i>=s.costCount&&this.lyMarkLv>=s.stampLevel)return!0}}return this.checkMixRed()},e.prototype.checkMixRed=function(){var t,e,i;for(var n in GlobalConfig.FlameStampMat)if(e=GlobalConfig.FlameStampMat[n],i=0,e.costItem&&(t=BagCT.ins().getBagItemById(e.costItem),i=t?t.count:0),e.costItem&&this.lyMarkLv>=e.limitLv&&i>=e.costCount)return!0;return!1},e.prototype.getCurSkillID=function(){for(var t,e,i=0,n=0,s=0;6>=s;s++)n=t=this.getSkillLvById(s+1),t||(t=1),e=GlobalConfig.FlameStampEffect[s+1][t],s+1!=1&&s+1!=2||!n||(i=e.skillId);return i},e.prototype.getCurSkillCD=function(){var t=this.getCurSkillID(),e=this.getSkillLvById(3),i=e?GlobalConfig.FlameStampEffect[3][e].reloadTime:0;return SkillUtil.getCD(GlobalConfig.SkillsConfig[t])-i},__decorate([post()],e.prototype,"postMarkData",null),__decorate([post()],e.prototype,"postUpgrade",null),e}(BaseSystem);__reflect(LyMark.prototype,"LyMark"),System.LyMark=function(){return LyMark.ins()},window.LyMark=LyMark;var SpecialRing=function(t){function e(){var e=t.call(this)||this;return e.mainHandler=[],e.ringList=[],e.loginDayCount=0,e.ringActiNum=0,e.specialRingHandler=[],e.ringsConfig=[],e.moneyOpenGrid=0,e.abilityIds=[],e.skillLvDic={},e.sysId=PackageID.Ring,e.regNetMsg(1,e.postRingUpdate),e.regNetMsg(2,e.postActiveRing),e.regNetMsg(3,e.postSpicelRingUpdate),e.regNetMsg(4,e.postGetSpicelRingInfo),e.regNetMsg(5,e.postSRStairUp),e.regNetMsg(6,e.postSRStairUp),e.regNetMsg(7,e.postUnLock),e.regNetMsg(8,e.postSkillInfo),e.regNetMsg(9,e.postRingAbility),e.observe(GameLogic.ins().postEnterMap,e.delayCreateRingAvatar),e}return __extends(e,t),e.prototype.delayCreateRingAvatar=function(){Timer.start(1e3,1,this.createRingAvatar,this)},e.prototype.postRingAbility=function(t){for(var i=t.readShort(),n=0;i>n;n++){var s=t.readShort(),o=t.readShort();this.abilityIds[s]=o}if(0==GameMap.fbType){var a=this.getSpecialRingDataById(e.FIRE_RING_ID);if(a){var r=this.getRingStair(a.level);r>=2&&(this.specialRingHandler[e.FIRE_RING_ID]>0&&EntityManager.ins().removeByHandle(this.specialRingHandler[e.FIRE_RING_ID]),this.createRingMonster(e.FIRE_RING_ID))}}var l=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var s in l)if(l[s][1]){var h=BagCT.ins().getBagItemById(l[s][1].itemId);h&&h.setCanbeUsed()}BagCT.ins().postHasItemCanUse()},e.prototype.createRingAvatar=function(){if(0==GameMap.fbType){var t=this.getSpecialRingDataById(e.FIRE_RING_ID);if(t){var i=this.getRingStair(t.level);i>=2&&this.createRingMonster(e.FIRE_RING_ID)}}},e.prototype.sendUpGrade=function(t,e){var i=this.getBytes(1);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.postRingUpdate=function(t){var e=t.readShort(),i=t.readShort(),n=t.readShort();return SubRoles.ins().getSubRoleByIndex(i).setExRingsData(e,n),!0},e.prototype.sendActiveRing=function(t,e){void 0===e&&(e=0);var i=this.getBytes(2);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendChangeFRSkill=function(t){var e=this.getBytes(11);e.writeByte(t),this.sendToServer(e)},e.prototype.postActiveRing=function(t){var i=t.readShort(),n=t.readShort(),s=t.readInt(),o=t.readByte(),a=this.getSpecialRingDataById(i);return a.level=n,a.exp=s,a.fight=o,this.ringActiNum++,i==e.FIRE_RING_ID&&this.updateGrid(),[i,0]},e.prototype.postSRStairUp=function(t){var e=t.readShort(),i=t.readShort(),n=t.readInt(),s=t.readByte(),o=this.getSpecialRingDataById(e);return o.level=i,o.exp=n,o.fight=s,this.createRingAvatar(),this.updateGrid(),[e,0]},e.prototype.sendSpicelRingUpdate=function(t){var e=this.getBytes(3);e.writeShort(t),this.sendToServer(e)},e.prototype.postSpicelRingUpdate=function(t){var e=t.readShort(),i=t.readShort(),n=t.readInt(),s=this.getSpecialRingDataById(e),o=0;o=t.readByte();var a=t.readByte();return s.level=i,s.exp=n,s.fight=a,[e,o]},e.prototype.postGetSpicelRingInfo=function(t){this.loginDayCount=t.readInt();var e=t.readShort();this.ringList=[],this.ringActiNum=0;for(var i=0;e>i;i++){var n=new SpecialRingData;n.parser(t),this.ringList.push(n),n.level>0&&this.ringActiNum++}return 0==GameMap.fbType&&GameLogic.ins().postHookStateChange(GameLogic.HOOK_STATE_FIND_ENMENY),this.createRingAvatar(),!0},e.prototype.isFireRing=function(t){return this.specialRingHandler[e.FIRE_RING_ID]==t},e.prototype.createRingMonster=function(t){if(this.ringList&&!(this.ringList.length<=0)){var i=GlobalConfig.ActorExRingConfig[t],n=this.getSpecialRingDataById(t);if(!(n.level<i.showMonsterLv)){var s=i.monsterId,o=this.getAbilityID();if(o){var a=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID][o][this.abilityIds[o]];a&&(s+=a.monId)}if(!EntityManager.ins().getEntityByHandle(this.specialRingHandler[t])){var r=SubRoles.lookAtTar;if(r){var l=FbCT.createModel(GlobalConfig.MonstersConfig[s]);l.setAtt(AttributeType.atMoveSpeed,e.FIRE_RING_MOVING_SPEED),l.x=r.x,l.y=r.y,l.masterHandle=Actor.handle,this.specialRingHandler[t]=l.handle=egret.getTimer(),l.lyMarkLv=LyMark.ins().lyMarkLv,l.lyMarkSkills=LyMark.ins().skills;var h=GameLogic.ins().createEntityByModel(l,Team.My);h.AI_STATE=AI_State.Stand}}}}},e.prototype.sendRingLevelUp=function(t){var e=this.getBytes(5);e.writeShort(t),this.sendToServer(e)},e.prototype.sendRingFight=function(t,e){var i=this.getBytes(6);i.writeShort(t),i.writeByte(e),this.sendToServer(i)},e.prototype.checkOperation=function(){var t=this.checkHaveUpRing();return!t&&this.isFireRingFuse()&&(t=this.isCanStudySkill()||this.isCanUpgradeSkill()),t},e.prototype.checkHaveUpRing=function(){if(!this.checkRingOpen())return!1;for(var t=this.ringList.length,e=0;t>e;e++){var i=this.ringList[e],n=this.checkRedPoint(i.id,i.level);if(n)return n}return!1},e.prototype.checkRingOpen=function(){var t=GlobalConfig.ActorExRingCommon.actImbaId;return Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t))?Artifact.ins().getNewArtifactBy(Artifact.ins().getArtifactIndexById(t)).open:!1
},e.prototype.checkRedPoint=function(t,e){return e>0?this.checkCanUpdate(t,e):this.checkCanActive(t)},e.prototype.checkCanUpdate=function(t,i){var n=!1;if(t==e.FIRE_RING_ID&&this.isFireRingFuse()){GlobalConfig.ActorExRingConfig[t];if(this.getRingConfigById(t,i+1))if(i%11==0)n=!0;else{var s=this.getRingConfigById(t,i),o=BagCT.ins().getBagGoodsCountById(0,s.costItem);n=s.cost<=o}}return n},e.prototype.checkCanActive=function(t){var i=GlobalConfig.ActorExRingConfig[t],n=!1;if(t==e.FIRE_RING_ID)this.isFireRingActivate()||(n=this.isFireRingCanActivate());else{var s=this.getSpecialRingDataById(t).level;0==s&&(n=this.loginDayCount>=i.openDay&&i.openDay>=0||Actor.vip>=i.openVip&&i.openVip>=0&&Actor.yb>=i.openYb)}return n},e.prototype.canGradeupRing=function(t){for(var e,i=[!1,!1,!1],n=SubRoles.ins().subRolesLen,s=0,o=0,a=0,r=0;n>r;r++){var l=SubRoles.ins().getSubRoleByIndex(r);s=l.getExRingsData(t),e=GlobalConfig["ExRing"+t+"Config"][s],o=e.cost,o?(a=BagCT.ins().getBagGoodsCountById(0,GlobalConfig.ExRingConfig[t].costItem),i[r]=a>=o):i[r]=!1}return i},e.prototype.getRingConfigById=function(t,e){return 0==this.ringsConfig.length&&this.initConfig(),this.ringsConfig[t]&&this.ringsConfig[t][e]},e.prototype.initConfig=function(){this.ringsConfig=[];var t=GlobalConfig.ActorExRingConfig;for(var e in t)this.ringsConfig[t[e].id]=GlobalConfig["ActorExRing"+e+"Config"]},e.prototype.getRingStair=function(t){var i=Math.ceil(t/(e.perStar+1));return i},e.prototype.getRingStar=function(t){return 1>t?0:(t-1)%(e.perStar+1)},e.prototype.hasHanlder=function(t){for(var e=0;e<this.mainHandler.length;e++)if(t==this.mainHandler[e])return!0;return this.mainHandler.push(t),!1},e.prototype.delHanlder=function(t){for(var e=0;e<this.mainHandler.length;e++)if(t==this.mainHandler[e])return void this.mainHandler.splice(e,1)},e.prototype.getSpecialRingDataById=function(t){for(var e=0;e<this.ringList.length;e++)if(this.ringList[e].id==t)return this.ringList[e];return null},e.prototype.isFireRingFuse=function(){var t=!1,i=this.getSpecialRingDataById(e.FIRE_RING_ID);return i&&i.level>=1&&(t=!0),t},e.prototype.isFireRingActivate=function(){var t=!1,i=this.getSpecialRingDataById(e.FIRE_RING_ID);return i&&i.isUnLock&&(t=!0),t},e.prototype.isFireRingCanActivate=function(){var t=!1,i=GlobalConfig.ActorExRingConfig[e.FIRE_RING_ID];if(this.loginDayCount>=i.openDay)for(var n=0;n<this.ringList.length;n++)if(t=!0,this.ringList[n].id!=e.FIRE_RING_ID&&0==this.ringList[n].level){t=!1;break}return t},e.prototype.requestDeblock=function(t){var e=this.getBytes(7);e.writeShort(t),this.sendToServer(e)},e.prototype.postUnLock=function(t){for(var e=t.readShort(),i=t.readShort(),n=t.readInt(),s=t.readByte(),o=t.readByte(),a=0;a<this.ringList.length;a++)if(this.ringList[a].id==e){this.ringList[a].level=i,this.ringList[a].exp=n,this.ringList[a].fight=s,this.ringList[a].isUnLock=o;break}return 1==o},e.prototype.requestOpenGrid=function(){var t=this.getBytes(8);this.sendToServer(t)},e.prototype.requestLearnSkill=function(t,e){var i=this.getBytes(9);i.writeShort(t),i.writeShort(e),this.sendToServer(i)},e.prototype.requestUpgradeSkill=function(t){var e=this.getBytes(10);e.writeShort(t),this.sendToServer(e)},e.prototype.postSkillInfo=function(t){this.initSkill(),this.moneyOpenGrid=t.readShort(),this.updateGrid();for(var e=t.readShort(),i=0;e>i;i++){var n=new RingSkillInfo;n.position=t.readShort(),n.skillId=t.readShort(),n.skillLvl=t.readShort(),this.updateSkillInfo(n)}},e.prototype.updateGrid=function(){var t=this.getSpecialRingDataById(e.FIRE_RING_ID),i=0;t.level>0&&(i=this.moneyOpenGrid+this.getRingConfigById(e.FIRE_RING_ID,t.level).freeSkillGrid),this.updateGridOpen(i)},e.prototype.updateGridOpen=function(t){for(var e=1;t>=e;e++){var i=this.skillInfo[e-1];i.isOpen=!0}},e.prototype.updateSkillInfo=function(t){for(var e=this.skillInfo.length,i=0;e>i;i++){var n=this.skillInfo[i];n.position==t.position&&(n.skillId=t.skillId,n.skillLvl=t.skillLvl)}},e.prototype.initSkill=function(){if(!this.skillInfo){this.skillInfo=[];for(var t=1;9>t;t++){var e=new RingSkillInfo;e.position=t,this.skillInfo.push(e)}}},e.prototype.getCanStudyBook=function(){var t=[];if(!this.skillInfo)return t;for(var e=this.skillInfo.length,i=[],n=0;e>n;n++){var s=this.skillInfo[n];s.skillId>0&&i.push(s.skillId)}for(var o=this.getActorExRingBookConfigByLvl(1),a=o.length,r=0;a>r;r++){var l=o[r];if(i.indexOf(l.id)<0){var h=BagCT.ins().getBagGoodsCountById(0,l.itemId);if(h>=l.num){var u=new RewardData;u.id=l.itemId,u.count=h,u.type=1,t.push(u)}}}return t},e.prototype.isBookCanStudy=function(t){for(var e=this.skillInfo.length,i=[],n=0;e>n;n++){var s=this.skillInfo[n];s.skillId>0&&i.push(s.skillId)}for(var o=this.getActorExRingBookConfigByLvl(1),a=o.length,r=0;a>r;r++){var l=o[r];if(l.itemId==t&&i.indexOf(l.id)<0){var h=BagCT.ins().getBagGoodsCountById(0,l.itemId);if(h>=l.num)return!0}}return!1},e.prototype.getStudyBook=function(){for(var t=[],e=this.getActorExRingBookConfigByLvl(1),i=e.length,n=0;i>n;n++){var s=e[n],o=BagCT.ins().getBagGoodsCountById(0,s.itemId),a=new RewardData;a.id=s.itemId,a.count=o,a.type=1,t.push(a)}return t},e.prototype.getFirstStudyBookIndex=function(){for(var t=this.getActorExRingBookConfigByLvl(1),e=t.length,i=0;e>i;i++){var n=t[i];if(this.isBookCanStudy(n.itemId))return i}return 0},e.prototype.isCanStudySkill=function(){var t=this.getCanStudyBook(),e=!1;return t.length>0&&this.isHaveFreeGrid()&&(e=!0),e},e.prototype.isHaveFreeGrid=function(){for(var t=this.skillInfo.length,e=0;t>e;e++){var i=this.skillInfo[e];if(0==i.skillId&&i.isOpen)return!0}return!1},e.prototype.isCanUpgradeSkill=function(){if(!this.skillInfo)return!1;for(var t=this.skillInfo.length,e=0;t>e;e++){var i=this.skillInfo[e];if(i.skillId>0&&i.skillLvl<this.getSkillMaxLvl(i.skillId)){var n=this.getActorExRingBookConfig(i.skillId,i.skillLvl),s=BagCT.ins().getBagGoodsCountById(0,n.itemId);if(s>=n.num)return!0}}return!1},e.prototype.fireRingRedPoint=function(){var t=GlobalConfig.ActorExRingConfig[e.FIRE_RING_ID];return this.loginDayCount<t.openDay?!1:FbCT.ins().fbRings.challengeTime>0||FbCT.ins().fbRings.canTakeAwardId>0},e.prototype.getActorExRingBookConfig=function(t,e){return GlobalConfig.ActorExRingBookConfig[t]&&GlobalConfig.ActorExRingBookConfig[t][e]},e.prototype.getActorExRingBookConfigByLvl=function(t){var e=[],i=[];for(var n in GlobalConfig.ActorExRingBookConfig){var s=GlobalConfig.ActorExRingBookConfig[n][t];s&&i.indexOf(s.itemId)<0&&(i.push(s.itemId),e.push(s))}return e},e.prototype.getSkillIdByItemId=function(t){var e;for(var i in GlobalConfig.ActorExRingBookConfig)for(var n in GlobalConfig.ActorExRingBookConfig[i])if(GlobalConfig.ActorExRingBookConfig[i][n].itemId==t)return e=parseInt(i);return 0},e.prototype.getSkillMaxLvl=function(t){var e=0;if(void 0!=this.skillLvDic[t])e=this.skillLvDic[t];else{for(var i in GlobalConfig.ActorExRingBookConfig)if(i==t+""){e=CommonUtils.getObjectLength(GlobalConfig.ActorExRingBookConfig[i]);break}this.skillLvDic[t]=e}return e},e.prototype.getNextStageSkillName=function(t){var e;for(var i in GlobalConfig.ActorExRingAbilityConfig){var n=GlobalConfig.ActorExRingAbilityConfig[i];if(n&&n.ringLv==t){e=n.abilityName;break}}return e},e.prototype.getUnLockStage=function(t){var e,i=GlobalConfig.ActorExRingAbilityConfig[t],n=i.ringLv;switch(n){case 1:e="一";break;case 5:e="五";break;case 10:e="十";break;case 20:e="二十";break;case 40:e="四十";break;case 60:e="六十";break;case 80:e="八十"}return e},e.prototype.getRingSkill=function(){if(!this.skillInfo)return 0;for(var t=this.skillInfo.length,e=0,i=0;t>i;i++){var n=this.skillInfo[i];if(7==n.skillId){e=n.skillLvl;break}}var s=this.getSpecialRingDataById(7).level,o=this.getRingConfigById(7,s).summonerSkillId;if(e>0&&o){var a=o%10;a+=e,a>9&&(a=9);var r=Math.floor(o/10);o=10*r+a}return o},e.prototype.getCanUpgradeStars=function(t){for(var i=this.getSpecialRingDataById(e.FIRE_RING_ID).level,n=0;;){i++;var s=GlobalConfig.ActorExRing7Config[i];if(!s)return n;if(t-=s.cost,!(t>=0))return n;n++}},e.prototype.getAbilityID=function(t){void 0===t&&(t=0);var e=0;for(var i in this.abilityIds){if(e==t)return+i;e++}return 0},e.prototype.getAbilityIdByItemId=function(t){var i=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var n in i)if(i[n][1].itemId=t)return+n;return 0},e.prototype.getMaxAbilityLvByItemId=function(t){var i=GlobalConfig.ActorExRingItemConfig[e.FIRE_RING_ID];for(var n in i)if(i[n][1].itemId=t)return CommonUtils.getObjectLength(i[n]);return 0},e.prototype.checkCanUseByItem=function(t){var e=this.getAbilityIdByItemId(t),i=this.getMaxAbilityLvByItemId(t);return e&&this.abilityIds[e]>=i?!1:!0},e.prototype.hasMaxSkill=function(){if(!this.skillInfo)return!1;for(var t=this.skillInfo.length,e=0;t>e;e++){var i=this.skillInfo[e];if(i.skillId>0&&i.skillLvl>=this.getSkillMaxLvl(i.skillId))return!0}return!1},e.prototype.skillIsMax=function(t){if(!this.skillInfo)return!1;for(var e=this.skillInfo.length,i=0;e>i;i++){var n=this.skillInfo[i];if(n.skillId==t)return n.skillLvl>=this.getSkillMaxLvl(n.skillId)}return!1},e.ins=function(){return t.ins.call(this)},e.perStar=10,e.FIRE_RING_ID=7,e.FIRE_RING_MOVING_SPEED=3750,e.GRID_OPEN_LEVEL=20,__decorate([post()],e.prototype,"postRingUpdate",null),__decorate([post()],e.prototype,"postActiveRing",null),__decorate([post()],e.prototype,"postSRStairUp",null),__decorate([post()],e.prototype,"postSpicelRingUpdate",null),__decorate([post()],e.prototype,"postGetSpicelRingInfo",null),__decorate([post()],e.prototype,"postUnLock",null),__decorate([post()],e.prototype,"postSkillInfo",null),e}(BaseSystem);__reflect(SpecialRing.prototype,"SpecialRing"),System.SpecialRing=function(){return SpecialRing.ins()},window.SpecialRing=SpecialRing;var BookSkillInfo=function(){function t(){this.itemId=0,this.num=0}return t}();__reflect(BookSkillInfo.prototype,"BookSkillInfo"),window.BookSkillInfo=BookSkillInfo;var OtherFireRingData=function(){function t(){this.lyMarkLv=0,this.lyMarkSkills=[]}return t.prototype.parser=function(t){if(this.lv=t.readInt(),this.skillBooks=[],this.abilityItems=[],this.lv>0){for(var e=t.readShort(),i=0;e>i;i++){var n=new RingSkillInfo;n.position=t.readShort(),n.skillId=t.readShort(),n.skillLvl=t.readShort(),this.skillBooks.push(n)}for(var s=t.readShort(),i=0;s>i;i++){var o=t.readShort(),a=t.readShort();this.abilityItems[o]=a}this.lyMarkLv=t.readShort(),this.lyMarkSkills=[];var r=t.readByte();this.lyMarkSkills.length=r;for(var i=0;r>i;i++)this.lyMarkSkills[i]=t.readShort()}},t}();__reflect(OtherFireRingData.prototype,"OtherFireRingData"),window.OtherFireRingData=OtherFireRingData;var RingSkillInfo=function(){function t(){this.position=0,this.skillId=0,this.skillLvl=0,this.isOpen=!1}return t}();__reflect(RingSkillInfo.prototype,"RingSkillInfo"),window.RingSkillInfo=RingSkillInfo;var SpecialRingData=function(){function t(){this.id=0,this.level=0,this.exp=0,this.fight=0,this.order=0,this.isUnLock=0}return t.prototype.parser=function(t){this.id=t.readShort(),this.level=t.readShort(),this.exp=t.readInt(),this.fight=t.readByte(),this.isUnLock=t.readByte(),this.order=GlobalConfig.ActorExRingConfig[this.id].order},t}();__reflect(SpecialRingData.prototype,"SpecialRingData"),window.SpecialRingData=SpecialRingData;var FireRingAbilityView=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRAbilitySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.list.itemRenderer=FireRingAbilityItem,this.addTouchEndEvent(this.colorCanvas,this.otherClose);var i=[];for(var n in GlobalConfig.ActorExRingAbilityConfig)i.push(parseInt(n));this.list.dataProvider=new eui.ArrayCollection(i)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(FireRingAbilityView.prototype,"FireRingAbilityView"),ViewManager.ins().reg(FireRingAbilityView,LayerManager.UI_Popup),window.FireRingAbilityView=FireRingAbilityView;var FireRingComposeItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRComposeitemSKin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.need.showName=!0,this.need.data=t.consume,this.need.setCount("");var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume.id);this.count.textColor=e>=t.consume.count?14537649:ColorUtil.RED,this.count.text=e+"",this.num.text=t.consume.count+"",this.target.data=t.obtain;var i=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.consume.id)>=t.consume.count;this.redPoint.visible=this.compose.enabled=i}},e}(BaseItemRender);__reflect(FireRingComposeItem.prototype,"FireRingComposeItem"),window.FireRingComposeItem=FireRingComposeItem;var FireRingExchangeWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="LYRExchangeSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick),this.eList.itemRenderer=FireRingComposeItem},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(BagCT.ins().postItemCountChange,this.updateList),this.observe(BagCT.ins().postItemDel,this.updateList),this.observe(BagCT.ins().postItemAdd,this.updateList),this.updateList()},e.prototype.updateList=function(){var t=[];for(var e in GlobalConfig.ExRingBookExchangeConfig){var i=GlobalConfig.ExRingBookExchangeConfig[e];SpecialRing.ins().skillIsMax(i.id)&&t.push(i)}this.eList.dataProvider=new eui.ArrayCollection(t)},e.prototype.onClick=function(t){if(t.target instanceof eui.Button&&t.target.parent.parent instanceof FireRingComposeItem){var e=t.target.parent.parent.data;return void SpecialRing.ins().sendChangeFRSkill(e.id)}switch(t.target){case this.eClose:ViewManager.ins().close(this)}},__decorate([callLater],e.prototype,"updateList",null),e}(BaseEuiView);__reflect(FireRingExchangeWin.prototype,"FireRingExchangeWin"),window.FireRingExchangeWin=FireRingExchangeWin,ViewManager.ins().reg(FireRingExchangeWin,LayerManager.UI_Popup);var FireRingInfoPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isItemEnough=!1,e.isclick=!1,e}return __extends(e,t),e.prototype.open=function(){this.addCustomEvent(),this.initView(),this.oldHorizontalCenter=this.nowAttr.horizontalCenter},e.prototype.removeDisplay=function(){this.removeTouchEvent(this.lvupBtn,this.updateDown,!0),this.lvupBtn&&this.lvupBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.showBtn,this.showDetail),this.addTouchEvent(this.lvupBtn,this.updateDown,!0),this.addTouchEvent(this.checkBtn,this.showAbility),this.addTouchEvent(this.ultraBtn,this.showUltra),this.observe(SpecialRing.ins().postSpicelRingUpdate,this.initView),this.observe(SpecialRing.ins().postSRStairUp,this.initView),this.lvupBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changeClick,this)},e.prototype.changeClick=function(){this.isclick=!1},e.prototype.updateDown=function(){this.isclick||(this.starList&&10==this.starList.starNum?(this.isclick=!0,SpecialRing.ins().sendRingLevelUp(SpecialRing.FIRE_RING_ID)):this.isItemEnough?SpecialRing.ins().sendSpicelRingUpdate(SpecialRing.FIRE_RING_ID):(this.isclick=!0,TipsCT.ins().showTips("神戒碎片不足")))},e.prototype.showUltra=function(){ViewManager.ins().open(RingUpgradeWin)},e.prototype.showAbility=function(){ViewManager.ins().open(FireRingAbilityView)},e.prototype.showDetail=function(){ViewManager.ins().open(RingDetailPanel,this.powerAttr)},e.prototype.initView=function(){var t=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),e=SpecialRing.ins().getRingStair(t.level),i=SpecialRing.ins().getRingStar(t.level),n=0;n=void 0==this.lastStar?0:this.lastStar<i?1:0,this.lastStar=i;var s=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,t.level);if(s){var o=GlobalConfig.ItemConfig[s.costItem],a=SpecialRing.ins().getRingConfigById(SpecialRing.FIRE_RING_ID,t.level+1);this.lv.text=StringUtils.NumberToChinese(e)+"阶",this.costImg.source=o.icon+"_png";var r=BagCT.ins().getBagGoodsCountById(0,s.costItem),l="",h=s.cost;10==i?(r=0,h=0,this.costImg.visible=!1,this.costCount.visible=!1,this.costTitle.visible=!1,this.lvupBtn.label="升  阶"):(this.costImg.visible=!0,this.costCount.visible=!0,this.costTitle.visible=!0,this.lvupBtn.label="升  星"),r>=h?(l=ColorUtil.GREEN_COLOR,this.isItemEnough=!0):(l=ColorUtil.RED_COLOR,this.isItemEnough=!1),this.costCount.textFlow=TextFlowMaker.generateTextFlow("<font color="+l+">"+r+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+h+"</font> "),this.nowAttr.text=AttributeData.getAttStr(s.attrAward,0,1,"："),this.nowAttr.horizontalCenter=a?this.oldHorizontalCenter:0,this.max.visible=a?!1:!0,this.nextAttr.visible=this.arrow.visible=this.lvupBtn.visible=!this.max.visible,a&&(this.nextAttr.text=AttributeData.getAttStr(a.attrAward,0,1,"：")),this.powerAttr=this.getRingTotalAttribute();var u=BagCT.getAttrPower(this.powerAttr);u*=SubRoles.ins().subRolesLen,this.power.setPower(u),this.starList||(this.starList=new StarList(10),this.starList.x=15,this.starGroup.addChild(this.starList)),this.starList.setStarNum(i,n),this.info.text=this.getNextStageAbility(e),SpecialRing.ins().getAbilityID()?(this.ultraBtn.icon="ability_0N",this.nameImg.source="ring_title2"):(this.ultraBtn.icon="ability_0L",this.nameImg.source="ring_title"),this.info0.visible=!1;for(var p in GlobalConfig.ActorExRingFubenExConfig){var c=GlobalConfig.ActorExRingFubenExConfig[p];if(e<c.tejieLv){this.info0.text=c.tejieLv+"阶解锁第"+c.id+"境副本",this.info0.visible=!0;break}}}},e.prototype.getRingTotalAttribute=function(){for(var t,e=function(e){var i=1;e==SpecialRing.FIRE_RING_ID&&(i=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level);var n=SpecialRing.ins().getRingConfigById(e,i);if(t)if(e==SpecialRing.FIRE_RING_ID){var s=CommonUtils.copyDataHandler(n.attrAward),o=SpecialRing.ins().getAbilityID();if(o){var a=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][o][SpecialRing.ins().abilityIds[o]];s.forEach(function(t,e){t.value*=1+a.attrPer/1e4,t.value=Math.round(t.value)})}t=AttributeData.AttrAddition(t,s)}else t=AttributeData.AttrAddition(t,n.attrAward);else t=n.attrAward},i=2;7>=i;i++)e(i);return t},e.prototype.getNextStageAbility=function(t){var e=t+1;2>e&&(e=2);var i=0;for(var n in GlobalConfig.ActorExRing7Config)GlobalConfig.ActorExRing7Config[n]instanceof ActorExRing7Config&&i++;for(var s=GlobalConfig.ActorExRing7Config[i],o=SpecialRing.ins().getRingStair(s.level);o>e;){var a=SpecialRing.ins().getNextStageSkillName(e);if(a)return e+"阶解锁"+SpecialRing.ins().getNextStageSkillName(e);e++}return""},e}(BaseView);__reflect(FireRingInfoPanel.prototype,"FireRingInfoPanel"),window.FireRingInfoPanel=FireRingInfoPanel;var FireRingSkillPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillId=0,e.isEoughItemUpgrade=!1,e.skillName="",e}return __extends(e,t),e.prototype.open=function(){this.initView(),this.addCustomEvent()},e.prototype.addCustomEvent=function(){this.addTouchEvent(this.opraBtn,this.opration),this.addTouchEvent(this.eChangeBtn,this.onClick),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListChange,this),this.learnList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onLearnListChange,this),this.observe(SpecialRing.ins().postSkillInfo,this.refreshView),this.observe(FireRingRedPoint.ins().postChangeRedPoint,this.changeRedPoint)},e.prototype.changeRedPoint=function(){this.redPoint.visible=FireRingRedPoint.ins().changePoint},e.prototype.onClick=function(t){switch(t.target){case this.eChangeBtn:ViewManager.ins().open(FireRingExchangeWin)}},e.prototype.opration=function(){var t=SpecialRing.ins().skillInfo[this.lastSelectIndex];0==t.skillId?SpecialRing.ins().requestLearnSkill(this.skillId,t.position):t.skillLvl==SpecialRing.ins().getSkillMaxLvl(t.skillId)?TipsCT.ins().showTips(this.skillName+"已升至顶级"):this.isEoughItemUpgrade?SpecialRing.ins().requestUpgradeSkill(t.position):TipsCT.ins().showTips(this.skillName+"数量不足")},e.prototype.onListChange=function(t){var i=SpecialRing.ins().skillInfo[this.list.selectedIndex];if(i.isOpen)this.updateView(t.itemIndex);else{var n=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level,s=SpecialRing.ins().getRingStair(n);if(s>=SpecialRing.GRID_OPEN_LEVEL){var o=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];Actor.yb>=o.skillGridYb?HuntWarnBuyWin.showBuyWarn("FireRingSkillPanel",e.requestOpenGrid.bind(this),"是否消耗"+GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].skillGridYb+"元宝开启神戒技能槽"):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")}else TipsCT.ins().showTips(SpecialRing.GRID_OPEN_LEVEL+"阶开启")}},e.requestOpenGrid=function(){SpecialRing.ins().requestOpenGrid()},e.prototype.onLearnListChange=function(t){this.selectSkill(this.learnList.selectedIndex)},e.prototype.initView=function(){this.list.itemRenderer=FireRingSkillItem,this.learnList.itemRenderer=FireRingSkillBookItem,this.updateList(),this.updateView(0)},e.prototype.updateList=function(){this.list.dataProvider=new eui.ArrayCollection(SpecialRing.ins().skillInfo)},e.prototype.refreshView=function(){this.updateList(),this.updateView(this.lastSelectIndex)},e.prototype.updateView=function(t){this.changeRedPoint(),this.lastSelectIndex=t,this.list.selectedIndex=t,this.eChangeBtn.visible=SpecialRing.ins().hasMaxSkill(),this.selectList();var e=SpecialRing.ins().skillInfo[t];if(this.opraBtn.visible=!0,e.skillId){this.currentState="upgrade",this.opraBtn.enabled=!0;var i=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl);if(this.skillName=i.skillName,this.nextLv.visible=!0,this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(i.skillDesc),e.skillLvl<SpecialRing.ins().getSkillMaxLvl(e.skillId)){this.nextLv.visible=!0;var n=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl+1);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(n.skillDesc),this.cost.text="X"+n.num,this.needItem.data=n.itemId,this.isEoughItemUpgrade=BagCT.ins().getBagGoodsCountById(0,i.itemId)>=n.num,this.isEoughItemUpgrade?(this.cost.textColor=ColorUtil.GREEN_COLOR_N,this.updateRp.visible=!0):(this.cost.textColor=ColorUtil.RED_COLOR_N,this.updateRp.visible=!1),this.updateGroup.visible=!0,this.eIsFull.visible=!1}else this.isEoughItemUpgrade=!0,this.updateGroup.visible=!1,this.nextLv.visible=!1,this.updateRp.visible=!1,this.eIsFull.visible=!0,this.opraBtn.visible=!1}else this.currentState="study",this.learnList.dataProvider=new eui.ArrayCollection(SpecialRing.ins().getStudyBook()),0==this.learnList.dataProvider.length?(this.nowLvDesc.visible=!1,this.nextLvDesc.visible=!1,this.opraBtn.enabled=!1,this.nobook.visible=!0):(this.nowLvDesc.visible=!0,this.nextLvDesc.visible=!0,this.opraBtn.enabled=!0,this.nobook.visible=!1,this.selectSkill(SpecialRing.ins().getFirstStudyBookIndex()));for(var s,o,a=SpecialRing.ins().skillInfo.length,r=0,l=0;a>l;l++){var i=SpecialRing.ins().skillInfo[l];if(i.skillId>0){var h=SpecialRing.ins().getActorExRingBookConfig(i.skillId,i.skillLvl);i.skillId<=4?s=s?AttributeData.AttrAddition(s,h.attr):h.attr:5==i.skillId?o=h.bookAttrPer:i.skillId>5&&h.exPower&&(r+=h.exPower)}}var u=r;s&&(o&&(s=AttributeData.AttrMultiply(s,o)),u+=BagCT.getAttrPower(s)),u*=SubRoles.ins().subRolesLen,this.power.setPower(u)},e.prototype.selectSkill=function(t){this.learnList.selectedIndex=t;var e=this.learnList.dataProvider.getItemAt(t),i=SpecialRing.ins().getSkillIdByItemId(e.id),n=SpecialRing.ins().getActorExRingBookConfig(i,1);this.skillId=i,this.nowLvDesc.textFlow=TextFlowMaker.generateTextFlow(n.skillDesc);var s=SpecialRing.ins().getActorExRingBookConfig(i,2);this.nextLvDesc.textFlow=TextFlowMaker.generateTextFlow(s.skillDesc),this.selectLearnList()},e.prototype.selectList=function(){for(var t=this.list.dataProvider.length,e=0;t>e;e++){var i=this.list.getElementAt(e);i&&(e!=this.list.selectedIndex?i.setSelect(!1):i.setSelect(!0))}},e.prototype.selectLearnList=function(){for(var t=this.learnList.dataProvider.length,e=0;t>e;e++){var i=this.learnList.getElementAt(e);i&&(e!=this.learnList.selectedIndex?i.setSelect(!1):i.setSelect(!0))}void 0!=this.learnList.selectedItem&&void 0!=this.learnList.selectedItem.id&&(this.opraBtn.enabled=SpecialRing.ins().isBookCanStudy(this.learnList.selectedItem.id))},e}(BaseView);__reflect(FireRingSkillPanel.prototype,"FireRingSkillPanel"),window.FireRingSkillPanel=FireRingSkillPanel;var FireRingWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelect=0,e.skinName="LYRingSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return SpecialRing.ins().checkRingOpen()?!0:(TipsCT.ins().showTips("激活神器 烈焰神戒 后开启"),!1)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.lastSelect=t[0]||0,this.addChangingEvent(this.tab,this.onTabTouching),this.tab.addEventListener(egret.Event.CHANGE,this.setSelectedIndex,this),this.tab.selectedIndex=this.lastSelect,this.viewStack.selectedIndex=this.lastSelect,this.viewStack.getElementAt(this.lastSelect).open(),this.checkPoint(),this.observe(SpecialRing.ins().postSRStairUp,this.checkPoint),this.observe(SpecialRing.ins().postSkillInfo,this.checkPoint),this.observe(FbCT.ins().postFbRingInfo,this.checkPoint),this.observe(BagCT.ins().postItemAdd,this.checkPoint),this.observe(BagCT.ins().postItemDel,this.checkPoint),this.observe(BagCT.ins().postItemCountChange,this.checkPoint),this.observe(LyMark.ins().postMarkData,this.checkPoint),this.observe(FireRingRedPoint.ins().postChangeRedPoint,this.checkPoint)},e.prototype.onTabTouching=function(t){this.checkIsOpen(this.tab.selectedIndex)||t.preventDefault()},e.prototype.checkIsOpen=function(t){return 3!=t||LyMark.ins().checkOpen()?!0:(TipsCT.ins().showTips("烈焰戒指达到"+SpecialRing.ins().getRingStair(GlobalConfig.FlameStamp.openLevel)+"阶开启"),!1)},e.prototype.setSelectedIndex=function(){this.lastSelect=this.viewStack.selectedIndex,this.viewStack.getElementAt(this.lastSelect).open()},e.prototype.checkPoint=function(){this.redPoint0.visible=SpecialRing.ins().checkHaveUpRing(),this.redPoint1.visible=SpecialRing.ins().isCanStudySkill()||SpecialRing.ins().isCanUpgradeSkill()||FireRingRedPoint.ins().changePoint,this.redPoint2.visible=SpecialRing.ins().fireRingRedPoint(),this.redPoint3.visible=LyMark.ins().checkRed()},__decorate([callLater],e.prototype,"checkPoint",null),e}(BaseEuiView);__reflect(FireRingWin.prototype,"FireRingWin"),ViewManager.ins().reg(FireRingWin,LayerManager.UI_Main),window.FireRingWin=FireRingWin;var RingDetailPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRAttrSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0];this.attrValue.text=AttributeData.getAttStr(i,0,1,"    ",!1,!1),this.addTouchEndEvent(this.bgClose,this.otherClose)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RingDetailPanel.prototype,"RingDetailPanel"),ViewManager.ins().reg(RingDetailPanel,LayerManager.UI_Popup),window.RingDetailPanel=RingDetailPanel;var RingInfoView=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.barbc=new ProgressBarEff,e.cruCostId=0,e.isAutoUp=!1,e.canUpdate=!1,e.FIRE_RING_ID=7,e.isTopLevel=!0,e._sn_="ring",e}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(TaskCT.ins().postUpdateAchieve,this.updateView),this.observe(SpecialRing.ins().postUnLock,this.updateView),this.observe(SpecialRing.ins().postSpicelRingUpdate,this.playEffect),this.observe(SpecialRing.ins().postActiveRing,this.showActivityView),this.observe(SpecialRing.ins().postActiveRing,this.updateView),this.observe(SpecialRing.ins().postSRStairUp,this.updateView),this.barbc.reset(),this.updateView(),this.setIcon()},e.prototype.skinComplete=function(){this.barbc.setWidth(400),this.barbc.x=-15,this.barbc.y=25,this.barGroup.addChild(this.barbc),this.starList=new StarList(SpecialRing.perStar),this.starList.x=15,this.starList.y=0,this.star.addChild(this.starList),this.iconMc=new MovieClip,this.iconMc.x=0,this.iconMc.y=0,this.ringMcGroup.addChild(this.iconMc),this.reliveEff=new MovieClip,this.reliveEff.x=200,this.reliveEff.y=62,this.reliveEff.scaleX=1.15,this.baojiMc=new MovieClip,this.baojiMc.x=245,this.baojiMc.y=650,this.menuList.itemRenderer=SpecialRingItem,this.menuList.selectedIndex=0,this.menuListData=new eui.ArrayCollection,this.menuList.dataProvider=this.menuListData,this.ringget.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.ringget.text+"</u></a>"),this.upgradebtn.label="进阶",this.uplevel.label="升星",this.countTxt.textColor=ColorUtil.NORMAL_COLOR,this.addChangeEvent(this.menuList,this.onClickMenu),this.addTouchEvent(this.uplevel,this.onTap),this.addTouchEvent(this.acivebtn,this.onTap),this.addTouchEvent(this.ringget,this.onTap),this.addTouchEvent(this.upgradebtn,this.onTap),this.addTouchEvent(this.goQuicklyOpen,this.onQuickOpen)},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.reliveEff),this.isAutoUp&&this.stopAutoUp()},e.prototype.onQuickOpen=function(t){var e=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID],i=e.useYb;Actor.yb>=i?SpecialRing.ins().sendActiveRing(SpecialRing.FIRE_RING_ID,1):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onTap=function(t){switch(t.currentTarget){case this.uplevel:this.warnShow();break;case this.acivebtn:this.currData.id==SpecialRing.FIRE_RING_ID?SpecialRing.ins().requestDeblock(this.currData.id):SpecialRing.ins().sendActiveRing(this.currData.id);break;case this.upgradebtn:TipsCT.ins().showTips("排版优化 屏蔽升级功能");break;case this.ringget:WarnCT.ins().setBuyGoodsWarn(this.cruCostId)}},e.prototype.showActivityView=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ActorExRingConfig[this.currData.id];this.currData.id==SpecialRing.FIRE_RING_ID?(ViewManager.ins().close(this),ViewManager.ins().open(FireRingWin)):this.upDateItem.apply(this,t),Activationtongyong.show(0,i.name,"j"+i.icon+"_png")},e.prototype.upDateItem=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=0;t&&t[0]&&(i=t[0][0]);var n=SpecialRing.ins().getSpecialRingDataById(i),s=GlobalConfig.ActorExRingConfig[this.currData.id];this.menuListData.replaceItemAt(n,s.order-1),this.currData=n,this.updateDetail(!0)},e.prototype.playEffect=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];this.upDateItem.apply(this,e);var n=0,s=GlobalConfig.ActorExRingConfig[this.currData.id];e&&e[0]&&(n=e[0][1]);var o=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);n>0&&(this.baojiMc.playFile(RES_DIR_EFF+"BurstEff",1),this.addChild(this.baojiMc));var a=new eui.Label;a.size=14,a.textColor=3532333,a.width=450,a.textAlign=egret.HorizontalAlign.CENTER,a.x=19,a.y=420,a.text=s.name+"经验增加"+o.addPower,this.addChild(a);var r=egret.Tween.get(a);r.to({y:a.y-45},500).call(function(){t.removeChild(a)},this)},e.prototype.onClickMenu=function(t){var e=this.specialDatas[t.currentTarget.selectedIndex];e&&(this.barbc.reset(),this.currData=e,this.updateDetail(),this.setIcon())},e.prototype.setIcon=function(){var t=GlobalConfig.ActorExRingConfig[this.currData.id];if(!GlobalConfig.DefineEff[t.effid])return void egret.log(t.name+"特效ID出错啦");var e=GlobalConfig.DefineEff[t.effid].souce;this.iconMc.playFile(RES_DIR_EFF+e,-1)},e.prototype.updateView=function(){this.updateMenuList(),this.updateDetail()},e.prototype.updateMenuList=function(){if(this.specialDatas=CommonUtils.copyDataHandler(SpecialRing.ins().ringList),this.menuListData.source=this.specialDatas.sort(function(t,e){return Algorithm.sortAscAttr(t,e,"order")}),this.currData){for(var t in this.specialDatas)if(this.currData.id==this.specialDatas[t].id){this.currData=this.specialDatas[t];break}}else this.currData=this.specialDatas[0]},e.prototype.updateFuseView=function(){var t=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];
this.price0.setPrice(t.useYb)},e.prototype.updateDetail=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ActorExRingConfig[this.currData.id],i=SpecialRing.ins().isFireRingActivate();if(i)this.currentState="tejie8",this.updateFuseView(),this.currData.id=this.FIRE_RING_ID;else if(this.currData.id==this.FIRE_RING_ID){this.currentState="disable",this.resetUI(),this.attrBg0.visible=!1,this.acivebtn.label="解封";var n=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.ringname.text=""+n.name,this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(n)),this.openDesc.text="第8天激活全部神戒后解锁",SpecialRing.ins().isFireRingCanActivate()?(this.acivebtn.visible=!0,this.openDesc.visible=!1,this.addReliveEff()):(this.acivebtn.visible=!1,this.openDesc.visible=!0,DisplayUtils.removeFromParent(this.reliveEff))}else{this.attrBg0.visible=!0,this.acivebtn.label="激活";var s=0==this.currData.level?1:this.currData.level,o=SpecialRing.ins().getRingConfigById(this.currData.id,s),a=SpecialRing.ins().getRingStair(this.currData.level);if(this.ringname.text=""+e.name,this.stageImg.setValue(a),this.currData.level>0)if(Actor.level>=e.needLevel&&ZsCT.ins().lv>=e.needZs)SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.currentState="open":this.currentState="final",this.setOpenInfo(t);else if(this.currentState="wait",this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e)),this.openLevelDesc.text="达到"+(e.needZs>0?e.needZs+"转":"")+(e.needLevel>0?e.needLevel+"级":"")+"后神戒开启飞升",o.attrAward){this.setLayoutAttr(o);var r=BagCT.getAttrPower(o.attrAward);this.powerPanel.setPower(r)}else this.setLayoutAttr(o,!0),this.powerPanel.setPower(0);else{if(this.currentState="disable",o.attrAward){this.setLayoutAttr(o);var r=BagCT.getAttrPower(o.attrAward);this.powerPanel.setPower(r)}else this.setLayoutAttr(o,!0),this.powerPanel.setPower(0);this.Explain0.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e));var l=SpecialRing.ins().checkRedPoint(this.currData.id,this.currData.level);if(l)this.openDesc.text="",this.acivebtn.visible=!0,this.addReliveEff();else{var h=GlobalConfig.ActorExRingConfig[this.currData.id];this.acivebtn.visible=!1,this.openDesc.text="第"+h.openDay+"天或"+VipCT.getVipStr(h.openVip,!0)+"开启",DisplayUtils.removeFromParent(this.reliveEff)}this.canUpdate=!1}this.skillname.text=o.SpecialRingSkin}},e.prototype.addReliveEff=function(){this.reliveEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.reliveEff.parent||this.aciveGroup.addChild(this.reliveEff)},e.prototype.resetUI=function(){this.setLayoutAttr(null,!0),this.Explain0.text="",this.skillname.text="",this.openDesc.text=""},e.prototype.setLayoutAttr=function(t,e){for(var i=0;4>i;i++)if(e)this["attrLabel"+(i+1)].text="";else{var n=AttributeData.getAttStr(this.getAttrArray(t.attrAward),1),s=n.split("\n");this["attrLabel"+(i+1)].text=s[i]}},e.prototype.getAttrArray=function(t){for(var e=[11,12,23,24],i=[],n=0;n<t.length;n++)e.indexOf(t[n].type)<0&&i.push(t[n]);return i},e.prototype.setOpenInfo=function(t){void 0===t&&(t=!1);var e=GlobalConfig.ActorExRingConfig[this.currData.id],i=0==this.currData.level?1:this.currData.level,n=SpecialRing.ins().getRingConfigById(this.currData.id,i);this.cruCostId=n.costItem,this.Explain0.textFlow=this.Explain.textFlow=TextFlowMaker.generateTextFlow(this.countStrDesc(e));var s=BagCT.ins().getBagGoodsCountById(0,n.costItem);this.countTxt.text="需要"+GlobalConfig.ItemConfig[n.costItem].name+":";var o="";o=s>=n.cost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,this.useTxt.textFlow=TextFlowMaker.generateTextFlow("<font color="+o+">"+s+"</font><font color="+ColorUtil.WHITE_COLOR+">/"+n.cost+"</font> "),this.canUpdate=s>=n.cost;var a;this.upgradebtn.visible=!1,"final"!=this.currentState&&(this.uplevel.visible=!0);var r=SpecialRing.ins().getRingStar(this.currData.level);if(n.judgeup>0?(a=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1),this.currData.exp>=n.upPower?(this.starList.setStarNum(r,Number(t)),this.upgradebtn.visible=!0,this.uplevel.visible=!1,SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.upgradebtn.label="进阶":this.upgradebtn.label="已满级"):this.starList.setStarNum(r,Number(t))):(a=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1),this.starList.setStarNum(r,Number(t))),a&&(a.attrAward?this.nextAttrLabel.text=AttributeData.getAttStr(this.getAttrArray(a.attrAward),1):this.nextAttrLabel.text=""),this.expBarChange(),n.attrAward){this.setLayoutAttr(n);var l=BagCT.getAttrPower(n.attrAward);this.powerPanel.setPower(l)}else this.setLayoutAttr(n,!0),this.attrLabel.text="",this.powerPanel.setPower(0)},e.prototype.warnShow=function(){if(!this.canUpdate){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level);return void TipsCT.ins().showTips(GlobalConfig.ItemConfig[t.costItem].name+"不足")}var e=GlobalConfig.ActorExRingConfig[this.currData.id];Actor.level>=e.needLevel&&ZsCT.ins().lv>=e.needZs||TipsCT.ins().showTips(""+(e.needZs>0?e.needZs+"转":"")+(e.needLevel>0?e.needLevel+"级":"")+"可飞升"),SpecialRing.ins().sendSpicelRingUpdate(this.currData.id)},e.prototype.stopAutoUp=function(){this.isAutoUp=!1,Timer.stop(this.autoUpStar,this)},e.prototype.autoUpStar=function(){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level),e=BagCT.ins().getBagGoodsCountById(0,t.costItem);e?SpecialRing.ins().sendSpicelRingUpdate(this.currData.id):(this.isAutoUp=!1,Timer.stop(this.autoUpStar,this))},e.prototype.expBarChange=function(){var t=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level),e=t.upPower,i=this.currData.exp;i=SpecialRing.ins().getRingConfigById(this.currData.id,this.currData.level+1)?this.currData.exp>e?e:this.currData.exp:e,this.barbc.getMaxValue()!=e?this.barbc.setData(i,e):this.barbc.setValue(i)},e.prototype.countStrDesc=function(t){var e=0==this.currData.level?1:this.currData.level,i=SpecialRing.ins().getRingConfigById(this.currData.id,e),n=t.explain.split("$"),s="";if(n.length>0)for(var o=0;o<n.length;o++)if(Number(n[o])){var a=Number(n[o]),r=void 0;r=a/200>=1?i.extAttrAward:i.attrAward;for(var l in r)if(r[l].type==a%100){s+=a>200?AttributeData.getExtAttStrByType(r[l],0,"",!1,!1):AttributeData.getAttStrByType(r[l],0,"",!1,!1);break}}else s+=n[o];else s=t.explain;return s},e}(BaseEuiView);__reflect(RingInfoView.prototype,"RingInfoView"),ViewManager.ins().reg(RingInfoView,LayerManager.UI_Main),window.RingInfoView=RingInfoView;var RingTurnDisplayer=function(t){function e(){var e=t.call(this)||this;return e.gAngle=180,e.gHasReset=!0,e.gInitPos=!0,e.isMaxX=!1,e.isMaxY=!1,e.gemPos1=[64,-52,-68,-80,-84,-80,-64,-90,-50,-100,40,-110,64,-80,64,-52],e.mc=new MovieClip,e.gFollowItem=new egret.DisplayObjectContainer,e.addChild(e.gFollowItem),e.gCenterPos=new egret.Point,e.gTurnItem=new egret.DisplayObjectContainer,e.gTurnItem.addChild(e.mc),e.gFollowItem.addChild(e.gTurnItem),Timer.start(20,0,e.update,e),e}return __extends(e,t),e.prototype.setOwner=function(t){this.gOwner=t,this.gTurnTime=1e4+1e4*Math.random()+egret.getTimer(),this.gAngle=e.STAR_ANGLE,this.gStopTime=0},e.prototype.update=function(){this.gInitPos?(this.gFollowItem.x=e.TARGET_POINT_X,this.gFollowItem.y=e.TARGET_POINT_Y-this.gOwner.height,this.gInitPos=!1):(this.gFollowItem.x=this.gFollowItem.x-(this.gOwner.x-this.gOwnerLastX),this.gFollowItem.y=this.gFollowItem.y-(this.gOwner.y-this.gOwnerLastY)),this.gCenterPos=new egret.Point(this.effectX,this.effectY),this.moveCenterPoint(),this.gOwnerLastX=this.gOwner.x,this.gOwnerLastY=this.gOwner.y},e.prototype.setEffectXY=function(t){var e=this.gemPos1[2*t],i=this.gemPos1[2*t+1];this.effectX=e+Math.ceil(100*Math.random()-50),this.effectY=i+Math.ceil(100*Math.random()-50)},e.prototype.moveCenterPoint=function(){var t,i=this.gCenterPos.x-this.gFollowItem.x;0!=i&&(Math.abs(i)>e.MAX_DIS?(t=2*Math.ceil(Math.abs(i)*e.SPEED_RATIO)*3/2,i>0?i>t&&(this.gFollowItem.x=this.gFollowItem.x+t):0>i&&Math.abs(i)>t&&(this.gFollowItem.x=this.gFollowItem.x-t)):(this.isMaxX=!1,t=3*Math.ceil(Math.abs(i)*e.SPEED_RATIO)/2*1.35,i>0?i>t&&(this.gFollowItem.x=this.gFollowItem.x+t):0>i&&Math.abs(i)>t&&(this.gFollowItem.x=this.gFollowItem.x-t)));var n=this.gCenterPos.y-this.gFollowItem.y;0!=n&&(Math.abs(n)>e.MAX_DIS?(t=2*Math.ceil(Math.abs(n)*e.SPEED_RATIO)*3/2,n>=0?n>t&&(this.gFollowItem.y=this.gFollowItem.y+t):0>n&&Math.abs(n)>t&&(this.gFollowItem.y=this.gFollowItem.y-t)):(this.isMaxY=!1,t=3*Math.ceil(Math.abs(n)*e.SPEED_RATIO)/2*1.35,n>=0?n>t&&(this.gFollowItem.y=this.gFollowItem.y+t):0>n&&Math.abs(n)>t&&(this.gFollowItem.y=this.gFollowItem.y-t)))},e.prototype.setModel=function(t,e,i){if(this.infomodel=e,e.masterHandle&&e.masterHandle==Actor.handle){if(0>t||null==t)return;if(EntityManager.ins().getMainRole(0)&&EntityManager.ins().getMainRole(0).infoModel.handle!=e.handle)return}return e.masterHandle&&SpecialRing.ins().hasHanlder(e.masterHandle)?void(this.lastID!=t&&(this.showRing(t),this.lastID=t)):(this.showRing(t),void i.addChild(this))},e.prototype.showRing=function(t){this.mc.alpha=1,this.ringInfo=GlobalConfig.ActorExRingConfig[t];var e=GlobalConfig.MonstersConfig[this.ringInfo.avatarFileName];this.mc.playFile(""+RES_DIR_MONSTER+e.avatar+"_0a",-1)},e.prototype.reset=function(){this.mc&&DisplayUtils.removeFromParent(this.mc),SpecialRing.ins().delHanlder(this.infomodel.masterHandle),this.gOwnerLastX=0,this.gOwnerLastY=0,this.gCenterPos.x=0,this.gCenterPos.y=0,this.gHasReset=!0,this.gInitPos=!0,this.gModelUrl="",Timer.stopAll(this)},e.TARGET_POINT_X=95,e.TARGET_POINT_Y=-40,e.MAX_DIS=60,e.STAR_ANGLE=0,e.SPEED_RATIO=.015,e}(egret.DisplayObjectContainer);__reflect(RingTurnDisplayer.prototype,"RingTurnDisplayer"),window.RingTurnDisplayer=RingTurnDisplayer;var RingUpgradeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="LYRUltraSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.addBossImg=function(t){this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=this.ring0eff.width/2,this.bossImage.y=115,this.ring0eff.addChild(this.bossImage);var e=GlobalConfig.MonstersConfig[t];this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)},e.prototype.addNextBossImg=function(t){this.nextBossImage=new MovieClip,this.nextBossImage.scaleX=-1,this.nextBossImage.scaleY=1,this.nextBossImage.x=this.ring1eff.width/2,this.nextBossImage.y=115,this.ring1eff.addChild(this.nextBossImage);var e=GlobalConfig.MonstersConfig[t];this.nextBossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.colorCanvas,this.otherClose);var i=SpecialRing.ins().getAbilityID();0==i&&(i=1);var n=SpecialRing.ins().abilityIds[i];n=n?n:1;var s=GlobalConfig.ActorExRingItemConfig[SpecialRing.FIRE_RING_ID][i][n],o=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID].monsterId,a=o+s.monId;this.abilityDesc.textFlow=TextFlowMaker.generateTextFlow(s.abilityDesc),this.addBossImg(o),this.addNextBossImg(a)},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(RingUpgradeWin.prototype,"RingUpgradeWin"),ViewManager.ins().reg(RingUpgradeWin,LayerManager.UI_Popup),window.RingUpgradeWin=RingUpgradeWin;var ShenjietipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ShenjietipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.ItemConfig[t[0]];return null!=i},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.itemId=t[0],this.num=t[1],this.update()},e.prototype.update=function(){var t=GlobalConfig.ItemConfig[this.itemId];this.nameLabel.text=t.name,this.nameLabel.textColor=ItemUtil.getQualityColor(t),this.qualityImg.source="quali"+ItemUtil.getQuality(t),this.itemIcon.setData(t),this.lvTxt.text=(t.level||1)+"级",this.iconBg.source="big"+t.icon+"_png",this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(t.desc)},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(ShenjietipsWin.prototype,"ShenjietipsWin"),window.ShenjietipsWin=ShenjietipsWin,ViewManager.ins().reg(ShenjietipsWin,LayerManager.UI_Popup);var SpecialRingWin=function(t){function e(){var e=t.call(this)||this;return e.ringLv=0,e.skinName="RingTips",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.iconMc=new MovieClip,this.iconMc.x=170,this.iconMc.y=160,this.gainList0.itemRenderer=RingGainItem},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],null==t[1]&&(t[1]=0),this.roleSelect.setCurRole(t[1]),this.iconMc&&!this.iconMc.parent&&this.mcGroup.addChild(this.iconMc),this.addTouchEvent(this.btnUse,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.gainList0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addSpecialListener(),this.observe(BagCT.ins().postItemAdd,this.roleChange),this.observe(BagCT.ins().postItemChange,this.roleChange);var i=GlobalConfig.ExRingConfig[this.index],n=GlobalConfig.GainItemConfig[i.costItem];this.gainList0.dataProvider=new eui.ArrayCollection(n.gainWay),this.roleChange()},e.prototype.addSpecialListener=function(){this.observe(SpecialRing.ins().postRingUpdate,this.roleChange)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.iconMc)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&GameGuider.guidance(e[1],e[2],!0)}},e.prototype.onTap=function(t){switch(t.currentTarget){case this.colorCanvas0:case this.bgClose:ViewManager.ins().close(this);break;case this.btnUse:"激活"==this.btnUse.label?this.sendUpgrade():this.openBuyGoods()}},e.prototype.showIcon=function(){var t=this.index?"tjiehs":"tjiemb";this.iconMc.playFile(RES_DIR_EFF+t,-1)},e.prototype.roleChange=function(t){void 0===t&&(t=!1),this.setRedPoint();var e=this.roleSelect.getCurRole();this.ringLv=SubRoles.ins().getSubRoleByIndex(e).getExRingsData(this.index),this.showIcon();var i=GlobalConfig.ExRingConfig[this.index],n=GlobalConfig["ExRing"+this.index+"Config"][0],s=GlobalConfig["ExRing"+this.index+"Config"][1];if(0==this.ringLv){var o=(CommonUtils.getObjectLength(GlobalConfig["ExRing"+this.index+"Config"]),BagCT.ins().getBagGoodsCountById(0,i.costItem)),a="";a=o>=n.cost?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR,o<n.cost?this.currentState="lock":this.currentState="active",this.validateNow(),this.tips.source="tjweijihuo"}else this.currentState="actived",this.validateNow(),this.tips.source="tjyijihuo";var r=0;if(s){for(var l="",h=0,u=0,p=0,c="",d=0;d<s.attrAward.length;d++)u=s.attrAward[d].type,15!=u&&13!=u&&(l=AttributeData.getAttrStrByType(u),h=s.attrAward[d].value,l.length<3&&(l=AttributeData.inserteBlank(l,7)),this["attr"+p].text=l+"：",u>1&&9>u?c=7==u||8==u?h/100+"%":h.toString():(u>12&&15>u||u>15)&&(c=u==AttributeType.atCritEnhance?h/100+150+"%":h/100+"%"),this["value"+p].text=c,p++);r=BagCT.getAttrPower(s.attrAward),r+=s.power,this.powerPanel.setPower(r),this.powerPanel.setMcVisible(!1);var g=GlobalConfig.ItemConfig[i.costItem];this.specialAttr.textFlow=TextFlowMaker.generateTextFlow1(g.desc),this.nameLabel.text=""+i.name}},e.prototype.sendUpgrade=function(){SpecialRing.ins().sendUpGrade(this.index,this.roleSelect.getCurRole())},e.prototype.openBuyGoods=function(){WarnCT.ins().setBuyGoodsWarn(GlobalConfig.ExRingConfig[this.index].costItem)},e.prototype.setRedPoint=function(){for(var t=SubRoles.ins().subRolesLen,e=0;t>e;e++){var i=SubRoles.ins().getSubRoleByIndex(e);this.roleSelect.showRedPoint(e,RoleCT.ins().roleHintCheck(i,this.index))}},e.prototype.getPower=function(){return"actived"==this.currentState?this.powerPanel.power:0},e}(BaseEuiView);__reflect(SpecialRingWin.prototype,"SpecialRingWin"),ViewManager.ins().reg(SpecialRingWin,LayerManager.UI_Main),window.SpecialRingWin=SpecialRingWin;var FireRingAbilityItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ActorExRingAbilityConfig[t];this.nameTxt.text=e.abilityName,this.descLabel.textFlow=TextFlowMaker.generateTextFlow(e.abilityDesc),this.imgIcon.source=e.abilityIcon;var i=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),n=SpecialRing.ins().getRingStair(i.level);n>=e.ringLv?this.stateLabel.text="":(this.stateLabel.text="("+SpecialRing.ins().getUnLockStage(t)+"阶解锁)",this.stateLabel.textColor=ColorUtil.RED_COLOR_N)},e}(eui.ItemRenderer);__reflect(FireRingAbilityItem.prototype,"FireRingAbilityItem"),window.FireRingAbilityItem=FireRingAbilityItem;var FireRingFb=function(t){function e(){var e=t.call(this)||this;return e.isUse=!1,e.name="副本",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.eMenuList.itemRenderer=FireRingFbItem;var e=CommonUtils.objectToArray(GlobalConfig.ActorExRingFubenExConfig);this.eMenuList.dataProvider=new eui.ArrayCollection(e),this.eMenuList.validateNow(),this.eItemList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=CommonUtils.objectToArray(GlobalConfig.ActorExRingFubenExConfig),e=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),i=SpecialRing.ins().getRingStair(e.level),n=0,s=0;s<t.length;s++)i>=t[s].tejieLv&&(n=s);this.eMenuList.selectedIndex=n,n>2&&(this.menuScroller.viewport.scrollH=this.eMenuList.getChildAt(0).width*(n-2)),this.addChangeEvent(this.eMenuList,this.onChoose),this.addTouchEvent(this,this.onTap),this.observe(FbCT.ins().postFbRingInfo,this.onUpdate),this.observe(BagCT.ins().postItemCountChange,this.UseToItem),this.onUpdate(),this.updateUI()},e.prototype.close=function(){this.removeTouchEvent(this,this.onTap),this.removeObserve(),DisplayUtils.removeFromParent(this.eff),this.eff=null},e.prototype.onChoose=function(t){this.onUpdate(),this.updateUI()},e.prototype.updateUI=function(){this.eItemList.dataProvider=new eui.ArrayCollection(GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1].rewardShow)},e.prototype.onUpdate=function(){this.isUse=!1;var t=FbCT.ins().fbRings,e=0,i=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1],n=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID),s=SpecialRing.ins().getRingStair(n.level),o=s>=i.tejieLv;t.canTakeAwardId>0?(e=1,this.currentState="free"):Recharge.ins().franchise?FbCT.ins().fbRings.challengeTime>0&&o?(this.currentState="sdget",e=1):(this.currentState="sdfb",e=0):(e=0,this.currentState="challenge"),this.validateNow(),this.onInitIndex(e,o)},e.prototype.UseToItem=function(){if(this.isUse){this.isUse=!1;var t=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1];FbCT.ins().sendChallengeFbRing(t.id)}},e.prototype.getChangeNum=function(t){void 0==t&&(t=Actor.vip);var e=GlobalConfig.ActorExRingFubenConfig.freeCount;return(GlobalConfig.ActorExRingFubenConfig.vipCount[t]||0)+e},e.prototype.onInitIndex=function(t,e){var i=FbCT.ins().fbRings,n=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1],s=n.rewardShow[0].count;if(this.eTips.visible=!e,this.eTips.text="特戒达到"+n.tejieLv+"阶解锁",0==t)if(this.btnChallenge.visible=!this.eTips.visible,this.lbTime.text="今日可挑战次数："+i.challengeTime,this.lbExp.text=""+s,i.challengeTime)this.btnChallenge.enabled=!0;else{for(var o=this.getChangeNum(),a=Actor.vip+1,r=this.getChangeNum(a);void 0!=r&&r>=o&&(a+=1,r=this.getChangeNum(a),void 0!=GlobalConfig.ActorExRingFubenConfig.vipCount[a]););r-o>0&&(this.lbTime.text=VipCT.getVipStr(a,!0)+"可挑战次数+"+(r-o))}else if(1==t){var l=GlobalConfig.ActorExRingFubenConfig.recPrice,h=0;Recharge.ins().franchise?this.lbSweepTime.text="今日可挑战次数："+i.challengeTime:s=GlobalConfig.ActorExRingFubenExConfig[i.canTakeAwardId].rewardShow[0].count;for(var u in l){this["lbExp"+h].textFlow=TextFlowMaker.generateTextFlow1("  "+s*+u);var p=GlobalConfig.ActorExRingFubenConfig.recPrice[u];this["gold"+h].setPrice(p),h+=1}0==Setting.ins().getValue(ClientSet.expFirst)&&(this.eff||(this.eff=new MovieClip,this.eff.scaleX=.75,this.eff.scaleY=.75,this.eff.touchEnabled=!1,this.eff.x=this.btnGet2.x+this.btnGet2.width/2,this.eff.y=this.btnGet2.y+this.btnGet2.height/2,this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.g2.addChild(this.eff))),Actor.level<80?(this.g1.visible=this.g2.visible=!1,this.g0.horizontalCenter=0):(this.g1.visible=this.g2.visible=!0,this.g0.horizontalCenter=-182)}},e.prototype.onTap=function(t){var e=t.target,i=FbCT.ins().fbRings;if(this.checkBtnGet(e));else if(e==this.btnChallenge){if(!KfArenaSys.ins().checkIsMatching())return;if(FbCT.ins().checkInFB())return;if(i.challengeTime<=0){var n="",s=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,ItemConst.FIRE_FB);return s?(n="确定使用1个<font color='#FFB82A'>"+s.itemConfig.name+"</font>道具进入挑战？\n",void WarnWin.show(n,function(){this.isUse=!0,BagCT.ins().sendUseItem(s.configID,1)},this)):i.buyTime<(GlobalConfig.ActorExRingFubenConfig.vipCount[Actor.vip]||0)?(n="是否花费"+GlobalConfig.ActorExRingFubenConfig.vipcost+"元宝挑战烈焰副本？",void WarnWin.show(n,function(){var t=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1];FbCT.ins().sendChallengeFbRing(t.id)},this)):(n="|C:0xff0000&T:挑战次数不足,无法挑战",void TipsCT.ins().showTips(n))}var o=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1];FbCT.ins().sendChallengeFbRing(o.id)}},e.prototype.checkBtnGet=function(t){var e=0;if(t==this.btnGet0?e=1:t==this.btnGet1?e=2:t==this.btnGet2&&(e=3),e>0){var i=GlobalConfig.ActorExRingFubenConfig.recPrice[e-1];if(Actor.yb<i)return void TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|");var n=FbCT.ins().fbRings;if(n.canTakeAwardId>0)FbCT.ins().sendFbRingTakeAward(e);else if(Recharge.ins().franchise){var s=GlobalConfig.ActorExRingFubenExConfig[this.eMenuList.selectedIndex+1];FbCT.ins().sendRingSweep(e,s.id)}else FbCT.ins().sendFbRingTakeAward(e)}return e>0},e}(BaseView);__reflect(FireRingFb.prototype,"FireRingFb"),window.FireRingFb=FireRingFb;var FireRingFbItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data;this.labelDisplay.text=""+t.id}},e}(eui.ItemRenderer);__reflect(FireRingFbItem.prototype,"FireRingFbItem"),window.FireRingFbItem=FireRingFbItem;var FireRingSkillBookItem=function(t){function e(){var e=t.call(this)||this;return e.isOpenSelectImg=!0,e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.onRemove,e),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChangeHandler=function(){var t=this.data.count;t>0?(this.itemIcon.imgIcon.filters=null,this.itemIcon.imgBg.filters=null):(this.itemIcon.imgIcon.filters=FilterUtil.ARRAY_GRAY_FILTER,this.itemIcon.imgBg.filters=FilterUtil.ARRAY_GRAY_FILTER)},e.prototype.onRemove=function(){this.itemIcon&&(this.itemIcon.imgIcon.filters=null,this.itemIcon.imgBg.filters=null)},e}(ItemBase);__reflect(FireRingSkillBookItem.prototype,"FireRingSkillBookItem"),window.FireRingSkillBookItem=FireRingSkillBookItem;var FireRingSkillItem=function(t){function e(){var e=t.call(this)||this;return egret.callLater(function(){var t=new egret.Shape;t.graphics.beginFill(65280),t.graphics.drawRoundRect(0,0,e.width,e.height,1,1),t.graphics.endFill(),t.alpha=0,e.addChild(t)},e),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this,e=this.data;if(e.isOpen)if(e.skillId){this.currentState="learn";var i=SpecialRing.ins().getActorExRingBookConfig(e.skillId,e.skillLvl);this.skillImg.source=i.skillIcon,this.skillLv.text="Lv"+e.skillLvl,this.skillName.text=i.skillName;var n=BagCT.ins().getBagGoodsCountById(0,i.itemId);this.redpoint.visible=n>=i.num&&e.skillLvl<SpecialRing.ins().getSkillMaxLvl(e.skillId)}else this.currentState="unlearn",this.redpoint.visible=SpecialRing.ins().isCanStudySkill();else{this.currentState="lock";var s=SpecialRing.ins().getSpecialRingDataById(SpecialRing.FIRE_RING_ID).level,o=SpecialRing.ins().getRingStair(s);if(o<SpecialRing.GRID_OPEN_LEVEL)egret.callLater(function(){t.skillName.text=SpecialRing.GRID_OPEN_LEVEL+"阶解锁"},this),this.price.visible=!1;else{this.price.visible=!0,egret.callLater(function(){t.skillName.text="未解锁"},this);var a=GlobalConfig.ActorExRingConfig[SpecialRing.FIRE_RING_ID];this.price.setPrice(a.skillGridYb)}}this.select.visible=this.selected},e.prototype.setSelect=function(t){this.select.visible=t},e}(eui.ItemRenderer);__reflect(FireRingSkillItem.prototype,"FireRingSkillItem"),window.FireRingSkillItem=FireRingSkillItem;var RingGainItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="RuneGainTipsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=this.data[0]},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(RingGainItem.prototype,"RingGainItem"),window.RingGainItem=RingGainItem;var SpecialRingItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ringtogglebtn",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=GlobalConfig.ActorExRingConfig[this.data.id];t&&(this.addEvent(),this.ringNameTxt.text=t.name,this.textBg.visible=this.data.level>0,this.data.level>0?(this.levelTxt.text=SpecialRing.ins().getRingStair(this.data.level)+"阶",this.openLv.text="",this.noopen.visible=!1,this.ringicon.source=t.icon):(this.levelTxt.text="",this.noopen.visible=!0,this.ringicon.source=t.icon+"a",t.openDay>0&&t.openVip>0?this.openLv.text="第"+t.openDay+"天或"+VipCT.getVipStr(t.openVip,!0)+"开启":t.openDay>0?this.openLv.text="第"+t.openDay+"天开启":t.openVip>0?this.openLv.text=VipCT.getVipStr(t.openVip,!0)+"开启":t.openYb>0&&(this.openLv.text=t.openYb+"元宝开启")),this.updateRedPoint())},e.prototype.addEvent=function(){this.isAddEvent||(this.isAddEvent=!0,MessageCenter.addListener(BagCT.ins().postItemAdd,this.updateRedPoint,this),MessageCenter.addListener(BagCT.ins().postItemDel,this.updateRedPoint,this),MessageCenter.addListener(BagCT.ins().postItemCountChange,this.updateRedPoint,this),MessageCenter.addListener(VipCT.ins().postUpdateVipData,this.updateRedPoint,this),MessageCenter.addListener(SpecialRing.ins().postActiveRing,this.updateRedPoint,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this))},e.prototype.onRemove=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.destruct()},e.prototype.destruct=function(){MessageCenter.ins().removeAll(this),this.isAddEvent=!1},e.prototype.updateRedPoint=function(){this.data.level>0?this.actTxt.visible=!1:this.data.id==SpecialRing.FIRE_RING_ID?this.actTxt.visible=SpecialRing.ins().isFireRingCanActivate():this.actTxt.visible=SpecialRing.ins().checkCanActive(this.data.id),this.openLv.visible=!this.actTxt.visible,this.redPoint.visible=SpecialRing.ins().checkRedPoint(this.data.id,this.data.level)},e}(BaseItemRender);__reflect(SpecialRingItem.prototype,"SpecialRingItem"),window.SpecialRingItem=SpecialRingItem;var StudySkillNeedItem=function(){function t(){}return t.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];this.itemIcon.setData(e),this.nameTxt.text=e.name},t}();__reflect(StudySkillNeedItem.prototype,"StudySkillNeedItem"),window.StudySkillNeedItem=StudySkillNeedItem;var LyMarkEffect=function(t){function e(e,i){var n=t.call(this)||this;return n._angle=.1,n._angles=[0,0,0,0,0,0,0],n._circleCenter={x:0,y:-72},n._a=60,n._b=30,n._oldBallNum=0,n._curTimes=0,n._isShowBall=!0,n._ring=e,n._infoModel=i,MessageCenter.addListener(LyMark.ins().postMarkData,n.dataChange,n),n.usedLyMarkSkill(),n}return __extends(e,t),e.prototype.dataChange=function(){this._infoModel&&this._infoModel.masterHandle==Actor.handle&&this.update()},Object.defineProperty(e.prototype,"_parent",{get:function(){return this._ring.parent},enumerable:!0,configurable:!0}),e.prototype.usedLyMarkSkill=function(){this.resetBalls(),Timer.stopAll(this);var t=this.getSkillLvById(1);if(t){var e=GlobalConfig.FlameStampEffect[1][t];t=this.getSkillLvById(3);var i=t?GlobalConfig.FlameStampEffect[3][t].reloadTime:0,n=e.skillId,s=e.stamp;this.getSkillLvById(2)&&(t=this.getSkillLvById(2),n=GlobalConfig.FlameStampEffect[2][t].skillId,s=GlobalConfig.FlameStampEffect[2][t].stamp);var o=(SkillUtil.getCD(GlobalConfig.SkillsConfig[n])-i)/s>>0;Timer.start(o,s,this.doTimer,this),this._curTimes=0}},e.prototype.doTimer=function(){this._curTimes++,this.updateBalls(this._curTimes)},e.prototype.update=function(){for(var t,e,i=0,n=0,s=0;6>=s;s++)n=t=this.getSkillLvById(s+1),t||(t=1),e=GlobalConfig.FlameStampEffect[s+1][t],s+1!=1&&s+1!=2||!n||(i=e.stamp);this.updateBalls(i)},e.prototype.updateBalls=function(t){if(this._ring&&this._parent&&t&&this._oldBallNum!=t){this.resetBalls(),this._oldBallNum=t,this._balls||(this._balls=[],Timer.start(51,0,this.doCircle,this));for(var e=void 0,i=2*Math.PI/t,n=0;t>n;n++)e=ObjectPool.pop("MovieClip"),this._isShowBall&&this._parent.addChild(e),this._angles[n]=i*n,e.x=this._a*Math.cos(i*n)+this._circleCenter.x,e.y=this._b*Math.sin(i*n)+this._circleCenter.y,this._balls.push(e),e.playFile(RES_DIR_SKILLEFF+"6204a",-1)}},e.prototype.doCircle=function(){if(!this._balls)return void Timer.stop(this.doCircle,this);if(this._isShowBall&&this._ring&&this._parent)for(var t,e,i=this._balls.length,n=0,s=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,n=e.getChildIndex(this._ring),s=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?s>n&&e.addChildAt(t,n):n>s&&e.addChildAt(t,e.numChildren)},e.prototype.resetBalls=function(){if(Timer.stop(this.doCircle,this),this._oldBallNum=0,this._balls){for(var t=this._balls.length,e=0;t>e;e++)DisplayUtils.removeFromParent(this._balls[e]);this._balls=null}},e.prototype.getSkillLvById=function(t){var e=this._infoModel.masterHandle==Actor.handle?LyMark.ins().skills:this._infoModel.lyMarkSkills;return!e||e.length<t?0:e[t-1]},e.prototype.showBall=function(){if(!this._isShowBall&&(this._isShowBall=!0,this.updateBalls(this._curTimes),this._balls&&this._parent))for(var t=this._balls.length,e=0;t>e;e++)this._parent.addChild(this._balls[e])},e.prototype.hideBall=function(){this._isShowBall&&(this._isShowBall=!1,this.resetBalls())},e.prototype.destruct=function(){this.resetBalls(),Timer.stopAll(this),this._ring=null,this._infoModel=null,MessageCenter.ins().removeAll(this)},e}(egret.HashObject);__reflect(LyMarkEffect.prototype,"LyMarkEffect"),window.LyMarkEffect=LyMarkEffect;var LyMarkMixItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="markMixItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.MixBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.dataChanged=function(){var t=this.data.cfg.costItem;this.limitLv.textFlow=TextFlowMaker.generateTextFlow1(this.data.cfg.mixDesc),this.cost.textFlow=TextFlowMaker.generateTextFlow1(t?"合成消耗："+("|C:"+(this.data.count?13746831:16711680)+"&T:"+this.data.itemName+" X"+this.data.cfg.costCount):""),this.stock.textFlow=TextFlowMaker.generateTextFlow1("当前拥有：|C:"+(this.data.itemCount?65280:16711680)+"&T:"+this.data.itemCount),this.MixBtn.label=t?"一键合成":"获取",this.MixBtn.enabled=!t||LyMark.ins().lyMarkLv>=this.data.cfg.limitLv,this.redpoint.visible=t&&LyMark.ins().lyMarkLv>=this.data.cfg.limitLv&&this.data.count>=this.data.cfg.costCount,this.itemIcon.data=this.data.cfg.itemId},e.prototype.onTap=function(t){this.data.cfg.costItem?this.data.count>=this.data.cfg.costCount?LyMark.ins().sendCompound(this.data.cfg.itemId):TipsCT.ins().showTips("材料不足"):WarnCT.ins().setBuyGoodsWarn(this.data.cfg.itemId)
},e.prototype.destruct=function(){this.MixBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e}(BaseItemRender);__reflect(LyMarkMixItemRender.prototype,"LyMarkMixItemRender"),window.LyMarkMixItemRender=LyMarkMixItemRender;var LyMarkMixWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="markMixSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list.itemRenderer=LyMarkMixItemRender},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTouch),this.observe(BagCT.ins().postItemAdd,this.update),this.observe(BagCT.ins().postItemChange,this.update),this.update()},e.prototype.close=function(){},e.prototype.update=function(){this._collect||(this._collect=new eui.ArrayCollection,this.list.dataProvider=this._collect);var t,e,i,n,s,o=[];for(var a in GlobalConfig.FlameStampMat)e=GlobalConfig.FlameStampMat[a],e.costItem?(t=BagCT.ins().getBagItemById(e.costItem),n=GlobalConfig.ItemConfig[e.costItem].name,i=t?t.count:0):(i=0,n=""),t=BagCT.ins().getBagItemById(e.itemId),s=t?t.count:0,o.push({cfg:e,count:i,itemName:n,itemCount:s});this._collect.source=o},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(LyMarkMixWin.prototype,"LyMarkMixWin"),ViewManager.ins().reg(LyMarkMixWin,LayerManager.UI_Main),window.LyMarkMixWin=LyMarkMixWin;var LyMarkPanel=function(t){function e(){var e=t.call(this)||this;return e._angle=.1,e._angles=[0,0,0,0,0,0,0],e._circleCenter={x:279,y:229},e._a=155,e._b=80,e._oldBallNum=0,e.expBar=new ProgressBarEff,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.mixItemTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:"+this.mixItemTxt.text),this.expBar.setWidth(470),this.expBar.x=-85,this.expBar.y=-15,this.schedule.addChild(this.expBar)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(LyMark.ins().postMarkData,this.update),this.observe(BagCT.ins().postItemAdd,this.updateMaterial),this.observe(BagCT.ins().postItemChange,this.updateMaterial),this.observe(BagCT.ins().postItemDel,this.updateMaterial),this.observe(LyMark.ins().postUpgrade,this.updateEff),this.addTouchEvent(this,this.onTouch),this._oldBallNum=0,this.update()},e.prototype.close=function(){this._materailInfo=null,this.resetBalls(),this.clearRedEff(),this.expBar.reset()},e.prototype.resetBalls=function(){if(Timer.stopAll(this),this._balls){for(var t=this._balls.length,e=0;t>e;e++)DisplayUtils.removeFromParent(this._balls[e]);this._balls.length=0,this._balls=null}},e.prototype.update=function(){var t=LyMark.ins().isMax,e=LyMark.ins().lyMarkLv;this.currentState=t?"max":"normal",this.lvtxt.text="Lv."+LyMark.ins().lyMarkLv;var i=[],n=GlobalConfig.FlameStampLevel[e];for(var s in n.attrs)i.push(new AttributeData(n.attrs[s].type,n.attrs[s].value));var o=BagCT.getAttrPower(i);if(this.nowAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"：")),this.expBar.getMaxValue()!=n.exp?this.expBar.setData(LyMark.ins().lyMarkExp,n.exp):this.expBar.setValue(LyMark.ins().lyMarkExp),t)this.clearRedEff(),this.updateMixEff();else{i=[];var a=GlobalConfig.FlameStampLevel[e+1];for(var s in a.attrs)i.push(new AttributeData(a.attrs[s].type,a.attrs[s].value));this.nextAttr.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(i,0,1,"："));var r=GlobalConfig.ItemConfig[n.costItem];this.costImg.source=r.icon+"_png",this.updateMaterial()}for(var l,h,u=0,p=0,c=0;6>=c;c++)p=l=LyMark.ins().getSkillLvById(c+1),l||(l=1),h=GlobalConfig.FlameStampEffect[c+1][l],this["skill"+c].setCfg(h),c+1!=1&&c+1!=2||!p||(u=h.stamp),p&&(o+=h.exPower);var d=SubRoles.ins().subRolesLen;if(this.power.setPower(o*d),u&&this._oldBallNum!=u){this.resetBalls(),this._oldBallNum=u,this._balls||(this._balls=[],Timer.start(51,0,this.doCircle,this));for(var g=void 0,f=2*Math.PI/u,c=0;u>c;c++)g=ObjectPool.pop("MovieClip"),this.img.parent.addChild(g),this._angles[c]=f*c,g.x=this._a*Math.cos(f*c)+this._circleCenter.x,g.y=this._b*Math.sin(f*c)+this._circleCenter.y,this._balls.push(g),g.playFile(RES_DIR_EFF+"FireRing1",-1)}},e.prototype.doCircle=function(){if(!this._balls)return void Timer.stopAll(this);for(var t,e,i=this._balls.length,n=0,s=0,o=0;i>o;o++)t=this._balls[o],t.x=this._a*Math.cos(this._angles[o])+this._circleCenter.x,t.y=this._b*Math.sin(this._angles[o])+this._circleCenter.y,this._angles[o]+=this._angle,this._angles[o]=this._angles[o]%(2*Math.PI),e=t.parent,n=e.getChildIndex(this.img),s=e.getChildIndex(t),this._angles[o]>=2.5&&this._angles[o]<=6?s>n&&e.addChildAt(t,3):n>s&&e.addChildAt(t,e.numChildren)},e.prototype.updateMaterial=function(){if(this.updateMixEff(),!LyMark.ins().isMax){var t=GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv],e=BagCT.ins().getBagItemById(t.costItem),i=e?e.count:0;this.costCount.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(i<t.costCount?"0xFF0000":"0x00FF00")+"&T:"+i+"|/"+t.costCount),this._materailInfo={enough:i>=t.costCount,id:t.costItem};var n=t.exp-LyMark.ins().lyMarkExp;i>=t.costCount&&i*GlobalConfig.FlameStampMat[t.costItem].exp>=n?this._redEffect||(this._redEffect=ObjectPool.pop("MovieClip"),this._redEffect.touchEnabled=!1,this.lvupGroup.addChild(this._redEffect),this._redEffect.x=77,this._redEffect.y=28,this._redEffect.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):this.clearRedEff()}},e.prototype.updateMixEff=function(){LyMark.ins().checkMixRed()?this.mixEff||(this.mixEff=ObjectPool.pop("MovieClip"),this.mixEff.touchEnabled=!1,this.mixGroup.addChild(this.mixEff),this.mixEff.scaleX=.6,this.mixEff.scaleY=.5,this.mixEff.x=40,this.mixEff.y=10,this.mixEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):this.clearMixEff()},e.prototype.clearRedEff=function(){this._redEffect&&(DisplayUtils.removeFromParent(this._redEffect),this._redEffect=null)},e.prototype.clearMixEff=function(){this.mixEff&&(DisplayUtils.removeFromParent(this.mixEff),this.mixEff=null)},e.prototype.onTouch=function(t){switch(t.target){case this.lvupBtn:this._materailInfo.enough?LyMark.ins().sendUpgrade():TipsCT.ins().showTips("材料不足");break;case this.mixItemTxt:ViewManager.ins().open(LyMarkMixWin);break;case this.skill0:case this.skill1:case this.skill2:case this.skill3:case this.skill4:case this.skill5:case this.skill6:ViewManager.ins().open(LyMarkSkillTipsWin,t.target.getCfg())}},e.prototype.updateEff=function(t){var e=t[0];if(e>1){var i=new eui.Image("xn_wingup"+e);i.horizontalCenter=0,i.verticalCenter=0,i.scaleX=i.scaleY=.5;var n=egret.Tween.get(i);n.to({scaleX:1.5,scaleY:1.5,alpha:0},500).call(function(){DisplayUtils.removeFromParent(i)},this),this.actEff.addChild(i)}},e}(BaseEuiView);__reflect(LyMarkPanel.prototype,"LyMarkPanel"),window.LyMarkPanel=LyMarkPanel;var LyMarkSkillItem=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.touchChildren=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.setCfg=function(t){this._cfg=t,this.update()},e.prototype.getCfg=function(){return this._cfg},e.prototype.addToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),MessageCenter.addListener(LyMark.ins().postMarkData,this.update,this),MessageCenter.addListener(BagCT.ins().postItemAdd,this.update,this),MessageCenter.addListener(BagCT.ins().postItemChange,this.update,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)},e.prototype.removeStage=function(t){MessageCenter.ins().removeAll(this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStage,this)},e.prototype.update=function(){if(this._cfg){this.skillImg.source=this._cfg.icon,this.skillName.textFlow=TextFlowMaker.generateTextFlow1(this._cfg.skillname);var t=LyMark.ins().getSkillLvById(this._cfg.id);if(this.lock.visible=!t,this.redpoint.visible=!1,1!=this._cfg.id){var e=t>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;if(e)return;var i=GlobalConfig.FlameStampEffect[this._cfg.id][0>=t?1:t+1];if(i.costItem){var n=(GlobalConfig.ItemConfig[i.costItem],BagCT.ins().getBagItemById(i.costItem)),s=n?n.count:0;this.redpoint.visible=s>=i.costCount&&LyMark.ins().lyMarkLv>=i.stampLevel}}}},e}(eui.Component);__reflect(LyMarkSkillItem.prototype,"LyMarkSkillItem"),window.LyMarkSkillItem=LyMarkSkillItem;var LyMarkSkillTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="markSkillTipsSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._cfg=t[0],this.addTouchEvent(this,this.onTouch),this.observe(LyMark.ins().postMarkData,this.resetCfg),this.observe(BagCT.ins().postItemAdd,this.updateData),this.observe(BagCT.ins().postItemChange,this.updateData),this.updateData()},e.prototype.resetCfg=function(){var t=LyMark.ins().getSkillLvById(this._cfg.id);t||(t=1),this._cfg=GlobalConfig.FlameStampEffect[this._cfg.id][t],this.updateData()},e.prototype.updateData=function(){this.currentState="skill"+(this._cfg.id-1),this.skillImg.source=this._cfg.icon,this.nametxt.text=this._cfg.skillname;var t=LyMark.ins().getSkillLvById(this._cfg.id);if(this.lvtxt.text="Lv."+t,this.redpoint.visible=!1,this.nextLevel.text="",1==this._cfg.id){var e=0,i=LyMark.ins().getSkillLvById(3),n=i?GlobalConfig.FlameStampEffect[3][i].reloadTime:0,s=this._cfg.skillId,o=this._cfg.stamp;t?LyMark.ins().getSkillLvById(2)&&(i=LyMark.ins().getSkillLvById(2),s=GlobalConfig.FlameStampEffect[2][i].skillId,o=GlobalConfig.FlameStampEffect[2][i].stamp):n=0;var a=GlobalConfig.SkillsConfig[s];e=(SkillUtil.getCD(a)-n)/1e3>>0,this.keyDesctxt.text="充能时间："+e+"秒",this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1("                "+SkillUtil.getDesc(a,["|C:65280&T:"+(e/o>>0)+"|","|C:65280&T:"+o+"|"])),this.damageDesctxt.textFlow=TextFlowMaker.generateTextFlow1("                "+(LyMark.ins().lyMarkLv?GlobalConfig.FlameStampLevel[LyMark.ins().lyMarkLv].bulletDesc:""))}else{2==this._cfg.id||3==this._cfg.id||7==this._cfg.id?this.keyDesctxt.text="最大等级："+Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length:this.keyDesctxt.text="触发概率："+(GlobalConfig.EffectsConfig[4==this._cfg.id?this._cfg.selfEffId:this._cfg.effId].probabilityBuff/100>>0)+"%",this.skillDesctxt.textFlow=TextFlowMaker.generateTextFlow1("                "+this._cfg.skillDesc);var r=t>=Object.keys(GlobalConfig.FlameStampEffect[this._cfg.id]).length;if(this.cost.visible=!1,this.update.visible=!1,!r){var l=GlobalConfig.FlameStampEffect[this._cfg.id][0>=t?1:t+1];if(l.costItem){var h=GlobalConfig.ItemConfig[l.costItem];this.costImg.source=h.icon+"_png";var u=BagCT.ins().getBagItemById(l.costItem),o=u?u.count:0;this.costNum.textFlow=TextFlowMaker.generateTextFlow1("|C:"+(o<l.costCount?16711680:13746831)+"&T:X "+l.costCount+"|"),this.redpoint.visible=o>=l.costCount&&LyMark.ins().lyMarkLv>=l.stampLevel,this._nextCfg=l,LyMark.ins().lyMarkLv>=l.stampLevel?(this.cost.visible=o<l.costCount,this.update.visible=!this.cost.visible):this.nextLevel.text="烈焰印记达到"+l.stampLevel+"级解锁升级"}else LyMark.ins().lyMarkLv<l.stampLevel&&(this.nextLevel.text="烈焰印记达到"+l.stampLevel+"级自动升级")}}this._uiEffect||(this._uiEffect=ObjectPool.pop("MovieClip"),this.uieff.addChild(this._uiEffect)),this._uiEffect.playFile(""+RES_DIR_EFF+this._cfg.uiEff,-1)},e.prototype.onTouch=function(t){switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.update:this.redpoint.visible?LyMark.ins().sendUpSkill(this._cfg.id):this._nextCfg.stampLevel>LyMark.ins().lyMarkLv?TipsCT.ins().showTips("需要烈焰印记达到"+this._nextCfg.stampLevel+"级"):TipsCT.ins().showTips("材料不足")}},e}(BaseEuiView);__reflect(LyMarkSkillTipsWin.prototype,"LyMarkSkillTipsWin"),ViewManager.ins().reg(LyMarkSkillTipsWin,LayerManager.UI_Main),window.LyMarkSkillTipsWin=LyMarkSkillTipsWin;var TargetListCC=function(t){function e(){var e=t.call(this)||this;return e.masterAtkTarget={},e.tipsCD=!1,e.attackMeHandles=[],e.canAttackHandles=[],e.observe(GameLogic.ins().postEntityHpChange,e.attackAndShowTip),e.observe(BattleCC.ins().postEnterSuccess,e.campChange),e.observe(GameLogic.ins().postAllAtkTarget,e.updateAtkTarget),e.observe(GameLogic.ins().postEnterMap,e.onEnterMap),e}return __extends(e,t),e.prototype.onEnterMap=function(){var t=this;this.masterAtkTarget={},this.attackMeHandles.length=0,this.canAttackHandles.length=0,Timer.stopAll(this),ViewManager.ins().close(TargetListPanel),Timer.start(600,1,function(){t.isShow&&(Timer.start(1e3,0,t.update,t),t.update(),GameMap.fbType!=FbCT.FB_TYPE_CITY&&ViewManager.ins().open(TargetListPanel))},this)},Object.defineProperty(e.prototype,"isShow",{get:function(){return CityCC.ins().isCity||BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||DarkMjBoss.ins().isDarkBoss||KFBossSys.ins().isKFBossBattle||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena||XuanWuCT.ins().isXuanWu||GameMap.fbType==FbCT.FB_TYPE_37BOSS||GameMap.fbType==FbCT.FB_TYPE_CONTEST||GameMap.fbType==FbCT.FB_TYPE_XMHJ||GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.fbType==FbCT.FB_TYPE_Legend||GameMap.fbType==FbCT.FB_TYPE_SMYJ||GameMap.fbType==FbCT.FB_TYPE_KING||GameMap.fbType==FbCT.FB_TYPE_GUILDFB},enumerable:!0,configurable:!0}),e.prototype.update=function(){return this.isShow?(this.postChangeCanAttackHandle(),void this.updateAttackMe()):(Timer.stopAll(this),void ViewManager.ins().close(TargetListPanel))},e.prototype.campChange=function(){if(BattleCC.ins().isBattle()){var t=void 0,e=EntityManager.ins().getAllEntity();for(var i in e)t=e[i],t&&t.infoModel&&t.infoModel.type==EntityType.Role&&(t.setCharName(t.infoModel.guildAndName),t.updateNameColor())}},e.prototype.postChangeCanAttackHandle=function(){var t,e=EntityManager.ins().getAllEntity();this.canAttackHandles.length=0;var i,n=!1,s=CityCC.ins().isCity||GwBoss.ins().isGwBoss||GwBoss.ins().isGwTopBoss||KFBossSys.ins().isKFBossBattle||DarkMjBoss.ins().isDarkBoss||DevildomSys.ins().isDevildomBattle||KfArenaSys.ins().isKFArena||GameMap.fbType==FbCT.FB_TYPE_XMHJ||GameMap.fbType==FbCT.FB_TYPE_SPIRIT||GameMap.fbType==FbCT.FB_TYPE_SMYJ||GameMap.fbType==FbCT.FB_TYPE_KING||GameMap.fbType==FbCT.FB_TYPE_GUILDFB;for(var o in e)if(t=e[o],i=t.infoModel)if(i.type==EntityType.Role||i.type==EntityType.LadderPlayer)KfArenaSys.ins().isKFArena?i.camp>0&&i.camp!=KfArenaSys.ins().myCampId&&this.updateCanAttackHandle(i.masterHandle,!0):0==t.isSafety()&&i.getAtt(AttributeType.atHp)>0&&(BattleCC.ins().isBattle()?i.camp>0&&i.camp!=BattleCC.ins().camp&&this.updateCanAttackHandle(i.masterHandle,!0):DevildomSys.ins().isDevildomBattle?(!i.guildID||i.guildID&&i.guildID!=Guild.ins().guildID)&&this.updateCanAttackHandle(t.infoModel.masterHandle,!0):GameMap.fbType==FbCT.FB_TYPE_GUILDFB||this.updateCanAttackHandle(i.masterHandle,!0,!1,t));else if(i.type==EntityType.Monster&&i.getAtt(AttributeType.atHp)>0&&!n){if(s)continue;var a=GlobalConfig.MonstersConfig[i.configID];if(!a)continue;if(a.type==MonsterType.Ring||a.type==MonsterType.Summon)continue;if(!this.checkMonHead(a))continue;-1==GlobalConfig.CampBattleConfig.noAttack.indexOf(i.configID)&&(n=!0,this.updateCanAttackHandle(i.handle,!0,!0))}if(KFBossSys.ins().isKFBossBattle&&KFBossSys.ins().flagHandle&&KFBossSys.ins().flagTimes>0)for(var o in GlobalConfig.CrossBossConfig)if(GameMap.fubenID==GlobalConfig.CrossBossConfig[o].fbid&&1==GlobalConfig.CrossBossConfig[o].hasFlag)return void this.updateCanAttackHandle(KFBossSys.ins().flagHandle,!0,!0)},e.prototype.checkMonHead=function(t){return!Assert(t.head,"怪物头像不存在1，id:"+t.id+",name:"+t.name)},e.prototype.updateAttackMe=function(){for(var t=0,e=this.attackMeHandles;t<e.length;t++){var i=e[t],n=EntityManager.ins().getMasterList(i);if(n&&0!=n.length){for(var s=!0,o=0,a=n;o<a.length;o++){var r=a[o];if(r&&r.infoModel&&r.infoModel.getAtt(AttributeType.atHp)>0){s=!1;break}}s&&this.postTargetList(i,0)}else this.postTargetList(i,0)}},e.prototype.clear=function(){this.attackMeHandles.length=0,this.canAttackHandles.length=0,GameLogic.ins().currAttackHandle=0,BossCT.ins().monsterID=0},e.prototype.updateCanAttackHandle=function(t,e,i,n){void 0===i&&(i=!1);var s=EntityManager.ins().getRootMasterHandle(t);if(0!=s&&s!=Actor.handle){var o=n?MathUtils.getDistanceByObject(SubRoles.lookAtTar,n):0;if(GameMap.fbType==FbCT.FB_TYPE_SMYJ){var a=GameMap.CELL_SIZE*GlobalConfig.DevilRuinsBase.space,r=GlobalConfig.DevilRuinsBossConfig[KFSmyjBossCT.ins().fbKind];if(o>a||r&&r[1]&&!r[1].showBelong)return}else if(GameMap.fbType==FbCT.FB_TYPE_Legend){var a=GameMap.CELL_SIZE*GlobalConfig.LegendTowerBaseConfig.showSpace;if(o>a)return}var l=this.canAttackHandles.indexOf(s);e&&-1==l?i?this.canAttackHandles.unshift(s):this.canAttackHandles.push(s):e||-1==l||this.canAttackHandles.splice(l,1)}},e.prototype.postTargetList=function(t,e){if(0!=t||0!=e){var i=EntityManager.ins().getRootMasterHandle(t),n=EntityManager.ins().getRootMasterHandle(e);if(i!=n)if(i==Actor.handle){var s=EntityManager.ins().getEntityByHandle(e);if(s&&s.infoModel&&s.infoModel.type==EntityType.CollectionMonst)return;if(s&&s.infoModel&&s.infoModel.getAtt(AttributeType.atHp)>0)if(s.infoModel.type==EntityType.Monster){var o=GlobalConfig.MonstersConfig[s.infoModel.configID];if(o&&(o.type==MonsterType.Ring||o.type==MonsterType.Summon?GameLogic.ins().postChangeTarget(s.infoModel.masterHandle):GameLogic.ins().postChangeTarget(s.infoModel.handle),!o.head)){var a="";CityCC.ins().isCity&&(a+="isCity = true"),PaoDianCC.ins().isPaoDian&&(a+="|isPaoDian = true"),BattleCC.ins().isBattle()&&(a+="|isBattle = true"),GwBoss.ins().isGwBoss&&(a+="|isGwBoss = true"),GwBoss.ins().isGwTopBoss&&(a+="|isGwTopBoss = true"),KFBossSys.ins().isKFBossBattle&&(a+="|isKFBossBattle = true"),DevildomSys.ins().isDevildomBattle&&(a+="|isDevildomBattle = true"),KfArenaSys.ins().isKFArena&&(a+="|isKFArena = true"),DarkMjBoss.ins().isDarkBoss&&(a+="|isDarkBoss = true"),Assert(o.head,"postTargetList 怪物头像不存在，id:"+o.id+",name:"+o.name+",fbType:"+GameMap.fbType+",fbId:"+GameMap.fubenID+",ms:"+s.infoModel.masterHandle+" "+a)}}else GameLogic.ins().postChangeTarget(s.infoModel.masterHandle);else GameLogic.ins().postChangeTarget(0),ViewManager.ins().close(TargetPlayerBigBloodPanel);ViewManager.ins().isShow(TargetListPanel)&&ViewManager.ins().getView(TargetListPanel).showTarget(0!=e)}else if(0==n){var r=this.attackMeHandles.indexOf(i);-1!=r&&this.attackMeHandles.splice(r,1)}}},e.prototype.attackAndShowTip=function(t){var e=t[0],i=t[1],n=(t[2],t[3]);if(this.isShow&&e&&i&&!(0>=n)&&(e.isMy||i.isMy)){var s=EntityManager.ins().getRootMasterHandle(i.infoModel.handle),o=EntityManager.ins().getRootMasterHandle(e.infoModel.handle);if(o!=Actor.handle&&s==Actor.handle)return void(0==GameLogic.ins().currAttackHandle||ViewManager.ins().isShow(TargetPlayerBigBloodPanel)||(BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian?ViewManager.ins().open(TargetPlayerBigBloodPanel):CityCC.ins().isCity&&0==CityCC.ins().cityBossId&&ViewManager.ins().open(TargetPlayerBigBloodPanel)));var a=this.attackMeHandles.indexOf(s);-1==a&&o==Actor.handle&&s!=Actor.handle&&this.masterAtkTarget[s]==o&&(i.infoModel.type==EntityType.Role||i.infoModel.type==EntityType.LadderPlayer)&&(this.attackMeHandles.push(s),this.attackMeHandles.length>0&&(ViewManager.ins().isShow(TargetListPanel)||(ViewManager.ins().open(TargetListPanel),CityCC.ins().postChangeAttStatue(1))),this.postTargetList(0,0)),e.infoModel.isMy&&e.infoModel.getAtt(AttributeType.atHp)<=0&&!SubRoles.lookAtTar&&ViewManager.ins().isShow(TargetListPanel)&&ViewManager.ins().getView(TargetListPanel).showTarget(!1)}},e.prototype.updateAtkTarget=function(t){var e=t[0],i=t[1],n=EntityManager.ins().getRootMasterHandle(e),s=EntityManager.ins().getRootMasterHandle(i);this.masterAtkTarget[n]=s},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postChangeCanAttackHandle",null),__decorate([post()],e.prototype,"postTargetList",null),e}(BaseSystem);__reflect(TargetListCC.prototype,"TargetListCC"),System.TargetListCC=function(){return TargetListCC.ins()},window.TargetListCC=TargetListCC;var TargetListPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="TargetListSkin",e.list1.itemRenderer=WorldBossHeadRender,e.list2.itemRenderer=TargetMemberHeadRender,e.list3.itemRenderer=TargetMemberHeadRender,e.list1.name="tar.list1",e.list2.name="tar.list2",e.list3.name="tar.list3",e.list2Dt=new eui.ArrayCollection,e.list2Dt.source=TargetListCC.ins().canAttackHandles,e.list2.dataProvider=e.list2Dt,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.update(),Timer.has(this.update,this)||Timer.start(1e3,0,this.update,this),this.attackGroup0.visible=!1,this.canAttackGroup0.visible=!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.has(this.update,this)&&Timer.stop(this.update,this)},e.prototype.update=function(){this.updateTarget(),this.updateBeAttackList(),this.updateCanAttackList()},e.prototype.showTarget=function(t){this.attackGroup0.visible=t},e.prototype.updateTarget=function(){if(this.attackGroup0.visible)if(this.list1.dataProvider){var t=this.list1.dataProvider;t.replaceAll([GameLogic.ins().currAttackHandle])}else this.list1.dataProvider=new eui.ArrayCollection([GameLogic.ins().currAttackHandle])},e.prototype.updateBeAttackList=function(){var t=TargetListCC.ins().attackMeHandles;if(this.beAttackGroup0.visible=t.length>0,this.beAttackGroup0.visible)if(this.list3.dataProvider){var e=this.list3.dataProvider;e.replaceAll(t)}else this.list3.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateCanAttackList=function(){if(!KfArenaSys.ins().isKFArena){var t=TargetListCC.ins().canAttackHandles;this.canAttackGroup0.visible=t.length>0,this.canAttackGroup0.visible&&this.list2Dt.replaceAll(TargetListCC.ins().canAttackHandles)}},e}(BaseEuiView);__reflect(TargetListPanel.prototype,"TargetListPanel"),System.TargetListPanel=function(){return ViewManager.ins().reg(TargetListPanel,LayerManager.Main_View)},window.TargetListPanel=TargetListPanel;var TargetMemberHeadRender=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onTap,e),e}return __extends(e,t),e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.removeAttEffect()},e.prototype.onTap=function(t){if(!isNaN(this.data)){if(this.showEffect(),SysSetting.ins().setValue("mapClickTx",0),SysSetting.ins().setValue("mapClickTy",0),KfArenaSys.ins().isKFArena){if(!KfArenaSys.ins().checkFBOperat(KfArenaSys.ins().flagHandle==parseInt(this.data)))return;var e=SubRoles.lookAtTar;if(e&&e.isSafety()){var i=GlobalConfig.CrossArenaBase.readyPos[KfArenaSys.ins().readyIndex-1].tranferPoint;return GameMap.moveTo((i.x+.5)*GameMap.CELL_SIZE>>0,i.y*GameMap.CELL_SIZE>>0),void EntrustManager.ins().regEntrusTask(EntrustType.Transfer,this.touchDo,this)}}this.touchDo()}},e.prototype.touchDo=function(){if(KFBossSys.ins().flagHandle==parseInt(this.data))KFBossSys.ins().flagCD-egret.getTimer()>0?TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:旗子未刷新！|"):KFBossSys.ins().sendCollectFlag();else if(KfArenaSys.ins().flagHandle==parseInt(this.data)){if(KfArenaSys.ins().flagCD-egret.getTimer()>0)return void TipsCT.ins().showTips("|C:"+ColorUtil.RED+"&T:天书未刷新！|");KfArenaSys.ins().sendCollectFlag()}else GameLogic.ins().postChangeAttrPoint(this.data)},e}(WorldBossHeadRender);__reflect(TargetMemberHeadRender.prototype,"TargetMemberHeadRender"),window.TargetMemberHeadRender=TargetMemberHeadRender;var TargetPlayerBigBloodPanel=function(t){function e(){var e=t.call(this)||this;return e.curValue=1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TargetPlayerSmallBloodSkin",this.bloodBar.slideDuration=0,this.grayImg.source="bosshp2",e.GRAYIMG_WIDTH=this.grayImg.width,this.bloodBar.labelDisplay.visible=!1,this.playerBloodGroup.top=BattleCC.ins().isBattle()||PaoDianCC.ins().isPaoDian?this.playerBloodGroup.top:60},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(GameLogic.ins().postChangeTarget,this.updateTarget),this.updateTarget(),Timer.has(this.changeHp,this)||Timer.start(500,0,this.changeHp,this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.grayImg&&egret.Tween.removeTweens(this.grayImg),this.currAttackHandle=0,Timer.has(this.changeHp,this)&&Timer.stop(this.changeHp,this)},e.prototype.changeHp=function(){if(0!=this.currAttackHandle){var t=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(t&&t.length>0){for(var e=t.length,i=0,n=0,s=0,o=0,a=0;e>a;a++){var r=t[a];if(r){var l=r.infoModel.getAtt(AttributeType.atHp)||0,h=r.infoModel.getAtt(AttributeType.atMaxHp)||0;i+=l,n+=h;var u=r.infoModel.getAtt(AttributeType.cruNeiGong)||0,p=r.infoModel.getAtt(AttributeType.maxNeiGong)||0;s+=u,o+=p}}BattleCC.ins().isBattle()&&(i=i/n*100,n=100),this.hudunbloodBar0.maximum=o,this.hudunbloodBar0.value=s,this.bloodBar.maximum=n,this.bloodBar.value=i,this.curValue=Math.floor(i/n*100),this.tweenBlood()}else{var c=EntityManager.ins().getEntityByHandle(this.currAttackHandle);c&&c.infoModel&&c.infoModel.type==EntityType.Monster&&(this.hudunbloodBar0.maximum=c.infoModel.getAtt(AttributeType.maxNeiGong)||0,this.hudunbloodBar0.value=c.infoModel.getAtt(AttributeType.cruNeiGong)||0,this.bloodBar.maximum=c.infoModel.getAtt(AttributeType.atMaxHp)||0,this.bloodBar.value=c.infoModel.getAtt(AttributeType.atHp)||0,this.curValue=Math.floor(this.bloodBar.value/this.bloodBar.maximum*100),this.tweenBlood())}}},e.prototype.updateTarget=function(){if(0==GameLogic.ins().currAttackHandle&&ViewManager.ins().close(this),0!=this.currAttackHandle&&this.currAttackHandle!=GameLogic.ins().currAttackHandle&&(this.currAttackHandle=GameLogic.ins().currAttackHandle,0!=this.currAttackHandle)){var t=void 0,e=EntityManager.ins().getEntitysBymasterhHandle(this.currAttackHandle,EntityType.Role);if(e&&e.length>0){t=e[0].infoModel;var i=t.name,n=i.split("\n");i=n[1]?n[1]:n[0],this.nameTxt.textFlow=TextFlowMaker.generateTextFlow(i),this.head.source="yuanhead"+t.job+t.sex,this.changeHp()}else{var s=EntityManager.ins().getEntityByHandle(this.currAttackHandle);if(s&&s.infoModel&&s.infoModel.type==EntityType.Monster){var o=GlobalConfig.MonstersConfig[s.infoModel.configID];this.nameTxt.textFlow=(new egret.HtmlTextParser).parser(o.name),this.head.source="monhead"+o.head+"_png",this.changeHp()}}}},e.prototype.tweenBlood=function(){var t=this,i=this.curValue*e.GRAYIMG_WIDTH/100;if(egret.Tween.removeTweens(this.grayImg),!(3>i)){var n=egret.Tween.get(this.grayImg);n.to({width:i-3},1e3).call(function(){0>=i&&(t.grayImg.width=0,egret.Tween.removeTweens(t.grayImg),ViewManager.ins().close(t))},this)}},e.GRAYIMG_WIDTH=0,__decorate([callLater],e.prototype,"changeHp",null),__decorate([callLater],e.prototype,"updateTarget",null),e}(BaseEuiView);__reflect(TargetPlayerBigBloodPanel.prototype,"TargetPlayerBigBloodPanel"),System.TargetPlayerBigBloodPanel=function(){return ViewManager.ins().reg(TargetPlayerBigBloodPanel,LayerManager.Main_View)},window.TargetPlayerBigBloodPanel=TargetPlayerBigBloodPanel;var AchievementData=function(){function t(){}return t}();__reflect(AchievementData.prototype,"AchievementData"),window.AchievementData=AchievementData;var LimitTaskData=function(){function t(){this.id=0,this.name="",this.desc="",this.target=0,this.control=0,this.type=0,this.state=0,this.progress=0}return t.prototype.setBaseData=function(t){this.id=t.id,this.name=t.name,this.desc=t.desc,this.target=t.target,this.awardList=t.awardList,this.control=t.control,this.controlTarget=t.controlTarget,this.type=t.type},t.prototype.parser=function(t){this.progress=t.readInt(),this.state=t.readByte()},t}();__reflect(LimitTaskData.prototype,"LimitTaskData"),window.LimitTaskData=LimitTaskData;var TaskCT=function(t){function e(){var e=t.call(this)||this;return e.investmentAllTask=[],e.dayNum=0,e.isInit=!0,e.limitTaskList=[],e.limitTaskDic={},e.limitTaskState=0,e.limitTaskCount=0,e.limitTaskEndTime=-1,e.currTaskListsId=-1,e.sysId=PackageID.Task,e.regNetMsg(1,e.doTaskData),e.regNetMsg(2,e.doTaskChangeData),e.regNetMsg(3,e.doVitality),e.regNetMsg(4,e.doVitalityAwards),e.regNetMsg(5,e.doAchieveData),e.regNetMsg(7,e.doJoinAchieveData),e.regNetMsg(8,e.doAchieveChangeData),e.regNetMsg(9,e.doLimitDataChange),e.regNetMsg(10,e.doUpdateLimitData),e.regNetMsg(11,e.onEncounterTaskData),e.regNetMsg(12,e.postInvestmentTaskData),e.regNetMsg(13,e.postOneInvestmentTask),e.regNetMsg(14,e.postCloseInvestmentTask),e.achiEvement=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onEncounterTaskData=function(t){var e=EncounterTreasureData.ins().parseTaskData(t);if(e[0]){var i=e[0],n=GlobalConfig.DailyLineConfig[i.taskId];0!=i.taskStat||0==i.taskVar||this.isInit||TipsCT.ins().showCenterTips("解封秘宝"+i.taskVar+"/"+n.target),this.isInit=!1}return e},e.prototype.finishTreasureMission=function(t){var e=this.getBytes(7);e.writeByte(t),this.sendToServer(e)},e.prototype.sendGetTask=function(t){var e=this.getBytes(1);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetVitalityAwards=function(t){var e=this.getBytes(2);e.writeInt(t),this.sendToServer(e)},e.prototype.sendGetAchieve=function(t){var e=this.getBytes(3);e.writeInt(t),this.sendToServer(e)},e.prototype.doTaskData=function(t){this.task=[],this.vitalityAwards=[];for(var e=t.readInt(),i=0;e>i;i++){var n=new TaskData;n.id=t.readInt(),n.value=t.readInt(),n.state=t.readInt(),this.task.push(n)}this.vitality=t.readInt();for(var s=t.readInt(),i=0;s>i;i++){var o=new VitalityData;o.id=t.readInt(),o.state=t.readInt(),this.vitalityAwards.push(o)}this.sortTask()},e.prototype.doTaskChangeData=function(t){var e=t.readInt(),i=this.getTaskDataById(e);ErrorLog.Assert(i,"TaskCT  doTaskChangeData id  = "+e)||(i.value=t.readInt(),i.state=t.readInt(),this.sortTask(),this.postTaskChangeData())},e.prototype.postTaskChangeData=function(){},e.prototype.doVitality=function(t){this.vitality=t.readInt()},e.prototype.doVitalityAwards=function(t){var e=t.readInt(),i=this.getVitalityAwardsById(e);i.state=t.readInt(),this.postTaskChangeData()},e.prototype.doAchieveData=function(t){this.achiEvement.length=0;for(var e=t.readInt(),i=0;e>i;i++){var n=new AchievementData;n.achievementId=t.readInt(),n.id=t.readInt(),n.state=t.readInt(),n.value=t.readInt();var s=this.getAchieveConfById(n.id);null==s?console.warn("无法获得成就配置:"+n.id+"，请检查配置"):n.achievementType=s.achievementType,1e3==n.achievementId?(this.taskTrace=n,100003==this.taskTrace.id&&0==this.taskTrace.state,this.postUpdteTaskTrace()):this.achiEvement.push(n)}this.sortAchiEvement(),this.postUpdateAchieve()},e.prototype.getTaskData=function(t,e){for(var i,n=this.achiEvement.length,s=0;n>s;s++){var o=this.achiEvement[s];if(o.achievementId==t&&o.id==e){i=o;break}}return i},e.prototype.getTaskTarget=function(t){var e=0,i=this.getAchieveConfById(t);return i&&(e=i.target),e},e.prototype.postUpdateAchieve=function(){},e.prototype.postUpdteTaskTrace=function(){},e.prototype.postUpdteLimitTaskData=function(t){return t},e.prototype.doJoinAchieveData=function(t){this.changeAchieve(t)},e.prototype.doAchieveChangeData=function(t){this.changeAchieve(t)},e.prototype.doLimitDataChange=function(t){var e=t.readByte();if(this.limitTaskState=e,this.limitTaskCount=0,0==e)this.currTaskListsId=t.readInt(),this.initLimitTaskData(this.currTaskListsId);else if(1==e){this.currTaskListsId=t.readInt(),this.initLimitTaskData(this.currTaskListsId),this.limitTaskEndTime=t.readInt();var i=GlobalConfig.LimitTimeConfig[this.currTaskListsId];1==this.currTaskListsId&&i.time==this.limitTaskEndTime&&ViewManager.ins().open(LimitStartTipsView),this.limitTaskEndTime+=Math.floor(GameServer.serverTime/1e3);for(var n=t.readShort(),s=0;n>s;s++){var o=t.readInt();this.limitTaskDic[o].parser(t),2==this.limitTaskDic[o].state&&this.limitTaskCount++
}}this.postUpdteLimitTaskData()},e.prototype.initLimitTaskData=function(t){this.limitTaskList=[],this.limitTaskDic={};var e=GlobalConfig.LimitTimeConfig[t];for(var i in e.taskIds){var n=GlobalConfig.LimitTimeTaskConfig[e.taskIds[i]],s=new LimitTaskData;s.setBaseData(n),this.limitTaskList.push(s),this.limitTaskDic[s.id]=s}},e.prototype.doUpdateLimitData=function(t){var e=t.readInt(),i=this.limitTaskDic[e];return i?(i.parser(t),2==i.state&&this.limitTaskCount++,void this.postUpdteLimitTaskData(i)):void console.log("限时任务未初始化："+e)},e.prototype.sendGetLimitTask=function(){this.sendBaseProto(5)},e.prototype.sendGetLimitTaskReward=function(t){var e=this.getBytes(6);e.writeInt(t),this.sendToServer(e)},e.prototype.changeAchieve=function(t){var e,i=t.readInt();e=1e3==i?this.taskTrace:this.getAchieveDataById(i),ErrorLog.Assert(e,"TaskCT  data is null  achievementId = "+i)||(e.id=t.readInt(),e.state=t.readInt(),e.value=t.readInt(),1e3==e.achievementId?this.postUpdteTaskTrace():(this.sortAchiEvement(),this.postTaskChangeData()))},e.prototype.getChengjiuDataByType=function(t){if(void 0==this.achiEvement)return void console.log("通过成就类型获取成就数据  achiEvement = null");for(var e=[],i=0;i<this.achiEvement.length;i++)this.achiEvement[i].achievementType==t&&e.push(this.achiEvement[i]);return this.sortAchievementAcByType(e)},e.prototype.sortAchievementAcByType=function(t){return t&&t.sort(function(t,e){return 2==t.state?1:2==e.state?-1:e.state-t.state}),t},e.prototype.getAchieveDataById=function(t){if(void 0==this.achiEvement)return void console.log("通过成就类型获取成就数据  achiEvement = null");for(var e=0;e<this.achiEvement.length;e++)if(this.achiEvement[e].achievementId==t)return this.achiEvement[e];return null},e.prototype.getAchieveByTaskId=function(t){for(var e=0;e<this.achiEvement.length;e++)if(this.achiEvement[e].id==t)return this.achiEvement[e];return null},e.prototype.getVitalityAwardsById=function(t){for(var e=0;e<this.vitalityAwards.length;e++)if(this.vitalityAwards[e].id==t)return this.vitalityAwards[e];return null},e.prototype.getTaskDataById=function(t){if(!this.task)return null;for(var e=0;e<this.task.length;e++)if(this.task[e].id==t)return this.task[e];return null},e.prototype.getAchieveConfById=function(t){if(!this.achiTaskConfig){this.achiTaskConfig={};var e=GlobalConfig.AchievementTaskConfig;for(var i in e)this.achiTaskConfig[e[i].taskId]=e[i]}return this.achiTaskConfig[t]},e.prototype.getAwardsConfigById=function(t){var e,i=GlobalConfig.DailyAwardConfig;for(e in i){var n=i[e];if(n.id==t)return n}return null},e.prototype.getTaskStast=function(){if(this.task){var t=void 0;for(t=0;t<this.task.length;t++)if(1==this.task[t].state)return void this.postUpdataTaskPoint(!0);for(t=0;t<this.vitalityAwards.length;t++){var e=this.getAwardsConfigById(this.vitalityAwards[t].id);if(this.vitality>=e.valueLimit&&0==this.vitalityAwards[t].state)return void this.postUpdataTaskPoint(!0)}for(t=0;t<this.achiEvement.length;t++)if(1==this.achiEvement[t].state)return void this.postUpdataTaskPoint(!0);return void this.postUpdataTaskPoint(!1)}},e.prototype.postUpdataTaskPoint=function(t){return t},e.prototype.sortTask=function(){if(this.task.length>2){this.task.sort(this.sort);for(var t=[],e=0;e<this.task.length;e++)0!=this.task[e].state&&(t.push(this.task[e]),this.task.splice(e,1),e--);t.length>0&&(this.task=this.task.concat(t))}},e.prototype.sort=function(t,e){return Algorithm.sortAsc(t.id,e.id)},e.prototype.sortAchiEvement=function(){for(var t=0;t<this.achiEvement.length;t++){var e=this.achiEvement[t];1==e.state?(this.achiEvement.splice(t,1),this.achiEvement.unshift(e)):2==e.state&&(this.achiEvement.splice(t,1),this.achiEvement.push(e))}},e.prototype.getIsOpenChengjiu=function(){return Actor.level>=7},e.prototype.getIsHaveChengjiuReward=function(){if(!this.getIsOpenChengjiu())return!1;for(var t=LiLian.ins().chengjiuMaxData(),e=0,i=t;e<i.length;e++){var n=i[e],s=this.getChengjiuDataByType(n);if(void 0==s)return void console.log("是否有成就奖励可领取 datas = null");for(var o=0,a=s;o<a.length;o++){var r=a[o];if(1==r.state)return!0}}return!1},e.prototype.getIsHaveChengjiuRewardBytype=function(t){for(var e=this.getChengjiuDataByType(t),i=0,n=e;i<n.length;i++){var s=n[i];if(1==s.state)return!0}return!1},e.prototype.getTaskState=function(){var t=this.taskTrace;if(t){var e=this.getAchieveConfById(t.id+1);return e||2!=t.state?!0:!1}return!1},e.prototype.getLimitTaskRed=function(){for(var t=0;t<this.limitTaskList.length;t++)if(1==this.limitTaskList[t].state)return 1;return 0},e.prototype.postParabolicItem=function(){},e.prototype.getLimitTimeId=function(t){for(var e in GlobalConfig.LimitTimeConfig){var i=GlobalConfig.LimitTimeConfig[e];if(-1!=i.taskIds.indexOf(t))return i.id}return 0},e.prototype.sendInvestmentTaskData=function(t,e){var i=this.getBytes(12);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postInvestmentTaskData=function(t){var e=t.readUnsignedShort();this.investmentAllTask=[];for(var i=0;e>i;i++){var n=t.readInt(),s={cfgId:n,overTime:t.readInt(),tasks:this.parserInvestmentTask(t,n),activityId:0};this.investmentAllTask[s.cfgId]=s;var o=t.readInt(),a=t.readInt();s.activityId=a;var r=Activity.ins().activityData[a];if(r)r.update(t);else switch(o){case ActivityDataType._41:var l=GlobalConfig.ActivityConfig[a];r=new ActivityType41Data(t),r.id=a,r.pageStyle=l.pageStyle,r.pageSkin=l.pageSkin,Activity.ins().activityData[a]=r;break;default:t.readByte()}}Activity.ins().postActivityIsGetAwards()},e.prototype.parserInvestmentTask=function(t,e){for(var i=t.readUnsignedInt(),n=[],s=0;i>s;s++){var o={taskIndex:t.readUnsignedShort(),param:t.readUnsignedInt(),status:0,isAct:!1},a=t.readByte(),r=1&a,l=a>>1&1,h=GlobalConfig.InvestmentTaskConfig[e][o.taskIndex].target||0;o.status=1==r?2:o.param<h?0:1,o.isAct=1==l,n[o.taskIndex]=o}return n},e.prototype.postOneInvestmentTask=function(t){var e=t.readUnsignedInt(),i=t.readUnsignedShort(),n=t.readInt(),s=t.readByte(),o=this.getInvestmentTask(e,i);if(o){var a=GlobalConfig.InvestmentTaskConfig[e][o.taskIndex].target||n+1;o.param=n,o.status=1==s?2:o.param<a?0:1,Activity.ins().postActivityIsGetAwards()}},e.prototype.postCloseInvestmentTask=function(t){var e=t.readUnsignedInt(),i=this.getInvestmentAllTask(e);if(i){var n=i.activityId;Activity.ins().activityData[n]=null,delete Activity.ins().activityData[n],Activity.ins().postActivityIsGetAwards()}},e.prototype.getInvestmentAllTask=function(t){return this.investmentAllTask[t]},e.prototype.getInvestmentTask=function(t,e){var i=this.getInvestmentAllTask(t);return i&&i.tasks?i.tasks[e]:null},__decorate([post()],e.prototype,"onEncounterTaskData",null),__decorate([post()],e.prototype,"postTaskChangeData",null),__decorate([post()],e.prototype,"postUpdateAchieve",null),__decorate([post()],e.prototype,"postUpdteTaskTrace",null),__decorate([post()],e.prototype,"postUpdteLimitTaskData",null),__decorate([post()],e.prototype,"postUpdataTaskPoint",null),__decorate([post()],e.prototype,"postParabolicItem",null),__decorate([post()],e.prototype,"postInvestmentTaskData",null),__decorate([post()],e.prototype,"postOneInvestmentTask",null),__decorate([post()],e.prototype,"postCloseInvestmentTask",null),e}(BaseSystem);__reflect(TaskCT.prototype,"TaskCT"),System.TaskCT=function(){return TaskCT.ins()},window.TaskCT=TaskCT;var TaskData=function(){function t(){}return t}();__reflect(TaskData.prototype,"TaskData"),window.TaskData=TaskData;var VitalityData=function(){function t(){}return t}();__reflect(VitalityData.prototype,"VitalityData"),window.VitalityData=VitalityData;var AchieveItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=TaskCT.ins().getAchieveConfById(t.id);this.taskImg.source="",this.taskName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&T:("+t.value+"/"+e.target+")|"),this.taskInfo.text=e.desc;var i=void 0,n=1;for(i in e.awardList)this["awards"+n++].setData(e.awardList[i]);switch(t.state){case 0:this.gotoBtn.visible=!0,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!1;break;case 1:this.gotoBtn.visible=!1,this.awardsBtn.visible=!0,this.completeImg.visible=this.completeLabel.visible=!1;break;case 2:this.gotoBtn.visible=!1,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!0}0==e.control&&(this.gotoBtn.visible=!1)}},e}(BaseItemRender);__reflect(AchieveItem.prototype,"AchieveItem"),window.AchieveItem=AchieveItem;var GuideArrow2=function(t){function e(){var e=t.call(this)||this;return e.skinName="guideArrowSkin",e}return __extends(e,t),e.prototype.setDirection=function(t){egret.Tween.removeTweens(this),this.x=0,this.visible=!0,1==t?(this.currentState="right",egret.Tween.get(this,{loop:!0}).to({x:40},1e3).to({x:0},1e3)):(this.currentState="left",egret.Tween.get(this,{loop:!0}).to({x:-40},1e3).to({x:0},1e3))},e.prototype.setTips=function(t){this.lab.text=t},e.prototype.removeTweens=function(){egret.Tween.removeTweens(this)},e}(BaseEuiView);__reflect(GuideArrow2.prototype,"GuideArrow2"),window.GuideArrow2=GuideArrow2;var LimitStartTipsView=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitStartTipsSkin",e.isTopLevel=!0,e.name="限时任务开始",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return LocationProperty.isTSServer?!1:!0},e.prototype.open=function(){this.addTouchEvent(this.btn,this.onStart)},e.prototype.close=function(){t.prototype.close.call(this)},e.prototype.onStart=function(){ViewManager.ins().close(e),ViewManager.ins().open(LimitTaskView)},e}(BaseEuiView);__reflect(LimitStartTipsView.prototype,"LimitStartTipsView"),ViewManager.ins().reg(LimitStartTipsView,LayerManager.UI_Popup),window.LimitStartTipsView=LimitStartTipsView;var LimitTaskItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="LimitTimeItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.goBtn.visible=!0,this.done.visible=!1,this.taskNameTxt.text=this.data.name,this.taskIcon.isShowName(!1),this.taskIcon.data=this.data.awardList[0],this.progTxt.text="("+this.data.progress+"/"+this.data.target+")",83==this.data.type&&(this.data.progress>=this.data.target?this.progTxt.text="1/1":this.progTxt.text="0/1"),this.progTxt.textColor=12849664,0==this.data.state?(this.stateTxt.text="进行中",this.goBtn.label="前往"):1==this.data.state?(this.stateTxt.text="可领取奖励",this.goBtn.label="领取",this.progTxt.textColor=4823887):2==this.data.state&&(this.stateTxt.text="已完成",this.goBtn.visible=!1,this.done.visible=!0,this.progTxt.textColor=4823887),this.redPoint.visible=1==this.data.state,this.taskIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTopIcon,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.prototype.onTopIcon=function(t){t.stopImmediatePropagation(),t.stopPropagation()},e.prototype.onTap=function(t){if(0==this.data.state){var e=this.data.controlTarget[1]?this.data.controlTarget[1]:0,i=this.data.controlTarget[2]?this.data.controlTarget[2]:0;if("GuanQiaRewardWin"==this.data.controlTarget[0])return void this.gotoQuanQia();ViewManager.ins().open(this.data.controlTarget[0],e,i)}else 1==this.data.state&&(BagCT.ins().getSurplusCount()<1?TipsCT.ins().showTips("背包剩余空位不足，请先清理"):TaskCT.ins().sendGetLimitTaskReward(this.data.id))},e.prototype.gotoQuanQia=function(){return BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH?(ViewManager.ins().closeTopLevel(),ViewManager.ins().open(BagFullTipsWin)):FbCT.ins().currentEnergy>=FbCT.ins().energy?(ViewManager.ins().closeTopLevel(),FbCT.ins().autoPk()):TipsCT.ins().showTips("|C:0xf3311e&T:能量不足|"),!1},e}(BaseItemRender);__reflect(LimitTaskItem.prototype,"LimitTaskItem"),window.LimitTaskItem=LimitTaskItem;var LimitTaskView=function(t){function e(){var e=t.call(this)||this;return e.skinName="limittime",e.name="限时任务",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){this.addTouchEvent(this.list,this.onTouch),this.addTouchEvent(this.viewBtn,this.onTouch),this.addTouchEvent(this.closeBtn,this.onTouch),this.observe(TaskCT.ins().postUpdteLimitTaskData,this.setPanel),this.observe(TaskCT.ins().postUpdteLimitTaskData,this.updateFly),this.setPanel()},e.prototype.close=function(){Timer.stop(this.runTime,this)},e.prototype.onTouch=function(t){switch(t.target){case this.viewBtn:ViewManager.ins().open(SkillWin,2);break;case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.setPanel=function(){var t=this.sortList();this.list.dataProvider=new eui.ArrayCollection(t);var e=TaskCT.ins().currTaskListsId,i=GlobalConfig.LimitTimeConfig[e];if(!i)return void TipsCT.ins().showCenterTips("限时任务id:"+e+"不存在限时任务表中");var n="";n=i.openZhuan>0?i.openZhuan+"转":i.openLevel+"级";for(var s=["title0","title1","title2"],o=0;o<s.length;o++)this[s[o]].visible=o==e-1;for(var o=0;8>o;o++)this["item"+o].redPoint.visible=!1;this.link0.text=n,this.expBarChange(),this.itemChange(),this.updateAttr(),TaskCT.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3)>0?(this.runTime(),Timer.has(this.runTime,this)||Timer.start(1e3,0,this.runTime,this)):this.time.text="活动已过期"},e.prototype.runTime=function(){var t=TaskCT.ins().limitTaskEndTime-Math.floor(GameServer.serverTime/1e3);t>=0?this.time.text=DateUtils.getFormatBySecond(t,1):(this.time.text="活动已过期",Timer.stop(this.runTime,this))},e.prototype.expBarChange=function(){var t=TaskCT.ins().limitTaskList.length,e=TaskCT.ins().limitTaskCount;this.expBar.maximum!=t&&(this.expBar.maximum=t),this.expBar.value=e,0==e?this.playAllEffect():this.removeAllEffect()},e.prototype.itemChange=function(){for(var t=TaskCT.ins().limitTaskList,e=0;e<t.length;e++){var i=t[e],n=this["item"+e];n.visible=2!=i.state;var s=i.awardList[0];n.data=s,n.destruct(),n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchItem,this)}},e.prototype.updateAttr=function(){var t=GlobalConfig.TogetherHitEquipQmConfig,e=TaskCT.ins().limitTaskList[0].awardList[0],i=GlobalConfig.ItemConfig[e.id],n=i.zsLevel||0;for(var s in t)if(s+""==n+""){for(var o in t[s]){var a=t[s][o];for(var r in a)r+""=="3"?this.link4.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc):r+""=="5"?this.link6.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc):this.link8.textFlow=TextFlowMaker.generateTextFlow1(a[r].desc)}break}},e.prototype.onTouchItem=function(t){var e=t.currentTarget;ViewManager.ins().open(HejiEquipTipsWin,e.data,!1)},e.prototype.sortList=function(){var t=TaskCT.ins().limitTaskList;return t},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.list.itemRenderer=LimitTaskItem,this.time.text="",this.expBar.slideDuration=0,this.effArr=[];for(var e=0;8>e;e++){var i=new MovieClip;i.x=177,i.y=174,i.rotation=45*e,i.touchEnabled=!1,this.effArr.push(i)}},e.prototype.playAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent||(this.effArr[t].playFile(RES_DIR_EFF+"HeJizbEff",-1),this.EffectGroup.addChild(this.effArr[t]))},e.prototype.removeAllEffect=function(){for(var t=0;t<this.effArr.length;t++)this.effArr[t].parent&&DisplayUtils.removeFromParent(this.effArr[t])},e.prototype.updateFly=function(t){if(t&&2==t.state){var e=TaskCT.ins().limitTaskList.indexOf(t);e>=0&&this.addFly(e)}},e.prototype.addFly=function(t){var e=this["item"+t],i=new PunchEquipItemBase;i.currentState=e.currentState,i.anchorOffsetX=e.width/2,i.anchorOffsetY=e.height/2,i.scaleX=.53,i.scaleY=.53,i.alpha=.8;var n=e.parent,s=new egret.Point;n.parent.localToGlobal(n.x+.53*(e.x+e.width/2),n.y+.53*(e.y+e.height/2),s),this.globalToLocal(s.x,s.y,s),i.x=s.x,i.y=s.y,this.addChild(i);var o=TaskCT.ins().limitTaskList[t].awardList[0];i.validateNow(),i.data=o;var a=ViewManager.ins().getView(UIView2),r=a.getToggleBtn(0),l=new egret.Point;r.parent.localToGlobal(r.x+r.width/2,r.y+r.height/2,l);var h=egret.Tween.get(i);h.to({scaleX:.8,scaleY:.8},300).to({x:s.x+30},50).to({x:s.x-30},50).to({x:s.x+30},50).to({x:s.x-30},50).to({x:s.x+30},50).to({x:s.x-30},50).to({x:s.x+30},50).to({x:s.x-30},50).to({x:s.x},25).to({x:l.x,y:l.y,scaleX:.15,scaleY:.15},800).call(function(){i.parent&&i.parent.removeChild(i)})},e.openCheck=function(){return LocationProperty.isTSServer?void 0:TaskCT.ins().currTaskListsId>0?!0:(ViewManager.ins().open(BossWin,1),!1)},e}(BaseEuiView);__reflect(LimitTaskView.prototype,"LimitTaskView"),ViewManager.ins().reg(LimitTaskView,LayerManager.UI_Main),window.LimitTaskView=LimitTaskView;var TaskAlertWin=function(t){function e(){var e=t.call(this)||this;return e.CLOSE_TIME=5,e.timeCount=0,e.skinName="TaskSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.gotoBtn,this.onClick),this.setView(),SoundUtil.play("longlin_a_dkjm_mp3")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];egret.Tween.removeTweens(this.arrowGroup)},e.prototype.setView=function(){var t=TaskCT.ins().taskTrace;if(t){var e=TaskCT.ins().getAchieveConfById(t.id),i=e.controlTarget,n=(i[0],i[1],i[2]),s=i[3];switch(e&&(this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList),this.taskInfo.text=s,this.eNpc.source=e.face||""),this.taskName.text=n,t.state){case 0:this.gotoBtn.label="前  往";break;case 1:this.gotoBtn.label="领  取"}}urlParam.noGuide&&(this.arrowGroup.visible=!1);var o=egret.Tween.get(this.arrowGroup,{loop:!0});o.to({y:this.arrowGroup.y-10},400).to({y:this.arrowGroup.y+10},400),Timer.stop(this.onTimeCount,this),this.timeCount=this.CLOSE_TIME,Timer.start(1e3,this.timeCount,this.onTimeCount,this),this.timeText.text=this.timeCount+"秒后自动提交"},e.prototype.onTimeCount=function(){this.timeCount--,this.timeText.text=this.timeCount+"秒后自动提交",0==this.timeCount&&(Timer.stop(this.onTimeCount,this),this.doTask())},e.prototype.onClick=function(t){switch(t.target){case this.gotoBtn:this.doTask()}},e.prototype.doTask=function(){var t=TaskCT.ins().taskTrace,i=TaskCT.ins().getAchieveConfById(t.id),n=i.pickmc,s=i.commc;0==t.state?(n&&SoundUtil.play(n),GameGuider.taskGuidance(t.id,1),GuideUtils.ins().updateByClick()):(s&&SoundUtil.play(s),TaskCT.ins().sendGetAchieve(t.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(t),TaskCT.ins().getAchieveConfById(t.id+1)||TipsCT.ins().showTips("已完成所有任务!")),ViewManager.ins().close(e)},e}(BaseEuiView);__reflect(TaskAlertWin.prototype,"TaskAlertWin"),ViewManager.ins().reg(TaskAlertWin,LayerManager.UI_Main),window.TaskAlertWin=TaskAlertWin;var TaskEffectView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this._effGroup=new eui.Group,this.addChild(this._effGroup),this._arrowGroup=new eui.Group,this.addChild(this._arrowGroup),this._effCir=new MovieClip,this._effGroup.addChild(this._effCir),this._arrow=new GuideArrow2,this._arrowGroup.addChild(this._arrow),this.touchChildren=!1,this.touchEnabled=!1},e.prototype.start=function(){Timer.stop(this.update,this),Timer.start(500,0,this.update,this)},e.prototype.stop=function(){Timer.stop(this.update,this),this.hide()},e.prototype.show=function(t){if(!this._isShow){this._isShow=!0;var e=ViewManager.ins().getView(PlayFunView);if(!e)return void this.hide();egret.Tween.removeTweens(this),this.alpha=0,egret.Tween.get(this).to({alpha:1},300);var i=e.taskTraceBtn;if(!i)return;this.x=i.width>>1,this.y=i.height>>1,i.addChild(this),this._arrow.setDirection(0),this._effCir.playFile(RES_DIR_EFF+"NoviceEff",-1)}this._arrow.setTips(t)},e.prototype.hide=function(){this._isShow&&(this._isShow=!1,this._arrow.removeTweens(),this.parent&&this.parent.removeChild(this))},e.prototype.isShow=function(){return this._isShow},e.prototype.update=function(){var t=TaskCT.ins().taskTrace;if(t){for(var e=TaskCT.ins().getAchieveConfById(t.id),i=["WelcomeWin"],n=0,s=i;n<s.length;n++){var o=s[n];if(ViewManager.ins().getView(o))return void this.hide()}e&&(0==t.state&&e.startwarning?this.show(e.startwarning):1==t.state&&e.finishwarning?this.show(e.finishwarning):this.hide())}},e}(egret.DisplayObjectContainer);__reflect(TaskEffectView.prototype,"TaskEffectView"),window.TaskEffectView=TaskEffectView;var TaskItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;if(t){var e=GlobalConfig.DailyConfig[t.id];this.taskImg.source="",this.taskName.textFlow=TextFlowMaker.generateTextFlow(e.name+"|C:0x35e62d&("+e.activeValue+"活跃度)"),this.taskInfo.textFlow=TextFlowMaker.generateTextFlow(e.desc+"|C:0x35e62d&("+t.value+"/"+e.target+")");var i=void 0,n=1;for(i in e.awardList)this["awards"+n++].setData(e.awardList[i]);switch(this.awards2.visible=n>2,t.state){case 0:this.gotoBtn.visible=!0,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!1;break;case 1:this.gotoBtn.visible=!1,this.awardsBtn.visible=!0,this.completeImg.visible=this.completeLabel.visible=!1;break;case 2:this.gotoBtn.visible=!1,this.awardsBtn.visible=!1,this.completeImg.visible=this.completeLabel.visible=!0}0==e.control&&(this.gotoBtn.visible=!1)}},e}(BaseItemRender);__reflect(TaskItem.prototype,"TaskItem"),window.TaskItem=TaskItem;var TipsCT=function(t){function e(){var e=t.call(this)||this;return e.TipsTime=0,e.sysId=PackageID.LianJi,e.regNetMsg(6,function(t){return e.showTips(t.readString())}),e.regNetMsg(12,e.postFirstRechargeTips),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postFirstRechargeTips=function(t){return this.TipsTime=DateUtils.formatMiniDateTime(t.readUnsignedInt()),this.TipsTime>GameServer.serverTime?void 0:!1},Object.defineProperty(e.prototype,"view",{get:function(){return this._view&&this._view.parent||(ViewManager.ins().open(TipsView),this._view=ViewManager.ins().getView(TipsView)),this._view},enumerable:!0,configurable:!0}),e.prototype.showTips=function(t,i){if(!("元宝不足"!=t&&"|C:0xf3311e&T:元宝不足|"!=t||LocationProperty.isIosTS||LocationProperty.isTSServer)){var n=WarnWin.show("元宝不足，是否前往充值？",null,null,function(){var t=Recharge.ins().getRechargeData(0);if(t&&0!=t.num)ViewManager.ins().open(RechargeWin);else{var n=ViewManager.ins().getView(BuyWin);n&&BuyWin.goodsId&&(e.goodsId=BuyWin.goodsId),ViewManager.ins().open(Recharge1Win),ViewManager.ins().close(BuyWin),ViewManager.ins().isShow(RareAnimalResultWin)&&(ViewManager.ins().close(RareAnimalResultWin),RareAnimalCT.ins().isBackShow=!0)}i&&"function"==typeof i&&i()});return void n.setBtnLabel("取消","前往")}DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTips,t)},e.prototype.showCenterTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips,t)},e.prototype.showCenterTips2=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips2,t)},e.prototype.showCenterTips3=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips3,t)},e.prototype.showCenterTips4=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showCenterTips4,t)},e.prototype.showBottomCenterTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showBottomCenterTips,t)},e.prototype.showSceneTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showSceneTips,t)},e.prototype.showTaskTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showTaskTips,t)},e.prototype.showAttrTips=function(t,e){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showAttrTips,[t,e])},e.prototype.showGoodEquipTips=function(t){this.view.showGoodEquipTip(t)},e.prototype.showTreasureTips=function(t){this.view.showTreasureTip(t)},e.prototype.showSkillTips=function(t){this.view.showSkillTip(t)},e.prototype.showItemTips=function(t){this.view.showItemTip(t)},e.prototype.showHeartItemTips=function(t){this.view.showHeartItemTip(t)},e.prototype.showBoxTips=function(t){this.view.showBoxTip(t)},e.prototype.showBoostPower=function(t,e){ViewManager.ins().open(BoostPowerView).showBoostPower(t,e)},e.prototype.showRewardBox=function(t){this.view.showRewardBox(t)},e.prototype.showEverTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showEverTips,t)},e.prototype.showHintTips=function(t){DelayOptManager.ins().addDelayOptFunction(this.view,this.view.showHintTips,t)},e.prototype.showGoodRewardTips=function(t){this.view.showGoodRewardTip(t)},__decorate([post()],e.prototype,"postFirstRechargeTips",null),e}(BaseSystem);__reflect(TipsCT.prototype,"TipsCT"),System.TipsCT=function(){return TipsCT.ins()},window.TipsCT=TipsCT;var AttriteChangeView=function(t){function e(){var e=t.call(this)||this;return e.bl=new eui.BitmapLabel,e.touchEnabled=e.touchChildren=!1,e._sp=new egret.Sprite,e.addChild(e._sp),e._bgImg=new eui.Image,e._sp.addChild(e._bgImg),e.bl.font="num_attr_fnt",e.bl.x=90,e.bl.y=10,e._sp.addChild(e.bl),e}return __extends(e,t),e.prototype.setLabelText=function(t,e){var i=this;this._sp.x=0,this._sp.alpha=1,this._bgImg.source="",this._bgImg.source="attr"+t,this.bl.text=e+"";var n=egret.Tween.get(this._sp);n.wait(1e3).to({alpha:0,x:-300},500).call(function(){DisplayUtils.removeFromParent(i)},this)},e}(BaseView);__reflect(AttriteChangeView.prototype,"AttriteChangeView"),window.AttriteChangeView=AttriteChangeView;var BarrageTipsItem=function(t){function e(){var e=t.call(this)||this;return e._sn_="BarrageSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.bg.width=this.lab.width+40,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.setText()},Object.defineProperty(e.prototype,"data",{set:function(t){this._data=t,this.setText()},enumerable:!0,configurable:!0}),e.prototype.setText=function(){this.lab&&this._data&&(this.lab.textFlow=TextFlowMaker.generateTextFlow(this._data))},e}(BaseView);__reflect(BarrageTipsItem.prototype,"BarrageTipsItem"),window.BarrageTipsItem=BarrageTipsItem;var BoostPowerView=function(t){function e(){var e=t.call(this)||this;return e.defaultValue=0,e.skinName="boostPowerSkin",e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.imgBg.alpha=1,this.img.alpha=1,this.lastTime=0,this.lastPower=0,this.clearShow()},e.prototype.showBoostPower=function(t,e){this.defaultValue=e,0==this.lastPower&&(this.lastPower=e),Timer.start(500,1,this.delayPowerUp,this)},e.prototype.clearShow=function(){this.power.text=this.add.text="",egret.Tween.removeTweens(this.eGroup),this.eGroup.visible=!1,Timer.stopAll(this),egret.clearTimeout(this.ii),this.ii=0},e.prototype.delayPowerUp=function(){var t=this.lastPower?this.lastPower:this.defaultValue,e=Actor.power;e>t&&this.showPowerUp(t,e)},e.prototype.showPowerUp=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,s,o,a,r=this;return __generator(this,function(l){switch(l.label){case 0:return this.clearShow(),this.eGroup.visible=!0,this.eGroup.alpha=1,i=e-t,[4,Timer.start(20,25,function(){var e=i;e+=Math.round(Math.random()*e);var n=t.toString(),s="";s=e.toString().length==n.length?e.toString().slice(1):e+"",n=n.charAt(0),n+=s,r.power.text=n+""},this)];case 1:return l.sent(),this.power.text=Actor.power+"",n="+"+i,this.add.text=n,s=200,o=2e3,this.lastPower=0,a=egret.Tween.get(this.eGroup),a.to(s).to({alpha:0},o).call(function(){r.eGroup.visible=!1},this),[2]}})})},e}(BaseEuiView);__reflect(BoostPowerView.prototype,"BoostPowerView"),ViewManager.ins().reg(BoostPowerView,LayerManager.UI_Tips),window.BoostPowerView=BoostPowerView;var ExSkillAiLogic=function(t){function e(){var e=t.call(this)||this;return e.ZL_SKILL_DEVIL=0,e.ZL_SKILL_EXPLOSION=1,e.ZL_SKILL_KILL=2,e.ZL_SKILL_SACRIFICE=3,e.ZL_SKILL_RELIEF=4,e.ZL_SKILL_ANGER=5,e.ZL_H_SKILL_DETER=6,e.ZL_H_SKILL_ANTICIPATI=7,e.ZL_SKILL_REMEDY=8,e.ZL_SKILL_SJZL=9,e.ZL_SKILL_RENJIA=10,e.MAX=11,e.triggerInterval={},e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkWarSpiritBubbleTrigger=function(){if(ZhanLingModel.ins().ZhanLingOpen())for(var t in GlobalConfig.ZhanLingBase){var e=GlobalConfig.ZhanLingBase[t],i=ZhanLingModel.ins().getZhanLingDataById(e.id);if(i)switch(e.talent){case this.ZL_SKILL_DEVIL:if(!GlobalConfig.ZhanLingLevel[e.type][i.level])break;var n=GlobalConfig.ZhanLingLevel[e.type][i.level].talentLevel,s=GlobalConfig.ZhanLingTalent[e.talent][n];if(s&&GameLogic.triggerValue(s.rate)){SkillCT.ins().postShowSkillWord(s.showWords);for(var o=0;o<SubRoles.ins().subRolesLen;o++){var a=EntityManager.ins().getMainRole(o);if(a){var r=EntityBuff.createBuff(s.effId,a);a.addBuff(r)}}}break;case this.ZL_SKILL_REMEDY:if(n=ZhanLingModel.ins().getZhanLingDataByTalentLv(e.id),s=GlobalConfig.ZhanLingTalent[e.talent][n],GameLogic.triggerValue(s.rate))for(var o=0;o<SubRoles.ins().subRolesLen;o++){var a=EntityManager.ins().getMainRole(o);if(a){var r=EntityBuff.createBuff(s.effId,a);a.addBuff(r)}}break;case this.ZL_SKILL_SJZL:if(n=ZhanLingModel.ins().getZhanLingDataByTalentLv(e.id),s=GlobalConfig.ZhanLingTalent[e.talent][n],GameLogic.triggerValue(s.rate)){SkillCT.ins().postShowSkillWord(s.showWords);for(var o=0;o<SubRoles.ins().subRolesLen;o++){var a=EntityManager.ins().getMainRole(o);if(a&&a.AI_STATE!=AI_State.Die){var r=EntityBuff.createBuff(s.effId,a);a.addBuff(r)}}}}}},e.prototype.checkHJTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e[0])return;var i=(t.getHP(),t.infoModel.getAtt(AttributeType.atMaxHp),t.infoModel.team==Team.My&&t instanceof CharRole);for(var n in GlobalConfig.ZhanLingBase){var s=GlobalConfig.ZhanLingBase[n],o=ZhanLingModel.ins().getZhanLingDataById(s.id);if(o)switch(s.talent){case this.ZL_H_SKILL_DETER:if(i){var a=ZhanLingModel.ins().getZhanLingDataByTalentLv(s.id),r=GlobalConfig.ZhanLingTalent[s.talent][a];if(!r)break;for(var l=0;l<SubRoles.ins().subRolesLen;l++){var h=EntityManager.ins().getMainRole(l);if(h)for(var u=function(e){if(!e.type||e.type==h.infoModel.job){var i=new SkillData(e.id);p.intervalDoFun(t.infoModel.handle+e.id+s.talent,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},p=this,c=0,d=r.passive;c<d.length;c++){var g=d[c];u(g)}}}break;case this.ZL_H_SKILL_ANTICIPATI:var f=GlobalConfig.ZhanLingTalent[s.talent][1];GameLogic.triggerValue(f.rate)}}}},e.prototype.checkDieTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e[0])return;var i=(t.getHP(),t.infoModel.getAtt(AttributeType.atMaxHp),t.infoModel.team==Team.My&&t instanceof CharRole);for(var n in GlobalConfig.ZhanLingBase){var s=GlobalConfig.ZhanLingBase[n],o=ZhanLingModel.ins().getZhanLingDataById(s.id);if(o){var a=ZhanLingModel.ins().getZhanLingDataByTalentLv(s.id),r=GlobalConfig.ZhanLingTalent[s.talent][a];if(r)switch(s.talent){case this.ZL_SKILL_KILL:if(i)for(var l=0;l<SubRoles.ins().subRolesLen;l++){var h=EntityManager.ins().getMainRole(l);if(h&&h.infoModel.handle!=t.infoModel.handle)for(var u=function(e){if(!e.type||e.type==h.infoModel.job){var i=new SkillData(e.id);p.intervalDoFun(t.infoModel.handle+e.id+s.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},p=this,c=0,d=r.passive;c<d.length;c++){var g=d[c];u(g)}}break;case this.ZL_SKILL_EXPLOSION:if(!i&&e[0]&&e[0].infoModel.team==Team.My)for(var f=0,v=r.passive;f<v.length;f++){var g=v[f];if(!g.type||e[0].infoModel.job==g.type)for(var l=(new SkillData(g.id),0);l<SubRoles.ins().subRolesLen;l++){var h=EntityManager.ins().getMainRole(l);if(!h||h.infoModel.handle==e[0].infoModel.handle)break;var y=new SkillData(g.id);if(y.tarEff&&y.tarEff.length>0)for(var m=0,T=y.tarEff;m<T.length;m++){var C=T[m],b=EntityBuff.createBuff(C,h);h.addBuff(b)}}}break;case this.ZL_SKILL_SACRIFICE:if(!i&&e[0]&&e[0].infoModel.team==Team.My&&e[0].infoModel.job==JobConst.ZhanShi)for(var I=function(e){if(!e.type||e.type==t.infoModel.job){var i=new SkillData(e.id);w.intervalDoFun(t.infoModel.handle+e.id+s.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},w=this,S=0,_=r.passive;S<_.length;S++){var g=_[S];I(g)}break;case this.ZL_SKILL_ANGER:if(!i&&e[0]&&e[0].infoModel.team==Team.My&&e[0].infoModel.job==JobConst.FaShi)for(var B=function(e){if(!e.type||e.type==t.infoModel.job){var i=new SkillData(e.id);
D.intervalDoFun(t.infoModel.handle+e.id+s.id,i.cd,function(){RoleAI.ins().tryUseWarSpiritSkill(t,e.id,!0)})}},D=this,x=0,R=r.passive;x<R.length;x++){var g=R[x];B(g)}}}}}},e.prototype.checkHPTrigger=function(t,e){if(ZhanLingModel.ins().ZhanLingOpen()){if(!t||!e)return;t.getHP(),t.infoModel.getAtt(AttributeType.atMaxHp),t.infoModel.team==Team.My&&t instanceof CharRole;for(var i in GlobalConfig.ZhanLingBase){var n=GlobalConfig.ZhanLingBase[i],s=ZhanLingModel.ins().getZhanLingDataById(n.id);if(s)switch(n.talent){case this.ZL_SKILL_RELIEF:break;case this.ZL_SKILL_RENJIA:}}}},e.prototype.intervalDoFun=function(t,e,i){void 0==this.triggerInterval[t]&&(this.triggerInterval[t]=egret.getTimer()),egret.getTimer()-this.triggerInterval[t]>=0&&i(),this.triggerInterval[t]=egret.getTimer()+e},e}(BaseClass);__reflect(ExSkillAiLogic.prototype,"ExSkillAiLogic");var CenterTipsItem=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.liftTime=3e3,e}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,Timer.start(5e3,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelText2",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,Timer.start(1e3,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labelText3",{set:function(t){this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+40,this.bg.source="zjmqipao",this.bg.visible=!0,this.lab.alpha=1,this.bg.y=0,this.lab.horizontalCenter=0,this.lab.verticalCenter=0,this.addToEvent||(this.addToEvent=!0,Timer.start(this.liftTime,1,this.removeFromParent,this))},enumerable:!0,configurable:!0}),e}(TipsItem);__reflect(CenterTipsItem.prototype,"CenterTipsItem"),window.CenterTipsItem=CenterTipsItem;var ChatTipsView=function(t){function e(){var e=t.call(this)||this;return e.showOver=!1,e.skinName="ChatMessage",e}return __extends(e,t),e.prototype.setData=function(t){this.lab.textFlow=TextFlowMaker.generateTextFlow(t.str),this.setshowTime()},e.prototype.setshowTime=function(){this.showOver||Timer.stop(this.showOverInfo,this),Timer.start(5e3,1,this.showOverInfo,this)},e.prototype.showOverInfo=function(){this.showOver=!0,DisplayUtils.removeFromParent(this)},e}(eui.Component);__reflect(ChatTipsView.prototype,"ChatTipsView"),window.ChatTipsView=ChatTipsView;var EverTipsItem=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="TipsSkin",e.lab.stroke=1,e.lab.strokeColor=0,e.bg.source="zjmqipao",e}return __extends(e,t),e.prototype.setIndex=function(t){this.index=t},Object.defineProperty(e.prototype,"labelText",{get:function(){return this._labelText},set:function(t){var e=this;this.bg.alpha=1,this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width+80,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1;var i=egret.Tween.get(this.bg);i.to({y:0},500).wait(500).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(e)},this)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(EverTipsItem.prototype,"EverTipsItem"),window.EverTipsItem=EverTipsItem;var HintTipsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsSkin",e.lab.visible=!1,e.bg.visible=!1,e}return __extends(e,t),e.prototype.setTips=function(t){var e=this;this.pic.source=t+"_png",this.pic.alpha=0,this.pic.y=0;var i=egret.Tween.get(this.pic);i.to({alpha:1},500).wait(GlobalConfig.ClientGlobalConfig.skillShowTime).to({alpha:0},200).call(function(){DisplayUtils.removeFromParent(e)},this)},e}(BaseView);__reflect(HintTipsItem.prototype,"HintTipsItem"),window.HintTipsItem=HintTipsItem;var SceneTipsItem=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"labelText",{set:function(t){var e=this;this._labelText=t,this.lab.textFlow=TextFlowMaker.generateTextFlow(this._labelText),this.bg.width=this.lab.width,this.bg.visible=!1,this.lab.alpha=1,this.bg.y=0,this.lab.verticalCenter=-1,Timer.start(500,1,function(){DisplayUtils.removeFromParent(e)},this)},enumerable:!0,configurable:!0}),e}(TipsItem);__reflect(SceneTipsItem.prototype,"SceneTipsItem"),window.SceneTipsItem=SceneTipsItem;var TipsEquipAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=GlobalConfig.ItemConfig[t];this.item.setItemImg(e.icon+"_png"),this.item.isShowJob(!1),this.item.setImgBg(ItemUtil.getQuality(e)),this.desc.text=e.name,this.skillName.visible=!1,this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsEquipAlertPanel.prototype,"TipsEquipAlertPanel"),window.TipsEquipAlertPanel=TipsEquipAlertPanel;var TipsGoodEquip=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){this.item.isShowName(!1);var e=GlobalConfig.ClientGlobalConfig.getDesc;if(t instanceof ItemData){var i=ItemUtil.getQuality(t.itemConfig);this.item.showNum(!0),this.item.data=t,4==i?(this.desc.source=e[0],this.itemName.visible=!0):5==i&&(this.desc.source=e[0],this.itemName.visible=!0),7==ItemUtil.getType(t.itemConfig)&&(this.desc.source=e[1]),this.itemName.text=t.itemConfig.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[i]}else if(t instanceof TreasureData){var n=GlobalConfig.SkirmishTreasureConfig[t.id];this.desc.source=e[2],this.item.setItemImg(n.icon+"_png"),this.item.setImgBg(n.quality),this.item.isShowJob(!1),this.item.showNum(!1),this.item.showName=!0,this.item.setName(n.name),this.itemName.text=n.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[n.quality]}else{this.desc.source=e[1];var s=t;this.item.setItemImg(s.imgClose),this.itemName.text=s.name,this.itemName.textColor=ItemBase.QUALITY_COLOR[s.quality],this.item.showNum(!1)}},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsGoodEquip.prototype,"TipsGoodEquip"),window.TipsGoodEquip=TipsGoodEquip;var TipsGoodReward=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){if(t instanceof RewardData)switch(t.id){case MoneyConst.yuanbao:this.desc.text="元宝",this.skillName.text=""+t.count,this.item.setItemImg(RewardData.CURRENCY_RES[t.id]),this.item.isShowName(!1),this.item.showNum(!1),this.item.isShowJob(!1)}},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsGoodReward.prototype,"TipsGoodReward"),window.TipsGoodReward=TipsGoodReward;var TipsHeartEquipAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="guardGodWeaponNoticeTip",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=GlobalConfig.ItemConfig[t];this.item.setItemImg(e.icon+"_png"),this.item.isShowJob(!1),this.item.setImgBg(ItemUtil.getQuality(e));var i=ItemUtil.getQualityColor(e);this.desc.textFlow=TextFlowMaker.generateTextFlow1("C:"+i+"&T:"+e.name),this.itemName.visible=!1,this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsHeartEquipAlertPanel.prototype,"TipsHeartEquipAlertPanel"),window.TipsHeartEquipAlertPanel=TipsHeartEquipAlertPanel;var TipsSkillAlertPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeEquipNoticeSkin2",e.isUsing=!1,e.horizontalCenter=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{set:function(t){var e=new SkillData(t);this.item.setItemImg(e.icon),this.item.setJob(e.job),this.skillName.text=e.name,this.skillName.textColor=ItemBase.QUALITY_COLOR[4],this.item.isShowName(!1),this.item.showNum(!1)},enumerable:!0,configurable:!0}),e}(BaseView);__reflect(TipsSkillAlertPanel.prototype,"TipsSkillAlertPanel"),window.TipsSkillAlertPanel=TipsSkillAlertPanel;var TipsView=function(t){function e(){var e=t.call(this)||this;return e.list=[],e.centerList=[],e.taskTipsList=[],e.sceneList=[],e.attrList=[],e.everList=[],e.hintList=[],e.rewardTipList=[],e.goodEquipList=[],e.floatWinList=[],e.skillTipList=[],e.equipItemList=[],e.equipHeartItemList=[],e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.touchChildren=!1,this.touchEnabled=!1,this.rewardTip=new TipsGoodReward,this.equipTip1=new TipsGoodEquip,this.skillTip1=new TipsSkillAlertPanel,this.equipTip=new TipsEquipAlertPanel,this.equipHeartTip=new TipsHeartEquipAlertPanel,this.observe(Actor.ins().postExp,this.showExp)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.showExp=function(t){t&&this.showTips("|C:0x23CA23&T:经验 +"+t+"|")},e.prototype.showHintTips=function(t){var e=ObjectPool.pop("HintTipsItem");e.bottom=260,e.horizontalCenter=0,e.setTips(t),this.addChild(e),this.hintList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this);for(var i=this.hintList.length-1;i>=0;i--){egret.Tween.removeTweens(this.hintList[i]);var n=egret.Tween.get(this.hintList[i]);n.to({bottom:260+-30*i},300)}},e.prototype.removeHintTip=function(t){var e=this.hintList.indexOf(t.currentTarget);this.hintList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeHintTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showEverTips=function(t){var e=ObjectPool.pop("EverTipsItem");e.x=t.x,e.y=t.y,e.labelText=t.str,this.addChild(e),this.everList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this);for(var i=this.everList.length-1;i>=0;i--){egret.Tween.removeTweens(this.everList[i]);var n=egret.Tween.get(this.everList[i]);n.to({y:e.y-30*i},300)}},e.prototype.removeEverTip=function(t){var e=this.everList.indexOf(t.currentTarget);this.everList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeEverTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showAttrTips=function(t){var e=ObjectPool.pop("AttriteChangeView");e.left=30,e.bottom=190,e.setLabelText(t[0],t[1]),this.addChild(e),this.attrList.unshift(e),e.once(egret.Event.REMOVED_FROM_STAGE,this.removeAttrTip,this);for(var i=this.attrList.length-1;i>=0;i--){egret.Tween.removeTweens(this.attrList[i]);var n=egret.Tween.get(this.attrList[i]);n.to({bottom:190+40*i},300)}},e.prototype.removeAttrTip=function(t){var e=this.attrList.indexOf(t.currentTarget);this.attrList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),ObjectPool.push(t.currentTarget)},e.prototype.showCenterTips=function(t){var e=ObjectPool.pop("CenterTipsItem");e.verticalCenter=0,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var n=egret.Tween.get(this.centerList[i]);n.to({verticalCenter:-30*i},500)}},e.prototype.removeCenterTip=function(t){var e=t.currentTarget,i=this.centerList.indexOf(e);this.centerList.splice(i,1),e.horizontalCenter=0/0,e.verticalCenter=0/0,egret.Tween.removeTweens(e),e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this),ObjectPool.push(e)},e.prototype.showCenterTips2=function(t){var e=ObjectPool.pop("CenterTipsItem");e.horizontalCenter=0,e.verticalCenter=-60,this.addChild(e),e.labelText2=t,this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var n=egret.Tween.get(this.centerList[i]);n.to({verticalCenter:-120-30*i},300)}},e.prototype.removeCenterTip2=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip2,this),e.horizontalCenter=0/0,e.verticalCenter=0/0;var i=this.centerList.indexOf(e);this.centerList.splice(i,1)},e.prototype.showCenterTips4=function(t){var e=this,i=ObjectPool.pop("BarrageTipsItem");i.x=StageUtils.ins().getWidth(),i.y=StageUtils.ins().getHeight()-StageUtils.ins().getHeight()/4-600*Math.random(),i.data=t,this.floatWinList.unshift(i),i.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip4,this),egret.Tween.removeTweens(i);var n=this.floatWinList.length>1?GlobalConfig.ClientGlobalConfig.barrageWaitTime*(this.floatWinList.length-1):0,s=egret.Tween.get(i);s.wait(n).call(function(){e.addChild(i)},this).to({x:-this.width},8e3).call(function(){DisplayUtils.removeFromParent(i),egret.Tween.removeTweens(i)},this)},e.prototype.removeCenterTip4=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip4,this);var i=this.floatWinList.indexOf(e);this.floatWinList.splice(i,1),ObjectPool.push(t.currentTarget)},e.prototype.showCenterTips3=function(t){var e=ObjectPool.pop("CenterTipsItem");e.verticalCenter=0,e.horizontalCenter=0,e.labelText3=t,this.addChild(e),this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip3,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var n=egret.Tween.get(this.centerList[i]);n.to({verticalCenter:-30*i},500)}},e.prototype.showBottomCenterTips=function(t){var e=ObjectPool.pop("CenterTipsItem");e.bottom=220,e.horizontalCenter=0,e.labelText3=t,e.liftTime=5e3,this.addChild(e),this.centerList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip3,this);for(var i=this.centerList.length-1;i>=0;i--){egret.Tween.removeTweens(this.centerList[i]);var n=egret.Tween.get(this.centerList[i]);n.to({bottom:220+30*i},500)}},e.prototype.removeCenterTip3=function(t){var e=t.currentTarget,i=this.centerList.indexOf(e);this.centerList.splice(i,1),e.horizontalCenter=0/0,e.verticalCenter=0/0,egret.Tween.removeTweens(e),e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeCenterTip,this),ObjectPool.push(e)},e.prototype.showSceneTips=function(t){var e=ObjectPool.pop("SceneTipsItem");e.verticalCenter=-175,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.sceneList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this);for(var i=this.sceneList.length-1;i>=0;i--){egret.Tween.removeTweens(this.sceneList[i]);var n=egret.Tween.get(this.sceneList[i]);n.to({verticalCenter:-175+-30*i},500)}},e.prototype.removeSceneTip=function(t){var e=this.sceneList.indexOf(t.currentTarget);this.sceneList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeSceneTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showTaskTips=function(t){var e=ObjectPool.pop("CenterTipsItem");e.bottom=232,e.horizontalCenter=0,e.labelText=t,this.addChild(e),this.taskTipsList.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this);for(var i=this.taskTipsList.length-1;i>=0;i--){egret.Tween.removeTweens(this.taskTipsList[i]);var n=egret.Tween.get(this.taskTipsList[i]);n.to({bottom:232+30*i},500)}},e.prototype.removeTaskTip=function(t){var e=this.taskTipsList.indexOf(t.currentTarget);this.taskTipsList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTaskTip,this),ObjectPool.push(t.currentTarget)},e.prototype.showTips=function(t){var e=ObjectPool.pop("TipsItem");e.left=0,e.bottom=190,this.addChild(e),e.labelText=t,this.list.unshift(e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this);for(var i=this.list.length-1;i>=0;i--){egret.Tween.removeTweens(this.list[i]);var n=egret.Tween.get(this.list[i]);n.to({bottom:190+30*i},300)}},e.prototype.removeTipsItem=function(t){var e=t.currentTarget;e.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeTipsItem,this),e.left=0/0,e.bottom=0/0;var i=this.list.indexOf(e);this.list.splice(i,1),ObjectPool.push(e)},e.prototype.showGoodRewardTip=function(t){this.rewardTipList.push(t),Timer.has(this.goodRewardTimer,this)||Timer.start(16,0,this.goodRewardTimer,this)},e.prototype.showTreasureTip=function(t){this.goodEquipList.push(t),Timer.has(this.goodEquipTimer,this)||Timer.start(16,0,this.goodEquipTimer,this)},e.prototype.showBoxTip=function(t){var e=GlobalConfig.TreasureBoxConfig[t];this.goodEquipList.push(e),Timer.has(this.goodEquipTimer,this)||Timer.start(16,0,this.goodEquipTimer,this)},e.prototype.goodRewardTimer=function(){var t=this;if(0==this.rewardTipList.length)return void Timer.stop(this.goodEquipTimer,this);if(!this.isWait){var e;if(this.rewardTip.isUsing||(e=this.rewardTip),e){e.x=50,e.y=750,e.alpha=1,e.parent||this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.rewardTipList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.goodEquipTimer=function(){var t=this;if(0==this.goodEquipList.length)return void Timer.stop(this.goodEquipTimer,this);if(!this.isWait){var e;if(this.equipTip1.isUsing||(e=this.equipTip1),e){e.x=50,e.y=750,e.alpha=1,e.parent||this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.goodEquipList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(GlobalConfig.ClientGlobalConfig.itemShowTime).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.showRewardBox=function(t){var e=GlobalConfig.TreasureBoxConfig[t];this.goodEquipList.push(e),Timer.has(this.goodEquipTimer,this)||Timer.start(16,0,this.goodEquipTimer,this)},e.prototype.showSkillTip=function(t){var e=ObjectPool.pop("TipsSkillAlertPanel");this.updateTips(e,t)},e.prototype.removeGoodEquipTip=function(t){var e=this.goodEquipList.indexOf(t.currentTarget);this.goodEquipList.splice(e,1),egret.Tween.removeTweens(t.currentTarget),t.currentTarget.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeGoodEquipTip,this),ObjectPool.push(t.currentTarget)},e.prototype.updateTips=function(t,e){var i=this;t.x=50,t.y=750,t.alpha=0,t.data=e,this.addChild(t),this.goodEquipList.unshift(t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeGoodEquipTip,this),egret.Tween.removeTweens(t);var n=t instanceof TipsSkillAlertPanel,s=GlobalConfig.ClientGlobalConfig,o=n?s.skillShowTime:s.itemShowTime,a=n?s.skillWaitTime:s.itemWaitTime,r=this.goodEquipList.length>1?a*(this.goodEquipList.length-1):0,l=egret.Tween.get(t);l.wait(r).to({alpha:1,y:600},300).wait(o).to({alpha:0,y:450},1e3).call(function(){i.removeChild(t)},this)},e.prototype.showGoodEquipTip=function(t){var e=ObjectPool.pop("TipsGoodEquip");this.updateTips(e,t)},e.prototype.showItemTip=function(t){this.equipItemList.push(t),Timer.has(this.itemTipTimer,this)||Timer.start(16,0,this.itemTipTimer,this)},e.prototype.itemTipTimer=function(){var t=this;if(0==this.equipItemList.length)return void Timer.stop(this.itemTipTimer,this);if(!this.isWait){var e;if(this.equipTip.isUsing||(e=this.equipTip),e){e.x=50,e.y=750,e.alpha=1,this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.equipItemList.pop();var i=egret.Tween.get(e);i.to({y:600},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e.prototype.showHeartItemTip=function(t){this.equipHeartItemList.push(t),Timer.has(this.itemHeartTipTimer,this)||Timer.start(16,0,this.itemHeartTipTimer,this)},e.prototype.itemHeartTipTimer=function(){var t=this;if(0==this.equipHeartItemList.length)return void Timer.stop(this.itemHeartTipTimer,this);if(!this.isWait){var e;if(this.equipHeartTip.isUsing||(e=this.equipHeartTip),e){e.x=50,e.y=713,e.alpha=1,this.addChild(e),e.isUsing=!0,this.isWait=!0,e.data=this.equipHeartItemList.pop();var i=egret.Tween.get(e);i.to({y:563},300).wait(1e3).to({alpha:0},1e3).call(function(){e.isUsing=!1,t.isWait=!1,t.removeChild(e)})}}},e}(BaseEuiView);__reflect(TipsView.prototype,"TipsView"),ViewManager.ins().reg(TipsView,LayerManager.UI_Tips),window.TipsView=TipsView;var Title=function(t){function e(){var e=t.call(this)||this;return e.showTitleDic={},e.curSelectRole=0,e.sysId=PackageID.Title,e.regNetMsg(1,e.postListUpdate),e.regNetMsg(2,e.doAdd),e.regNetMsg(3,e.doRemove),e.regNetMsg(4,e.doUpdateShow),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.getTotalPower=function(){for(var t=this.list.length,e=0,i=0;t>i;i++){var n=this.list[i];n.endTime>=0&&(e+=n.power)}return e},e.prototype.postUseTitle=function(t){return t},e.prototype.sendGetList=function(){this.sendBaseProto(1)},e.prototype.postListUpdate=function(t){for(var e={},i=t.readInt(),n=0;i>n;++n)e[t.readInt()]=t.readUnsignedInt();this.initList(e),this.showTitleDic={};for(var s=SubRoles.ins().subRolesLen,n=0;s>n;n++){var o=SubRoles.ins().getSubRoleByIndex(n);null!=o&&(this.showTitleDic[n]=o.title)}},e.prototype.doAdd=function(t){this.change(t.readInt(),t.readUnsignedInt())},e.prototype.doRemove=function(t){this.change(t.readInt(),-1)},e.prototype.sendChangeShow=function(t,e){var i=this.getBytes(4);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.doUpdateShow=function(t){var e=EntityManager.ins().getEntityByHandle(t.readDouble());if(e){var i=e.infoModel;if(i.title=t.readInt(),e.updateTitle(),e.team==Team.My){var n=i.index,s=this.showTitleDic[n]||0;this.showTitleDic[n]=i.title,this.postTitleShow(n,i.title,s)}}},e.prototype.postTitleShow=function(t,e,i){return[t,e,i]},e.prototype.setTitle=function(t,e){for(var i in this.showTitleDic)if(this.showTitleDic[i]==e){this.sendChangeShow(+i,0);break}this.sendChangeShow(t,e)},e.prototype.sortFunc=function(t,e){return t.endTime<0==e.endTime<0?t.config.sort>e.config.sort?1:-1:t.endTime<0?1:-1},e.prototype.initList=function(t){this.timeDict=t,this.infoDict={},this._totalAttrs=[],this._totalAttrsText=new eui.ArrayCollection;var e=[],i=GlobalConfig.TitleConf;for(var n in i)if(i[n].type!=TitleType.NewPlayer){var s=new TitleInfo(i[n]);if(s.config.Id in t){s.endTime=t[s.config.Id];for(var o in s.config.attrs){var a=s.config.attrs[o];this._totalAttrs[a.type]=(this._totalAttrs[a.type]||0)+a.value}}else s.endTime=-1;-1==s.endTime&&1!=i[n].defaultShow&&BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i[n].activeItemId)<1||(e[e.length]=this.infoDict[s.config.Id]=s,s.attrsTotal=this._totalAttrsText)}e.sort(this.sortFunc),this.list=e,this.updateTotalAttrs()},e.prototype.change=function(t,e){if(this.infoDict){0>e?delete this.timeDict[t]:this.timeDict[t]=e,this.initList(this.timeDict);var i=this.infoDict[t];i&&(i.endTime=e);var n=0>e?-1:1;n>0&&this.autoWearTitle(i)}},e.prototype.updateTotalAttrs=function(){var t=this._totalAttrsText.source;t.length=0;for(var e in this._totalAttrs)this._totalAttrs[e]>0&&t.push(TitleInfo.formatAttr(Number(e),this._totalAttrs[e]));for(var i in this.timeDict){var n=GlobalConfig.TitleConf[i].sysadd;if(n&&this.timeDict[i]>=0)for(var s in n)t.push(this.attrDesc(n[s]))}if(0==t.length)for(var o=this.infoDict[1].config.attrs,a=0,r=o;a<r.length;a++){var s=r[a];t.push(TitleInfo.formatAttr(s.type,0))}this._totalAttrsText.refresh()},e.prototype.attrDesc=function(t){var e="";switch(t[0]){case OtherTitleType.Dragon:e="龍装";break;case OtherTitleType.Book:e="图鉴";break;case OtherTitleType.Ring:e="特戒";break;case OtherTitleType.Devil:e="魔神";break;case OtherTitleType.Wing:e="翅膀";break;case OtherTitleType.Seal:e="龙印";break;case OtherTitleType.Smelt:e="淬炼";break;case OtherTitleType.Beast:e="神兽";break;case OtherTitleType.Reincarnation:e="转生";break;case OtherTitleType.Equip:e="装备";break;case OtherTitleType.SecretBook:e="秘籍"}return{h:e+"基础属性加成：",t:t[1]/100+"%",textColor:3532333}},e.prototype.autoWearTitle=function(t){if(17==t.config.Id&&t instanceof TitleInfo)for(var i=SubRoles.ins().subRolesLen,n=0;i>n;n++)if(!e.ins().showTitleDic[n]){e.ins().setTitle(n,t.config.Id);break}},e.getTitleCfgByItemId=function(t){for(var e in GlobalConfig.TitleConf)if(GlobalConfig.TitleConf[e].activeItemId==t)return GlobalConfig.TitleConf[e];return null},e.TITLE_WIN_REFLASH_PANEL="TITLE_WIN_REFLASH_PANEL",e.SIMLPE_HEIGHT=86,e.EXPAND_HEIGHT=380,__decorate([post()],e.prototype,"postUseTitle",null),__decorate([post()],e.prototype,"postListUpdate",null),__decorate([post()],e.prototype,"postTitleShow",null),e}(BaseSystem);__reflect(Title.prototype,"Title");var TitleType;!function(t){t[t.Default=0]="Default",t[t.NewPlayer=1]="NewPlayer"}(TitleType||(TitleType={}));var OtherTitleType;!function(t){t[t.Dragon=1]="Dragon",t[t.Book=2]="Book",t[t.Ring=3]="Ring",t[t.Devil=4]="Devil",t[t.Wing=5]="Wing",t[t.Seal=6]="Seal",t[t.Smelt=7]="Smelt",t[t.Beast=8]="Beast",t[t.Reincarnation=9]="Reincarnation",t[t.Equip=10]="Equip",t[t.SecretBook=11]="SecretBook"}(OtherTitleType||(OtherTitleType={})),window.TitleType=TitleType,window.OtherTitleType=OtherTitleType,System.Title=function(){return Title.ins()},window.Title=Title;var TitleInfo=function(){function t(t){this.config=t}return Object.defineProperty(t.prototype,"attrsText",{get:function(){if(!this._attrsText){for(var e=[],i=this.config.attrs,n=this.config.sysadd,s=i.length+(n?n.length:0);s--;)s>=i.length?e[s]=Title.ins().attrDesc(n[s-i.length]):e[s]=t.formatAttr(i[s].type,i[s].value);this._attrsText=new eui.ArrayCollection(e),this.power=BagCT.getAttrPower(i)}return this._attrsText},enumerable:!0,configurable:!0}),t.formatAttr=function(t,e){var i=AttributeData.getAttStrByType1({type:t,value:e}),n=i.split("+");return{h:n[0]+"：",t:n[1],textColor:3532333}},t}();__reflect(TitleInfo.prototype,"TitleInfo"),window.TitleInfo=TitleInfo;var TitleItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TitleItemSkin",e}return __extends(e,t),e.prototype.onTap=function(t){t.target==this.btnSet?Title.ins().postUseTitle(this.data):(this.currentState="expand"!=this.currentState?"expand":"simple",this.dizuo.visible="expand"!=this.currentState?!1:!0,MessageCenter.ins().dispatch(Title.TITLE_WIN_REFLASH_PANEL,this,this.currentState))},e.prototype.dataChanged=function(){if(this.data instanceof TitleInfo){var t=this.data;this.attrsTotal.removeChildren();for(var i=0,n=this.data.attrsTotal.source;i<n.length;i++){var s=n[i],o=new eui.Label;o.size=16,o.textFlow=[{text:s.h},{text:s.t,style:s}],this.attrsTotal.addChild(o)}this.attrs.removeChildren();for(var a=0,r=this.data.attrsText.source;a<r.length;a++){var s=r[a],o=new eui.Label;o.size=16,o.textFlow=[{text:s.h},{text:s.t,style:s}],this.attrs.addChild(o)}if(this.conditionTxt.text="获得条件："+t.config.condition,t.config.img&&(this.img.source=RES_DIR_CHENGHAO+t.config.img),this.img.visible=!!t.config.img,t.config.eff){this.titleMc||(this.titleMc=ObjectPool.pop("MovieClip"),this.effpos.addChild(this.titleMc));var l=RES_DIR_EFF+t.config.eff;this.titleMc.playFile(l,-1)}else this.titleMc&&(DisplayUtils.removeFromParent(this.titleMc),this.titleMc=null);if(t.endTime>=0){this.btnSet.label=t.config.Id==Title.ins().showTitleDic[Title.ins().curSelectRole]?"卸下":Title.ins().showTitleDic[Title.ins().curSelectRole]?"更换":"穿戴",this.btnSet.visible=!0,this.time.visible=!0;var h=DateUtils.formatMiniDateTime(t.endTime)/1e3;this.time.text=0==t.endTime?"有效期：永久":"有效期："+DateUtils.getFormatBySecond(h,2),this.labLack.visible=!1}else this.btnSet.visible=!1,this.time.visible=!1,this.labLack.visible=!0;"string"==typeof e.rareText[t.config.rare]&&(e.rareText[t.config.rare]=TextFlowMaker.generateTextFlow("稀有度：|C:"+e.rareText[t.config.rare])),this.labRare.textFlow=e.rareText[t.config.rare],this._power!=t.power&&(this.power.text=t.power*SubRoles.ins().subRolesLen+"",this._power=t.power),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)}else this.img.source="",this.conditionTxt.text="",this._power&&(this._power=0,this.power.text="0"),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},e.rareText=["0xfbf8ee&T:普通","0x00ff3c&T:稀有","0x066eba&T:珍贵","0xd200ff&T:国器","0xf45601&T:无双"],e}(BaseItemRender);__reflect(TitleItem.prototype,"TitleItem"),window.TitleItem=TitleItem;var TitleWin=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TitleSkin",this.list.itemRenderer=TitleItem,this.isTopLevel=!0},e}(BaseEuiView);__reflect(TitleWin.prototype,"TitleWin"),ViewManager.ins().reg(TitleWin,LayerManager.UI_Main),window.TitleWin=TitleWin;var BreakDownListItemData=function(){function t(){}return t}();__reflect(BreakDownListItemData.prototype,"BreakDownListItemData"),window.BreakDownListItemData=BreakDownListItemData;var Hunt=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.TreasureHunt,e.regNetMsg(1,e.doHuntResult),e.regNetMsg(2,e.postBestListInfo),e.regNetMsg(3,e.postHuntNum),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.sendHunt=function(t){var e=this.getBytes(1);e.writeShort(t),this.sendToServer(e)},e.prototype.sendHuntList=function(){this.sendBaseProto(2)},e.prototype.doHuntResult=function(t){for(var e=t.readShort(),i=t.readInt(),n=[],s=0;i>s;s++)n[s]=[t.readInt(),t.readInt()];ViewManager.ins().isShow(HuntResultWin)?this.postHuntResult(e,n,0):(ViewManager.ins().open(HuntResultWin,e,n,0),this.postHuntResult(e,n,0))},e.prototype.postHuntResult=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t},e.prototype.postBestListInfo=function(t){for(var e=t.readShort(),i=[],n=0;e>n;n++)i[n]=[t.readString(),t.readInt()];return i.reverse(),i},e.prototype.sendHuntNum=function(){this.sendBaseProto(3)},e.prototype.postHuntNum=function(t){return t.readUnsignedInt()},e.prototype.checkRed=function(t,e){var i=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,t),n=i?i.count:0;return n>=e},e.prototype.checkHuntRed=function(t){return this.checkRed(GlobalConfig.TreasureHuntConfig.huntItem,t)},e.prototype.checkRuneRed=function(t){return this.checkRed(GlobalConfig.FuwenTreasureConfig.huntItem,t)},e.prototype.checkChuanshiRed=function(t){return this.checkRed(GlobalConfig.HeirloomTreasureConfig.huntItem,t)},__decorate([post()],e.prototype,"postHuntResult",null),__decorate([post()],e.prototype,"postBestListInfo",null),__decorate([post()],e.prototype,"postHuntNum",null),e}(BaseSystem);__reflect(Hunt.prototype,"Hunt"),System.Hunt=function(){return Hunt.ins()},window.Hunt=Hunt;var LegendEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.totalRedPoint=!1,e.LegendMainRedPoint=[],e.roleRedPoint=[],e.equipRedPoint=[],e.associated(e.postRedPoint,e.postLegendMainRedPoint),e.associated(e.postLegendMainRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipLegenLevel,GameLogic.ins().postSubRoleChange,Actor.init),e}return __extends(e,t),e.prototype.postRedPoint=function(){this.totalRedPoint=!1;for(var t=0;t<this.LegendMainRedPoint.length;t++)this.LegendMainRedPoint[t]&&(this.totalRedPoint=!0);return!0},e.prototype.postLegendMainRedPoint=function(){return!0},e.prototype.postRoleRedPoint=function(){this.LegendMainRedPoint=[!1,!1];for(var t=0;3>t;t++){this.equipRedPoint[t]=[!1,!1];var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=e.legenEquipDate[0],n=e.legenEquipDate[2],s=null,o=null;
for(var a in GlobalConfig.HotBloodAwakeLevel)for(var r in GlobalConfig.HotBloodAwakeLevel[a]){if(0==GlobalConfig.HotBloodAwakeLevel[a][r].slot&&GlobalConfig.HotBloodAwakeLevel[a][r].level==i+1){s=GlobalConfig.HotBloodAwakeLevel[a][r];break}if(2==GlobalConfig.HotBloodAwakeLevel[a][r].slot&&GlobalConfig.HotBloodAwakeLevel[a][r].level==n+1){o=GlobalConfig.HotBloodAwakeLevel[a][r];break}}if(void 0!=s){var l=BagCT.ins().getBagGoodsCountById(0,s.materialInfo.id),h=s.materialInfo.count;l>=h&&(this.equipRedPoint[t][0]=!0,this.roleRedPoint[t]=!0)}if(void 0!=o){var l=BagCT.ins().getBagGoodsCountById(0,o.materialInfo.id),h=o.materialInfo.count;l>=h&&(this.equipRedPoint[t][1]=!0,this.roleRedPoint[t]=!0)}(this.equipRedPoint[t][0]||this.equipRedPoint[t][1])&&(this.LegendMainRedPoint[1]=!0);for(var u=!1,a=0;2>a;a++)u=EquipCT.ins().setLegendEquipItemUpState(a>0?2:0,e),u=EquipCT.ins().setLegendEquipItemState(a>0?2:0,e)||u,this.roleRedPoint[t]||(this.roleRedPoint[t]=u),u&&(this.LegendMainRedPoint[0]=!0)}else this.roleRedPoint[t]=!1,this.equipRedPoint[t]=[!1,!1]}return!0},e.ins=function(){return t.ins.call(this)},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postLegendMainRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),e}(BaseSystem);__reflect(LegendEquipRedPoint.prototype,"LegendEquipRedPoint"),System.LegendEquipRedPoint=function(){return LegendEquipRedPoint.ins()},window.LegendEquipRedPoint=LegendEquipRedPoint;var OrangeEquipRedPoint=function(t){function e(){var e=t.call(this)||this;return e.redPoint=!1,e.roleTabs=[],e.awakeItemPoints=[],e.associated(e.postRedPoint,e.postRoleRedPoint),e.associated(e.postRoleRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,EquipCT.ins().postEquipAwakeLevel,Actor.init),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ZsCT.ins().lv<GlobalConfig.EquipAwakeConf.openzhuanshenglv?!1:GameServer.serverOpenDay<GlobalConfig.EquipAwakeConf.openserverday-1?!1:!0},e.prototype.postRedPoint=function(){var t=this.redPoint;this.redPoint=!1;for(var e=0;e<this.roleTabs.length;e++)this.roleTabs[e]&&(this.redPoint=!0);return t!=this.redPoint},e.prototype.postRoleRedPoint=function(){for(var t=0;3>t;t++){var e=SubRoles.ins().getSubRoleByIndex(t);if(e){var i=this.itemAwakePoints(t);this.roleTabs[t]=i}else this.roleTabs[t]=!1}return!0},e.prototype.itemAwakePoints=function(t){this.awakeItemPoints[t]=[];var e=!1,i=SubRoles.ins().getSubRoleByIndex(t);if(!i||!this.openCheck())return!1;for(var n=0;n<i.equipAwakeLv.length;n++){var s=SubRoles.ins().getSubRoleByIndex(t).getEquipByIndex(n);if(ItemUtil.isCanAwakeEquip(s.item.itemConfig)){var o=i.equipAwakeLv[n],a=GlobalConfig.EquipAwakeLevel[n][o+1];if(a){var r=a?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,a.materialInfo.id):0;r>=a.materialInfo.count?(this.awakeItemPoints[t][n]=!0,e=!0):this.awakeItemPoints[t][n]=!1}else this.awakeItemPoints[t][n]=!1}else this.awakeItemPoints[t][n]=!1}return e},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postRoleRedPoint",null),e}(BaseSystem);__reflect(OrangeEquipRedPoint.prototype,"OrangeEquipRedPoint"),System.OrangeEquipRedPoint=function(){return OrangeEquipRedPoint.ins()},window.OrangeEquipRedPoint=OrangeEquipRedPoint;var AdvanEquipWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.curSelectIndex=0,e._sn_="AdvanEquipWinSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){!SmmzCT.ins().checkOpen()&&this.viewStack.contains(this.SmTreasurePanel)&&this.viewStack.removeChild(this.SmTreasurePanel),this.viewStack.selectedIndex=e.ShenZhuang,this.tab.dataProvider=this.viewStack,this.tab.validateNow()},e.prototype.addDisplay=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t[0]?t[0]:e.ShenZhuang,s=t[1]?t[1]:e.ShenZhuang;this.roleSelect.setCurRole(s),this.addTouchEvent(this.closeBtn,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.onTabTouching),this.observe(BagCT.ins().postItemChange,this.setRedPoint),this.observe(BagCT.ins().postItemAdd,this.setRedPoint),this.observe(BagCT.ins().postItemDel,this.setRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.observe(LegendEquipRedPoint.ins().postRedPoint,this.setRedPoint),this.observe(PowerEquipAwakeRedPoint.ins().postRedPoint,this.setRedPoint),this.observe(SmRedPoint.ins().postRedPoint,this.setRedPoint),this.addChangeEvent(this.roleSelect,this.switchRole),this.setSelectedIndex(n),this.setRedPoint()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this)}},e.prototype.switchRole=function(){var t=this.roleSelect.getCurRole(),e=this.viewStack.selectedChild;e&&e.setRoleId&&e.setRoleId(t)},e.prototype.onTabTouching=function(t){return t.currentTarget.selectedIndex==e.zhuzai?(GameServer.serverOpenDay+1>=GlobalConfig.MasterEquipBaseConf.openday&&ZsCT.ins().lv>=GlobalConfig.MasterEquipBaseConf.zslevel?ViewManager.ins().open(PowerEquipMainWin,this.curRole):TipsCT.ins().showTips(" 开服第"+GlobalConfig.MasterEquipBaseConf.openday+"天并达到"+GlobalConfig.MasterEquipBaseConf.zslevel+"转开启"),void t.preventDefault()):this.checkIsOpen(t.currentTarget.selectedIndex)?void 0:void t.preventDefault()},e.prototype.checkIsOpen=function(t){switch(t){case e.ShenZhuang:}return!0},e.prototype.onTabTouch=function(t){var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e),this.setRedPoint(),ViewManager.ins().close(LimitTaskView)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.viewStack.selectedIndex=t,this.switchRole()},e.openCheck=function(){return Actor.level>=10?!0:(TipsCT.ins().showTips("10级开启"),!1)},e.prototype.setRedPoint=function(){for(var t=!1,i=!1,n=SubRoles.ins().subRolesLen,s=0;n>s;s++){for(var o=0;8>o&&!(t=EquipCT.ins().setOrangeEquipItemState(o,SubRoles.ins().getSubRoleByIndex(s)));o++);t||(t=OrangeEquipRedPoint.ins().roleTabs[s]),this.viewStack.selectedIndex==e.ShenZhuang&&this.roleSelect.showRedPoint(s,t),i=t||BagCT.ins().getLegendHasResolve()}t=!1;for(var a=!1,s=0;n>s;s++){for(var o=0;2>o;o++)if(t=EquipCT.ins().setLegendEquipItemUpState(o>0?2:0,SubRoles.ins().getSubRoleByIndex(s)),t=EquipCT.ins().setLegendEquipItemState(o>0?2:0,SubRoles.ins().getSubRoleByIndex(s))||t,1==o&&t){a=t;break}this.viewStack.selectedIndex==e.ChuanQi&&this.roleSelect.showRedPoint(s,t)}a||(a=EquipCT.ins().checkRedPointEx(5,this.roleSelect.getCurRole())||LegendEquipRedPoint.ins().totalRedPoint);for(var s=0;n>s;s++)this.viewStack.selectedIndex==e.ShenMo?this.roleSelect.showRedPoint(s,SmRedPoint.ins().rolePoints[s]):this.viewStack.selectedIndex==e.zhuzai&&this.roleSelect.showRedPoint(s,LegendEquipRedPoint.ins().roleRedPoint[s]);for(var o=0;o<this.viewStack.numElements;o++){var r=!1;switch(this.viewStack.getElementAt(o)){case this.orangeEquipPanel:r=i;break;case this.legendEquipPanel:r=a;break;case this.ePanel3:r=PowerEquipRedPoint.ins().totalRedPoint||PowerEquipAwakeRedPoint.ins().redPoint;break;case this.SmTreasurePanel:r=SmRedPoint.ins().redPoint}this.tab.getElementAt(o)&&this.tab.getElementAt(o).eRp&&(this.tab.getElementAt(o).eRp.visible=r)}},e.ShenZhuang=0,e.ChuanQi=1,e.zhuzai=2,e.ShenMo=3,__decorate([callDelay(100)],e.prototype,"setRedPoint",null),e}(BaseEuiView);__reflect(AdvanEquipWin.prototype,"AdvanEquipWin"),window.AdvanEquipWin=AdvanEquipWin,ViewManager.ins().reg(AdvanEquipWin,LayerManager.UI_Main);var BreakDownItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.configID=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.itemIcon.imgJob.visible=!1},e.prototype.dataChanged=function(){var t=this.data.itemConfig;if(t.zsLevel>0?this.level.text=t.zsLevel+"转":this.level.text=t.level?"Lv."+t.level:"Lv.1",this.itemIcon.setData(t),this.equipName.text=""+t.name,this.equipName.textColor=ItemUtil.getQualityColor(t),ItemUtil.getType(t)==ItemType.TYPE_9){var e=Book.ins().getDecomposeConfigByItemId(t.id),i=0;if(e)i=e.value;else{var n=GlobalConfig.DecomposeConfig[67];n&&(i=n.value)}this.desc.text="图鉴经验 x"+i,this.tip.visible=!0,this.tip.x=this.equipName.x+this.equipName.width,this.level.text=""}else if(ItemUtil.getType(t)==ThunderEquipPanel.TYPE)this.tip.visible=!1,this.desc0.textFlow=(new egret.HtmlTextParser).parser("<font color='#a5a37e'>必然获得：</font><font color='#d242fb'>雷光尘</font>"),this.desc.textFlow=(new egret.HtmlTextParser).parser("<font color='#a5a37e'>几率获得：</font><font color='#ff750f'>雷灵石</font>");else if(ItemUtil.getType(t)==ItemType.TYPE_28){var s=GlobalConfig.ItemConfig[t.output[0].id];this.tip.visible=!1,this.desc.text=s.name+" x "+t.output[0].count,this.desc.textColor=this.equipName.textColor}else{var o=GlobalConfig.EquipConfig[t.id];if(!o)return;var s=GlobalConfig.ItemConfig[o.stoneId];if(!s)return;this.desc.text=s.name+" x "+o.stoneNum,this.desc.textColor=this.equipName.textColor;var a=ItemUtil.getSubType(t),r=EquipCT.ins().getEquipConfigIDByPosAndQuality(a,ItemUtil.getQuality(t)),l=GlobalConfig.ItemConfig[r],h=t.zsLevel?t.zsLevel:0,u=l.zsLevel?l.zsLevel:0,p=t.level?t.level:0,c=l.level?l.level:0,d=1e4*h+p,g=1e4*u+c;g>d?ZsCT.ins().lv>=u&&Actor.level>=c?this.tip.visible=!1:(this.tip.visible=!0,this.tip.x=this.equipName.x+this.equipName.width):this.tip.visible=!1}this.configID=this.data.handle},e}(BaseItemRender);__reflect(BreakDownItemRenderer.prototype,"BreakDownItemRenderer"),window.BreakDownItemRenderer=BreakDownItemRenderer;var BreakDownListview=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="BreakDownSkin",this.isTopLevel=!0,this.equipList.itemRenderer=BreakDownItemRenderer,this.listData=new eui.ArrayCollection,this.equipList.dataProvider=this.listData,this.gainList.itemRenderer=GainGoodsItem,this.goList=new eui.ArrayCollection,this.gainList.dataProvider=this.goList},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.observe(BagCT.ins().postItemDel,this.updateData),this.addTouchEvent(this,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onGo,this),this.quality=t[0],this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(){var t=BagCT.ins().getBagEquipsByQuality(this.quality);t.sort(function(t,e){var i=GlobalConfig.ItemConfig[t.configID],n=GlobalConfig.ItemConfig[e.configID];return i.zsLevel>n.zsLevel?1:i.zsLevel<n.zsLevel?-1:i.level>n.level?1:i.level<n.level?-1:0}),this.listData.source=t;var e=this.itemList[this.quality],i=e.length;this.goList.removeAll();for(var n=0;n<e.length;n++)this.goList.addItem(e[n]);this.refushPos(i)},e.prototype.refushPos=function(t){this.contrain.height=60*t,this.equipScroller.height=310+60*(3-t)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn0:case this.closeBtn:case this.bgClose:ViewManager.ins().close(this);break;default:if(t.target instanceof eui.Button)switch(t.target.name){case"breakDown":EquipCT.ins().sendSmeltEquip(1,[t.target.parent.data])}}},e.prototype.onGo=function(t){var e=t.item;if(null!=t.item){var i=ViewManager.ins().viewOpenCheck(e[1],e[2]);i&&(GameGuider.guidance(e[1],e[2]),ViewManager.ins().close(this))}},e}(BaseEuiView);__reflect(BreakDownListview.prototype,"BreakDownListview"),ViewManager.ins().reg(BreakDownListview,LayerManager.UI_Popup),window.BreakDownListview=BreakDownListview;var HuntBoxsTips=function(t){function e(){var e=t.call(this)||this;return e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="TreasureRuneGift"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.index=t[0],t.length>=2&&(this.type=t[1],this.activityID=t[2]),this.addTouchEvent(this.bgClose,this.onTap),this.gift.itemRenderer=ItemBase,3==this.type?this.initActivity():2==this.type?this.initHeirloom():4==this.type?this.initActivity40_2():this.initInfo()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeObserve()},e.prototype.initInfo=function(){var t=GlobalConfig.FuwenTreasureRewardConfig[this.index];if(t)if(this.gift.dataProvider=new eui.ArrayCollection(t.reward),this.num0.text=Rune.ins().runeCount.toString(),Rune.ins().boxs[this.index-1]==Rune.UNGET){var e=t.needTime-Rune.ins().runeCount;this.num1.text=e>0?e+"":"0",this.already.visible=!1}else this.num1.visible=this.num2.visible=this.num3.visible=!1,this.already.visible=!0},e.prototype.initHeirloom=function(){var t=GlobalConfig.HeirloomTreasureRewardConfig[this.index];if(t)if(this.gift.dataProvider=new eui.ArrayCollection(t.reward),this.num0.text=Heirloom.ins().huntTimes.toString(),Heirloom.ins().huntBoxInfo[this.index-1]==Heirloom.UNGET){var e=t.needTime-Heirloom.ins().huntTimes;this.num1.text=e>0?e+"":"0",this.already.visible=!1}else this.num1.visible=this.num2.visible=this.num3.visible=!1,this.already.visible=!0},e.prototype.initActivity=function(){var t=GlobalConfig.ActivityType18Config[this.activityID][this.index];this.gift.dataProvider=new eui.ArrayCollection(t.rewards);var e=Activity.ins().getActivityDataById(this.activityID);this.num0.text=e.num+"";var i=t.dbCount-e.num;this.num1.text=i>0?i+"":"0",1==e.getStateByIndex(this.index)?this.already.visible=!0:this.already.visible=!1},e.prototype.initActivity40_2=function(){var t=GlobalConfig.ActivityType40_1Config[this.activityID][this.index];t.lotteryCount&&(this.gift.dataProvider=new eui.ArrayCollection(t.rewards));var e=Activity.ins().getActivityDataById(this.activityID);this.num0.text=e.lottery+"";var i=t.lotteryCount-e.lottery;this.num1.text=i>0?i+"":"0",1==e.getStateByIndex(this.index)?this.already.visible=!0:this.already.visible=!1},e.prototype.onTap=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(HuntBoxsTips.prototype,"HuntBoxsTips"),ViewManager.ins().reg(HuntBoxsTips,LayerManager.UI_Popup),window.HuntBoxsTips=HuntBoxsTips;var HuntListRenderer=function(t){function e(){var e=t.call(this)||this;return e.job=["","战士","法师","道士"],e.skinName="HuntListRendererSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data,e=GlobalConfig.ItemConfig[t[1]];if(null!=e){var i,n=ItemUtil.getQualityColor(e),s=ItemUtil.getType(e);i=0==s?"<font color = '#12b2ff'>"+t[0]+"</font> 获得 <font color='"+n+"'>"+this.makeNameList(e)+"</font>":"<font color = '#12b2ff'>"+t[0]+"</font> 获得 <font color='"+n+"'>"+e.name+"</font>",this.showText.textFlow=TextFlowMaker.generateTextFlow(i)}},e.prototype.makeNameList=function(t){var e="";return e=t.name,e+=t.zsLevel>0?"("+t.zsLevel+"转 ":"("+t.level+"级 ",e+=this.job[ItemUtil.getJob(t)]+")"},e.QUALITY_COLOR=["#e2dfd4","#35e62d","#d242fb","#ff750f","#f3311e","#ffd93f"],e}(BaseItemRender);__reflect(HuntListRenderer.prototype,"HuntListRenderer"),window.HuntListRenderer=HuntListRenderer;var c_launchX=window.c_launchX=180,c_launchY=window.c_launchY=500,c_firstX=window.c_firstX=0,c_firstY=window.c_firstY=0,c_distantX=window.c_distantX=77,c_distantY=window.c_distantY=93,c_depotX=window.c_depotX=320,c_depotY=window.c_depotY=620,waitTime=window.waitTime=50,HuntResultWin=function(t){function e(){var e=t.call(this)||this;return e.arr=[],e.items=[],e.type=0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="HuntResult",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.buyBtn,this.buy),this.observe(Hunt.ins().postHuntResult,this.updateView),this.observe(Heirloom.ins().postHuntResult,this.updateView),this.observe(Activity.ins().postHuntResult,this.updateView),this.updateView([t[0],t[1],t[2],t[3]])},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.closeFunc&&this.closeFunc(),Timer.stop(this.buy,this)},e.prototype.updateView=function(t){if(this.canClicck=!0,this.huntType=t[0],this.arr=t[1],this.type=t[2],this.activityID=t[3],this.closeFunc=null,0==this.huntType){var e=0;0==this.type?e=GlobalConfig.TreasureHuntConfig.huntOnce:1==this.type?e=GlobalConfig.FuwenTreasureConfig.huntOnce:2==this.type?e=GlobalConfig.HeirloomTreasureConfig.huntOnce:3==this.type?e=GlobalConfig.ActivityType18Config[this.activityID][1].yb:4==this.type?e=GlobalConfig.ActivityType40Config[this.activityID][1].yb:5==this.type&&(e=GlobalConfig.BeastTreasureBase.costYB),this.yb=e,this.buyBtn.labelDisplay.text="购买1次"}else{var e=0;0==this.type?e=GlobalConfig.TreasureHuntConfig.huntTenth:1==this.type?e=GlobalConfig.FuwenTreasureConfig.huntTenth:2==this.type?e=GlobalConfig.HeirloomTreasureConfig.huntTenth:3==this.type?e=GlobalConfig.ActivityType18Config[this.activityID][2].yb:4==this.type?e=GlobalConfig.ActivityType40Config[this.activityID][1].yb*this.huntType:5==this.type&&(e=GlobalConfig.BeastTreasureBase.costYBten),this.yb=e,this.buyBtn.labelDisplay.text="购买10次"}this.yb>0?this.zwHunt.addChildAt(this.eYuanBaoGroup,0):DisplayUtils.removeFromParent(this.eYuanBaoGroup),this.zwHunt.visible=!0;var i;if(0==this.type)i=GlobalConfig.TreasureHuntConfig.huntItem;else if(1==this.type)i=GlobalConfig.FuwenTreasureConfig.huntItem;else if(2==this.type)i=GlobalConfig.HeirloomTreasureConfig.huntItem;else if(3==this.type){i=GlobalConfig.ActivityType18Config[this.activityID][1].item;var n=Activity.ins().getActivityDataById(this.activityID);if(n){var s=GlobalConfig.ActivityType18Config[this.activityID][0].relateActivityId,o=Activity.ins().getActivityDataById(s);o&&(this.closeFunc=function(){Activity.ins().postHuntResultPlayFunc()})}}else 4==this.type?i=GlobalConfig.ActivityType40Config[this.activityID][1].itemId:5==this.type&&(i=GlobalConfig.BeastTreasureBase.costItemId);this.zw.text=this.yb>0?this.yb+"":"";var a=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,i),r=this.huntType?10:1,l=a?a.count:0;this.zwNum1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(l>=r?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+l+"</font> "),this.icon.source=GlobalConfig.ItemConfig[i].icon+"_png",this.zwNum2.text=0==this.huntType?"/1）":"/10）",this.playResult()},e.prototype.playResult=function(t){var e=this;this.releaseAllItem();for(var i=this.arr.length,n=0;i>n;n++){this.items[n]=this.createItem(this.arr[n]);var s=egret.Tween.get(this.items[n]);this.items[n].x=n%5*c_distantX+c_firstX,this.items[n].y=Math.floor(n/5)*c_distantY+c_firstY,this.items[n].alpha=0,s.wait(n*waitTime).to({alpha:1},200).call(function(){i--,0==i&&(void 0!=t&&t(),e.canClicck=!0)})}},e.prototype.playGet=function(t){for(var e=this,i=this.arr.length,n=0;i>n;n++)if(this.items[n]){var s=egret.Tween.get(this.items[n]);s.to({y:c_depotY,x:c_depotX,scaleX:0,scaleY:0},300-50*Math.floor(n/5)).call(function(){i--,0==i&&(void 0!=t&&t(),e.releaseAllItem())})}},e.prototype.createItem=function(t){var e=new ItemBase;this.listCon.addChild(e);var i=GlobalConfig.ItemConfig[t[0]];return i?(e.num=t[1],e.data=t[0]):e.data={type:0,count:t[1],id:t[0]},e.x=c_launchX,e.y=c_launchY,e},e.prototype.releaseAllItem=function(){for(var t in this.items)this.items[t].destruct(),this.listCon.removeChild(this.items[t]);this.items=[]},e.prototype.closeCB=function(t){var e=this;if(this.canClicck){this.canClicck=!1;var i=function(){ViewManager.ins().close(e)};this.playGet(i)}},e.prototype.buy=function(t){var e=this;if(this.buyBtn.touchEnabled=!1,Timer.start(1e3,1,function(){e.buyBtn.touchEnabled=!0},this),3==this.type&&BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin);if(this.canClicck){if(2==this.type&&0==this.huntType&&Heirloom.ins().huntFreeTimes>0)return void Heirloom.ins().sendHunt(this.huntType);var i=0;i=5==this.type?GlobalConfig.BeastTreasureBase.costItemId:4==this.type?GlobalConfig.ActivityType40Config[this.activityID][1].itemId:3==this.type?GlobalConfig.ActivityType18Config[this.activityID][1].item:2==this.type?GlobalConfig.HeirloomTreasureConfig.huntItem:1==this.type?GlobalConfig.FuwenTreasureConfig.huntItem:GlobalConfig.TreasureHuntConfig.huntItem;var n=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,i);if(n&&n.count){var s=function(){0==e.type?Hunt.ins().sendHunt(e.huntType):1==e.type?Rune.ins().sendHuntRune(e.huntType):2==e.type?Heirloom.ins().sendHunt(e.huntType):3==e.type?Activity.ins().sendReward(e.activityID,0==e.huntType?1:2):4==e.type?Activity.ins().sendReward(e.activityID,0,0==e.huntType?1:2):5==e.type&&BeastCT.ins().sendTreasure(e.huntType)};this.playGet(s),this.canClicck=!1}else if(this.yb>0){var o=this.huntType?10:1;HuntWarnBuyWin.showBuyWarn(this.getPanelNameByType(this.type)+"-HuntResultWin"+this.huntType,this.huntWarnFun.bind(this),"是否消耗"+this.yb+"元宝购买"+GlobalConfig.ItemConfig[i].name+"*"+o)}}},e.prototype.getPanelNameByType=function(t){return 5==this.type?"TreasureBeastPanel":4==this.type?"OSATarget40Panel_"+this.activityID:3==this.type?"OSATarget18Panel"+GlobalConfig.ActivityType18Config[this.activityID][0].showType:2==this.type?"TreasureChuanshiPanel":1==this.type?"TreasureRunePanel":"TreasureHuntPanel"},e.prototype.huntWarnFun=function(){var t=this;if(Actor.yb>=this.yb){var e=function(){0==t.type?Hunt.ins().sendHunt(t.huntType):1==t.type?Rune.ins().sendHuntRune(t.huntType):2==t.type?Heirloom.ins().sendHunt(t.huntType):3==t.type?Activity.ins().sendReward(t.activityID,0==t.huntType?1:2):4==t.type?Activity.ins().sendReward(t.activityID,0,0==t.huntType?1:2):5==t.type&&BeastCT.ins().sendTreasure(t.huntType)};this.playGet(e),this.canClicck=!1}else TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e}(BaseEuiView);__reflect(HuntResultWin.prototype,"HuntResultWin"),window.HuntResultWin=HuntResultWin,ViewManager.ins().reg(HuntResultWin,LayerManager.UI_Main);var HuntWarnBuyWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="WarnBuySkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panel=t[0],this.callback=t[1],this.des=t[2],this.addTouchEndEvent(this,this.onTouch),this.update()},e.prototype.close=function(){this.panel=null,this.callback=null,this.removeTouchEvent(this,this.onTouch)},e.showBuyWarn=function(t,i,n){1==e.loginRecords[t]?i&&i():ViewManager.ins().open(e,t,i,n)},e.prototype.update=function(){this.tipsCheckbox.selected=!1,this.desTxt.textFlow=TextFlowMaker.generateTextFlow(this.des)},e.prototype.onTouch=function(t){switch(t.target){case this.noBtn:case this.BG:ViewManager.ins().close(this);break;case this.yesBtn:e.loginRecords[this.panel]=this.tipsCheckbox.selected,this.callback&&this.callback(),ViewManager.ins().close(this)}},e.loginRecords={},e}(BaseEuiView);__reflect(HuntWarnBuyWin.prototype,"HuntWarnBuyWin"),window.HuntWarnBuyWin=HuntWarnBuyWin,ViewManager.ins().reg(HuntWarnBuyWin,LayerManager.UI_Popup);var LegendEquipforgePanel=function(t){function e(){var e=t.call(this)||this;return e.currentRoleID=0,e.currenSelect=0,e.currentLightNum=0,e.currjineng=0,e.isCangrow=!1,e.itemIcon="",e.skinName="LegendEquipforgeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.currenSelect=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>"),this.getTreasureBtn.touchEnabled=!0},e.prototype.open=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.currjineng=e.effLv1,this.currenSelect=0,this.currjineng=0,this.isCangrow=!1,this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this),this.addTouchEvent(this.chuanqi1,this.OnSelect),this.addTouchEvent(this.chuanqi2,this.OnSelect),this.addTouchEvent(this.effectPic,this.OnSelect),this.addTouchEvent(this.executeBtn,this.OnSelect),this.addTouchEvent(this.itemPic,this.OnSelect),this.observe(BagCT.ins().postItemAdd,this.updateView),this.observe(BagCT.ins().postItemDel,this.updateView),this.observe(BagCT.ins().postItemChange,this.updateView),this.observe(EquipCT.ins().postEquipLegenLevel,this.updateView),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.observe(LegendEquipRedPoint.ins().postRedPoint,this.setRedPoint),this.setRoleId(t[0]),this.updateView(),this.setRedPoint(),this.legendMc1=new MovieClip,this.legendMc1.playFile(RES_DIR_EFF+"LegenEqui",-1),this.eff.addChild(this.legendMc1)},e.prototype.close=function(){this.reMoveEEF()},e.prototype.setRedPoint=function(){var t=LegendEquipRedPoint.ins().equipRedPoint;return this.redPoint0.visible=t[this.currentRoleID][0==this.currenSelect?0:1],this.redPoint1.visible=t[this.currentRoleID][0],this.redPoint2.visible=t[this.currentRoleID][1],!0},e.prototype.updateView=function(){this.setRedPoint(),this.currjineng=0,this.equipPicName.source=this.currenSelect>0?"chuanqi2red_png":"chuanqi1red_png",this.itemPic.source=0==this.currenSelect?"101019_png":"121014_png";var t=GlobalConfig.ItemConfig[0==this.currenSelect?75109:75110],e=EquipCT.getLegendJINengLevel();this.upGrupGroup.visible=!0;var i=this.role.legenEquipDate[this.currenSelect],n=this.role.legenEquipDate[0==this.currenSelect?2:0];this.topLevel.visible=!1,this.attrGroup2.visible=!1,this.arrow1.visible=!0,this.equipName.visible=!0,this.xuanzhong1.visible=0==this.currenSelect,this.xuanzhong2.visible=!this.xuanzhong1.visible,this.haveEquip(this.currenSelect),i>=e[2]&&(this.topLevel.text="已满级",this.topLevel.visible=!0,this.upGrupGroup.visible=!1,this.attrGroup2.visible=!0,this.arrow1.visible=!1),i>=e[2]&&n>=e[2]?this.currjineng=3:i>=e[1]&&n>=e[1]?this.currjineng=2:i>=e[0]&&n>=e[0]&&(this.currjineng=1),this.attrGroup0.visible=i<e[2],this.attrGroup1.visible=i<e[2],this.playEFF(i);var s=null,o=null;for(var a in GlobalConfig.HotBloodAwakeLevel)for(var r in GlobalConfig.HotBloodAwakeLevel[a])if(GlobalConfig.HotBloodAwakeLevel[a][r].slot==this.currenSelect&&GlobalConfig.HotBloodAwakeLevel[a][r].level==i&&(s=GlobalConfig.HotBloodAwakeLevel[a][r]),GlobalConfig.HotBloodAwakeLevel[a][r].slot==this.currenSelect&&GlobalConfig.HotBloodAwakeLevel[a][r].level==i+1){o=GlobalConfig.HotBloodAwakeLevel[a][r];break}var l=0,h=BagCT.ins().getBagGoodsCountById(0,t.id);if(this.cur.text=h.toString(),null!=o){this.need.text="/"+o.materialInfo.count,this.isCangrow=h>=o.materialInfo.count,this.itemIcon=GlobalConfig.ItemConfig[o.materialInfo.id].icon+"_png",this.cur.textColor=this.isCangrow?ColorUtil.GREEN:ColorUtil.RED,this.title2.text="神话"+(i+1)+"阶",this.title2.textColor=16777215,this.attr0.text="",this.attr0.height=0,this.attr0.width=250,this.attr0.textAlign="center",this.attr0.textColor=65280;for(var u=o.attrs,a=0;a<u.length;a++){var p=AttributeData.getAttrStrByType(u[a].type);this.attr0.text+=p+":"+u[a].value+"\n",this.attr0.height+=20}this.attr0.text+=(0==this.currenSelect?"武器":"衣服")+"基础属性+"+o.precent/100+"%",this.attr0.height+=20}if(this.attr3.text="",this.attr3.height=0,this.attr3.width=250,this.attr3.textColor=65280,this.attr3.textAlign="center",null!=s){var c=0==i?"未神话":"神话"+i+"阶";if(this.title1.text=c,this.title1.textColor=16777215,i==e[2]){this.attr2.height=0,this.attr2.width=250,this.attr2.textColor=65280;var d="|C:0xFFFFFF&T:"+c+"|\n";this.attr2.textFlow=TextFlowMaker.generateTextFlow1(d),this.attr2.height+=40,this.attr2.textAlign="center"}for(var u=s.attrs,g=i>=e[2]?this.attr2:this.attr3,a=0;a<u.length;a++){var p=AttributeData.getAttrStrByType(u[a].type);g.text+=p+":"+u[a].value+"\n",g.height+=20}g.text+=(0==this.currenSelect?"武器":"衣服")+"基础属性+"+s.precent/100+"%",g.height+=20,l+=BagCT.getAttrPower(u);var f=ItemUtil.getBaseAttrData(this.role.equipsData[this.currenSelect].item.itemConfig);for(var v in f)f[v].value=f[v].value*(s.precent/1e4);l+=BagCT.getAttrPower(f)}else this.title1.text="未神话",this.title1.textColor=16777215,0==this.currenSelect?(this.attr3.text+=AttributeData.getAttrStrByType(2)+":0\n",this.attr3.text+=AttributeData.getAttrStrByType(4)+":0\n",this.attr3.height+=40):(this.attr3.text+=AttributeData.getAttrStrByType(2)+":0\n",this.attr3.text+=AttributeData.getAttrStrByType(5)+":0\n",this.attr3.text+=AttributeData.getAttrStrByType(6)+":0\n",this.attr3.height+=60),this.attr3.text+=(0==this.currenSelect?"武器":"衣服")+"基础属性+0%",this.attr3.height+=20;this.powerPanel3.setPower(l),this.setRedPoint()},e.prototype.OnSelect=function(t){switch(t.currentTarget){case this.chuanqi1:this.currenSelect=0;break;case this.chuanqi2:this.currenSelect=2;break;case this.effectPic:ViewManager.ins().open(LegendEquipSkillWin,this.currenSelect,this.currentRoleID,this.currjineng);break;case this.executeBtn:this.isCangrow?EquipCT.ins().sendLegenCompose(this.currentRoleID,this.currenSelect):TipsCT.ins().showTips("|C:0xf3311e&T:材料不足|")}this.updateView(),this.setRedPoint()},e.prototype.openSmeltView=function(t){var e=GlobalConfig.HotBloodAwakeLevel[0==this.currenSelect?0:2][1].materialInfo.id,i=ViewManager.ins().open(ShopGoodsWarn);i.setData(e,1)},e.prototype.playEFF=function(t){var e=this;if(t>=this.currentLightNum){for(var i=function(t){return n["e"+(t+1)].numChildren>0?"continue":void egret.Tween.get(n["e"+(t+1)]).call(function(){var i=new MovieClip;i.playFile(RES_DIR_EFF+"LegendForge",-1),e["e"+(t+1)].addChild(i)})},n=this,s=0;t>s;s++)i(s);for(var o=t;6>o;o++)egret.Tween.removeTweens(this["e"+(o+1)]),this["e"+(o+1)].numChildren>0&&this["e"+(o+1)].removeChildren()}else for(var s=this.currentLightNum-1;s>=t;s--)0!=this["e"+(s+1)].numChildren&&this["e"+(s+1)].removeChildren();this.currentLightNum=t},e.prototype.reMoveEEF=function(){for(var t=0;6>t;t++)egret.Tween.removeTweens(this["e"+(t+1)]),this["e"+(t+1)].numChildren<=0||this["e"+(t+1)].removeChildren();this.currentLightNum=0,DisplayUtils.removeFromParent(this.legendMc1)},e.prototype.setRoleId=function(t){this.currentRoleID=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currentRoleID),this.updateView()},e.prototype.haveEquip=function(t){var e=GlobalConfig.HotBloodAwakeConf.legendEquip,i=this.role.equipsData[t].item;return 0==i.configID?!1:e.indexOf(i.configID)>-1?(this.equipName.text=i.itemConfig.name,!0):(this.equipName.text="未穿戴",!1)},e.effLv1=1,e.efflv2=2,e.effLv3=3,e}(BaseView);__reflect(LegendEquipforgePanel.prototype,"LegendEquipforgePanel"),window.LegendEquipforgePanel=LegendEquipforgePanel;var LegendEquipmainPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentRoleID=0,e.currenSelect=0,e._sn_="LegendEquipmainSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.name="热血",this.panelArr=[this.legendEquipPanel,this.legendEquipforgePanel],this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.currentRoleID=t[0],this.roleSelect.setCurRole(t[0]),this.addChangeEvent(this.roleSelect,this.switchRole),this.currenSelect=0,this.tab.dataProvider=this.viewStack,this.addChangeEvent(this.tab,this.onTabTouch),this.panelArr[this.currenSelect].open(this.currentRoleID),this.observe(BagCT.ins().postItemChange,this.setRedPoint),this.observe(BagCT.ins().postItemAdd,this.setRedPoint),this.observe(BagCT.ins().postItemDel,this.setRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.observe(LegendEquipRedPoint.ins().postRedPoint,this.setRedPoint),this.setRedPoint()},e.prototype.switchRole=function(){this.currentRoleID=this.roleSelect.getCurRole(),this.panelArr[this.currenSelect].setRoleId(this.currentRoleID)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.currenSelect].close()},e.prototype.checkIsOpen=function(t){if(1==t.target.selectedIndex){var e=GlobalConfig.HotBloodAwakeConf.openzhuanshenglv;if(ZsCT.ins().lv<e)return TipsCT.ins().showTips("热血神话功能"+e+"转开启"),t.$cancelable=!0,void t.preventDefault()
}},e.prototype.onTabTouch=function(t){this.panelArr[this.currenSelect].close();var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e)},e.prototype.setSelectedIndex=function(t){this.currenSelect=t,this.panelArr[t].open(this.currentRoleID),this.viewStack.selectedIndex=t,this.setRedPoint()},e.prototype.setRoleId=function(t){this.currentRoleID=t,this.panelArr[this.currenSelect].setRoleId(this.currentRoleID)},e.prototype.setRedPoint=function(){for(var t=!1,e=SubRoles.ins().subRolesLen,i=0;e>i;i++)t||(t=OrangeEquipRedPoint.ins().roleTabs[i]),this.roleSelect.showRedPoint(i,t);for(var i=0;e>i;i++)0==this.viewStack.selectedIndex&&this.roleSelect.showRedPoint(i,t),this.roleSelect.showRedPoint(i,LegendEquipRedPoint.ins().roleRedPoint[i]);return this.redPoint1.visible=LegendEquipRedPoint.ins().LegendMainRedPoint[1],this.redPoint2.visible=LegendEquipRedPoint.ins().LegendMainRedPoint[0],this.panelArr[0].setRedPoint()||this.panelArr[1].setRedPoint()},e}(BaseEuiView);__reflect(LegendEquipmainPanel.prototype,"LegendEquipmainPanel"),window.LegendEquipmainPanel=LegendEquipmainPanel,ViewManager.ins().reg(LegendEquipmainPanel,LayerManager.UI_Main);var LegendEquipPanel=function(t){function e(){var e=t.call(this)||this;return e._roleId=0,e._sn_="LegendEquipSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.curIndex=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>"),this.getTreasureBtn.touchEnabled=!0,this.legendMc=new MovieClip,this.legendMc1=new MovieClip,this.legendMc2=new MovieClip,this.chargeEff1=new MovieClip,this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2,this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.7,this.chargeEff1.scaleX=.9,this._weaponEffect=new MovieClip,this._bodyEffect=new MovieClip,this.legendMc.playFile(RES_DIR_EFF+"Projection",-1),this.lighteff.addChild(this.legendMc),this.legendMc1.playFile(RES_DIR_EFF+"LegenEqui",-1),this.weaponEff.addChild(this.legendMc1),this.legendMc2.playFile(RES_DIR_EFF+"LegenEqui",-1),this.armorEff.addChild(this.legendMc2)},e.prototype.addDisplay=function(){this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this),this.addTouchEvent(this.mixSwordBtn,this.onSelect),this.addTouchEvent(this.mixArmorBtn,this.onSelect),this.addTouchEvent(this.armorIcon,this.onSelect),this.addTouchEvent(this.swordIcon,this.onSelect),this.addTouchEvent(this.executeBtn,this.executeCB),this.observe(EquipCT.ins().postMixGodEquip,this.mixCB),this.observe(BagCT.ins().postItemAdd,this.updateView),this.observe(BagCT.ins().postItemDel,this.updateView),this.observe(BagCT.ins().postItemChange,this.updateView),this.observe(GameLogic.ins().postSubRoleChange,this.updateSubRoleChange),Timer.start(2e3,0,this.mcChange,this),this.updateView()},e.prototype.removeDisplay=function(){Timer.stop(this.mcChange,this),DisplayUtils.removeFromParent(this.legendMc),DisplayUtils.removeFromParent(this.legendMc1),DisplayUtils.removeFromParent(this.legendMc2),DisplayUtils.removeFromParent(this._weaponEffect),DisplayUtils.removeFromParent(this._bodyEffect)},e.prototype.mcChange=function(){egret.Tween.removeTweens(this.bgMc);var t=egret.Tween.get(this.bgMc);t.to({alpha:0},1e3).to({alpha:1},1e3)},e.prototype.executeCB=function(t){return parseInt(this.cur.text)<parseInt(this.need.text.substr(1))?void TipsCT.ins().showTips("|C:0xf3311e&T:热血碎片不足|"):void(this.executeBtn.label==c_grewup?this.grewup():this.executeBtn.label==c_mix&&this.mix())},e.prototype.grewup=function(){var t=GlobalConfig.ItemConfig[this.curEquipConfigId+1];return t.level>Actor.level||t.zsLevel>ZsCT.ins().lv?void TipsCT.ins().showTips("|C:0xf3311e&T:升级后超过角色等级，无法升级|"):void EquipCT.ins().sendGrewupEquip(this._roleId,this.curIndex)},e.prototype.mix=function(){var t=EquipCT.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5),e=GlobalConfig.ItemConfig[t];e.level<=Actor.level&&e.zsLevel<=ZsCT.ins().lv?EquipCT.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex):TipsCT.ins().showTips("|C:0xf3311e&T:等级不满足，无法合成|")},e.prototype.mixCB=function(t,e,i){return 0==e?void TipsCT.ins().showTips("|C:0xf3311e&T:合成失败|"):(TipsCT.ins().showTips("合成成功,已自动穿戴至角色身上"),void this.updateView())},e.prototype.openSmeltView=function(t){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,5)},e.prototype.onSelect=function(t){switch(t.currentTarget){case this.mixSwordBtn:case this.swordIcon:this.curIndex=0;break;case this.mixArmorBtn:case this.armorIcon:this.curIndex=2}this.updateView()},e.prototype.setRoleId=function(t){this._roleId=t;var e=SubRoles.ins().getSubRoleByIndex(this._roleId),i=e.getEquipByIndex(0),n=e.getEquipByIndex(2);i&&this.checkQuality(i)?this.curIndex=0:n&&this.checkQuality(n)&&(this.curIndex=2),this.updateView()},e.prototype.updateView=function(){if(this.skin){this.updateAttrPanel(),this.updateIconAndDesc();var t=this.setRedPoint();t&&this.setEff()}},e.prototype.setEff=function(){var t=BagCT.ins().getLegendOutEquips();t.length?(this.chargeEff1.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.chargeEff1.parent||this.getTreasureBtn.parent.addChild(this.chargeEff1)):DisplayUtils.removeFromParent(this.chargeEff1)},e.prototype.updateSubRoleChange=function(){var t=this.setRedPoint();t&&this.setEff()},e.prototype.checkQuality=function(t){var e=!1;return t&&t.item&&t.item.itemConfig&&(e=5==ItemUtil.getQuality(t.item.itemConfig)),e},e.prototype.updateAttrPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=GlobalConfig.ItemConfig[t.item.configID+1],i=0,n=0,s=ItemUtil.getQuality(t.item.itemConfig);if(void 0==e&&0!=t.item.handle&&5==s)this.mixAttributes.visible=!0,this.grewupAttributes.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.topLevel.visible=!0,this.costGroup.visible=!1,this.executeBtn.visible=!1,this.need.text="",this.cur.text="";else{if(void 0!=e&&0!=t.item.handle&&5==s){this.mixAttributes.visible=!1,this.grewupAttributes.visible=!0,this.curEquipConfigId=this.updateGrewupPanel(),this.executeBtn.label=c_grewup;var o=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];i=o.count,n=o.itemId}else{if(this.mixAttributes.visible=!0,this.grewupAttributes.visible=!1,this.curEquipConfigId=this.updateMixPanel(),null==this.curEquipConfigId)return;this.executeBtn.label=c_mix;var a=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];i=a.count,n=a.itemId}this.executeBtn.visible=!0,this.topLevel.visible=!1,this.costGroup.visible=!0;var r=BagCT.ins().getBagGoodsCountById(0,n);this.need.text="/"+i,this.cur.text=r+"",r>=i?this.cur.textColor=ColorUtil.GREEN_COLOR_N:this.cur.textColor=ColorUtil.RED_COLOR_N}},e.prototype.updateMixPanel=function(){var t=Actor.level;if(10>t)return void console.log("error: 10级开启");var e=EquipCT.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,this.curIndex,5),i=GlobalConfig.EquipConfig[e];if(i){var n=[],s=[],o=[];for(var a in AttributeData.translate)!i[a]||i[a]<=0||(s.push(i[a]+""),n.push(AttributeData.getAttrStrByType(AttributeData.translate[a])),o.push(" +"+Math.floor(ItemBase.additionRange/100*i[a])));return this.mixAttributes.sCur=i&&i.baseAttr1?AttributeData.getAttStrByType(i.baseAttr1,0,":  "):"",this.mixAttributes.baseAttr.text=ItemData.getStringByNextList(s,o),this.mixAttributes.nameAttr.text=ItemData.getStringByList(n),this.mixAttributes.randAttr.text="",this.mixAttributes.score.text=ItemUtil.pointCalNumber(GlobalConfig.ItemConfig[e]),this.mixAttributes.eMaxLab.y=this.mixAttributes.nameAttr.y+this.mixAttributes.nameAttr.textHeight,e}},e.prototype.updateGrewupPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e],n=GlobalConfig.ItemConfig[e+1];if(void 0==n);else{for(var s=1;4>=s;s++)this.grewupAttributes["arrow"+s].visible=!1;var o=[],a=[],r=[],l=[],h=[],u=GlobalConfig.EquipConfig[e],p=GlobalConfig.EquipConfig[e+1],c=t.item,d=1;for(var g in AttributeData.translate)if(u[g]&&!(u[g]<=0)){if(void 0!=c)for(var f=c.att,v=0;v<f.length;v++)if(f[v].type==AttributeData.translate[g]){r.push(" +"+f[v].value);break}this.grewupAttributes["arrow"+d].visible=!0,d++,a.push(u[g]+""),l.push(p[g]+""),h.push(" +"+Math.floor(ItemBase.additionRange/100*p[g])),o.push(AttributeData.getAttrStrByType(AttributeData.translate[g]))}this.grewupAttributes.sCur=u&&u.baseAttr1?AttributeData.getAttStrByType(u.baseAttr1,0,":",!0):"",this.grewupAttributes.sNext=p&&p.baseAttr1?AttributeData.getAttStrByType(p.baseAttr1,0,"",!0,!1):"",this.grewupAttributes.curBaseAttr.text=ItemData.getStringByNextList(a,r),this.grewupAttributes.nextBaseAttr.text=ItemData.getStringByNextList(l,h),this.grewupAttributes.nameAttr.text=ItemData.getStringByList(o),this.grewupAttributes.curScore.text="评分："+ItemUtil.pointCalNumber(i),this.grewupAttributes.nextScore.text="评分："+ItemUtil.pointCalNumber(n),this.grewupAttributes.eNextLab.y=this.grewupAttributes.eCurLab.y=this.grewupAttributes.nameAttr.y+this.grewupAttributes.nameAttr.textHeight}return e},e.prototype.updateIconAndDesc=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId),i=t.getEquipByIndex(0),n=t.getEquipByIndex(2);0==this.curIndex?(this.swordSelect.visible=!0,this.armorSelect.visible=!1,this.zhanshi.source=null,this.currentState="jian",this.setWeaponEffect(i.item.configID,"wPos",t.sex,this.weaponEffect,this._weaponEffect),this._bodyEffect.parent&&this._bodyEffect.parent.removeChild(this._bodyEffect)):(this.swordSelect.visible=!1,this.armorSelect.visible=!0,this.zhanshi.source=e.armorImg[0]+t.sex+"_png",this.currentState="jia",this.setWeaponEffect(n.item.configID,"bPos",t.sex,this.bodyEffect,this._bodyEffect,2),this._weaponEffect.parent&&this._weaponEffect.parent.removeChild(this._weaponEffect)),this.updateItem(i,this.swordIcon,this.swordLevel,this.mixSwordBtn),this.updateItem(n,this.armorIcon,this.armorLevel,this.mixArmorBtn,2)},e.prototype.updateItem=function(t,e,i,n,s){var o=s?s:this.curIndex,a=GlobalConfig.ItemConfig[EquipCT.ins().getEquipConfigIDByPosAndQualityByLegend(this._roleId,o,5)].zsLevel;if(0!=t.item.handle&&5==ItemUtil.getQuality(t.item.itemConfig)){var r=GlobalConfig.ItemConfig[t.item.configID];n.visible=!1,i.text=r.zsLevel+"转";for(var l=void 0,h=this.curEquipConfigId;h%100!=99&&(l=GlobalConfig.ItemConfig[this.curEquipConfigId+1],void 0==l);h++);o==ItemUtil.getSubType(t.item.itemConfig)&&void 0!=l?i.x=n.x+15-i.width/2:i.x=n.x+15}else n.visible=!1,i.text=a+"转",i.x=n.x+15},e.prototype.setRedPoint=function(){for(var t=!1,e=!1,i=0;2>i;i++)if(e=EquipCT.ins().setLegendEquipItemUpState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId)),e=EquipCT.ins().setLegendEquipItemState(i>0?2:0,SubRoles.ins().getSubRoleByIndex(this._roleId))||e,this["redPoint"+i]&&(this["redPoint"+i].visible=e),t||(t=e),!t){var n=BagCT.ins().getLegendOutEquips();t=n.length>0}return t},e.prototype.setWeaponEffect=function(t,i,n,s,o,a){void 0===a&&(a=0);var r=GlobalConfig.EquipWithEffConfig[t+"_"+n],l=!0;if(!r){var h=(0==a?e.swrodImg[1]:e.armorImg[1])+"_"+(0==a?0:n);r=GlobalConfig.EquipWithEffConfig[h],l=!0}o.scaleX=o.scaleY=r.scaling,o.x=this[i+n].x,o.y=this[i+n].y,o.parent||s.addChild(o),o.playFile(RES_DIR_EFF+(l?r.inShowEff:r.nextShowEff),-1)},e.swrodImg=["chuanqi_0_png","101501"],e.armorImg=["chuanqi_","121501"],e}(BaseView);__reflect(LegendEquipPanel.prototype,"LegendEquipPanel"),window.LegendEquipPanel=LegendEquipPanel;var LegendEquipSkillWin=function(t){function e(){var e=t.call(this)||this;return e.currentSelect=0,e.currentRoleID=0,e.skillConfigIndex=0,e.currentSkillLevel=0,e.skinName="LegendEquipSkillSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.isTopLevel=!0,this.currentSelect=0,this.currentSkillLevel=0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onTap),this.currentSelect=t[0],this.setRoleId(t[1]),this.currentSkillLevel=t[2],this.eEFMovie=new MovieClip,this.upDataView()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.eEFMovie)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.bgClose:ViewManager.ins().close(this)}},e.prototype.upDataView=function(){var t=EquipCT.getLegendJINengLevel(),e=!1,i=this.role.legenEquipDate[0],n=this.role.legenEquipDate[2];this.curskillDesc2.textColor=375860,this.curskillDesc3.textColor=375860,this.curskillDesc2.text="【武器神话"+t[0]+"阶 衣服神话"+t[0]+"阶】",this.nextskillTitle2.text="【武器神话"+t[1]+"阶 衣服神话"+t[1]+"阶】";var s=1;this.curr.text="当前效果：";var o=EquipCT.LegendToLevelgenDescID(i,n),a=GlobalConfig.SkillsConfig[o].desc;switch(this.currentSkillLevel){case 0:if(this.skillConfigIndex=a,this.curskillDesc2.textColor=7170660,i>0||n>0){var r=i>0?"【|C:0x05BC34&T:武器神话"+i+"阶| 衣服神话1阶】":"【武器神话1阶 |C:0xff00ff&T:衣服神话"+n+"阶|】";this.curskillDesc2.textFlow=TextFlowMaker.generateTextFlow1(r)}this.curskillDesc3.textColor=7170660,e=!0,this.curr.text="下阶效果：";break;case 1:this.skillConfigIndex=a;var l="【|C:0x05BC34&T:武器神话"+i+"阶| C:0xff00ff&T:  衣服神话"+n+"阶|】";this.curskillDesc2.textFlow=TextFlowMaker.generateTextFlow1(l);break;case 2:this.skillConfigIndex=a;var h="【|C:0x05BC34&T:武器神话"+i+"阶| C:0xff00ff&T:  衣服神话"+n+"阶|】";this.curskillDesc2.textFlow=TextFlowMaker.generateTextFlow1(h),this.nextskillTitle2.text="【武器神话"+t[2]+"阶 衣服神话"+t[2]+"阶】",s=2;break;case 3:this.skillConfigIndex=a,this.curskillDesc2.text="【武器神话"+t[2]+"阶 衣服神话"+t[2]+"阶】",s=3,e=!0}var u=GlobalConfig.SkillsDescConfig[this.skillConfigIndex];if(!e){var p=GlobalConfig.SkillsDescConfig[this.skillConfigIndex+1];this.nextskillTitle3.textFlow=TextFlowMaker.generateTextFlow1(p.desc)}this.nextEffGroup.visible=!e,this.curskillDesc3.textFlow=TextFlowMaker.generateTextFlow1(u.desc),this.skillName.text=u.name+"Lv"+s,this.eEFMovie.playFile(RES_DIR_EFF+"legendnuzhan",-1),this.skilleff.addChild(this.eEFMovie),this.eEFMovie.y+=110},e.prototype.setRoleId=function(t){this.currentRoleID=t,this.role=SubRoles.ins().getSubRoleByIndex(this.currentRoleID)},e}(BaseEuiView);__reflect(LegendEquipSkillWin.prototype,"LegendEquipSkillWin"),ViewManager.ins().reg(LegendEquipSkillWin,LayerManager.UI_Main),window.LegendEquipSkillWin=LegendEquipSkillWin;var OrangeEquipForgePanel=function(t){function e(){var e=t.call(this)||this;return e.curIndex=0,e.curRoleId=0,e.hasEnough=!1,e.effMCs=[],e._sn_="OrangeEquipForgeSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=0;8>t;t++){var e=this["equip"+t];this.addTouchEvent(e,this.onSelect)}this.addTouchEvent(this.upBtn,this.onClick),this.addChangeEvent(this.roleSelect,this.onChange);var i=new MovieClip;i.playFile(RES_DIR_EFF+"dragonfire",-1),this.effGroup.addChild(i),this.centerEff=new MovieClip,this.centerEff.playFile(RES_DIR_EFF+"orangeeff",-1),this.effGroup0.addChild(this.centerEff)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.setRoleId(t?t[0]:0),this.curIndex=0,this.roleSelect.setCurRole(this.curRoleId),this.observe(EquipCT.ins().postEquipAwakeLevel,this.update),this.observe(OrangeEquipRedPoint.ins().postRedPoint,this.updateRed),this.update()},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ZsCT.ins().lv<GlobalConfig.EquipAwakeConf.openzhuanshenglv?(TipsCT.ins().showTips(GlobalConfig.EquipAwakeConf.openzhuanshenglv+"转开启"),!1):GameServer.serverOpenDay<GlobalConfig.EquipAwakeConf.openserverday-1?(TipsCT.ins().showTips("开服"+GlobalConfig.EquipAwakeConf.openserverday+"天开启"),!1):!0},e.prototype.onChange=function(t){this.setRoleId(this.roleSelect.getCurRole())},e.prototype.updateRed=function(){if(this.skin){this.redPoint.visible=OrangeEquipRedPoint.ins().awakeItemPoints[this.curRoleId][this.curIndex];for(var t=0;8>t;t++){var e=this["equip"+t];e.redPoint.visible=OrangeEquipRedPoint.ins().awakeItemPoints[this.curRoleId][t]}for(var i=SubRoles.ins().subRolesLen,t=0;i>t;t++){var n=OrangeEquipRedPoint.ins().roleTabs[t];this.roleSelect.showRedPoint(t,n)}}},e.prototype.onClick=function(t){switch(t.target){case this.upBtn:this.hasEnough?EquipCT.ins().sendEquipAwakeLevel(this.curRoleId,this.curIndex):TipsCT.ins().showTips("材料不足")}},e.prototype.onSelect=function(t){var e=this.curIndex;switch(t.currentTarget){case this.equip0:this.curIndex=0;break;case this.equip1:this.curIndex=1;break;case this.equip2:this.curIndex=2;break;case this.equip3:this.curIndex=3;break;case this.equip4:this.curIndex=4;break;case this.equip5:this.curIndex=5;break;case this.equip6:this.curIndex=6;break;case this.equip7:this.curIndex=7}if(e!=this.curIndex){var i=this["equip"+e];i&&(i.select.visible=!1),i=this["equip"+this.curIndex],i&&(i.select.visible=!0),this.updateUI(),this.updateRed()}},e.prototype.update=function(t){var e=this;void 0===t&&(t=!1),t&&this.centerEff.playFile(RES_DIR_EFF+"orangeopeneff1",1,function(){e.centerEff.playFile(RES_DIR_EFF+"orangeeff",-1,null,!1)},!1),this.updateAllBadyEquip(),this.updateRed(),this.updateUI(t)},e.prototype.updateUI=function(t){void 0===t&&(t=!1);var e=0,i=null,n=!1,s=!0;this.hasEnough=!1;var o=SubRoles.ins().getSubRoleByIndex(this.curRoleId).getEquipByIndex(this.curIndex);o.item.itemConfig&&ItemUtil.isCanAwakeEquip(o.item.itemConfig)?(e=EquipCT.ins().getBodyEquipAwakeLv(this.curRoleId,this.curIndex),i=GlobalConfig.EquipAwakeLevel[this.curIndex][e+1],n=!i,this.eItems.visible=this.eItemIcon.visible=this.arrow0.visible=this.attrGroup0.visible=this.attrGroup1.visible=this.upBtn.visible=!n,this.attrGroup3.visible=n,this.equipicon.visible=!0,this.equipicon.source=o.item.itemConfig.icon+"_png"):(this.arrow0.visible=this.eItems.visible=this.eItemIcon.visible=this.attrGroup0.visible=this.attrGroup1.visible=this.attrGroup3.visible=this.upBtn.visible=!1,this.maxLevel.visible=!0,this.maxLevel.text="没有穿戴神装",s=!1,this.equipicon.visible=!1),this.lunhuiLv.text=GlobalConfig.EquipAwakeConf.names[e];var a=GlobalConfig.EquipAwakeLevel[this.curIndex][e];this.eAddLab.text="当前部位基础属性加成："+(a?a.precent/100:0)+"%";for(var r=function(i){var n=l["lv"+i];if(e>i){n.filters=[];var s=l.effMCs[i];s||(s=l.effMCs[i]=new MovieClip),l["eff"+i].addChild(s),t&&i==e-1?s.playFile(RES_DIR_EFF+"orangeopeneff2",1,function(){s.playFile(RES_DIR_EFF+"orangejuexing",-1,null,!1)},!1):s.playFile(RES_DIR_EFF+"orangejuexing",-1,null,!1)}else{n.filters=FilterUtil.ARRAY_GRAY_FILTER;var o=l.effMCs[i];o&&(o.stop(),DisplayUtils.removeFromParent(o))}},l=this,h=0;6>h;h++)r(h);if(s)if(n)this.maxLevel.text="已满级",this.attr3.text=this.getAttrStr(o.item,e),this.powerPanel3.setPower(ItemUtil.pointCalAwakeNumber(o.item.itemConfig,e));else{var u=i?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,i.materialInfo.id):0;this.hasEnough=u>=i.materialInfo.count;var p=this.hasEnough?ColorUtil.GREEN:ColorUtil.RED,c='<font color="'+p+'">'+u+"</font>/"+i.materialInfo.count;this.eItems.textFlow=(new egret.HtmlTextParser).parser(c),this.eItemIcon.source=i.materialInfo.id+"_png",this.attr0.text=this.getAttrStr(o.item,e),this.attr1.text=this.getAttrStr(o.item,e+1),this.powerPanel0.setPower(ItemUtil.pointCalAwakeNumber(o.item.itemConfig,e)),this.powerPanel1.setPower(ItemUtil.pointCalAwakeNumber(o.item.itemConfig,e+1)),this.maxLevel.text=""}},e.prototype.getAttrStr=function(t,e){var i="";if(!t)return i;var n=GlobalConfig.EquipAwakeLevel[this.curIndex][e],s=GlobalConfig.EquipConfig[t.configID];for(var o in AttributeData.translate)!s[o]||s[o]<=0||(i+=AttributeData.getAttrStrByType(AttributeData.translate[o])+"："+s[o]+(n?"+"+Math.floor(s[o]*n.precent/1e4):"")+"\n");return i},e.prototype.updateAllBadyEquip=function(){for(var t=0;8>t;t++)this.updateBadyEquip(t)},e.prototype.updateBadyEquip=function(t){var e=this["equip"+t];if(null!=e){var i=SubRoles.ins().getSubRoleByIndex(this.curRoleId).getEquipByIndex(t),n=e.itemIcon;n.imgJob.visible=!1,0!=i.item.handle&&ItemUtil.isCanAwakeEquip(i.item.itemConfig)?(i.item.itemConfig.zsLevel>0?e.level.text=i.item.itemConfig.zsLevel+"转":e.level.text=i.item.itemConfig.level?"Lv."+i.item.itemConfig.level:"Lv.1",n.setData(i.item.itemConfig),this.playEff(t)):(n.setData(null),n.imgIcon.source=OrangeEquipPanel.defaultEquipIcon[t],e.level.text="",this.cleanEffOnly(t)),e.mixBtn.visible=!1,e.select.visible=this.curIndex==t}},e.prototype.playEff=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]||(this["effArr"+e]=new MovieClip,this["effArr"+e].x+=this["equip"+e].width/2,this["effArr"+e].y+=this["equip"+e].height/2-15,this["equip"+e].addChild(this["effArr"+e]),this["effArr"+e].playFile(RES_DIR_EFF+"ValueEff5",-1))}},e.prototype.cleanEffOnly=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]&&(DisplayUtils.removeFromParent(this["effArr"+e]),this["effArr"+e]=null)}},e.prototype.setRoleId=function(t){this.curRoleId=t,this.update()},__decorate([callDelay(100)],e.prototype,"updateRed",null),__decorate([callLater],e.prototype,"update",null),e}(BaseEuiView);__reflect(OrangeEquipForgePanel.prototype,"OrangeEquipForgePanel"),window.OrangeEquipForgePanel=OrangeEquipForgePanel,ViewManager.ins().reg(OrangeEquipForgePanel,LayerManager.UI_Main);var c_grewup="升 级",c_mix="合 成",OrangeEquipPanel=function(t){function e(){var e=t.call(this)||this;return e._roleId=0,e._sn_="OrangeEquipSkin",e.name="神装",e}return __extends(e,t),e.prototype.skinComplete=function(){this.curIndex=0,this.getTreasureBtn.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.getTreasureBtn.text+"</u></a>"),this.getTreasureBtn.touchEnabled=!0,this.chargeEff1=new MovieClip,this.chargeEff1.x=this.getTreasureBtn.x+this.getTreasureBtn.width/2,this.chargeEff1.y=this.getTreasureBtn.y+this.getTreasureBtn.height/2,this.chargeEff1.touchEnabled=!1,this.chargeEff1.scaleY=.7,this.chargeEff1.scaleX=.9},e.prototype.addDisplay=function(){this.getTreasureBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.openSmeltView,this);for(var t=0;8>t;t++){var e=this["equip"+t];this.addTouchEvent(e,this.onSelect),this.addTouchEvent(e.mixBtn,this.onSelect)}this.addTouchEvent(this.executeBtn,this.executeCB),this.addTouchEvent(this.eBtn,this.onClick),this.addTouchEvent(this.eSuitGroup,this.onClick),this.observe(OrangeEquipRedPoint.ins().postRedPoint,this.updateRed),this.observe(EquipCT.ins().postMixEquip,this.mixCB),this.observe(BagCT.ins().postItemAdd,this.updateView),this.observe(BagCT.ins().postItemDel,this.updateView),this.observe(BagCT.ins().postItemChange,this.updateView),this.curIndex=this.computerCurIndex(),this.updateView(),this.updateRed(),this.hideExecuteBtn()},e.prototype.updateRed=function(){this.redPoint.visible=OrangeEquipRedPoint.ins().redPoint},e.prototype.onClick=function(t){t.target==this.eBtn?ViewManager.ins().open(OrangeEquipForgePanel,this._roleId):t.target==this.eSuitGroup&&ViewManager.ins().open(OrangeEquipSuitWin,SubRoles.ins().getSubRoleByIndex(this._roleId),this.suitLv)},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.chargeEff1),this.cleanEff()},e.prototype.onSelect=function(t){switch(t.currentTarget){case this.equip0:case this.equip0.mixBtn:this.curIndex=0;break;case this.equip1:case this.equip1.mixBtn:this.curIndex=1;break;case this.equip2:case this.equip2.mixBtn:this.curIndex=2;break;case this.equip3:case this.equip3.mixBtn:this.curIndex=3;break;case this.equip4:case this.equip4.mixBtn:this.curIndex=4;break;case this.equip5:case this.equip5.mixBtn:this.curIndex=5;break;case this.equip6:case this.equip6.mixBtn:this.curIndex=6;break;case this.equip7:case this.equip7.mixBtn:this.curIndex=7}this.updateView()},e.prototype.executeCB=function(){if(parseInt(this.cur.text)<parseInt(this.need.text.substr(1)))return void TipsCT.ins().showTips("|C:0xf3311e&T:神装碎片不足|");if(this.executeBtn.label==c_grewup)this.grewup();else if(this.executeBtn.label==c_mix){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e];void 0!=i&&5==ItemUtil.getQuality(i)||this.mix()}},e.prototype.hideExecuteBtn=function(){if(this.executeBtn.label==c_mix){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e];void 0!=i&&5==ItemUtil.getQuality(i)&&(this.executeBtn.visible=!1,this.costNum.visible=!1,this.labelMax.visible=!0,this.labelMax.textColor=65280)}},e.prototype.grewup=function(){var t=GlobalConfig.ItemConfig[GlobalConfig.LegendLevelupConfig[this.curEquipConfigId].newEquipId];return t.level>Actor.level||t.zsLevel>ZsCT.ins().lv?void TipsCT.ins().showTips("|C:0xf3311e&T:升级后超过角色等级，无法升级|"):void EquipCT.ins().sendGrewupEquip(this._roleId,this.curIndex)},e.prototype.mix=function(){EquipCT.ins().sendMixEquip(this._roleId,this.curEquipConfigId,this.curIndex)},e.prototype.mixCB=function(t,e,i){return 0==e?void TipsCT.ins().showTips("|C:0xf3311e&T:合成失败|"):(TipsCT.ins().showTips("合成成功,已自动穿戴至角色身上"),void this.updateView())},e.prototype.openSmeltView=function(t){ViewManager.ins().open(BreakDownView,BreakDownView.type_legend,4)},e.prototype.updateView=function(){this.skin&&(this.updateAllEquipItem(),this.updateDetailPanel(),BagCT.ins().getLegendHasResolve()?(this.chargeEff1.visible=!0,this.chargeEff1.playFile(RES_DIR_EFF+"BtnPrompt1",-1),this.chargeEff1.parent||this.btnGroup.addChild(this.chargeEff1)):(this.chargeEff1.visible=!1,DisplayUtils.removeFromParent(this.chargeEff1)),this.setItemRedPoint(),this.updateSuit(),this.updateBtn(),this.hideExecuteBtn())},e.prototype.updateBtn=function(){var t=GlobalConfig.EquipAwakeLevel[0][1],e=t?BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,t.materialInfo.id):0;if(e>0)return void(this.eBtn.visible=!0);for(var i=0;3>i;i++){var n=SubRoles.ins().getSubRoleByIndex(i);if(n)for(var s=0;s<n.equipAwakeLv.length;s++)if(n.equipAwakeLv[s]>0)return void(this.eBtn.visible=!0)}this.eBtn.visible=!1},e.prototype.updateSuit=function(){this.suitLv=EquipCT.getOrangeSuitLv(SubRoles.ins().getSubRoleByIndex(this._roleId)),this.suitLv.zsLv>0?this.eSuitLv.text=this.suitLv.zsLv+"转":this.eSuitLv.text=this.suitLv.lv+"级",this.eSuitLab.text=this.suitLv.num+"/8"},e.prototype.updateDetailPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex);if(null!=t){var e=GlobalConfig.LegendLevelupConfig[t.item.configID]?GlobalConfig.ItemConfig[GlobalConfig.LegendLevelupConfig[t.item.configID].newEquipId]:null,i=0,n=0;this.costNum.visible=!0;var s=ItemUtil.getQuality(t.item.itemConfig);if(void 0==e&&0!=t.item.handle&&4==s)this.mixPanel.visible=!0,this.labelMax.visible=!0,this.labelMax.textColor=65280,this.grewupPanel.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.executeBtn.visible=!1,this.need.text="",this.cur.text="",this.costNum.visible=!1;else{if(void 0!=e&&0!=t.item.handle&&4==s&&1!=t.item.itemConfig.level){this.mixPanel.visible=!1,this.grewupPanel.visible=!0,this.curEquipConfigId=this.updateGrewupPanel(),this.executeBtn.label=c_grewup;var o=GlobalConfig.LegendLevelupConfig[this.curEquipConfigId];i=o.count,n=o.itemId}else{this.mixPanel.visible=!0,this.grewupPanel.visible=!1,this.curEquipConfigId=this.updateMixPanel(),this.executeBtn.label=c_mix;var a=GlobalConfig.LegendComposeConfig[this.curEquipConfigId];if(!a)return void platform.reportError("OrangeEquipPanel:"+this.curEquipConfigId+" ");i=a.count,n=a.itemId}var r=BagCT.ins().getBagGoodsCountById(0,n);this.need.text="/"+i,this.cur.text=r+"",r>=i?this.cur.textColor=ColorUtil.GREEN_COLOR_N:this.cur.textColor=ColorUtil.RED_COLOR_N,this.executeBtn.visible=!0,this.labelMax.visible=!1}}},e.prototype.updateMixPanel=function(){var t,e,i=Actor.level;if(i>=1){var n=this.curIndex,s=SubRoles.ins().getSubRoleByIndex(this._roleId);e=EquipCT.ins().getEquipConfigIDByPosAndQualityByGod(s,n,4,s.job),t=GlobalConfig.ItemConfig[e]}void 0!=t&&(t.zsLevel>0?this.mixPanel.level.text=t.zsLevel+"转":this.mixPanel.level.text=t.level?"Lv."+t.level:"Lv.1",this.mixPanel.equipName.text=t.name,this.mixPanel.itemIcon.imgJob.visible=!1,this.mixPanel.itemIcon.setData(t));var o=[],a=[],r=[],l=GlobalConfig.EquipConfig[e];for(var h in AttributeData.translate)!l[h]||l[h]<=0||(a.push(l[h]+""),o.push(AttributeData.getAttrStrByType(AttributeData.translate[h])),r.push(" +"+Math.floor(ItemBase.additionRange*l[h]/100)));return this.mixPanel.attributes.baseAttr.text=ItemData.getStringByNextList(a,r),this.mixPanel.attributes.randAttr.text="",this.mixPanel.attributes.nameAttr.text=ItemData.getStringByList(o),this.mixPanel.attributes.score.text=ItemUtil.pointCalNumber(t),e},e.prototype.updateGrewupPanel=function(){var t=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(this.curIndex),e=t.item.configID,i=GlobalConfig.ItemConfig[e],n=GlobalConfig.LegendLevelupConfig[t.item.configID]?GlobalConfig.ItemConfig[GlobalConfig.LegendLevelupConfig[t.item.configID].newEquipId]:null;if(void 0==n);else{this.grewupPanel.curName.text=i.name+"",this.grewupPanel.nextName.text=n.name+"",i.zsLevel>0?this.grewupPanel.curLevel.text=i.zsLevel+"转":this.grewupPanel.curLevel.text=i.level?"Lv."+i.level:BagCT.fitleEquip.indexOf(t.item.configID)>-1?"无级别":"Lv.1",n.zsLevel>0?this.grewupPanel.nextLevel.text=n.zsLevel+"转":this.grewupPanel.nextLevel.text=n.level?"Lv."+n.level:"Lv.1",this.grewupPanel.curItemIcon.imgJob.visible=!1,this.grewupPanel.nextItemIcon.imgJob.visible=!1,this.grewupPanel.curItemIcon.setData(i),this.grewupPanel.nextItemIcon.setData(n);for(var s=1;4>=s;s++)this.grewupPanel.attributes["arrow"+s].visible=!1;var o=[],a=[],r=[],l=[],h=[],u=GlobalConfig.EquipConfig[e],p=GlobalConfig.LegendLevelupConfig[t.item.configID]?GlobalConfig.EquipConfig[GlobalConfig.LegendLevelupConfig[t.item.configID].newEquipId]:null,c=t.item,d=1;for(var g in AttributeData.translate)if(u[g]&&!(u[g]<=0)){if(void 0!=c)for(var f=c.att,v=0;v<f.length;v++)if(f[v].type==AttributeData.translate[g]){r.push(" +"+f[v].value);break}this.grewupPanel.attributes["arrow"+d].visible=!0,d++,a.push(u[g]+""),l.push(p[g]+""),h.push(" +"+Math.floor(ItemBase.additionRange*p[g]/100)),o.push(AttributeData.getAttrStrByType(AttributeData.translate[g]))}this.grewupPanel.attributes.curBaseAttr.text=ItemData.getStringByNextList(a,r),this.grewupPanel.attributes.nextBaseAttr.text=ItemData.getStringByNextList(l,h),this.grewupPanel.attributes.nameAttr.text=ItemData.getStringByList(o),this.grewupPanel.attributes.curScore.text="评分："+ItemUtil.pointCalNumber(i),this.grewupPanel.attributes.nextScore.text="评分："+ItemUtil.pointCalNumber(n)}return e},e.prototype.updateAllEquipItem=function(){for(var t=0;8>t;t++)this.updateEquipItem(t)},e.prototype.updateEquipItem=function(t){var i=this["equip"+t];if(null!=i){var n=SubRoles.ins().getSubRoleByIndex(this._roleId).getEquipByIndex(t),s=i.itemIcon;s.imgJob.visible=!1,0==n.item.handle||ItemUtil.getQuality(n.item.itemConfig)<4||1==n.item.itemConfig.level&&!n.item.itemConfig.zsLevel?(s.setData(null),s.imgIcon.source=e.defaultEquipIcon[t],i.level.text="",i.mixBtn.visible=!1,this.cleanEffOnly(t)):(i.mixBtn.visible=!1,n.item.itemConfig.zsLevel>0?i.level.text=n.item.itemConfig.zsLevel+"转":i.level.text=n.item.itemConfig.level?"Lv."+n.item.itemConfig.level:BagCT.fitleEquip.indexOf(n.item.configID)>-1?"无级别":"Lv.1",s.setData(n.item.itemConfig),this.playEff(t)),i.select.visible=this.curIndex==t}},e.prototype.playEff=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]||(this["effArr"+e]=new MovieClip,this["effArr"+e].x+=this["equip"+e].width/2,this["effArr"+e].y+=this["equip"+e].height/2-15,this["equip"+e].addChild(this["effArr"+e]),this["equip"+e].addChild(this["equip"+e].level,this.getChildIndex(this["effArr"+t])+1),this["effArr"+e].playFile(RES_DIR_EFF+"ValueEff5",-1))}},e.prototype.cleanEffOnly=function(t){if(!(0>t||t>7)){var e=t;this["effArr"+e]&&(DisplayUtils.removeFromParent(this["effArr"+e]),this["effArr"+e]=null)}},e.prototype.cleanEff=function(){for(var t=0;8>t;t++)this["effArr"+t]&&(DisplayUtils.removeFromParent(this["effArr"+t]),this["effArr"+t]=null)},e.prototype.setItemRedPoint=function(){for(var t=0;8>t;t++){var e=this["equip"+t],i=SubRoles.ins().getSubRoleByIndex(this._roleId);
if(e.redPoint.visible=EquipCT.ins().setOrangeEquipItemState(t,i),e.redPoint.visible){var n=BagCT.ins().checkEqRedPoint(t,i,!0);e.redPoint.visible=null!=n?n:e.redPoint.visible}}},e.prototype.computerCurIndex=function(){return 0},e.prototype.setRoleId=function(t){this._roleId=t,this.updateView()},e.defaultEquipIcon=["xb_10","xb_11","xb_12","xb_13","xb_14","xb_15","xb_16","xb_17"],e}(BaseView);__reflect(OrangeEquipPanel.prototype,"OrangeEquipPanel"),window.OrangeEquipPanel=OrangeEquipPanel;var OrangeEquipSuitItemRander=function(t){function e(){var e=t.call(this)||this;return e.skinName="OrangeequipeffItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){var t=this.data[0],e=this.data[1].item,i=this.data[2];if(e&&e.itemConfig&&EquipCT.isReachSuitLv(e.itemConfig,t))this.eIcon.source=e.itemConfig.icon+"_png",this.eName.text=e.itemConfig.name+"（已激活）",this.eName.textColor=ColorUtil.GREEN;else{var n=[101001,111001,121001,131001,141001,151001,161001,171001];this.eIcon.source=n[i]+"_png",this.eName.text=Role.getEquipNameByType(i)+"（未激活）",this.eName.textColor=ColorUtil.GRAY_COLOR2}}},e}(BaseItemRender);__reflect(OrangeEquipSuitItemRander.prototype,"OrangeEquipSuitItemRander"),window.OrangeEquipSuitItemRander=OrangeEquipSuitItemRander;var OrangeEquipSuitWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="OrangeequipeffSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=OrangeEquipSuitItemRander,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.role=t[0],this.suitLv=t[1],this.update()},e.prototype.update=function(){this.suitLv.zsLv>0?this.eSuitLab.text=this.suitLv.zsLv+"转":this.eSuitLab.text=this.suitLv.lv+"级",this.eNumLab.text=this.suitLv.num+"/8";for(var t=[],e=0;8>e;e++){var i=this.role.getEquipByIndex(e);t.push([this.suitLv,i,e])}this.eList.dataProvider=new eui.ArrayCollection(t);var n,s=GlobalConfig.EquipStarSuit[this.suitLv.lv][this.suitLv.zsLv];for(var e in s)n=s[e];if(n){var o=this.suitLv.num>=n.count;this.Desc.text="神装基础属性 + "+n.precent/100+"% "+(o?"":"（未激活）"),this.Desc.textColor=o?10289337:11645079}else this.Desc.text=""},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(OrangeEquipSuitWin.prototype,"OrangeEquipSuitWin"),window.OrangeEquipSuitWin=OrangeEquipSuitWin,ViewManager.ins().reg(OrangeEquipSuitWin,LayerManager.UI_Popup);var RuneExchangeShopWin=function(t){function e(){var e=t.call(this)||this;return e.curSelectIndex=0,e.skinName="RuneExchangeShop",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.panelArr=[this.runeShop],this.viewStack.selectedIndex=0,this.tab.dataProvider=this.viewStack},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.tab,this.onTabTouch),this.runeShop.curRole=0,this.setSelectedIndex(0)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.panelArr[this.curSelectIndex].close()},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(t){case 0:this.runeShop.open()}},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.panelArr[t].open(),this.viewStack.selectedIndex=t},e}(BaseEuiView);__reflect(RuneExchangeShopWin.prototype,"RuneExchangeShopWin"),ViewManager.ins().reg(RuneExchangeShopWin,LayerManager.UI_Main),window.RuneExchangeShopWin=RuneExchangeShopWin;var TreasureChuanshiGiftWin=function(t){function e(){var e=t.call(this)||this;return e.lastSelected=-1,e.maxNum=0,e.skinName="TreasureChuanshiGift",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.id=t[1],this.num=t[2],this.addTouchEvent(this,this.onTouch),this.observe(BagCT.ins().postGiftResult,this.otherClose),this.addTouchEndEvent(this.minBtn0,this.onTap),this.addTouchEndEvent(this.maxBtn0,this.onTap),this.addTouchEndEvent(this.sub1Btn0,this.onTap),this.addTouchEndEvent(this.add1Btn0,this.onTap),this.addChangeEvent(this.numLabel0,this.onTxtChange),this.numLabel0.restrict="0-9",this.numLabel0.text="0",this.add.touchEnabled=!1,this.add.touchChildren=!1,this.update()},e.prototype.update=function(){var t=GlobalConfig.OptionalGiftConfig[this.id];if(this.gift.itemRenderer=TreasureChuanshiItemRender,t.show[0].reward.length<=4){var e=this.gift.layout;e.requestedColumnCount=t.show[0].reward.length}this.validateNow(),this.gift.dataProvider=new eui.ArrayCollection(t.show[0].reward),this.gift.validateNow(),this.choose.textFlow=TextFlowMaker.generateTextFlow1(t.show[0].str),this.maxNum=this.num,this.useNum=0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTouch),this.lastSelected=-1},e.prototype.onTouch=function(t){if(t.target==this.get){if(this.gift.selectedIndex<0)return void TipsCT.ins().showTips("请选择一个奖励");if(!this.useNum)return void TipsCT.ins().showTips("请选择开启的数量");var e=GlobalConfig.OptionalGiftConfig[this.id],i=e.options[this.gift.selectedIndex];if(Actor.level<i.level)return void TipsCT.ins().showTips("人物等级"+i.level+"才能领取");if(ZsCT.ins().lv<i.zslimit)return void TipsCT.ins().showTips("转生等级"+i.zslimit+"才能领取");BagCT.ins().getSurplusCount()<this.useNum?ViewManager.ins().open(BagFullTipsWin,this.useNum):BagCT.ins().sendChoosableGift(this.id,this.useNum,this.gift.selectedIndex)}else t.target.parent==this.gift?(this.lastSelected>=0&&this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex),this.lastSelected=this.gift.selectedIndex,this.gift.dataProvider&&this.lastSelected>-1&&this.lastSelected<this.gift.dataProvider.length&&this.gift.getChildAt(this.lastSelected).checkSelcted(this.gift.selectedIndex),this.add.touchChildren=!0,this.useNum=1,this.numLabel0.text=this.useNum+""):t.target==this.bgClose&&this.otherClose()},e.prototype.otherClose=function(){ViewManager.ins().close(this)},e.prototype.onTap=function(t){switch(t.target){case this.minBtn0:this.useNum=1;break;case this.maxBtn0:this.useNum=this.maxNum;break;case this.sub1Btn0:this.useNum--,this.useNum<=0&&(this.useNum=1);break;case this.add1Btn0:this.useNum++,this.useNum>this.maxNum&&(this.useNum=this.maxNum)}this.numLabel0.text=this.useNum+""},e.prototype.onTxtChange=function(t){var e=Number(this.numLabel0.text);e>this.maxNum?e=this.maxNum:0>=e&&(e=1),this.useNum=e,this.numLabel0.text=this.useNum+""},e}(BaseEuiView);__reflect(TreasureChuanshiGiftWin.prototype,"TreasureChuanshiGiftWin"),ViewManager.ins().reg(TreasureChuanshiGiftWin,LayerManager.UI_Popup),window.TreasureChuanshiGiftWin=TreasureChuanshiGiftWin;var TreasureChuanshiItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="TreasureChuanshiItem",e.touchChildren=!1,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.gift.data=this.data,this.select.visible=this.select2.visible=!1},e.prototype.checkSelcted=function(t){this.select.visible=this.select2.visible=this.itemIndex==t},e}(BaseItemRender);__reflect(TreasureChuanshiItemRender.prototype,"TreasureChuanshiItemRender"),window.TreasureChuanshiItemRender=TreasureChuanshiItemRender;var TreasureChuanshiPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.addBoxEvent=!1,e.huntType=0,e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=GlobalConfig.HeirloomTreasureConfig.boxes.length,e=0;t>e;e++){var i=this["gift"+e];i.data=GlobalConfig.HeirloomTreasureConfig.boxes[e]}this.eff=new MovieClip,this.eff.x=59,this.eff.y=23,this.eff.scaleX=.8,this.eff.scaleY=.8,this.eff.touchEnabled=!1,this.list.itemRenderer=HuntListRenderer,this.zb1.text=GlobalConfig.HeirloomTreasureConfig.huntOnce+"",this.zb10.text=GlobalConfig.HeirloomTreasureConfig.huntTenth+""},e.prototype.addDisplay=function(){this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.observe(Heirloom.ins().postHuntRecord,this.listRefush),this.observe(BagCT.ins().postItemAdd,this.setRedStatu),this.observe(Heirloom.ins().postHuntBoxInfo,this.updateBox),this.observe(Heirloom.ins().postHuntResult,this.updateMaterial),this.listRefush(),Heirloom.ins().sendHuntRecord(),this.updateBox(),this.addBoxEvent=!0,this.updateMaterial(),this.setRedStatu();var t=DateUtils.calcWeekFirstDay();this.endedTime=t.getTime()+egret.getTimer(),this.timeClock(),Timer.stop(this.timeClock,this),Timer.start(1e3,0,this.timeClock,this)},e.prototype.removeDisplay=function(){DisplayUtils.removeFromParent(this.eff),Timer.stop(this.timeClock,this),this.addBoxEvent=!1},e.prototype.timeClock=function(){if(this.endedTime-egret.getTimer()<=0){var t=DateUtils.calcWeekFirstDay();this.endedTime=t.getTime()+egret.getTimer()}this.leftTimeTxt.text=DateUtils.getFormatBySecond((this.endedTime-egret.getTimer())/1e3>>0,DateUtils.TIME_FORMAT_5,4)},e.prototype.listRefush=function(){this.list.dataProvider=new eui.ArrayCollection(Heirloom.ins().huntRecords)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Heirloom)}},e.prototype.buyHunt=function(t){if(0==t&&Heirloom.ins().huntFreeTimes>0)return void Heirloom.ins().sendHunt(t);this.huntType=t;var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem);if(e&&e.count)Heirloom.ins().sendHunt(t);else{var i=0==t?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureChuanshiPanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.HeirloomTreasureConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.HeirloomTreasureConfig.huntOnce:GlobalConfig.HeirloomTreasureConfig.huntTenth;Actor.yb>=t?Heirloom.ins().sendHunt(this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.setRedStatu=function(){var t=Boolean(BagCT.ins().getHuntGoods(2).length);t?(this.outBag.parent.addChildAt(this.eff,this.getChildIndex(this.outBag)),this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.eff),this.redPoint2.visible=t,this.buy1.eRp.visible=Hunt.ins().checkChuanshiRed(1),this.buy10.eRp.visible=Hunt.ins().checkChuanshiRed(10)},e.prototype.updateBox=function(){var t,e,i=Heirloom.ins().huntBoxInfo.length,n=0;for(var s in GlobalConfig.HeirloomTreasureRewardConfig)e=GlobalConfig.HeirloomTreasureRewardConfig[s],this["time"+n].text=e.needTime+"次",this["time"+n].visible=!0,this["done"+n].visible=!1,this["boxPoint"+n].visible=!1,this["bar"+n].value=0,this["box"+n].source="200116_0_png",this["box"+n].name="box"+(n+1),this.addBoxEvent||this.addTouchEvent(this["box"+n],this.onGetAward),i>n&&(t=Heirloom.ins().huntBoxInfo[n],t==Heirloom.CANGET?(this["box"+n].source="200116_png",this["bar"+n].value=100,this["boxPoint"+n].visible=!0):t==Heirloom.ISNGET&&(this["time"+n].visible=!1,this["done"+n].visible=!0,this["bar"+n].value=100)),n++;this.hopeValue0.text=Heirloom.ins().huntHope+"",this.times.text=Heirloom.ins().huntTimes+"",this.maskImage(),this.redPoint3.visible=Heirloom.ins().huntFreeTimes>0,this.buy1.label=Heirloom.ins().huntFreeTimes>0?"免费寻宝":"寻宝一次"},e.prototype.maskImage=function(){var t=Heirloom.ins().huntHope,e=GlobalConfig.HeirloomTreasureConfig.maxBlissVal,i=Math.floor(.01*Math.pow(t,.74)*e)/e;return i=1>i?i:1,i>=1?(this.maxHopeValue0.mask&&(this.maxHopeValue0.mask=null),void(this.maskShape&&(this.maskShape.graphics.clear(),this.maskShape=null))):(this.maxHopeValue0.mask||(this.maskShape=new egret.Shape,this.maskShape.graphics.beginFill(16776960),this.maskShape.graphics.drawRect(this.maxHopeValue0.x,this.maxHopeValue0.y,this.maxHopeValue0.width,this.maxHopeValue0.height),this.maxHopeValue0.parent.addChild(this.maskShape),this.maxHopeValue0.mask=this.maskShape),void(this.maskShape.y=this.maxHopeValue0.height*(1-i)))},e.prototype.onGetAward=function(t){var e=t.target.name.slice(3,4),i=Heirloom.ins().huntBoxInfo[e-1];i==Heirloom.CANGET?Heirloom.ins().sendHuntAward(e):ViewManager.ins().open(HuntBoxsTips,e,2)},e.prototype.updateMaterial=function(){var t=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.HeirloomTreasureConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|"),this.num10.textFlow=TextFlowMaker.generateTextFlow("|C:"+(e>=10?ColorUtil.GREEN_COLOR_N:ColorUtil.RED_COLOR_N)+"&T:"+e+"|")},e}(BaseView);__reflect(TreasureChuanshiPanel.prototype,"TreasureChuanshiPanel"),window.TreasureChuanshiPanel=TreasureChuanshiPanel;var TreasureHuntPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.huntType=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.updateDescEx();var t;Activity.ins().IsHefuXunBaoTimer()?(this.bdsz.visible=!1,t=GlobalConfig.TreasureHuntPoolHefuConfig[GameServer._hefuCount]):t=GameServer._hefuCount>0?GlobalConfig.TreasureHuntPoolHefuForeverConfig:GlobalConfig.TreasureHuntPoolConfig,this.id1=t[1].reward[0].id,this.id2=t[2].reward[0].id,this.list1.itemRenderer=ItemBase,this.list2.itemRenderer=ItemBase,this.list1.dataProvider=new eui.ArrayCollection(t[3].reward),this.list2.dataProvider=new eui.ArrayCollection(t[4].reward),this.mc1=new MovieClip,this.mc1.x=this.icon1.x+36,this.mc1.y=this.icon1.y+38,this.mc1.scaleX=this.mc1.scaleY=1.4,this.chuanqi.addChild(this.mc1),this.mc2=new MovieClip,this.mc2.x=this.icon2.x+36,this.mc2.y=this.icon2.y+38,this.mc2.scaleX=this.mc2.scaleY=1.4,this.chuanqi.addChild(this.mc2),this.list.itemRenderer=HuntListRenderer,this.listRefush([]),this.longZhuEff=new MovieClip,this.longZhuEff.x=63,this.longZhuEff.y=27,this.longZhuEff.touchEnabled=!1,this.eff=new MovieClip,this.eff.x=59,this.eff.y=23,this.eff.scaleX=.8,this.eff.scaleY=.8,this.eff.touchEnabled=!1},e.prototype.addDisplay=function(){this.longZhuEff.playFile(RES_DIR_EFF+"Supremacy",-1),this.titleMcGroup.addChild(this.longZhuEff),this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.addTouchEvent(this.icon1,this.onClick),this.addTouchEvent(this.icon2,this.onClick),this.observe(Hunt.ins().postBestListInfo,this.listRefush),this.observe(BagCT.ins().postItemAdd,this.setRedStatu),this.observe(Hunt.ins().postHuntResult,this.callHuntResult),this.mc1.playFile(RES_DIR_EFF+"LegenEqui",-1),this.mc2.playFile(RES_DIR_EFF+"LegenEqui",-1),this.listRefush([]),Hunt.ins().sendHuntList(),this.setRedStatu()},e.prototype.setRedStatu=function(){var t=Boolean(BagCT.ins().getHuntGoods(0).length);t?(this.outBag.parent.addChildAt(this.eff,this.getChildIndex(this.outBag)),this.eff.playFile(RES_DIR_EFF+"BtnPrompt1",-1)):DisplayUtils.removeFromParent(this.eff),this.redPoint2.visible=t,this.buy1.eRp.visible=Hunt.ins().checkHuntRed(1),this.buy10.eRp.visible=Hunt.ins().checkHuntRed(10)},e.prototype.listRefush=function(t){this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Equip)}},e.prototype.buyHunt=function(t){this.huntType=t;var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem);if(e&&e.count)Hunt.ins().sendHunt(t);else{var i=0==t?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureHuntPanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.TreasureHuntConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.TreasureHuntConfig.huntOnce:GlobalConfig.TreasureHuntConfig.huntTenth;Actor.yb>=t?Hunt.ins().sendHunt(this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.onClick=function(t){switch(t.target){case this.icon1:ViewManager.ins().open(LegendTipsWin,this.id1);break;case this.icon2:ViewManager.ins().open(LegendTipsWin,this.id2)}},e.prototype.callHuntResult=function(){this.updateDescEx()},e.prototype.updateDescEx=function(){var t=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.TreasureHuntConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.zb1.text=GlobalConfig.TreasureHuntConfig.huntOnce+"",this.zb10.text=GlobalConfig.TreasureHuntConfig.huntTenth+""},e}(BaseView);__reflect(TreasureHuntPanel.prototype,"TreasureHuntPanel"),window.TreasureHuntPanel=TreasureHuntPanel;var TreasureHuntWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSelectIndex=0,e._sn_="TreasureHuntSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.viewStack.selectedIndex=0,this.checkHeirloomOpen(),this.checkBeastOpen(),this.tab.dataProvider=this.viewStack,this.tab.validateNow(),this.addTouchEvent(this.closeBtn,this.onClick),this.addTouchEvent(this.help,this.onClick),this.addChangeEvent(this.tab,this.onTabTouch),this.addChangingEvent(this.tab,this.checkIsOpen)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]?t[0]:0;this.observe(BagCT.ins().postItemChange,this.setRedPoint),this.observe(BagCT.ins().postItemAdd,this.setRedPoint),this.observe(BagCT.ins().postItemDel,this.setRedPoint),this.observe(GameLogic.ins().postSubRoleChange,this.setRedPoint),this.observe(Rune.ins().postRuneBoxGift,this.setRedPoint),this.observe(BeastRedPoint.ins().postTreasureRedPoint,this.setRedPoint),this.observe(GameServer.ins().postServerOpenDay,this.checkHeirloomOpen),this.observe(ZsCT.ins().postZsLv,this.checkHeirloomOpen),this.setSelectedIndex(i),this.setRedPoint()},e.prototype.onClick=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.help:var e=void 0;0==this.tab.selectedIndex?e=39:1==this.tab.selectedIndex?e=13:2==this.tab.selectedIndex?e=40:3==this.tab.selectedIndex&&(e=60),e&&ViewManager.ins().open(ZsBossRuleSpeak,e)}},e.prototype.checkIsOpen=function(t){var e=t.target,i=GlobalConfig.FuwenTreasureConfig.openlevel;return 1==e.selectedIndex&&Actor.level<i?(TipsCT.ins().showTips(i+"级开启"),t.$cancelable=!0,void t.preventDefault()):void 0},e.prototype.onTabTouch=function(t){var e=t.currentTarget.selectedIndex;this.setSelectedIndex(e),this.setRedPoint(),ViewManager.ins().close(LimitTaskView)},e.prototype.setSelectedIndex=function(t){this.curSelectIndex=t,this.viewStack.selectedIndex=t},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(LocationProperty.isIosTS)return!1;if(t[0])if(2==t[0]){if(!Heirloom.ins().isHeirloomHuntOpen())return TipsCT.ins().showTips("开服第"+(GlobalConfig.HeirloomTreasureConfig.openDay+1)+"天达到"+GlobalConfig.HeirloomTreasureConfig.openZSlevel+"转后方可参与"),!1}else if(1==t[0]&&Actor.level<GlobalConfig.FuwenTreasureConfig.openlevel)return TipsCT.ins().showTips(GlobalConfig.FuwenTreasureConfig.openlevel+"级开启"),!1;return OpenSystem.ins().checkSysOpen(SystemType.TREASURE)?(ViewManager.ins().close(LiLianWin),!0):(TipsCT.ins().showTips(OpenSystem.ins().getNoOpenTips(SystemType.TREASURE)),!1)},e.prototype.setRedPoint=function(){for(var t=0;t<this.viewStack.numElements;t++){var e=!1;switch(this.viewStack.getElementAt(t)){case this.treasureHuntPanel:e=Boolean(BagCT.ins().getHuntGoods(0).length)||Hunt.ins().checkHuntRed(1)||Hunt.ins().checkHuntRed(10);break;case this.treasureRune:e=Boolean(BagCT.ins().getHuntGoods(1).length)||Rune.ins().getIsGetBox()||RuneRedPointMgr.ins().checkCanExchange()||Hunt.ins().checkRuneRed(1)||Hunt.ins().checkRuneRed(10);break;case this.treasureChuanshi:e=Hunt.ins().checkChuanshiRed(1)||Hunt.ins().checkChuanshiRed(10)||Boolean(Heirloom.ins().isHeirloomHuntOpen()&&(BagCT.ins().getHuntGoods(2).length||Heirloom.ins().getIsGetBox()));break;case this.treasureBeast:e=BeastRedPoint.ins().treasureRedPoint}this.tab.getElementAt(t).eRp.visible=e}},e.prototype.checkHeirloomOpen=function(){Heirloom.ins().isHeirloomHuntOpen()?this.treasureChuanshi.parent||this.viewStack.addChildAt(this.treasureChuanshi,2):this.treasureChuanshi.parent&&DisplayUtils.removeFromParent(this.treasureChuanshi)},e.prototype.checkBeastOpen=function(){BeastCT.ins().checkTreasureOpen()?this.treasureBeast.parent||this.viewStack.addChildAt(this.treasureBeast,3):this.treasureBeast.parent&&DisplayUtils.removeFromParent(this.treasureBeast)},e}(BaseEuiView);__reflect(TreasureHuntWin.prototype,"TreasureHuntWin"),ViewManager.ins().reg(TreasureHuntWin,LayerManager.UI_Main),window.TreasureHuntWin=TreasureHuntWin;var TreasureRunePanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.huntType=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.updateDescEx();var t=GlobalConfig.FuwenTreasureLevelConfig,e=SkyLevelModel.ins().cruLevel,i=null;for(var n in t){var s=t[n];if(e>=s.level&&e<=s.levelend){i=s;break}}this.list1.itemRenderer=ItemBase,this.list1.dataProvider=new eui.ArrayCollection(i.showicon),this.list.itemRenderer=HuntListRenderer,this.listRefush([])},e.prototype.addDisplay=function(){this.addTouchEvent(this.buy1,this.onBuy),this.addTouchEvent(this.buy10,this.onBuy),this.addTouchEvent(this.outBag,this.onBuy),this.addTouchEvent(this.outBag0,this.onBuy),this.observe(Rune.ins().postHuntRuneInfo,this.callRuneResult),this.observe(Rune.ins().postBestListInfo,this.listRefush);for(var t=0;t<Rune.BoxSum;t++)this.addTouchEvent(this["box"+t],this.onTab);this.observe(BagCT.ins().postHuntStore,this.setRedStatu),this.observe(BagCT.ins().postItemAdd,this.setRedStatu),this.observe(Rune.ins().postRuneBoxGift,this.callback),this.observe(GameLogic.ins().postRuneExchange,this.setRedStatu),Rune.ins().sendRuneList(),this.setRedStatu(),this.setBoxData();for(var t=0;t<this.list1.numElements;t++){var e=this.list1.getElementAt(t);e&&(e.clearEffect(),e.HideImgBg())}var i=DateUtils.calcWeekFirstDay();this.endedTime=i.getTime()/1e3,Timer.stop(this.timeClock,this),Timer.start(1e3,0,this.timeClock,this)},e.prototype.removeDisplay=function(){Timer.stop(this.timeClock,this)},e.prototype.timeClock=function(){if(this.endedTime-=1,this.endedTime<=0){var t=DateUtils.calcWeekFirstDay();this.endedTime=t.getTime()/1e3}this.leftTime.text="累计重置剩余时间："+DateUtils.getFormatBySecond(this.endedTime,DateUtils.TIME_FORMAT_5,4)},e.prototype.setRedStatu=function(){this.redPoint2.visible=!!BagCT.ins().getHuntGoods(1).length,this.redPoint0.visible=RuneRedPointMgr.ins().checkCanExchange(),this.buy1.eRp.visible=Hunt.ins().checkRuneRed(1),this.buy10.eRp.visible=Hunt.ins().checkRuneRed(10)},e.prototype.onBuy=function(t){switch(t.target){case this.buy1:this.buyHunt(0);break;case this.buy10:this.buyHunt(1);break;case this.outBag:ViewManager.ins().open(TreasureStorePanel,DepotType.Rune);break;case this.outBag0:ViewManager.ins().open(RuneExchangeShopWin)}},e.prototype.onTab=function(t){for(var e=0;e<Rune.BoxSum;e++)if(t.target==this["box"+e]){if(Rune.ins().boxs[e]==Rune.UNGET){ViewManager.ins().open(HuntBoxsTips,e+1);break}if(Rune.ins().boxs[e]==Rune.ISNGET){ViewManager.ins().open(HuntBoxsTips,e+1);break}this.boxId=e+1,Rune.ins().sendRuneBoxGift(e+1);break}},e.prototype.buyHunt=function(t){this.huntType=t;var e=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem);if(e&&e.count)Rune.ins().sendHuntRune(t);else{var i=0==t?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;HuntWarnBuyWin.showBuyWarn("TreasureRunePanel-HuntResultWin"+t,this.huntWarnFun.bind(this),"是否消耗"+i+"元宝购买"+GlobalConfig.ItemConfig[GlobalConfig.FuwenTreasureConfig.huntItem].name+"*"+(t?10:1))}},e.prototype.huntWarnFun=function(){var t=0==this.huntType?GlobalConfig.FuwenTreasureConfig.huntOnce:GlobalConfig.FuwenTreasureConfig.huntTenth;Actor.yb>=t?Rune.ins().sendHuntRune(this.huntType):TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|")},e.prototype.callback=function(){if(this.boxId){var t=GlobalConfig.FuwenTreasureRewardConfig[this.boxId];if(t)for(var e=0;e<t.reward.length;e++)TipsCT.ins().showTips("|C:0xff00ff&T:获得图腾碎片X"+t.reward[e].count);this.boxId=0}this.setBoxData()},e.prototype.setBoxData=function(){this.times.text=Rune.ins().runeCount+"";for(var t=0;t<Rune.BoxSum;t++){var e=GlobalConfig.FuwenTreasureRewardConfig[t+1],i=e.needTime?e.needTime:0;switch(Rune.ins().boxs[t]){case Rune.UNGET:this["time"+t].text=i+"次",this["time"+t].visible=!0,this["done"+t].visible=!this["time"+t].visible,this["box"+t].source="ttxunbao_box2",this["boxPoint"+t].visible=!1;break;case Rune.CANGET:this["time"+t].text=i+"次",this["time"+t].visible=!1,this["done"+t].visible=!this["time"+t].visible,this["done"+t].text="可领取",this["box"+t].source="ttxunbao_box1",this["boxPoint"+t].visible=!0;break;case Rune.ISNGET:this["time"+t].text=i+"次",this["time"+t].visible=!1,this["done"+t].visible=!this["time"+t].visible,this["done"+t].text="已领取",this["box"+t].source="ttxunbao_box2",this["boxPoint"+t].visible=!1}}},e.prototype.callRuneResult=function(){this.updateDescEx()},e.prototype.updateDescEx=function(){var t=BagCT.ins().getBagGoodsByTypeAndId(BagCT.BAG_TYPE_OTHTER,GlobalConfig.FuwenTreasureConfig.huntItem),e=t?t.count:0;this.num1.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.num10.textFlow=TextFlowMaker.generateTextFlow("<font color="+(e>=10?ColorUtil.GREEN_COLOR:ColorUtil.RED_COLOR)+">"+e+"</font> "),this.zw1.text=GlobalConfig.FuwenTreasureConfig.huntOnce+"",this.zw10.text=GlobalConfig.FuwenTreasureConfig.huntTenth+"",this.hopeValue.text=Rune.ins().hope+"",this.maskImage()},e.prototype.maskImage=function(){var t=Rune.ins().hope,e=GlobalConfig.FuwenTreasureConfig.maxBlissVal,i=Math.floor(.0096*Math.pow(t,.6719)*e)/e;if(i=1>i?i:1,i>=1)return DisplayUtils.removeFromParent(this.masksp),void(this.masksp=null);var n=118;if(!this.masksp){this.masksp=new egret.Sprite;var s=new egret.Shape;s.graphics.beginFill(16776960),s.graphics.drawRect(this.maxHopeValue.x,this.maxHopeValue.y,128,n),s.graphics.endFill(),this.masksp.addChild(s),this.maxHopeValue.parent.addChild(this.masksp),this.maxHopeValue.mask=this.masksp}this.masksp.y=n*(1-i)},e.prototype.listRefush=function(t){this.list.dataProvider=new eui.ArrayCollection(t)},e}(BaseView);__reflect(TreasureRunePanel.prototype,"TreasureRunePanel"),window.TreasureRunePanel=TreasureRunePanel;var ItemBaseStore=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onClick=function(){var t=this.data.handle;BagCT.ins().sendGetGoodsByStore(t)},e}(ItemBase);__reflect(ItemBaseStore.prototype,"ItemBaseStore"),window.ItemBaseStore=ItemBaseStore;var TreasureStorePanel=function(t){function e(){var e=t.call(this)||this;return e.isTopLevel=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){this.init()},e.prototype.init=function(){this.skinName="TreasureStore",this.list.itemRenderer=ItemBaseStore,this.listScroller.viewport=this.list},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.type=t[0],this.addTouchEvent(this.get,this.getGoods),this.observe(BagCT.ins().postHuntStore,this.updateData),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.updateData=function(){var t=BagCT.ins().getHuntGoodsBySort(this.type);this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.getGoods=function(t){this.list.dataProvider.length>0&&BagCT.ins().sendGetGoodsByStore(this.type)},e}(BaseEuiView);__reflect(TreasureStorePanel.prototype,"TreasureStorePanel"),ViewManager.ins().reg(TreasureStorePanel,LayerManager.UI_Main),window.TreasureStorePanel=TreasureStorePanel;var BossRemindWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="TxmyBossRemindSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0==GameMap.fubenID},e.prototype.skinComplete=function(){this.eTips.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eTips.text+"</u>")},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onClick);var i=t[0];this.eTitle.text=i.title,this.eHead.source=i.head,this.eName.text=i.name,this.btnFun=i.btnFun,this.tipsFun=i.tipsFun,this.winParam=i.winParam},e.prototype.onClick=function(t){switch(t.target){case this.eBtn:this.btnFun&&this.btnFun(this.winParam);break;case this.eTips:this.tipsFun&&this.tipsFun();break;case this.eClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(BossRemindWin.prototype,"BossRemindWin"),window.BossRemindWin=BossRemindWin;var BossRemindInfo=function(){function t(){}return t}();__reflect(BossRemindInfo.prototype,"BossRemindInfo"),window.BossRemindInfo=BossRemindInfo,ViewManager.ins().reg(BossRemindWin,LayerManager.UI_Main);var TxmyBossItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TxmyBossItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data,e=GlobalConfig.MonstersConfig[t.bossId];if(this.eNameLab.text=e.name+" "+t.levelLimit[0]/1e3+"转",this.eLab.textColor=ColorUtil.RED,PowerEquipCT.ins().powerEquipLevel<t.masterLevelLimit)this.eLab.text="主宰"+StringUtils.NumberToChinese(t.masterLevelLimit)+"级开启",this.eGroup.filters=FilterUtil.ARRAY_GRAY_FILTER;else if(ZsCT.ins().lv<t.levelLimit[0]/1e3)this.eLab.text=t.levelLimit[0]/1e3+"转可挑战",this.eGroup.filters=FilterUtil.ARRAY_GRAY_FILTER;else{this.eGroup.filters=[];var i=KFBossSys.ins().fbInfo[t.id];if(!i)return;var n=(i.bossRefTimer-egret.getTimer())/1e3>>0;n>0?this.eLab.text=DateUtils.getFormatBySecond(n):(this.eLab.textColor=16776960,this.eLab.text="生命"+i.hpPercent+"%")}this.eIcon.visible=!0,t.specialShow>0?this.eIcon.source=t.specialShow+"_png":this.eIcon.visible=!1}},e}(BaseItemRender);__reflect(TxmyBossItem.prototype,"TxmyBossItem"),window.TxmyBossItem=TxmyBossItem;var TxmyBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curLayer=0,e.curListSelect=0,e._sn_="TxmyBossPanelSkin",e.times=0,e}return __extends(e,t),e.prototype.setLayer=function(t){if(t>=0){if(this.curLayer=t,!this.skin)return;this.eTab.selectedIndex=t,this.updateList()}},e.prototype.skinComplete=function(){this.initTab(),this.listDP=new eui.ArrayCollection,this.eList.itemRenderer=TxmyBossItem,this.eList.dataProvider=this.listDP,this.addTouchEvent(this,this.onClick),this.addChangeEvent(this.eTab,this.updateList),this.addChangeEvent(this.eList,this.updateUI),this.rewardList.itemRenderer=ItemBase,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossGroup.addChild(this.bossImage),this.eTips.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eTips.text+"</u>"),this.eBuy.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.eBuy.text+"</u>"),KFBossSys.ins().sendBossInfo()},e.prototype.addDisplay=function(){this.observe(KFBossSys.ins().postInfo,this.updateNum),this.observe(KFBossSys.ins().postHelpNum,this.updateHelpNum),this.observe(KFBossSys.ins().postCanHelpNum,this.updateHelpNum),this.addChangingEvent(this.eTab,this.checkIsOpen),this.updateList(),Timer.start(1e3,0,this.timerCB,this)},e.prototype.removeDisplay=function(){Timer.stop(this.timerCB,this)},e.prototype.checkIsOpen=function(t){var e=t.target.selectedItem;
if(e instanceof Array){var i=e[1]||0;if(PowerEquipCT.ins().powerEquipLevel<i)return t.preventDefault(),void TipsCT.ins().showTips("主宰等级不足")}},e.prototype.timerCB=function(){this.times++,this.times>=5&&(this.times=0,KFBossSys.ins().sendBossInfo()),this.listDP.refresh(),this.eList.selectedIndex=this.curListSelect},e.prototype.onClick=function(t){switch(t.target){case this.challengeBtn:this.challengeClick();break;case this.eBuy:WarnWin.show("确定花费|C:16767295&T:"+GlobalConfig.CrossBossBase.txmybuyCost[KFBossSys.ins().getHasBuyBelongNum(KFBossType.TXMY)]+"元宝|购买1次主宰BOSS归属次数吗？\n今天可购买："+(GlobalConfig.CrossBossBase.txmybuyCount-KFBossSys.ins().getHasBuyBelongNum(KFBossType.TXMY))+"/"+GlobalConfig.CrossBossBase.txmybuyCount,function(){GlobalFun.checkMoney(GlobalConfig.CrossBossBase.txmybuyCost[KFBossSys.ins().getHasBuyBelongNum(KFBossType.TXMY)])&&(KFBossSys.ins().getHasBuyBelongNum(KFBossType.TXMY)<GlobalConfig.CrossBossBase.txmybuyCount?KFBossSys.ins().sendBugBelongNum(KFBossType.TXMY):TipsCT.ins().showTips("今日可购买次数不足"))},this);break;case this.eTips:ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_TXMY)}},e.prototype.challengeClick=function(){if(KfArenaSys.ins().checkIsMatching()){var t=this.eList.selectedItem;if(t){if(PowerEquipCT.ins().powerEquipLevel<t.masterLevelLimit)return void TipsCT.ins().showTips("主宰"+t.masterLevelLimit+"级开启");if(ZsCT.ins().lv<t.levelLimit[0]/1e3)return void TipsCT.ins().showTips("转生等级不足");if(KFBossSys.ins().fbInfo[t.id]&&KFBossSys.ins().fbInfo[t.id].bossRefTimer-egret.getTimer()>0)return void TipsCT.ins().showTips("BOSS未复活");var e=(KFBossSys.ins().enterCD-egret.getTimer())/1e3>>0;return e>0?void TipsCT.ins().showTips("|C:0xf3311e&T:"+e+"秒后可以进入！"):ZsCT.ins().lv<t.levelLimit[0]/1e3||ZsCT.ins().lv>t.levelLimit[1]/1e3?void TipsCT.ins().showTips("|C:0xf3311e&T:需要转生等级到达"+(t.levelLimit[0]/1e3>>0)+"转！"):void(KFBossSys.ins().txmyNum>0?RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,KFBossSys.ins().txmyNum,function(){KFBossSys.ins().sendEnter(t.id),KFBossSys.ins().kfBossCfgID=t.id}):(KFBossSys.ins().sendEnter(t.id),KFBossSys.ins().kfBossCfgID=t.id))}}},e.prototype.updateUI=function(){var t=this.eList.selectedItem;if(this.curListSelect=this.eList.selectedIndex,t){var e=GlobalConfig.MonstersConfig[t.bossId];this.nameTxt.text=""+e.name,this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1);var i=KFBossSys.ins().getBossShowAward(t.belongRewardshow);this.rewardList.dataProvider=new eui.ArrayCollection(i),this.updateNum(),this.updateHelpNum()}},e.prototype.updateNum=function(){this.eNumLab.text=KFBossSys.ins().txmyNum+""},e.prototype.updateHelpNum=function(){this.helpTimes.text=KFBossSys.ins().helpNum[KFBossType.TXMY-1]+"次"},e.prototype.updateList=function(){var t=[],e=this.eTab.selectedItem?this.eTab.selectedItem[0]:0,i=GlobalConfig.CrossBossBase.txmyLayers,n=i[e],s=i[e+1];for(var o in GlobalConfig.CrossBossConfig){var a=GlobalConfig.CrossBossConfig[o];a.type==KFBossType.TXMY&&a.id>=n&&(!s||a.id<s)&&t.push(a)}this.listDP.source=t,this.listDP.refresh(),this.eList.selectedIndex=this.curListSelect,this.updateUI()},e.prototype.initTab=function(){this.updateTab(),this.eTab.selectedIndex=this.curLayer},e.prototype.updateTab=function(){for(var t=[],e=GlobalConfig.CrossBossBase.txmyLayers,i=(PowerEquipCT.ins().powerEquipLevel,0);i<e.length;i++)t.push([i,GlobalConfig.CrossBossConfig[e[i]].masterLevelLimit]);this.eTab.itemRenderer=TxmyTabItem,this.eTab.dataProvider=new eui.ArrayCollection(t)},__decorate([callLater],e.prototype,"updateList",null),e}(BaseView);__reflect(TxmyBossPanel.prototype,"TxmyBossPanel"),window.TxmyBossPanel=TxmyBossPanel;var TxmyBossWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="TxmyBossSkin",e.isTopLevel=!0,e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return KFBossSys.ins().txmyIsOpen(!0)},e.prototype.skinComplete=function(){this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t&&this.txmyBossPanel.setLayer(t[0])},e.prototype.onClick=function(t){switch(t.target){case this.seeRule:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[50].text)}},e}(BaseEuiView);__reflect(TxmyBossWin.prototype,"TxmyBossWin"),window.TxmyBossWin=TxmyBossWin,ViewManager.ins().reg(TxmyBossWin,LayerManager.UI_Main);var TxmyTabItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="TxmyBossLayerSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data&&this.data instanceof Array){this.bg.source="txmy"+(this.data[0]+1)+"_png";var t=PowerEquipCT.ins().powerEquipLevel;this.nameTxt0.text=t<this.data[1]?"主宰"+StringUtils.NumberToChinese(this.data[1])+"级开启":""}},e}(BaseItemRender);__reflect(TxmyTabItem.prototype,"TxmyTabItem"),window.TxmyTabItem=TxmyTabItem;var TxShiPinWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="TXshipingSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.addTouchEvent(this.shoucang,function(){return window.location.href="https://iwan.qq.com/fun/mindex?ADTAG=txsp.wd.xyx&hidetitlebar=1&autoplay=1"}),this.addTouchEvent(this.BG,function(){return ViewManager.ins().close(t)})},e}(BaseEuiView);__reflect(TxShiPinWin.prototype,"TxShiPinWin"),ViewManager.ins().reg(TxShiPinWin,LayerManager.UI_Main),window.TxShiPinWin=TxShiPinWin;var WarnCT=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.setWarnLabel=function(t,e,i,n,s,o,a){void 0===n&&(n="normal"),void 0===s&&(s="left"),void 0===o&&(o=!1);var r=ViewManager.ins().open(WarnWin,o);return r.setWarnLabel(t,e,i,n,s,a),r},e.prototype.setBuyGoodsWarn=function(t,e){void 0===e&&(e=1);var i=ViewManager.ins().open(ShopGoodsWarn);return i.setData(t,e),i},e}(BaseSystem);__reflect(WarnCT.prototype,"WarnCT"),System.WarnCT=function(){return WarnCT.ins()},window.WarnCT=WarnCT;var BagAddItemWarn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="OpenCellSkin",this.price.setType(MoneyConst.yuanbao)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.decBtn,this.onTap),this.addTouchEvent(this.addBtn,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.cancelBtn,this.onTap),this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.setCount(5)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.decBtn:this.setCount(Number(this.count.text)-5);break;case this.addBtn:this.setCount(Number(this.count.text)+5);break;case this.sureBtn:if(!(Actor.yb>=this.price.getPrice())){TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this);break}BagCT.ins().sendAddBagGrid(Number(this.count.text)/5);case this.cancelBtn:case this.closeBtn:ViewManager.ins().close(e);break;case this.bgClose:ViewManager.ins().close(e)}},e.prototype.setCount=function(t){var e=GlobalConfig.BagBaseConfig,i=GlobalConfig.BagExpandConfig,n=CommonUtils.getObjectLength(i),s=(Actor.bagNum-e.baseSize)/e.rowSize,o=(n-s)*e.rowSize;5>t?(t=5,TipsCT.ins().showTips("|C:0xf3311e&T:已经是最小扩张数|")):t>o&&(t=o,TipsCT.ins().showTips("|C:0xf3311e&T:已经是最大扩张数|")),this.count.text=""+t;for(var a=0,r=t/e.rowSize,l=1;r>=l;l++)a+=i[s+l].cost;this.price.setPrice(a)},e}(BaseEuiView);__reflect(BagAddItemWarn.prototype,"BagAddItemWarn"),ViewManager.ins().reg(BagAddItemWarn,LayerManager.UI_Popup),window.BagAddItemWarn=BagAddItemWarn;var BagFullTipsWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="FullBagSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.sureBtn,this.onTap);var i=20;t[0]&&(i=t[0]),this.numText.text=""+i},e.prototype.close=function(){this.removeTouchEvent(this.closeBtn,this.onTap),this.removeTouchEvent(this.sureBtn,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.sureBtn:ViewManager.ins().close(this),ViewManager.ins().open(SmeltEquipTotalWin)}},e}(BaseEuiView);__reflect(BagFullTipsWin.prototype,"BagFullTipsWin"),window.BagFullTipsWin=BagFullTipsWin,ViewManager.ins().reg(BagFullTipsWin,LayerManager.UI_Popup);var GainGoodsItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="GainGoodsItemSkin",e.graycolor=7239022,e}return __extends(e,t),e.prototype.dataChanged=function(){this.greencolor=this.desc.textColor,this.norcolor=this.desc2.textColor,this.desc.text=this.data[0]},e.prototype.gainData=function(t,e,i){if(this.stars.visible=!0,t)for(var n=1;5>=n;n++)this["star"+n].visible=e>=n;else{if(this.desc.textColor=this.graycolor,this.desc2.textColor=this.graycolor,i){var s="";i.needZs&&(s+=i.needZs+"转生开启"),i.needLv&&(s+=i.needLv+"级开启"),i.guanka&&(s+=i.guanka+"关卡开启"),this.desc2.text=s}this.dir.visible=!1;for(var n=1;5>=n;n++)this["star"+n].visible=!1}},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsItem.prototype,"GainGoodsItem"),window.GainGoodsItem=GainGoodsItem;var GainGoodsItem1=function(t){function e(){var e=t.call(this)||this;return e.skinName="GainGoodsItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.desc.text=t.str},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsItem1.prototype,"GainGoodsItem1"),window.GainGoodsItem1=GainGoodsItem1;var GainGoodsNoSkinItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.dataChanged=function(){this.desc.text=this.data[0]},Object.defineProperty(e.prototype,"userData",{get:function(){return this.data},enumerable:!0,configurable:!0}),e}(BaseItemRender);__reflect(GainGoodsNoSkinItem.prototype,"GainGoodsNoSkinItem"),window.GainGoodsNoSkinItem=GainGoodsNoSkinItem;var ShopGoodsWarn=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="GainGoodsSkin",this.gainList.itemRenderer=GainGoodsItem,this.countTxt.restrict="0-9",this.price.setType(MoneyConst.yuanbao),this.totalPrice.setType(MoneyConst.yuanbao),this.itemIcon.imgJob.visible=!1},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];"7000183"==urlParam.appid&&window.mz?(this.chatGroup.touchChildren=!1,this.chatGroup.touchEnabled=!0):(this.chatGroup.touchChildren=!0,this.chatGroup.touchEnabled=!1),this.addTouchEvent(this.decBtn,this.onTap),this.addTouchEvent(this.addBtn,this.onTap),this.addTouchEvent(this.dec10Btn,this.onTap),this.addTouchEvent(this.add10Btn,this.onTap),this.addTouchEvent(this.buyBtn,this.onTap),this.addTouchEvent(this.topUpBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.chatGroup,this.onTap),this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.addChangeEvent(this.countTxt,this.onTxtChange),this.observe(Shop.ins().postBuyResult,this.buyCallBack),this.observe(GameLogic.ins().postInputText,this.updateInputText),this.countTxt.addEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this)},e.prototype.updateInputText=function(t){this.countTxt.text=t,this.textInOn()},e.prototype.textInOn=function(){"请输入"==this.countTxt.text&&(this.countTxt.text="")},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.countTxt.removeEventListener(egret.FocusEvent.FOCUS_IN,this.textInOn,this),this.gainList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.removeTouchEvent(this.decBtn,this.onTap),this.removeTouchEvent(this.addBtn,this.onTap),this.removeTouchEvent(this.dec10Btn,this.onTap),this.removeTouchEvent(this.add10Btn,this.onTap),this.removeTouchEvent(this.buyBtn,this.onTap),this.removeTouchEvent(this.topUpBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.countTxt.removeEventListener(egret.TouchEvent.CHANGE,this.onTxtChange,this)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.decBtn:this.setTotalPrice(this._totalNum-1);break;case this.addBtn:this.setTotalPrice(this._totalNum+1);break;case this.dec10Btn:this.setTotalPrice(this._totalNum-10);break;case this.add10Btn:this.setTotalPrice(this._totalNum+10);break;case this.buyBtn:if("7000183"==urlParam.appid&&window.mz&&!parseInt(this.countTxt.text))return void TipsCT.ins().showTips("请输入数字");Actor.yb>=this.totalPrice.getPrice()?Shop.ins().sendBuy(1,[[this._goodsId,this._totalNum]]):(TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this));break;case this.topUpBtn:var i=Recharge.ins().getRechargeData(0);i&&0!=i.num?ViewManager.ins().open(RechargeWin):(ViewManager.ins().close(e),ViewManager.ins().open(Recharge1Win));break;case this.bgClose:ViewManager.ins().close(e);break;case this.chatGroup:"7000183"==urlParam.appid&&window.mz&&CommonUtils.getKeyboard(0,this.countTxt.text||"")}},e.prototype.onTouchList=function(t){var i=t.item;if(null!=t.item){var n=ViewManager.ins().viewOpenCheck(i[1],i[2]);if(n){var s=!0;if("Recharge2Win"==i[1]){var o=Recharge.ins().getRechargeData(0);o&&0!=o.num||(s=!1,ViewManager.ins().open(Recharge1Win))}s&&""!=i[1]&&GameGuider.guidance(i[1],i[2],i[3]),ViewManager.ins().close(e),ViewManager.ins().close(BookUpWin),ViewManager.ins().close(WeaponPanel),ViewManager.ins().close(WeaponSoulBreakWin),ViewManager.ins().close(SkillWin),"HeirloomCom"!=i[1]&&ViewManager.ins().close(HeirloomCom),"LadderWin"==i[1]&&ViewManager.ins().close(ForgeWin),"PlayFunView"==i[1]&&ViewManager.ins().close(ShopWin)}}},e.prototype.buyCallBack=function(t){t>0?ViewManager.ins().close(e):(TipsCT.ins().showTips("|C:0xf3311e&T:元宝不足|"),ViewManager.ins().close(this))},e.prototype.onTxtChange=function(t){var e=Number(this.countTxt.text);this.setTotalPrice(e)},e.prototype.setData=function(t,e){var i;if(t>2e4){var n=GlobalConfig.ItemConfig[t];this.itemIcon.setData(n),this.nameTxt.text=""+n.name,this.nameTxt.textColor=ItemUtil.getQualityColor(n),i=ItemStoreConfig.getStoreByItemID(t),this.titleTxt.text="材料不足，通过以下方式获得"}else{switch(this.itemIcon.setData(null),t){case MoneyConst.gold:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="货币不足，通过以下方式获得";break;case MoneyConst.soul:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="精华不足，通过以下方式获得";break;case 7:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="功勋不足，通过以下方式获得";break;case 8:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="成就积分不足，通过以下方式获得";break;case MoneyConst.weiWang:this.itemIcon.imgIcon.source=RewardData.CURRENCY_RES[t],this.nameTxt.text=RewardData.CURRENCY_NAME[t],this.titleTxt.text="威望不足，通过以下方式获得"}this.nameTxt.textColor=16758826}var s=GlobalConfig.GainItemConfig[t],o=0;s?(this.gainList.dataProvider=new eui.ArrayCollection(s.gainWay),o=60*s.gainWay.length):this.gainList.dataProvider=new eui.ArrayCollection([]),i?(this.goodsGroup.visible=!0,this.nameTxt.x=225,this.nameTxt.y=170,this.nameTxt.textAlign="center",this.itemIcon.x=145,this.frame.height=410+o,this.gainListGroup.y=352,this._goodsId=i.id,this.price.setPrice(i.price),this.setTotalPrice(e)):(this.goodsGroup.visible=!1,this.nameTxt.x=182,this.nameTxt.y=200,this.nameTxt.textAlign="center",this.itemIcon.x=172,this.frame.height=340+o,this.gainListGroup.y=280),this.tipGroup.y=this.gainListGroup.height+this.gainListGroup.y+3},e.prototype.setTotalPrice=function(t){0>=t?this._totalNum=1:t>=1e4?this._totalNum=9999:this._totalNum=t,this.countTxt.text=this._totalNum+"",this.totalPrice.setPrice(this._totalNum*this.price.getPrice())},e}(BaseEuiView);__reflect(ShopGoodsWarn.prototype,"ShopGoodsWarn"),ViewManager.ins().reg(ShopGoodsWarn,LayerManager.UI_Popup),window.ShopGoodsWarn=ShopGoodsWarn;var Wanbatc=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){this.skinName="WanbatcSkin",this.rewardList.itemRenderer=ItemBase},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.BG,this.onTap),this.addTouchEvent(this.shoucang,this.onTap),this.rewardList.dataProvider=new eui.ArrayCollection(GlobalConfig.WanBaGiftbagBasic[10].items)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.BG,this.onTap),this.removeTouchEvent(this.shoucang,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.shoucang:window.h5gamecn&&window.h5gamecn.sendToDesktop&&window.h5gamecn.sendToDesktop(function(){TipsCT.ins().showTips("成功添加到桌面"),PfActivity.ins().sendWanBaGift(10)});case this.BG:ViewManager.ins().close(e)}},e}(BaseEuiView);__reflect(Wanbatc.prototype,"Wanbatc"),ViewManager.ins().reg(Wanbatc,LayerManager.UI_Popup),window.Wanbatc=Wanbatc;var WarnWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.show=function(t,e,i,n,s,o,a,r,l,h){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o="normal"),void 0===a&&(a="center"),void 0===r&&(r=!1),void 0===l&&(l=null),void 0===h&&(h=null);var u=WarnCT.ins().setWarnLabel(t,{func:e,thisObj:i},{func2:n,thisObj2:s},o,a,r,{func3:l,thisObj3:h});return u},e.prototype.showUI=function(t,e,i,n){this.leftGroup.visible=!1,this.icon1.visible=!1,this.label1.visible=!1,this.rightGroup.visible=!1,this.icon2.visible=!1,this.label2.visible=!1,(t||e)&&(this.leftGroup.visible=!0,t&&(this.icon1.visible=!0,this.icon1.source=t),e&&(this.label1.visible=!0,this.label1.text=e)),(i||n)&&(this.rightGroup.visible=!0,i&&(this.icon2.visible=!0,this.icon2.source=i),n&&(this.label2.visible=!0,this.label2.text=n))},e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="warnFrameSkin"},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.sureBtn,this.onTap),this.addTouchEvent(this.notBtn,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.addTouchEvent(this.cbx,this.onTap),this.cbx.selected=t?t[0]:!1},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.sureBtn,this.onTap),this.removeTouchEvent(this.notBtn,this.onTap),this.removeTouchEvent(this.bgClose,this.onTap),this.removeTouchEvent(this.cbx,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.sureBtn:null!=this.callBack.func&&this.callBack.func.call(this.callBack.thisObj);break;case this.notBtn:case this.bgClose:this.calback2.func2&&this.calback2.func2.call(this.calback2.thisObj2);break;case this.cbx:this.calback3.func3&&this.calback3.func3.call(this.calback3.thisObj3,this.cbx.selected)}t.currentTarget!=this.cbx&&ViewManager.ins().close(e)},Object.defineProperty(e.prototype,"isShowWin",{get:function(){return this._isShowWin},set:function(t){this._isShowWin!=t&&(this._isShowWin=t)},enumerable:!0,configurable:!0}),e.prototype.setWarnLabel=function(t,e,i,n,s,o){void 0===i&&(i=null),void 0===n&&(n="normal"),void 0===s&&(s="left"),this.warnLabel.textFlow=TextFlowMaker.generateTextFlow(t),this.callBack=e,this.calback2=i,this.currentState=n,this.warnLabel.textAlign=s,this.calback3=o},e.prototype.setBtnLabel=function(t,e){t&&(this.sureBtn.label=t),e&&(this.notBtn.label=e)},e}(BaseEuiView);__reflect(WarnWin.prototype,"WarnWin"),window.WarnWin=WarnWin,ViewManager.ins().reg(WarnWin,LayerManager.UI_Popup);var WelcomeWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="welcomePanelSkin",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.item.visible=!1,LocationProperty.isIosTS){this.visible=!1;var i=TaskCT.ins().taskTrace;i?this.close():this.observe(TaskCT.ins().postUpdateAchieve,this.close)}this.observe(TaskCT.ins().postUpdteTaskTrace,this.update),this.rewardList.itemRenderer=ItemBase,this.addTouchEvent(this,this.onTap),this.playEff(),this.update()},e.prototype.update=function(){var t=TaskCT.ins().taskTrace;if(t){var e=TaskCT.ins().getAchieveConfById(t.id);e&&e.awardList&&(this.list=e.awardList,this.rewardList.dataProvider=new eui.ArrayCollection(e.awardList))}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onTap),egret.Tween.removeTweens(this.pic);var i=TaskCT.ins().taskTrace;i&&(TaskCT.ins().sendGetAchieve(i.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(i))},e.prototype.onTap=function(t){var i=this,n=egret.Tween.get(this.list);for(var s in this.list)this.item.visible=!0,n.wait(300).call(function(){i.flyItem(i.item,i.list[s])});var o=egret.Tween.get(this.sureGroup);o.to({scaleX:0,scaleY:0,horizontalCenter:-StageUtils.ins().getWidth()/2+80,verticalCenter:-StageUtils.ins().getHeight()/2+165+98},500).call(function(){ViewManager.ins().close(e)}),Hint.ins().postWelcome()},e.prototype.flyItem=function(t,e){if(e.count){var i=new ItemBaseNoTap;i.x=t.x,i.y=t.y,i.scaleX=i.scaleY=.7,i.data=e,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,t.parent.addChild(i),GameLogic.ins().postFlyItemEx(i)}},e.prototype.playEff=function(){this.eff||(this.eff=new MovieClip,this.eff.x=this.sureGroup.width/2,this.eff.y=this.sureGroup.height/2-5,this.eff.scaleX=this.effgroup.scaleX,this.eff.scaleY=this.effgroup.scaleY,this.sureGroup.addChild(this.eff)),this.eff.playFile(RES_DIR_EFF+"Briefing",-1)},e}(BaseEuiView);__reflect(WelcomeWin.prototype,"WelcomeWin"),ViewManager.ins().reg(WelcomeWin,LayerManager.UI_Popup),window.WelcomeWin=WelcomeWin;var WelcomeWin2=function(t){function e(){var e=t.call(this)||this;return e.eff=new MovieClip,e.skinName="welcomePanelSkin2",e.eGruop.addChild(e.eff),e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.eBtn,this.onTap),this.eff.playFile(RES_DIR_EFF+"Briefing",-1)},e.prototype.onTap=function(t){var i=egret.Tween.get(this.eG);i.to({scaleX:0,scaleY:0,horizontalCenter:-StageUtils.ins().getWidth()/2+80,verticalCenter:-StageUtils.ins().getHeight()/2+165+98},500).call(function(){ViewManager.ins().close(e)})},e}(BaseEuiView);__reflect(WelcomeWin2.prototype,"WelcomeWin2"),ViewManager.ins().reg(WelcomeWin2,LayerManager.UI_Popup),window.WelcomeWin2=WelcomeWin2;var Weapons=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Weapons,e.regNetMsg(0,e.postWeaponsInfo),e.regNetMsg(1,e.postWeaponsUpLevel),e.regNetMsg(2,e.postWeaponsAct),e.regNetMsg(3,e.postWeaponsUse),e.regNetMsg(4,e.postWeaponsFlexibleAct),e.regNetMsg(5,e.postWeaponsFlexibleCount),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.checkRedPoint=function(t){if(!OpenSystem.ins().checkSysOpen(SystemType.WEAPONS))return!1;var e=SubRoles.ins().getSubRoleByIndex(t);for(var i in GlobalConfig.WeaponSoulConfig){var n=GlobalConfig.WeaponSoulConfig[i];if(e.weapons.getRedPointBySuit(n.id))return!0}var s=ForgeRedPoint.ins().getFlexibleRedPoint(t);if(s)return!0;var o=BagCT.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid);return o&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum?!0:!1},e.prototype.checkIsUseFlexible=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(t);return-1!=i.weapons.getFlexibleData().indexOf(e)?!0:!1},e.prototype.sendWeaponsUpLevel=function(t,e){var i=this.getBytes(1);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsAct=function(t,e){var i=this.getBytes(2);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsUse=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeShort(e),this.sendToServer(i)},e.prototype.sendWeaponsFlexibleAct=function(t,e,i){var n=this.getBytes(4);n.writeByte(t),n.writeByte(e),n.writeShort(i),this.sendToServer(n)},e.prototype.sendWeaponsFlexibleCount=function(t){var e=this.getBytes(5);e.writeByte(t),this.sendToServer(e)},e.prototype.postWeaponsInfo=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parser(t)},e.prototype.postWeaponsUpLevel=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parserInfoOnly(t)},e.prototype.postWeaponsAct=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.parserSoulInfoOnly(t,e)},e.prototype.postWeaponsUse=function(t){var e=t.readUnsignedByte(),i=SubRoles.ins().getSubRoleByIndex(e);i.weapons.weaponsId=t.readShort();var n=EntityManager.ins().getEntityByHandle(i.handle);n&&n.updateModel()},e.prototype.postWeaponsFlexibleAct=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte(),n=t.readShort(),s=SubRoles.ins().getSubRoleByIndex(e),o=s.weapons.getFlexibleData();if(i==WeaponFlex.act)-1==o.indexOf(n)&&o.push(n);else for(var a=0;a<o.length;a++)if(o[a]==n){o.splice(a,1);break}},e.prototype.postWeaponsFlexibleCount=function(t){var e=t.readByte(),i=t.readShort(),n=SubRoles.ins().getSubRoleByIndex(e);n&&(n.weapons.flexibleCount=i?i+1:0)},__decorate([post()],e.prototype,"postWeaponsInfo",null),__decorate([post()],e.prototype,"postWeaponsUpLevel",null),__decorate([post()],e.prototype,"postWeaponsAct",null),__decorate([post()],e.prototype,"postWeaponsUse",null),__decorate([post()],e.prototype,"postWeaponsFlexibleAct",null),__decorate([post()],e.prototype,"postWeaponsFlexibleCount",null),e}(BaseSystem);__reflect(Weapons.prototype,"Weapons");var WeaponFlex;!function(t){t[t.act=0]="act",t[t.cancel=1]="cancel"}(WeaponFlex||(WeaponFlex={})),System.Weapons=function(){return Weapons.ins()},window.Weapons=Weapons;var WeaponsData=function(){function t(){var t=Object.keys(GlobalConfig.WeaponSoulConfig);this.WeaponsSoulInfoData={};for(var e=0;e<t.length;e++){var i=t[e],n=new WeaponsSoulInfo;this.WeaponsSoulInfoData[i]=n}t=Object.keys(GlobalConfig.WeaponSoulPosConfig),this.WeaponsInfoData={};for(var e=0;e<t.length;e++){var i=t[e];this.WeaponsInfoData[i]||(this.WeaponsInfoData[i]={})}this.WeaponsFlexibleInfoData=[],this.weaponsId=0,this.flexibleCount=0}return t.prototype.getSuitConfig=function(t){for(var e=this.getInfoData(),i=0,n=!1,s=GlobalConfig.WeaponSoulConfig[t],o=0;o<s.actcond.length;o++){var a=s.actcond[o];if(n=!0,Object.keys(e[a]).length)for(var r in e[a]){var l=e[a][r];if(0==o&&(i=l.level),!l.level){n=!1;break}l.level<=i&&(i=l.level)}else n=!1;if(!n)break}var h;if(n){var u="";for(var p in GlobalConfig.WeaponSoulSuit[t]){if(!(i>=Number(p)))break;u=p}u&&(h=GlobalConfig.WeaponSoulSuit[t][u])}return h},t.prototype.getNextSuitConfig=function(t){var e,i=this.getSuitConfig(t);i||(i=GlobalConfig.WeaponSoulSuit[t][0]);for(var n in GlobalConfig.WeaponSoulSuit[t])if(GlobalConfig.WeaponSoulSuit[t][n].lv>i.lv){e=GlobalConfig.WeaponSoulSuit[t][n];break}return e},t.prototype.parser=function(t){this.parserInfo(t),this.parserSoulInfo(t),this.parserWeaponFlexibleInfo(t)},t.prototype.parserInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort(),s=t.readInt();this.WeaponsInfoData[n]={};var o=new WeaponsInfo;o.setInfo(n,s),this.WeaponsInfoData[n][s]=o}},t.prototype.parserSoulInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort();this.WeaponsSoulInfoData[n].setSoulInfo(n)}},t.prototype.parserWeaponFlexibleInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=t.readShort();this.WeaponsFlexibleInfoData.push(n)}this.flexibleCount=t.readShort(),this.flexibleCount&&this.flexibleCount++},t.prototype.parserInfoOnly=function(t){var e=t.readShort(),i=t.readInt();this.WeaponsInfoData[e]={};var n=new WeaponsInfo;n.setInfo(e,i),this.WeaponsInfoData[e][i]=n},t.prototype.parserSoulInfoOnly=function(t,e){var i=t.readShort();if(i>0){this.WeaponsSoulInfoData[i].setSoulInfo(i);var n=SubRoles.ins().getSubRoleByIndex(e);if(n){var s=this.WeaponsSoulInfoData[i].inside[n.job-1];s&&(ViewManager.ins().close(WeaponPanel),Activationtongyong.show(0,this.WeaponsSoulInfoData[i].name,"weapsdao_png",!0,function(){var t=ViewManager.ins().getView(ForgeWin);t&&t.weaponsoul&&ViewManager.ins().open(WeaponPanel,t.weaponsoul.roleId,t.weaponsoul.weaponId)},s))}}},t.prototype.getRedPointBySuit=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)return!1;if(!this.WeaponsSoulInfoData[t].id&&this.IsActivityWeapon(t))return!0;for(var i in e.actcond){var n=e.actcond[i],s=this.getInfoLevel(n),o=GlobalConfig.WeaponSoulPosConfig[n][s],a=o.costNum,r=GlobalConfig.WeaponSoulPosConfig[n][s+1];if(a&&r){var l=BagCT.ins().getBagItemById(o.costItem),h=l?l.count:0;if(h>=a)return!0}}return this.IsHaveAndNotWear(t)},t.prototype.IsHaveAndNotWear=function(t){if(!this.weaponsId)for(var e in this.WeaponsSoulInfoData){var i=this.WeaponsSoulInfoData[e];if(t){if(t==i.id)return!0}else if(i.id)return!0}return!1},t.prototype.getInfoLevel=function(t){var e=0;if(!this.WeaponsInfoData[t])return 0;for(var i in this.WeaponsInfoData[t]){e=this.WeaponsInfoData[t][i].level;break}return e},t.prototype.getSlotByInfo=function(t){var e;if(!this.WeaponsInfoData[t])return e;for(var i in this.WeaponsInfoData[t]){e=this.WeaponsInfoData[t][i];break}return e},t.prototype.getWeapsInfoBySoulId=function(t){var e=this.WeaponsSoulInfoData[t];return e},t.prototype.IsActivityWeapon=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(e){for(var i=0;i<e.actcond.length;i++){var n=e.actcond[i];if(!CommonUtils.getObjectLength(this.WeaponsInfoData[n]))return!1}return!0}return!1},t.prototype.getInfoData=function(){return this.WeaponsInfoData},t.prototype.getSoulInfoData=function(){return this.WeaponsSoulInfoData},t.prototype.getFlexibleData=function(){return this.WeaponsFlexibleInfoData},t}();__reflect(WeaponsData.prototype,"WeaponsData"),window.WeaponsData=WeaponsData;var WeaponsInfo=function(){function t(){this.id=0,this.level=0,this.costItem=0,this.costNum=0,this.showlv=0,this.assault=0,this.icon="",this.name="",this.attr=[],this.ex_attr=[]}return t.prototype.setInfo=function(t,e){if(t>0&&e>0){var i=GlobalConfig.WeaponSoulPosConfig[t][e];if(!i)return;this.id=i.id,this.level=i.level,this.costItem=i.costItem,this.costNum=i.costNum,this.showlv=i.showlv,this.assault=i.assault,this.icon=i.icon,this.name=i.name,this.attr=i.attr,this.ex_attr=i.ex_attr}},t}();__reflect(WeaponsInfo.prototype,"WeaponsInfo"),window.WeaponsInfo=WeaponsInfo;var WeaponsSoulInfo=function(){function t(){this.icon="",this.id=0,this.name="",this.actcond=[],this.inside=[],this.outside=[],this.pic=[],this.icon=""}return t.prototype.setSoulInfo=function(t){if(t>0){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)return;this.id=e.id,this.name=e.name,this.actcond=e.actcond,this.inside=e.inside,this.outside=e.outside,this.pic=e.pic,this.icon=e.icon}},t}();__reflect(WeaponsSoulInfo.prototype,"WeaponsSoulInfo"),window.WeaponsSoulInfo=WeaponsSoulInfo;var WeaponsSuitInfo=function(){function t(){this.id=0,this.level=0,this.attr={},this.ex_attr={}}return t.prototype.setInfo=function(t){},t}();__reflect(WeaponsSuitInfo.prototype,"WeaponsSuitInfo"),window.WeaponsSuitInfo=WeaponsSuitInfo;var WeaponListItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="soulItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data&&this.data.showId){var t=this.data.id,e=this.data.isuse,i=this.data.isRedPoint,n=this.data.level,s=(this.data.isSelect,GlobalConfig.WeaponSoulConfig[t]),o=this.data.showId,a=this.data.job;if(!s){s=GlobalConfig.WeaponSoulConfig[o],this.setEff(s,a);var r=GlobalConfig.WeaponSoulSuit[s.id],l=void 0;for(var h in r){l=r[h];break}return this.timelabel.text=s.name,this.huanhuaImage.visible=!1,this.redPoint0.visible=i,this.levellabel.text=l.lv+"阶",void this.setGray(this.mc)
}this.setEff(s,a),this.timelabel.text=s.name,this.huanhuaImage.visible=e,this.redPoint0.visible=i,this.levellabel.text=n+"阶"}},e.prototype.setEff=function(t,e){if(t){switch(this.mc||(this.mc=new MovieClip),this.mc.parent||(this.effpos.parent.addChild(this.mc),this.mc.rotation=125),e){case 1:this.mc.x=40,this.mc.y=320;break;case 2:this.mc.x=40,this.mc.y=240;break;case 3:this.mc.x=40,this.mc.y=300}var i=t.inside[e-1];this.mc.playFile(RES_DIR_EFF+i,-1),this.touchEnabled=!1,this.mc.touchEnabled=!1,this.effpos.parent.touchEnabled=!1,this.cleanFilters(this.mc)}},e.prototype.setGray=function(t){if(this.mc&&this.cleanFilters(this.mc),t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)]}},e.prototype.cleanFilters=function(t){t&&(t.filters=[])},e.prototype.clear=function(){this.cleanFilters(this.mc)},e.prototype.destruct=function(){this.clear()},e}(BaseItemRender);__reflect(WeaponListItem.prototype,"WeaponListItem"),window.WeaponListItem=WeaponListItem;var JieSuo="解 锁",WeaponPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkin2",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.skillicon,this.onEvent),this.addTouchEvent(this.upGradeBtn0,this.onEvent),this.addTouchEvent(this.turnTxt,this.onEvent),this.addTouchEvent(this.closeBtn,this.onEvent),this.observe(Weapons.ins().postWeaponsAct,this.callback),this.observe(Weapons.ins().postWeaponsUse,this.callback),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.weaponShowPanel.open(),this.roleId=t[0],this.weaponId=t[1],this.init(this.weaponId)},e.prototype.init=function(t){this.updateUI(t)},e.prototype.updateUI=function(t){var e=GlobalConfig.WeaponSoulConfig[t];if(!e)for(var i in GlobalConfig.WeaponSoulConfig){e=GlobalConfig.WeaponSoulConfig[i];break}var n=SubRoles.ins().getSubRoleByIndex(this.roleId);this.ringname.text=e.name;var s=n.weapons.getSoulInfoData()[t],o=n.weapons.getSuitConfig(t),a="|C:0x00ff00&T:(已激活)",r="|C:0xffd93f&T:";if(!s||!s.id){r="";for(var i in GlobalConfig.WeaponSoulSuit[t]){o=GlobalConfig.WeaponSoulSuit[t][i];break}}-1==n.weapons.getFlexibleData().indexOf(t)&&(a=""),this.levellabel.text=o.lv+"阶",this.skillicon.data={icon:o.skillicon},this.skillname.text=o.skillname,this.powerPanel.setPower(n.getWeaponTotalPower(t));for(var l=[4,2,6,5],h=[0,0,0,0],u=0,p=e.actcond;u<p.length;u++){var c=p[u],d=n.weapons.getSlotByInfo(c);if(d)for(var g=0,f=d.attr;g<f.length;g++){var v=f[g];if(-1!=l.indexOf(v.type))for(var y=0;y<l.length;y++)l[y]==v.type&&(h[y]+=v.value)}}for(var m=0;4>m;m++)if(this["attr"+m]){var T=AttributeData.getAttrStrByType(l[m]);this["attr"+m].text=T+"+"+h[m]}this.skill.textFlow=TextFlowMaker.generateTextFlow1(""+r+o.skilldesc+a);var C=n.weapons.getWeapsInfoBySoulId(t);this.turnTxt.parent&&(this.turnTxt.textFlow=TextFlowMaker.generateTextFlow1("|U:&T:兵魂之灵")),this.descGroup.visible=!0,n.weapons.flexibleCount?(this.desc.text="使用后只会改变外观,变更技能效果请前往",this.turnTxt.parent||this.desc.parent.addChild(this.turnTxt)):(this.desc.text="使用后将激活兵魂的技能效果以及外观显示",DisplayUtils.removeFromParent(this.turnTxt)),C&&C.id?n.weapons.weaponsId==C.id?(this.upGradeBtn0.label="取 消",this.huanhuaImage.visible=!0,this.redPoint.visible=!1):n.weapons.weaponsId?(this.upGradeBtn0.label="替 换",this.huanhuaImage.visible=!1,this.redPoint.visible=!1):(this.upGradeBtn0.label="使 用",this.huanhuaImage.visible=!1,this.redPoint.visible=!0):(this.upGradeBtn0.label=JieSuo,this.huanhuaImage.visible=!1,this.redPoint.visible=n.weapons.IsActivityWeapon(t),this.descGroup.visible=!1),this.weaponShowPanel.init(t,this.roleId)},e.prototype.onEvent=function(t){switch(t.currentTarget){case this.skillicon:ViewManager.ins().open(WeaponSoulSkillTips,this.roleId,this.weaponId);break;case this.upGradeBtn0:var e=SubRoles.ins().getSubRoleByIndex(this.roleId);if(this.upGradeBtn0.label==JieSuo){var i=e.weapons.getSuitConfig(this.weaponId);if(!i)return void TipsCT.ins().showTips("还有部位未激活");Weapons.ins().sendWeaponsAct(this.roleId,this.weaponId)}else"使 用"==this.upGradeBtn0.label?Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId):"取 消"==this.upGradeBtn0.label?Weapons.ins().sendWeaponsUse(this.roleId,0):"替 换"==this.upGradeBtn0.label&&Weapons.ins().sendWeaponsUse(this.roleId,this.weaponId);break;case this.closeBtn:ViewManager.ins().close(this);break;case this.turnTxt:var n=ViewManager.ins().getView(ForgeWin);n&&n.weaponsoul.closeSoulCondition(!1),ViewManager.ins().close(this)}},e.prototype.callback=function(){this.updateUI(this.weaponId)},e.prototype.destoryView=function(){t.prototype.destoryView.call(this)},e}(BaseEuiView);__reflect(WeaponPanel.prototype,"WeaponPanel"),ViewManager.ins().reg(WeaponPanel,LayerManager.UI_Popup),window.WeaponPanel=WeaponPanel;var WeaponShowPanel=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkinState",e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.roleId=0,this.weaponId=0},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.releaseEvent()},e.prototype.releaseEvent=function(){this.currentState&&(DisplayUtils.removeFromParent(this.mc),this.mc=null,DisplayUtils.removeFromParent(this.masksp),this.masksp=null)},e.prototype.init=function(t,e){var i=t?t:this.weaponId,n=isNaN(e)?this.roleId:e;this.weaponId=i,this.roleId=n;var s=GlobalConfig.WeaponSoulConfig[i];if(s){var o=s.actcond.length;this.releaseEvent();var a=SubRoles.ins().getSubRoleByIndex(n);this.currentState=o+"";for(var r=a.weapons.getWeapsInfoBySoulId(s.id),l=0,h=0;h<s.actcond.length;h++)if(this.addTouchEvent(this["item"+h],this.onClick),r.id)l++,this["lianjiexian"+h]&&this.setLight(this["lianjiexian"+h]),this["item"+h]&&(this["item"+h].data=a.weapons.getSlotByInfo(s.actcond[h]));else{var u=a.weapons.getSlotByInfo(s.actcond[h]);u?(l++,this["lianjiexian"+h]&&this.setLight(this["lianjiexian"+h]),this["item"+h]&&(this["item"+h].data=a.weapons.getSlotByInfo(s.actcond[h]))):(this["lianjiexian"+h]&&this.setGray(this["lianjiexian"+h]),this["item"+h]&&(this["item"+h].data=GlobalConfig.WeaponSoulPosConfig[s.actcond[h]][0]))}this.setEff(l,s.actcond.length,s,a)}},e.prototype.setEff=function(t,e,i,n){if(i){var s=i.inside[n.job-1];this.mc||(this.mc=new MovieClip),this.mc.parent||this.effgroup.addChild(this.mc),this.mc.playFile(RES_DIR_EFF+s,-1);var o=SubRoles.ins().getSubRoleByIndex(this.roleId).job;2==o?(this.mc.x=64,this.mc.y=280,this.mc.rotation=120):(this.mc.x=40,this.mc.y=400,this.mc.rotation=125)}},e.prototype.setWeaponsModel=function(){this.weaponImg.source="";var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.getEquipByIndex(0),i=e.item.configID;if(i>0){var n=GlobalConfig.EquipConfig[i].appearance;n&&n.indexOf("[job]")>-1&&(n=n.replace("[job]",t.job+"")),this.weaponImg.source=n+"_"+t.sex+"_c_png"}},e.prototype.onClick=function(t){for(var e=0;e<Number(this.currentState);e++)if(t.currentTarget==this["item"+e]){var i=this["item"+e].slot,n=SubRoles.ins().getSubRoleByIndex(this.roleId),s=n.weapons.getSlotByInfo(i);s&&s.level?s.assault?ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.TUPO,n.index,i):ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.SHENGJI,n.index,i):ViewManager.ins().open(WeaponSoulBreakWin,WeaponSoulBreakWin.JIHUO,n.index,i);break}},e.prototype.getJobSkinName=function(t){switch(t){case 1:return"zhan";case 2:return"fa";case 3:return"dao"}return""},e.prototype.callback=function(){this.init()},e.prototype.setGray=function(t){var e=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0];t.filters=[new egret.ColorMatrixFilter(e)]},e.prototype.setLight=function(t){t.filters=[]},e.prototype.cleanFilters=function(t,e){this["zhan"+t+e].filters=[],this["fa"+t+e].filters=[],this["dao"+t+e].filters=[]},e.prototype.destructor=function(){},e}(BaseView);__reflect(WeaponShowPanel.prototype,"WeaponShowPanel"),window.WeaponShowPanel=WeaponShowPanel;var WeaponSkillItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSkillItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data&&(this.skillIcon.source=this.data.icon+"_png")},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSkillItem.prototype,"WeaponSkillItem"),window.WeaponSkillItem=WeaponSkillItem;var WeaponSoulbreakItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulbreakitem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t,e=this.data.sum,i=this.data.costNum,n=this.data.costItem;t=e>=i?ColorUtil.GREEN:ColorUtil.RED,this.lv.textFlow=TextFlowMaker.generateTextFlow1("|C:"+t+"&T:"+e+"/"+i),this.itemIcon.imgJob.visible=!1;var s=GlobalConfig.ItemConfig[n];this.nameTxt.text=s.name,this.itemIcon.imgIcon.source=s.icon+"_png"}},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSoulbreakItem.prototype,"WeaponSoulbreakItem"),window.WeaponSoulbreakItem=WeaponSoulbreakItem;var WeaponSoulBreakWin=function(t){function e(){var e=t.call(this)||this;return e.calldesc="",e.skinName="weaponSoulBreak",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Timer.stop(this.timeClock,this),DisplayUtils.removeFromParent(this.upLvEff),DisplayUtils.removeFromParent(this.finisheff);for(var i=0;i<this.effs.length;i++)DisplayUtils.removeFromParent(this.effs[i])},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btnjihuo,this.onClick),this.addTouchEvent(this.btntupo,this.onClick),this.addTouchEvent(this.btnlianhua,this.onClick),this.addTouchEvent(this.bgClose,this.onClick),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.tipsType=t[0],this.roleId=t[1],this.slot=t[2],this.effs=[],this.flys=[],this.update()},e.prototype.callback=function(){TipsCT.ins().showTips(this.calldesc+"成功"),"激活"==this.calldesc?(this.star.visible=!0,this.lock.visible=!1,this.tipsType=e.SHENGJI,this.callbackToUpdate()):"升级"==this.calldesc?this.playUpLvEff():"突破"==this.calldesc&&this.playflyEff()},e.prototype.callbackToUpdate=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),i=t.weapons.getSlotByInfo(this.slot);Assert(i,"WeaponSoulBreakWin slot:"+this.slot+", roleId:"+this.roleId),i.assault?this.tipsType=e.TUPO:"突破"==this.calldesc&&(this.btntupo.touchEnabled=!0,this.tipsType=e.SHENGJI),this.update()},e.prototype.update=function(){var t=GlobalConfig.WeaponSoulPosConfig[this.slot];if(this.tipsType==e.JIHUO){this.title.text="激活",this.star.visible=!1,this.lock.visible=!0,this.jihuo.visible=!0,this.tupo.visible=!1,this.lianhua.visible=!1,this.item1.imgIcon.source="b_"+t[0].icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name1.text=t[0].name;var i=BagCT.ins().getBagItemById(t[0].costItem),n=i?i.count:0;if(this.material1.data={costItem:t[0].costItem,costNum:t[0].costNum,sum:n},t[1].attr){var s=AttributeData.getAttrStrByType(t[1].attr[0].type);this.jhattr0.text=s+"+"+t[1].attr[0].value,this.jhattr1.visible=!0,t[1].attr[1]?(s=AttributeData.getAttrStrByType(t[1].attr[1].type),this.jhattr1.text=s+"+"+t[1].attr[1].value):this.jhattr1.visible=!1}this.needItemId=t[0].costItem,this.curSum=n,this.maxSum=t[0].costNum}else if(this.tipsType==e.TUPO){this.title.text="突破",this.star.visible=!0,this.lock.visible=!1;var o=SubRoles.ins().getSubRoleByIndex(this.roleId),a=o.weapons.getSlotByInfo(this.slot);if(this.jihuo.visible=!1,this.tupo.visible=!0,this.lianhua.visible=!1,this.item1.imgIcon.source="b_"+t[0].icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name3.text=t[0].name,this.tpattr1.text=a.showlv+"",this.tpattr2.text=a.assault+"",this.tpright0.x=this.tpattr1.x+this.tpattr1.width,this.tpattr2.x=this.tpright0.x+this.tpright0.width,a.attr){this.tpattr0.text=AttributeData.getAttrStrByType(a.attr[0].type),this.tpattr3.text=a.attr[0].value+"";var r=GlobalConfig.WeaponSoulPosConfig[a.id][a.level+1];this.tpattr4.text=r.attr[0].value+"",this.tpright1.x=this.tpattr3.x+this.tpattr3.width,this.tpattr4.x=this.tpright1.x+this.tpright1.width,a.attr[1]&&r.attr[1]?(this.g2.visible=!0,this.tpattr5.text=AttributeData.getAttrStrByType(a.attr[1].type),this.tpattr6.text=a.attr[1].value+"",this.tpattr7.text=r.attr[1].value+"",this.tpright2.x=this.tpattr6.x+this.tpattr6.width,this.tpattr7.x=this.tpright2.x+this.tpright2.width):this.g2.visible=!1}var i=BagCT.ins().getBagItemById(a.costItem),n=i?i.count:0;this.material.data={costItem:a.costItem,costNum:a.costNum,sum:n},this.needItemId=a.costItem,this.curSum=n,this.maxSum=a.costNum}else if(this.tipsType==e.SHENGJI){this.title.text="炼化",this.star.visible=!0,this.lock.visible=!1,this.lianhua.visible=!0,this.jihuo.visible=!1,this.tupo.visible=!1;var o=SubRoles.ins().getSubRoleByIndex(this.roleId),a=o.weapons.getSlotByInfo(this.slot),l=GlobalConfig.WeaponSoulPosConfig[a.id][0],r=GlobalConfig.WeaponSoulPosConfig[a.id][a.level+1];if(!r)return this.costgroup0.visible=!1,this.btnlianhua.visible=this.costgroup0.visible,this.lhright1.visible=this.costgroup0.visible,this.lhright0.visible=this.costgroup0.visible,this.lhattr4.visible=this.costgroup0.visible,this.lhattr6.visible=this.costgroup0.visible,this.maxdesc0.visible=!this.costgroup0.visible,this.lhright2.visible=this.costgroup0.visible,this.lhattr8.visible=this.costgroup0.visible,a.attr&&(this.lhattr3.text=a.showlv+"",this.lhattr1.text=AttributeData.getAttrStrByType(a.attr[0].type),this.lhattr5.text=a.attr[0].value+"",a.attr[1]?(this.attr2.visible=!0,this.lhattr2.text=AttributeData.getAttrStrByType(a.attr[1].type),this.lhattr7.text=a.attr[1].value+""):this.attr2.visible=!1),this.name2.text=l.name,this.item1.imgIcon.source="b_"+l.icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.updateEff(),void this.addCheckEff();if(this.item1.imgIcon.source="b_"+l.icon+"_png",this.item1.imgBg.visible=!1,this.item1.imgJob.visible=!1,this.name2.text=l.name,a.attr){this.lhattr3.text=a.showlv+"",this.lhattr4.text=r.showlv+"",this.lhright1.x=this.lhattr3.x+this.lhattr3.width+this.lhright1.width,this.lhattr4.x=this.lhright1.x,this.lhattr1.text=AttributeData.getAttrStrByType(a.attr[0].type),this.lhattr5.text=a.attr[0].value+"",this.lhattr6.text=r.attr[0].value+"",this.lhright0.x=this.lhattr5.x+this.lhattr5.width+this.lhright0.width,this.lhattr6.x=this.lhright0.x,a.attr[1]&&r.attr[1]?(this.attr2.visible=!0,this.lhattr2.text=AttributeData.getAttrStrByType(a.attr[1].type),this.lhattr7.text=a.attr[1].value+"",this.lhattr8.text=r.attr[1].value+"",this.lhright2.x=this.lhattr7.x+this.lhattr7.width+this.lhright2.width,this.lhattr8.x=this.lhright2.x):this.attr2.visible=!1;var i=BagCT.ins().getBagItemById(a.costItem),n=i?i.count:0,h=GlobalConfig.ItemConfig[a.costItem];this.micon0.source=h.icon+"_png";var u=void 0;u=n>=a.costNum?ColorUtil.GREEN:ColorUtil.RED,this.countLabel1.textFlow=TextFlowMaker.generateTextFlow1("|C:"+u+"&T:"+n+"|/|C:0xD1C28F&T:"+a.costNum),this.needItemId=a.costItem,this.curSum=n,this.maxSum=a.costNum}}this.updateEff(),this.addCheckEff()},e.prototype.updateEff=function(){if(this.star.visible){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),i=t.weapons.getSlotByInfo(this.slot);if(!i)return void TipsCT.ins().showTips("显示异常");if(this.cirimg.visible=!0,!i.level){for(var n=0;n<e.maxCir;n++)this["s"+n].visible=!1;return void(this.cirimg.visible=!1)}if(this.maxdesc0.visible||this.tipsType==e.TUPO){for(var n=0;n<e.maxCir;n++)this["s"+n].visible=!0;return void DisplayUtils.drawCir(this._shap,this.star.width>>1,360)}for(var s=i.level%10,n=0;n<e.maxCir;n++)s?this["s"+n].visible=s>n:this["s"+n].visible=!1,this._shap||(this._shap=new egret.Shape),this._shap.parent||(this.star.addChild(this._shap),this.cirimg.mask=this._shap,this._shap.x=this._shap.y=this.star.width>>1,this._shap.rotation=-90),n>0&&s>0?DisplayUtils.drawCir(this._shap,this.star.width>>1,360*(s-1)/e.maxCir):this._shap.graphics.clear()}},e.prototype.addCheckEff=function(){for(var t=0;t<e.maxCir;t++)if(this["s"+t].visible){if(!this.effs[t]){var i=new MovieClip;this.effs[t]=i}this.effs[t].parent||this["star"+t].addChild(this.effs[t]),this.effs[t].x=21,this.effs[t].y=21,this.effs[t].playFile(RES_DIR_EFF+"pulse2",-1)}else this.effs[t]&&this.effs[t].parent&&DisplayUtils.removeFromParent(this.effs[t])},e.prototype.playUpLvEff=function(){this.upLvEff||(this.upLvEff=new MovieClip),this.upLvEff.parent||this.star.addChild(this.upLvEff),this.upLvEff.x=145,this.upLvEff.y=140;var t=this;this.upLvEff.playFile(RES_DIR_EFF+"UpEff1",1,function(){DisplayUtils.removeFromParent(t.upLvEff)}),t.callbackToUpdate()},e.prototype.playflyEff=function(){for(var t=this,e=function(e){if(i.effs[e]&&i.effs[e].parent){i.flys[e]=!0;var n=i.item1.localToGlobal();i["star"+e].globalToLocal(n.x+38,n.y+38,n),egret.Tween.get(i.effs[e]).to({x:n.x,y:n.y},500).call(function(){t.flys[e]=!1,egret.Tween.removeTweens(t.effs[e]),DisplayUtils.removeFromParent(t.effs[e])})}},i=this,n=0;n<this.effs.length;n++)e(n);Timer.stop(this.timeClock,this),Timer.start(100,0,this.timeClock,this)},e.prototype.timeClock=function(){for(var t=0;t<this.flys.length;t++)if(this.flys[t])return;Timer.stop(this.timeClock,this),this.finisheff||(this.finisheff=new MovieClip),this.finisheff.parent||this.star.addChild(this.finisheff),this.finisheff.x=145,this.finisheff.y=140;var e=this;this.finisheff.playFile(RES_DIR_EFF+"BreachEff3",1,function(){e.callbackToUpdate(),DisplayUtils.removeFromParent(e.finisheff)})},e.prototype.onClick=function(t){switch(t.target){case this.btnjihuo:case this.btntupo:if(t.target==this.btnjihuo?this.calldesc="激活":(this.calldesc="突破",this.btntupo.touchEnabled=!1),this.curSum<this.maxSum)return TipsCT.ins().showTips("材料不足"),void WarnCT.ins().setBuyGoodsWarn(this.needItemId);Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot),SoundUtil.play(SoundEnum.FORGE);break;case this.btnlianhua:if(this.curSum<this.maxSum)return TipsCT.ins().showTips("材料不足"),void WarnCT.ins().setBuyGoodsWarn(this.needItemId);this.calldesc="升级",Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot),SoundUtil.play(SoundEnum.FORGE);break;case this.bgClose:ViewManager.ins().close(this)}},e.TUPO=1,e.JIHUO=2,e.SHENGJI=3,e.maxCir=9,e}(BaseEuiView);__reflect(WeaponSoulBreakWin.prototype,"WeaponSoulBreakWin"),ViewManager.ins().reg(WeaponSoulBreakWin,LayerManager.UI_Popup),window.WeaponSoulBreakWin=WeaponSoulBreakWin;var WeaponSoulItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulitem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.slot=0},e.prototype.dataChanged=function(){if(this.data){var t;this.black.visible=!1,this.data instanceof WeaponsInfo?(t=this.data,this.itemIcon.setActived(!0)):(t=this.data,this.black.visible=!0),this.slot=t.id;var e=GlobalConfig.WeaponSoulPosConfig[t.id][0];this.itemIcon.imgIcon.source=e.icon+"_png",this.lv.text=(isNaN(t.level)?e.level:t.level)+"",this.nameTxt.text=e.name;var i=GlobalConfig.WeaponSoulPosConfig[t.id][Number(this.lv.text)+1];if(t.costNum&&i){var n=BagCT.ins().getBagItemById(t.costItem),s=n?n.count:0;this.redPoint.visible=s>=t.costNum?!0:!1}else this.redPoint.visible=!1}},e.prototype.destruct=function(){},e.prototype.clear=function(){},e}(BaseItemRender);__reflect(WeaponSoulItem.prototype,"WeaponSoulItem"),window.WeaponSoulItem=WeaponSoulItem;var WeaponSoulSkillTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulSkilltips",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.bgClose,this.onClick),this.roleId=t[0],this.weaponId=t[1];var i=SubRoles.ins().getSubRoleByIndex(this.roleId);this.head(i),this.curSkill(i),this.nextSkill(i)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.bgClose,this.onClick)},e.prototype.head=function(t){var e=t.weapons.getSuitConfig(this.weaponId);e||(e=GlobalConfig.WeaponSoulSuit[this.weaponId][0]),this.skillicon.data={icon:e.skillicon},this.skillname.text=e.skillname},e.prototype.curSkill=function(t){var e=t.weapons.getSuitConfig(this.weaponId);e||(e=GlobalConfig.WeaponSoulSuit[this.weaponId][0]);for(var i=GlobalConfig.WeaponSoulConfig[this.weaponId],n="",s=0,o=0;o<i.actcond.length;o++){var a=i.actcond[o],r=t.weapons.getInfoLevel(a),l=GlobalConfig.WeaponSoulPosConfig[a][0].name;r&&r>=e.lv?(n+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+l+"| ",s++):n+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"| "}this.num0.text="（"+s+"/"+i.actcond.length+"）",this.informationname0.textFlow=TextFlowMaker.generateTextFlow1(n),this.desc0.text=this.ShowSkillDesc(e)},e.prototype.nextSkill=function(t){var e=t.weapons.getNextSuitConfig(this.weaponId);if(!e)return this.name1.text="已满级",this.num1.visible=!1,this.nextdesc1.visible=!1,this.informationname1.visible=!1,void(this.ndesc0.visible=!1);for(var i=GlobalConfig.WeaponSoulConfig[this.weaponId],n="",s=0,o=0;o<i.actcond.length;o++){var a=i.actcond[o],r=t.weapons.getInfoLevel(a),l=GlobalConfig.WeaponSoulPosConfig[a][0].name;r>=e.lv?(n+="|C:"+ColorUtil.WHITE_COLOR2+"&T:"+l+"| ",s++):n+="|C:"+ColorUtil.GRAY_COLOR2+"&T:"+l+"| "}this.num1.text="（"+s+"/"+i.actcond.length+"）",this.informationname1.textFlow=TextFlowMaker.generateTextFlow1(n),this.ndesc0.text=this.ShowSkillDesc(e);var h=this.nextdesc1.text,u=h.split("X"),p=u[0],c=u[1],d=p+(""+e.lv)+c;this.nextdesc1.text=d},e.prototype.ShowSkillDesc=function(t){return t.skilldesc},e.prototype.onClick=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this)}},e}(BaseEuiView);__reflect(WeaponSoulSkillTips.prototype,"WeaponSoulSkillTips"),ViewManager.ins().reg(WeaponSoulSkillTips,LayerManager.UI_Popup),window.WeaponSoulSkillTips=WeaponSoulSkillTips;var WeaponSoulUplvWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="weaponSoulUplv",e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.btn1,this.onClick),this.addTouchEvent(this.bgClose,this.onClick),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.roleId=t[0],this.slot=t[1],this.update()},e.prototype.callback=function(){TipsCT.ins().showTips("升级成功"),this.update()},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.weapons.getSlotByInfo(this.slot),i=GlobalConfig.WeaponSoulPosConfig[e.id][0],n=GlobalConfig.WeaponSoulPosConfig[e.id][e.level+1];if(!n)return this.costgroup.visible=!1,this.btn1.visible=this.costgroup.visible,this.rightIcon0.visible=this.costgroup.visible,this.rightIcon1.visible=this.costgroup.visible,this.attr6.visible=this.costgroup.visible,this.attr4.visible=this.costgroup.visible,this.maxdesc.visible=!this.costgroup.visible,e.attr&&(this.attr5.text=e.attr[0].value+"",this.attr2.text=AttributeData.getAttrStrByType(e.attr[0].type)),this.name0.text=i.name,this.item0.imgIcon.source=i.icon+"_png",void(this.item0.imgJob.visible=!1);if(this.item0.imgIcon.source=i.icon+"_png",this.item0.imgJob.visible=!1,this.name0.text=i.name,e.attr){this.attr5.text=e.attr[0].value+"",this.attr6.text=n.attr[0].value+"",this.rightIcon0.x=this.attr5.x+this.attr5.width+this.rightIcon0.width,this.attr6.x=this.rightIcon0.x,this.attr2.text=AttributeData.getAttrStrByType(e.attr[0].type),this.attr3.text=e.attr[0].value+"",this.attr4.text=n.attr[0].value+"",this.rightIcon1.x=this.attr3.x+this.attr3.width+this.rightIcon1.width,this.attr4.x=this.rightIcon1.x;var s=BagCT.ins().getBagItemById(e.costItem),o=s?s.count:0,a=GlobalConfig.ItemConfig[e.costItem];this.micon.source=a.icon+"",this.countLabel0.text=o+"/"+e.costNum,this.curSum=o,this.maxSum=e.costNum}},e.prototype.onClick=function(t){switch(t.target){case this.btn1:if(this.curSum<this.maxSum)return void TipsCT.ins().showTips("材料不足");Weapons.ins().sendWeaponsUpLevel(this.roleId,this.slot);break;case this.bgClose:ViewManager.ins().close(this)}},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(BaseEuiView);__reflect(WeaponSoulUplvWin.prototype,"WeaponSoulUplvWin"),ViewManager.ins().reg(WeaponSoulUplvWin,LayerManager.UI_Popup),window.WeaponSoulUplvWin=WeaponSoulUplvWin;var WeaponWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.weaponId=1,e.weaponFlexible=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"roleId",{get:function(){return this._roleId},set:function(t){this._roleId=t,this.skin&&(this.init(this.weaponId),this.closeSoulCondition())},enumerable:!0,configurable:!0}),e.prototype.skinComplete=function(){this.addTouchEvent(this.leftbtn,this.onEvent),this.addTouchEvent(this.rightbtn,this.onEvent),this.addTouchEvent(this.active,this.onEvent),this.addTouchEvent(this.turnBtn,this.onEvent),this.addTouchEvent(this.backBtn,this.onEvent),this.addTouchEvent(this.leftbtn0,this.onEvent),this.addTouchEvent(this.rightbtn0,this.onEvent),this.addTouchEvent(this.list1,this.onClick),this.addEvent(eui.UIEvent.CHANGE_END,this.list1Scroll,this.onChange),this.addEvent(eui.UIEvent.CHANGE_END,this.list0Scroll,this.onChangeFlex),this.list0.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this),this.list1.itemRenderer=WeaponListItem,this.list0.itemRenderer=WeaponListItem,this.leftbtn.parent.touchEnabled=!1},e.prototype.removeDisplay=function(){ViewManager.ins().getView(ForgeWin).isNotMove=!1},e.prototype.addDisplay=function(){ViewManager.ins().getView(ForgeWin).isNotMove=!0,this.closeSoulCondition(),this.observe(Weapons.ins().postWeaponsAct,this.callback),this.observe(Weapons.ins().postWeaponsUse,this.callback),this.observe(Weapons.ins().postWeaponsUpLevel,this.callback),this.observe(Weapons.ins().postWeaponsFlexibleAct,this.callback2),this.observe(Weapons.ins().postWeaponsFlexibleCount,this.callback),this.turnBtn.visible=!0,this.init(this.weaponId)},e.prototype.init=function(t){this.soulArr=[],this.listdata=[],this.dataArr=new eui.ArrayCollection(this.listdata);var e=SubRoles.ins().getSubRoleByIndex(this.roleId);for(var i in GlobalConfig.WeaponSoulConfig){var n=GlobalConfig.WeaponSoulConfig[i],s=e.weapons.getSoulInfoData()[n.id],o=e.weapons.getSuitConfig(n.id),a={isuse:e.weapons.weaponsId==n.id,id:s&&s.id&&o?o.id:0,isRedPoint:e.weapons.getRedPointBySuit(n.id),level:s&&s.id&&o?o.lv:0,isSelect:i==t.toString(),showId:n.id,job:e.job};this.listdata.push(a),s&&s.id&&o&&this.soulArr.push(a)}this.updateUI(),this.list1.dataProvider=this.dataArr,this.list1.scrollH=0,this.onChange(),this.updateSoul(this.soulArr,!0),this.updateRedPoint(),this.onChangeFlex()},e.prototype.setSelectId=function(t){for(var e=0;e<this.listdata.length;e++){var i=this.listdata[e];i.isSelect=e==t}this.dataArr.replaceAll(this.listdata),this.list1.dataProvider=this.dataArr},e.prototype.onEvent=function(t){var e=450;switch(t.currentTarget){case this.leftbtn:this.list1.scrollH<=e?this.list1.scrollH=0:this.list1.scrollH-=e;break;case this.rightbtn:this.list1.scrollH>=150*(this.list1.dataProvider.length-3)?this.list1.scrollH=150*(this.list1.dataProvider.length-3):this.list1.scrollH+=e;break;case this.leftbtn0:this.list0.scrollH<=e?this.list0.scrollH=0:this.list0.scrollH-=e;break;case this.rightbtn0:this.list0.scrollH>=150*(this.list0.dataProvider.length-3)?this.list0.scrollH=150*(this.list0.dataProvider.length-3):this.list0.scrollH+=e;break;case this.active:if("激  活"==this.active.label){var i=SubRoles.ins().getSubRoleByIndex(this.roleId),n=i.weapons.getFlexibleData();if(i.weapons.flexibleCount<=n.length)return void TipsCT.ins().showCenterTips("当前已激活"+i.weapons.flexibleCount+"个兵魂技能，请先取消任意一个");if(!this.weaponFlexible)return void TipsCT.ins().showCenterTips("兵魂之灵激活数据异常");this.isSendActFlex=!0,Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.act,this.weaponFlexible)}else if("取  消"==this.active.label){if(!this.weaponFlexible)return void TipsCT.ins().showCenterTips("兵魂之灵取消数据异常");this.isSendActFlex=!0,Weapons.ins().sendWeaponsFlexibleAct(this.roleId,WeaponFlex.cancel,this.weaponFlexible)}break;case this.turnBtn:var s=ViewManager.ins().getView(ForgeWin);s&&s.redPointEx();var o=BagCT.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid),a=SubRoles.ins().getSubRoleByIndex(this.roleId);o&&a.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum&&ViewManager.ins().open(RoleChooseItemWin,this.roleId),this.closeSoulCondition(!1);break;case this.backBtn:if(!BagCT.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid))return void TipsCT.ins().showTips("背包内没有兵魂之灵");ViewManager.ins().open(RoleChooseItemWin,this.roleId)}this.onChange(),this.onChangeFlex()},e.prototype.updateRedPoint=function(){var t=BagCT.ins().getBagItemById(GlobalConfig.WeaponSoulBaseConfig.itemid),e=SubRoles.ins().getSubRoleByIndex(this.roleId);this.redPoint0.visible=ForgeRedPoint.ins().getFlexibleRedPoint(this.roleId)||null!=t&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum,this.backBtn.visible=this.redPoint1.visible=null!=t&&e.weapons.flexibleCount-1<GlobalConfig.WeaponSoulBaseConfig.maxItemNum},e.prototype.onClick=function(t){var e=t.currentTarget.selectedIndex;e=e>0?e:0,this.listdata[e]&&(this.weaponId=this.listdata[e].showId,this.setSelectId(e),ViewManager.ins().open(WeaponPanel,this.roleId,this.weaponId)),this.onChange()},e.prototype.onChange=function(){this.list1.scrollH<150?(this.leftbtn.visible=!1,this.rightbtn.visible=!0):this.list1.scrollH>=150*(this.list1.dataProvider.length-3)?(this.leftbtn.visible=!0,this.rightbtn.visible=!1):(this.leftbtn.visible=!0,this.rightbtn.visible=!0)},e.prototype.onChangeFlex=function(){if(this.nothingTips.visible)return this.leftbtn0.visible=!1,void(this.rightbtn0.visible=!1);var t=SubRoles.ins().getSubRoleByIndex(this.roleId);return t&&this.soulArr.length<=3?(this.leftbtn0.visible=!1,void(this.rightbtn0.visible=!1)):void(this.list0.scrollH<150?(this.leftbtn0.visible=!1,this.rightbtn0.visible=!0):this.list0.scrollH>=150*(this.list0.dataProvider.length-3)?(this.leftbtn0.visible=!0,this.rightbtn0.visible=!1):(this.leftbtn0.visible=!0,this.rightbtn0.visible=!0))},e.prototype.closeSoulCondition=function(t){void 0===t&&(t=!this.isShowSoul()),this.normal.visible=t,this.soul.visible=!t},e.prototype.onSoulClick=function(t){if(t&&t.itemRenderer&&t.item){var e=t.item,i=SubRoles.ins().getSubRoleByIndex(this.roleId),n=i.weapons.getFlexibleData(),s=i.weapons.getSuitConfig(e.id);if(s){var o="";e.isuse?(o="|C:0xffd93f&T:",this.active.visible=!0):this.active.visible=i.weapons.flexibleCount>n.length,this.weaponFlexible=s.id,this.skillicon0.data={icon:s.skillicon},this.skill.textFlow=TextFlowMaker.generateTextFlow1(o+s.skilldesc),this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(s.skillname)}else this.weaponFlexible=0;e.isuse?(this.active.label="取  消",this.redPoint.visible=!1):(this.active.label="激  活",this.redPoint.visible=i.weapons.flexibleCount>n.length)}},e.prototype.updateUI=function(){var t=SubRoles.ins().getSubRoleByIndex(this.roleId);this.powerPanel.setPower(t.getWeaponTotalPower());var e=[4,2,6,5],i=[0,0,0,0],n=!1,s=t.weapons.getInfoData();for(var o in s){var a=s[o];for(var r in a)for(var l=a[r],h=0;h<l.attr.length;h++){var u=l.attr[h];if(-1!=e.indexOf(u.type))for(var p=0;p<e.length;p++)e[p]==u.type&&(i[p]+=u.value,n=!0)}}var c=t.weapons.flexibleCount?t.weapons.flexibleCount-1:0,d=GlobalConfig.WeaponSoulItemAttr[c];if(n&&d)for(var g=0;g<d.attr.length;g++)if(-1!=e.indexOf(d.attr[g].type))for(var p=0;p<e.length;p++)e[p]==d.attr[g].type&&(i[p]+=d.attr[g].value);for(var g=0;4>g;g++)if(this["attr"+g]){var f=AttributeData.getAttrStrByType(e[g]);this["attr"+g].text=f+"+"+i[g]
}},e.prototype.callback2=function(){this.callback(!0)},e.prototype.callback=function(t){void 0===t&&(t=!1),this.soulArr=[];var e=SubRoles.ins().getSubRoleByIndex(this.roleId),i=e.weapons.getSuitConfig(this.weaponId);for(var n in this.listdata){var s=e.weapons.getSoulInfoData()[this.listdata[n].showId],o=this.listdata[n];o.showId==this.weaponId?(o.isuse=e.weapons.weaponsId==this.weaponId,o.id=s&&s.id&&i?i.id:0,o.isRedPoint=e.weapons.getRedPointBySuit(o.showId),o.level=s&&s.id&&i?i.lv:0,o.isSelect=!0):(o.isRedPoint=e.weapons.getRedPointBySuit(o.showId),o.isSelect=!1,o.isuse=o.showId==e.weapons.weaponsId),s&&s.id&&i&&this.soulArr.push(o)}this.updateUI(),this.dataArr.replaceAll(this.listdata),this.list1.dataProvider=this.dataArr,this.updateSoul(this.soulArr,t),this.updateActLabel(),this.updateRedPoint()},e.prototype.updateSoul=function(t,e){var i=SubRoles.ins().getSubRoleByIndex(this.roleId);if(this.soulArr=[],i.weapons.flexibleCount)for(var n=0;n<t.length;n++){var s={isuse:Weapons.ins().checkIsUseFlexible(i.index,t[n].id),id:t[n].id,isRedPoint:ForgeRedPoint.ins().getFlexibleRedPointOnly(i.index,t[n].showId),level:t[n].level,isSelect:t[n].isSelect,showId:t[n].showId,job:t[n].job};this.soulArr.push(s)}this.list0.dataProvider=new eui.ArrayCollection(this.soulArr);var o=i.weapons.flexibleCount?i.weapons.flexibleCount-1:0;if(this.desc.textFlow=TextFlowMaker.generateTextFlow1("|C:0xF8B141&T:当前已使用|C:0x00ff00&T:"+o+"|C:0xF8B141&T:个兵魂之灵，最多可以同时激活|C:0x00ff00&T:"+(o+1)+"|C:0xF8B141&T:把兵魂技能效果"),e)if(this.soulArr.length>0&&i.weapons.flexibleCount){this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=!0;var a=i.weapons.getSuitConfig(this.soulArr[0].id);if(a){var r="";this.soulArr[0].isuse&&(r="|C:0xffd93f&T:"),this.skillicon0.data={icon:a.skillicon},this.skill.textFlow=TextFlowMaker.generateTextFlow1(r+a.skilldesc),this.skillname0.textFlow=TextFlowMaker.generateTextFlow1(a.skillname)}if(this.leftbtn0.visible=this.rightbtn0.visible=!1,this.soulArr.length>3&&(this.rightbtn0.visible=!0),this.soulArr[0].isuse)this.active.label="取  消",this.redPoint.visible=!1;else{this.active.label="激  活";var l=i.weapons.getFlexibleData();this.active.visible=this.redPoint.visible=i.weapons.flexibleCount<=l.length}this.weaponFlexible=this.soulArr[0].showId}else this.redPoint.visible=!1,this.leftbtn0.visible=this.rightbtn0.visible=!1,this.active.visible=this.skillicon0.visible=this.skill.visible=this.skillname0.visible=!1;this.nothingTips.visible=!this.skillicon0.visible,this.nothingTips.visible&&(i.weapons.flexibleCount?this.nothingTips.text="目前尚未激活任何兵魂":this.nothingTips.text="该角色尚未使用兵魂之灵")},e.prototype.isShowSoul=function(){return this.soul?this.soul.visible:!1},e.prototype.updateActLabel=function(){if(!this.isSendActFlex)return void(this.isSendActFlex=!1);var t=SubRoles.ins().getSubRoleByIndex(this.roleId),e=t.weapons.getFlexibleData();this.isSendActFlex=!1;var i=this.skill.text;"激  活"==this.active.label?(this.active.label="取  消",this.redPoint.visible=!1,this.skill.textFlow=TextFlowMaker.generateTextFlow1("|C:0xffd93f&T:"+i)):"取  消"==this.active.label&&(this.active.label="激  活",this.active.visible=this.redPoint.visible=t.weapons.flexibleCount>e.length,this.skill.textFlow=TextFlowMaker.generateTextFlow1("|C:0x898989&T:"+i))},e}(BaseView);__reflect(WeaponWin.prototype,"WeaponWin"),window.WeaponWin=WeaponWin;var WingFeishengTipsWin=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="wingFeishengTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._curRole=t[0],this.observe(BagCT.ins().postItemAdd,this.itemChange),this.observe(BagCT.ins().postItemChange,this.itemChange),this.observe(BagCT.ins().postItemDel,this.itemChange),this.observe(WingCT.ins().postUseDanSuccess,this.update),this.observe(WingCT.ins().postWingUpgrade,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=GlobalConfig.WingLevelConfig[t.wingsData.lv];this.wingName.text=e.name,this.feishengLv.text=t.wingsData.flyUpDan+"级",this.career.text=Role.getJobNameByJob(t.job);var i=ExpansionCardCT.ins().useDanData,n=i&&i[6]?i[6].addNum:0,s=e.flyPill+n;if(t.wingsData.flyUpDan>=s)this.currentState="maxLv";else{var o=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),a=o?o.count:0;a?this.currentState="normal":this.currentState="noitem"}this.updateAttrs()},e.prototype.updateAttrs=function(){for(var t,e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=GlobalConfig.WingLevelConfig[e.wingsData.lv],n=i.attr.length,s=GlobalConfig.WingCommonConfig.flyPillAttr,o=s.length,a=[],r=1;4>=r;r++)this["attr"+r].text="",this["attr"+r+"NextLv"].text="",n>=r&&(t=i.attr[r-1],this["attr"+r].text=AttributeData.getAttrStrByType(t.type)+": +"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*e.wingsData.flyUpDan+"%","normal"==this.currentState&&(this["attr"+r+"NextLv"].text="+"+Math.floor(GlobalConfig.WingCommonConfig.flyPill/100)*(e.wingsData.flyUpDan+1)+"%"),a.push(new AttributeData(t.type,Math.floor(t.value*GlobalConfig.WingCommonConfig.flyPill/1e4*e.wingsData.flyUpDan)))),this["attr"+(r+4)].text="",this["attr"+(r+4)+"NextLv"].text="",o>=r&&(t=s[r-1],this["attr"+(r+4)].text=AttributeData.getAttrStrByType(t.type)+": +"+t.value*e.wingsData.flyUpDan,"normal"==this.currentState&&(this["attr"+(r+4)+"NextLv"].text="+"+t.value*(e.wingsData.flyUpDan+1)),a.push(new AttributeData(t.type,t.value*e.wingsData.flyUpDan)));this.powerPanel.setPower(BagCT.getAttrPower(a))},e.prototype.itemChange=function(){if("maxLv"!=this.currentState){var t,e=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.flyPillId),i=e?e.count:0;i?(t="normal"!=this.currentState,this.currentState="normal"):(t="noitem"!=this.currentState,this.currentState="noitem"),t&&this.updateAttrs()}},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:WingCT.ins().sendUseDan(this._curRole,1)}},e}(BaseEuiView);__reflect(WingFeishengTipsWin.prototype,"WingFeishengTipsWin"),ViewManager.ins().reg(WingFeishengTipsWin,LayerManager.UI_Main),window.WingFeishengTipsWin=WingFeishengTipsWin;var WingZizhiTipsWin=function(t){function e(){var e=t.call(this)||this;return e._curRole=0,e.skinName="wingZizhiTips",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._curRole=t[0],this.observe(BagCT.ins().postItemAdd,this.itemChange),this.observe(BagCT.ins().postItemChange,this.itemChange),this.observe(BagCT.ins().postItemDel,this.itemChange),this.observe(WingCT.ins().postUseDanSuccess,this.update),this.observe(WingCT.ins().postWingUpgrade,this.update),this.addTouchEvent(this,this.onTouch),this.update()},e.prototype.update=function(){var t=SubRoles.ins().getSubRoleByIndex(this._curRole),e=GlobalConfig.WingLevelConfig[t.wingsData.lv];this.wingName.text=e.name,this.zizhiLv.text=t.wingsData.aptitudeDan+"级",this.career.text=Role.getJobNameByJob(t.job);var i=ExpansionCardCT.ins().useDanData,n=i&&i[5]?i[5].addNum:0,s=e.attrPill+n;if(t.wingsData.aptitudeDan>=s)this.currentState="maxLv";else{var o=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),a=o?o.count:0;a?this.currentState="normal":this.currentState="noitem"}this.updateAttrs()},e.prototype.updateAttrs=function(){for(var t,e=SubRoles.ins().getSubRoleByIndex(this._curRole),i=GlobalConfig.WingCommonConfig.attrPill,n=i.length,s=[],o=1;4>=o;o++)this["attr"+o].text="",this["attr"+o+"NextLv"].text="",n>=o&&(t=i[o-1],this["attr"+o].text=AttributeData.getAttrStrByType(t.type)+": +"+t.value*e.wingsData.aptitudeDan,s.push(new AttributeData(t.type,t.value*e.wingsData.aptitudeDan)),"normal"==this.currentState&&(this["attr"+o+"NextLv"].text="+"+i[o-1].value*(e.wingsData.aptitudeDan+1)));this.powerPanel.setPower(BagCT.getAttrPower(s))},e.prototype.itemChange=function(){if("maxLv"!=this.currentState){var t,e=BagCT.ins().getBagItemById(GlobalConfig.WingCommonConfig.attrPillId),i=e?e.count:0;i?(t="normal"!=this.currentState,this.currentState="normal"):(t="noitem"!=this.currentState,this.currentState="noitem"),t&&this.updateAttrs()}},e.prototype.onTouch=function(t){switch(t.target){case this.bgClose:ViewManager.ins().close(this);break;case this.updateBtn:WingCT.ins().sendUseDan(this._curRole,0)}},e}(BaseEuiView);__reflect(WingZizhiTipsWin.prototype,"WingZizhiTipsWin"),ViewManager.ins().reg(WingZizhiTipsWin,LayerManager.UI_Main),window.WingZizhiTipsWin=WingZizhiTipsWin;var WushuangEquipCT=function(t){function e(){var e=t.call(this)||this;return e.data={},e.sysId=PackageID.Equip,e.regNetMsg(21,e.initData),e.regNetMsg(22,e.updateData),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initData=function(t){for(var e=t.readUnsignedByte(),i=0;e>i;i++){var n=t.readUnsignedByte(),s=t.readUnsignedByte();this.data[n]=this.data[n]||[];for(var o=0;s>o;o++){var a=t.readUnsignedByte();this.data[n][a]=t.readInts(2)}}},e.prototype.updateData=function(t){var e=t.readUnsignedByte(),i=t.readUnsignedByte();return this.data[e][i]=t.readInts(2),i},e.prototype.sendEquip=function(t,e,i){var n=this.getBytes(21);n.writeDouble(t),n.writeByte(e),n.writeByte(i),this.sendToServer(n)},e.prototype.sendStage=function(t,e){var i=this.getBytes(23);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.isOpen=function(t){var e=GlobalConfig.PeerlessBaseConfig,i=e.openzhuanshenglv,n=e.openserverday;return GameServer.serverOpenDay+1<n?(t&&TipsCT.ins().showTips("开服"+n+"天开启"),!1):ZsCT.ins().lv<i?(t&&TipsCT.ins().showTips(i+"转开启"),!1):!0},e.getStage=function(t){var e=GlobalConfig.PeerlessEquipConfig;for(var i in e)if(t in e[i])return e[i][t].stage;return 0},e.getPos=function(t){var e=GlobalConfig.PeerlessEquipConfig;for(var i in e)if(t in e[i])return+i;return-1},e.getTz=function(t){var e=GlobalConfig.PeerlessBaseConfig.suit;for(var i in e)if(~e[i].indexOf(t))return+i+1;return 0},e.getPosName=function(t){if("number"==typeof t)return WushuangTypeName["_"+t];var e=[];for(var i in t)e.push(WushuangTypeName["_"+t[i]]);return e},e.getTzPosAll=function(t){var e=GlobalConfig.PeerlessBaseConfig.suit;return e[t-1]},e.getTzPosAllName=function(t,i,n){var s=e.getTzPosAll,o=e.getStage,a=e.getPosName,r=a(s(t));if(i){for(var l=s(t),h={},u=0,p=l;u<p.length;u++){var c=p[u],d=i[c]?o(i[c][0]):0;d>=n&&(h[c]=!0)}for(var c in h){var g=l.indexOf(+c);r[g]='<font color="0x00ff00">'+r[g]+"</font>"}}return r},e.getWushuangItemAtt=function(t,i){var n=e.getTz,s=e.getPos,o=s(t),a=n(o),r=AttributeFormat.FORMAT_1();r.wordColor=null,r.attrColor=null;var l=GlobalConfig.PeerlessSuitConfig,h=ItemUtil.getBaseAttrData(GlobalConfig.ItemConfig[t]),u=AttributeData.getAttStr1(h,r);if(i){var p=u.split("\n"),c=l[a][i].rate,d=void 0;for(var g in c)c[g][0]==o&&(d=c[g][1]);for(var f in p)p[f]+="		+"+h[f].value*(d/1e4);u=p.join("\n")}return u},e.getTzAttrStr=function(t,e){for(var i=[],n=GlobalConfig.PeerlessSuitConfig[t][e].rate,s=0,o=n;s<o.length;s++){var a=o[s],r=a[0],l=a[1],h="无双"+WushuangTypeName["_"+r];h=h.replace("(右)",""),h=h.replace("(左)",""),h+="属性+"+l/100+"%",~i.indexOf(h)||i.push(h)}return i},e.getTzSkill=function(t,e){return GlobalConfig.SkillsConfig[GlobalConfig.PeerlessSuitConfig[t][e].skill]},e.getTzLevel=function(t,i){for(var n=e.getTzPosAll,s=e.getStage,o=n(t),a=Number.MAX_VALUE,r=0,l=o;r<l.length;r++){var h=l[r],u=i[h]?s(i[h][0]):0;a=Math.min(a,u)}return a},e.getTzLevelCount=function(t,i,n){for(var s=e.getTzPosAll,o=e.getStage,a=s(t),r=0,l=0,h=a;l<h.length;l++){var u=h[l],p=i[u]?o(i[u][0]):0;p>=n&&r++}return r},__decorate([post()],e.prototype,"initData",null),__decorate([post()],e.prototype,"updateData",null),e}(BaseSystem);__reflect(WushuangEquipCT.prototype,"WushuangEquipCT"),System.WushuangEquipCT=function(){return WushuangEquipCT.ins()},window.WushuangEquipCT=WushuangEquipCT;var WushuangRP=function(t){function e(){var e=t.call(this)||this;e.erps=[];var i=WushuangEquipCT.ins(),n=i.initData,s=i.updateData,o=BagCT.ins(),a=o.postItemAdd,r=o.postItemDel,l=o.postItemCountChange;return e.associated(e.updateRed,n,s,a,r,l),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.updateRed=function(){var t=WushuangEquipCT.ins().data,e=GlobalConfig.PeerlessBaseConfig.initequip;for(var i in t){var n=t[i];this.erps[i]=this.erps[i]||[];for(var s in n)if(n[s][0]){var o=GlobalConfig.PeerlessStageConfig[n[s][0]];if(!o){this.erps[i][s]=!1;continue}var a=o.consume[0],r=BagCT.ins().getBagItemCount(BagCT.BAG_TYPE_OTHTER,a.id);this.erps[i][s]=r>=a.count}else{var l=BagCT.ins().getBagItemById(e[s]);this.erps[i][s]=!!l}}},e.prototype.getRoleRp=function(t){if(void 0===t&&(t=-1),t>-1)return!!~this.erps[t].indexOf(!0);for(var e in this.erps)if(~this.erps[e].indexOf(!0))return!0;return!1},__decorate([post()],e.prototype,"updateRed",null),e}(BaseSystem);__reflect(WushuangRP.prototype,"WushuangRP"),System.WushuangRP=function(){return WushuangRP.ins()},window.WushuangRP=WushuangRP;var WushuangTypeName;!function(t){t._0="武器",t._1="衣服",t._2="头盔",t._3="腰带",t._4="鞋子",t._5="项链",t._6="戒指(左)",t._7="戒指(右)",t._8="护手(左)",t._9="护手(右)",t._10="手镯(左)",t._11="手镯(右)"}(WushuangTypeName||(WushuangTypeName={}));var WushuangEquipPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.items=[],e}return __extends(e,t),e.prototype.skinComplete=function(){for(var t=this,e=0;;){var i=this["eItem"+e];if(!i)break;this.items.push(i),this.addTouchEvent(this.items[e],function(e){var i=t.items.indexOf(e.currentTarget),n=GlobalConfig.PeerlessBaseConfig.initequip;if(WushuangEquipCT.ins().data[t.curRole][i][0])return void ViewManager.ins().open(WushuangEquipTips,WushuangEquipCT.ins().data[t.curRole],i,t.curRole);var s=BagCT.ins().getBagItemById(n[i]);s?WushuangEquipCT.ins().sendEquip(s.handle,t.curRole,i):ViewManager.ins().open(ShopGoodsWarn).setData(n[i])}),e++}this.setRoleId(this.curRole),this.addTouchEvent(this.eBtn0,this.openSuit),this.addTouchEvent(this.eBtn1,this.openSuit),this.addTouchEvent(this.eBtn2,this.openSuit)},e.prototype.openSuit=function(t){ViewManager.ins().open(WushuangEquipSuit,WushuangEquipCT.ins().data[this.curRole],+t.currentTarget.name)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(WushuangEquipCT.ins().updateData,this.update),this.observe(WushuangRP.ins().updateRed,this.updateAllRp)},e.prototype.updateMc=function(t){for(var e=WushuangEquipCT.getStage(WushuangEquipCT.ins().data[this.curRole][t][0]),i=0;i<this.items[t].numChildren;i++)i&&(this.items[t].getChildAt(i).visible=!!e);var n=this["eff"+t];if(e){if(!n.numChildren){var s=new MovieClip;s.playFile(RES_DIR_EFF+n.name,-1),n.addChild(s),s=new MovieClip,s.playFile(RES_DIR_EFF+"zhizuneff",-1),n.addChild(s)}}else n.removeChildren();this.items[t].eJs.text=e?e:"",this.updateRp(t)},e.prototype.updateAllRp=function(){for(var t in this.items)this.updateRp(+t)},e.prototype.updateRp=function(t){if(this.items&&this.items[t]){var e=WushuangRP.ins().erps;this.items[t].eRP.visible=e[this.curRole][t]}},e.prototype.update=function(t){this.updateMc(t)},e.prototype.setRoleId=function(t){if(this.curRole=t,this.skin)for(var e in this.items)this.update(+e)},e}(BaseView);__reflect(WushuangEquipPanel.prototype,"WushuangEquipPanel"),window.WushuangEquipPanel=WushuangEquipPanel;var WushuangEquipSuit=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WushuangEquipSuitSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.addTouchEvent(this.eClose,function(){return ViewManager.ins().close(t)})},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ids=t[0],this.tz=t[1],this.currentState=this.tz+"";for(var i=WushuangEquipCT.getTzPosAll,n=WushuangEquipCT.getStage,s=WushuangEquipCT.getTzPosAllName,o=WushuangEquipCT.getTzAttrStr,a=WushuangEquipCT.getTzSkill,r=WushuangEquipCT.getTzLevelCount,l=WushuangEquipCT.getTzLevel,h=i(this.tz),u=0,p=h;u<p.length;u++){var c=p[u],d=this["eItem"+c];if(d.alpha=this.ids[c][0]?1:0,d.alpha){var g=this["eff"+c],f=new MovieClip;f.playFile(RES_DIR_EFF+g.name,-1),g.addChild(f),f=new MovieClip,f.playFile(RES_DIR_EFF+"zhizuneff",-1),g.addChild(f)}var v=n(this.ids[c][0]);d.eJs.text=v?v:""}var y=l(this.tz,this.ids)||1;this.eJs.text=""+y;var m=s(this.tz,this.ids,y);this.eTzPos.textFlow=(new egret.HtmlTextParser).parse(m.join(","));var T=r(this.tz,this.ids,y),C=GlobalConfig.PeerlessBaseConfig.rateNeed,b=C[this.tz-1],I=T>=b;this.eTzAttr.text=o(this.tz,y).join("\n"),I?(this.eTzAttr.textColor=3342080,this.eTzStage.textColor=3532333,this.eTzStage.text="（"+b+"/"+b+"）"):this.eTzStage.text="（"+T+"/"+b+"）";var w=T>=m.length;this.eTzSkill.text="（"+T+"/"+m.length+"）";var S=a(this.tz,y);if(this.eTzSkillDesc.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(S)),w&&(this.eTzSkill.textColor=this.eTzSkillDesc.textColor=15054355),GlobalConfig.PeerlessSuitConfig[this.tz][y+1]){this.eJs1.text=""+(y+1);var _=s(this.tz,this.ids,y+1);this.eTzPos1.textFlow=(new egret.HtmlTextParser).parse(_.join(","));var B=r(this.tz,this.ids,y+1);this.eTzStage1.text="（"+B+"/"+_.length+"）",this.eTzSkill1.text="（"+B+"/"+_.length+"）",this.eTzAttr1.text=o(this.tz,y+1).join("\n");var D=a(this.tz,y+1);this.eTzSkillDesc1.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(D))}else DisplayUtils.removeFromParent(this.eNext)},e}(BaseEuiView);__reflect(WushuangEquipSuit.prototype,"WushuangEquipSuit"),ViewManager.ins().reg(WushuangEquipSuit,LayerManager.UI_Popup),window.WushuangEquipSuit=WushuangEquipSuit;var WushuangEquipTips=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WushuangEquipTipsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){var t=this;this.addTouchEvent(this.eClose,function(){return ViewManager.ins().close(t)}),this.addTouchEvent(this.eBtn,function(){return WushuangEquipCT.ins().sendStage(t.roleIndex,t.pos)});var e=new MovieClip;e.playFile(RES_DIR_EFF+"zhizuneff",-1),this.eGroup.addChild(e)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.ids=t[0],this.pos=t[1],this.currentState=this.pos+"",this.roleIndex=t[2],this.update(),this.observe(WushuangEquipCT.ins().updateData,this.update)},e.prototype.update=function(){var t=this.ids[this.pos][0];this.itemCfg=GlobalConfig.ItemConfig[t];var e=WushuangEquipCT.getStage,i=WushuangEquipCT.getTz,n=WushuangEquipCT.getTzPosAllName,s=WushuangEquipCT.getTzLevel,o=WushuangEquipCT.getTzLevelCount,a=WushuangEquipCT.getWushuangItemAtt,r=WushuangEquipCT.getTzAttrStr,l=WushuangEquipCT.getTzSkill;this.jieshu=e(t),this.eJs.text=this.jieshu+"",this.tz=i(this.pos),this.eName.text=this.itemCfg.name,this.eZs.text=this.itemCfg.zsLevel+"转",this.ePow.setPower(this.ids[this.pos][1]);var h=n(this.tz,this.ids,this.jieshu);this.eTzPos.textFlow=(new egret.HtmlTextParser).parse(h.join(",")),this.eAttr.textFlow=(new egret.HtmlTextParser).parse(a(t,s(this.tz,this.ids)));var u=o(this.tz,this.ids,this.jieshu),p=GlobalConfig.PeerlessBaseConfig.rateNeed,c=p[this.tz-1],d=u>=c;this.eTzAttr.text=r(this.tz,this.jieshu).join("\n"),d?(this.eTzAttr.textColor=3342080,this.eTzStage.textColor=3532333,this.eTzStage.text="（"+c+"/"+c+"）"):this.eTzStage.text="（"+u+"/"+c+"）";var g=u>=h.length;this.eTzSkill.text="（"+u+"/"+h.length+"）";var f=l(this.tz,this.jieshu);if(this.eTzSkillDesc.textFlow=TextFlowMaker.generateTextFlow(SkillUtil.getDesc(f)),g&&(this.eTzSkill.textColor=this.eTzSkillDesc.textColor=15054355),this.eUpgrade.visible=!isNaN(this.roleIndex),this.eUpgrade.visible){var v=GlobalConfig.PeerlessStageConfig[t];if(!v)return void(this.eUpgrade.visible=!1);var y=v.consume[0],m=BagCT.ins().getBagItemCount(BagCT.BAG_TYPE_OTHTER,y.id);this.eNeed.text=m+"/"+y.count,this.eRP.visible=m>=y.count}},e}(BaseEuiView);__reflect(WushuangEquipTips.prototype,"WushuangEquipTips"),ViewManager.ins().reg(WushuangEquipTips,LayerManager.UI_Popup),window.WushuangEquipTips=WushuangEquipTips;var GuanZhuCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.pfActivity,e.regNetMsg(13,e.guanzhuInfo),window.platform.onShow(e.updateOptions),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.updateOptions=function(t){},e.prototype.sendGetGuanZhu=function(){this.sendBaseProto(13)},e.prototype.guanzhuInfo=function(t){this.getGZ=2==t.readInt()},__decorate([post()],e.prototype,"updateOptions",null),__decorate([post()],e.prototype,"guanzhuInfo",null),e}(BaseSystem);__reflect(GuanZhuCT.prototype,"GuanZhuCT"),System.GuanZhuCT=function(){return GuanZhuCT.ins()},window.GuanZhuCT=GuanZhuCT;var ShareCT=function(t){function e(){var e=t.call(this)||this;return e.dayCount=0,e.firstGet=0,e.dayGet=0,e.cdTime=0,e.dayIndex=0,e.totalShare=[],e.friends=[],e.sysId=PackageID.pfActivity,e.regNetMsg(6,e.shareInfo),e.regNetMsg(10,e.shareTotal),e.regNetMsg(14,e.friendsLv),e.regNetMsg(24,e.doSubscribe),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){if(platform.options){var t=platform.options();if(t&&t.query&&t.query.actorId){console.log("options.query:"+t.query);var e=t.query;if(urlParam.isnew){var i=SubRoles.ins().getSubRoleByIndex(0),n="?actorid="+Actor.actorID+"&serverid="+urlParam.srvid+"&openId="+urlParam.openId;n+="&iactorid="+e.actorId+"&iserverid="+e.srvId+"&iopenId="+e.openId+"&param="+Actor.actorID+"_"+Actor.myName+"_"+(i?i.sex:0)+"_"+(i?i.job:0),Http.get(urlParam.reportRoot+"back/actor/invite"+n)}var s={actorid:Actor.actorID,serverid:urlParam.srvid,openId:urlParam.openId,iactorid:e.actorId,iserverid:e.srvId,iopenId:e.openId};Http.post(urlParam.reportRoot+"back/actor/invite/log",s)}}},e.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return window.platform.share({withShareTicket:!0,success:function(e){return e.shareTickets?(TipsCT.ins().showCenterTips("分享成功"),void t.sendShareSuc()):void TipsCT.ins().showCenterTips("必须分享到群")},fail:function(){TipsCT.ins().showCenterTips("分享失败")}}),[2]})})},e.prototype.sendGetFirst=function(){this.sendBaseProto(7)},e.prototype.sendShareSuc=function(){this.sendBaseProto(8)},e.prototype.sendGetDay=function(){this.sendBaseProto(9)},e.prototype.shareInfo=function(t){e=t.readInts(5),this.dayCount=e[0],this.dayGet=e[1],this.firstGet=e[2],this.cdTime=e[3],this.dayIndex=e[4],this.cdTime=DateUtils.formatMiniDateTime(this.cdTime);var e},e.prototype.shareTotal=function(t){for(var e=t.readInt(),i=0;e>i;i++){var n=t.readInt();this.totalShare[n]=[n,t.readInt(),t.readInt()]}},e.prototype.sendGetTotal=function(t){var e=this.getBytes(11);e.writeInt(t),this.sendToServer(e)},e.prototype.friendsLv=function(t){this.friends.length=0;for(var e=t.readInt(),i=0;e>i;i++)this.friends.push(new ShareLvData(t))},e.prototype.sendGetFriends=function(t){var e=this.getBytes(15);e.writeInt(t),this.sendToServer(e)},e.prototype.doSubscribe=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return this.subReward=t.readByte(),e=this,[4,this.checkCanOpen()];case 1:return e.subscribeOpen=i.sent(),this.postSubscribe(),[2]}})})},e.prototype.postSubscribe=function(){},e.prototype.checkCanOpen=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return window.platform.getKeepSubscribe?[4,window.platform.getKeepSubscribe(GlobalConfig.WeiXiGuanZhuConst.subscribeID)]:[2,!1];case 1:return t=e.sent(),[2,t[0]]}})})},e.prototype.sendSubscribe=function(){this.sendBaseProto(23)},__decorate([post()],e.prototype,"shareInfo",null),__decorate([post()],e.prototype,"shareTotal",null),__decorate([post()],e.prototype,"friendsLv",null),__decorate([post()],e.prototype,"postSubscribe",null),e}(BaseSystem);__reflect(ShareCT.prototype,"ShareCT"),System.ShareCT=function(){return ShareCT.ins()},window.ShareCT=ShareCT;var wxgameCT=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.init=!1,e.advBtn=new eui.Image,e}return __extends(e,t),e.prototype.initLogin=function(){var t=this;if(!this.init&&3==+urlParam.apptype&&urlParam.isMiniGame){var e=window.h5gamecn;if(e.gankshareData){this.init=!0,console.warn("fchid "+e.gankshareData.fchid),1967==e.gankshareData.fchid&&(e.getRandAd(function(e){return t.showPlayAd(e)}),this.advBtn.scaleY=this.advBtn.scaleX=.5,this.advBtn.addEventListener(egret.Event.COMPLETE,this.advCom,this),this.advBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.advTou,this));var i=new gank.cross.VIPSDK;i.x=0,i.y=0,egret.MainContext.instance.stage.addChild(i),i.init({gameId:382,openId:e.login0Param.uid,userId:e.login0Param.uid,adsId:382,gameVersion:1,vip:Actor.vip,chid:e.gankshareData.fchid,sid:GameServer.serverID,nickname:Actor.myName,level:Actor.level})}}},e.prototype.advCom=function(){this.advBtn.anchorOffsetX=this.advBtn.width/2,this.advBtn.anchorOffsetY=this.advBtn.height/2;var t=StageUtils.ins().getStage();this.advBtn.x=t.stageWidth-this.advBtn.anchorOffsetX*this.advBtn.scaleX-20,this.advBtn.y=150},e.prototype.advTou=function(){var t=this,e=window.h5gamecn;e.navigateToMiniProgram({},function(e){return t.showPlayAd(e)})},e.prototype.playAdEffect=function(t,e,i,n){void 0===e&&(e=25),void 0===i&&(i=150),void 0===n&&(n=4e3),egret.Tween.get(t,{loop:!0}).wait(n).to({rotation:-1*e},i/2).to({rotation:e},i).to({rotation:-1*(.8*e)},.8*i).to({rotation:.8*e},.8*i).to({rotation:0},.8*i/2)},e.prototype.setImg=function(){this._adIdx++,this._adIdx>=this._adList.length&&(this._adIdx=0),this.advBtn.source=this._adList[this._adIdx]},e.prototype.removeAdvEffect=function(){this.advBtn.visible=!1,this.advBtn.rotation=0,egret.Tween.removeTweens(this.advBtn),DisplayUtils.removeFromParent(this.advBtn)},e.prototype.showPlayAd=function(t){if(this.removeAdvEffect(),!t)return void DisplayUtils.removeFromParent(this.advBtn);if(1==t.type)this.advBtn.source=t.data,this.playAdEffect(this.advBtn);else if(2==t.type){this.advBtn.visible=!0,this._adList=t.data.imglist;var e=t.data.intervals;this.advBtn.source=this._adList[0],this._adIdx=0,egret.Tween.get(this.advBtn,{loop:!0}).call(this.setImg,this).wait(e)}var i=ViewManager.ins().getView(PlayFunView);i&&i.addChild(this.advBtn)},e}(BaseSystem);__reflect(wxgameCT.prototype,"wxgameCT"),System.wxgameCT=function(){return wxgameCT.ins()},window.wxgameCT=wxgameCT;var WxGameGuanZhuRule=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.updateMessage=[],n.showMessage=[GuanZhuCT.ins().guanzhuInfo],n}return __extends(e,t),e.prototype.checkShowIcon=function(){return GuanZhuCT.ins().getGZ?!1:OpenSystem.ins().checkSysOpen(SystemType.WXGAMEGUANZHU)},e.prototype.checkShowRedPoint=function(){return 1},e.prototype.tapExecute=function(){ViewManager.ins().open(WxGameGuanZhuWin)},e}(RuleIconBase);__reflect(WxGameGuanZhuRule.prototype,"WxGameGuanZhuRule"),window.WxGameGuanZhuRule=WxGameGuanZhuRule;var WxGameGuanZhuWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WxGameGuanZhuSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.eGet,function(){GuanZhuCT.ins().sendGetGuanZhu()}),this.updateBtn()},e.prototype.addDisplay=function(){this.observe(GuanZhuCT.ins().updateOptions,this.updateBtn)},e.prototype.updateBtn=function(){var t=GuanZhuCT.ins().getGZ,e=window.platform.options;this.eGet.enabled=e&&1104==e.scene&&!t},e}(BaseEuiView);__reflect(WxGameGuanZhuWin.prototype,"WxGameGuanZhuWin"),ViewManager.ins().reg(WxGameGuanZhuWin,LayerManager.UI_Main),window.WxGameGuanZhuWin=WxGameGuanZhuWin;var ShareLvData=function(){function t(t){this.id=t.readInt(),this.roleName=t.readString(),e=t.readInts(3),this.sex=e[0],this.job=e[1],this.state=e[2];var e}return t}();__reflect(ShareLvData.prototype,"ShareLvData"),window.ShareLvData=ShareLvData;var WxGameItem1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.addTouchEvent(this.eBtn,this.onTap)},e.prototype.onTap=function(){ShareCT.ins().sendGetTotal(this.data.id)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.skin&&this.data){var t=ShareCT.ins().totalShare,e=this.data,i=e.id,n=e.type,s=e.target,o=e.param,a=e.awardList,r=t[i],l=(r[0],r[1]),h=r[2];1==n?this.eTxt.text="通过分享进入的好友人数("+l+"/"+s+")":this.eTxt.text="进入游戏的好友达到"+o+"级("+l+"/"+s+")",h?this.eBtn.label=(1==h?"可":"已")+"领取":this.eBtn.label="未完成",this.eBtn.enabled=1==h,this.eL.dataProvider=new eui.ArrayCollection(a)}},e}(BaseItemRender);__reflect(WxGameItem1.prototype,"WxGameItem1"),window.WxGameItem1=WxGameItem1;var WxGameItem2=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){this.addTouchEvent(this.eBtn,this.onTap)},e.prototype.onTap=function(){ShareCT.ins().sendGetFriends(this.data.id)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.dataChanged()},e.prototype.dataChanged=function(){if(this.skin&&this.data){var t=ShareCT.ins().friends;if(t[this.itemIndex]){var e=t[this.itemIndex].state;this.eL.dataProvider=new eui.ArrayCollection(this.data.awardList),this.eTxt.text="第"+(this.itemIndex+1)+"位好友",e?this.eBtn.label=(1==e?"可":"已")+"领取":this.eBtn.label="未完成",this.eBtn.enabled=1==e,this.eHead.data=t[this.itemIndex]}}},e}(BaseItemRender);__reflect(WxGameItem2.prototype,"WxGameItem2"),window.WxGameItem2=WxGameItem2;var WxGameShare1=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addDisplay=function(){this.observe(ShareCT.ins().shareInfo,this.update),this.update()},e.prototype.removeDisplay=function(){},e.prototype.skinComplete=function(){this.addTouchEvent(this.eFx,this.onTap),this.eList.dataProvider=new eui.ArrayCollection(GlobalConfig.ShareBaseConfig.firstAwards)},e.prototype.update=function(){var t=ShareCT.ins().firstGet;t&&(this.eFx.label=(1==t?"点击":"已")+"领取"),this.eFx.enabled=2!=t},e.prototype.onTap=function(){var t=ShareCT.ins().firstGet;return t?void(1==t&&ShareCT.ins().sendGetFirst()):void ShareCT.ins().share()},e}(BaseView);__reflect(WxGameShare1.prototype,"WxGameShare1"),window.WxGameShare1=WxGameShare1;var WxGameShare2=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastTime=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.eFx,this.share),this.addTouchEvent(this.eGet,this.getDay)},e.prototype.addDisplay=function(){this.observe(ShareCT.ins().shareInfo,this.updateInfo),this.observe(ShareCT.ins().shareTotal,this.updateList),this.observe(ShareCT.ins().friendsLv,this.updateList),this.updateList(),this.updateInfo()},e.prototype.enterFrame=function(){var t=egret.getTimer();t-this.lastTime>1e3&&(this.updateTimer(),this.lastTime=t)},e.prototype.updateInfo=function(){var t=ShareCT.ins(),e=t.dayCount,i=t.dayGet,n=t.dayIndex,s=GlobalConfig.ShareBaseConfig.shareNum;this.eL.dataProvider=new eui.ArrayCollection(GlobalConfig.dailyShareRewardConfig[n].awardList),this.eFxL.text="分享次数("+e+"/"+s+")",this.eGet.visible=e>=s,this.eFxL.visible=!this.eGet.visible,this.eGet.label=(1==i?"可":"已")+"领取",this.eGet.enabled=1==i,3==i&&(DisplayUtils.removeFromParent(this.eL),DisplayUtils.removeFromParent(this.eGet),this.eFxL.text="每日分享奖励已达到上限",this.eFxL.right=null,this.eFxL.horizontalCenter=0)},e.prototype.updateList=function(){var t="lj"==this.currentState?GlobalConfig.AddUpShareConfig:GlobalConfig.ShareFriendsLevelRewardConfig,e=[];for(var i in t)e.push(t[i]);this.eList.dataProvider=new eui.ArrayCollection(e)},e.prototype.updateTimer=function(){var t=ShareCT.ins().cdTime,e=t-GameServer.serverTime;e/=1e3,this.eFx.label=e>=0?DateUtils.getFormatBySecond(e,DateUtils.TIME_FORMAT_3):"立即分享",this.eFx.enabled=0>e
},e.prototype.share=function(){ShareCT.ins().share()},e.prototype.getDay=function(){ShareCT.ins().sendGetDay()},e}(BaseView);__reflect(WxGameShare2.prototype,"WxGameShare2"),window.WxGameShare2=WxGameShare2;var WxGameShareRule=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.updateMessage=[ShareCT.ins().shareInfo,ShareCT.ins().friendsLv],n}return __extends(e,t),e.prototype.checkShowIcon=function(){return OpenSystem.ins().checkSysOpen(SystemType.WXGAMESHARE)},e.prototype.checkShowRedPoint=function(){var t=1==ShareCT.ins().firstGet||1==ShareCT.ins().dayGet;if(t)return 1;var e=ShareCT.ins().friends;for(var i in e)if(1==e[i].state)return 1;return 0},e.prototype.tapExecute=function(){ViewManager.ins().open(WxGameShareWin)},e}(RuleIconBase);__reflect(WxGameShareRule.prototype,"WxGameShareRule"),window.WxGameShareRule=WxGameShareRule;var WxGameShareWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="WxGameShareSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){2==ShareCT.ins().firstGet&&this.viewStack.removeChildAt(0)},e}(BaseEuiView);__reflect(WxGameShareWin.prototype,"WxGameShareWin"),ViewManager.ins().reg(WxGameShareWin,LayerManager.UI_Main),window.WxGameShareWin=WxGameShareWin;var XinshouCT=function(t){function e(){var e=t.call(this)||this;return e.observe(TaskCT.ins().postUpdteTaskTrace,function(){if(!(KFServerSys.ins().isKFServ||FbCT.ins().guanqiaID<1e5)){var t=TaskCT.ins().taskTrace,i=TaskCT.ins().getAchieveConfById(t.id),n=EntityManager.ins(),s=ViewManager.ins(),o=GameLogic.ins(),a=GameMap.CELL_SIZE,r=FbCT.ins(),l=[109,110,111,112,20,4];if(~l.indexOf(i.type)){var h;if(SubRoles.lookAtTar)h=SubRoles.lookAtTar;else for(var u=SubRoles.ins().subRolesLen,p=void 0,c=EntityManager.ins(),d=0;u>d;d++)if(p=c.getJobMainRole(d),p&&p.getHP()>0&&p.visible){h=p;break}if(7==i.control&&0==t.state){var g=i.controlTarget[i.controlTarget.length-2],f=i.controlTarget[i.controlTarget.length-1];if(f>=0)for(var v=n.getEntityByMonsterId(r.waveMonsterId[f]),y=0,m=v;y<m.length;y++){var T=m[y];n.removeByHandle(T.infoModel.handle)}g>=0&&o.createGuanqiaMonster(!0,!1,[g,g+1])}if(i.type==RoleAI.SEND_TASK_TYPE2){var C=i.controlTarget,b=C[0],I=C[1];switch(t.state){case 0:MoveCC.ins().myMoveTo(b*a,I*a,function(){RoleAI.ins().add(h)});break;case 1:RoleAI.ins().remove(h);var w=function(){TaskCT.ins().sendGetAchieve(t.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(t)};if(i.awardList){for(var S=0,_=i.awardList;S<_.length;S++){var T=_[S];T.job==h.infoModel.job&&Encounter.ins().postCreateDrop(Math.floor(h.x/64),Math.floor(h.y/64),T)}DropHelp.addCompleteFunc(w,e),DropHelp.start(h)}else w()}}if(109==i.type)switch(t.state){case 1:RoleAI.ins().remove(h);var B=i.controlTarget,b=B[0],I=B[1];MoveCC.ins().myMoveTo(b*a,I*a,function(){s.open(TaskAlertWin)})}if(111==i.type)switch(t.state){case 1:var D=i.controlTarget,b=D[0],I=D[1];RoleAI.ins().remove(h),GameLogic.ins().addOutEff(b*a,I*a),MoveCC.ins().myMoveTo(b*a,I*a,function(){TaskCT.ins().sendGetAchieve(t.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(t)})}if(20==i.type||4==i.type)switch(t.state){case 1:TaskCT.ins().sendGetAchieve(t.achievementId),TaskCT.ins().postParabolicItem(),Hint.ins().postAchievementAft(t)}}}}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e}(BaseSystem);__reflect(XinshouCT.prototype,"XinshouCT"),System.XinshouCT=function(){return XinshouCT.ins()},window.XinshouCT=XinshouCT;var XuanWuCT=function(t){function e(){var e=t.call(this)||this;return e.bossInfo=[],e.bossPlayList=[],e.lastXuanWu=!1,e._destroyTime=0,e.sysId=PackageID.KFBoss,e.regNetMsg(14,e.postInfo),e.regNetMsg(15,e.postBossInfo),e.regNetMsg(16,e.postRevive),e.regNetMsg(17,e.postAscriptionChange),e.regNetMsg(18,e.setShieldPer),e.regNetMsg(19,e.postBossChallengeResult),e.regNetMsg(23,e.postBossDestroyTime),e.observe(GameLogic.ins().postCreateOtherEntity,e.onCreateEntity),e.observe(GameLogic.ins().postEnterMap,function(){e.isXuanWu?e.postEnterXuanWu():e.lastXuanWu&&e.postQuiXuanWu()}),e}return __extends(e,t),e.prototype.postEnterXuanWu=function(){this.lastXuanWu=!0,ViewManager.ins().close(XuanWuBossPanel),ViewManager.ins().close(BossWin),ViewManager.ins().open(KFBossSceneWin),this.showView(!0)},e.prototype.postQuiXuanWu=function(){this.showView(!1),ViewManager.ins().close(KFBossSceneWin),this._destroyTime=0,this.lastXuanWu=!1},e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"isXuanWu",{get:function(){return GameMap.fbType==FbCT.FB_TYPE_XUANWU},enumerable:!0,configurable:!0}),e.prototype.postInfo=function(t){this.bossLeftTime=t.readShort(),this.enterCD=t.readShort()},e.prototype.postBossInfo=function(t){for(var e=t.readShort(),i=0;e>i;i++){var n=void 0,s=t.readShort(),o=GlobalConfig.XuanWuBossConfig[s];this.bossInfo[i]||(this.bossInfo[i]=new WorldBossItemData,this.bossInfo[i].bossType=BossCT.BOSS_SUBTYPE_XUANWUBOSS),n=this.bossInfo[i],n.id=s;t.readInt();n.relieveTime=1e3*t.readInt()+egret.getTimer();var a=n.bossState;if(n.bossState=t.readShort(),2==a&&1==n.bossState&&YuanshenData.ins().isInTheRange(o.lianjiLv)){var r=GlobalConfig.MonstersConfig[o.bossId],l="|C:0xfee900&T:玄武殿BOSS||C:0xfe4444&T:"+r.name+"||C:0xfee900&T:出现在||C:0x16b2ff&T:玄武殿BOSS！|";ChatCT.ins().postSysChatMsg(new ChatSystemData(3,l)),BossCT.ins().postBossData(!0,r.name,BossCT.BOSS_SUBTYPE_XUANWUBOSS)}}this.updateBossPlayList()},e.prototype.postRevive=function(t){var e=t.readInt(),i=t.readDouble();if(e>0)ViewManager.ins().open(KFBossReliveWin,e,i);else if(ViewManager.ins().close(KFBossReliveWin),KFServerSys.ins().isKF){var n=Actor.yb-GlobalConfig.XuanWuBossBase.rebornCost;Actor.ins().postYbChange(n)}},e.prototype.postAscriptionChange=function(t){var e=t.readDouble(),i=t.readDouble(),n="";if(e>0){var s=EntityManager.ins().getMasterList(e);s&&s[0]&&s[0].infoModel&&(n=s[0].infoModel.name)}BossCT.ins().postBelongChange(i,e,n)},e.prototype.setShieldPer=function(t){BossCT.ins().setShieldPer(t)},e.prototype.postBossChallengeResult=function(t){BossCT.ins().doBossChallengeResult(t)},e.prototype.sendClearReliveCD=function(){this.sendBaseProto(20)},e.prototype.sendGetAward=function(){this.sendBaseProto(21)},e.prototype.sendEnter=function(t){var e=this.getBytes(22);e.writeShort(t),this.sendToServer(e)},e.prototype.postBossDestroyTime=function(t){this._destroyTime=DateUtils.formatMiniDateTime(t.readUnsignedInt())-GameServer.serverTime+egret.getTimer()},Object.defineProperty(e.prototype,"destroyTime",{get:function(){return this._destroyTime-egret.getTimer()},enumerable:!0,configurable:!0}),e.prototype.updateBossPlayList=function(){var t=this.bossInfo.slice();this.bossPlayList=[];for(var e,i=0,n=t;i<n.length;i++){var s=n[i];if(s){var o=GlobalConfig.XuanWuBossConfig[s.id];o&&(YuanshenData.ins().isInTheRange(o.lianjiLv)?this.bossPlayList.push(s):YuanshenData.ins().isEnough(o.lianjiLv[0])||(e?e.id>s.id&&(e=s):e=s))}}null!=e&&this.bossPlayList.push(e)},e.prototype.showView=function(t){t?(ViewManager.ins().isShow(BossBelongPanel)||ViewManager.ins().open(BossBelongPanel),ViewManager.ins().isShow(BossBloodPanel)?ViewManager.ins().getView(BossBloodPanel).changeBoss():ViewManager.ins().open(BossBloodPanel)):(ViewManager.ins().close(BossBelongPanel),ViewManager.ins().close(BossBloodPanel),ViewManager.ins().close(TargetListPanel))},e.prototype.getBossShowAward=function(t){var e=GameServer.serverOpenDay+1,i=[];for(var n in t)e>=+n&&(i=t[n].concat());return i},e.prototype.onCreateEntity=function(t){t&&this.isXuanWu&&(t.type!=EntityType.Monster||t.team!=Team.Monster||t.masterHandle||(BossCT.ins().monsterID=t.configID,BossCT.ins().bossHandler=t.handle,this.showView(!0)))},__decorate([post()],e.prototype,"postEnterXuanWu",null),__decorate([post()],e.prototype,"postQuiXuanWu",null),__decorate([post()],e.prototype,"postInfo",null),__decorate([post()],e.prototype,"postBossInfo",null),__decorate([post()],e.prototype,"postRevive",null),__decorate([post()],e.prototype,"postAscriptionChange",null),__decorate([post()],e.prototype,"postBossChallengeResult",null),__decorate([post()],e.prototype,"postBossDestroyTime",null),e}(BaseSystem);__reflect(XuanWuCT.prototype,"XuanWuCT"),System.XuanWuCT=function(){return XuanWuCT.ins()},window.XuanWuCT=XuanWuCT;var XuanWuBossPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="XuanWuBossPanelSkin",e}return __extends(e,t),e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=GlobalConfig.XuanWuBossBase.openDay;return GameServer.serverOpenDay+1<i&&TipsCT.ins().showTips("开服"+i+"天后开启"),XuanWuCT.ins().bossInfo&&0!=XuanWuCT.ins().bossInfo.length?GameServer.serverOpenDay+1>=i:(TipsCT.ins().showTips("暂未开启"),!1)},e.prototype.addDisplay=function(){this.addTouchEvent(this.eCloseRect,this.onClick),this.addTouchEvent(this.challengeBtn,this.onClick),this.remindTpis.addEventListener(egret.TextEvent.LINK,this.onLink,this),this.remindTpis.textFlow=(new egret.HtmlTextParser).parser('<a href="event:"><u>'+this.remindTpis.text+"</u></a>"),this.remindTpis.touchEnabled=!0,this.list.itemRenderer=WorldBossItemMain,this.dropRewardList.itemRenderer=ItemBase,this.dropRewardList0.itemRenderer=ItemBase,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.bossImage=new MovieClip,this.bossImage.scaleX=-1,this.bossImage.scaleY=1,this.bossImage.x=78,this.bossImage.y=165,this.bossGroup.addChild(this.bossImage),this.bossGroup.touchEnabled=this.bossGroup.touchChildren=!1;var t=[],e=BossCT.BOSS_SUBTYPE_XUANWUBOSS;XuanWuCT.ins().updateBossPlayList();var i=XuanWuCT.ins().bossPlayList.slice();i.sort(this.sortList),t.push({type:e,arr:i,selectIndex:0,clickCall:this.onClickList.bind(this)}),this.listData.source=t,this.list.scrollV=0,this.list.selectedIndex=0,this.currData=t[0].arr[0],this.setWin()},e.prototype.sortList=function(t,e){return t.id<e.id?-1:1},e.prototype.removeDisplay=function(){this.remindTpis.removeEventListener(egret.TextEvent.LINK,this.onLink,this)},e.prototype.onClick=function(t){switch(t.target){case this.eCloseRect:ViewManager.ins().close(this);break;case this.challengeBtn:if(!this.currData)return;if(FbCT.ins().checkInFB())return;if(!KfArenaSys.ins().checkIsMatching())return;var e=GlobalConfig.XuanWuBossConfig[this.currData.id];if(!YuanshenData.ins().isInTheRange(e.lianjiLv))return void TipsCT.ins().showTips("元神等级"+YuanshenData.getName(e.lianjiLv[0])+"解锁");if(BagCT.ins().getSurplusCount()<BagCT.BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin,BagCT.BAG_ENOUGH);if(this.currData.isDie)return void TipsCT.ins().showTips("BOSS未复活");if(BagCT.ins().getSurplusCount()<BossCT.WB_BAG_ENOUGH)return void ViewManager.ins().open(BagFullTipsWin,BossCT.WB_BAG_ENOUGH);RexueDideCT.checkEnoughTimeById(RexueID.KuafuBoss,XuanWuCT.ins().bossLeftTime,function(){XuanWuCT.ins().sendEnter(e.id)})}},e.prototype.onLink=function(){ViewManager.ins().open(PubBossRemindWin,BossCT.BOSS_SUBTYPE_XUANWUBOSS)},e.prototype.onClickList=function(t){this.currData=t;for(var e=0;e<this.listData.length;e++){var i=this.listData.getItemAt(e);i.selectIndex=i.arr.indexOf(t)}this.setWin()},e.prototype.setWin=function(){if(this.currData){var t=GlobalConfig.XuanWuBossConfig[this.currData.id],e=GlobalConfig.MonstersConfig[t.bossId];this.nameTxt.text=e.name+"("+YuanshenData.getName(t.lianjiLv[0])+")",2==this.currData.bossState?this.stateImage.source="zdbossyijisha":1==this.currData.bossState?this.stateImage.source="zdbosskejisha":this.stateImage.source="",this.dropRewardList.dataProvider?this.dropRewardList.dataProvider.source=XuanWuCT.ins().getBossShowAward(t.joinRewardshow):this.dropRewardList.dataProvider=new eui.ArrayCollection(XuanWuCT.ins().getBossShowAward(t.joinRewardshow)),this.dropRewardList0.dataProvider?this.dropRewardList0.dataProvider.source=XuanWuCT.ins().getBossShowAward(t.belongRewardshow):this.dropRewardList0.dataProvider=new eui.ArrayCollection(XuanWuCT.ins().getBossShowAward(t.belongRewardshow));var i=XuanWuCT.ins().bossLeftTime;this.leftText.text="挑战获得领奖剩余次数:"+i,this.bossImage.playFile(RES_DIR_MONSTER+(e.avatar+"_3s"),-1)}},e}(BaseEuiView);__reflect(XuanWuBossPanel.prototype,"XuanWuBossPanel"),ViewManager.ins().reg(XuanWuBossPanel,LayerManager.UI_Popup),window.XuanWuBossPanel=XuanWuBossPanel;var YuanshenCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.LianJi,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.onBaseData=function(t){var e=t.readByte();console.log(e)},e.prototype.onDataUpdate=function(t){console.log("Yuanshen update ",t)},e.prototype.doLevelup=function(){this.sendBaseProto(2)},e.prototype.checkRed=function(){var t=this,e=!1;if(!YuanshenData.ins().yuanshenId)return e;if(YuanshenData.ins().skillUnlockData.forEach(function(i,n){i||t.isSkillCanActived(n).can&&(e=!0)}),e)return!0;var i=YuanshenData.ins().exp,n=YuanshenData.ins().yuanshenData[YuanshenData.ins().yuanshenId],s=n&&n.level||0,o=GlobalConfig.LianJiSysUpgradeConf[YuanshenData.ins().yuanshenId][s+1];if(!o)return!1;var a=o.needExp;return i>=a&&!YuanshenData.ins().skillUnlockData.some(function(t){return 0==t})},e.prototype.isSkillCanActived=function(t){var e=YuanshenPanel.lv2zs(GlobalConfig.LianJiSysConf.unLockLvl[t]),i=GlobalConfig.LianJiSysConf.openSkillYb;return Actor.yb<i[t]?{can:!1,reason:"元宝不足"}:!YuanshenData.ins().skillUnlockData[t]&&e.lv<=Actor.level&&e.zs<=ZsCT.ins().lv?{can:!0,reason:""}:{can:!1,reason:"等级不足"}},__decorate([post()],e.prototype,"onDataUpdate",null),e}(BaseSystem);__reflect(YuanshenCT.prototype,"YuanshenCT"),window.YuanshenCT=YuanshenCT;var YuanshenData=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.yuanshenData={},e.skillUnlockData=[],e.lastSkillUnlockData=[],e.yuanShenLv=0,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.parse=function(t){this.yuanshenId=t.readByte();for(var e=t.readByte(),i=0;e>i;i++){var n=new YuanshenItemData;n.id=t.readUnsignedByte(),n.level=t.readUnsignedShort(),this.yuanshenData[n.id]=n}return this.exp=t.readInt(),this.calculateYuanshenLv(),this},e.prototype.calculateYuanshenLv=function(){this.yuanshenData&&this.yuanshenData[11]?this.yuanShenLv=this.yuanshenData[11].level:this.yuanShenLv=1},e.getName=function(t){return GlobalConfig.LianJiSysConf.peiyangNeedName[MathUtils.toInteger((t-1)/4)]},e.prototype.isEnough=function(t){return e.ins().yuanShenLv>=t},e.prototype.isInTheRange=function(t){return e.ins().yuanShenLv>=t[0]&&e.ins().yuanShenLv<=t[1]},e.prototype.parseSkillData=function(t){this.lastSkillUnlockData=this.skillUnlockData,this.skillUnlockData=[];for(var e=t.readByte(),i=0;e>i;i++)this.skillUnlockData[i]=t.readInt()},e.getJingjie=function(t){var i=t||e.ins().yuanshenData[e.ins().yuanshenId]&&e.ins().yuanshenData[e.ins().yuanshenId].level||0,n=Math.ceil(i/YuanshenPanel.JIE_PER_JINGJIE),s=0==i?0:i%YuanshenPanel.JIE_PER_JINGJIE||YuanshenPanel.JIE_PER_JINGJIE;return{jingjie:n,jie:s}},e.getUpgradeTimesByLv=function(t){if(t<=e.ins().yuanShenLv)return 0;var i=e.ins().yuanShenLv;return 1==e.ins().yuanShenLv&&CommonUtils.getObjectLength(e.ins().yuanshenData)<11&&(i=0),11*(t-i)-e.ins().yuanshenId+1},e}(BaseClass);__reflect(YuanshenData.prototype,"YuanshenData"),window.YuanshenData=YuanshenData;var YuanshenItemData=function(){function t(){}return t}();__reflect(YuanshenItemData.prototype,"YuanshenItemData"),window.YuanshenItemData=YuanshenItemData;var YuanshenSkillData=function(){function t(){}return t}();__reflect(YuanshenSkillData.prototype,"YuanshenSkillData"),window.YuanshenSkillData=YuanshenSkillData;var YuanshenPanel=function(t){function e(){var e=t.call(this)||this;return e.animating=!1,e.inited=!1,e.skillDatas=[],e.loopSkillAnim=!0,e.initLianJi=!1,e.initYuanShen=!1,e.name="连击",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addEvent(egret.TouchEvent.TOUCH_TAP,this.eTp,this.onTap)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.eTp:ViewManager.ins().open(YuanshenBreakWin)}},e.prototype.addDisplay=function(){if(this.currentState=this.checkState(),YuanshenData.ins().skillDatas=GlobalConfig.LianJiSysConf.skillsId,this.checkState()==e.STAT_PEIYANG?this.initPeiyang():this.initLianji(),this.checkState()==e.STAT_PEIYANG){var t=GlobalConfig.LianJiSysConf,i=t.LianjiBreakOpenDay,n=t.LianjiBreakZsLevel;this.eTp.visible=GameServer.serverOpenDay+1>=i&&ZsCT.ins().lv>=n,this.inited||(this.initYuanshenPos(),this.inited=!0),Timer.start(100,1,this.updatePeiyangView,this),this.name="元神",this.observe(LianJiCT.ins().onYuanshenData,this.updatePeiyangView)}else this.name="连击",this.updateSkillView();this.observe(LianJiCT.ins().baseInfo,this.doUpdateView),this.observe(LianJiTPRPCT.ins().tpRP,this.refreshTPRP),this.refreshTPRP()},e.prototype.refreshTPRP=function(){this.eTpRed.visible=this.eTp.visible&&LianJiTPRPCT.ins().tp},e.prototype.initPeiyang=function(){var t=this;if(!this.initYuanShen){this.initYuanShen=!0,this.currentYuanshen=YuanshenData.ins().yuanshenId,this.eEquip&&this.addTouchEvent(this.eEquip,this.onClick),this.addTouchEvent(this.levelupBtn,this.doLevelup),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>"),this.addTouchEvent(this.getItemTxt,this.onGetItem),this.observe(SoulSuitRedPoint.ins().postRedPoint,this.checkEquipRed),this.checkEquipRed(),YuanshenData.ins().skillDatas.forEach(function(e,i){t.addTouchEvent(t["skillItem"+i],function(){t.onSkillDetail(t.skillDatas[i]||e,i)})});var e=new MovieClip;e.x=185,this.yuanshen_qian.addChild(e),e.playFile(RES_DIR_EFF+"yuanshen_up",-1);var i=new MovieClip;i.x=185,this.yuanshen_hou.addChild(i),i.playFile(RES_DIR_EFF+"yuanshen_down",-1);for(var n=1;4>=n;n++){var s=new MovieClip;this.backEffGroup.addChild(s),s.visible=n<=YuanshenData.getJingjie().jie,s.playFile(RES_DIR_EFF+"yuanshencircle"+n,-1)}}},e.prototype.checkEquipRed=function(){this.redEquip.visible=SoulSuitRedPoint.ins().redPoint},e.prototype.onClick=function(t){ViewManager.ins().open(SoulSuitEquipWin)},e.prototype.initLianji=function(){var t=this;if(!this.initLianJi){this.initLianJi=!0,this.addTouchEvent(this.activeBtn,this.doActive);for(var e=function(e){i.addTouchEvent(i["lianji_"+e],function(i){t.onSkillTouch(i,e)})},i=this,n=0;4>n;n++)e(n);this.lianjiEff=new MovieClip,this.lianjiStage.addChild(this.lianjiEff),this.lianjiEff.x=this.lianjiStage.width/2,this.lianjiEff.y=this.lianjiStage.height/2}},e.prototype.doUpdateView=function(){this.checkState()==e.STAT_SKILL?this.updateSkillView():this.updatePeiyangSkills()},e.prototype.onSkillDetail=function(t,e){ViewManager.ins().open(YuanshenSkillTipsWin,t,e)},e.prototype.onSkillTouch=function(t,e){this.updateSkillInfo(e),this.doSelectIcon(t.currentTarget)},e.prototype.checkState=function(){var t=GlobalConfig.LianJiSysConf;return GameServer.serverOpenDay+1>=t.peiyangNeedOpenDay&&ZsCT.ins().lv>=t.peiyangNeedZsLevel?e.STAT_PEIYANG:e.STAT_SKILL},e.prototype.updatePeiyangSkills=function(){var t=this,e=0,i=YuanshenData.ins().skillUnlockData;return YuanshenData.ins().skillDatas.forEach(function(n,s){n=n+i[s]-1,t.skillDatas[s]=n;var o=new SkillData(n),a=t["skillItem"+s];if(a.icon.source=o.icon,a.iconBG.source="quality"+(s+1),a.skillName.text=o.name,a.lv.text="Lv."+o.lv,o.lv&&(e+=GlobalConfig.LianJiSysUpgradePowerConf[s+1][o.lv].power),YuanshenData.ins().skillUnlockData[s]?(a.lock.text="",a.rect.visible=!1):(a.lock.text="未激活",a.rect.visible=!0),a.red.visible=t.isSkillCanActived(s).can,YuanshenData.ins().skillUnlockData[s]>YuanshenData.ins().lastSkillUnlockData[s]){YuanshenData.ins().lastSkillUnlockData[s]=YuanshenData.ins().skillUnlockData[s];var r=new MovieClip;t.skillIcons.addChild(r),r.x=a.x+a.width/2,r.y=a.y+a.height/2-20,r.playFile(RES_DIR_EFF+"UpEff1",1)}}),this.updatePower(e),e},e.prototype.updatePeiyangView=function(t){var i=this;this.levelupBtn.label="培元",t&&t.yuanshenId?this.currentYuanshen!=t.yuanshenId&&(this.currentYuanshen=t.yuanshenId,1==t.yuanshenId?this.playJinjieAnim(0):this.levelupAnim(1)):this.currentYuanshen=YuanshenData.ins().yuanshenId,11==this.currentYuanshen&&(this.levelupBtn.label="升阶"),this.updatePeiyangSkills();var n=YuanshenData.ins().exp,s=YuanshenData.ins().yuanshenData,o=s[this.currentYuanshen],a=o&&o.level||0,r=GlobalConfig.LianJiSysUpgradeConf[this.currentYuanshen][a+1];if(r){var l=r.needExp;l>n?this.countLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:0xFF0000&T:"+n+"|/"+l):this.countLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:0x00FF00&T:"+n+"/"+l+"|")}else this.countLabel.visible=!1;this.peiyangRed.visible=this.isCanPeiyang();var h=o&&o.level||0,u=this.currentYuanshen-1,p=h;0==u?(u=10,p=h):p=h+1;var c=GlobalConfig.LianJiSysUpgradeConf[u][p],d=[],g=[4,5,6,2];g.forEach(function(t){d.push({type:t,value:0})}),this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(c&&c.attrs||d,0,1,"："));var f=GlobalConfig.LianJiSysUpgradeConf[this.currentYuanshen][h+1];f?this.nextAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(f.attrs,0,1,"：")):this.nextAtt.visible=!1,this.yuanshenItems.$children.forEach(function(t,e){var n=t.$children[3],s=YuanshenData.ins().yuanshenData;if(!s[e+1]||s[i.currentYuanshen]&&s[e+1].level<=s[i.currentYuanshen].level?(t.$children[1].visible=!0,t.$children[3].visible=!1):t.$children[1].visible=!1,i.currentYuanshen==e+1)t.$children[1].visible=!1;else if((s[i.currentYuanshen]&&s[i.currentYuanshen].level||0)<(s[e+1]&&s[e+1].level))if(n)n.visible=!0;else{var o=new MovieClip;o.playFile(RES_DIR_EFF+"hunqiu"+(e+1),-1,null,!1),o.x=52,o.y=52,t.addChild(o)}else n&&(n.visible=!1)});var v=YuanshenData.getJingjie(),y=GlobalConfig.LianJiSysUpgradeConf[v.jingjie||1];this.xuanwuTips.text=y&&y[1]&&y[1].desc?y[1].desc:"";var m=CommonUtils.getObjectLength(GlobalConfig.LianJiSysUpgradeConf[1]);if(YuanshenData.ins().yuanShenLv>=m)this.jiesuoTips.text="";else{var T=YuanshenData.ins().yuanshenId-1,C=void 0;C=0==v.jie?11-T:11*(4-(v.jie-1))-T;var b=CommonUtils.getObjectLength(GlobalConfig.LianJiSysConf.peiyangNeedName);v.jingjie>=b?(C-=11,this.jiesuoTips.text="达到【"+GlobalConfig.LianJiSysConf.peiyangNeedName[v.jingjie-1]+"】满阶还需培元"+C+"次"):this.jiesuoTips.text="达到【"+GlobalConfig.LianJiSysConf.peiyangNeedName[v.jingjie]+"】还需培元"+C+"次"}this.jingjieName.source="yuanshen_jingjie_"+(v.jingjie||1),this.numJie.setValue(v.jie);for(var I=0;4>I;I++){var w=this.backEffGroup.getChildAt(I);w.visible=I+1<=YuanshenData.getJingjie().jie}var S=this.getNextSkill();if(S){var _=YuanshenData.getJingjie(S.level);this.next_jingjie.text=GlobalConfig.LianJiSysConf.peiyangNeedName[_.jingjie-1]+e.JIE[_.jie-1]+"阶";var B=new SkillData(YuanshenData.ins().skillDatas[S.skill[0]-1]);this.next_lv.text=B.name+S.skill[1]+"级"}else this.nextSkillInfo.visible=!1;var D=Object.keys(GlobalConfig.LianJiSysUpgradeConf[1]).length;YuanshenData.ins().yuanshenData[11]&&YuanshenData.ins().yuanshenData[11].level==D&&(this.peiyuan.visible=!1,this.cursor.visible=!1,this.curAtt.horizontalCenter=0,this.maxTips.visible=!0,this.curAtt.textFlow=TextFlowMaker.generateTextFlow1(AttributeData.getAttStr(GlobalConfig.LianJiSysUpgradeConf[11][D].attrs,0,1,"：")))},e.prototype.updatePower=function(t){var e=this.currentYuanshen-1||11;YuanshenData.ins().yuanshenData[e]&&(t+=BagCT.getAttrPower(GlobalConfig.LianJiSysUpgradeConf[e][YuanshenData.ins().yuanshenData[e].level].attrs)*SubRoles.ins().subRolesLen),this.powerPanel.setPower(t)},e.prototype.updateSkillView=function(){var t=this;YuanshenData.ins().skillDatas.forEach(function(e,i){var n=new SkillData(e);if(t["lianji_"+i].$children[1].source=n.icon,t["lianji_"+i].$children[3].visible=!YuanshenData.ins().skillUnlockData[i],t["lianji_"+i].$children[4].visible=t.isSkillCanActived(i).can,YuanshenData.ins().skillUnlockData[i]>YuanshenData.ins().lastSkillUnlockData[i]){YuanshenData.ins().lastSkillUnlockData[i]=YuanshenData.ins().skillUnlockData[i];var s=new MovieClip;t.lianjiSkills.addChild(s),s.x=t["lianji_"+i].x+t["lianji_"+i].width/2,s.y=t["lianji_"+i].y+t["lianji_"+i].height/2,s.playFile(RES_DIR_EFF+"UpEff1",1)}}),this.unlockLabel.text="玩家等级达到"+GlobalConfig.LianJiSysConf.peiyangNeedZsLevel+"转、开服"+GlobalConfig.LianJiSysConf.peiyangNeedOpenDay+"天开启连击成长元神培养",this.updateSkillInfo(this.currentSkill||0),this.doSelectIcon(this["lianji_"+(this.currentSkill||0)]),YuanshenData.ins().skillUnlockData.some(function(t){return t>0})?this.loopSkillAnim=!1:(this.loopSkillAnim=!0,this.startLoopSkillAnim())},e.prototype.doSelectIcon=function(t){for(var e=0;4>e;e++)this["lianji_"+e].$children[2].visible=this["lianji_"+e]==t},e.prototype.updateSkillInfo=function(t){this.currentSkill=t;var i=YuanshenData.ins().skillDatas[t],n=new SkillData(i);this.skillName.text=n.name,this.skillDesc.textFlow=TextFlowMaker.generateTextFlow1(SkillUtil.getDesc(n.config));var s=GlobalConfig.LianJiSysConf.unLockLvl[t],o=e.lv2zs(s);if(this.unlockSkillLabel.text="激活条件：玩家等级达到"+o.lvStr,this.activeGroup.visible=!1,Actor.level>=o.lv&&ZsCT.ins().lv>=o.zs){var a=this.checkState();if(a==e.STAT_PEIYANG)return this.currentState=this.checkState(),void this.initPeiyang()}YuanshenData.ins().skillUnlockData[t]?(this.activeGroup.visible=!1,this.activedLabel.visible=!0):(GlobalConfig.LianJiSysConf.openSkillYb[t]?(this.activeCost.text=GlobalConfig.LianJiSysConf.openSkillYb[t].toString(),this.activeCostIcon.visible=!0):(this.activeCost.text="",this.activeCostIcon.visible=!1),this.activedLabel.visible=!1,this.activeGroup.visible=!0),this.isSkillCanActived(t).can?(this.red3.visible=!0,this.btnEff?this.btnEff.visible=!0:(this.btnEff=new MovieClip,this.activeGroup.addChild(this.btnEff),this.btnEff.x=this.activeGroup.width/2,this.btnEff.y=56,this.btnEff.playFile(RES_DIR_EFF+"BtnPrompt1",-1))):(this.red3.visible=!1,this.btnEff&&(this.btnEff.visible=!1)),YuanshenData.ins().skillUnlockData.some(function(t){return t>0})&&(this.loopSkillAnim=!1,this.lianjiEff.playFile(RES_DIR_EFF+"lianji"+(t+1),-1))},e.prototype.startLoopSkillAnim=function(t){var e=this;t=t%5||1,this.loopSkillAnim&&this.lianjiEff.playFile(RES_DIR_EFF+"lianji"+t,1,function(){Timer.start(50,1,function(){e.startLoopSkillAnim(++t)},e)},!1)},e.lv2zs=function(t){var e=Math.floor(t/1e3),i=t%1e3,n="";return e&&(n+=e+"转"),i&&(n+=i+"级"),{zs:e,lv:i,lvStr:n}},e.prototype.initYuanshenPos=function(){var t=this;this.yuanshenItemPos=[],this.yuanshenItems.$children.forEach(function(e,i){var n={x:e.x,y:e.y,sx:e.scaleX,sy:e.scaleY,a:e.alpha};t.yuanshenItemPos.push(n);var s=new MovieClip;s.playFile(RES_DIR_EFF+"hunqiu"+(i+1),-1,null,!1),s.x=52,s.y=52,s.visible=!1,e.addChild(s);var o=new MovieClip;o.x=52,o.y=52,e.addChild(o),o.visible=!1,o.playFile(RES_DIR_EFF+"UpEff1",1,function(){})}),this.resetPosAndStartAnim()},e.prototype.resetPosAndStartAnim=function(){var t=this;this.updateYuanshenPos(this.currentYuanshen-1),this.yuanshenItems.$children.forEach(function(e,i){e.x=t.yuanshenItemPos[i].x,e.y=t.yuanshenItemPos[i].y,e.scaleX=t.yuanshenItemPos[i].sx,e.scaleY=t.yuanshenItemPos[i].sy,e.alpha=t.yuanshenItemPos[i].a,e.$children[2].$children[1].text="Lv"+(YuanshenData.ins().yuanshenData[i+1]&&YuanshenData.ins().yuanshenData[i+1].level||"0")})},e.prototype.updateYuanshenPos=function(t){var e=void 0==t?1:t,i=[];this.yuanshenItemPos.forEach(function(t,n){var s=(n+e)%10;i[s]=t}),this.yuanshenItemPos=i},e.prototype.getNextSkill=function(){for(var t,e=YuanshenData.ins().yuanshenData[this.currentYuanshen]&&YuanshenData.ins().yuanshenData[this.currentYuanshen].level||0,i=Object.keys(GlobalConfig.LianJiSysUpgradeConf[1]).length,n=Object.keys(GlobalConfig.LianJiSysUpgradeConf).length,s=e;i>=s;s++){for(var o=1;n>=o;o++){var a=GlobalConfig.LianJiSysUpgradeConf[o][s];if(a&&a.skill&&s>e){t=a;break}}if(t)break}return t},e.prototype.isSkillCanActived=function(t){var i=e.lv2zs(GlobalConfig.LianJiSysConf.unLockLvl[t]),n=GlobalConfig.LianJiSysConf.openSkillYb;return Actor.yb<n[t]?{can:!1,reason:"元宝不足"}:!YuanshenData.ins().skillUnlockData[t]&&i.lv<=Actor.level&&i.zs<=ZsCT.ins().lv?{can:!0,reason:""}:{can:!1,reason:"等级不足"}},e.prototype.isCanPeiyang=function(){if(!YuanshenData.ins().yuanshenId)return!1;var t=YuanshenData.ins().exp,e=YuanshenData.ins().yuanshenData[YuanshenData.ins().yuanshenId],i=e&&e.level||0,n=GlobalConfig.LianJiSysUpgradeConf[YuanshenData.ins().yuanshenId][i+1];if(!n)return!1;var s=n.needExp;return t>=s&&!YuanshenData.ins().skillUnlockData.some(function(t){return 0==t})},e.prototype.checkRed=function(){var t=this,e=!1;return YuanshenData.ins().skillUnlockData.forEach(function(i,n){i||t.isSkillCanActived(n).can&&(e=!0)}),SoulSuitRedPoint.ins().redPoint&&(e=!0),this.isCanPeiyang()&&(e=!0),e||LianJiTPRPCT.ins().tp},e.prototype.playJinjieAnim=function(t){var e=this;this.updateYuanshenPos(t),this.animating=!0,this.yuanshenItems.$children.forEach(function(t,i){t.$children[2].$children[1].text="Lv"+(YuanshenData.ins().yuanshenData[i+1]&&YuanshenData.ins().yuanshenData[i+1].level||"0"),egret.Tween.get(t).to({x:t.parent.width/2-52,y:t.parent.height/2-52,scaleX:.3,scaleY:.3,alpha:0},300);var n=e.yuanshenItemPos[i];9==i&&Timer.start(400,1,function(){var i=new MovieClip;e.addChild(i),i.x=t.parent.x+t.parent.width/2,i.y=t.parent.y+t.parent.height/2+50,i.playFile(RES_DIR_EFF+"WingOpenEff3")},e),Timer.start(1200,1,function(){egret.Tween.get(t).to({x:n.x,y:n.y,scaleX:n.sx,scaleY:n.sy,alpha:n.a},200)},e)}),Timer.start(1200,1,this.resetLvUpEnabled,this)},e.prototype.levelupAnim=function(t){var e=this;this.updateYuanshenPos(t),this.animating=!0,this.yuanshenItems.$children.forEach(function(t,i){var n=e.yuanshenItemPos[i];t.$children[2].$children[1].text="Lv"+(YuanshenData.ins().yuanshenData[i+1]&&YuanshenData.ins().yuanshenData[i+1].level||"0"),egret.Tween.get(t).to({x:n.x,y:n.y,scaleX:n.sx,scaleY:n.sy,alpha:n.a},300).call(function(){})}),Timer.start(180,1,this.resetLvUpEnabled,this)},e.prototype.resetLvUpEnabled=function(){this.animating=!1},e.prototype.doLevelup=function(){var t=YuanshenData.ins().exp,e=YuanshenData.ins().yuanshenData[this.currentYuanshen],i=e&&e.level||0;if(!GlobalConfig.LianJiSysUpgradeConf||!GlobalConfig.LianJiSysUpgradeConf[this.currentYuanshen]){var n=GlobalConfig.LianJiSysUpgradeConf?Object.keys(GlobalConfig.LianJiSysUpgradeConf).length:-1;return void platform.reportError("cys"+this.currentYuanshen+"-"+YuanshenData.ins().yuanshenId+"+-lev"+i+"-cfglen"+n)}var s=GlobalConfig.LianJiSysUpgradeConf[this.currentYuanshen][i+1];if(s){var o=s.needExp;if(o>t)return void TipsCT.ins().showTips("元神经验不足")}if(!this.animating){if(YuanshenData.ins().skillUnlockData.some(function(t){return 0==t}))return void TipsCT.ins().showTips("激活全部技能后开启培养");if(this.lastYuanshen=this.currentYuanshen,LianJiCT.ins().doYuanshenLevelUp(),11==this.currentYuanshen);else{var a=this.yuanshenItems.getChildAt(this.currentYuanshen-1),r=a.$children[4];r||(r=new MovieClip,r.x=52,r.y=52,a.addChild(r)),r.visible=!0,r.playFile(RES_DIR_EFF+"UpEff1",1,function(){r.visible=!1},!1)}}},e.prototype.doActive=function(t){var e=this.isSkillCanActived(this.currentSkill);return e.can?void LianJiCT.ins().doActiveSkill(this.currentSkill+1):void TipsCT.ins().showTips(e.reason)},e.prototype.onGetItem=function(){WarnCT.ins().setBuyGoodsWarn(GlobalConfig.LianJiSysConf.addExpItem[0][0],1)},e.STAT_SKILL="lianji_jh",e.STAT_PEIYANG="yuanshen_up",e.JIE=["一","二","三","四","五","六","七","八","九","十"],e.JIE_PER_JINGJIE=4,e}(BaseView);__reflect(YuanshenPanel.prototype,"YuanshenPanel"),window.YuanshenPanel=YuanshenPanel;var YuanshenSkillTipsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="YuanshenSkillTips",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.closeSelf,this.onTap),this.addTouchEvent(this.activeBtn,this.doActive)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0],n=t[1];this.currentIndex=n;var s=new SkillData(i);this.icon.source=s.icon,this.skillName.text=s.name,this.skillDesc.textFlow=TextFlowMaker.generateTextFlow1("技能效果:"+s.desc);var o=GlobalConfig.LianJiSysConf.unLockLvl[n],a=YuanshenPanel.lv2zs(o);
if(this.cost.text=GlobalConfig.LianJiSysConf.openSkillYb[n].toString(),GlobalConfig.LianJiSysConf.openSkillYb[n]||(this.costIcon.visible=!1,this.cost.visible=!1),YuanshenData.ins().skillUnlockData[n]){var r=Object.keys(GlobalConfig.LianJiSysUpgradeConf[1]).length;if(YuanshenData.ins().yuanshenData[11]&&YuanshenData.ins().yuanshenData[11].level==r)this.skillDescNext.visible=!1,this.skillDescNext.height=0,this.active.visible=!1,this.active.height=0;else{var l=new SkillData(i+1);this.skillDescNext.textFlow=TextFlowMaker.generateTextFlow1("下一等级:\n"+l.desc),this.active.visible=!1,this.active.height=0}}else this.unlockSkillLabel.text="激活条件：玩家等级达到"+a.lvStr,this.active.visible=!0},e.prototype.doActive=function(){return this.close(),Actor.yb<GlobalConfig.LianJiSysConf.openSkillYb[this.currentIndex]?void TipsCT.ins().showTips("元宝不足"):void LianJiCT.ins().doActiveSkill(this.currentIndex+1)},e.prototype.onTap=function(){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(YuanshenSkillTipsWin.prototype,"YuanshenSkillTipsWin"),ViewManager.ins().reg(YuanshenSkillTipsWin,LayerManager.UI_Tips),window.YuanshenSkillTipsWin=YuanshenSkillTipsWin;var ZhanLing=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.WarSpirit,e.regNetMsg(1,e.postZhanLingInfo),e.regNetMsg(2,e.postZhanLingUpExp),e.regNetMsg(3,e.postZhanLingDrug),e.regNetMsg(4,e.postZhanLingWear),e.regNetMsg(6,e.postZhanLingComposeItem),e.regNetMsg(7,e.postZhanLingBubble),e.regNetMsg(11,e.postZhanLingSkinUpGrade),e.regNetMsg(12,e.postZhangLingSkinChange),e.regNetMsg(13,e.postZhanLingShenLian),e.regNetMsg(14,e.postZhanLingZhuHun),e.observe(ZsCT.ins().postZsLv,e.initZhanLing),e.observe(BagCT.ins().postItemAdd,function(){ZhanLingModel.ins().updateShowZLlist()}),e.observe(BagCT.ins().postItemDel,function(){ZhanLingModel.ins().updateShowZLlist()}),e.observe(BagCT.ins().postItemCountChange,function(){ZhanLingModel.ins().updateShowZLlist()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.initLogin=function(){ZhanLingModel.ins().updateShowZLlist()},e.prototype.initZero=function(){!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()&&ZhanLingModel.ins().setZhanLingData(new ZhanLingData)},e.prototype.initZhanLing=function(){!ZhanLingModel.ins().getZhanLingDataById(0)&&ZhanLingModel.ins().ZhanLingOpen()&&ZhanLingModel.ins().setZhanLingData(new ZhanLingData)},e.prototype.checkRedPoint=function(){if(!ZhanLingModel.ins().ZhanLingOpen())return!1;var t=0,e=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t);if(e)return!0;if(e=ZhanLingModel.ins().isUpGradeByTalent(t))return!0;var i=GlobalConfig.ZhanLingConfig;for(var n in i.upgradeInfo)if(e=ZhanLingModel.ins().getZhanLingDataByDrugUse(t,Number(n)))return!0;for(var s=0;s<ZhanLingModel.ins().showZLlist.length;s++){var o=ZhanLingModel.ins().showZLlist[s];if(t=o.id){if(e=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t))return!0;if(e=ZhanLingModel.ins().isUpGradeByTalent(t))return!0}}return t=0,e=ZhanLingModel.ins().getZhanLingItemRedPoint(t),e||(e=ZhanLingRedPoint.ins().redPoint),e},e.prototype.ZhanLingItemTips=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!1),void 0===n&&(n=null);var s=t,o=GlobalConfig.ItemConfig[s],a=ItemUtil.getSubType(o),r=i?1:0,l=n&&n.zhuHunLv>0?"铸魂 "+GlobalFun.getRomanNumStr(n.zhuHunLv)+"."+o.name:null,h=n&&n.zhuHunLv>0?"zlzh_hun_png":"",u=ZhanLingModel.ins().getZhanLingItemPower(s,r),p=ZhanLingModel.ins().getZhanLingItemPower(s,0),c=o.level?o.level+"级":"无级别",d=GlobalConfig.ZhanLingEquip[s],g={left:"部位:\n等级:",right:GlobalConfig.ZhanLingConfig.zlEquipName[d.pos-1]+"\n"+c},f=[];if(i&&n){for(var v="",y=GlobalConfig.ZhanLingShenLianLevel,m=GlobalConfig.ZhanLingZhuHunLevel,T=0;T<d.attrs.length;T++){var C=d.attrs[T].type;v+=AttributeData.getAttStrByType(d.attrs[T],0,"：");var b=y[a][n.shenLianStage][n.shenLianLv];if(b)for(var I in b.attr)if(b.attr[I].type==C){v+=AttributeData.getAttStrByType(b.attr[I],4,"+",!1,!1);break}var w=m[a][n.zhuHunLv];if(w)for(var I in w.attrs)if(w.attrs[I].type==C){v+=AttributeData.getAttStrByType(w.attrs[I],4,"+",!1,!1);break}b&&(v+=" |C:0xFFFF00&T:神炼+"+d.attrs[T].value*b.precent/1e4+"|"),T-1<d.attrs.length&&(v+="\n")}f.push({title:"基础属性:",attr:[],others:{suitdesc:v}})}else f.push({title:"基础属性:",attr:d.attrs});var S=GlobalConfig.ZhanLingEquip[s].level;S=S?S:1;for(var _=GlobalConfig.ZhanLingSuit[S],B=65280,D=ZhanLingModel.ins().getZhanLingDataById(e),x=16711935,R=16711935,E=0,A="",T=0;T<GlobalConfig.ZhanLingConfig.equipPosCount;T++){var P=65280,k=D?GlobalConfig.ZhanLingEquip[D.items[T]]:null;!D||!D.items[T]||!k||k.level<S?(P=B=16711680,x=R=6710886):E++,i||T+1==GlobalConfig.ZhanLingEquip[s].pos&&(P=65280);var M="|C:"+P+"&T:"+GlobalConfig.ZhanLingConfig.zlEquipName[T];T+1<GlobalConfig.ZhanLingConfig.equipPosCount&&(M+="|C:"+P+"&T:、"),A+=M}i||(E=1);var L="魔神基础属性增加+"+_.precent/100+"%",G="|C:"+B+"&T:("+E+"/"+GlobalConfig.ZhanLingConfig.equipPosCount+")";if(f.push({title:"|C:0xff00ff&T:"+_.suitWithName+"|"+G,attr:_.attrs,colorName:x,colorValue:R,others:{suitdesc:A,exdesc:L}}),null!=i&&null!=n){var F=GlobalConfig.ZhanLingZhuHunLinkLevel[a],N=0;for(var T in F)N=+T;var W=ZhanLingModel.ins().getZhanLingPosData(0,N),O=Math.min(n.zhuHunLv,W.zhuHunLv),U=F[N]&&F[N][O]?F[N][O]:null,H=null!=U;if(H){var v="|C:0xffff00&T:[铸魂"+GlobalConfig.ZhanLingConfig.zlEquipName[N-1]+"]"+AttributeData.getAttStr(U.attrs,4,1,"")+"|";f.push({title:"|C:0xffff00&T:灵魂锁链Lv"+O+"|",attr:[],colorName:0,colorValue:0,others:{suitdesc:v}})}}if(null!=i&&null!=n){var V=GlobalConfig.ZhanLingShenLianLevel[a],q=V[n.shenLianStage][n.shenLianLv];if(0!=q.precent){var v="|C:0xffff00&T:为当前部位炼入神之血，提升基\n础属性至"+(q.precent+1e4)/100+"%|";f.push({title:"|C:0xffff00&T:神炼Lv"+(n.shenLianStage-1)+"|",attr:[],colorName:0,colorValue:0,others:{suitdesc:v}})}}ViewManager.ins().open(EquipTipsBase,BagCT.BAG_TYPE_OTHTER,s,p,u,g,f,null,null,h,l)},e.prototype.checkShenZhuOpen=function(){return ZsCT.ins().lv<GlobalConfig.ZhanLingShenLianBaseCfg.openzhuanshenglv?!1:!(GameServer.serverOpenDay<GlobalConfig.ZhanLingShenLianBaseCfg.openserverday-1)},e.prototype.sendZhanLingUpExp=function(t,e){void 0===e&&(e=0);var i=this.getBytes(2);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendZhanLingDrug=function(t,e){var i=this.getBytes(3);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendZhanLingWear=function(t,e){var i=this.getBytes(4);i.writeByte(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendZhanLingComposeItem=function(t){var e=this.getBytes(5);e.writeInt(t),this.sendToServer(e)},e.prototype.sendZhanLingSkinUpGrade=function(t){var e=this.getBytes(11);e.writeByte(t),this.sendToServer(e)},e.prototype.sendZhangLingSkinChange=function(t){var e=this.getBytes(12);e.writeByte(t),this.sendToServer(e)},e.prototype.sendZhanLingShenLian=function(t,e){var i=this.getBytes(13);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.sendZhanLingZhuHun=function(t,e){var i=this.getBytes(14);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postZhanLingInfo=function(t){for(var e=t.readByte(),i=0;e>i;i++){var n=new ZhanLingData;n.id=t.readInt(),n.talentLv=t.readByte(),n.level=t.readShort(),n.exp=t.readInt(),n.drugs=[];for(var s=t.readByte(),o=0;s>o;o++){var a=t.readInt(),r=t.readShort();n.drugs.push({itemId:a,count:r})}var l=t.readByte();if(l){n.items=[],n.posInfo=[];for(var h=0;l>h;h++){n.items.push(t.readInt());var u={shenLianLv:t.readShort(),shenLianStage:t.readShort(),zhuHunLv:t.readShort()};n.posInfo.push(u)}}ZhanLingModel.ins().setZhanLingData(n)}var p=t.readByte();ZhanLingModel.ins().ZhanLingSkinId=p},e.prototype.postZhanLingUpExp=function(t){var e=t.readByte(),i=t.readShort(),n=t.readInt(),s=ZhanLingModel.ins().getZhanLingDataById(e);if(s){var o=s.level;s.level=i,s.exp=n,i>o&&this.postZhanLingUpgrade()}},e.prototype.postZhanLingUpgrade=function(){},e.prototype.postZhanLingDrug=function(t){var e=t.readByte(),i=t.readInt(),n=t.readShort(),s=ZhanLingModel.ins().getZhanLingDataById(e);if(s){for(var o=!1,a=0;a<s.drugs.length;a++)if(s.drugs[a].itemId==i){s.drugs[a].count=n,o=!0;break}o||s.drugs.push({itemId:i,count:n})}},e.prototype.postZhanLingWear=function(t){var e=t.readByte(),i=t.readInt(),n=ZhanLingModel.ins().getZhanLingDataById(e);if(n){var s=GlobalConfig.ZhanLingEquip[i];s&&(n.items[s.pos-1]=i)}},e.prototype.postZhanLingComposeItem=function(t){var e=t.readByte(),i=t.readByte(),n=ZhanLingModel.ins().getZhanLingDataById(e);if(n)for(var s=0;i>s;s++)n.items[s]=t.readInt()},e.prototype.postZhanLingBubble=function(t){var e=t.readDouble(),i=t.readInt(),n=t.readByte(),s=EntityManager.ins().getEntityByHandle(e);s&&s.showZhanling(n,i)},e.prototype.postZhanLingSkinUpGrade=function(t){var e=t.readByte(),i=t.readShort(),n=ZhanLingModel.ins().getZhanLingDataById(e),s=0;n?s=n.talentLv:(n=new ZhanLingData,n.id=e,ZhanLingModel.ins().setZhanLingData(n)),i!=s&&this.postZhanLingTalentLvUpGrade(),n.talentLv=i},e.prototype.postZhanLingTalentLvUpGrade=function(){},e.prototype.postZhangLingSkinChange=function(t){var e=t.readByte();ZhanLingModel.ins().ZhanLingSkinId=e},e.prototype.postZhanLingShenLian=function(t){var e=t.readByte(),i=ZhanLingModel.ins().getZhanLingDataById(e),n=t.readByte(),s=i.getPosInfoBy(n),o=s?s.shenLianLv:0;return s.shenLianLv=t.readUnsignedShort(),s.shenLianStage=t.readUnsignedByte(),s.shenLianLv>o?1:0},e.prototype.postZhanLingZhuHun=function(t){var e=t.readByte(),i=ZhanLingModel.ins().getZhanLingDataById(e),n=t.readByte(),s=i.getPosInfoBy(n);s.zhuHunLv=t.readUnsignedShort()},__decorate([post()],e.prototype,"postZhanLingInfo",null),__decorate([post()],e.prototype,"postZhanLingUpExp",null),__decorate([post()],e.prototype,"postZhanLingUpgrade",null),__decorate([post()],e.prototype,"postZhanLingDrug",null),__decorate([post()],e.prototype,"postZhanLingWear",null),__decorate([post()],e.prototype,"postZhanLingComposeItem",null),__decorate([post()],e.prototype,"postZhanLingBubble",null),__decorate([post()],e.prototype,"postZhanLingSkinUpGrade",null),__decorate([post()],e.prototype,"postZhanLingTalentLvUpGrade",null),__decorate([post()],e.prototype,"postZhangLingSkinChange",null),__decorate([post()],e.prototype,"postZhanLingShenLian",null),__decorate([post()],e.prototype,"postZhanLingZhuHun",null),e}(BaseSystem);__reflect(ZhanLing.prototype,"ZhanLing"),System.ZhanLing=function(){return ZhanLing.ins()},window.ZhanLing=ZhanLing;var ZhanLingRedPoint=function(t){function e(){var e=t.call(this)||this;return e.itemSLRedPoint=[],e.itemZHRedPoint=[],e.associated(e.postRedPoint,BagCT.ins().postItemCountChange,BagCT.ins().postItemDel,BagCT.ins().postItemAdd,ZsCT.ins().postZsData,ZhanLing.ins().postZhanLingInfo,ZhanLing.ins().postZhanLingShenLian,ZhanLing.ins().postZhanLingZhuHun),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postRedPoint=function(){this.redPoint;this.slRedPoint=this.postItemSLRedPoint(),this.zhRedPoint=this.postItemZHRedPoint(),this.redPoint=this.slRedPoint||this.zhRedPoint},e.prototype.postItemSLRedPoint=function(){var t=!1;this.itemSLRedPoint=[];for(var e=1;e<=GlobalConfig.ZhanLingConfig.equipPosCount;e++)if(this.itemSLRedPoint[e]=!1,ZhanLing.ins().checkShenZhuOpen()){var i=ZhanLingModel.ins().getZhanLingPosData(0,e),n=GlobalConfig.ZhanLingShenLianLevel[e],s=ZhanLingModel.ins().getZhanLingDataByItem(0,e);if(0!=s&&i){var o=n[i.shenLianStage]?n[i.shenLianStage][i.shenLianLv+1]:null;if(!o){var a=n[i.shenLianStage+1];a&&(o=n[i.shenLianStage+1][0])}var r=!o;if(!r){var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o.cost.id);l>=o.cost.count&&(this.itemSLRedPoint[e]=!0,t=!0)}}}return t},e.prototype.postItemZHRedPoint=function(){this.itemZHRedPoint=[];for(var t=!1,e=1;e<=GlobalConfig.ZhanLingConfig.equipPosCount;e++)if(this.itemZHRedPoint[e]=!1,ZhanLing.ins().checkShenZhuOpen()){var i=ZhanLingModel.ins().getZhanLingDataByItem(0,e),n=ZhanLingModel.ins().getZhanLingPosData(0,e);if(0!=i&&n){var s=GlobalConfig.ZhanLingZhuHunLevel[e][n.zhuHunLv+1],o=!s;if(!o){var a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,s.materialInfo.id);a>=s.materialInfo.count&&(this.itemZHRedPoint[e]=!0,t=!0)}}}return t},__decorate([post()],e.prototype,"postRedPoint",null),__decorate([post()],e.prototype,"postItemSLRedPoint",null),__decorate([post()],e.prototype,"postItemZHRedPoint",null),e}(BaseSystem);__reflect(ZhanLingRedPoint.prototype,"ZhanLingRedPoint"),System.ZhanLingRedPoint=function(){return ZhanLingRedPoint.ins()},window.ZhanLingRedPoint=ZhanLingRedPoint;var ZhanLingData=function(){function t(t){this._id=t?t:0,this._level=0,this._exp=0,this._items=[];for(var e=0;e<GlobalConfig.ZhanLingConfig.equipPosCount;e++)this._items.push(0);this._talentLv=0,this._drugs=[];for(var e in GlobalConfig.ZhanLingConfig.upgradeInfo)this._drugs.push({itemId:Number(e),count:0});this.posInfo=[]}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exp",{get:function(){return this._exp},set:function(t){this._exp=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){return this._items},set:function(t){this._items=t},enumerable:!0,configurable:!0}),t.prototype.getPosInfoBy=function(t){return this.posInfo[t-1]},Object.defineProperty(t.prototype,"talentLv",{get:function(){return this._talentLv},set:function(t){this._talentLv=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drugs",{get:function(){return this._drugs},set:function(t){this._drugs=t},enumerable:!0,configurable:!0}),t}();__reflect(ZhanLingData.prototype,"ZhanLingData");var ZLPOS;!function(t){t[t.ITEM1=1]="ITEM1",t[t.ITEM2=2]="ITEM2",t[t.ITEM3=3]="ITEM3",t[t.ITEM4=4]="ITEM4"}(ZLPOS||(ZLPOS={})),window.ZhanLingData=ZhanLingData;var ZhanLingModel=function(t){function e(){var e=t.call(this)||this;return e._ZhanLingData={},e._ZhanLingSkinId=0,e._showZLlist=[],e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},Object.defineProperty(e.prototype,"ZhanLingData",{get:function(){return this._ZhanLingData},enumerable:!0,configurable:!0}),e.prototype.getZhanLingDataById=function(t){return this._ZhanLingData[t]},e.prototype.setZhanLingData=function(t){t&&(this._ZhanLingData[t.id]=t)},Object.defineProperty(e.prototype,"ZhanLingSkinId",{get:function(){return this._ZhanLingSkinId},set:function(t){this._ZhanLingSkinId=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showZLlist",{get:function(){return this._showZLlist},set:function(t){this._showZLlist=t},enumerable:!0,configurable:!0}),e.prototype.ZhanLingOpen=function(){return ZsCT.ins().lv>=GlobalConfig.ZhanLingConfig.openzhuanshenglv&&GameServer.serverOpenDay+1>=GlobalConfig.ZhanLingConfig.openserverday},e.prototype.getZhanLingDataByLevel=function(t){return this._ZhanLingData[t]?this._ZhanLingData[t].level:0},e.prototype.getZhanLingDataByStage=function(t){if(!this._ZhanLingData[t]||!this._ZhanLingData[t].level)return 1;var e=Math.floor(this._ZhanLingData[t].level/10),i=Math.floor(this._ZhanLingData[t].level%10);return e+=1,i||(e-=1),e||(e=1),e},e.prototype.getZhanLingDataByNextStage=function(t){var e=0;this._ZhanLingData[t]&&(e=this._ZhanLingData[t].talentLv);var i,n=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type];for(var s in n){var o=n[s];if(o.talentLevel>e){i=o;break}}return i?this.getStageLv(i.level):null},e.prototype.getZhanLingDataByStar=function(t){if(!this._ZhanLingData[t]||!this._ZhanLingData[t].level)return 0;var e=Math.floor(this._ZhanLingData[t].level%10);return e||(e=10),e},e.prototype.getZhanLingDataByTalentLv=function(t){if(!this._ZhanLingData[t])return 0;var e=this.getZhanLingDataByLevel(t),i=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][e].talentLevel;return i&&(this._ZhanLingData[t].talentLv=i),this._ZhanLingData[t].talentLv},e.prototype.getZhanLingDataByExp=function(t){return this._ZhanLingData[t]?this._ZhanLingData[t].exp:0},e.prototype.getZhanLingDataByItem=function(t,e){return this._ZhanLingData[t]?this._ZhanLingData[t].items[e-1]:0},e.prototype.getZhanLingPosData=function(t,e){return this._ZhanLingData[t]?this._ZhanLingData[t].getPosInfoBy(e):null},e.prototype.getZhanLingDataByDrugUse=function(t,e){if(!this._ZhanLingData[t])return!1;var i=0,n=BagCT.ins().getBagItemById(e);if(i=n?n.count:0,!i)return!1;var s=0,o=ExpansionCardCT.ins().useData;if(o&&o[e-205001])s=ExpansionCardCT.ins().useData[e-205001].maxNum;else{var a=this._ZhanLingData[t].level,r=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][a];if(!r.maxCount||!r.maxCount[e])return;s=r.maxCount[e]}for(var l=!1,h=0;h<this._ZhanLingData[t].drugs.length;h++)if(this._ZhanLingData[t].drugs[h].itemId==e&&this._ZhanLingData[t].drugs[h].count>=s){l=!0;break}return l?!1:!0},e.prototype.showDrue=function(t,e){var i=this._ZhanLingData[t];if(!i)return!1;var n=i?i.level:0,s=CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type])-1,o=BagCT.ins().getBagItemById(e),a=o?o.count:0,r=0,l=ExpansionCardCT.ins().useData;if(l&&l[e-205001])r=ExpansionCardCT.ins().useData[e-205001].maxNum;else{var h=this._ZhanLingData[t].level,u=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][h];if(!u.maxCount||!u.maxCount[e])return;r=u.maxCount[e]}if(t&&!r)return!1;for(var p=!1,c=0;c<this._ZhanLingData[t].drugs.length;c++)if(this._ZhanLingData[t].drugs[c].itemId==e&&this._ZhanLingData[t].drugs[c].count>=r){p=!0;break}return n>=s&&p?!1:a>0},e.prototype.getZhanLingDataByTalentId=function(t){var e=GlobalConfig.ZhanLingBase[t];return e?e.talent:0},e.prototype.getZhanLingDataBySkill=function(t){var e=[];return this._ZhanLingData[t]?GlobalConfig.ZhanLingBase[t].skill:e},e.prototype.getZhanLingDataByDrug=function(t,e){if(!this._ZhanLingData[t])return 0;for(var i=0;i<this._ZhanLingData[t].drugs.length;i++)if(this._ZhanLingData[t].drugs[i].itemId==e)return this._ZhanLingData[t].drugs[i].count;return 0},e.prototype.getZhanLingDataBySuit=function(t){if(!this._ZhanLingData[t])return 0;for(var e=0,i=0;i<this._ZhanLingData[t].items.length;i++){var n=this._ZhanLingData[t].items[i],s=GlobalConfig.ZhanLingEquip[n];if(!s)return 0;e||(e=s.level),e>s.level&&(e=s.level)}return e},e.prototype.getZhanLingDataBySuitCount=function(t,e){if(!this._ZhanLingData[t])return 0;for(var i=0,n=0;n<this._ZhanLingData[t].items.length;n++){var s=this._ZhanLingData[t].items[n],o=GlobalConfig.ZhanLingEquip[s];o&&o.level>=e&&i++}return i},e.prototype.getZhanLingDataByMat=function(t,e){if(!e&&!this._ZhanLingData[t])return 0;var i=GlobalConfig.ZhanLingBase[t],n=i.talent,s=0;if(e)s=1;else{if(!this._ZhanLingData[t].talentLv)return 0;s=this._ZhanLingData[t].talentLv+1}var o=GlobalConfig.ZhanLingTalent[n][s];return o?o.costCount:0},e.prototype.getZhanLingPower=function(t){var i=0,n=e.ins().getZhanLingDataByLevel(t),s=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][n];if(!s)return[i,[],[]];var o=e.ins().getZhanLingDataById(t);if(!o)return[i,[],[]];var a=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][n+1],r=0,l=[],h=[],u=0,p=0,c=[],d=[],g=0,f=[],v=[],y=0,m=0;r+=BagCT.getAttrPower(AttributeData.getAttrFromCfg(s))*SubRoles.ins().subRolesLen;for(var T=0;T<SubRoles.ins().subRolesLen;T++){var C=SubRoles.ins().getSubRoleByIndex(T),b=AttributeData.getAttrFromCfg(s);for(var I in b)r+=ItemUtil.relatePower(b[I],C)}r+=(s.expower?s.expower:0)*SubRoles.ins().subRolesLen;var w=AttributeData.getAttrFromCfg(s);l=this.addAttrs(l,w),a&&(h=this.addAttrs(h,AttributeData.getAttrFromCfg(a)));var S=e.ins().getZhanLingDataBySuit(t);if(S){var _=GlobalConfig.ZhanLingSuit[S];if(_&&_.attrs){p+=BagCT.getAttrPower(_.attrs)*SubRoles.ins().subRolesLen;for(var I=0;I<_.attrs.length;I++)for(var T=0;T<SubRoles.ins().subRolesLen;T++){var C=SubRoles.ins().getSubRoleByIndex(T);p+=ItemUtil.relatePower(_.attrs[I],C)}c=AttributeData.getPercentAttr(l,_.precent/1e4),a&&(d=AttributeData.getPercentAttr(h,_.precent/1e4))}}for(var I=0;I<o.drugs.length;I++){for(var B=[],D=[],x=GlobalConfig.ZhanLingConfig.upgradeInfo[o.drugs[I].itemId],R=[],E=0;E<x.attr.length;E++){var A=new AttributeData;A.type=x.attr[E].type,A.value=x.attr[E].value*o.drugs[I].count,R.push(A)}var P={attr:R,precent:x.precent?x.precent*o.drugs[I].count:0,sort:x.sort};g+=BagCT.getAttrPower(P.attr)*SubRoles.ins().subRolesLen,f=this.addAttrs(f,P.attr),v=this.addAttrs(v,P.attr),P.precent&&(g+=Math.floor(r*P.precent/1e4),S&&(g+=Math.floor(r*P.precent/1e4)),B=AttributeData.getPercentAttr(l,P.precent/1e4),f=this.addAttrs(f,B),a&&(D=AttributeData.getPercentAttr(h,P.precent/1e4),v=this.addAttrs(v,D)));for(var T=0;T<SubRoles.ins().subRolesLen;T++){var C=SubRoles.ins().getSubRoleByIndex(T);g+=ItemUtil.relatePower(P.attr[I],C)}}for(var I=1;I<=GlobalConfig.ZhanLingConfig.equipPosCount;I++){var k=e.ins().getZhanLingDataByItem(t,I);u+=this.getZhanLingItemPower(k,1)}var M=this.getZhanLingDataByTalentId(t),L=this.getZhanLingDataByTalentLv(t),G=GlobalConfig.ZhanLingTalent[M][L];if(G){var F=G.expower;y+=(F?F:0)*SubRoles.ins().subRolesLen,G.attrs&&(y+=BagCT.getAttrPower(G.attrs)*SubRoles.ins().subRolesLen)}for(var N=GlobalConfig.ZhanLingBase[t],I=0;I<N.skill.length;I++){var W=GlobalConfig.ZhanLingSkill[N.skill[I].id];if(W.attrs){m+=BagCT.getAttrPower(W.attrs)*SubRoles.ins().subRolesLen;for(var T=0;T<SubRoles.ins().subRolesLen;T++)for(var C=SubRoles.ins().getSubRoleByIndex(T),O=0;O<W.attrs.length;O++)m+=ItemUtil.relatePower(W.attrs[O],C);W.expower&&(m+=W.expower)}}return i=r+u+p+g+y+m,l=this.addAttrs(l,c),l=this.addAttrs(l,f),a&&(h=this.addAttrs(h,d),h=this.addAttrs(h,v)),[i,l,h]},e.prototype.addAttrs=function(t,i,n){void 0===n&&(n=!0);var s=n?[]:t;if(n)for(var o=0;o<t.length;o++)-1!=e.showTypeList.indexOf(t[o].type)&&s.push(new AttributeData(t[o].type,t[o].value));for(var a=0;a<i.length;a++){var r=!1;if(-1!=e.showTypeList.indexOf(i[a].type)){for(var l=0;l<t.length;l++)if(t[l].type==i[a].type){s[l].value+=i[a].value,r=!0;break}r||s.push(new AttributeData(i[a].type,i[a].value))}}return s},e.prototype.getZhanLingItemPower=function(t,i){void 0===i&&(i=0);var n=0,s=GlobalConfig.ZhanLingEquip[t];if(!s)return n;var o=i?SubRoles.ins().subRolesLen:3;if(n+=BagCT.getAttrPower(s.attrs)*o,i){for(var a=0;o>a;a++)for(var r=SubRoles.ins().getSubRoleByIndex(a),l=0;l<s.attrs.length;l++)n+=ItemUtil.relatePower(s.attrs[l],r);var h=ItemUtil.getSubType(GlobalConfig.ItemConfig[t]),u=e.ins().getZhanLingPosData(0,h);if(u){var p=GlobalConfig.ZhanLingShenLianLevel[h],c=p[u.shenLianStage][u.shenLianLv],d=AttributeData.getPercentAttr(s.attrs,c.precent/1e4),g=AttributeData.AttrAddition(c.attr,d);n+=BagCT.getAttrPower(g)}if(u){var f=GlobalConfig.ZhanLingZhuHunLevel[h][u.zhuHunLv];f&&(n+=BagCT.getAttrPower(f.attrs));var v=GlobalConfig.ZhanLingZhuHunLinkLevel[h],y=0;for(var a in v)y=+a;var m=e.ins().getZhanLingPosData(0,y),T=Math.min(u.zhuHunLv,m.zhuHunLv),C=v[y]&&v[y][T]?v[y][T]:null,b=null!=C;b&&(n+=C.power)}}return n},e.prototype.isUpGradeByStar=function(t){if(!this.getZhanLingDataById(t))return this.isUpGradeByTalent(t,!0);var i=e.ins().getZhanLingDataByLevel(t),n=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][i];if(!n||!n.exp)return!1;var s=e.ins().getZhanLingDataByExp(t),o=n.exp-s;o=o>0?o:0;var a=Math.ceil(o/GlobalConfig.ZhanLingConfig.stageitemexp),r=BagCT.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid),l=r?r.count:0;return l>=a&&l>=n.count},e.prototype.isHintNum=function(t){var i=e.ins().getZhanLingDataById(t);if(!i)return!1;var n=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][i.level];if(!n||!n.exp)return!1;var s=BagCT.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid),o=s?s.count:0;return o>=GlobalConfig.ZhanLingConfig.hintNum},e.prototype.isUpGradeByTalent=function(t,i){void 0===i&&(i=!1);var n=e.ins().getZhanLingDataById(t);if(!i&&!n)return!1;var s=GlobalConfig.ZhanLingBase[t];if(!s.mat)return!1;var o=BagCT.ins().getBagItemById(s.mat),a=o?o.count:0,r=this.getZhanLingDataByMat(t,i);return r?a>=r:!1},e.prototype.updateShowZLlist=function(){var t=[];for(var i in GlobalConfig.ZhanLingBase)t.push(GlobalConfig.ZhanLingBase[i]);t.sort(function(t,e){return t.sort<e.sort?-1:1}),this.showZLlist=[];for(var n=0;n<t.length;n++)if(t[n].show){var s=e.ins().getZhanLingDataById(t[n].id);if(s)this.showZLlist.push(t[n]);else{var o=BagCT.ins().getBagItemById(t[n].mat);o&&o.count&&this.showZLlist.push(t[n])}}else this.showZLlist.push(t[n])},e.prototype.getZhanLingItemRedPoint=function(t){var e=this.getZhanLingDataById(t);if(!e)return!1;var i=BagCT.ins().getBagGoodsByType(ItemType.TYPE_21);i&&i.sort(function(t,e){var i=GlobalConfig.ZhanLingEquip[t.configID],n=GlobalConfig.ZhanLingEquip[e.configID];return i.level>n.level?-1:1});for(var n=0;n<e.items.length;n++){var s=n+1,o=e.items[n],a=void 0;o&&(a=GlobalConfig.ZhanLingEquip[o]);for(var r=0;r<i.length;r++){var l=i[r].configID,h=GlobalConfig.ItemConfig[l];if(h){var u=GlobalConfig.ZhanLingEquip[l];if(u&&s==u.pos){var p=h.level?h.level:0,c=h.zsLevel?h.zsLevel:0;if(ZsCT.ins().lv>=c&&Actor.level>=p){if(a){if(u.level>a.level)return!0;break}return!0}}}}}return!1},e.prototype.getStageLv=function(t){var e=Math.floor(t/10),i=Math.floor(t%10);return i?e+=1:t&&t%10==0?i=10:e+=1,[e,i]},e.showTypeList=[AttributeType.atAttack,AttributeType.atMaxHp,AttributeType.atDef,AttributeType.atRes],e}(BaseClass);__reflect(ZhanLingModel.prototype,"ZhanLingModel"),window.ZhanLingModel=ZhanLingModel;var ZhanLingItemRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingEquipSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){this.addEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.id;if(this.equips=this.data.equips,this.bg.source=this.getPosImg(Number(this.name)),this.hun.visible=this.data.posInfo&&this.data.posInfo.zhuHunLv>0,this.bg.visible=!0,this.equip.visible=!this.bg.visible,this.redPoint.visible=this.getRedPoint(),this.data.id){var e=GlobalConfig.ItemConfig[t];e&&(this.quality.source="quality"+ItemUtil.getQuality(e),this.equip.source=e.icon+"_png",this.bg.visible=!1,this.equip.visible=!this.bg.visible)}}},e.prototype.getRedPoint=function(){var t;this.data.id&&(t=GlobalConfig.ZhanLingEquip[this.data.id]);for(var e=0;e<this.equips.length;e++){var i=this.equips[e].configID,n=GlobalConfig.ItemConfig[i];if(n){var s=GlobalConfig.ZhanLingEquip[i];if(s&&Number(this.name)==s.pos){var o=n.level?n.level:0,a=n.zsLevel?n.zsLevel:0;if(ZsCT.ins().lv>=a&&Actor.level>=o)return t?s.level>t.level?(this.bestId=s.id,!0):!1:(this.bestId=s.id,!0)}}}return!1},e.prototype.getPosImg=function(t){var e="zl_equip_bg_"+t;return e},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){if(this.data){if(!this.data.id&&!this.redPoint.visible)return void TipsCT.ins().showTips("没有可穿戴的魔神装备");if(this.data.id&&!this.redPoint.visible){var t=ZhanLingModel.ins().getZhanLingPosData(0,ItemUtil.getSubType(GlobalConfig.ItemConfig[this.data.id]));return void ZhanLing.ins().ZhanLingItemTips(this.data.id,0,!0,t)}return isNaN(this.data.zlId)?void TipsCT.ins().showTips("魔神id异常"):this.bestId?!this.data.id&&this.redPoint.visible?void ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId):void ZhanLing.ins().sendZhanLingWear(this.data.zlId,this.bestId):void TipsCT.ins().showTips("穿戴装备异常")}},e}(BaseItemRender);__reflect(ZhanLingItemRender.prototype,"ZhanLingItemRender"),window.ZhanLingItemRender=ZhanLingItemRender;var ZhanLingItemRender2=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingEquipSkin",e.touchChildren=!1,e}return __extends(e,t),e.prototype.dataChanged=function(){if(this.data){var t=this.data.id;if(this.pos=this.data.pos,this.equips=this.data.equips,this.hun.visible=this.data.posInfo&&this.data.posInfo.zhuHunLv>0,this.bg.source="zl_equip_bg_"+this.pos,this.bg.visible=!0,this.equip.visible=!this.bg.visible,this.redPoint.visible=this.data.redPoint||!1,this.data.id){var e=GlobalConfig.ItemConfig[t];e&&(this.quality.source="quality"+ItemUtil.getQuality(e),this.equip.source=e.icon+"_png",this.bg.visible=!1,this.equip.visible=!this.bg.visible,this.setSelect(this.selected))}}},e.prototype.setSelect=function(t){this.selectFrame.visible=t},e}(BaseItemRender);__reflect(ZhanLingItemRender2.prototype,"ZhanLingItemRender2"),window.ZhanLingItemRender2=ZhanLingItemRender2;var ZhanLingItemTips=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanglingUpTipsSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0],this.itemid=t[1];var i=GlobalConfig.ItemConfig[this.itemid];this.itemIcon.setData(i),this.nameLabel.textFlow=TextFlowMaker.generateTextFlow1(i.name);var n=ZhanLingModel.ins().getZhanLingDataByDrug(this.id,this.itemid),s=205001==this.itemid?0:1,o=ExpansionCardCT.ins().useData,a=0;if(o&&o[s])a=ExpansionCardCT.ins().useData[s].maxNum;else{var r=ZhanLingModel.ins().getZhanLingDataByLevel(this.id),l=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.id].type][r];a=l.maxCount[this.itemid]}var h=n>=a?65280:16711680;this.use.textFlow=TextFlowMaker.generateTextFlow1("|C:"+h+"&T:"+n+"|/"+a);var u=BagCT.ins().getBagItemById(this.itemid);this.num.text=u?""+u.count:"0";var p=ZhanLingModel.ins().getZhanLingDataByStage(this.id)+1;10*p>CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.id].type])?DisplayUtils.removeFromParent(this.info):this.num0.text=p+"阶1星";var c=GlobalConfig.ZhanLingConfig.upgradeInfo[this.itemid],d=AttributeData.getAttStr(c.attr,0,1,"+");c.precent&&(d+="\n魔神基础属性+"+c.precent/100+"%"),this.attr.text=d},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZhanLingItemTips.prototype,"ZhanLingItemTips"),ViewManager.ins().reg(ZhanLingItemTips,LayerManager.UI_Popup),window.ZhanLingItemTips=ZhanLingItemTips;var ZhanLingPanel=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.removeDisplay=function(){Timer.stop(this.checkUpdate,this),Timer.stop(this.autoUpStar,this)},e.prototype.addDisplay=function(){this.addTouchEvent(this,this.onEvent),this.addTouchEvent(this.checkBoxs,this.updateCost),this.addTouchEvent(this.checkBoxs,this.updateModel),this.addTouchEvent(this.icon,this.showIconTips),this.list.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSoulClick,this),this.observe(BagCT.ins().postItemAdd,this.timerUpdate),this.observe(BagCT.ins().postItemDel,this.timerUpdate),this.observe(BagCT.ins().postItemCountChange,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingInfo,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingUpExp,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingDrug,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingWear,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingSkinUpGrade,this.timerUpdate),this.observe(ZhanLing.ins().postZhangLingSkinChange,this.timerUpdate),this.observe(ZhanLing.ins().postZhanLingUpgrade,this.stopUpGrade),this.list.itemRenderer=ZhanLingSkinItem,this.list.useVirtualLayout=!1,this.listData=new eui.ArrayCollection,this.list.dataProvider=this.listData,this.zlId=ZhanLingModel.ins().ZhanLingSkinId,this._tick=0,this.postEvent=Math.floor(150/GlobalConfig.ZhanLingConfig.unitTime);for(var t=0;t<GlobalConfig.ZhanLingBase[this.zlId].skill.length;t++)this.addTouchEvent(this["skillIcon"+(t+1)],this.onSkillEvent);for(var e in GlobalConfig.ZhanLingConfig.upgradeInfo){var i=GlobalConfig.ZhanLingConfig.upgradeInfo[e].sort;this.addTouchEvent(this["up"+i],this.onDrugEvent)
}this.addEvent(eui.UIEvent.CHANGE_END,this.listScroller,this.onChange),this.isAutoUp=!1,this.roleSelect.hideRole(),this.init(),Timer.start(500,0,this.checkUpdate,this),this.upBtn.label=this.isAutoUp?"取 消":"一键升星",this.shengzhu.visible=ZhanLing.ins().checkShenZhuOpen(),this.getItemTxt.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.getItemTxt.text+"</u>")},e.prototype.checkUpdate=function(){var t=this;this._tick&&this._tick<=this.postEvent&&(this._tick=0,egret.callLater(function(){t.updateUI()},this))},e.prototype.timerUpdate=function(){var t=this;this._tick++,this._tick&&this._tick>this.postEvent&&(this._tick=0,egret.callLater(function(){t.updateUI()},this))},e.prototype.init=function(){this.updateUI(!0)},e.prototype.updateState=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=t?t.level:0,i=CommonUtils.getObjectLength(GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.zlId].type])-1;this.zlId?e>=i?this.currentState="skin_max":this.currentState="skin_up":e>=i?this.currentState="zl_max":this.currentState="zl_up",this.validateNow()},e.prototype.updateUI=function(t){this.updateState(),this.updateTop(t),this.updateItem(),this.updateSkill(),this.updateValue(),this.updateDown(),this.updateCost(),this.updateRedPoint()},e.prototype.updateTop=function(t){if(this.listData.replaceAll(ZhanLingModel.ins().showZLlist),this.list.validateNow(),this.zlId||0==this.zlId)for(var e=0;e<this.list.numElements;e++){var i=this.list.getVirtualElementAt(e),n=this.list.dataProvider.getItemAt(e);if(n.id==this.zlId){if(i.setSelect(!0),t){var s=this.zlId;this.list.scrollH=this.list.contentWidth>528?60*e:0,e>3&&(this.listScroller.stopAnimation(),s=Math.floor((e+1)/4)*i.height),this.setStartPosition(s)}break}}this.onChange(),this.huanhua.visible=!!ZhanLingModel.ins().getZhanLingDataById(this.zlId),this.huanhua.icon=ZhanLingModel.ins().ZhanLingSkinId==this.zlId?"zl_quxiao_btn":"zl_huanhua_btn";var o=GlobalConfig.ZhanLingConfig;for(var a in o.upgradeInfo){var e=o.upgradeInfo[a].sort,r=ZhanLingModel.ins().showDrue(this.zlId,Number(a));this["up"+e]&&(this["up"+e].icon=GlobalConfig.ItemConfig[a].icon+"_png",this["up"+e].visible=r,this["upbg"+e].visible=r),this["redPoint"+e]&&(this["redPoint"+e].visible=ZhanLingModel.ins().getZhanLingDataByDrugUse(this.zlId,Number(a))),this["used"+e]&&(this["used"+e].text=ZhanLingModel.ins().getZhanLingDataByDrug(this.zlId,Number(a)),this["used"+e].visible=r)}var l=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),h=Math.max(Math.ceil(l/10),1),u=0==l?0:l%10!=0?l%10:10;this.lv.data=StringUtils.NumberToChinese(h)+"阶"+StringUtils.NumberToChinese(u)+"星",this.model||(this.model=new MovieClip),this.model.parent||this.zhanling.addChild(this.model),this.updateModel()},e.prototype.updateModel=function(){var t=GlobalConfig.ZhanLingBase[this.zlId];this.zhanlingName.source=t.zlName;var e=t.innerAppearance;this.model.name!=RES_DIR_EFF+e&&this.model.playFile(RES_DIR_EFF+e,-1)},e.prototype.updateItem=function(){var t=BagCT.ins().getBagGoodsByType(ItemType.TYPE_21),e=0;t&&t.sort(this.sort);for(var i=1;i<=GlobalConfig.ZhanLingConfig.equipPosCount;i++){this["item"+i].name=i.toString();var n=ZhanLingModel.ins().getZhanLingDataByItem(e,i),s=ZhanLingModel.ins().getZhanLingPosData(e,i);this["item"+i].data={zlId:e,id:n,equips:t,posInfo:s}}},e.prototype.updateSkill=function(){var t=GlobalConfig.ZhanLingBase[this.zlId];if(t){var e=t.talent,i=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId),n=GlobalConfig.ZhanLingTalent[e][i];n||(n=GlobalConfig.ZhanLingTalent[e][1]),n.talentDesc&&n.talentDesc.icon?this.skillIcon0.source=n.talentDesc.icon:n.passive&&(this.skillIcon0.source=1e3*Math.floor(n.passive[0].id/1e3)+"_png");for(var s=0;s<GlobalConfig.ZhanLingBase[this.zlId].skill.length;s++){var o=GlobalConfig.ZhanLingBase[this.zlId].skill[s].id,a=GlobalConfig.ZhanLingSkill[o];a.desc&&a.desc.icon?this["skillIcon"+(s+1)].source=a.desc.icon:this["skillIcon"+(s+1)].source=1e3*Math.floor(a.passive/1e3)+"_png"}this.blackImg0.visible=!i;for(var r=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),s=0;s<GlobalConfig.ZhanLingBase[this.zlId].skill.length;s++){var l=GlobalConfig.ZhanLingBase[this.zlId].skill[s];this["blackImg"+(s+1)].visible=l.open>r}}},e.prototype.updateValue=function(){var t=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),e=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.zlId].type][t];if(e){var i=ZhanLingModel.ins().getZhanLingPower(this.zlId),n=i[0]?i[0]:0;this.powerPanel.setPower(n),i[1].length||(i[1]=this.getEmptyAttrs(this.zlId)),i[2].length||(i[2]=this.getEmptyAttrs(this.zlId,!0));var s=AttributeData.getAttStr(i[1],0,1,"：")+"\n",o=AttributeData.getAttStr(i[2],0,1,"：")+"\n";this.curAtt.text=s,this.nextAtt.text=o}},e.prototype.getEmptyAttrs=function(t,e){var i=[],n=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[t].type][0];if(i=ZhanLingModel.ins().addAttrs(i,AttributeData.getAttrFromCfg(n)),!e)for(var s=0;s<i.length;s++)i[s].value=0;return i},e.prototype.updateDown=function(t){if(void 0===t&&(t=0),this.zlId||0==this.zlId){var e=ZhanLingModel.ins().getZhanLingDataById(this.zlId);if(this.starGroup.visible=this.barGroup.visible=!!e,!e)return}this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0),this.starList.parent||this.starGroup.addChild(this.starList);var i=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),n=Math.floor(i%10);if(i){var s=n;s||(n=10)}this.starList.setStarNum(n,t),this.barbc||(this.barbc=new ProgressBarEff,this.barbc.setWidth(525)),this.barbc.parent||this.barGroup.addChild(this.barbc);var o=ZhanLingModel.ins().getZhanLingDataByExp(this.zlId),a=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.zlId].type][i];a&&(this.barbc.reset(),this.barbc.setData(o,a.exp))},e.prototype.updateCost=function(){var t=this.getCostValue(),e=t[0],i=t[1],n=e>=i?65280:16711680;this.countLabel.textFlow=TextFlowMaker.generateTextFlow1("|C:"+n+"&T:"+e+"|/"+i),this.upBtn.visible=!!ZhanLingModel.ins().getZhanLingDataById(this.zlId),this.upBtnEx.visible=!this.upBtn.visible},e.prototype.getCostValue=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=GlobalConfig.ZhanLingBase[this.zlId];if(this.checkBoxs.visible=!0,this.getItemTxt.visible=!1,this.costType=ItemType.TYPE_1,t||!e.mat){var i=0,n=0,s=ZhanLingModel.ins().getZhanLingDataByLevel(this.zlId),o=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.zlId].type][s],a=GlobalConfig.ItemConfig[GlobalConfig.ZhanLingConfig.stageitemid];this.icon.source=a.icon+"_png";var r=BagCT.ins().getBagItemById(GlobalConfig.ZhanLingConfig.stageitemid);return i=r?r.count:0,n=o.count,this.checkBoxs.selected&&n>i&&(i=Actor.yb,this.icon.source="szyuanbao",n=GlobalConfig.ZhanLingConfig.unitPrice*o.count,this.costType=MoneyConst.yuanbao),this.costCount=n,[i,n]}var l=GlobalConfig.ItemConfig[e.mat];this.icon.source=l.icon+"_png";var h=BagCT.ins().getBagItemById(e.mat),u=h?h.count:0,p=GlobalConfig.ZhanLingTalent[this.zlId][1],c=p.costCount;return this.checkBoxs.visible=!1,this.getItemTxt.visible=!0,this.costType=ItemType.TYPE_22,this.costCount=c,[u,c]},e.prototype.updateRedPoint=function(){for(var t=0;5>t;t++)this["skillRedPoint"+t]&&(this["skillRedPoint"+t].visible=!1);if(this.hhRedPoint.visible=!1,this.shenZhuRedPoint.visible=ZhanLingRedPoint.ins().redPoint,this.upRedPoint.visible=ZhanLingModel.ins().isUpGradeByStar(this.zlId)||ZhanLingModel.ins().isHintNum(this.zlId),this.skillRedPoint0.visible=ZhanLingModel.ins().isUpGradeByTalent(this.zlId),this.hxRedPoint){this.hxRedPoint.visible=!1}},e.prototype.onSoulClick=function(t){if(t&&t.itemRenderer&&t.item){var e=t.item;this.zlId=e.id,this.updateUI()}},e.prototype.onSkillEvent=function(t){for(var e=0;e<GlobalConfig.ZhanLingBase[this.zlId].skill.length;e++)if(t.currentTarget==this["skillIcon"+(e+1)]){var i=GlobalConfig.ZhanLingBase[this.zlId].skill[e];ViewManager.ins().open(ZhanLingTips,this.zlId,i.id);break}},e.prototype.onDrugEvent=function(t){for(var e in GlobalConfig.ZhanLingConfig.upgradeInfo){var i=GlobalConfig.ZhanLingConfig.upgradeInfo[e].sort;if(t.currentTarget==this["up"+i]){var n=this.getDrugItemByIndex(i);this["redPoint"+i].visible?ZhanLing.ins().sendZhanLingDrug(this.zlId,n):ViewManager.ins().open(ZhanLingItemTips,this.zlId,n)}}},e.prototype.onEvent=function(t){var e=this,i=420,n=0;switch(t.target){case this.closeBtn:ViewManager.ins().close(this);break;case this.detail:break;case this.suit:ViewManager.ins().open(ZhanLingSuitTip,0);break;case this.shengzhu:ViewManager.ins().open(ZhanLingShenzhuWin),ViewManager.ins().close(SkillWin);break;case this.huanxing:break;case this.upBtn:this.sendUpGrade();break;case this.upBtnEx:this.upRedPoint.visible?ZhanLing.ins().sendZhanLingSkinUpGrade(this.zlId):TipsCT.ins().showTips("|C:0xff0000&T:材料不足");break;case this.skillIcon0:if(this.skillRedPoint0&&this.skillRedPoint0.visible){var s=ZhanLingModel.ins().getZhanLingDataByTalentId(this.zlId),o=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.zlId),a=GlobalConfig.ZhanLingTalent[s][o+1],r=GlobalConfig.ZhanLingBase[this.zlId],l=GlobalConfig.ItemConfig[r.mat],h=WarnWin.show("是否消耗|C:0x00ff00&T:"+l.name+"皮肤*"+a.costCount+"|升级天赋？",null,null,function(){ZhanLing.ins().sendZhanLingSkinUpGrade(e.zlId)},this);h.setBtnLabel("取消","确定")}else ViewManager.ins().open(ZhanLingTips,this.zlId);break;case this.btn0:n=this.list.scrollV-i,n=84*Math.round(n/84),0>n&&(n=0),this.list.scrollH=this.list.contentHeight,this.onChange();break;case this.btn1:n=this.list.scrollV+i,n=84*Math.round(n/84),n>this.list.contentHeight-this.listScroller.height&&(n=this.list.contentHeight-this.listScroller.height),this.list.scrollH=n,this.onChange();break;case this.huanhua:if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId))return void TipsCT.ins().showTips("|C:0xff0000&T:皮肤未激活");var u=this.zlId;ZhanLingModel.ins().ZhanLingSkinId==u&&(u=0),ZhanLing.ins().sendZhangLingSkinChange(u);break;case this.help:ViewManager.ins().open(CommonHelpWin,GlobalConfig.HelpInfoConfig[35].text);break;case this.getItemTxt:if(this.costType==ItemType.TYPE_22){var p=GlobalConfig.ZhanLingBase[this.zlId].mat;ViewManager.ins().open(ShopGoodsWarn).setData(p)}}},e.prototype.sendUpGrade=function(){if(this.isAutoUp=!this.isAutoUp,this.isAutoUp){if(!this.checkUpStar())return void(this.isAutoUp=!1);this.updateModel(),Timer.start(GlobalConfig.ZhanLingConfig.unitTime,0,this.autoUpStar,this)}else Timer.stop(this.autoUpStar,this);this.upBtn.label=this.isAutoUp?"取 消":"一键升星"},e.prototype.stopUpGrade=function(){this.isAutoUp=!1,Timer.stop(this.autoUpStar,this),this.upBtn.label=this.isAutoUp?"取 消":"一键升星",this.updateDown(1),this.updateModel()},e.prototype.showIconTips=function(){var t=MoneyConst.yuanbao;switch(this.costType){case MoneyConst.yuanbao:ViewManager.ins().open(ItemCurrencyWin,t,this.costCount);break;case ItemType.TYPE_1:t=GlobalConfig.ZhanLingConfig.stageitemid,ViewManager.ins().open(ItemDetailedWin,0,t,this.costCount);break;case ItemType.TYPE_22:t=GlobalConfig.ZhanLingBase[this.zlId].mat,ViewManager.ins().open(ZhanlingZBTipWin,t)}},e.prototype.autoUpStar=function(){if(this.isAutoUp){var t=this.checkBoxs.selected?1:0;if(!this._tick&&!this.checkUpStar())return this.isAutoUp=!1,void Timer.stop(this.autoUpStar,this);ZhanLing.ins().sendZhanLingUpExp(this.zlId,t)}},e.prototype.checkUpStar=function(){if("skin_max"==this.currentState||"zl_max"==this.currentState)return TipsCT.ins().showTips("|C:0xff0000&T:已满级"),this.upBtn.label="一键升星",!1;if(!ZhanLingModel.ins().getZhanLingDataById(this.zlId))return TipsCT.ins().showTips("|C:0xff0000&T:皮肤未激活"),this.upBtn.label="一键升星",!1;var t=this.checkBoxs.selected?1:0,e=this.getCostValue(),i=e[0],n=e[1];if(!i||n>i){if(!t)return TipsCT.ins().showTips("|C:0xff0000&T:魔神进阶丹不足,可勾选自动兑换升级"),this.upBtn.label="一键升星",!1;if(i=Actor.yb,n=GlobalConfig.ZhanLingConfig.unitPrice*n,!i||n>i)return TipsCT.ins().showTips("|C:0xff0000&T:元宝不足"),this.upBtn.label="一键升星",!1}return this.upBtn.label="取 消",!0},e.prototype.sort=function(t,e){var i=GlobalConfig.ZhanLingEquip[t.configID],n=GlobalConfig.ZhanLingEquip[e.configID];return Algorithm.sortDesc(i.level,n.level)},e.prototype.onChange=function(){this.btn1.visible=!1,this.btn0.visible=!1,this.list.scrollH<39?this.list.contentWidth>528&&(this.btn1.visible=!1,this.btn0.visible=!0):this.list.scrollH>=this.list.contentWidth-this.list.width-39?this.list.contentWidth>528&&(this.btn1.visible=!0,this.btn0.visible=!1):(this.btn1.visible=!0,this.btn0.visible=!0),this.rightRed0.visible=this.btn0.visible?this.hxRedPoint.visible:!1,this.rightRed1.visible=this.btn1.visible?this.hxRedPoint.visible:!1},e.prototype.setStartPosition=function(t){if(this.listScroller.height>=this.list.contentHeight)t=0;else{var e=this.list.contentHeight-this.listScroller.height;e=e>0?e:0,t>=e&&(t=e)}this.list.scrollV=t},e.prototype.getDrugItemByIndex=function(t){var e=0,i=GlobalConfig.ZhanLingConfig;for(var n in i.upgradeInfo){var s=i.upgradeInfo[n].sort;if(s==t){e=Number(n);break}}return e},e}(BaseView);__reflect(ZhanLingPanel.prototype,"ZhanLingPanel"),window.ZhanLingPanel=ZhanLingPanel;var ZhanlingShenLianPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zlId=0,e.hasEnough=!1,e.costItemId=0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.initStar(),this.link.textFlow=(new egret.HtmlTextParser).parser("<u>"+this.link.text+"</u>"),this.eList.itemRenderer=ZhanLingItemRender2,this.listDt=new eui.ArrayCollection,this.eList.dataProvider=this.listDt,this.curSelectPos=0,this.nowAttrCenter=this.eLeftGroup.horizontalCenter,this.show.touchChildren=!1,this.addTouchEvent(this,this.onClick)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ZhanLing.ins().postZhanLingShenLian,this.updateLevel),this.observe(ZhanLingRedPoint.ins().postRedPoint,this.updateRedPoint),this.update(),this.setSelectPos(1)},e.prototype.onClick=function(t){if(t.target instanceof ZhanLingItemRender2)return void this.setSelectPos(t.target.pos);switch(t.target){case this.soulBtn:var e=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,this.curSelectPos);0==e?TipsCT.ins().showTips("没有装备"):this.hasEnough?ZhanLing.ins().sendZhanLingShenLian(this.zlId,this.curSelectPos):TipsCT.ins().showTips("材料不足");break;case this.link:0!=this.costItemId&&WarnCT.ins().setBuyGoodsWarn(this.costItemId,1);break;case this.show:if(this.show.data&&this.show.data>0){var i=ZhanLingModel.ins().getZhanLingPosData(this.zlId,this.curSelectPos);ZhanLing.ins().ZhanLingItemTips(this.show.data,0,!0,i)}}},e.prototype.update=function(){this.updateList(),this.updateLevel()},e.prototype.updateRedPoint=function(){this.updateList()},e.prototype.setSelectPos=function(t){if(this.curSelectPos!=t){var e=this.eList.getElementAt(this.curSelectPos-1);e&&e.setSelect(!1),e=this.eList.getElementAt(t-1),e&&e.setSelect(!0),this.curSelectPos=t,this.updateLevel()}},e.prototype.updateLevel=function(t){void 0===t&&(t=0);var e=ZhanLingModel.ins().getZhanLingDataById(this.zlId),i=e.getPosInfoBy(this.curSelectPos);this.updateCurItemUI(),this.updateStar(i,t),this.updateAttr(i)},e.prototype.updateList=function(){for(var t=ZhanLingModel.ins().getZhanLingDataById(0),e=[],i=1;i<=t.items.length;i++){var n=ZhanLingModel.ins().getZhanLingPosData(this.zlId,i),s=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,i);e.push({zlId:this.zlId,id:s,pos:i,posInfo:n,redPoint:ZhanLingRedPoint.ins().itemSLRedPoint[i]})}this.listDt.source=e,this.eList.validateNow()},e.prototype.updateCurItemUI=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,this.curSelectPos),i=t.getPosInfoBy(this.curSelectPos);if(0!=e){this.show.data=e,this.show.setTag(i.zhuHunLv>0?"zlzh_hun_png":"");var n=GlobalConfig.ItemConfig[e];this.show.setName(i&&i.zhuHunLv>0?"铸魂 "+GlobalFun.getRomanNumStr(i.zhuHunLv)+"."+n.name:n.name),this.show.visible=!0}else this.show.visible=!1;this.level.source="zlsl_"+(i?i.shenLianStage:1)+"_png"},e.prototype.updateAttr=function(t){if(t){var e=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,this.curSelectPos),i=GlobalConfig.ZhanLingEquip[e];if(!i)return this.eItemGroup.visible=this.eFullLab.visible=this.soulBtn.visible=this.arrow.visible=!1,this.nowPowerPanel.setPower(0),this.nextPowerPanel.setPower(0),this.nextAttr.text=this.nowAttr.text="",void(this.chainGroup.visible=!1);var n=GlobalConfig.ZhanLingShenLianLevel[this.curSelectPos],s=n[t.shenLianStage][t.shenLianLv],o=n[t.shenLianStage][t.shenLianLv+1];if(!o){var a=n[t.shenLianStage+1];a&&(o=n[t.shenLianStage+1][0])}var r=!o;if(this.nowAttr.text=AttributeData.getAttStr(s.attr,4,1,":"),r)this.eLeftGroup.horizontalCenter=0,this.eNextChainLab.text="",this.costItemId=0;else{this.nextAttr.text=AttributeData.getAttStr(o.attr,4,1,":"),this.eLeftGroup.horizontalCenter=this.nowAttrCenter;var l=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,o.cost.id);this.hasEnough=l>=o.cost.count,this.costItemId=o.cost.id;var h=this.hasEnough?ColorUtil.GREEN:ColorUtil.RED,u='<font color="'+h+'">'+l+"</font>/"+o.cost.count;this.costCount.textFlow=(new egret.HtmlTextParser).parser(u),this.costImg.source=GlobalConfig.ItemConfig[o.cost.id].icon+"_png";var p=n[t.shenLianStage+1]?n[t.shenLianStage+1][0]:null;this.eNextChainLab.text=p?"（下级"+(p.precent+1e4)/100+"%）":"";var c=AttributeData.getPercentAttr(i.attrs,o.precent/1e4-1),d=AttributeData.AttrAddition(o.attr,c);this.nextPowerPanel.setPower(BagCT.getAttrPower(d)*SubRoles.ins().subRolesLen)}var g=AttributeData.getPercentAttr(i.attrs,s.precent/1e4-1),f=AttributeData.AttrAddition(s.attr,g);this.nowPowerPanel.setPower(BagCT.getAttrPower(f)*SubRoles.ins().subRolesLen),this.soulBtn.label=10==this.starList.starNum?"升 阶":"神 炼",this.link.visible=this.eItemGroup.visible=!r&&10!=this.starList.starNum,this.soulBtn.visible=this.arrow.visible=this.eRightGroup.visible=!r,this.eFullLab.visible=r,this.eChainTitle.text="【神炼Lv"+(t.shenLianStage-1)+"】",this.eChainLab.text="为当前部位炼入神之血，提升基础属性至"+(s.precent+1e4)/100+"%"}},e.prototype.initStar=function(){this.starList||(this.starList=new StarList(10),this.starList.horizontalCenter=0),this.starList.parent||this.starGroup.addChild(this.starList)},e.prototype.updateStar=function(t,e){void 0===e&&(e=0),this.starList&&t&&this.starList.setStarNum(t.shenLianLv,e)},__decorate([callLater],e.prototype,"updateRedPoint",null),__decorate([callLater],e.prototype,"updateLevel",null),e}(BaseView);__reflect(ZhanlingShenLianPanel.prototype,"ZhanlingShenLianPanel"),window.ZhanlingShenLianPanel=ZhanlingShenLianPanel;var ZhanLingShenzhuWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZhanglingShengzhuSkin",e.isTopLevel=!0,e}return __extends(e,t),e.prototype.skinComplete=function(){this.addChangeEvent(this.tab,this.onTabTouch)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ZhanLingRedPoint.ins().postRedPoint,this.updateRedPoint),this.updateRedPoint()},e.prototype.updateRedPoint=function(){this.redPoint1.visible=ZhanLingRedPoint.ins().slRedPoint,this.redPoint2.visible=ZhanLingRedPoint.ins().zhRedPoint},e.prototype.onTabTouch=function(t){this.setOpenIndex(this.tab.selectedIndex)},e.prototype.setOpenIndex=function(t){switch(this.viewStack.getElementAt(t)){case this.shenLianPanel:this.eTitle.source="zlsl_title_png";break;case this.shenLianPanel:this.eTitle.source="zlzh_title_png"}},e.openCheck=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ZhanLing.ins().checkShenZhuOpen()||TipsCT.ins().showTips("开服60天且9转开启"),!0},e}(BaseEuiView);__reflect(ZhanLingShenzhuWin.prototype,"ZhanLingShenzhuWin"),window.ZhanLingShenzhuWin=ZhanLingShenzhuWin,ViewManager.ins().reg(ZhanLingShenzhuWin,LayerManager.UI_Main);var ZhanLingSkinItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){if(this.data){var t=this.data.id,e=GlobalConfig.ZhanLingBase[t];if(e){var i=ZhanLingModel.ins().getZhanLingDataByLevel(t);this.icon.source=e.icon||"zl_skin_1",this.state.visible=ZhanLingModel.ins().getZhanLingDataById(t)?!1:!0,this.change.visible=ZhanLingModel.ins().ZhanLingSkinId==t,this.select.visible=!1,this.eLabel&&(this.eLabel.text=i+"",this.eLabel.visible=!this.state.visible);var n=ZhanLingModel.ins().isUpGradeByStar(t)||ZhanLingModel.ins().isHintNum(t);n||(n=ZhanLingModel.ins().isUpGradeByTalent(t)),this.redPoint.visible=n}}},e.prototype.destruct=function(){},e.prototype.setSelect=function(t){this.select.visible=t},e}(BaseItemRender);__reflect(ZhanLingSkinItem.prototype,"ZhanLingSkinItem"),window.ZhanLingSkinItem=ZhanLingSkinItem;var ZhanLingSuitTip=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingSuitTipsSkin",e}return __extends(e,t),e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0];var i=ZhanLingModel.ins().getZhanLingDataBySuit(this.id),n=CommonUtils.getObjectLength(GlobalConfig.ZhanLingSuit),s=GlobalConfig.ZhanLingConfig.equipPosCount,o=0;i?(o=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,i),i>=n&&o>=s?this.currentState="max":this.currentState="active"):(this.currentState="unactive",i=1,o=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,i)),this.validateNow();var a=GlobalConfig.ZhanLingSuit[i],r=StringUtils.replace(a.suitCondition,""+o,""+s);"unactive"==this.currentState&&(this.content0.textFlow=TextFlowMaker.generateTextFlow1(r));var l=AttributeData.getAttStr(a.attrs,0,1,"+");if(l+="\n魔神基础属性+"+a.precent/100+"%",this.attr0.text=l,this.name0.text=a.suitTname,"active"==this.currentState){var h=GlobalConfig.ZhanLingSuit[i+1];o=ZhanLingModel.ins().getZhanLingDataBySuitCount(this.id,i+1),r=StringUtils.replace(h.suitCondition,""+o,""+s),this.content1.textFlow=TextFlowMaker.generateTextFlow1(r);var u=AttributeData.getAttStr(h.attrs,0,1,"+");u+="\n魔神基础属性+"+h.precent/100+"%",this.attr1.text=u,this.name1.text=h.suitTname}},e}(BaseEuiView);__reflect(ZhanLingSuitTip.prototype,"ZhanLingSuitTip"),ViewManager.ins().reg(ZhanLingSuitTip,LayerManager.UI_Popup),window.ZhanLingSuitTip=ZhanLingSuitTip;var ZhanLingTips=function(t){function e(){var e=t.call(this)||this;return e._sn_="ZhanlingSkillTipsSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.addTouchEvent(this.bgClose,this.otherClose),this.id=t[0]||0,this.skillid=t[1];var i={name:"",desc:"",lock:""},n={name:"",desc:"",lock:""},s="";if(this.skillid){s="unactive";for(var o=ZhanLingModel.ins().getZhanLingDataById(this.id),a=GlobalConfig.ZhanLingBase[this.id],r=ZhanLingModel.ins().getZhanLingDataByLevel(this.id),l=0;l<a.skill.length;l++)if(a.skill[l].id==this.skillid){var h=GlobalConfig.ZhanLingSkill[a.skill[l].id],u=GlobalConfig.SkillsConfig[h.passive];if(!o||r<a.skill[l].open){var p=Math.floor(a.skill[l].open/10),c=Math.floor(a.skill[l].open%10);c?p+=1:a.skill[l].open&&a.skill[l].open%10==0?c=10:p+=1,u&&(i.name=SkillUtil.getName(u),i.desc=SkillUtil.getDesc(u)),i.lock=p+"阶"+c+"星"}else s="max",u&&(i.name=SkillUtil.getName(u),i.desc=SkillUtil.getDesc(u));h.desc&&h.desc.name&&(i.name=h.desc.name),h.desc&&h.desc.desc&&(i.desc=h.desc.desc),h.attrs&&(i.desc&&(i.desc+="\n"),i.desc+="|C:0xff00ff&T:"+AttributeData.getAttStr(h.attrs,0,1,"：")+"|");break}}else{var d=ZhanLingModel.ins().getZhanLingDataByTalentId(this.id),g=ZhanLingModel.ins().getZhanLingDataByTalentLv(this.id),f=CommonUtils.getObjectLength(GlobalConfig.ZhanLingTalent[d]),v=GlobalConfig.ZhanLingTalent[d][g];if(v)if(g>=f)s="max";else{s="active";var y=GlobalConfig.ZhanLingBase[this.id],m=GlobalConfig.ItemConfig[y.mat],T=GlobalConfig.ZhanLingTalent[d][g+1];if(T.talentDesc)if(n.name=T.talentDesc.name,n.desc=StringUtils.replace(T.talentDesc.desc,""+T.rate/100),T.costCount)n.lock="|C:0xFFFFCC&T:升级条件:|C:0xff0000&T:"+m.name+"皮肤*"+T.costCount,DisplayUtils.removeFromParent(this.lock1);else{var C=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);C&&(n.lock=C[0]+"阶"+C[1]+"星")}else{var b=T.passive[0].id,I=GlobalConfig.SkillsConfig[b];if(n.name=SkillUtil.getName(I),n.desc=SkillUtil.getDesc(I),T.costCount)n.lock="|C:0xFFFFCC&T:升级条件:|C:0xff0000&T:"+m.name+"皮肤*"+T.costCount,DisplayUtils.removeFromParent(this.lock1);else{var C=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);C&&(n.lock=C[0]+"阶"+C[1]+"星")}}}else if(s="unactive",v=GlobalConfig.ZhanLingTalent[d][1],v.costCount)i.lock="激活皮肤后";else{var C=ZhanLingModel.ins().getZhanLingDataByNextStage(this.id);C&&(i.lock=C[0]+"阶"+C[1]+"星")}if(v.talentDesc)i.name=v.talentDesc.name,i.desc=StringUtils.replace(v.talentDesc.desc,""+v.rate/100);else{var b=v.passive[0].id,w=GlobalConfig.SkillsConfig[b];i.name=SkillUtil.getName(w),i.desc=SkillUtil.getDesc(w)}}this.currentState=s,this.validateNow(),this.skillName0.textFlow=TextFlowMaker.generateTextFlow1(i.name),this.skillDesc0.textFlow=TextFlowMaker.generateTextFlow1(i.desc),i.lock?this.condition0.textFlow=TextFlowMaker.generateTextFlow1(i.lock):DisplayUtils.removeFromParent(this.condition0.parent),n.name&&("active"==s?(this.skillName1.textFlow=TextFlowMaker.generateTextFlow1(n.name),this.skillDesc1.textFlow=TextFlowMaker.generateTextFlow1(n.desc),n.lock?this.condition1.textFlow=TextFlowMaker.generateTextFlow1(n.lock):DisplayUtils.removeFromParent(this.condition1.parent)):DisplayUtils.removeFromParent(this.nextGroup))},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZhanLingTips.prototype,"ZhanLingTips"),ViewManager.ins().reg(ZhanLingTips,LayerManager.UI_Popup),window.ZhanLingTips=ZhanLingTips;var ZhanlingZBTipItemsRender=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZhanlingZBTipItemsSkin",e.init(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.dataChanged=function(){if(this.data){var t=this.data.zlId,e=this.data.id,i=GlobalConfig.ZhanLingSkill[e];i.desc&&i.desc.icon?this.skillIcon1.source=i.desc.icon:this.skillIcon1.source=1e3*Math.floor(i.passive/1e3)+"_png";for(var n=GlobalConfig.ZhanLingBase[t],s=0,o=0;o<n.skill.length;o++)if(n.skill[o].id==e){s=n.skill[o].open;break}var a=GlobalConfig.SkillsConfig[i.passive],r={name:"",desc:""};a&&(r.name=SkillUtil.getName(a),r.desc=SkillUtil.getDesc(a)),i.desc&&i.desc.name&&(r.name=i.desc.name),i.desc&&i.desc.desc&&(r.desc=i.desc.desc),i.attrs&&(r.desc&&(r.desc+="\n"),r.desc+="|C:0xff00ff&T:"+AttributeData.getAttStr(i.attrs,0,1,"：")+"|");var l=ZhanLingModel.ins().getStageLv(s);this.desc.textFlow=TextFlowMaker.generateTextFlow1(l[0]+"阶习得技能|C:0xff00ff&T:【"+r.name+"】\n"+r.desc)}},e.prototype.destruct=function(){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onClick,this)},e.prototype.onClick=function(){},e}(BaseItemRender);__reflect(ZhanlingZBTipItemsRender.prototype,"ZhanlingZBTipItemsRender"),window.ZhanlingZBTipItemsRender=ZhanlingZBTipItemsRender;var ZhanlingZBTipWin=function(t){function e(){var e=t.call(this)||this;return e._sn_="ZhanlingZBTipsSkin",e}return __extends(e,t),e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEndEvent(this,this.otherClose),this.gainList.itemRenderer=GainGoodsItem,this.gainList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTouchList,this),this.skillList.itemRenderer=ZhanlingZBTipItemsRender,this.itemid=t[0];for(var i in GlobalConfig.ZhanLingBase){var n=GlobalConfig.ZhanLingBase[i];if(n.mat==this.itemid){this.zlId=n.id;break}}this.zhanlingName.source=GlobalConfig.ZhanLingBase[this.zlId].zlName,this.model||(this.model=new MovieClip),this.model.parent||this.zhanling.addChild(this.model);var s=GlobalConfig.ZhanLingBase[this.zlId].innerAppearance;this.model.name!=RES_DIR_EFF+s&&this.model.playFile(RES_DIR_EFF+s,-1),this.bottomMc||(this.bottomMc=new MovieClip),this.bottomMc.parent||this.bottomD.addChild(this.bottomMc);var o=GlobalConfig.ItemConfig[this.itemid];this.itemname.textFlow=TextFlowMaker.generateTextFlow1("|C:"+ItemUtil.getQualityColor(o)+"&T:"+o.name);var a=ItemUtil.getQuality(o);this.quali.source=a>0?"quali"+a:"";var r=GlobalConfig.ZhanLingBase[this.zlId],l=GlobalConfig.ZhanLingTalent[r.talent][1];l||(l=GlobalConfig.ZhanLingTalent[r.talent][1]);var h="激活后获得强力天赋:";if(l.talentDesc&&l.talentDesc.icon)this.skillIcon0.source=l.talentDesc.icon,l.talentDesc.desc&&(h+=l.talentDesc.desc);else{l.passive&&(this.skillIcon0.source=1e3*Math.floor(l.passive[0].id/1e3)+"_png");var u=GlobalConfig.SkillsConfig[l.passive[0].id];h+=SkillUtil.getDesc(u)}this.desc.textFlow=TextFlowMaker.generateTextFlow1(h);for(var p=3,c=GlobalConfig.ZhanLingLevel[GlobalConfig.ZhanLingBase[this.zlId].type][0],d=BagCT.getAttrPower(AttributeData.getAttrFromCfg(c))*p,g=(l.expower+BagCT.getAttrPower(l.attrs?l.attrs:[]))*p,f=[],v=0;v<r.skill.length;v++){var y=r.skill[v].id;f.push({id:y,zlId:r.id})}this.skillList.dataProvider=new eui.ArrayCollection(f),d+=g,this.powerPanel.setPower(d);var m=GlobalConfig.GainItemConfig[this.itemid];m&&(this.gainList.dataProvider=new eui.ArrayCollection(m.gainWay))},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.onTouchList=function(t){var e=t.item;if(null!=t.item&&e[1]){if("BossWin"==e[1]&&GlobalConfig.CrossBossBase.openDay>GameServer.serverOpenDay)return void TipsCT.ins().showTips("开服第"+(GlobalConfig.CrossBossBase.openDay+1)+"天开启");ViewManager.ins().close(SkillWin),ViewManager.ins().open(e[1],e[2],e[3])}},e}(BaseEuiView);__reflect(ZhanlingZBTipWin.prototype,"ZhanlingZBTipWin"),ViewManager.ins().reg(ZhanlingZBTipWin,LayerManager.UI_Popup),window.ZhanlingZBTipWin=ZhanlingZBTipWin;var ZhanlingZhuHunPanel=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.zlId=0,e.hasEnough=!1,e.costItemId=0,e.isPlay=!1,e}return __extends(e,t),e.prototype.skinComplete=function(){this.eList.itemRenderer=ZhanLingItemRender2,this.listDt=new eui.ArrayCollection,this.eList.dataProvider=this.listDt,this.curSelectPos=0,this.nowAttrCenter=this.eLeftGroup.horizontalCenter,this.addTouchEvent(this,this.onClick),this.itemIconNow.touchChildren=!1,this.itemIconCost.touchChildren=!1,this.itemIconNext.touchChildren=!1},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.observe(ZhanLing.ins().postZhanLingZhuHun,this.postZhanLingZhuHun),this.observe(ZhanLingRedPoint.ins().postRedPoint,this.updateRedPoint),this.update(),this.setSelectPos(1)},e.prototype.onClick=function(t){if(t.target instanceof ZhanLingItemRender2)return void this.setSelectPos(t.target.pos);switch(t.target){case this.soulBtn:this.hasEnough?ZhanLing.ins().sendZhanLingZhuHun(this.zlId,this.curSelectPos):TipsCT.ins().showTips("材料不足");break;case this.itemIconNow:if(this.itemIconNow.config&&this.itemIconNow.config.id>0){var e=ZhanLingModel.ins().getZhanLingPosData(this.zlId,this.curSelectPos);ZhanLing.ins().ZhanLingItemTips(this.itemIconNow.config.id,0,!0,e)}break;case this.itemIconNext:if(this.itemIconNext.config&&this.itemIconNext.config.id>0){var e=ZhanLingModel.ins().getZhanLingPosData(this.zlId,this.curSelectPos);ZhanLing.ins().ZhanLingItemTips(this.itemIconNext.config.id,0,!0,e)}break;case this.itemIconCost:this.itemIconCost.config&&this.itemIconCost.config.id>0&&ViewManager.ins().open(ItemDetailedWin,0,this.itemIconCost.config.id)}},e.prototype.update=function(){this.updateList()},e.prototype.updateRedPoint=function(){this.updateList()},e.prototype.postZhanLingZhuHun=function(){this.updateCurItemUI(),this.updateCallBack()},e.prototype.setSelectPos=function(t){if(this.curSelectPos!=t){var e=this.eList.getElementAt(this.curSelectPos-1);e&&e.setSelect(!1),e=this.eList.getElementAt(t-1),e&&e.setSelect(!0),this.curSelectPos=t,this.updateCurItemUI()
}},e.prototype.updateList=function(){for(var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=[],i=1;i<=t.items.length;i++){var n=ZhanLingModel.ins().getZhanLingPosData(this.zlId,i),s=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,i);e.push({zlId:this.zlId,id:s,pos:i,posInfo:n,redPoint:ZhanLingRedPoint.ins().itemZHRedPoint[i]})}this.listDt.source=e,this.eList.validateNow()},e.prototype.updateCurItemUI=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,this.curSelectPos),i=t.getPosInfoBy(this.curSelectPos),n=GlobalConfig.ZhanLingZhuHunLevel[this.curSelectPos][i.zhuHunLv+1],s=!n;if(this.eCostGroup.visible=this.eNextGroup.visible=this.eCurGroup.visible=0!=e&&!s,this.cleanEff(),0!=e&&!s){var o=GlobalConfig.ItemConfig[e];this.itemIconNow.setData(o),this.itemIconNow.setTag(i.zhuHunLv>0?"zlzh_hun_png":""),this.currentName.text=i&&i.zhuHunLv>0?"铸魂 "+GlobalFun.getRomanNumStr(i.zhuHunLv)+"."+o.name:o.name,this.itemIconNext.setData(o),this.itemIconNext.setTag("zlzh_hun_png"),this.nextName.text="铸魂 "+GlobalFun.getRomanNumStr(i.zhuHunLv+1)+"."+o.name,o=GlobalConfig.ItemConfig[n.materialInfo.id],this.itemIconCost.setData(o),this.costName.text=o.name;var a=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,n.materialInfo.id);this.hasEnough=a>=n.materialInfo.count,this.numInfo.text=a+"/"+n.materialInfo.count,this.numInfo.textColor=this.hasEnough?ColorUtil.GREEN:ColorUtil.RED,this.playEff()}this.updateAttr()},e.prototype.updateAttr=function(){var t=ZhanLingModel.ins().getZhanLingDataById(this.zlId),e=ZhanLingModel.ins().getZhanLingDataByItem(this.zlId,this.curSelectPos),i=t.getPosInfoBy(this.curSelectPos);if(i){if(0==e)return this.nowPowerPanel.setPower(0),this.nextPowerPanel.setPower(0),this.nowAttr.text="",this.nextAttr.text="",void(this.soulBtn.visible=this.eFullLab.visible=!1);var n=GlobalConfig.ZhanLingZhuHunLinkLevel[this.curSelectPos],s=0;for(var o in n)s=+o;var a=t.getPosInfoBy(s),r=Math.min(i.zhuHunLv,a.zhuHunLv),l=n[s]&&n[s][r]?n[s][r]:null,h=null!=l;if(h){this.eChainTitle.text="【灵魂锁链Lv"+r+"】",this.eChainLab.text="[铸魂"+GlobalConfig.ZhanLingConfig.zlEquipName[s-1]+"]"+AttributeData.getAttStr(l.attrs,4,1,"");var u=n[s]&&n[s][r+1]?n[s][r+1]:null;this.eNextChainLab.text=u?"（下级"+AttributeData.getAttStr(u.attrs,4,1,"",!1,!1)+"）":""}else{var p=n[s]&&n[s][r+1]?n[s][r+1]:null;this.eChainTitle.text="【灵魂锁链Lv1】",this.eChainLab.text="[铸魂"+GlobalConfig.ZhanLingConfig.zlEquipName[s-1]+"]"+AttributeData.getAttStr(p.attrs,4,1,""),this.eNextChainLab.text=""}var c=GlobalConfig.ZhanLingZhuHunLevel[this.curSelectPos][i.zhuHunLv],d=GlobalConfig.ZhanLingZhuHunLevel[this.curSelectPos][i.zhuHunLv+1],g=!d;if(c){this.nowAttr.text=AttributeData.getAttStr(c.attrs,4,1,"：");var f=0;h?(f+=l.power,f+=BagCT.getAttrPower(AttributeData.AttrAddition(c.attrs,l.attrs))*SubRoles.ins().subRolesLen):f+=BagCT.getAttrPower(c.attrs)*SubRoles.ins().subRolesLen,this.nowPowerPanel.setPower(f)}else this.nowAttr.text="生命：0\n攻击：0\n物防：0\n魔防：0",this.nowPowerPanel.setPower(0);if(g)this.eLeftGroup.horizontalCenter=0,this.costItemId=0;else{this.eLeftGroup.horizontalCenter=this.nowAttrCenter,this.nextAttr.text=AttributeData.getAttStr(d.attrs,4,1,"：");var v=Math.min(i.zhuHunLv+1,a.zhuHunLv),y=n[s]&&n[s][v]?n[s][v]:null,f=0;y?(f+=y.power,f+=BagCT.getAttrPower(AttributeData.AttrAddition(d.attrs,y.attrs))*SubRoles.ins().subRolesLen):f+=BagCT.getAttrPower(d.attrs)*SubRoles.ins().subRolesLen,this.nextPowerPanel.setPower(f)}this.soulBtn.visible=this.arrow.visible=this.eRightGroup.visible=!g,this.eFullLab.visible=g}},e.prototype.addBarEff=function(t){var e="ProgressEff6",i=new MovieClip;i.playFile(RES_DIR_EFF+e,-1),t.addChild(i),i.x=t.width/2,i.y=t.height/2,i.scaleX=t.width/466,i.scaleY=t.height/16,t.scaleX=0,t.scaleY=0},e.prototype.moveBarEff=function(t,e,i){var n=1,s=1e3*t[e?"width":"height"]/160,o={};o[e?"scaleX":"scaleY"]=1,t[e?"scaleY":"scaleX"]=1;var a=egret.Tween.get(t);a.to(o,s/n).call(function(){i&&i()})},e.prototype.playEff=function(){var t=this;if(!this.isPlay){this.isPlay=!0;for(var e=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,28],i=0;i<=e.length-1;i++)this.addBarEff(this["bar"+e[i]]);this.moveBarEff(this.bar21,!1),this.moveBarEff(this.bar11,!1,function(){t.moveBarEff(t.bar13,!0),t.moveBarEff(t.bar22,!0),t.moveBarEff(t.bar23,!0),t.moveBarEff(t.bar12,!0,function(){t.moveBarEff(t.bar24,!1),t.moveBarEff(t.bar14,!1,function(){t.moveBarEff(t.bar25,!0),t.moveBarEff(t.bar15,!0,function(){t.moveBarEff(t.bar16,!0,function(){t.moveBarEff(t.bar17,!1,function(){t.moveBarEff(t.bar28,!0),t.moveBarEff(t.bar18,!0,function(){t.moveBarEff(t.bar19,!1,function(){t.isPlay=!1})})})})})})})})}},e.prototype.cleanEff=function(){this.isPlay=!1;for(var t=[11,12,13,14,15,16,17,18,19,21,22,23,24,25,28],e=0;e<t.length;e++)this["bar"+t[e]].removeChildren()},e.prototype.updateCallBack=function(){var t=new MovieClip;this.eNextGroup.parent.addChild(t),t.x=this.eNextGroup.x+this.eNextGroup.width/2,t.y=this.eNextGroup.y+this.eNextGroup.height/2,t.playFile(RES_DIR_EFF+"UpEff1")},__decorate([callLater],e.prototype,"updateRedPoint",null),__decorate([callLater],e.prototype,"updateCurItemUI",null),e}(BaseView);__reflect(ZhanlingZhuHunPanel.prototype,"ZhanlingZhuHunPanel"),window.ZhanlingZhuHunPanel=ZhanlingZhuHunPanel;var ZhuZaiData=function(){function t(){}return t.prototype.parser=function(t){this.id=t.readInt(),this.rank=t.readShort(),this.growupID=t.readInt()},Object.defineProperty(t.prototype,"lv",{get:function(){return this.rank*GlobalConfig.EquipPointConstConfig.rankGrowUp+this.growupID},enumerable:!0,configurable:!0}),t}();__reflect(ZhuZaiData.prototype,"ZhuZaiData"),window.ZhuZaiData=ZhuZaiData;var MijiCT=function(t){function e(){var e=t.call(this)||this;return e.sysId=PackageID.Miji,e.regNetMsg(1,e.postMijiData),e.regNetMsg(2,e.postMijiUpDate),e.regNetMsg(3,e.postMijiChange),e.regNetMsg(6,e.postMijiLockInfo),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postMijiData=function(t){this.grid=t.readShort();var e=SubRoles.ins().subRolesLen;this.miji=[];for(var i=0;e>i;i++){this.miji[i]=[];for(var n=0;n<this.grid;n++){var s=new MijiData;s.id=t.readInt(),s.isLocked=t.readInt(),this.miji[i][n]=s}}},e.prototype.sendMijiLearn=function(t,e){var i=this.getBytes(2);i.writeShort(t),i.writeInt(e),this.sendToServer(i)},e.prototype.postMijiUpDate=function(t){var e=t.readShort(),i=t.readShort()-1,n=t.readInt(),s=t.readByte(),o=this.miji[e][i].id;return this.miji[e][i].id=n,[i,n,o,s]},e.prototype.sendMijiChange=function(t,e,i){var n=this.getBytes(3);n.writeInt(t),n.writeInt(e),n.writeInt(i),this.sendToServer(n)},e.prototype.sendMijiwancheng=function(t){var e=this.getBytes(4);e.writeShort(t),this.sendToServer(e)},e.prototype.sendMijiAddLock=function(t,e){var i=this.getBytes(5);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.sendMijiDelLock=function(t,e){var i=this.getBytes(6);i.writeInt(t),i.writeInt(e),this.sendToServer(i)},e.prototype.getSkillListOfRole=function(t){return this.miji&&this.miji[t]?this.miji[t]:null},e.prototype.hasSpecificSkillOfRole=function(t,e){var i=this.getSkillListOfRole(t);if(null!=i)for(var n=0,s=i;n<s.length;n++){var o=s[n];if(o.id==e)return!0}return!1},e.prototype.hasEquipHigtLvlMiji=function(t,e){var i=this.getSkillListOfRole(t);if(null!=i)for(var n=0,s=i;n<s.length;n++){var o=s[n];if(o.id==e+1)return!0}return!1},e.prototype.mijiIsLock=function(t,e){var i=!1,n=this.getSkillListOfRole(t);if(null!=n){for(var s=!1,o=0;o<n.length;o++)Math.floor(n[o].id/10)==Math.floor(e/10)&&n[o].isLocked&&(s=!0);s&&(i=!0)}return i},e.prototype.postMijiChange=function(t){var e=t.readInt();return e},e.prototype.postMijiLockInfo=function(t){for(var e=this.miji[t.readInt()],i=t.readInt(),n=0;n<e.length;n++)if(e[n].id==i){var s=t.readInt();e[n].isLocked=s;break}},e.prototype.getPowerByRole=function(t){for(var e=0,i=this.miji[t],n=0;n<i.length;n++)i[n].id&&(e+=GlobalConfig.MiJiSkillConfig[i[n].id].pow);return e},e.prototype.postSelectedMiji=function(t,e){return[t,e]},e.prototype.postBagUseMiji=function(t){return t},e.prototype.hasEquipMiji=function(t,e){void 0===e&&(e=0);var i=this.miji[e];if(!i)return!1;for(var n=0;n<i.length;n++)if(i[n]&&0!=i[n].id){var s=GlobalConfig.MiJiSkillConfig[i[n].id];if(s.item==t)return!0}return!1},e.prototype.isMjiSum=function(){if(ZsCT.ins().lv<e.ZsLv)return!1;if(!this.miji)return!1;var t=BagCT.ins().getBagGoodsByType(2),i=t.length>0;if(!i)return!1;var n=Setting.ins().getValue(ClientSet.mijiRedPoint);if(n)return!1;for(var s=SubRoles.ins().subRolesLen,o=0;s>o;o++)for(var a=this.miji[o],r=0;r<a.length;r++)if(a[r].id)for(var l=GlobalConfig.MiJiSkillConfig[a[r].id],h=0;h<t.length;h++)if(l.item==t[h].configID)return Setting.ins().setValue(ClientSet.mijiRedPoint,1),!1;return!0},e.ZsLv=1,e.BAGOPEN=5,__decorate([post()],e.prototype,"postMijiData",null),__decorate([post()],e.prototype,"postMijiUpDate",null),__decorate([post()],e.prototype,"postMijiChange",null),__decorate([post()],e.prototype,"postMijiLockInfo",null),__decorate([post()],e.prototype,"postSelectedMiji",null),__decorate([post()],e.prototype,"postBagUseMiji",null),e}(BaseSystem);__reflect(MijiCT.prototype,"MijiCT"),System.MijiCT=function(){return MijiCT.ins()},window.MijiCT=MijiCT;var ZsCT=function(t){function e(){var e=t.call(this)||this;return e.isSendXW=[],e.sysId=PackageID.Zs,e.regNetMsg(1,e.postZsData),e.regNetMsg(4,e.postZsStoreInfo),e.regNetMsg(5,e.postBuyResult),e.exchange=!1,e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postZsData=function(t){this.lv;this.lv=t.readInt();var e=this.exp;this.exp=t.readInt(),this.upgradeCount=[t.readShort(),t.readShort(),t.readShort()],e&&Actor.ins().postZsExpChange(this.exp-e),this.postZsLv(),SubRoles.lookAtTar&&SubRoles.lookAtTar.wearTitle()},e.prototype.postZsLv=function(){},e.prototype.sendGetXiuWei=function(t){var e=this.getBytes(1);e.writeByte(t),this.sendToServer(e)},e.prototype.sendZsUpgrade=function(){this.sendBaseProto(2)},e.prototype.canUpgrade=function(){var t=GlobalConfig.ZhuanShengLevelConfig[this.lv+1];return t?this.exp>=t.exp:!1},e.prototype.sendZsReward=function(){this.sendBaseProto(3)},e.prototype.sendZsStoreInfo=function(){this.sendBaseProto(4)},e.prototype.postZsStoreInfo=function(t){var e=t.readByte();this.storeItemInfo={};for(var i=0,n=0;e>n;n++){var s=t.readByte(),o=t.readByte(),a=DateUtils.formatMiniDateTime(t.readUnsignedInt());this.storeItemInfo[s]={storeId:s,hasBuy:o,storeOverTime:a},i=Math.max(i,a)}i>0&&(Timer.stop(this.postShowIconRule,this),Timer.start(i,1,this.postShowIconRule,this)),this.storeOverTime=i},e.prototype.postShowIconRule=function(){},e.prototype.sendBuy=function(t,e){var i=this.getBytes(5);i.writeByte(t),i.writeByte(e),this.sendToServer(i)},e.prototype.postBuyResult=function(t){var e=t.readByte(),i=t.readByte();this.storeItemInfo[e].hasBuy=this.storeItemInfo[e].hasBuy|1<<i},e.prototype.isMaxLv=function(){return!GlobalConfig.ZhuanShengLevelConfig[this.lv+1]},e.prototype.canGet=function(){var t=0;if(!this.upgradeCount)return t;for(var e=GlobalConfig.ZhuanShengConfig,i=[e.conversionCount,e.normalCount,e.advanceCount],n=[0,e.normalItem,e.advanceItem],s=0;s<i.length;s++)i[s]-this.upgradeCount[s]&&(!n[s]&&Actor.level>80||BagCT.ins().getBagGoodsCountById(0,n[s]))&&(0==s?this.exchange||(t|=1<<s):t|=1<<s);return t},e.prototype.canOpenZSWin=function(){var t=Actor.level,e=null!=this.lv?this.lv:0;return e>0||t>=80},e.prototype.hasGoods=function(t){return void 0===t&&(t=0),!1},__decorate([post()],e.prototype,"postZsData",null),__decorate([post()],e.prototype,"postZsLv",null),__decorate([post()],e.prototype,"postZsStoreInfo",null),__decorate([post()],e.prototype,"postShowIconRule",null),__decorate([post()],e.prototype,"postBuyResult",null),e}(BaseSystem);__reflect(ZsCT.prototype,"ZsCT"),System.ZsCT=function(){return ZsCT.ins()},window.ZsCT=ZsCT;var MijiData=function(){function t(){}return t}();__reflect(MijiData.prototype,"MijiData"),window.MijiData=MijiData;var GainZsWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="GainZsSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.infoTxts=[this.infoTxt0,this.infoTxt1,this.infoTxt2],this.toDays=[this.toDay0,this.toDay1,this.toDay2],this.items=[this.item0,this.item1,this.item2],this.btns=[this.btn0,this.btn1,this.btn2];for(var t=0;t<this.items.length;t++)this.items[t].isShowName(!1);this.priceIcon1.setType(MoneyConst.yuanbao),this.priceIcon2.setType(MoneyConst.yuanbao);var e=new RewardData;e.type=0,e.id=0,e.count=0,this.items[0].data=e,this.isTopLevel=!0,this.tipsExp=0,this.schedule0=new ProgressBarEff,this.schedule0.setWidth(320),this.barGroup.addChild(this.schedule0)},e.prototype.addDisplay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this,this.onTap),this.observe(ZsCT.ins().postZsData,this.setData),this.observe(Actor.ins().postLevelChange,this.setData),this.observe(Shop.ins().postBuyResult,this.setData),this.observe(Shop.ins().postBuyCount,this.setData),this.setData()},e.prototype.setData=function(){var t=GlobalConfig.ZhuanShengConfig,e=t.level+1,i=Math.max(Actor.level,e),n=GlobalConfig.ZhuanShengExpConfig[i],s=ZsCT.ins(),o=GlobalConfig.ZhuanShengLevelConfig[s.lv+1],a=GlobalConfig.ZhuanShengLevelRewardConfig[s.lv+1];this.eZsBtn.enabled=!1,o&&(this.eCur.text=s.lv+"",this.next.text=s.lv+1+"",s.exp>=o.exp?(this.schedule0.setMaxValue(o.exp),this.schedule0.max()):this.schedule0.setData(s.exp,o.exp),this.eZsBtn.enabled=s.exp>=o.exp),this.eCur.visible=this.next.visible=this.schedule0.visible=this.nextImg.visible=null!=o,this.nextImg.source=a&&a.nextImg2?a.nextImg2:"",this.redPoint3.visible=this.eZsBtn.enabled;var r;this.toDays[0].textColor=Actor.level<e?15937822:11050120,this.infoTxts[0].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#9de242">'+n.exp+"</font>修为\n\n等级兑换：降1级"),r=t.conversionCount-s.upgradeCount[0],this.toDays[0].textFlow=(new egret.HtmlTextParser).parser(Actor.level<=80?"大于"+(e-1)+"级才能兑换":'今天还可兑换<font color="#9de242">'+r+"</font>次"),this.btns[0].enabled=r>0;var l=t.normalItem,h=GlobalConfig.ItemConfig[l],u=BagCT.ins().getBagGoodsCountById(0,l),p=ItemStoreConfig.getStoreByItemID(l);this.items[1].data=l,this.btns[1].label=u?"立即使用":"购买",this.btns[1].name=t.normalExp+"",this.priceIcon1.visible=0==u,this.priceIcon1.setPrice(p.price),this.priceIcon1.name=h.name,this.infoTxts[1].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#9de242">'+t.normalExp+"</font>修为\n\n"+h.name+"："+(u?"剩余"+u+"个":"")),r=t.normalCount-s.upgradeCount[1],this.toDays[1].textFlow=(new egret.HtmlTextParser).parser('今天还可兑换<font color="#9de242">'+r+"</font>次"),this.btns[1].enabled=r>0,p.viplv&&Actor.vip<p.viplv?(this.vipLb1.visible=!0,this.vipLb1.text=VipCT.getVipStr(p.viplv,!0)+"可购买"):this.vipLb1.visible=!1,l=t.advanceItem,h=GlobalConfig.ItemConfig[l],u=BagCT.ins().getBagGoodsCountById(0,l),p=ItemStoreConfig.getStoreByItemID(l),this.items[2].data=l,this.btns[2].label=u?"立即使用":"购买",this.btns[2].name=t.advanceExp+"",this.priceIcon2.visible=0==u,this.priceIcon2.setPrice(ItemStoreConfig.getStoreByItemID(l).price),this.priceIcon2.name=h.name,this.infoTxts[2].textFlow=(new egret.HtmlTextParser).parser('增加<font color="#cb5ac4">'+t.advanceExp+"</font>修为\n\n"+h.name+"："+(u?"剩余"+u+"个":"")),r=t.advanceCount-s.upgradeCount[2],this.toDays[2].textFlow=(new egret.HtmlTextParser).parser('今天还可兑换<font color="#9de242">'+r+"</font>次"),this.btns[2].enabled=r>0,p.viplv&&Actor.vip<p.viplv?(this.vipLb2.visible=!0,this.vipLb2.text=VipCT.getVipStr(p.viplv,!0)+"可购买"):this.vipLb2.visible=!1;for(var c=s.canGet(),d=0;3>d;d++)this["redPoint"+d].visible=c>>d&1,this["redPointRule"+d]&&this["redPointRule"+d]();i=Math.max(Actor.level+1,e),n=GlobalConfig.ZhuanShengExpConfig[i],ZsCT.ins().isSendXW[0]?ZsCT.ins().isSendXW[0]=!1:ZsCT.ins().isSendXW[1]?ZsCT.ins().isSendXW[1]=!1:ZsCT.ins().isSendXW[2]&&(ZsCT.ins().isSendXW[2]=!1)},e.prototype.redPointRule0=function(){ZsCT.ins().exchange||(ZsCT.ins().exchange=!0)},e.prototype.onTap=function(t){switch(t.target){case this.colorCanvas:case this.bgClose:ViewManager.ins().close(this);break;case this.eZsBtn:var e=ZsCT.ins(),i=GlobalConfig.ZhuanShengLevelConfig[e.lv+1];if(e.exp<i.exp)return void TipsCT.ins().showTips("修为不足");this.eZsBtn.enabled=!1,ZsCT.ins().sendZsUpgrade();break;default:var n=this.btns.indexOf(t.target);if(n>-1)if(0==n)ZsCT.ins().isSendXW[n]=!0,ZsCT.ins().sendGetXiuWei(n+1);else if("立即使用"==this.btns[n].label)ZsCT.ins().isSendXW[n]=!0,ZsCT.ins().sendGetXiuWei(n+1);else{var s=this["priceIcon"+n].getPrice();if(Actor.yb<s)return TipsCT.ins().showTips("元宝不足"),void ViewManager.ins().close(this);if(1==n){var o=GlobalConfig.ItemStoreConfig;for(var a in o)if(200009==o[a].itemId)return void this.buyGoodsId(o[a].id)}else if(2==n){var o=GlobalConfig.ItemStoreConfig;for(var a in o)if(200010==o[a].itemId)return void this.buyGoodsId(o[a].id)}}}},e.prototype.buyGoodsId=function(t){Shop.ins().shopData.checkBuyGoodsId(t)&&ViewManager.ins().open(BuyWin,t)},e}(BaseEuiView);__reflect(GainZsWin.prototype,"GainZsWin"),window.GainZsWin=GainZsWin,ViewManager.ins().reg(GainZsWin,LayerManager.UI_Popup);var MijiLearnItemRenderer=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiLearnItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;this.item.data=t.item,t.isLock?(this.label.visible=!0,this.label.text="已锁"):t.islearn?(this.label.visible=!0,this.label.text="已学"):this.label.visible=!1},e}(BaseItemRender);__reflect(MijiLearnItemRenderer.prototype,"MijiLearnItemRenderer"),window.MijiLearnItemRenderer=MijiLearnItemRenderer;var MijiLearnWin=function(t){function e(){var e=t.call(this)||this;return e.skinName="MijiLearnSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.itemList.itemRenderer=MijiLearnItemRenderer,this.itemScroller.viewport=this.itemList,this.isTopLevel=!0,this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得途径</u>")},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.roleIndex=t[0],this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.link,this.onTap),this.observe(BagCT.ins().postItemAdd,this.updateItem),this.observe(BagCT.ins().postItemDel,this.updateItem),this.observe(BagCT.ins().postItemChange,this.updateItem),this.clearData(),this.updateItem(!0)},e.prototype.sortFun=function(t,e){var i=MijiCT.ins(),n=MiJiSkillConfig.getSkillIDByItem(t.configID),s=MiJiSkillConfig.getSkillIDByItem(e.configID);return 1==i.hasSpecificSkillOfRole(this.roleIndex,n)?1:1==i.hasSpecificSkillOfRole(this.roleIndex,s)?-1:t.configID<e.configID?-1:t.configID>e.configID?1:0},e.prototype.updateItem=function(t){void 0===t&&(t=!1);var e=BagCT.ins().getBagGoodsByType(2);e.sort(this.sortFun.bind(this));for(var i=[],n=0;n<e.length;n++){var s=MiJiSkillConfig.getSkillIDByItem(e[n].configID),o=new Object;o.islearn=MijiCT.ins().hasSpecificSkillOfRole(this.roleIndex,s),o.isLock=MijiCT.ins().mijiIsLock(this.roleIndex,s),o.item=e[n],i.push(o)}this.itemList.dataProvider=new eui.ArrayCollection(i),t&&e.length&&(this.setData(e[0]),this.itemList.selectedIndex=0)},e.prototype.setData=function(t){this.mijiLearnIcon.data=MiJiSkillConfig.getSkillIDByItem(t.configID);var e=ItemUtil.getQualityColor(t.itemConfig).toString(16);this.mijiName.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+e+"'>"+t.itemConfig.name+"</font>"),this.info.textFlow=TextFlowMaker.generateTextFlow1(t.itemConfig.desc),this.mijiLearnIcon.visible=!0;var i=MiJiSkillConfig.getSkillIDByItem(t.configID),n=MijiCT.ins().hasSpecificSkillOfRole(this.roleIndex,i);this.smeltBtn.enabled=!n,MijiCT.ins().mijiIsLock(this.roleIndex,i)?(this.smeltBtn.label="已加锁",this.smeltBtn.enabled=!1):this.smeltBtn.label=n?"已学习":"放 入",this.curName=t.itemConfig.name},e.prototype.clearData=function(){this.itemList.selectedIndex=-1,this.mijiLearnIcon.visible=!1,this.mijiLearnIcon.data=null,this.info.text="",this.curName="",this.mijiName.text=""},e.prototype.onItemTap=function(t){var e=this.itemList.dataProvider.getItemAt(t.itemIndex);this.setData(e.item)},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:case this.closeBtn0:ViewManager.ins().close(this);break;case this.smeltBtn:if(this.mijiLearnIcon.data<=0)return void TipsCT.ins().showTips("请选择技能！");var e=this.mijiLearnIcon.data;if(MijiCT.ins().hasEquipHigtLvlMiji(this.roleIndex,e))return void TipsCT.ins().showTips("已有此类型的高级秘籍");MijiCT.ins().postSelectedMiji(e,this.curName),this.clearData(),ViewManager.ins().close(this);break;case this.link:ViewManager.ins().close(this),WarnCT.ins().setBuyGoodsWarn(200099,1)}},e}(BaseEuiView);__reflect(MijiLearnWin.prototype,"MijiLearnWin"),ViewManager.ins().reg(MijiLearnWin,LayerManager.UI_Main),window.MijiLearnWin=MijiLearnWin;var MijiLockWin=function(t){function e(){var e=t.call(this)||this;return e.curRole=0,e.selItem=0,e.isFirst=!0,e.skinName="MijiLockSkin",e}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.mijiBtns=[this.mijiBtn0,this.mijiBtn1,this.mijiBtn2,this.mijiBtn3,this.mijiBtn4,this.mijiBtn5,this.mijiBtn6,this.mijiBtn7],this.link.textFlow=(new egret.HtmlTextParser).parser("<u>获得道具</u>"),this.roleSelect.hideTop()},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.isFirst=!0,this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.link,this.onTap),this.addChangeEvent(this.roleSelect,this.onChange),this.addTouchEndEvent(this.otherRect,this.otherClose);for(var i in this.mijiBtns)this.addTouchEvent(this.mijiBtns[i],this.onTap);this.observe(MijiCT.ins().postMijiLockInfo,this.setData),t[0]==MijiCT.BAGOPEN?this.bagSelectIndex():(this.roleSelect.setCurRole(isNaN(t[0])?0:t[0]),this.selItem=this.getindex(isNaN(t[0])?0:t[0])),this.setCurRole(this.roleSelect.getCurRole())},e.prototype.otherClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e.prototype.onChange=function(t){var e=this.roleSelect.getCurRole();this.isFirst||(this.selItem=this.getindex(e)),this.isFirst=!1,this.setCurRole(e)},e.prototype.setCurRole=function(t){this.curRole=t,this.setData()},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.smeltBtn:var e=this.mijiBtns[this.selItem].data;if(e.isLocked)return void MijiCT.ins().sendMijiDelLock(this.curRole,e.id);MijiCT.ins().sendMijiAddLock(this.curRole,e.id);break;case this.link:WarnCT.ins().setBuyGoodsWarn(GlobalConfig.MijiBaseConfig.lockId,1);break;default:var i=this.mijiBtns.indexOf(t.target.parent),n=this.mijiBtns[i].data;if(!this.mijiBtns[i]||!n)return;if(0==n.id)return void TipsCT.ins().showCenterTips("未学习秘籍的孔位无法加锁");this.selItem=i;var s=MijiCT.ins();if(!s.grid||this.selItem>=s.grid)return void TipsCT.ins().showTips("未开启");this.updateBtnState()}},e.prototype.updateBtnState=function(){for(var t=0;t<this.mijiBtns.length;t++)this.mijiBtns[t].setSelected(!1);this.labCount.text="",this.link.visible=!1;var e=BagCT.ins().getBagGoodsCountById(BagCT.BAG_TYPE_OTHTER,GlobalConfig.MijiBaseConfig.lockId),i=e>0;if(i&&(this.labCount.text="剩余道具： "+e),this.link.visible=!i,this.selItem<0)return this.smeltBtn.label="孔位加锁",void(this.smeltBtn.enabled=!1);this.mijiBtns[this.selItem].setSelected(!0);var n=this.mijiBtns[this.selItem].data;n.isLocked?(this.smeltBtn.label="孔位解锁",this.smeltBtn.enabled=!0):(this.smeltBtn.label="孔位加锁",this.smeltBtn.enabled=i)},e.prototype.setData=function(){for(var t=MijiCT.ins(),e=!0,i=0;8>i;i++)if(ErrorLog.Assert(t.miji,"MijiPanel   data.miji is null"))this.mijiBtns[i].data=null;else{var n=t.miji[this.curRole];ErrorLog.Assert(n,"MijiPanel   numList is null  roleId = "+this.curRole)?this.mijiBtns[i].data=null:(this.mijiBtns[i].data=n[i]?n[i]:null,n[i]&&0==n[i].id?this.mijiBtns[i].setUnlearn(!0):this.mijiBtns[i].setUnlearn(!1),n[i]||e&&(this.mijiBtns[i].setCountLabel(i),e=!1))}this.updateBtnState()},e.prototype.getindex=function(t){for(var e=MijiCT.ins().miji[t],i=0;i<e.length;i++)if(0!=e[i].id)return i;return-1},e.prototype.bagSelectIndex=function(){var t=0,e=!1;this.selItem=0;for(var i=SubRoles.ins().subRolesLen,n=0;i>n;n++){for(var s=MijiCT.ins().miji[n],o=0;o<s.length;o++)if(0!=s[o].id&&0==s[o].isLocked){t=n,this.selItem=o,e=!0;break}if(e)break}this.roleSelect.setCurRole(t)},e}(BaseEuiView);__reflect(MijiLockWin.prototype,"MijiLockWin"),ViewManager.ins().reg(MijiLockWin,LayerManager.UI_Popup),window.MijiLockWin=MijiLockWin;var MijiTipWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiTipSkin",this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.item.data=t[0].id;var i=GlobalConfig.ItemConfig[GlobalConfig.MiJiSkillConfig[t[0].id].item];this.info.textFlow=TextFlowMaker.generateTextFlow1(i.name+"\n\n"+i.desc),this.power.text="评分："+GlobalConfig.MiJiSkillConfig[t[0].id].pow,this.addTouchEvent(this,this.onClose)},e.prototype.onClose=function(t){ViewManager.ins().close(this)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this,this.onClose)},e}(BaseEuiView);__reflect(MijiTipWin.prototype,"MijiTipWin"),ViewManager.ins().reg(MijiTipWin,LayerManager.UI_Main),window.MijiTipWin=MijiTipWin;var MiJiTujianWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiPhotoSkin",this.mijiList.itemRenderer=ItemBaseNoTap,this.isTopLevel=!0},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.mijiList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.addTouchEvent(this.mijiOpen,this.onTap),this.updateData()},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.removeTouchEvent(this.closeBtn,this.onTap),this.mijiList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.removeTouchEvent(this.mijiOpen,this.onTap)},e.prototype.updateData=function(){this.mijiOpen.textFlow=(new egret.HtmlTextParser).parser("<font><u>通过王者争霸玩法获得</u></font>");for(var t=[],e=0,i=GlobalConfig.ItemConfig;e<i.length;e++){var n=i[e];2==ItemUtil.getType(n)&&t.push(n.id)}this.mijiList.dataProvider=new eui.ArrayCollection(t),t.length&&(this.setData(t[0]),this.mijiList.selectedIndex=0)},e.prototype.onItemTap=function(t){var e=this.mijiList.dataProvider.getItemAt(t.itemIndex);this.setData(e)},e.prototype.setData=function(t){var e=GlobalConfig.ItemConfig[t];this.mijiIcon.setData(e);var i=ItemUtil.getQualityColor(e).toString(16);this.info.textFlow=(new egret.HtmlTextParser).parser("<font color='#"+i+"'>"+e.name+"</font>\n"+e.desc),this.mijiIcon.visible=!0;for(var n=10,s=0,o=GlobalConfig.MiJiSkillConfig;s<o.length;s++){var a=o[s];a.item==t&&(n=a.id)}this.power.text="评分："+GlobalConfig.MiJiSkillConfig[n].pow},e.prototype.onTap=function(t){switch(t.currentTarget){case this.closeBtn:ViewManager.ins().close(this);break;case this.mijiOpen:ViewManager.ins().close(this),WarnCT.ins().setBuyGoodsWarn(200099,1)}},e}(BaseEuiView);__reflect(MiJiTujianWin.prototype,"MiJiTujianWin"),ViewManager.ins().reg(MiJiTujianWin,LayerManager.UI_Main),window.MiJiTujianWin=MiJiTujianWin;var MijiZhWin=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUI=function(){t.prototype.initUI.call(this),this.skinName="MijiZhSkin",this.itemList.itemRenderer=ItemBaseNoTap,this.itemScroller.viewport=this.itemList,this.touchChildren=!0,this.mijiItem0.touchEnabled=!0,this.mijiItem0.touchChildren=!0,this.mijiItem1.touchEnabled=!0,this.mijiItem1.touchChildren=!0,this.mijiItem2.touchEnabled=!0,this.mijiItem2.touchChildren=!0,this.mcEff1=new MovieClip,this.mcEff1.x=63,this.mcEff1.y=99,this.mcEff2=new MovieClip,this.mcEff2.x=153,this.mcEff2.y=99,this.mcEff3=new MovieClip,this.mcEff3.x=243,this.mcEff3.y=99,this.nameArr=[],this.isTopLevel=!0},e.prototype.onItemTap=function(t){if(!(this.mijiItem0.data&&this.mijiItem1.data&&this.mijiItem2.data)){var e=t.item.count,i=MiJiSkillConfig.getSkillIDByItem(t.item.configID);this.mijiItem0.data==i&&e--,this.mijiItem1.data==i&&e--,this.mijiItem2.data==i&&e--;var n="秘籍不足";if(!e)return void TipsCT.ins().showTips(n);this.mijiItem0.data?this.mijiItem1.data?this.mijiItem2.data||(this.mijiItem2.data=i,this.nameArr[2]=t.item.itemConfig.name):(this.mijiItem1.data=i,this.nameArr[1]=t.item.itemConfig.name):(this.mijiItem0.data=i,this.nameArr[0]=t.item.itemConfig.name),this.mijiItem3.data=""}},e.prototype.open=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.addTouchEvent(this.closeBtn,this.onTap),this.addTouchEvent(this.closeBtn0,this.onTap),this.addTouchEvent(this.smeltBtn,this.onTap),this.addTouchEvent(this.mijiItem0,this.onTap),this.addTouchEvent(this.mijiItem1,this.onTap),this.addTouchEvent(this.mijiItem2,this.onTap),this.addTouchEvent(this.mijiItem3,this.onTap),this.addTouchEvent(this.bgClose,this.onTap),this.itemList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.observe(BagCT.ins().postItemAdd,this.updateItem),this.observe(BagCT.ins().postItemDel,this.updateItem),this.observe(BagCT.ins().postItemChange,this.updateItem),this.observe(MijiCT.ins().postMijiChange,this.showResult),this.clearData(),this.updateItem()},e.prototype.sortFun=function(t,e){return t.configID<e.configID?-1:t.configID>e.configID?1:0},e.prototype.updateItem=function(){var t=BagCT.ins().getBagGoodsByType(2);t.sort(this.sortFun),this.itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.clearData=function(){this.itemList.selectedIndex=-1,this.mijiItem0.data="",this.mijiItem1.data="",this.mijiItem2.data="",this.mijiItem3.data=""},e.prototype.playEffect=function(){this.mcEff1.playFile(RES_DIR_EFF+"UpEff1",1),this.anigroup.addChild(this.mcEff1),this.mcEff2.playFile(RES_DIR_EFF+"UpEff1",1),this.anigroup.addChild(this.mcEff2),this.mcEff3.playFile(RES_DIR_EFF+"UpEff1",1),this.anigroup.addChild(this.mcEff3)},e.prototype.onTap=function(t){var e=this;switch(t.currentTarget){case this.smeltBtn:if(!this.mijiItem0.data||!this.mijiItem1.data||!this.mijiItem2.data)return void TipsCT.ins().showTips("请先放入3本秘籍");WarnWin.show("是否消耗《"+this.nameArr[0]+"》、《"+this.nameArr[1]+"》、《"+this.nameArr[2]+"》随机置换一本新的秘籍？",function(){var t=e.mijiItem0.data,i=e.mijiItem1.data,n=e.mijiItem2.data;MijiCT.ins().sendMijiChange(t,i,n),e.clearData(),e.playEffect()},this);break;case this.closeBtn:case this.closeBtn0:case this.bgClose:ViewManager.ins().close(this);break;case this.mijiItem0:case this.mijiItem1:case this.mijiItem2:t.currentTarget.data="";break;case this.mijiItem3:if(this.mijiItem3&&this.mijiItem3.data){var i=GlobalConfig.MiJiSkillConfig[this.mijiItem3.data];if(i){var n=BagCT.ins().getBagItemById(i.item);n&&ViewManager.ins().open(ItemDetailedWin,0,n.itemConfig.id,n.count)}}}},e.prototype.showResult=function(t){this.mijiItem3.data=MiJiSkillConfig.getSkillIDByItem(t)},e.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];DisplayUtils.removeFromParent(this.mcEff1),DisplayUtils.removeFromParent(this.mcEff2),DisplayUtils.removeFromParent(this.mcEff3)},e}(BaseEuiView);__reflect(MijiZhWin.prototype,"MijiZhWin"),ViewManager.ins().reg(MijiZhWin,LayerManager.UI_Popup),window.MijiZhWin=MijiZhWin;var ZSrewardWin=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._sn_="ZSrewardSkin",e}return __extends(e,t),e.prototype.skinComplete=function(){this.addTouchEvent(this.goUpBtn,this.onClick),this.eList.itemRenderer=ItemBase},e.prototype.addDisplay=function(){this.update()
},e.prototype.update=function(){this.eNum.text=ZsCT.ins().lv+"";var t=GlobalConfig.ZhuanShengLevelRewardConfig[ZsCT.ins().lv];t?(this.next.source=t.nextImg,this.eList.dataProvider=new eui.ArrayCollection(t.rewards)):this.next.source=""},e.prototype.onClick=function(t){ZsCT.ins().sendZsReward(),ViewManager.ins().close(this)},e}(BaseEuiView);__reflect(ZSrewardWin.prototype,"ZSrewardWin"),window.ZSrewardWin=ZSrewardWin,ViewManager.ins().reg(ZSrewardWin,LayerManager.UI_Popup);var RoleMgr=function(t){function e(){var e=t.call(this)||this;return e.errorCode=["","sql错误","用户没登陆","游戏服务没准备好","角色上一次保存数据是否出现异常","客户端选择角色的常规错误","角色名称重复","角色不存在","错误的性别","随机生成的名字已经分配完","客户端上传的角色阵营参数错误","客户端上传的角色职业参数错误","名称无效，名称中包含非法字符或长度不合法","如果玩家是帮主，不能删除该角色，需要玩家退帮","已经登陆到其他服务器","已经超过最大可建角色数量"],e.filterStr=["<",">","&","|"],e.sysId=PackageID.Login,e.regNetMsg(5,e.postEnterGame),e.regNetMsg(10,function(t){for(var e=0;255>e;e++)PackageMap[e]=t.readUnsignedByte()}),e}return __extends(e,t),e.ins=function(){return t.ins.call(this)},e.prototype.postEnterGame=function(t){var e=t.readByte();switch(e){case 0:break;case 1:return console.log("进入游戏成功"),SceneManager.ins().runScene(MainScene),!0;default:alert("错误码:"+e)}return!1},e.prototype.showErrorTips=function(t){0!=t&&TipsCT.ins().showTips(this.errorCode[Math.abs(t)])},e.prototype.checkNameIsFilter=function(t){for(var e=0,i=this.filterStr;e<i.length;e++){var n=i[e];if(t.indexOf(n)>=0)return!0}return!1},e.prototype.checkName=function(t){return this.checkNameIsFilter(t)?(this.showErrorTips(-12),!1):!0},__decorate([post(!0)],e.prototype,"postEnterGame",null),e}(BaseSystem);__reflect(RoleMgr.prototype,"RoleMgr"),System.RoleMgr=function(){return RoleMgr.ins()},window.RoleMgr=RoleMgr;var cdshader_mc="\n\nprecision mediump float;\n\nuniform float time;\nuniform float PI;\nuniform float w;\nuniform float h;\nuniform float frameW;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n	vec4 mask_FragColor = texture2D(uSampler, vTextureCoord);\n	float once = 1. / w;\n	float frameIndex = vTextureCoord.x / once / frameW;\n	frameIndex = min(floor(frameIndex), w / frameW - 1.);\n	float w2 = frameW / 2.;\n	\n	//以正中间为中心，所以将uv范围映射到(-0.5, 0.5)\n	vec2 uv = vTextureCoord - vec2((frameIndex * frameW + w2) * once, 0.5);\n	\n	//-1用于控制方向\n	float radian = atan(uv.x, uv.y * h / w) * -1. + PI;\n\n	float radian2 = time * 2.* PI;\n	float v = step(radian, radian2);\n\n	gl_FragColor = mask_FragColor * sign(v);\n}\n\n",cdshader_mc_rect="\n\nprecision mediump float;\n\nuniform float time;\nuniform float PI;\nuniform float value;\nuniform int dir;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\n\nvoid main() {\n	vec4 mask_FragColor = texture2D(uSampler, vTextureCoord);\n	float vv = dir == 1 ? vTextureCoord.x : vTextureCoord.y;\n	float v = step(1. - value, vv);\n	gl_FragColor = mask_FragColor * sign(v);\n}\n\n",baseVertex="\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\n\nuniform vec2 projectionVector;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nconst vec2 center = vec2(-1.0, 1.0);\n\nvoid main(void) {\n	gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n	vTextureCoord = aTextureCoord;\n	vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}\n\n";