var game=window.game;var customui=window.customui;var customui,__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(o,r,s,c){return new(s=s||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function a(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(i,a)}n((c=c.apply(o,r||[])).next())})},__generator=this&&this.__generator||function(i,a){var n,o,r,t,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[0,r.value]),e[0]){case 0:case 1:r=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){s.label=e[1];break}if(6===e[0]&&s.label<r[1]){s.label=r[1],r=e;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(e);break}r[2]&&s.ops.pop(),s.trys.pop();continue}e=a.call(i,s)}catch(t){e=[6,t],o=0}finally{n=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};!function(A){var t=(y.init=function(){var t,e;y.CommonConfig=((t={})[0]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},t[EActivityType.DailyLoginWeal]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:y.commonTargetNoticeCheck,cycle:!0},t[EActivityType.DiscountGiftBag]={protoName:"GetDiscountGiftBagInfo",getRewardName:"",checkNotice:function(t){},formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",cycle:!0},t[EActivityType.ContinueRechargeReward]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=!1,i=(t.content,t.data.rechargeDays),a=JSON.parse(t.data.targeted),n=JSON.parse(t.content),o=n[2];if(!o)return!1;for(var r in o){var s=o[r],c=s[0],d=s[1],h=(s[2],REWARD_STATUS.AVAILABLE);for(var l in a)if(a[l][0]==c){h=REWARD_STATUS.RECEIVED;break}if(i<d&&(h=REWARD_STATUS.GO_RECHARGE),h==REWARD_STATUS.AVAILABLE){e=!0;break}}var p=n[0],u=n[1][y.getCurDay(t)-1];if(u){var g=t.data.amounts,m=REWARD_STATUS.GO_RECHARGE;for(var l in p<=g&&(m=REWARD_STATUS.AVAILABLE),a)if(a[l][0]==u[0]){m=REWARD_STATUS.RECEIVED;break}return m==REWARD_STATUS.AVAILABLE&&(e=!0),e}}},t[EActivityType.SecondOpenServerRecharge]={protoName:"GetSecondOpenServerRechargeInfo",getRewardName:"SecondOpenServerRechargeReward",checkNotice:function(t){if(t&&t.data){var e,i=t.content,a=t.data.amount,n=JSON.parse(t.data.targeted),o=t.data.curCycle||1;for(var r in i[1])if((d=i[1][r])[0]==o){e=d[1];break}if(!e)return!1;var s=!1;for(var c in e){var d,h=(d=e[c])[1];REWARD_STATUS.AVAILABLE,-1!=n.indexOf(d[0])?REWARD_STATUS.RECEIVED:a<h?REWARD_STATUS.UNAVAILABLE:s=!0}return s}},cycle:!0},t[EActivityType.DiamondGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"",checkNotice:function(t){},cycle:!0},t[EActivityType.HuntTreasure]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},t[EActivityType.ItemGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(t){if(!t||!t.data)return!1;var e,i=t.data.targeted,a=t.content,n=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),o=t.data.curCycle;for(var r in a[1])if((c=a[1][r])[0]==o){e=c[1];break}if(!e)return!1;for(var s=0;s<e.length;s++){var c,d=(c=e[s])[0],h=(c[1],c[2]),l=c[3],p=(REWARD_STATUS.UNAVAILABLE,0);for(var r in i){var u=i[r];if(u.id==d){p=u.num;break}}if(l<=p)REWARD_STATUS.RECEIVED;else if(h&&n.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}return!1},cycle:!0},t[EActivityType.NewNewItemGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(t){if(!t||!t.data)return!1;var e,i=t.data.targeted,a=t.content,n=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),o=t.data.curCycle;for(var r in a[1])if((c=a[1][r])[0]==o){e=c[1];break}if(!e)return!1;for(var s=0;s<e.length;s++){var c,d=(c=e[s])[0],h=(c[1],c[2]),l=c[3];if(!c[4]){REWARD_STATUS.UNAVAILABLE;var p=0;for(var r in i){var u=i[r];if(u.id==d){p=u.num;break}}if(l<=p)REWARD_STATUS.RECEIVED;else if(h&&n.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}}return!1},cycle:!0},t[EActivityType.MysticalShopRefreshTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:y.commonTaskNoticeCheck},t[EActivityType.DailyLuxuryGifts1]={protoName:"GetDailyLuxuryGiftsInfo",getRewardName:"BuyFreeDailyLuxuryGifts",formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"累充礼包",checkNotice:function(t){if(t&&t.data){var e=t.data.targeted,i=t.content,a=t.data.day,n=[];for(var o in i)(c=i[o])[0]==a&&n.push(c);if(!n.length)return!1;for(var r=t.data.key,s=0;s<n.length;s++){(c=n[s])[0];var c,d=c[1],h=c[2];if(c[3],!c[4]||!c[2]){var l=REWARD_STATUS.UNAVAILABLE;h<=r&&(l=REWARD_STATUS.AVAILABLE);var p=!1;for(var o in e)if(e[o].id==d){p=!0;break}if(p&&(l=REWARD_STATUS.RECEIVED),l==REWARD_STATUS.AVAILABLE)return!0}}return!1}},getEndDt:function(){var t=Utils.TimerManager.getServerTime(),e=new Date(1e3*t);return e.setHours(23,59,59),e.getTime()/1e3}},t[EActivityType.EnjoyCard]={protoName:"GetEnjoyCardInfo",getRewardName:"GetEnjoyCardReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content),i=t.data.startEffectDt,a=t.data.endEffectDt,n=t.data.targeted,o=i&&a,r=new Date(1e3*i);r.setHours(23,59,59);var s=Math.ceil((Utils.TimerManager.getServerTime()-(r.getTime()/1e3+1))/24/3600);++s<=0&&(s=1);var c=1;for(var d in n.sort(function(t,e){return t-e}),n){if((u=n[d])!=c)break;c++}for(var h=Math.ceil(c/e[0]),l=!1,p=0;p<e[1].length;p++){var u,g=(u=e[1][p])[0],m=(u[1],(h-1)*e[0]+g),y=REWARD_STATUS.AVAILABLE;if(o?0<=n.indexOf(m)?y=REWARD_STATUS.RECEIVED:s<m&&(y=REWARD_STATUS.UNAVAILABLE):y=REWARD_STATUS.UNAVAILABLE,y==REWARD_STATUS.AVAILABLE){l=!0;break}}return l}},t[EActivityType.CommonTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:y.commonTaskNoticeCheck,getEndDt:y.getActivityOneDayEndDt},t[EActivityType.WishGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;var i=t.data.amounts,e=t.content,a=t.data.rechargeTargeted,n=!1;return e[1].forEach(function(t){var e=t[0];t[1],REWARD_STATUS.UNAVAILABLE,0<=a.indexOf(e)?REWARD_STATUS.RECEIVED:e<=i&&(REWARD_STATUS.AVAILABLE,n=!0)}),n}},t[EActivityType.SecondContinueRechargeReward]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;t.data.amount;var e=JSON.parse(t.data.targeted),i=JSON.parse(t.data.rechargeDays),a=JSON.parse(t.content);if(!a)return!1;var n=[];for(var o in a){var r=a[o];n.indexOf(r[0])<0&&n.push(r[0])}n.sort(function(t,e){return t-e});for(var s=0;s<n.length;s++){var c=n[s];for(var d in a)if((r=a[d])[0]==c){var h=r[1];for(var o in h){var l=h[o],p=l[0],u=l[1],g=(l[2],0);for(var m in i)if(i[m][0]==c){g=i[m][1];break}var y=REWARD_STATUS.GO_RECHARGE;for(var v in u<=g&&(y=REWARD_STATUS.AVAILABLE),e)if(e[v][0]==p){y=REWARD_STATUS.RECEIVED;break}if(y==REWARD_STATUS.AVAILABLE)return!0}}}}},t[EActivityType.FlashCapsuleHigh]={protoName:"GetFlashCapsuleHighInfo",getRewardName:"FlashCapsuleHigh",checkNotice:y.commonTargetNoticeCheck,formatString:"高级招募%s次"},t),y.Config=((e={})[EActivityType.SignIn]={protoName:"GetSignInInfo",getRewardName:"SignIn",checkNotice:function(t){if(t&&t.data)return 0==t.data.count},formatString:"",needPullWhenOpen:!1,cycle:!1,getEndDt:y.getActivityNormalEndDt},e[EActivityType.NewSignIn]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(t&&t.data)return 0==t.data.count},formatString:"",needPullWhenOpen:!1,cycle:!1,getEndDt:y.getActivityNormalEndDt},e[EActivityType.LevelReward]={protoName:"GetLevelRewardInfo",getRewardName:"LevelReward",checkNotice:function(t){if(t&&t.data){function e(t){var e=o[t],i=e[0];e[1],REWARD_STATUS.AVAILABLE,a<i?REWARD_STATUS.UNAVAILABLE:n.some(function(t){return t.id==i&&0<t.num})?REWARD_STATUS.RECEIVED:r=!0}for(var a=A.AppFacade.getInstance().retrieveProxy(A.PlayerPy.N).playerInfoVO.level,n=t.data.targeted,o=t.content,r=!1,i=0;i<o.length;i++)e(i);return r}},formatString:"等级达到%s级"},e[EActivityType.ExchangeCode]={protoName:""},e[EActivityType.ThirdOpenServerRecharge]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.ThirdOpenServerRecharge1]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.ThirdOpenServerRecharge2]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FourthOpenServerRecharge]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FourthOpenServerRecharge1]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FourthOpenServerRecharge2]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FourthOpenServerRecharge3]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FifthOpenServerRecharge]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FifthOpenServerRecharge1]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FifthOpenServerRecharge2]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.FifthOpenServerRecharge3]=y.CommonConfig[EActivityType.SecondOpenServerRecharge],e[EActivityType.QqzoneOpenServerRecharge]={protoName:"GetSecondOpenServerRechargeInfo",getRewardName:"SecondOpenServerRechargeReward",checkNotice:function(t){if(t&&t.data){var e,i=t.content,a=t.data.amount,n=JSON.parse(t.data.targeted),o=t.data.curCycle||1;for(var r in i[1])if((d=i[1][r])[0]==o){e=d[1];break}if(!e)return!1;var s=!1;for(var c in e){var d,h=(d=e[c])[1];REWARD_STATUS.AVAILABLE,-1!=n.indexOf(d[0])?REWARD_STATUS.RECEIVED:a<h?REWARD_STATUS.UNAVAILABLE:s=!0}return s}},isOpen:function(){return"QQVip"==getUrlKV().channel&&0<getUrlKV().QQVipLevel},cycle:!0},e[EActivityType.SecondContinueRechargeReward]=y.CommonConfig[EActivityType.SecondContinueRechargeReward],e[EActivityType.SecondContinueRechargeReward1]=y.CommonConfig[EActivityType.SecondContinueRechargeReward],e[EActivityType.SecondContinueRechargeReward2]=y.CommonConfig[EActivityType.SecondContinueRechargeReward],e[EActivityType.SecondContinueRechargeReward3]=y.CommonConfig[EActivityType.SecondContinueRechargeReward],e[EActivityType.SingleRecharge]={protoName:"GetSingleRechargeInfo",getRewardName:"SingleRecharge",checkNotice:function(t){if(t&&t.data){var e=t.content,i=t.data.day,a=t.data.rechargeInfo,n=t.data.targetedInfo,o=(A.Config.getRechargeConfig(),e[0]);for(var r in e){var s=e[r];if(s[0]==i){o=s[1];break}}var c=!1;return o.forEach(function(t){var e=t[0];t[1],t[2],REWARD_STATUS.UNAVAILABLE,n.some(function(t){return t.id==e})?REWARD_STATUS.RECEIVED:a.some(function(t){return t.id==e&&0<t.num})&&(REWARD_STATUS.AVAILABLE,c=!0)}),c}}},e[EActivityType.DailyLogin]={protoName:"GetDailyLoginInfo",getRewardName:"DailyLogin",checkNotice:function(t){if(t&&t.data){var e=JSON.parse(t.content),i=t.data.targeted,a=t.data.key||0,n=(t.data.day,!1),o=t.data.curCycle;for(var r in e[1]){var s=e[1][r];if(s[0]==o){e=s[1];break}}return e.forEach(function(t){var e=t[0];t[1],t[2],REWARD_STATUS.UNAVAILABLE,i.some(function(t){return t.id==e&&0<t.num})?REWARD_STATUS.RECEIVED:a>=t[1]&&(REWARD_STATUS.AVAILABLE,n=!0)}),n}},cycle:!0},e[EActivityType.ActivityShop]={protoName:"GetActivityShopInfo",getRewardName:"PurchaseCommodity",checkNotice:void 0},e[EActivityType.MonthCard]={protoName:"GetMonthCardInfo",getRewardName:"GetMonthCardReward",checkNotice:function(t){var e=!1;if(t&&t.data){var i=t.data.day,a=t.data.giftFlag;JSON.parse(t.content),i<=0||a||(e=!0);var n=A.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard];return JSON.parse(n.content),n&&n.data&&n.data.hasPurchased&&(n.data.giftFlag||(e=!0)),e}}},e[EActivityType.DiamondReward]={protoName:"GetDiamondRewardInfo",getRewardName:"DiamondReward",checkNotice:y.commonTargetNoticeCheck,formatString:"累计消费%s钻石",cycle:!0,getEndDt:y.getActivityNormalEndDt},e[EActivityType.PushGiftBag]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0,getEndDt:y.getActivityOneDayEndDt},e[EActivityType.WishTree]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.BlessingBox]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;for(var e=JSON.parse(t.content),i=t.data.recharged,a=t.data.targeted,n=0;n<2;n++){var o=0,r=e[0][n],s=(r[0],r[1],r[2],r[4]);for(var c in i)(l=i[c])[0]==n+1&&(o=l[1]);if(!(s<=o))return!0;var d=e[n+1],h=0==n?t.data.blessGrade:t.data.zoneGrade;for(var c in h=h||0,d){var l,p=(l=d[c])[0],u=(l[1],l[2]),g=REWARD_STATUS.UNAVAILABLE;if(u<=h&&(g=REWARD_STATUS.AVAILABLE),0<=a.indexOf(p)&&(g=REWARD_STATUS.RECEIVED),g==REWARD_STATUS.AVAILABLE)return!0}}return!1}},e[EActivityType.AwakenGiftBag]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.ExtremeBattle]={protoName:"GetExtremeBattleInfo",getRewardName:"",checkNotice:function(t){},needPullWhenOpen:!1},e[EActivityType.FlashCapsuleRace]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:y.commonTargetNoticeCheck,formatString:"时空召唤%s次"},e[EActivityType.FlashCapsuleRace1]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:y.commonTargetNoticeCheck,formatString:"时空召唤%s次"},e[EActivityType.FlashCapsuleRace2]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:y.commonTargetNoticeCheck,formatString:"时空召唤%s次"},e[EActivityType.FlashCapsuleRace3]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:y.commonTargetNoticeCheck,formatString:"时空召唤%s次"},e[EActivityType.RiskLayer]={protoName:"GetRiskLayerInfo",getRewardName:"GetRiskLayerReward",checkNotice:y.commonTargetNoticeCheck,formatString:"通关冒险第%s章"},e[EActivityType.CollectHero]={protoName:"GetCollectHeroInfo",getRewardName:"GetCollectHeroReward",checkNotice:function(t){if(t&&t.data){function e(t){var e=h[t];if(1==e[1][0][0]){var i=e[1][0][1],a=e[1][0][2],n=e[1][0][3];(r=e[1][0][4])<=(s=u[o=""+(i<10?"0"+i:i)+(a<10?"0"+a:a)+(n<10?"0"+n:n)]?u[o]:0)&&!l.some(function(t){return t.id==e[0]})&&(g=!0)}if(2==e[1][0][0]){var o=e[1][0][1],r=e[1][0][2];if(A.GeneralConfig.getEntityConfigByCode(o)){var s=0;for(var c in p){var d=p[c];d.code==o&&(r=d.num)}r<=s&&!l.some(function(t){return t.id==e[0]})&&(g=!0)}}}var h=JSON.parse(t.content),i=t.data,l=i.targeted,p=i.specialListspecialList,u=JSON.parse(i.genericityList),g=!1;for(var a in h)e(a);return g}}},e[EActivityType.WeekGift]={protoName:"GetCycleGiftInfo",getRewardName:"",checkNotice:function(t){if(t&&t.data){var e=JSON.parse(t.content),i=!1;return e.forEach(function(t){t[0],A.GameMVC.playerPy.playerInfoVO.level<(t[3]&&t[3][0]||0)||Utils.TimerManager.getServerOpenDays()<(t[3]&&t[3][1]||0)||Utils.LocalStorageUtil.getItem("Activity"+EActivityType.WeekGift+"_"+t[4])||(i=!0)}),i}},formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",getEndDt:function(){if(A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[EActivityType.WeekGift]){var t=Utils.TimerManager.getServerTime(),e=new Date(1e3*t).getDay();0==e&&(e=7);var i=new Date(1e3*(t+24*(7-e)*3600));return i.setHours(23,59,59),i.getTime()/1e3}return 0}},e[EActivityType.MonthGift]={protoName:"GetCycleGiftInfo",getRewardName:"",checkNotice:function(t){if(t&&t.data){var e=JSON.parse(t.content),i=!1;return e.forEach(function(t){t[0],A.GameMVC.playerPy.playerInfoVO.level<(t[3]&&t[3][0]||0)||Utils.TimerManager.getServerOpenDays()<(t[3]&&t[3][1]||0)||Utils.LocalStorageUtil.getItem("Activity"+EActivityType.MonthGift+"_"+t[4])||(i=!0)}),i}},formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",getEndDt:function(){if(A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[EActivityType.MonthGift]){var t=Utils.TimerManager.getServerTime(),e=new Date(1e3*t),i=e.getMonth();return 11==i?e.setFullYear(e.getFullYear()+1,0,1):e.setMonth(i+1,1),e.setHours(0,0,0),e.getTime()/1e3}return 0}},e[EActivityType.EnjoyCard]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.EnjoyCard1]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.EnjoyCard2]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.EnjoyCard3]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.EnjoyCard4]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.EnjoyCard5]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.SecondDiamondGifts]=y.CommonConfig[EActivityType.DiamondGifts],e[EActivityType.NewItemGifts]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.NewItemGifts1]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.NewItemGifts2]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.NewExchangeGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e,i=t.data.targeted,a=t.content,n=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),o=t.data.curCycle;for(var r in a[1])if((c=a[1][r])[0]==o){e=c[1];break}if(!e)return!1;for(var s=0;s<e.length;s++){var c,d=(c=e[s])[0],h=(c[1],c[2]),l=c[3],p=(REWARD_STATUS.UNAVAILABLE,0);for(var r in i){var u=i[r];if(u.id==d){p=u.num;break}}if(l<=p)REWARD_STATUS.RECEIVED;else if(h&&n.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}return!1},cycle:!0},e[EActivityType.SecondNewItemGifts]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.NewNewItemGifts]=y.CommonConfig[EActivityType.NewNewItemGifts],e[EActivityType.TriggerGifts]={protoName:"GetTriggerGiftsInfo",getRewardName:"",formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",checkNotice:function(t){}},e[EActivityType.FirstRecharge1]={protoName:"GetFirstRechargeInfo",getRewardName:"GetFirstRechargeReward",checkNotice:function(t){if(t&&t.data){for(var e=JSON.parse(t.content),i=(JSON.parse(t.data.rechargeTargeted),t.data.rewardTargeted,t.data.key,!1),a=0;a<=3;a++){for(var n=0;n<3;n++){var o=e[3*a+n],r=o[0],s=(o[1],o[2]),c=o[4],d=t.data.key,h=t.data.rewardTargeted,l=JSON.parse(t.data.rechargeTargeted),p=REWARD_STATUS.UNAVAILABLE;s<=d&&(p=REWARD_STATUS.AVAILABLE),0<=h.indexOf(r)&&(p=REWARD_STATUS.RECEIVED);var u=0;for(var g in l){var m=l[g];m[0]==s&&(u=m[1])}if(u<c&&(p=REWARD_STATUS.UNAVAILABLE),p==REWARD_STATUS.AVAILABLE){i=!0;break}}if(i)break}return i}}},e[EActivityType.BraveBook]={protoName:"GetBraveBookInfo",getRewardName:"",checkNotice:function(t){}},e[EActivityType.NewBraveBook]={protoName:"GetCommonActivityInfo",getRewardName:"",checkNotice:function(t){}},e[EActivityType.WholeLifeCard]={protoName:"GetWholeLifeCardInfo",getRewardName:"",checkNotice:function(t){return NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MonthCard]),!1}},e[EActivityType.DailyLuxuryGifts5]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(i){if(!i||!i.data)return!1;var t=JSON.parse(i.content),r=!1;return t.forEach(function(t,e){var n=0==e?i.data.dailyResetList:i.data.weeklyResetList,o=0==e?i.data.dailyTargetedList:i.data.weeklyTargetedList;t.forEach(function(t){var e=t[0],i=t[1],a=(t[2],REWARD_STATUS.UNAVAILABLE);(0<=n.indexOf(i)||0==i)&&(a=REWARD_STATUS.AVAILABLE),0<=o.indexOf(e)&&(a=REWARD_STATUS.RECEIVED),a==REWARD_STATUS.AVAILABLE&&(r=!0)})}),r},getEndDt:function(){if(A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[EActivityType.DailyLuxuryGifts5]){var t=Utils.TimerManager.getServerTime(),e=new Date(1e3*t).getDay();6==e&&(e=-1),5==e&&(e=-2);var i=new Date(1e3*(t+24*(5-e)*3600));return i.setHours(0,0,0),i.getTime()/1e3}return 0}},e[EActivityType.DailyLuxuryGifts1]=y.CommonConfig[EActivityType.DailyLuxuryGifts1],e[EActivityType.DailyLuxuryGifts2]=y.CommonConfig[EActivityType.DailyLuxuryGifts1],e[EActivityType.DailyLuxuryGifts3]=y.CommonConfig[EActivityType.DailyLuxuryGifts1],e[EActivityType.DailyLuxuryGifts4]=y.CommonConfig[EActivityType.DailyLuxuryGifts1],e[EActivityType.VipLevelGift]={protoName:"",getRewardName:"",checkNotice:function(t){return A.AppFacade.getInstance().retrieveProxy(A.RechargePy.N).checkVipGiftNotice()},isOpen:function(){return!Utils.SDKMgr.getPerformConfig(2)&&A.GameMVC.activityPy.isOpen(EActivityType.VipLevelGift)}},e[EActivityType.CommentLike]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TouchGoldHandTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TouchGoldHandTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ArenaChallengeTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ArenaChallengeTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.SmithyTimeTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.SmithyTimeTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.SmithyTimeTask2]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ChallengeCircleTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ChallengeCircleTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ChallengeCircleTask2]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.QuoraNumTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.QuoraNumTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.FriendShare]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.OneYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.OneYuanGifts2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.NewOneYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.SixtyEightYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.NewYearWeekCrad]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.CertificationReward]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.MysticalShopRefreshTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.MysticalShopRefreshTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.GuildCollectTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.GuildCollectTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ActivityGashaponTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ActivityGashaponTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.SecondModuleGoalReward]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ConsumeDiamondTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.ConsumeDiamondTask1]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.MagicalUpGradeTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.PetUpGradeTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TreasureJewelTotalLevelTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.QuenchceMasterMaxLevelTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.HeroArtifactTotalBaptizeTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TopFarmCollectTime]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TopFarmCoinRewardNum]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.TopFarmBuildLevelNum]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.GuildTopFarmCoinRewardNum]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.HeroArtifactUpStarTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content),r=t.data.keyList,i=t.data.targeted;function a(t){var e=0,i=(t+"").split("");for(var a in r){var n=(r[a].taskType+"").split(""),o=r[a].key;0==Number(i[i.length-4])?Number(i[i.length-5])==Number(n[n.length-5])&&(e+=o):Number(i[i.length-5])==Number(n[n.length-5])&&Number(i[i.length-4])==Number(n[n.length-4])&&(e+=o)}return e}i[0]||(i=[]);var n=EActivityType.HeroArtifactUpStarTask;for(var o in e){var s=e[o],c=s[0],d=(s[1]+"").split(""),h=Number(d[d.length-1]),l=a(s[1]),p=REWARD_STATUS.CANBUY;if(h<=l&&(p=REWARD_STATUS.AVAILABLE),0<=i.indexOf(c)&&(p=REWARD_STATUS.RECEIVED),n!=EActivityType.ConsumeDiamondTask&&n!=EActivityType.ConsumeDiamondTask1&&n!=EActivityType.LiuYiConsumeTask||p!=REWARD_STATUS.CANBUY||(p=REWARD_STATUS.UNAVAILABLE),p==REWARD_STATUS.AVAILABLE)return!0}return!1}},e[EActivityType.HeroStarSubTypeNumTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content),d=t.data.keyList,i=t.data.targeted;function a(t){var e=0;t=Number(t);var i=Math.floor(t/1e4),a=Math.floor((t-1e4*i)/100);for(var n in d){var o=d[n].taskType,r=d[n].key,s=Math.floor(o/1e4),c=Math.floor((o-1e4*s)/100);0==i?a<=c&&(e+=r):i==s&&a<=c&&(e+=r)}return e}for(var n in i[0]||(i=[]),e){var o=e[n],r=o[0],s=(o[1]+"").split(""),c=Number(s[s.length-1]),h=a(o[1]),l=REWARD_STATUS.CANBUY;if(c<=h&&(l=REWARD_STATUS.AVAILABLE),0<=i.indexOf(r)&&(l=REWARD_STATUS.RECEIVED),l==REWARD_STATUS.AVAILABLE)return!0}return!1}},e[EActivityType.TimerLuckyMoney3]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){return!1}},e[EActivityType.TimerLuckyMoney1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){return!1}},e[EActivityType.TimerLuckyMoney]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){var t=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!t||!t.data)return!1;var e=A.GameMgr.getInstance().serverTime(),i=JSON.parse(t.content),a=t.data.targeted,n=[],o=new Date(1e3*e);for(var r in o.setHours(0,0,0),n.push(o.getTime()/1e3),i[0]){var s=i[0][r],c=s[0],d=s[1],h=new Date(1e3*e);h.setHours(c[0],c[1],c[2]||0);var l=h.getTime()/1e3,p=new Date(1e3*e);p.setHours(d[0],d[1],d[2]||0);var u=p.getTime()/1e3;n.push(l),n.push(u)}for(var g=0;g<n.length-1;g++)if(e>=n[g]&&e<=n[g+1]){if(g%2==0)return!1;var m=!1;for(var r in a){var y=a[r];if(y>=n[g]&&y<=n[g+1]){m=!0;break}}return!m}return!1}},e[EActivityType.CollectWords]={protoName:"GetCommonActivityInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(t){if(!t||!t.data)return!1;var e,i=t.data.targeted,a=t.content,n=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),o=t.data.curCycle;for(var r in a[1])if((c=a[1][r])[0]==o){e=c[1];break}if(!e)return!1;for(var s=0;s<e.length;s++){var c,d=(c=e[s])[0],h=(c[1],c[2]),l=c[3],p=(REWARD_STATUS.UNAVAILABLE,0);for(var r in i){var u=i[r];if(u.id==d){p=u.num;break}}if(l<=p)REWARD_STATUS.RECEIVED;else if(h&&n.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}return!1},cycle:!0},e[EActivityType.NewYearChallenge]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content),i=t.data.sectionId>e[1].length?e[1].length-1:t.data.sectionId-1,a=e[1][i],n=(a[0],a[1]),o=[e[0]],r=A.GameMgr.getInstance().serverTime(),s=[];for(var c in o){var d=o[c],h=d[0],l=d[1],p=new Date(1e3*r);p.setHours(h[0],h[1],h[2]||0);var u=p.getTime()/1e3,g=new Date(1e3*r);g.setHours(l[0],l[1],l[2]||0);var m=g.getTime()/1e3;s.push(u),s.push(m)}var y=!1;r>=s[0]&&r<=s[1]&&(y=!0);var v=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N);return!(!y||!v.checkEnough(n))}},e[EActivityType.HeroConvert]={protoName:"GetCommonActivityInfo",getRewardName:"HeroConvert",checkNotice:void 0},e[EActivityType.VipPreferentialGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content)[0],i=t.data[0]&&t.data[0].times||0,a=e[1],n=e[2],o=A.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,r=REWARD_STATUS.UNAVAILABLE;a<=o&&(r=REWARD_STATUS.AVAILABLE);var s=void 0;for(var c in n){var d=n[c];if(d[0]==i+1){s=d;break}}s||(r=REWARD_STATUS.RECEIVED);var h=!1;switch(r){case REWARD_STATUS.UNAVAILABLE:h=!1;break;case REWARD_STATUS.AVAILABLE:h=A.GameMVC.backpackPy.checkEnough(s[1],!1);break;case REWARD_STATUS.RECEIVED:h=!1}return h}},e[EActivityType.ActivityGashapon]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=t.content[0];return A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N).checkEnough(e,!1)}},e[EActivityType.NewZoneConsumeRank1]={protoName:"",getRewardName:"",checkNotice:void 0},e[EActivityType.TopFarmMoneyRank]={protoName:"",getRewardName:"",checkNotice:void 0},e[EActivityType.ActivityGashapon1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=t.content[0];return A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N).checkEnough(e,!1)}},e[EActivityType.CommonShopSpecialItem]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.CommonShopSpecialItem1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.CommonShopSpecialItem2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.ZoneConsumeRank]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.DrawCardRatioImprove]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.DiamondRebate]={needPullWhenOpen:!0,protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation"},e[EActivityType.NewHeroShow]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.ZoneAuction]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.WchessShow]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.RechargeRotate]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){var e=!1;return t&&t.data&&(e=0<t.data.times),e}},e[EActivityType.RechargeRotate1]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){var e=!1;return t&&t.data&&(e=0<t.data.times),e}},e[EActivityType.RechargeRotate2]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){var e=!1;return t&&t.data&&(e=0<t.data.times),e}},e[EActivityType.QQZoneVipGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0,isOpen:function(){return Utils.agentConfig.other.isJhb}},e[EActivityType.OneChoice]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0,isOpen:function(t){if(!t||!t.data)return!1;var e=t.content[(t.data.day||1)-1],i=t.data.targeted;for(var a in i)if(i[a][0]==e[0])return!1;return!0}},e[EActivityType.DiamondLottery]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(t&&t.data)return 0<t.data.count||0==t.data.recharge},needPullWhenOpen:!0},e[EActivityType.ProfessionSuit]={protoName:"GetCommonActivityInfo",getRewardName:"ActiveProfessionSuit",checkNotice:void 0},e[EActivityType.BasicHeroGifts]={protoName:"GetCommonActivityInfo",getRewardName:"",formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",checkNotice:function(t){}},e[EActivityType.NewTurntable]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){return!(!t||!t.data)&&0<t.data.total}},e[EActivityType.EverydayTurntable]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){return!(!t||!t.data)&&0<t.data.total}},e[EActivityType.ZoneDevoteGoods]={protoName:"GetCommonActivityInfo",getRewardName:"",formatString:"%s"+Utils.SDKMgr.globalIAPSuffix+"礼包",checkNotice:function(t){if(!t||!t.data)return!1;function e(t,e,i,a){var n=[];for(var o in i){var r=i[o],s=r[0],c=r[1],d=REWARD_STATUS.UNAVAILABLE;s<=t&&(d=REWARD_STATUS.AVAILABLE),0<=e.indexOf(s)&&(d=REWARD_STATUS.RECEIVED);var h={id:s,key:t,status:d,rewards:c,btnFunc:a};n.push(h)}return n}var i=t.data,a=JSON.parse(t.content),n=!1;e(i.grade,i.targeted,a[1],void 0).forEach(function(t){t.status==REWARD_STATUS.AVAILABLE&&(n=!0)}),e(i.totalGrade,i.zoneTargeted,a[2],void 0).forEach(function(t){t.status==REWARD_STATUS.AVAILABLE&&(n=!0)});var o=a[4][1];return A.GameMVC.backpackPy.checkEnough(o,!1)&&(n=!0),n}},e[EActivityType.OtherDiamondGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",formatString:"",checkNotice:function(t){if(t&&t.data){var a=t.data.day,n=t.data.amounts,o=JSON.parse(t.data.giftTargeted),r=JSON.parse(t.content),s=!1;function e(t){var e=r[t];if(e[2]<=a){var i=0;o.forEach(function(t){t[0]==e[0]&&(i=t)}),n<e[3]&&(s=!0,A.ActivityOtherDiamondGifts.local_notice[e[2]]=!0),i<e[5]&&A.GameMVC.backpackPy.checkEnough(e[4],!1)&&(A.ActivityOtherDiamondGifts.local_notice[e[2]]=!0,s=!0)}}for(var i in A.ActivityOtherDiamondGifts.local_notice=[],r)e(i);return s}}},e[EActivityType.NewGrowFund]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){if(t&&t.data){var e=!1,i=JSON.parse(t.content),a=t.data.targeted;if(!t.data.buy)return!1;for(var n=A.GameMVC.playerPy.playerInfoVO.level,o=0;o<i[1].length;o++){var r=i[1][o],s=r[0],c=(r[1],REWARD_STATUS.AVAILABLE);0<=a.indexOf(s)?c=REWARD_STATUS.RECEIVED:n<s&&(c=REWARD_STATUS.UNAVAILABLE),c==REWARD_STATUS.AVAILABLE&&(e=!0)}return e}},isOpen:function(t){if(!t||!t.data)return!1;var e=t.content;if(!t.data.buy)return!1;for(var i=t.data.targeted,a=A.GameMVC.playerPy.playerInfoVO.level,n=!0,o=0;o<e[1].length;o++){var r=e[1][o],s=r[0],c=(r[1],REWARD_STATUS.AVAILABLE);0<=i.indexOf(s)?c=REWARD_STATUS.RECEIVED:a<s&&(c=REWARD_STATUS.UNAVAILABLE),c!=REWARD_STATUS.RECEIVED&&(n=!1)}return!n}},e[EActivityType.EatingZongZi]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content),i=e[1],a=A.GameMVC.backpackPy;for(var n in i){var o=i[n][1];if(a.checkEnough(o,!1))return!0}var r=t.data.integral||0,s=t.data.targeted,c=e[0];for(var n in c){var d=c[n][0];if(d<=r&&s.indexOf(d)<0)return!0}return!1}},e[EActivityType.DragonBoatGrade]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;var e=!1,i=JSON.parse(t.content),a=i[3],n=t.data.grade,o=t.data.targeted;for(var r in a){var s=a[r][0];if(s<=n&&o.indexOf(s)<0){e=!0;break}}var c=i[2];return A.GameMVC.backpackPy.checkEnough(c[0][0],!1)&&(e=!0),e}},e[EActivityType.DoubleTwelve]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",needPullWhenOpen:!0,checkNotice:void 0},e[EActivityType.ThirdLevelReward]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.ThirdLevelReward1]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve];return!(!t||!t.data)&&0<JSON.parse(t.data.rebateList).length}},e[EActivityType.DTRecharge]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DTRecharge1]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DTRecharge2]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DTRechargeGift]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.LimitNumGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.LimitNumGift1]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.TimerLuckyMoney2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){return!1}},e[EActivityType.DoubleElevenCostTimes1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){return A.GameMVC.activityPy.checkDoubleTaskNotice()},getEndDt:y.getActivityOneDayEndDt},e[EActivityType.ZoneFishing]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;var e=!1;if(0<t.data.playerInfo.snatchTimes)e=!0;else{var i=0,a=t.data.playerInfo.curCreelCode||1,n=t.content[2][a-1][2],o=t.data.playerInfo.creel;for(var r in o)i+=o[r][1];e=n<=i}return e}},e[EActivityType.ProfessionSuitReplacement]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(t){return t&&t.data,!1}},e[EActivityType.NewZoneGroupPurchase]={protoName:"GetCommonActivityInfo",getRewardName:"NewZoneGroupPurchasePurchase",formatString:"",checkNotice:function(t){if(!t||!t.data)return!1;var e=!1,i=JSON.parse(t.content),a=t.data.itemList;for(var n in i){var o=i[n],r=o[0],s=(o[1],o[2]),c=o[3],d=o[4],h=0,l=0;for(var p in a){var u=a[p];u.code==r&&(h=u.num,l=u.times)}var g=100;for(var m in d){var y=d[m];h>=y[0]&&(g=y[1])}var v=[[1,1,c*g/100]];if(l<s&&A.GameMVC.backpackPy.checkEnough(v,!1)){e=!0;break}}return e}},e[EActivityType.SecondDailyGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1},getEndDt:y.getActivityOneDayEndDt},e[EActivityType.VipWelfare]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(t&&t.data){for(var e=t.data.amounts,i=JSON.parse(t.data.dailyTargeted),s=JSON.parse(t.data.weekTargeted),a=JSON.parse(t.data.dailyAmountsTargeted),n=t.data.vip,c=A.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,o=JSON.parse(t.content),r=A.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],d=r&&r.data&&r.data.hasPurchased&&!0,h=!1,l=0;l<2;l++){var p=o[l];for(var u in p){var g=p[u];if(g[1]>=n&&g[1]<=c||0==l&&g[1]==c+1){var m=g[0],y=0==l?0:g[2],v=(0==l?g[2]:g[3],REWARD_STATUS.GO_RECHARGE);if(y<=e&&g[1]>=n&&g[1]<=c&&(v=REWARD_STATUS.AVAILABLE),0<=(0==l?i:a).indexOf(m)&&(v=REWARD_STATUS.RECEIVED),v==REWARD_STATUS.AVAILABLE&&d){h=!0;break}}}if(h)break}if(h)return h;function f(t){var e=p[t];if(_>=e[1]){var i=e[0],a=s,n=REWARD_STATUS.UNAVAILABLE;c>=e[2]&&(n=REWARD_STATUS.AVAILABLE);var o=0;a.forEach(function(t){t[0]==i&&(o=t[1])}),o>=e[3]&&(n=REWARD_STATUS.RECEIVED);var r=e[4];if(n==REWARD_STATUS.AVAILABLE&&A.GameMVC.backpackPy.checkEnough(r,!1))return h=!0,"break"}}h=!1,p=o[2];var _=A.GameMVC.playerPy.playerInfoVO.level;for(var u in p)if("break"===f(u))break;return h||A.GameMVC.rechargePy.checkVipGiftNotice()}}},e[EActivityType.WeekFund]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=!1,i=JSON.parse(t.content),a=t.data.amounts,n=t.data.targeted,o=t.data.day;for(var r in i[1]){var s=i[1][r],c=REWARD_STATUS.UNAVAILABLE;if(a>=i[0]&&o>=s[0]&&(c=REWARD_STATUS.AVAILABLE),0<=n.indexOf(s[0])&&(c=REWARD_STATUS.RECEIVED),c==REWARD_STATUS.AVAILABLE){e=!0;break}}return e}},e[EActivityType.WorldRechargeRank]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1}},e[EActivityType.SecondLevelReward]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;for(var e=A.GameMVC.playerPy.playerInfoVO.level,i=JSON.parse(t.content),a=Utils.TimerManager.getServerTime(),n=0;n<2;n++)for(var o=0,r=i[n],s=0==n?t.data.diamondTargeted:t.data.rechargeTargeted,c=0==n?t.data.diamondGifts:t.data.rechargeGifts,d=0;d<r.length;d++){var h=0,l=r[d],p=l[0],u=l[1];if(2==o)break;for(var g in c)if((y=c[g])[0]==p){h=y[1];break}if(!(h<=a)){var m=REWARD_STATUS.UNAVAILABLE;for(var g in u<=e?m=REWARD_STATUS.CANBUY:o++,s){var y;if((y=s[g])[0]==p){0<y[1]&&(m=REWARD_STATUS.RECEIVED);break}}if(m==REWARD_STATUS.CANBUY)return!0}}return!1},isOpen:function(t){if(!t||!t.data)return!1;for(var e=A.GameMVC.playerPy.playerInfoVO.level,i=JSON.parse(t.content),a=Utils.TimerManager.getServerTime(),n=0;n<2;n++)for(var o=0,r=i[n],s=0==n?t.data.diamondTargeted:t.data.rechargeTargeted,c=0==n?t.data.diamondGifts:t.data.rechargeGifts,d=0;d<r.length;d++){var h=0,l=r[d],p=l[0],u=l[1];if(2==o)break;for(var g in c)if((y=c[g])[0]==p){h=y[1];break}var m=REWARD_STATUS.UNAVAILABLE;for(var g in u<=e?m=REWARD_STATUS.CANBUY:o++,s){var y;if((y=s[g])[0]==p){0<y[1]&&(m=REWARD_STATUS.RECEIVED);break}}if(m==REWARD_STATUS.CANBUY&&a<h||m==REWARD_STATUS.UNAVAILABLE)return!0}return!1}},e[EActivityType.Quora]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!(!t||!t.data||t.data.isTargeted)}},e[EActivityType.Quora1]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!(!t||!t.data||t.data.isTargeted)}},e[EActivityType.NewZoneQuora]={protoName:"GetCommonActivityInfo",getRewardName:"GetZoneQuoraReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(e).isOpen}},e[EActivityType.NewZoneQuora1]={protoName:"GetCommonActivityInfo",getRewardName:"GetZoneQuoraReward",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(e).isOpen}},e[EActivityType.ThirdLevelReward2]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;for(var e=A.GameMVC.playerPy.playerInfoVO.level,i=JSON.parse(t.content)[0],a=t.data.diamondTargeted,n=0;n<i.length;n++){var o=i[n],r=o[0],s=o[1],c=REWARD_STATUS.UNAVAILABLE;for(var d in s<=e&&(c=REWARD_STATUS.CANBUY),a){var h=a[d];if(h[0]==r){h[1],h[1]>=o[4]&&(c=REWARD_STATUS.HASBUY);break}}if(0==o[2][0][2]&&c==REWARD_STATUS.CANBUY)return!0}return!1}},e[EActivityType.GameHallGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){return!1}},e[EActivityType.BlueDiamondGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){return!1}},e[EActivityType.RedBag]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){return!1}},e[EActivityType.PlayerRedBag]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){return!1}},e[EActivityType.TeamBoss]={protoName:"GetCommonActivityInfo",getRewardName:"NewZoneOperation",checkNotice:void 0},e[EActivityType.WomenArtifactReach]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return t&&t.data&&0<t.data.count}},e[EActivityType.NewCard]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.NewCard1]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.NewCard2]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.NewCard3]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.DiscountGifts]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DiscountGifts1]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DiscountGifts2]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.DiscountGifts3]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.Regression]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0,getEndDt:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.Regression];if(t&&t.data&&t.data.inActivity){var e=t.content,i=t.data.backDt,a=new Date(1e3*i);return a.setHours(0,0,0),Math.floor(a.getTime()/1e3)+86400*e[2]}return 0}},e[EActivityType.RaceTowerTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.AltarUnlockTask]=y.CommonConfig[EActivityType.MysticalShopRefreshTask],e[EActivityType.HonorOrderTask]=y.CommonConfig[EActivityType.CommonTask],e[EActivityType.HonorOrder]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;t.data.exp;var e=t.data.level,i=t.data.wasBought,a=JSON.parse(t.content);for(var n in a[0]){var o=a[0][n],r=REWARD_STATUS.UNAVAILABLE;if(e>=o[0]&&(r=REWARD_STATUS.AVAILABLE),i&&0<=t.data.honorRecord.indexOf(o[0])?r=REWARD_STATUS.RECEIVED:0<=t.data.normalRecord.indexOf(o[0])&&(r=REWARD_STATUS.RECEIVED),r==REWARD_STATUS.AVAILABLE)return!0}return!!NoticeManager.isNoticeShow(NT.ALL_ACTIVITY[EActivityType.HonorOrderTask])}},e[EActivityType.GloryRank]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.GloryRank];return t&&t.data,!1}},e[EActivityType.NewHuntTreasure]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.NewHuntTreasure];if(t&&t.data){var e=JSON.parse(t.content);if(0<A.GameMVC.backpackPy.getItemNumByCode(e[0][0][0][1]))return!0}return!1}},e[EActivityType.HeroEquipImprovement]={protoName:"",getRewardName:"DoCommonOperation",checkNotice:function(t){var e=A.GameMVC.heroThingPy.AllEquipInfo,i=[];for(var a in e){var n=e[a];if(n.config.color==EColorType.EColorTypeLegend&&2==n.config.kind&&(i.push(n),2<=i.length))return!0}return!1}},e[EActivityType.ClientTask]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1}},e[EActivityType.RiskSecretTerritory]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1}},e[EActivityType.TurnOverGame]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1}},e[EActivityType.NewBreakEggs]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=t.content,i=t.data.times||0,a=t.data.targetRecord;for(var n in e[1]){var o=e[1][n],r=REWARD_STATUS.UNAVAILABLE;if(i>=o[1]&&(r=REWARD_STATUS.AVAILABLE),0<=a.indexOf(o[0])&&(r=REWARD_STATUS.RECEIVED),r==REWARD_STATUS.AVAILABLE)return!0}return!1}},e[EActivityType.MagpieActivity]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.LiuYiRecharge]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.LiuYiTask]=y.CommonConfig[EActivityType.CommonTask],e[EActivityType.LiuYiExchange]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.LiuYiConsumeTask]=y.CommonConfig[EActivityType.CommonTask],e[EActivityType.LiuYiCard]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.LiuYiQuora]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content)[0],i=t.data.quora;return i&&i.quoraCode,(i?i.order-1:e)<e||!t.data.isTargeted}},e[EActivityType.BeachDiaoBao]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.BeachWishTrees]=y.CommonConfig[EActivityType.HuntTreasure],e[EActivityType.BeachRecharge]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.BeachRecharge1]=y.CommonConfig[EActivityType.DiscountGiftBag],e[EActivityType.BeachItemGift]=y.CommonConfig[EActivityType.ItemGifts],e[EActivityType.BeachTask]=y.CommonConfig[EActivityType.CommonTask],e[EActivityType.BeachCard]=y.CommonConfig[EActivityType.EnjoyCard],e[EActivityType.BirthDayCard]=y.CommonConfig[EActivityType.DailyLoginWeal],e[EActivityType.DivideDiamond]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",needPullWhenOpen:!0,checkNotice:function(t){if(!t||!t.data)return!1;var e=t.content;return t.data.targeted.length<e[1].length}},e[EActivityType.Commemoration]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.Commemoration];if(t&&t.data){var e=JSON.parse(t.data.keys);if(0==Object.keys(e).length)return!1;function i(t){var e=o[0][t],i=e[0];if(r.indexOf(i)<0)return"continue";e[2];var a=e[4],n=0;return s.forEach(function(t){t[0]==i&&(n=t[1])}),a<=n?void 0:{value:!0}}var o=t.content,r=t.data.diamondGifts,s=t.data.diamondTargeted,c=t.data.rechargeGifts,d=t.data.rechargeTargeted;for(var a in o[0]){var n=i(a);if("object"==typeof n)return n.value}function h(t){var e=o[1][t],i=e[0];if(c.indexOf(i)<0)return"continue";e[2];var a=e[4],n=0;return d.forEach(function(t){t[0]==i&&(n=t[1])}),a<=n?void 0:{value:!0}}for(var a in o[1]){var l=h(a);if("object"==typeof l)return l.value}}return!1}},e[EActivityType.BeachReach]={protoName:"",getRewardName:"DoCommonOperation",checkNotice:function(){var t=A.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(!t||!t.data)return!1;var e=JSON.parse(t.content)[3],i=t.data.maxLevel,a=t.data.targeted,n=2;for(var o in e){var r=e[o];if(r[0]>i)n=2;else{for(var s in n=1,a)a[s]==r[0]&&(n=0);if(1==n)return!0}}return!1}},e[EActivityType.BeachRank]={protoName:"",getRewardName:"DoCommonOperation",checkNotice:function(t){return!1}},e[EActivityType.NewPushGiftBag]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0,getEndDt:y.getActivityOneDayEndDt},e[EActivityType.HeroPushGiftBag]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0,getEndDt:y.getActivityOneDayEndDt},e[EActivityType.DouYinFansReach]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(t){if(!t||!t.data)return!1;if(!Utils.LocalStorageUtil.getTodayVaild("Activity348"))return!0;var e=JSON.parse(t.content),i=t.data.fans||0,a=t.data.targeted||[];for(var n in e[0]){var o=e[0][n],r=REWARD_STATUS.UNAVAILABLE;if(i>=o[1]&&(r=REWARD_STATUS.AVAILABLE),0<=a.indexOf(o[0])&&(r=REWARD_STATUS.RECEIVED),r==REWARD_STATUS.AVAILABLE)return!0}return!1}},e[EActivityType.NewNewHuntTreasure]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(){return!1}},e[EActivityType.PlayerBoss]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content)[1];return!!A.GameMVC.backpackPy.checkEnough(e,!1)}},e[EActivityType.PlayerBossEntrance]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},e[EActivityType.MazeExplore]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=JSON.parse(t.content);return A.GameMVC.backpackPy.checkEnough(e[4],!1)}},e[EActivityType.SummerTrain]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return!(!t||!t.data)&&0<JSON.parse(t.content)[1]-t.data.times}},e[EActivityType.ChoseDiscountGiftBag]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return t&&t.data,!1}},e[EActivityType.ChoseExchangeGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){return t&&t.data,!1}},e[EActivityType.HeroExplore]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;if(!t.data.exploreId)return!0;var e=JSON.parse(t.content),i=void 0;for(var a in e[0]){var n=e[0][a];if(n[0]==t.data.exploreId){i=n;break}}if(i){var o=Utils.TimerManager.getServerTime();return i[3]-(o-t.data.startDt)<=0}return!1}},e[EActivityType.MakeMoonCake]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=A.GameMVC.backpackPy.AllItemInfo;for(var i in e){var a=e[i][0],n=A.Config.itemConfig()[Number(i)];if(0==n.type&&1==n.subType&&0<a.num)return!0;if(0==n.type&&2==n.subType&&0<a.num)return!0}return!1}},e[EActivityType.EatMoonCake]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(t){if(!t||!t.data)return!1;var e=A.GameMVC.backpackPy.AllItemInfo;for(var i in e){var a=e[i][0],n=A.Config.itemConfig()[Number(i)];if(0==n.type&&2==n.subType&&0<a.num)return!0}return!1}},e)},y.getActivityConfigByType=function(t){var e=A.Config.activityConfigs(),i=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N),a=[];for(var n in e){var o=e[n],r=y.Config[n];if(r&&o.entrance==t&&o.inList&&Utils.UnlockMgr.checkPass(MODULE.Activity+o.id,!1).allow){var s=i.allActivityData[o.id];r.isOpen?r.isOpen(s)&&a.push(o):s&&a.push(o)}}return a.sort(function(t,e){return t.priority-e.priority}),a},y.commonTargetNoticeCheck=function(t,e){try{var i=y.Config[e];if(!i)return!1;if(!t||!t.data)return!1;var a=t.data.targeted;0==Object.keys(a).length&&(a=[]);var n=t.data.key||0,o=(t.data.day,JSON.parse(t.content)),r=t.data.curCycle;if(r&&i.cycle)for(var s in o[1]){var c=o[1][s];if(c[0]==r){o=c[1];break}}var d=!1;return o.forEach(function(t){var e=t[0];t[1],t[2],REWARD_STATUS.UNAVAILABLE,a.some(function(t){return t.id==e&&0<t.num})?REWARD_STATUS.RECEIVED:n>=t[1]&&(REWARD_STATUS.AVAILABLE,d=!0)}),d}catch(t){console.log("判断通用列表活动红点发送错误",t)}},y.commonTaskNoticeCheck=function(t,n){if(t&&t.data)try{var e=JSON.parse(t.content),i=t.data.targeted;function a(t){if(n==EActivityType.MagicalUpGradeTask||n==EActivityType.PetUpGradeTask){var e=0;for(var i in s)(a=s[i]).taskType>=t&&(e+=a.key);return c[t]=e}for(var i in s){var a;if((a=s[i]).taskType==t)return c[t]=a.key,a.key}}function o(t,e){switch(parseInt(n)){case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:case EActivityType.LiuYiConsumeTask:case EActivityType.TopFarmCoinRewardNum:case EActivityType.GuildTopFarmCoinRewardNum:return t;case EActivityType.CommonTask10:case EActivityType.QingMingTask:return e==TaskSubType.ActivityConsumeDiamond?t:t%1e4;default:return t%1e4}}function r(t,e){var i=t;switch(parseInt(n)){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:case EActivityType.HeroArtifactUpStarTask:case EActivityType.TopFarmCollectTime:case EActivityType.TopFarmBuildLevelNum:i=e[1]-e[1]%1e4}return i}i[0]||(i=[]);var s=t.data.keyList,c={};for(var d in e){var h=e[d],l=h[0],p=(h[2],h[3]),u=(h[4],r(p,h)),g=o(h[1],u),m=c[u]||a(u)||0,y=REWARD_STATUS.UNAVAILABLE;if(g<=m&&(y=REWARD_STATUS.AVAILABLE),0<=i.indexOf(l)&&(y=REWARD_STATUS.RECEIVED),y===REWARD_STATUS.AVAILABLE)return!0}return!1}catch(t){console.log(t)}},y.getActivityEndDt=function(t){if(y.Config[t]){var e=y.Config[t];return e.getEndDt?e.getEndDt(t):e.cycle?y.getActivityCycleEndDt(t):y.getActivityNormalEndDt(t)}return 0},y.getActivityNormalEndDt=function(t){var e=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[t];return e?e.endDt:0},y.getActivityCycleEndDt=function(t){var e=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[t];return e&&e.data?e.startDt+(e.data.curCycle||1)*JSON.parse(e.content)[0]*24*3600:0},y.getActivityOneDayEndDt=function(t){var e=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).allActivityData[t];if(e&&e.data){var i=new Date(1e3*Utils.TimerManager.getServerTime());return i.setHours(23,59,59),i.getTime()/1e3}return 0},y.getCurDay=function(t){if("number"==typeof t&&(t=A.GameMVC.activityPy.allActivityData[t]),t&&t.data){var e=t.startDt,i=Utils.TimerManager.getServerTime();return e<i?Math.ceil((i-e)/86400):0}return 0},y.getAllDayCount=function(t){if(t&&t.data){var e=t.startDt,i=t.endDt;return e<i?Math.floor((i-e)/86400):0}return 0},y.addAllActivityConfig=function(){y.addActivityConfig("FlashCapsuleHigh",0,12),y.addActivityConfig("DiscountGiftBag",0,26),y.addActivityConfig("ContinueRechargeReward",0,4),y.addActivityConfig("WishGifts",0,11),y.addActivityConfig("HuntTreasure",0,5),y.addActivityConfig("ItemGifts",0,20),y.addActivityConfig("SecondOpenServerRecharge",0,20),y.addActivityConfig("ProfessionSuit",0,12),y.addActivityConfig("WishTree",0,12),y.addActivityConfig("DiamondGifts",0,12),y.addActivityConfig("WeekFund",0,12),y.addActivityConfig("DailyLoginWeal",0,12),y.addActivityConfig("DiscountGiftBagDaily",0,10,"DiscountGiftBag"),y.addActivityConfig("CommonTask",0,10,"CommonTask"),y.addActivityConfig("SeventhOpenServerRecharge",0,20,"SecondOpenServerRecharge"),y.addActivityConfig("ThirdDiamondGifts",0,20,"DiamondGifts"),y.addActivityConfig("DrawCardRatioImprove",0,20,"DrawCardRatioImprove"),y.addActivityConfig("DermaJump",0,20,"DrawCardRatioImprove")},y.addActivityConfig=function(t,e,i,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a="");for(var n=e;n<=i;n++){var o=n?EActivityType[t+n]:EActivityType[t];o&&(a=a||t,y.Config[o]=y.CommonConfig[EActivityType[a]]||y.Config[EActivityType[a]])}},y.CommonConfig={},y.Config={},y);function y(){}A.ActivityConfig=t}(game=game||{}),function(j){var i,t=(i=BaseMediator,__extends(J,i),J.prototype.initSubView=function(){this.addSubView(J.SV.MAIN,j.ActivityRootPanel),this.addSubView(J.SV.FISHINGSHOP,j.ActivityFishingShopPanel),this.addSubView(J.SV.FISHINGCHALLGE,j.ActivityFishingChallengePanel),this.addSubView(J.SV.MAGPIE_GIFT,j.ActivityMagpieRewardPanel),this.addSubView(J.SV.MAGPIE_GIFT_ALL,j.ActivityMagpieRewardAllPanel),this.addSubView(J.SV.PUSH_BAG_COLLECTION,j.ActivityPushGiftBagCollection)},J.prototype.initSubviewByCode=function(){this.addSubviewByCode(EActivityType.SignIn,j.ActivitySignIn),this.addSubviewByCode(EActivityType.NewSignIn,j.Activity333),this.addSubviewByCode(EActivityType.LevelReward,j.ActivityLevelReward),this.addSubviewByCode(EActivityType.ExchangeCode,j.ActivityExchangeCode),this.addSubviewGroup2("SecondOpenServerRecharge",j.ActivitySecondOpenServerRecharge,0,20),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge1,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge2,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge1,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge2,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge3,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.QqzoneOpenServerRecharge,j.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge,j.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge1,j.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge2,j.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge3,j.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward,j.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward1,j.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward2,j.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward3,j.ActivitySecondContinueRechargeReward),this.addSubviewGroup2("SeventhOpenServerRecharge",j.ActivitySeventhOpenServerRecharge,0,20),this.addSubviewByCode(EActivityType.SingleRecharge,j.ActivitySingleRecharge),this.addSubviewByCode(EActivityType.ActivityShop,j.ActivityShop),this.addSubviewByCode(EActivityType.MonthCard,j.ActivityMonthCard),this.addSubviewByCode(EActivityType.EnjoyCard,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard1,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard2,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard3,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard4,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard5,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.ExtremeBattle,j.ActivityExtremeChallengeView),this.addSubviewByCode(EActivityType.CollectHero,j.ActivityCollectHeroView),this.addSubviewByCode(EActivityType.DailyLogin,j.ActivityDailyLogin),this.addSubviewByCode(EActivityType.DiamondReward,j.ActivityCommonTargetListView),this.addSubviewGroup2("FlashCapsuleHigh",j.ActivityCommonTargetListView,0,12),this.addSubviewByCode(EActivityType.FlashCapsuleRace,j.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace1,j.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace2,j.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace3,j.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.RiskLayer,j.ActivityCommonTargetListView),this.addSubviewGroup2("DiscountGiftBag",j.ActivityCommonRechargeListView,0,26),this.addSubviewGroup2("DiscountGiftBagDaily",j.ActivityCommonRechargeListView,0,10),this.addSubviewByCode(EActivityType.AwakenGiftBag,j.ActivityAwakenGiftBag),this.addSubviewByCode(EActivityType.WeekGift,j.Activity85),this.addSubviewByCode(EActivityType.MonthGift,j.Activity85),this.addSubviewGroup2("DiamondGifts",j.ActivityDiamondGifts,0,10),this.addSubviewByCode(EActivityType.SecondDiamondGifts,j.ActivityDiamondGifts),this.addSubviewGroup2("ItemGifts",j.ActivityItemGifts,0,20),this.addSubviewByCode(EActivityType.CollectWords,j.ActivityItemGifts),this.addSubviewByCode(EActivityType.TriggerGifts,j.ActivityTriggerGiftsView),this.addSubviewByCode(EActivityType.BasicHeroGifts,j.ActivityTriggerGiftsView),this.addSubviewByCode(EActivityType.FirstRecharge1,j.ActivityFirstRechargeView),this.addSubviewByCode(EActivityType.DailyLuxuryGifts5,j.Activity93),this.addSubviewByCode(EActivityType.DailyLuxuryGifts1,j.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts2,j.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts3,j.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts4,j.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.VipLevelGift,j.ActivityVipGift),this.addSubviewByCode(EActivityType.CommentLike,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TouchGoldHandTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TouchGoldHandTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ArenaChallengeTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ArenaChallengeTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask2,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask2,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MysticalShopRefreshTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MysticalShopRefreshTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.GuildCollectTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.GuildCollectTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ActivityGashaponTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ActivityGashaponTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SecondModuleGoalReward,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MagicalUpGradeTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.PetUpGradeTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TreasureJewelTotalLevelTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.QuenchceMasterMaxLevelTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.HeroArtifactTotalBaptizeTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TopFarmCollectTime,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TopFarmCoinRewardNum,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TopFarmBuildLevelNum,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.GuildTopFarmCoinRewardNum,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.HeroArtifactUpStarTask,j.ActivityHeroArtifactUpTaskView),this.addSubviewByCode(EActivityType.ConsumeDiamondTask,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ConsumeDiamondTask1,j.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.NewZoneConsumeRank1,j.ActivityNewZoneConsumeRank1View),this.addSubviewByCode(EActivityType.TopFarmMoneyRank,j.ActivityNewZoneConsumeRank1View),this.addSubviewGroup2("CommonTask",j.ActivityCommonTaskView,0,9),this.addSubviewByCode(EActivityType.CommonTask10,j.ActivityCommonTaskListPanel),this.addSubviewByCode(EActivityType.FriendShare,j.ActivityFriendShare),this.addSubviewByCode(EActivityType.OneYuanGifts,j.ActivityOneYuanGifts),this.addSubviewByCode(EActivityType.OneYuanGifts2,j.ActivitySixtyEightYuanGifts),this.addSubviewByCode(EActivityType.WeChatShare,j.ActivityWeChatShareCommonPanel),this.addSubviewByCode(EActivityType.NewYearWeekCrad,j.ActivityNewYearWeekCrad),this.addSubviewByCode(EActivityType.NewYearChallenge,j.ActivityNewYearChallenge),this.addSubviewGroup2("DailyLoginWeal",j.ActivityDailyLoginWeal,0,15),this.addSubviewByCode(EActivityType.TimerLuckyMoney,j.ActivityTimerLuckyMoney),this.addSubviewByCode(EActivityType.ActivityGashapon,j.ActivityGashaponView),this.addSubviewByCode(EActivityType.ActivityGashapon1,j.ActivityGashaponView),this.addSubviewByCode(EActivityType.HeroConvert,j.ActivityHeroConvertView),this.addSubviewByCode(EActivityType.CommonShopSpecialItem,j.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.CommonShopSpecialItem1,j.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.CommonShopSpecialItem2,j.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.SixtyEightYuanGifts,j.ActivitySixtyEightYuanGifts),this.addSubviewGroup2("DrawCardRatioImprove",j.ActivityDrawCardRatioImprove,0,20),this.addSubviewGroup2("DermaJump",j.ActivityDrawCardRatioImprove,0,20),this.addSubviewByCode(EActivityType.PlayerBossEntrance,j.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.NewBraveBook,j.ActivityBraveBookViewNew),this.addSubviewByCode(EActivityType.ZoneAuction,j.ActivityAuctionEntry),this.addSubviewByCode(EActivityType.ZoneAuction1,j.ActivityAuction),this.addSubviewByCode(EActivityType.OneChoice,j.ActivityOneChoice),this.addSubviewByCode(EActivityType.WchessShow,j.ActivityWchessShow),this.addSubviewGroup2("HuntTreasure",j.ActivityTreasureHunter,0,5),this.addSubviewByCode(EActivityType.RechargeRotate,j.ActivityTreasureHunter),this.addSubviewByCode(EActivityType.RechargeRotate1,j.ActivityTreasureHunter),this.addSubviewGroup2("ProfessionSuit",j.ActivityProfessionSuitView,0,5),this.addSubviewByCode(EActivityType.NewItemGifts,j.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewItemGifts1,j.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewItemGifts2,j.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewExchangeGifts,j.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewNewItemGifts,j.ActivityNewNewItemGifts),this.addSubviewByCode(EActivityType.ZoneDevoteGoods,j.ActivityZoneDevoteGoods),this.addSubviewGroup2("WishGifts",j.ActivityWishGifts,0,11),this.addSubviewByCode(EActivityType.NewHeroShow,j.ActivityNewHeroShow),this.addSubviewByCode(EActivityType.OtherDiamondGifts,j.ActivityOtherDiamondGifts),this.addSubviewByCode(EActivityType.NewGrowFund,j.ActivityNewGrowFund),this.addSubviewByCode(EActivityType.QQZoneVipGift,j.VIPPrivilegeView),this.addSubviewByCode(EActivityType.EatingZongZi,j.ActivityEatingZongZi),this.addSubviewByCode(EActivityType.DragonBoatGrade,j.ActivityDragonBoatGrade),this.addSubviewByCode(EActivityType.DiamondRebate,j.ActivityDiamondRebateView),this.addSubviewByCode(EActivityType.NewZoneGroupPurchase,j.ActivityNewZoneGroupPurchase),this.addSubviewByCode(EActivityType.InvitationCode,j.ActivityInviteCode),this.addSubviewByCode(EActivityType.PushGiftBag,j.ActivityPushGiftBag),this.addSubviewByCode(EActivityType.NewOneYuanGifts,j.ActivityNewYuanGiftsByRandom),this.addSubviewByCode(EActivityType.ZoneFishing,j.ActivityFishingView),this.addSubviewByCode(EActivityType.DoubleTwelve,j.Activity211),this.addSubviewByCode(EActivityType.ThirdLevelReward1,j.Activity1201),this.addSubviewByCode(EActivityType.LimitNumGift1,j.Activity1202),this.addSubviewByCode(EActivityType.TimerLuckyMoney2,j.ActivityShuang12LuckyMoney),this.addSubviewByCode(EActivityType.DTRecharge,j.Activity207),this.addSubviewByCode(EActivityType.DTRecharge1,j.Activity207),this.addSubviewByCode(EActivityType.DTRecharge2,j.Activity207),this.addSubviewByCode(EActivityType.DTRechargeGift,j.Activity207),this.addSubviewGroup2("ContinueRechargeReward",j.ActivityContinueRechargeReward,0,4),this.addSubviewGroup2("ThirdDiamondGifts",j.ActivityThirdDiamondGifts,0,20),this.addSubviewByCode(EActivityType.VipPreferentialGift,j.ActivityVipPreferentialGift),this.addSubviewGroup2("WishTree",j.Activity162,0,20),this.addSubviewGroup2("DiamondLottery",j.Activity170,0,0),this.addSubviewByCode(EActivityType.BlessingBox,j.Activity163),this.addSubviewByCode(EActivityType.HeroStarSubTypeNumTask,j.Activity173),this.addSubviewByCode(EActivityType.SecondDailyGifts,j.Activity174),this.addSubviewByCode(EActivityType.VipWelfare,j.Activity175),this.addSubviewGroup2("WeekFund",j.Activity176,0,10),this.addSubviewByCode(EActivityType.WorldRechargeRank,j.Activity177),this.addSubviewByCode(EActivityType.SecondLevelReward,j.Activity179),this.addSubviewByCode(EActivityType.ProfessionSuitReplacement,j.ActivityChangeEqui),this.addSubviewByCode(EActivityType.BeachDiaoBao,j.Activity336),this.addSubviewByCode(EActivityType.BeachWishTrees,j.Activity282),this.addSubviewByCode(EActivityType.BeachRecharge,j.ActivityCommonRechargeListPanel),this.addSubviewByCode(EActivityType.BeachRecharge1,j.ActivityCommonRechargeListPanel),this.addSubviewByCode(EActivityType.BeachItemGift,j.Activity250),this.addSubviewByCode(EActivityType.BeachTask,j.ActivityCommonTaskListPanel),this.addSubviewByCode(EActivityType.BeachCard,j.Activity327),this.addSubviewByCode(EActivityType.BirthDayCard,j.Activity342),this.addSubviewByCode(EActivityType.DivideDiamond,j.Activity343),this.addSubviewByCode(EActivityType.Commemoration,j.Activity344),this.addSubviewByCode(EActivityType.BeachReach,j.Activity345),this.addSubviewByCode(EActivityType.BeachRank,j.Activity346),this.addSubviewByCode(EActivityType.Beach,j.Activity347),this.addSubviewByCode(EActivityType.Quora,j.Activity184),this.addSubviewByCode(EActivityType.NewZoneQuora,j.Activity186),this.addSubviewByCode(EActivityType.CertificationReward,j.Activity194),this.addSubviewByCode(EActivityType.GameHallGift,j.Activity208),this.addSubviewByCode(EActivityType.BlueDiamondGift,j.Activity209),this.addSubviewByCode(EActivityType.Regression,j.Activity295),this.addSubviewByCode(j.Activity235.groupActivityCode.entrance,j.Activity235),this.addSubviewByCode(j.Activity235.groupActivityCode.recharge,j.ActivityCommonRechargeListPanel),this.addSubviewByCode(j.Activity235.groupActivityCode.task,j.ActivityCommonTaskListPanel),this.addSubviewByCode(EActivityType.DiscountGifts,j.Activity280),this.addSubviewByCode(EActivityType.DiscountGifts1,j.Activity280),this.addSubviewByCode(EActivityType.DiscountGifts2,j.Activity280),this.addSubviewByCode(EActivityType.DiscountGifts3,j.Activity280),this.addSubviewByCode(EActivityType.NewCard,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.NewCard1,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.NewCard2,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.NewCard3,j.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.LiuYiExchange,j.Activity250),this.addSubviewByCode(EActivityType.LiuYiRecharge,j.ActivityCommonRechargeListPanel),this.addSubviewByCode(EActivityType.LiuYiTask,j.ActivityCommonTaskListPanel),this.addSubviewByCode(EActivityType.LiuYiConsumeTask,j.ActivityCommonTaskListPanel),this.addSubviewByCode(EActivityType.LiuYiQuora,j.Activity269),this.addSubviewByCode(EActivityType.LiuYiCard,j.Activity327),this.addSubviewByCode(EActivityType.HeroEquipImprovement,j.Activity289),this.addSubviewByCode(EActivityType.ClientTask,j.Activity290),this.addSubviewByCode(EActivityType.RechargeRotate2,j.Activity2127),this.addSubviewByCode(EActivityType.RiskSecretTerritory,j.Activity319),this.addSubviewByCode(EActivityType.HonorOrder,j.Activity303),this.addSubviewByCode(EActivityType.GloryRank,j.Activity304),this.addSubviewByCode(EActivityType.RaceTowerTask,j.Activity305),this.addSubviewByCode(EActivityType.HonorOrderTask,j.Activity306),this.addSubviewByCode(EActivityType.NewHuntTreasure,j.Activity307),this.addSubviewByCode(EActivityType.AltarUnlockTask,j.Activity308),this.addSubviewByCode(EActivityType.TurnOverGame,j.Activity321),this.addSubviewByCode(EActivityType.NewBreakEggs,j.Activity322),this.addSubviewByCode(EActivityType.NewExchangeGifts,j.Activity323),this.addSubviewByCode(EActivityType.NewPushGiftBag,j.Activity334),this.addSubviewByCode(EActivityType.HeroPushGiftBag,j.ActivityPushPetGiftBag),this.addSubviewByCode(EActivityType.DouYinFansReach,j.Activity348),this.addSubviewByCode(EActivityType.NewNewHuntTreasure,j.Activity349),this.addSubviewByCode(EActivityType.PlayerBoss,j.Activity350),this.addSubviewByCode(EActivityType.MazeExplore,j.Activity352),this.addSubviewByCode(EActivityType.SummerTrain,j.Activity353),this.addSubviewByCode(EActivityType.MakeMoonCake,j.Activity358),this.addSubviewByCode(EActivityType.EatMoonCake,j.Activity359),this.addSubviewByCode(EActivityType.ChoseDiscountGiftBag,j.Activity354),this.addSubviewByCode(EActivityType.ChoseExchangeGifts,j.Activity354),this.addSubviewByCode(EActivityType.HeroExplore,j.Activity356),this.addSubviewByCode(EActivityType.RedBag,j.Activity210),this.addSubviewByCode(EActivityType.PlayerRedBag,j.Activity210),this.addSubviewByCode(EActivityType.ShiMingRenZheng,j.ActivitySDKSMRZView),this.addSubviewByCode(EActivityType.WeiDuanXiaZai,j.ActivitySDKWDXZView),Utils.isXYX()?(this.addSubviewByCode(EActivityType.ShouCangYouLi,j.ActivityGZGZHView),2==Utils.SDKMgr.getPerformConfig(200007)?this.addSubviewByCode(EActivityType.GuanZhuGongZhongHao,j.ActivityGZGZHView2):this.addSubviewByCode(EActivityType.GuanZhuGongZhongHao,j.ActivityGZGZHView)):(this.addSubviewByCode(EActivityType.ShouCangYouLi,j.ActivityShouCangYouLiView),this.addSubviewByCode(EActivityType.GuanZhuGongZhongHao,j.ActivitySDKGZHView)),this.addSubviewByCode(EActivityType.NewTurntable,j.ActivityNewTurnTable),this.addSubviewByCode(EActivityType.EverydayTurntable,j.ActivityEverydayTurnTable),this.addSubviewByCode(EActivityType.MagpieActivity,j.ActivityMagpieView),this.addSubviewByCode(EActivityType.TodayActivity,j.ActivityTodayShowPanel)},J.prototype.initNotice=function(){},J.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.PLAYER_LEVEL_UP,CN.ACTIVITY_ADD_TRIGGER,CN.ACTIVITY_SHOW_TRIGGER,CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE,CN.MONEY_UPDATE,CN.SHOW_WECHAT_SHARE,CN.ADD_WECHAT_SHARE_INFO,CN.GENERAL_PASS_DAY,CN.ACTIVITY_MID_ALLGIFT_UPDATE,CN.QQZONE_GIFT_VIEW,CN.PLAYER_INFO_ERROR,CN.QQZONE_PUSH_MESSAGE,CN.QQZONE_POPUP_VIEW,CN.GUIDE_FIRST_CHARPTER_END,CN.FIRST_INTO_CITY_FOR_EVERYDAY,CN.ACTIVITY_PUSH_GIFT_OPEN,CN.ACTIVITY_PUSH_GIFT_CLOSE,CN.ACTIVITY_PUSH_GIFT_COLLECTION_UPDATE,CN.GAME_HEARTBEAT]},J.prototype.handleNotification=function(t){var e=t.getBody();switch(t.getName()){case CN.LOGIN_FINAL_DONE:this.initSubviewByCode(),this.activityProxy.GetActivityList(),this.activityProxy.GetRelationInfo(RelationType.Recommend),this.activityProxy.GetRelationInfo(RelationType.Share),this.sendNotification(CN.QQZONE_POPUP_VIEW,{type:4}),this.sendNotification(CN.QQZONE_GIFT_VIEW);break;case CN.GAME_HEARTBEAT:break;case CN.GENERAL_PASS_DAY:this.activityProxy.GetActivityList(),this.activityProxy.GetRelationInfo(RelationType.Recommend),this.activityProxy.GetRelationInfo(RelationType.Share);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.LevelReward]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.NewGrowFund]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.SecondLevelReward]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.WeekGift]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MonthGift]);break;case CN.ACTIVITY_ADD_TRIGGER:this.ActivityTriggerList.push(e);break;case CN.FIRST_INTO_CITY_FOR_EVERYDAY:if(j.GameMVC.activityPy.isOpen(EActivityType.PushGiftBag)){if(!(p=j.GameMVC.activityPy.allActivityData[EActivityType.PushGiftBag])||!p.data)return;if(!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.PushGiftBag,!1).allow)return;var i=Utils.TimerManager.getServerOpenDays(),a=p.data.vipLevel,n=JSON.parse(p.content),o=[];for(var r in n)if((c=n[r])[0]==i)for(var s in c[1])(d=c[1][s])[1]==a&&(o=d[0]);if(!o)return;if(!(S=j.GameMVC.rechargePy.getGoodInfo(o)))return;j.GameMVC.activityMed.showViewByCode(EActivityType.PushGiftBag)}if(j.GameMVC.activityPy.isOpen(EActivityType.NewPushGiftBag)){if(!(p=j.GameMVC.activityPy.allActivityData[EActivityType.NewPushGiftBag])||!p.data)return;if(!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.NewPushGiftBag,!1).allow)return;for(var r in i=Utils.TimerManager.getServerOpenDays(),a=p.data.vipLevel,n=JSON.parse(p.content),o=[],n){var c;if((c=n[r])[0]==i)for(var s in c[1]){var d;(d=c[1][s])[1]==a&&(o=d[0])}}if(!o)return;if(!(S=j.GameMVC.rechargePy.getGoodInfo(o)))return;j.GameMVC.activityMed.showViewByCode(EActivityType.NewPushGiftBag)}break;case CN.ACTIVITY_SHOW_TRIGGER:if(e&&e.clear)return void(this.ActivityTriggerList=[]);if(0<this.ActivityTriggerList.length){var h=j.AppFacade.getInstance().retrieveProxy(j.ActivityPy.N),l=EActivityType.TriggerGifts,p=h.allActivityData[l],u=JSON.parse(p.content),g=j.AppFacade.getInstance().retrieveProxy(j.RechargePy.N).goodList;for(var m in Utils.TimerManager.getServerTime(),this.ActivityTriggerList){var y=this.ActivityTriggerList[m],v=0;for(var r in u[0]){var f=u[0][r];f[0]==y.code&&(v=f[1])}if(v){var _=void 0;for(var A in g)if(v==(S=g[A]).id){_=S;break}var T="\n",b=0;if(y.triggerType==TriggerGiftsTriggerType.TeamLevelUp?(T="恭喜你激活了%s级等级礼包，\n是否前往购买",b=y.triggerKey):y.triggerType==TriggerGiftsTriggerType.HeroUpStar&&(T="恭喜你激活了%s星英雄成长礼包，\n是否前往购买",(n=j.Config.allHeroConfig()[y.triggerKey])&&n.initStar&&(b=n.initStar)),_){j.GameMgr.getInstance().showCommonTipsWin({commonTips:T.format([b]),cost:"[]",btnStyle:{cancel:j.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:j.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(t){1==t.type&&j.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.TriggerGifts)}});break}}}this.ActivityTriggerList=[]}break;case CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE:if(p=j.GameMVC.activityPy.allActivityData[EActivityType.BasicHeroGifts]){var C=JSON.parse(p.content),E=p.data.gifts[0];if(E){var I=C[0][E.code-1],S=void 0;for(var b in g=j.GameMVC.rechargePy.goodList){var w=g[b];if(I[1]==w.id){S=w;break}}if(S){var M=E.triggerKey,R="";M&&(R=j.Config.allHeroConfig()[M].name),j.GameMgr.getInstance().showCommonTipsWin({commonTips:"恭喜激活了英雄礼包"+(""==R?"":"-"+R)+"，\n是否前往购买？",btnStyle:{cancel:j.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:j.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(t){1==t.type&&j.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.BasicHeroGifts)}})}}else j.GameMVC.activityMed.updateViewByCode(EActivityType.TriggerGifts)}break;case CN.ACTIVITY_MID_ALLGIFT_UPDATE:break;case CN.MONEY_UPDATE:(Y=this.getSubView(J.SV.MAIN))&&Y.updateResourceBar(),j.GameMVC.activityMed.updateViewByCode(EActivityType.TriggerGifts),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.NewZoneGroupPurchase]);break;case CN.ADD_WECHAT_SHARE_INFO:this.shareInfo=e.type;break;case CN.SHOW_WECHAT_SHARE:if(l=this.shareInfo,e&&e.filter&&l!=WeChatTargetType.ObtainFiveStarHero)return;l&&j.AppFacade.getInstance().retrieveMediator(J.N).showViewByCode(EActivityType.WeChatShare,{type:this.shareInfo}),this.shareInfo=void 0;break;case CN.PLAYER_INFO_ERROR:if(e){Utils.Socket.needReconnect=!1;var U={tips:"",clickCB:void 0};10143==e.error?(U.tips="该账号已在其他地方登陆，是否刷新游戏？",Utils.SDKMgr.cmd({type:"DingHaoTiShi"},function(t){t&&t.tips&&(U.tips=t.tips),t&&t.clickCB&&(U.clickCB=t.clickCB)})):11187==e.error&&(U.tips="系统检测到当前游戏行为可能存在异常，请尝试重新登录"),j.GameMgr.getInstance().showCommonTipsWin({clickDarkClose:!1,noOKBtn:!0,commonTips:U.tips,btnStyle:{cancel:j.CommonTipsDialog.BTN_STYLE.CONFIRM},clickCB:function(t){U.clickCB?U.clickCB():j.GameMgr.getInstance().restart()}})}break;case CN.GUIDE_FIRST_CHARPTER_END:j.GameMVC.playerPy.checkAndPopSthWhenFirstGuideEnd();break;case CN.QQZONE_POPUP_VIEW:if(!Utils.SDKMgr.getPerformConfig(10021))return;if(1==(l=e.type))PopUpManager.addPopUp({obj:new j.QQLiveView({cb:e&&e.cb})});else if(2==l)j.AppFacade.getInstance().retrieveMediator(J.N).showViewByCode(EActivityType.ShouCangYouLi);else if(3==l){var k=Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"downloadGameAPP"}}),N=Utils.agentConfig.other.packName&&""!=Utils.agentConfig.other.packName;if(getUrlKV().qua&&"PC"==getUrlKV().qua.app||!k||!N)return;var P=-1!=j.GameMVC.activityPy.giftList.indexOf(1101),x=-1!=j.GameMVC.activityPy.giftList.indexOf(1102),L=Utils.SDKMgr.extraFuncForAgent({type:"appDownload"}),D="gameApp"!=getUrlKV().channel&&(L&&x||!L&&!x)&&!P,B="gameApp"==getUrlKV().channel&&L&&x&&!P;1==getUrlKV().platform&&(D||B)&&PopUpManager.addPopUp({obj:new j.NativeDownloadView})}else if(4==l&&getUrlKV().channel){var V=getUrlKV().channel,O=j.GameMVC.activityPy.giftList;"1"!=Utils.LocalStorageUtil.getItem(V)&&("huangzuan"==V&&-1==O.indexOf(2403)||"QQVip"==V&&-1==O.indexOf(2404))&&(Utils.LocalStorageUtil.setItem(V,"1"),PopUpManager.addPopUp({obj:new j.QQCommonGiftView({type:V})}))}break;case CN.QQZONE_PUSH_MESSAGE:if(Utils.agentConfig.other.isJhb){var G=e.data;switch(e.type){case"playerLevelUp":Math.floor(G.newLevel/10)>Math.floor(G.oldLevel/10)&&j.GameMVC.activityPy.pushMessageToFriends({content:"达到"+G.newLevel+"等级，快来一起打怪升级呀！"});break;case"areanChallenge":j.GameMVC.activityPy.pushMessageToFriends({source:MODULE.Arena,content:"你们的竞技场排名已经被我取代了，就问你服不服？"});break;case"championAchievement":G.id%10==0&&j.GameMVC.activityPy.pushMessageToFriends({source:MODULE.Champion,content:"永恒之塔已经挑战至"+G.targetId+"层了，抓紧时间和他交流一下经验吧。"});break;case"worldKingRank":if(G.oldLevel&&G.curLevel>G.oldLevel){var F=j.Config.worldKingLevelConfig()[G.curLevel].name;j.GameMVC.activityPy.pushMessageToFriends({source:MODULE.WorldKing,content:"在排位赛中达成"+F+"段位，赶紧上线挑战吧，可不能被人小瞧。"})}}}break;case CN.QQZONE_GIFT_VIEW:if(Utils.agentConfig.other.isJhb){var H=getUrlKV().GIFT;H&&j.GameMVC.activityPy.getGiftReward({giftId:H})}break;case CN.ACTIVITY_PUSH_GIFT_OPEN:if(!(Y=j.GameMVC.activityMed.getViewByCode(EActivityType.NewPushGiftBag))){var W=j.GameMVC.activityPy.newPushList.shift();W&&j.GameMVC.activityMed.showViewByCode(EActivityType.NewPushGiftBag,{uuid:W})}break;case CN.ACTIVITY_PUSH_GIFT_CLOSE:(Y=j.GameMVC.activityMed.getViewByCode(EActivityType.NewPushGiftBag))&&Y.uuid==e.uuid&&Y.hide();break;case CN.ACTIVITY_PUSH_GIFT_COLLECTION_UPDATE:var Y;(Y=this.getSubView(J.SV.PUSH_BAG_COLLECTION))&&Y.updateView()}},J.prototype.addSubviewByCode=function(t,e){var i=this.encodeActCode2string(t);i&&""!=i&&this.addSubView(i,e)},J.prototype.addSubviewGroup=function(t,e){for(var i=0;i<t.length;i++)this.addSubviewByCode(t[i],e)},J.prototype.addSubviewGroup2=function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=0);for(var n=i;n<=a;n++){var o=n?EActivityType[t+n]:EActivityType[t];o&&this.addSubviewByCode(o,e)}},J.prototype.updateViewByCode=function(t,e){e?e.activityType=t:e={activityType:t},this.updateView(this.encodeActCode2string(t),e)},J.prototype.getViewByCode=function(t){var e=this.encodeActCode2string(t);return this.getSubView(e)},J.prototype.showViewByCode=function(t,e){var i=this,a=this.encodeActCode2string(t),n=parseInt(a.split("#")[0]),o=j.ActivityConfig.Config[t];o&&o.needPullWhenOpen&&this.activityProxy.GetActivityInfo(t,function(){i.updateViewByCode(t)}),n?this.getSubView(J.SV.MAIN)?(e?e.activityType=t:e={activityType:t},this.showSubView(a,e)):this.showSubView(J.SV.MAIN,{viewType:n,code:t,activityType:t}):(e&&!e.activityType&&(e.activityType=t),this.showSubView(a,e||{code:t,activityType:t}))},J.prototype.hideViewByCode=function(t){this.hideSubView(this.encodeActCode2string(t))},J.prototype.encodeActCode2string=function(t){if(!this._viewIdCache[t]){var e=j.Config.activityConfigs()[t],i=0;e&&e.inList?(i=e.entrance,this._viewIdCache[t]=i+"#"+t):this._viewIdCache[t]="0#"+t}return this._viewIdCache[t]},J.prototype.updateBtn=function(t,e){switch(e){case REWARD_STATUS.UNAVAILABLE:t.label="领取",UIActionManager.setGrey(t,!0),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8;break;case REWARD_STATUS.RECEIVED:t.skinName="skins.ButtonSkinSure",t.label="已领取",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=1;break;case REWARD_STATUS.CANBUY:t.skinName="skins.ButtonSkinYellow",t.label="购买",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8;break;case REWARD_STATUS.HASBUY:t.skinName="skins.ButtonSkinSure",t.label="已购买",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=1;break;case REWARD_STATUS.GO_RECHARGE:t.skinName="skins.ButtonSkinYellow",t.label="充值",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8;break;case REWARD_STATUS.UNAVAILABLE_BUY:t.skinName="skins.ButtonSkinYellow",t.label="购买",UIActionManager.setGrey(t,!0),t.scaleX=t.scaleY=.8;break;case REWARD_STATUS.NEXT_REWARD:t.visible=!1;break;default:t.label="领取",UIActionManager.setGrey(t,!1),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8}},J.prototype.showHelpDialog=function(t){if(t){var e=[];for(var i in t){var a=t[i];for(var n in a){var o=a[n];parseInt(n)%2==0?e.push({text:o}):e.push({text:o,style:{textColor:36807}})}e.push({text:"\n"})}PopUpManager.addPopUp({obj:new j.HelpDialog({text:e})})}else Utils.MsgUtils.addMidMsg("未找到说明配置")},J.prototype.CommonGpAddReward=function(i,a,n){if(void 0===n&&(n=.8),i&&a)if("string"==typeof a)a=JSON.parse(a),this.CommonGpAddReward(i,a,n);else if(Array.isArray(a))a.forEach(function(t){var e=customui.BaseItemFactory.create();e.scaleX=e.scaleY=n,Array.isArray(t)?e.updateData({reward:t}):e.updateData(t),i.addChild(e)});else{function t(e){var t=a[e];Array.isArray(t)&&t.forEach(function(t){switch(e){case"rewards":o.push(t);break;case"heros":o.push({uuid:t.uuid,type:EEntityType.EEntityTypeHero});break;case"vestageHeros":o.push({uuid:t.uuid,type:EEntityType.EEntityTypeVestageHero});break;case"heroEquips":o.push({code:t.code,type:EEntityType.EEntityTypeHeroEquip,num:t.num});break;case"heroArtifacts":o.push({code:t.code,type:EEntityType.EEntityTypeHeroArtifact,num:t.num});break;case"maps":o.push({uuid:t.uuid,type:EEntityType.EEntityTypeMap})}})}var o=[];for(var e in a)t(e);this.CommonGpAddReward(i,o,n)}},J.prototype.CommonGpAddReward2=function(a,i,n,o){if(void 0===n&&(n=.8),void 0===o&&(o=!0),a&&i)if("string"==typeof i)i=JSON.parse(i),this.CommonGpAddReward2(a,i,n);else if(Array.isArray(i))i.forEach(function(t){var e=customui.BaseItemFactory.create();e.scaleX=e.scaleY=n;var i=new eui.Group;i.addChild(e),i.width=i.height=105*n,Array.isArray(t)?e.updateData({reward:t}):e.updateData(t),t[3]&&o?UIActionManager.addEffect(i,"common_jiban",{scaleX:n/.7,scaleY:n/.7}):UIActionManager.hideEffect(i),a.addChild(i)});else{function t(e){var t=i[e];Array.isArray(t)&&t.forEach(function(t){switch(e){case"rewards":r.push(t);break;case"heros":r.push({uuid:t.uuid,type:EEntityType.EEntityTypeHero});break;case"vestageHeros":r.push({uuid:t.uuid,type:EEntityType.EEntityTypeVestageHero});break;case"heroEquips":r.push({code:t.code,type:EEntityType.EEntityTypeHeroEquip,num:t.num});break;case"heroArtifacts":r.push({code:t.code,type:EEntityType.EEntityTypeHeroArtifact,num:t.num});break;case"maps":r.push({uuid:t.uuid,type:EEntityType.EEntityTypeMap})}})}var r=[];for(var e in i)t(e);this.CommonGpAddReward2(a,r,n)}},J.N="ActivityMediator",J.SV={MAIN:1,FISHINGSHOP:2,FISHINGCHALLGE:3,MAGPIE_GIFT:4,MAGPIE_GIFT_ALL:5,MID_AUTUMN_IDEL_REWARD:6,SF_QUORA:8,REAL_SF_247:9,AllGift311:10,PUSH_BAG_COLLECTION:11},J);function J(t){void 0===t&&(t=null);var e=i.call(this,J.N,t)||this;return e.activityProxy=j.AppFacade.getInstance().retrieveProxy(j.ActivityPy.N),e._viewIdCache={},e.ActivityTriggerList=[],e}j.ActivityMediator=t}(game=game||{}),function(N){var t=(e.registerAll=function(){(new a).register(),(new d).register(),(new U).register(),(new r).register(),(new E).register(),(new T).register(),(new w).register(),(new x).register(),(new B).register(),(new G).register(),(new W).register(),(new f).register(),(new m).register(),(new p).register(),(new J).register(),(new X).register(),(new Q).register(),(new et).register(),(new nt).register(),(new ht).register(),(new st).register(),(new ut).register()},e);function e(){}N.ActivityProcessor=t;var i,a=(i=N.ProcessorBase,__extends(n,i),n.prototype.execute=function(t){var e=t.getBody();console.log("FlashCapsuleInfoP",e),N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).allActivityData[EActivityType.FlashCapsuleHigh].updateData(e.info)},n);function n(){return i.call(this,"activity.FlashCapsuleInfoP",n)||this}var o,r=(o=N.ProcessorBase,__extends(s,o),s.prototype.execute=function(t){var e=t.getBody();console.log("SecondOpenServerRechargeInfoP",e);var i=EActivityType.SecondOpenServerRecharge;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).allActivityData[i].updateData(e.info),e.clientReward&&N.AppFacade.getInstance().retrieveProxy(N.BackpackPy.N).handleClientReward(e.clientReward,2)},s);function s(){return o.call(this,"activity.SecondOpenServerRechargeInfoP",s)||this}var c,d=(c=N.ProcessorBase,__extends(h,c),h.prototype.execute=function(t){var e=t.getBody();console.log("ActivityBaseInfoP",e);var i=e.code;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e),i!=EActivityType.OneYuanGifts&&i!=EActivityType.SixtyEightYuanGifts&&i!=EActivityType.OneYuanGifts2||N.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)},h);function h(){return c.call(this,"activity.ActivityBaseInfoP",h)||this}var l,p=(l=N.ProcessorBase,__extends(u,l),u.prototype.execute=function(t){var e=t.getBody();console.log("CommonActivityInfoP",e);var i=e.code,a=N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N),n=N.AppFacade.getInstance().retrieveProxy(N.PlayerPy.N),o=!1;if(i!=EActivityType.ZoneAuction){if(i==EActivityType.ZoneFishing){E=N.AppFacade.getInstance().retrieveMediator(N.ActivityMediator.N);var r=a.allActivityData[EActivityType.ZoneFishing].data.playerInfo.creel,s=JSON.parse(e.info).playerInfo.creel,c=0;if(r&&s)if(0<r.length)if(r.length==s.length){for(var d in s)if(r[d][0]==s[d][0]&&r[d][1]!=s[d][1]){c=s[d][0];break}}else for(d=0;d<s.length;d++)r[d]?r[d][0]!=s[d][0]&&(c=s[d][0]):c=s[d][0];else c=s[0][0];return E.updateViewByCode(EActivityType.ZoneFishing,{newFish:c}),a.updateData_View_Reward(i,e),void NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.ZoneFishing])}if(i==EActivityType.LimitNumGift1){var h=JSON.parse(e.info),l=N.GameMVC.activityPy.allActivityData[EActivityType.LimitNumGift1].data;if(l){for(var p in l.itemList){var u=l.itemList[p];for(var g in h.itemList){var m=h.itemList[g];m.times||u.code!=m.code||(h.itemList[g].times=u.times)}}e.info=JSON.stringify(h)}}if(i==EActivityType.HeroPushGiftBag){var y=JSON.parse(e.info).gifts;0!=y.length&&null!=y.entityCode||(C=N.GameMVC.activityMed.getViewByCode(EActivityType.HeroPushGiftBag))&&C.hide()}else if(i==EActivityType.NewPushGiftBag){var v=a.allActivityData[EActivityType.NewPushGiftBag],f=JSON.parse(e.info);if(v&&v.data&&v.data.gifts)for(var d in v.data.gifts){var _=!0;for(var A in f.gifts)d==A&&(_=!1);_&&(this.log("推送礼包 delete "+d),this.sendNotification(CN.ACTIVITY_PUSH_GIFT_CLOSE,{uuid:d}))}var T=new Array;if(f&&f.gifts)for(var d in f.gifts){var b=!0;for(var A in v.data.gifts)if(d==A){b=!1;break}b&&(this.log("推送礼包 add "+d),T.push(d))}return a.allActivityData[i]&&(a.allActivityData[i].data=f),0<T.length&&(N.GameMVC.activityPy.addPustGiftList(T),N.AppFacade.getInstance().retrieveProxy(N.FightPy.N).addDelayCBAfterFightExit(function(t){N.AppFacade.getInstance().sendNotification(CN.ACTIVITY_PUSH_GIFT_OPEN),N.GameMVC.fightPy.queueExceExitCB()},"PushGift",5)),this.sendNotification(CN.ACTIVITY_PUSH_GIFT_COLLECTION_UPDATE),void N.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}var C;a.updateData_View_Reward(i,e),0<=[EActivityType.OneYuanGifts,EActivityType.NewYearWeekCrad,EActivityType.OneYuanGifts2,EActivityType.SecondDailyGifts,EActivityType.NewPushGiftBag,EActivityType.Commemoration].indexOf(i)&&N.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),i==EActivityType.NewYearWeekCrad&&(E=N.AppFacade.getInstance().retrieveMediator(N.ActivityMediator.N)).hideViewByCode(EActivityType.NewYearWeekCrad),i==EActivityType.BasicHeroGifts&&(N.AppFacade.getInstance().sendNotification(CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE,e),N.GameMVC.mainMed.updateBtn()),i!=EActivityType.LimitNumGift1||(C=N.GameMVC.activityMed.getViewByCode(EActivityType.DoubleTwelve))&&C.limitPanel&&C.limitPanel.updateView()}else{var E,I=a.allActivityData[EActivityType.ZoneAuction],S=JSON.parse(e.info).info;if(I&&S){var w=I.data.items;for(var M in S.items)for(var R=S.items[M],U=R.buyerInfo,d=0;d<w.length;d++){var k=w[d];k.confId==R.confId&&(k.buyerInfo.playerId!=n.playerInfoVO.playerId||U.playerId==n.playerInfoVO.playerId||o||(o=!0,Utils.MsgUtils.addMidMsg("商品价格已刷新，请重新竞拍")),w[d]=R)}}N.AppFacade.getInstance().retrieveProxy(N.BackpackPy.N).handleClientReward(e.clientReward),I&&I.data&&S&&S.record&&(I.data.record=S.record),(E=N.AppFacade.getInstance().retrieveMediator(N.ActivityMediator.N)).updateViewByCode(EActivityType.ZoneAuction1),e.type==ZoneAuctionInfoPType.Refresh&&N.AppFacade.getInstance().retrieveMediator(N.MainMediator.N).updateBtn(),e.type==ZoneAuctionInfoPType.Account&&(N.AppFacade.getInstance().retrieveMediator(N.MainMediator.N).updateBtn(),a.GetActivityInfo(EActivityType.ZoneAuction))}},u);function u(){return l.call(this,"activity.CommonActivityInfoP",u)||this}var g,m=(g=N.ProcessorBase,__extends(y,g),y.prototype.execute=function(t){var e=t.getBody();console.log("FirstRechargeInfoP",e);var i=EActivityType.FirstRecharge1;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e)},y);function y(){return g.call(this,"activity.FirstRechargeInfoP",y)||this}var v,f=(v=N.ProcessorBase,__extends(_,v),_.prototype.execute=function(t){var e=t.getBody();console.log("PurchaseWholeLifeCardP",e);var i=EActivityType.WholeLifeCard;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e),N.AppFacade.getInstance().retrieveMediator(N.ActivityMediator.N).updateViewByCode(EActivityType.MonthCard)},_);function _(){return v.call(this,"activity.PurchaseWholeLifeCardP",_)||this}var A,T=(A=N.ProcessorBase,__extends(b,A),b.prototype.execute=function(t){var e=t.getBody();console.log("PurchaseDiscountGiftBagP",e);var i=EActivityType.DiscountGiftBag;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e)},b);function b(){return A.call(this,"activity.PurchaseDiscountGiftBagP",b)||this}var C,E=(C=N.ProcessorBase,__extends(I,C),I.prototype.execute=function(t){var e=t.getBody();console.log("MonthCardRewardP",e);var i=EActivityType.MonthCard;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e)},I);function I(){return C.call(this,"activity.MonthCardRewardP",I)||this}var S,w=(S=N.ProcessorBase,__extends(M,S),M.prototype.execute=function(t){var e=t.getBody();console.log("EnjoyCardRewardP",e);var i=e.code;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e),i==EActivityType.BeachCard&&N.GameMVC.activityMed.updateViewByCode(EActivityType.Beach)},M);function M(){return S.call(this,"activity.EnjoyCardRewardP",M)||this}var R,U=(R=N.ProcessorBase,__extends(k,R),k.prototype.execute=function(t){var e=t.getBody();console.log("CollectHeroInfoP",e);var i=EActivityType.CollectHero;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).allActivityData[i].updateData(e.info)},k);function k(){return R.call(this,"activity.CollectHeroInfoP",k)||this}var P,x=(P=N.ProcessorBase,__extends(L,P),L.prototype.execute=function(t){var e=t.getBody();console.log("TriggerGiftNewP",e);var i=N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N),a=EActivityType.TriggerGifts,n=i.allActivityData[a],o={};n&&JSON.parse(n.data.gifts).forEach(function(t){o[t.uuid]=1}),i.updateData_View_Reward(a,e);var r=i.allActivityData[a];r&&JSON.parse(r.data.gifts).forEach(function(t){o[t.uuid]||N.AppFacade.getInstance().sendNotification(CN.ACTIVITY_ADD_TRIGGER,t)})},L);function L(){return P.call(this,"activity.TriggerGiftNewP",L)||this}var D,B=(D=N.ProcessorBase,__extends(V,D),V.prototype.execute=function(t){var e=t.getBody();console.log("TriggerGiftRewardP",e);var i=EActivityType.TriggerGifts;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e)},V);function V(){return D.call(this,"activity.TriggerGiftRewardP",V)||this}var O,G=(O=N.ProcessorBase,__extends(F,O),F.prototype.execute=function(t){var e=t.getBody();console.log("BraveBookBuyP",e);var i=EActivityType.BraveBook;N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateData_View_Reward(i,e),N.AppFacade.getInstance().updateView(N.BraveBookMediator.N,N.BraveBookMediator.SV.MAIN)},F);function F(){return O.call(this,"activity.BraveBookBuyP",F)||this}var H,W=(H=N.ProcessorBase,__extends(Y,H),Y.prototype.execute=function(t){var e=t.getBody();console.log("BraveBookLevelBuyP",e),EActivityType.BraveBook,N.AppFacade.getInstance().sendNotification(CN.ACTIVITY_BRAVEBOOKSHOP)},Y);function Y(){return H.call(this,"activity.BraveBookLevelBuyP",Y)||this}var j,J=(j=N.ProcessorBase,__extends(z,j),z.prototype.execute=function(t){var e=t.getBody();if(console.log("WeChatShareInfoP",e),Utils.SDKMgr.getPerformConfig(16)){var i=e.type;N.AppFacade.getInstance().sendNotification(CN.ADD_WECHAT_SHARE_INFO,{type:e.type});var a=SHARE_RESOURCE_FILTER[i];if(!a||!0!==a.skip){var n=N.AppFacade.getInstance().retrieveMediator(N.ActivityMediator.N);n.shareInfo=void 0;var o=N.AppFacade.getInstance().retrieveProxy(N.FightPy.N);o.addDelayCBAfterFightExit(function(){n.showViewByCode(EActivityType.WeChatShare,{type:i}),o.queueExceExitCB()},"WeChatShareInfoP")}}},z);function z(){return j.call(this,"activity.WeChatShareInfoP",z)||this}var q,X=(q=N.ProcessorBase,__extends(K,q),K.prototype.execute=function(t){var e=t.getBody();console.log("RelationInfoP",e),N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateRelationTotalInfo(e)},K);function K(){return q.call(this,"relation.RelationInfoP",K)||this}var Z,Q=(Z=N.ProcessorBase,__extends($,Z),$.prototype.execute=function(t){var e=t.getBody();console.log("SyncDownRelationDataP",e),N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateRelationTotalInfo({info:e},!0)},$);function $(){return Z.call(this,"relation.SyncDownRelationDataP",$)||this}var tt,et=(tt=N.ProcessorBase,__extends(it,tt),it.prototype.execute=function(t){var e=t.getBody();console.log("NewDownRelationP",e),N.AppFacade.getInstance().retrieveProxy(N.ActivityPy.N).updateRelationTotalInfo({info:e},!0)},it);function it(){return tt.call(this,"relation.NewDownRelationP",it)||this}var at,nt=(at=N.ProcessorBase,__extends(ot,at),ot.prototype.execute=function(t){var e,i=t.getBody();console.log("ZoneQuoraRoundQuoraEndP",i),N.Activity186.firstName=i.firstAnswerInfo,(e=N.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora))&&e.updateView(),(e=N.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora1))&&e.updateView()},ot);function ot(){return at.call(this,"activity.ZoneQuoraRoundQuoraEndP",ot)||this}var rt,st=(rt=N.ProcessorBase,__extends(ct,rt),ct.prototype.execute=function(t){var e=t.getBody();console.log("NewOperationExecP",e),N.GameMVC.backpackPy.handleClientReward(e.clientReward)},ct);function ct(){return rt.call(this,"operation.NewOperationExecP",ct)||this}var dt,ht=(dt=N.ProcessorBase,__extends(lt,dt),lt.prototype.execute=function(t){var e=t.getBody();console.log("NewZoneGroupPurchaseP",e);var i=JSON.parse(e.info),a=N.GameMVC.activityPy.allActivityData[EActivityType.NewZoneGroupPurchase];if(a&&a.data){for(var n in i.itemList){var o=i.itemList[n];for(var r in a.data.itemList){var s=a.data.itemList[r];o.code!=s.code||o.times||(i.itemList[n].times=s.times)}}N.GameMVC.activityPy.updateData_View_Reward(EActivityType.NewZoneGroupPurchase,{info:i})}},lt);function lt(){return dt.call(this,"activity.NewZoneGroupPurchaseP",lt)||this}var pt,ut=(pt=N.ProcessorBase,__extends(gt,pt),gt.prototype.execute=function(t){var e=t.getBody();console.log("ActivityListP",e),N.GameMVC.activityPy.updateActivityList(e.activityList),N.GameMVC.activityPy.GetAllActivityInfo(e.activityList)},gt);function gt(){return pt.call(this,"activity.ActivityListP",gt)||this}}(game=game||{}),function(b){var e,t=(e=BaseProxy,__extends(n,e),n.prototype.addNotice=function(){function t(t){var e=b.ActivityConfig.Config[t];e&&e.checkNotice&&NoticeManager.registerCB(NT.ALL_ACTIVITY[t],function(){return e.checkNotice(i.allActivityData[t],t)},a,MODULE.Activity+parseInt(t))}var i=this,a=this;for(var e in b.ActivityConfig.Config)t(e);NoticeManager.setChildType(NT.ACTIVITY_EnjoyCard1,NT.ALL_ACTIVITY[EActivityType.EnjoyCard1]),Utils.SDKMgr.getPerformConfig(10018)||(NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.COMMON_SHOP[ShopType.ShopTypeShare]),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.FRIEND_SHARE_REWARD),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.FRIEND_SHARE_DAY_FIRST_SHARE)),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[0],function(){return i.checkFriendShareRewardNotice(0)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[1],function(){return i.checkFriendShareRewardNotice(1)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[2],function(){return i.checkFriendShareRewardNotice(2)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[3],function(){return i.checkFriendShareRewardNotice(3)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[4],function(){return i.checkFriendShareRewardNotice(4)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[5],function(){return i.checkFriendShareRewardNotice(5)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_DAY_FIRST_SHARE,function(){return!Utils.LocalStorageUtil.getTodayVaild("FriendShare")},this),NoticeManager.registerCB(NT.ACTIVITY_MID_CREAT,function(){return i.cheakCreatNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_EAT,function(){return i.cheakEatNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_GET,function(){return i.cheakGetNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_GIFT,function(){return i.cheakGiftNotice()},this),NoticeManager.setChildType(NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.entrance],[NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.event],NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.keng],NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.shoot],NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.soup],NT.ALL_ACTIVITY[b.Activity235.groupActivityCode.task]]),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.MagpieActivity],[NT.ACTIVITY_MAGPIE_TASK,NT.ACTIVITY_MAGPIE_TIME]),NoticeManager.setChildType(NT.ACTIVITY_MAGPIE_ENTRANCE,[NT.ALL_ACTIVITY[EActivityType.MagpieActivity],NT.ALL_ACTIVITY[EActivityType.LiuYiTask],NT.ALL_ACTIVITY[EActivityType.LiuYiConsumeTask],NT.ALL_ACTIVITY[EActivityType.LiuYiCard],NT.ALL_ACTIVITY[EActivityType.LiuYiQuora]]),NoticeManager.registerCB(NT.ACTIVITY_MAGPIE_TASK,function(){return i.checkMagpieNotice(1)},this),NoticeManager.registerCB(NT.ACTIVITY_MAGPIE_TIME,function(){return i.checkMagpieNotice(2)},this),NoticeManager.registerCB(NT.DOUBLE12_EXP_REWARD,function(){return i.checkExpRewardNotice()},this),NoticeManager.registerCB(NT.DOUBLE12_CONSUME_REWARD,function(){return i.checkConsumeRebateRewardNotice()},this),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.DoubleTwelve],[NT.DOUBLE12_EXP_REWARD,NT.DOUBLE12_CONSUME_REWARD,NT.ALL_ACTIVITY[EActivityType.DoubleElevenCostTimes1],NT.ALL_ACTIVITY[EActivityType.ThirdLevelReward1]]),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.Regression],[NT.ACTIVITY_REGRESS_LOGIN,NT.ACTIVITY_REGRESS_RECHARGE]),NoticeManager.registerCB(NT.ACTIVITY_REGRESS_LOGIN,function(){return i.activity295NoticeLogin()},this),NoticeManager.registerCB(NT.ACTIVITY_REGRESS_RECHARGE,function(){return i.activity295NoticeRecharge()},this),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.Beach],[NT.ALL_ACTIVITY[EActivityType.BeachDiaoBao],NT.ALL_ACTIVITY[EActivityType.BeachWishTrees],NT.ALL_ACTIVITY[EActivityType.BeachItemGift],NT.ALL_ACTIVITY[EActivityType.BeachTask],NT.ALL_ACTIVITY[EActivityType.BeachCard],NT.ALL_ACTIVITY[EActivityType.BirthDayCard],NT.ALL_ACTIVITY[EActivityType.DivideDiamond],NT.ALL_ACTIVITY[EActivityType.Commemoration],NT.ALL_ACTIVITY[EActivityType.BeachReach]])},n.prototype.GetActivityList=function(e){var i=this;if(this.allActivityData={},Utils.Socket.send("activity","GetActivityList",{}).then(function(t){i.log("拉活动列表 GetActivityListR",t),i.firstFetch={},i.updateActivityList(t.activityList),i.GetAllActivityInfo(),b.AppFacade.getInstance().sendNotification(CN.ACTIVITY_LIST_UPDATED),e&&e()}),this.isFirst){this.isFirst=!1;var t=b.Config.activityConfigs();for(var a in t){var n=t[a];NoticeManager.setChildType(NT.ACTIVITY_ENTRANCE[n.entrance],NT.ALL_ACTIVITY[n.id])}}b.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE),b.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE)},n.prototype.updateData_View_Reward=function(t,e,i){var a=b.AppFacade.getInstance().retrieveProxy(n.N);a.allActivityData[t]&&a.allActivityData[t].updateData(e.info),e.clientReward?b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:i}):i&&i()},n.prototype.getActivityShowPanelCodes=function(t){return[]},n.prototype.GetCommonReward=function(e,t,i){var a=this;Utils.Socket.send("activity","GetCommonReward",{code:e,id:t}).then(function(t){a.updateData_View_Reward(e,t),i&&i()})},n.prototype.DoCommonOperation=function(e,t,i,a,n,o){var r=this;Utils.Socket.send("activity","DoCommonOperation",{code:e,num:t,id:i,info:o}).then(function(t){e==EActivityType.MagpieActivity&&n?n!=MagpieEventType.FingerGame&&n!=MagpieEventType.Talk&&n!=MagpieEventType.Sieve&&n!=MagpieEventType.Slots||a&&a(t,r.updateData_View_Reward.bind(r)):e==b.Activity235.groupActivityCode.soup||e==EActivityType.MakeMoonCake?a&&a(t):e==b.Activity235.groupActivityCode.shoot?(GameRootLayer.gameLayer().switchTouchEnable(!0),r.updateData_View_Reward(e,t,function(){a&&a(t)})):(e==EActivityType.ValentineHeroGift||e==EActivityType.NewHuntTreasure||r.updateData_View_Reward(e,t),a&&a(t))})},n.prototype.NewZoneOperation=function(e,t,i,a,n,o){var r=this;Utils.Socket.send("activity","NewZoneOperation",{code:e,num:t,id:i,info:o}).then(function(t){r.updateData_View_Reward(e,t),a&&a(t)})},n.prototype.updateActivityList=function(t,e){void 0===e&&(e=!1);var i=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);for(var a in this.allActivityData&&!e||(this.allActivityData={}),t){var n=t[a];if(!i||!Array.isArray(Utils.SDKMgr.getPerformConfig(51))||-1==Utils.SDKMgr.getPerformConfig(51).indexOf(Number(n.code))){var o=new b.ActivityVO;o.update(n),this.allActivityData[n.code]=o}}},n.prototype.onFirstFetch=function(t){switch(this.allActivityData[t],t){case EActivityType.ZoneFishing:}},n.prototype.getToday=function(t){var e=this.allActivityData[t];if(!e||!e.data)return 0;var i=Utils.TimerManager.getServerTime(),a=e.startDt;return Math.ceil((i-a)/24/3600)},n.prototype.GetActivityInfo=function(c,d){var h=this,l=b.ActivityConfig.Config[c],p=l&&l.protoName||"",t=l&&l.params||{code:c};this.isOpen(c)&&""!=p&&Utils.Socket.send("activity",p,t).then(function(t){h.log(c,l.name,p,t);var e=h.allActivityData[c];if(e.updateData(t.info),h.firstFetch[c]||(h.firstFetch[c]=!0,h.onFirstFetch(c)),c==EActivityType.BraveBook&&NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),c==EActivityType.NewBraveBook&&NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),c==b.Activity235.groupActivityCode.soup&&(h.addLanterCreateNoticeListen(),NoticeManager.updateNotice(NT.ACTIVITY_MID_CREAT)),c!=EActivityType.NewBraveBook&&c!=EActivityType.BraveBook&&c!=EActivityType.FirstRecharge1&&c!=EActivityType.DailyLogin&&c!=EActivityType.DailyLuxuryGifts5&&c!=EActivityType.OneYuanGifts&&c!=EActivityType.SixtyEightYuanGifts&&c!=EActivityType.OneYuanGifts2||b.AppFacade.getInstance().sendNotification(CN.ACTIVITY_LIST_UPDATED),c==EActivityType.WholeLifeCard&&b.AppFacade.getInstance().retrieveProxy(b.GuajiPy.N).updateNotice(),d&&d(),c==EActivityType.ClientTask){var i=window.launchParams;if(i){var a=i.query||{},n=i.shareTicket||"",o=a.activity290TaskType,r=a.fromPlayerId;o&&n&&r==b.GameMVC.playerPy.playerInfoVO.playerId&&Utils.SDKMgr.cmd({type:"getShareAward",shareTicket:n,thisObj:h},function(t){t&&h.DoCommonOperation(EActivityType.ClientTask,1,1,function(){console.log("290加进度成功",o)},0,JSON.stringify([[o,1]]))})}}if(c==EActivityType.Regression&&e.data.inActivity&&"1"!=Utils.LocalStorageUtil.getItem("activity295")&&b.GameMVC.activityMed.showViewByCode(EActivityType.Regression),c==EActivityType.PlayerBoss&&b.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE),0<=h.needWatchNotice.indexOf(c)&&h.addCollectActivityNoticeWatch(c),c==EActivityType.MazeExplore){var s=h.allActivityData[c];NoticeManager.addCareCost(s.content[4],function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MazeExplore])})}})},n.prototype.GetAllActivityInfo=function(t){var e=this;if(t)for(var i in t){var a=t[i].code;a&&this.GetActivityInfo(Number(a))}else var n=Object.keys(this.allActivityData),o=egret.setInterval(function(){n[0]?(e.GetActivityInfo(Number(n[0])),n.shift()):egret.clearInterval(o)},this,100)},n.prototype.isOpen=function(t){return!!this.allActivityData[t]},n.prototype.ChallengeExtremeChallenge=function(){var a=this,t=this.allActivityData[EActivityType.ExtremeBattle];if(t&&t.data){JSON.parse(t.content);var n=t.data.id;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeExtremeBattle,customParams:{fightBg:"fight_scene_xstz",tips:['<b><font color="#ffffff" size="22">恭喜您挑战 </font><font color="#00fff0" size="22">第'+n+'关</font><font color="#ffffff" size="22"> 成功</font></b>','<b><font color="#ffffff" size="22">很遗憾,您挑战 </font><font color="#00fff0" size="22">第'+n+'关</font><font color="#ffffff" size="22"> 失败</font></b>']},pb1:"activity",pb2:"ChallengeExtremeBattle",params:{},doneCB:function(t){Utils.LocalStorageUtil.setItem(b.ActivityExtremeChallengeView.EXTREMECHALLENGESKIP_PREFIX+n,"true");var e=t.cbRet,i=a.allActivityData[EActivityType.ExtremeBattle];i&&i.updateData(e.info),i.data.passed||b.AppFacade.getInstance().retrieveMediator(b.ActivityMediator.N).showViewByCode(EActivityType.ExtremeBattle),b.AppFacade.getInstance().retrieveProxy(b.FightPy.N).queueExceExitCB(),b.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}})}else Utils.MsgUtils.addMidMsg("活动数据错误")},n.prototype.WeChatShare=function(e){var i=this;Utils.SDKMgr.share(e,function(t){0==t&&(e.customCB?(e.customCB(),b.AppFacade.getInstance().retrieveMediator(b.ActivityMediator.N).hideViewByCode(EActivityType.WeChatShare)):Utils.Socket.send("activity","WeChatShare",{id:e.id}).then(function(t){console.log("微信分享 WeChatShareR",t),i.allActivityData[EActivityType.WeChatShare].updateData(t.info),t&&t.clientReward&&b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward),b.AppFacade.getInstance().retrieveMediator(b.ActivityMediator.N).hideViewByCode(EActivityType.WeChatShare),Utils.MsgUtils.addMidMsg("分享成功"),e.doneCB&&e.doneCB()}).catch(function(t){}))})},n.prototype.isSameGamePlatform=function(t){return""==t||null==t||t==this.gamePlatform},n.prototype.updateRelationTotalInfo=function(t,e,i){var a=this;if(void 0===e&&(e=!1),void 0===i&&(i=!0),t){var n=t.info;if(this.gamePlatform=t.gamePlatform,n.downRelationInfo&&n.relationType==RelationType.Recommend){if(Array.isArray(n.downRelationInfo))this.downRelationInfos.splice(0),n.downRelationInfo.forEach(function(t){a.downRelationInfos.push(new b.RelationInfoVO(t))});else if(e){var o=!1;for(var r in this.downRelationInfos)(s=this.downRelationInfos[r]).playerId==n.downRelationInfo.playerId&&(s.update(n.downRelationInfo),o=!0);o||this.downRelationInfos.push(new b.RelationInfoVO(n.downRelationInfo))}this.downRelationInfos.sort(function(t,e){return t.dt!=e.dt?t.dt-e.dt:t.playerId-e.playerId})}if(n.downRelationInfo&&n.relationType==RelationType.Share){if(Array.isArray(n.downRelationInfo))this.downRelationInfosAny.splice(0),n.downRelationInfo.forEach(function(t){a.downRelationInfosAny.push(new b.RelationInfoVO(t))});else if(e){for(var r in o=!1,this.downRelationInfosAny)(s=this.downRelationInfosAny[r]).playerId==n.downRelationInfo.playerId&&(s.update(n.downRelationInfo),o=!0);o||this.downRelationInfosAny.push(new b.RelationInfoVO(n.downRelationInfo))}this.downRelationInfosAny.sort(function(t,e){return t.dt!=e.dt?t.dt-e.dt:t.playerId-e.playerId})}if(n.upRelationInfo&&n.relationType==RelationType.Share){if(Array.isArray(n.upRelationInfo))this.upRelationInfos.splice(0),n.upRelationInfo.forEach(function(t){a.upRelationInfos.push(new b.RelationInfoVO(t))});else if(e){for(var r in o=!1,this.upRelationInfos){var s;(s=this.upRelationInfos[r]).playerId==n.downRelationInfo.playerId&&(s.update(n.downRelationInfo),o=!0)}o||this.upRelationInfos.push(new b.RelationInfoVO(n.downRelationInfo))}this.upRelationInfos.sort(function(t,e){return t.dt!=e.dt?t.dt-e.dt:t.playerId-e.playerId})}n.redBagInfo&&n.relationType==RelationType.Recommend&&(this.relationRedBagInfos.splice(0),Array.isArray(n.redBagInfo)&&n.redBagInfo.forEach(function(t){a.relationRedBagInfos.push(new b.RelationRedBagInfoVO(t))})),n.targeted&&n.relationType==RelationType.Recommend&&(this.releationTargeted.splice(0),Array.isArray(n.targeted)&&n.targeted.forEach(function(t){a.releationTargeted.push(t)})),n.targeted&&n.relationType==RelationType.Share&&(this.releationTargetedNew.splice(0),Array.isArray(n.targeted)&&n.targeted.forEach(function(t){a.releationTargetedNew.push(t)})),i&&b.AppFacade.getInstance().retrieveMediator(b.ActivityMediator.N).updateViewByCode(EActivityType.FriendShare),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare])}},n.prototype.GetRelationInfo=function(t,e){var i=this;Utils.Socket.send("relation","GetRelationInfo",{relationType:t}).then(function(t){i.updateRelationTotalInfo(t),e&&e()})},n.prototype.GetShareRelationRewards=function(t,e){var i=this;Utils.Socket.send("relation","GetShareRelationRewards",{relationType:t.relationType,tPlayerId:t.tPlayerId}).then(function(t){i.updateRelationTotalInfo(t),t.clientReward?(b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward,{}),e&&e(t.clientReward),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare])):e&&e()})},n.prototype.GetRelationRedBag=function(t,e,i){var a=this;Utils.Socket.send("relation","GetRelationRedBag",{relationType:t,uuid:e}).then(function(t){a.updateRelationTotalInfo(t),t.clientReward?(b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward,{closeCB:i}),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare])):i&&i()})},n.prototype.GetRelationReward=function(i,t,a){var n=this;Utils.Socket.send("relation","GetRelationReward",{relationType:i,id:t}).then(function(t){if(t.clientReward&&b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward,2),t.targeted)for(var e in t.targeted)i==RelationType.Recommend?n.releationTargeted.push(t.targeted[e]):i==RelationType.Share&&n.releationTargetedNew.push(t.targeted[e]);NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare]),a&&a()})},n.prototype.checkRedBag=function(){0<this.upRelationInfos.length&&(this.upRelationInfos[0].isShareGotten||PopUpManager.addPopUpQueue({obj:new b.ActivityFriendRedBagPanel}))},n.prototype.checkFriendShareRewardNotice=function(t){var e=0,i=b.Config.relationRewardConfigs(),a=this.downRelationInfosAny,n=this.releationTargeted,o=a.length;switch(t){case 0:for(var r in n=this.releationTargetedNew,i)if((_=i[r]).relationType==RelationType.Share){var s=_.id,c=_.count,d=(_.reward,REWARD_STATUS.UNAVAILABLE);if(c<=o&&(d=REWARD_STATUS.AVAILABLE),0<=n.indexOf(s)&&(d=REWARD_STATUS.RECEIVED),d==REWARD_STATUS.AVAILABLE)return!0}break;case 1:a=this.downRelationInfos;var h=[];for(var l in a)new Date(1e3*Utils.TimerManager.getServerTime()).toDateString()===new Date(1e3*a[l].dt).toDateString()&&h.push(a[l]);for(var p in o=h.length,i)if((_=i[p]).relationType==RelationType.Recommend&&0==_.requireType){s=_.id,c=_.count,_.reward;var u=REWARD_STATUS.UNAVAILABLE;if(c<=o&&(u=REWARD_STATUS.AVAILABLE),0<=n.indexOf(s)&&(u=REWARD_STATUS.RECEIVED),u==REWARD_STATUS.AVAILABLE)return!0}break;case 2:for(var g in this.upRelationInfos)if(!(_=this.upRelationInfos[g]).isShareGotten)return!0;break;case 3:for(var m in this.downRelationInfos)30<=(_=this.downRelationInfos[m]).level&&e++;if(0<e)for(var y in i)if((_=i[y]).count<=e&&30==_.level&&-1==this.releationTargeted.indexOf(_.id))return!0;break;case 4:for(var v in this.downRelationInfos)60<=(_=this.downRelationInfos[v]).level&&e++;if(0<e)for(var f in i){var _;if((_=i[f]).count<=e&&60==_.level&&-1==this.releationTargeted.indexOf(_.id))return!0}break;case 5:if(this.relationRedBagInfos&&0<this.relationRedBagInfos.length)return!0}return!1},n.prototype.checkFriendShareRewardNotice01=function(t){var e=this.allActivityData[EActivityType.FriendShare];if(e&&e.data){var i=JSON.parse(e.content),a=e.data.keyList,n=e.data.targeted;function o(t){for(var e in a){var i=a[e];if(i.taskType==t)return r[t]=i.key,i.key}}0==t&&(a=e.data.todayKeyList,n=e.data.todayTargeted);var r={};for(var s in i){var c=i[s],d=c[4];if(d==TaskResetType.Daily&&0==t||d==TaskResetType.None&&1==t){var h=c[0],l=c[1],p=(c[2],c[3]),u=REWARD_STATUS.UNAVAILABLE;switch(l<=(r[p]||o(p)||0)&&(u=REWARD_STATUS.AVAILABLE),0<=n.indexOf(h)&&(u=REWARD_STATUS.RECEIVED),u){case REWARD_STATUS.UNAVAILABLE:break;case REWARD_STATUS.AVAILABLE:return!0;case REWARD_STATUS.RECEIVED:}}}return!1}},n.prototype.operationHasExec=function(e){var i=this;return null==this._operationHasExec[e]?(Utils.Socket.send("operation","HasExec",{operationId:e}).then(function(t){i._operationHasExec[e]=t.ret,i.sendNotification(CN.MAIN_UPDATE_BTN)}),!0):this._operationHasExec[e]},n.prototype.getOperationReward=function(e,i){Utils.Http.toGet({action:"get_reward",playerId:b.GameMVC.playerPy.roleVo.playerId,area:b.GameMVC.loginPy.serverSelect.s_id,rewardId:e}).then(function(t){b.GameMVC.activityPy._operationHasExec[e]=1,b.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),i&&i(t)})},n.prototype.checkAllSDKReward=function(){Utils.SDKMgr.getPerformConfig(15)&&getUrlKV().Act_ShouCangYouLi&&(b.AppFacade.getInstance().retrieveProxy(b.ActivityPy.N),b.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi)),getUrlKV().Act_GuanZhuGongZhongHao&&(b.AppFacade.getInstance().retrieveProxy(b.ActivityPy.N),b.GameMVC.activityPy.getOperationReward(OperationType.Act_GuanZhuGongZhongHao)),getUrlKV().Act_ShiMingRenZheng&&(b.AppFacade.getInstance().retrieveProxy(b.ActivityPy.N),b.GameMVC.activityPy.getOperationReward(OperationType.Act_ShiMingRenZheng))},n.prototype.hasWholeLifeCard=function(){return this.allActivityData[EActivityType.WholeLifeCard]&&this.allActivityData[EActivityType.WholeLifeCard].data&&this.allActivityData[EActivityType.WholeLifeCard].data.hasPurchased},n.prototype.getFetchedList=function(e){var i=this;Utils.Socket.send("gift","GetFetchedList",{}).then(function(t){i.giftList=t.idList,e&&e.cb&&e.cb(t)})},n.prototype.getGiftRewardFormServer=function(e){var i=this;Utils.Socket.send("gift","GetGiftReward",{id:Number(e.giftId)}).then(function(t){0==t.err&&b.GameMVC.backpackPy.handleClientReward(t.clientReward),i.getFetchedList(e),e&&e.cb&&e.cb()}).catch(function(t){})},n.prototype.getGiftReward=function(i){var a=this;if(Utils.agentConfig.other.isJhb){function t(e){Utils.Socket.send("gift","GetGiftReward",{id:Number(i.giftId)}).then(function(t){0==t.err&&b.GameMVC.backpackPy.handleClientReward(t.clientReward),n&&0==n.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new b.GiftBagsView({giftId:i.giftId,isGet:e.isGet,ret:e.ret})}),a.getFetchedList(i)}).catch(function(t){n&&0==n.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new b.GiftBagsView({giftId:i.giftId,isGet:e.isGet,ret:e.ret})})})}var e=Number(i.giftId),n=b.Config.giftConfig()[e],o=-1!=this.giftList.indexOf(e);if(n)if(0!=n.vipRange){var r=getUrlKV().giftRet;o||0!=r.ret?i&&i.cb?i&&i.cb():0==n.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new b.GiftBagsView({giftId:e,isGet:o,ret:r})}):t({isGet:o,ret:r})}else o?0==n.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new b.GiftBagsView({giftId:e,isGet:o})}):t({isGet:o})}},n.prototype.getQQFriendsInfo=function(e){var i=this;Utils.Http.toGet({action:"get_appFri",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf}).then(function(t){0==t.ret?(i.qqFriends=t.items,e.cb&&e.cb(t.items)):Utils.MsgUtils.addMidMsg(t.msg)}).catch(function(){})},n.prototype.pushMessageToFriends=function(o){if(Utils.agentConfig.other.isJhb){var r=Utils.LocalStorageUtil.getItem("msgTime")||"0",s=(Number(r)+1).toString();r&&Number(r)<1&&this.getQQFriendsInfo({cb:function(t){for(var e=0,i=t;e<i.length;e++){var a=i[e].openid,n=o.content;Utils.Http.toGet({action:"get_gameMsg",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,zoneid:getUrlKV().platform,frd:a,msgtype:3,content:decodeURI(n),qua:getUrlKV().qua.meybeQua}).then(function(t){0==t.ret?r&&Number(r)<1&&Utils.LocalStorageUtil.setItem("msgTime",s,!1):Utils.MsgUtils.addMidMsg(t.msg)}).catch(function(){})}}})}},n.prototype.GetInvitationCodeInfo=function(t,e){Utils.Socket.send("activity","GetInvitationCodeInfo",{code:t}).then(function(t){e&&e(t.info)})},n.prototype.UseInvitationCode=function(t,e){Utils.Socket.send("activity","UseInvitationCode",{code:t.code,invitationCode:t.invitationCode}).then(function(t){t.clientReward&&b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward,2),e&&e()})},n.prototype.FishingOperation=function(e,i,a){var n=this;Utils.Socket.send("activity","FishingOperation",{code:e.code,type:e.type,target:e.target,num:e.num}).then(function(t){t.info&&n.updateData_View_Reward(e.code,t),t.clientReward&&b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).handleClientReward(t.clientReward,2),i&&i({info:JSON.parse(t.info),content:e.content}),a&&a()})},n.prototype.FishingGetEnemyInfo=function(t,e){Utils.Socket.send("activity","FishingGetEnemyInfo",{targetId:t}).then(function(t){e&&e(t)})},n.prototype.FishingChallenge=function(i,a){var n=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EActivityType.ZoneFishing,pb1:"activity",pb2:"FishingOperation",params:{code:EActivityType.ZoneFishing,type:i.type,target:i.target,num:void 0},ignoreStringWay:!0,doneCB:function(t){t.cbRet.info&&n.updateData_View_Reward(i.code,t.cbRet),b.GameMVC.activityMed.showViewByCode(EActivityType.ZoneFishing);var e=b.AppFacade.getInstance().retrieveProxy(b.FightPy.N);a&&a(),e.queueExceExitCB()}})},n.prototype.getTitle=function(t,e,i){return(b.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([i[1]%1e4])},n.prototype.getMax=function(t,e,i){switch(t){case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:case EActivityType.LiuYiConsumeTask:case EActivityType.TopFarmCoinRewardNum:case EActivityType.GuildTopFarmCoinRewardNum:return e;default:return e%1e4}},n.prototype.getTypeKey=function(t,e,i){var a=e;switch(t){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:case EActivityType.TopFarmCollectTime:case EActivityType.TopFarmBuildLevelNum:a=i[1]-i[1]%1e4}return a},n.prototype.addCollectActivityNoticeWatch=function(t){var e=b.GameMVC.activityPy.allActivityData[t];if(!e||!e.data)return!1;var i,a=e.content,n=(b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),e.data.curCycle);for(var o in a[1])if((s=a[1][o])[0]==n){i=s[1];break}if(!i)return!1;for(var r=0;r<i.length;r++){var s,c=(s=i[r])[2];NoticeManager.addCareCost(c,function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[t])})}return!1},n.prototype.activity295NoticeLogin=function(){var t=this.allActivityData[EActivityType.Regression];if(!t||!t.data)return!1;if(!t.data.inActivity)return!1;for(var e=t.content,i=t.data.vipLevel,a=0,n=0;n<e[1].length;n++)i>=(p=e[1][n])[0]&&(a=p[0]);i=a;var o=t.data.backDt,r=new Date(1e3*o);r.setHours(0,0,0);var s=Math.floor(r.getTime()/1e3),c=Utils.TimerManager.getServerTime(),d=Math.ceil((c-s)/86400),h=t.data.signIn;for(var l in e[1]){var p;if((p=e[1][l])[0]==i)for(var u in p[3],p[1]){var g=p[1][u],m=REWARD_STATUS.UNAVAILABLE;if(g[0]<d?m=REWARD_STATUS.CANBUY:g[0]==d&&(m=REWARD_STATUS.AVAILABLE),0<=h.indexOf(g[0])&&(m=REWARD_STATUS.RECEIVED),m==REWARD_STATUS.CANBUY||m==REWARD_STATUS.AVAILABLE)return!0}}return!1},n.prototype.activity295NoticeRecharge=function(){var t=this.allActivityData[EActivityType.Regression];if(!t||!t.data)return!1;if(!t.data.inActivity)return!1;for(var e=t.content,i=t.data.vipLevel,a=0,n=0;n<e[1].length;n++)i>=(c=e[1][n])[0]&&(a=c[0]);i=a;var o=t.data.amount,r=t.data.boxRecord;for(var s in e[1]){var c;if((c=e[1][s])[0]==i)for(var d in c[2]){var h=c[2][d],l=REWARD_STATUS.UNAVAILABLE;if(o>=h[1]&&(l=REWARD_STATUS.AVAILABLE),0<=r.indexOf(h[0])&&(l=REWARD_STATUS.RECEIVED),l==REWARD_STATUS.AVAILABLE)return!0}}return!1},n.prototype.checkIdelAvailable=function(){var t=this.allActivityData[b.Activity235.groupActivityCode.keng];if(!t||!t.data)return!1;var e=t.content[3],i=e[0],a=e[1],n=Utils.TimerManager.getServerTime(!1),o=new Date(1e3*n),r=o.getHours(),s=o.getMinutes();return(r>i[0]||r===i[0]&&s>=i[1])&&(r<a[0]||r===a[0]&&s<a[1])},n.prototype.cheakCreatNotice=function(){var t=[],e=b.GameMVC.backpackPy.AllItemInfo;for(var i in e){e[i][0];var a=b.Config.itemConfig()[Number(i)];0==a.type&&1==a.subType&&t.push(a)}return 0<t.length},n.prototype.cheakEatNotice=function(){var t=[],e=b.GameMVC.backpackPy.AllItemInfo;for(var i in e){e[i][0];var a=b.Config.itemConfig()[Number(i)];0==a.type&&2==a.subType&&t.push(a)}return 0<t.length},n.prototype.cheakGetNotice=function(){var t=!1,e=this.allActivityData[b.Activity235.groupActivityCode.event];return e&&e.data&&(t=!!e.data.inActivity&&0<e.data.events.length),t},n.prototype.cheakGiftNotice=function(){var t=this.allActivityData[b.Activity235.groupActivityCode.event];if(!t||!t.data)return!1;var o=t.content[2],r=[];if(t&&t.data&&t.data.gifts){var e=JSON.parse(t.data.gifts),s=b.GameMVC.rechargePy.goodList,c=Utils.TimerManager.getServerTime();e.forEach(function(t){var e={uuid:t.uuid,info:t,config:void 0,goodInfo:void 0,chosen:!1};for(var i in o){var a=o[i];if(a[0]===t.code){e.config=a;break}}for(var i in s){var n=s[i];if(Number(n.id)===e.config[1]){e.goodInfo=n;break}}0<t.triggerDt+e.config[3]-c&&r.push(e)})}return 0<r.length},n.prototype.addLanterCreateNoticeListen=function(){var t=b.Config.itemConfig();for(var e in t){var i=t[e];0==i.type&&1==i.subType&&NoticeManager.addCareCost([[3,e,1]],function(){NoticeManager.updateNotice(NT.ACTIVITY_MID_CREAT)})}},n.prototype.checkMagpieNotice=function(t){var e=!1,i=this.allActivityData[EActivityType.MagpieActivity];switch(t){case 1:var a=this.allActivityData[EActivityType.MagpieActivity],n=b.Config.magpieAchieveConfigs();for(var o in n){var r=n[o],s=!1;for(var c in a.data.targeted)if(r.code==a.data.targeted[c]){s=!0;break}if(!s){var d=JSON.parse(r.target),h=0,l=0;switch(r.type){case MagpieAchieveType.Collect:for(var p=0;p<d.length;p++){var u=b.GameMVC.backpackPy.getItemNumByCode(d[p][1]);d[p][0]<=u&&l++}h=d.length;break;case MagpieAchieveType.FinishRound:l=a.data.round,h=d[0];break;case MagpieAchieveType.ThrowDiceTimes:l=a.data.throwRecord,h=d[0];break;case MagpieAchieveType.ChatWith:var g=a.data.talkRecord,m=d[1];for(var y in h=d[0],g)if(g[y][0]==m){l=g[y][1];break}}h<=l&&(e=!0)}}break;case 2:var v=i.content,f=v[5][0];if(0<b.GameMVC.backpackPy.getInfoByCode(f[1]).haveNum)e=!0;else{var _=v[6][0];e=0<b.GameMVC.backpackPy.getInfoByCode(_[1]).haveNum}}return e},n.prototype.DoubleGetMax=function(t,e){switch(t){case EActivityType.ConsumeDiamondTask:case EActivityType.NationalTask:case EActivityType.DoubleEleven:case EActivityType.DoubleTwelve:case EActivityType.DoubleElevenCostTimes1:return e;default:return e%1e4}},n.prototype.DoubleGetTypeKey=function(t,e,i){if(t==EActivityType.DoubleEleven||t==EActivityType.DoubleTwelve)return 1;var a=e;return 1e5<i[1]?a=1e5*Math.floor(i[1]/1e5):1e4<i[1]&&(a=1e4*Math.floor(i[1]/1e4)),a},n.prototype.checkDoubleTaskNotice=function(){var t=EActivityType.DoubleElevenCostTimes1,e=this.allActivityData[EActivityType.DoubleElevenCostTimes1];if(!e||!e.data)return[];var i=e.content,a=e.data.targeted;function n(t){for(var e in o){var i=o[e];if(i.taskType==t)return r[t]=i.key,i.key}return 0}a[0]||(a=[]);var o=e.data.keyList,r={},s=b.Config.activityConfigs()[t],c=s&&s.rotation||1,d=0,h=9999999,l=0;if(1!=c){for(var p=i.length/c,u=1;u<=c;u++){var g=(_=i[f=u*p-1])[0],m=_[1]%1e4,y=_[3],v=this.DoubleGetTypeKey(t,y,_);if(!(m<=(A=r[v]||n(v)))){h=m;break}if(!(a.length>f)){h=m;break}l++,d=m}c<=l&&(l=c-1,d=i[i.length-p-1]&&i[i.length-p-1][1]||0,h=i[i.length-1][1])}for(var f in i){var _;if(g=(_=i[f])[0],m=this.DoubleGetMax(t,_[1]),1==c||!(m<=d||h<m)){_[2],y=_[3],_[4],v=this.DoubleGetTypeKey(t,y,_);var A=r[v]||n(v),T=REWARD_STATUS.CANBUY;if(m<=A&&(T=REWARD_STATUS.AVAILABLE),0<=a.indexOf(g)&&(T=REWARD_STATUS.RECEIVED),T==REWARD_STATUS.AVAILABLE)return!0}}return!1},n.prototype.checkExpRewardNotice=function(){var t=this.allActivityData[EActivityType.DoubleTwelve];if(!t||!t.data)return!1;var e=JSON.parse(t.content)[1],i=t.data.grade[0],a=t.data.levelTargeted;for(var n in e){var o=e[n][0];if(e[n][2],e[n][3],1!=o){var r=REWARD_STATUS.UNAVAILABLE;if(o<=i&&(r=REWARD_STATUS.AVAILABLE),0<=a.indexOf(o)&&(r=REWARD_STATUS.RECEIVED),r==REWARD_STATUS.AVAILABLE)return!0}}return!1},n.prototype.checkConsumeRebateRewardNotice=function(){var t=b.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve];if(!t||!t.data)return[];var e=JSON.parse(t.content)[4],i=t.data.targeted,a=t.data.totalCost;for(var n in e){var o=e[n],r=o[0],s=o[1],c=(o[2],REWARD_STATUS.UNAVAILABLE);if(s<=a&&(c=REWARD_STATUS.AVAILABLE),0<=i.indexOf(r)&&(c=REWARD_STATUS.RECEIVED),c==REWARD_STATUS.AVAILABLE)return!0}return!1},n.prototype.getPushGiftByIndex=function(t){var e=this.allActivityData[EActivityType.NewPushGiftBag];if(!e||!e.data||!e.data.gifts)return null;var i=[];for(var a in e.data.gifts){var n=e.data.gifts[a],o=b.Config.pushGiftBagConditionConfig()[n.code],r={code:n.code,beginDt:n.beginDt,gear:n.gear,gearCode:n.gearCode,goodsId:n.goodsId,rewards:n.rewards,endDt:n.beginDt+o.expire,uuid:a};i.push(r)}return i.sort(function(t,e){return t.endDt-e.endDt}),i[t]||null},n.prototype.getPushGiftByUuid=function(t){var e=this.allActivityData[EActivityType.NewPushGiftBag];if(!e||!e.data||!e.data.gifts)return null;for(var i in e.data.gifts)if(i==t){var a=e.data.gifts[i],n=b.Config.pushGiftBagConditionConfig()[a.code];return{code:a.code,beginDt:a.beginDt,gear:a.gear,gearCode:a.gearCode,goodsId:a.goodsId,rewards:a.rewards,endDt:a.beginDt+n.expire,uuid:i}}return null},n.prototype.addPustGiftList=function(t){for(var e in t)this.newPushList.push(t[e])},n.N="ActivityProxy",n);function n(){var t=e.call(this,n.N)||this;return t.backpackProxy=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),t.gamePlatform="",t._operationHasExec={},t.firstIn={},t.firstFetch={},t.giftList=[],t.qqFriends=[],t.isFirst=!0,t.needWatchNotice=[],t.newPushList=new Array,t.firstIn={},t.allActivityData={},t.downRelationInfos=new Array,t.upRelationInfos=new Array,t.downRelationInfosAny=new Array,t.relationRedBagInfos=new Array,t.releationTargeted=new Array,t.releationTargetedNew=new Array,b.ActivityConfig.addAllActivityConfig(),t.addNotice(),t}b.ActivityPy=t}(game=game||{}),function(a){var e,t=(e=eui.ItemRenderer,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.hasCreated=!0,this.update(this.params),this.gp_top.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},i.prototype.setDecorateData=function(t){this.decorateData=t,this.update(this.params)},i.prototype.decodeDecorateData=function(t){return this.decorateData&&this.decorateData[t]?this.decorateData[t](this.params):void 0},i.prototype.update=function(t){var e=this;if(this.hasCreated){if(t){if(this.params=t,!this.hasAddEffect){var i=this.decodeDecorateData("getEffect");i&&UIActionManager.addEffect(this.gp_effect,i,{},function(t){(e.tdEffect=t).visible=e.params&&e.params.status==REWARD_STATUS.AVAILABLE})}switch(this.img_bottom.source=this.decodeDecorateData("get_bottomImg_source")||"",this.bm_count.text=this.decodeDecorateData("get_tipBm_text")||"",this.bm_count.font=this.decodeDecorateData("get_tipBm_font")||"white_num_fnt",this.img_box.source=this.decodeDecorateData("get_boxImg_source")||"",t.status){case REWARD_STATUS.AVAILABLE:this.gp_effect.visible=!0,this.img_box.visible=!1,this.btnFunc=function(){e.tdEffect&&(e.tdEffect.visible=!1),e.img_box.visible=!0,e.img_box.source=e.decodeDecorateData("onBtnTap_boxImg_source")||"",DragonBoneTools.playOnce({parent:e.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){t.btnFunc&&t.btnFunc(t)}})};break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.GO_RECHARGE:this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewards,type:a.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})};break;case REWARD_STATUS.RECEIVED:this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")}}}}else this.params=t},i);function i(){var t=e.call(this)||this;return t.hasCreated=!1,t.hasAddEffect=!1,t.skinName="ActivityBox",t}a.ActivityBox=t}(game=game||{}),function(A){var e,t=(e=BaseView,__extends(i,e),i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},Object.defineProperty(i.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code},i.prototype.getReward=function(t,e){var i=this;if(this.code){var a=A.ActivityConfig.Config[this.code],n=a.getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,t).then(function(t){i.log(a.name+"——领取",n+"R",t),i.info.updateData(t.info),i.backpackProxy.handleClientReward(t.clientReward),e&&e(t)})}else this.log("没有声明活动code")},i.prototype.getParentView=function(){var t=A.AppFacade.getInstance().retrieveMediator(A.ActivityMediator.N).getSubView(A.ActivityMediator.SV.MAIN);return t&&t.gp_content},i.prototype.commonSortDataList=function(t){t.sort&&t.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id})},i.prototype.updateActivityTime=function(t,e){void 0===e&&(e=!0);var i=this.info;if(this.code==EActivityType.LevelReward)t.text="";else if(i&&t){var a=A.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();t.text=e?"剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):""+Utils.TimerManager.getFormatBySecond2(a),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=a--?t.text=e?"剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):""+Utils.TimerManager.getFormatBySecond2(a):A.AppFacade.getInstance().hideSubView(A.ActivityMediator.N,A.ActivityMediator.SV.MAIN)},this,1e3)}},i);function i(){var t=e.call(this)||this;return t.actProxy=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N),t.backpackProxy=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),t.hasInit=!1,t._CLASS_NAME_="ActivityCommonView",t}A.ActivityCommonView=t;var a,n=(a=BasePanel,__extends(o,a),Object.defineProperty(o.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},o.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code},o.prototype.getReward=function(t,e,i){var a=this;if(this.code){var n=A.ActivityConfig.Config[this.code],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,t).then(function(t){a.log(n.name+"——领取",o+"R",t),a.info.updateData(t.info),a.backpackProxy.handleClientReward(t.clientReward,{closeCB:i}),e&&e(t)})}else this.log("没有声明活动code")},o.prototype.commonSortDataList=function(t){t.sort&&t.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id})},o.prototype.updateActivityTime=function(t,e){var i=this;void 0===e&&(e=!0);var a=this.info;if(this.code==EActivityType.LevelReward)t.text="";else if(a&&t){var n=A.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),o=e?"剩余时间:":"";t.text=o+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?t.text=o+Utils.TimerManager.getFormatBySecond2(n):i.hide()},this,1e3)}},o.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},o);function o(){var t=a.call(this)||this;return t.actProxy=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N),t.backpackProxy=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),t}A.ActivityCommonPanel=n;var r,s=(r=BaseFull,__extends(c,r),Object.defineProperty(c.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this)},c.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code},c.prototype.getReward=function(t,e){var i=this;if(this.code){var a=A.ActivityConfig.Config[this.code],n=a.getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,t).then(function(t){i.log(a.name+"——领取",n+"R",t),i.info.updateData(t.info),i.backpackProxy.handleClientReward(t.clientReward),e&&e(t)})}else this.log("没有声明活动code")},c.prototype.commonSortDataList=function(t){t.sort&&t.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id})},c.prototype.updateActivityTime=function(t,e){var i=this;void 0===e&&(e=!0);var a=this.info;if(this.code==EActivityType.LevelReward)t.text="";else if(a&&t){var n=A.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),o=e?"剩余时间:":"";t.text=o+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?t.text=o+Utils.TimerManager.getFormatBySecond2(n):i.hide()},this,1e3)}},c.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},c);function c(){var t=r.call(this)||this;return t.actProxy=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N),t.backpackProxy=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),t}A.ActivityCommonFull=s;var d,h=(__extends(l,d=t),l.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},l.prototype.childrenCreated=function(){d.prototype.childrenCreated.call(this),this.initList()},l.prototype.initList=function(){this.list_itemList.itemRenderer=_},l.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code,this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)},l.prototype.getDataList=function(){return[]},l.prototype.updateTitle=function(){var t=this,e=A.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var a=A.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<a--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):A.AppFacade.getInstance().hideSubView(A.ActivityMediator.N,A.ActivityMediator.SV.MAIN)},this,1e3)}},l);function l(){var t=d.call(this)||this;return t.skinName="ActivityCommonListViewSkin",t}A.ActivityCommonListView=h;var p,u=(__extends(g,p=h),g.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)}},g.prototype.getDataList=function(){var r=this;if(!this.code)return[];var s=A.ActivityConfig.Config[this.code];if(!s)return[];var t=this.info;if(!t||!t.data)return[];var c=[],d=t.data.targeted;0==Object.keys(d).length&&(d=[]);var h=t.data.key||0,e=t.data.day,i=JSON.parse(t.content);t.data.curCycle,e&&s.cycle&&i.forEach(function(t){t[0]==e&&(i=t[1])});var a=A.Config.activityConfigs()[this.code],l=a&&a.rotation||1,n=0,o=0,p=0,u=9999999,g=i.length/l;if(1<l){for(var m=1;m<=l&&2<=l;m++){var y=m*g-1,v=i[y],f=(v[0],v[1]%1e4);if(!(f<=h)){u=f;break}if(o++,!(d.length>y)){u=f;break}n++,p=f}l<=n&&(n=l-1,p=i[i.length-g-1]&&i[i.length-g-1][1]||0,u=i[i.length-1][1])}return i.forEach(function(t){var e=t[0],i=t[1],a=t[2];if(l<=1||p<i&&i<=u){var n=REWARD_STATUS.UNAVAILABLE;d.some(function(t){return t.id==e&&0<t.num})?n=REWARD_STATUS.RECEIVED:h>=t[1]&&(n=REWARD_STATUS.AVAILABLE);var o={id:e,title:s.formatString&&s.formatString.format([i-p]),tips:h-p+"/"+(i-p),status:n,rewards:a,btnFunc:function(t){switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.AVAILABLE:r.getReward({id:t.id,code:r.code});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};c.push(o)}}),c.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),a&&1!=a.rotation&&0!=a.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+o+"/"+l+")"),c},g);function g(){return null!==p&&p.apply(this,arguments)||this}A.ActivityCommonTargetListView=u;var m,y=(__extends(v,m=h),v.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)}},v.prototype.getDataList=function(){var g=this;if(this.code){var m=A.ActivityConfig.Config[this.code];if(m){var t=this.info;if(t&&t.data){var y=t.data.targeted,v=(t.data.day,[]),e=JSON.parse(t.content),i=t.data.curCycle;if(i&&m.cycle)for(var a in e[1]){var n=e[1][a];if(n[0]==i){e=n[1];break}}var f=A.AppFacade.getInstance().retrieveProxy(A.RechargePy.N),_=f.goodList;return e.forEach(function(t){var e,i=t[0],a=t[1],n=t[2],o=t[3],r=t[4];for(var s in _){var c=_[s];if(i==c.id){e=c;break}}var d="";d=e?m.formatString.format([e.price*Utils.SDKMgr.globalIAPRate]):"找不到商品信息",t[5]&&(d=t[5]);var h=0;y.forEach(function(t){t.id==i&&(h=t.num)});var l=REWARD_STATUS.CANBUY;n<=h&&(l=REWARD_STATUS.HASBUY);var p=h+"/"+n;t[6]&&(p=h+"/"+t[6]);var u={title:d,tips:p,status:l,rewards:a,oriPrice:o,discount:r,btnFunc:function(){e?h<n?f.purchase(e,2,"",JSON.stringify({activityType:g.code}),{activityType:g.code}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};v.push(u)}),v.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),v}}}},v);function v(){return null!==m&&m.apply(this,arguments)||this}A.ActivityCommonRechargeListView=y;var f,_=(f=eui.ItemRenderer,__extends(T,f),T.prototype.childrenCreated=function(){f.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},T.prototype.dataChanged=function(){var o=this,t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_title.text=t.title||"",this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="领取",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;case REWARD_STATUS.CANBUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.HASBUY:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;case REWARD_STATUS.GO_RECHARGE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="充值",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.UNAVAILABLE_BUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.NEXT_REWARD:this.btn_operate.visible=!1;break;default:this.btn_operate.label="领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}t.btnText&&(this.btn_operate.label=t.btnText);var e=JSON.parse(t.rewards);this.gp_rewards.removeChildren(),e.forEach(function(t,e){var i=new eui.Group;i.width=i.height=73.5;var a=customui.BaseItemFactory.create();if(i.addChild(a),o.gp_rewards.addChild(i),a.scaleX=a.scaleY=.7,t[0]==EEntityType.EEntityTypeHeroArtifact||t[0]==EEntityType.EEntityTypeHeroEquip){var n={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};a.updateData({reward:t,vo:n})}else a.updateData({reward:t});t[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1}):UIActionManager.hideEffect(i)}),this.btnFunc=t.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate),this.data.discount&&this.lb_discount&&this.img_discount?(this.lb_tips.horizontalCenter=236,this.btn_operate.horizontalCenter=236,this.data.discount<100?(this.img_discount.visible=!0,this.lb_discount.visible=!0,this.data.discount%10==0?this.lb_discount.text=this.data.discount/10+"折":this.lb_discount.text=this.data.discount+"折"):(this.img_discount.visible=!1,this.lb_discount.visible=!1)):(this.img_discount&&(this.img_discount.visible=!1),this.lb_discount&&(this.lb_discount.visible=!1))},T);function T(){var t=f.call(this)||this;return t.skinName="ActivityCommonListItemSkin",t}A.ActivityCommonListItem=_}(game=game||{}),function(A){var e,t=(e=A.ActivityCommonListView,__extends(i,e),i.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.costBar=new customui.CommonResourceBar,this.costBar.x=-200,this.costBar.top=215,this.gp_title.addChild(this.costBar)},i.prototype.getDataList=function(){var g=this,t=this.info;if(!t||!t.data)return[];var d,m=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){d=n[1];break}}if(!d)return[];function o(t){var e=d[t],i=e[0],h=e[1],l=e[2],p=e[3],a=e[4],n=REWARD_STATUS.UNAVAILABLE,u=0;for(var o in m){var r=m[o];if(r.id==i){u=r.num;break}}f||(f=!0,_.costBar.updateBar(l)),p<=u?n=REWARD_STATUS.RECEIVED:y.checkEnough(l,!1)&&(n=REWARD_STATUS.AVAILABLE);var s=A.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),c={id:i,title:"兑换"+(s&&s.name),tips:u+"/"+p,rewards:h,costs:l,status:n,discount:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=A.AppFacade.getInstance().retrieveMediator(A.ShopyMediator.N),i=[],a=9999;for(var n in l){var o=l[n],r=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N).getInfoByCode(o[1]),s=Math.floor(r.haveNum/o[2]);s<a&&(a=s,i=o)}var c=a,d=A.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;t.showSubView(A.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(t){return{unit:i[2],total:i[2]*t}},name:d,limit:"[5,"+(p+1)+"]"},maxCount:p-u<c?p-u:c,buyNum:u+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){g.getReward({code:g.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};v.push(c)}for(var y=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),v=[],f=!1,_=this,r=0;r<d.length;r++)o(r);return v.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),this.code!=EActivityType.CollectWords&&this.code!=EActivityType.ItemGifts13&&this.code!=EActivityType.ItemGifts14&&this.code!=EActivityType.ItemGifts15||(this.costBar.visible=!1),v},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.ItemGifts,t}A.ActivityItemGifts=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var t=new eui.HorizontalLayout;t.verticalAlign="middle",t.gap=0,this.gp_rewards.layout=t},o.prototype.dataChanged=function(){var n=this,t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_title.text=t.title||"",this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.label="已领取",this.btn_operate.skinName="skins.ButtonSkinSure",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;default:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}this.gp_rewards.removeChildren();for(var e=JSON.parse(t.costs),i=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),a=0;a<e.length;a++){if(0<a){var o=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(o)}var r=customui.BaseItemFactory.create();r.scaleX=r.scaleY=.7,r.updateData({reward:e[a]});var s=i.getInfoByCode(e[a][1],!1).haveNum;r.blb_num.text=s+"/"+e[a][2],s>=e[a][2]?UIActionManager.setAbsGrey(r,!1):UIActionManager.setAbsGrey(r,!0),this.gp_rewards.addChild(r)}var c=new eui.Image("newactivity_img_denghao_png");if(this.gp_rewards.addChild(c),JSON.parse(t.rewards).forEach(function(t,e){var i=new eui.Group;i.width=i.height=73.5;var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({reward:t}),t[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1,childIndex:1}):UIActionManager.hideEffect(i),i.addChildAt(a,0),n.gp_rewards.addChild(i)}),this.btnFunc=t.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-1}):UIActionManager.hideEffect(this.btn_operate),this.data.discount){if(this.bm_discount)this.bm_discount.parent.visible=!0;else{var d=new eui.Group;d.left=432,d.top=-22,this.addChild(d),this.gp_discount=d;var h=new eui.Image;h.source="newactivity_img_zhekou_png",d.addChild(h),this.bm_discount=new eui.BitmapLabel,this.bm_discount.right=67,this.bm_discount.top=32,this.bm_discount.font="main_vip_fnt",this.bm_discount.rotation=-10,d.addChild(this.bm_discount)}this.bm_discount.text=this.data.discount/10+""}else this.bm_discount&&(this.bm_discount.parent.visible=!1)},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityCommonListItemSkin",t}A.ActivityExchangeListItem=n}(game=game||{}),function(b){var e,t=(e=b.ActivityCommonPanel,__extends(i,e),i.prototype.initList=function(){this.list_items.itemRenderer=y},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){t.hide()},this.rootPanel.blb_title.text="",this.img_top.source=""},i.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType;var e=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(e):this.list_items.dataProvider=new eui.ArrayCollection(e),0<=[EActivityType.DTRecharge,EActivityType.DTRecharge1,EActivityType.DTRecharge2].indexOf(this.code)?this.bm_time.visible=!0:this.bm_time.visible=!1,this.updateTitle()}},i.prototype.getDataList=function(){var l=this;if(this.code){var p=b.ActivityConfig.Config[this.code];if(p){var t=this.info;if(t&&t.data){this.timer&&this.timer&&egret.clearInterval(this.timer);var e=t.endDt,i=Utils.TimerManager.getServerTime();this.leftTime=e-i,this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond1(this.leftTime),this.timer=egret.setInterval(function(){--l.leftTime<=0?l.hide():l.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond1(l.leftTime)},this,1e3);var u=t.data.targeted,g=(t.data.day,[]),a=JSON.parse(t.content);a[2]&&(this.img_top.source=a[2]+"_png");var n=t.data.curCycle;if(n&&p.cycle)for(var o in a[1]){var r=a[1][o];if(r[0]==n){a=r[1];break}}var m=b.AppFacade.getInstance().retrieveProxy(b.RechargePy.N),y=m.goodList;return a.forEach(function(t){var e,i=t[0],a=t[1],n=t[2];for(var o in y){var r=y[o];if(i==r.id){e=r;break}}var s="";s=e?p.formatString.format([e.price*Utils.SDKMgr.globalIAPRate]):"找不到商品信息";var c=0;u.forEach(function(t){t.id==i&&(c=t.num)});var d=REWARD_STATUS.CANBUY;n<=c&&(d=REWARD_STATUS.HASBUY);var h={title:s,tips:c+"/"+n,status:d,rewards:a,oriPrice:t[3],discount:t[4],btnFunc:function(){e?c<n?m.purchase(e,2,"",JSON.stringify({activityType:l.code}),{activityType:l.code}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};g.push(h)}),g.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),g}}}},i.prototype.updateTitle=function(){var t=b.Config.activityConfigs()[this.code];t&&(this.img_top.source=JSON.parse(t.img_title)[0]+"_png",this.rootPanel.blb_title.text=JSON.parse(t.des_title)[0])},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.leftTime=0,t.skinName="ActivityMidAutumnTaskSkin",t}b.ActivityCommonRechargeListPanel=t;var a,n=(a=b.ActivityCommonPanel,__extends(o,a),o.prototype.initList=function(){this.list_items.itemRenderer=_},o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){t.hide()},this.img_top.source=""},o.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code;var e=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(e):this.list_items.dataProvider=new eui.ArrayCollection(e),this.updateTitle()},o.prototype.getDataList=function(){var g=this,t=this.info;if(!t||!t.data)return[];var m,y=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){m=n[1];break}}if(!m)return[];function o(t){var e=m[t],i=e[0],h=e[1],l=e[2],p=e[3],a=e[4],n=REWARD_STATUS.UNAVAILABLE,u=0;for(var o in y){var r=y[o];if(r.id==i){u=r.num;break}}p<=u?n=REWARD_STATUS.RECEIVED:v.checkEnough(l,!1)&&(n=REWARD_STATUS.AVAILABLE);var s=b.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),c="兑换";switch(_.code){case EActivityType.ChristmasItemGift1:s=b.GeneralConfig.getEntityConfigByCode(l[0][0],l[0][1]),c="收集"}var d={id:i,title:c+""+(s&&s.name),tips:u+"/"+p,rewards:h,costs:l,status:n,activityType:_.code,discount:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=b.AppFacade.getInstance().retrieveMediator(b.ShopyMediator.N),i=[],a=Number.MAX_VALUE;for(var n in l){var o=l[n],r=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N).getInfoByCode(o[1]),s=Math.floor(r.haveNum/o[2]);s<a&&(a=s,i=o)}var c=a,d=b.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;g.code==EActivityType.ValentineItemGift?g.getReward({code:g.code,giftCode:e.id,num:1}):t.showSubView(b.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(t){return{unit:i[2],total:i[2]*t}},name:d,limit:"[5,"+(p+1)+"]"},maxCount:p-u<c?p-u:c,buyNum:u+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){g.getReward({code:g.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};f.push(d)}for(var v=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),f=[],_=this,r=0;r<m.length;r++)o(r);return f.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),f},o.prototype.updateTitle=function(){var t=b.Config.activityConfigs()[this.code];t&&(this.img_top.source=JSON.parse(t.img_title)[0]+"_png",this.rootPanel.blb_title.text=JSON.parse(t.des_title)[0])},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityMidAutumnTaskSkin",t}b.ActivityCommonExchangeListPanel=n;var r,s=(r=b.ActivityCommonPanel,__extends(c,r),c.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items,this.list_items.itemRenderer=C},c.prototype.onItemTap=function(t){this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0,this.updateView()},c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.rootPanel.onCloseCB=function(){t.hide()},this.rootPanel.blb_title.text="任务",this.img_top.source="",this.initList(),this.updateView()},c.prototype.updateView=function(t){r.prototype.updateView.call(this,t);var e=[];e=this.code==EActivityType.ValentineRecharge?this.getDataList2():this.getDataList();var i=[],a={};e.forEach(function(t){i.push(t),a[t.type]=a[t.type]||t.status==REWARD_STATUS.AVAILABLE}),this.ac_items.replaceAll(i),this.updateTitle()},c.prototype.getDataList=function(){var p=this,a=this.info;if(!a||!a.data)return[];var u=[],g=this.info.content,m=a.data.targeted;m[0]||(m=[]);var n=a.data.keyList;function y(t){if(p.code==EActivityType.DoubleTwelve)return a.data.totalCost;for(var e in n){var i=n[e];if(i.taskType==t)return v[t]=i.key,i.key}return 0}this.code==EActivityType.DoubleTwelve&&(g=this.info.content[4]);var v={},t=b.Config.activityConfigs()[this.code],f=t&&t.rotation||1,_=0,A=Number.MAX_VALUE,e=0;if(1!=f){for(var i=g.length/f,o=1;o<=f;o++){var r=g[l=o*i-1],s=(r[0],r[1]%1e4),c=r[3],d=this.getTypeKey(c,r);if(!(s<=(v[d]||y(d)))){A=s;break}if(!(m.length>l)){A=s;break}e++,_=s}f<=e&&(e=f-1,_=g[g.length-i-1]&&g[g.length-i-1][1]||0,A=g[g.length-1][1])}function h(t){var e=g[t],i=e[0],a=e[3],n=T.getTypeKey(a,e),o=T.getMax(e[1],n);if(1!=f&&(o<=_||A<o))return"continue";var r=e[2],s=e[4];T.code==EActivityType.DoubleTwelve&&(s=e[3]);var c=v[n]||y(n),d=REWARD_STATUS.CANBUY;o<=c&&(d=REWARD_STATUS.AVAILABLE),0<=m.indexOf(i)&&(d=REWARD_STATUS.RECEIVED);var h=T.getTitle(a,e);T.code!=EActivityType.ConsumeDiamondTask&&T.code!=EActivityType.ConsumeDiamondTask1&&T.code!=EActivityType.LiuYiConsumeTask||d!=REWARD_STATUS.CANBUY||(d=REWARD_STATUS.UNAVAILABLE);var l={id:i,key:o,title:h,cur:c,taskSubType:a,status:d,rewards:r,tips:c-_+"/"+(o-_),btnText:d==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(d){case REWARD_STATUS.AVAILABLE:p.getReward({code:p.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:if(1e5<s){var e=s%1e5;b.GameMVC.activityMed.showViewByCode(e)}else b.MainJumpConfig.jumpTo(s);p.hide();break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}},type:T.code==EActivityType.DoubleTwelve?1:e[7]};u.push(l)}var T=this;for(var l in g)h(l);return u.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),u},c.prototype.getDataList2=function(){var d=this,t=this.info;if(!t||!t.data)return[];var h,e=t.content,l=t.data.amount,p=JSON.parse(t.data.targeted),i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){h=n[1];break}}if(!h)return[];function o(t){var e=h[t],i=e[1],a=e[2],n=e[3]||1,o=REWARD_STATUS.AVAILABLE;-1!=p.indexOf(e[0])?o=REWARD_STATUS.RECEIVED:l<i&&(o=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+e[1]*Utils.SDKMgr.globalIAPRate+" "+Utils.SDKMgr.globalIAPSuffix+"可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(m.code)&&(r="今日充值任意金额可领取");var s={id:i,title:e[1]?r:"免费领取",tips:e[1]?l+"/"+i:"",rewards:a,status:o,btnFunc:function(){switch(o){case REWARD_STATUS.AVAILABLE:d.getReward({id:e[0],code:d.code});break;case REWARD_STATUS.GO_RECHARGE:b.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<n){var c=!0;if(u.forEach(function(t){t.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(t)+1])return u.push(s),"break";g=n,u.splice(0,u.length),u.push(s)}else u.push(s)}var u=[],g=1,m=this;for(var r in h)if("break"===o(r))break;return u.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),u},c.prototype.getNameByCode=function(t){var e="";switch(t){case DoubleElevenPlace.Hero:e="英雄";break;case DoubleElevenPlace.Artifact:e="圣物";break;case DoubleElevenPlace.Equip:e="装备";break;case DoubleElevenPlace.Horse:e="坐骑";break;case DoubleElevenPlace.Pet:e="宠物";break;case DoubleElevenPlace.Role:e="主角"}return e},c.prototype.getTitle=function(t,e){if(this.code==EActivityType.DoubleTwelve)return"在大卖场消费满"+e[1]+"钻石";switch(t){case TaskSubType.DoubleElevenCostTimes:var i=Math.floor(e[1]/1e4),a=this.getNameByCode(i);return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([a,e[1]%1e4]);case TaskSubType.DoubleElevenViewTime:var n=Math.floor(e[1]/1e5),o=this.getNameByCode(n);return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([o,e[1]%1e5]);case TaskSubType.ActivityConsumeDiamond:return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]]);default:return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]%1e4])}},c.prototype.getMax=function(t,e){switch(this.code){case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:case EActivityType.LiuYiConsumeTask:case EActivityType.DoubleTwelve:case EActivityType.DoubleElevenCostTimes1:case EActivityType.HonorOrderTask:return t;case EActivityType.CommonTask10:case EActivityType.QingMingTask:return e==TaskSubType.ActivityConsumeDiamond?t:t%1e4;default:return t%1e4}},c.prototype.getTypeKey=function(t,e){if(this.code==EActivityType.DoubleTwelve)return 1;if(this.code==EActivityType.CommonTask10||this.code==EActivityType.QingMingTask||this.code==EActivityType.LiuYiConsumeTask)return t;var i=t;return 1e5<e[1]?i=1e5*Math.floor(e[1]/1e5):1e4<e[1]&&(i=1e4*Math.floor(e[1]/1e4)),i},c.prototype.updateTitle=function(){var t=b.Config.activityConfigs()[this.code];t&&(this.img_top.source=JSON.parse(t.img_title)[0]+"_png",this.rootPanel.blb_title.text=JSON.parse(t.des_title)[0])},c);function c(t){var e=r.call(this)||this;return e.proxy=b.GameMVC.activityPy,e.skinName="ActivityMidAutumnTaskSkin",e.params=t,e.code=t&&t.activityType||t&&t.code||e.code,e}b.ActivityCommonTaskListPanel=s;var d,h=(d=b.ActivityCommonPanel,__extends(l,d),l.prototype.initList=function(){this.list_items.itemRenderer=u},l.prototype.childrenCreated=function(){var t=this;d.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){t.hide()},this.img_top.source=""},l.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code;var e=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(e):this.list_items.dataProvider=new eui.ArrayCollection(e),this.updateTitle()},l.prototype.getDataList=function(){var e=this,t=this.info;if(!t||!t.data)return[];var i,a=t.data.targeted,n=t.content,o=t.data.curCycle||1;for(var r in n[1])if((h=n[1][r])[0]==o){i=h[1];break}if(!i)return[];for(var s=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),c=[],d=0;d<i.length;d++){var h,l=(h=i[d])[0],p=h[1],u=h[2],g=h[3],m=h[4],y=REWARD_STATUS.UNAVAILABLE,v=0;for(var r in a){var f=a[r];if(f.id==l){v=f.num;break}}g<=v?y=REWARD_STATUS.RECEIVED:s.checkEnough(u,!1)&&(y=REWARD_STATUS.CANBUY),b.GeneralConfig.getEntityConfigByCode(p[0][0],p[0][1]);var _={id:l,title:u[0][2]+"钻礼包",tips:v+"/"+g,rewards:p,costs:u,status:y,activityType:this.code,btnText:"购买",discount:m,btnFunc:function(t){switch(t.status){case REWARD_STATUS.CANBUY:case REWARD_STATUS.AVAILABLE:e.getReward({code:e.code,giftCode:t.id,num:1});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("钻石不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};c.push(_)}return c.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),c},l.prototype.updateTitle=function(){var t=b.Config.activityConfigs()[this.code];t&&(this.img_top.source=JSON.parse(t.img_title)[0]+"_png",this.rootPanel.blb_title.text=JSON.parse(t.des_title)[0])},l);function l(){var t=d.call(this)||this;return t.skinName="ActivityMidAutumnTaskSkin",t}b.ActivityCommonDiamondGiftsPanel=h;var p,u=(p=eui.ItemRenderer,__extends(g,p),g.prototype.childrenCreated=function(){var t=this;p.prototype.childrenCreated.call(this),this.btn_receive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc(t.data)},this)},g.prototype.dataChanged=function(){var t=this.data;this.lb_title.text=t.title,this.lb_progress.text=t.tips,this.gp_rewards.removeChildren(),b.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t.rewards,1),this.data.status===REWARD_STATUS.RECEIVED?(this.btn_got.visible=!0,this.btn_receive.visible=!1):(this.btn_got.visible=!1,this.btn_receive.visible=!0,this.btn_receive.label=this.data.btnText||"领取"),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_receive,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_receive)},g);function g(){var t=p.call(this)||this;return t.skinName="ActivityMidAutumnTaskPanel_TaskItem",t}var m,y=(m=b.ActivityCommonListItem,__extends(v,m),v.prototype.childrenCreated=function(){m.prototype.childrenCreated.call(this),this.img_discount=new eui.Image,this.img_discount.source="sjboss_img_zhekoudi_png",this.img_discount.right=this.img_discount.top=0,this.gp_root.addChild(this.img_discount),this.lb_discount=new eui.Label,this.lb_discount.size=21,this.lb_discount.textColor=16771491,this.lb_discount.rotation=45,this.lb_discount.right=11,this.lb_discount.top=5,this.gp_root.addChild(this.lb_discount),this.img_discount.visible=!1,this.lb_discount.visible=!1},v.prototype.dataChanged=function(){m.prototype.dataChanged.call(this),this.gp_rewards.scaleX=this.gp_rewards.scaleY=.85,this.data.discount&&this.data.oriPrice?(this.lb_tips.horizontalCenter=180,this.btn_operate.horizontalCenter=180,this.data.discount<100?(this.img_discount.visible=!0,this.lb_discount.visible=!0,this.data.discount%10==0?this.lb_discount.text=this.data.discount/10+"折":this.lb_discount.text=this.data.discount+"折"):(this.img_discount.visible=!1,this.lb_discount.visible=!1)):(this.img_discount.visible=!1,this.lb_discount.visible=!1)},v);function v(){var t=m.call(this)||this;return t.skinName="ActivityCommonListItemSkin2",t}var f,_=(f=b.ActivityExchangeListItem,__extends(A,f),A.prototype.dataChanged=function(){f.prototype.dataChanged.call(this),this.gp_rewards.scaleX=this.gp_rewards.scaleY=.85},A);function A(){var t=f.call(this)||this;return t.skinName="ActivityCommonListItemSkin2",t}var T,C=(T=eui.ItemRenderer,__extends(E,T),E.prototype.childrenCreated=function(){var t=this;T.prototype.childrenCreated.call(this),this.btn_receive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc()},this)},E.prototype.dataChanged=function(){var t=this.data;this.lb_title.text=t.title,this.lb_progress.text=t.tips,this.gp_rewards.removeChildren(),b.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t.rewards,1),this.data.status===REWARD_STATUS.RECEIVED?(this.btn_got.visible=!0,this.btn_receive.visible=!1):(this.btn_got.visible=!1,this.btn_receive.visible=!0,this.btn_receive.label=this.data.btnText||"领取"),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_receive,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_receive)},E);function E(){var t=T.call(this)||this;return t.skinName="ActivityMidAutumnTaskPanel_TaskItem",t}b.ActivityMidAutumnTaskPanel_TaskItem=C}(game=game||{}),function(C){var t,e,i=(t=C.ActivityCommonListView,__extends(d,t),d.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e),this.code){case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.RankMediator.N,C.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},d.prototype.getDataList=function(){var p=this,t=this.info;if(!t||!t.data)return[];var u=[],g=JSON.parse(t.content),m=t.data.targeted;function y(t){if(p.code==EActivityType.MagicalUpGradeTask||p.code==EActivityType.PetUpGradeTask){var e=0;for(var i in n)(a=n[i]).taskType>=t&&(e+=a.key);return v[t]=e}for(var i in n){var a;if((a=n[i]).taskType==t)return v[t]=a.key,a.key}return 0}m[0]||(m=[]);var n=t.data.keyList,v={},e=C.Config.activityConfigs()[this.code],f=e&&e.rotation||1,_=0,A=9999999,i=0,a=0;if(1!=f){for(var o=g.length/f,r=1;r<=f;r++){var s=g[b=r*o-1],c=(s[0],s[1]%1e4),d=s[3],h=this.getTypeKey(d,s);if(!(c<=(v[h]||y(h)))){A=c;break}if(i++,!(m.length>b)){A=c;break}a++,_=c}f<=a&&(a=f-1,_=g[g.length-o-1]&&g[g.length-o-1][1]||0,A=g[g.length-1][1])}function l(t){var e=g[t],i=e[0],a=T.getMax(e[1]);if(1!=f&&(a<=_||A<a))return"continue";var n=e[2],o=e[3],r=e[4],s=T.getTypeKey(o,e),c=v[s]||y(s),d=REWARD_STATUS.CANBUY;a<=c&&(d=REWARD_STATUS.AVAILABLE),0<=m.indexOf(i)&&(d=REWARD_STATUS.RECEIVED);var h=T.getTitle(o,e);T.code!=EActivityType.ConsumeDiamondTask&&T.code!=EActivityType.ConsumeDiamondTask1&&T.code!=EActivityType.LiuYiConsumeTask||d!=REWARD_STATUS.CANBUY||(d=REWARD_STATUS.UNAVAILABLE);var l={id:i,key:a,title:h,status:d,taskSubType:o,rewards:n,tips:c-_+"/"+(a-_),btnText:d==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(d){case REWARD_STATUS.AVAILABLE:p.getReward({code:p.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:r&&C.MainJumpConfig.jumpTo(r);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};u.push(l)}var T=this;for(var b in g)l(b);return this.commonSortDataList(u),e&&1!=e.rotation&&0!=e.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+f+")"),u},d.prototype.getTitle=function(t,e){switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:return(d.TaskType_2_Title[t]||"").format([Math.floor(e[1]/1e4),e[1]%1e4]);case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:return(d.TaskType_2_Title[t]||"").format([e[1]%1e4,Math.floor(e[1]/1e4)]);case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:case EActivityType.LiuYiConsumeTask:case EActivityType.TopFarmCoinRewardNum:case EActivityType.GuildTopFarmCoinRewardNum:return(d.TaskType_2_Title[t]||"").format([e[1]]);case EActivityType.TopFarmBuildLevelNum:var i="";switch(a=Math.floor(e[1]/1e4)){case TopFarmBuild.Farm:i="农场";break;case TopFarmBuild.Market:i="市场";break;case TopFarmBuild.Collect:i="采集中心";break;case TopFarmBuild.Research:i="研究所"}return(d.TaskType_2_Title[t]||"").format([i,e[1]%1e4]);case EActivityType.TopFarmCollectTime:var a=e[1]-e[1]%1e4,n=C.Config.farm_seedConfig(),o=0;for(var r in n){var s=n[r];s.code%1e4*1e4==a&&(o=JSON.parse(s.crop)[0][1])}var c=C.Config.itemConfig()[o];return(d.TaskType_2_Title[t]||"").format([c&&c.name||"找不到配置",e[1]%1e4]);default:return(d.TaskType_2_Title[t]||"").format([e[1]%1e4])}},d.prototype.getMax=function(t){switch(this.code){case EActivityType.ConsumeDiamondTask:case EActivityType.ConsumeDiamondTask1:case EActivityType.LiuYiConsumeTask:case EActivityType.TopFarmCoinRewardNum:case EActivityType.GuildTopFarmCoinRewardNum:return t;default:return t%1e4}},d.prototype.getTypeKey=function(t,e){var i=t;switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:case EActivityType.TopFarmCollectTime:case EActivityType.TopFarmBuildLevelNum:i=e[1]-e[1]%1e4}return i},d.TaskType_2_Title=((e={})[TaskSubType.CommentBeLikeMax]="单条评论收获%s个赞",e[TaskSubType.CommentTimes]="发布%s条评论",e[TaskSubType.LikeTimes]="点赞%s次",e[TaskSubType.ArenaChallengeTimes]="竞技场挑战%s次",e[TaskSubType.TouchGoldHand]="矮人宝藏点金%s次",e[TaskSubType.SmithyTimes]="铁匠铺锻造%s次",e[TaskSubType.ChallengeCircle]="遗迹探险探索%s圈",e[TaskSubType.MysticalShopRefreshTime]=" 神秘商店刷新%s次",e[TaskSubType.GuildCollectTime]="完成%s星公会采集%s次",e[TaskSubType.ActivityGashapon]="神魔召唤%s次",e[TaskSubType.ActivityGashapon1]="神魔召唤%s次",e[TaskSubType.HighGashaponTimes]="高级召唤%s次",e[TaskSubType.GiveFriendPokeBall]="赠送爱心%s次",e[TaskSubType.DailyFortressTimes]="日常副本战斗%s次",e[TaskSubType.ShopBuyTimes]="黑市商店购买%s次",e[TaskSubType.ExpeditionSuccessTimes]="远征胜利%s次",e[TaskSubType.RaceGashaponTimes]="时空招募%s次",e[TaskSubType.ActivityConsumeDiamond]="消耗%s钻石可领取",e[TaskSubType.HeroArtifactUpStarNum]="通过升星获得%s星圣物%s个",e[TaskSubType.MagicalUpGrade]="将任意%s个神器升级到%s级",e[TaskSubType.PetUpGrade]="将任意%s只宠物升级到%s级",e[TaskSubType.TreasureJewelTotalLevel]="上阵英雄宝石总等级达到%s级",e[TaskSubType.QuenchceMasterMaxLevel]="任意一个英雄淬炼大师达到%s级",e[TaskSubType.HeroArtifactTotalBaptizeNum]="洗满%s条圣物洗练属性",e[TaskSubType.QuoraNum]="在每日答题或定时答题中答对%s道题",e[TaskSubType.ReceiveRiksMineRewards]="冒险领取%s次采集收益",e[TaskSubType.RechargeMoney]="累计充值%s元",e[TaskSubType.JiuShenTask]="酒神积分达到%s",e[TaskSubType.ShiShenTask]="食神积分达到%s",e[TaskSubType.TopFarmCollectTime]="收获%s%s次",e[TaskSubType.TopFarmCoinRewardNum]="为公会贡献%s银币",e[TaskSubType.GuildTopFarmCoinRewardNum]="公会获得%s银币",e[TaskSubType.TopFarmBuildLevelNum]="公会%s升级到%s级",e[TaskSubType.DoubleElevenCostTimes]="在双十一%s分会场消费%s次",e[TaskSubType.DoubleElevenViewTime]="在双十一%s分会场浏览%s秒",e[TaskSubType.DoubleElevenSignIn]="每日登录",e[TaskSubType.CollectItem]="收集%s%s次",e[TaskSubType.TurnOverTimes]="在翻牌游戏中翻牌%s次",e[TaskSubType.TurnOverPairs]="翻牌游戏成功配对%s次",e[TaskSubType.TurnOverTrapTimes]="翻牌游戏遭遇陷阱%s次",e[TaskSubType.TurnOverColorPairs]="配对%s品质的卡牌%s次",e[TaskSubType.ChallengeTimes]="遗迹探险%s次",e[TaskSubType.RaceTowerTotalNum]="所有种族圣域通关第%s关",e[TaskSubType.AltarHeroUnlock]="英雄集结解锁%s个槽位",e[TaskSubType.AltarEquipUnlock]="装备集结解锁%s个槽位",e[TaskSubType.AltarArtifactUnlock]="圣物集结解锁%s个槽位",e[TaskSubType.PlayTexanPokerTimes]="每日进行一局命运对决",e[TaskSubType.DoneAllDailyTask]="完成主城所有日常任务",e),d);function d(){return t.call(this)||this}C.ActivityCommonTaskView=i}(game=game||{}),function(n){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){n.AppFacade.getInstance().retrieveMediator(n.ActivityMediator.N).hideAllSubView(),this.gp_content.removeChildren()},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.updateResourceBar(),this.initList()},i.prototype.initList=function(){this.list_actItem.itemRenderer=o,this.list_actItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),UIActionManager.hideScrollerBar(this.scl_actItem),this.scl_actItem.scrollPolicyH=eui.ScrollPolicy.AUTO},i.prototype.onItemTap=function(t){var e=t.id||t.item.config.id,i=n.AppFacade.getInstance().retrieveMediator(n.ActivityMediator.N);this.curActivityCode&&i.hideViewByCode(this.curActivityCode),this.curActivityCode=e,i.showViewByCode(this.curActivityCode),console.log("点击活动 ： ",e),this.updateSelected(e),this.gp_content.$children.forEach(function(t){t.scaleX=t.scaleY=1})},i.prototype.updateSelected=function(t){var e=this.list_actItem.dataProvider,i=e.source;for(var a in i){var n=i[a];n.chosen=n.config.id==t}e.replaceAll(i)},i.prototype.updateResourceBar=function(){var t=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.CommonResourceBar.updateBar({costs:t,width:190,needAdd:!0})},i.prototype.updateView=function(t){var e=this;this.vType=t&&t.viewType||this.vType,this.actList=n.ActivityConfig.getActivityConfigByType(this.vType);var i=[];this.actList.forEach(function(t){Utils.UnlockMgr.checkPass(MODULE.Activity+t.code,!1)&&i.push({config:t,chosen:!1,view:e})}),this.list_actItem.dataProvider=new eui.ArrayCollection(i);var a=t&&t.code||this.actList[0]&&this.actList[0].id;a&&this.onItemTap({id:a})},i);function i(){var t=e.call(this)||this;return t.curActivityCode=0,t.actList=[],t.skinName="ActivityRootPanelSkin",t}n.ActivityRootPanel=t;var a,o=(a=eui.ItemRenderer,__extends(r,a),r.prototype.dataChanged=function(){var t=this.activityProxy.allActivityData[this.data.config.id];Utils.SDKMgr.getPerformConfig(10018)&&!t&&this.data.config.id==EActivityType.QQZoneVipGift&&(t={skinId:0}),t&&(this.img_icon.source=ResourceUtils.png(JSON.parse(this.data.config.img_icon)[t.skinId]),this.updateSelected(),this.bm_title.text=JSON.parse(this.data.config.des_title)[0],this.lb_code.text=JSON.parse(this.data.config.des_title)[0],this.oldId&&NoticeManager.removeNoticeListener(NT.ALL_ACTIVITY[this.oldId]),this.oldId=this.data.config.id,NoticeManager.addNoticeListener(NT.ALL_ACTIVITY[this.data.config.id],this.gp_root,this.data.view,{percentX:90/113,percentY:0}))},r.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},r);function r(){var t=a.call(this)||this;return t.oldY=-5,t.oldId=0,t.activityProxy=n.AppFacade.getInstance().retrieveProxy(n.ActivityPy.N),t.skinName="ActivityRootPanel_ActivityItem",t}}(game=game||{}),function(r){var n,t=(n=BasePanel,__extends(e,n),e.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.isGet=-1!=r.GameMVC.activityPy.giftList.indexOf(this.giftId);var e=r.Config.giftConfig()[this.giftId];if(0==e.qqZoneVip){if(this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.removePopUp(t)},this),0==e.vipRange&&this.isGet&&(this.gp_title.width=460),0==e.vipRange)this.blb_title.text=this.isGet?"每天只能领取一次哦":"领取成功",this.lb_tips.text=this.isGet?"你今天已经领取过":"恭喜你领取了：",this.gp_rewards.visible=!0,this.lb_gotTips.visible=!1,this.lb_hints.visible=!0,this.lb_hints.text="            记得明天继续到                    玩吧礼包中心领取新的礼包哦！~";else{var i=this.ret;if(0==i.ret){this.gp_rewards.visible=!0,this.lb_gotTips.visible=!1;var a=e.vipRange;this.blb_title.text="领取成功",this.lb_tips.text=this.isGet?"你已经领取过VIP"+a+"礼包":"恭喜你，获得VIP"+a+"礼包：",this.lb_hints.visible=!0,this.lb_tips.visible=!0,this.lb_hints.text="明天请记得再来领取喔~"}else this.gp_rewards.visible=!1,this.lb_gotTips.visible=!0,this.blb_title.text="领取失败",this.lb_gotTips.text={2007:"VIP等级不匹配，无法领取",2008:"很遗憾，您的VIP等级已失效，点亮特权后重新领取。",2e3:"系统繁忙，请稍后重试或联系客服进行处理。"}[i.ret]||i.msg,this.lb_hints.visible=!1,this.lb_tips.visible=!1}this.updateView()}},e.prototype.updateView=function(t){for(var e=r.Config.giftConfig()[this.giftId],i=0,a=JSON.parse(e.rewards);i<a.length;i++){var n=a[i],o=customui.BaseItemFactory.create();o.updateData({reward:n}),o.scaleX=o.scaleY=.8,this.gp_items.addChild(o)}},e);function e(t){var e=n.call(this)||this;return e.skinName="GiftBagsSkin",e.params=t,e.giftId=t&&t.giftId||1,e.ret=t&&t.ret,e}r.GiftBagsView=t}(game=game||{}),function(h){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.isTargetPlatform="gameApp"==getUrlKV().channel,this.isDownload=Utils.SDKMgr.extraFuncForAgent({type:"appDownload"}),this.isDwonloadTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.downLoadId),this.isLoginTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.loginId),this.btn_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){function t(){i.updateView()}if(i.isDownload||i.isDwonloadTarget||i.isLoginTarget)!i.isDownload||i.isTargetPlatform||i.isDwonloadTarget||i.isLoginTarget?i.isDownload&&i.isTargetPlatform&&i.isDwonloadTarget&&!i.isLoginTarget&&h.GameMVC.activityPy.getGiftRewardFormServer({giftId:i.loginId,cb:t}):h.GameMVC.activityPy.getGiftRewardFormServer({giftId:i.downLoadId,cb:t});else{var e=Utils.agentConfig.other.weiduanUrl||"https://h5.qzone.qq.com/h5plus/download/1108515115?_wv=1025&via=H5.APP.YOUXINEI&autoDownload=1&hideDemo=1&newDownload=1";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:e}}),Utils.SDKMgr.extraFuncForAgent({type:"appDownload",params:{cb:function(t){i.isDownload=t,i.updateView({suc:t})}}})}},this),this.updateView()},i.prototype.updateView=function(t){var e=this.isDwonloadTarget||this.isLoginTarget||this.isDownload?this.loginId:this.downLoadId;this.isDwonloadTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.downLoadId),this.isLoginTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.loginId);var i=h.Config.giftConfig()[e],a=JSON.parse(i.rewards);this.gp_rewards.removeChildren();for(var n=0,o=a;n<o.length;n++){var r=o[n],s=customui.BaseItemFactory.create();s.updateData({reward:r}),s.scaleX=s.scaleY=.8,this.gp_rewards.addChild(s)}var c="下载微端";if(!this.isDownload||this.isTargetPlatform||this.isDwonloadTarget||this.isLoginTarget)if(this.isDownload&&t&&t.suc&&!this.isTargetPlatform&&!this.isDwonloadTarget&&!this.isLoginTarget){var d=t&&t.suc;c=d?"领取奖励":"领取失败",d||this.updateView()}else this.isDownload&&this.isTargetPlatform&&this.isDwonloadTarget&&!this.isLoginTarget?c="领取奖励":this.isDownload&&this.isTargetPlatform&&this.isDwonloadTarget&&this.isLoginTarget&&(c="已领取",this.btn_btn.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_btn,!0));else this.btn_btn.touchEnabled=this.isTargetPlatform,c="微端登录";this.btn_btn.label=c},i);function i(){var t=e.call(this)||this;return t.isDownload=!1,t.isDwonloadTarget=!1,t.isLoginTarget=!1,t.isTargetPlatform=!1,t.downLoadId=1101,t.loginId=1102,t.skinName="NativeDownloadSkin",t}h.NativeDownloadView=t}(game=game||{}),function(p){var a,t=(a=BasePanel,__extends(e,a),e.prototype.childrenCreated=function(){var i=this;a.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=p.GameMVC.activityPy.giftList,e=i.gift_type[i.params.type].id;-1==t.indexOf(e)?p.GameMVC.activityPy.getGiftRewardFormServer({giftId:e,cb:function(){i.updateView(i.params),p.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}}):Utils.MsgUtils.addMidMsg("已领取过，明天再来领吧！")},this),this.updateView()},e.prototype.updateView=function(t){var e=t||this.params,i=e&&e.type,a=this.gift_type[i].bg,n=this.gift_type[i].rewards;this.img_bg.source=a,this.gp_rewards.removeChildren();for(var o=0,r=n;o<r.length;o++){var s=r[o],c=customui.BaseItemFactory.create();c.updateData({reward:s}),c.scaleX=c.scaleY=.8,this.gp_rewards.addChild(c)}var d=p.GameMVC.activityPy.giftList,h=this.gift_type[i].id,l=-1!=d.indexOf(h);this.btn_get.label=l?"已领取":"领取",this.btn_get.touchEnabled=!l,UIActionManager.setAbsGrey(this.btn_get,l)},e);function e(t){var e=a.call(this)||this;return e.gift_type={PC:{id:2401,bg:"wanba_img_dengluyouli_png",rewards:JSON.parse(p.Config.giftConfig()[2401].rewards)},huangzuan:{id:2403,bg:"wanba_img_qqhuangzuantequan_png",rewards:JSON.parse(p.Config.giftConfig()[2403].rewards)},QQVip:{id:2404,bg:"wanba_img_qqhuiyuantequan_png",rewards:JSON.parse(p.Config.giftConfig()[2404].rewards)},xinYueClub:{id:2402,bg:"wanba_img_xinyuetequan_png",rewards:JSON.parse(p.Config.giftConfig()[2402].rewards)}},e.skinName="QQCommonGiftSKin",e.params=t,e}p.QQCommonGiftView=t}(game=game||{}),function(t){var i,e=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=Utils.agentConfig.other.tengxunUrl||"https://iwan.qq.com/fun/mindex?ADTAG=txsp.wd.xyx&hidetitlebar=1&autoplay=1";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:t}})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.doneCb&&t.doneCb()},this)},a);function a(t){var e=i.call(this)||this;return e.skinName="QQLiveSkin",e.doneCb=t&&t.cb,e}t.QQLiveView=e}(game=game||{}),function(m){var e,t=(e=m.ActivityCommonListView,__extends(i,e),i.prototype.initList=function(){var t=getUrlKV().QQVipLevel||0;this.lb_vipLevel.text="VIP"+t;var e=m.Config.activityConfigs()[EActivityType.QQZoneVipGift];this.img_bg.source=ResourceUtils.png(JSON.parse(e.img_title)[0]),this.list_items.itemRenderer=m.ActivityCommonListItem,this.sl_items.scrollPolicyH=eui.ScrollPolicy.OFF},i.prototype.getDataList=function(){function t(a){var n=u[a];if(0<n.qqZoneVip&&n.qqZoneVip>=p){var t=REWARD_STATUS.NEXT_REWARD,e=JSON.parse(n.rewards),i=n.qqZoneVip,o={id:a,rewards:e,status:t,title:"小游戏VIP"+i+"礼包",btnFunc:void 0};if(p<n.qqZoneVip)return o.status=REWARD_STATUS.NEXT_REWARD,o.title="下一个小游戏VIP"+i+"礼包，可领取：",g.push(o),"break";if(p==n.qqZoneVip){for(var r=m.GameMVC.activityPy.giftList,s=-1==r.indexOf(Number(a)),c=0,d=r;c<d.length;c++){var h=d[c];if(0!=u[h].qqZoneVip){s=!1;break}}o.status=s?REWARD_STATUS.AVAILABLE:REWARD_STATUS.RECEIVED,o.btnFunc=function(){l.getVIPInfo({id:a,cb:function(t){if(0==t.ret)m.GameMVC.activityPy.getGiftReward({giftId:Number(a),isVIPPri:!0,cb:function(t){l.updateView()}});else{var e=t.level,i="领取礼包失败";n.qqZoneVip>e&&(i="等级不足，需消费"+t.pay_fee_min+"星币到达等级"),n.qqZoneVip<e&&(i="当前礼包已过期"),Utils.MsgUtils.addMidMsg(i)}}})},g.push(o)}}}var l=this,p=getUrlKV().QQVipLevel||0,u=m.Config.giftConfig(),g=[];for(var e in u)if("break"===t(e))break;return g},i.prototype.updateView=function(t){this.getVIPInfo();var e=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(e):this.list_items.dataProvider=new eui.ArrayCollection(e)},i.prototype.getVIPInfo=function(e){Utils.Http.toGet({action:"get_vipLev",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,gift_id:e&&e.id||0}).then(function(t){0==t.vip.ret&&(getUrlKV().QQVipLevel=t.vip.level),e.cb&&e.cb(t.vip)}).catch(function(){})},i);function i(){var t=e.call(this)||this;return t.actPy=m.GameMVC.activityPy,t.skinName="VIPPrivilegeSkin",t}m.VIPPrivilegeView=t}(game=game||{}),function(r){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityPy.getGiftRewardFormServer({giftId:t.rewardId,cb:function(){t.updateView()}})},this),this.btn_btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=Utils.agentConfig.other.xinyueUrl||"http://xinyue.qq.com/act/a20181130xyh5game/index.html";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:t}})},this),this.updateView()},i.prototype.updateView=function(){var t=JSON.parse(r.Config.giftConfig()[this.rewardId].rewards);this.gp_rewards1.removeChildren();for(var e=0,i=t;e<i.length;e++){var a=i[e],n=customui.BaseItemFactory.create();n.updateData({reward:a}),n.scaleX=n.scaleY=.8,this.gp_rewards1.addChild(n)}var o=-1!=r.GameMVC.activityPy.giftList.indexOf(this.rewardId);this.btn_got.visible=o,this.btn_btn_1.visible=!o},i);function i(){var t=e.call(this)||this;return t.rewardId=2402,t.skinName="XinyueClubSkin",t}r.XinyueCLubView=t}(game=game||{}),function(l){var p,t=(p=l.ActivityCommonView,__extends(e,p),e.prototype.childrenCreated=function(){var i=this;p.prototype.childrenCreated.call(this),this.baseitem_chose.visible=!1,this.baseitem_chose.touchEnabled=!1,UIActionManager.addEffect(this.gp_main,"common_xysbeijing",{childIndex:1,offectY:100}),UIActionManager.fadeBlink(this.img_jiahao,!0,!1,1e3),this.gp_chose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=[];t.data.wishId&&e.push(String(t.data.wishId));var a=JSON.parse(t.content);PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var t={};for(var e in a[0]){var i=a[0][e];i[5]&&(t[i[0]]={uuid:i[0],type:i[1][0][0],code:i[1][0][1],num:i[1][0][2],isLocked:!1})}return t},type:EEntityType.EEntityTypeItem,isOnlyCode:!0,checkFull:function(t){return 1<=t.length},sortFunc:function(t,e){return t.info.uuid-e.info.uuid},selectUuids:e,singleChoose:!0,fullTip:"",title:"请选择你的心愿物品"}),closeCB:function(t){t&&i.getReward({code:i.code,id:WishTreeOper.SetWishId,num:t[0]?parseInt(t[0]):0})}})}},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.data.wishId?i.getReward({code:i.code,id:WishTreeOper.Wish,num:1}):Utils.MsgUtils.addMidMsg("请先选择心愿物品")},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.data.wishId?i.getReward({code:i.code,id:WishTreeOper.Wish,num:10}):Utils.MsgUtils.addMidMsg("请先选择心愿物品")},this);for(var t=0;t<10;t++){var e=new a;e.x=this.pos[t][0],e.y=this.pos[t][1],e.visible=!1,this.gp_rewards.addChild(e),this.reward_items.push(e)}},e.prototype.updateView=function(t){var n=this;p.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=e.data.wishId,o=e.data.wishGrade;this.img_chose.source=a?"xyzs_txt_dangqian_png":"xyzs_txt_xuanze_png";var r=i[0];for(var s in this.hasInit||(this.hasInit=!0,this.pb_lucky.maximum=i[4],this.cost_1.updateItem({cost:i[1][0],style:CommonIconStyle.RIGHT}),this.cost_10.updateItem({cost:i[2][0],style:CommonIconStyle.RIGHT}),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[5],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new l.HelpDialog({text:e})})},this)),this.pb_lucky.value=o,this.bm_cur.text=o+"/",this.bm_max.text=this.pb_lucky.maximum+"",o>=this.pb_lucky.maximum?(this.bm_cur.font="green_num_fnt",this.img_tip.source="xyzs_txt_xuyuanzhi_png"):(this.bm_cur.font="white_num_fnt",this.img_tip.source="xyzs_txt_xingyunzhi_png"),this.baseitem_chose.visible=!1,r){var c=r[s];c[0]==a&&(this.baseitem_chose.updateData({reward:c[1][0]}),this.baseitem_chose.visible=!0);var d=!!c[5],h=c[6]-1;this.reward_items[h]&&!d&&this.reward_items[h].update({isRare:d,rewards:c[1],id:c[0]})}this.updateTitle()}},e.prototype.updateTitle=function(){var t=this,e=l.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=e--?t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e):l.AppFacade.getInstance().hideSubView(l.ActivityMediator.N,l.ActivityMediator.SV.MAIN)},this,1e3)},e);function e(){var t=p.call(this)||this;return t.reward_items=[],t.pos=[[120,-60],[320,-30],[460,55],[430,200],[310,240],[80,180],[-80,150],[-50,0],[140,70],[280,100]],t.skinName="Activity162",t}l.Activity162=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),Object.defineProperty(n.prototype,"temData",{set:function(t){this.img_bg?this.update(t):this._temData=t},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_main,"common_xysqiuzhao",{childIndex:1,offectY:-10},function(t){(e.effectObj=t).visible=!(!e.data||!e.data.isRare)}),this.gp_main.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&l.GeneralConfig.showItemDetail(e.data.rewards[0])},this),this.img_bg.source="xyzs_img_waikuang1_png",this._temData&&(this.update(this._temData),this._temData=void 0)},n.prototype.update=function(t){this.data=t,this.visible=!0,this.img_bg.visible=!(this.data&&this.data.isRare),this.img_rare.visible=!(!this.data||!this.data.isRare),this.effectObj&&(this.effectObj.visible=!(!this.data||!this.data.isRare));var e=l.GameMVC.backpackPy.getInfoByCode(this.data.rewards[0][1]);this.img_icon.source=e.info.icon+"_png",this.lb_name.text=e.info.name,this.bm_num.text=this.data.rewards[0][2]},n.prototype.playEffect=function(t,e){this.effectObj&&(this.effectObj.visible=!1),this.img_bg.visible=!1,DragonBoneTools.playOnce({effectName:t,parent:this,x:this.width/2,y:this.height/2,doneCB:function(){e&&e()}})},n.prototype.showEffect=function(){this.img_bg.visible=!0,this.effectObj&&(this.effectObj.visible=!0)},n);function n(){var t=i.call(this)||this;return t.skinName="Activity162Item",t}l.Activity162Item=a}(game=game||{}),function(S){var w,t=(w=S.ActivityCommonView,__extends(e,w),e.prototype.childrenCreated=function(){var n=this;w.prototype.childrenCreated.call(this),this.btn_buy0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.buyBtnFunc0&&n.buyBtnFunc0()},this),this.btn_buy1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.buyBtnFunc1&&n.buyBtnFunc1()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[4],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new S.HelpDialog({text:e})})},this)},e.prototype.updateView=function(t){var l=this;w.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var p=JSON.parse(e.content);if(!this.hasInit){this.hasInit=!0;for(var s=0;s<2;s++){var i=p[0][s],a=(i[0],i[1]),n=i[2],o=i[4],r=this["gp_rewards"+s];S.GameMgr.getInstance().CommonGpAddReward(r,n,.95);var c=this["bm_max"+s];c&&(c.text=o);var d=S.GameMVC.rechargePy.getGoodInfo(a);if(d){var h=this["btn_buy"+s];h&&(h.label=""+d.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix)}}for(s=0;s<2;s++){var u=p[s+1],g=0;for(var m in u)(v=u[m])[2]>g&&(g=v[2]);var y=this["pb_"+s];if(y&&(y.maximum=g),r=this["gp_pb"+s])for(var m in u){var v=u[m],f=new S.ActivityBox;f.setDecorateData({getEffect:function(t){return"common_jxbaoxiang_1"},get_tipBm_font:function(t){return t.key>=t.target?"green_num_fnt":"white_num_fnt"},get_tipBm_text:function(t){return t.target},get_boxImg_source:function(t){return t.status==REWARD_STATUS.RECEIVED?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang1_png"},onBtnTap_boxImg_source:function(t){return"jjqy_img_baoxiang2_png"}}),f.horizontalCenter=r.width*v[2]/g-r.width/2,f.bm_count.top=90,this["boxs"+s].push(f),r.addChild(f)}}}var _=e.data.targeted;for(s=0;s<2;s++){u=p[s+1];var A=0==s?e.data.blessGrade:e.data.zoneGrade;function T(t){var e=u[t],i=e[0],a=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;n<=A&&(o=REWARD_STATUS.AVAILABLE),0<=_.indexOf(i)&&(o=REWARD_STATUS.RECEIVED);var r=b["boxs"+s][t];r&&r.update({status:o,rewards:a,key:A,target:n,btnFunc:function(t){l.getReward({code:l.code,id:i,num:1})}})}this["bm_curWish"+s].text=A,A=(this["pb_"+s].value=A)||0;var b=this;for(var m in u)T(m)}function C(t){var e=0,i=p[0][t],a=i[0],n=i[1],o=(i[2],i[4]);for(var r in E){var s=E[r];s[0]==t+1&&(e=s[1])}var c=I["bm_cur"+t];c&&(c.text=e+"/"),c.font=o<=e?"green_num_fnt":"white_num_fnt";var d=S.GameMVC.rechargePy.getGoodInfo(n);if(o<=e){I["buyBtnFunc"+t]=function(){Utils.MsgUtils.addMidMsg("已购买")};var h=I["btn_buy"+t];h&&(h.skinName="skins.ButtonSkinSure",h.label="已购买")}else I["buyBtnFunc"+t]=function(){d?S.GameMVC.rechargePy.purchase(d,2,a,JSON.stringify({uuid:a,activityType:l.code}),{activityType:l.code}):Utils.MsgUtils.addMidMsg("找不到商品信息")}}var E=e.data.recharged,I=this;for(s=0;s<2;s++)C(s);this.updateTitle()}},e.prototype.updateTitle=function(){var t=this,e=S.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=e--?t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e):S.AppFacade.getInstance().hideSubView(S.ActivityMediator.N,S.ActivityMediator.SV.MAIN)},this,1e3)},e);function e(){var t=w.call(this)||this;return t.boxs0=[],t.boxs1=[],t.skinName="Activity163",t}S.Activity163=t}(game=game||{}),function(s){var i,t=(i=s.ActivityCommonView,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0}),this.activateComponent()},e.prototype.updateView=function(t){var o=this;i.prototype.updateView.call(this,t);var r=this.info;if(r&&r.data){var e=r.content[0];this.tableInit||(e.forEach(function(i,t){var e=o["gp_Reward"+t],a=customui.BaseItemFactory.create();if(a.scaleX=a.scaleY=70/105,a.horizontalCenter=a.verticalCenter=0,a.updateData({reward:i[1][0]}),e.addChild(a),i[3]||i[4]){var n=new eui.Image;n.source="zsle_txt_xiyou_png",n.right=0,n.top=0,n.scaleX=n.scaleY=70/105,e.addChild(n),UIActionManager.addEffect(e,"common_fangkuang",{scaleX:.8,scaleY:.8,offectX:-2,offectY:-2},function(t){var e=0;e=i[3]?Math.ceil(r.data.zoneDiamond*i[3]):Math.ceil(r.data.diamond*i[4]),t.visible=!!e}),a.touchEnabled=!1,i[3]?((o.zoneDiamondBaseitem=a).img_icon.source="zsle_icon_zhan_png",o.zoneRate=i[3],e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(o.info.data.zoneDiamond){var t=Math.ceil(o.info.data.zoneDiamond*i[3]);s.AppFacade.getInstance().showSubView(s.CommonMediator.N,s.CommonMediator.SV.REWARD_PANEL,{rewards:[[1,1,t]],type:s.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else Utils.MsgUtils.addMidMsg("当前无战区奖池钻石")},o)):((o.selfDiamondBaseitem=a).img_icon.source="zsle_icon_ge_png",o.selfRate=i[4],e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(o.info.data.diamond){var t=Math.ceil(o.info.data.diamond*i[4]);s.AppFacade.getInstance().showSubView(s.CommonMediator.N,s.CommonMediator.SV.REWARD_PANEL,{rewards:[[1,1,t]],type:s.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else Utils.MsgUtils.addMidMsg("当前无个人奖池钻石")},o))}}),this.tableInit=!0),this.bm_selfRewardPool.text=r.data.diamond,Math.ceil(r.data.diamond*this.selfRate)?UIActionManager.setGrey(this.selfDiamondBaseitem.parent,!1):(UIActionManager.hideEffect(this.selfDiamondBaseitem.parent),UIActionManager.setGrey(this.selfDiamondBaseitem.parent,!0)),this.bm_zoneRewardPool.text=r.data.zoneDiamond,Math.ceil(r.data.zoneDiamond*this.zoneRate)?UIActionManager.setGrey(this.zoneDiamondBaseitem.parent,!1):(UIActionManager.hideEffect(this.zoneDiamondBaseitem.parent),UIActionManager.setGrey(this.zoneDiamondBaseitem.parent,!0)),this.bm_times.text=r.data.count,0<r.data.count?(this.bm_tips.text="",this.bm_tips.font="green_num_fnt",this.bm_tips.text="(每日重置)"):0<r.data.recharge?(this.bm_tips.text="",this.bm_tips.font="white_num_fnt",this.bm_tips.text="(当天抽奖完毕)"):(this.bm_tips.text="",this.bm_tips.font="white_num_fnt",this.bm_tips.text="(当天任意充值一次获得)"),this.updateRecord(),this.updateActivityTime(this.bm_time)}},e.prototype.rotateToIndex=function(t,e){if(!this.rotating){var i=t*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,e)}},e.prototype.rotateToAngle=function(t,e,i){var a=this;void 0===i&&(i=5e3);for(var n=[],o=0;o<8;o++){var r=this["gp_Reward"+o];r&&n.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1),this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var e=360*(a.FIXED_LAP+1)-a.gp_roll.rotation;n.forEach(function(t){t.rotation=e})},onChangeObj:this}).to({rotation:t},i,function(t){return 1-Math.pow(1-t,3)}).call(function(){a.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),e&&e()})},e.prototype.updateRecord=function(){var t=this.info;if(t&&t.data){var o=t.content[0];this.gp_record.removeChildren(),t.data.record&&0!=Object.keys(t.data.record).length||(t.data.record=[]);var r=t.data.record;for(var e in r.sort(function(t,e){return e.dt-t.dt}),r.forEach(function(t,e){var i=1;for(var a in o){var n=o[a];n[0]==t.id&&n[4]&&(i=2)}r[e].textFlow=[{text:"祝贺",style:{textColor:16777215}},{text:t.name+"",style:{textColor:6531583}},{text:"喜中",style:{textColor:16777215}},{text:1==i?"战区钻石大奖":"个人钻石大奖",style:{textColor:1==i?16751149:12805375}},{text:"，获得钻石",style:{textColor:16777215}},{text:Utils.MathUtils.formatNumStyle1(t.num)+"",style:{textColor:6618944}}]}),r){var i=r[e],a=new eui.Label;a.size=22,a.textFlow=i.textFlow,this.gp_record.addChild(a)}}},e.prototype.activateComponent=function(){var n=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<n.info.data.count?Utils.Socket.send("activity","DoCommonOperation",{code:n.code,num:1,id:1}).then(function(t){n.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:n.gp_effect,loop:!0});var e=JSON.parse(t.info);n.rotateToIndex(e.rewardCode-1,function(){n.info.updateData(e),s.GameMVC.backpackPy.handleClientReward(t.clientReward),n.gp_effect.removeChildAt(1),n.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[1],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new s.HelpDialog({text:e})})},this),Utils.ComponentUtils.registerListener(this.btn_record,egret.TouchEvent.TOUCH_TAP,function(){var t=n.info;if(t&&t.data){t.data.record&&0!=Object.keys(t.data.record).length||(t.data.record=[]);var i=t.data.record;i.sort(function(t,e){return e.dt-t.dt}),i.forEach(function(t,e){i[e].textFlow=[{text:"恭喜",style:{textColor:16777215}},{text:t.name+"",style:{textColor:16777215}},{text:"抽中",style:{textColor:16777215}},{text:Utils.MathUtils.formatNumStyle1(t.num)+"",style:{textColor:16777215}},{text:"钻石。",style:{textColor:16777215}}]}),PopUpManager.addPopUp({obj:new s.RecordPanel({records:i,title:"中奖记录"})})}},this)},e);function e(){var t=i.call(this)||this;return t.FIXED_LAP=5,t.itemAngle=45,t.rotating=!1,t.curIndex=0,t.tableInit=!1,t.skinName="Activity170",t}s.Activity170=t}(game=game||{}),function(E){var t,e,i=(t=E.ActivityCommonListView,__extends(r,t),r.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e),this.code){case EActivityType.ConsumeDiamondTask:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){E.AppFacade.getInstance().showSubView(E.RankMediator.N,E.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},r.prototype.getDataList=function(){var u=this,t=this.info;if(!t||!t.data)return[];var g=[],m=JSON.parse(t.content),y=t.data.targeted;function v(t){var e=0;t=Number(t);var i=Math.floor(t/1e4),a=Math.floor((t-1e4*i)/100);for(var n in d){var o=d[n].taskType,r=d[n].key,s=Math.floor(o/1e4),c=Math.floor((o-1e4*s)/100);0==i?a<=c&&(e+=r):i==s&&a<=c&&(e+=r)}return e}y[0]||(y=[]);var d=t.data.keyList,f={},e=E.Config.activityConfigs()[this.code],_=e&&e.rotation||1,A=0,T=9999999,i=0,a=0;if(1!=_){for(var n=m.length/_,o=1;o<=_;o++){var r=m[C=o*n-1],s=(r[0],(r[1]+"").split("")),c=Number(s[s.length-1]),h=r[3],l=this.getTypeKey(h,r);if(!(c<=(f[l]||v(r[1])))){T=c;break}if(i++,!(y.length>C)){T=c;break}a++,A=c}_<=a&&(a=_-1,A=m[m.length-n-1]&&m[m.length-n-1][1]||0,T=m[m.length-1][1])}function p(t){var e=m[t],i=e[0],a=(e[1]+"").split(""),n=Number(a[a.length-1]);if(1!=_&&(n<=A||T<n))return"continue";var o=e[2],r=e[3],s=e[4],c=b.getTypeKey(r,e),d=f[c]||v(e[1]),h=REWARD_STATUS.CANBUY;n<=d&&(h=REWARD_STATUS.AVAILABLE),0<=y.indexOf(i)&&(h=REWARD_STATUS.RECEIVED);var l=b.getTitle(r,e);b.code==EActivityType.ConsumeDiamondTask&&h==REWARD_STATUS.CANBUY&&(h=REWARD_STATUS.UNAVAILABLE);var p={id:i,key:n,title:l,status:h,rewards:o,tips:d-A+"/"+(n-A),btnText:h==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(h){case REWARD_STATUS.AVAILABLE:u.getReward({code:u.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:s&&E.MainJumpConfig.jumpTo(s);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};g.push(p)}var b=this;for(var C in m)p(C);return this.commonSortDataList(g),e&&1!=e.rotation&&0!=e.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+_+")"),g},r.prototype.getTitle=function(t,e){switch(this.code){case EActivityType.HeroStarSubTypeNumTask:var i=Math.floor(e[1]/1e4),a=Math.floor((e[1]-1e4*i)/100),n=e[1]%100,o=E.Config.heroConfigBySubType(i)[0];return(r.TaskType_2_Title[t]||"").format([n,o&&o.name||"无配置",a]);default:return(E.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]%1e4])}},r.prototype.getTypeKey=function(t,e){var i=t;switch(this.code){case EActivityType.HeroStarSubTypeNumTask:i=e[1]-e[1]%100}return i},r.TaskType_2_Title=((e={})[TaskSubType.HeroStarSubTypeNum]="将%s个%s升级到%s星",e),r);function r(){return null!==t&&t.apply(this,arguments)||this}E.Activity173=i}(game=game||{}),function(v){var f,t=(f=v.ActivityCommonPanel,__extends(e,f),e.prototype.childrenCreated=function(){var t=this;f.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this),this.btn_playVideo.visible=!1,this.btn_playVideo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),UIActionManager.addEffect(this.gp_effect,"common_shenqizs")},e.prototype.updateView=function(t){var e=this;f.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=JSON.parse(i.content);a.sort(function(t,e){return t[0]-e[0]});for(var n=i.data.day,o=i.data.targeted,r=1;r<=a.length;){var s=!1;for(var c in o)if(o[c].id==r){s=!0;break}if(!s)break;r++}var d=a[r-1];if(d){var h=d[2],l=v.GameMVC.rechargePy.getGoodInfo(h);this.btn_buy.label=l?""+l.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:"商品错误";var p=REWARD_STATUS.UNAVAILABLE;if(!(r<=n))return p=REWARD_STATUS.HASBUY,void this.hide();p=REWARD_STATUS.AVAILABLE;var u=d[1];if(this.btnFunc=function(){switch(p){case REWARD_STATUS.AVAILABLE:l?v.GameMVC.rechargePy.purchase(l,2,u,JSON.stringify({uuid:u,activityType:e.code}),{activityType:e.code,uuid:u}):Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买");break;default:Utils.MsgUtils.addMidMsg("状态错误")}},this.lastIndex!=r){this.lastIndex=r,this.gp_rewards.removeChildren();var g=d[3];v.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,g,.8),this.lb_name.text=d[4],this.HeroDynamicModel.update({model:d[5],isStatic:!0}),this.gp_preview.removeChildren();var m=d[6];MovieClipTools.create(m,function(t){t&&(t.x=this.gp_preview.width/2,t.y=this.gp_preview.height/2,t.scaleX=this.gp_preview.width/t.width,t.scaleY=this.gp_preview.height/t.height,this.effectObj=t,this.effectObj&&this.effectObj.animation.play(1),t.addEventListener(egret.Event.COMPLETE,function(){this.effectObj.animation.play(1)},this),this.gp_preview.addChild(t))},this)}var y=v.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(y),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=y--?e.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(y):e.hide()},this,1e3)}else this.hide()}else this.hide()},e);function e(){var t=f.call(this)||this;return t.lastIndex=0,t.isPlaying=!1,t.skinName="Activity174",t}v.Activity174=t}(game=game||{}),function(E){var i,t=(i=E.ActivityCommonListView,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.tabbar=new eui.TabBar,this.tabbar.itemRendererSkinName="TabBarItemSkin3",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this),this.tabbar.left=20,this.tabbar.bottom=0;var t=new eui.HorizontalLayout;t.gap=5,this.tabbar.layout=t,this.gp_title.addChild(this.tabbar);var e=new eui.Image;e.source="vipfl_img_hengtiao_png",e.bottom=0,e.horizontalCenter=0,this.gp_title.addChild(e),this.img_wholeLifeCard.left=165,this.img_wholeLifeCard.bottom=55,this.gp_title.addChild(this.img_wholeLifeCard),this.bm_time.right=-60,this.bm_time.y-=30},e.prototype.initList=function(){this.list_itemList.itemRenderer=n},e.prototype.onTabbarTap=function(t){if(2==t.itemIndex&&E.GameMVC.playerPy.playerInfoVO.level<this.unlockLevel)return Utils.MsgUtils.addMidMsg(this.unlockLevel+"级解锁"),void(this.tabbar.selectedIndex=this.selectIndex);this.selectIndex=t.itemIndex,this.updateView()},e.prototype.updateView=function(t){var e=this;this.code=t&&t.activityType||t&&t.code||this.code;var i=this.info;if(i&&i.data){if(this.updateTitle(),!this.hasInitTabbar){var a=[];a.push({up:"vipfl_yeqian_meirifuli2_png",down:"vipfl_yeqian_meirifuli1_png",text:""}),a.push({up:"vipfl_yeqian_viplibao2_png",down:"vipfl_yeqian_viplibao1_png",text:""}),a.push({up:"vipfl_yeqian_meizhoulibao2_png",down:"vipfl_yeqian_meizhoulibao1_png",text:""}),this.tabbar.dataProvider=new eui.ArrayCollection(a),this.tabbar.once(eui.UIEvent.ENTER_FRAME,function(){e.updateNotice()},this)}var n=this.getDataList();if(this.list_itemList.dataProvider=new eui.ArrayCollection(n),0==this.selectIndex){var o=E.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],r=o&&o.data&&o.data.hasPurchased&&!0;this.img_wholeLifeCard.source=r?"vipfl_img_yijihuo_png":"vipfl_img_weijihuo_png"}else this.img_wholeLifeCard.source="";this.updateTitle(),this.updateNotice()}},e.prototype.getNextLevelExp=function(){var t=E.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,e=E.Config.VIPUpgradeConfig()[t+1];return e?Math.ceil(e.exp-E.GameMVC.playerPy.playerInfoVO.playerVip.exp)/10:0},e.prototype.getDataList=function(){var d=this,t=this.info;if(!t||!t.data)return[];if(1==this.selectIndex)return this.getDataList2();var h=t.data.amounts,l=JSON.parse(t.data.dailyTargeted),c=JSON.parse(t.data.weekTargeted),p=JSON.parse(t.data.dailyAmountsTargeted),u=t.data.vip,g=E.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,i=JSON.parse(t.content);if(!i)return[];var m=[],y=this.getNextLevelExp();if(0==this.selectIndex){function e(s){function t(t){var e=c[t];if(e[1]>=u&&e[1]<=g||0==s&&e[1]==g+1||1==s){var i=e[0],a=0==s?0:e[2],n=0==s?e[2]:e[3],o=REWARD_STATUS.UNAVAILABLE;a<=h&&(e[1]>=u&&e[1]<=g||1==s&&g>=e[1])&&(o=REWARD_STATUS.AVAILABLE),0<=(0==s?l:p).indexOf(i)&&(o=REWARD_STATUS.RECEIVED);var r=0==s?"vip"+e[1]+"-终身卡每日专属福利":"当日累充"+e[2]*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"福利";y&&e[1]==g+1&&(r+="（再充值"+y*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"可领取）"),o==REWARD_STATUS.RECEIVED&&0==s&&e[1]!=g||m.push({id:i,title:r,rewards:n,status:o,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:i,code:d.code,num:s+1});break;case REWARD_STATUS.GO_RECHARGE:E.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("VIP等级不足")}}})}}var c=i[s];for(var e in c)t(e)}for(var a=0;a<2;a++)e(a)}else{function n(t){var e=v[t];if(f>=e[1]){var i=e[0],a=c,n=REWARD_STATUS.UNAVAILABLE;g>=e[2]&&(n=REWARD_STATUS.AVAILABLE);var o=0;a.forEach(function(t){t[0]==i&&(o=t[1])}),o>=e[3]&&(n=REWARD_STATUS.RECEIVED);var r=e[5],s=e[4];m.push({id:i,title:"       "+e[7],costs:s[0],discount:e[6],tips:g>=e[2]?"可购买"+(e[3]-o)+"次":"vip"+e[2]+"解锁",rewards:r,status:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:i,code:d.code,num:3});break;case REWARD_STATUS.GO_RECHARGE:E.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("VIP等级不足")}}})}}var v=i[2],f=E.GameMVC.playerPy.playerInfoVO.level;for(var o in v)n(o)}return m.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),m},e.prototype.getDataList2=function(){function t(t){var e=c[t];if(!e.level||e.level>d+3)return"continue";var i=REWARD_STATUS.CANBUY;h[e.level]&&(i=REWARD_STATUS.HASBUY),e.level>d&&(i=REWARD_STATUS.UNAVAILABLE_BUY);var a=JSON.parse(e.costs),n={id:e.level,title:"       VIP"+e.level+"礼包",status:i,rewards:e.gifts,discount:e.discount,costs:a[0],isVip:!0,btnFunc:function(){switch(n.status){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:s.GetVipLevelGift(e.level,function(){o.updateView(void 0)});break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:Utils.MsgUtils.addMidMsg("VIP等级不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}};r.push(n)}var o=this,r=[],s=E.AppFacade.getInstance().retrieveProxy(E.RechargePy.N),c=E.Config.VIPUpgradeConfig(),e=E.AppFacade.getInstance().retrieveProxy(E.PlayerPy.N).playerInfoVO.playerVip,d=e.vipLevel||0,h=e.vipGiftGot;for(var i in c)t(i);return r.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),r},e.prototype.updateNotice=function(){var t=this.info;if(t&&t.data){for(var e=t.data.amounts,i=JSON.parse(t.data.dailyTargeted),s=JSON.parse(t.data.weekTargeted),a=JSON.parse(t.data.dailyAmountsTargeted),n=t.data.vip,c=E.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,o=E.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],r=o&&o.data&&o.data.hasPurchased&&!0,d=JSON.parse(t.content),h=!1,l=0;l<2;l++){var p=d[l];for(var u in p){var g=p[u];if(g[1]>=n&&g[1]<=c||0==l&&g[1]==c+1){var m=g[0],y=0==l?0:g[2],v=(0==l?g[2]:g[3],REWARD_STATUS.GO_RECHARGE);if(y<=e&&g[1]>=n&&g[1]<=c&&(v=REWARD_STATUS.AVAILABLE),0<=(0==l?i:a).indexOf(m)&&(v=REWARD_STATUS.RECEIVED),v==REWARD_STATUS.AVAILABLE&&r){h=!0;break}}}if(h)break}function f(t){var e=p[t];if(A.unlockLevel=A.unlockLevel<e[1]?A.unlockLevel:e[1],_>=e[1]){var i=e[0],a=s,n=REWARD_STATUS.UNAVAILABLE;c>=e[2]&&(n=REWARD_STATUS.AVAILABLE);var o=0;a.forEach(function(t){t[0]==i&&(o=t[1])}),o>=e[3]&&(n=REWARD_STATUS.RECEIVED);var r=e[4];if(n==REWARD_STATUS.AVAILABLE&&E.GameMVC.backpackPy.checkEnough(r,!1))return h=!0,"break"}}(T=this.tabbar.$children[0])&&(b=T.img_notice)&&(b.right=-5,b.visible=h),h=!1,p=d[2];var _=E.GameMVC.playerPy.playerInfoVO.level,A=this;for(var u in p)if("break"===f(u))break;(T=this.tabbar.$children[2])&&(b=T.img_notice)&&(b.right=-5,b.visible=h);var T,b,C=E.AppFacade.getInstance().retrieveProxy(E.RechargePy.N);(T=this.tabbar.$children[1])&&(b=T.img_notice)&&(b.right=-5,b.visible=C.checkVipGiftNotice())}},e.prototype.updateTitle=function(){var t=E.Config.activityConfigs()[this.code];t&&(this.img_title.source=JSON.parse(t.img_title)[this.selectIndex]+"_png"),this.bm_time.text=""},e);function e(){var t=null!==i&&i.apply(this,arguments)||this;return t.img_wholeLifeCard=new eui.Image,t.selectIndex=0,t.hasInitTabbar=!1,t.rechargegGradient=[],t.unlockLevel=50,t}E.Activity175=t;var a,n=(a=E.ActivityCommonListItem,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_costs.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this),this.btn_costs.cui_freshCost.left=void 0,this.btn_costs.cui_freshCost.horizontalCenter=0,this.btn_costs.btn_oppr.skinName="skins.ButtonSkinYellow"},o.prototype.dataChanged=function(){a.prototype.dataChanged.call(this),this.gp_oldPrice.visible=!!this.data.isVip,this.data.costs?(this.gp_discount.visible=!0,this.img_discount.visible=!0,this.bm_discount.text=this.data.discount/10+"",this.data.status!=REWARD_STATUS.RECEIVED&&this.data.status!=REWARD_STATUS.HASBUY?(this.btn_operate.visible=!1,this.btn_costs.visible=!0,this.btn_costs.cui_freshCost.updateItem({cost:this.data.costs,style:CommonIconStyle.RIGHT})):(this.btn_operate.visible=!0,this.btn_costs.visible=!1),this.data.isVip&&this.CommonIconWithNum.updateItem({type:this.data.costs[0],code:this.data.costs[1],num:this.data.costs[2]/this.data.discount*100,style:CommonIconStyle.RIGHT})):(this.btn_operate.visible=!0,this.btn_costs.visible=!1,this.gp_discount.visible=!1)},o);function o(){var t=a.call(this)||this;return t.skinName="Activity175ItemSkin",t}}(game=game||{}),function(o){var r,t=(r=o.ActivityCommonView,__extends(e,r),e.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.list_root.itemRenderer=a,this.list_root.img_nextOne.source=this.list_root.img_lastOne.source=""},e.prototype.updateView=function(t){var d=this;r.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var h=JSON.parse(e.content);this.hasInit||(this.bm_minRecharge.text=h[0],this.bm_scaleTimes.text=h[2]);var l=e.data.amounts,p=e.data.targeted,u=e.data.day;function i(t){var e=h[1][t],i=REWARD_STATUS.UNAVAILABLE;l>=h[0]&&u>=e[0]&&(i=REWARD_STATUS.AVAILABLE),0<=p.indexOf(e[0])&&(i=REWARD_STATUS.RECEIVED),g.push({id:e[0],rewards:e[1],status:i,btnFunc:function(t){switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("单笔充值额度不足");break;case REWARD_STATUS.AVAILABLE:d.getReward({id:e[0],code:d.code,num:e[0]});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}});var a=e[1];for(var n in a){var o=a[n],r=!1;for(var s in m){var c=m[s];c[0]==o[0]&&c[1]==o[1]&&(r=!0,c[2]+=o[2])}r||m.push([o[0],o[1],o[2]])}}l>=h[0]?this.img_hasbuy.source="zxjj_img_yidacheng_png":this.img_hasbuy.source="zxjj_img_weidacheng_png",this.hasInit||this.gp_rewards.removeChildren();var g=[],m=[];for(var a in h[1])i(a);this.hasInit||o.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,m),r.prototype.commonSortDataList.call(this,g),this.list_root.dataProvider=new eui.ArrayCollection(g);var n=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer&&egret.clearInterval(this.timer),this.bm_time.text=Utils.TimerManager.getFormatBySecond1(n),this.timer=egret.setInterval(function(){0<n--&&(d.bm_time.text=Utils.TimerManager.getFormatBySecond1(n))},this,1e3),this.hasInit=!0}},e);function e(){var t=r.call(this)||this;return t.skinName="Activity176",t}o.Activity176=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.effectObj=this.gp_effect,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc(t.data)},this),UIActionManager.addEffect(this.gp_effect,"common_kelingqu2",{multi:1}),UIActionManager.addEffect(this.gp_effect,"common_kelingqu2k",{multi:1,scaleY:1.43})},n.prototype.dataChanged=function(){switch(this.lb_title.text="第"+o.GeneralConfig.numToChinesNum(this.data.id)+"天",this.gp_rewards.removeChildren(),o.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards,.6),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_status.visible=!1,UIActionManager.setGrey(this,!0);break;case REWARD_STATUS.AVAILABLE:this.img_status.visible=!0,this.img_status.source="",this.img_status.scaleX=this.img_status.scaleY=1.8,UIActionManager.setGrey(this,!1);break;case REWARD_STATUS.RECEIVED:this.img_status.visible=!0,this.img_status.source="xyzp_img_yilingqu_png",this.img_status.scaleX=this.img_status.scaleY=1.2,UIActionManager.setGrey(this,!0)}this.effectObj&&(this.effectObj.visible=this.data.status==REWARD_STATUS.AVAILABLE),this.img_notice.visible=!1},n.itemWidth=238,n);function n(){var t=i.call(this)||this;return t.skinName="Activity176Item",t}}(game=game||{}),function(s){var i,t=(i=s.ActivityCommonPanel,__extends(e,i),e.prototype.childrenCreated=function(){var n=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[2],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new s.HelpDialog({text:e})})},this),this.list_itemList.itemRenderer=o,this.CommonDaTanChuKuang.blb_title.text="充值排行榜",this.CommonDaTanChuKuang.onCloseCB=function(){n.hide()},UIActionManager.addEffect(this.gp_firstRank,"common_paihangbang_1",{childIndex:1,offectX:0,offectY:0,scaleX:.8,scaleY:.8})},e.prototype.updateView=function(t){var r=this;i.prototype.updateView.call(this,t),this.rankPy.GetRankList({rankType:RankingType.RankingTypeActivityRechargeRank,refreshInterval:0},function(t){var n=[],o=s.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityRechargeRank);0==t.ranks.length?r.gp_empty.visible=!0:(r.gp_empty.visible=!1,t.ranks.forEach(function(t,e){for(var i in 1==t.rank?(r.lb_topName.text=t.playerBaseInfo.name,r.cu_firstRank.updateData({vo:t.playerBaseInfo})):n.push({info:t,config:{keyWord:" "}}),o){var a=o[i];t.rank>=a.rankUpper&&t.rank<=a.rankLower&&(t.rewardsDesc=a.rewardsDesc)}}),r.list_itemList.dataProvider?r.list_itemList.dataProvider.replaceAll(n):r.list_itemList.dataProvider=new eui.ArrayCollection(n));var e=r.rankPy.getSelfRank(RankingType.RankingTypeActivityRechargeRank);if(e)for(var i in r.img_iconSelf.source=r.rankPy.rankIcon(e.rank),r.img_iconSelf.source?r.blb_rankSelf.text="":r.blb_rankSelf.text=e.rank.toString(),r.bm_selfRecharge.text="充值:"+e.key*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,r.lb_selfReward.text="请继续加油",o){var a=o[i];e.rank>=a.rankUpper&&e.rank<=a.rankLower&&(r.lb_selfReward.text=a.rewardsDesc)}else r.lb_selfReward.text="请继续加油",r.blb_rankSelf.text="",r.img_iconSelf.source="",r.bm_selfRecharge.text="";r.cu_self.updateData({vo:s.GameMVC.playerPy.playerInfoVO}),r.lb_nameSelf.text=""+s.GameMVC.playerPy.playerInfoVO.name});var e=s.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer&&egret.clearInterval(this.timer),this.bm_time.text=Utils.TimerManager.getFormatBySecond1(e),this.timer=egret.setInterval(function(){0<e--&&(r.bm_time.text=Utils.TimerManager.getFormatBySecond1(e))},this,1e3)},e);function e(){var t=i.call(this)||this;return t.rankPy=s.AppFacade.getInstance().retrieveProxy(s.RankPy.N),t.skinName="Activity177",t}s.Activity177=t;var a,o=(a=s.CommonRankPanel_RankItem,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){a.prototype.dataChanged.call(this),this.lb_keyValue.text=this.data.info.rewardsDesc||"请继续加油",this.bm_recharge.text="充值"+this.data.info.key*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,this.lb_name.textFlow=[{text:this.data.info.playerBaseInfo.name,style:{textColor:16777215}},{text:"("+this.data.info.playerBaseInfo.serverId+"服)",style:{textColor:196437}}]},n);function n(){var t=a.call(this)||this;return t.skinName="Activity177Item",t}}(game=game||{}),function(k){var N,t=(N=k.ActivityCommonView,__extends(e,N),e.prototype.childrenCreated=function(){var e=this;N.prototype.childrenCreated.call(this),this.tabbar.itemRendererSkinName="TabBarItemSkin3",this.tabbar.dataProvider=new eui.ArrayCollection([{up:"djlb_yeqian_lbgm2_png",down:"djlb_yeqian_lbgm1_png",text:""},{up:"djlb_yeqian_thcz2_png",down:"djlb_yeqian_thcz1_png",text:""}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){e.tabbarSelectIndex=t.itemIndex,e.updateDetailList()},this),this.CommonArrayList.itemRenderer=a,this.CommonArrayList.setItemTapEvent(this.onItemTap,this),this.CommonArrayList.gap=-100,this.list_root.itemRenderer=k.ActivityCommonListItem,this.btn_jump1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){k.MainJumpConfig.jumpTo(MODULE.Champion)},this),this.btn_jump2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){k.MainJumpConfig.jumpTo(MODULE.Risk)},this)},e.prototype.updateView=function(t){var i=this;N.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){for(var a=k.GameMVC.playerPy.playerInfoVO.level,n=-1,o=[],r=JSON.parse(e.content),s=0;s<2;s++)for(var c=0,d=r[s],h=0==s?e.data.diamondTargeted:e.data.rechargeTargeted,l=0==s?e.data.diamondGifts:e.data.rechargeGifts,p=0;p<d.length;p++){var u=0,g=d[p],m=g[0],y=g[1];if(2==c)break;for(var v in l)if((M=l[v])[0]==m){u=M[1];break}var f=REWARD_STATUS.UNAVAILABLE;for(var v in y<=a?f=REWARD_STATUS.CANBUY:c++,h)if((M=h[v])[0]==m){0<M[1]&&(f=REWARD_STATUS.RECEIVED);break}var _="";if(0==s)_=g[2][0][2]+"钻礼包";else{var A=k.GameMVC.rechargePy.getGoodInfo(g[2]);_=A?""+A.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"礼包":"找不到商品配置"}for(var T={id:m,type:s,title:_,tips:"",status:f,rewards:g[3],costs:g[2],goodId:g[2],btnFunc:function(t){if(t)switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("等级不足");break;case REWARD_STATUS.CANBUY:if(0==t.type)k.GameMVC.backpackPy.checkEnough(t.costs,!1)?i.getReward({code:i.code,id:t.type+1,num:t.id}):Utils.MsgUtils.addMidMsg("钻石不足");else{var e=k.GameMVC.rechargePy.getGoodInfo(t.goodId);e?k.GameMVC.rechargePy.purchase(e,2,t.id,JSON.stringify({uuid:t.id,activityType:i.code}),{activityType:i.code,uuid:t.id}):Utils.MsgUtils.addMidMsg("找不到商品配置")}break;case REWARD_STATUS.CANBUY:Utils.MsgUtils.addMidMsg("已购买")}else Utils.MsgUtils.addMidMsg("没传data")}},b=!1,C="data"+s,E=0;E<o.length;E++){var I=o[E];if(I.level==y){I[C]?I[C].push(T):I[C]=[T],I.level<=a&&T.status==REWARD_STATUS.CANBUY&&(I.notice=!0),b=!0;break}}b||o.push(((S={level:y})[C]=[T],S.icon=g[4],S.desc=g[5],S.jumpModule=g[6],S.chosen=!1,S.status=f,S.endTime=u,S.notice=T.status==REWARD_STATUS.CANBUY,S))}var S,w=Utils.TimerManager.getServerTime();for(s=0;s<o.length;s++){var M,R=!1,U=(T=(M=o[s]).data0,M.data1);if(T){if(M.status==REWARD_STATUS.UNAVAILABLE)R=!0;else if(M.endTime<=w)R=!1;else{for(var v in T)if(T[v].status!=REWARD_STATUS.RECEIVED){R=!0;break}for(var v in U)if(U[v].status!=REWARD_STATUS.RECEIVED){R=!0;break}}R||(o.splice(s,1),s--)}else o.splice(s,1),s--}if(0==o.length)return this.hide(),void k.AppFacade.getInstance().hideSubView(k.ActivityMediator.N,k.ActivityMediator.SV.MAIN);this.hasInit?this.lastLevel&&(o[0]&&o[0].level!=this.lastLevel?this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(0)},this):this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(i.topListSelectIndex)},this)):(this.hasInit=!0,n<0&&(n=0),n>o.length-1&&(n=o.length-1),o[n]&&(o[n].chosen=!0),this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(n)},this),this.lastLevel=o[n].level),this.CommonArrayList.setDataProvider(o,!1),this.updateDetailList()}},e.prototype.onItemTap=function(t){var e=this.CommonArrayList.dataProvider[t.itemIndex];e&&!e.fade&&(this.CommonArrayList.dataProvider[this.topListSelectIndex].chosen=!1,this.topListSelectIndex=t.itemIndex,this.CommonArrayList.dataProvider[this.topListSelectIndex].chosen=!0,this.CommonArrayList.refresh(),e.status==REWARD_STATUS.UNAVAILABLE?(this.gp_empty.visible=!0,this.sl_root.visible=!1,this.tabbar.visible=!1,this.updateDetailEmpty()):(this.gp_empty.visible=!1,this.sl_root.visible=!0,this.tabbar.visible=!0,this.updateDetailList()),0!=e.endTime?this.updateTime(e.endTime-Utils.TimerManager.getServerTime()):(this.timer&&egret.clearInterval(this.timer),this.bm_time.text="",this.bm_timeTip.text=""))},e.prototype.updateDetailList=function(){var t=this.CommonArrayList.dataProvider[this.topListSelectIndex];if(t&&!t.fade){var e=t["data"+this.tabbarSelectIndex];this.list_root.dataProvider=new eui.ArrayCollection(e)}},e.prototype.updateDetailEmpty=function(){var t=this.CommonArrayList.dataProvider[this.topListSelectIndex];if(t&&!t.fade){var e=t.level,i=k.GameMVC.playerPy.playerInfoVO.level;this.lb_noEnought.textFlow=[{text:"    可惜，还差",style:{textColor:16770787}},{text:""+(e-i),style:{textColor:8774140}},{text:"级就可以激活",style:{textColor:16770787}},{text:""+t.desc,style:{textColor:8774140}},{text:"，请前往",style:{textColor:16770787}},{text:"永恒之塔",style:{textColor:8774140}},{text:"和冒险的",style:{textColor:16770787}},{text:"快速开采",style:{textColor:8774140}},{text:"获取大量经验",style:{textColor:16770787}}]}},e.prototype.updateTime=function(t){var e=this;this.timer&&egret.clearInterval(this.timer),this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t--),this.timer=egret.setInterval(function(){e.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t--),t<=0&&e.updateView()},this,1e3)},e);function e(){var t=N.call(this)||this;return t.topListSelectIndex=1,t.tabbarSelectIndex=0,t.lastLevel=0,t.skinName="Activity179",t}k.Activity179=t;var i,a=(i=customui.scroller2p0Item,__extends(n,i),n.prototype.childrenCreated=function(){var t=this;this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data&&t.data.jumpModule?k.MainJumpConfig.jumpTo(t.data.jumpModule):Utils.MsgUtils.addMidMsg("没有跳转模块")},this),this.minScale=.6},n.prototype.dataChanged=function(){this.data.fade?this.visible=!1:(this.visible=!0,this.data.chosen?(UIActionManager.setGrey(this,!1),this.btn_go.touchEnabled=!0):this.btn_go.touchEnabled=!1,this.img_icon.source=this.data.icon+"_png",this.lb_desc.text=this.data.desc,this.lb_level.text=this.data.level+"级",this.img_notice.visible=!!this.data.notice)},n.itemWidth=276,n);function n(){var t=i.call(this)||this;return t.skinName="Activity179Item",t}}(game=game||{}),function(c){var d,t=(d=c.ActivityCommonView,__extends(e,d),e.prototype.childrenCreated=function(){var o=this;function t(n){var t=e["gp_answer"+n];e.answerGp.push(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.ActivityConfig.Config[o.code];e.getRewardName,o.lastChoseId=n;var t=o.info.data.quora;if(t){o.gp_answerParent.touchChildren=!1;var i=egret.setTimeout(function(){o.gp_answerParent.touchChildren=!0},o,3e3),a={order:t.order,quoraCode:t.quoraCode,optionNum:n+1};Utils.Socket.send("activity","DoCommonOperation",{code:o.code,num:1,info:JSON.stringify(a)}).then(function(t){o.log(e.name+"——领取","DoCommonOperationR",t),i&&egret.clearTimeout(i),o.timer&&egret.clearTimeout(o.timer),o.timer=egret.setTimeout(function(){o.gp_answerParent.touchChildren=!0,o.lastChoseId=-1,o.timer=0,o.info.updateData(t.info),o.safeData=void 0},o,3e6),o.safeData=t.info,o.updateView()})}},e)}d.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_effect,"hero_activity_018_01");for(var e=this,i=0;i<4;i++)t(i);this.btn_getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.getReward({code:o.code,num:2,id:1,info:JSON.stringify({code:o.code})})},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.timer&&egret.clearTimeout(o.timer),o.gp_answerParent.touchChildren=!0,o.lastChoseId=-1,o.timer=0,o.safeData&&(o.info.updateData(o.safeData),o.safeData=void 0)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=o.info,e=JSON.parse(t.content);c.GameMVC.activityMed.showHelpDialog(e[2])},this)},e.prototype.updateView=function(t){d.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=i[0],n=e.data.quora,o=n&&n.quoraCode||0,r=n?n.order-1:a,s=e.data.correctNum;if(this.lb_correctNum.text=s,this.timer)this.updateRewardVisible(!1),this.updateQuestion(o),this.lb_questionId.text="第"+(r+1)+"题("+(r+1)+"/"+a+")",this.updateAnswers(o,!0,this.lastChoseId),this.btn_next.label=r==a-1?"交卷":"下一题",this.btn_next.visible=!0,this.img_everyDayReset.visible=!1;else if(0==r)this.updateRewardVisible(!1),this.lastQuestionId=0,this.updateQuestion(o),this.updateAnswers(o,!1),this.lb_questionId.text="第1题(1/"+a+")",this.lb_answerResult.text="开始答题吧",this.btn_next.visible=!1,this.img_everyDayReset.visible=!0;else{var c=i[0];i[1],r<c?(this.updateRewardVisible(!1),this.updateQuestion(o),this.updateAnswers(o,!1),this.lb_questionId.text="第"+(r+1)+"题("+(r+1)+"/"+a+")"):(this.updateRewardVisible(!0),this.updateRewards()),this.btn_next.visible=!1,this.img_everyDayReset.visible=!0}}},e.prototype.updateRewardVisible=function(t){this.lb_answerDone.visible=t,this.lb_question.visible=!t,this.lb_questionId.visible=!t,this.gp_rewardGp.visible=t,this.gp_answers.visible=!t},e.prototype.updateQuestion=function(t){var e=c.Config.quoraConfig()[t];e?this.lb_question.textFlow=(new egret.HtmlTextParser).parse(e.question):this.lb_question.text="找不到题目配置"},e.prototype.updateAnswers=function(t,e,i){void 0===i&&(i=-1);var a=c.Config.quoraConfig()[t];if(a){for(var n=JSON.parse(a.answer),o=0;o<4;o++){var r=n[o],s=!!r;e?this.updateAnswer(o,o+1==a.correct,r,s,i==o):this.updateAnswer(o,void 0,r,s,i==o)}e?this.lastChoseId+1==a.correct?this.lb_answerResult.text="非常棒，回答正确！":this.lb_answerResult.text="遗憾，回答错误！":this.lb_answerResult.text="请回答下列题目"}else for(o=0;o<4;o++)this.updateAnswer(o,void 0,"",!1)},e.prototype.updateAnswer=function(t,e,i,a,n){void 0===i&&(i=""),void 0===a&&(a=!0),void 0===n&&(n=!1);var o=this.answerGp[t];if(o){var r=o.$children[1],s=o.$children[2],c=o.$children[3];s&&(s.text=this.num2letter[t]+". "+i),c.visible=n,0==a?(o.parent.removeChild(o),o.visible=!1):null==e?(o.visible=!0,r.visible=!1):(o.visible=!0,r.visible=!0,r.source=e?"jsjhd_img_gou_png":"jsjhd_img_cha_png")}},e.prototype.updateRewards=function(){var t=this.info;if(t&&t.data){var e=JSON.parse(t.content);t.data.isTargeted?c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.RECEIVED):c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.AVAILABLE),this.gp_rewards.removeChildren(),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t.data.rewards);var i=e[1],a=t.data.correctNum;for(var n in i){var o=i[n];o[1]==a&&(this.lb_answerResult.text="成绩为"+o[2])}}},e.prototype.onDestroy=function(){this.timer&&egret.clearTimeout(this.timer),this.safeData&&this.info.updateData(this.safeData)},e);function e(){var t=d.call(this)||this;return t.lastQuestionId=0,t.lastChoseId=-1,t.num2letter=["A","B","C","D","E"],t.safeData=void 0,t.answerGp=[],t.skinName="Activity184",t}c.Activity184=t}(game=game||{}),function(_){var A,t=(A=_.ActivityCommonView,__extends(T,A),T.prototype.childrenCreated=function(){var a=this;function t(t){var e=i["gp_answer"+t];i.answerGp.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=_.ActivityConfig.Config[a.code];if(a.curQuora){a.gp_answerParent.touchChildren=!1;var i=egret.setTimeout(function(){a.gp_answerParent.touchChildren=!0},a,3e3);Utils.Socket.send("activity","ZoneQuoraAnswer",{code:a.code,order:a.curQuora.order,quoraCode:a.curQuora.quoraCode,optionNum:t+1}).then(function(t){a.log(e.name+"——领取","ZoneQuoraAnswer",t),a.gp_answerParent.touchChildren=!0,t.info.sysdt&&_.GameMgr.getInstance().updateTimeDValue(t.info.sysdt),a.updateStatus(),T.oldGrade=a.info.data.selfPlayer&&a.info.data.selfPlayer.score||0,a.info.updateData(t.info),egret.clearTimeout(i)})}},i)}A.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_effect,"hero_activity_018_01"),this.list_rank.itemRenderer=n;for(var i=this,e=0;e<4;e++)t(e);this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.info,e=JSON.parse(t.content);_.GameMVC.activityMed.showHelpDialog(e[4])},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.AppFacade.getInstance().showSubView(_.RankMediator.N,_.RankMediator.SV.COMMON,{module:"ACTIVITY_QUORA"})},this),this.btn_getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.getReward({code:a.code})},this)},T.prototype.updateView=function(t){var e=this;A.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=JSON.parse(i.content);this.timeConfig=a[0][0];var n=a[1],o=_.Config.zoneQuoraConfig(),r=this.info.data.selfPlayer&&this.info.data.selfPlayer.records||[];if(!this.canAnswerTime)return this.showCorrectAnswerTime=a[3],this.canAnswerTime=a[2].length,this.updateStatus(),this.timer=egret.setInterval(function(){e.updateStatus()},this,1e3),this.bm_beginTime.text=this.timeConfig[0][0]+":"+(this.timeConfig[0][1]||"00"),this.bm_endTime.text=this.timeConfig[1][0]+":"+(this.timeConfig[1][1]||"00"),void this.updateRank();switch(this.curStatus){case 1:this.updateVisible(REWARD_STATUS.UNAVAILABLE),this.lb_rankTitle.text="上期排名",this.lb_firstOne.text="";break;case 2:case 3:this.lb_rankTitle.text="当前排名";var s=i.data.quoras,c=i.data.selfPlayer,d=(c.selfRank,c.score,c.records);this.updateVisible(REWARD_STATUS.AVAILABLE);var h=0;for(var l in s)(v=s[l]).order==this.curOrder&&(h=v.quoraCode);if(!h)return;for(var l in this.curQuora={order:this.curOrder,quoraCode:h},this.updateQuestion(h),this.lb_questionId.text="第"+this.curOrder+"题("+this.curOrder+"/"+n+")",this.lastChoseId=-999,d)(v=d[l]).order==this.curOrder&&(this.lastChoseId=v.optionNum);if(this.updateAnswers(h,3==this.curStatus,this.lastChoseId),3==this.curStatus)if(T.firstName){var p=JSON.parse(T.firstName);this.lb_firstOne.text="最快答对此题玩家："+p.name+"("+p.serverId+"服)"}else this.lb_firstOne.text="无人答对此题";else this.lb_firstOne.text="";break;case 4:this.lb_rankTitle.text="上期排名",this.updateVisible(REWARD_STATUS.RECEIVED),this.updateRewards(),this.lb_firstOne.text=""}if(2!=this.curStatus){this.lb_grade.text=this.info.data.selfPlayer&&this.info.data.selfPlayer.score||0;var u=0;for(var l in r){var g=(v=r[l]).quoraCode,m=v.optionNum;(f=o[g])&&m==f.correct&&u++}this.lb_correctNum.text=u+""}else{u=0;var y=!1;for(var l in r){var v,f;g=(v=r[l]).quoraCode,m=v.optionNum,(f=o[g])&&m==f.correct&&g!=this.curQuora.quoraCode&&u++,g==this.curQuora.quoraCode&&(y=!0)}this.lb_correctNum.text=u+"",y?this.lb_grade.text=T.oldGrade||"0":this.info.data.selfPlayer&&this.info.data.selfPlayer.score?this.lb_grade.text=this.info.data.selfPlayer.score:this.lb_grade.text="0"}}},T.prototype.updateStatus=function(){var t=Utils.TimerManager.checkIsOpen_FormatA(this.timeConfig);this.openTimeDt=t.openTimeDt;var e=Utils.TimerManager.getServerTime(!1),i=0,a=this.curOrder;if(e>t.openTimeDt&&e<=t.endTimeDt){var n=e-t.openTimeDt;(a=Math.ceil(n/(this.canAnswerTime+this.showCorrectAnswerTime)))<=0&&(a=1);var o=n%(this.canAnswerTime+this.showCorrectAnswerTime);if(0==o&&a++,o<=this.canAnswerTime){i=2;var r=this.canAnswerTime-o;this.bm_leftCanAnswerTime.text=Utils.TimerManager.getFormatBySecond1(r)}else i=3}else if(e<t.openTimeDt)i=1;else if(this.info.data.selfPlayer&&this.info.data.selfPlayer.isTargeted)i=1;else{var s=this.info.data.selfPlayer&&this.info.data.selfPlayer.rewards;i=s&&0<Object.keys(s).length?4:1}this.curStatus==i&&a==this.curOrder||(this.curStatus=i,this.curOrder=a,this.updateView())},T.prototype.updateVisible=function(t){switch(this.lb_answerDone.visible=!1,this.lb_question.visible=!1,this.lb_questionId.visible=!1,this.lb_answerCanGetReward.visible=!1,this.gp_rewardGp.visible=!1,this.gp_answers.visible=!1,this.gp_openTime.visible=!1,this.gp_curTime.visible=!1,this.curStatus){case 1:this.lb_answerDone.visible=!0,this.lb_answerDone.text="未开始",this.lb_answerCanGetReward.visible=!0,this.lb_answerResult.visible=!0,this.lb_answerResult.text="欢迎各位同学",this.gp_openTime.visible=!0;break;case 2:case 3:this.gp_answers.visible=!0,this.lb_question.visible=!0,this.lb_questionId.visible=!0,this.gp_curTime.visible=!0;break;case 4:this.lb_answerDone.visible=!0,this.lb_answerDone.text="交卷完成",this.lb_answerResult.visible=!0,this.lb_answerResult.text="领取奖励吧",this.gp_rewardGp.visible=!0}},T.prototype.updateQuestion=function(t){var e=_.Config.zoneQuoraConfig()[t];e?this.lb_question.textFlow=(new egret.HtmlTextParser).parse(e.question):this.lb_question.text="找不到题目配置"},T.prototype.updateAnswers=function(t,e,i){void 0===i&&(i=-1);var a=_.Config.zoneQuoraConfig()[t];if(a){for(var n=JSON.parse(a.answer),o=0;o<4;o++){var r=n[o],s=!!r;e?this.updateAnswer(o,o+1==a.correct,r,s,i==o+1):this.updateAnswer(o,void 0,r,s,i==o+1)}e?this.lastChoseId==a.correct?this.lb_answerResult.text="非常棒，回答正确！":this.lb_answerResult.text="遗憾，回答错误！":this.lb_answerResult.text="请回答下列题目"}else for(o=0;o<4;o++)this.updateAnswer(o,void 0,"",!1)},T.prototype.updateAnswer=function(t,e,i,a,n){void 0===i&&(i=""),void 0===a&&(a=!0),void 0===n&&(n=!1);var o=this.answerGp[t];if(o){var r=o.$children[1],s=o.$children[2],c=o.$children[3];s&&(s.text=this.num2letter[t]+". "+i),c.visible=n,0==a?(o.parent.removeChild(o),o.visible=!1):null==e?(o.visible=!0,r.visible=!1):(o.visible=!0,r.visible=!0,r.source=e?"jsjhd_img_gou_png":"jsjhd_img_cha_png")}},T.prototype.updateRewards=function(){var t=this.info;t&&t.data&&(JSON.parse(t.content),t.data.selfPlayer.isTargeted?_.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.RECEIVED):_.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.AVAILABLE),this.gp_rewards.removeChildren(),_.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t.data.selfPlayer.rewards))},T.prototype.updateRank=function(){var i=this;_.GameMVC.rankPy.GetRankList({rankType:RankingType.RankingTypeNewZoneActivityQuora,refreshInterval:35},function(t){var e=t.ranks;0==e.length?(i.img_noRank.visible=!0,i.list_rank.dataProvider=new eui.ArrayCollection):(e.sort(_.GeneralConfig.simpleSort("rank")),i.img_noRank.visible=!1,i.list_rank.dataProvider=new eui.ArrayCollection(e))})},T.firstName="",T.oldGrade="",T);function T(){var t=A.call(this)||this;return t.lastChoseId=-1,t.num2letter=["A","B","C","D","E"],t.canAnswerTimer=0,t.openTimeDt=0,t.showCorrectAnswerTime=2,t.curOrder=-1,t.canAnswerTime=0,t.curStatus=0,t.curQuora=void 0,t.answerGp=[],t.skinName="Activity186",t}_.Activity186=t;var e,n=(e=eui.ItemRenderer,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.data&&(this.lb_rank.textFlow=[{text:"第",style:{textColor:16777215}},{text:""+this.data.rank,style:{textColor:6531583}},{text:"名",style:{textColor:16777215}}],this.lb_name.textFlow=[{text:this.data.playerBaseInfo.name,style:{textColor:16751149}},{text:"("+this.data.playerBaseInfo.serverId+"服)",style:{textColor:16777215}}],this.lb_key.textFlow=[{text:""+this.data.key,style:{textColor:6618944}},{text:"积分",style:{textColor:16777215}}])},i);function i(){var t=e.call(this)||this;return t.params=void 0,t.skinName="Activity186Item",t}_.Activity186Item=n}(game=game||{}),function(a){var n,t=(n=a.ActivityCommonPanel,__extends(i,n),i.prototype.childrenCreated=function(){var d=this;n.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=d.et_phone.text;if(!/^1[3456789]\d{9}$/.test(e))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;var i=d.et_name.text;if(""!=i){var a=d.et_cerNum.text;if(!/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(a))return Utils.MsgUtils.addMidMsg("身份证号格式不符合规则，请重填"),!1;var t=d.et_cerCode.text;if(""==t)return Utils.MsgUtils.addMidMsg("请填写验证码"),!1;var n=window.xyxPlatform||window.h5FlaSDK&&window.h5FlaSDK.urlKV&&window.h5FlaSDK.urlKV.login_ext,o="h5",r=Utils.DeviceUtils.getPlatform();4==r?o="ios":5==r&&(o="android");var s=0,c=0;n&&(s=n.pid||n._pid||0,c=n.gid||n._gid||0),Utils.Http.getByUrl(Utils.agentConfig.HttpUnitServer+"/sms_VerificationApi.php"+Utils.Http.decorateParams({pid:s,gid:c,mobile:e,code:t,type:"certification",tm:(new Date).getTime(),client:o},!0,egret.HttpMethod.GET)).then(function(t){0==t.success?d.getReward({code:d.code,id:1,num:1,info:JSON.stringify({name:i,phone:e,IdentificationNumber:a,AgentName:Utils.agentConfig.AgentName})}):Utils.MsgUtils.addMidMsg("验证码错误")})}else Utils.MsgUtils.addMidMsg("请输入名字")},this),this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=d.et_phone.text;if(!/^1[3456789]\d{9}$/.test(t))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;i.lastSendTime=Utils.TimerManager.getServerTime(),d.updateTime(),Utils.SDKMgr.cmd({type:"sendCertificateCode",phone:t,cb:function(t){t&&200==t.code||Utils.MsgUtils.addMidMsg("发送失败")}})},this)},i.prototype.updateView=function(t){n.prototype.updateView.call(this,t);var e=this.info;if(e.data.isTargeted)this.hide();else{var i=JSON.parse(e.content);this.gp_rewards.removeChildren(),a.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i[0],.7),this.updateTime()}},i.prototype.updateTime=function(){var t=this;if(this.timer&&egret.clearInterval(this.timer),this.btn_send.touchEnabled=!1,i.lastSendTime){var e=30-(Utils.TimerManager.getServerTime()-i.lastSendTime);0<e?(this.btn_send.label=e+"",this.timer=egret.setInterval(function(){t.btn_send.label=--e+"",e<=0&&(i.lastSendTime=0,t.updateTime())},this,1e3)):(i.lastSendTime=0,this.updateTime())}else this.btn_send.label="发送验证码",this.btn_send.touchEnabled=!0},i.lastSendTime=0,i);function i(){var t=n.call(this)||this;return t.skinName="Activity194",t.code=EActivityType.CertificationReward,t}a.Activity194=t}(game=game||{}),function(i){var t,e=(t=i.ActivityCommonListView,__extends(a,t),a.prototype.getDataList=function(){var o=this,r=[],t=this.info;if(!t||!t.data)return r;var s=t.data.targeted,e=JSON.parse(t.content),c=i.GameMVC.playerPy.playerInfoVO.level;return e.forEach(function(t,e){for(var i in t){t[i];var a="",n=REWARD_STATUS.UNAVAILABLE;switch(e){case 0:a="新手注册礼包",n=REWARD_STATUS.AVAILABLE;break;case 1:a="专属"+t[2]+"级礼包",c>=t[2]&&(n=REWARD_STATUS.AVAILABLE);break;case 2:a="每日活跃礼包",n=REWARD_STATUS.AVAILABLE}0<=s.indexOf(t[0])&&(n=REWARD_STATUS.RECEIVED),r.push({id:t[0],rewards:t[1],title:a,type:e,status:n,tip:2==e?c+"/"+t[2]:"",btnFunc:function(t){switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("等级不足");break;case REWARD_STATUS.AVAILABLE:o.getReward({id:t.id,type:o.code,num:0});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}})}}),r},a);function a(){return null!==t&&t.apply(this,arguments)||this}i.Activity208=e}(game=game||{}),function(i){var t,e=(t=i.ActivityCommonListView,__extends(a,t),a.prototype.getDataList=function(){var r=this,s=[],t=this.info;if(!t||!t.data)return s;var c=t.data.targeted,e=JSON.parse(t.content),d=i.GameMVC.playerPy.playerInfoVO.level;return e.forEach(function(e,i){for(var t in e){e[t];var a="",n=REWARD_STATUS.UNAVAILABLE;switch(i){case 0:a="新手注册礼包",n=REWARD_STATUS.AVAILABLE;break;case 1:a="专属"+e[2]+"级礼包",d>=e[2]&&(n=REWARD_STATUS.AVAILABLE);break;case 2:var o=getUrlKV().blueVip;1==e[2]?(a="蓝钻每日活跃礼包",o&&o.is_blue_vip&&(n=REWARD_STATUS.AVAILABLE)):2==e[2]?(a="豪华蓝钻每日活跃礼包",o&&o.is_super_blue_vip&&(n=REWARD_STATUS.AVAILABLE)):3==e[2]&&(a="年费蓝钻每日活跃礼包",o&&o.is_blue_year_vip&&(n=REWARD_STATUS.AVAILABLE))}0<=c.indexOf(e[0])&&(n=REWARD_STATUS.RECEIVED),s.push({id:e[0],rewards:e[1],title:a,type:i,status:n,tip:2==i?d+"/"+e[2]:"",btnFunc:function(t){switch(t.status){case REWARD_STATUS.UNAVAILABLE:2==i?Utils.MsgUtils.addMidMsg("等级不足"):3==i&&(1==e[2]?Utils.MsgUtils.addMidMsg("蓝钻用户可领取"):2==e[2]?Utils.MsgUtils.addMidMsg("豪华蓝钻用户可领取"):Utils.MsgUtils.addMidMsg("年费蓝钻用户可领取"));break;case REWARD_STATUS.AVAILABLE:r.getReward({id:t.id,type:r.code,num:0});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}})}}),s},a);function a(){return null!==t&&t.apply(this,arguments)||this}i.Activity209=e}(game=game||{}),function(l){var p,t=(p=l.ActivityCommonPanel,__extends(e,p),e.prototype.childrenCreated=function(){var s=this;p.prototype.childrenCreated.call(this),this.lb_getWay.text='完成任务后请到 "'+(Utils.agentConfig.isChecking.GZGZH_TEM||"")+'" 领取该红包',this.list_root.itemRenderer=m,this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(s.info.data&&0<s.info.data.totalMoney)if(s.info.data.phoneNum&&""!=s.info.data.phoneNum){var t=0,e=0,i="",a=window.xyxPlatform;a&&(t=a._pid||0,e=a._gid||0,i=window.urlKV&&window.urlKV.token||getUrlKV().token);var n=window.h5FlaSDK;n&&(t=n.urlKV.login_ext&&n.urlKV.login_ext.pid||0,e=n.urlKV.login_ext&&n.urlKV.login_ext.gid||0,i=n.urlKV.token),i&&t&&e?l.GameMVC.activityPy.DoCommonOperation(s.code,1,2,function(){},0,JSON.stringify({pid:t,gid:e,access_token:i,activity_id:s.code,partner_data:{mobile:s.info.data.phoneNum,server_id:l.GameMVC.loginPy.serverSelect.s_id,role_id:l.GameMVC.playerPy.playerInfoVO.playerId},remark:"remark",tm:Math.floor((new Date).getTime()/1e3)})):Utils.MsgUtils.addMidMsg("token错误")}else Utils.SDKMgr.isSH()?PopUpManager.addPopUp({obj:new g}):PopUpManager.addPopUp({obj:new u});else Utils.MsgUtils.addMidMsg("无可提取金额")},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.hide()},this),this.lb_rule.textFlow=[{text:"活动规则",style:{underline:!0}}],this.lb_hasGet.textFlow=[{text:"领奖记录",style:{underline:!0}}],this.lb_rule.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=s.info;if(t&&t.data){var e=JSON.parse(t.content);l.GameMVC.activityMed.showHelpDialog(e[2])}},this),this.lb_hasGet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=s.info;if(t&&t.data){for(var e=JSON.parse(t.content),i=0,a=0;a<e[0].length;a++){var n=e[0][a],o=n[0],r=n[2];0<=c.indexOf(o)&&(i+=r)}Utils.MsgUtils.addMidMsg("已提现"+(i-t.data.totalMoney)/100+"元")}},this);var t=this.info;if(t&&t.data){for(var e=JSON.parse(t.content),c=t.data.targeted,i=[],a=[],n=0;n<e[0].length;n++){var o=e[0][n],r=o[0],d=(o[1],o[2]),h=o[3];a.push({id:r,targeted:c,money:d,desc:o[4]}),i.push({activity_id:this.code,task_id:r,task_type:h==TaskSubType.LevelUpTeam?3:2,task_desc:o[4],task_state:0<=c.indexOf(r)?2:1,amt:d})}this.list_root.dataProvider=new eui.ArrayCollection(a);try{Utils.SDKMgr.cmd({type:"redbag_submit",data:i})}catch(t){console.error(t)}}},e.prototype.updateView=function(t){p.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content);this.lb_tip.text="金额达到"+i[1]/100+"元可提现，当前可提现金额"+e.data.totalMoney/100+"元"}},e.domain_name="api.kunyufun.com",e);function e(){var t=p.call(this)||this;t.skinName="Activity210",t.code=EActivityType.PlayerRedBag;return 0<=["wechat","wechat_bh_sh","wechat_bh_sh2","wechat_bh_sh3","wechat_bh_sh4","wechat_bh_sh7","wechat_bh_sh8"].indexOf(Utils.agentConfig.AgentCode)&&(l.Activity210.domain_name="api.icefoxgame.com"),t}l.Activity210=t;var a,u=(a=l.ActivityCommonPanel,__extends(n,a),n.prototype.childrenCreated=function(){var i=this;a.prototype.childrenCreated.call(this),this.uid=l.GameMVC.loginPy.userVO.sdkUuid;var t=window.xyxPlatform;t&&(this.pid=t._pid,this.gid=t._gid);var e=window.h5FlaSDK;e&&(this.pid=e.urlKV.login_ext.pid,this.gid=e.urlKV.login_ext.gid),this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.et_phone.text;if(!/^1[3456789]\d{9}$/.test(e))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;i.uid?i.topost("https://"+l.Activity210.domain_name+"/api/v1/redMobile/isBind",{openid:i.uid,mobile:e,tm:Math.floor((new Date).getTime()/1e3)},egret.HttpMethod.POST,function(t){t&&200==t.code?i.sendCode(i.uid,e):Utils.MsgUtils.addMidMsg(t.msg)}):Utils.MsgUtils.addMidMsg("未找到玩家id")},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.et_phone.text;if(!/^1[3456789]\d{9}$/.test(e))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;var t=i.et_cerNum.text;if(!t)return Utils.MsgUtils.addMidMsg("请输入验证码"),!1;i.uid?(Utils.DeviceUtils.getPlatform(),i.topost("https://"+l.Activity210.domain_name+"/api/v1/verify/code",{pid:i.pid,gid:i.gid,mobile:e,code:t,type:"certification",tm:Math.floor((new Date).getTime()/1e3),client:"h5"},egret.HttpMethod.POST,function(t){t&&200==t.code?i.bind_phone(e):Utils.MsgUtils.addMidMsg(t.msg)})):Utils.MsgUtils.addMidMsg("未找到玩家id")},this)},n.prototype.sendCode=function(t,e){if(30<Utils.TimerManager.getServerTime()-n.lastSendTime){n.lastSendTime=Utils.TimerManager.getServerTime();var i=Utils.DeviceUtils.getPlatform();this.topost("https://"+l.Activity210.domain_name+"/api/v1/send/code",{pid:this.pid,gid:this.gid,mid:1e4,mobile:e,type:"certification",tm:Math.floor((new Date).getTime()/1e3),device_id:i,client:"h5"},egret.HttpMethod.POST,function(t){t&&200==t.code?Utils.MsgUtils.addMidMsg("发送成功"):Utils.MsgUtils.addMidMsg(t.msg)})}else Utils.MsgUtils.addMidMsg("发送频繁,请于"+(60-(Utils.TimerManager.getServerTime()-n.lastSendTime))+"秒后重试")},n.prototype.bind_phone=function(e){var i=this;this.topost("https://"+l.Activity210.domain_name+"/api/v1/redMobile/bind",{openid:this.uid,mobile:e,tm:Math.floor((new Date).getTime()/1e3)},egret.HttpMethod.POST,function(t){t&&200==t.code?(Utils.MsgUtils.addMidMsg("绑定成功"),i.getReward({code:i.code,id:1,num:1,info:e},function(){i.hide()})):Utils.MsgUtils.addMidMsg(t.msg)})},n.prototype.decorateParams=function(t){var e="",i=1,a=Object.keys(t).sort();for(var n in a)e=1==i?e+"?"+a[n]+"="+t[a[n]]:e+"&"+a[n]+"="+t[a[n]],i++;var o="";return o="?"==e.charAt(0)?e.substring(1):e,o+="&",egret.log("strMd5",o),e+"&sign="+(new flamd5).hex_md5(o).toLowerCase()},n.prototype.topost=function(t,e,i,a){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget;try{console.log(JSON.parse(e.response)),a&&a(JSON.parse(e.response))}catch(t){egret.warn(t)}},this),n.open(t+this.decorateParams(e),i),n.send()},n.lastSendTime=0,n);function n(){var t=a.call(this)||this;return t.uid="",t.pid=0,t.gid=0,t.skinName="Activity210CertificatePanelSkin",t.code=EActivityType.PlayerRedBag,t}var i,g=(i=l.ActivityCommonPanel,__extends(o,i),o.prototype.childrenCreated=function(){var a=this;i.prototype.childrenCreated.call(this),this.uid=l.GameMVC.loginPy.userVO.sdkUuid;var t=window.xyxPlatform;t&&(this.pid=t._pid,this.gid=t._gid);var e=window.h5FlaSDK;e&&(this.pid=e.urlKV.login_ext.pid,this.gid=e.urlKV.login_ext.gid),this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=a.et_phone.text;if(!/^1[3456789]\d{9}$/.test(i))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;a.uid?Utils.SDKMgr.cmd({type:"isBindPhone"},function(t,e){"SUCCESS"==e.ret?Utils.MsgUtils.addMidMsg("当前已实名，可直接绑定"):a.sendCode(a.uid,i)}):Utils.MsgUtils.addMidMsg("未找到玩家id")},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=a.et_phone.text;if(!/^1[3456789]\d{9}$/.test(i))return Utils.MsgUtils.addMidMsg("手机号码格式不符合规则，请重填"),!1;var t=a.et_cerNum.text;if(!t)return Utils.MsgUtils.addMidMsg("请输入验证码"),!1;a.uid?(Utils.DeviceUtils.getPlatform(),Utils.SDKMgr.cmd({type:"bindPhone",data:{phone:i,code:t}},function(t,e){"SUCCESS"==e.ret?(Utils.MsgUtils.addMidMsg("绑定成功"),a.getReward({code:a.code,id:1,num:1,info:i},function(){a.hide()})):Utils.MsgUtils.addMidMsg("绑定失败")})):Utils.MsgUtils.addMidMsg("未找到玩家id")},this)},o.prototype.sendCode=function(t,i){var a=this;30<Utils.TimerManager.getServerTime()-o.lastSendTime?(o.lastSendTime=Utils.TimerManager.getServerTime(),Utils.DeviceUtils.getPlatform(),Utils.SDKMgr.cmd({type:"getPhoneCode",data:{phone:i}},function(t,e){"SUCCESS"==e.ret?(Utils.MsgUtils.addMidMsg("发送成功"),a.sendCode(a.uid,i)):Utils.MsgUtils.addMidMsg("发送失败")})):Utils.MsgUtils.addMidMsg("发送频繁,请于"+(60-(Utils.TimerManager.getServerTime()-o.lastSendTime))+"秒后重试")},o.prototype.decorateParams=function(t){var e="",i=1,a=Object.keys(t).sort();for(var n in a)e=1==i?e+"?"+a[n]+"="+t[a[n]]:e+"&"+a[n]+"="+t[a[n]],i++;var o="";return o="?"==e.charAt(0)?e.substring(1):e,o+="&",egret.log("strMd5",o),e+"&sign="+(new flamd5).hex_md5(o).toLowerCase()},o.prototype.topost=function(t,e,i,a){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.once(egret.Event.COMPLETE,function(t){var e=t.currentTarget;try{console.log(JSON.parse(e.response)),a&&a(JSON.parse(e.response))}catch(t){egret.warn(t)}},this),n.open(t+this.decorateParams(e),i),n.send()},o.lastSendTime=0,o);function o(){var t=i.call(this)||this;return t.uid="",t.pid=0,t.gid=0,t.skinName="Activity210CertificatePanelSkin",t.code=EActivityType.PlayerRedBag,t}var r,m=(r=eui.ItemRenderer,__extends(s,r),s.prototype.dataChanged=function(){var t=this.data.targeted,e=this.data.id;this.lb_price.text=this.data.money/100+"元",this.lb_desc.text=""+this.data.desc,0<=t.indexOf(e)?(this.btn_status.label="",this.btn_status.skinName="skins.ButtonSkinGreen",this.btn_status.label="已完成"):(this.btn_status.label="",this.btn_status.skinName="skins.ButtonSkinRed",this.btn_status.label="未完成")},s);function s(){var t=r.call(this)||this;return t.skinName="Activity210Item",t}}(game=game||{}),function(c){var i,t=(i=c.ActivityCommonView,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var t=0;t<12;++t){var e=this["img_"+t];this.rotaPosArr.push({x:e.x,y:e.y})}this.activateComponent()},e.prototype.updateView=function(t){i.prototype.updateView.call(this,t),this.gp_rechargeRotate.visible=!1,this.gp_treasureHunter.visible=!1,this.isRechargeRotate()?(this.gp_rechargeRotate.visible=!0,this.img_bg.source="newactivity_img_zpdt_png",this.img_title.source="newactivity_img_lczp_png",this.updateRechargeRotate()):(this.gp_treasureHunter.visible=!0,this.img_bg.source="xydb_img_ditu_png",this.img_title.source="",this.updateTreasureHunter()),this.timer||(this.remainingDt=c.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateTreasureHunter=function(){var t=this;if(this.isFirst){this.isFirst=!1;var e=this.info.content[0],i=e[0][0],a=e[1][0];this.btn_1.updateData({source:"xydb_btn_anniushang_png",text:"1次",cost:i}),this.btn_10.updateData({source:"xydb_btn_anniuxia_png",text:"10次",cost:a}),this.sl_record.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=s,this.lb_welcome_tip.text=this.welcomeText[this.welId],this.welcomeTimer=egret.setInterval(function(){t.welId=(t.welId+1)%3,t.lb_welcome_tip.text=t.welcomeText[t.welId]},this,1e4)}this.showRecords(),this.updateMidView()},e.prototype.updateRechargeRotate=function(){this.isFirst&&(this.isFirst=!1);var t=this.info;this.blb_rr_reTime.text=t.data.times;var e=t.content[0],i=t.data.amounts,a=0;for(var n in e){var o=e[n];if(i<o[0]){a=o[0];break}}(a=a||e[e.length-1][0])<i&&(i=a),this.pb_rr.maximum=a,this.pb_rr.value=i,this.blb_rr_progress.text=i+"/"+a,this.updateMidView()},e.prototype.showRecords=function(){var t=this.info.data.records,e=[];if(this.gp_empty.visible=t.length<=0,0<t.length)for(var i=0,a=t;i<a.length;i++){var n=a[i],o={rewards:n.rewards,userName:n.name,dt:n.dt,activityCode:this.code};e.push(o)}0<e.length&&(e.sort(function(t,e){return 0<=t.dt-e.dt?-1:1}),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(e):this.list_item.dataProvider=new eui.ArrayCollection(e))},e.prototype.updateMidView=function(){var t=this.info.data.targeted,e=this.info.content[1];for(var i in e){var a=this["img_"+i],n=e[i];if(this.isRechargeRotate()){var o={id:n[0],reward:n[2][0],type:n[2][0][3],targeted:0<=t.indexOf(n[0])};a.updateData(o)}else o={reward:n[1][0],type:n[3],id:n[0]},a.updateData(o)}},e.prototype.updateRemainingTime=function(){var t=this.isRechargeRotate()?this.blb_rr_time:this.blb_time;0<this.remainingDt?t.text=""+Utils.TimerManager.getFormatBySecond2(this.remainingDt--):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},e.prototype.isRechargeRotate=function(){return 0<=[EActivityType.RechargeRotate,EActivityType.RechargeRotate1].indexOf(this.code)},e.prototype.hunter=function(c){var d=this;this.touched=!0,this.selectBtn=c||1,this.btn_1.btn_btn.touchEnabled=!1,this.btn_10.btn_btn.touchEnabled=!1,Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:c}).then(function(t){var e=JSON.parse(t.info);if(2==c){for(var i=e.rewardShow,a={1:1,4:1,7:1,10:1},n=i[i.length-1],o=0,r=i;o<r.length;o++){var s=r[o];if(a[s]){n=s;break}}d.target=n+12-d.movPos}else d.target=e.rewardShow[0]+(12-d.movPos);d.hunterRotation(t)})},e.prototype.hunterRotation=function(t){var e=this;this.rotaPosArr[this.movPos],this.moveCircle({count:0,doneCB:function(){e.touched=!1,e.info&&e.info.updateData(t.info),t.clientReward&&c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(t.clientReward,{onCloseCB:function(){e.btn_1.btn_btn.touchEnabled=!0,e.btn_10.btn_btn.touchEnabled=!0,egret.Tween.get(e.gp_move).to({alpha:0},20)}})}})},e.prototype.moveCircle=function(t){var e=this,i=this.movPos,a=this.rotaPosArr[i].x,n=this.rotaPosArr[i].y,o=t&&t.duration||60,r=t&&t.count||0,s=t&&t.doneCB;this.gp_move.alpha=1,r>=12*this.CIRCLENUM*this.selectBtn+this.target?egret.Tween.get(this.gp_move).wait(50).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).wait(20).call(function(){s&&s()}):(egret.Tween.get(this.gp_move).to({x:a,y:n},o,egret.Ease.circOut).call(function(){++i,++r>=12*e.CIRCLENUM*e.selectBtn&&(o+=2),r<12*e.CIRCLENUM*e.selectBtn+e.target&&(e.movPos=i%12),e.moveCircle({count:r,duration:o,doneCB:s})}),this.tailMoving(i,o,r))},e.prototype.tailMoving=function(t,o,r){function e(t,e,i,a){var n=a||0;egret.Tween.get(t).to({x:e,y:i},o,egret.Ease.circOut).call(function(){r>=12*s.CIRCLENUM*s.selectBtn+s.target-1&&egret.Tween.get(t).to({alpha:0},50+n)})}var s=this,i=(t-1+12)%12,a=(t-2+12)%12,n=this.rotaPosArr[i].x,c=this.rotaPosArr[i].y,d=this.rotaPosArr[a].x,h=this.rotaPosArr[a].y;this.gp_move0.alpha=1,e(this.gp_move0,n,c),this.gp_move1.alpha=1,e(this.gp_move1,d,h,50)},e.prototype.activateComponent=function(){var n=this;Utils.ComponentUtils.registerListener(this.btn_rr_oprt,egret.TouchEvent.TOUCH_TAP,function(){n.touched||(0<n.info.data.times?n.hunter():12==n.info.data.targeted.length?Utils.MsgUtils.addMidMsg("已获得所有奖励"):c.GameMgr.getInstance().showCommonTipsWin({commonTips:"累充达到目标可获得抽奖次数",btnStyle:{cancel:c.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:c.CommonTipsDialog.BTN_STYLE.RECHARGE},clickCB:function(t){1==t.type&&c.AppFacade.getInstance().showSubView(c.RechargeMediator.N,c.RechargeMediator.SV.MAIN,{viewType:c.RechargeView.VIEW_TYPE.RECHARGE})}}))},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content[0][0][0];if(!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough([t],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(1)}},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content[0][1][0];if(!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough([t],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(2)}},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[2],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new c.HelpDialog({text:e})})},this),Utils.ComponentUtils.registerListener(this.btn_rr_record,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l({records:n.info.data.records})})},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.welcomeTimer&&egret.clearInterval(this.welcomeTimer)},e.isInit=!0,e);function e(){var t=i.call(this)||this;return t.movPos=0,t.target=0,t.selectBtn=1,t.touched=!1,t.CIRCLENUM=1,t.rotaPosArr=[],t.isFirst=!0,t.welId=0,t.welcomeText={0:"欢迎各位勇士前来夺宝！",1:"祝大家好运连连，惊喜不断！",2:"嘿嘿！我这有很多宝贝！你想要吗？"},t.skinName="ActivityTreasureHunterSkin",t}c.ActivityTreasureHunter=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.updateData=function(t){var e=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),i=t.reward,a=i[1],n=(i[2],e.getInfoByCode(a).info);this.img_bg.source=this.bg_map[t.type],this.lb_desc.text=""+n.name;var o=customui.BaseItemFactory.create(21);o.updateData({type:i[0],code:i[1],num:i[2]}),o.scaleX=.75,o.scaleY=.75,this.gp_items.addChild(o),null!=t.targeted&&UIActionManager.setAbsGrey(this,t.targeted),this.gp_effect.removeChildren(),t&&t.type&&DragonBoneTools.create("common_tswpguang",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2-20,t.animation.play(),this.gp_effect.addChild(t)},this)},o);function o(){var t=a.call(this)||this;return t.bg_map={0:"xydb_img_gezi1_png",1:"xydb_img_gezi2_png",2:"xydb_img_gezi3_png"},t.skinName="TreasureItemSkin",t}c.TreasureItem=n;var r,s=(r=eui.ItemRenderer,__extends(d,r),d.prototype.dataChanged=function(){var t=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),e=this.data.rewards&&this.data.rewards[0],i=e&&e.code,a=e&&e.num,n=t.getInfoByCode(i).info,o=this.data.userName,r=n&&n.name,s=(c.AppFacade.getInstance().retrieveProxy(c.ActivityPy.N),n&&n.color||2);o&&r?(this.lb_userName.text=o,this.lb_record.text=r+"x"+a):(this.lb_userName.text=this.data.record,this.lb_lb.text="",this.lb_record.text=""),this.lb_record.textColor=COLOR_2_FONT_COLOR[s],this.lb_userName.x=0,this.lb_lb.x=this.lb_userName.width,this.lb_record.x=this.lb_lb.x+this.lb_lb.width},d);function d(){var t=r.call(this)||this;return t.colorMap={0:1083089,1:8397989},t.skinName="RecordItemSkin",t}c.LableItemRender=s;var h,l=(h=BasePanel,__extends(p,h),p.prototype.childrenCreated=function(){h.prototype.childrenCreated.call(this),this.scl_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=s,this.data&&this.updateView()},p.prototype.updateView=function(){var t=this.data.records;if(0<t.length){this.gp_empty.visible=!1;var i=[];t.forEach(function(t){var e={rewards:t.rewards,userName:t.name,dt:t.dt};i.push(e)}),this.list_item.dataProvider=new eui.ArrayCollection(i)}else this.gp_empty.visible=!0},p);function p(t){var e=h.call(this)||this;return e.skinName="ActivityTreasureHunterRecordPanelSkin",e.data=t,e}c.ActivityTreasureHunterRecordPanel=l}(game=game||{}),function(o){var i,t=(i=o.ActivityCommonView,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var t=0;t<12;++t){var e=this["img_"+t];this.rotaPosArr.push({x:e.x,y:e.y})}this.activateComponent()},e.prototype.updateView=function(t){i.prototype.updateView.call(this,t),this.gp_rechargeRotate.visible=!1,this.gp_treasureHunter.visible=!1,this.isRechargeRotate()?(this.gp_rechargeRotate.visible=!0,this.img_bg.source="tqhd_img_ditu_png",this.img_title.source="newactivity_img_lczp_png",this.updateRechargeRotate()):(this.gp_treasureHunter.visible=!0,this.img_bg.source="fnj_img_xingyunnvshenditu_png",this.img_title.source="",this.updateTreasureHunter()),this.timer||(this.remainingDt=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateTreasureHunter=function(){var t=this;if(this.isFirst){this.isFirst=!1;var e=this.info.content[0],i=e[0][0],a=e[1][0];this.btn_1.updateData({source:"fnj_btn_choujiang1_png",text:"1次",cost:i}),this.btn_10.updateData({source:"fnj_btn_choujiang2_png",text:"10次",cost:a}),this.sl_record.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=o.LableItemRender,this.lb_welcome_tip.text=this.welcomeText[this.welId],this.welcomeTimer=egret.setInterval(function(){t.welId=(t.welId+1)%2,t.lb_welcome_tip.text=t.welcomeText[t.welId]},this,1e4)}this.showRecords(),this.updateMidView()},e.prototype.updateRechargeRotate=function(){this.isFirst&&(this.isFirst=!1);var t=this.info;this.blb_rr_reTime.text=t.data.times;var e=t.content[0],i=t.data.amounts,a=0;for(var n in e){var o=e[n];if(i<o[0]){a=o[0];break}}(a=a||e[e.length-1][0])<i&&(i=a),this.pb_rr.maximum=a,this.pb_rr.value=i,this.blb_rr_progress.text=i+"/"+a,this.updateMidView()},e.prototype.showRecords=function(){var t=this.info.data.records,e=[];if(this.gp_empty.visible=t.length<=0,0<t.length)for(var i=0,a=t;i<a.length;i++){var n=a[i],o={rewards:n.rewards,userName:n.name,dt:n.dt,activityCode:this.code};e.push(o)}0<e.length&&(e.sort(function(t,e){return 0<=t.dt-e.dt?-1:1}),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(e):this.list_item.dataProvider=new eui.ArrayCollection(e))},e.prototype.updateMidView=function(){var t=this.info.data.targeted,e=this.info.content[1];for(var i in e){var a=this["img_"+i],n=e[i];if(this.isRechargeRotate()){var o={id:n[0],reward:n[2][0],type:n[2][0][3],targeted:0<=t.indexOf(n[0])};a.updateData(o)}else o={reward:n[1][0],type:n[3],id:n[0]},a.updateData(o)}},e.prototype.updateRemainingTime=function(){var t=this.isRechargeRotate()?this.blb_rr_time:this.blb_time;0<this.remainingDt?t.text=""+Utils.TimerManager.getFormatBySecond2(this.remainingDt--):o.AppFacade.getInstance().hideSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAIN)},e.prototype.isRechargeRotate=function(){return 0<=[EActivityType.RechargeRotate,EActivityType.RechargeRotate1,EActivityType.RechargeRotate2].indexOf(this.code)},e.prototype.hunter=function(c){var d=this;this.touched=!0,this.selectBtn=c||1,this.btn_1.btn_btn.touchEnabled=!1,this.btn_10.btn_btn.touchEnabled=!1,Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:c}).then(function(t){var e=JSON.parse(t.info);if(2==c){for(var i=e.rewardShow,a={1:1,4:1,7:1,10:1},n=i[i.length-1],o=0,r=i;o<r.length;o++){var s=r[o];if(a[s]){n=s;break}}d.target=n+12-d.movPos}else d.target=e.rewardShow[0]+(12-d.movPos);d.hunterRotation(t)})},e.prototype.hunterRotation=function(t){var e=this;this.rotaPosArr[this.movPos],this.moveCircle({count:0,doneCB:function(){e.touched=!1,e.info&&e.info.updateData(t.info),t.clientReward&&o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientReward(t.clientReward,{onCloseCB:function(){e.btn_1.btn_btn.touchEnabled=!0,e.btn_10.btn_btn.touchEnabled=!0,egret.Tween.get(e.gp_move).to({alpha:0},20)}})}})},e.prototype.moveCircle=function(t){var e=this,i=this.movPos,a=this.rotaPosArr[i].x,n=this.rotaPosArr[i].y,o=t&&t.duration||60,r=t&&t.count||0,s=t&&t.doneCB;this.gp_move.alpha=1,r>=12*this.CIRCLENUM*this.selectBtn+this.target?egret.Tween.get(this.gp_move).wait(50).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).wait(20).call(function(){s&&s()}):(egret.Tween.get(this.gp_move).to({x:a,y:n},o,egret.Ease.circOut).call(function(){++i,++r>=12*e.CIRCLENUM*e.selectBtn&&(o+=2),r<12*e.CIRCLENUM*e.selectBtn+e.target&&(e.movPos=i%12),e.moveCircle({count:r,duration:o,doneCB:s})}),this.tailMoving(i,o,r))},e.prototype.tailMoving=function(t,o,r){function e(t,e,i,a){var n=a||0;egret.Tween.get(t).to({x:e,y:i},o,egret.Ease.circOut).call(function(){r>=12*s.CIRCLENUM*s.selectBtn+s.target-1&&egret.Tween.get(t).to({alpha:0},50+n)})}var s=this,i=(t-1+12)%12,a=(t-2+12)%12,n=this.rotaPosArr[i].x,c=this.rotaPosArr[i].y,d=this.rotaPosArr[a].x,h=this.rotaPosArr[a].y;this.gp_move0.alpha=1,e(this.gp_move0,n,c),this.gp_move1.alpha=1,e(this.gp_move1,d,h,50)},e.prototype.activateComponent=function(){var n=this;Utils.ComponentUtils.registerListener(this.btn_rr_oprt,egret.TouchEvent.TOUCH_TAP,function(){n.touched||(0<n.info.data.times?n.hunter():12==n.info.data.targeted.length?Utils.MsgUtils.addMidMsg("已获得所有奖励"):o.GameMgr.getInstance().showCommonTipsWin({commonTips:"累充达到目标可获得抽奖次数",btnStyle:{cancel:o.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:o.CommonTipsDialog.BTN_STYLE.RECHARGE},clickCB:function(t){1==t.type&&o.AppFacade.getInstance().showSubView(o.RechargeMediator.N,o.RechargeMediator.SV.MAIN,{viewType:o.RechargeView.VIEW_TYPE.RECHARGE})}}))},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content[0][0][0];if(!o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough([t],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(1)}},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content[0][1][0];if(!o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough([t],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(2)}},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[2],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new o.HelpDialog({text:e})})},this),Utils.ComponentUtils.registerListener(this.btn_rr_record,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.ActivityTreasureHunterRecordPanel({records:n.info.data.records})})},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.welcomeTimer&&egret.clearInterval(this.welcomeTimer)},e.isInit=!0,e);function e(){var t=i.call(this)||this;return t.movPos=0,t.target=0,t.selectBtn=1,t.touched=!1,t.CIRCLENUM=1,t.rotaPosArr=[],t.isFirst=!0,t.welId=0,t.welcomeText={0:"欢迎各位勇士前来夺宝！",1:"幸运女神庇佑你，祝各位夺宝成功！"},t.skinName="Activity275Skin",t}o.Activity2127=t;var a,n=(a=o.TreasureItem,__extends(r,a),r.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.img_top=new eui.Image("tqhd_img_gezizhuangshi_png"),this.addChild(this.img_top),this.img_top.horizontalCenter=this.img_top.verticalCenter=0,this.img_top.pixelHitTest=!0},r.prototype.updateData=function(t){a.prototype.updateData.call(this,t),1==t.type?this.img_top.visible=!0:this.img_top.visible=!1},r);function r(){var t=a.call(this)||this;return t.bg_map={0:"tqhd_img_gezi01_png",1:"tqhd_img_gezi02_png",2:"tqhd_img_gezi02_png"},t.skinName="TreasureItemSkin",t}o.Activity275Item=n}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonRechargeListView,__extends(a,e),a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list_itemList.itemRenderer=o},a);function a(){return null!==e&&e.apply(this,arguments)||this}t.Activity280=i;var n,o=(n=t.ActivityCommonListItem,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.img_discount_line=new eui.Image("newactivity_img_xiexian_png"),this.addChild(this.img_discount_line),this.img_discount_line.left=23,this.img_discount_line.top=11,this.lb_title2=new eui.Label,this.addChild(this.lb_title2),this.lb_title2.left=152,this.lb_title2.top=16,this.lb_title2.size=22},r.prototype.dataChanged=function(){n.prototype.dataChanged.call(this),this.data.discount&&this.data.oriPrice&&this.img_discount_line&&this.lb_title2?(this.img_discount_line.visible=!0,this.lb_title2.visible=!0,this.lb_title2.text=this.lb_title.text.replace("礼包",""),this.lb_title.text=""+this.data.oriPrice+Utils.SDKMgr.globalIAPSuffix+"礼包"):(this.img_discount_line.visible=!1,this.lb_title2.visible=!1)},r);function r(){return null!==n&&n.apply(this,arguments)||this}}(game=game||{}),function(o){var e,t=(e=o.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){var n=this;e.prototype.childrenCreated.call(this),DragonBoneTools.create("zhujiemian_ar",function(t){t.x=50+this.gp_player.width/2,t.y=100+this.gp_player.height/2,t.scaleX=t.scaleY=1.2,t.animation.play("zhujiemian_ar_daiji2"),this.gp_player.addChild(t)},this),this.baseitem_chose0.touchEnabled=!1,this.baseitem_chose1.touchEnabled=!1,this.baseitem_chose2.touchEnabled=!1,this.baseitem_chose3.touchEnabled=!1,UIActionManager.fadeBlink(this.img_jiahao0,!0,!1,1e3),UIActionManager.fadeBlink(this.img_jiahao1,!0,!1,1e3),UIActionManager.fadeBlink(this.img_jiahao2,!0,!1,1e3),UIActionManager.fadeBlink(this.img_jiahao3,!0,!1,1e3),this.btn_sp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.selectedUuids_1.length<2)Utils.MsgUtils.addMidMsg("所需金色职业套装装备不足");else{var i={};n.selectedUuids_1.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1});var t=[];for(var e in i)t.push({uuid:e,num:i[e]});n.btn_sp.touchEnabled=!1,n.btn_cz.touchEnabled=!1,n.btn_1.touchEnabled=!1,n.btn_2.touchEnabled=!1,o.GameMVC.heroThingPy.HeroEquipImprove({costList:t,type:1,beforeCB:function(t){DragonBoneTools.playOnce({effectName:"common_activity_zhishujie08",parent:n.gp_effect_0,x:n.gp_effect_0.width/2,y:n.gp_effect_0.height/2,scaleX:1,scaleY:1,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_spcg",parent:n.gp_effect_1,x:n.gp_effect_1.width/2,y:n.gp_effect_1.height/2,scaleX:1,scaleY:1,doneCB:function(){t(),n.initChoose(),n.updateView()}})}})},cb:function(){}})}},this),this.btn_cz.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.selectedUuids_2.length<1||n.selectedUuids_3.length<1)Utils.MsgUtils.addMidMsg("所需条件不足");else{var i={};n.selectedUuids_2.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1}),n.selectedUuids_3.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1});var t=[];for(var e in i)t.push({uuid:e,num:i[e]});n.btn_sp.touchEnabled=!1,n.btn_cz.touchEnabled=!1,n.btn_1.touchEnabled=!1,n.btn_2.touchEnabled=!1,o.GameMVC.heroThingPy.HeroEquipImprove({costList:t,type:2,beforeCB:function(t,e){DragonBoneTools.playOnce({effectName:"common_activity_zhishujie09",parent:n.gp_effect_3,x:n.gp_effect_3.width/2,y:n.gp_effect_3.height/2,scaleX:1,scaleY:1,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_chongliancg",parent:n.gp_effect_4,x:n.gp_effect_4.width/2,y:n.gp_effect_4.height/2,scaleX:1,scaleY:1,doneCB:function(){t(),n.initChoose(),n.updateView()}})}})},cb:function(){}})}},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=n.nowType&&n.updateType(1)},this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2!=n.nowType&&n.updateType(2)},this),Utils.ComponentUtils.registerListener(this.gp_choose_0,egret.TouchEvent.TOUCH_TAP,function(){var t=o.GameMVC.heroThingPy.AllEquipInfo,e=!1;for(var i in t){var a=t[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar){e=!0;break}}e?PopUpManager.addPopUp({obj:new o.CommonChosePanel({getInfos:function(){var t={},e=o.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar)for(var n=a.num;0<n--;)t[i+"#"+n]={uuid:a.uuid,isLocked:!!a.heroUuid,entityType:EEntityType.EEntityTypeHeroEquip}}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return 2<=t.length},selectUuids:n.selectedUuids_1,title:"请选择装备",lockedTip:"穿戴中",uniNum:!0,source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(){n.updateChoose_1(),n.updateView()}}):Utils.MsgUtils.addMidMsg("所需金色职业套装装备不足")},this),Utils.ComponentUtils.registerListener(this.gp_choose_1,egret.TouchEvent.TOUCH_TAP,function(){var t=o.GameMVC.heroThingPy.AllEquipInfo,e=!1;for(var i in t){var a=t[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar){e=!0;break}}e?PopUpManager.addPopUp({obj:new o.CommonChosePanel({getInfos:function(){var t={},e=o.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar)for(var n=a.num;0<n--;)t[i+"#"+n]={uuid:a.uuid,isLocked:!!a.heroUuid,entityType:EEntityType.EEntityTypeHeroEquip}}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return 2<=t.length},selectUuids:n.selectedUuids_1,title:"请选择装备",lockedTip:"穿戴中",uniNum:!0,source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(){n.updateChoose_1(),n.updateView()}}):Utils.MsgUtils.addMidMsg("所需金色职业套装装备不足")},this),Utils.ComponentUtils.registerListener(this.gp_choose_2,egret.TouchEvent.TOUCH_TAP,function(){var t=o.GameMVC.heroThingPy.AllEquipInfo,e=!1;for(var i in t){var a=t[i];if(a.config.color==EColorType.EColorTypeDarkGold&&!a.isAltar){e=!0;break}}e?PopUpManager.addPopUp({obj:new o.CommonChosePanel({getInfos:function(){var t={},e=o.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==EColorType.EColorTypeDarkGold&&!a.isAltar)for(var n=a.num;0<n--;)t[i+"#"+n]={uuid:a.uuid,isLocked:!!a.heroUuid,entityType:EEntityType.EEntityTypeHeroEquip}}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return 1<=t.length},selectUuids:n.selectedUuids_2,title:"请选择装备",lockedTip:"穿戴中",uniNum:!0,source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(){n.updateChoose_2(),n.updateView()}}):Utils.MsgUtils.addMidMsg("所需暗金装备不足")},this),Utils.ComponentUtils.registerListener(this.gp_choose_3,egret.TouchEvent.TOUCH_TAP,function(){var t=o.GameMVC.heroThingPy.AllEquipInfo,e=!1;for(var i in t){var a=t[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar){e=!0;break}}e?PopUpManager.addPopUp({obj:new o.CommonChosePanel({getInfos:function(){var t={},e=o.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==EColorType.EColorTypeLegend&&2==a.config.kind&&!a.isAltar)for(var n=a.num;0<n--;)t[i+"#"+n]={uuid:a.uuid,isLocked:!!a.heroUuid,entityType:EEntityType.EEntityTypeHeroEquip}}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return 1<=t.length},selectUuids:n.selectedUuids_3,title:"请选择装备",lockedTip:"穿戴中",uniNum:!0,source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(){n.updateChoose_3(),n.updateView()}}):Utils.MsgUtils.addMidMsg("所需金色职业套装装备不足")},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=o.GameMVC.activityPy.allActivityData[EActivityType.HeroEquipImprovement],e=JSON.parse(t.content);o.GameMVC.activityMed.showHelpDialog(e[0])},this)},i.prototype.updateView=function(t){this.updateType(this.nowType),this.updateItemShow(),this.btn_sp.touchEnabled=!0,this.btn_cz.touchEnabled=!0,this.btn_1.touchEnabled=!0,this.btn_2.touchEnabled=!0},i.prototype.updateType=function(t){1==(this.nowType=t)?(this.gp_sp.visible=!0,this.gp_cz.visible=!1,this.btn_1.icon="ajsw_btn_shengpin_1_png",this.btn_2.icon="ajsw_btn_chonglian2_png",this.selectedUuids_2=[],this.selectedUuids_3=[],this.chooseList_2=[{equipUuid:"",num:0,code:0}],this.chooseList_3=[{equipUuid:"",num:0,code:0}],this.baseitem_chose2.reset(!0),this.baseitem_chose3.reset(!0)):(this.gp_sp.visible=!1,this.gp_cz.visible=!0,this.btn_1.icon="ajsw_btn_shengpin_2_png",this.btn_2.icon="ajsw_btn_chonglian1_png",this.selectedUuids_1=[],this.chooseList_1=[{equipUuid:"",num:0,code:0},{equipUuid:"",num:0,code:0}],this.baseitem_chose0.reset(!0),this.baseitem_chose1.reset(!0)),this.updateItemShow()},i.prototype.updateItemShow=function(){this.baseitem_chose0.visible=0!=this.chooseList_1[0].code,this.baseitem_chose1.visible=0!=this.chooseList_1[1].code,this.baseitem_chose2.visible=0!=this.chooseList_2[0].code,this.baseitem_chose3.visible=0!=this.chooseList_3[0].code;var t=o.GameMVC.heroThingPy.AllEquipInfo,e=!1,i=!1;for(var a in t)if((n=t[a]).config.color==EColorType.EColorTypeLegend&&2==n.config.kind){e=!0;break}for(var a in t){var n;if((n=t[a]).config.color==EColorType.EColorTypeDarkGold){i=!0;break}}this.img_jiahao0.visible=e,this.img_jiahao1.visible=e,this.img_jiahao2.visible=i,this.img_jiahao3.visible=e,this.baseitem_chose0.updateData({type:EEntityType.EEntityTypeHeroEquip,code:this.chooseList_1[0].code,num:this.chooseList_1[0].num}),this.baseitem_chose1.updateData({type:EEntityType.EEntityTypeHeroEquip,code:this.chooseList_1[1].code,num:this.chooseList_1[1].num}),this.baseitem_chose2.updateData({type:EEntityType.EEntityTypeHeroEquip,code:this.chooseList_2[0].code,num:this.chooseList_2[0].num}),this.baseitem_chose3.updateData({type:EEntityType.EEntityTypeHeroEquip,code:this.chooseList_3[0].code,num:this.chooseList_3[0].num})},i.prototype.initChoose=function(){for(var t in this.chooseList_1)this.chooseList_1[t].equipUuid="",this.chooseList_1[t].num=0,this.chooseList_1[t].code=0;for(var t in this.chooseList_2)this.chooseList_2[t].equipUuid="",this.chooseList_2[t].num=0,this.chooseList_2[t].code=0;for(var t in this.chooseList_3)this.chooseList_3[t].equipUuid="",this.chooseList_3[t].num=0,this.chooseList_3[t].code=0;this.selectedUuids_1=[],this.selectedUuids_2=[],this.selectedUuids_3=[]},i.prototype.updateChoose_1=function(){for(var t in this.chooseList_1)this.chooseList_1[t].equipUuid="",this.chooseList_1[t].num=0,this.chooseList_1[t].code=0;var e=0;if(0<this.selectedUuids_1.length)for(var t in this.selectedUuids_1){var i=o.GameMVC.backpackPy.heroThingPy.AllEquipInfo,a=this.selectedUuids_1[t],n=i[a.split("#")[0]].config;e=Number(n.code),n?(this.chooseList_1[t].equipUuid=a,this.chooseList_1[t].num=1,this.chooseList_1[t].code=e):this.selectedUuids_1.splice(Number(t))}},i.prototype.updateChoose_2=function(){for(var t in this.chooseList_2)this.chooseList_2[t].equipUuid="",this.chooseList_2[t].num=0,this.chooseList_2[t].code=0;var e=0;if(0<this.selectedUuids_2.length)for(var t in this.selectedUuids_2){var i=o.GameMVC.backpackPy.heroThingPy.AllEquipInfo,a=this.selectedUuids_2[t],n=i[a.split("#")[0]].config;e=Number(n.code),n?(this.chooseList_2[t].equipUuid=a,this.chooseList_2[t].num=1,this.chooseList_2[t].code=e):this.selectedUuids_2.splice(Number(t))}},i.prototype.updateChoose_3=function(){for(var t in this.chooseList_3)this.chooseList_3[t].equipUuid="",this.chooseList_3[t].num=0,this.chooseList_3[t].code=0;var e=0;if(0<this.selectedUuids_3.length)for(var t in this.selectedUuids_3){var i=o.GameMVC.backpackPy.heroThingPy.AllEquipInfo,a=this.selectedUuids_3[t],n=i[a.split("#")[0]].config;e=Number(n.code),n?(this.chooseList_3[t].equipUuid=a,this.chooseList_3[t].num=1,this.chooseList_3[t].code=e):this.selectedUuids_3.splice(Number(t))}},i);function i(){var t=e.call(this)||this;return t.nowType=1,t.selectedUuids_1=[],t.selectedUuids_2=[],t.selectedUuids_3=[],t.chooseList_1=[{equipUuid:"",num:0,code:0},{equipUuid:"",num:0,code:0}],t.chooseList_2=[{equipUuid:"",num:0,code:0}],t.chooseList_3=[{equipUuid:"",num:0,code:0}],t.skinName="Activity289Skin",t}o.Activity289=t}(game=game||{}),function(m){var n,t=(n=m.ActivityCommonPanel,__extends(e,n),e.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.GameMVC.commonMed.showHelpDialog(MODULE.Activity+EActivityType.ClientTask)},this),this.initList(),this.updateView()},e.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_root.dataProvider=this.ac_items,this.list_root.itemRenderer=a},e.prototype.getDataList=function(){var c=this,t=this.info;if(!t||!t.data)return[];var d=[],h=this.info.content,l=t.data.targeted;l[0]||(l=[]);var p=t.data.keyList;function e(t){var e=h[t],i=e[0],a=g.getMax(e[1]),n=e[2],o=function(t){for(var e in p){var i=p[e];if(i.taskType==t)return u[t]=i.key,i.key}return 0}(i),r=REWARD_STATUS.UNAVAILABLE;a<=o&&(r=REWARD_STATUS.AVAILABLE),0<=l.indexOf(i)&&(r=REWARD_STATUS.RECEIVED);var s={id:i,key:a,cur:o,status:r,rewards:n,tips:o+"/"+a,btnText:r==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(r){case REWARD_STATUS.AVAILABLE:c.getReward({code:c.code,id:2,num:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:var e=window.xyxPlatform;e?e.share({activity290TaskType:i,fromPlayerId:m.GameMVC.playerPy.playerInfoVO.playerId},function(){}):Utils.MsgUtils.addMidMsg("不是小游戏平台")}},type:g.code==EActivityType.DoubleTwelve?1:e[7]};d.push(s)}this.code==EActivityType.DoubleTwelve&&(h=this.info.content[4]);var u={},g=this;for(var i in h)e(i);return d.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),d},e.prototype.getMax=function(t){return this.code,t%1e4},e.prototype.updateView=function(t){n.prototype.updateView.call(this,t);var e=[];e=this.getDataList();var i=[],a={};e.forEach(function(t){i.push(t),a[t.type]=a[t.type]||t.status==REWARD_STATUS.AVAILABLE}),this.ac_items.replaceAll(i)},e);function e(t){var e=n.call(this)||this;return e.skinName="Activity290Skin",e.params=t,e.code=t&&t.activityType||t&&t.code||e.code,e}m.Activity290=t;var i,a=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc()},this)},o.prototype.dataChanged=function(){var t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="分享",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;default:this.btn_operate.label="领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}var e=JSON.parse(t.rewards);this.gp_rewards.removeChildren(),m.GameMVC.activityMed.CommonGpAddReward(this.gp_rewards,e,.7),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate),this.pb_progress.maximum=this.data.key,this.pb_progress.value=this.data.cur},o);function o(){var t=i.call(this)||this;return t.skinName="Activity290ItemSkin",t}}(game=game||{}),function(C){var a,t=(a=C.ActivityCommonPanel,__extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.activateComponent(),this.heroModel.update({model:this.info.content[3],isStatic:!0});for(var t=0;t<5;t++){var e;if(e=this.gp_login.$children[t]){var i=new n;this.login_items.push(i),e.addChild(i)}(e=this.gp_box.$children[t])&&(i=new s,this.box_items.push(i),e.addChild(i))}},e.prototype.updateView=function(t){var a=this,e=this.info;if(e&&e.data){var i=e.content,n=e.data.backDt,o=new Date(1e3*n);o.setHours(0,0,0);for(var r=Math.floor(o.getTime()/1e3),s=e.data.vipLevel,c=0,d=0;d<i[1].length;d++)s>=(T=i[1][d])[0]&&(c=T[0]);s=c,this.gp_recharge.visible=!1,this.gp_login.visible=!1;var h=[];if(0==this.selectIndex){function l(e){switch(e.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("登录天数不足");break;case REWARD_STATUS.AVAILABLE:a.getReward({code:a.code,id:1,num:e.id});break;case REWARD_STATUS.CANBUY:C.GameMgr.getInstance().showCommonTipsWin({costTips:"补签",cost:e.costs,clickCB:function(t){t.type&&a.getReward({code:a.code,id:1,num:e.id})}});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}this.gp_login.visible=!0,this.img_bg.source="hgds_img_di3_png";var p=Utils.TimerManager.getServerTime(),u=Math.ceil((p-r)/86400),g=e.data.signIn;for(var m in i[1])if((T=i[1][m])[0]==s){var y=T[3];for(var v in T[1]){var f=T[1][v],_=REWARD_STATUS.UNAVAILABLE;f[0]<u?_=REWARD_STATUS.CANBUY:f[0]==u&&(_=REWARD_STATUS.AVAILABLE),0<=g.indexOf(f[0])&&(_=REWARD_STATUS.RECEIVED),h.push({id:f[0],costs:y,rewards:f[1],status:_,btnFunc:l})}}h.forEach(function(t,e){a.login_items[e]&&(a.login_items[e].data=t,a.login_items[e].dataChanged())})}else{this.gp_recharge.visible=!0,this.img_bg.source="hgds_img_di2_png",this.bm_amount.text=e.data.amount;var A=e.data.amount;for(var m in g=e.data.boxRecord,i[1]){var T;if((T=i[1][m])[0]==s)for(var v in T[2]){f=T[2][v];var b=REWARD_STATUS.UNAVAILABLE;A>=f[1]&&(b=REWARD_STATUS.AVAILABLE),0<=g.indexOf(f[0])&&(b=REWARD_STATUS.RECEIVED),h.push({id:f[0],key:f[1],rewards:f[2],status:b})}}this.img_line0.visible=!1,this.img_line1.visible=!1,this.img_line2.visible=!1,this.img_line3.visible=!1,h.forEach(function(t,e){if(a.box_items[e]&&(a.box_items[e].data=t,a.box_items[e].dataChanged(),t.status==REWARD_STATUS.AVAILABLE||t.status==REWARD_STATUS.RECEIVED)){var i=a["img_line"+(e-1)];i&&(i.visible=!0)}})}this.updateActivityTime(this.bm_time,!1)}},e.prototype.activateComponent=function(){var t=this;this.btn_login.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.selectIndex=0,t.btn_login.icon="hgds_btn_cfds01_png",t.btn_recharge.icon="hgds_btn_lcyj02_png",t.updateView()},this),this.btn_recharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.selectIndex=1,t.btn_login.icon="hgds_btn_cfds02_png",t.btn_recharge.icon="hgds_btn_lcyj01_png",t.updateView()},this),NoticeManager.addNoticeListenerAtParent(NT.ACTIVITY_REGRESS_LOGIN,this.btn_login,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.ACTIVITY_REGRESS_RECHARGE,this.btn_recharge,this,BTN_ICON_NOTICE_POS)},e);function e(){var t=a.call(this)||this;return t.login_items=[],t.box_items=[],t.selectIndex=0,t.skinName="Activity295Skin",t.code=EActivityType.Regression,"1"!=Utils.LocalStorageUtil.getItem("activity295")&&Utils.LocalStorageUtil.setItem("activity295","1"),t}C.Activity295=t;var i,n=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.status==REWARD_STATUS.UNAVAILABLE?t.baseitem.onClick():t.data.btnFunc&&t.data.btnFunc(t.data)},this)},o.prototype.dataChanged=function(){this.lb_day.text="第"+C.GeneralConfig.numToChinesNum(this.data.id)+"天",this.baseitem.updateData({reward:this.data.rewards[0]});var t=C.GeneralConfig.getEntityConfigByCode(this.data.rewards[0][0],this.data.rewards[0][1]);switch(this.lb_name.text=t.name,this.gp_effect.visible=!1,UIActionManager.setAbsGrey(this,!1),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_bg.source="hgds_img_kuang2_png",this.lb_name.textColor=this.lb_day.textColor=16773852;break;case REWARD_STATUS.CANBUY:this.img_bg.source="hgds_img_kuang2_png",this.lb_name.textColor=this.lb_day.textColor=16773852,UIActionManager.removeEffect(this.gp_effect),UIActionManager.addEffect(this.gp_effect,"common_activity_huiguihuodong_02",{offectY:0,offectX:0,scaleX:1,scaleY:1}),this.gp_effect.visible=!0;break;case REWARD_STATUS.AVAILABLE:this.img_bg.source="hgds_img_kuang1_png",this.lb_day.textColor=8537344,this.lb_name.textColor=8540192,UIActionManager.removeEffect(this.gp_effect),UIActionManager.addEffect(this.gp_effect,"common_activity_huiguihuodong_01",{offectY:0,offectX:0,scaleX:1,scaleY:1}),this.gp_effect.visible=!0;break;case REWARD_STATUS.RECEIVED:this.img_bg.source="hgds_img_kuang2_png",this.lb_name.textColor=this.lb_day.textColor=16773852,UIActionManager.setAbsGrey(this)}},o);function o(){var t=i.call(this)||this;return t.code=EActivityType.SecondSignIn,t.py=C.AppFacade.getInstance().retrieveProxy(C.ActivityPy.N),t.skinName="Activity295Item1Skin",t}var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(t.data.status){case REWARD_STATUS.UNAVAILABLE:C.GameMVC.commonMed.showSubView(C.CommonMediator.SV.REWARD_PANEL,{rewards:t.data.rewards,type:C.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN});break;case REWARD_STATUS.AVAILABLE:t.img_box.source="hgds_img_baoxiang2_png",t.img_box.visible=!0,t.gp_effect.visible=!1,DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:t,x:t.width/2,y:t.height/2,doneCB:function(){t.py.DoCommonOperation(t.code,t.data.id,2)}});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("奖励已领取")}t.data.btnFunc&&t.data.btnFunc(t.data)},this),UIActionManager.addEffect(this.gp_effect,"common_activity_huiguihuodong_03",{offectY:20})},c.prototype.dataChanged=function(){if(0!=this.data.key){switch(this.gp_effect.visible=!1,this.img_box.visible=!0,this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_box.source="hgds_img_baoxiang_png",UIActionManager.setGrey(this.img_box,!1);break;case REWARD_STATUS.AVAILABLE:this.gp_effect.visible=!0,this.img_box.visible=!1,UIActionManager.setGrey(this.img_box,!1);break;case REWARD_STATUS.RECEIVED:this.img_box.source="hgds_img_baoxiang2_png",UIActionManager.setGrey(this.img_box,!0)}this.bm_key.text=this.data.key+"元"}else this.visible=!1},c);function c(){var t=r.call(this)||this;return t.code=EActivityType.Regression,t.py=C.AppFacade.getInstance().retrieveProxy(C.ActivityPy.N),t.skinName="Activity295Item2Skin",t}}(game=game||{}),function(l){var _,t=(_=l.ActivityCommonFull,__extends(e,_),e.prototype.childrenCreated=function(){_.prototype.childrenCreated.call(this),this.list_itemList.dataProvider=this.dataProvider,this.list_itemList.itemRenderer=a,Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_top),this.activateComponent(),NoticeManager.addNoticeListener(NT.ALL_ACTIVITY[EActivityType.HonorOrderTask],this.btn_task,this,{percentX:129/162,percentY:-.125}),UIActionManager.addEffect(this.gp_effect_ryl,"common_activity_rongyaoling_01",{scaleX:1,scaleY:1})},e.prototype.updateView=function(t){var e=this;_.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=i.data.exp,n=i.data.level;this.lb_level.text=n+"";var o=i.data.wasBought,r=JSON.parse(i.content),s=0,c=[],d=-1,h=function(t){if(t)if(t.wasBought)switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("荣耀令等级不足");break;case REWARD_STATUS.AVAILABLE:e.getReward({code:e.code,id:2,num:t.id});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}else switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("荣耀令等级不足");break;case REWARD_STATUS.AVAILABLE:e.getReward({code:e.code,id:1,num:t.id});break;case REWARD_STATUS.RECEIVED:PopUpManager.addPopUp({obj:new A})}else Utils.MsgUtils.addMidMsg("没传data")}.bind(this);for(var l in this.hasOneToGet=!1,r[0]){var p=r[0][l],u=REWARD_STATUS.UNAVAILABLE,g=REWARD_STATUS.UNAVAILABLE;n>=p[0]&&(u=REWARD_STATUS.AVAILABLE,g=REWARD_STATUS.AVAILABLE),o?(0<=i.data.honorRecord.indexOf(p[0])&&(u=REWARD_STATUS.RECEIVED),0<=i.data.normalRecord.indexOf(p[0])&&(g=REWARD_STATUS.RECEIVED)):0<=i.data.normalRecord.indexOf(p[0])&&(u=REWARD_STATUS.RECEIVED),d<0&&(u==REWARD_STATUS.UNAVAILABLE||u==REWARD_STATUS.AVAILABLE)&&(d=parseInt(l)),p[0]==n+1&&(s=p[1]-a),u==REWARD_STATUS.AVAILABLE&&(this.hasOneToGet=!0);var m={id:p[0],rewards:p[2],rewards2:p[3],status:u,status2:g,wasBought:o,btnFunc:h};c.push(m)}this.dataProvider.replaceAll(c),this.bm_nextExp.text=0<s?s+"":"已满级";var y=s+(this.blb_count.text=a);this.blb_max.text="/"+y,this.img_di.width=Math.floor(a/y*350),o?(this.img_ryl.visible=!1,this.btn_buy.visible=!1,this.gp_effect_ryl.visible=!0):(this.img_ryl.visible=!0,UIActionManager.setGrey(this.img_ryl,!0),this.btn_buy.visible=!0,this.gp_effect_ryl.visible=!1),_.prototype.updateActivityTime.call(this,this.bm_time,!1);var v=125*d,f=125*r[0].length-5-this.sl_root.height;egret.setTimeout(function(){e.sl_root.viewport.scrollV=f<v?f:v,e.sl_root.viewport.scrollV<0&&(e.sl_root.viewport.scrollV=0)},this,200)}},e.prototype.activateComponent=function(){var s=this;this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new A})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=s.info;if(t&&t.data){var e=t.data.exp,i=t.data.level,a=JSON.parse(t.content),n=0;for(var o in a[0]){var r=a[0][o];r[0]==i+1&&(n=r[1]-e)}0<n?PopUpManager.addPopUp({obj:new c}):Utils.MsgUtils.addMidMsg("已满级")}},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showHelpDialog(s.info.content[3])},this),this.btn_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.HonorOrderTask)},this),this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.hasOneToGet?s.getReward({code:s.code,id:4,num:0}):Utils.MsgUtils.addMidMsg("当前无可领取的奖励")},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.hide()},this)},e);function e(){var t=_.call(this)||this;return t.hasOneToGet=!1,t.skinName="Activity303Skin",t.dataProvider=new eui.ArrayCollection,t}l.Activity303=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc(t.data)},this)},n.prototype.dataChanged=function(){if(i.prototype.dataChanged.call(this),this.lb_title.text=this.data.id,this.gp_rewards.removeChildren(),this.gp_rewards2.removeChildren(),l.GameMVC.activityMed.CommonGpAddReward2(this.gp_rewards,this.data.rewards,.8),l.GameMVC.activityMed.CommonGpAddReward2(this.gp_rewards2,this.data.rewards2,.8),this.data.wasBought)switch(this.data.status2==REWARD_STATUS.RECEIVED&&this.gp_rewards.$children.forEach(function(t){var e=new eui.Image("xyzp_img_yilingqu_png");e.horizontalCenter=e.verticalCenter=0,t.addChild(e)}),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="领 取",UIActionManager.setGrey(this.btn_operate,!0);break;case REWARD_STATUS.AVAILABLE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="领 取",UIActionManager.setGrey(this.btn_operate,!1);break;case REWARD_STATUS.RECEIVED:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已领取",UIActionManager.setGrey(this.btn_operate,!1),this.gp_rewards2.$children.forEach(function(t){var e=new eui.Image("xyzp_img_yilingqu_png");e.horizontalCenter=e.verticalCenter=0,t.addChild(e)})}else switch(this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="领 取",UIActionManager.setGrey(this.btn_operate,!0);break;case REWARD_STATUS.AVAILABLE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="领 取",UIActionManager.setGrey(this.btn_operate,!1);break;case REWARD_STATUS.RECEIVED:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="继续领取",UIActionManager.setGrey(this.btn_operate,!1),this.gp_rewards.$children.forEach(function(t){var e=new eui.Image("xyzp_img_yilingqu_png");e.horizontalCenter=e.verticalCenter=0,t.addChild(e)})}this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate)},n);function n(){var t=i.call(this)||this;return t.skinName="Activity303ItemSkin",t}var r,c=(r=l.ActivityCommonPanel,__extends(o,r),o.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.CommonResourceBar.updateBar([[1,1,1]]);var t=this.info.content;this.list_chosen.itemRenderer=d;var i=[];for(var a in t[1]){var n=t[1][a],o={exp:n[1],cost:n[2][0][2],chosen:!1};i.push(o)}this.list_chosen.dataProvider=this.dataprovider,this.dataprovider.replaceAll(i),this.list_chosen.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){e.curCode=t.itemIndex+1,e.curNum=0,e.updateView()},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=e.curNum?l.GameMgr.getInstance().showCommonTipsWin({costTips:"购买"+e.curAddExp+"经验",cost:[[1,1,e.curCost]],clickCB:function(t){t.type&&e.getReward({code:e.code,id:3,num:e.curCode,info:e.curNum+""},function(){e.hide()})}}):Utils.MsgUtils.addMidMsg("购买数量不能为零")},this),this.updateView()},o.prototype.updateView=function(){var s=this,c=this.info.content,t=this.info;if(t&&t.data){function e(t){var e=c[1][t];if(e[0]==h.curCode){var i=e[2][0],a=l.GameMVC.backpackPy.getInfoByCode(i[1]),n=Math.floor(a.haveNum/i[2]),o=Math.ceil(d/e[1]),r=n<o?n:o;return h.CommonBatchNum.update({minBuyNum:0,maxBuyNum:r,onUpdate:function(t,e){0==r&&3<=e?Utils.MsgUtils.addMidMsg("钻石不足"):(s.curNum=parseInt(t),s.updateLevelAndExp())}}),"break"}}var i=t.data.exp,d=(t.data.level,c[0][c[0].length-1][1]-i),h=this;for(var a in c[1])if("break"===e(a))break;this.CommonBatchNum.setValueTo(0),this.updateLevelAndExp();var n=this.dataprovider.source;n.forEach(function(t,e){n[e].chosen=e==s.curCode-1}),this.dataprovider.replaceAll(n)}},o.prototype.updateLevelAndExp=function(){var t=this.info;if(t&&t.data){var e=t.data.exp,i=t.data.level,a=JSON.parse(t.content),n=0;for(var o in a[0])(h=a[0][o])[0]==i&&h[1],h[0]==i+1&&(n=h[1]-e);if(n){this.lb_oldExp.text=t.data.exp+"";var r=0,s=0;for(var o in a[1])(h=a[1][o])[0]==this.curCode&&(r=h[1]*this.curNum,s=h[2][0][2]*this.curNum);this.curCost=s,this.curAddExp=r,this.bm_costs.text=s+"";var c=e+r,d=i;for(var o in a[0]){var h;c>=(h=a[0][o])[1]&&(d=h[0],h[1])}this.lb_oldLevel.text=i,(this.lb_newLevel.text=d)==a[0].length?this.lb_newExp.text="已满级":this.lb_newExp.text=t.data.exp+r+""}}},o);function o(){var t=r.call(this)||this;return t.curCode=1,t.curNum=0,t.curAddExp=0,t.curCost=0,t.dataprovider=new eui.ArrayCollection,t.skinName="Activity303BuyExpPanelSkin",t.code=EActivityType.HonorOrder,t}var s,d=(s=eui.ItemRenderer,__extends(h,s),h.prototype.dataChanged=function(){this.lb_exp.text=this.data.exp+"经验",this.lb_cost.text=this.data.cost,this.img_bg.source=this.data.chosen?"ryl_img_xuanze1_png":"ryl_img_xuanze2_png"},h);function h(){var t=s.call(this)||this;return t.skinName="Activity303BuyExpPanelItemSkin",t}var p,A=(p=l.ActivityCommonPanel,__extends(u,p),u.prototype.childrenCreated=function(){var t=this;p.prototype.childrenCreated.call(this);var e=this.info;if(e&&e.data){var i=e.content,a=e.data.level,n=[],o=[];for(var r in i[0]){var s=i[0][r];s[0]<=a?n=l.GeneralConfig.rewardsAdd(n,s[3]):o=l.GeneralConfig.rewardsAdd(o,s[3])}0==n.length?(this.img_title.source="ryl_txt_jsljkhd_png",this.sl_top.parent.removeChild(this.sl_top),this.gp_mid.parent.removeChild(this.gp_mid),this.sl_down.height=300):0==o.length?(this.img_title.source="ryl_txt_jsljhd_png",this.sl_top.height=300,this.gp_mid.parent.removeChild(this.gp_mid),this.sl_down.parent.removeChild(this.sl_down)):(this.img_title.source="ryl_txt_jsljhd_png",n.length<=4?this.sl_top.height=90:this.sl_top.height=200,o.length<=4?this.sl_down.height=90:this.sl_down.height=200),l.GameMVC.activityMed.CommonGpAddReward(this.gp_up,n),l.GameMVC.activityMed.CommonGpAddReward(this.gp_down,o);var c=i[2],d=l.GameMVC.rechargePy.getGoodInfo(c);this.btn_buy.label=d?d.price+"元":"商品Id错误",this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d?l.GameMVC.rechargePy.purchase(d,2,t.code+"",JSON.stringify({activityType:t.code,code:t.code}),{activityType:t.code,code:t.code},function(){t.hide()}):Utils.MsgUtils.addMidMsg("找不到商品信息")},this)}},u);function u(){var t=p.call(this)||this;return t.code=EActivityType.HonorOrder,t.skinName="Activity303RewardPreviewSkin",t}}(game=game||{}),function(c){var r,t=(r=c.ActivityCommonView,__extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo(MODULE.GloryArena)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info,e=JSON.parse(t.content);c.GameMVC.activityMed.showHelpDialog(e[1])},this)},e.prototype.updateView=function(t){var a=this;r.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var n=this.getConfig(),o=[];c.GameMVC.rankPy.GetRankList(RankingType.RankingTypeGloryArena,function(t){var e=0;if(t.selfRank&&t.selfRank.rank){e=t.selfRank.rank;for(var i=0;i<n.length;i++)if(e<n[i].rankSort){0==i||1==i||2==i?(o.push(n[1]),o.push(n[0])):(o.push(n[i-2]),o.push(n[i-3]));break}}else o.push(n[n.length-1]),o.push(n[n.length-2]);t.selfRank&&t.selfRank.rank?(a.updateGetRankShow(e),a.lb_rank.text=e+"",a.updateRankShow(o,e)):(a.gp_reward.removeChildren(),a.lb_rank.text="未上榜",a.updateRankShow(o,999999999))}),this.updateTimeAll(e.content[0])}},e.prototype.updateRankShow=function(t,e){for(var i=0;i<t.length;i++){var a=this["lb_"+i],n=this["gp_reward_"+i],o=this["img_"+i];n.removeChildren();var r=JSON.parse(t[i].rewards);c.GameMgr.getInstance().CommonGpAddReward(n,r,.65),a.text="达到"+t[i].rank+"名可获得奖励：",o.source=e<=t[i].rankSort?"rydf_img_yidacheng_png":"rydf_img_weidacheng_png"}},e.prototype.updateGetRankShow=function(t){for(var e=this.getConfig(),i=0;i<e.length;i++)if(t<e[i].rankSort){this.gp_reward.removeChildren();var a=void 0;a=0<i?JSON.parse(e[i-1].rewards):JSON.parse(e[0].rewards),c.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,a,.85);break}},e.prototype.getConfig=function(){var t=[],e=c.Config.rankingRewardByTypeConfig(RankingType.RankingTypeGloryRank);for(var i in e){var a=e[i],n={rankSort:a.rankUpper,rank:0<a.rankLower-a.rankUpper?9999<=a.rankLower?a.rankUpper+"-":a.rankUpper+"-"+a.rankLower:a.rankUpper,rewards:a.rewards};t.push(n)}return t.sort(function(t,e){return t.rankSort-e.rankSort}),t},e.prototype.updateTimeAll=function(t){var e=this,i=Utils.TimerManager.getServerTime(),a=c.ActivityConfig.getActivityEndDt(this.code),n=new Date(1e3*i);n.setHours(t[0],t[1],t[2]||0);var o=n.getTime()/1e3,r=a-i,s=o-i;this.lb_timeAll.text=""+Utils.TimerManager.getFormatBySecond1(r),this.lb_timeNow.text=""+Utils.TimerManager.getFormatBySecond1(s),this.timer&&egret.clearInterval(this.timer),this.timer1&&egret.clearInterval(this.timer1),this.timer=egret.setInterval(function(){0<=r--?e.lb_timeAll.text=""+Utils.TimerManager.getFormatBySecond1(r):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},this,1e3),this.timer1=egret.setInterval(function(){0<=s--?e.lb_timeNow.text=""+Utils.TimerManager.getFormatBySecond1(s):e.lb_timeNow.text="今日已结算"},this,1e3)},e);function e(){var t=r.call(this)||this;return t.skinName="Activity304Skin",t.code=EActivityType.GloryRank,t}c.Activity304=t}(game=game||{}),function(r){var s,t=(s=r.ActivityCommonTaskView,__extends(e,s),e.prototype.updateView=function(t){for(var e in s.prototype.updateView.call(this,t),ERaceTowerType){var i=ERaceTowerType[e],a=r.GameMVC.raceTowerPy.getInfoByType(i),n=a&&a.id-1||0;a&&a.pass&&n++;var o=this["lb_"+i];o&&(o.text=n+"层")}},e);function e(){var t=s.call(this)||this;return t.skinName="Activity305Skin",t}r.Activity305=t}(game=game||{}),function(a){var c,t=(c=a.ActivityCommonTaskListPanel,__extends(e,c),e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.list_items.itemRenderer=n,this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hasOneToGet?t.getReward({code:t.code,id:0}):Utils.MsgUtils.addMidMsg("当前无可领取的奖励")},this)},e.prototype.updateView=function(t){c.prototype.updateView.call(this,t);var e=a.GameMVC.activityPy.allActivityData[EActivityType.HonorOrder],i=Utils.MathUtils.formatNumStyle1(e.data.exp);this.blb_count.text=i+"",this.img_top.source="ryl_img_guanggaotu_png"},e.prototype.getDataList=function(){var e=this,t=c.prototype.getDataList.call(this),i=[],a={};for(var n in t.forEach(function(t){a[t.taskSubType]?a[t.taskSubType].push(t):a[t.taskSubType]=[t]}),a){var o=a[n];o.sort(function(t,e){return t.key-e.key});for(var r=o[0],s=0;s<o.length&&(r=o[s],o[s].status!=REWARD_STATUS.CANBUY&&o[s].status!=REWARD_STATUS.AVAILABLE);s++);i.push(r)}return this.hasOneToGet=!1,i.forEach(function(t){t.status==REWARD_STATUS.AVAILABLE&&(e.hasOneToGet=!0)}),c.prototype.commonSortDataList.call(this,i),i},e);function e(){var t=c.call(this)||this;return t.hasOneToGet=!1,t.skinName="Activity306Skin",t}a.Activity306=t;var i,n=(i=a.ActivityMidAutumnTaskPanel_TaskItem,__extends(o,i),o.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.data.taskSubType==TaskSubType.ActivityConsumeDiamond&&(this.lb_title.text="消费"+Utils.MathUtils.formatNumStyle1(this.data.key)+"钻石可领取",this.lb_progress.text=this.data.cur+"/"+Utils.MathUtils.formatNumStyle1(this.data.key))},o);function o(){var t=i.call(this)||this;return t.skinName="Activity306ItemSkin",t}}(game=game||{}),function(d){var r,t=(r=d.ActivityCommonView,__extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this),this.btn_jilu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o})},this),this.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.isEnough_1?i.effectByType(1):Utils.MsgUtils.addMidMsg("当前所需道具不足")},this),this.img_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.isEnough_10?i.effectByType(2):Utils.MsgUtils.addMidMsg("当前所需道具不足")},this),this.btn_shuoming.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info,e=JSON.parse(t.content);d.GameMVC.activityMed.showHelpDialog(e[3])},this),DragonBoneTools.create("common_activity_dabanben_01_1",function(t){this.gp_effect_1.removeChildren(),t.x=this.gp_effect_0.width/2,t.y=this.gp_effect_0.height/2,t.scaleX=t.scaleY=1,t.animation.play(),this.gp_effect_0.visible=!0,this.gp_effect_0.addChild(t)},this)},e.prototype.updateView=function(t){r.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content);for(var a in this.configList=i[1],this.gp_list.removeChildren(),i[1]){var n=new eui.Group;n.width=n.height=89.25;var o=customui.BaseItemFactory.create();n.addChild(o),this.gp_list.addChild(n),o.scaleX=o.scaleY=.85,o.updateData({reward:i[1][a][1][0]}),i[1][a][1][0][3]&&UIActionManager.addEffect(n,"common_jiban",{scaleX:1.2,scaleY:1.2})}this.updateCost_1(i[0][0],i[2][0]),this.updateCost_10(i[0][1],i[2][1]),this.updateRes(i[0],i[2]),this.updateTime()}},e.prototype.updateTime=function(){var t=this,e=Utils.TimerManager.getServerTime(),i=d.ActivityConfig.getActivityEndDt(this.code)-e;this.lb_timeAll.text=""+Utils.TimerManager.getFormatBySecond1(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?t.lb_timeAll.text=""+Utils.TimerManager.getFormatBySecond1(i):d.AppFacade.getInstance().hideSubView(d.ActivityMediator.N,d.ActivityMediator.SV.MAIN)},this,1e3)},e.prototype.updateCost_1=function(t,e){var i=void 0;if(i=d.GameMVC.backpackPy.getItemNumByCode(t[0][1])>=t[0][2]?t:e,this.gp_cost_1.removeChildren(),i&&i.length)for(var a=0;a<i.length;a++){var n=new customui.CommonIconWithNum({code:i[a][1],num:i[a][2],style:CommonIconStyle.RIGHT,showEnough:!1});n.scaleX=n.scaleY=1,this.gp_cost_1.addChild(n),this.isEnough_1=d.GameMVC.backpackPy.checkEnough(i)}else this.gp_cost_1.removeChildren()},e.prototype.updateCost_10=function(t,e){var i=void 0;if(i=d.GameMVC.backpackPy.getItemNumByCode(t[0][1])>=t[0][2]?t:e,this.gp_cost_10.removeChildren(),i&&i.length)for(var a=0;a<i.length;a++){var n=new customui.CommonIconWithNum({code:i[a][1],num:i[a][2],style:CommonIconStyle.RIGHT,showEnough:!1});n.scaleX=n.scaleY=1,this.gp_cost_10.addChild(n),this.isEnough_10=d.GameMVC.backpackPy.checkEnough(i)}else this.gp_cost_10.removeChildren()},e.prototype.updateRes=function(t,e){var i=[];i.push([t[0][0][0],t[0][0][1]]),this.resource_bar.updateBar({costs:i,width:170,gap:70,needAdd:!1})},e.prototype.effectByType=function(t){var c=this;this.img_1.touchEnabled=!1,this.img_10.touchEnabled=!1,egret.Tween.removeTweens(this.img_1),egret.Tween.removeTweens(this.img_10);var e=void 0;e=1==t?this.img_1:this.img_10,egret.Tween.get(e).to({rotation:90},500,egret.Ease.backOut).to({rotation:0},500,egret.Ease.backOut).call(function(){DragonBoneTools.playOnce({effectName:"common_activity_dabanben_01_2",parent:c.gp_effect_1,x:c.gp_effect_1.width/2,y:c.gp_effect_1.height/2,scaleX:1,scaleY:1,doneCB:function(){c.py.DoCommonOperation(c.code,t,0,function(e){DragonBoneTools.playOnce({effectName:"common_activity_dabanben_02",parent:c.gp_effect_2,x:c.gp_effect_2.width/2,y:c.gp_effect_2.height/2,scaleX:1,scaleY:1}),c.img_1.touchEnabled=!0,c.img_10.touchEnabled=!0;for(var t=[],i=0;i<e.clientReward.rewards.length;i++)t.push(e.clientReward.rewards[i]);var a=!1,n=new h,o=void 0;if(c.gp_result.removeChildren(),1<t.length)for(var r in o=t[0],t)for(var i in c.configList){var s=c.configList[i][1][0];if(t[r].type==s[0]&&t[r].code==s[1]&&c.configList[i][3]){o=t[r],a=!0;break}}else for(var i in o=t[0],c.configList)if(s=c.configList[i][1][0],t[0].type==s[0]&&t[0].code==s[1]&&c.configList[i][3]){a=!0;break}c.gp_result.addChild(n),n.gp_main.scaleX=n.gp_main.scaleY=0,n.updateData(o,a),egret.Tween.get(n.gp_main).to({scaleX:1.2,scaleY:1.2},400,egret.Ease.backOut).to({scaleX:1,scaleY:1},200,egret.Ease.backOut).wait(200).call(function(){c.gp_result.removeChildren(),d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:function(){var t=d.AppFacade.getInstance().retrieveProxy(d.ActivityPy.N);t.allActivityData[c.code]&&t.allActivityData[c.code].updateData(e.info)}})},c)})}})},this)},e);function e(){var t=r.call(this)||this;return t.isEnough_1=!1,t.isEnough_10=!1,t.py=d.AppFacade.getInstance().retrieveProxy(d.ActivityPy.N),t.configList=[],t.skinName="Activity307Skin",t.code=EActivityType.NewHuntTreasure,t}d.Activity307=t;var i,h=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},a.prototype.updateData=function(t,e){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.8,this.gp_item.addChild(i),i.updateData({reward:[t.type,t.code,0]}),i.img_bg.source=i.img_frame.source="",this.img_di0.source=e?"niudan_img_niudanh2_png":"niudan_img_niudanlv2_png",this.img_di1.source=e?"niudan_img_niudanh2di_png":"niudan_img_niudanlv2di_png"},a);function a(){var t=i.call(this)||this;return t.skinName="Activity307Item2Skin",t}d.Activity307Item2=h;var n,o=(n=BasePanel,__extends(s,n),s.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.updateInfo(),this.list_historyItem.itemRenderer=l},s.prototype.updateInfo=function(){var t=d.GameMVC.activityPy.allActivityData[EActivityType.NewHuntTreasure];if(!t||!t.data)return!1;var e=t.data.records;this.list_historyItem.dataProvider=new eui.ArrayCollection(e)},s);function s(){var t=n.call(this)||this;return t.skinName="Activity307LookSkin",t}d.Activity307LookPanel=o;var c,l=(c=eui.ItemRenderer,__extends(p,c),p.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this)},p.prototype.dataChanged=function(){this.data;var t=this.data.rewards[0],e=d.GameMVC.backpackPy.getInfoByTypeCodeNum(t.type,t.code);this.lb_text.textFlow=[{text:"恭喜",style:{textColor:16777215}},{text:this.data.name+"",style:{textColor:6347775}},{text:"获得了",style:{textColor:16777215}},{text:e.info.name+"",style:{textColor:6355204}},{text:"x"+t.num,style:{textColor:6355204}}]},p);function p(){var t=c.call(this)||this;return t.skinName="Activity307LookItemSkin",t}}(game=game||{}),function(t){var r,e=(r=t.ActivityCommonTaskView,__extends(i,r),i.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.bm_time.right=-63;var t=new eui.TabBar;t.itemRendererSkinName="TabBarItemSkin5",t.dataProvider=new eui.ArrayCollection([{up:"jjst_yeqian_yingxiongjijie2_png",down:"jjst_yeqian_yingxiongjijie1_png",text:"",scaleX:1},{up:"jjst_yeqian_shengwujijie2_png",down:"jjst_yeqian_shengwujijie1_png",text:"",scaleX:1},{up:"jjst_yeqian_zhuangbeijijie2_png",down:"jjst_yeqian_zhuangbeijijie1_png",text:"",scaleX:1}]),this.gp_title.addChild(t),t.left=0,t.bottom=-5,t.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){e.curIndex=t.itemIndex,e.updateView({activityType:e.code})},this);var i=new eui.HorizontalLayout;i.gap=-5,t.layout=i;for(var a=[120,265,420],n=0;n<3;n++){var o=new eui.Image("_main_m_json.common_img_hongdian");this.gp_title.addChild(o),o.x=a[n],o.y=220,this.noticeImg.push(o)}},i.prototype.getDataList=function(){var t=r.prototype.getDataList.call(this),e=0;switch(this.curIndex){case 0:e=TaskSubType.AltarHeroUnlock,this.img_title.source="newactivity_img_jjst1_png";break;case 1:e=TaskSubType.AltarArtifactUnlock,this.img_title.source="newactivity_img_jjst3_png";break;case 2:e=TaskSubType.AltarEquipUnlock,this.img_title.source="newactivity_img_jjst2_png"}var i=[];for(var a in this.noticeImg.forEach(function(t){t.visible=!1}),t){var n=t[a];n.taskSubType==e&&i.push(n),n.taskSubType==TaskSubType.AltarHeroUnlock&&n.status==REWARD_STATUS.AVAILABLE&&(this.noticeImg[0].visible=!0),n.taskSubType==TaskSubType.AltarArtifactUnlock&&n.status==REWARD_STATUS.AVAILABLE&&(this.noticeImg[1].visible=!0),n.taskSubType==TaskSubType.AltarEquipUnlock&&n.status==REWARD_STATUS.AVAILABLE&&(this.noticeImg[2].visible=!0)}return i},i);function i(){var t=null!==r&&r.apply(this,arguments)||this;return t.curIndex=0,t.noticeImg=[],t}t.Activity308=e}(game=game||{}),function(i){var a,t=(a=i.ActivityCommonView,__extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(t){a.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&a.prototype.updateActivityTime.call(this,this.bm_time,!1)},e.prototype.activateComponent=function(){this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i.GuajiGateListPanel({type:0}),closeCB:function(t){var e=i.AppFacade.getInstance().retrieveProxy(i.GuajiPy.N);t&&e.MiniTriggerEvent(Number(t),function(){i.MainJumpConfig.jumpTo("GUAJI")})}})},this)},e);function e(){var t=a.call(this)||this;return t.skinName="Activity319Skin",t}i.Activity319=t}(game=game||{}),function(p){var e,t=(e=p.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){var o=this;e.prototype.childrenCreated.call(this),this.list_cards.itemRenderer=n,this.list_cards.dataProvider=new eui.ArrayCollection,this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=p.GameMVC.activityPy.allActivityData[o.code];if(t&&t.data){var e=JSON.parse(t.content),i=(t.data.fMap,0);for(var a in t.data.fMap)0!=t.data.fMap[a]&&i++;var n="";n=i==e[0]?"是否确定重新开始一轮":"是否确定消耗"+e[4][0][2]+"钻石重新开始一轮",p.GameMgr.getInstance().showCommonTipsWin({commonTips:n,source:"activity321Refresh",cb:!0,clickCB:function(t){t&&1==t.type&&Utils.Socket.send("activity","DoCommonOperation",{code:o.code,id:3,num:0}).then(function(t){p.GameMVC.activityPy.updateData_View_Reward(o.code,t),o.updateView()})}})}},this),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("activity","DoCommonOperation",{code:o.code,id:2,num:0}).then(function(t){GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},o,1e4),p.GameMVC.activityPy.updateData_View_Reward(o.code,t),o.playEffect1()})},this),this.btn_rewardsPreview.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.GameMVC.activityMed.showHelpDialog(o.info.content[5])},this),this.updateView()},i.prototype.updateView=function(t){var e=this,i=p.GameMVC.activityPy.allActivityData[this.code];if(i&&i.data){var a=JSON.parse(i.content),n=i.data.fMap,o=[];i.data.inGame?(this.btn_begin.visible=!1,this.btn_refresh.horizontalCenter=0):((n=i.data.gameMapShow).sort(function(t,e){return t-e}),this.btn_begin.visible=!0,this.btn_refresh.horizontalCenter=-120);var r=[];for(var s in p.GameMVC.backpackPy.checkEnough(a[2],!1)?(r=a[2][0],this.CommonIconWithNum.updateItem({cost:a[2][0],style:CommonIconStyle.RIGHT})):(r=a[3][0],this.CommonIconWithNum.updateItem({cost:a[3][0],style:CommonIconStyle.RIGHT})),n){var c=n[s];if(0==c)o.push({index:s,code:0,cost:[r],updateView:function(){e.updateView()}});else for(var d in a[1]){var h=a[1][d];h[0]==c&&o.push({index:d,code:c,rewards:h[2],color:h[1],updateView:function(){e.updateView()}})}}this.list_cards.dataProvider.replaceAll(o);var l=0;for(var s in i.data.fMap)0!=i.data.fMap[s]&&l++;l==a[0]?this.btn_refresh.updateData({text:"免费重置"}):this.btn_refresh.updateData({cost:a[4][0],text:"重置"})}},i.prototype.playEffect1=function(){var t=this;for(var e in this.list_cards.$children){var i=this.list_cards.$children[e];i&&i.hideReward&&i.hideReward()}egret.setTimeout(function(){DragonBoneTools.playOnce({effectName:"common_activity_tongyong_fanpai",parent:t.gp_effect,loadFinishCB:function(){t.list_cards.visible=!1},doneCB:function(){t.updateView(),t.list_cards.visible=!0,GameRootLayer.gameLayer().switchTouchEnable(!0)},x:t.gp_effect.width/2,y:t.gp_effect.height/2})},this,500)},i);function i(){var t=e.call(this)||this;return t.skinName="Activity321Skin",t.code=EActivityType.TurnOverGame,t}p.Activity321=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.img_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==e.data.code&&(p.GameMVC.backpackPy.checkEnough(e.data.cost,!1)?p.GameMgr.getInstance().showCommonTipsWin({costTips:"翻牌",cost:e.data.cost,cb:!0,source:"activity321",btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&e.onTap()}}):Utils.MsgUtils.addMidMsg("货币不足"))},this)},o.prototype.dataChanged=function(){var t=p.GameMVC.activityPy.allActivityData[EActivityType.TurnOverGame];t&&t.data&&(JSON.parse(t.content),0==this.data.code?(this.baseitem.visible=!1,this.img_bg.source="qwfp_img_kapai2_png"):(this.baseitem.visible=!0,this.baseitem.updateData({reward:this.data.rewards[0]}),this.img_bg.source="qwfp_img_kapai1_png"))},o.prototype.onTap=function(){var e=this;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,1e4),Utils.Socket.send("activity","DoCommonOperation",{id:1,code:EActivityType.TurnOverGame,num:parseInt(this.data.index)+1}).then(function(t){0==JSON.parse(t.info).fMap[e.data.index]||(DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_01",x:e.width/2,y:e.height/2,doneCB:function(){DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_02_1",x:e.width/2,y:e.height/2}),DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_02_2",x:e.width/2,y:e.height/2,doneCB:function(){}})}}),egret.Tween.get(e).to({scaleX:0},200).call(function(){e.updateByData(t)},e).to({scaleX:1},200).wait(800).call(function(){p.GameMVC.activityPy.updateData_View_Reward(EActivityType.TurnOverGame,t),GameRootLayer.gameLayer().switchTouchEnable(!0)}))})},o.prototype.updateByData=function(t){var e=JSON.parse(t.info).fMap[this.data.index],i=p.GameMVC.activityPy.allActivityData[EActivityType.TurnOverGame],a=JSON.parse(i.content);for(var n in a[1]){var o=a[1][n];if(o[0]==e)return this.data.code=e,this.data.rewards=o[2],this.data.color=o[1],void this.dataChanged()}},o.prototype.hideReward=function(){var t=this;egret.Tween.get(this).to({scaleX:0},200).call(function(){t.img_bg.source="qwfp_img_kapai2_png",t.baseitem.visible=!1},this).to({scaleX:1},200).call(function(){})},o);function o(){var t=a.call(this)||this;return t.skinName="Activity321ItemSkin",t}var r,s=(r=p.ActivityCommonPanel,__extends(c,r),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.btn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=t.index&&(t.index=0,t.updateView())},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=t.index&&(t.index=1,t.updateView())},this),this.updateView()},c.prototype.updateView=function(){0==this.index?(this.img_bg0.source="zzhl_yeqian_dqjc1_png",this.img_bg1.source="zzhl_yeqian_zjc2_png",this.updateRewards1()):(this.img_bg0.source="zzhl_yeqian_dqjc2_png",this.img_bg1.source="zzhl_yeqian_zjc1_png",this.updateRewards2())},c.prototype.updateRewards1=function(){var t=this.info;if(t&&t.data){this.sl_root.viewport.scrollV=0;var e=t.data.gameMapShow,i=t.content,a={};for(var n in t.data.fMap)a[s=t.data.fMap[n]]?a[s]++:a[s]=1;for(var n in this.gp_rewards.removeChildren(),e.sort(function(t,e){return t-e}),e){var o=e[n];for(var r in i[1]){var s;if((s=i[1][r])[0]==o){var c=s[2][0],d=new eui.Group;d.width=d.height=84;var h=customui.BaseItemFactory.create();if(d.addChild(h),this.gp_rewards.addChild(d),h.scaleX=h.scaleY=.8,c[0]==EEntityType.EEntityTypeHeroArtifact||c[0]==EEntityType.EEntityTypeHeroEquip){var l={code:c[1],entityType:c[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};h.updateData({reward:c,vo:l})}else h.updateData({reward:c});if(c[3]?UIActionManager.addEffect(d,"common_jiban",{scaleX:.8/.7,scaleY:.8/.7}):UIActionManager.hideEffect(d),a[o]){UIActionManager.setGrey(h,!0);var p=new eui.Image("xyzp_img_yilingqu_png");d.addChild(p),p.horizontalCenter=p.verticalCenter=0}else UIActionManager.setGrey(h,!1);a[o]--}}}}},c.prototype.updateRewards2=function(){this.gp_rewards.removeChildren();var e=[];for(var t in this.info.content[6])this.info.content[6][t].forEach(function(t){e.push(t)});p.GameMVC.activityMed.CommonGpAddReward2(this.gp_rewards,e)},c);function c(){var t=r.call(this)||this;return t.index=0,t.skinName="Activity321RewardsView",t.code=EActivityType.TurnOverGame,t}}(game=game||{}),function(d){var h,t=(h=d.ActivityCommonView,__extends(e,h),e.prototype.childrenCreated=function(){var n=this;h.prototype.childrenCreated.call(this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info;if(t&&t.data){var e=JSON.parse(t.content),i=e[0][1],a=e[0][2];d.GameMVC.backpackPy.checkEnough(i,!1)||d.GameMVC.backpackPy.checkEnough(a,!1)?d.GameMVC.backpackPy.checkEnough(i,!1)?n.onBtnTap(1):d.GameMgr.getInstance().showCommonTipsWin({costTips:"砸1次蛋",cost:a,cb:!0,source:"activity322_1_"+n.curIndex,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&n.onBtnTap(1)}}):Utils.MsgUtils.addMidMsg("钻石不足")}},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info;if(t&&t.data){var e=JSON.parse(t.content),i=e[0][3],a=e[0][4];d.GameMVC.backpackPy.checkEnough(i,!1)||d.GameMVC.backpackPy.checkEnough(a,!1)?d.GameMVC.backpackPy.checkEnough(i,!1)?n.onBtnTap(10):d.GameMgr.getInstance().showCommonTipsWin({costTips:"砸10次蛋",cost:a,cb:!0,source:"activity322_10_"+n.curIndex,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&n.onBtnTap(10)}}):Utils.MsgUtils.addMidMsg("钻石不足")}},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.GameMVC.activityMed.showHelpDialog(n.info.content[2])},this),this.btn_rewards.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l})},this),this.gp_effect.visible=!1;var e=0;UIActionManager.addEffect(this.gp_effect,"common_activity_yuandanjie_09_2",{offectX:-10,offectY:30,multi:!0},function(t){n.effect00=t,n.effect00.animation.gotoAndStopByFrame("common_activity_yuandanjie_09_2",0),n.effect00.visible=!1,e++,n.gp_effect.visible=3==e}),UIActionManager.addEffect(this.gp_effect,"common_activity_yuandanjie_09",{offectX:-10,offectY:30,multi:!0},function(t){n.effect01=t,n.effect01.animation.gotoAndStopByFrame("common_activity_yuandanjie_09",0),n.effect01.visible=!1}),UIActionManager.addEffect(this.gp_effect,"common_activity_yuandanjie_10",{offectX:-10,offectY:30,multi:!0,childIndex:0},function(t){n.effect1=t,n.effect1.animation.play(),n.effect1.visible=0==n.curIndex,e++,n.gp_effect.visible=3==e}),UIActionManager.addEffect(this.gp_effect,"common_activity_yuandanjie_11",{offectX:-10,offectY:30,multi:!0,childIndex:0},function(t){n.effect2=t,n.effect2.animation.play(),n.effect2.visible=1==n.curIndex,e++,n.gp_effect.visible=3==e});var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),a=[];for(var o in i[0][0]){var r=i[0][0][o];for(var s in r[2]){var c=r[2][s];a.push(c)}}this.gp_rewards.removeChildren(),d.GameMVC.activityMed.CommonGpAddReward2(this.gp_rewards,a,.7)}},e.prototype.updateView=function(t){h.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=i[0][1],n=i[0][2],o=i[0][3],r=i[0][4];d.GameMVC.backpackPy.checkEnough(a,!1)?this.cost_1.updateItem({cost:a[0],style:CommonIconStyle.RIGHT}):this.cost_1.updateItem({cost:n[0],style:CommonIconStyle.RIGHT}),d.GameMVC.backpackPy.checkEnough(o,!1)?this.cost_10.updateItem({cost:o[0],style:CommonIconStyle.RIGHT}):this.cost_10.updateItem({cost:r[0],style:CommonIconStyle.RIGHT}),this.img_hammer.source=0==this.curIndex?"ydhd_img_chuizi2_png":"ydhd_img_chuizi_png",this.img_notice.visible=NoticeManager.isNoticeShow(NT.ALL_ACTIVITY[this.code])}},e.prototype.onBtnTap=function(t){var e=this,i=this.info;if(i&&i.data){var a=JSON.parse(i.content),n=a[0][1],o=a[0][2];if(10==t&&(n=a[0][3],o=a[0][4]),d.GameMVC.backpackPy.checkEnough(n,!1)||d.GameMVC.backpackPy.checkEnough(o,!1)){GameRootLayer.gameLayer().switchTouchEnable(!1),this.img_hammer.visible=!1;var r=0==this.curIndex?this.effect00:this.effect01,s=0==this.curIndex?"common_activity_yuandanjie_09_2":"common_activity_yuandanjie_09";r.animation.gotoAndPlayByFrame(s,0),r.visible=!0,this.effect1.visible=!1,this.effect2.visible=!1,egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),r.visible=!1,e.img_hammer.visible=!0,e.effect1&&(e.effect1.visible=0==e.curIndex),e.effect2&&(e.effect2.visible=1==e.curIndex),r.animation.gotoAndStopByFrame(s,0),e.callServer(t)},this,1e3)}else Utils.MsgUtils.addMidMsg("钻石不足")}},e.prototype.callServer=function(t){var i=this;void 0===t&&(t=1);var e=this.curIndex;Utils.Socket.send("activity","DoCommonOperation",{code:this.code,id:e+1,num:t}).then(function(t){var e=i.info;e&&e.data&&(d.GameMVC.activityPy.allActivityData[i.code].updateData(t.info),d.GameMVC.backpackPy.handleClientReward(t.clientReward,{closeCB:function(){}}))})},e);function e(){var t=h.call(this)||this;return t.curIndex=0,t.skinName="Activity322Skin",t.code=EActivityType.NewBreakEggs,t}d.Activity322=t;var i,l=(i=d.ActivityCommonTaskListPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateView(),this.rootPanel.blb_title.text="奖 励",this.updateTitle()},a.prototype.getDataList=function(){var a=this,t=this.info;if(!t||!t.data)return[];function e(t){var e=o[1][t],i=REWARD_STATUS.UNAVAILABLE;r>=e[1]&&(i=REWARD_STATUS.AVAILABLE),0<=s.indexOf(e[0])&&(i=REWARD_STATUS.RECEIVED),n.push({id:e[0],key:e[1],title:"砸蛋"+e[1]+"次",cur:r,status:i,rewards:e[2],tips:r+"/"+e[1],btnFunc:function(t){switch(i){case REWARD_STATUS.AVAILABLE:a.getReward({code:a.code,id:2,num:e[0]},function(){a.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("砸蛋次数不足")}}})}var n=[],o=this.info.content,r=t.data.times||0,s=t.data.targetRecord;for(var i in o[1])e(i);return n.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),n},a.prototype.updateTitle=function(){var t=d.Config.activityConfigs()[this.code];t&&(this.img_top.source=JSON.parse(t.img_title)[0]+"_png"),this.rootPanel.blb_title.text="奖 励"},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityMidAutumnTaskSkin",t.code=EActivityType.NewBreakEggs,t}}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity323Skin",t}t.Activity323=e}(game=game||{}),function(i){var a,t=(a=i.ActivityCommonView,__extends(e,a),e.prototype.onDestroy=function(){a.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),Utils.AssetsMgr.destroyGroup("group_signin")},e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.initList()},e.prototype.initList=function(){this.list_itemList.itemRenderer=o,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.getDataList=function(){for(var e=this,t=this.info,i=t.data.count||0,a=t.data.dayIndex||0,n=t.content,o=[],r=Utils.TimerManager.getServerTime(),s=new Date(1e3*r),c=(s.getFullYear(),s.getMonth()+1),d=s.getDate(),h=0;h<n[0].length;h++){var l=n[0][h];if(l[0]==c)for(var p=0;p<l[1].length;p++){var u=l[1][p][2],g=REWARD_STATUS.UNAVAILABLE;g=a<p?REWARD_STATUS.UNAVAILABLE:p<a?REWARD_STATUS.RECEIVED:1<=i?p<d?REWARD_STATUS.CANBUY:REWARD_STATUS.UNAVAILABLE:REWARD_STATUS.AVAILABLE;var m={num:p,dayIndex:p,rewards:u,costs:n[1],status:g,btnFunc:function(t){e.getReward({code:e.code,id:1,num:t.num+1})}};o.push(m)}}var y=this.getCount();return(o=o.slice(0,y)).sort(function(t,e){return t.num-e.num}),o},e.prototype.updateView=function(t){a.prototype.updateView.call(this,t),this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)},e.prototype.updateTitle=function(){var t=i.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code],t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.bm_time.text=""},e.prototype.getCount=function(){var t=Utils.TimerManager.getServerTime(),e=new Date(1e3*t),i=e.getFullYear(),a=e.getMonth()+1;return 0<=[1,3,5,7,8,10,12].indexOf(a)?31:0<=[4,6,9,11].indexOf(a)?30:i%4==0&&i%100!=0||i%400==0?29:28},e);function e(){var t=a.call(this)||this;return t.code=EActivityType.NewSignIn,Utils.AssetsMgr.loadGroup("group_signin"),t.skinName="ActivitySignInViewSkin",t}i.Activity333=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;this.baseItem=customui.BaseItemFactory.create(),this.gp_reward.addChild(this.baseItem),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(e.data.status){case REWARD_STATUS.UNAVAILABLE:PopUpManager.addPopUp({obj:new i.BaseItemDetailView({code:e.data.rewards[0][1],type:e.data.rewards[0][0]})});break;case REWARD_STATUS.AVAILABLE:e.data.btnFunc&&e.data.btnFunc(e.data);break;case REWARD_STATUS.CANBUY:i.GameMVC.backpackPy.checkEnough(e.data.costs)?i.GameMgr.getInstance().showCommonTipsWin({costTips:"补签",cost:JSON.stringify(e.data.costs),cb:!0,source:"Activity333",clickCB:function(t){1==t.type&&e.data.btnFunc&&e.data.btnFunc(e.data)}}):Utils.MsgUtils.addMidMsg("钻石不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("奖励已领取")}},this)},r.prototype.dataChanged=function(){switch(this.img_buqian.visible=!1,this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan01_png";break;case REWARD_STATUS.CANBUY:this.img_signed.visible=!1,this.img_buqian.visible=!0,this.img_bg.source="newactivity_img_dikuan03_png";break;case REWARD_STATUS.AVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan03_png";break;case REWARD_STATUS.RECEIVED:this.img_signed.visible=!0,this.img_bg.source="newactivity_img_dikuan02_png"}this.baseItem.reset(),this.baseItem.touchEnabled=!1,this.baseItem.scaleX=this.baseItem.scaleY=.933,this.baseItem.horizontalCenter=this.baseItem.verticalCenter=1,this.baseItem.updateData({reward:this.data.rewards[0]})},r);function r(){var t=n.call(this)||this;return t.skinName="ActivitySignInItemSkin",t}}(game=game||{}),function(p){var u,t=(u=p.ActivityCommonPanel,__extends(e,u),e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),this.once(egret.Event.ENTER_FRAME,function(){p.AppFacade.getInstance().sendNotification(CN.ACTIVITY_PUSH_GIFT_OPEN)},this)},e.prototype.childrenCreated=function(){var a=this;u.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.info;if(t&&t.data){a.uuid=a.data.uuid,a.data.code,a.data.gear;var e=a.data.goodsId;if(e){var i=p.GameMVC.rechargePy.getGoodInfo(e);i?p.GameMVC.rechargePy.purchase(i,2,String(a.uuid),JSON.stringify({uuid:a.uuid,activityType:a.code}),{uuid:a.uuid,activityType:a.code}):Utils.MsgUtils.addMidMsg("找不到商品配置")}else Utils.MsgUtils.addMidMsg("找不到商品id")}},this),this.heroModel.update({code:41070088,isStatic:!0}),this.btn_close.visible=!0,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide()},this)},e.prototype.updateView=function(t){var a=this;u.prototype.updateView.call(this,t);var e=t.idx||0,i=this.info;if(i&&i.data&&(t.uuid?this.data=p.GameMVC.activityPy.getPushGiftByUuid(t.uuid):this.data=p.GameMVC.activityPy.getPushGiftByIndex(e),this.data)){this.data.uuid;var n=this.data.code,o=(this.data.beginDt,this.data.endDt,this.data.gear),r=this.data.rewards,s=this.data.gearCode,c=p.Config.pushGiftBagGearConfig()[s],d=c?c.numDescribe:""+p.Config.constConfig().PushGiftBagNumDescribe.constValue;this.blb_value.text=d+"%";var h=p.Config.pushGiftBagConditionConfig()[n],l=h.describe&&""!=h.describe?h.describe:"未配置";this.lb_desc.text=l,this.gp_rewards.removeChildren(),Array.isArray(r)&&r.forEach(function(t,e){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.65,i.updateData({reward:t}),a.gp_rewards.addChild(i)}),this.btn_buy.label=""+o*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,this.updateTime()}},e.prototype.updateTime=function(){var t=this,e=this.data.endDt-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond1(e),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--e?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(e):t.hide()},this,1e3)},e);function e(){var t=u.call(this)||this;return t.data=void 0,t.uuid=void 0,t.skinName="Activity334Skin",t.code=EActivityType.NewPushGiftBag,t}p.Activity334=t;var l,i=(l=p.ActivityCommonPanel,__extends(a,l),a.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},a.prototype.childrenCreated=function(){var t=this;l.prototype.childrenCreated.call(this),this.heroModel.update({code:41070088,isStatic:!0}),this.btn_close.visible=!0,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.initList()},a.prototype.initList=function(){this.list_itemList.itemRenderer=o},a.prototype.updateView=function(t){var o=this;l.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var r=[];if(i.data&&i.data.gifts){function e(a){var n=i.data.gifts[a],t=p.Config.pushGiftBagConditionConfig()[n.code],e={code:n.code,beginDt:n.beginDt,gear:n.gear,gearCode:n.gearCode,goodsId:n.goodsId,rewards:n.rewards,endDt:n.beginDt+t.expire,uuid:a,btnFunc:function(){var t=n.goodsId,e=a;if(t){var i=p.GameMVC.rechargePy.getGoodInfo(t);i?p.GameMVC.rechargePy.purchase(i,2,String(e),JSON.stringify({uuid:e,activityType:o.code}),{uuid:e,activityType:o.code}):Utils.MsgUtils.addMidMsg("找不到商品配置")}else Utils.MsgUtils.addMidMsg("找不到商品id")}};r.push(e)}for(var a in i.data.gifts)e(a)}if(r.sort(function(t,e){return t.endDt-e.endDt}),this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(r):this.list_itemList.dataProvider=new eui.ArrayCollection(r),0<r.length){var n=r[0],s=p.Config.pushGiftBagGearConfig()[n.gearCode],c=s?s.numDescribe:""+p.Config.constConfig().PushGiftBagNumDescribe.constValue;this.blb_value.text=c+"%";var d=p.Config.pushGiftBagConditionConfig()[n.code],h=d.describe&&""!=d.describe?d.describe:"未配置";this.lb_desc.text=h}else Utils.MsgUtils.addMidMsg("活动已结束"),this.hide()}},a);function a(){var t=l.call(this)||this;return t.data=void 0,t.uuid=void 0,t.skinName="ActivityPushGiftBagCollection",t.code=EActivityType.NewPushGiftBag,t}p.ActivityPushGiftBagCollection=i;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},r.prototype.dataChanged=function(){var a=this,t=(this.data.uuid,this.data.code,this.data.beginDt,this.data.endDt,this.data.gear),e=this.data.rewards;this.data.gearCode,this.gp_rewards.removeChildren(),Array.isArray(e)&&e.forEach(function(t,e){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.6,i.updateData({reward:t}),a.gp_rewards.addChild(i)}),this.btnFunc=this.data.btnFunc,this.btn_buy.label=""+t*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,this.updateTime()},r.prototype.updateTime=function(){var t=this,e=this.data.endDt-Utils.TimerManager.getServerTime();this.lb_time.text=Utils.TimerManager.getFormatBySecond1(e)+"后消失",this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e)+"后消失":p.GameMVC.activityPy.GetActivityInfo(EActivityType.NewPushGiftBag,function(){})},this,1e3)},r);function r(){var t=n.call(this)||this;return t.skinName="ActivityPushGiftBagCollectionItem",t}p.ActivityPushGiftBagCollectionItem=o;var s,c=(s=p.ActivityCommonPanel,__extends(d,s),d.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),this.once(egret.Event.ENTER_FRAME,function(){p.AppFacade.getInstance().sendNotification(CN.ACTIVITY_PUSH_GIFT_OPEN)},this)},d.prototype.childrenCreated=function(){var a=this;s.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.info;if(t&&t.data){a.uuid=a.data.uuid,a.data.code,a.data.gear;var e=a.data.goodsId;if(e){var i=p.GameMVC.rechargePy.getGoodInfo(e);i?p.GameMVC.rechargePy.purchase(i,2,String(a.uuid),JSON.stringify({code:a.uuid,activityType:a.code}),{uuid:a.uuid,activityType:a.code}):Utils.MsgUtils.addMidMsg("找不到商品配置")}else Utils.MsgUtils.addMidMsg("找不到商品id")}},this),this.lb_desc.parent.visible=!1,this.btn_close.visible=!0,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide()},this)},d.prototype.updateView=function(t){var a=this;s.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data&&e.data.gifts&&0!=e.data.gifts.length&&(this.data=e.data.gifts[0],this.data)){var i=this.data.rewards,n=this.data.entityCode,o=this.data.goodsId;this.heroModel.update({code:n,isStatic:!0});var r=p.GameMVC.rechargePy.getGoodInfo(o).price;this.gp_rewards.removeChildren(),Array.isArray(i)&&i.forEach(function(t,e){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.65,i.updateData({reward:t}),a.gp_rewards.addChild(i)}),this.btn_buy.label=""+r*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,this.updateTime()}},d.prototype.updateTime=function(){var t=this,e=this.data.expiredDt-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond1(e),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--e?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(e)+"后礼包消失":t.hide()},this,1e3)},d);function d(){var t=s.call(this)||this;return t.data=void 0,t.uuid=void 0,t.skinName="Activity334Skin",t.code=EActivityType.HeroPushGiftBag,t}p.ActivityPushPetGiftBag=c}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity335Skin",t}t.Activity335=e}(game=game||{}),function(t){var d,e=(d=t.ActivityCommonPanel,__extends(i,d),i.prototype.childrenCreated=function(){var t=this;d.prototype.childrenCreated.call(this),this.list_items.itemRenderer=n,this.gp_bigger.visible=!1,this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.gp_bigger.visible=!0},this),this.gp_bigger.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.gp_bigger.visible=!1},this),Utils.LocalStorageUtil.setTodayVaild("Activity348"),NoticeManager.updateNotice(NT.ALL_ACTIVITY[this.code]),this.list_items.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){var e=t.item;e&&e.btnFunc&&e.btnFunc(e)},this)},i.prototype.updateView=function(){var e=this;d.prototype.updateView.call(this);var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),a=t.data.fans||0,n=t.data.targeted||[];this.lb_key.text=a+"";var o=[];for(var r in i[0]){var s=i[0][r],c=REWARD_STATUS.UNAVAILABLE;a>=s[1]&&(c=REWARD_STATUS.AVAILABLE),0<=n.indexOf(s[0])&&(c=REWARD_STATUS.RECEIVED),o.push({id:s[0],count:s[1],icon:s[3],effect:s[4],key:a,status:c,reward:s[2][0][2],btnFunc:function(t){if(t)switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("粉丝数不足");break;case REWARD_STATUS.AVAILABLE:e.getReward({code:e.code,id:t.id});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}})}this.list_items.dataProvider=new eui.ArrayCollection(o)}},i);function i(){var t=d.call(this)||this;return t.skinName="Activity348Skin",t.code=EActivityType.DouYinFansReach,t}t.Activity348=e;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){this.gp_effect.touchEnabled=!1,this.gp_effect.touchChildren=!1},o.prototype.dataChanged=function(){switch(this.data.icon&&(this.img_icon.source=this.data.icon+"_png"),this.bm_reward.text=this.data.reward+"钻石",this.bm_count.text=""+Utils.MathUtils.formatNumStyle1(this.data.count),this.data.status){case REWARD_STATUS.UNAVAILABLE:UIActionManager.removeEffect(this.gp_effect),UIActionManager.setGrey(this.img_icon,!0),this.img_received.visible=!1;break;case REWARD_STATUS.AVAILABLE:UIActionManager.addEffect(this.gp_effect,this.data.effect,{offectY:-5},function(t){t.touchEnabled=!1}),UIActionManager.setGrey(this.img_icon,!1),this.img_received.visible=!1;break;case REWARD_STATUS.RECEIVED:UIActionManager.removeEffect(this.gp_effect),UIActionManager.setGrey(this.img_icon,!1),this.img_received.visible=!0}},o);function o(){var t=a.call(this)||this;return t.skinName="Activity348ItemSkin",t}}(game=game||{}),function(r){var i,t=(i=r.ActivityCommonView,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var t=0;t<12;++t){var e=this["img_"+t];this.rotaPosArr.push({x:e.x,y:e.y})}this.activateComponent()},e.prototype.updateView=function(t){i.prototype.updateView.call(this,t),this.gp_treasureHunter.visible=!1,this.gp_treasureHunter.visible=!0,this.updateTreasureHunter(),this.timer||(this.remainingDt=r.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateTreasureHunter=function(){var t=this;this.isFirst&&(this.isFirst=!1,this.sl_record.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=r.LableItemRender,this.lb_welcome_tip.text=this.welcomeText[this.welId],this.welcomeTimer=egret.setInterval(function(){t.welId=(t.welId+1)%3,t.lb_welcome_tip.text=t.welcomeText[t.welId]},this,1e4));var e=(a=this.info.content[2])[0][0],i=a[1][0];this.btn_1.updateData({source:"xydb_btn_anniushang_png",text:"1次",cost:e}),this.btn_10.updateData({source:"xydb_btn_anniuxia_png",text:"10次",cost:i});var a,n=this.info.content,o=(e=(a=n[0])[0][0],i=a[1][0],n[3]-this.info.data.r2Count);(r.GameMVC.backpackPy.checkEnough([e],!1)||o<1)&&this.btn_1.updateData({source:"xydb_btn_anniushang_png",text:"1次",cost:e}),(r.GameMVC.backpackPy.checkEnough([i],!1)||o<10)&&this.btn_10.updateData({source:"xydb_btn_anniuxia_png",text:"10次",cost:e}),this.bm_diamondTimes.text=o+"",this.crb_itemCosts.updateBar([e]),this.showRecords(),this.updateMidView()},e.prototype.showRecords=function(){var t=this.info.data.records,e=[];if(this.gp_empty.visible=t.length<=0,0<t.length)for(var i=0,a=t;i<a.length;i++){var n=a[i],o={rewards:n.rewards,userName:n.name,dt:n.dt,activityCode:this.code};e.push(o)}0<e.length&&(e.sort(function(t,e){return 0<=t.dt-e.dt?-1:1}),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(e):this.list_item.dataProvider=new eui.ArrayCollection(e))},e.prototype.updateMidView=function(){this.info.data.targeted;var t=this.info.content[1];for(var e in t){var i=this["img_"+e],a=t[e],n={reward:a[1][0],type:a[3],id:a[0]};i.updateData(n)}},e.prototype.updateRemainingTime=function(){var t=this.blb_time;0<this.remainingDt?t.text=""+Utils.TimerManager.getFormatBySecond2(this.remainingDt--):r.AppFacade.getInstance().hideSubView(r.ActivityMediator.N,r.ActivityMediator.SV.MAIN)},e.prototype.hunter=function(c){var d=this;this.touched=!0,this.selectBtn=c||1,this.btn_1.btn_btn.touchEnabled=!1,this.btn_10.btn_btn.touchEnabled=!1,Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:c}).then(function(t){var e=JSON.parse(t.info);if(2==c){for(var i=e.rewardShow,a={1:1,4:1,7:1,10:1},n=i[i.length-1],o=0,r=i;o<r.length;o++){var s=r[o];if(a[s]){n=s;break}}d.target=n+12-d.movPos}else d.target=e.rewardShow[0]+(12-d.movPos);d.hunterRotation(t)})},e.prototype.hunterRotation=function(t){var e=this;this.rotaPosArr[this.movPos],this.moveCircle({count:0,doneCB:function(){e.touched=!1,e.info&&e.info.updateData(t.info),t.clientReward&&r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).handleClientReward(t.clientReward,{onCloseCB:function(){e.btn_1.btn_btn.touchEnabled=!0,e.btn_10.btn_btn.touchEnabled=!0,egret.Tween.get(e.gp_move).to({alpha:0},20)}})}})},e.prototype.moveCircle=function(t){var e=this,i=this.movPos,a=this.rotaPosArr[i].x,n=this.rotaPosArr[i].y,o=t&&t.duration||60,r=t&&t.count||0,s=t&&t.doneCB;this.gp_move.alpha=1,r>=12*this.CIRCLENUM*this.selectBtn+this.target?egret.Tween.get(this.gp_move).wait(50).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).wait(20).call(function(){s&&s()}):(egret.Tween.get(this.gp_move).to({x:a,y:n},o,egret.Ease.circOut).call(function(){++i,++r>=12*e.CIRCLENUM*e.selectBtn&&(o+=2),r<12*e.CIRCLENUM*e.selectBtn+e.target&&(e.movPos=i%12),e.moveCircle({count:r,duration:o,doneCB:s})}),this.tailMoving(i,o,r))},e.prototype.tailMoving=function(t,o,r){function e(t,e,i,a){var n=a||0;egret.Tween.get(t).to({x:e,y:i},o,egret.Ease.circOut).call(function(){r>=12*s.CIRCLENUM*s.selectBtn+s.target-1&&egret.Tween.get(t).to({alpha:0},50+n)})}var s=this,i=(t-1+12)%12,a=(t-2+12)%12,n=this.rotaPosArr[i].x,c=this.rotaPosArr[i].y,d=this.rotaPosArr[a].x,h=this.rotaPosArr[a].y;this.gp_move0.alpha=1,e(this.gp_move0,n,c),this.gp_move1.alpha=1,e(this.gp_move1,d,h,50)},e.prototype.activateComponent=function(){var n=this;this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content,e=t[3]-n.info.data.r2Count,i=t[0][0];if(r.GameMVC.backpackPy.checkEnough(i,!1))return void n.hunter(1);i=t[2][0];var a=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N);if(e<1)return void Utils.MsgUtils.addMidMsg("钻石抽奖次数不足");if(!a.checkEnough(i,!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(1)}},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.touched){var t=n.info.content,e=t[3]-n.info.data.r2Count,i=t[0][1];if(r.GameMVC.backpackPy.checkEnough(i,!1))return void n.hunter(2);i=t[2][1];var a=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N);if(e<10)return void Utils.MsgUtils.addMidMsg("钻石抽奖次数不足");if(!a.checkEnough(i,!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");n.hunter(2)}},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showHelpDialog(n.info.content[4])},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.welcomeTimer&&egret.clearInterval(this.welcomeTimer)},e.isInit=!0,e);function e(){var t=i.call(this)||this;return t.movPos=0,t.target=0,t.selectBtn=1,t.touched=!1,t.CIRCLENUM=1,t.rotaPosArr=[],t.isFirst=!0,t.welId=0,t.welcomeText={0:"欢迎各位勇士前来夺宝！",1:"祝大家好运连连，惊喜不断！",2:"嘿嘿！我这有很多宝贝！你想要吗？"},t.skinName="Activity349Skin",t}r.Activity349=t}(game=game||{}),function(h){var e,t=(e=h.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.HeroDynamicModel.update({isStatic:!0,model:this.info.content[5]}),this.lb_desc.text=this.info.content[7],this.activateComponent()},i.prototype.updateView=function(){var t=this.info;if(t&&t.data){this.need321=!1,(this.curBossLife&&this.curBossLife<t.data.curBossLife||this.curBossCode&&this.curBossCode!=t.data.curBossCode)&&(this.need321=!0,this.BossVisible(!1)),this.need321&&this.playEffect3(),this.curBossLife=t.data.curBossLife,this.curBossCode=t.data.curBossCode;var e=t.content,i=0;for(var a in e[0]){var n=e[0][a];this.curBossCode==n[0]&&(i=n[1],this.boxReward=n[2])}if(i){for(var a in this.pb_hp.maximum=i,this.pb_hp.value=this.curBossLife,this.bm_hp.text=Math.ceil(this.curBossLife/i*100)+"%",this.gp_reward.removeChildren(),h.GameMVC.activityMed.CommonGpAddReward2(this.gp_reward,e[2]),this.gp_reward.$children){n=this.gp_reward.$children[a];var o=new eui.Image;o.source="sqhd_img_gu_png",o.right=o.top=0,n.addChild(o),n.img_added=!0}var r={};for(var a in e[3]){var s=e[3][a][1][0];r[s[1]]=s}var c=[];for(var a in r)n=r[a],c.push(n);h.GameMVC.activityMed.CommonGpAddReward2(this.gp_reward,c);var d=e[1];this.CommonIconWithNum.updateItem({cost:d[0],style:CommonIconStyle.RIGHT,needShowHave:!0}),this.CommonIconWithNum10.updateItem({cost:[d[0][0],d[0][1],10*d[0][2]],style:CommonIconStyle.RIGHT,needShowHave:!0}),this.updateTime()}else Utils.MsgUtils.addMidMsg("找不到BOSS配置:"+this.curBossCode)}},i.prototype.activateComponent=function(){var t=this;this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.getReward(1)},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.getReward(10)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.GameMVC.activityMed.showHelpDialog(t.info.content[6])},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.boxReward&&h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.REWARD_PANEL,{rewards:t.boxReward,type:h.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this)},i.prototype.setTouchFalse=function(){GameRootLayer.gameLayer().switchTouchEnable(!1),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer),this.toleranceTimer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,5e3)},i.prototype.setTouchTrue=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},i.prototype.getReward=function(t){var e=this,i=this.info;if(i&&i.data){var a=JSON.parse(i.content)[1];this.backpackProxy.checkEnough([[a[0][0],a[0][1],t]])?(this.setTouchFalse(),Utils.Socket.send("activity","DoCommonOperation",{num:t,code:this.code}).then(function(t){e.cbData=t,e.playEffect1()}).catch(function(t){e.setTouchTrue(),Utils.MsgUtils.addErrMsg(t.err)})):Utils.MsgUtils.addMidMsg("道具不足")}},i.prototype.playEffect1=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return DragonBoneTools.playOnce({effectName:"common_activity_xiarihuodong_01",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2-50||0,keep:!1,loop:!1,actionName:"common_bianpao",doneCB:function(){e.HeroDynamicModel.egretArmDisplay&&e.HeroDynamicModel.egretArmDisplay.addEventListener(dragonBones.EventObject.COMPLETE,e.onModelComplete,e),e.HeroDynamicModel.changeAction(["shouji"])}}),[2]})})},i.prototype.onModelComplete=function(){var t=this;this.cbData.clientReward&&(GameRootLayer.gameLayer().switchTouchEnable(!0),h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(this.cbData.clientReward,{onCloseCB:function(){t.handleRewardDone()}})),this.HeroDynamicModel.egretArmDisplay&&this.HeroDynamicModel.egretArmDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onModelComplete,this),this.HeroDynamicModel.changeAction(["daiji"])},i.prototype.BossVisible=function(t){this.HeroDynamicModel.visible=t,this.pb_hp.visible=t,this.bm_hp.visible=t},i.prototype.handleRewardDone=function(){this.allDone()},i.prototype.playEffect3=function(){var t=this;this.darkSprite?this.darkSprite.visible=!0:(this.darkSprite=new egret.Sprite,this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.8),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth(),Utils.DeviceUtils.curHeight()),this.darkSprite.graphics.endFill(),this.darkSprite.width=Utils.DeviceUtils.curWidth(),this.darkSprite.height=Utils.DeviceUtils.curHeight(),this.darkSprite.x=(this.width-this.darkSprite.width)/2,this.darkSprite.y=(this.height-this.darkSprite.height)/2,this.addChild(this.darkSprite)),this.setTouchFalse(),egret.setTimeout(function(){t.setTouchTrue(),t.need321=!1,t.darkSprite.visible=!1,t.BossVisible(!0)},this,6e3),DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:this,doneCB:function(){}})},i.prototype.allDone=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.cbData?(this.actProxy.allActivityData[this.code].updateData(this.cbData.info),this.cbData=void 0):this.updateView(),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},i.prototype.updateTime=function(){var t=this;this.timer&&egret.clearInterval(this.timer);var e=h.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond1(e),this.timer=egret.setInterval(function(){0<--e?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(e):(Utils.MsgUtils.addMidMsg("活动已结束"),t.timer&&egret.clearInterval(t.timer),t.hide())},this,1e3)},i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},i);function i(){var t=e.call(this)||this;return t.need321=!1,t.cbData=void 0,t.curBossCode=0,t.curBossLife=0,t.boxReward=[],t.skinName="Activity350Skin",t.code=EActivityType.PlayerBoss,t}h.Activity350=t}(game=game||{}),function(f){var e,t=(e=f.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list_card.dataProvider=new eui.ArrayCollection,this.list_card.itemRenderer=n,this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.gp_chose.addChildAt(this.baseitem,0),this.baseitem.horizontalCenter=this.baseitem.verticalCenter=0,UIActionManager.addEffect(this.gp_next,"common_activity_xiarikuanghuan_03"),UIActionManager.fadeBlink(this.img_add,!0,!1,500),this.activateComponent(),this.gp_effect.visible=!1},i.prototype.updateView=function(t){var e=this,i=f.GameMVC.activityPy.allActivityData[this.code];if(i&&i.data){var a=JSON.parse(i.content),n=i.data.fMap,o=2,r=i.data.layerNum,s=a[2];r%a[1]==0?(o=1,this.img_normal.source="xrhd_btn_putong2_png",this.img_superb.source="xrhd_btn_gaoji1_png",UIActionManager.hideEffect(this.gp_normal),UIActionManager.addEffect(this.gp_superb,"common_activity_xiarikuanghuan_04"),s=a[3]):(this.img_normal.source="xrhd_btn_putong1_png",UIActionManager.addEffect(this.gp_normal,"common_activity_xiarikuanghuan_04"),UIActionManager.hideEffect(this.gp_superb),this.img_superb.source="xrhd_btn_gaoji2_png");var c=[];if(i.data.bigReward.code)for(var d in i.data.bigReward.targeted?(this.gp_next.visible=!0,this.img_change.visible=!1,UIActionManager.hideEffect(this.gp_chose),this.img_add.visible=!1,this.img_hasGet.visible=!0):(this.gp_next.visible=!1,this.img_change.visible=!0,UIActionManager.addEffect(this.gp_chose,"common_activity_xiarikuanghuan_05",{childIndex:0}),this.img_add.visible=!1,this.img_hasGet.visible=!1),s[1])(h=s[1][d])[0]==i.data.bigReward.code&&this.baseitem.updateData({reward:h[1][0]});else{for(var d in n=[-1],i.data.gameMapShow){var h=i.data.gameMapShow[d];n.push(h[0])}n.sort(function(t,e){return t-e}),this.gp_next.visible=!1,UIActionManager.hideEffect(this.gp_chose),this.baseitem.resetFixedStyle(EEntityType.EEntityTypeHero),this.img_change.visible=!1,this.img_add.visible=!0,this.img_hasGet.visible=!1}this.info.data.fMap2&&(n=this.info.data.fMap2);var l=a[4][0],p=f.GameMVC.backpackPy.getInfoByCode(l[1]);for(var d in this.img_costIcon.source=p.info.icon+"_png",this.bm_have.text=Utils.MathUtils.formatNumStyle1(p.haveNum),this.bm_need.text="/"+l[2],n){var u=n[d];if(0==u||-1==u)c.push({index:d,code:u,color:o,superCode:i.data.bigReward.code,cost:[l],activityCode:this.code});else if(u==i.data.bigReward.code)for(var g in s[1])(y=s[1][g])[0]==u&&c.push({index:g,code:u,superCode:i.data.bigReward.code,rewards:y[1],color:o,activityCode:this.code});else for(var m in s[0]){var y;(y=s[0][m])[0]==u&&c.push({index:m,code:u,superCode:i.data.bigReward.code,rewards:y[2],color:o,activityCode:this.code})}}this.list_card.dataProvider.replaceAll(c);var v=(this.bm_level.text=r)+(a[1]-r%a[1]);r%a[1]==0&&(v=r),this.bm_nextSuperLevel.text=v,this.info.data.fMap2&&(GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){e.info.data.fMap2=void 0,e.playEffect()},this,2e3))}},i.prototype.playEffect=function(t,e){var i=this;for(var a in this.list_card.$children){var n=this.list_card.$children[a];n&&n.hideReward&&n.hideReward()}GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){e&&e(),i.gp_effect.visible=!0,DragonBoneTools.playOnce({effectName:i.info.data.layerNum%i.info.content[1]==0?"common_activity_xiarikuanghuan_02":"common_activity_xiarikuanghuan_01",parent:i.gp_effect,loadFinishCB:function(){i.list_card.visible=!1},doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),i.gp_effect.visible=!1,i.list_card.visible=!0,t?t():i.updateView()},x:i.gp_effect.width/2,y:i.gp_effect.height/2})},this,500)},i.prototype.choseReward=function(t){var o=this;Utils.Socket.send("activity","DoCommonOperation",{code:this.code,id:2,num:parseInt(t)}).then(function(t){var i=JSON.parse(t.info);i.fMap2=[],i.gameMapShow.forEach(function(t){i.fMap2.push(t[0])}),i.fMap2.sort(function(t,e){return t==i.bigReward.code?-1:e==i.bigReward.code?1:t-e}),GameRootLayer.gameLayer().switchTouchEnable(!1);var e=o.info.content[2];for(var a in e[1]){var n=e[1][a];n[0]==i.bigReward.code&&o.baseitem.updateData({reward:n[1][0]})}o.img_add.visible=!1,o.gp_effect.visible=!0,DragonBoneTools.playOnce({effectName:"common_activity_xiarikuanghuan_08",parent:o.gp_effect,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_activity_xiarihuodong4_01",parent:o.gp_effect,doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),o.gp_effect.visible=!1,o.info.updateData(i)},x:30,y:27})},x:35,y:23})})},i.prototype.getAllRewards=function(){function t(t){egret.setTimeout(function(){e.getReward({id:1,code:e.code,num:t})},i,100*t)}for(var e=this,i=this,a=1;a<37;a++)t(a)},i.prototype.activateComponent=function(){var c=this;this.gp_chose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=c.info.content,s=c.info.data.codeMap;c.info.data.bigReward.code&&c.info.data.bigReward.targeted?Utils.MsgUtils.addMidMsg("究极宝物已获得,进入下一层后可更换"):PopUpManager.addPopUp({obj:new d({index:c.info.data.layerNum%i[1]==0?1:0,getInfos:function(a){var n=i[2][1];1==a&&(n=i[3][1]);var o={},r=0;function t(t){var e=n[t],i={type:e[1][0][0],code:e[1][0][1],num:e[1][0][2],canGet:e[4],hasGet:0,isLocked:0};s.forEach(function(t){t[0]==e[0]&&(i.hasGet=t[1])}),i.isLocked=a!=r?2:i.hasGet>=i.canGet?1:0,o[e[0]]=i}for(var e in c.info.data.layerNum%i[1]==0&&(r=1),n)t(e);return o},type:EEntityType.EEntityTypeItem,checkFull:function(t){return 1<=t.length},selectUuids:c.info.data.bigReward.code?[c.info.data.bigReward.code+""]:[],singleChoose:!0,isOnlyCode:!0,noCloseAsConfirm:!0,title:"请选择究极宝物",lockedTip:function(t){return 1==t.isLocked?"该宝物可获得次数已用完":"请选择对应层的究极宝物"},source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(t){t&&t[0]&&t[0]!=c.info.data.bigReward.code&&(c.info.data.bigReward.code?c.getReward({code:c.code,id:2,num:parseInt(t[0])}):c.choseReward(t[0]))}})},this),this.gp_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){function e(){DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:c.gp_chose,x:c.gp_chose.width/2,y:c.gp_chose.height/2,doneCB:function(){UIActionManager.hideEffect(c.gp_chose),c.baseitem.resetFixedStyle(EEntityType.EEntityTypeHero),c.img_change.visible=!1,c.img_hasGet.visible=!1,c.info.data&&c.info.data.layerNum++,c.playEffect(function(){c.getReward({code:c.code,id:3,num:0})},function(){var t=2;for(var e in c.info.data&&c.info.data.layerNum%c.info.content[1]==0&&(t=1),c.list_card.$children){var i=c.list_card.$children[e];i&&i.img_bg&&(i.img_bg.source="xrhd_img_paibei"+t+"_png")}})}})}0==c.info.data.fMap.filter(function(t){return 0==t}).length?e():f.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否前往下一层，确认后无法返回，剩余奖励将会消失",source:"activity352NextLevel",cb:!0,clickCB:function(t){t.type&&e()}})},this),this.btn_rewards.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.info.data.bigReward.code?PopUpManager.addPopUp({obj:new u}):Utils.MsgUtils.addMidMsg("请先选择究极宝物")},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.GameMVC.activityMed.showHelpDialog(c.info.content[7])},this),this.btn_access.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=c.info.content[4][0];PopUpManager.addPopUp({obj:new f.BaseItemDetailView({code:t[1],type:t[0],showAccessNow:!0})})},this),this.btn_getItem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(c.info.content[6]-c.info.data.buyTimes<=0)Utils.MsgUtils.addMidMsg("已达最大购买次数");else{var e=c.info.content[5],t=c.info.content[4],i=f.GeneralConfig.getEntityConfigByCode(t[0][0],t[0][1]);f.GameMVC.shopyMed.showSubView(f.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:t,costs:JSON.stringify(e),countFun:function(t){return{unit:e[0][2],total:e[0][2]*t}},name:i.name,limit:"[1,"+c.info.content[6]+"]"},maxCount:c.info.content[6]-c.info.data.buyTimes,buyNum:c.info.data.buyTimes,doneCB:function(t){c.getReward({code:c.code,id:4,num:t.num})}})}},this),e.prototype.updateActivityTime.call(this,this.bm_time,!1)},i);function i(){var t=e.call(this)||this;return t.skinName="Activity352Skin",t.code=EActivityType.MazeExplore,t}f.Activity352=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.img_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==e.data.code&&(e.data.superCode?f.GameMVC.backpackPy.checkEnough(e.data.cost,!1)?f.GameMgr.getInstance().showCommonTipsWin({costTips:"翻牌",cost:e.data.cost,cb:!0,source:"activity352",btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&e.onTap()}}):Utils.MsgUtils.addMidMsg("道具不足"):Utils.MsgUtils.addMidMsg("请先设置究极宝物"))},this)},o.prototype.dataChanged=function(){var t=f.GameMVC.activityPy.allActivityData[this.data.activityCode];t&&t.data&&(this.img_add.visible=!1,this.baseitem.touchEnabled=!1,0==this.data.code?(this.baseitem.visible=!1,this.img_bg.source="xrhd_img_paibei"+this.data.color+"_png"):-1==this.data.code?(this.baseitem.visible=!0,this.baseitem.resetFixedStyle(EEntityType.EEntityTypeHero),this.img_add.visible=!0,this.img_bg.source=""):(this.baseitem.visible=!0,this.baseitem.updateData({reward:this.data.rewards[0]}),this.img_bg.source="",this.baseitem.touchEnabled=!0))},o.prototype.onTap=function(){var e=this;GameRootLayer.gameLayer().switchTouchEnable(!1),Utils.Socket.send("activity","DoCommonOperation",{id:1,code:this.data.activityCode,num:parseInt(this.data.index)+1}).then(function(t){0==JSON.parse(t.info).fMap[e.data.index]||(DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_01",x:e.width/2,y:e.height/2,scaleX:.75,scaleY:.4,timeScale:2,doneCB:function(){DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_02_1",scaleX:.6,scaleY:.4,timeScale:2,x:e.width/2,y:e.height/2}),DragonBoneTools.playOnce({parent:e,effectName:"common_activity_tongyong_02_2",timeScale:2,scaleX:.6,scaleY:.4,x:e.width/2,y:e.height/2,doneCB:function(){}})}}),egret.Tween.get(e).to({scaleX:0},100).call(function(){e.updateByData(t),e.data.superCode==e.data.code&&DragonBoneTools.playOnce({effectName:"common_activity_xiarikuanghuan_07",parent:e,x:e.width/2,y:e.height/2})},e).to({scaleX:1},100).wait(500).call(function(){t.clientReward=void 0,f.GameMVC.activityPy.updateData_View_Reward(e.data.activityCode,t),GameRootLayer.gameLayer().switchTouchEnable(!0)}))})},o.prototype.updateByData=function(t){var e=JSON.parse(t.info).fMap[this.data.index],i=f.GameMVC.activityPy.allActivityData[this.data.activityCode],a=JSON.parse(i.content),n=a[2];if(1==this.data.color&&(n=a[3]),e==i.data.bigReward.code){for(var o in n[1])if((r=n[1][o])[0]==e)return this.data.code=e,this.data.rewards=r[1],void this.dataChanged()}else for(var o in n[0]){var r;if((r=n[0][o])[0]==e)return this.data.code=e,this.data.rewards=r[2],void this.dataChanged()}},o.prototype.hideReward=function(){var t=this;egret.Tween.get(this).to({scaleX:0},200).call(function(){t.img_bg.source="xrhd_img_paibei"+t.data.color+"_png",t.baseitem.visible=!1},this).to({scaleX:1},200).call(function(){})},o);function o(){var t=a.call(this)||this;return t.skinName="Activity352ItemSkin",t}var r,d=(r=f.CommonChosePanel,__extends(s,r),s.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.list_item.itemRenderer=h,this.btn_normal.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=t.curIndex&&(t.curIndex=0,t.updateView())},this),this.btn_super.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=t.curIndex&&(t.curIndex=1,t.updateView())},this)},s.prototype.updateView=function(t){var n=this,e=[],i=this.params.getInfos&&this.params.getInfos(this.curIndex);this.lb_title.text=this.params.title,i=i||[];var a=this.params.excludeUuids||[];for(var o in i){var r=i[o];if(!(0<=a.indexOf(o))){var s=0<=this.selectUuids.indexOf(o);e.push({uuid:o,chosen:s,isOnlyCode:this.params.isOnlyCode||!1,info:r,source:this.params.source,type:this.params.type||EEntityType.EEntityTypeItem,uniNum:this.params.uniNum})}}e.length?(this.gp_empty.visible=!1,this.btn_confirm.visible=!0,this.params.sortFunc||(this.params.sortFunc=function(t,e){var i=t.info,a=e.info;return i.isLocked!=a.isLocked?i.isLocked?1:-1:n.backpackPy.checkHeroInTeam(i.uuid)&&!n.backpackPy.checkHeroInTeam(a.uuid)?1:!n.backpackPy.checkHeroInTeam(i.uuid)&&n.backpackPy.checkHeroInTeam(a.uuid)?-1:i.code!=a.code?i.code-a.code:i.level-a.level}),e.sort(function(t,e){return n.params.sortFunc(t,e)}),this.ac_list.replaceAll(e)):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1),this.btn_normal.icon=0==this.curIndex?"xrhd_yeqian_putongceng01_png":"xrhd_yeqian_putongceng02_png",this.btn_super.icon=1==this.curIndex?"xrhd_yeqian_gaojiceng01_png":"xrhd_yeqian_gaojiceng02_png"},s);function s(t){var e=r.call(this,t)||this;return e.curIndex=0,e.skinName="Activity352SuperRewardChosePanel",e.curIndex=t.index,e}var c,h=(c=f.CommonChosePanelItem,__extends(l,c),l.prototype.dataChanged=function(){c.prototype.dataChanged.call(this),this.bm_cur.text=this.data.info.hasGet,this.bm_max.text="/"+this.data.info.canGet},l);function l(){var t=c.call(this)||this;return t.skinName="Activity352SuperRewardChosePanelItem",t}var p,u=(p=BasePanel,__extends(g,p),g.prototype.childrenCreated=function(){var n=this;p.prototype.childrenCreated.call(this);var o=f.GameMVC.activityPy.allActivityData[EActivityType.MazeExplore];if(o&&o.data){this.list_normal.itemRenderer=y;var r=o.data.gameMapShow,s=0;r.forEach(function(t){s+=t[1]});var c={},d=0,h=0;r.forEach(function(e){if(e[0]==o.data.bigReward.code){var t=new y;t.horizontalCenter=0,t.bottom=0,t.data={reward:n.getRewardByCode(e[0]),cur:o.data.bigReward.targeted?1:0,max:1,probability:Math.floor(1e4*e[1]/s)/100},n.gp_superb.addChild(t),Math.floor(1e4*e[1]/s)}else if(!c[e[0]]){var i=r.filter(function(t){return t[0]==e[0]}).length,a=o.data.fMap.filter(function(t){return t==e[0]}).length;c[e[0]]={reward:n.getRewardByCode(e[0]),cur:a,max:i,probability:Math.floor(1e4*e[1]/s)/100},d+=i,h+=a,Math.floor(1e4*e[1]/s)}});var t=[];for(var e in c){var i=c[e];t.push(i)}this.list_normal.dataProvider=new eui.ArrayCollection(t),this.bm_superCur.text=o.data.bigReward.targeted?"1":"0",this.bm_normalCur.text=h+"",this.bm_normalMax.text="/"+d,this.bm_superMax.text="/1"}},g.prototype.getRewardByCode=function(t){var e=f.GameMVC.activityPy.allActivityData[EActivityType.MazeExplore];if(!e||!e.data)return[];var i=e.content[2];if(e.data.layerNum%e.content[1]==0&&(i=e.content[3]),t==e.data.bigReward.code){var a=i[1];for(var n in a)if((o=a[n])[0]==t)return o[1][0]}else for(var n in a=i[0]){var o;if((o=a[n])[0]==t)return o[2][0]}return[]},g);function g(){var t=p.call(this)||this;return t.skinName="Activity352RewardPanel",t}var m,y=(m=eui.ItemRenderer,__extends(v,m),v.prototype.childrenCreated=function(){m.prototype.childrenCreated.call(this),this.data&&this.dataChanged()},v.prototype.dataChanged=function(){this.baseitem.updateData({reward:this.data.reward}),this.data.cur>=this.data.max?(this.bm_cur.text="已获得",this.bm_max.text="",UIActionManager.setGrey(this.baseitem,!0)):(this.bm_cur.text=this.data.cur,this.bm_max.text="/"+this.data.max,UIActionManager.setGrey(this.baseitem,!1)),this.bm_probability.text=this.data.probability+"%"},v);function v(){var t=m.call(this)||this;return t.skinName="Activity352RewardPanelItem",t}}(game=game||{}),function(l){var p,t=(p=l.ActivityCommonView,__extends(e,p),e.prototype.childrenCreated=function(){if(p.prototype.childrenCreated.call(this),this.list_heros.itemRenderer=r,!this.gp_enermyH.$children.length)for(var t=1;t<=6;t++)(e=new a).scaleX=e.scaleY=.8,e.touchEnabled=e.touchChildren=!1,this.gp_enermyH.addChild(e);var e;(e=new a).scaleX=e.scaleY=.8,e.horizontalCenter=e.verticalCenter=0,e.touchEnabled=e.touchChildren=!1,this.gp_enermyP.addChild(e),this.activateComponent()},e.prototype.updateView=function(t){p.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content);this.info.data.rTimes<i[2]?(this.bm_free.visible=!0,this.bm_freeTime.visible=!0,this.btn_refresh.updateData({text:"刷新"}),this.bm_freeTime.text=i[2]-e.data.rTimes+""):(this.bm_free.visible=!1,this.bm_freeTime.visible=!1,this.btn_refresh.updateData({cost:i[3][0],text:"刷新"})),this.bm_rewardTime.font=0<i[1]-this.info.data.times?"green_num_fnt":"RedBlackStrocke_fnt",this.bm_rewardTime.text=""+(i[1]-this.info.data.times);var a=e.data.raceLimit,o=e.data.heros;a.sort(function(t,e){return t[1]!=e[1]?e[1]-t[1]:t[0]-e[0]});var r={};function n(t){function e(){var a=void 0;o.forEach(function(t){var e=t[1],i=l.GameMVC.heroPy.allHeroByUuid[e];c[e]||i.config.race!=n||(a=i)}),a&&(c[a.uuid]=1),s.push({hero:a,race:n,btnFunc:d.onHeroTap.bind(d)})}for(var n=a[t][0],i=r[n]||0;0<i--;)e()}a.forEach(function(t){r[t[0]]=t[1]});var s=[],c={},d=this;for(var h in a)n(h);this.list_heros.dataProvider=new eui.ArrayCollection(s),s.filter,this.updateEnermy()}},e.prototype.updateEnermy=function(){var r=this.info.data.tPublicInfo,s=r.baseInfo;function t(e){var t=d.gp_enermyH.getChildAt(e-1),i=l.Config.unlockConfig(e),a=!0;if(i){var n=JSON.parse(i.condition);switch(n[0]){case UnlockType.Level:s.level<n[1]&&(a=!1)}var o=r.heroList.filter(function(t){return t.pos==e})[0];c=c||o.heroId,t.updateItem({vo:o,unlock:a,unlockLevel:n[1],type:EEntityType.EEntityTypeHero}),t.scaleX=.8,t.scaleY=.8}}this.fightCap.update(s.fightCap),this.lb_name.text=s.name;for(var c=0,d=this,e=1;e<=6;e++)t(e);var i=this.gp_enermyP.$children[0],a=Utils.UnlockMgr.checkPass(MODULE.Pet,!1);a.allow=s.level>=a.ext.requestLevel,i.updateItem({unlock:a,vo:r.petList[0],type:EEntityType.EEntityTypePet}),i.scaleX=.8,i.scaleY=.8,c&&this.hero_model.update({code:c})},e.prototype.onHeroTap=function(t){var c=this,d=t.race,e=this.info.data.heros,i=l.GameMVC.heroPy.allHeroByUuid,a=[];for(var n in e){var o=i[e[n][1]];o&&o.config.race==d&&a.push(o.uuid)}var r=0;this.info.data.raceLimit.forEach(function(t){t[0]==d&&(r=t[1])}),PopUpManager.addPopUp({obj:new h({getInfos:function(){var t={},e=l.GameMVC.heroPy.allHeroByUuid;for(var i in e){var a=e[i];a.config.race==d&&(t[a.uuid]={uuid:a.uuid,type:EEntityType.EEntityTypeHero,code:a.code,fightCap:a.fightCap,isLocked:!1})}return t},race:d,num:r,checkFull:function(t){return t.length>=r},sortFunc:function(t,e){return e.info.fightCap!=t.info.fightCap?e.info.fightCap-t.info.fightCap:e.info.uuid-t.info.uuid},selectUuids:a,type:EEntityType.EEntityTypeHero,noCloseAsConfirm:!0,title:"请选择出战英雄"}),closeCB:function(t){if(t){var e=c.info.data.heros,i=[],a=l.GameMVC.heroPy.allHeroByUuid,n=[1,2,3,4,5,6];for(var o in e){var r=e[o],s=a[r[1]];s&&(s.config.race!=d?(i.push([r[0],s.uuid]),n.splice(n.indexOf(r[0]),1)):0<=t.indexOf(s.uuid)&&(i.push([r[0],s.uuid]),n.splice(n.indexOf(r[0]),1),t.splice(t.indexOf(s.uuid),1)))}t.forEach(function(t){i.push([n[0],t]),n.shift()}),c.getReward({code:c.code,id:2,num:0,info:JSON.stringify(i)})}}})},e.prototype.activateComponent=function(){var n=this;this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showHelpDialog(n.info.content[5])},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=[],e=n.info.data.heros;for(var i in e){var a=e[i];t.push({uuid:a[1],battlePos:a[0]})}l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION,{battlePosInfo:t,cb:function(t){var e=[];for(var i in t){var a=t[i];a&&e.push([Number(i),a.info.uuid])}n.getReward({code:n.code,id:2,num:0,info:JSON.stringify(e)})}})},this),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=n.info.data.heros.length?n.info.data.times<n.info.content[1]?Utils.Socket.send("activity","DoCommonOperation",{code:n.code,id:3,num:0}).then(function(t){egret.setTimeout(function(){n.info.updateData(t.info)},n,1500),l.GameMVC.fightPy.addDelayCBAfterFightExit(function(){l.GameMVC.activityMed.showViewByCode(n.code)},"activity353")}):Utils.MsgUtils.addMidMsg("今日已无奖励次数"):Utils.MsgUtils.addMidMsg("至少上阵一名英雄")},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.info.data.rTimes<n.info.content[2]?n.getReward({code:n.code,id:1,num:0}):l.GameMgr.getInstance().showCommonTipsWin({costTips:"刷新对手",cost:n.info.content[3],source:"activity353",cb:!0,clickCB:function(t){t.type&&n.getReward({code:n.code,id:1,num:0})}})},this)},e);function e(){var t=p.call(this)||this;return t.skinName="Activity353Skin",t}l.Activity353=t;var i,a=(i=eui.Component,__extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.btnFunc&&this.data.btnFunc()},this)},n.prototype.updateItem=function(t){if(this.data=t,this.data.vo){this.gp_baseitem.visible=!0;var e=t.type;if(this.gp_empty.visible=!1,e==EEntityType.EEntityTypeHero)if(t.vo.code=t.vo.heroId,t.vo.dermaCode){var i=l.Config.getHeroDermaConfig()[t.vo.dermaCode].avatar;this.baseItem.updateData({vo:t.vo,type:EEntityType.EEntityTypeHero,avatar:i,isShowEffect:!0})}else this.baseItem.updateData({vo:t.vo,type:EEntityType.EEntityTypeHero});else e==EEntityType.EEntityTypePet?(this.data.vo.code=this.data.vo.petId,this.baseItem.updateData({vo:this.data.vo,type:e})):e==EEntityType.EEntityTypeMagical&&this.baseItem.updateData({vo:this.data.vo,type:e})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock?(this.img_add.visible=!1,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+t.unlockLevel)},n);function n(){var t=i.call(this)||this;return t.skinName="HeroMainView_HeroListItem",t.heroThingProxy=l.AppFacade.getInstance().retrieveProxy(l.HeroThingPy.N),t}var o,r=(o=eui.ItemRenderer,__extends(s,o),s.prototype.childrenCreated=function(){var t=this;this.baseitem=customui.BaseItemFactory.create(),this.img_race.parent.addChildAt(this.baseitem,0),this.baseitem.horizontalCenter=0,this.baseitem.verticalCenter=0,this.baseitem.scaleX=this.baseitem.scaleY=.8,this.baseitem.touchEnabled=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc(t.data)},this),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},s.prototype.dataChanged=function(){var t=this.data.race;this.img_race.source=HeroRaceConfig[t].haoloIcon,this.data.hero?(this.baseitem.updateData({type:EEntityType.EEntityTypeHero,uuid:this.data.hero.uuid}),this.img_race.visible=!1,this.img_add.visible=!1):(this.baseitem.resetFixedStyle(EEntityType.EEntityTypeHero),this.img_race.visible=!0,this.img_add.visible=!0)},s);function s(){var t=o.call(this)||this;return t.skinName="Activity353Item",t}var c,h=(c=l.CommonChosePanel,__extends(d,c),d.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this);var t=this.params;this.lb_desc.text="请选择"+t.num+"名"+HeroRaceConfig[t.race].name+"英雄"},d);function d(t){var e=c.call(this,t)||this;return e.skinName="HeroAltarSelectPanel2Skin",e}}(game=game||{}),function(A){var r,t=(r=A.ActivityCommonListView,__extends(e,r),e.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.list_itemList.itemRenderer=a,this.list_itemList.dataProvider=new eui.ArrayCollection},e.prototype.getDataList=function(){var m=this,t=this.info;if(!t||!t.data)return[];var y,v=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){y=n[1];break}}if(!y)return[];function o(t){var e=y[t],i=e[0],a=e[1],n=e[2],o=e[3],r=e[4],s=e[5],c=0;v.forEach(function(t){t.id==i&&(c=t.num)});var d=c+"/"+s,h="";if(n&&n[0])h=n[0][2]+"钻礼包";else{var l=A.GameMVC.rechargePy.getGoodInfo(a);h=l?l.price+"元礼包":"找不到商品信息"}var p=REWARD_STATUS.CANBUY;s<=c&&(p=REWARD_STATUS.HASBUY);var u=[];_.forEach(function(t){t.id==i&&(u=t.chose)}),r.forEach(function(t,e){var i=!1;u.forEach(function(t){t[0]==e+1&&(i=!0)}),i||u.push([e+1,0])});var g={id:i,goodId:a,costs:n,rewards:o,selfChose:r,maxBuyTimes:s,tips:d,title:h,status:p,choseInfo:u,btnFunc:function(t){if(t){if(t.status!=REWARD_STATUS.HASBUY)if(t.costs&&t.costs[0]&&!A.GameMVC.backpackPy.checkEnough(t.costs,!1))Utils.MsgUtils.addMidMsg("钻石不足");else{var e=0;if(t.choseInfo.forEach(function(t){0!=t[1]&&e++}),e<t.selfChose.length)Utils.MsgUtils.addMidMsg("请选满自选奖励");else if(t.goodId){var i=A.GameMVC.rechargePy.getGoodInfo(t.goodId);A.GameMVC.rechargePy.purchase(i,2,t.id,JSON.stringify({activityType:m.code,code:t.id}),{activityType:m.code,code:t.id})}else m.getReward({code:m.code,id:2,num:t.id,info:"1"})}}else Utils.MsgUtils.addMidMsg("数据有误")},choseFunc:function(t){m.getReward({code:m.code,id:1,num:t.id,info:JSON.stringify(t.choseInfo)})}};f.push(g)}var f=[],_=t.data.choseList;for(var a in y)o(a);return r.prototype.commonSortDataList.call(this,f),f},e);function e(){return r.call(this)||this}A.Activity354=t;var i,a=(i=A.ActivityCommonListItem,__extends(n,i),n.prototype.dataChanged=function(){var s=this;function t(t){var e=c.data.selfChose[t],i=new eui.Group;i.width=i.height=73.5;var a=customui.BaseItemFactory.create();i.addChild(a),c.gp_rewards.addChild(i),a.scaleX=a.scaleY=.7,a.horizontalCenter=a.verticalCenter=0,a.touchEnabled=!1;var n,o=parseInt(t),r=0;c.data.choseInfo.forEach(function(t){t[0]==o+1&&(r=t[1])}),r?(e.forEach(function(t){t[0]==r&&a.updateData({reward:t[1][0]})}),(n=new eui.Image).source="xrhd_btn_jiaohuan_png",n.right=n.top=0):(a.resetFixedStyle(EEntityType.EEntityTypeHero),(n=new eui.Image).source="yxtx_txt_zixuan_png",n.horizontalCenter=n.verticalCenter=0,i.addChild(n),(n=new eui.Image).source="yxtx_img_zixuankuang_png",n.horizontalCenter=n.verticalCenter=0,n.scaleX=n.scaleY=.8),i.addChild(n),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d({index:o+1,selfChose:s.data.selfChose,choseInfo:s.data.choseInfo}),closeCB:function(t){t&&(s.data.choseInfo=t,s.data.choseFunc&&s.data.choseFunc(s.data))}})},c)}i.prototype.dataChanged.call(this);var c=this;for(var e in this.data.selfChose)t(e)},n);function n(){return null!==i&&i.apply(this,arguments)||this}var s,d=(s=BasePanel,__extends(o,s),o.prototype.childrenCreated=function(){var o=this;s.prototype.childrenCreated.call(this),this.list_rewards.itemRenderer=h,this.list_rewards.dataProvider=new eui.ArrayCollection,this.gp_effect.visible=!1,this.curIndex=this.params.index||1,this.params.selfChose.forEach(function(t,e){var i=new eui.Group;i.width=i.height=105,o.grids.push(i),o.gp_grids.addChild(i);var a=customui.BaseItemFactory.create();i.addChild(a),a.horizontalCenter=a.verticalCenter=0,a.touchEnabled=!1;var n=new eui.Image;n.source="common_img_jia_png",n.horizontalCenter=n.verticalCenter=0,i.addChild(n),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.curIndex!=e+1&&(o.curIndex=e+1,o.updateView())},o)}),this.choseImg=new eui.Image,this.choseImg.source="yxtx_img_zixuankuang_png",this.choseImg.horizontalCenter=this.choseImg.verticalCenter=0,this.choseImg.scaleX=this.choseImg.scaleY=1.1,this.list_rewards.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){o.rewardsIndex!=t.itemIndex+1&&(o.rewardsIndex=t.itemIndex+1,o.playEffect())},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=o.grids[o.curIndex-1].$children[0];o.lb_itemName.text&&(t.touchEnabled=!0,t.onClick(),t.touchEnabled=!1)},this),this.btn_comfire.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.updateView()},o.prototype.updateView=function(){var r=this,i=[],s=this.params.choseInfo;this.params.selfChose.forEach(function(t,a){var n=0;s.forEach(function(t){t[0]==a+1&&(n=t[1])});var o=r.grids[a].$children[0],e=r.grids[a].$children[1];n?t.forEach(function(t,e){if(t[0]==n&&(o.updateData({reward:t[1][0]}),a+1==r.curIndex)){r.rewardsIndex=e+1;var i=A.GeneralConfig.getEntityConfigByCode(t[1][0][0],t[1][0][1]);r.lb_itemDesc.text=i.desc,r.lb_itemName.text=i.name+"×"+Utils.MathUtils.formatNumStyle1(t[1][0][2])}}):(o.resetFixedStyle(EEntityType.EEntityTypeHero),a+1==r.curIndex&&(r.lb_itemDesc.text="暂未选择奖励",r.lb_itemName.text="",r.rewardsIndex=0)),e.visible=!n,a+1==r.curIndex&&(t.forEach(function(t,e){i.push({reward:t[1][0],chosen:e+1==r.rewardsIndex})}),r.choseImg.parent&&r.choseImg.parent.removeChild(r.choseImg),r.grids[a].addChild(r.choseImg))}),this.btn_detail.visible=!!this.lb_itemName.text,this.list_rewards.dataProvider.replaceAll(i)},o.prototype.playEffect=function(){var n=this;this.gp_effect.visible=!0;var t=this.params.choseInfo,o=customui.BaseItemFactory.create(),e=this.params.selfChose[this.curIndex-1][this.rewardsIndex-1],i={};t.forEach(function(t){t[0]==n.curIndex&&(t[1]=n.rewardsIndex,i=e[1][0],o.updateData({reward:i}))}),this.gp_effect.addChild(o),this.list_rewards.$children.forEach(function(t,e){if(e==n.rewardsIndex-1){var i=t.localToGlobal(0,0),a=n.gp_effect.globalToLocal(i.x,i.y);o.x=a.x,o.y=a.y}});var a,r,s=this.grids[this.curIndex-1].$children[0],c=s.localToGlobal(0,0),d=this.gp_effect.globalToLocal(c.x,c.y);a=d.x,r=d.y;var h=a-o.x,l=r-o.y,p=Math.sqrt(h*h+l*l)/this.speed;egret.Tween.get(o).to({x:a,y:r},p).call(function(){n.gp_effect.removeChildren(),n.gp_effect.visible=!1,s.updateData({reawrd:i}),n.updateView()},this)},o.prototype.onDestroy=function(){this.opperationParams=this.params.choseInfo},o);function o(t){var e=s.call(this)||this;return e.grids=[],e.rewardsIndex=1,e.speed=.8,e.skinName="Activity354ChosePanelSkin",e.params=t,e}var c,h=(c=eui.ItemRenderer,__extends(l,c),l.prototype.dataChanged=function(){this.baseitem||(this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.baseitem.horizontalCenter=this.baseitem.verticalCenter=0,this.gp_main.addChildAt(this.baseitem,0)),this.baseitem.updateData({reward:this.data.reward}),this.img_chosen.visible=this.data.chosen},l);function l(){var t=c.call(this)||this;return t.skinName="Activity354ChosePanelItem",t}}(game=game||{}),function(g){var m,t=(m=g.ActivityCommonView,__extends(e,m),e.prototype.childrenCreated=function(){m.prototype.childrenCreated.call(this),this.list_tasks.dataProvider=new eui.ArrayCollection,this.list_tasks.itemRenderer=a,this.pb_time.labelFunction=function(){return""},this.lb_name.text=g.GameMVC.playerPy.playerInfoVO.name+"的队伍",this.activateComponent()},e.prototype.updateView=function(t){var e=this;m.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=JSON.parse(i.content);if(this.gp_rewards.removeChildren(),egret.clearInterval(this.timer),UIActionManager.hideEffect(this.pb_time.parent),i.data.exploreId){this.pb_time.maximum=i.data.endDt-i.data.startDt;var n=void 0;for(var o in a[0])if((p=a[0][o])[0]==i.data.exploreId){n=p;break}if(n){var r=Utils.TimerManager.getServerTime(),s=i.data.endDt-r;s<=0?(this.bm_time.text=Utils.TimerManager.getFormatBySecond1(0),this.pb_time.value=this.pb_time.maximum,UIActionManager.addEffect(this.pb_time.parent,"common_activity_xiarihuodong4_02",{offectX:52,offectY:0,childIndex:2})):(this.bm_time.text=Utils.TimerManager.getFormatBySecond1(s),this.pb_time.value=this.pb_time.maximum-s,this.timer=egret.setInterval(function(){0<=--s?(e.pb_time.value=e.pb_time.maximum-s,e.bm_time.text=Utils.TimerManager.getFormatBySecond1(s)):e.updateView()},this,1e3))}i.data.rewards.sort(function(t,e){return e[1]-t[1]}),g.GameMVC.activityMed.CommonGpAddReward(this.gp_rewards,i.data.rewards),UIActionManager.setGrey(this.btn_get,!1)}else this.bm_time.text="??:??:??",UIActionManager.setGrey(this.btn_get,!0),this.pb_time.value=0;if(this.img_noRewards.visible=i.data.exploreId&&0==this.gp_rewards.$children.length,this.img_noTeam.visible=!i.data.exploreId,this.gp_heros.removeChildren(),i.data.exploreId)for(var o in i.data.heroCodes){var c=i.data.heroCodes[o];(h=customui.BaseItemFactory.create()).updateData({type:EEntityType.EEntityTypeHero,code:c}),this.gp_heros.addChild(h),h.scaleX=h.scaleY=.8,h.touchEnabled=!1}else for(var d=0;d<6;d++){var h;(h=customui.BaseItemFactory.create()).resetFixedStyle(EEntityType.EEntityTypeHero),h.img_icon.source="dzr_icon_yingxiong_png",h.scaleX=h.scaleY=.8,h.addTapEvent(function(){return Utils.MsgUtils.addMidMsg("当前未进行探索"),!0}),this.gp_heros.addChild(h)}var l=[];for(var o in a[0]){var p=a[0][o];l.push({id:p[0],rewards:p[2],title:p[4],costs:a[2],exploreId:i.data.exploreId,isExploring:p[0]==i.data.exploreId})}if(this.list_tasks.dataProvider.replaceAll(l),this.isFirst&&(this.isFirst=!1,i.data.exploreId)){var u=278*(i.data.exploreId-1)+288-this.sl_tasks.width;0<u&&egret.setTimeout(function(){this.sl_tasks.viewport.scrollH=u},this,150)}this.bm_quickCount.text=i.data.quickTimes+"/",this.bm_quickMaxTime.text=a[3],this.crb_costs.updateBar(a[2][0]),this.bm_critCount.text=i.data.crit,this.bm_critCount.parent.visible,i.data.exploreId,this.updateBuff()}},e.prototype.updateBuff=function(){var t=this.info;if(t&&t.data){var s=t.content,e=t.data.heroCodes,c={};function i(t){var e=s[1][t],i=0,a="";if(e[2].forEach(function(t){i+=c[t]||0}),0==i)return"continue";e[0]==HerpExploreBuffType.TimeUp?a="icon_buff_sj_png":e[0]==HerpExploreBuffType.RewardUp?a="icon_buff_sy_png":e[0]==HerpExploreBuffType.RewardUp2&&(a="icon_buff_dj_png");var n=new eui.Group;n.width=n.height=52,n.scaleX=n.scaleY=.6;var o=new eui.Image(a);n.addChild(o);var r=new eui.BitmapLabel(i+"");r.font="white_num_fnt",n.addChild(r),r.bottom=r.right=0,d.gp_buff.addChild(n)}this.gp_buff.removeChildren(),e.forEach(function(t){var e=g.Config.allHeroConfig()[t];e&&(c[e.race]?c[e.race]++:c[e.race]=1)});var d=this;for(var a in s[1])i(a)}},e.prototype.activateComponent=function(){var e=this;this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.gp_rewards.$children.length?e.pb_time.value<e.pb_time.maximum?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否确定终止探索并领取奖励",clickCB:function(t){t.type&&e.getReward({code:e.code,id:3,num:0})}}):e.getReward({code:e.code,id:3,num:0}):Utils.MsgUtils.addMidMsg("暂无奖励可领取")},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.GameMVC.activityMed.showHelpDialog(e.info.content[5])},this),this.btn_buff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new p})},this)},e);function e(){var t=m.call(this)||this;return t.isFirst=!0,t.skinName="Activity356Skin",t}g.Activity356=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_quick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=[];t=g.GameMVC.backpackPy.checkEnough(e.data.costs[0],!1)?e.data.costs[0]:e.data.costs[1],g.GameMgr.getInstance().showCommonTipsWin({costTips:"进行快速探索(只获得基础探索收益,不包括额外buff收益)",source:"activity356Quick",cb:!0,cost:t,clickCB:function(t){t.type&&g.GameMVC.activityPy.DoCommonOperation(EActivityType.HeroExplore,e.data.id,4)}})},this),this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.exploreId?Utils.MsgUtils.addMidMsg("请等待探险结束"):PopUpManager.addPopUp({obj:new o({id:e.data.id})})},this)},n.prototype.dataChanged=function(){this.lb_title.text=this.data.title,this.gp_rewards.removeChildren(),g.GameMVC.activityMed.CommonGpAddReward(this.gp_rewards,this.data.rewards,.5),g.GameMVC.backpackPy.checkEnough(this.data.costs[0],!1)?this.ciw_costs.updateItem({cost:this.data.costs[0][0],style:CommonIconStyle.RIGHT}):this.ciw_costs.updateItem({cost:this.data.costs[1][0],style:CommonIconStyle.RIGHT}),this.img_exploring.visible=this.data.isExploring,this.gp_main.top=this.data.id%2==0?0:20},n);function n(){var t=i.call(this)||this;return t.skinName="Activity356TaskItem",t}var r,o=(r=g.ActivityCommonPanel,__extends(s,r),s.prototype.childrenCreated=function(){var a=this;r.prototype.childrenCreated.call(this),this.list_race.itemRenderer=d,this.list_race.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){a.curRace=t.itemIndex+1;var e=a.list_race.dataProvider;e.source.forEach(function(t,e){t.selected=e+1==a.curRace}),e.refresh(),a.updateView()},this);for(var t=[],e=1;e<=6;e++)t.push({icon:HeroRaceConfig[e].raceIconBig,race:e,selected:e==this.curRace});this.list_race.dataProvider=new eui.ArrayCollection(t),this.list_heros.itemRenderer=g.CommonChosePanelItem,this.list_heros.dataProvider=new eui.ArrayCollection,this.list_heros.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){var e=t.item,i=a.curUuids.indexOf(e.info.uuid);if(0<=i)a.curUuids.splice(i,1);else{if(6<=a.curUuids.length)return void Utils.MsgUtils.addMidMsg("已选满6名英雄");a.curUuids.push(e.info.uuid)}a.updateView()},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.curUuids=[],a.updateView()},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){6<=a.curUuids.length?a.getReward({code:a.code,id:1,num:0,info:JSON.stringify(a.curUuids)},function(){a.getReward({code:a.code,id:2,num:a.params.id}),a.hide()}):Utils.MsgUtils.addMidMsg("请选满6名英雄")},this);var i=this.info;if(i&&i.data){var n=i.data.heroUuids,o=g.GameMVC.heroPy.allHeroByUuid;n.forEach(function(t){o[t]&&a.curUuids.push(t)}),this.updateView()}},s.prototype.updateView=function(){var e=this,t=this.info;if(t&&t.data){var i=g.GameMVC.heroPy.allHeroByUuid,a=[];for(var n in i){var o=i[n];o.config.race==this.curRace&&a.push({type:EEntityType.EEntityTypeHero,chosen:0<=this.curUuids.indexOf(o.uuid),info:{uuid:o.uuid,fightCap:o.fightCap}})}a.sort(function(t,e){return t.info.fightCap!=e.info.fightCap?e.info.fightCap-t.info.fightCap:t.info.uuid-e.info.uuid}),this.list_heros.dataProvider.replaceAll(a),this.bm_curChoseNum.text=this.curUuids.length+"";var r={};this.curUuids.forEach(function(t){var e=i[t];e&&(r[e.config.race]?r[e.config.race]++:r[e.config.race]=1)});var s=t.content[1];this.gp_buff.removeChildren(),s.forEach(function(i){var a=0,n="";i[2].forEach(function(t){a+=r[t]||0,n+=HeroRaceConfig[t].name+"或"}),n=n.slice(0,n.length-1);var t=new eui.Label;t.size=18,t.textColor=16773314;var o=[];i[3].split("%s").forEach(function(t,e){switch(t&&o.push({text:t}),e){case 0:o.push({text:n});break;case 1:i[0]==HerpExploreBuffType.TimeUp?o.push({text:i[1]/60+"分钟",style:{textColor:65280}}):o.push({text:i[1]/10+"%",style:{textColor:65280}});break;case 2:o.push({text:"(已激活"}),o.push({text:""+a,style:{textColor:65280}}),o.push({text:"名)"})}}),t.textFlow=o,e.gp_buff.addChild(t)})}},s);function s(t){var e=r.call(this)||this;return e.curRace=1,e.curUuids=[],e.skinName="Activity356HeroChose",e.code=EActivityType.HeroExplore,e.params=t,e}var c,d=(c=eui.ItemRenderer,__extends(h,c),h.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this)},h.prototype.dataChanged=function(){this.width=80,this.img_icon.source=this.data.icon,this.img_selected.visible=this.data.selected},h);function h(){var t=c.call(this)||this;return t.skinName="HeroSelectPanel_TabbarItem",t}var l,p=(l=g.ActivityCommonPanel,__extends(u,l),u.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this),this.list_items.itemRenderer=v,this.updateView()},u.prototype.updateView=function(){var t=this.info;if(t&&t.data){var r=t.content,e=t.data.heroCodes,s=[],c={};function i(t){var i=r[1][t],e=0,a="";i[2].forEach(function(t){e+=c[t]||0,a+=HeroRaceConfig[t].name+"/"}),a=a.slice(0,a.length-1);var n=[];i[3].split("%s").forEach(function(t,e){switch(t&&n.push({text:t}),e){case 0:n.push({text:a});break;case 1:i[0]==HerpExploreBuffType.TimeUp?n.push({text:i[1]/60+"分钟",style:{textColor:65280}}):n.push({text:i[1]/10+"%",style:{textColor:65280}})}});var o="";i[0]==HerpExploreBuffType.TimeUp?o="icon_buff_sj_png":i[0]==HerpExploreBuffType.RewardUp?o="icon_buff_sy_png":i[0]==HerpExploreBuffType.RewardUp2&&(o="icon_buff_dj_png"),s.push({title:a+"光环",desc:n,icon:o,count:e})}for(var a in e.forEach(function(t){var e=g.Config.allHeroConfig()[t];e&&(c[e.race]?c[e.race]++:c[e.race]=1)}),r[1])i(a);this.list_items.dataProvider=new eui.ArrayCollection(s)}},u);function u(){var t=l.call(this)||this;return t.skinName="Activity356BuffDetailPanel",t.code=EActivityType.HeroExplore,t}var y,v=(y=eui.ItemRenderer,__extends(f,y),f.prototype.dataChanged=function(){this.lb_title.text=this.data.title,this.bm_count.text=this.data.count,this.lb_desc.textFlow=this.data.desc,this.img_icon.source=this.data.icon},f);function f(){var t=y.call(this)||this;return t.skinName="Activity356BuffDetailPanelItem",t}}(game=game||{}),function(y){var e,t=(e=y.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){var a=this;e.prototype.childrenCreated.call(this),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.EatMoonCake],this.btn_eat,this,BTN_ICON_NOTICE_POS),UIActionManager.addEffect(this.gp_effect,"common_activity_zhizuobingsha",{},function(t){t&&t.animation&&t.animation.play("changtai")}),UIActionManager.addEffect(this.gp_effect1,"common_activity_zhizuobingsha_hxfg",{offectX:0}),UIActionManager.addEffect(this.gp_effect2,"common_activity_zhizuobingsha_hxfg",{offectX:0}),this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(a.lb_num.text)>a.maxBuyNum&&(a.lb_num.text=a.maxBuyNum.toString())},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){a.setValueTo(Number(a.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){a.setValueTo(Number(a.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){a.setValueTo(Number(a.lb_num.text)+1)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){a.setValueTo(Number(a.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_eat,function(){y.GameMVC.activityMed.showViewByCode(EActivityType.EatMoonCake)}),Utils.TouchUtils.addTouchListener(this.btn_formulate,function(){PopUpManager.addPopUp({obj:new d})}),Utils.TouchUtils.addTouchListener(this.btn_help,function(){y.GameMVC.activityMed.showHelpDialog(a.info.content[2])}),Utils.TouchUtils.addTouchListener(this.btn_creat,function(){if(0!=a.chooseList[0].code||0!=a.chooseList[1].code){var i=Number(a.lb_num.text);if(0<i){function t(){var t=[];for(var e in a.chooseList)0!=a.chooseList[e].code&&t.push(a.chooseList[e].code);y.GameMVC.activityPy.DoCommonOperation(a.code,i,1,function(t){a.btn_creat.touchEnabled=!0,a.info.updateData(t.info),PopUpManager.addPopUp({obj:new n(t)}),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.EatMoonCake])},void 0,JSON.stringify(t))}var e=a.gp_effect.$children[0];e?(e&&e.animation&&e.animation.play("zhuandong"),a.btn_creat.touchEnabled=!1,egret.setTimeout(function(){t(),e&&e.animation&&e.animation.play("changtai")},a,1e3)):t()}else Utils.MsgUtils.addMidMsg("请选择制作个数")}else Utils.MsgUtils.addMidMsg("请先选择材料")}),this.updateView()},i.prototype.setValueTo=function(t){t>this.maxBuyNum&&(t=this.maxBuyNum),t<1&&(t=0),this.lb_num.text=t.toString(),this.chooseList[0].num||this.chooseList[1].num||Utils.MsgUtils.addMidMsg("当前未有材料放入")},i.prototype.updateView=function(){this.updateChoose(),this.updateItem(),0!=this.chooseList[0].num&&0!=this.chooseList[1].num?this.maxBuyNum=this.chooseList[0].num>this.chooseList[1].num?this.chooseList[1].num:this.chooseList[0].num:0==this.chooseList[0].num&&0==this.chooseList[1].num?this.maxBuyNum=0:0!=this.chooseList[0].num&&0==this.chooseList[1].num?this.maxBuyNum=this.chooseList[0].num:0==this.chooseList[0].num&&0!=this.chooseList[1].num&&(this.maxBuyNum=this.chooseList[1].num),this.maxBuyNum=20<this.maxBuyNum?20:this.maxBuyNum;var t=parseInt(this.lb_num.text||"0");if(this.maxBuyNum>t)this.lb_num.text=t+"";else{var e=0<this.maxBuyNum?1:0;this.lb_num.text=e+""}},i.prototype.updateChoose=function(){for(var t=0;t<2;t++){var e=this.chooseList[t].code;if(e){var i=y.GameMVC.backpackPy.AllItemInfo;i[e]?this.chooseList[t].num=i[e][0].num:(this.chooseList[t].num=0,this.chooseList[t].code=0)}else this.chooseList[t].num=0}},i.prototype.updateItem=function(){var a=this,t=this.gp_choose_0.$children[0];t||(t=new r,this.gp_choose_0.addChild(t),Utils.ComponentUtils.registerListener(t,egret.TouchEvent.TOUCH_TAP,function(){var t=[];for(var e in a.chooseList){var i=a.chooseList[e];i.code&&t.push(i.code+"")}PopUpManager.addPopUp({obj:new y.CommonChosePanel({getInfos:function(){var t={},e=y.GameMVC.backpackPy.AllItemInfo;for(var i in e){var a=e[i][0],n=y.Config.itemConfig()[Number(i)];0==n.type&&1==n.subType&&(n.num=a.num,t[""+n.id]={code:n.id,type:EEntityType.EEntityTypeItem,num:a.num})}return t},checkFull:function(t){return 2<=t.length},selectUuids:t,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择材料",text:"青团材料（可选1-2种）"}),closeCB:function(t){t&&t[0]?1==t.length?a.chooseList[0].code&&!a.chooseList[1].code?a.chooseList[0].code=parseInt(t[0]):a.chooseList[1].code&&!a.chooseList[0].code?a.chooseList[1].code=parseInt(t[0]):(a.chooseList[1].code=0,a.chooseList[0].code=parseInt(t[0])):t.forEach(function(t,e){a.chooseList[e].code=t?parseInt(t):0}):(a.chooseList[0].code=0,a.chooseList[1].code=0),a.updateChoose(),a.updateView()}})},this)),t.updateItem({code:this.chooseList[0].code,num:this.chooseList[0].num});var e=this.gp_choose_1.$children[0];e||(e=new r,this.gp_choose_1.addChild(e),Utils.ComponentUtils.registerListener(e,egret.TouchEvent.TOUCH_TAP,function(){var t=[];for(var e in a.chooseList){var i=a.chooseList[e];i.code&&t.push(i.code+"")}PopUpManager.addPopUp({obj:new y.CommonChosePanel({getInfos:function(){var t={},e=y.GameMVC.backpackPy.AllItemInfo;for(var i in e){var a=e[i][0],n=y.Config.itemConfig()[Number(i)];0==n.type&&1==n.subType&&(n.num=a.num,t[""+i]={code:n.id,type:EEntityType.EEntityTypeItem,num:a.num})}return t},checkFull:function(t){return 2<=t.length},selectUuids:t,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择材料",text:"青团材料（可选1-2种）"}),closeCB:function(t){t&&t[0]?1==t.length?a.chooseList[0].code&&!a.chooseList[1].code?a.chooseList[0].code=parseInt(t[0]):(a.chooseList[1].code&&!a.chooseList[0].code||(a.chooseList[0].code=0),a.chooseList[1].code=parseInt(t[0])):t.forEach(function(t,e){a.chooseList[e].code=t?parseInt(t):0}):(a.chooseList[0].code=0,a.chooseList[1].code=0),a.updateChoose(),a.updateView()}})},this)),e.updateItem({code:this.chooseList[1].code,num:this.chooseList[1].num})},i);function i(){var t=e.call(this)||this;return t.chooseList=[{code:0,num:0},{code:0,num:0}],t.maxBuyNum=0,t.skinName="Activity358Skin",t.code=EActivityType.MakeMoonCake,t}y.Activity358=t;var s,n=(s=BasePanel,__extends(a,s),a.prototype.childrenCreated=function(){var e=this;if(s.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_ok,function(){e.hide()}),this.img_result.visible=!1,this.params&&this.params.info){var t=JSON.parse(this.params.info),i=t.result?"common_activity_bingliangyixiazzcg_1":"common_activity_bingliangyixiazzsb_1",a=t.result?"common_activity_bingliangyixiazzcg_2":"common_activity_bingliangyixiazzsb_2";DragonBoneTools.create(a,function(t){(e.ead_model1=t).x=e.gp_effect.width/2,t.y=480,e.gp_effect.addChild(e.ead_model1),e.ead_model1.visible=!1,e.ead_model1.animation.play(),DragonBoneTools.create(i,function(t){(e.ead_model2=t).x=e.gp_effect.width/2,t.y=480,e.gp_effect.addChild(e.ead_model2),e.ead_model2.visible=!0,e.ead_model2.animation.play(),t.addEventListener(dragonBones.EventObject.COMPLETE,function(){e.ead_model1.visible=!0},e)},e,{cacheFrameRate:e.cacheFrameRate})},this,{cacheFrameRate:this.cacheFrameRate})}if(this.params&&this.params.clientReward&&this.params.clientReward.rewards){var n=this.params.clientReward.rewards;for(var o in n){var r=customui.BaseItemFactory.create();r.scaleX=r.scaleY=1,r.updateData({code:n[o].code,type:n[o].type,num:n[o].num}),this.gp_reward.addChild(r)}}},a);function a(t){var e=s.call(this)||this;return e.py=y.AppFacade.getInstance().retrieveProxy(y.ActivityPy.N),e.params=void 0,e.skinName="ActivityMidAutumnMakeResultSkin",e.params=t,e}y.ActivityMidAutumnMakeResultPanel=n;var o,r=(o=eui.Component,__extends(c,o),c.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},c.prototype.updateItem=function(t){this.data=t,this.data.code?(this.gp_empty.visible=!1,this.gp_baseitem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseitem.visible=!1),this.data.num?(this.lb_unlock.visible=!0,this.lb_unlock.text=this.data.num+""):this.lb_unlock.visible=!1},c);function c(){var t=o.call(this)||this;return t.skinName="ActivityMidAutumnMake_ItemSkin",t}y.Activity358Item=r;var v,d=(v=y.ActivityCommonPanel,__extends(h,v),h.prototype.childrenCreated=function(){var e=this;v.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="配 方",this.CommonDaTanChuKuang.onCloseCB=this.hide.bind(this);var t=this.info;if(t&&t.data){var i=y.GameMVC.activityPy.allActivityData[EActivityType.EatMoonCake];if(i&&i.data){var a=t.content,n=i.content,o=JSON.parse(t.data.records),r=[];for(var s in a[0]){var c=a[0][s],d=c[0],h=c[1],l=h[0][2];if(0<=o.indexOf(l)){var p=[],u=[];for(var g in n[0]){var m=n[0][g];m[0]==l&&(p=m[1][0][1],u=m[4])}r.push({moonCakeCode:l,moonRewards:h[0][1],costs:d,rewards1:p,rewards2:u,btnFunc:function(t){e.opperationParams=t.costs,e.hide()}})}}this.list_item.itemRenderer=f,this.list_item.dataProvider=new eui.ArrayCollection(r),this.gp_empty.visible=0==r.length}}},h);function h(){var t=v.call(this)||this;return t.skinName="Activity358FormulatePanel",t.code=EActivityType.MakeMoonCake,t}var l,f=(l=eui.ItemRenderer,__extends(p,l),p.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.baseitem_reward2.parent,"common_jiban",{scaleX:1.5,scaleY:1.5,childIndex:1})},p.prototype.dataChanged=function(){var t=this.data.costs;t[0]&&this.baseitem_cost1.updateData({type:EEntityType.EEntityTypeItem,code:t[0]}),t[1]?(this.baseitem_cost2.visible=!0,this.img_add.visible=!0,this.baseitem_cost2.updateData({type:EEntityType.EEntityTypeItem,code:t[1]}),this.baseitem_cost1.left=226):(this.baseitem_cost2.visible=!1,this.img_add.visible=!1,this.baseitem_cost1.left=273),this.baseitem_reward1.updateData({reward:this.data.rewards1[0]}),this.data.rewards2?(this.baseitem_reward2.updateData({reward:this.data.rewards2[0]}),this.img_or.visible=!0,this.baseitem_reward1.left=424):(this.baseitem_reward2.parent.visible=!1,this.baseitem_reward1.left=473,this.img_or.visible=!1);var e=this.data.moonCakeCode,i=y.Config.itemConfig()[e];i&&(this.img_icon.source=i.icon+"_png",this.lb_name.text=i.name)},p);function p(){var t=l.call(this)||this;return t.skinName="Activity358FormulatePanelItem",t}}(game=game||{}),function(h){var e,t=(e=h.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){var d=this;e.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_ok,function(){if(0!=d.chooseList[0].code){var t=d.chooseList[0].num;0<t&&h.GameMVC.activityPy.DoCommonOperation(d.code,t,d.chooseList[0].code,function(t){d.info.updateData(t.info);var e,i=d.info,a=d.chooseList[0].code,n=i.content[0],o=i.content[1],r=0;for(var s in n)if(n[s][0]==a){r=n[s][2]-1;break}var c=Utils.MathUtils.getRandomInt(0,o.length-1);e=o[r][c],t.clientReward&&h.GameMVC.backpackPy.handleClientReward(t.clientReward,{lb_top_text:e}),d.selectedUuid=[],d.updateChoose(),d.updateItem(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MakeMoonCake])})}else Utils.MsgUtils.addMidMsg("请先选择兑换的冰沙")}),this.updateChoose(),this.updateItem(),UIActionManager.fadeBlink(this.gp_text,!0,!1,1e4),this.heroModel_0.update({model:"hero_009_03",isStatic:!0})},i.prototype.updateChoose=function(){for(var t in this.chooseList)this.chooseList[t].code=0,this.chooseList[t].num=0;var e=0,i=0;if(0<this.selectedUuid.length)for(var t in this.selectedUuid){var a=h.GameMVC.backpackPy.AllItemInfo,n=this.selectedUuid[t],o=h.Config.itemConfig()[Number(n)];e=Number(o.id),i=a[n][0].num,this.chooseList[t].code=e,this.chooseList[t].num=i}},i.prototype.updateItem=function(){var e=this,t=this.gp_choose.$children[0];t||(t=new h.Activity358Item,this.gp_choose.addChild(t),Utils.ComponentUtils.registerListener(t,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var t={},e=h.GameMVC.backpackPy.AllItemInfo;for(var i in e){var a=e[i][0],n=h.Config.itemConfig()[Number(i)];0==n.type&&2==n.subType&&(n.num=a.num,t[""+i]={code:n.id,type:EEntityType.EEntityTypeItem,num:a.num})}return t},checkFull:function(t){return 1<=t.length},selectUuids:e.selectedUuid,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择冰沙",text:"",isShowDi:!1,posY:-50}),closeCB:function(t){e.updateChoose(),e.updateItem()}})},this)),t.updateItem({code:this.chooseList[0].code,num:this.chooseList[0].num})},i);function i(){var t=e.call(this)||this;return t.chooseList=[{code:0,num:0}],t.selectedUuid=[],t.skinName="Activity359Skin",t.code=EActivityType.EatMoonCake,t}h.Activity359=t}(game=game||{}),function(f){var t,e=(t=f.ActivityCommonRechargeListView,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_itemList.itemRenderer=n},i.prototype.getDataList=function(){var p=this;if(this.code){var u=f.ActivityConfig.Config[this.code];if(u){var t=this.info;if(t&&t.data){var g=t.data.targeted,m=(t.data.day,[]),e=JSON.parse(t.content),i=t.data.curCycle;if(i&&u.cycle)for(var a in e[1]){var n=e[1][a];if(n[0]==i){e=n[1];break}}var y=f.AppFacade.getInstance().retrieveProxy(f.RechargePy.N),v=y.goodList;return e.forEach(function(e){var t=e[0],i=e[1],a=e[2];if(!(f.GameMVC.playerPy.playerInfoVO.level<e[3][0]||Utils.TimerManager.getServerOpenDays()<e[3][1])){var n;for(var o in v){var r=v[o];if(t==r.id){n=r;break}}var s="";s=n?u.formatString.format([n.price*Utils.SDKMgr.globalIAPRate]):"找不到商品信息";var c=0;g.forEach(function(t){t.id==e[4]&&(c=t.num)});var d=REWARD_STATUS.CANBUY;a<=c&&(d=REWARD_STATUS.HASBUY);var h=c+"/"+a,l={id:e[4],title:s,tips:h,status:d,rewards:i,activityType:p.code,btnFunc:function(){n?c<a?y.purchase(n,2,e[4],JSON.stringify({activityType:p.code,uuid:e[4]}),{activityType:p.code,uuid:e[4]}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};m.push(l)}}),m.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),m}}}},i.prototype.onDestroy=function(){var t=this.list_itemList.dataProvider.source;for(var e in t){var i=t[e];Utils.LocalStorageUtil.setItem("Activity"+i.activityType+"_"+i.id,"true")}NoticeManager.updateNotice(NT.ALL_ACTIVITY[this.code])},i);function i(){return null!==t&&t.apply(this,arguments)||this}f.Activity85=e;var a,n=(a=f.ActivityCommonListItem,__extends(o,a),o.prototype.dataChanged=function(){a.prototype.dataChanged.call(this),this.imgNew||(this.imgNew=new eui.Image,this.imgNew.source="newactivity_img_xin_png",this.imgNew.top=-6,this.imgNew.left=430,this.gp_root.addChild(this.imgNew));var t=!Utils.LocalStorageUtil.getItem("Activity"+this.data.activityType+"_"+this.data.id);this.imgNew.visible=!!t},o);function o(){return null!==a&&a.apply(this,arguments)||this}}(game=game||{}),function(n){var o,t=(o=n.ActivityCommonPanel,__extends(e,o),e.prototype.onDestroy=function(){o.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.initList()},e.prototype.initList=function(){this.list_itemList.itemRenderer=a},e.prototype.updateView=function(t){var e=this;o.prototype.updateView.call(this,t);var i=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(i):this.list_itemList.dataProvider=new eui.ArrayCollection(i),this.timer&&egret.clearInterval(this.timer);var a=n.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond2(a),this.timer=egret.setInterval(function(){a--,e.bm_time.text=Utils.TimerManager.getFormatBySecond2(a)},this,1e3)},e.prototype.getDataList=function(){var c=this,i=this.info,t=JSON.parse(i.content),d=[];return t.forEach(function(t,e){var r=0==e?i.data.dailyResetList:i.data.weeklyResetList,s=0==e?i.data.dailyTargetedList:i.data.weeklyTargetedList;t.forEach(function(t){var e=t[0],i=t[1],a=t[2],n=REWARD_STATUS.UNAVAILABLE;(0<=r.indexOf(i)||0==i)&&(n=REWARD_STATUS.AVAILABLE),0<=s.indexOf(e)&&(n=REWARD_STATUS.RECEIVED);var o={id:e,title:0==i?"每日福利":"单笔充值"+i+"元可领取",status:n,rewards:a,btnFunc:function(){c.getReward({id:e,code:c.code})}};d.push(o)})}),d},e);function e(){var t=o.call(this)||this;return t.actProxy=n.AppFacade.getInstance().retrieveProxy(n.ActivityPy.N),t.backpackProxy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.code=EActivityType.DailyLogin,t.skinName="Activity93Skin",t}n.Activity93=t;var i,a=(i=eui.ItemRenderer,__extends(r,i),r.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc()},this)},r.prototype.dataChanged=function(){var n=this;this.lb_title.text=this.data.title||"";var t=this.data.rewards;switch(this.gp_reward.removeChildren(),t.forEach(function(t,e){var i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.6,t[0]==EEntityType.EEntityTypeHeroArtifact||t[0]==EEntityType.EEntityTypeHeroEquip){var a={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:t,vo:a})}else i.updateData({reward:t});n.gp_reward.addChild(i)}),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn.label="领取",UIActionManager.setGrey(this.btn,!0),this.btn.skinName="skins.ButtonSkinYellow2";break;case REWARD_STATUS.RECEIVED:this.btn.skinName="skins.ButtonSkinSure",this.btn.label="已领取",UIActionManager.setGrey(this.btn,!1);break;default:this.btn.label="领取",UIActionManager.setGrey(this.btn,!1),this.btn.skinName="skins.ButtonSkinYellow2"}this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-2}):UIActionManager.hideEffect(this.btn)},r);function r(){var t=i.call(this)||this;return t.skinName="Activity93ItemSkin",t}}(game=game||{}),function(l){var h,t=(h=l.ActivityCommonPanel,__extends(e,h),e.prototype.childrenCreated=function(){var r=this;h.prototype.childrenCreated.call(this),this.list_items.dataProvider=new eui.ArrayCollection,this.list_items.itemRenderer=p;var s=this.info;if(s){for(var t in UIActionManager.addEffect(this.gp_effect,"common_activity_yuandanjie_06",{childIndex:0,offectY:60,scaleX:.5,scaleY:.5}),this.config=JSON.parse(s.content),this.config[1]){var e=this.config[1][t],i=e[0],a=e[2],n=e[3][0],o=e[3][2],c=e[4];this.itemMap[i]={id:i,rewards:a,beginPrice:n,onePrice:o,curPrice:n,status:0,endDt:0,bidTime:e[1],playerInfo:{},init:!1,groupId:c,rare:0<e[4]?1:0,priority:e[5],updateFunc:function(){r.updateView()},timeConfig:this.config[0][0]}}var d=this.config[0][0][0];this.bm_time.text=d[0]+"点"+(d[1]||"00")+"分",this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==Object.keys(s.data.record.buyRecords).length&&(s.data.record.buyRecords=[]);var t=s.data.record.buyRecords;t.sort(function(t,e){return e.timestamp-t.timestamp}),l.Config.itemConfig();for(var e=0;e<t.length;e++){var i=t[e],a=void 0;for(var n in r.itemMap){var o=r.itemMap[n];o.id==i.itemId&&(a=o.rewards[0])}t[e].rewards=[{type:a[0],code:a[1],num:a[2]}],t[e].name=t[e].username}PopUpManager.addPopUp({obj:new l.RecordPanel({records:t,title:"购买记录",desc:"记录显示上限为20条"})})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showHelpDialog(r.info.content[6])},this)}},e.prototype.updateView=function(){var e=this,t=this.info;if(t&&t.data){var i=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N).playerInfoVO.playerId,a=t.content,n=t.data.items;for(var o in this.itemMap)(r=this.itemMap[o]).init=!1;if(n)for(var o in n){var r=n[o];this.itemMap[r.confId]&&(this.itemMap[r.confId].curPrice=r.diamonds,this.itemMap[r.confId].status=r.status,0==r.accountDt?this.itemMap[r.confId].endDt=0:this.itemMap[r.confId].endDt=r.accountDt,this.itemMap[r.confId].playerInfo=r.buyerInfo,0==Object.keys(r.players).length&&(r.players=[]),this.itemMap[r.confId].bought=0<=r.players.indexOf(i)&&r.status==AuctionItemStatus.Bidding,this.itemMap[r.confId].init=!0,this.itemMap[r.confId].rare&&r.players.indexOf(i))}var s=[];for(var o in this.itemMap)this.itemMap[o].init&&s.push(this.itemMap[o]);s.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.bought!=e.bought?e.bought-t.bought:t.rare!=e.rare?e.rare-t.rare:t.priority!=e.priority?t.priority-e.priority:t.id-e.id}),this.list_items.dataProvider.replaceAll(s);var c=Utils.TimerManager.checkIsOpen_FormatA(a[0][0]);if(this.timer&&egret.clearInterval(this.timer),c.isOpen){var d=c.endTimeDt-Utils.TimerManager.getServerTime(!1);this.gp_open.visible=!0,this.gp_close.visible=!1,this.timer=egret.setInterval(function(){0<--d?e.bm_leftLime.text=""+Utils.TimerManager.getFormatBySecond1(d):e.updateView()},this,1e3)}else this.gp_open.visible=!1,this.gp_close.visible=!0;var h=this.info.data.record.luckyOne;h?(this.img_nobody.visible=!1,this.role_model.visible=!0,l.GameMVC.playerPy.GetPublicPlayerBaseInfo([h],function(t){e.role_model.update({vo:t[0].baseInfo}),e.lb_luckyName.text=t[0].baseInfo.name})):(this.role_model.visible=!1,this.img_nobody.visible=!0)}},e);function e(){var t=h.call(this)||this;return t.itemMap={},t.skinName="ActivityAuction",t.code=EActivityType.ZoneAuction,t}l.ActivityAuction=t;var i,p=(i=eui.ItemRenderer,__extends(a,i),a.prototype.Bid=function(t,e){var i=this;Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.ZoneAuction,id:t,num:e}).then(function(t){l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N).updateData_View_Reward(EActivityType.ZoneAuction,t),i.data.updateFunc&&i.data.updateFunc()})},a.prototype.childrenCreated=function(){var o=this;this.baseitem=customui.BaseItemFactory.create(),this.baseitem.horizontalCenter=this.baseitem.verticalCenter=0,this.gp_baseitem.addChild(this.baseitem),this.btn_bid.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);if(o.data.playerInfo.username!=t.playerInfoVO.name)if(Utils.TimerManager.checkIsOpen_FormatA(o.data.timeConfig).isOpen){var e=[EEntityType.EEntityTypeMoney,EPropertyType.EPropertyTypeDiamond,o.data.curPrice],i=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),a=o.data.rewards[0][1],n=i.getInfoByCode(a);i.checkEnough([e],!0)&&(i.getInfoByCode(EPropertyType.EPropertyTypeDiamond),l.GameMgr.getInstance().showCommonTipsWin({costTips:"竞拍"+n.info.name+"\n\n（竞拍失败时，钻石会直接返还）",cost:[e],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&o.Bid(o.data.id,o.data.curPrice)}}))}else Utils.MsgUtils.addMidMsg("战区竞拍于12点整开始拍卖");else Utils.MsgUtils.addMidMsg("无法重复拍卖该商品")},this),this.btn_onePrice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N).allActivityData[EActivityType.ZoneAuction].content;if(Utils.TimerManager.checkIsOpen_FormatA(t[0][0]).isOpen){var e=[EEntityType.EEntityTypeMoney,EPropertyType.EPropertyTypeDiamond,o.data.onePrice],i=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),a=o.data.rewards[0][1],n=i.getInfoByCode(a);i.checkEnough([e],!0)&&(i.getInfoByCode(EPropertyType.EPropertyTypeDiamond),l.GameMgr.getInstance().showCommonTipsWin({costTips:"竞拍"+n.info.name+"\n\n",cost:[e],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&o.Bid(o.data.id,o.data.onePrice)}}))}else Utils.MsgUtils.addMidMsg("战区竞拍于12点整开始拍卖")},this)},a.prototype.dataChanged=function(){var e=this;if(this.curId!=this.data.id){this.curId=this.data.id;var t=this.data.rewards[0];l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),this.baseitem.updateData({type:t[0],code:t[1],num:t[2]}),this.price_onePrice.updateItem({cost:[1,1,this.data.onePrice],style:CommonIconStyle.RIGHT})}switch(this.data.rare?this.img_bg.source="zqjp_img_dikuang_png":this.img_bg.source="common_img_kt_4_png",this.img_bought.visible=this.data.bought,this.gp_bidding.visible=1==this.data.status,this.gp_bidDone.visible=2==this.data.status,this.gp_bidding.visible=!1,this.gp_bidDone.visible=!1,this.gp_time.visible=!1,this.img_nobody.visible=!1,this.data.status){case AuctionItemStatus.Bidding:this.price_bid.updateItem({cost:[1,1,this.data.curPrice],style:CommonIconStyle.RIGHT}),this.gp_bidding.visible=!0;var i=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);this.data.playerInfo.playerId==i.playerInfoVO.playerId?(this.btn_bid.label="",this.btn_bid.skinName="skins.ButtonSkinSure",this.btn_bid.scaleX=this.btn_bid.scaleY=.8,this.btn_bid.label="已拍"):(this.btn_bid.label="",this.btn_bid.skinName="skins.ButtonSkinYellow",this.btn_bid.scaleX=this.btn_bid.scaleY=.6,this.btn_bid.label="竞拍"),this.data.endDt?this.gp_time.visible=!0:this.img_nobody.visible=!0;break;case AuctionItemStatus.Bid:this.gp_bidDone.visible=!0}this.data.playerInfo.username?this.lb_name.text="("+this.data.playerInfo.serverId+"服)"+this.data.playerInfo.username:this.lb_name.text="暂无",this.timer&&egret.clearInterval(this.timer);var a=Utils.TimerManager.getServerTime();this.data.endDt>a?this.bm_time.text=Utils.TimerManager.getFormatBySecond1(this.data.endDt-a):this.bm_time.text="已结束",this.timer=egret.setInterval(function(){var t=Utils.TimerManager.getServerTime();e.data.endDt>t?e.bm_time.text=Utils.TimerManager.getFormatBySecond1(e.data.endDt-t):e.bm_time.text="已结束"},this,1e3)},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityAuctionItem",t}var n,o=(n=l.ActivityCommonView,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this),this.btnFunc=function(){l.MainJumpConfig.jumpTo("CITY"),l.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.ZoneAuction1)}},r.prototype.updateView=function(){var t=this,e=this.info;if(e&&e.data){this.timer&&egret.clearInterval(this.timer);var i=l.ActivityConfig.getActivityEndDt(EActivityType.ZoneAuction)-Utils.TimerManager.getServerTime();i?this.timer=egret.setInterval(function(){0<--i?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(i):t.updateView()},this,1e3):(this.bm_time.text="",egret.setTimeout(function(){t.updateView()},this,5e3))}},r);function r(){var t=n.call(this)||this;return t.skinName="ActivityAuctionEntry",t.code=EActivityType.ZoneAuction,t}l.ActivityAuctionEntry=o}(game=game||{}),function(o){var e,t=(e=o.ActivityCommonListView,__extends(i,e),i.prototype.initList=function(){var t=this;this.list_itemList.itemRenderer=a;var e=new eui.TileLayout;e.requestedColumnCount=2,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.horizontalGap=40,e.verticalGap=40,e.paddingTop=0,e.paddingLeft=35,e.paddingRight=0,e.columnAlign=eui.ColumnAlign.LEFT,this.list_itemList.layout=e;var i=new eui.Image;i.source="newactivity_img_ditu_png",i.top=this.gp_title.height,this.addChildAt(i,0),this.img_arrow.source="sycx_img_jiantou_png",this.img_arrow.rotation=90,this.img_arrow.bottom=0,this.img_arrow.horizontalCenter=0,this.img_arrow.scaleX=this.img_arrow.scaleY=1.2,this.img_arrow.visible=!1,egret.Tween.get(this.img_arrow,{loop:!0}).to({bottom:10},500).to({bottom:0},500),this.addChild(this.img_arrow),this.sl_root.addEventListener(egret.Event.CHANGE,function(){t.img_arrow.visible=t.sl_root.viewport.scrollV<t.list_itemList.contentHeight-t.sl_root.height},this),this.sl_root.once(egret.Event.ENTER_FRAME,function(){t.img_arrow.visible=t.sl_root.viewport.scrollV<t.list_itemList.contentHeight-t.sl_root.height},this),this.sl_root.top=280,this.sl_root.height=720,this.bm_time.y-=25},i.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)}},i.prototype.getDataList=function(){var p=this;if(this.code){var u=o.ActivityConfig.Config[this.code];if(u){var t=this.info;if(t&&t.data){var g=t.data.targeted,m=(t.data.day,[]),e=JSON.parse(t.content),i=t.data.curCycle;if(i&&u.cycle)for(var a in e[1]){var n=e[1][a];if(n[0]==i){e=n[1];break}}var y=o.AppFacade.getInstance().retrieveProxy(o.RechargePy.N),v=y.goodList;return e.forEach(function(t){var e,i=t[0],a=t[1],n=t[2],o=t[3];for(var r in v){var s=v[r];if(i==s.id){e=s;break}}var c="";c=e?u.formatString.format([e.price]):"找不到商品信息";var d=0;g.forEach(function(t){t.id==i&&(d=t.num)});var h=REWARD_STATUS.CANBUY;n<=d&&(h=REWARD_STATUS.HASBUY);var l={id:i,title:c,tips:d+"/"+n+"次",status:h,rewards:a,GoodInfo:e,icon:o,btnFunc:function(){e?d<n?y.purchase(e,2,"",JSON.stringify({activityType:p.code}),{activityType:p.code}):Utils.MsgUtils.addMidMsg("购买次数已达上限"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};m.push(l)}),m.sort(function(t,e){return t.status!=e.status?t.status-e.status:e.id-t.id}),m}}}},i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.img_arrow=new eui.Image,t}o.ActivityAwakenGiftBag=t;var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.gp_double.visible=!1,this.scaleX=this.scaleY=1.1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data&&t.data.btnFunc&&t.data.btnFunc(t.data)},this);var e=new eui.Image;e.source="jxzl_img_cishudi_png",e.left=e.bottom=20,e.scaleX=e.scaleY=.9,this.addChild(e),this.bm_tip.rotation=30,this.bm_tip.left=18,this.bm_tip.bottom=18,this.bm_tip.scaleX=this.bm_tip.scaleY=.95,this.bm_tip.font="white_num_fnt",this.addChild(this.bm_tip)},r.prototype.dataChanged=function(){n.prototype.dataChanged.call(this),this.bm_tip.text=this.data.tips;var t=this.data.rewards;for(var e in t){var i=t[e],a=o.GeneralConfig.getEntityConfigByCode(i[0],i[1]);a&&(i[0]==EEntityType.EEntityTypeMoney&&i[1]==EPropertyType.EPropertyTypeDiamond?this.blb_extra.text=i[2]:(this.img_canGet.source=a.icon+"_png",this.blb_obtain.text=i[2]))}if(this.data.GoodInfo)switch(this.blb_price.text=""+this.data.GoodInfo.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,this.data.GoodInfo.price){case 648:this.img_bg.source="chongzhi_img_wupinkuan01_png";break;case 328:this.img_bg.source="chongzhi_img_wupinkuan02_png";break;default:this.img_bg.source="chongzhi_img_wupinkuan03_png"}this.data.status==REWARD_STATUS.HASBUY?UIActionManager.setGrey(this,!0):UIActionManager.setGrey(this,!1),this.img_icon.source=this.data.icon+"_png"},r);function r(){var t=n.call(this)||this;return t.bm_tip=new eui.BitmapLabel,t.skinName="RechargeView_RechargeItem",t}}(game=game||{}),function(T){var i,h=(i=BaseFull,__extends(b,i),b.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.braveInfo=this.activityPy.allActivityData[EActivityType.BraveBook],this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.braveBookBuy,this),this.btn_treasure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.braveInfo.data;t&&!t.isBuy?Utils.MsgUtils.addMidMsg("请先购买勇士令状"):(e.gp_achivements.visible=!1,e.gp_tasks.visible=!1,T.AppFacade.getInstance().showSubView(T.BraveBookMediator.N,T.BraveBookMediator.SV.BAOXIANG,{closeCB:function(){e.gp_achivements.visible=!0,e.gp_tasks.visible=!0}}))},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){T.MainJumpConfig.jumpTo()},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToNext(function(){e.pageBtnStatus()})},this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){T.AppFacade.getInstance().showSubView(T.HeroMediator.N,T.HeroMediator.SV.HERO_DETAIL,{code:this.maxRewardCode})},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToLast(function(){e.pageBtnStatus()})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.taskPy.getBraveLevelReward({levels:e.noRewardList,cb:function(){e.updateView()}})},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){e.isFromCurTouchBegin&&Math.abs(e.startPosX-t.stageX)>e.moveGuild&&(e.isFromCurTouchBegin=!1,0<t.stageX-e.startPosX?e.sl_reward.scrollToLast():e.taskPy.isBraveBookMax||e.sl_reward.scrollToNext(),e.startPosX=void 0)},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){e.isFromCurTouchBegin=!0,e.startPosX=t.stageX},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_END,function(t){e.isFromCurTouchBegin=!1,e.startPosX=void 0},this),DragonBoneTools.create("common_zhihuanhou",function(t){t.x=this.gp_rewarddi.width/2,t.y=this.gp_rewarddi.height/2,t.scaleX=t.scaleY=.6,t.animation.play(),this.gp_rewarddi.addChild(t)},this);var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.RIGHT,this.list_rewards.layout=t,this.cuIndex=0,this.taskPy.nextBraveBook=1,this.progressBar.minimum=0,this.initPageScroller(),this.initTaskList(),this.initRewardsList(),this.upateLeftTime()},b.prototype.braveBookBuy=function(){var t=this.braveInfo.data,e=T.AppFacade.getInstance().retrieveProxy(T.RechargePy.N),i=e.goodList,a=t&&!t.isBuy?this.braveInfo.content[0]:this.braveInfo.content[3];if(t&&!t.isBuy){var n=void 0;for(var o in i){var r=i[o];if(r.id==a[0]){n=r;break}}e.purchase(n)}},b.prototype.initTaskList=function(){this.list_tasks.itemRenderer=c},b.prototype.initRewardsList=function(){this.list_rewards.itemRenderer=p,UIActionManager.hideScrollerBar(this.sl_reward)},b.prototype.updateReward=function(){var t=T.Config.braveBookLevelConfigs(),e=[],i=[];for(var a in this.noRewardList=[],t){var n=t[a];""!=n.rewards&&(e.push({level:a,rewards:n.rewards,isSure:this.curlevel>=Number(a)}),this.curlevel>=Number(a)&&i.push(Number(a)))}for(var o in i){var r=i[o];this.taskPy.braveBookTask.levelTargeted&&-1!=this.taskPy.braveBookTask.levelTargeted.indexOf(r)||this.noRewardList.push(r)}var s=this.list_rewards.dataProvider;s?s.replaceAll(e):this.list_rewards.dataProvider=new eui.ArrayCollection(e);var c=this.btn_get.iconDisplay;c.scale9Grid=new egret.Rectangle(5,5,35,35),c.width=this.btn_get.width;var d=this.btn_get.labelDisplay,h=this.braveInfo.data;d.font="btn_fnt_yellow2_fnt",d.text=this.noRewardList.length+"件未领取奖励",this.bp_get.visible=!(h&&!h.isBuy)&&0<this.noRewardList.length,this.JumpIndexReward()},b.prototype.JumpIndexReward=function(){var t=this;0<this.taskPy.nextBraveBook&&(this.cuIndex<=0&&this.sl_reward.curPage++,this.sl_reward.scrollerToPage(0<this.cuIndex?this.sl_reward.curPage+1:0,!0,function(){t.once(egret.Event.ENTER_FRAME,function(){0<t.taskPy.nextBraveBook&&(t.cuIndex=1,t.JumpIndexReward())},t)})),this.taskPy.nextBraveBook=1},b.prototype.initPageScroller=function(){this.list_chapters.itemRenderer=t,UIActionManager.hideScrollerBar(this.pageScroller)},b.prototype.taskinfoCallback=function(){var t=this.taskPy.braveBookTask;this.curlevel=t.level,this.blb_level.text=t.level.toString(),this.progressBar.value=t.exp;var e=T.Config.braveBookLevelConfigs()[t.level];this.progressBar.maximum=e.exp;var i=T.Config.braveBookLevelConfigs(),a=0;for(var n in i)a++;this.taskPy.braveBookTask.levelTargeted.sort(function(t,e){return e-t});for(var o=this.taskPy.braveBookTask.levelTargeted[0]==a?a:(this.taskPy.braveBookTask.levelTargeted[0]?this.taskPy.braveBookTask.levelTargeted[0]:0)+1;o<=a;o++){var r=i[o];if(0<r.isShow){this.maxlevl=i[a].level,this.lb_tips.text="勇士等级达到"+r.level+"级带我回家哦！";var s=JSON.parse(r.rewards)[0];return this.maxRewardCode=s[1],void(s[0]==EEntityType.EEntityTypeHero?(this.cu_model.visible=!0,this.baseitem.visible=!1,this.cu_model.update({isStatic:!0,code:s[1]})):(this.cu_model.visible=!1,this.baseitem.visible=!0,this.baseitem.updateData({code:s[1],num:s[2]}),this.baseitem.img_bg.visible=!1,this.baseitem.img_frame.visible=!1,this.baseitem.gp_star_item.visible=!1,this.baseitem.blb_num.visible=!1,this.baseitem.blb_level.visible=!1))}}},b.prototype.updateView=function(t){this.params=t,this.effect=void 0,!b.isInit&&this.curlevel!=this.taskPy.braveBookTask.level&&this.curlevel<this.taskPy.braveBookTask.level&&DragonBoneTools.playOnce({effectName:"common_ysdjts",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){}}),this.taskinfoCallback(),this.updateReward(),this.braveInfo=this.activityPy.allActivityData[EActivityType.BraveBook];var e,i=this.braveInfo.data,a=this.braveInfo.content[1];UIActionManager.setGrey(this.btn_buy,!(i&&!i.isBuy)),this.btn_buy.touchEnabled=i&&!i.isBuy,this.img_notice_2.visible=this.backPackProxy.checkEnough([a[0][1][0]],!1),t&&t.sectionCode&&t.chapterCode&&(e={sectionCode:t&&t.sectionCode,chapterCode:t&&t.chapterCode}),this.updateTaskData(e),this.pageBtnStatus()},b.prototype.updateTaskData=function(t){var e=this;this.braveInfo,this.allTasksArray=[],this.pageArray=[],this.scrollerArray=[];var i=T.Config.braveBook(),a=[],n=[],o=1,r=!1;this.finishNum=0;var s=this.remainNum=0,c=this.taskPy.braveBookTask.starTargeted;for(var d in i){var h=i[d],l=JSON.parse(h.target)[0],p={code:h.code,current:0,type:h.type,subType:h.subType,sectionCode:h.sectionCode,chapterCode:h.chapterCode,total:l,desc:h.desc,finish:!1,canGet:!1,rewards:h.rewards,isTarget:!1,jumpModule:h.jumpModule,curSection:0,unlock:!1},u=this.taskPy.getBraveTask(TaskType.BraveBook,h.code),g=!1;if(g=h.subType==TaskSubType.ArenaChallengeRank?u&&0<u.key&&u.key<=l||!1:u&&u.key>=l||!1,p.canGet=g,p.isTarget=u&&u.isTarget||!1,p.finish=g&&1==p.isTarget,p.current=u&&u.key||0,u&&(p.unlock=!0,s+=1,b.isInit&&(this.sectionId=Math.max(h.sectionCode,this.sectionId),this.chapterId=Math.max(h.chapterCode,this.chapterId))),g&&!p.isTarget&&(this.remainNum+=1),p.finish&&(this.finishNum+=1),n.push(p),o%3==0){r&&(this.sectionId=Math.max(h.sectionCode,this.sectionId),this.chapterId=Math.max(h.chapterCode,this.chapterId),r=!1);var m=this.params&&this.params.unresetChapter;!b.isInit&&n[0].finish&&n[1].finish&&n[2].finish&&!m&&(r=!0),this.allTasksArray.push(n),a.push(n),n=[]}if(o%27==0){var y=!1;if(0<c.length)for(var v=0,f=c;v<f.length;v++)if(f[v]==h.chapterCode){y=!0;break}this.pageArray.push({array:a,finishNum:this.finishNum,remainNum:this.remainNum,unLockNum:s,isStarGet:y}),this.finishNum=0,s=this.remainNum=0,a=[],++this.pageNumber}++o}b.isInit&&(b.isInit=!1),t&&(t.sectionCode&&t.chapterCode||!t.unresetChapter)&&(this.sectionId=t.sectionCode||b.sectionData.sectionId,this.chapterId=t.chapterCode||b.sectionData.chapterId),this.scrollerArray=this.allTasksArray[this.sectionId-1],b.sectionData={sectionId:this.sectionId,chapterId:this.chapterId};var _=this.list_tasks.dataProvider;_?_.replaceAll(this.scrollerArray):this.list_tasks.dataProvider=new eui.ArrayCollection(this.scrollerArray);var A=this.list_chapters.dataProvider;A?A.replaceAll(this.pageArray):this.list_chapters.dataProvider=new eui.ArrayCollection(this.pageArray),this.chapterId-1!=this.pageScroller.curPage&&egret.setTimeout(function(){e.pageScroller.scrollerToPage(e.chapterId-1,!0,function(){e.pageBtnStatus()})},this,300)},b.prototype.upateLeftTime=function(){var t=this,e=this.braveInfo.endDt-Utils.TimerManager.getServerTime();0<e&&(this.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(e)),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=--e&&(t.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(e))},this,1e3)},b.prototype.pageBtnStatus=function(){var r=this;this.btn_last.visible=0!=this.pageScroller.curPage;var t=0<this.pageArray.length&&27<=this.pageArray[this.pageScroller.curPage].unLockNum&&this.pageArray[this.pageScroller.curPage+1]&&0<this.pageArray[this.pageScroller.curPage+1].unLockNum,e=this.pageScroller.curPage==this.pageNumber-1;function i(t,e){var i=r.pageArray.length-1;if(e<0||i<t)return!1;for(var a=!1,n=t;t<=n&&n<=e;){var o=r.pageArray[n];a=0<o.remainNum||27<=o.finishNum&&!o.isStarGet||a,++n}return a}this.btn_next.visible=!(e||!t),this.img_notice_0.visible=0<this.pageScroller.curPage&&0<this.pageArray[this.pageScroller.curPage-1].remainNum&&this.btn_last.visible||i(0,this.pageScroller.curPage-1),this.img_notice_1.visible=this.pageScroller.curPage<this.pageArray.length-1&&0<this.pageArray[this.pageScroller.curPage+1].remainNum&&this.btn_next.visible||i(this.pageScroller.curPage+1,this.pageArray.length-1)},b.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),this.params&&this.params.closeCB&&this.params.closeCB(),b.isInit=!0},b.isInit=!0,b);function b(){var t=i.call(this)||this;return t.pageIndex=0,t.pageNumber=0,t.isFirst=!0,t.curlevel=0,t.activityPy=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N),t.taskPy=T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),t.backPackProxy=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),t.allTasksArray=[],t.pageArray=[],t.scrollerArray=[],t.finishNum=0,t.remainNum=0,t.sectionId=1,t.chapterId=1,t.noRewardList=[],t.maxlevl=0,t.maxRewardCode=0,t.moveGuild=70,t.skinName="BraveBookViewSkin",t.taskPy.getBraveBookTask(),t}T.ActivityBraveBookView=h;var e,t=(e=eui.ItemRenderer,__extends(a,e),a.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),27<=i.data.finishNum&&!i.starResult){var t=T.Config.braveBookstarRewardConfigs()[i.data.array[0][0].chapterCode];T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N).getBraveBookStarReward({code:t.code,cb:function(){i.btn_box.icon="_yslz_m_json.yslz_img_baoxiangdakai",i.btn_box.touchEnabled=!1}})}else{var e=T.Config.braveBookstarRewardConfigs()[i.data.array[0][0].chapterCode];T.AppFacade.getInstance().showSubView(T.CommonMediator.N,T.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.rewards),type:T.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}},this)},a.prototype.dataChanged=function(){this.lb_pro.text=this.data.finishNum+"/27",T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),this.img_notice.visible=!1,this.gp_effect.removeChildren(),DragonBoneTools.create("common_buxiudebaozang_xbx",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.animation.play(),this.gp_effect.addChild(t)},this),egret.Tween.removeTweens(this.btn_box),this.btn_box.touchEnabled=!0,this.btn_box.icon="_yslz_m_json.yslz_img_baoxiang",27<=this.data.finishNum&&!this.data.isStarGet?(this.img_notice.visible=!0,UIActionManager.douDong(this.btn_box)):27<=this.data.finishNum&&this.data.isStarGet&&(this.btn_box.icon="_yslz_m_json.yslz_img_baoxiangdakai",this.btn_box.touchEnabled=!1);for(var t=0;t<this.data.array.length;++t){var e=this.data.array[t];this.data.array,this["chapter_"+t].updateData(e)}},a);function a(){var t=e.call(this)||this;return t.starResult=!1,t.skinName="BraveBookPageSkin",t}T.BraveBook_page=t;var n,o=(n=eui.Component,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.img_notice.touchEnabled=!1,this.btn_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.switchChapter()},this)},r.prototype.switchChapter=function(){this.unlock?T.AppFacade.getInstance().retrieveMediator(T.BraveBookMediator.N).updateView(T.BraveBookMediator.SV.MAIN,{sectionCode:this.data[0].sectionCode,chapterCode:this.data[0].chapterCode}):Utils.MsgUtils.addMidMsg("未解锁！")},r.prototype.updateData=function(t){this.data=t;var e=h.sectionData,i=!1,a=0;this.unlock=!1;for(var n=0;n<3;++n){var o=this.data[n];o.canGet&&!o.isTarget&&(i=!0);var r=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N),s=JSON.parse(T.Config.constConfig().DefaultAvatar.constValue)[0],c=r.playerInfoVO.avatar||s;this.img_avatar.source=ResourceUtils.png(c),this.gp_top.visible=e.sectionId==o.sectionCode&&e.chapterId==o.chapterCode,this.touchEnabled=!this.gp_top.visible,this.touchChildren=!this.gp_top.visible,this.img_model.visible=!1,this.unlock=this.unlock||o.unlock,this["img_"+n].source="yslz_img_xingxing2_png",o.finish&&++a}this.img_notice.visible=!this.gp_top.visible&&i;for(var d=0;d<a;++d)this["img_"+d].source="_border_m_json.common_icon_xingji";this.img_suo.visible=!this.unlock,this.btn_icon.touchEnabled=this.unlock,this.gp_top.visible&&(this.gp_move.y=2,UIActionManager.jumping(this.gp_move))},r.prototype.onOPReset=function(){},r.prototype.onOPComeBack=function(t,e){},r.prototype.onOPClean=function(){},r.prototype.onOPCheck=function(t){},r);function r(){var t=n.call(this)||this;return t.taskPy=T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),t.unlock=!1,t.skinName="ChapterItemViewSkin",t}T.ChapterItemView=o;var s,c=(s=eui.ItemRenderer,__extends(d,s),d.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapCallBack,this)},d.prototype.tapCallBack=function(){if(!this.data.isTarget)if(this.data.canGet){var t=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[EActivityType.BraveBook].data;t&&t.isBuy?T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N).GetTaskReward(this.data.type,this.data.code,function(){},{unresetChapter:!0}):Utils.MsgUtils.addMidMsg("请先购买勇士令状！")}else if(this.data.jumpModule){if(!Utils.UnlockMgr.checkPass(this.data.jumpModule).allow)return;T.MainJumpConfig.jumpTo(this.data.jumpModule)}else Utils.MsgUtils.addMidMsg("无跳转途径")},d.prototype.dataChanged=function(){this.data.subType==TaskSubType.ArenaChallengeRank?(this.progressBar.maximum=1,this.data.canGet?this.progressBar.value=1:this.progressBar.value=0):(this.progressBar.maximum=this.data.total,this.data.canGet?this.progressBar.value=this.data.total:this.progressBar.value=this.data.current),this.lb_info.text=this.data.desc,this.data.isTarget?(this.btn_go.visible=!1,this.btn_gone.visible=!0):(this.btn_go.visible=!0,this.btn_gone.visible=!1,this.btn_go.label=this.data.canGet?"领取":"前往",this.data.canGet?UIActionManager.addEffect(this.btn_go,"common_lingquanniu",{scaleX:.9,scaleY:.9}):UIActionManager.hideEffect(this.btn_go));var t=JSON.parse(this.data.rewards)[0];this.baseItem.updateData({reward:t}),this.baseItem.touchEnabled=!1,this.validateNow()},d);function d(){var t=s.call(this)||this;return t.taskPy=T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),t.skinName="BraveBookItemSkin",t}T.BraveBookItem=c;var l,p=(l=eui.ItemRenderer,__extends(u,l),u.prototype.childrenCreated=function(){var t=this;l.prototype.childrenCreated.call(this);var e=T.Config.braveBookLevelConfigs();for(var i in e)this.index++;this.gp_item.cacheAsBitmap=!1,this.img_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.isSure?-1==t.taskPy.braveBookTask.levelTargeted.indexOf(Number(t.data.level))?t.taskPy.getBraveLevelReward({levels:[Number(t.data.level)],cb:function(){T.AppFacade.getInstance().retrieveMediator(T.BraveBookMediator.N).updateView(T.BraveBookMediator.SV.MAIN)}}):Utils.MsgUtils.addMidMsg("已领取该奖励"):Utils.MsgUtils.addMidMsg("未达到解锁条件")},this)},u.prototype.dataChanged=function(){this.taskPy.isBraveBookMax=this.index==this.data.level,this.img_btn.touchEnabled=this.gp_item.visible=!0;var t=JSON.parse(this.data.rewards),e=new eui.TileLayout;e.requestedColumnCount=Math.ceil(t.length/2),t.length<=2?e.verticalAlign=egret.VerticalAlign.BOTTOM:e.verticalAlign=egret.VerticalAlign.TOP,this.gp_item.layout=e,this.gp_item.removeChildren();for(var i=0,a=t;i<a.length;i++){var n=a[i],o=customui.BaseItemFactory.create(21);o.updateData({type:n[0],code:n[1],num:n[2]}),o.scaleX=.65,o.scaleY=.65,this.gp_item.addChild(o)}2<t.length?(this.img_btn.label=this.data.level+"级奖励",this.img_btn.icon="_yslz_m_json.yslz_img_sztd1"):(this.img_btn.icon="_yslz_m_json.yslz_img_sztd2",this.img_btn.label=this.data.level),this.img_btn.iconDisplay.width=this.img_btn.width=this.width=this.gp_item.width+10,this.img_get.visible=this.data.isSure,this.data.isSure&&(this.img_get.source=-1==this.taskPy.braveBookTask.levelTargeted.indexOf(Number(this.data.level))?"_yslz_m_json.yslz_txt_dacheng":"_yslz_m_json.yslz_txt_yiling"),this.taskPy.nextBraveBook=this.index==this.data.level?0:this.taskPy.nextBraveBook*(-1==this.taskPy.braveBookTask.levelTargeted.indexOf(Number(this.data.level))?0:1)},u);function u(){var t=l.call(this)||this;return t.index=0,t.taskPy=T.AppFacade.getInstance().retrieveProxy(T.TaskPy.N),t.skinName="BraveBookRewardItemSkin",t}}(game=game||{}),function(C){var e,d=(e=BaseFull,__extends(E,e),E.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),this.params&&this.params.closeCB&&this.params.closeCB(),C.ActivityBraveBookView.isInit=!0,Utils.AssetsMgr.destroyGroup("group_brave_book")},E.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),DragonBoneTools.create("common_zhihuanhou",function(t){t.x=this.gp_rewarddi.width/2,t.y=this.gp_rewarddi.height/2,t.scaleX=t.scaleY=.6,t.animation.play(),this.gp_rewarddi.addChild(t)},this);var t=this.taskPy.NewBraveBooklevelParams;t&&!t.isShow&&(t.level!=t.preLevel&&Utils.MsgUtils.NewBraveBookShenjiEffect(t.preLevel,t.level),this.taskPy.NewBraveBooklevelParams=void 0),this.progressBar.labelDisplay.visible=!1,this.progressBar.minimum=0,this.progressBar.maximum=E.MAXTASKNUM,this.list_ch_items.itemRenderer=C.BravebookTaskItem,this.addListenerEvents(),this.upateLeftTime()},E.prototype.addListenerEvents=function(){var r=this;function t(e){i["chapter_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=r.taskInfoArr[e-1];E.sectionData=t[0].sectionCode,r.updateChapter()},i)}this.btn_treasure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.BraveBookMediator.N,C.BraveBookMediator.SV.BAOXIANG)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.hide()},this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.maxRewardCode&&C.AppFacade.getInstance().showSubView(C.HeroMediator.N,C.HeroMediator.SV.HERO_DETAIL,{code:this.maxRewardCode})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.oneKeyGetAllRewards()},this),this.btn_rewards.$addListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.BraveBookMediator.N,C.BraveBookMediator.SV.BRAVEBOOKREWARDS,{data:r.taskInfoArr,doneCB:function(){r.optimizationView(!0)}}),r.optimizationView(!1)},this),this.btn_getExp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.BraveBookMediator.N,C.BraveBookMediator.SV.GETWAYS,{type:EExpType.EExpTypeNewBraveBook,code:EExpType.EExpTypeVip})},this),this.btn_baoxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().retrieveProxy(C.TaskPy.N);var t,e=C.Config.newBraveBookRewardConfig();for(var i in e){var a=r.taskInfoArr[0][0].chapterCode,n=e[i];if(n.chapterCode==a&&n.type==r.taskType){t=n;break}}if(t)if(r.finishNum>=E.MAXTASKNUM)C.AppFacade.getInstance().retrieveProxy(C.TaskPy.N).getNewBraveBookStarReward({code:t.code,type:r.taskType,cb:function(){r.gp_eff.removeChildren(),r.updateView({LevelEffect:!0})}});else{var o=JSON.parse(t.rewards);C.AppFacade.getInstance().showSubView(C.CommonMediator.N,C.CommonMediator.SV.REWARD_PANEL,{rewards:o,type:C.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN,bottom_tips_offsetY:25,bottom_tips:o&&"勇士令状等级+"+o[0][2]})}else Utils.MsgUtils.addMidMsg("没有该星级奖励配置")},this),this.btn_detial.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new C.HelpDialog({moduleId:MODULE.ActivityNewBrave})})},this);for(var i=this,e=1;e<=5;++e)t(e)},E.prototype.viewHistoryChapter=function(t){var e=this,i=t;this.taskPy.newBraveBookTaskHistory[i]&&this.latestChapter!=i?this.updateView({history:!0,condKey:i}):this.taskPy.getTaskInfo({type:this.taskType,condKey:i},function(){e.updateView({history:!0,condKey:i})})},E.prototype.taskinfoCallback=function(){this.taskPy.newBraveBookTask.level;var t=this.activityPy.allActivityData[EActivityType.NewBraveBook],e=C.Config.newBraveBookLevelConfig(t&&t.content[4]);if(this.LevelRewards.length<=0){for(var i in e){var a=e[i];1==a.isShow&&1==a.isRare&&this.LevelRewards.push(a)}this.LevelRewards.sort(function(t,e){return 0<t.level-e.level?-1:1})}var n,o=this.taskPy.newBraveBookTask.levelTargeted;if(o.sort(function(t,e){return 0<t-e?-1:1}),0<o.length)for(var r=0;r<this.LevelRewards.length-1;++r){var s=this.LevelRewards[r],c=this.LevelRewards[r+1];if(o[0]<s.level&&o[0]>=c.level||o[0]>=s.level&&0==r){n=s;break}if(o[0]<c.level&&r==this.LevelRewards.length-2){n=c;break}}else n=this.LevelRewards[this.LevelRewards.length-1];var d=JSON.parse(n.rewards)[0][1];this.lb_reward_tip.text="勇士等级达到"+n.level+"级带我回家哦！",this.maxRewardCode!=d&&(this.maxRewardCode=d,this.cu_model.visible=!0,this.cu_model.update({isStatic:!0,code:this.maxRewardCode}))},E.prototype.optimizationView=function(t){this.gp_task.visible=t},E.prototype.updateView=function(t){var e=this.taskPy.NewBraveBooklevelParams;e&&!e.isShow&&t&&t.LevelEffect&&(e.preLevel!=e.level&&Utils.MsgUtils.NewBraveBookShenjiEffect(e.preLevel,e.level),this.taskPy.NewBraveBooklevelParams=void 0),this.params=t;var i=this.activityPy.allActivityData[EActivityType.NewBraveBook],a=i.content[3];if(a&&a==TaskType.NewNewBraveBook?this.taskType=TaskType.NewNewBraveBook:this.taskType=TaskType.NewBraveBook,0==this.maxChapterNum){var n=C.Config.newBraveBookTasksConfig(),o=0;for(var r in n)n[r].type==this.taskType&&++o%20==0&&++this.maxChapterNum}this.braveInfo=this.taskPy.allTasks[this.taskType],this.taskinfoCallback();var s=i.data,c=i.content[1],d=this.activityPy.allActivityData[EActivityType.NewBraveBook],h=C.Config.newBraveBookLevelConfig(d&&d.content[4]),l=this.taskPy.newBraveBookTask&&this.taskPy.newBraveBookTask.level||0,p=0;for(var u in h){var g=h[u];g.rewards&&""!=g.rewards.rewards&&l>=g.level&&(!this.taskPy.newBraveBookTask.levelTargeted||-1==this.taskPy.newBraveBookTask.levelTargeted.indexOf(g.level))&&++p}if(this.gp_notice_1.visible=0<p,this.blb_level_num.text=""+p,this.lb_playerLevel.text=""+l,this.img_notice_2.visible=this.backPackProxy.checkEnough([c[0][1][0]],!1),t&&t.history||this.curChapter<this.latestChapter)this.lb_desc.text=this.tips_Tex[2],this.btn_get.label="一键领取";else{this.lb_desc.text=s&&s.isBuy?this.tips_Tex[2]:this.tips_Tex[1];var m=i&&i.data&&!i.data.isBuy?i.content[0]:i.content[3],y=C.GameMVC.rechargePy.getGoodInfo(m[0]);1<Utils.SDKMgr.globalIAPSuffixLen?this.btn_get.label=s&&s.isBuy?"一键领取":""+y.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:this.btn_get.label=s&&s.isBuy?"一键领取":""+y.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"激活"}this.updateTaskData(t),this.updateChapterTasks(t)},E.prototype.oneKeyGetAllRewards=function(){var t=this,e=this.activityPy.allActivityData[EActivityType.NewBraveBook],i=C.AppFacade.getInstance().retrieveProxy(C.RechargePy.N),a=i.goodList,n=e&&e.data&&!e.data.isBuy?e.content[0]:e.content[3];if(e&&e.data&&!e.data.isBuy){var o=void 0;for(var r in a){var s=a[r];if(s.id==n[0]){o=s;break}}o?i.purchase(o):Utils.MsgUtils.addMidMsg("找不到商品信息")}else this.taskPy.GetTaskAllReward(this.taskType,function(){t.gp_eff.removeChildren(),t.updateView()})},E.prototype.updateTaskData=function(t){var e;if(t&&t.history||this.curChapter<this.latestChapter){var i=t&&t.condKey||this.curChapter;e=this.taskPy.newBraveBookTaskHistory[i]}else e=this.braveInfo;this.taskInfoArr=[];var a=C.Config.newBraveBookTasksConfig(),n=[],o=1;this.finishNum=0;var r=9999,s=!(this.remainNum=0);e.sort(function(t,e){return 0<=Number(e.code)-Number(t.code)?-1:1});var c=e.slice(e.length-20,e.length),d=C.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook];for(var h in c){var l=a[c[h].code];if(l.type==this.taskType){var p=c[h],u=JSON.parse(l.target)[0],g={code:l.code,current:p.key,type:l.type,subType:l.subType,sectionCode:l.sectionCode,chapterCode:l.chapterCode,total:u,desc:l.desc,canGet:!1,rewards:l.rewards,isTarget:!1,jumpModule:l.jumpModule,curSection:0,unlock:!1,canSkipBuy:!!d.content[4]};g.isTarget=p&&p.isTarget||!1,g.current=g.isTarget?u:p&&p.key||0;var m=!1;m=l.subType==TaskSubType.ArenaChallengeRank?0<g.current&&g.current<=u||!1:g.current>=u||!1,g.canGet=m,s=s&&m,g.canGet&&!g.isTarget&&(this.remainNum+=1),g.canGet&&g.isTarget&&(this.finishNum+=1),n.push(g),o%E.TASKNUM==0&&(this.taskInfoArr.push(n),s||(r=Math.min(r,n[0].sectionCode)),s=!0,n=[]),++o}}C.ActivityBraveBookView.isInit&&(C.ActivityBraveBookView.isInit=!1),9999==r&&(r=this.taskInfoArr[E.TASKNUM][0].sectionCode),E.sectionData=r,t&&t.sectionCode&&(E.sectionData=t.sectionCode);var y,v=C.Config.newBraveBookRewardConfig();for(var h in v){var f=this.taskInfoArr[0][0].chapterCode,_=v[h];if(_.chapterCode==f&&_.type==this.taskType){y=_;break}}var A=this.taskPy.newBraveBookTask&&this.taskPy.newBraveBookTask.starTargeted;0<A.length&&-1!=A.indexOf(y.code)?this.btn_baoxiang.icon="yslz_img_hongbaozang0_png":this.finishNum>=E.MAXTASKNUM?(this.remainNum+=1,this.btn_baoxiang.icon="yslz_img_hongbaozang_png",this.addBaoxiangEffect()):this.btn_baoxiang.icon="yslz_img_hongbaozang1_png",this.lb_taskpro.textFlow=[{text:"("},{text:""+this.finishNum,style:{textColor:3407662}},{text:"/"+E.MAXTASKNUM+")"}],this.progressBar.value=this.finishNum,this.gp_notice2.visible=0<this.remainNum,this.blb_num.visible=0<this.remainNum;var T=this.activityPy.allActivityData[EActivityType.NewBraveBook];this.btn_get.touchEnabled=0<this.remainNum||T&&T.data&&!T.data.isBuy,UIActionManager.setAbsGrey(this.bp_get,!this.btn_get.touchEnabled),0<this.remainNum&&(this.blb_num.text=""+this.remainNum),this.params&&this.params.fromModule&&C.AppFacade.getInstance().updateView(C.BraveBookMediator.N,this.params.fromModule,{}),t&&t.history||this.curChapter<this.latestChapter||(this.latestChapter=this.taskInfoArr[0][0].chapterCode),this.curChapter=this.taskInfoArr[0][0].chapterCode;var b=Utils.MathUtils.formatNumToCharacter(this.curChapter);this.lb_chapter.text="第"+b+"章",this.updateChapter()},E.prototype.updateChapter=function(){for(var t in this.taskInfoArr){var e=this["chapter_"+(Number(t)+1)],i=this.taskInfoArr[t];e.updateData({info:i})}},E.prototype.addBaoxiangEffect=function(){DragonBoneTools.create("common_buxiudebaozang_1",function(t){t.x=this.gp_eff.width/2,t.y=this.gp_eff.height/2,t.animation.play(),t.scaleY=.3,t.scaleX=.3,this.gp_eff.addChild(t)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(t){t.x=this.gp_eff.width/2,t.y=this.gp_eff.height-10,t.scaleY=.3,t.scaleX=.3,t.animation.play(),this.gp_eff.addChild(t)},this)},E.prototype.upateLeftTime=function(){var t=this,e=this.activityPy.allActivityData[EActivityType.NewBraveBook].endDt-Utils.TimerManager.getServerTime();0<e&&(this.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(e)),this.timer&&(egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=(e-=60)&&(t.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(e))},this,6e4))},E.prototype.updateChapterTasks=function(t){var e;if(t&&t.updateTaskP&&t.data)e=t.data,t.canGetNum;else if(t&&t.updateTaskP&&t.code)t.code,0==(i=t.sectionCode%5)&&(i=5),e=this.taskInfoArr[i-1];else{var i;0==(i=E.sectionData%5)&&(i=5),e=this.taskInfoArr[i-1]}this.list_ch_items.dataProvider=new eui.ArrayCollection(e)},E.isInit=!0,E.MAXTASKNUM=20,E.CHAPTERNUM=5,E.TASKNUM=4,E);function E(){var t=e.call(this)||this;return t.curlevel=0,t.activityPy=C.AppFacade.getInstance().retrieveProxy(C.ActivityPy.N),t.taskPy=C.AppFacade.getInstance().retrieveProxy(C.TaskPy.N),t.backPackProxy=C.AppFacade.getInstance().retrieveProxy(C.BackpackPy.N),t.taskInfoArr=[],t.finishNum=0,t.remainNum=0,t.sectionId=1,t.chapterId=1,t.noRewardList=[],t.maxlevl=0,t.LevelRewards=[],t.maxChapterNum=0,t.tips_Tex={1:"激活勇士令状可获取大量高级道具、英雄奖励！！",2:"完成本章所有令状任务可解锁下一章哦！"},Utils.AssetsMgr.destroyGroup("group_brave_book"),t.skinName="BraveBookViewNewSkin",t}C.ActivityBraveBookViewNew=d;var i,t=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.GameMVC.activityMed.updateViewByCode(EActivityType.NewBraveBook,{updateTaskP:!0,data:t.data,canGetNum:t.canGetNum})},this)},a.prototype.updateData=function(t){var e="yslz_img_lingzhuang0_png",i="yslz_img_lingzhuang1_png",a="yslz_img_lingzhuang2_png",n="yslz_img_lingzhuang3_png";this.data=t.info,this.canGetNum=0,this.unlock=!1;for(var o=this.targetNum=0;o<4;++o){var r=this.data[o];this["img_"+o].source="yslz_img_xingxing2_png",r.canGet&&r.isTarget&&++this.targetNum,r.canGet&&!r.isTarget&&++this.canGetNum}var s=d.sectionData==this.data[0].sectionCode;4<=this.targetNum?this.img_top.source=s?n:e:this.img_top.source=s?a:i,this.img_bg.source=s?"yslz_img_gezi2_png":"yslz_img_gezi_png",this.effect?this.effect.visible=s:DragonBoneTools.create("common_yslzxuanzhong",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2+50,t.visible=!1,s&&(t.visible=!0),t.animation.play(),this.effect=t,this.gp_effect.addChild(this.effect)},this);for(var c=0;c<this.targetNum;++c)this["img_"+c].source="_border_m_json.common_icon_xingji";this.img_notice.visible=0<this.canGetNum},a.prototype.onOPReset=function(){},a.prototype.onOPComeBack=function(t,e){},a.prototype.onOPClean=function(){},a.prototype.onOPCheck=function(t){},a);function a(){var t=i.call(this)||this;return t.canGetNum=0,t.taskPy=C.AppFacade.getInstance().retrieveProxy(C.TaskPy.N),t.unlock=!1,t.targetNum=0,t.skinName="ChapterItemNewViewSkin",t}C.ChapterItemViewNew=t}(game=game||{}),function(d){var h,t=(h=d.ActivityCommonView,__extends(e,h),e.prototype.childrenCreated=function(){if(h.prototype.childrenCreated.call(this),this.activateComponent(),!this.commonConfig){var t=d.Config.HeroEquipCompound();for(var e in t){var i=t[e];if(i.type==HeroEquipCompoundType.ProfessionSuitReplacement){this.commonConfig=i;break}}}this.item_0.touchEnabled=!1,this.item_1.touchEnabled=!1,this.item_2.touchEnabled=!1,this.item_3.touchEnabled=!1},e.prototype.updateView=function(t){var i=this;h.prototype.updateView.call(this,t);var e=[];if(this.targetId){var a=d.Config.HeroEquipCompound()[this.targetId];JSON.parse(a.rewards).forEach(function(t){e.push(t[1])})}this.item_0.visible=0!=this.chooseItemCode_0,this.item_1.visible=0!=this.chooseItemCode_1,this.item_2.visible=0!=this.chooseItemCode_2,this.item_3.visible=0!=this.chooseItemCode_3,this.item_0.visible&&this.item_0.updateData({code:this.chooseItemCode_0}),this.item_1.visible&&this.item_1.updateData({code:this.chooseItemCode_1}),this.item_2.visible&&this.item_2.updateData({code:this.chooseItemCode_2}),this.item_3.visible&&this.item_3.updateData({code:this.chooseItemCode_3});var n=this.needNum;this.blb_num0.visible=this.selectedUuid_0.length<n,this.blb_num0.font="RedBlackStrocke_fnt",this.blb_num0.text=this.selectedUuid_0.length+"/"+n,this.blb_num1.visible=this.selectedUuid_1.length<n,this.blb_num1.font="RedBlackStrocke_fnt",this.blb_num1.text=this.selectedUuid_1.length+"/"+n,this.blb_num2.visible=this.selectedUuid_2.length<n,this.blb_num2.font="RedBlackStrocke_fnt",this.blb_num2.text=this.selectedUuid_2.length+"/"+n,this.blb_num3.visible=this.selectedUuid_3.length<n,this.blb_num3.font="RedBlackStrocke_fnt",this.blb_num3.text=this.selectedUuid_3.length+"/"+n;for(var o=0;o<4;o++){var r=this.gp_preview.$children[o];r||(r=new l,this.gp_preview.addChild(r),Utils.ComponentUtils.registerListener(r,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.ActivityProfessionSuitSelect({selectedId:i.targetId,showType:HeroEquipCompoundType.ProfessionSuitReplacement}),closeCB:function(t){i.targetId=t,i.updateView()}})},this)),r.updateItem({code:e[o]})}var s=this.info.content[0];this.numEnough=!(this.info.data.num>=s),this.blb_limitTimes.text=""+(s-this.info.data.num),this.updateTime(),this.gp_costs.removeChildren();var c=JSON.parse(this.commonConfig.costs);c.length&&(c.forEach(function(t){var e=new customui.CommonIconWithNum;e.updateItem({cost:t,style:CommonIconStyle.RIGHT,needBg:!0}),i.gp_costs.addChild(e)}),this.isEnough=d.GameMVC.backpackPy.checkEnough(c))},e.prototype.updateTime=function(){this.timer||(this.remainingDt=d.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):d.AppFacade.getInstance().hideSubView(d.ActivityMediator.N,d.ActivityMediator.SV.MAIN)},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.gp_equi_0,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var t={},e=d.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==o.commonConfig.color&&""==a.heroUuid&&0!=a.config.professionSuit&&a.config.type==HeroEquipType.Weapon)for(var n=a.num;0<n--;)t[i+"#"+n]=a}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return t.length>=o.needNum},selectUuids:o.selectedUuid_0,title:"请选择职业武器装备。",uniNum:!0,sortFunc:function(t,e){return t.info.quenchceLevel!=e.info.quenchceLevel?t.info.quenchceLevel-e.info.quenchceLevel:t.info.level2!=e.info.level2?t.info.level2-e.info.level2:t.info.level!=e.info.level?t.info.level-e.info.level:void 0}}),closeCB:function(){var t=0;0<o.selectedUuid_0.length&&(t=d.GameMVC.heroThingPy.AllEquipInfo[o.selectedUuid_0[0].split("#")[0]].config.code),o.chooseItemCode_0=t,o.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_1,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var t={},e=d.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==o.commonConfig.color&&""==a.heroUuid&&0!=a.config.professionSuit&&a.config.type==HeroEquipType.Armour)for(var n=a.num;0<n--;)t[i+"#"+n]=a}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return t.length>=o.needNum},selectUuids:o.selectedUuid_1,title:"请选择职业护甲装备。",uniNum:!0,sortFunc:function(t,e){return t.info.quenchceLevel!=e.info.quenchceLevel?t.info.quenchceLevel-e.info.quenchceLevel:t.info.level2!=e.info.level2?t.info.level2-e.info.level2:t.info.level!=e.info.level?t.info.level-e.info.level:void 0}}),closeCB:function(){var t=0;0<o.selectedUuid_1.length&&(t=d.GameMVC.heroThingPy.AllEquipInfo[o.selectedUuid_1[0].split("#")[0]].config.code),o.chooseItemCode_1=t,o.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_2,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var t={},e=d.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==o.commonConfig.color&&""==a.heroUuid&&0!=a.config.professionSuit&&a.config.type==HeroEquipType.Ornament)for(var n=a.num;0<n--;)t[i+"#"+n]=a}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return t.length>=o.needNum},selectUuids:o.selectedUuid_2,title:"请选择职业头盔装备。",uniNum:!0,sortFunc:function(t,e){return t.info.quenchceLevel!=e.info.quenchceLevel?t.info.quenchceLevel-e.info.quenchceLevel:t.info.level2!=e.info.level2?t.info.level2-e.info.level2:t.info.level!=e.info.level?t.info.level-e.info.level:void 0}}),closeCB:function(){var t=0;0<o.selectedUuid_2.length&&(t=d.GameMVC.heroThingPy.AllEquipInfo[o.selectedUuid_2[0].split("#")[0]].config.code),o.chooseItemCode_2=t,o.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_3,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var t={},e=d.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==o.commonConfig.color&&""==a.heroUuid&&0!=a.config.professionSuit&&a.config.type==HeroEquipType.Shoe)for(var n=a.num;0<n--;)t[i+"#"+n]=a}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return t.length>=o.needNum},selectUuids:o.selectedUuid_3,title:"请选择职业鞋子装备。",uniNum:!0,sortFunc:function(t,e){return t.info.quenchceLevel!=e.info.quenchceLevel?t.info.quenchceLevel-e.info.quenchceLevel:t.info.level2!=e.info.level2?t.info.level2-e.info.level2:t.info.level!=e.info.level?t.info.level-e.info.level:void 0}}),closeCB:function(){var t=0;0<o.selectedUuid_3.length&&(t=d.GameMVC.heroThingPy.AllEquipInfo[o.selectedUuid_3[0].split("#")[0]].config.code),o.chooseItemCode_3=t,o.updateView()}})},this),Utils.ComponentUtils.registerListener(this.btn_forge,egret.TouchEvent.TOUCH_TAP,function(){0<o.selectedUuid_0.length&&0<o.selectedUuid_1.length&&0<o.selectedUuid_2.length&&0<o.selectedUuid_3.length?o.targetId?o.judgeEquipType()?o.isEnough?o.numEnough?o.changeEquip():Utils.MsgUtils.addMidMsg("当前次数不足"):Utils.MsgUtils.addMidMsg("当前道具不足"):Utils.MsgUtils.addMidMsg("所需套装必须为同一职业套装，请重新选择"):Utils.MsgUtils.addMidMsg("当前未选择置换套装"):Utils.MsgUtils.addMidMsg("当前所需置换职业装备为空")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.HelpDialog({moduleId:MODULE.ActivityProfessionSuit})})},this)},e.prototype.judgeTargetId=function(t){var e=!1;if(0<this.selectedUuid_0.length&&0<this.selectedUuid_1.length&&0<this.selectedUuid_2.length&&0<this.selectedUuid_3.length){var i=d.GameMVC.heroThingPy.AllEquipInfo,a=this.selectedUuid_0[0].split("#")[0],n=this.selectedUuid_1[0].split("#")[0],o=this.selectedUuid_2[0].split("#")[0],r=this.selectedUuid_3[0].split("#")[0];if(this.judgeSameSuit(a,n,o,r)){var s=i[a].config.suitType;d.Config.HeroEquipCompound()[t].suitType==s&&(e=!0)}}return e},e.prototype.judgeSameSuit=function(t,e,i,a){var n=d.GameMVC.heroThingPy.AllEquipInfo;return n[t].config.professionSuit==n[e].config.professionSuit&&n[t].config.professionSuit==n[i].config.professionSuit&&n[t].config.professionSuit==n[a].config.professionSuit&&n[e].config.professionSuit==n[i].config.professionSuit&&n[e].config.professionSuit==n[a].config.professionSuit&&n[i].config.professionSuit==n[a].config.professionSuit},e.prototype.changeEquip=function(){var a=this,i={};this.selectedUuid_0.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1}),this.selectedUuid_1.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1}),this.selectedUuid_2.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1}),this.selectedUuid_3.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1});var t=[];for(var e in i)t.push({equipUuid:e,num:i[e]});d.GameMVC.heroThingPy.HeroEquipCompound({id:this.targetId,uuidInfos:t,type:HeroEquipCompoundType.ProfessionSuitReplacement,code:this.code,beforeCB:function(i){DragonBoneTools.playOnce({effectName:"common_tjjt",parent:a.gp_preview,y:-40,doneCB:function(){a.gp_preview.$children.forEach(function(t,e){DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:t,doneCB:function(){e==a.gp_preview.numChildren-1&&i()}})})}})},cb:function(){a.selectedUuid_0=[],a.selectedUuid_1=[],a.selectedUuid_2=[],a.selectedUuid_3=[],a.targetId=0,a.chooseItemCode_0=0,a.chooseItemCode_1=0,a.chooseItemCode_2=0,a.chooseItemCode_3=0,a.updateView()}})},e.prototype.judgeEquipType=function(){if(0<this.selectedUuid_0.length&&0<this.selectedUuid_1.length&&0<this.selectedUuid_2.length&&0<this.selectedUuid_3.length){d.GameMVC.heroThingPy.AllEquipInfo;var t=this.selectedUuid_0[0].split("#")[0],e=this.selectedUuid_1[0].split("#")[0],i=this.selectedUuid_2[0].split("#")[0],a=this.selectedUuid_3[0].split("#")[0];return!!this.judgeSameSuit(t,e,i,a)}return!1},e);function e(){var t=h.call(this)||this;return t.code=EActivityType.ProfessionSuitReplacement,t.targetId=0,t.selectedUuid_0=[],t.selectedUuid_1=[],t.selectedUuid_2=[],t.selectedUuid_3=[],t.isEnough=!1,t.numEnough=!1,t.needNum=1,t.chooseItemCode_0=0,t.chooseItemCode_1=0,t.chooseItemCode_2=0,t.chooseItemCode_3=0,t.skinName="ActivityChangeEquiSkin",t}d.ActivityChangeEqui=t;var i,l=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},a.prototype.updateItem=function(t){this.data=t,this.data.code?(this.gp_empty.visible=!1,this.gp_baseItem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseItem.visible=!1)},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityProfessionSuitView_EquipItem",t}}(game=game||{}),function(f){var e,t=(e=f.ActivityCommonListView,__extends(i,e),i.prototype.getDataList=function(){var p=this,t=this.info;if(t&&t.data){function e(t){var e=u[t],i={id:e[0],title:"",tips:"",rewards:[],status:REWARD_STATUS.UNAVAILABLE,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:p.getReward({id:e[0]});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(1==e[1][0][0]){var a=e[1][0][1],n=e[1][0][2],o=e[1][0][3],r=e[1][0][4];i.title="收集%s%s%s英雄%s个".format([HeroRaceConfig[a]?HeroRaceConfig[a].name:"任意种族",ProfessionConfig[n]?ProfessionConfig[n].name:"任意职业",o?o+"星":"任意星级",r]);var s=v[c=""+(a<10?"0"+a:a)+(n<10?"0"+n:n)+(o<10?"0"+o:o)]?v[c]:0;i.tips=s+"/"+r,r<=s&&(i.status=REWARD_STATUS.AVAILABLE),m.some(function(t){return t.id==e[0]})&&(i.status=REWARD_STATUS.RECEIVED)}if(2==e[1][0][0]){var c=e[1][0][1],d=(r=e[1][0][2],f.GeneralConfig.getEntityConfigByCode(c));if(d){for(var h in i.title="收集"+d.name+r+"个",s=0,y){var l=y[h];l.code==c&&(r=l.num)}i.tips=s+"/"+r,r<=s&&(i.status=REWARD_STATUS.AVAILABLE),m.some(function(t){return t.id==e[0]})&&(i.status=REWARD_STATUS.RECEIVED)}}i.rewards=e[2],g.push(i)}var u=JSON.parse(t.content),i=t.data,g=[],m=i.targeted,y=i.specialListspecialList,v=JSON.parse(i.genericityList);for(var a in u)e(a);return g.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),g}},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.CollectHero,t}f.ActivityCollectHeroView=t}(game=game||{}),function(m){var y,t=(y=m.ActivityCommonView,__extends(e,y),e.prototype.childrenCreated=function(){var i=this;y.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;m.MainJumpConfig.jumpTo(e[0][2])}},this)},e.prototype.updateView=function(t){var e=this;y.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=i.content,n=[];for(var o in a){var r=a[o];for(var s in r[1]){var c=r[1][s];n.push(c)}}var d=m.Config.shop(),h=[];for(var o in d)r=d[o],0<=n.indexOf(r.id)&&h.push(JSON.parse(r.reward)[0]);var l=m.Config.itemConfig();function p(t){var e=h[t],i=customui.BaseItemFactory.create();i.updateData({reward:e});var a=0;for(var n in l){var o=l[n];if(o.id==e[1]){var r=JSON.parse(o.effect);a=r[0][1]}}i.addTapEvent(function(){return a&&m.AppFacade.getInstance().showSubView(m.HeroMediator.N,m.HeroMediator.SV.HERO_DETAIL,{code:a}),!0}),u.gp_reward.addChild(i)}this.gp_reward.removeChildren();var u=this;for(var o in h)p(o);this.img_bg.source=a[0][3]+"_png",this.img_tip.source=a[0][4]+"_png";var g=m.ActivityConfig.getActivityEndDt(this.code);this.bm_time.text=Utils.TimerManager.getFormatBySecond1(g-Utils.TimerManager.getServerTime()),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){e.bm_time.text=Utils.TimerManager.getFormatBySecond1(g-Utils.TimerManager.getServerTime())},this,1e3)}},e);function e(){var t=y.call(this)||this;return t.skinName="ActivityCommonShopSpecialItem",t}m.ActivityCommonShopSpecialItem=t}(game=game||{}),function(f){var e,t=(e=f.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},i.prototype.updateView=function(t){var e=this;this.code=t&&t.activityType||t&&t.code||this.code;var i=this.info;if(i&&i.data){this.updateTitle();var a=JSON.parse(i.content);this.img_bg.source=a[3]?a[3]+"_png":"mrcz_img_mrczdt_png";var n=a[0],o=a[1],r=(a[2],JSON.parse(i.data.targeted)),s=i.data.rechargeDays,c=i.data.amounts;this.bm_rechargeDays.text=s+"天",n<=c?(this.lb_todayRecharge.text="(已达成)",this.lb_todayRecharge.textColor=3604224):this.lb_todayRecharge.text="（今日充值："+c+"/"+n+"）";var d=f.ActivityConfig.getCurDay(i);this.gp_rewards.removeChildren();var h=o[d-1];if(h){h&&h[1]&&f.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,h[1]);var l=REWARD_STATUS.GO_RECHARGE;for(var p in n<=c&&(l=REWARD_STATUS.AVAILABLE),r)if(r[p][0]==h[0]){l=REWARD_STATUS.RECEIVED;break}switch(l){case REWARD_STATUS.AVAILABLE:this.btn_get.label="领取",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.skinName="skins.ButtonSkinYellow",this.btn_get.scaleX=this.btn_get.scaleY=.8,this.btnFunc=function(){e.getReward({id:h[0],code:e.code})};break;case REWARD_STATUS.RECEIVED:this.btn_get.skinName="skins.ButtonSkinSure",this.btn_get.label="已领取",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.scaleX=this.btn_get.scaleY=1,this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")};break;case REWARD_STATUS.GO_RECHARGE:this.btn_get.skinName="skins.ButtonSkinYellow",this.btn_get.label="充值",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.scaleX=this.btn_get.scaleY=.8,this.btnFunc=function(){f.MainJumpConfig.jumpTo(MODULE.Recharge)}}l==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_get);var u=this.getDataList();u[u.length-1].isFinal=!0,this.pb_progress.maximum=u[u.length-1].targetDays;var g=u.length,m=this.gp_boxs.width/u[u.length-1].targetDays;if(!this.hasinit){this.hasinit=!0;for(var y=0;y<g;y++){var v=new _;v.x=u[y].targetDays*m-66,this.gp_boxs.addChild(v),this.boxItems.push(v)}}for(y=0;y<g;y++)this.boxItems[y].update(u[y]);this.pb_progress.value=s}else Utils.MsgUtils.addMidMsg("找不到配置")}},i.prototype.updateTitle=function(){var t=this,e=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.bm_time.text="";else if(e&&this.bm_time){var i=f.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):f.AppFacade.getInstance().hideSubView(f.ActivityMediator.N,f.ActivityMediator.SV.MAIN)},this,1e3)}},i.prototype.getDataList=function(){var d=this,t=this.info;if(!t||!t.data)return[];t.content;var h=t.data.rechargeDays,l=JSON.parse(t.data.targeted),e=JSON.parse(t.content);if(!e)return[];function i(t){var e=u[t],i=e[0],a=e[1],n=e[2],o=REWARD_STATUS.AVAILABLE;for(var r in l)if(l[r][0]==i){o=REWARD_STATUS.RECEIVED;break}h<a&&(o=REWARD_STATUS.GO_RECHARGE);var s="连续充值"+a+"天可领取",c={id:i,title:e[1]?s:"免费领取",tips:e[1]?h+"/"+a:"",rewards:n,targetDays:a,status:o,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:e[0],code:d.code});break;case REWARD_STATUS.GO_RECHARGE:f.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};p.push(c)}var p=[],u=e[2];for(var a in u)i(a);return p.sort(function(t,e){return t.id-e.id}),p},i);function i(){var t=e.call(this)||this;return t.hasinit=!1,t.boxItems=[],t.skinName="ActivityContinueRechargeReward",t}f.ActivityContinueRechargeReward=t;var a,_=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.hasCreated=!0,this.update(this.params),this.gp_top.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},n.prototype.update=function(t){var e=this;if(this.hasCreated){if(t){if(this.params=t,!this.hasAddEffect){var i=t.isFinal?"common_xunbaorijibxtd05":"common_xunbaorijibxtd03";UIActionManager.addEffect(this.gp_effect,i,{},function(t){e.tdEffect=t})}switch(this.bm_count.text=t.targetDays,t.status){case REWARD_STATUS.AVAILABLE:this.gp_effect.visible=!0,this.img_box.visible=!1,this.btnFunc=function(){e.tdEffect&&(e.tdEffect.visible=!1),e.img_box.visible=!0,e.img_box.source=t.isFinal?"xbrj_img_baoxiang0_4_png":"xbrj_img_baoxiang0_2_png",DragonBoneTools.playOnce({parent:e.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){t.btnFunc&&t.btnFunc(t)}})};break;case REWARD_STATUS.GO_RECHARGE:this.img_box.source=t.isFinal?"xbrj_img_baoxiang1_4_png":"xbrj_img_baoxiang1_2_png",this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){f.AppFacade.getInstance().showSubView(f.CommonMediator.N,f.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewards,type:f.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})};break;case REWARD_STATUS.RECEIVED:this.gp_effect.visible=!1,this.img_box.visible=!0,this.img_box.source=t.isFinal?"xbrj_img_baoxiang0_4_png":"xbrj_img_baoxiang0_2_png",this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")}}}}else this.params=t},n);function n(){var t=a.call(this)||this;return t.hasCreated=!1,t.hasAddEffect=!1,t.skinName="ActivityContinueRechargeRewardItem",t}}(game=game||{}),function(o){var e,t=(e=BasePanel,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_daily_login")},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initList()},Object.defineProperty(i.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),i.prototype.initList=function(){this.list_itemList.itemRenderer=n},i.prototype.updateView=function(t){var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)},i.prototype.getDataList=function(){var r=this,t=this.info,e=JSON.parse(t.content),s=t.data.targeted,c=t.data.key||0,d=(t.data.day,[]),i=t.data.curCycle;for(var a in e[1]){var n=e[1][a];if(n[0]==i){e=n[1];break}}return e.forEach(function(t){var e=t[0],i=t[1],a=t[2],n=REWARD_STATUS.UNAVAILABLE;s.some(function(t){return t.id==e&&0<t.num})?n=REWARD_STATUS.RECEIVED:c>=t[1]&&(n=REWARD_STATUS.AVAILABLE);var o={id:i,title:"开服第"+e+"天可领取",tips:c+"/"+i,status:n,rewards:a,btnFunc:function(){r.getReward({id:e})}};d.push(o)}),d.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),this.img_bg.source=1==i?"lxdl_img_ditu_png":"lxdl_img_14riditu_png",d},i.prototype.getReward=function(t,e){var i=this;if(this.code){var a=o.ActivityConfig.Config[this.code],n=a.getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,t).then(function(t){i.log(a.name+"——领取",n+"R",t),i.info.updateData(t.info),i.backpackProxy.handleClientReward(t.clientReward),e&&e(t)})}else this.log("没有声明活动code")},i);function i(){var t=e.call(this)||this;return t.actProxy=o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N),t.backpackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t.code=EActivityType.DailyLogin,Utils.AssetsMgr.loadGroup("group_daily_login"),t.skinName="ActivityDailyLogin",t}o.ActivityDailyLogin=t;var a,n=(a=eui.ItemRenderer,__extends(r,a),r.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.btnFunc&&t.data.btnFunc()},this)},r.prototype.dataChanged=function(){var n=this;this.lb_title.text=this.data.title||"";var t=this.data.rewards;switch(this.gp_reward.removeChildren(),t.forEach(function(t,e){var i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.6,t[0]==EEntityType.EEntityTypeHeroArtifact||t[0]==EEntityType.EEntityTypeHeroEquip){var a={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:t,vo:a})}else i.updateData({reward:t});n.gp_reward.addChild(i)}),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn.label="领取",UIActionManager.setGrey(this.btn,!0),this.btn.skinName="skins.ButtonSkinYellow2";break;case REWARD_STATUS.RECEIVED:this.btn.skinName="skins.ButtonSkinSure",this.btn.label="已领取",UIActionManager.setGrey(this.btn,!1);break;default:this.btn.label="领取",UIActionManager.setGrey(this.btn,!1),this.btn.skinName="skins.ButtonSkinYellow2"}this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-2}):UIActionManager.hideEffect(this.btn)},r);function r(){var t=a.call(this)||this;return t.skinName="ActivityDailyLoginItem",t}}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonListView,__extends(a,e),a.prototype.getDataList=function(){var t,r=this,e=this.info,i=JSON.parse(e.content),s=e.data.targeted,c=e.data.key||1,a=e.data.curCycle;for(var n in i[1]){var o=i[1][n];if(o[0]==a){t=o[1];break}}if(!t)return Utils.MsgUtils.addMidMsg("找不到配置"),[];var d=[];return t.forEach(function(t){var e=t[0],i=t[1],a=t[2],n=REWARD_STATUS.UNAVAILABLE;s.some(function(t){return t.id==e&&0<t.num})?n=REWARD_STATUS.RECEIVED:c>=t[1]&&(n=REWARD_STATUS.AVAILABLE);var o={id:i,title:"连续登录"+i+"天",tips:c+"/"+i,status:n,rewards:a,btnFunc:function(){r.getReward({code:r.code,id:e})}};d.push(o)}),d.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),d},a);function a(){return null!==e&&e.apply(this,arguments)||this}t.ActivityDailyLoginWeal=i}(game=game||{}),function(v){var i,t=(i=BasePanel,__extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),Utils.AssetsMgr.destroyGroup("group_daily_luxury_gifts")},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc1&&t.btnFunc1()},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc2&&t.btnFunc2()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.updateView();var e=v.ActivityConfig.getActivityEndDt(this.code);this.lb_time.text=Utils.TimerManager.getFormatBySecond1(e-Utils.TimerManager.getServerTime()),this.timer=egret.setInterval(function(){t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e-Utils.TimerManager.getServerTime())},this,1e3)},e.prototype.getReward=function(t,e){var i=this;if(this.code){var a=v.ActivityConfig.Config[this.code].getRewardName;a&&""!=a&&Utils.Socket.send("activity",a,t).then(function(t){i.actProxy.updateData_View_Reward(i.code,t),v.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),e&&e(t)})}else this.log("没有声明活动code")},e.prototype.updateView=function(t){var h=this;this.code=t&&t.activityType||t&&t.code||this.code;var e=this.info;if(e&&e.data&&v.ActivityConfig.Config[this.code]){var l=e.data.targeted,i=e.content,p=e.data.key,a=e.data.day,u=[];for(var n in i){var o=i[n];o[0]==a&&u.push(o)}if(!u.length)return[];function r(t){var e=u[t],n=(e[0],e[1]),o=e[2],i=e[3],a=e[4],r=REWARD_STATUS.GO_RECHARGE;if(a){if(-1==m)return"continue";r=REWARD_STATUS.CANBUY,o||(r=REWARD_STATUS.AVAILABLE),d=!1;var s=0;for(var c in l)if(l[c].id==n){d=!0;break}if(d&&(r=REWARD_STATUS.RECEIVED,++m!=u.length-1))return"continue";switch(m){case 0:y.img_title.source="mrhl_txt_mianfeihaoli_png";break;case 1:y.img_title.source="mrhl_txt_6yuanhaoli_png",s=6;break;case 2:case 3:y.img_title.source=u.length<4?"mrhl_txt_6yuanhaoli_png":"mrhl_txt_30yuanhaoli_png",s=u.length<4?6:30}m=-1,y.gp_reward1.removeChildren(),v.GameMgr.getInstance().CommonGpAddReward(y.gp_reward1,i),y.updateBtn(y.btn1,r,s),y.btnFunc1=function(){switch(r){case REWARD_STATUS.AVAILABLE:h.getReward({code:h.code,id:n});break;case REWARD_STATUS.CANBUY:var t=g.goodList,e=void 0;for(var i in t){var a=t[i];a.id==o&&(e=a)}e?g.purchase(e,2,String(n),JSON.stringify({uuid:n,activityType:h.code}),{activityType:h.code}):Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.GO_RECHARGE:v.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}}else{o<=p&&(r=REWARD_STATUS.AVAILABLE);var d=!1;for(var c in l)if(l[c].id==n){d=!0;break}d&&(r=REWARD_STATUS.RECEIVED),y.gp_reward2.removeChildren(),v.GameMgr.getInstance().CommonGpAddReward(y.gp_reward2,i),y.bm_targeted.text=o,y.updateBtn(y.btn2,r),y.lb_todayRecharge.textFlow=[{text:"今日已充值:",style:{textColor:16777215}},{text:(p||0)*Utils.SDKMgr.globalIAPRate+"",style:{textColor:3211008}},{text:Utils.SDKMgr.globalIAPSuffix,style:{textColor:16777215}}],y.btnFunc2=function(){switch(r){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:h.getReward({code:h.code,id:n});break;case REWARD_STATUS.GO_RECHARGE:v.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}}}for(var g=v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N),m=(g.goodList,0),y=this,s=0;s<u.length;s++)r(s)}},e.prototype.updateBtn=function(t,e,i){switch(void 0===i&&(i=0),e){case REWARD_STATUS.RECEIVED:t.skinName="skins.ButtonSkinSure",t.label="已领取",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.7,UIActionManager.hideEffect(t);break;case REWARD_STATUS.GO_RECHARGE:t.skinName="skins.ButtonSkinYellow",t.label="充值",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;case REWARD_STATUS.CANBUY:t.skinName="skins.ButtonSkinYellow",t.label="购买",i&&(1<Utils.SDKMgr.globalIAPSuffixLen?t.label=""+i*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:t.label=""+i*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"购买"),UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;default:t.label="领取",UIActionManager.setGrey(t,!1),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8,UIActionManager.addEffect(t,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e);function e(){var t=i.call(this)||this;return t.actProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t.code=EActivityType.DailyLuxuryGifts,Utils.AssetsMgr.loadGroup("group_daily_luxury_gifts"),t.skinName="ActivityDailyLuxuryGifts",t}v.ActivityDailyLuxuryGifts=t}(game=game||{}),function(A){var e,t=(e=A.ActivityCommonListView,__extends(i,e),i.prototype.getDataList=function(){var i=this,t=this.info;if(t&&t.data){var e,a=t.data.targeted,n=t.content,o=t.data.curCycle||1;for(var r in n[1])if((d=n[1][r])[0]==o){e=d[1];break}if(!e)return[];for(var s=[],c=0;c<e.length;c++){var d,h=(d=e[c])[0],l=d[1],p=d[2],u=d[3],g=d[4],m=REWARD_STATUS.CANBUY,y=0;for(var r in a){var v=a[r];if(v.id==h){y=v.num;break}}u<=y&&(m=REWARD_STATUS.HASBUY);var f=0==p[0][2]?"免费礼包":p[0][2]+"钻礼包";this.code==EActivityType.FoolsDayItemGift1&&(f="测试礼包"),d[6]&&(u=d[6]);var _={id:h,title:f,tips:y+"/"+u,rewards:d[5]||l,status:m,discount:g,btnFunc:function(t){switch(t.status){case REWARD_STATUS.CANBUY:Utils.Socket.send("activity","BuyExchangeGifts",{code:i.code,giftCode:t.id,num:1}).then(function(t){A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N).updateData_View_Reward(i.code,t)});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}var e=A.AppFacade.getInstance().retrieveMediator(A.ActivityMediator.N).getSubView(A.ActivityMediator.SV.MAIN);e&&e.updateResourceBar()}};s.push(_)}return s.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),this.code==EActivityType.FoolsDayItemGift1&&(this.img_title.source=""),s}},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.DiamondGifts,t}A.ActivityDiamondGifts=t}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonView,__extends(a,e),a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.scheId&&(egret.clearInterval(this.scheId),this.scheId=void 0)},a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.pb_pb.labelDisplay.visible=!1},a.prototype.updateView=function(t){var i=this,e=this.info;if(e){var a=e.content,n=a.length-1,o=e.data.total||0;this.curLevel=0,a.forEach(function(t,e){o>=t[0]&&o<t[1]&&(i.curLevel=e),0!=t[2]&&i.generateItem(t,e,n)}),e.data&&(this.blb_curCost.text=o,this.blb_curRebate.text=e.data.rebate||0),this.img_cur.y=this.POS[this.curLevel][0],this.pb_pb.value=this.POS[this.curLevel][1],this.scheId||(this.scheId=egret.setInterval(function(){i.blb_dt.text=Utils.TimerManager.getFormatBySecond2(e.endDt-Utils.TimerManager.getServerTime())},this,1e3))}},a.prototype.generateItem=function(t,e,i){var a=new eui.Group,n=new eui.Label,o=new eui.Label,r=new eui.Image;a.width=this.gp_tips.width,a.height=31;var s=new eui.HorizontalLayout;s.verticalAlign=egret.VerticalAlign.MIDDLE,s.gap=4,a.layout=s,r.width=r.height=31,r.source="item_icon_zuanshi_png",o.textColor=7339894,o.size=22,o.x=r.x+r.width+5,o.text="返利"+Math.floor(100*t[2])+"%";var c=void 0;c=e==i?[{text:"累积消费 ",style:{size:22,textColor:16775312}},{text:t[0]+"及以上",style:{size:22,textColor:9499647}}]:[{text:"累积消费 ",style:{size:22,textColor:16775312}},{text:t[0]+"~"+(t[1]-1),style:{size:22,textColor:9499647}}],e==this.curLevel||(UIActionManager.setAbsGrey(r,!0),c.forEach(function(t){t.style.textColor=9737364}),o.textColor=9737364),n.textFlow=c,a.addChild(n),a.addChild(r),a.addChild(o),a.x=0,a.y=this.gp_tips.height/i*(e-1),this.gp_tips.addChild(a)},a);function a(){var t=e.call(this)||this;return t.code=EActivityType.DiamondRebate,t.curLevel=0,t.scheId=0,t.POS=[[0,0],[0,10],[30,20],[55,30],[85,40],[113,50],[140,65],[170,70],[195,85],[225,100]],t.skinName="ActivityDiamondRebateViewSkin",t}t.ActivityDiamondRebateView=i}(game=game||{}),function(n){var v,t=(v=n.ActivityCommonView,__extends(e,v),e.prototype.childrenCreated=function(){var i=this;v.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"common_dwlongzhou",parent:this.gp_boat,x:this.gp_boat.width/2,y:this.gp_boat.height/2+30,loop:!0,loadFinishCB:function(t){i.effectObj=t,i.effectObj.visible=!1,egret.setTimeout(function(){i.updateView()},i,500)}});for(var t=0;t<1;t++)DragonBoneTools.playOnce({effectName:"common_dwbowen",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,loop:!0});for(t=0;t<10;t++){var e=new a;e.x=this.boxPosi[t][0],e.y=this.boxPosi[t][1],this.boxs.push(e),this.gp_boxs.addChild(e)}this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.GameMVC.activityMed.showHelpDialog(i.info.content[4])},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"DragonBoatGradeRank"})},this),this.btn_cost0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=JSON.parse(t.content)[2];n.GameMgr.getInstance().showCommonTipsWin({costTips:"前进"+e[1][1]+"m",cost:JSON.stringify(e[1][0]),cb:!0,source:"ActivityDragonBoatGrade0",clickCB:function(t){1==t.type&&i.actProxy.DoCommonOperation(i.code,1,2)}})}},this),this.btn_cost2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=JSON.parse(t.content)[2];n.GameMgr.getInstance().showCommonTipsWin({costTips:"前进"+10*e[1][1]+"m",cost:JSON.stringify([[e[1][0][0][0],e[1][0][0][1],10*e[1][0][0][2]]]),cb:!0,source:"ActivityDragonBoatGrade2",clickCB:function(t){1==t.type&&i.actProxy.DoCommonOperation(i.code,10,2)}})}},this),this.btn_cost1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;t&&t.data&&n.GameMVC.activityMed.updateView(n.ActivityMediator.SV.MAIN,{code:EActivityType.EatingZongZi})},this),this.btn_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1==i.pageIndex&&(i.pageIndex=0,i.updateView())},this),this.btn_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==i.pageIndex&&(i.pageIndex=1,i.updateView())},this)},e.prototype.updateView=function(t){v.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){this.hideAllLines();var i=JSON.parse(e.content),a=i[3];a.sort(function(t,e){return t[0]-e[0]});var n=e.data.grade,o=e.data.targeted;if(null==this.pageIndex)if(n>=a[9][0]){for(var r=0;r<10;r++)if(o.indexOf(a[r][0]<0)){this.pageIndex=1;break}}else this.pageIndex=0;this.img_text.visible=0==this.pageIndex,this.btn_lastOne.visible=1==this.pageIndex,this.btn_nextOne.visible=0==this.pageIndex;var s=0;n>=a[9][0]&&(s=1),0==s&&1==this.pageIndex?UIActionManager.addEffect(this.btn_lastOne,"common_btn_jiantou"):UIActionManager.hideEffect(this.btn_lastOne),1==s&&0==this.pageIndex?UIActionManager.addEffect(this.btn_nextOne,"common_btn_jiantou"):UIActionManager.hideEffect(this.btn_nextOne);var c=0,d=!1,h=0==this.pageIndex?0:a[9][0];for(r=0;r<10;r++){var l=10*this.pageIndex+r,p=this.boxs[r],u=a[l][0];if(p&&p.update({max:u,cur:n,got:0<=o.indexOf(u),rewards:a[l][1],curStage:c,view:this}),u<=n)this.showLine(c),c++;else if(!d){d=!0,this.gp_boat.scaleX=3==c||4==c||9==c?-1:1,this.gp_boat.visible=!0;var g=0==c?(u-n)/(u-h):(u-n)/(u-a[l-1][0]),m=0;switch(.8<=g&&c?(this.effectObj&&(this.effectObj.visible=!1),this.img_boat.source="dwj_img_lztb_png",this.img_boat.visible=!0,m=-50,2!=c&&5!=c&&8!=c||(g=.8)):g<=.2?(this.effectObj&&(this.effectObj.visible=!1),this.img_boat.source="dwj_img_lztb_png",this.img_boat.visible=!0,m=2==c||5==c||8==c?-100:-50,2!=c&&5!=c&&8!=c||(g=.2)):(this.effectObj&&(this.effectObj.visible=!0),this.img_boat.visible=!1),c){case 0:this.gp_boat.y=this.boatY[0],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[0])*g;break;case 1:this.gp_boat.y=this.boatY[0],this.gp_boat.horizontalCenter=this.boatX[2]-(this.boatX[2]-this.boatX[1])*g;break;case 2:this.gp_boat.horizontalCenter=this.boatX[2],this.gp_boat.y=this.boatY[1]-(this.boatY[1]-this.boatY[0])*g;break;case 3:this.gp_boat.y=this.boatY[1],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[2])*g;break;case 4:this.gp_boat.y=this.boatY[1],this.gp_boat.horizontalCenter=this.boatX[0]-(this.boatX[0]-this.boatX[1])*g;break;case 5:this.gp_boat.horizontalCenter=this.boatX[0],this.gp_boat.y=this.boatY[2]-(this.boatY[2]-this.boatY[1])*g;break;case 6:this.gp_boat.y=this.boatY[2],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[0])*g;break;case 7:this.gp_boat.y=this.boatY[2],this.gp_boat.horizontalCenter=this.boatX[2]-(this.boatX[2]-this.boatX[1])*g;break;case 8:this.gp_boat.horizontalCenter=this.boatX[2],this.gp_boat.y=this.boatY[3]-(this.boatY[3]-this.boatY[2])*g;break;case 9:this.gp_boat.y=this.boatY[3],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[2])*g;break;default:this.gp_boat.visible=!1}this.gp_boat.y+=m}}this.gp_boat.visible=d;var y=i[2];this.cost_0.updateItem({cost:y[1][0][0],style:CommonIconStyle.RIGHT}),this.cost_2.updateItem({cost:[y[1][0][0][0],y[1][0][0][1],10*y[1][0][0][2]],style:CommonIconStyle.RIGHT}),this.cost_1.updateItem({cost:y[0][0][0],style:CommonIconStyle.RIGHT}),this.CommonResourceBar.updateBar(y[0][0]),i[1],i[0],this.bm_speed.text="距离:"+n+"m"}},e.prototype.showLine=function(t){var e=this.gp_lines.$children[t];e&&(e.visible=!0)},e.prototype.hideAllLines=function(){for(var t=this.gp_lines.$children.length,e=0;e<t;e++){var i=this.gp_lines.$children[e];i&&(i.visible=!1)}},e);function e(){var t=v.call(this)||this;return t.boxs=[],t.pageIndex=void 0,t.boatY=[688,480,308,116],t.boatX=[250,11,-247],t.boxPosi=[[200,520],[-50,520],[-50,320],[200,320],[450,320],[450,140],[200,140],[-50,140],[-50,-50],[200,-50]],t.effectObj=void 0,t.skinName="ActivityDragonBoatGrade",t}n.ActivityDragonBoatGrade=t;var i,a=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){var a=this;i.prototype.childrenCreated.call(this),UIActionManager.addEffect(this,"common_dwxuanwo",{x:this.width/2,y:this.height/2,loop:!0,childIndex:0}),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(a.params.cur>=a.params.max){GameRootLayer.gameLayer().switchTouchEnable(!1);var i=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},a,1e3);Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.DragonBoatGrade,id:a.params.max}).then(function(e){a.btn_box.icon="dwj_img_baoxiang0_png",DragonBoneTools.playOnce({effectName:"common_jxbaoxiangkai",parent:a,x:a.width/2,y:a.height/2,doneCB:function(){if(GameRootLayer.gameLayer().switchTouchEnable(!0),egret.clearTimeout(i),9==a.params.curStage){var t=a.params.view;t&&(t.pageIndex=void 0)}n.GameMVC.activityPy.updateData_View_Reward(EActivityType.DragonBoatGrade,e)}})})}else n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.REWARD_PANEL,{rewards:a.params.rewards,type:n.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this)},o.prototype.update=function(t){this.params=t,this.bm_cur.text=t.cur,this.bm_tar.text="/"+t.max,this.bm_cur.font=t.cur>=t.max?"green_num_fnt":"white_num_fnt",this.btn_box.icon=this.params.got?"dwj_img_baoxiang0_png":"dwj_img_baoxiang1_png",this.img_notice.visible=!t.got&&t.cur>=t.max,this.img_got.visible=t.got,(t.got||t.max>t.cur+1e3)&&(this.bm_cur.text="",this.bm_tar.text="")},o);function o(){var t=i.call(this)||this;return t.skinName="ActivityDragonBoatGradeItem",t}}(game=game||{}),function(r){var s,t=(s=r.ActivityCommonView,__extends(e,s),e.prototype.childrenCreated=function(){var i=this;s.prototype.childrenCreated.call(this),this.gp_effect.visible=!1,this.gp_coverAll.visible=!1,this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;r.MainJumpConfig.jumpTo(),r.MainJumpConfig.jumpTo(e[1])}},this),this.btn_go1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;r.MainJumpConfig.jumpTo(),r.MainJumpConfig.jumpTo(e[2])}},this),this.btn_preview0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;i.gp_effect.$children[1]&&i.gp_effect.removeChildAt(1),e[3]&&(MovieClipTools.create(e[3],function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.scaleX=this.gp_effect.width/t.width,t.scaleY=this.gp_effect.height/t.height,t.animation.play(e[3],-1),this.gp_effect.addChildAt(t,1)},i),i.gp_effect.visible=!0,i.gp_coverAll.visible=!0)}},this),this.btn_preview1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;i.gp_effect.$children[1]&&i.gp_effect.removeChildAt(1),e[4]&&(MovieClipTools.create(e[4],function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.scaleX=this.gp_effect.width/t.width,t.scaleY=this.gp_effect.height/t.height,t.animation.play(e[4],-1),this.gp_effect.addChildAt(t,1)},i),i.gp_effect.visible=!0,i.gp_coverAll.visible=!0)}},this),this.gp_coverAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.gp_effect.visible=!1,i.gp_coverAll.visible=!1},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.gp_effect.visible=!1,i.gp_coverAll.visible=!1},this)},e.prototype.updateView=function(t){var e=this;s.prototype.updateView.call(this,t);var i=this.info;if(!i||!i.data)return this.bm_time.text="",void(this.bm_timeTip.text="活动已结束");var a=i.content;this.img_bg.source=a[0]+"_png",this.timer&&egret.clearInterval(this.timer);var n=r.ActivityConfig.getActivityEndDt(this.code),o=Utils.TimerManager.getServerTime();0<n-o?(this.bm_timeTip.text="活动倒计时:",this.bm_time.text=Utils.TimerManager.getFormatBySecond1(n-o)):(this.bm_timeTip.text="活动已结束",this.bm_time.text=""),this.timer=egret.setInterval(function(){var t=Utils.TimerManager.getServerTime();0<n-t?(e.bm_timeTip.text="活动倒计时:",e.bm_time.text=Utils.TimerManager.getFormatBySecond1(n-t)):(e.bm_timeTip.text="活动已结束",e.bm_time.text="")},this,1e3),a[3]?this.btn_preview0.visible=!0:this.btn_preview0.visible=!1,a[4]?this.btn_preview1.visible=!0:this.btn_preview1.visible=!1,this.img_bottomLight.visible=!!a[5],this.btn_go1.visible=!1,a[1]&&a[2]?(this.btn_go1.visible=!0,this.btn_go.horizontalCenter=84,this.btn_go1.horizontalCenter=-234,this.btn_go1.top=638,this.gp_time.visible=!1):(a[1]||(this.btn_go.visible=!1),this.gp_time.top=824)},e);function e(){var t=s.call(this)||this;return t.skinName="ActivityDrawCardRatioImprove",t}r.ActivityDrawCardRatioImprove=t}(game=game||{}),function(l){var p,t=(p=l.ActivityCommonView,__extends(e,p),e.prototype.childrenCreated=function(){var e=this;p.prototype.childrenCreated.call(this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.Activity+e.code})})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.RankMediator.N,l.RankMediator.SV.COMMON,{module:"ACTIVITY_EATINGZONGZI"})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.RankMediator.N,l.RankMediator.SV.COMMON,{module:"NewZoneZongZiGradeRank"})},this);for(var t=[[40,-120],[250,-50],[470,-120]],i=0;i<3;i++){var a=new n;a.x=t[i][0],a.y=t[i][1],this.ActivityEatingZongZiItemList.push(a),this.gp_zongzi.addChild(a)}this.gp_coverAll.visible=this.gp_detail.visible=!1,this.gp_coverAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateDetail({})},this),UIActionManager.addEffect(this.gp_effect,"chizongzi",{offectY:150},function(t){e.effectObj=t})},e.prototype.updateView=function(t){var e=this;p.prototype.updateView.call(this,t),this.updateTitle();var i=this.info;if(i&&i.data){function a(t){o[t][7]=r.code,o[t][5]=function(){e.updateDetail(o[t])},o[t][6]=function(t){e.DoCommonOperation(t)},r.ActivityEatingZongZiItemList[t].update(o[t])}var n=JSON.parse(i.content),o=n[1],r=this;for(var s in o)a(s);var c=i.data.integral||0,d=i.data.targeted,h=n[0];for(var s in this.img_notice.visible=!1,h){var l=h[s][0];if(l<=c&&d.indexOf(l)<0){this.img_notice.visible=!0;break}}}},e.prototype.DoCommonOperation=function(e){var i=this;if(l.GameMVC.backpackPy.checkEnough(e[1],!1)){var t=l.AppFacade.getInstance().retrieveMediator(l.ShopyMediator.N),a=l.GameMVC.backpackPy.getInfoByCode(e[1][0][1]);t.showSubView(l.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:"",costs:e[1],countFun:function(t){return{unit:1,total:t}},name:a.info.name},maxCount:a.haveNum,buyNum:0,btnLabel:"享用",costTip:"享用消耗",limitTip:"享用次数",doneCB:function(t){i.effectObj&&i.effectObj.animation.play("chi",1),GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),l.GameMVC.activityPy.DoCommonOperation(e[7],t.num||1,e[0]),i.effectObj.animation.play("daiji",0),Utils.MsgUtils.addMidMsg("龙舟前进了"+e[4]*t.num+"米")},i,1400)}})}else Utils.MsgUtils.addMidMsg("粽子不足")},e.prototype.updateDetail=function(t){if(1==this.gp_detail.visible)this.gp_detail.visible=!1,this.gp_coverAll.visible=!1;else{this.gp_detail.visible=!0,this.gp_coverAll.visible=!0,t[0];var e=t[1],i=t[2],a=e[0],n=l.GameMVC.backpackPy.getInfoByCode(a[1]);for(var o in this.lb_name.text=n.info.name,this.lb_desc.text=n.info.desc,this.gp_rewards.removeChildren(),i){var r=i[o],s=(c=r,h=d=void 0,d=new eui.Group,(h=customui.BaseItemFactory.create()).updateData({reward:c[1][0]}),h.scaleX=h.scaleY=.8,d.addChild(h),d);this.gp_rewards.addChild(s)}}var c,d,h},e.prototype.updateTitle=function(){var t=this,e=l.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var a=l.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=a--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):l.AppFacade.getInstance().hideSubView(l.ActivityMediator.N,l.ActivityMediator.SV.MAIN)},this,1e3)}},e);function e(){var t=p.call(this)||this;return t.ActivityEatingZongZiItemList=[],t.effectObj=void 0,t.skinName="ActivityEatingZongZi",t}l.ActivityEatingZongZi=t;var i,n=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;this.btn_eat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data[6]&&t.data[6](t.data)},this),this.img_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data[5]&&t.data[5]()},this)},a.prototype.update=function(t){this.data=t;var e=this.data[0],i=this.data[1];this.data[2],this.img_bg.source=1==e?"newactivity_img_tbk_png":"newactivity_img_tbk"+e+"_png";var a=i[0],n=l.GameMVC.backpackPy.getInfoByCode(a[1]);this.img_icon.source=n.info.icon+"_png",this.bm_num.text=n.haveNum},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityEatingZongZiItem",t}}(game=game||{}),function(c){var d,t=(d=c.ActivityCommonListView,__extends(e,d),e.prototype.onDestroy=function(){d.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_enjoy_card")},e.prototype.childrenCreated=function(){var t=this;d.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.purchaseEnjoyCard(t.code)},this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=c.ActivityCommonListItem,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(t){if(d.prototype.updateView.call(this,t),this.info&&this.info.data){var e=this.info,i=e.data.startEffectDt,a=e.data.endEffectDt,n=this.rechargeProxy.getEnjoyCardInfo(this.code);if(!n){var o=JSON.parse(this.info.content);n=c.GameMVC.rechargePy.getMonthCardInfoById(o[2])}if(n&&(this.btn_buy.label=""+n.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix),i&&a){o=JSON.parse(e.content),this.btn_buy.skinName="skins.ButtonSkinSure",this.btn_buy.label="已购买",UIActionManager.setGrey(this.btn_buy,!1),this.btn_buy.scaleX=this.btn_buy.scaleY=1,this.btn_buy.touchEnabled=!1;var r=e.data.targeted,s=Math.floor((a-i)/24/3600);this.lb_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(a-Utils.TimerManager.getServerTime()),this.bm_targetTimes.text=r.length+"/"+s}else this.btn_buy.touchEnabled=!0,this.lb_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(e.endDt-Utils.TimerManager.getServerTime()),this.bm_targetTimes.text="0/0"}else Utils.MsgUtils.addMidMsg("服务器数据错误")},e.prototype.getDataList=function(){var s=this,t=this.info,c=JSON.parse(t.content),d=(t.data.startEffectDt,t.data.endEffectDt,t.data.targeted),e=new Date(1e3*t.startDt);e.setHours(23,59,59);var h=Math.ceil((Utils.TimerManager.getServerTime()-(e.getTime()/1e3+1))/24/3600);++h<=0&&(h=1);var i=1;for(var a in d.sort(function(t,e){return t-e}),d){if(d[a]!=i)break;i++}function n(t){var e=c[1][t],i=e[0],a=e[1],n=0*c[0]+i,o=REWARD_STATUS.AVAILABLE;0<=d.indexOf(n)?o=REWARD_STATUS.RECEIVED:h<n&&(o=REWARD_STATUS.UNAVAILABLE);var r={num:t,id:i,rewards:a,status:o,title:"第"+(t+1)+"天可领取",btnFunc:function(){s.getReward({day:n,code:s.code})}};l.push(r)}for(var l=[],o=0;o<c[1].length;o++)n(o);return this.commonSortDataList(l),l},e.prototype.purchaseEnjoyCard=function(t){var e=this.rechargeProxy.getEnjoyCardInfo(t);if(!e){var i=JSON.parse(this.info.content);e=c.GameMVC.rechargePy.getMonthCardInfoById(i[2])}e?(e.isMonthCard=!0,this.rechargeProxy.purchase(e,2,String(t),JSON.stringify({uuid:t,activityType:this.code,code:this.code}),{activityType:this.code,code:this.code})):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},e);function e(){var t=d.call(this)||this;return t.rechargeProxy=c.AppFacade.getInstance().retrieveProxy(c.RechargePy.N),Utils.AssetsMgr.loadGroup("group_enjoy_card"),t.skinName="ActivityEnjoyCardViewSkin",t}c.ActivityEnjoyCardView=t}(game=game||{}),function(o){var e,t=(e=o.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0})},i.prototype.updateView=function(t){var n=this,e=this.info;this.tableInit||(e.content.forEach(function(t,e){var i=n["gp_Reward"+e],a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=70/105,a.updateData({reward:t[1][0]}),i.addChild(a)}),this.tableInit=!0),this.blb_times.text=e.data.total.toString();var i=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.blb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?n.blb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):o.AppFacade.getInstance().hideSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAIN)},this,1e3)},i.prototype.rotateToIndex=function(t,e){if(!this.rotating){var i=t*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,e)}},i.prototype.rotateToAngle=function(t,e,i){var a=this;void 0===i&&(i=5e3);for(var n=[],o=0;o<8;o++){var r=this["gp_Reward"+o];r&&n.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1),this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var e=360*(a.FIXED_LAP+1)-a.gp_roll.rotation;n.forEach(function(t){t.rotation=e})},onChangeObj:this}).to({rotation:t},i,function(t){return 1-Math.pow(1-t,3)}).call(function(){a.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),e&&e()})},i.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<i.info.data.total?Utils.Socket.send("activity","DoCommonOperation",{code:i.code,num:1,id:1}).then(function(t){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0});var e=JSON.parse(t.info);i.rotateToIndex(e.rewardId-1,function(){i.info.updateData(e),o.GameMVC.backpackPy.handleClientReward(t.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_access,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n})},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.Activity+EActivityType.EverydayTurntable})})},this)},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.EverydayTurntable,t.FIXED_LAP=5,t.itemAngle=45,t.rotating=!1,t.curIndex=0,t.tableInit=!1,t.skinName="ActivityEverydayTurnTableSkin",t}o.ActivityEverydayTurnTable=t;var a,n=(a=BasePanel,__extends(r,a),r.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.updateView()},r.prototype.updateView=function(t){function e(t){var e=n.CONFIG[t],i=a[e.name];n["lb_"+t].text=e.text.format([i.toString()]),n["img_"+t].visible=i===e.max,n["btn_"+t].visible=i!=e.max,Utils.ComponentUtils.registerListener(n["btn_"+t],egret.TouchEvent.TOUCH_TAP,function(){e.cb()},n)}var a=o.GameMVC.activityPy.allActivityData[EActivityType.EverydayTurntable].data,n=this;for(var i in this.CONFIG)e(i);this.img_3.visible=this.lb_3.visible=this.btn_3.visible=!1},r);function r(){var t,e=a.call(this)||this;return e.CONFIG=((t={})[1]={name:"loginTimes",max:1,text:"登录游戏（%s/1）",cb:function(){Utils.MsgUtils.addMidMsg("你能点到这个按钮证明程序出问题了")}},t[2]={name:"firstChargeTimes",max:1,text:"首次充值（%s/1）",cb:function(){e.hide(),o.MainJumpConfig.jumpTo(MODULE.Recharge)}},t),e.skinName="ActivityNewTurnTable_AccessPanel",e}}(game=game||{}),function(e){var i,t=(i=e.ActivityCommonView,__extends(a,i),a.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_exchange_code")},a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent(),this.updateTitle()},a.prototype.updateTitle=function(){var t=e.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code],t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.bm_time.text=""},a.prototype.activateComponent=function(){this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;""===this.edt_input.text?Utils.MsgUtils.addMidMsg("请输入内容"):(this.edt_input.text=this.edt_input.text.replace(" ",""),0==this.edt_input.text.indexOf("T2019")||0==this.edt_input.text.indexOf("T2020")||0==this.edt_input.text.indexOf("T2021")||0==this.edt_input.text.indexOf("T2022")||0==this.edt_input.text.indexOf("T2023")||0==this.edt_input.text.indexOf("W2020")||0==this.edt_input.text.indexOf("W2021")||0==this.edt_input.text.indexOf("W2022")||0==this.edt_input.text.indexOf("W2023")?Utils.Http.getByUrl(Utils.agentConfig.HttpUnitServer+"/get_AllCode.php"+Utils.Http.decorateParams({status:0,player_id:this.playerProxy.roleVo.playerId,code_id:this.edt_input.text,platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id},!0,egret.HttpMethod.GET)).then(function(t){t&&(3===t.code?Utils.Http.toGet({action:"get_code",player_id:e.playerProxy.roleVo.playerId,code_id:e.edt_input.text,platform:Utils.agentConfig.AgentCode,area:e.loginProxy.serverSelect.s_id}).then(function(t){t&&(1===t.success?Utils.Http.getByUrl(Utils.agentConfig.HttpUnitServer+"/get_AllCode.php"+Utils.Http.decorateParams({status:1,player_id:e.playerProxy.roleVo.playerId,code_id:e.edt_input.text,platform:Utils.agentConfig.AgentCode,area:e.loginProxy.serverSelect.s_id},!0,egret.HttpMethod.GET)).then(function(t){}):Utils.MsgUtils.addMidMsg(t.msg),e.edt_input.text="")}):2===t.code&&Utils.MsgUtils.addMidMsg(t.msg))}):Utils.Http.toGet({action:"get_code",player_id:this.playerProxy.roleVo.playerId,code_id:this.edt_input.text,platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id}).then(function(t){1===t.success||Utils.MsgUtils.addMidMsg(t.msg),e.edt_input.text=""}))},this)},a);function a(){var t=i.call(this)||this;return t.code=EActivityType.ExchangeCode,t.playerProxy=e.AppFacade.getInstance().retrieveProxy(e.PlayerPy.N),t.loginProxy=e.AppFacade.getInstance().retrieveProxy(e.LoginPy.N),Utils.AssetsMgr.loadGroup("group_exchange_code"),t.skinName="ActivityExchangeCodeSkin",t}e.ActivityExchangeCode=t}(game=game||{}),function(o){var n,t=(n=BasePanel,__extends(i,n),i.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_extreme_challenge")},i.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.width=this.parent.width,this.height=this.parent.height,this.activityVO=this.activityProxy.allActivityData[this.code];var t=JSON.parse(this.activityVO.content);if(this.activityVO&&this.activityVO.data){for(var i in t[1]){var a=t[1][i];a[0]==this.activityVO.data.curCycle&&(this.config=a[1])}this.activityVO.data.passed&&(this.activityVO.data.id=20),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.activityVO.data.passed)Utils.MsgUtils.addMidMsg("恭喜您已通过");else{var t=5*e.scrollerIndex+e.seleceIndex;e.activityVO.data.id<t+1?Utils.MsgUtils.addMidMsg("请先通关前面的关卡"):e.activityVO.data.id>t+1?Utils.MsgUtils.addMidMsg("已通过该关卡"):(e.CloseView(),e.activityProxy.ChallengeExtremeChallenge())}},this),this.img_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.scrollerIndex++,3<e.scrollerIndex&&(e.scrollerIndex=3),e.updateView({id:e.seleceIndex}),e.updateLevel()},this),this.img_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.scrollerIndex--,e.scrollerIndex<0&&(e.scrollerIndex=0),e.updateView({id:e.seleceIndex}),e.updateLevel()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.list_level.itemRenderer=r,this.seleceIndex=(this.activityVO.data.id-1)%5,this.scrollerIndex=Math.floor((this.activityVO.data.id-1)/5),this.list_level.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(t){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.onItemTap(t)},this),this.initTimer(),this.updateView({id:this.seleceIndex}),this.initUIEffect(),this.updateLevel()}},i.prototype.onItemTap=function(t){this.list_level.dataProvider.getItemAt(this.seleceIndex%5).chose=!1,this.updateView({id:t.itemIndex}),this.list_level.dataProvider.getItemAt(this.seleceIndex%5).chose=!0},i.prototype.updateView=function(t){if(t){var e=this.activityProxy.allActivityData[this.code];if(e&&e.data){var i=t.id;if(null==i){i=(this.activityVO.data.id-1)%5,this.updateLevel();var a=this.list_level.dataProvider&&this.list_level.dataProvider.getItemAt(this.seleceIndex%5);a&&(a.chose=!1),this.seleceIndex=i,(a=this.list_level.dataProvider&&this.list_level.dataProvider.getItemAt(this.seleceIndex%5))&&(a.chose=!0)}else this.seleceIndex=i;if(null!=i){var n=5*this.scrollerIndex+i;this.updateCreep(n),this.updateReward(n)}}}},i.prototype.initUIEffect=function(){this.effect?this.effect.animation.play():DragonBoneTools.create("common_zhihuanqian",function(t){this.effect=t,this.effect.x=this.gp_effects.width/2,this.effect.y=this.gp_effects.height-100,this.effect.visible=!0,this.effect.animation.timeScale=1,this.effect.animation.play(),this.gp_effects.addChild(this.effect)},this)},i.prototype.initTimer=function(){var t=this,e=0;if(this.activityProxy.isOpen(this.code)){var i=this.activityProxy.allActivityData[this.code];i&&i.endDt&&(e=(i.endDt-o.GameMgr.getInstance().serverTime())%(24*i.content[0]*60*60))}0!=e&&(this.leftTime=egret.setInterval(function(){t.bitmap_time.text=Utils.TimerManager.getFormatBySecond1(e--)},this,1e3))},i.prototype.updateReward=function(t){this.gp_reward.removeChildren();var e=this.config[t][3];for(var i in e){var a=e[i],n=new customui.BaseItem(20);n.updateData({code:a[1],num:a[2]}),n.scaleX=.8,n.scaleY=.8,this.gp_reward.addChild(n)}},i.prototype.updateCreep=function(t){var e,i=(e=this.config[t][2])[0][0];e.forEach(function(t){t[1]&&(i=t[0])});var a=o.Config.creepConfig()[i];if(a){this.creep_model.update({code:a.heroId});var n=o.Config.allHeroConfig()[a.heroId];this.lb_name.text=n.name,this.img_raceIcon.source=HeroRaceConfig[n.race].raceIcon}},i.prototype.updateLevel=function(){for(var t in this.leveldata=[],this.config){var e=this.config[t];e[0]==this.activityVO.data.id?this.leveldata.push({state:i.state.current,id:e[0],reward:e[3][0],chose:!1,creep:e[2]}):e[0]>this.activityVO.data.id?this.leveldata.push({state:i.state.next,id:e[0],reward:e[3][0],chose:!1,creep:e[2]}):this.leveldata.push({state:i.state.passed,id:e[0],reward:e[3][0],chose:!1,creep:e[2]})}this.activityVO.data.passed&&(this.leveldata[this.leveldata.length-1].state=i.state.passed),this.leveldata[5*this.scrollerIndex+this.seleceIndex].chose=!0,this.leveldata=this.leveldata.slice(5*this.scrollerIndex,5*this.scrollerIndex+5),this.list_level.dataProvider=new eui.ArrayCollection(this.leveldata),0==this.scrollerIndex||2==this.scrollerIndex?(this.img_nextOne.visible=!0,this.img_lastOne.visible=!1):(this.img_nextOne.visible=!1,this.img_lastOne.visible=!0)},i.prototype.CloseView=function(){this.hide(),this.leftTime&&egret.clearInterval(this.leftTime)},i.state={passed:-1,current:0,next:1},i.EXTREMECHALLENGE_PREFIX="EXTREMECHALLENGE_PREFIX",i.EXTREMECHALLENGESKIP_PREFIX="EXTREMECHALLENGE_PREFIX",i);function i(){var t=n.call(this)||this;return t.leveldata=[],t.scrollerIndex=0,t.seleceIndex=1,t.code=EActivityType.ExtremeBattle,t.activityProxy=o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N),Utils.AssetsMgr.loadGroup("group_extreme_challenge"),t.skinName="ActivityExtremeChallengeViewSkin",t}o.ActivityExtremeChallengeView=t;var e,r=(e=eui.ItemRenderer,__extends(a,e),a.prototype.dataChanged=function(){switch(this.data.state){case t.state.passed:UIActionManager.setAbsGrey(this.gp_main,!0),this.img_passed.visible=!0;break;case t.state.current:case t.state.next:UIActionManager.setAbsGrey(this.gp_main,!1),this.img_passed.visible=!1}this.bitmap_level.text=this.data.id,this.setChose(this.data.chose);var e=this.data.creep[0][0];this.data.creep.forEach(function(t){t[1]&&(e=t[0])}),o.Config.creepConfig()[e],this.baseitem.updateData({code:this.data.reward[1],num:this.data.reward[2]})},a.prototype.childrenCreated=function(){this.baseitem.touchEnabled=!1},a.prototype.setChose=function(t){this.img_chose.visible=t},a);function a(){var t=e.call(this)||this;return t.skinName="ExtremeChallengeListItemSkin",t}}(game=game||{}),function(y){var l,t=(l=y.ActivityCommonPanel,__extends(e,l),e.prototype.childrenCreated=function(){var i=this;function t(t){var e=a["img_icon"+t];e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.onclick(t)},a)}l.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.btnFun&&i.btnFun()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this);for(var a=this,e=0;e<4;e++)t(e);UIActionManager.addEffect(this.gp_effect,"common_bujibaoxiang01")},e.prototype.onclick=function(t){var e=this.curData.rewards[t],i=e[0],a=e[1],n=y.GeneralConfig.getEntityConfigByCode(i,a);switch(i){case EEntityType.EEntityTypeHero:y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_DETAIL,{code:a});break;default:if(i==EEntityType.EEntityTypeHeroEquip||i==EEntityType.EEntityTypeHeroArtifact||i==EEntityType.EEntityTypeTreasure){var o=void 0;switch(i){case EEntityType.EEntityTypeHeroEquip:var r=y.Config.getHeroEquipUpgradeConfig(a);y.Config.getHeroEquipEnchantConfig(a),o={code:a,entityType:i,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:r=y.Config.getHeroArtifactUpgradeConfig(a),y.Config.getHeroArtifactUpstarConfig(a),o={code:a,entityType:i,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(r=y.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&r.length&&r[r.length-1].level}y.AppFacade.getInstance().showSubView(y.HeroThingMediator.N,y.HeroThingMediator.SV.MAIN,{entityType:i,vo:o,config:n,source:y.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new y.BaseItemDetailView({code:a,type:i,config:n})})}},e.prototype.updateView=function(t){l.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=this.getDataList(),a=void 0;for(var n in i){var o=i[n];if(o.status==REWARD_STATUS.AVAILABLE||o.status==REWARD_STATUS.GO_RECHARGE){a=o;break}}if(a){this.curData=a,e.data.amount,this.btnFun=function(){a.btnFunc&&a.btnFunc(a)},a.status==REWARD_STATUS.AVAILABLE?(this.img_status.source="mrbj_txt_yidacheng_png",this.img_status.horizontalCenter=0,this.bm_recharge.text="",this.btn_go.label="领取"):(this.img_status.source="mrbj_txt_dqljcz_png",this.img_status.horizontalCenter=-18,this.bm_recharge.text=e.data.amount,this.btn_go.label="充值"),this.lb_desc.text="当日累计充值达到"+a.targetAmount*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"即可领取";for(var r=0;r<4&&a.rewards;r++){var s=a.rewards[r];if(s){var c=y.GeneralConfig.getEntityConfigByCode(s[0],s[1]),d=this["img_icon"+r];d&&(d.source=c.icon+"_png");var h=this["bm_num"+r];h&&(h.text=Utils.MathUtils.formatNumStyle1(s[2]))}}}else this.hide()}else this.hide()},e.prototype.getDataList=function(){var d=this,t=this.info;if(!t||!t.data)return[];var h,e=t.content,l=t.data.amount,p=JSON.parse(t.data.targeted),i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){h=n[1];break}}if(!h)return[];function o(t){var e=h[t],i=e[1],a=e[2],n=e[3]||1,o=REWARD_STATUS.AVAILABLE;-1!=p.indexOf(e[0])?o=REWARD_STATUS.RECEIVED:l<i&&(o=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+e[1]*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(m.code)&&(r="今日充值任意金额可领取");var s={id:e[0],title:e[1]?r:"免费领取",tips:e[1]?l+"/"+i:"",rewards:a,status:o,targetAmount:i,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:t.id,code:d.code},function(){y.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)});break;case REWARD_STATUS.GO_RECHARGE:y.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<n){var c=!0;if(u.forEach(function(t){t.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(t)+1])return u.push(s),"break";g=n,u.splice(0,u.length),u.push(s)}else u.push(s)}var u=[],g=1,m=this;for(var r in h)if("break"===o(r))break;return u.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),u},e);function e(){var t=l.call(this)||this;return t.skinName="ActivityFifthOpenServerRecharge",t}y.ActivityFifthOpenServerRecharge=t}(game=game||{}),function(A){var b,t=(b=BasePanel,__extends(e,b),e.prototype.onDestroy=function(){b.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),A.EventPoint.lastTriggerTime=0,Utils.AssetsMgr.destroyGroup("group_first_recharge")},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){b.prototype.childrenCreated.call(this),this.activateComponent();for(var t=0;t<3;t++){var e=this["gp_effect"+t];e&&UIActionManager.addEffect(e,"common_kelingqu",{scaleX:.85,scaleY:.85,offectX:-2,offectY:-13})}for(var i=0;i<=3;i++){var a=this.notice_img[i];a.source="_main_m_json.common_img_hongdian";var n=this["btn_"+i];a&&n&&(a.right=20,a.top=15,n.addChild(a)),n.iconDisplay.pixelHitTest=!0}var o=this.info;if(o&&o.data){var r=JSON.parse(o.content),s=JSON.parse(o.data.rechargeTargeted),c=o.data.rewardTargeted,d=o.data.key,h=[];for(i=0;i<=3;i++){var l=REWARD_STATUS.UNAVAILABLE,p=0;for(t=0;t<3;t++){var u=r[t+3*i],g=u[0],m=(u[1],u[2]),y=u[4],v=REWARD_STATUS.UNAVAILABLE;m<=d&&(v=REWARD_STATUS.AVAILABLE),0<=c.indexOf(g)&&(v=REWARD_STATUS.RECEIVED);var f=0;for(var _ in s){var A=s[_];A[0]==m&&(f=A[1])}if(f<y&&(v=REWARD_STATUS.UNAVAILABLE),v==REWARD_STATUS.AVAILABLE){l=REWARD_STATUS.AVAILABLE;break}v==REWARD_STATUS.RECEIVED&&p++}3==p&&(l=REWARD_STATUS.RECEIVED),h.push(l)}var T=void 0;for(t=0;t<h.length;t++)if(h[t]==REWARD_STATUS.AVAILABLE){T=t;break}for(t=0;t<h.length&&null==T;t++)if(h[t]==REWARD_STATUS.UNAVAILABLE){T=t;break}this.onBtnTap(T||0)}},e.prototype.updateNotice=function(){var t=this.info;if(t&&t.data)for(var e=JSON.parse(t.content),i=(JSON.parse(t.data.rechargeTargeted),t.data.rewardTargeted,t.data.key,0);i<=3;i++){for(var a=!1,n=this.notice_img[i],o=0;o<3;o++){var r=e[3*i+o],s=r[0],c=(r[1],r[2]),d=r[4],h=t.data.key,l=t.data.rewardTargeted,p=JSON.parse(t.data.rechargeTargeted),u=REWARD_STATUS.UNAVAILABLE;c<=h&&(u=REWARD_STATUS.AVAILABLE),0<=l.indexOf(s)&&(u=REWARD_STATUS.RECEIVED);var g=0;for(var m in p){var y=p[m];y[0]==c&&(g=y[1])}if(g<d&&(u=REWARD_STATUS.UNAVAILABLE),u==REWARD_STATUS.AVAILABLE){a=!0;break}}n&&(n.visible=a)}},e.prototype.updateView=function(t){var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=JSON.parse(e.data.rechargeTargeted),n=e.data.rewardTargeted,o=e.data.key;200<=o?this.gp_has.visible=!1:this.lb_cur.text=""+o*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix;var r=i[3*this.curSeleceIndex];this.img_bg.source=r[5]+"_png",this.img_title.source=r[6]+"_png",this.heroModel.update({model:r[7],isStatic:!0}),r[8]?(this.heroModel1.update({model:r[8],isStatic:!0}),this.heroModel1.visible=!0):this.heroModel1.visible=!1;for(var s=0;s<3;s++){var c=i[s+3*this.curSeleceIndex],d=c[0],h=c[1],l=c[2],p=c[4],u=REWARD_STATUS.UNAVAILABLE;l<=o&&(u=REWARD_STATUS.AVAILABLE),0<=n.indexOf(d)&&(u=REWARD_STATUS.RECEIVED);var g=0;for(var m in a){var y=a[m];y[0]==l&&(g=y[1])}g<p&&(u=REWARD_STATUS.UNAVAILABLE);var v=this["gp_effect"+s],f=this["gp_reward"+s],_=this["img_hasget"+s];switch(f&&(f.removeChildren(),A.GameMgr.getInstance().CommonGpAddReward(f,h,.8)),_&&(_.visible=u==REWARD_STATUS.RECEIVED),u){case REWARD_STATUS.UNAVAILABLE:v&&(v.touchEnabled=!1,v.visible=!1,v.touchChildren=!0),f&&UIActionManager.setGrey(f,!1);break;case REWARD_STATUS.AVAILABLE:v&&(v.touchEnabled=!0,v.visible=!0,v.touchChildren=!1),f&&UIActionManager.setGrey(f,!1);break;case REWARD_STATUS.RECEIVED:v&&(v.touchEnabled=!1,v.visible=!1,v.touchChildren=!0),f&&UIActionManager.setGrey(f,!0)}this.btn_go.visible=!g}this.updateNotice()}},e.prototype.onBtnTap=function(t){var e;this.curSeleceIndex!=t&&((e=this["btn_"+this.curSeleceIndex])&&(e.icon=this.index2benImg[this.curSeleceIndex]+"1_png"),this.curSeleceIndex=t,(e=this["btn_"+this.curSeleceIndex])&&(e.icon=this.index2benImg[this.curSeleceIndex]+"2_png"),this.updateView())},e.prototype.activateComponent=function(){function t(t){var e=i["btn_"+t];e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.onBtnTap(t)},i)}for(var u=this,i=this,e=0;e<=3;e++)t(e);function a(p){var t=n["gp_effect"+p];t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=u.info;if(t&&t.data){var e=JSON.parse(t.content)[3*u.curSeleceIndex+p],i=e[0],a=(e[1],e[2]),n=e[4],o=t.data.key,r=t.data.rewardTargeted,s=JSON.parse(t.data.rechargeTargeted),c=REWARD_STATUS.UNAVAILABLE;a<=o&&(c=REWARD_STATUS.AVAILABLE),0<=r.indexOf(i)&&(c=REWARD_STATUS.RECEIVED);var d=0;for(var h in s){var l=s[h];l[0]==a&&(d=l[1])}switch(d<n&&(c=REWARD_STATUS.UNAVAILABLE),c){case REWARD_STATUS.UNAVAILABLE:A.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.AVAILABLE:Utils.Socket.send("activity","GetFirstRechargeReward",{id:3*u.curSeleceIndex+p+1,code:u.code}).then(function(t){A.GameMVC.activityPy.updateData_View_Reward(EActivityType.FirstRecharge1,t),A.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}},n)}this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){A.MainJumpConfig.jumpTo(MODULE.Recharge)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.hide()},this);for(var n=this,o=0;o<3;o++)a(o)},e);function e(){var t=b.call(this)||this;t.notice_img=[],t.actProxy=A.AppFacade.getInstance().retrieveProxy(A.ActivityPy.N),t.backpackProxy=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),t.code=EActivityType.FirstRecharge1,t.curSeleceIndex=void 0,t.index2benImg=["shouchon_btn_6yuan","shouchon_btn_30yuan","shouchon_btn_100yuan","shouchon_btn_200yuan"],Utils.AssetsMgr.destroyGroup("group_first_recharge"),t.skinName="ActivityFirstRechargeSkin";for(var e=0;e<4;e++)t.notice_img.push(new eui.Image);return t}A.ActivityFirstRechargeView=t}(game=game||{}),function(i){var a,t=(a=BasePanel,__extends(e,a),e.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.HeroMediator.N,i.HeroMediator.SV.FORMATION)},this),this.challge_join.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t={type:FishingActivityOper.Snatch,target:e.params.baseInfo.playerId,code:EActivityType.ZoneFishing};e.py.FishingChallenge(t),e.mediator.hideSubView(e)},this)},e.prototype.updateView=function(t){if(t&&t.info&&t.content){this.params=t.info,this.cfc_fightcap.update(this.params.baseInfo.fightCap),this.lb_name.text=this.params.baseInfo.name,this.cu_ph.updateData({vo:this.params.baseInfo}),this.severId.text="S"+this.params.baseInfo.serverId;var e=this.params.fishes,i=t.content[3];for(var a in e){(r=customui.BaseItemFactory.create()).scaleX=r.scaleY=.7;var n=0;for(var o in i)i[o][0]==e[a].code&&(n=i[o][1]);0!=n&&(r.updateData({id:n,num:e[a].num}),this.gp_reward_show.addChild(r))}for(var a in this.params.heros){var r;(r=customui.BaseItemFactory.create()).updateData({type:EEntityType.EEntityTypeHero,vo:this.params.heros[a]}),r.scaleX=r.scaleY=.6,r.touchEnabled=!1,this.gp_enermy.addChild(r)}}},e);function e(){var t=a.call(this)||this;return t.py=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),t.skinName="ActivityFishingChallengeSkin",t}i.ActivityFishingChallengePanel=t}(game=game||{}),function(e){var i,t=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_ahead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),e.GameMVC.activityMed.showViewByCode(EActivityType.ZoneFishing)},this),this.updateView()},a.prototype.updateView=function(t){this.updateTime()},a.prototype.updateTime=function(){this.timer||(this.remainingDt=e.ActivityConfig.getActivityEndDt(EActivityType.ZoneFishing)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},a.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):this.hide()},a.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityFishingEntranceSkin",t}e.ActivityFishingEntrancePanel=t}(game=game||{}),function(a){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.initList(),this.initTabbar(),this.rootPanel.onCloseCB=function(){i.hide()},this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info.content[5];a.GameMVC.backpackPy.checkEnough(t,!1)?a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Activity+EActivityType.ZoneFishing,hasBuyNum:0,buyCB:function(t){var e={code:EActivityType.ZoneFishing,type:FishingActivityOper.BuySnatch,target:void 0,num:t};a.GameMVC.activityPy.FishingOperation(e,function(){i.updateView()})},curNum:i.info.data.playerInfo.snatchTimes,maxNum:200}):Utils.MsgUtils.addMidMsg("您的货币不足")},this),this.updateView()},i.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_list},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_fuchou_0",down:"_btn_yq_m_json.common_yeqian_fuchou_1"}},{source:{up:"_btn_yq_m_json.common_yeqian_jilu_0",down:"_btn_yq_m_json.common_yeqian_jilu_1"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this),this.tabbar.selectedIndex=0},i.prototype.updateView=function(t){switch(this.info=a.GameMVC.activityPy.allActivityData[EActivityType.ZoneFishing],this.tabbar.selectedIndex){case 0:this.updateRevenge();break;case 1:this.updateRecord()}},i.prototype.updateRecord=function(){this.list_items.itemRenderer=o,this.rootPanel.blb_title.text="记 录";var t=this.info.data.playerInfo.battleRecord,e=[];for(var i in t){var a=t[i];e.push({info:a,view:this})}this.ac_list.replaceAll(e),this.gp_empty.visible=0===e.length,this.gp_times.visible=!1},i.prototype.updateRevenge=function(){this.list_items.itemRenderer=c,this.rootPanel.blb_title.text="记 录";var t=this.info.data.playerInfo.revengeList,e=[];for(var i in t){var a=t[i];e.push({info:a,view:this})}this.ac_list.replaceAll(e),this.gp_empty.visible=0===e.length,this.gp_times.visible=!0,this.blb_times.text=this.info.data.playerInfo.snatchTimes.toString()},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityFishingRecordSkin",t}a.ActivityFishingRecordPanel=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.fightPy.BattlePlayBack(t.data.info.battleUuid,{doneCB:function(){a.GameMVC.activityMed.showViewByCode(EActivityType.ZoneFishing)}})},this),this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar)},r.prototype.dataChanged=function(){this.lb_name.text=this.data.info.baseInfo.name;var t=void 0;t=this.data.info.challengerId!=this.playerPy.playerInfoVO.playerId?this.data.info.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.data.info.result,this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(this.data.info.baseInfo.fightCap),this.avatar.updateData({vo:this.data.info.baseInfo}),this.lb_time.visible=!0,t===EBattleResult.EBattleResultWin?this.img_result.source="jjc_icon_sheng_png":this.img_result.source="jjc_icon_bai_png",this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-this.data.info.battleDt)},r);function r(){var t=n.call(this)||this;return t.fightPy=a.GameMVC.fightPy,t.playerPy=a.GameMVC.playerPy,t.skinName="ActivityFishingRecordPanel_RecordItem",t}var s,c=(s=eui.ItemRenderer,__extends(d,s),d.prototype.childrenCreated=function(){var t=this;s.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_revenge,egret.TouchEvent.TOUCH_TAP,function(){0<t.activityPy.allActivityData[EActivityType.ZoneFishing].data.playerInfo.snatchTimes?t.activityPy.FishingChallenge({type:FishingActivityOper.Revenge,target:t.data.info.baseInfo.playerId,code:EActivityType.ZoneFishing},function(){t.data.view.hide()}):Utils.MsgUtils.addMidMsg("次数不足")},this),this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar);for(var e=0;e<6;e++)this.gp_items.addChild(customui.BaseItemFactory.create())},d.prototype.dataChanged=function(){var t=this.data.info.baseInfo;this.avatar.updateData({vo:t}),this.lb_name.text=t.name;for(var e=this.data.info.creel,i=0;i<6;i++){var a=this.gp_items.getChildAt(i),n=e[i];e[i]?(a.visible=!0,a.updateData({code:n[0],num:n[1]})):a.visible=!1}this.item_fightCap.update(t.fightCap)},d);function d(){var t=s.call(this)||this;return t.activityPy=a.GameMVC.activityPy,t.skinName="ActivityFishingRecordPanel_RevengeItem",t}}(game=game||{}),function(r){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){var n=this;function t(e){var i=e<3?FishingActivityOper.ChangeRod:e<6?FishingActivityOper.ChangeBait:FishingActivityOper.ChangeCreel,a=e<3?e+1:e<6?e-2:e-5;o["gp_btn_"+e].touchChildren=!1,o["gp_btn_"+e].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){n["gp_btn_"+e].scaleX=n["gp_btn_"+e].scaleY=.9},o),o["gp_btn_"+e].addEventListener(egret.TouchEvent.TOUCH_END,function(){n["gp_btn_"+e].scaleX=n["gp_btn_"+e].scaleY=1},o),o["gp_btn_"+e].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n["gp_btn_"+e].scaleX=n["gp_btn_"+e].scaleY=1},o),o["gp_btn_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t={code:EActivityType.ZoneFishing,type:i,target:a,num:void 0,content:n.params.content};n.py.FishingOperation(t,n.updateView.bind(n),n.updateText.bind(n))},o),o["img_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.itemIdList[e];PopUpManager.addPopUp({obj:new r.BaseItemDetailView({code:t})})},o)}i.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this);for(var o=this,e=0;e<9;e++)t(e);this.heroModel0.update({model:"hero_019_02",isStatic:!0})},e.prototype.updateText=function(){Utils.MsgUtils.addMidMsg("购买成功")},e.prototype.updateView=function(t){this.params=t,this.gp_0,this.gp_1,this.gp_2,this.gp_3,this.gp_4,this.gp_5,this.gp_6,this.gp_7,this.gp_8;for(var e=t.info.playerInfo,i=t.content,a=0;a<9;a++)if(a<3)this["img_use_"+a].visible=e.curRodCode-1==a,this["gp_btn_"+a].visible=!(e.curRodCode-1>=a),this["num_"+a].updateItem({cost:i[0][a][1][0],style:CommonIconStyle.RIGHT}),UIActionManager.setGrey(this["gp_"+a],e.curRodCode-1>a);else if(a<6){var n=a-3;this["img_use_"+a].visible=e.curBaitCode-1==n,this["gp_btn_"+a].visible=!(e.curBaitCode-1>=n),this["num_"+a].updateItem({cost:i[0][n][1][0],style:CommonIconStyle.RIGHT}),UIActionManager.setGrey(this["gp_"+a],e.curBaitCode-1>n)}else if(a<9){var o=a-6;this["img_use_"+a].visible=e.curCreelCode-1==o,this["gp_btn_"+a].visible=!(e.curCreelCode-1>=o),this["num_"+a].updateItem({cost:i[0][o][1][0],style:CommonIconStyle.RIGHT}),UIActionManager.setGrey(this["gp_"+a],e.curCreelCode-1>o)}},e);function e(){var t=i.call(this)||this;return t.params=void 0,t.code=EActivityType.ZoneFishing,t.py=r.AppFacade.getInstance().retrieveProxy(r.ActivityPy.N),t.data=void 0,t.itemIdList=[30001087,30001088,30001089,30001081,30001082,30001083,30001084,30001085,30001086],t.skinName="ActivityFishingShopSkin",t}r.ActivityFishingShopPanel=t}(game=game||{}),function(o){var n,t=(n=o.ActivityCommonView,__extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"common_hjcdcj",parent:this.gp_main,z:1,loop:!0,scaleX:.7,scaleY:.7}),this.activateComponent()},e.prototype.buyCount=function(){var i=this,t=this.info.content[5];o.GameMVC.backpackPy.checkEnough(t,!1)?o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Activity+EActivityType.ZoneFishing,hasBuyNum:this.info.data.playerInfo.buyCount,buyCB:function(t){var e={code:EActivityType.ZoneFishing,type:FishingActivityOper.BuySnatch,target:void 0,num:t};i.py.FishingOperation(e)},curNum:this.info.data.playerInfo.snatchTimes,maxNum:this.info.content[7],maxBuyNum:this.info.content[7]}):Utils.MsgUtils.addMidMsg("您的货币不足")},e.prototype.updateView=function(t){n.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){this.data=e.data,this.blb_count.text=e.data.playerInfo.snatchTimes,this.curFishNum=0;var i=this.info.data.playerInfo.creel;for(var a in i)this.curFishNum+=i[a][1];this.btn_fish.visible=0===e.data.playerInfo.fishingDt&&0===this.curFishNum,this.updateEffect(),this.updateInfo(),this.updateTime(),this.updateTextList(),t.newFish&&this.updateFish(t.newFish)}},e.prototype.updateFish=function(t){var e={type:EEntityType.EEntityTypeItem,code:t,num:1};Utils.MsgUtils.addRewardMsg({rewards:[e]},this.gp_effectCreel,{oriY:0,offsetY1:-100,cb:function(){}})},e.prototype.updateEffect=function(){var a=this;function t(i){e[i-1]?n.effectList[i]||DragonBoneTools.create("zhujiao_nan_dy_01",function(t){if(!a.effectList[i]){a.effectList[i]=t;var e=a["gp_effectOther_"+i];t.x=e.width/2,t.y=e.height,t.scaleX=i%2==0?1:-1,e.addChild(t),t.animation.play("daiji"),a.autoAction(i)}}):n.effectList[i]&&(n.effectList[i].parent&&n.effectList[i].parent.removeChild(n.effectList[i]),n.effectList[i]=void 0,n.actionTimers[i]&&egret.clearTimeout(n.actionTimers[i]),n.actionTimers[i]=void 0)}this.effectList[0]?this.runSeriesAction(0,["shougan","shuaigan","daiji"]):DragonBoneTools.create("zhujiao_nan_dy_02",function(t){a.effectList[0]||((a.effectList[0]=t).x=a.gp_effectMy.width/2,t.y=a.gp_effectMy.height,a.gp_effectMy.addChild(t),t.animation.play(a.info.data.playerInfo.fishingDt?"daiji":"daiji2"))});for(var e=this.info.data.playerInfo.snatchList,n=this,i=1;i<5;i++)t(i);var o=this.info.data.playerInfo.curCreelCode||1,r=this.info.content[8][o-1],s=this.info.content[2][o-1][2],c=this.gp_effectCreel.numChildren&&this.gp_effectCreel.getChildAt(0);c&&c.armature.armatureData.name===r?this.curFishNum<Math.floor(s/3)?c.animation.play("daiji1",0):this.curFishNum<Math.floor(s/3*2)?c.animation.play("daiji2",0):c.animation.play("daiji3",0):(this.gp_effectCreel.removeChildren(),DragonBoneTools.create(r,function(t){a.gp_effectCreel.numChildren||(t.x=a.gp_effectCreel.width/2,t.y=a.gp_effectCreel.height,a.gp_effectCreel.addChild(t),a.curFishNum<Math.floor(s/3)?t.animation.play("daiji1",0):a.curFishNum<Math.floor(s/3*2)?t.animation.play("daiji2",0):t.animation.play("daiji3",0))})),this.img_full.visible=this.curFishNum===s},e.prototype.updateInfo=function(){for(var t=this.info.data.playerInfo.snatchList,e=1;e<5;e++)t[e-1]?(this["gp_name_"+e].visible=!0,this["btn_snatch_"+e].visible=!0,this["lb_name_"+e].text="S"+t[e-1][2]+"."+t[e-1][1]):(this["gp_name_"+e].visible=!1,this["btn_snatch_"+e].visible=!1)},e.prototype.updateTextList=function(){for(var t=this.data.fishingRecords,e=this.info.content[3],i=this.info.content[0],a=[],n=t.length-1;0<=n;n--){var o=0;for(var r in e)if(e[r][0]==t[n].fishCode){o=e[r][1];break}var s=0;for(var r in i)if(i[r][0]==t[n].rodCode){s=i[r][3];break}var c={fishId:o,rodId:s,name:t[n].name};a.push(c)}this.list.itemRenderer=d,this.list.dataProvider=new eui.ArrayCollection(a),this.gp_empty.visible=!(0<a.length)},e.prototype.updateTime=function(){this.timer||(this.remainingDt=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(this.remainingDt--):o.AppFacade.getInstance().hideSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAIN)},e.prototype.runSeriesAction=function(t,e){var i=this;if(this.effectList[t]&&e.length){var a=e.shift();this.goAction(t,a,function(){i.runSeriesAction(t,e)})}},e.prototype.goAction=function(t,e,i){var a=this;if(!this.effectRunning[t]){var n=this.effectList[t];this.effectRunning[t]=!0,n.animation.play(e),n.once(dragonBones.EgretEvent.LOOP_COMPLETE,function(){a.effectRunning[t]=!1,i&&i()},this)}},e.prototype.autoAction=function(t){var e=this;this.effectList[t]&&(this.actionTimers[t]=egret.setTimeout(function(){e.runSeriesAction(t,["shougan","shuaigan","daiji"]),e.autoAction(t)},this,1e3*Utils.MathUtils.getRandomInt(15,35)))},e.prototype.activateComponent=function(){var i=this;function t(t){e["gp_effectOther_"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.data&&i.data.playerInfo&&i.data.playerInfo.snatchList&&i.data.playerInfo.snatchList[t-1])if(0<i.data.playerInfo.snatchTimes){var e=i.info.content;i.py.FishingGetEnemyInfo(i.data.playerInfo.snatchList[t-1][0],function(t){o.AppFacade.getInstance().showSubView(o.ActivityMediator.N,o.ActivityMediator.SV.FISHINGCHALLGE,{info:t,content:e})})}else Utils.MsgUtils.addMidMsg("当前无挑战次数")},e)}this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.Activity+EActivityType.ZoneFishing})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"FishingRank"})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.ActivityMediator.N,o.ActivityMediator.SV.FISHINGSHOP,{info:i.info.data,content:i.info.content})},this),this.btn_fish.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t={code:EActivityType.ZoneFishing,type:FishingActivityOper.StartFishing,target:void 0,num:void 0};i.py.FishingOperation(t,function(){i.runSeriesAction(0,["shuaigan","daiji"]),DragonBoneTools.playOnce({effectName:"common_ty_kaishidiaoyu",parent:GameRootLayer.gameLayer().popMsgLayer})})},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t={code:EActivityType.ZoneFishing,type:FishingActivityOper.RefreshSnatchList,target:void 0,num:void 0};i.py.FishingOperation(t,function(){Utils.MsgUtils.addMidMsg("刷新成功"),i.refreshCD=5,i.blb_cd.text="5s",i.btn_change.enabled=!1,UIActionManager.setAbsGrey(i.btn_change,!0),i.refreshTimer=egret.setInterval(function(){i.refreshCD?i.blb_cd.text=--i.refreshCD+"s":(i.blb_cd.text="",UIActionManager.setAbsGrey(i.btn_change,!1),i.btn_change.enabled=!0,egret.clearInterval(i.refreshTimer),i.refreshTimer=void 0)},i,1e3)})},this),this.gp_effectCreel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.curFishNum?DragonBoneTools.playOnce({effectName:"common_shuzswb",parent:i.gp_effectCreel,doneCB:function(){var t={code:EActivityType.ZoneFishing,type:FishingActivityOper.GetFish,target:void 0,num:void 0};i.py.FishingOperation(t)}}):Utils.MsgUtils.addMidMsg("暂无鱼可收取")},this);for(var e=this,a=1;a<5;a++)t(a);this.btn_old.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.ActivityFishingRecordPanel})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.buyCount()},this)},e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),this.actionTimers.forEach(function(t){t&&egret.clearTimeout(t)}),this.refreshTimer&&egret.clearInterval(this.refreshTimer)},e);function e(){var t=n.call(this)||this;return t.code=EActivityType.ZoneFishing,t.py=o.GameMVC.activityPy,t.data=void 0,t.effectList=[],t.effectRunning={},t.actionTimers=[],t.refreshCD=0,t.refreshTimer=0,t.skinName="ActivityFishingSkin",t}o.ActivityFishingView=t;var i,d=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){var t=this.data,e=[],i=o.Config.itemConfig()[t.fishId],a=o.Config.itemConfig()[t.rodId],n=a?a.name:"黄金鱼竿";e.push({text:"恭喜 ",style:{textColor:16777215}}),e.push({text:t.name,style:{textColor:10354658}}),e.push({text:" 使用 ",style:{textColor:16777215}}),e.push({text:n,style:{textColor:16764712}}),e.push({text:" 成功捕捉 ",style:{textColor:16777215}}),e.push({text:i.name,style:{textColor:16742927}}),this.lb_text.textFlow=e},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityFishingTextSkin",t}}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonListView,__extends(a,e),a.prototype.getDataList=function(){var r=this,t=this.info,e=t.content,s=t.data.targeted,c=t.data.purchaseTime,i=t.data.day,d=[];for(var a in e){var n=e[a];if(n[0]==i){function o(t){var e=h[t],i=e[0],a=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;s.some(function(t){return t.id==e[0]&&0<t.time})?o=REWARD_STATUS.RECEIVED:a<=c&&(o=REWARD_STATUS.AVAILABLE),d.push({title:"扭蛋"+a+"次",tips:c+"/"+a,rewards:n,status:o,btnFunc:function(){r.getReward({id:i})}})}var h=n[1];for(var l in h)o(l);break}}return d.sort(function(t,e){return t.status-e.status}),d},a);function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.code=EActivityType.FlashCapsuleHigh,t}t.ActivityFlashCapsule=i}(game=game||{}),function(a){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if("yqyl_img_hongbao01_png"==i.img_hongbao.source){var t=a.AppFacade.getInstance().retrieveProxy(a.ActivityPy.N),e={relationType:2,tPlayerId:i.info.playerId};t.GetShareRelationRewards(e,function(t){i.hide()})}else i.hide()},this),this.updateView()},i.prototype.updateView=function(){var i=this,t=this.py.upRelationInfos[0];this.info=t,this.img_no.visible=!1,this.img_hongbao.source="yqyl_img_hongbao01_png",this.gp_get.visible=!1,this.lb_name.text=t.name,this.gp_name.y=135,this.playerhead.visible=!0,this.playerProxy.GetPublicPlayerBaseInfo([t.playerId],function(t,e){i.playerhead.updateData({vo:t[0].baseInfo})})},i.prototype.updateStatus=function(t){this.img_hongbao.source="yqyl_img_hongbao02_png",this.gp_get.visible=!0,this.gp_name.y=25,this.lb_num.text="555"},i);function i(){var t=e.call(this)||this;return t.info=void 0,t.py=a.AppFacade.getInstance().retrieveProxy(a.ActivityPy.N),t.playerProxy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),t.skinName="ActivityFriendShareIRedItem",t}a.ActivityFriendRedBagPanel=t}(game=game||{}),function(m){var e,t=(e=m.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.dp=new eui.ArrayCollection,this.list_item.dataProvider=this.dp,this.activateComponent(),this.sl_items.scrollPolicyH=eui.ScrollPolicy.OFF,this.initTabbar(),this.updateView(),this.addNotice(),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.GameMVC.commonMed.showHelpDialog(MODULE.Activity+EActivityType.FriendShare)},this)},i.prototype.initList1=function(){this.list_item.itemRenderer=s;var t=new eui.VerticalLayout;this.list_item.layout=t},i.prototype.initList2=function(){this.list_item.itemRenderer=n;var t=new eui.TileLayout;t.requestedColumnCount=3,this.list_item.layout=t},i.prototype.initList3=function(){this.list_item.itemRenderer=h;var t=new eui.TileLayout;t.requestedColumnCount=3,t.horizontalGap=-8,this.list_item.layout=t},i.prototype.initTabbar=function(){this.tb_bottom.itemRendererSkinName="FriendTabBarItemSkin",Utils.SDKMgr.getPerformConfig(2016)?this.tb_bottom.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_yaoqingyouli_0",down:"_btn_yq_m_json.common_yeqian_yaoqingyouli_1",text:""},{up:"_btn_yq_m_json.common_yeqian_fenxianghongbao_0",down:"_btn_yq_m_json.common_yeqian_fenxianghongbao_1",text:""}]):this.tb_bottom.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_yaoqingyouli_0",down:"_btn_yq_m_json.common_yeqian_yaoqingyouli_1",text:""},{up:"_btn_yq_m_json.common_yeqian_fenxianghongbao_0",down:"_btn_yq_m_json.common_yeqian_fenxianghongbao_1",text:""},{up:"_btn_yq_m_json.common_yeqian_haoyouhongbao_0",down:"_btn_yq_m_json.common_yeqian_haoyouhongbao_1",text:""},{up:"_btn_yq_m_json.common_yeqian_yaoqinghaoyou_0",down:"_btn_yq_m_json.common_yeqian_yaoqinghaoyou_1",text:""},{up:"_btn_yq_m_json.common_yeqian_haoyouchongji_0",down:"_btn_yq_m_json.common_yeqian_haoyouchongji_1",text:""},{up:"_btn_yq_m_json.common_yeqian_haoyoufanli_0",down:"_btn_yq_m_json.common_yeqian_haoyoufanli_1",text:""}]),this.tb_bottom.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},i.prototype.onBarItemTap=function(t){t.itemIndex!=this.curSelectIndex&&(this.curSelectIndex=t.itemIndex,this.updateView())},i.prototype.updateView=function(t){switch(t&&null!=t.index&&(this.curSelectIndex=t.index),this.updateTitle(),this.gp_list.visible=!1,this.gp_redPocket.visible=!1,this.btn_shop.visible=!1,this.btn_friend.visible=!1,Utils.SDKMgr.getPerformConfig(27)?this.btn_share.label="邀请游戏":this.btn_share.label="分享游戏",this.curSelectIndex){case 0:case 1:this.gp_list.visible=!0,this.initList1(),this.updateList01();break;case 2:this.gp_list.visible=!0,this.initList3(),this.updateList4();break;case 3:case 4:this.gp_list.visible=!0,this.initList2(),this.updateList23(),this.btn_shop.visible=!0;break;case 5:this.gp_redPocket.visible=!0,this.updateRedPockets()}},i.prototype.updateTitle=function(){var h=this;function t(){h.lb_todayShare.visible=!0;var t,e=m.Config.relationRewardConfigs(),i=0,a=0,n=[];0==h.curSelectIndex?(i=RelationType.Share,a=0,n=h.actProxy.downRelationInfosAny):1==h.curSelectIndex&&(i=RelationType.Recommend,a=0,n=h.actProxy.downRelationInfos);var o=[];for(var r in e){var s=e[r];s.relationType==i&&s.requireType==a&&o.push(s)}o.sort(function(t,e){return t.count>e.count?1:-1}),t=o[o.length-1].count;var c,d=[];for(var r in n)2==i?d.push(n[r]):new Date(1e3*Utils.TimerManager.getServerTime()).toDateString()===new Date(1e3*n[r].dt).toDateString()&&d.push(n[r]);c=d.length,0==h.curSelectIndex?h.lb_todayShare.textFlow=[{style:{textColor:16777215},text:"今日已邀请玩家"},{style:{textColor:3211008},text:"("+c+"/"+t+")"}]:h.lb_todayShare.textFlow=[{style:{textColor:16777215},text:"已邀请新注册玩家"},{style:{textColor:3211008},text:"("+c+"/"+t+")"}]}switch(this.bm_tips.text="",this.lb_todayShare.visible=!1,this.curSelectIndex){case 0:this.img_title.y=0,Utils.SDKMgr.getPerformConfig(27)?this.img_title.source="hyfx_img_meirifenxiang_awy_png":this.img_title.source="yqyl_img_hengfu03_png",t();break;case 1:this.img_title.y=0,Utils.SDKMgr.getPerformConfig(27)?this.img_title.source="hyfx_img_leijifenxiang_awy_png":this.img_title.source="yqyl_img_hengfu04_png",t();break;case 2:this.img_title.source="yqyl_img_hengfu01_png",this.img_title.y=0,this.bm_tips.horizontalCenter=-25.5,this.bm_tips.x=282,this.bm_tips.y=107.44,this.bm_tips.text="";var e=m.Config.constConfig().MaxShareRelationRewardsGetTime.constValue,i=[];for(var a in this.lb_todayShare.visible=!0,this.actProxy.upRelationInfos)this.actProxy.upRelationInfos[a].isShareGotten&&i.push(this.actProxy.upRelationInfos[a]);var n=i.length;this.lb_todayShare.textFlow=[{style:{textColor:16777215},text:"今日可领红包次数"},{style:{textColor:3211008},text:"("+n+"/"+e+")"}];break;case 3:this.img_title.source="hyfx_img_yaoqinghaoyou_png",this.img_title.y=-31,this.bm_tips.horizontalCenter=-25.5,this.bm_tips.x=282,this.bm_tips.y=107.44,this.bm_tips.text=this.LEVEL_GUILD[0].toString();break;case 4:this.img_title.source="hyfx_img_yaoqinghaoyou_png",this.img_title.y=-31,this.bm_tips.horizontalCenter=-25.5,this.bm_tips.x=282,this.bm_tips.y=107.44,this.bm_tips.text=this.LEVEL_GUILD[1].toString();break;case 5:this.img_title.source="yqyl_img_hengfu02_png",this.img_title.y=0,this.bm_tips.horizontalCenter=-65,this.bm_tips.y=175,this.bm_tips.text=(Number(m.Config.constConfig().FriendRelationRedBagRatio.constValue)/100).toString()}},i.prototype.updateList01=function(){var s=this,c=m.Config.relationRewardConfigs(),d=RelationType.Recommend,t=[],h=0,l=this.actProxy.releationTargeted;0==this.curSelectIndex?(d=RelationType.Share,t=this.actProxy.downRelationInfosAny,h=0,l=this.actProxy.releationTargetedNew):1==this.curSelectIndex&&(d=RelationType.Recommend,t=this.actProxy.downRelationInfos,h=0);var p=[],u="邀请%s人新人注册奖励";0==this.curSelectIndex&&(u="邀请%s人奖励");var g,e=[];for(var i in t)2==d?e.push(t[i]):new Date(1e3*Utils.TimerManager.getServerTime()).toDateString()===new Date(1e3*t[i].dt).toDateString()&&e.push(t[i]);function a(t){var e=c[t];if(e.relationType==d&&e.requireType==h){var i=e.id,a=e.count,n=e.reward,o=REWARD_STATUS.UNAVAILABLE;a<=g&&(o=REWARD_STATUS.AVAILABLE),0<=l.indexOf(i)&&(o=REWARD_STATUS.RECEIVED);var r={id:i,status:o,rewards:n,tips:g+"/"+a,title:u.format([a]),btnFunc:function(){switch(o){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.AVAILABLE:m.AppFacade.getInstance().retrieveProxy(m.ActivityPy.N).GetRelationReward(e.relationType,i,function(){s.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};p.push(r)}}for(var i in g=e.length,c)a(i);this.commonSortDataList(p),this.dp.removeAll(),p.forEach(function(t){s.dp.addItem(t)}),this.once(egret.Event.ENTER_FRAME,function(){s.list_item.scrollV=0},this)},i.prototype.updateList23=function(){var t,e=this,i=m.Config.relationRewardConfigs(),a=99999,n=0;for(var o in this.dp.removeAll(),3==this.curSelectIndex?a=this.LEVEL_GUILD[0]:4==this.curSelectIndex&&(a=this.LEVEL_GUILD[1]),t=this.actProxy.downRelationInfos.filter(function(t){return t.level>=a}),i){var r=i[o];r.level==a&&this.dp.addItem({c:r,vo:t[n++],isGet:-1!=this.actProxy.releationTargeted.indexOf(r.id)})}this.once(egret.Event.ENTER_FRAME,function(){e.list_item.scrollV=0},this)},i.prototype.updateList4=function(){var e=this;this.dp.removeAll();var t=[],i=[];for(var a in this.actProxy.upRelationInfos)this.actProxy.upRelationInfos[a].isShareGotten&&i.push(this.actProxy.upRelationInfos[a]);var n=m.Config.constConfig().MaxShareRelationRewardsGetTime.constValue,o=i.length;for(var a in this.actProxy.upRelationInfos)if(this.actProxy.upRelationInfos[a]){var r={info:this.actProxy.upRelationInfos[a],cb:this.updateView.bind(this),isCan:!(n<=o)};t.push(r)}0==t.length?(this.gp_redPocket.visible=!0,this.gp_list.visible=!1,this.gp_empty.visible=!0,this.gp_red_pocket_item.visible=!1):(t.sort&&t.sort(function(t,e){return t.info.isShareGotten?1:-1}),t.forEach(function(t){e.dp.addItem(t)})),this.once(egret.Event.ENTER_FRAME,function(){e.list_item.scrollV=0},this)},i.prototype.dismissRedPocketAction=function(t){UIActionManager.fadeIn(this.gp_red_pocket_item,500,function(){t&&t()},!0)},i.prototype.showRedPocketAction=function(t){UIActionManager.fadeIn(this.gp_red_pocket_item,500,function(){t&&t()})},i.prototype.updateRedPockets=function(){var i=this;if(0==this.actProxy.relationRedBagInfos.length)this.gp_empty.visible=!0,this.gp_red_pocket_item.visible=!1;else{var a=this.actProxy.relationRedBagInfos[0],t=m.Config.constConfig().FriendRelationRedBagRatio.constValue,e=Math.floor(a.num*t/100);this.lb_num.text=e+"",this.playerProxy.GetGPPublicPlayerBaseInfo([a.playerId],a.gamePlatform,function(t,e){i.playerhead.updateData({vo:t[0].baseInfo}),i.lb_name.text=""+e[a.playerId].baseInfo.name,i.gp_empty.visible=!1,i.gp_red_pocket_item.visible=!0,i.showRedPocketAction()})}},i.prototype.doShare=function(){var t=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N);Utils.SDKMgr.share({recommendId:t.roleVo.playerId,recommendPlatform:Utils.agentConfig.AgentCode+"#"+this.actProxy.gamePlatform,sceneId:WeChatTargetType.Share2Friend},function(t){})},i.prototype.activateComponent=function(){var t=this;Utils.SDKMgr.getPerformConfig(27)?this.CommonDaTanChuKuang.blb_title.text="邀请好友":this.CommonDaTanChuKuang.blb_title.text="分享好友",this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.doShare()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeShare})},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;0<this.actProxy.relationRedBagInfos.length?this.actProxy.GetRelationRedBag(RelationType.Recommend,this.actProxy.relationRedBagInfos[0].uuid,function(){t.dismissRedPocketAction(function(){t.updateRedPockets()})}):Utils.MsgUtils.addMidMsg("当前没有红包")},this)},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeShare],this.btn_shop.$children[0],this,BTN_ICON_NOTICE_POS);for(var t=0;t<6;t++)NoticeManager.addNoticeListener(NT.FRIEND_SHARE_REWARD[t],this.tb_bottom,this,{percentX:(85*t+60)/506,percentY:30/84})},i);function i(){var t=e.call(this)||this;return t.curSelectIndex=0,t.code=EActivityType.FriendShare,t.playerProxy=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N),t.LEVEL_GUILD=[30,60],t.skinName="ActivityFriendShare",t}m.ActivityFriendShare=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;m.AppFacade.getInstance().retrieveProxy(m.ActivityPy.N).GetRelationReward(RelationType.Recommend,this.data.c.id,function(){t.data.isGet=!0,t.updateStatus()})},this)},o.prototype.updateStatus=function(){this.data.vo&&!this.data.isGet?(this.img_wdc.visible=!1,this.btn_get.touchEnabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1),this.btn_get.skinName="skins.ButtonSkinYellow2",this.btn_get.label="领 取",this.img_wdc.visible=!1):this.data.vo&&this.data.isGet?(this.img_wdc.visible=!1,this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),this.btn_get.skinName="skins.ButtonSkinSure",this.btn_get.label="已领取",this.img_wdc.visible=!1):(this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),this.btn_get.label="",this.img_wdc.visible=!0)},o.prototype.dataChanged=function(){var t=this;this.lb_title.text="第"+(this.itemIndex+1)+"位好友",this.data.vo?(this.playerhead.visible=!0,this.gp_empty.visible=!1,this.playerhead.updateData({vo:this.data.vo}),this.playerhead.addTapEvent(function(){m.AppFacade.getInstance().showSubView(m.FriendMediator.N,m.FriendMediator.SV.INFO,{playerId:t.data.vo.playerId,gamePlatform:t.data.vo.gamePlatform})})):(this.playerhead.visible=!1,this.gp_empty.visible=!0,this.playerhead.updateData());var e=JSON.parse(this.data.c.reward)[0];this.img_reward.source=ResourceUtils.png(m.GeneralConfig.getEntityConfigByCode(e[0],e[1]).icon),this.lb_reward.text="奖励:"+e[2],this.updateStatus()},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityFriendShareItem2",t}var r,s=(r=m.ActivityCommonListItem,__extends(c,r),c);function c(){var t=r.call(this)||this;return t.skinName="ActivityFriendShareItem1",t}var d,h=(d=eui.ItemRenderer,__extends(l,d),l.prototype.childrenCreated=function(){this.scaleX=this.scaleY=.7,d.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;if("yqyl_img_hongbao01_png"==this.img_hongbao.source)if(this.data.isCan){var t=m.AppFacade.getInstance().retrieveProxy(m.ActivityPy.N),i={relationType:RelationType.Share,tPlayerId:this.data.info.playerId};t.GetShareRelationRewards(i,function(t){e.cb&&e.cb()})}else Utils.MsgUtils.addMidMsg("今天已达到领取上限")},this)},l.prototype.dataChanged=function(){var i=this,t=this.data.info;if(this.cb=this.data.cb,this.lb_name.text=t.name,this.img_no.visible=!1,t.avatar||(t.avatar=""),this.playerhead.visible=!0,this.playerProxy.GetGPPublicPlayerBaseInfo([t.playerId],t.gamePlatform,function(t,e){i.playerhead.updateData({vo:t[0].baseInfo})}),t.isShareGotten){this.img_hongbao.source="yqyl_img_hongbao02_png",this.gp_get.visible=!0,this.gp_name.y=25;var e=JSON.parse(t.extraData);this.lb_num.text=e.diamondNum}else this.img_hongbao.source="yqyl_img_hongbao01_png",this.gp_get.visible=!1,this.gp_name.y=135,this.lb_num.text=""},l);function l(){var t=d.call(this)||this;return t.playerProxy=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N),t.skinName="ActivityFriendShareIRedItem",t}}(game=game||{}),function(s){var e,t=(e=s.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.activateComponent()},i.prototype.updateView=function(t){this.code=t&&t.activityType||t&&t.code||this.code;var e=this.info;if(e&&e.data){var i=e.content,a=i[0],n=i[2],o=i[3],r=i[4];for(var s in this.heroModel.update({model:r,isStatic:!0}),this.gp_top.removeChildren(),o){var c=o[s],d=customui.BaseItemFactory.create();d.updateData({code:c[0][1]}),d.scaleX=d.scaleY=.95,this.gp_top.addChild(d)}this.costIcon1.updateItem({cost:a[0],style:CommonIconStyle.RIGHT}),this.costIcon10.updateItem({cost:n[0],style:CommonIconStyle.RIGHT}),this.CommonResourceBar.updateBar(a),this.cost1=a[0],this.cost10=n[0]}},i.prototype.doGashapon=function(e){var n=this;GameRootLayer.gameLayer().switchTouchEnable(!1),Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:e}).then(function(t){n.actProxy.allActivityData[n.code]&&n.actProxy.allActivityData[n.code].updateData(t.info),GameRootLayer.gameLayer().switchTouchEnable(!0),s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.COMMON_GACHA_RESULT,{cost1:n.cost1,cost10:n.cost10,freeTimes:0,rewards:t.clientReward.heros,gacha_1_cb:function(){n.doGashapon(1)},gacha_10_cb:function(){n.doGashapon(3)},rewardLength:e,choukaEnd_cb:function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},showSpecialEffect:function(t){var e=n.info;if(!e||!e.data)return!1;var i=e.content[3];for(var a in i)if(t==i[a][0][1]&&i[a][0][3])return!0;return!1}})}).catch(function(t){GameRootLayer.gameLayer().switchTouchEnable(!0)})},i.prototype.activateComponent=function(){var i=this;this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.doGashapon(1)},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.doGashapon(3)},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.data.records;0<e.length?PopUpManager.addPopUp({obj:new n({records:e})}):Utils.MsgUtils.addMidMsg("当前无中奖记录")}},this)},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityGashaponView",t}s.ActivityGashaponView=t;var a,n=(a=BasePanel,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.updateView()},o.prototype.updateView=function(){if(this.params){var t=this.params.records;for(var e in t.sort(function(t,e){return e.dt-t.dt}),this.lb_title.text=this.params.title||"记录",s.Config.allHeroConfig(),this.gp_root.removeChildren(),t){var i=t[e],a=[];if(i.textFlow)a=i.textFlow;else{var n=i.rewards[0],o=s.GeneralConfig.getEntityConfigByCode(n.type,n.code);o&&(a=[{text:i.name,style:{textColor:16777215}},{text:" 获得 ",style:{textColor:16777215}},{text:o.name,style:{textColor:16777215}},{text:" ×"+n.num,style:{textColor:16777215}}])}var r=new eui.Label;r.size=22,r.textFlow=a,this.gp_root.addChild(r)}this.lb_desc.text=this.params.desc||""}},o);function o(t){var e=a.call(this)||this;return e.skinName="RecordPanel",e.params=t,e}s.RecordPanel=n}(game=game||{}),function(c){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent(),Utils.LocalStorageUtil.setTodayVaild("HAS_CLICK_GZGZH_BTN")},i.prototype.updateView=function(t){if(t&&t.source)this.img_bg.source=t.source;else if(Utils.SDKMgr.getPerformConfig(20001)){var e=this.img_bg.parent;if(!e)return;e.verticalCenter=0,this.img_bg.source=Utils.SDKMgr.getPerformConfig(200002)||"scbz_img_shoucang_qqxyx_png",this.img_bg.y=110;var i=new eui.Group,a=new eui.HorizontalLayout;a.horizontalAlign="center",i.layout=a,i.width=400,i.height=111,i.horizontalCenter=-50,i.y=516;var n=c.Config.operationConfig()[6];c.GameMVC.activityPy.operationHasExec(6),c.GameMgr.getInstance().CommonGpAddReward(i,JSON.parse(n.reward)),e.addChild(i);var o=new eui.Image;o.source="xinshou_img_shouzhi_png",o.y=0,o.x=570,Utils.DeviceUtils.setLiuHaiPingAdapter(o);var r=o.y;egret.Tween.get(o,{loop:!0}).to({y:r+30},1e3).to({y:r},1e3),this.addChild(o);var s=new eui.Button;s.label="领取",s.skinName="skins.ButtonSkinYellow",s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){getUrlKV().fromQuickEntrance?c.GameMVC.activityPy.operationHasExec(6)?Utils.MsgUtils.addMidMsg("奖励已领取"):(c.GameMVC.activityPy.getOperationReward(6),Utils.MsgUtils.addMidMsg("奖励已发送至邮箱")):Utils.MsgUtils.addMidMsg("请大退后从快捷入口进入")},this),s.x=190,s.y=631,e.addChild(s)}else RES.hasRes(Utils.SDKMgr.getPerformConfig(200002))&&(this.img_bg.source=Utils.SDKMgr.getPerformConfig(200002))},i.prototype.activateComponent=function(){var t=this;Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){t.hide()}),Utils.SDKMgr.getPerformConfig(200005)&&(this.gp_copy.visible=!0,Utils.ComponentUtils.registerListener(this.gp_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.copyToClipBoard(Utils.SDKMgr.getPerformConfig(200005),function(){Utils.MsgUtils.addMidMsg("复制成功")})}))},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.ShouCangYouLi,t.skinName="ActivityGZGZHViewSkin",t}c.ActivityGZGZHView=t;var a,n=(a=BasePanel,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="关注礼包",this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.activateComponent(),Utils.LocalStorageUtil.setTodayVaild("HAS_CLICK_GZGZH_BTN")},o.prototype.updateView=function(t){},o.prototype.activateComponent=function(){this.btn_copy.visible=!1;var t=Utils.SDKMgr.getPerformConfig(200005);t&&(this.btn_copy.visible=!0,this.lb_1.text="1、微信搜索 ”"+t+"“ ",this.lb_2.text="2、点击【"+t+"】并关注",Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.copyToClipBoard(t,function(){Utils.MsgUtils.addMidMsg("复制成功")})}))},o);function o(){var t=a.call(this)||this;return t.code=EActivityType.ShouCangYouLi,t.skinName="ActivityGZGZHViewSkin2",t}c.ActivityGZGZHView2=n;var r,s=(r=BasePanel,__extends(d,r),d.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.activateComponent()},d.prototype.updateView=function(t){},d.prototype.activateComponent=function(){this.cu_hero.update({model:"hero_skin_018_01",isStatic:!0}),this.btn_copy.visible=!1;var t=Utils.SDKMgr.getPerformConfig(200009);t&&(this.btn_copy.visible=!0,this.lb_1.text=t[0],this.lb_2.text=t[1],this.lb_3.text=t[2],this.lb_4.text=t[3],Utils.SDKMgr.getPerformConfig(41)?(this.btn_copy.label="跳转公众号",Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.cmd({type:"PopKeFu"})})):Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.copyToClipBoard(Utils.SDKMgr.getPerformConfig(200005),function(){Utils.MsgUtils.addMidMsg("复制成功")})}))},d);function d(){var t=r.call(this)||this;return t.skinName="ActivityGZGZHViewSkin3",t}c.ActivityGZGZHView3=s}(game=game||{}),function(E){var t,e,i=(t=E.ActivityCommonListView,__extends(o,t),o.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType,this.updateTitle();var e=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e),this.code){case EActivityType.ConsumeDiamondTask:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){E.AppFacade.getInstance().showSubView(E.RankMediator.N,E.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},o.prototype.getDataList=function(){var u=this,t=this.info;if(!t||!t.data)return[];var g=[],m=JSON.parse(t.content),y=t.data.targeted;function v(t){var e=0;for(var i in r){var a=(r[i].taskType+"").split(""),n=r[i].key,o=(t+"").split("");0==Number(o[o.length-4])?Number(o[o.length-5])==Number(a[a.length-5])&&(e+=n):Number(o[o.length-5])==Number(a[a.length-5])&&Number(o[o.length-4])==Number(a[a.length-4])&&(e+=n)}return e}y[0]||(y=[]);var r=t.data.keyList,f={},e=E.Config.activityConfigs()[this.code],_=e&&e.rotation||1,A=0,T=9999999,i=0,a=0;if(1!=_){for(var n=m.length/_,o=1;o<=_;o++){var s=m[C=o*n-1],c=(s[0],(s[1]+"").split("")),d=Number(c[c.length-1]),h=s[3],l=this.getTypeKey(h,s);if(!(d<=(f[l]||v(s[1])))){T=d;break}if(i++,!(y.length>C)){T=d;break}a++,A=d}_<=a&&(a=_-1,A=m[m.length-n-1]&&m[m.length-n-1][1]||0,T=m[m.length-1][1])}function p(t){var e=m[t],i=e[0],a=(e[1]+"").split(""),n=Number(a[a.length-1]);if(1!=_&&(n<=A||T<n))return"continue";var o=e[2],r=e[3],s=e[4],c=b.getTypeKey(r,e),d=f[c]||v(e[1]),h=REWARD_STATUS.CANBUY;n<=d&&(h=REWARD_STATUS.AVAILABLE),0<=y.indexOf(i)&&(h=REWARD_STATUS.RECEIVED);var l=b.getTitle(r,e);b.code==EActivityType.ConsumeDiamondTask&&h==REWARD_STATUS.CANBUY&&(h=REWARD_STATUS.UNAVAILABLE);var p={id:i,key:n,title:l,status:h,rewards:o,tips:d-A+"/"+(n-A),btnText:h==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(h){case REWARD_STATUS.AVAILABLE:u.getReward({code:u.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:s&&E.MainJumpConfig.jumpTo(s);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};g.push(p)}var b=this;for(var C in m)p(C);return this.commonSortDataList(g),e&&1!=e.rotation&&0!=e.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+_+")"),g},o.prototype.getTitle=function(t,e){switch(this.code){case EActivityType.HeroArtifactUpStarTask:var i=(e[1]+"").split(""),a=Number(i[i.length-4]),n="";return 0!=a&&(n=COLOR_CONFIG[a].name),(o.TaskType_2_Title[t]||"").format([Number(i[i.length-1]),n,Math.floor(e[1]/1e4)]);default:return(E.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]%1e4])}},o.prototype.getMax=function(t){switch(this.code){case EActivityType.ConsumeDiamondTask:return t;default:return t%1e4}},o.prototype.getTypeKey=function(t,e){var i=t;switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:i=e[1]-e[1]%1e4}return i},o.TaskType_2_Title=((e={})[TaskSubType.HeroArtifactUpStarNum]="任意%s个%s圣物升到%s星",e),o);function o(){return t.call(this)||this}E.ActivityHeroArtifactUpTaskView=i}(game=game||{}),function(l){var e,t=(e=l.ActivityCommonListView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.initList=function(){this.list_itemList.itemRenderer=n},i.prototype.getDataList=function(){function t(t){var e=o[t],r=e[0],n={id:r,slots:[],rewards:e[2],curNum:0,maxNum:e[3],view:d,btnFunc:function(){if(s.checkSatisfy(r)){function t(e){a[e].forEach(function(t){i.push({slotNum:Number(e),uuid:t})})}var i=[],a=s.selectedUuids[r];for(var e in a)t(e);var n=[];i.forEach(function(t){n.push(t.uuid)});var o=l.GameMVC.backpackPy.checkMultiTeamTips(n);o?l.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+o.name+"在"+o.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(t){1==t.type&&s.getReward({id:r,code:s.code,uuidInfos:i},function(){for(var t in a)a[t].splice(0),s.updateView()})}}):s.getReward({id:r,code:s.code,uuidInfos:i},function(){for(var t in a)a[t].splice(0),s.updateView()})}else Utils.MsgUtils.addMidMsg("条件未满足")}};d.selectedUuids[r]||(d.selectedUuids[r]={}),e[1].forEach(function(t,e){var i=e+1;s.selectedUuids[r][i]||(s.selectedUuids[r][i]=[]);var a={require:t,selected:s.selectedUuids[r][i],slotNum:i};n.slots.push(a)}),n.slots.sort(function(t,e){var i=t.require[0],a=e.require[0];return i!=a?i-a:t.slotNum-e.slotNum});var i=0;a.data.targeted.some(function(t){if(t.id==r)return i=t.num,!0}),n.curNum=i,c.push(n)}var s=this,a=this.info,o=JSON.parse(a.content),c=[],d=this;for(var e in o)t(e);return c.sort(function(t,e){var i=t.curNum>=t.maxNum;return i!=e.curNum>=e.maxNum?i?1:-1:t.id-e.id}),c},i.prototype.checkSatisfy=function(t){var e=this.info.content,i=!0,a=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N);for(var n in e){var o=e[n];if(o[0]==t){var r=o[1];for(var s in r){var c=r[s];if(1==c[0]){if(!a.checkEnough(c[1],!1)){i=!1;break}}else if(2==c[0]&&this.selectedUuids[t][Number(s)+1].length<c[4]){i=!1;break}}break}}return i},i.prototype.updateSelectedUuid=function(t,e,i){this.selectedUuids[t]||(this.selectedUuids[t]={});var a=this.selectedUuids[t];a[e]||(a[e]=[]),a[e].splice(0,a[e].length,i)},i.prototype.isUuidChosen=function(t){var e=!1;for(var i in this.selectedUuids){var a=this.selectedUuids[i];for(var n in a)if(-1<a[n].indexOf(t)){e=!0;break}}return e},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.HeroConvert,t.selectedUuids={},t}l.ActivityHeroConvertView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_operate,function(){t.data.btnFunc&&t.data.btnFunc()})},o.prototype.dataChanged=function(){var s=this,t=this.data.slots;this.gp_slots.removeChildren(),t.forEach(function(t,e){if(0!=e){var i=new eui.Image("common_img_jia_png");s.gp_slots.addChild(i)}var a=s.data.curNum<s.data.maxNum,n=new c({info:t,available:a}),r=t.require,o=t.selected;1==r[0]||2==r[0]&&a&&Utils.TouchUtils.addTouchListener(n,function(){PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e=t.allHeroByUuid,i={};for(var a in e){var n=e[a],o=n.config;t.heroUuid22Pos[a]||0!=r[1]&&o.race!=r[1]||0!=r[2]&&o.profession!=r[2]||0!=r[3]&&o.initStar!=r[3]||(i[n.uuid]=n)}return i},type:EEntityType.EEntityTypeHero,uniNum:!0,checkFull:function(t){return t.length>=r[4]},selectUuids:o,title:"请选择英雄"}),closeCB:function(t){s.data.view.updateView()}})}),s.gp_slots.addChild(n)}),this.gp_slots.addChild(new eui.Image("newactivity_img_denghao_png"));var e=customui.BaseItemFactory.create();e.scaleX=e.scaleY=.7,e.updateData({reward:this.data.rewards[0]}),this.gp_slots.addChild(e);var i=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).getInfoByCode(this.data.rewards[0][1]);this.lb_title.text="兑换"+i.info.name,this.lb_tips.text=this.data.curNum+"/"+this.data.maxNum;var a=this.data.curNum>=this.data.maxNum;this.btn_operate.enabled=!a,UIActionManager.setAbsGrey(this.btn_operate,a),a?(this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已兑换",this.btn_operate.scaleX=this.btn_operate.scaleY=1):(this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="兑换",this.btn_operate.scaleX=this.btn_operate.scaleY=.8)},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityHeroConvertView_Item",t}var r,c=(r=eui.Component,__extends(s,r),s.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_jia,!0,!1,1e3),this.updateItem(this.data)},s.prototype.findRandomHero=function(t){var e=l.Config.allHeroConfig();for(var i in e){var a=e[i];if(!(0!=t[1]&&a.race!=t[1]||0!=t[2]&&a.profession!=t[2]||0!=t[3]&&a.initStar!=t[3]))return a}},s.prototype.updateItem=function(t){var e=t.info.require,i=t.info.selected;if(this.img_jia.visible=!1,1==e[0])this.baseItem.updateData({reward:e[1][0]}),l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).checkEnough(e[1],!1)?UIActionManager.setAbsGrey(this.gp_main,!1):UIActionManager.setAbsGrey(this.gp_main,!0);else if(2==e[0]){var a=this.findRandomHero(e);this.baseItem.updateData({code:a.code});var n=a.initStar,o=1;if([[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(t,e){n>=t[0]&&n<=t[1]&&(o=e+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+o+"_png",t.available&&(i.length>=e[4]?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0),i.length<e[4])){var r=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),s=r.allHeroByUuid,c=0;for(var d in s){var h=s[d].config;r.heroUuid22Pos[d]||0!=e[1]&&h.race!=e[1]||0!=e[2]&&h.profession!=e[2]||0!=e[3]&&h.initStar!=e[3]||c++}this.img_jia.visible=c>=e[4]}}},s);function s(t){var e=r.call(this)||this;return e.data=t,e.skinName="ActivityHeroConvertView_HeroChooseItem",e}}(game=game||{}),function(i){var e,t=(e=i.ActivityCommonPanel,__extends(a,e),a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},a.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=this.edt_input.text?this.exchangeNum():Utils.MsgUtils.addMidMsg("请正确输入兑换码")},this),Utils.DeviceUtils.IsNative&&this.edt_myCode_mic?(this.btn_copy.visible=this.lb_myCode.visible=!1,this.edt_myCode_mic.visible=!0,this.edt_myCode_mic.text=this.lb_myCode.text,this.edt_myCode_mic.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){t.edt_myCode_mic.text=t.lb_myCode.text},this)):this.btn_copy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=this.lb_myCode.text&&(Utils.DeviceUtils.IsNative?Utils.MsgUtils.addMidMsg("复制失败，请手动输入"):Utils.SDKMgr.copyToClipBoard(this.lb_myCode.text,this.copyCb.bind(this)))},this),this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(""!=this.lb_myCode.text){var t=Number(Utils.SDKMgr.getPerformConfig(35))||10,e=Number(Utils.LocalStorageUtil.getItem("LAST_SEND_YAOQINGMA_DT"))||0;Math.floor((Utils.TimerManager.getServerTime()-e)/60)>=t?i.AppFacade.getInstance().retrieveProxy(i.MainPy.N).SendMessage(EChatChannelType.SameServer,this.lb_myCode.text,0,function(){Utils.MsgUtils.addMidMsg("发送成功"),Utils.LocalStorageUtil.setItem("LAST_SEND_YAOQINGMA_DT",Utils.TimerManager.getServerTime().toString())},EChatSendCheckType.None,""):Utils.MsgUtils.addMidMsg("邀请码"+t+"分钟可发送一次，暂时无法发送")}},this),this.heroModel.update({model:"hero_038_03",isStatic:!0}),this.py.GetInvitationCodeInfo(EActivityType.InvitationCode,this.updateView.bind(this))},a.prototype.updateView=function(t){var e=this.info;e.content&&null!=e.content&&(this.lb_text1.text=e.content[4][0],this.lb_text2.text=e.content[4][1],this.lb_text3.text=e.content[4][2],this.lb_text4.text=e.content[4][3]),t&&(this.lb_myCode.text=t.invitationCode,this.edt_myCode_mic&&(this.edt_myCode_mic.text=this.lb_myCode.text))},a.prototype.exchangeNum=function(){this.py.UseInvitationCode({code:EActivityType.InvitationCode,invitationCode:this.edt_input.text},this.clearView.bind(this))},a.prototype.clearView=function(){this.edt_input.text="",Utils.MsgUtils.addMidMsg("兑换成功"),this.hide()},a.prototype.copyCb=function(){Utils.MsgUtils.addMidMsg("复制成功")},a);function a(){var t=e.call(this)||this;return t.code=EActivityType.InvitationCode,t.py=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),t.skinName="ActivityInviteCodeSkin",t}i.ActivityInviteCode=t}(game=game||{}),function(a){var e,t=(e=a.ActivityCommonListView,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_level_reward")},i.prototype.getDataList=function(){function t(t){var e=d[t],i=e[0],a=e[1],n=REWARD_STATUS.AVAILABLE;s<i?n=REWARD_STATUS.UNAVAILABLE:c.some(function(t){return t.id==i&&0<t.num})&&(n=REWARD_STATUS.RECEIVED);var o={id:t+1,title:"等级达到"+i+"级",tips:s+"/"+i,rewards:a,status:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:r.getReward({targetLevel:i});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};h.push(o)}for(var r=this,e=this.info,s=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N).playerInfoVO.level,c=e.data.targeted,d=e.content,h=[],i=0;i<d.length;i++)t(i);return h.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),h},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.LevelReward,Utils.AssetsMgr.loadGroup("group_level_reward"),t}a.ActivityLevelReward=t}(game=game||{}),function(p){var e,t=(e=p.ActivityCommonView,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_month_card")},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.purchaseMonthCard=function(){var t=this.rechargeProxy.getMonthCardInfo();t?(t.isMonthCard=!0,this.rechargeProxy.purchase(t)):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},i.prototype.purchaseWholelifeard=function(){var t=this.rechargeProxy.getWholeLifeCardInfo();t?(t.isMonthCard=!0,this.rechargeProxy.purchase(t)):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},i.prototype.updateView=function(t){this.updateMonthCard(),this.updateWholeLifeCard()},i.prototype.updateMonthCard=function(){var t=this.info,e=t.data.day,i=t.data.giftFlag,a=JSON.parse(t.content);this.bm_rewardInstant1.text=a[2][0][2],this.bm_rewardEveryday1.text=a[3][0][2];var n=!1;if(UIActionManager.setGrey(this.btn_purchase1,!1),e<=0){var o=this.rechargeProxy.getMonthCardInfo();1<Utils.SDKMgr.globalIAPSuffixLen?this.btn_purchase1.label=""+o.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:this.btn_purchase1.label=""+o.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"购买",this.btn_purchase1.enabled=!0,this.bm_time1.text="",this.btn_purchase1.visible=!0}else i?(n=!0,this.bm_time1.text="剩余天数:"+e+"天",this.btn_purchase1.visible=!1,UIActionManager.setGrey(this.btn_purchase1,!0)):(this.btn_purchase1.label="领取",this.btn_purchase1.enabled=!0,UIActionManager.addEffect(this.btn_purchase1,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}));for(var r in this.gp_reward0.removeChildren(),a[2]){var s=a[2][r],c=new eui.Group,d=customui.BaseItemFactory.create();if(d.scaleX=d.scaleY=.8,c.addChild(d),n){var h=new eui.Image;h.source="xyzp_img_yilingqu_png",h.horizontalCenter=h.verticalCenter=0,c.addChild(h),UIActionManager.setGrey(d,!0)}d.updateData({reward:s}),this.gp_reward0.addChild(c)}},i.prototype.updateWholeLifeCard=function(){var t=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N).playerInfoVO.playerVip.vipLevel||1,e=p.Config.VIPUpgradeConfig()[t],i=JSON.parse(e.wholeLifeCardEmailRewards);this.bm_rewardEveryday2.text=i[0][2];var a=this.actProxy.allActivityData[EActivityType.WholeLifeCard],n=JSON.parse(a.content);this.bm_rewardInstant2.text=n[1][0][2];var o=!1;if(UIActionManager.hideEffect(this.btn_purchase2),UIActionManager.setGrey(this.btn_purchase2,!1),a&&a.data&&a.data.hasPurchased)a.data.giftFlag?(this.btn_purchase2.label="",this.btn_purchase2.skinName="skins.ButtonSkinSure",this.btn_purchase2.label="已领取",this.btn_purchase2.enabled=!1,UIActionManager.setGrey(this.btn_purchase2,!0),o=!0):(this.btn_purchase2.label="领取",this.btn_purchase2.enabled=!0,UIActionManager.addEffect(this.btn_purchase2,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}));else{this.btn_purchase2.label="",this.btn_purchase2.scaleX=this.btn_purchase2.scaleY=1,this.btn_purchase2.skinName="skins.ButtonSkinYellow";var r=this.rechargeProxy.getWholeLifeCardInfo();1<Utils.SDKMgr.globalIAPSuffixLen?this.btn_purchase2.label=""+r.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:this.btn_purchase2.label=""+r.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"购买"}for(var s in this.gp_reward1.removeChildren(),n[1]){var c=n[1][s],d=new eui.Group,h=customui.BaseItemFactory.create();if(h.scaleX=h.scaleY=.8,d.addChild(h),o){var l=new eui.Image;l.source="xyzp_img_yilingqu_png",l.horizontalCenter=l.verticalCenter=0,d.addChild(l),UIActionManager.setGrey(h,!0)}h.updateData({reward:c}),this.gp_reward1.addChild(d)}},i.prototype.activateComponent=function(){this.btn_purchase1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.info.data.day<=0?this.purchaseMonthCard():this.info.data.giftFlag?Utils.MsgUtils.addMidMsg("已领取"):this.getReward({})},this),this.btn_purchase2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,i=this.actProxy.allActivityData[EActivityType.WholeLifeCard];i&&i.data&&i.data.hasPurchased?i.data.giftFlag?Utils.MsgUtils.addMidMsg("已领取"):Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.WholeLifeCard,id:0}).then(function(t){i.updateData(t.info),e.backpackProxy.handleClientReward(t.clientReward),e.updateView()}):this.purchaseWholelifeard()},this)},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.MonthCard,t.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),Utils.AssetsMgr.loadGroup("group_month_card"),t.skinName="ActivityMonthCardSkin",t}p.ActivityMonthCard=t}(game=game||{}),function(a){var n,t=(n=a.ActivityCommonListView,__extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_enjoy_card")},e.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.purchaseGrowFund(t.code)},this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=a.ActivityCommonListItem,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(t){n.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data)if(e.data.buy)JSON.parse(e.content),this.btn_buy.skinName="skins.ButtonSkinSure",this.btn_buy.label="已购买",UIActionManager.setGrey(this.btn_buy,!1),this.btn_buy.scaleX=this.btn_buy.scaleY=1,this.btn_buy.touchEnabled=!1;else{var i=this.rechargeProxy.getGrowFund(this.code);i&&(this.btn_buy.label=""+i.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix),this.btn_buy.touchEnabled=!0}},e.prototype.getDataList=function(){var r=this,t=this.info;if(t&&t.data){function e(t){var e=s[1][t],i=e[0],a=e[1],n=REWARD_STATUS.AVAILABLE;0<=c.indexOf(i)?n=REWARD_STATUS.RECEIVED:h<i&&(n=REWARD_STATUS.UNAVAILABLE);var o={num:t,id:i,rewards:a,status:n,title:"等级达到"+i+"级可领取",btnFunc:function(){r.getReward({id:i,code:r.code})}};d.push(o)}for(var s=JSON.parse(t.content),c=t.data.targeted,d=(t.data.buy,[]),h=a.GameMVC.playerPy.playerInfoVO.level,i=0;i<s[1].length;i++)e(i);return this.commonSortDataList(d),d}},e.prototype.purchaseGrowFund=function(t){var e=this.rechargeProxy.getGrowFund(t);e?this.rechargeProxy.purchase(e,2,String(t),JSON.stringify({uuid:t,activityType:this.code}),{activityType:this.code}):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取成长基金信息，请稍后再试"))},e);function e(){var t=n.call(this)||this;return t.rechargeProxy=a.AppFacade.getInstance().retrieveProxy(a.RechargePy.N),Utils.AssetsMgr.loadGroup("group_enjoy_card"),t.skinName="ActivityNewGrowFund",t}a.ActivityNewGrowFund=t}(game=game||{}),function(h){var l,t=(l=h.ActivityCommonView,__extends(e,l),e.prototype.updateView=function(t){var n=this;if(l.prototype.updateView.call(this,t),!this.hasInit){var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=i[2];this.img_bg.source=i[0]+"_png";var o=h.Config.allHeroConfig()[a];if(o){function r(e){var i=o[s.skillNames[e]],t=s["skillItem"+e];if(t&&(t.updateItem({code:i}),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=h.Config.skillBaseConfig()[i];t&&(n.lb_skillName.text=t.name,n.lb_skillDesc.text=t.desc),n.img_chosen.x=n.chosenPosi[e][0]||0,n.img_chosen.y=n.chosenPosi[e][1]||0},s)),0==e){var a=h.Config.skillBaseConfig()[i];a&&(s.lb_skillName.text=a.name,s.lb_skillDesc.text=a.desc),s.img_chosen.x=s.chosenPosi[e][0]||0,s.img_chosen.y=s.chosenPosi[e][1]||0}}for(var s=this,c=0;c<this.skillNames.length;c++)r(c);var d=i[3];MovieClipTools.create(d,function(t){t&&(t.x=this.sl_root.width/2,t.y=this.sl_root.height/2,t.scaleX=this.sl_root.width/t.width,t.scaleY=this.sl_root.height/t.height,t.animation.play(d,-1),this.gp_effect.addChild(t))},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.MainJumpConfig.jumpTo(i[1])},this),this.updateTime(),this.hasInit=!0}else Utils.MsgUtils.addMidMsg("找不到英雄配置")}}},e.prototype.updateTime=function(){var t=this;this.timer&&egret.clearInterval(this.timer);var e=h.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="结束倒计时:"+Utils.TimerManager.getFormatBySecond2(e),this.timer=egret.setInterval(function(){--e<0?t.updateTime():t.bm_time.text="结束倒计时:"+Utils.TimerManager.getFormatBySecond2(e)},this,1e3)},e);function e(){var t=l.call(this)||this;return t.skillNames=["actSkill","posSkill1","posSkill2","posSkill3","normalSkill"],t.hasInit=!1,t.chosenPosi=[[49,600],[139,600],[228,600],[316,600]],t.skinName="ActivityNewHeroShow",t}h.ActivityNewHeroShow=t}(game=game||{}),function(_){var e,t=(e=_.ActivityCommonListView,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.img_last=new eui.Image,this.img_last.source="common_btn_jiantou_png",this.img_last.left=0,this.img_last.scaleX=-1,this.img_last.verticalCenter=160,this.gp_main.addChild(this.img_last),this.img_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex--,t.updateView()},this),this.img_next=new eui.Image,this.img_next.source="common_btn_jiantou_png",this.img_next.right=0,this.img_next.scaleX=1,this.img_next.verticalCenter=160,this.gp_main.addChild(this.img_next),this.img_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex++,t.updateView()},this),this.btn_help=new eui.Button,this.btn_help.icon="_btn_lb_m_json.common_icon_jiangli",this.btn_help.skinName="skins.ButtonSkinIcon2",this.btn_help.label="说 明",this.btn_help.horizontalCenter=300,this.btn_help.verticalCenter=-200,this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.GameMVC.activityMed.showHelpDialog(t.info.content[4])},this),this.gp_main.addChild(this.btn_help)},i.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.costBar=new customui.CommonResourceBar,this.costBar.x=-200,this.costBar.top=215,this.gp_title.addChild(this.costBar);var t=new eui.TileLayout;t.horizontalAlign=egret.HorizontalAlign.LEFT,t.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,t.requestedColumnCount=3,t.horizontalGap=-130,t.verticalGap=35,t.paddingTop=80,t.paddingLeft=120,t.paddingRight=-120,this.list_itemList.layout=t;var e=new eui.Image;e.source="shangdian_img_guizi_png",e.horizontalCenter=0,e.y=271,e.scaleX=720/629,e.scaleY=754/628,this.gp_title.parent.addChildAt(e,1)},i.prototype.getDataList=function(){var p=this,t=this.info;if(!t||!t.data)return[];var u,g=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){u=n[1];break}}if(!u)return[];function o(t){var e=u[t],i=e[0],o=e[1],r=e[2],s=e[3],a=REWARD_STATUS.UNAVAILABLE,c=0;for(var n in g){var d=g[n];if(d.id==i){c=d.num;break}}v||(v=!0,f.costBar.updateBar(r)),s<=c?a=REWARD_STATUS.RECEIVED:m.checkEnough(r,!1)&&(a=REWARD_STATUS.AVAILABLE);var h=_.GeneralConfig.getEntityConfigByCode(o[0][0],o[0][1]),l={id:i,title:"兑换"+(h&&h.name),tips:c+"/"+s,buyTimes:s,hasBuy:c,rewards:o,costs:r,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=_.AppFacade.getInstance().retrieveMediator(_.ShopyMediator.N),i=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).getInfoByCode(r[0][1]),a=Math.floor(i.haveNum/r[0][2]),n=_.GeneralConfig.getEntityConfigByCode(o[0][0],o[0][1]).name;t.showSubView(_.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:o,costs:r,countFun:function(t){return{unit:r[0][2],total:r[0][2]*t}},name:n,limit:"[5,"+(s+1)+"]"},maxCount:s-c<a?s-c:a,buyNum:c+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){p.code==EActivityType.NewExchangeGifts?p.getReward({code:p.code,id:e.id,num:t.num||0}):p.getReward({code:p.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};y.push(l)}for(var m=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),y=[],v=!1,f=this,r=0;r<u.length;r++)o(r);return y.sort(function(t,e){return t.id-e.id}),y.length>9*(this.curIndex+1)?this.img_next.visible=!0:this.img_next.visible=!1,0<this.curIndex?this.img_last.visible=!0:this.img_last.visible=!1,y=y.slice(9*this.curIndex,9*this.curIndex+9),this.btn_help.visible=!!t.content[4],y},i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.curIndex=0,t}_.ActivityNewItemGifts=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.activateComponent(),this.blb_price.visible=!0,this.img_costIcon.visible=!0,this.scaleX=.85,this.scaleY=.85;var t=new eui.Image;t.horizontalCenter=0,t.verticalCenter=-50,t.scaleX=t.scaleY=1/this.scaleX,t.source="shangdian_img_guangxiao_png",this.addChildAt(t,0)},o.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},o.prototype.dataChanged=function(){var t=this.data;this.btnFunc=t.btnFunc;var e=JSON.parse(t.rewards)[0];this.backpackProxy.getInfoByTypeCodeNum(e[0],e[1],e[2]),this.baseItem.updateData({type:e[0],code:e[1],num:e[2]});var i=this.data.hasBuy,a=t.buyTimes;this.leftNum=a-i,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1),this.img_onlyOne.visible=1==a,1==t.discountDisplay?this.gp_discount.visible=!1:this.gp_discount.visible=1==a,this.cost=JSON.parse(t.costs)[0];var n=this.cost[2];this.price=100*n/100,this.blb_price.text=""+this.price;var o=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);o&&o.info&&(this.img_costIcon.source=ResourceUtils.png(o.info.icon))},o);function o(){var t=a.call(this)||this;return t.shopProxy=_.AppFacade.getInstance().retrieveProxy(_.ShopPy.N),t.backpackProxy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),t.unlock=!0,t.skinName="ShopUIItemSkin",t}}(game=game||{}),function(f){var t,e=(t=f.ActivityCommonListView,__extends(i,t),i.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.gp_costs=new eui.Group;var t=new eui.HorizontalLayout;t.gap=15,this.gp_costs.layout=t,this.gp_costs.x=20,this.gp_costs.top=215,this.gp_title.addChild(this.gp_costs)},i.prototype.getDataList=function(){var g=this,t=this.info;if(!t||!t.data)return[];var c,m=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){c=n[1];break}}if(!c)return[];function o(t){var e=c[t],i=e[0],h=e[1],l=e[2],p=e[3];if(e[4])return v.push(e),"continue";var a=REWARD_STATUS.UNAVAILABLE,u=0;for(var n in m){var o=m[n];if(o.id==i){u=o.num;break}}p<=u?a=REWARD_STATUS.RECEIVED:y.checkEnough(l,!1)&&(a=REWARD_STATUS.AVAILABLE);var r=f.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),s={id:i,title:"兑换"+(r&&r.name),tips:u+"/"+p,rewards:h,btnLabel:"制作",costs:l,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=f.AppFacade.getInstance().retrieveMediator(f.ShopyMediator.N),i=[],a=9999;for(var n in l){var o=l[n],r=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N).getInfoByCode(o[1]),s=Math.floor(r.haveNum/o[2]);s<a&&(a=s,i=o)}var c=a,d=f.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;t.showSubView(f.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(t){return{unit:i[2],total:i[2]*t}},name:d,limit:"[5,"+(p+1)+"]"},maxCount:p-u<c?p-u:c,buyNum:u+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){g.getReward({code:g.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};d.push(s)}for(var y=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),d=[],v=[],r=0;r<c.length;r++)o(r);if(d.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),this.gp_costs.removeChildren(),0<v.length){function s(t){var e=v[t],o=e[0],r=e[1],s=e[2],c=e[3],i=f.GameMVC.backpackPy.getInfoByCode(r[0][1]),d=0;for(var a in m){var n=m[a];if(n.id==o){d=n.num;break}}var h=f.GameMVC.backpackPy.getInfoByCode(s[0][1]),l=new customui.ResourceItem({icon:i.info.icon,num:i.haveNum,addClickWayFunc:function(){var t=REWARD_STATUS.UNAVAILABLE;switch(c<=d?t=REWARD_STATUS.RECEIVED:y.checkEnough(s,!1)&&(t=REWARD_STATUS.AVAILABLE),t){case REWARD_STATUS.AVAILABLE:var e=f.AppFacade.getInstance().retrieveMediator(f.ShopyMediator.N),i=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N).getInfoByCode(s[0][1]),a=Math.floor(i.haveNum/s[0][2]),n=f.GeneralConfig.getEntityConfigByCode(r[0][0],r[0][1]).name;e.showSubView(f.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:r,costs:s,countFun:function(t){return{unit:s[0][2],total:s[0][2]*t}},name:n,limit:"[5,"+(c+1)+"]"},maxCount:c-d<a?c-d:a,buyNum:d+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){g.getReward({code:g.code,giftCode:o,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg(h.info.name+"不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}});l.scaleX=l.scaleY=.9,p.gp_costs.addChild(l)}var p=this;for(var a in v)s(a)}return d},i);function i(){return t.call(this)||this}f.ActivityNewNewItemGifts=e;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var t=new eui.HorizontalLayout;t.verticalAlign="middle",t.gap=0,this.gp_rewards.layout=t},o.prototype.dataChanged=function(){var n=this,t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_title.text=t.title||"",this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.label="已领取",this.btn_operate.skinName="skins.ButtonSkinSure",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;default:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}this.data.btnLabel&&(this.btn_operate.label=this.data.btnLabel),this.gp_rewards.removeChildren();for(var e=JSON.parse(t.costs),i=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),a=0;a<e.length-1;a++){var o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.7,o.updateData({reward:e[a]});var r=i.getInfoByCode(e[a][1]).haveNum;o.blb_num.text=r+"/"+e[a][2],r>=e[a][2]?UIActionManager.setAbsGrey(o,!1):UIActionManager.setAbsGrey(o,!0),this.gp_rewards.addChild(o);var s=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(s)}var c=customui.BaseItemFactory.create();c.scaleX=c.scaleY=.7,c.updateData({reward:e[e.length-1]}),this.gp_rewards.addChild(c);var d=i.getInfoByCode(e[e.length-1][1]).haveNum;c.blb_num.text=d+"/"+e[e.length-1][2],d>=e[e.length-1][2]?UIActionManager.setAbsGrey(c,!1):UIActionManager.setAbsGrey(c,!0);var h=new eui.Image("newactivity_img_denghao_png");this.gp_rewards.addChild(h),JSON.parse(t.rewards).forEach(function(t,e){var i=new eui.Group;i.width=i.height=73.5;var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({reward:t}),t[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1,childIndex:1}):UIActionManager.hideEffect(i),i.addChildAt(a,0),n.gp_rewards.addChild(i)}),this.btnFunc=t.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-1}):UIActionManager.hideEffect(this.btn_operate)},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityCommonListItemSkin",t}}(game=game||{}),function(o){var e,t=(e=BasePanel,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){return this.proxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0}),this.list_rewards.itemRenderer=n},i.prototype.updateView=function(t){var n=this,e=this.info;if(!this.tableInit){e.content.forEach(function(t,e){var i=n["gp_Reward"+e],a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=70/105,a.updateData({reward:t[1][0]}),i.addChild(a)}),this.tableInit=!0;var i=e.data.nameList.length;if(i){if(this.img_empty.visible=!1,this.list_rewards.dataProvider=new eui.ArrayCollection(e.data.nameList),4<i){this.scl_rewards.viewport=this.list_rewards;var a=140*i+20*(i-1);this.once(egret.Event.ENTER_FRAME,function(){n.scl_rewards.viewport.scrollH=a-n.scl_rewards.width},this)}}else this.img_empty.visible=!0,this.list_rewards.dataProvider=new eui.ArrayCollection([["","sfhl_img_jp1"],["","sfhl_img_jp2"],["","sfhl_img_jp3"],["","sfhl_img_jp4"]])}this.dt=e.endDt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer||(this.timer=egret.setInterval(function(){0<n.dt&&(n.blb_time.text=Utils.TimerManager.getFormatBySecond1(--n.dt))},this,1e3)),this.blb_times.text=e.data.total.toString()},i.prototype.rotateToIndex=function(t,e){if(!this.rotating){var i=t*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,e)}},i.prototype.rotateToAngle=function(t,e,i){var a=this;void 0===i&&(i=5e3);for(var n=[],o=0;o<8;o++){var r=this["gp_Reward"+o];r&&n.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1),this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var e=360*(a.FIXED_LAP+1)-a.gp_roll.rotation;n.forEach(function(t){t.rotation=e})},onChangeObj:this}).to({rotation:t},i,function(t){return 1-Math.pow(1-t,3)}).call(function(){a.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),e&&e()})},i.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<i.info.data.total?Utils.Socket.send("activity","DoCommonOperation",{code:i.code,num:1,id:1}).then(function(t){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0});var e=JSON.parse(t.info);i.rotateToIndex(e.rewardId-1,function(){i.info.updateData(e),o.GameMVC.backpackPy.handleClientReward(t.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_access,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c})},this),Utils.ComponentUtils.registerListener(this.btn_preview,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l})},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showHelpDialog(i.info.content[0][3])},this)},i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.FIXED_LAP=5,t.itemAngle=45,t.rotating=!1,t.curIndex=0,t.tableInit=!1,t.code=EActivityType.NewTurntable,t.proxy=o.GameMVC.activityPy,t.skinName="ActivityNewTurnTableSkin",t}o.ActivityNewTurnTable=t;var a,n=(a=eui.ItemRenderer,__extends(r,a),r.prototype.dataChanged=function(){this.lb_desc.text=this.data[0],this.img_icon.source=this.data[1]+"_png",this.data[0]?(this.img_date.visible=!0,this.lb_date.visible=!0,this.lb_date.text=this.data[2]):(this.img_date.visible=!1,this.lb_date.visible=!1)},r);function r(){var t=a.call(this)||this;return t.skinName="ActivityNewTurnTable_RewardItem",t}var s,c=(s=BasePanel,__extends(d,s),d.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.updateView()},d.prototype.updateView=function(t){function e(t){var e=n.CONFIG[t],i=a[e.name];n["lb_"+t].text=e.text.format([i.toString()]),n["img_"+t].visible=i===e.max,n["btn_"+t].visible=i!=e.max,Utils.ComponentUtils.registerListener(n["btn_"+t],egret.TouchEvent.TOUCH_TAP,function(){e.cb()},n)}var a=o.GameMVC.activityPy.allActivityData[EActivityType.NewTurntable].data,n=this;for(var i in this.CONFIG)e(i)},d);function d(){var t,e=s.call(this)||this;return e.CONFIG=((t={})[1]={name:"loginTimes",max:1,text:"登录游戏（%s/1）",cb:function(){Utils.MsgUtils.addMidMsg("你能点到这个按钮证明程序出问题了")}},t[2]={name:"firstChargeTimes",max:1,text:"首次充值（%s/1）",cb:function(){e.hide(),o.MainJumpConfig.jumpTo(MODULE.Recharge)}},t[3]={name:"inviteTimes",max:3,text:"邀请好友（%s/3）",cb:function(){var t=EActivityType.InvitationCode;o.GameMVC.activityPy.isOpen(t)?(e.hide(),o.GameMVC.activityMed.showViewByCode(t)):Utils.MsgUtils.addMidMsg("邀请活动未开启")}},t),e.skinName="ActivityNewTurnTable_AccessPanel",e}var h,l=(h=BasePanel,__extends(p,h),p);function p(){var t=h.call(this)||this;return t.skinName="ActivityNewTurnTable_PreviewPanelSkin",t}}(game=game||{}),function(_){var a,t=(a=_.ActivityCommonPanel,__extends(e,a),e.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.btn_redPocket.visible=!1,this.HeroDynamicModel.update({isStatic:!0,model:"hero_037_03"}),this.activateComponent();var i=[0,1,2,3];this.barrageTimer=egret.setInterval(function(){if(0<e.barrageTextArr.length&&e.HeroDynamicModel.visible){var t=Math.floor(Math.random()*i.length);e.CommonBarrage.addOneMsg({text:e.barrageTextArr.pop(),startY:i[t]/4*e.CommonBarrage.height+1}),i.splice(t,1),0==i.length&&(i=[0,1,2,3]).splice(t,1)}},this,2e3),this.CommonBarrage.touchEnabled=!1},e.prototype.updateView=function(){var t=this.info;if(t&&t.data){var e=t.data.attackList,i=9999999;for(var a in e)parseInt(a)<i&&(i=parseInt(a));var n=0;if(e[i])for(var a in e[i])(p=e[i][a]).isKilled&&(n=1);var o=10*Object.keys(e).length+n;10!=this.oldRedPocketStatus||11!=o&&21!=o||(this.needHongBaoYu=!0),this.oldRedPocketStatus=o,this.curSectionId&&this.curSectionId!=t.data.sectionId&&(this.need321=!0,this.BossVisible(!1)),this.needHongBaoYu?this.playEffect2():this.need321&&this.playEffect3(),this.curSectionId=t.data.sectionId;var r=t.data.targeted,s=JSON.parse(t.content),c=t.data.sectionId>s[1].length?s[1].length-1:t.data.sectionId-1,d=s[1][c],h=(d[0],d[1]),l=[];for(var a in this.boxReward=d[5],d[3]){var p=d[3][a][0];for(var u in p){var g=p[u];l.push(g)}}this.gp_reward.removeChildren(),_.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,l),this.CommonIconWithNum.updateItem({cost:h[0],style:CommonIconStyle.RIGHT,needShowHave:!0});var m=t.data.life;this.pb_hp.maximum=m[0];var y=Math.floor(100*m[1]/m[0]);this.pb_hp.value=y<=20?m[0]/5:m[1],this.bm_hp.text=(y<=20?"??":y)+"%",this.curSectionId>i&&r.indexOf(0)<0?this.btn_redPocket.visible=!0:this.btn_redPocket.visible=!1,this.handleRecord(e),this.updateTime()}},e.prototype.handleRecord=function(t){void 0===t&&(t=[]);var e=_.AppFacade.getInstance().retrieveProxy(_.PlayerPy.N).playerInfoVO.playerId,i=[];for(var a in t){var n=t[a],o=parseInt(a);for(var r in n)n[r].sectionId=o,i.push(n[r])}i.sort(function(t,e){return t.dt-e.dt});var s="";for(r=this.oldLength;r<i.length;r++){var c=i[r];c.isKilled?c.sectionId==this.curSectionId-1&&(s=c.name+"豪气冲天，驱除魔物，一波红包来袭！！！"):c.playerId!=e&&this.barrageTextArr.push("喜贺新春，鞭炮除岁，"+c.name+"对boss发起过攻击。")}s&&this.barrageTextArr.push(s),this.oldLength=i.length},e.prototype.activateComponent=function(){var o=this;UIActionManager.addEffect(this.btn_redPocket,"common_hongbaotiaodong"),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.getReward(1)},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.AppFacade.getInstance().retrieveMediator(_.ShopyMediator.N);var t=o.info;if(t&&t.data){var e=JSON.parse(t.content),i=e[t.data.sectionId>e.length?e.length-1:t.data.sectionId-1],a=(i[0],i[1]),n=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).getInfoByCode(a[0][1]);Math.floor(n.haveNum/a[0][2]),PopUpManager.addPopUp({obj:new _.SimpleUsePanel({code:a[0][1],callBack:function(t){o.getReward(t.num)},requestNum:1})})}},this),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.boxReward&&_.AppFacade.getInstance().showSubView(_.CommonMediator.N,_.CommonMediator.SV.REWARD_PANEL,{rewards:o.boxReward,type:_.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new _.HelpDialog({moduleId:MODULE.Activity+EActivityType.NewYearChallenge})})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.btn_redPocket.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.setTouchFalse(),Utils.Socket.send("activity","GetCommonReward",{code:o.code,id:0}).then(function(t){DragonBoneTools.playOnce({effectName:"common_hongbaodakai",parent:o.gp_root,x:o.gp_root.width/2||0,y:o.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){o.actProxy.updateData_View_Reward(o.code,t),o.setTouchTrue()}})})},this)},e.prototype.setTouchFalse=function(){GameRootLayer.gameLayer().switchTouchEnable(!1),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer),this.toleranceTimer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,5e3)},e.prototype.setTouchTrue=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},e.prototype.getReward=function(t){var e=this,i=this.info;if(i&&i.data){var a=JSON.parse(i.content),n=i.data.sectionId>a[1].length?a[1].length-1:i.data.sectionId-1,o=a[1][n][1];this.backpackProxy.checkEnough([[o[0][0],o[0][1],t]])?(this.setTouchFalse(),Utils.Socket.send("activity","DoCommonOperation",{num:t,code:this.code}).then(function(t){e.cbData=t,e.playEffect1()}).catch(function(t){e.setTouchTrue(),Utils.MsgUtils.addErrMsg(t.err)})):Utils.MsgUtils.addMidMsg("道具不足")}},e.prototype.playEffect1=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return DragonBoneTools.playOnce({effectName:"common_bianpao",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){e.HeroDynamicModel.egretArmDisplay&&e.HeroDynamicModel.egretArmDisplay.addEventListener(dragonBones.EventObject.COMPLETE,e.onModelComplete,e),e.HeroDynamicModel.changeAction(["shouji"])}}),[2]})})},e.prototype.onModelComplete=function(){var t=this;this.cbData.clientReward&&(GameRootLayer.gameLayer().switchTouchEnable(!0),_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).handleClientReward(this.cbData.clientReward,{onCloseCB:function(){t.handleRewardDone()}})),this.HeroDynamicModel.egretArmDisplay&&this.HeroDynamicModel.egretArmDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onModelComplete,this),this.HeroDynamicModel.changeAction(["daiji"])},e.prototype.BossVisible=function(t){this.HeroDynamicModel.visible=t,this.pb_hp.visible=t,this.bm_hp.visible=t},e.prototype.handleRewardDone=function(){this.allDone()},e.prototype.playEffect2=function(){var t=this;DragonBoneTools.playOnce({effectName:"common_hongbaoyu",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){t.need321&&t.playEffect3()}}),this.needHongBaoYu=!1},e.prototype.playEffect3=function(){var t=this;this.darkSprite?this.darkSprite.visible=!0:(this.darkSprite=new egret.Sprite,this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.8),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth(),Utils.DeviceUtils.curHeight()),this.darkSprite.graphics.endFill(),this.darkSprite.width=Utils.DeviceUtils.curWidth(),this.darkSprite.height=Utils.DeviceUtils.curHeight(),this.darkSprite.x=(this.width-this.darkSprite.width)/2,this.darkSprite.y=(this.height-this.darkSprite.height)/2,this.addChild(this.darkSprite)),this.setTouchFalse(),egret.setTimeout(function(){t.setTouchTrue(),t.need321=!1,t.darkSprite.visible=!1,t.BossVisible(!0)},this,6e3),DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:this,doneCB:function(){}})},e.prototype.allDone=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.cbData?(this.actProxy.allActivityData[this.code].updateData(this.cbData.info),this.cbData=void 0):this.updateView(),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},e.prototype.updateTime=function(){var a=this;this.timer&&egret.clearInterval(this.timer);var t=this.info;if(t&&t.data){var e,i,n,o=[JSON.parse(t.content)[0]],r=_.GameMgr.getInstance().serverTime(),s=new Date(1e3*r),c=[];for(var d in s.setHours(0,0,0),c.push(s.getTime()/1e3),o){var h=(e=o[d])[0],l=e[1];(i=new Date(1e3*r)).setHours(h[0],h[1],h[2]||0);var p=i.getTime()/1e3;(n=new Date(1e3*r)).setHours(l[0],l[1],l[2]||0);var u=n.getTime()/1e3;c.push(p),c.push(u)}function g(t){if(r>=c[t]&&r<=c[t+1]){if(m=!0,t%2==0){y.BossVisible(!1);var e=c[t+1];return y.lb_timeTip.text="距离挑战开启时间:",y.timer=egret.setInterval(function(){var t=Utils.TimerManager.getServerTime();t<=e?a.lb_time.text=Utils.TimerManager.getFormatBySecond1(e-t):a.updateView()},y,1e3),{value:void 0}}y.need321||y.BossVisible(!0);var i=c[t+1];y.lb_timeTip.text="距离挑战结束时间:",y.timer=egret.setInterval(function(){var t=Utils.TimerManager.getServerTime();t<=i?a.lb_time.text=Utils.TimerManager.getFormatBySecond1(i-t):a.updateView()},y,1e3)}}h=(e=o[0])[0],l=e[1],(i=new Date(1e3*r)).setHours(h[0],h[1],h[2]||0),p=i.getTime()/1e3+86400,(n=new Date(1e3*r)).setHours(l[0],l[1],l[2]||0),u=n.getTime()/1e3+86400,p<t.endDt&&(c.push(p),u<=t.endDt||(n.setHours(23,59,59),u=n.getTime()/1e3),c.push(u));for(var m=!1,y=this,v=0;v<c.length-1;v++){var f=g(v);if("object"==typeof f)return f.value}m||(this.BossVisible(!1),this.lb_timeTip.text="活动已结束",this.lb_time.text="")}},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer),this.barrageTimer&&egret.clearInterval(this.barrageTimer)},e);function e(){var t=a.call(this)||this;return t.needHongBaoYu=!1,t.need321=!1,t.boxReward=void 0,t.cbData=void 0,t.curSectionId=void 0,t.barrageTextArr=[],t.oldLength=0,t.oldRedPocketStatus=0,t.skinName="ActivityNewYearChallenge",t.code=EActivityType.NewYearChallenge,t}_.ActivityNewYearChallenge=t}(game=game||{}),function(l){var e,t=(e=l.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},i.prototype.updateView=function(){var t=this,e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=!!e.data.day,n=(i[0],i[1]),o=i[2],r=(e.data.targeted,e.data.day%n?e.data.day%n-1:n),s=a&&o[r]||o[0];if(this.gp_reward.removeChildren(),s&&l.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,s[1]),a)this.btn.visible=!1;else{var c=l.AppFacade.getInstance().retrieveProxy(l.RechargePy.N),d=c.getNewYearCardInfo();d?(this.btn.label="购买",d.isMonthCard=!0,this.btnFunc=function(){c.purchase(d)}):(this.btn.label=Utils.SDKMgr.globalIAPSuffix,this.btnFunc=function(){Utils.MsgUtils.addMidMsg("找不到商品信息")}),this.btn.skinName="skins.ButtonSkinYellow",this.btn.scaleX=this.btn.scaleY=.8}if(!this.timer){var h=this.info.endDt;this.timer=egret.setInterval(function(){t.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(h-Utils.TimerManager.getServerTime())},this,1e3)}}},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityNewYearWeekCrad",t.code=EActivityType.NewYearWeekCrad,t}l.ActivityNewYearWeekCrad=t}(game=game||{}),function(y){var c,t=(c=y.ActivityCommonPanel,__extends(e,c),e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},e.prototype.updateView=function(t){var l=this;c.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data&&y.ActivityConfig.Config[this.code]){var p=e.data.targeted,i=e.content,u=e.data.key,a=e.data.day;a>i.length&&(a=i.length);var g=[];for(var n in i){var o=i[n];o[0]==a&&g.push(o)}if(!g.length)return[];function r(t){var e=g[t],n=(e[0],e[1]),o=e[2],i=e[3][u-1][0],a=e[4];m.gp_reward.removeChildren(),y.GameMgr.getInstance().CommonGpAddReward(m.gp_reward,i),m.heroModel.update({model:a,isStatic:!0});var r=REWARD_STATUS.CANBUY,s=!1;for(var c in p)if(p[c].id==n){s=!0;break}s&&(r=REWARD_STATUS.RECEIVED),m.updateBtn(m.btn,r);var d=y.AppFacade.getInstance().retrieveProxy(y.RechargePy.N).goodList;for(var c in d){var h=d[c];h.id==o&&(m.lb_price.text="售价："+h.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix)}m.btnFunc=function(){switch(r){case REWARD_STATUS.CANBUY:var t=y.AppFacade.getInstance().retrieveProxy(y.RechargePy.N),e=t.goodList;for(var i in e){var a=e[i];if(a.id==o)return void t.purchase(a,2,n,JSON.stringify({activityType:l.code,uuid:n}),{activityType:l.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}}for(var m=this,s=0;s<g.length;s++)r(s)}},e.prototype.updateBtn=function(t,e){switch(e){case REWARD_STATUS.RECEIVED:t.skinName="skins.ButtonSkinSure",t.label="已领取",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=1,UIActionManager.hideEffect(t);break;case REWARD_STATUS.GO_RECHARGE:t.skinName="skins.ButtonSkinYellow",t.label="充值",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;case REWARD_STATUS.CANBUY:t.skinName="skins.ButtonSkinYellow",t.label=""+1*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"购买",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;default:t.label="领取",UIActionManager.setGrey(t,!1),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8,UIActionManager.addEffect(t,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e);function e(){var t=c.call(this)||this;return t.skinName="ActivityNewYuanGiftsByRandomSkin",t.code=EActivityType.NewOneYuanGifts,t}y.ActivityNewYuanGiftsByRandom=t}(game=game||{}),function(o){var i,t=(i=o.ActivityCommonListView,__extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t="ActivityNewZoneConsumeRank1";switch(e.code){case EActivityType.TopFarmMoneyRank:t="TopFarmMoneyRank"}o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:t})},this),this.updateTitle()},e.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(t){var a=this;i.prototype.updateView.call(this,t);var n=RankingType.RankingTypeActivityNewZoneConsumeRank1;switch(this.code){case EActivityType.TopFarmMoneyRank:n=RankingType.RankingTypeNewZoneActivityTopFarmMoneyRank,this.img_tip.source="newactivity_txt_ghyb_png",this.img_tip2.source="newactivity_txt_ghmc_png";break;case EActivityType.NewZoneConsumeRank1:n=RankingType.RankingTypeActivityNewZoneConsumeRank1,this.img_tip.source="newactivity_txt_xfje_png",this.img_tip2.source="newactivity_txt_wjmc_png";break;default:n=RankingType.RankingTypeActivityNewZoneConsumeRank1,this.img_tip.source="",this.img_tip2.source=""}this.rankPy.GetRankList({rankType:n,refreshInterval:0},function(t){if(0==t.ranks.length)a.gp_empty.visible=!0;else{if(a.gp_empty.visible=!1,a.code==EActivityType.TopFarmMoneyRank)for(var e in t.ranks)t.ranks[e].isGuild=!0;a.list_itemList.dataProvider?a.list_itemList.dataProvider.replaceAll(t.ranks):a.list_itemList.dataProvider=new eui.ArrayCollection(t.ranks)}var i=a.rankPy.getSelfRank(n);i&&i.rank?(a.lb_money.text=i.key.toString(),a.img_icon.source=a.rankPy.rankIcon(i.rank),a.img_icon.source?a.blb_rank.text="":a.blb_rank.text=i.rank.toString()):(a.blb_rank.text="",a.img_icon.source="",a.lb_money.text="未上榜"),a.code==EActivityType.TopFarmMoneyRank&&o.GameMVC.guildPy.isInGuild()?(a.cu_ph.img_frame.visible=!1,a.cu_ph.img_bg.visible=!1,a.cu_ph.blb_level.visible=!1,a.lb_name.text=""+o.GameMVC.guildPy.guildDetail.name,a.cu_ph.updateData({vo:{avatar:o.GameMVC.guildPy.guildDetail.avatar}})):(a.cu_ph.updateData({vo:o.GameMVC.playerPy.playerInfoVO}),a.lb_name.text=""+o.GameMVC.playerPy.playerInfoVO.name)})},e);function e(){var t=i.call(this)||this;return t.code=EActivityType.NewZoneConsumeRank1,t.rankPy=o.AppFacade.getInstance().retrieveProxy(o.RankPy.N),t.skinName="ActivityNewZoneConsumeRank1ViewSkin",t}o.ActivityNewZoneConsumeRank1View=t;var a,n=(a=eui.ItemRenderer,__extends(r,a),r.prototype.dataChanged=function(){this.data.isGuild?(this.lb_name.text=this.data.guildBaseInfo.name+"("+this.data.playerBaseInfo.serverId+"服)",this.cu_ph.updateData({vo:this.data.guildBaseInfo}),this.cu_ph.img_frame.visible=!1,this.cu_ph.img_bg.visible=!1,this.cu_ph.blb_level.visible=!1):(this.lb_name.text=this.data.playerBaseInfo.name+"("+this.data.playerBaseInfo.serverId+"服)",this.cu_ph.updateData({vo:this.data.playerBaseInfo})),this.img_icon.source=this.rankPy.rankIcon(this.data.rank),this.img_icon.source?this.blb_rank.text="":this.blb_rank.text=this.data.rank.toString(),this.lb_money.text=this.data.key.toString()},r);function r(){var t=a.call(this)||this;return t.rankPy=o.AppFacade.getInstance().retrieveProxy(o.RankPy.N),t.skinName="ActivityNewZoneConsumeRank1Item",t}}(game=game||{}),function(s){var T,t=(T=s.ActivityCommonView,__extends(e,T),e.prototype.childrenCreated=function(){var i=this;T.prototype.childrenCreated.call(this),this.CommonArrayList.itemRenderer=a,this.CommonArrayList.setChoseFrame("common_img_touxiangxuanzhon_png"),this.CommonArrayList.addItemTapEvent(this.onTapItem,this);var t=new eui.HorizontalLayout;t.gap=0,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.CENTER,this.CommonArrayList.layout=t,this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.dataList[i.curCode-1];if(t){if(t.selfBuy>=t.canBuyTimes)return void Utils.MsgUtils.addMidMsg("当前没有可购买数量");var e=[[1,1,t.initPrice*t.curDiscount/100]];if(!s.GameMVC.backpackPy.checkEnough(e,!1))return void Utils.MsgUtils.addMidMsg("当前钻石不足");i.getReward({code:i.code,num:1,id:t.code,diamonds:t.initPrice*t.curDiscount/100})}else Utils.MsgUtils.addMidMsg("读取配置失败")},this),this.btn_help.visible=!0,this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s.HelpDialog({moduleId:MODULE.Activity+EActivityType.NewZoneGroupPurchase})})},this)},e.prototype.updateView=function(t){T.prototype.updateView.call(this,t),this.updateTitle();var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=e.data.itemList,n=[];for(var o in i){var r=i[o],s=r[0],c=r[1],d=r[2],h=r[3],l=r[4],p=0,u=0;for(var g in a){var m=a[g];m.code==s&&(p=m.num,u=m.times)}var y=100,v=0,f=0;for(var _ in l){var A=l[_];p>=A[0]&&(y=A[1],f++),v=A[0]>v?A[0]:v}n.push({code:s,rewards:c,canBuyTimes:d,initPrice:h,discountConfig:l,peopleBuy:p,selfBuy:u,curDiscount:y,maxNeedCount:v,curStage:f})}this.dataList=n,this.CommonArrayList.dataProvider=new eui.ArrayCollection(n),this.CommonArrayList.changeTo({itemIndex:this.curCode-1})}},e.prototype.onTapItem=function(t){var e=t.itemIndex;this.curCode=e+1,this.updateTopInfo()},e.prototype.updateTopInfo=function(){var t=void 0;for(var e in this.dataList)if((o=this.dataList[e]).code==this.curCode){t=o;break}if(t){var i=t.rewards,a=s.GeneralConfig.getEntityConfigByCode(i[0][0],i[0][1]);a&&(this.bastitem_reward.updateData({reward:i[0]}),this.lb_rewardname.text=a.name),this.bm_oldPrice.text=t.initPrice,this.lb_canBuy.text=t.canBuyTimes-t.selfBuy+"",this.blb_discount1.text=t.curDiscount/10+"",this.gp_discount0.visible=t.curDiscount<100,this.bm_curDiscount.text=t.curDiscount/10+"",this.bm_newPrice.text=t.initPrice*t.curDiscount/100+"",this.pb_progress.value=0,this.pb_progress.maximum=t.maxNeedCount;var n=0;for(var e in t.peopleBuy<1e3?n=0+(t.peopleBuy-0)/1e3*2500:t.peopleBuy<3e3?n=2500+(t.peopleBuy-1e3)/2e3*2500:t.peopleBuy<5e3?n=5e3+(t.peopleBuy-3e3)/2e3*2500:t.peopleBuy<1e4&&(n=7500+(t.peopleBuy-5e3)/5e3*2500),this.pb_progress.value=Math.floor(n),this.bm_hasSale.text=t.peopleBuy,this.recycleDiscountItem(),this.recyclePeopleItem(),t.discountConfig){var o=t.discountConfig[e],r=this.makeDiscountItem(o[1]/10);this.gp_discount.addChild(r),r=this.makePeopleItem(o[0]),this.gp_peoplCount.addChild(r)}t.selfBuy>=t.canBuyTimes?(this.btn_hasBuy.visible=!0,this.btn_buy.visible=!1):(this.btn_hasBuy.visible=!1,this.btn_buy.visible=!0)}},e.prototype.makeDiscountItem=function(t){if(0<this.discountItems.length){var e=this.discountItems[0];return e.bm_discount.text=t,this.discountItems.shift(),e.visible=t<10,e}var i=new eui.Group,a=new eui.Image,n=new eui.BitmapLabel;return a.source="newactivity_img_zhekou_png",a.horizontalCenter=a.verticalCenter=0,i.addChild(a),n.font="main_vip_fnt",n.text=t,n.rotation=-5,n.verticalCenter=5,n.right=70,i.bm_discount=n,i.addChild(n),i.visible=t<10,i},e.prototype.recycleDiscountItem=function(){for(var t in this.gp_discount.$children){var e=this.gp_discount.$children[t];this.discountItems.push(e)}this.gp_discount.removeChildren()},e.prototype.makePeopleItem=function(t){if(0<this.peopleCountItems.length){var e=this.peopleCountItems[0];return e.bm_discount.text=t,this.peopleCountItems.shift(),e.visible=!!t,e}var i=new eui.Group,a=new eui.Image,n=new eui.BitmapLabel;return a.source="newactivity_img_jindujiedian_png",a.horizontalCenter=a.verticalCenter=0,i.addChild(a),n.font="recharge_num_fnt",n.text=t,n.horizontalCenter=0,n.verticalCenter=0,n.rotation=-10,n.letterSpacing=-5,n.scaleX=n.scaleY=.7,i.bm_discount=n,i.addChild(n),i.visible=!!t,i},e.prototype.recyclePeopleItem=function(){for(var t in this.gp_peoplCount.$children){var e=this.gp_peoplCount.$children[t];this.peopleCountItems.push(e)}this.gp_peoplCount.removeChildren()},e.prototype.updateTitle=function(){var t=this,e=s.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var a=s.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=a--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):s.AppFacade.getInstance().hideSubView(s.ActivityMediator.N,s.ActivityMediator.SV.MAIN)},this,1e3)}},e);function e(){var t=T.call(this)||this;return t.curCode=1,t.dataList=[],t.peopleCountItems=[],t.discountItems=[],t.skinName="ActivityNewZoneGroupPurchase",t}s.ActivityNewZoneGroupPurchase=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.bi_reward=customui.BaseItemFactory.create(),this.bi_reward.horizontalCenter=this.bi_reward.verticalCenter=0,this.gp_main.addChild(this.bi_reward)},n.prototype.dataChanged=function(){this.bi_reward.updateData({reward:this.data.rewards[0]}),this.blb_discount0.text=this.data.curDiscount/10+"",100<=this.data.curDiscount?this.gp_discount.visible=!1:this.gp_discount.visible=!0,this.data.selfBuy<this.data.canBuyTimes?(UIActionManager.setGrey(this.gp_all,!1),this.img_hasBuy.visible=!1):(UIActionManager.setGrey(this.gp_all,!0),this.img_hasBuy.visible=!0)},n.itemWidth=105,n);function n(){var t=i.call(this)||this;return t.skinName="ActivityNewZoneGroupPurchaseItem",t}}(game=game||{}),function(n){var s,t=(s=n.ActivityCommonView,__extends(e,s),e.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n.HelpDialog({moduleId:MODULE.Activity+EActivityType.OneChoice})})},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.selectIndex?n.GameMgr.getInstance().showCommonTipsWin({costTips:"活动期间内祈福次数仅限一次，请确认是否祈福？",cost:[],reset:!0,cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(t){1===t.type&&e.getReward({code:e.code,num:1,id:e.selectIndex+1},function(){n.GameMVC.activityMed.updateView(n.ActivityMediator.SV.MAIN)})}}):Utils.MsgUtils.addMidMsg("未选择祈福的英雄")},this)},e.prototype.updateView=function(t){var n=this;if(s.prototype.updateView.call(this,t),!this.initFinish){this.initFinish=!0;var e=this.info;if(!e||!e.data)return[];function i(i){var t=o[i],e=r["gp"+i];if(t&&e){var a=new c({heroCode:t[0][1],effect:!1});a.horizontalCenter=a.verticalCenter=0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){for(var t in n.items){var e=n.items[t];e&&e.hideEffect()}n.selectIndex=i,n.items[i-1]&&n.items[i-1].showEffect()},r),r.items.push(a),e.addChild(a)}}for(var o=e.content[(e.data.day||1)-1],r=(e.data.targeted,this),a=1;a<=o.length;a++)i(a);this.updateTitle()}},e.prototype.updateTitle=function(){var t=this,e=n.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var a=n.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=a--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(a):n.AppFacade.getInstance().hideSubView(n.ActivityMediator.N,n.ActivityMediator.SV.MAIN)},this,1e3)}},e);function e(){var t=s.call(this)||this;return t.initFinish=!1,t.selectIndex=0,t.items=new Array,t.skinName="ActivityOneChoice",t}n.ActivityOneChoice=t;var i,c=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){UIActionManager.addEffect(this.gp_effect0,"common_buxiudebaozang_1"),UIActionManager.addEffect(this.gp_effect1,"common_buxiudebaozang_2"),this.data=this.params,this.dataChanged()},a.prototype.showEffect=function(){this.gp_effect0.visible=this.gp_effect1.visible=!0,UIActionManager.setAbsGrey(this,!1),this.HeroDynamicModel.changeAction()},a.prototype.hideEffect=function(){this.gp_effect0.visible=this.gp_effect1.visible=!1,UIActionManager.setAbsGrey(this,!0),this.HeroDynamicModel.egretArmDisplay&&this.HeroDynamicModel.egretArmDisplay.animation.stop()},a.prototype.dataChanged=function(){var t=this;this.HeroDynamicModel.update({code:this.data.heroCode,isStatic:!0},function(){t.update()});var e=n.Config.allHeroConfig()[this.data.heroCode];if(e){this.lb_name.text=e.name,this.img_raceIcon.source=HeroRaceConfig[e.race].raceIcon,this.gp_stars.removeChildren();for(var i=0;i<e.initStar;i++){var a=new eui.Image;a.source="_border_m_json.common_icon_xingji",this.gp_stars.addChild(a)}}this.update()},a.prototype.update=function(){this.data.effect?this.showEffect():this.hideEffect()},a);function a(t){var e=i.call(this)||this;return e.skinName="ActivityOneChoiceItem",e.params=t,e}}(game=game||{}),function(g){var c,t=(c=g.ActivityCommonPanel,__extends(e,c),e.prototype.onDestroy=function(){c.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_one_yuan_gifts")},e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},e.prototype.updateView=function(t){var h=this;c.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data&&g.ActivityConfig.Config[this.code]){var l=e.data.targeted,i=e.content,a=(e.data.key,e.data.day),p=[];for(var n in i){var o=i[n];o[0]==a&&p.push(o)}if(!p.length)return[];function r(t){var e=p[t],n=(e[0],e[1]),o=e[2],i=e[3],a=e[4];for(var r in u.gp_reward.removeChildren(),g.GameMgr.getInstance().CommonGpAddReward(u.gp_reward,i),i){var s=i[r];s[0]==EEntityType.EEntityTypeHero&&u.HeroDynamicModel.update({code:s[1],isStatic:!0})}var c=REWARD_STATUS.CANBUY,d=!1;for(var r in l)if(l[r].id==n){d=!0;break}d&&(c=REWARD_STATUS.RECEIVED),u.updateBtn(u.btn,c),u.bm_star.text=a,u.btnFunc=function(){switch(c){case REWARD_STATUS.CANBUY:var t=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N),e=t.goodList;for(var i in e){var a=e[i];if(a.id==o)return void t.purchase(a,2,n,JSON.stringify({activityType:h.code,uuid:n}),{activityType:h.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}}for(var u=this,s=0;s<p.length;s++)r(s)}},e.prototype.updateBtn=function(t,e){switch(e){case REWARD_STATUS.RECEIVED:t.skinName="skins.ButtonSkinSure",t.label="已领取",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=1,UIActionManager.hideEffect(t);break;case REWARD_STATUS.GO_RECHARGE:t.skinName="skins.ButtonSkinYellow",t.label="充值",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;case REWARD_STATUS.CANBUY:t.skinName="skins.ButtonSkinYellow",t.label=""+1*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"购买",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;default:t.label="领取",UIActionManager.setGrey(t,!1),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8,UIActionManager.addEffect(t,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e);function e(){var t=c.call(this)||this;return Utils.AssetsMgr.loadGroup("group_one_yuan_gifts"),t.skinName="ActivityOneYuanGifts",t}g.ActivityOneYuanGifts=t}(game=game||{}),function(r){var m,t=(m=r.ActivityCommonView,__extends(y,m),y.prototype.childrenCreated=function(){m.prototype.childrenCreated.call(this),this.list_root.itemRenderer=a,this.activateComponent();for(var t=0;t<7;t++){var e=this["btn_tabbarImg"+t];if(e){var i=new eui.Image;i.source="_main_m_json.common_img_hongdian",i.visible=!1,i.top=0,i.right=0,i.scaleX=i.scaleY=.7,e.addChild(i),this.local_notice_img.push(i)}}},y.prototype.updateView=function(t){m.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var n=e.data.day,o=e.data.amounts,r=JSON.parse(e.data.giftTargeted);function i(t){var e=s[t],i=REWARD_STATUS.UNAVAILABLE;if(e[2]==d.curDay){var a=0;r.forEach(function(t){t[0]==e[0]&&(a=t[1])}),a>=e[5]&&(i=REWARD_STATUS.HASBUY),c.push({code:e[0],goodId:e[1],needDay:e[2],needRechared:e[3],costs:e[4],canBuyTimes:e[5],rewards:e[6],name:e[7],today:n,curBuy:a,amounts:o,activityType:d.code,status:i})}}this.curDay||(this.curDay=n);var s=JSON.parse(e.content),c=[],d=this;for(var a in s)i(a);c.sort(function(t,e){return t.code-e.code}),c.forEach(function(t,e){c[e].ratity=5<e+1?5:e+1}),c.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.code-e.code}),this.list_root.dataProvider=new eui.ArrayCollection(c);for(var h=0;h<7;h++){var l=this["btn_tabbarImg"+h],p=this.gp_lines.$children[h];l&&(h+1<=n?(l.icon="xbrj_img_tbd0"+(h+1)+"_png",l.width=86,l.height=87):(l.icon="xbrj_img_tbd00_png",l.width=77,l.height=62),p&&(p.visible=h<n-1))}if(this.lb_allRecharge.text=o,this.lb_today.text="寻宝天数:第"+n+"天",this.isFirst){var u=this["btn_tabbarImg"+(this.curDay-1)];if(u){var g=u.bottom;egret.Tween.get(u,{loop:!0}).to({bottom:g+15},1e3).to({bottom:g},1e3),u&&(u.scaleX=u.scaleY=1.1)}this.isFirst=!1}this.local_notice_img.forEach(function(t,e){t.visible=!!y.local_notice[e+1]})}},y.prototype.changeDay=function(t){void 0===t&&(t=1);var e=this.info;if(e&&e.data)if(e.data.day<t)Utils.MsgUtils.addMidMsg("当前行程未开启");else if(t!=this.curDay){var i=this["btn_tabbarImg"+(this.curDay-1)];i&&(i.scaleX=i.scaleY=1)&&egret.Tween.removeTweens(i),this.curDay%2==0?i.bottom=0:i.bottom=96;var a=this["btn_tabbarImg"+(t-1)];if(a){var n=a.bottom;egret.Tween.get(a,{loop:!0}).to({bottom:n+15},1e3).to({bottom:n},1e3),a&&(a.scaleX=a.scaleY=1.1)}this.curDay=t,this.updateView()}},y.prototype.activateComponent=function(){function t(t){var e=a["btn_tabbarImg"+t];e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.changeDay(t+1)},a)}for(var i=this,a=this,e=0;e<7;e++)t(e)},y.prototype.onDestroy=function(){m.prototype.onDestroy.call(this)},y.local_notice=[],y);function y(){var t=m.call(this)||this;return t.curDay=0,t.isFirst=!0,t.local_notice_img=[],t.rechargeProxy=r.AppFacade.getInstance().retrieveProxy(r.RechargePy.N),t.skinName="ActivityOtherDiamondGifts",t}r.ActivityOtherDiamondGifts=t;var o,a=(o=eui.ItemRenderer,__extends(e,o),e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.curBuy>=this.data.canBuyTimes?Utils.MsgUtils.addMidMsg("已购买"):this.data.amounts<this.data.needRechared?Utils.MsgUtils.addMidMsg("未满足活动累充金额条件"):r.GameMVC.backpackPy.checkEnough(this.data.costs,!1)?this.getReward({code:this.data.activityType,num:1,id:this.data.code}):Utils.MsgUtils.addMidMsg("当前钻石不足")},this);var t=this.btn_operate.cui_freshCost.img_icon;t&&(t.scaleX=t.scaleY=.9),this.btn_operate.btn_oppr.skinName="skins.ButtonSkinYellow",this.btn_operate.cui_freshCost.left=void 0,this.btn_operate.cui_freshCost.horizontalCenter=-3,this.btn_hasBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("已购买")},this)},e.prototype.dataChanged=function(){var e=this;if(o.prototype.dataChanged.call(this),this.data){this.gp_rewards.removeChildren(),r.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards),this.lb_name.text=this.data.name||"第"+this.data.needDay+"天";var i=this.data.curBuy>=this.data.canBuyTimes,t=this.data.ratity,a=this.data.amounts>=this.data.needRechared,n="xbrj_img_baoxiang"+(i?"0_":"1_")+(t-1)+"_png";this.img_box.source=n,this.img_box.visible=!0,a?i?(this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&(this.tdEffect.visible=!1)):(this.img_box.visible=!1,this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&this.oldRatity==t?this.tdEffect.visible=!0:(this.gp_effect.removeChildren(),UIActionManager.addEffect(this.gp_effect,"common_xunbaorijibxtd0"+t,{childIndex:0},function(t){e.tdEffect=t,e.tdEffect.visible=a&&!i}))):(5==t?this.sgEffect?this.sgEffect.visible=!0:UIActionManager.addEffect(this.gp_effect,"common_xunbaorijibxsg",{},function(t){e.sgEffect=t}):this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&(this.tdEffect.visible=!1)),this.oldRatity=t,i?(this.btn_operate.visible=!1,this.btn_hasBuy.visible=!0):(this.btn_operate.visible=!0,this.btn_hasBuy.visible=!1,this.data.costs[0][2]?this.btn_operate.cui_freshCost.updateItem({cost:this.data.costs[0],style:CommonIconStyle.RIGHT}):this.btn_operate.updateData({text:"领取"})),this.lb_tip.visible=!a,UIActionManager.setGrey(this.btn_operate,!a),this.lb_tip.textFlow=[{text:"累充达到",style:{textColor:16777215}},{text:this.data.needRechared*Utils.SDKMgr.globalIAPRate+"",style:{textColor:16772466}},{text:Utils.SDKMgr.globalIAPSuffix+"可购买",style:{textColor:16777215}}]}},e.prototype.getReward=function(t,i){var a=this;if(this.data.activityType){var n=r.ActivityConfig.Config[this.data.activityType],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,t).then(function(t){GameRootLayer.gameLayer().switchTouchEnable(!1),console.log(n.name+"——领取",o+"R",t);var e=r.GameMVC.activityPy.allActivityData[a.data.activityType];a.tdEffect&&(a.tdEffect.visible=!1),a.img_box.visible=!0,a.img_box.source="xbrj_img_baoxiang0_"+(a.data.ratity-1)+"_png",DragonBoneTools.playOnce({parent:a.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),r.GameMVC.backpackPy.handleClientReward(t.clientReward,{closeCB:function(){e&&e.updateData(t.info)}})}}),i&&i(t)})}else console.log("没有声明活动code")},e);function e(){var t=o.call(this)||this;return t.oldRatity=0,t.skinName="ActivityOtherDiamondGiftsItem",t}}(game=game||{}),function(h){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.updateView(this.data),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},e.prototype.updateView=function(t){var e=this;this.selectedId=this.opperationParams=t.selectedId,this.gp_box.removeChildren();var i=h.Config.HeroEquipCompound(),a=h.Config.getHeroEquipConfig();for(var n in this.showType=t.showType,i){var o=i[n];if(o.type==this.showType){var r=JSON.parse(o.rewards),s=a[r[0][1]].professionSuit,c={id:Number(n),rewards:r,profession:s,selected:this.selectedId==Number(n),selectCB:function(t){e.selectId(t)}},d=new l;d.updateItem(c),this.gp_box.addChild(d)}}},e.prototype.selectId=function(t){var e=t==this.selectedId?0:t;this.selectedId=this.opperationParams=e,this.gp_box.$children.forEach(function(t){t.updateSelected(t.data.id==e)})},e);function e(t){var e=i.call(this)||this;return e.showType=0,e.skinName="ActivityProfessionSuitSelectSkin",e.data=t,e}h.ActivityProfessionSuitSelect=t;var a,l=(a=eui.Component,__extends(n,a),n.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.checkBox,egret.Event.CHANGE,function(){t.data.selectCB(t.data.id)},this)},n.prototype.updateItem=function(t){var i=this;this.data=t;var e=this.data.rewards;this.gp_baseItems.removeChildren(),e.forEach(function(t){var e=customui.BaseItemFactory.create();e.updateData({code:t[1]}),i.gp_baseItems.addChild(e)});var a=this.data.profession;this.img_icon.source=ProfessionConfig[a].icon,this.lb_title.text=ProfessionConfig[a].name+"套装",this.updateSelected(this.data.selected)},n.prototype.updateSelected=function(t){this.data.selected=t,this.checkBox.selected=t},n);function n(){var t=a.call(this)||this;return t.skinName="ActivityProfessionSuitSelect_SelectBox",t}}(game=game||{}),function(d){var h,t=(h=d.ActivityCommonView,__extends(e,h),e.prototype.childrenCreated=function(){var i=this;if(h.prototype.childrenCreated.call(this),this.activateComponent(),!this.commonConfig){var t=d.Config.HeroEquipCompound();for(var e in t){var a=t[e];if(2==a.type){this.commonConfig=a;break}}}this.gp_costs.removeChildren();var n=JSON.parse(this.commonConfig.costs);n.length&&n.forEach(function(t){var e=new customui.CommonIconWithNum;e.updateItem({cost:t,style:CommonIconStyle.RIGHT,needBg:!0}),i.gp_costs.addChild(e)})},e.prototype.updateView=function(t){var e=this;h.prototype.updateView.call(this,t);var i=[];if(this.targetId){var a=d.Config.HeroEquipCompound()[this.targetId];JSON.parse(a.rewards).forEach(function(t){i.push(t[1])})}var n=this.selectedUuids.length,o=this.commonConfig.num;this.blb_num.visible=!0,this.blb_num.font=n<o?"RedBlackStrocke_fnt":"green_num_fnt",this.blb_num.text=this.selectedUuids.length+"/"+this.commonConfig.num;for(var r=0;r<4;r++){var s=this.gp_preview.$children[r];s||(s=new l,this.gp_preview.addChild(s),Utils.ComponentUtils.registerListener(s,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.ActivityProfessionSuitSelect({selectedId:e.targetId,showType:HeroEquipCompoundType.ProfessionSuit}),closeCB:function(t){e.targetId=t,e.updateView()}})},this)),s.updateItem({code:i[r]})}var c=this.info.content[0];this.blb_limitTimes.text=""+(c-this.info.data.num),this.updateTime()},e.prototype.updateTime=function(){this.timer||(this.remainingDt=d.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):d.AppFacade.getInstance().hideSubView(d.ActivityMediator.N,d.ActivityMediator.SV.MAIN)},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.gp_slot,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var t={},e=d.GameMVC.heroThingPy.AllEquipInfo;for(var i in e){var a=e[i];if(a.config.color==o.commonConfig.color&&""==a.heroUuid&&0==a.config.professionSuit)for(var n=a.num;0<n--;)t[i+"#"+n]=a}return t},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(t){return t.length>=o.commonConfig.num},selectUuids:o.selectedUuids,title:"请选择装备",uniNum:!0}),closeCB:function(){o.updateView()}})},this),Utils.ComponentUtils.registerListener(this.btn_forge,egret.TouchEvent.TOUCH_TAP,function(){if(o.targetId)if(o.selectedUuids.length<o.commonConfig.num)Utils.MsgUtils.addMidMsg("所需装备不足");else{var i={};o.selectedUuids.forEach(function(t){var e=t.split("#")[0];i[e]||(i[e]=0),i[e]+=1});var t=[];for(var e in i)t.push({equipUuid:e,num:i[e]});d.GameMVC.heroThingPy.HeroEquipCompound({id:o.targetId,uuidInfos:t,type:2,code:o.code,beforeCB:function(i){DragonBoneTools.playOnce({effectName:"common_tjjt",parent:o.gp_preview,y:-40,doneCB:function(){o.gp_preview.$children.forEach(function(t,e){DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:t,doneCB:function(){e==o.gp_preview.numChildren-1&&i()}})})}})},cb:function(){o.selectedUuids.splice(0),o.targetId=0,o.updateView()}})}else Utils.MsgUtils.addMidMsg("请选择套装")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.HelpDialog({moduleId:MODULE.ActivityProfessionSuit})})},this)},e);function e(){var t=h.call(this)||this;return t.code=EActivityType.ProfessionSuit,t.targetId=0,t.selectedUuids=[],t.skinName="ActivityProfessionSuitSkin",t}d.ActivityProfessionSuitView=t;var i,l=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},a.prototype.updateItem=function(t){this.data=t,this.data.code?(this.gp_empty.visible=!1,this.gp_baseItem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseItem.visible=!1)},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityProfessionSuitView_EquipItem",t}}(game=game||{}),function(g){var p,t=(p=g.ActivityCommonPanel,__extends(e,p),e.prototype.childrenCreated=function(){var h=this;p.prototype.childrenCreated.call(this),this.gp_effect.visible=!1,this.gp_box.visible=!1,this.gp_main.visible=!1,this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=h.info;if(t&&t.data){var e=Utils.TimerManager.getServerOpenDays(),i=t.data.vipLevel,a=JSON.parse(t.content),n=[];for(var o in a){var r=a[o];if(r[0]==e)for(var s in r[1]){var c=r[1][s];c[1]==i&&(n=c[0])}}if(n){var d=g.GameMVC.rechargePy.getGoodInfo(n);d?g.GameMVC.rechargePy.purchase(d,2,String(n),JSON.stringify({uuid:n,activityType:h.code}),{activityType:h.code}):Utils.MsgUtils.addMidMsg("找不到商品配置")}else Utils.MsgUtils.addMidMsg("找不到商品id")}},this),this.img_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.isPlaying||(h.gp_effect.visible=!1,Utils.LocalStorageUtil.setTodayVaild("PUSH_GIFT_BAG"),h.showBox())},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.hide()},this),DragonBoneTools.create("common_jingxilibao_03",function(t){t.x=this.gp_box.width/2,t.y=this.gp_box.height/2,t.animation.play(),this.gp_box.addChild(t)},this),DragonBoneTools.create("common_jingxilibao_2_01",function(t){t.x=this.gp_bottom.width/2,t.y=this.gp_bottom.height/2+90,t.animation.play(),this.gp_bottom.addChild(t)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(t){t.x=this.gp_bottom.width/2,t.y=this.gp_bottom.height/2+110,t.scaleX=.84,t.animation.play(),this.gp_bottom.addChild(t)},this)},e.prototype.updateView=function(t){p.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){if(0<e.data.purchaseTime&&(g.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),this.hide()),Utils.LocalStorageUtil.getTodayVaild("PUSH_GIFT_BAG")){this.gp_box.visible=!0,this.gp_main.visible=!0,this.gp_rewards.removeChildren();var i=Utils.TimerManager.getServerOpenDays(),a=e.data.vipLevel,n=JSON.parse(e.content),o=[],r=0;for(var s in n){var c=n[s];if(c[0]==i)for(var d in c[1]){var h=c[1][d];h[1]==a&&(r=h[0],o=h[2])}}g.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,o);var l=g.GameMVC.rechargePy.getGoodInfo(r);this.btn_buy.label=l?""+l.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:"error"}else this.gp_effect.visible=!0,this.isPlaying=!0,MovieClipTools.create("common_jingxilibao_2_03",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2-110,t.animation.play("common_jingxilibao_2_03",1),this.gp_effect.addChild(t)},this),DragonBoneTools.create("common_jingxilibao_2_02",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2-10,t.animation.play("common_jingxilibao_2_02",0),this.gp_effect.addChild(t)},this),MovieClipTools.create("common_jingxilibao_01",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2+90,t.animation.play("common_jingxilibao_01",1),this.gp_effect.addChild(t),t.addEventListener(egret.Event.COMPLETE,function(){this.isPlaying=!1},this)},this);this.updateTime()}},e.prototype.showBox=function(){var e=this;this.gp_box.visible=!0,DragonBoneTools.playOnce({effectName:"common_jingxilibao_02",parent:this.gp_box,x:this.gp_box.width/2,y:this.gp_box.height/2+30,doneCB:function(t){e.showRewards()}})},e.prototype.showRewards=function(){var e=this;this.gp_main.visible=!0;var t=this.info;if(t&&t.data){GameRootLayer.gameLayer().switchTouchEnable(!1);var i,a=Utils.TimerManager.getServerOpenDays(),n=t.data.vipLevel,o=JSON.parse(t.content),r=[];for(var s in o){var c=o[s];if(c[0]==a)for(var d in c[1]){var h=c[1][d];h[1]==n&&(r=h[2],i=h[0])}}var l=0,p=function(){if(r[l]){var t=e.makeRewardsItem(r[l],p);e.gp_rewards.addChild(t),l++}};GameRootLayer.gameLayer().switchTouchEnable(!0);var u=g.GameMVC.rechargePy.getGoodInfo(i);this.btn_buy.label=u?""+u.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix:"error",p(),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,5e3)}},e.prototype.makeRewardsItem=function(t,e,i){void 0===i&&(i=!0);var a=new eui.Group;a.width=a.height=105,a.scaleX=a.scaleY=.8;var n=customui.BaseItemFactory.create();return n.horizontalCenter=n.verticalCenter=0,n.updateData({reward:t}),n.visible=!1,a.addChild(n),i?DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:a,doneCB:function(){n.visible=!0,e&&e()}}):e(),a},e.prototype.updateTime=function(){var t=this,e=g.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond1(e),egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--e?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(e):t.hide()},this,1e3)},e);function e(){var t=p.call(this)||this;return t.isPlaying=!1,t.skinName="ActivityPushGiftBag",t.code=EActivityType.PushGiftBag,t}g.ActivityPushGiftBag=t}(game=game||{}),function(n){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.updateView=function(t){var e=n.Config.operationConfig(),i=n.GameMVC.activityPy.allActivityData[this.code],a=e[JSON.parse(i.content)[0]];n.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(a.reward))},i.prototype.activateComponent=function(){var t=this;Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){t.hide()}),Utils.ComponentUtils.registerListener(this.btn_ok,egret.TouchEvent.TOUCH_TAP,function(){t.okCB&&t.okCB()})},i);function i(){var t=e.call(this)||this;return t.skinName="ActivitySDKCommonViewSkin",t}n.ActivitySDKCommonView=t}(game=game||{}),function(t){var e,i=(e=t.ActivitySDKCommonView,__extends(a,e),a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.lb_title.text="关注公众号礼包"},a.prototype.updateView=function(t){e.prototype.updateView.call(this,t),this.okCB=function(){Utils.SDKMgr.cmd({type:"GuanZhuGongZhongHao"})}},a);function a(){var t=e.call(this)||this;return t.code=EActivityType.GuanZhuGongZhongHao,t}t.ActivitySDKGZHView=i}(game=game||{}),function(i){var a,t=(a=i.ActivitySDKCommonView,__extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.lb_title.text="实名认证礼包"},e.prototype.updateView=function(t){var e=this;a.prototype.updateView.call(this,t),this.okCB=function(){Utils.SDKMgr.cmd({type:"ShiMingRenZheng",cb:function(){getUrlKV().Act_ShiMingRenZheng&&(i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),i.GameMVC.activityPy.getOperationReward(OperationType.Act_ShiMingRenZheng),Utils.MsgUtils.addMidMsg("奖励已通过邮件发放，请查收"))}}),e.hide()}},e);function e(){var t=a.call(this)||this;return t.code=EActivityType.ShiMingRenZheng,t}i.ActivitySDKSMRZView=t;var n,o=(n=i.ActivitySDKCommonView,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.lb_title.text=this.params&&this.params.title,this.updateView()},r.prototype.updateView=function(t){var e=this;this.okCB=function(){e.params.okCB&&e.params.okCB(),e.hide()},this.gp_rewards.removeChildren(),this.params.rewards&&i.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.params.rewards)},r);function r(t){var e=n.call(this)||this;return e.params=t,e}i.ActivitySDKSMRZView2=o}(game=game||{}),function(t){var i,e=(i=t.ActivitySDKCommonView,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_tips.visible=!1,this.lb_title.text="微端下载礼包"},a.prototype.check=function(){return!!getUrlKV().Act_WeiDuanXiaZai&&(t.AppFacade.getInstance().retrieveProxy(t.ActivityPy.N),t.GameMVC.activityPy.getOperationReward(OperationType.Act_AppDownload),Utils.MsgUtils.addMidMsg("奖励已通过邮件发放，请查收"),!0)},a.prototype.updateView=function(t){var e=this;i.prototype.updateView.call(this,t),this.okCB=function(){e.check()||Utils.SDKMgr.cmd({type:"WeiDuanXiaZai",cb:function(){e.check()}}),e.hide()}},a);function a(){var t=i.call(this)||this;return t.code=EActivityType.WeiDuanXiaZai,t}t.ActivitySDKWDXZView=e}(game=game||{}),function(v){var e,t=(e=v.ActivityCommonListView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.tabbar=new eui.TabBar,this.tabbar.itemRendererSkinName="ActivitySecondContinueRechargeRewardTabbar",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this),this.tabbar.left=this.tabbar.bottom=0,this.gp_title.addChild(this.tabbar);var t=new eui.Image;t.source="lxlc_img_yeqiandixian_png",t.bottom=0,t.horizontalCenter=0,this.gp_title.addChild(t),this.bm_time.right=-60,this.bm_time.y-=30},i.prototype.onTabbarTap=function(t){this.selectIndex=t.itemIndex,this.updateView()},i.prototype.updateView=function(t){var e=this;this.code=t&&t.activityType||t&&t.code||this.code;var i=this.info;if(i&&i.data){if(this.updateTitle(),!this.hasInitTabbar){var a=JSON.parse(i.content);for(var n in a){var o=a[n];this.rechargegGradient.indexOf(o[0])<0&&this.rechargegGradient.push(o[0])}this.rechargegGradient.sort(function(t,e){return t-e});var r=[];this.rechargegGradient.forEach(function(t){r.push({up:"lxlc_img_yeqian1_png",down:"lxlc_img_yeqian2_png",text:t*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix})}),this.tabbar.dataProvider=new eui.ArrayCollection(r),this.tabbar.once(eui.UIEvent.ENTER_FRAME,function(){e.updateNotice()},this)}var s=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(s):this.list_itemList.dataProvider=new eui.ArrayCollection(s),this.updateTitle(),this.updateNotice()}},i.prototype.getDataList=function(){var h=this,t=this.info;if(!t||!t.data)return[];var l=t.data.amounts,p=JSON.parse(t.data.targeted),u=JSON.parse(t.data.rechargeDays),e=JSON.parse(t.content);if(!e)return[];var g=[],m=this.rechargegGradient[this.selectIndex];for(var i in e){var a=e[i];if(a[0]==m){function n(t){var e=y[t],i=e[0],a=e[1],n=e[2],o=0;for(var r in u)if(u[r][0]==m){o=u[r][1];break}var s=REWARD_STATUS.UNAVAILABLE;for(var c in s=m<=l?o<a?REWARD_STATUS.UNAVAILABLE:REWARD_STATUS.AVAILABLE:o<a-1?REWARD_STATUS.UNAVAILABLE:o==a-1?REWARD_STATUS.GO_RECHARGE:REWARD_STATUS.AVAILABLE,p)if(p[c][0]==i){s=REWARD_STATUS.RECEIVED;break}var d={id:i,title:"连续充值"+a+"天可领取",tips:s==REWARD_STATUS.UNAVAILABLE?"未解锁":o+"/"+a,rewards:n,status:s,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:h.getReward({id:i,code:h.code});break;case REWARD_STATUS.GO_RECHARGE:v.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未解锁")}}};g.push(d)}var y=a[1];for(var o in y)n(o)}}return g.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),g},i.prototype.updateNotice=function(){var t=this.info;if(t&&t.data){t.data.amount;var e=JSON.parse(t.data.targeted),i=JSON.parse(t.data.rechargeDays),a=JSON.parse(t.content);if(!a)return[];for(var n=0;n<this.rechargegGradient.length;n++){var o=this.rechargegGradient[n];for(var r in a){var s=a[r];if(s[0]==o){var c=s[1];for(var d in c){var h=c[d],l=h[0],p=h[1],u=(h[2],0);for(var g in i)if(i[g][0]==o){u=i[g][1];break}var m=REWARD_STATUS.GO_RECHARGE;for(var y in p<=u&&(m=REWARD_STATUS.AVAILABLE),e)if(e[y][0]==l){m=REWARD_STATUS.RECEIVED;break}var v=this.tabbar.$children[n];if(v){var f=v.img_notice;if(f&&(f.visible=m==REWARD_STATUS.AVAILABLE,f.visible))break}}}}}}},i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.selectIndex=0,t.hasInitTabbar=!1,t.rechargegGradient=[],t}v.ActivitySecondContinueRechargeReward=t}(game=game||{}),function(y){var e,t=(e=y.ActivityCommonListView,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_arrives")},i.prototype.getDataList=function(){var d=this,t=this.info;if(!t||!t.data)return[];var h,e=t.content,l=t.data.amount,p=JSON.parse(t.data.targeted),i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){h=n[1];break}}if(!h)return[];function o(t){var e=h[t],i=e[1],a=e[2],n=e[3]||1,o=REWARD_STATUS.AVAILABLE;-1!=p.indexOf(e[0])?o=REWARD_STATUS.RECEIVED:l<i&&(o=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+e[1]*Utils.SDKMgr.globalIAPRate+" "+Utils.SDKMgr.globalIAPSuffix+"可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(m.code)&&(r="今日充值任意金额可领取");var s={id:i,title:e[1]?r:"免费领取",tips:e[1]?l+"/"+i:"",rewards:a,status:o,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:e[0],code:d.code});break;case REWARD_STATUS.GO_RECHARGE:y.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<n){var c=!0;if(u.forEach(function(t){t.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(t)+1])return u.push(s),"break";g=n,u.splice(0,u.length),u.push(s)}else u.push(s)}var u=[],g=1,m=this;for(var r in h)if("break"===o(r))break;return u.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),u},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.SecondOpenServerRecharge,Utils.AssetsMgr.loadGroup("group_hero_arrives"),t}y.ActivitySecondOpenServerRecharge=t}(game=game||{}),function(v){var e,t=(e=v.ActivityCommonView,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list_root.itemRenderer=n},i.prototype.updateView=function(t){var e=this;this.code=t&&t.activityType||t&&t.code||this.code;var i=this.info;if(i&&i.data){this.bm_cur.text=i.data.amount,this.updateTitle();var a=this.getDataList();this.list_root.dataProvider?this.list_root.dataProvider.replaceAll(a):this.list_root.dataProvider=new eui.ArrayCollection(a);var n=0,o=void 0;for(var r in a){var s=a[r];if(null==o&&s.status!=REWARD_STATUS.RECEIVED&&(o=parseInt(r)),s.select){(n=parseInt(r))<0&&(n=0);break}}if(this.hasInit){if(0<o){var c=132*(o-0);c>this.list_root.height-this.sl_root.height&&(c=this.list_root.height-this.sl_root.height),this.sl_root.viewport.scrollV=c}}else this.pb_progress.value=0,this.pb_progress.maximum=1e3*a.length,this.list_root.once(egret.TimerEvent.ENTER_FRAME,function(){if(e.pb_progress.width=e.list_root.height,0<o){var t=132*(o-0);t>e.list_root.height-e.sl_root.height&&(t=e.list_root.height-e.sl_root.height),e.sl_root.viewport.scrollV=t}e.find||(e.img_arrow.top=e.pb_progress.width-40)},this),this.hasInit=!0;this.find?(this.img_arrow.top=0==n?50:132*n+20,this.pb_progress.value=1e3*n+400):(this.pb_progress.value=this.pb_progress.maximum,this.img_arrow.top=this.pb_progress.width-40)}},i.prototype.updateTitle=function(){var t=this,e=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.bm_time.text="";else if(e&&this.bm_time){var i=v.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):v.AppFacade.getInstance().hideSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN)},this,1e3)}},i.prototype.getDataList=function(){var d=this,t=this.info;if(!t||!t.data)return[];var h,e=t.content,l=t.data.amount,p=JSON.parse(t.data.targeted),i=t.data.curCycle||1;for(var a in e[1])if((c=e[1][a])[0]==i){h=c[1];break}if(!h)return[];function n(t){var e=h[t],i=e[1],a=e[2],n=e[3]||1,o=REWARD_STATUS.AVAILABLE;-1!=p.indexOf(e[0])?o=REWARD_STATUS.RECEIVED:l<i&&(o=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+e[1]*Utils.SDKMgr.globalIAPRate+" "+Utils.SDKMgr.globalIAPSuffix+"可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(m.code)&&(r="今日充值任意金额可领取");var s={id:i,title:e[1]?r:"免费领取",tips:e[1]?l+"/"+i:"",rewards:a,isAnother:e[4],status:o,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:e[0],code:d.code});break;case REWARD_STATUS.GO_RECHARGE:v.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<n){var c=!0;if(u.forEach(function(t){t.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(t)+1])return u.push(s),"break";g=n,u.splice(0,u.length),u.push(s)}else u.push(s)}var u=[],g=1,m=this;for(var o in h)if("break"===n(o))break;for(var a in u)if((c=u[a]).isAnother)for(var r in u){var s=u[r];s.isAnother||s.id!=c.id||(u[r].anotherData=c)}for(var a in u){var c;(c=u[a]).isAnother&&u.splice(parseInt(a),1)}for(var a in u.sort(function(t,e){return t.id-e.id}),u)u[a].index=parseInt(a)+1;this.find=!1;for(var y=0;y<u.length;y++)if(l<u[y].id){0==y?u[0].select=!0:u[y-1].select=!0,this.find=!0;break}return this.find||(u[u.length-1].select=!0),u},i);function i(){var t=e.call(this)||this;return t.hasInit=!1,t.listHeight=0,t.find=!1,t.skinName="ActivitySeventhOpenServerRecharge",t}v.ActivitySeventhOpenServerRecharge=t;var a,n=(a=v.ActivityCommonListItem,__extends(o,a),o.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.lb_tips.visible=!1,this.bm_max.text="",UIActionManager.addEffect(this.gp_btn,"common_baoxiang_5",{},function(t){t&&(t.scaleX=t.scaleY=.8,e.box_effect=t,e.box_effect.visible=!(!e.data||!e.data.anotherData||e.data.anotherData.status!=REWARD_STATUS.AVAILABLE))}),this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.data.anotherData;t?t.status==REWARD_STATUS.AVAILABLE?(e.box_effect&&(e.box_effect.visible=!1),e.btn_box.visible=!0,e.btn_box.icon="jiangli_icon_baoxiang05_02_png",DragonBoneTools.playOnce({parent:e.gp_btn,effectName:"common_xunbaorijibxtx",doneCB:function(){t.btnFunc&&t.btnFunc(t)}})):v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewards,type:v.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}):Utils.MsgUtils.addMidMsg("数据错误")},this)},o.prototype.dataChanged=function(){a.prototype.dataChanged.call(this),this.img_select.visible=!!this.data.select;var t=[{text:"累充"+this.data.id*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,style:{textColor:16577473,size:20}}];if(this.data.status==REWARD_STATUS.GO_RECHARGE&&t.push({text:"（ 未达到 ）",style:{textColor:16771584,size:22}}),this.lb_title.textFlow=t,this.data.anotherData){this.gp_btn.visible=!0;var e=this.data.anotherData;e.status==REWARD_STATUS.RECEIVED?this.btn_box.icon="jiangli_icon_baoxiang05_02_png":e.status==REWARD_STATUS.AVAILABLE?(this.btn_box.icon="",this.box_effect&&(this.box_effect.visible=!0)):this.btn_box.icon="jiangli_icon_baoxiang05_01_png",this.bm_cur.text=this.data.id*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix}else this.gp_btn.visible=!1,this.bm_cur.visible=!1,this.bm_max.visible=!1},o);function o(){var t=a.call(this)||this;return t.skinName="ActivitySeventhOpenServerRechargeItem",t}}(game=game||{}),function(o){var e,t=(e=o.ActivityCommonListView,__extends(i,e),i.prototype.initList=function(){this.list_itemList.itemRenderer=o.ShopActiviteUI},i.prototype.purchaseList=function(t,e){for(var i=0;i<t.length;i++)if(t[i].code==e)return t[i].num;return 0},i.prototype.getDataList=function(){function t(t){var e=l[t],i=e[0],a=e[1],n=e[2],o=e[3],r=e[4],s=a[0][2]-u.purchaseList(h,i),c={title:"等级达到级",code:i,reward:a,costs:n,discount:o,buyNum:r,times:s,btnFunc:function(){d.getReward({code:i,num:1,time:s})}};p.push(c)}for(var d=this,e=this.info,h=(e.data.curCycle,e.data.purchaseList),i=e.data.curDay,l=e.content[1][0][1][i-1],p=[],u=this,a=0;a<l.length;a++)t(a);return p},i.prototype.getReward=function(t,e){var i=this;if(this.code)if(this.code==EActivityType.ActivityShop&&t.time<=0)Utils.MsgUtils.addMidMsg("库存不足");else{var a=o.ActivityConfig.Config[this.code],n=a.getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,{code:t.code,num:1}).then(function(t){i.log(a.name+"——领取",n+"R",t),i.code==EActivityType.ActivityShop&&Utils.MsgUtils.addMidMsg("购买成功"),i.info.updateData(t.info),i.backpackProxy.handleClientReward(t.clientReward),e&&e(t)})}else this.log("没有声明活动code")},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.ActivityShop,t.skinName="ActivityCommonShopListViewSkin",t}o.ActivityShop=t}(game=game||{}),function(n){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.updateView=function(t){var e=this,i=n.Config.operationConfig()[OperationType.Act_ShouCangYouLi],a=n.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi);n.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(i.reward)),Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15)&&(this.btn_copy.label="收藏",this.btn_copy.y=262,this.btn_copy.x=271,this.img_bg.source="scbz_img_shoucang_png",egret.setTimeout(function(){a=n.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi),e.lb_getTips.visible=!0,e.lb_getTips.text=a?"您的收藏奖励已发送过":"收藏后可在邮件中领取",UIActionManager.setGrey(e.gp_rewards,a)},this,200))},i.prototype.activateComponent=function(){var t=this;this.lb_getTips.visible=!1,Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){t.hide()}),Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15)?Utils.SDKMgr.addShortcut({title:Utils.agentConfig.htmlName},function(){n.AppFacade.getInstance().retrieveProxy(n.ActivityPy.N),n.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi),Utils.MsgUtils.addMidMsg("已经添加到桌面")}):Utils.SDKMgr.copyToClipBoard(getUrlKV().gameUrl||Utils.agentConfig.gameUrl||window.location.href,function(t){0==t?Utils.MsgUtils.addMidMsg("复制成功"):Utils.MsgUtils.addMidMsg("复制失败，请点击右上角尝试其他方式")})})},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.ShouCangYouLi,t.skinName="ActivityShouCangYouLiViewSkin",t}n.ActivityShouCangYouLiView=t}(game=game||{}),function(e){var i,t=(i=e.ActivityCommonView,__extends(a,i),a.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),Utils.AssetsMgr.destroyGroup("group_signin")},a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList()},a.prototype.initList=function(){this.list_itemList.itemRenderer=o,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},a.prototype.getDataList=function(){for(var t=this,e=this.info,i=e.data.count,a=e.data.dayIndex,n=e.content,o=[],r=0;r<n.length;r++){var s=n[r],c=(s[0],s[1],s[2]),d=(REWARD_STATUS.AVAILABLE,{num:r,dayIndex:a,rewards:c,count:i,status:a<r?REWARD_STATUS.UNAVAILABLE:r<a?REWARD_STATUS.RECEIVED:1==i?REWARD_STATUS.UNAVAILABLE:REWARD_STATUS.AVAILABLE,btnFunc:function(){t.getReward({})}});o.push(d)}return o.sort(function(t,e){return t.num-e.num}),o},a.prototype.updateView=function(t){this.updateTitle();var e=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(e):this.list_itemList.dataProvider=new eui.ArrayCollection(e)},a.prototype.updateTitle=function(){var t=e.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code],t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.bm_time.text=""},a);function a(){var t=i.call(this)||this;return t.code=EActivityType.SignIn,Utils.AssetsMgr.loadGroup("group_signin"),t.skinName="ActivitySignInViewSkin",t}e.ActivitySignIn=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;this.baseItem=customui.BaseItemFactory.create(),this.gp_reward.addChild(this.baseItem),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(t.data.status){case REWARD_STATUS.UNAVAILABLE:PopUpManager.addPopUp({obj:new e.BaseItemDetailView({code:t.data.rewards[0][1],type:t.data.rewards[0][0]})});break;case REWARD_STATUS.AVAILABLE:t.data.btnFunc&&t.data.btnFunc();break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("奖励已领取")}},this)},r.prototype.dataChanged=function(){switch(this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan01_png";break;case REWARD_STATUS.AVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan03_png";break;case REWARD_STATUS.RECEIVED:this.img_signed.visible=!0,this.img_bg.source="newactivity_img_dikuan02_png"}this.baseItem.reset(),this.baseItem.touchEnabled=!1,this.baseItem.scaleX=this.baseItem.scaleY=.933,this.baseItem.horizontalCenter=this.baseItem.verticalCenter=1,this.baseItem.updateData({reward:this.data.rewards[0]})},r);function r(){var t=n.call(this)||this;return t.skinName="ActivitySignInItemSkin",t}}(game=game||{}),function(l){var e,t=(e=l.ActivityCommonListView,__extends(i,e),i.prototype.getDataList=function(){var r=this,t=this.info,e=t.content,i=t.data.day,s=t.data.rechargeInfo,c=t.data.targetedInfo,d=l.Config.getRechargeConfig(),a=e[0];for(var n in e){var o=e[n];if(o[0]==i){a=o[1];break}}var h=[];return a.forEach(function(t){var e=t[0],i=t[1],a=t[2],n=REWARD_STATUS.UNAVAILABLE;c.some(function(t){return t.id==e})?n=REWARD_STATUS.RECEIVED:s.some(function(t){return t.id==e&&0<t.num})&&(n=REWARD_STATUS.AVAILABLE);var o={id:e,title:"充值"+d[i].money*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix+"档次",rewards:a,status:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:r.getReward({id:e});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};h.push(o)}),h.sort(function(t,e){return t.status!=e.status?t.status-e.REWARD_STATUS:t.id-e.id}),h},i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.code=EActivityType.SingleRecharge,t}l.ActivitySingleRecharge=t}(game=game||{}),function(g){var c,t=(c=g.ActivityCommonPanel,__extends(e,c),e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this)},e.prototype.updateView=function(t){var h=this;c.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data&&g.ActivityConfig.Config[this.code]){var l=e.data.targeted,i=e.content,a=(e.data.key,e.data.day),p=[];for(var n in i){var o=i[n];o[0]==a&&p.push(o)}if(!p.length)return[];function r(t){var e=p[t],n=(e[0],e[1]),o=e[2],i=e[3];e[4],u.gp_reward.removeChildren(),g.GameMgr.getInstance().CommonGpAddReward(u.gp_reward,i);var r=REWARD_STATUS.CANBUY,a=!1;for(var s in l)if(l[s].id==n){a=!0;break}a&&(r=REWARD_STATUS.RECEIVED),u.updateBtn(u.btn,r);var c=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N).goodList;for(var s in c){var d=c[s];d.id==o&&(u.lb_price.text="售价："+d.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix)}u.btnFunc=function(){switch(r){case REWARD_STATUS.CANBUY:var t=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N),e=t.goodList;for(var i in e){var a=e[i];if(a.id==o)return void t.purchase(a,2,n,JSON.stringify({activityType:h.code,uuid:n}),{activityType:h.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}}for(var u=this,s=0;s<p.length;s++)r(s)}},e.prototype.updateBtn=function(t,e){switch(e){case REWARD_STATUS.RECEIVED:t.skinName="skins.ButtonSkinSure",t.label="已领取",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=1,UIActionManager.hideEffect(t);break;case REWARD_STATUS.GO_RECHARGE:t.skinName="skins.ButtonSkinYellow",t.label="充值",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;case REWARD_STATUS.CANBUY:t.skinName="skins.ButtonSkinYellow",t.label="购买",UIActionManager.setGrey(t,!1),t.scaleX=t.scaleY=.8,UIActionManager.hideEffect(t);break;default:t.label="领取",UIActionManager.setGrey(t,!1),t.skinName="skins.ButtonSkinYellow",t.scaleX=t.scaleY=.8,UIActionManager.addEffect(t,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e);function e(){var t=c.call(this)||this;return t.skinName="ActivitySixtyEightYuanGifts",t.code=EActivityType.SixtyEightYuanGifts,t}g.ActivitySixtyEightYuanGifts=t}(game=game||{}),function(i){var t,e=(t=i.ActivitySDKCommonView,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lb_title.text="授权认证礼包",this.lb_tips.text="温馨提示：认证成功后，奖励将通过邮件发放，请注意查收",this.updateView()},a.prototype.updateView=function(){var t=this,e=i.Config.operationConfig()[OperationType.Act_XYX_AUTHORIZE_BINDING_GZH];i.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(e.reward)),this.okCB=function(){i.MainJumpConfig.jumpTo("XYX_USERINFO",void 0,{cb:function(t){t&&Utils.SDKMgr.cmd({type:"BindAccount"},function(t){0==t&&i.GameMVC.activityPy.getOperationReward(OperationType.Act_XYX_AUTHORIZE_BINDING_GZH)})}}),t.hide()}},a);function a(){return t.call(this)||this}i.ActivitySQRZView=e}(game=game||{}),function(T){var e,t=(e=T.ActivityCommonListView,__extends(i,e),i.prototype.initList=function(){var t=this;this.list_itemList.itemRenderer=n;var e=new eui.TileLayout;e.requestedColumnCount=2,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.horizontalGap=40,e.verticalGap=40,e.paddingLeft=65,e.paddingRight=65,e.columnAlign=eui.ColumnAlign.LEFT,this.list_itemList.layout=e,this.img_arrow.source="sycx_img_jiantou_png",this.img_arrow.rotation=90,this.img_arrow.bottom=0,this.img_arrow.horizontalCenter=0,this.img_arrow.visible=!1,this.img_arrow.scaleX=this.img_arrow.scaleY=1.2,egret.Tween.get(this.img_arrow,{loop:!0}).to({bottom:10},500).to({bottom:0},500),this.addChild(this.img_arrow),this.sl_root.addEventListener(egret.Event.CHANGE,function(){t.img_arrow.visible=t.sl_root.viewport.scrollV<t.list_itemList.contentHeight-t.sl_root.height},this),this.sl_root.once(egret.Event.ENTER_FRAME,function(){t.img_arrow.visible=t.sl_root.viewport.scrollV<t.list_itemList.contentHeight-t.sl_root.height},this),this.sl_root.height=610},i.prototype.getDataList=function(){var i=this,t=this.info;if(t&&t.data){var e,a=t.data.targeted,n=t.content,o=t.data.curCycle||1;for(var r in n[1])if((d=n[1][r])[0]==o){e=d[1];break}if(!e)return[];for(var s=[],c=0;c<e.length;c++){var d,h=(d=e[c])[0],l=d[1],p=d[2],u=d[3],g=d[4],m=d[5],y=d[6],v=REWARD_STATUS.CANBUY,f=0;for(var r in a){var _=a[r];if(_.id==h){f=_.num;break}}u<=f&&(v=REWARD_STATUS.HASBUY);var A={id:h,tips:f+"/"+u,rewards:l,status:v,costs:p,discount:g,icon:m,title:y,btnFunc:function(t){switch(t.status){case REWARD_STATUS.CANBUY:Utils.Socket.send("activity","BuyExchangeGifts",{code:i.code,giftCode:t.id,num:1}).then(function(t){T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).updateData_View_Reward(i.code,t)});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}var e=T.AppFacade.getInstance().retrieveMediator(T.ActivityMediator.N).getSubView(T.ActivityMediator.SV.MAIN);e&&e.updateResourceBar()}};s.push(A)}return s.sort(function(t,e){return t.id-e.id}),s}},i);function i(){var t=e.call(this)||this;return t.img_arrow=new eui.Image,t.skinName="ActivityThirdDiamondGifts",t}T.ActivityThirdDiamondGifts=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data&&t.data.btnFunc&&t.data.btnFunc(t.data)},this),this.btn_buy.cui_freshCost.left=void 0,this.btn_buy.cui_freshCost.horizontalCenter=0},o.prototype.dataChanged=function(){switch(this.lb_titile.text=this.data.title,this.data.icon&&(this.img_icon.source=this.data.icon+"_png"),this.bm_discount.text=parseInt(this.data.discount)/10+"",this.gp_rewards.removeChildren(),T.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards,.6),this.data.status){case REWARD_STATUS.CANBUY:case REWARD_STATUS.UNAVAILABLE:this.btn_buy.btn_oppr.skinName="skins.ButtonSkinYellow",this.btn_buy.cui_freshCost.visible=!0,this.btn_buy.cui_freshCost.updateItem({cost:this.data.costs[0],style:CommonIconStyle.RIGHT}),this.btn_buy.btn_oppr.label="";break;case REWARD_STATUS.HASBUY:this.btn_buy.cui_freshCost.visible=!1,this.btn_buy.btn_oppr.skinName="skins.ButtonSkinSure",this.btn_buy.btn_oppr.label="已购买"}this.btn_buy.cui_freshCost.blb_num.scaleX=this.btn_buy.cui_freshCost.blb_num.scaleY=1.4},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityThirdDiamondGiftsItem",t}}(game=game||{}),function(T){var e,t=(e=T.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.list_root.itemRenderer=n,this.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params&&t.params.NoNeedWait?t.params&&t.params.cb&&t.params.cb.call(t):(t.btn_open.visible=!1,DragonBoneTools.playOnce({effectName:"common_weixinhongbao",parent:t.gp_main,x:t.gp_main.width/2||0,y:t.gp_main.height/2||0,keep:!1,loop:!1,doneCB:function(){t.params&&t.params.cb&&t.params.cb()}}))},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.btn_open.source="chunjie_btn_kai2_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.btn_open.source="chunjie_btn_kai1_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.btn_open.source="chunjie_btn_kai1_png"},this),this.timer=egret.setInterval(function(){t.updateRecords()},this,5e3)},i.prototype.updateRecords=function(){var t=this.info;if(!t||!t.data)return!1;var e=t.data.records,i=[],a=[];for(var n in e){var o=e[n];a.push(o)}for(var r=0;r<7;r++){var s=Math.floor(Math.random()*(a.length-1));a[s]&&(i.push(a[s]),a.splice(s,1))}i.sort(function(t,e){return t.dt-e.dt}),0<i.length?this.img_bg.visible=!0:this.img_bg.visible=!1,this.list_root.dataProvider=new eui.ArrayCollection(i)},i.prototype.updateView=function(){var e=this,t=this.info;if(!t||!t.data)return!1;var i=T.GameMgr.getInstance().serverTime(),a=JSON.parse(t.content),n=t.data.targeted,o=[],r=new Date(1e3*i);for(var s in r.setHours(0,0,0),o.push(r.getTime()/1e3),a[0]){var c=a[0][s],d=c[0],h=c[1],l=new Date(1e3*i);l.setHours(d[0],d[1],d[2]||0);var p=l.getTime()/1e3,u=new Date(1e3*i);u.setHours(h[0],h[1],h[2]||0);var g=u.getTime()/1e3;o.push(p),o.push(g)}for(var m=!1,y=void 0,v=1,f=0;f<o.length-1;f++)if(i>=o[f]&&i<=o[f+1])if(m=!0,f%2==0)v=0,y=function(){Utils.MsgUtils.addMidMsg("未到领取时间")};else{var _=!1;for(var s in n){var A=n[s];if(A>=o[f]&&A<=o[f+1]){_=!0;break}}y=_?(v=0,function(){Utils.MsgUtils.addMidMsg("未到下次领取时间")}):function(){Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.TimerLuckyMoney}).then(function(t){e.actProxy.updateData_View_Reward(e.code,t,function(){e.hide(),T.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)})})}}m||(v=0,y=function(){Utils.MsgUtils.addMidMsg("活动未开启")}),this.params={cb:y,NoNeedWait:!v},this.updateRecords()},i);function i(){var t=e.call(this)||this;return t.skinName="RedPocketView",t.code=EActivityType.TimerLuckyMoney,t.actProxy.GetActivityInfo(t.code),t}T.ActivityTimerLuckyMoney=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.dataChanged=function(){this.lb_name.text=this.data.name;var t=this.data.rewards,e=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).getInfoByCode(t[0].code);this.lb_rewardName.text=e.info.name,this.lb_rewardName.textColor=COLOR_2_FONT_COLOR[e.info.color],this.lb_num.text="×"+t[0].num},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityTimerLuckyMoneyItem",t}}(game=game||{}),function(h){var e,t=(e=h.ActivityCommonPanel,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.updateView()},i.prototype.updateView=function(){var t,e=h.Config.entranceTimeConfig(),i=[],a=[],n=[];for(var o in e)if(e[o].moduleId!=MODULE.TexanPoker){var r={config:e[o],doneCB:this.hide.bind(this),ishold:!1,isNow:!1,isLock:!1,isAbs:!1,text:""};if(e[o].moduleId==MODULE.TeamArena){var s=Utils.UnlockMgr.checkPass(e[o].moduleId,!1);r.ishold=!0,h.GameMVC.battleZoneArenaPy.getOpenInfo(),r.isNow=!!Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(e[o].timeGaoLiang)[0]).isOpen;var c=JSON.parse(h.Config.constConfig().EliminateTeamArenaDt.constValue)[2],d=(Utils.TimerManager.isOddWeek(),h.GameMVC.battleZoneArenaPy.getOpenInfo());r.isLock=d.isOpen,r.text=0==c?"单周周日00:00~下周周六21:00":"双周周日00:00~下周周六21:00",s.allow?r.isNow?i.push(r):r.isLock?a.push(r):(r.isAbs=!0,n.push(r)):(r.isAbs=!0,n.push(r))}else e[o].moduleId==MODULE.GuildWar?(s=Utils.UnlockMgr.checkPass(e[o].moduleId,!1),r.ishold=!0,h.GameMVC.guildWarPy.getGuildWarStatus(),r.isNow=!!Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(e[o].timeGaoLiang)[0]).isOpen,c=JSON.parse(h.Config.constConfig().GuildWarDt.constValue)[2],Utils.TimerManager.isOddWeek(),d=h.GameMVC.guildWarPy.getOpenInfo(),r.isLock=d.isOpen,r.text=0==c?"单周周日00:00~下周周六21:00":"双周周日00:00~下周周六21:00",s.allow?r.isNow?i.push(r):r.isLock?a.push(r):(r.isAbs=!0,n.push(r)):(r.isAbs=!0,n.push(r))):(s=Utils.UnlockMgr.getOpenInfo(e[o].moduleId)).allow?s.isWillOpenToday&&(s.isOpen?i.push(r):a.push(r)):s.isWillOpenToday&&(r.isAbs=!0,n.push(r))}n.sort(function(t,e){return t.isLock?-1:1}),t=i.concat(a,n),this.list_task.itemRenderer=l,this.list_task.dataProvider=new eui.ArrayCollection(t)},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.TodayActivity,t.py=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N),t.skinName="ActivityTodayShowPanelSkin",t}h.ActivityTodayShowPanel=t;var a,l=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.gp_root.scaleX=this.gp_root.scaleY=.9},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.gp_root.scaleX=this.gp_root.scaleY=1,Utils.UnlockMgr.checkPass(this.data.config.moduleId).allow&&(this.ret&&this.ret.isOpen||this.data.isLock?(this.data.doneCB&&this.data.doneCB(),h.MainJumpConfig.jumpTo(this.data.config.moduleId)):Utils.MsgUtils.addMidMsg("不在活动期限内"))},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.gp_root.scaleX=t.gp_root.scaleY=1},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){this.gp_root.scaleX=this.gp_root.scaleY=1},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){HELP_CONST[t.data.config.moduleId]?PopUpManager.addPopUp({obj:new h.HelpDialog({moduleId:t.data.config.moduleId})}):h.GameMVC.commonMed.showHelpDialog(t.data.config.moduleId)},this)},n.prototype.dataChanged=function(){this.img_bg.source=this.data.config.imgBg+"_png",this.gp_reward.removeChildren();var t=JSON.parse(this.data.config.rewards);for(var e in t){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.5,i.updateData({id:t[e][1],num:0}),this.gp_reward.addChild(i)}if(this.data.ishold)this.lb_day.text=this.data.text;else{this.ret=Utils.UnlockMgr.getOpenInfo(this.data.config.moduleId);var a=this.ret.openTime[0]+":"+this.getTimeStrShow(this.ret.openTime[1]+this.ret.openTime[2]),n=this.ret.endTime[0]+":"+this.getTimeStrShow(this.ret.endTime[1]+this.ret.endTime[2]);this.lb_day.text=this.ret.openDayTip+a+"~"+n}UIActionManager.setAbsGrey(this.gp_root,this.data.isAbs),this.ret&&this.ret.allow&&(this.ret&&this.ret.isOpen||this.data.isNow)&&DragonBoneTools.create("common_rukou",function(t){this.gp_effect.removeChildren(),t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.scaleX=t.scaleY=1,t.animation.play(),this.gp_effect.addChild(t)},this)},n.prototype.getTimeStrShow=function(t){return 0==t?"00":t<10?"0"+t:""+t},n);function n(){var t=a.call(this)||this;return t.ret=void 0,t.skinName="ActivityTodayShowItemSkin",t}}(game=game||{}),function(v){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),v.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),Utils.AssetsMgr.destroyGroup("group_trigger_gifts")},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.CommonResourceBar),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFun&&t.btnFun()},this),DragonBoneTools.create("common_xianshilibao",function(t){t.anchorOffsetX=0,t.anchorOffsetY=0,t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.animation.play(),this.gp_effect.addChildAt(t,0)},this),DragonBoneTools.create("common_xianshilibao",function(t){t.anchorOffsetX=0,t.anchorOffsetY=0,t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.animation.play(),this.gp_effect0.addChildAt(t,0)},this),DragonBoneTools.create("common_shenqihuoyan",function(t){t.x=490,t.y=580,t.animation.play(),this.gp_effect.addChildAt(t,0)},this),DragonBoneTools.create("common_shenqihuoyan",function(t){t.x=210,t.y=580,t.animation.play(),this.gp_effect.addChildAt(t,0)},this),this.initList(),v.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER,{clear:!0})},i.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.list_actItem.itemRenderer=s,this.list_actItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},i.prototype.updateView=function(t){var e=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.CommonResourceBar.updateBar({costs:e,width:190,needAdd:!0}),this.updateTopList()},i.prototype.updateTopList=function(){var a=this,t=this.actProxy.allActivityData[EActivityType.BasicHeroGifts],e=this.actProxy.allActivityData[EActivityType.TriggerGifts];if(t||e){var n=Utils.TimerManager.getServerTime(),o=[];if(e){this.triggerContent=JSON.parse(e.content);var i=JSON.parse(e.data.gifts),r=0;v.GameMgr.getInstance().getOnLineTime(),i.forEach(function(t){for(var e in a.triggerContent[0]){var i=a.triggerContent[0][e];i[0]==t.code&&(r=i[3])}!t.buyDt&&n<t.triggerDt+r&&o.push(t)}),o.sort(function(t,e){return t.triggerDt-e.triggerDt})}t&&t.endDt>n&&(this.heroContent=JSON.parse(t.content),t.data.gifts.forEach(function(t){o.unshift(t)})),o.length<=0?this.hide():(this.curTarget=o[0],this.list_actItem.dataProvider=new eui.ArrayCollection(o),this.updateSelected(this.curTarget))}},i.prototype.perShow=function(){var t=this.actProxy.allActivityData[EActivityType.BasicHeroGifts],e=t&&t.data&&t.data.gifts.length||0,i=this.actProxy.allActivityData[EActivityType.TriggerGifts];return 0<e+(i&&i.data&&JSON.parse(i.data.gifts).length||0)},i.prototype.updateBottomList=function(t){this.curTarget=t,this.curTarget.triggerDt?this.updateTriggerGift():this.updateHeroGift()},i.prototype.updateTriggerGift=function(){var t=this,e=this.triggerContent,i=0,a=[],n=0,o="hero_009_01";for(var r in e[0]){var s=e[0][r];s[0]==this.curTarget.code&&(i=s[1],a=s[2],n=s[3],o=s[5]||o)}this.curTarget.triggerType==TriggerGiftsTriggerType.TeamLevelUp&&this.HeroDynamicModel.update({isStatic:!0,model:o});var c=v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N),d=c.goodList,h=v.ActivityConfig.Config[EActivityType.TriggerGifts];if(h){if(i){var l;for(var p in d){var u=d[p];if(i==u.id){l=u;break}}l?h.formatString.format([l.price]):Utils.MsgUtils.addMidMsg("找不到商品信息");var g=REWARD_STATUS.CANBUY;this.curTarget.buyDt&&(g=REWARD_STATUS.HASBUY),this.gp_reward.removeChildren(),v.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,a),this.btnFun=function(){l?g==REWARD_STATUS.CANBUY?c.purchase(l,2,String(t.curTarget.uuid),JSON.stringify({uuid:t.curTarget.uuid,activityType:EActivityType.TriggerGifts}),{activityType:EActivityType.TriggerGifts}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")},this.btn_buy.label=(l&&l.price*Utils.SDKMgr.globalIAPRate)+Utils.SDKMgr.globalIAPSuffix}this.timer&&egret.clearInterval(this.timer);var m=Utils.TimerManager.getServerTime(),y=this.curTarget.triggerDt+n-m;this.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(y),this.timer=egret.setInterval(function(){0<--y?t.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(y):(egret.clearInterval(t.timer),t.updateView())},this,1e3)}},i.prototype.updateHeroGift=function(){var t=this,e=this.heroContent,i=0,a=[];for(var n in e[0]){var o=e[0][n];o[0]==this.curTarget.code&&(i=o[1],a=o[2])}var r=v.Config.allHeroConfig()[this.curTarget.triggerKey||e[3]];this.HeroDynamicModel.update({isStatic:!0,model:r.model});var s=v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N),c=s.goodList,d=v.ActivityConfig.Config[EActivityType.BasicHeroGifts];if(d){if(i){var h;for(var l in c){var p=c[l];if(i==p.id){h=p;break}}h?d.formatString.format([h.price]):Utils.MsgUtils.addMidMsg("找不到商品信息");var u=REWARD_STATUS.CANBUY;if(this.curTarget.buyDt&&(u=REWARD_STATUS.HASBUY),this.gp_reward.removeChildren(),this.curTarget.triggerKey){var g=customui.BaseItemFactory.create({code:this.curTarget.triggerKey});g.scaleX=g.scaleY=.8,this.gp_reward.addChild(g)}v.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,a),this.btnFun=function(){h?u==REWARD_STATUS.CANBUY?s.purchase(h,2,String(t.curTarget.uuid),JSON.stringify({uuid:t.curTarget.uuid,activityType:EActivityType.BasicHeroGifts}),{activityType:EActivityType.BasicHeroGifts}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")},this.btn_buy.label=(h&&h.price*Utils.SDKMgr.globalIAPRate)+Utils.SDKMgr.globalIAPSuffix}this.timer&&egret.clearInterval(this.timer);var m=Utils.TimerManager.getServerTime(),y=v.ActivityConfig.getActivityEndDt(EActivityType.BasicHeroGifts)-m;this.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(y),this.timer=egret.setInterval(function(){0<y?t.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(--y):(egret.clearInterval(t.timer),t.updateView())},this,1e3)}},i.prototype.onItemTap=function(t){this.updateSelected(t.item)},i.prototype.updateSelected=function(t){var e=this.list_actItem.dataProvider,i=e.source;for(var a in i){var n=i[a];n.chosen=n.uuid==t.uuid}e.replaceAll(i),this.updateBottomList(t),this.updateTitle()},i.prototype.updateTitle=function(){this.curTarget?(this.gp_content.visible=!0,this.gp_level.visible=!1,this.gp_hero.visible=!1,this.gp_heroGift.visible=!1,this.curTarget.triggerType==TriggerGiftsTriggerType.HeroUpStar?(this.gp_hero.visible=!0,this.HeroDynamicModel.update({code:this.curTarget.triggerKey,isStatic:!0})):this.curTarget.triggerType==TriggerGiftsTriggerType.TeamLevelUp?(this.gp_level.visible=!0,this.bm_tip.text=this.curTarget.triggerKey):this.gp_heroGift.visible=!0):this.gp_content.visible=!1},i.prototype.perClose=function(){this.gp_effect.removeChildren(),this.gp_effect0.removeChildren()},i);function i(){var t=e.call(this)||this;return t.actProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t.backpackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),t.curTarget=void 0,Utils.AssetsMgr.loadGroup("group_trigger_gifts"),t.skinName="ActivityTriggerGiftsViewSkin",t}v.ActivityTriggerGiftsView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},o.prototype.dataChanged=function(){var n=this,t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_title.text=t.title||"",this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.CANBUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.HASBUY:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1}var e=JSON.parse(t.rewards);for(var i in this.gp_rewards.$children){var a=this.gp_rewards.$children[i];a&&(a.visible=!1)}e.forEach(function(t,e){n.gp_rewards.$children[e]||n.gp_rewards.addChild(customui.BaseItemFactory.create());var i=n.gp_rewards.$children[e];if(i.scaleX=i.scaleY=.7,i.visible=!0,t[0]==EEntityType.EEntityTypeHeroArtifact||t[0]==EEntityType.EEntityTypeHeroEquip){var a={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:t,vo:a})}else i.updateData({reward:t})}),this.btnFunc=t.btnFunc},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityCommonListItemSkin",t}var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.dataChanged=function(){this.data.triggerType==TriggerGiftsTriggerType.TeamLevelUp?(this.img_icon.source="huodong_icon_xianshilibao_png",this.bm_title.text="限时礼包"):this.data.triggerType==TriggerGiftsTriggerType.HeroUpStar?(this.bm_title.text="成长礼包",this.img_icon.source="huodong_icon_chengzhanglibao_png"):(this.bm_title.text="英雄礼包",this.img_icon.source="huodong_icon_yxlb_png"),this.updateSelected()},c.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},c);function c(){var t=r.call(this)||this;return t.oldY=-5,t.oldId=0,t.activityProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t.skinName="ActivityRootPanel_ActivityItem",t}}(game=game||{}),function(a){var e,t=(e=a.ActivityCommonListView,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_vip_gift")},i.prototype.initList=function(){this.list_itemList.itemRenderer=o},i.prototype.getDataList=function(){var o=this;if(!this.info)return[];function t(t){var e=c[t];if(!e.level||e.level>d+3)return"continue";var i=REWARD_STATUS.CANBUY;h[e.level]&&(i=REWARD_STATUS.HASBUY),e.level>d&&(i=REWARD_STATUS.UNAVAILABLE_BUY);var a=JSON.parse(e.costs),n={id:e.level,title:"VIP"+e.level+"礼包",status:i,rewards:e.gifts,discount:e.discount,cost:a[0],btnFunc:function(){switch(n.status){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:s.GetVipLevelGift(e.level,function(){o.updateView(void 0)});break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}};r.push(n)}var r=[],s=a.AppFacade.getInstance().retrieveProxy(a.RechargePy.N),c=a.Config.VIPUpgradeConfig(),e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N).playerInfoVO.playerVip,d=e.vipLevel||0,h=e.vipGiftGot;for(var i in c)t(i);return r.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),r},i.prototype.updateTitle=function(){var t=a.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code],t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.bm_time.text=""},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.VipLevelGift,Utils.AssetsMgr.loadGroup("group_vip_gift"),t}a.ActivityVipGift=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var t=this.btn_operate.cui_freshCost.img_icon;t&&(t.scaleX=t.scaleY=.9),this.btn_operate.btn_oppr.skinName="skins.ButtonSkinYellow"},r.prototype.dataChanged=function(){var n=this,t=this.data;switch(this.img_bg.source=t.bg||this.img_bg.source,this.lb_title.text=t.title||"",this.lb_tips.text=t.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:this.btn_operate.visible=!0,this.btn_buy.visible=!1,UIActionManager.setGrey(this.btn_operate,!0);break;case REWARD_STATUS.CANBUY:case REWARD_STATUS.AVAILABLE:this.btn_operate.visible=!0,this.btn_buy.visible=!1,UIActionManager.setGrey(this.btn_operate,!1);break;case REWARD_STATUS.HASBUY:case REWARD_STATUS.RECEIVED:this.btn_operate.visible=!1,this.btn_buy.visible=!0,this.btn_buy.enabled=!1,UIActionManager.setAbsGrey(this.btn_buy,!0)}var e=JSON.parse(t.rewards);this.gp_rewards.removeChildren(),e.forEach(function(t,e){var i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.7,t[0]==EEntityType.EEntityTypeHeroArtifact||t[0]==EEntityType.EEntityTypeHeroEquip){var a={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:t,vo:a})}else i.updateData({reward:t});n.gp_rewards.addChild(i)}),this.btnFunc=t.btnFunc,this.data.discount?(this.gp_discount.visible=!0,this.bm_discount.text=this.data.discount/10+"",this.data.cost?(this.CommonIconWithNum.updateItem({type:this.data.cost[0],code:this.data.cost[1],num:this.data.cost[2]/this.data.discount*100,style:CommonIconStyle.RIGHT}),this.CommonIconWithNum.visible=!0):this.CommonIconWithNum.visible=!1):(this.gp_discount.visible=!1,this.CommonIconWithNum.visible=!1),this.data.cost&&(this.btn_operate.cui_freshCost.updateItem({cost:this.data.cost,style:CommonIconStyle.RIGHT}),this.btn_operate.cui_freshCost.left=void 0,this.btn_operate.cui_freshCost.horizontalCenter=0),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate)},r);function r(){var t=n.call(this)||this;return t.skinName="ActivityVipGiftItemSkin",t}}(game=game||{}),function(y){var v,t=(v=y.ActivityCommonPanel,__extends(e,v),e.prototype.childrenCreated=function(){var t=this;v.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this),this.btn_buy.btn_oppr.skinName="skins.ButtonSkinYellow",this.heroModel.update({code:41150066,isStatic:!0})},e.prototype.updateView=function(t){var e=this;v.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=JSON.parse(i.content)[0],n=i.data[0]&&i.data[0].times||0,o=a[0],r=a[1],s=a[2],c=a[3];this.gp_rewards.removeChildren(),y.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,c),this.updateTitle(),this.img_topVip.source="thhk"+r+"_png";var d=y.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,h=REWARD_STATUS.UNAVAILABLE;r<=d&&(h=REWARD_STATUS.AVAILABLE);for(var l=0;l<3;l++){var p=s[l];this.updateDiscount(l,parseInt(p[2]))}var u=void 0;for(var g in s){var m=s[g];if(m[0]==n+1){u=m;break}}switch(u||(h=REWARD_STATUS.RECEIVED),this.lb_vip.text="vip"+r+"及以上即可购买",h){case REWARD_STATUS.UNAVAILABLE:this.btn_buy.updateData({text:"前往充值"}),this.updateRightDiscount(s[0]),this.btnFunc=function(){Utils.MsgUtils.addMidMsg("vip等级不足，请升级vip再进行购买")},this.btn_buy.updateData({text:"购买",cost:s[0][1][0]});break;case REWARD_STATUS.AVAILABLE:this.updateRightDiscount(u),u[2]?this.btn_buy.updateData({text:"购买",cost:u[1][0]}):this.btn_buy.updateData({text:"领取"}),this.btnFunc=function(){y.GameMVC.backpackPy.checkEnough(u[1],!1)?e.getReward({id:o,num:n+1,code:e.code}):Utils.MsgUtils.addMidMsg("货币不足")};break;case REWARD_STATUS.RECEIVED:this.hide(),y.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}}},e.prototype.updateRightDiscount=function(t){this.gp_rightDiscount.visible=!!t,t[2]?(this.img_rightFree.visible=!1,this.img_rightDiscount.visible=!0,this.bm_curDiscount.text=t[2]+""):(this.img_rightFree.visible=!0,this.img_rightDiscount.visible=!1,this.bm_curDiscount.text="")},e.prototype.updateDiscount=function(t,e){var i=this["bm_discount"+t],a=this["img_free"+t],n=this["gp_discount"+t];e?(a&&(a.visible=!1),n&&(n.visible=!0),i&&(i.visible=!0),i&&(i.text=e)):(a&&(a.visible=!0),n&&(n.visible=!1),i&&(i.visible=!1))},e.prototype.updateTitle=function(){var t=this,e=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.lb_time.text="";else if(e&&this.lb_time){var i=y.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.lb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?t.lb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):y.AppFacade.getInstance().hideSubView(y.ActivityMediator.N,y.ActivityMediator.SV.MAIN)},this,1e3)}},e);function e(){var t=v.call(this)||this;return t.skinName="ActivityVipPreferentialGift",t}y.ActivityVipPreferentialGift=t}(game=game||{}),function(o){var r,t=(r=o.ActivityCommonView,__extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=t.content;o.MainJumpConfig.jumpTo(e[1])}},this)},e.prototype.updateView=function(t){var e=this;r.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a=i.content;this.img_bg.source=a[0]+"_png",this.timer&&egret.clearInterval(this.timer);var n=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer=egret.setInterval(function(){0<--n?e.bm_time.text=Utils.TimerManager.getFormatBySecond1(n):o.GameMVC.activityMed.updateView(o.ActivityMediator.SV.MAIN)},this,1e3)}},e);function e(){var t=r.call(this)||this;return t.skinName="ActivityWchessShow",t}o.ActivityWchessShow=t}(game=game||{}),function(s){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._activateComponent()},i.prototype.updateView=function(t){var e=t&&t.type;this.customCB=t&&t.customCB,this.doneCB=t&&t.doneCB,this.canleCB=t&&t.canleCB;var i=Utils.SDKMgr.getPerformConfig(10018),a=(this.lb_hint.visible=i)?s.Config.operationConfig()[OperationType.Act_Share]:this.acProxy.allActivityData[this.code];if(i)return this.img_bg.source="fenxiang_img_fenxiang06_png",this.rewards=JSON.parse(a.reward),void s.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.rewards);if(a)for(var n=0,o=JSON.parse(a.content);n<o.length;n++){var r=o[n];if(r[1][0]==e){(this.targetInfo=r)[3]&&""!=r[3]&&(this.img_bg.source=ResourceUtils.png(r[3])),r[4]&&""!=r[4]&&(this.img_bg.source=ResourceUtils.png(r[4])),this.rewards=r[2],s.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.rewards);break}}},i.prototype._activateComponent=function(){this.gp_wetchat_tips.visible=!1,this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SDKMgr.getPerformConfig(10018))if(Utils.SDKMgr.getPerformConfig(10021)&&"WX"==getUrlKV().channel)this.gp_wetchat_tips.visible=!0;else{var t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);Utils.SDKMgr.share({recommendId:t.roleVo.playerId,recommendPlatform:Utils.agentConfig.AgentCode+"#"+this.acProxy.gamePlatform,content:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],sceneId:this.targetInfo&&this.targetInfo[1][0]||0},function(t){0==t&&(s.GameMVC.activityPy.getOperationReward(OperationType.Act_Share),Utils.MsgUtils.addMidMsg("分享成功"))})}else this.acProxy.WeChatShare({sceneId:this.targetInfo[1][0],id:this.targetInfo[1][0],customCB:this.customCB,doneCB:this.doneCB})},this)},i.prototype.perClose=function(){this.canleCB&&this.canleCB()},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.WeChatShare,t.skinName="ActivityWeChatShareCommonPanelSkin",t.acProxy=s.AppFacade.getInstance().retrieveProxy(s.ActivityPy.N),t}s.ActivityWeChatShareCommonPanel=t}(game=game||{}),function(u){var t,e=(t=u.ActivityCommonListView,__extends(i,t),i.prototype.getDataList=function(){var d=this,t=this.info,e=(JSON.parse(t.content),t.content);if(!e)return Utils.MsgUtils.addMidMsg("找不到配置"),[];var h=[],l=u.GameMVC.rechargePy.goodList,p=t.data.giftTargeted;e[0].forEach(function(t){var e=t[0],i=t[1],a=t[2],n=t[3],o=0;p&&p.forEach(function(t){t[0]==e&&(o=t[1])});var r=REWARD_STATUS.CANBUY;n<=o&&(r=REWARD_STATUS.HASBUY);var s=void 0;l.forEach(function(t){t.id==i&&(s=t)});var c={id:e,title:""+(s&&s.price*Utils.SDKMgr.globalIAPRate)+Utils.SDKMgr.globalIAPSuffix+"礼包",tips:o+"/"+n,status:r,rewards:a,type:1,btnFunc:function(){r==REWARD_STATUS.CANBUY?u.GameMVC.rechargePy.purchase(s,2,e,JSON.stringify({activityType:d.code,uuid:e}),{activityType:d.code,uuid:e}):Utils.MsgUtils.addMidMsg("已购买")}};h.push(c)});var o=t.data.amounts,r=t.data.rechargeTargeted;return e[1].forEach(function(t){var e=t[0],i=t[1],a=REWARD_STATUS.UNAVAILABLE;0<=r.indexOf(e)?a=REWARD_STATUS.RECEIVED:e<=o&&(a=REWARD_STATUS.AVAILABLE);var n={id:e,title:"累充"+e*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,tips:o+"/"+e,status:a,rewards:i,type:2,btnFunc:function(){d.getReward({code:d.code,id:e,num:e})}};h.push(n)}),h.sort(function(t,e){return t.type!=e.type?t.type-e.type:t.status!=e.status?t.status-e.status:t.id-e.id}),h},i);function i(){return null!==t&&t.apply(this,arguments)||this}u.ActivityWishGifts=e}(game=game||{}),function(c){var r,t=(r=c.ActivityCommonView,__extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this);for(var t=0;t<9;t++){var e=new a;this.boxs1.push(e),e.x=this.boxPosi1[t][0],e.y=this.boxPosi1[t][1],this.gp_box0.addChild(e)}for(t=0;t<5;t++)e=new a,this.boxs2.push(e),e.horizontalCenter=0,e.y=this.boxPosi2[t][1],this.gp_box1.addChild(e);this.btn_devote.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=JSON.parse(t.content)[4];PopUpManager.addPopUp({obj:new c.UsePropPanel({code:e[1][0][1],btnText:"祈愿",btnFunc:function(t){Utils.Socket.send("activity","ZoneDevoteGoods",{id:1,num:t.num}).then(function(t){c.GameMVC.activityPy.updateData_View_Reward(i.code,t)})}})})}},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"ZoneDevoteGoods"})},this)},e.prototype.updateView=function(t){var n=this;if(r.prototype.updateView.call(this,t),this.hasGetInfo){this.hideLines();var e=this.info;if(e&&e.data){var i=e.data,a=JSON.parse(e.content);this.getDataList(i.grade,i.targeted,a[1],function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:n.getRewards(t.id,"GetZoneDevoteGooddsTargeted",1);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewards,type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}}).forEach(function(t,e){var i=n.boxs1[e];if(t.type=1,i&&i.update(t),t.status==REWARD_STATUS.RECEIVED||t.status==REWARD_STATUS.AVAILABLE){var a=n["img_line1_"+e];a&&(a.visible=!0)}}),this.getDataList(i.totalGrade,i.zoneTargeted,a[2],function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:n.getRewards(t.id,"GetZoneDevoteGooddsZoneTargeted",2);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewards,type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}}).forEach(function(t,e){var i=n.boxs2[e];if(t.type=2,i&&i.update(t),t.status==REWARD_STATUS.RECEIVED||t.status==REWARD_STATUS.AVAILABLE){var a=n["img_line2_"+e];a&&(a.visible=!0)}}),this.updateTimer();var o=a[4];this.CommonResourceBar.updateBar({costs:o[1],needAdd:!0,wayFunc:function(){var t=c.AppFacade.getInstance().retrieveMediator(c.ShopyMediator.N),e=c.GameMVC.backpackPy.getInfoByCode(o[1][0][1]);t.showSubView(c.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:o[1],costs:o[0],countFun:function(t){return{unit:o[0][0][2],total:o[0][0][2]*t}},name:e.info.name},maxCount:99999999,buyNum:0,btnLabel:"购买",costTip:"购买消耗",limitTip:"购买次数",doneCB:function(t){Utils.Socket.send("activity","ZoneDevoteGoodsBuy",{num:t.num||0}).then(function(t){n.backpackProxy.handleClientReward(t.clientReward),NoticeManager.updateNotice(NT.ALL_ACTIVITY[n.code]),n.updateView()})}})}})}}else this.hasTry2Get||(this.hasTry2Get=!0,this.actProxy.GetActivityInfo(this.code,function(){n.hasGetInfo=!0,n.updateView()}))},e.prototype.hideLines=function(){this.gp_lines1.$children.forEach(function(t){t.visible=!1}),this.gp_lines2.$children.forEach(function(t){t.visible=!1})},e.prototype.updateTimer=function(){var t=this,e=c.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(e),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=e--?t.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(e):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},this,1e3)},e.prototype.getRewards=function(e,t,i,a){var n=this;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,3e3),Utils.Socket.send("activity",t,{grade:e}).then(function(t){n.handleReward(t,i,e),a&&a(t)})},e.prototype.handleReward=function(o,r,s){return __awaiter(this,void 0,void 0,function(){var e,i,a,n;return __generator(this,function(t){switch(t.label){case 0:for(a in e=this.boxs1,2==r&&(e=this.boxs2),i=[],e)(n=e[a])&&n.params&&n.params.status==REWARD_STATUS.AVAILABLE&&n.params.id==s&&i.push(n.playEffect());return[4,Promise.all(i)];case 1:return t.sent(),GameRootLayer.gameLayer().switchTouchEnable(!0),c.GameMVC.activityPy.updateData_View_Reward(this.code,o),[2]}})})},e.prototype.getDataList=function(t,e,i,a){this.info;var n=[];for(var o in i){var r=i[o],s=r[0],c=r[1],d=REWARD_STATUS.UNAVAILABLE;s<=t&&(d=REWARD_STATUS.AVAILABLE),0<=e.indexOf(s)&&(d=REWARD_STATUS.RECEIVED);var h={id:s,key:t,status:d,rewards:c,btnFunc:a};n.push(h)}return n},e);function e(){var t=r.call(this)||this;return t.boxs1=[],t.boxs2=[],t.boxPosi1=[[40,20],[140,100],[220,30],[290,130],[190,220],[80,200],[40,320],[160,360],[300,290]],t.boxPosi2=[[0,0],[0,92.5],[0,185],[0,277.5],[0,370]],t.hasTry2Get=!1,t.hasGetInfo=!1,t.skinName="ActivityZoneDevoteGoods",t}c.ActivityZoneDevoteGoods=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params&&t.params.btnFunc&&t.params.btnFunc(t.params)},this)},n.prototype.playEffect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.img_bg.source=1==this.params.type?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang4_png",this.effectObj.forEach(function(t){t.visible=!1}),[4,DragonBoneTools.playOnce({effectName:"common_jxbaoxiangkai",parent:this.gp_effect,x:this.width/2,y:this.height/2,doneCB:function(){}})];case 1:return t.sent(),[2]}})})},n.prototype.update=function(t){var e=this,i=(this.params=t).key,a=t.id;switch(this.bm_cur.text=i,this.bm_max.text="/"+a,egret.Tween.removeTweens(this.img_bg),this.effectObj.forEach(function(t){t.visible=!1}),t.status){case REWARD_STATUS.UNAVAILABLE:this.img_bg.source=1==t.type?"jjqy_img_baoxiang1_png":"jjqy_img_baoxiang3_png",this.bm_cur.visible=this.bm_max.visible=!0,this.bm_cur.font="white_num_fnt";break;case REWARD_STATUS.AVAILABLE:this.img_bg.source="",0<this.effectObj.length?this.effectObj.forEach(function(t){t.visible=!0}):(this.addEffect(this,"common_jxbaoxiangdg",{childIndex:0,offectY:-10},function(t){e.effectObj.push(t)}),this.addEffect(this.gp_effect,1==t.type?"common_jxbaoxiang_1":"common_jxbaoxiang_2",{},function(t){e.effectObj.push(t)})),this.bm_cur.visible=this.bm_max.visible=!0,this.bm_cur.font="green_num_fnt";break;case REWARD_STATUS.RECEIVED:this.img_bg.source=1==t.type?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang4_png",this.bm_cur.visible=this.bm_max.visible=!1}},n.prototype.addEffect=function(e,t,i,a){DragonBoneTools.create(t,function(t){t.x=e.width/2+(i&&i.offectX||0),t.y=e.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(t.scaleX=i.scaleX),i.scaleY&&(t.scaleY=i.scaleY)),i.childIndex||0==i.childIndex?e.addChildAt&&e.addChildAt(t,i.childIndex):e.addChild&&e.addChild(t),t.animation.play(),a&&a(t)},this)},n);function n(){var t=i.call(this)||this;return t.effectObj=[],t.skinName="ActivityZoneDevoteGoodsItem",t}}(game=game||{}),function(u){var i,t=(i=BasePanel,__extends(g,i),g.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.skinName="BraveBookRewardsSkin",this.tck_tck.blb_title.text="令状奖励",this.tck_tck.onCloseCB=function(){t.hide()};var e=new eui.VerticalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,e.gap=6,e.paddingLeft=e.paddingRight=6,e.paddingTop=6,this.list=new eui.List,this.list.layout=e,this.list.itemRenderer=a,this.sl_list.viewport=this.list,this.sl_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_list.addEventListener(egret.Event.CHANGE,this.ScrollSpecialItem,this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.taskPy.getNewBraveLevelReward({levels:t.canGetList,cb:function(){t.updateView(),u.AppFacade.getInstance().retrieveMediator(u.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)}})},this)},g.prototype.buttomView=function(){var t=u.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook],e=u.Config.newBraveBookLevelConfig(t&&t.content[4]),i=0;for(var a in e)i++;var n=this.taskPy.newBraveBookTask.levelTargeted;n.sort(function(t,e){return 0<t-e?-1:1});for(var o=n[0]==i?i:(n[0]?n[0]:0)+1;o<=i;o++){var r=e[o];if(1==r.isShow&&1==r.isRare){this.lb_reward_tip.text="勇士等级达到"+r.level+"级带我回家哦！";break}}},g.prototype.ScrollSpecialItem=function(){var t=this.list.scrollV,e=(this.list.$children,t/126);this.scrollerIndex=5+e,this.scrollerIndex>=this.commonArr.length-1&&(this.scrollerIndex=this.commonArr.length-1),this.scrollerIndex<=0&&(this.scrollerIndex=0),this.commonArr[e];var i=Math.floor(this.scrollerIndex),a=this.specialArr[0],n=this.commonArr[i];for(var o in this.specialArr){var r=this.specialArr[o];if(a&&n.level>=a.level&&n.level<=r.level){this.curSpe.level!=r.level&&(this.curSpe=r,this.showSpecialItem(r));break}a=r}},g.prototype.showSpecialItem=function(t){var e=t;this.lb_spLevel.text=""+e.level;var i=JSON.parse(e.rewards);this.gp_speItems.removeChildren();for(var a=0,n=i;a<n.length;a++){var o=n[a],r=customui.BaseItemFactory.create(21);r.updateData({type:o[0],code:o[1],num:o[2]}),r.scaleX=.75,r.scaleY=.75,this.gp_speItems.addChild(r)}},g.prototype.updateView=function(t){this.params=t,this.params&&this.params.doneCB&&(this.doneCB=this.params.doneCB),this.buttomView(),this.rewardlistsView();var e=u.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook];this.img_title.source=e.content[5]+"_png"},g.prototype.rewardlistsView=function(){var t=this.taskPy.newBraveBookTask.level,e=(this.taskPy.newBraveBookTask.levelTargeted,g.isInit?0:this.curPID),i=1e3*e+1,a=1e3*(Math.floor(t/1e3)+1),n=u.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook],o=u.Config.newBraveBookLevelConfig(n&&n.content[4]),r=(u.AppFacade.getInstance().retrieveProxy(u.ActivityPy.N),!1),s=u.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook].data;this.commonArr=[],this.canGetList=[];for(var c=i;o[c];++c){var d=o[c];if(d.rewards&&""!=d.rewards){var h=this.taskPy.newBraveBookTask.levelTargeted&&-1!=this.taskPy.newBraveBookTask.levelTargeted.indexOf(d.level),l={rewards:d.rewards,current:t,level:d.level,exp:d.exp,isTarget:h,canGet:d.level<=t,sortKey:d.level<=t&&h,isEffect:d.isRare,isGrey:!(s&&s.isBuy&&!h&&d.level<=t)};1==d.isShow2&&this.specialArr.push(l),this.commonArr.push(l),d.level<=t&&!h&&(this.canGetList.push(d.level),r=!0,this.curPID=e)}if(!r&&a<d.level&&(e+=1,this.commonArr=[],this.specialArr=[]),a<=d.level)break}this.specialArr.sort(function(t,e){return t.sortKey!=e.sortKey?t.sortKey-e.sortKey:0<e.level-t.level?-1:1}),this.curSpe=this.specialArr[0],this.showSpecialItem(this.specialArr[0]),this.commonArr.sort(function(t,e){return t.sortKey!=e.sortKey?t.sortKey-e.sortKey:0<e.level-t.level?-1:1});var p=this.list.dataProvider;p?p.replaceAll(this.commonArr):this.list.dataProvider=new eui.ArrayCollection(this.commonArr),UIActionManager.setAbsGrey(this.btn_get,!r),g.isInit&&(g.isInit=!1)},g.prototype.perClose=function(){this.doneCB&&this.doneCB()},g.isInit=!0,g);function g(){var t=null!==i&&i.apply(this,arguments)||this;return t.specialArr=[],t.commonArr=[],t.canGetList=[],t.scrollerIndex=0,t.curPID=0,t.taskPy=u.AppFacade.getInstance().retrieveProxy(u.TaskPy.N),t}u.BraveBookRewardsView=t;var e,a=(e=eui.ItemRenderer,__extends(n,e),n.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.current>=t.data.level&&(!t.taskPy.newBraveBookTask.levelTargeted||-1==t.taskPy.newBraveBookTask.levelTargeted.indexOf(Number(t.data.level)))?t.taskPy.getNewBraveLevelReward({levels:[Number(t.data.level)],cb:function(){u.AppFacade.getInstance().retrieveMediator(u.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook),u.AppFacade.getInstance().updateView(u.BraveBookMediator.N,u.BraveBookMediator.SV.BRAVEBOOKREWARDS)}}):Utils.MsgUtils.addMidMsg("已领取该奖励")},this)},n.prototype.dataChanged=function(){var t=this.data;this.lb_desc.text="勇士令状达到等级"+t.level+"可获取奖励";var e=t.current>t.level?t.level:t.current;this.lb_pro.text=e+"/"+t.level;var i=JSON.parse(t.rewards);this.gp_items.removeChildren();for(var a=0,n=i;a<n.length;a++){var o=n[a],r=customui.BaseItemFactory.create(21);r.updateData({type:o[0],code:o[1],num:o[2],effect:this.data.isEffect,effectParam:{effectName:"common_jiban",scale:1.5}}),r.scaleX=.65,r.scaleY=.65,this.gp_items.addChild(r)}this.btn_get.visible=!0,this.btn_get.touchEnabled=!0,this.btn_got.visible=!1,this.btn_got.touchEnabled=!0,UIActionManager.setGrey(this.btn_get,this.data.isGrey),t.current>=t.level&&t.canGet&&!t.isTarget?this.btn_get.label="领取":t.canGet&&t.isTarget?(this.btn_got.touchEnabled=!1,this.btn_get.touchEnabled=!1,this.btn_get.visible=!1,this.btn_got.visible=!0):(this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0))},n);function n(){var t=e.call(this)||this;return t.taskPy=u.AppFacade.getInstance().retrieveProxy(u.TaskPy.N),t.skinName="BraveRewardItemNewSkin",t}}(game=game||{}),function(h){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list_items.itemRenderer=n},i.prototype.updateView=function(t){t&&this.shopItems(t)},i.prototype.shopItems=function(t){var e=t.info,i=h.AppFacade.getInstance().retrieveProxy(h.RechargePy.N).goodList,a=[];if(Array.isArray(e)&&0<e.length)for(var n in e){var o=e[n],r=void 0;for(var s in i){var c=i[s];if(c.id==o[0]){r=c;break}}a.push({level:o[1],id:Number(n)+1,buyInfo:r})}var d=this.list_items.dataProvider;d?d.replaceAll(a):this.list_items.dataProvider=new eui.ArrayCollection(a)},i);function i(){var t=e.call(this)||this;return t.skinName="BraveBookShopSkin",t}h.BraveBookShopView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.taskPy.nextBraveBook=0,h.AppFacade.getInstance().retrieveProxy(h.RechargePy.N).purchase(t.data.buyInfo)},this)},o.prototype.dataChanged=function(){this.img_item_icon.source="_yslz_m_json.yslz_img_ysdj"+this.data.id,this.lb_level.text="提升"+this.data.level+"级",this.lb_price.text=""+this.data.buyInfo.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix;var t=h.AppFacade.getInstance().retrieveProxy(h.TaskPy.N).braveBookTask.level,e=h.Config.braveBookLevelConfigs();this.touchEnabled=e[t+1],this.touchChildren=e[t+1],UIActionManager.setAbsGrey(this.gp_root,!e[1+t])},o);function o(){var t=a.call(this)||this;return t.taskPy=h.AppFacade.getInstance().retrieveProxy(h.TaskPy.N),t.skinName="BraveBookShopItemSkin",t}h.BraveBookShopItem=n}(game=game||{}),function(d){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var a=this;e.prototype.childrenCreated.call(this),this.list_items.itemRenderer=n,this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=d.AppFacade.getInstance().retrieveProxy(d.ActivityPy.N).allActivityData[EActivityType.NewBraveBook],e=t.data,i=t.content[3];i=i&&i==TaskType.NewNewBraveBook?TaskType.NewNewBraveBook:TaskType.NewBraveBook,e&&e.isBuy&&i==TaskType.NewNewBraveBook||i==TaskType.NewBraveBook?d.AppFacade.getInstance().retrieveProxy(d.TaskPy.N).GetTaskAllReward(i,function(){a.updateView({all:!0})},{unresetChapter:!0,id:a.data[0].sectionCode,sectionCode:a.data[0].sectionCode}):Utils.MsgUtils.addMidMsg("请激活令状！")},this)},i.prototype.updateView=function(t){if(t){if(t.data&&(this.data=t.data,this.canGetNum=t.canGetNum),t.code)for(var e in this.data)this.data[e].code==t.code&&(this.data[e].isTarget=!0,--this.canGetNum);if(t.all)for(var e in this.data)this.data[e].canGet&&!this.data[e].isTarget&&(this.data[e].isTarget=!0,--this.canGetNum);var i=this.data,a=this.list_items.dataProvider;a?a.replaceAll(i):this.list_items.dataProvider=new eui.ArrayCollection(i)}var n=this.canGetNum<=0;this.btn_get.touchEnabled=!n,UIActionManager.setAbsGrey(this.btn_get,n)},i);function i(){var t=e.call(this)||this;return t.canGetNum=0,t.skinName="BravebookTasksSkin",t}d.BravebookTasksView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapCallBack,this)},o.prototype.tapCallBack=function(){var t=this;if(!this.data.isTarget)if(this.data.canGet){var e=d.AppFacade.getInstance().retrieveProxy(d.ActivityPy.N).allActivityData[EActivityType.NewBraveBook].data,i=this.data.type;e&&e.isBuy&&i==TaskType.NewNewBraveBook||i==TaskType.NewBraveBook||this.data.canSkipBuy?d.AppFacade.getInstance().retrieveProxy(d.TaskPy.N).GetTaskReward(this.data.type,this.data.code,function(){d.GameMVC.activityMed.updateViewByCode(EActivityType.NewBraveBook,{updateTaskP:!0,code:t.data.code,sectionCode:t.data.sectionCode})},{unresetChapter:!0,code:this.data.code,sectionCode:this.data.sectionCode}):Utils.MsgUtils.addMidMsg("请激活令状！")}else if(this.data.jumpModule){if(!Utils.UnlockMgr.checkPass(this.data.jumpModule).allow)return;d.MainJumpConfig.jumpTo(this.data.jumpModule)}else Utils.MsgUtils.addMidMsg("无跳转途径")},o.prototype.dataChanged=function(){this.gp_items.removeChildren();for(var t=this.data,e=0,i=JSON.parse(this.data.rewards);e<i.length;e++){var a=i[e],n=customui.BaseItemFactory.create(21);n.updateData({type:a[0],code:a[1],num:a[2]}),n.scaleX=.65,n.scaleY=.65,this.gp_items.addChild(n)}var o=this.data.current>this.data.total?this.data.total:this.data.current,r=this.data.total;this.data.subType==TaskSubType.ArenaChallengeRank&&(o=this.data.canGet?1:0,r=1),this.lb_desc.textFlow=[{text:t.desc+"("},{text:""+o,style:{textColor:3407662}},{text:"/"+r+")"}];var s=d.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook].data,c=!(s&&s.isBuy&&this.data.type==TaskType.NewNewBraveBook||this.data.type==TaskType.NewBraveBook||this.data.canSkipBuy)&&t.canGet&&!t.isTarget;UIActionManager.setGrey(this.btn_get,c),this.btn_get.visible=!0,this.btn_got.visible=!1,this.btn_got.touchEnabled=!0,t.canGet&&!t.isTarget?(this.btn_get.label="领取",c||UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:.9,scaleY:.9})):(t.canGet&&t.isTarget?(this.btn_got.touchEnabled=!1,this.btn_get.touchEnabled=!1,this.btn_get.visible=!1,this.btn_got.visible=!0):this.btn_get.label="前往",UIActionManager.hideEffect(this.btn_get))},o);function o(){var t=a.call(this)||this;return t.skinName="BraveBookTaskItem2Skin",t}d.BravebookTaskItem=n}(game=game||{}),function(i){var e,t=(e=BasePanel,__extends(a,e),a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_buxiu_baoxiang")},a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.type=EActivityType.BraveBook,this.actProxy.isOpen(EActivityType.NewBraveBook)&&(this.type=EActivityType.NewBraveBook),this.actList=this.actProxy.allActivityData[this.type].content[1],DragonBoneTools.create("common_buxiudebaozang_1",function(t){t.x=this.effect_2.width/2,t.y=this.effect_2.height/2,t.animation.play(),this.effect_2.addChild(t)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(t){t.x=this.effect.width/2,t.y=this.effect.height/2,t.animation.play(),this.effect_2.addChild(t)},this),this.inintButton(),this.initConfig(),this.initView()},a.prototype.initView=function(){this.list=new eui.List,this.list.itemRenderer=o;var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,this.list.layout=t;var e=[];for(var i in this.actList[1][1]){var a=this.actList[1][1][i];e.push({type:a[0],model:a[1],num:a[2],xiyou:a[4],code:i})}this.list.dataProvider=new eui.ArrayCollection(e),this.gp_reward.addChild(this.list)},a.prototype.initConfig=function(){this.cofing={},this.cofing[1]={},this.cofing[10]={},this.cofing[1].itemCosts=this.actList[0][1][0],this.cofing[1].moneyCosts=this.actList[0][0][0],this.cofing[10].itemCosts=this.actList[0][3][0],this.cofing[10].moneyCosts=this.actList[0][2][0]},a.prototype.inintButton=function(){var e=this;this.heroPy.gashaponInfo,this.btn_challenge1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;if(this.isOpen){if(this.isOpen=!1,!(this.backPackProxy.checkEnough([this.cofing[1].itemCosts],!1)||this.cofing[1].moneyCosts[0]&&this.backPackProxy.checkEnough([this.cofing[1].moneyCosts],!1)))return Utils.MsgUtils.addMidMsg("道具不足"),void(this.isOpen=!0);var t=1,i=this.cofing[1].itemCosts,a=0<this.cofing[1].moneyCosts.length?this.cofing[1].moneyCosts:void 0;!this.backPackProxy.checkEnough([i],!1)&&a||(t=2),this.img_baoxiang.visible=!1,DragonBoneTools.playOnce({effectName:"common_buxiudebaozang_bxdk",parent:this.effect,y:this.effect.height/2-100,x:this.effect.width/2,doneCB:function(){e.type==EActivityType.NewBraveBook?e.actProxy.DoCommonOperation(EActivityType.NewBraveBook,t,0,function(){e.isOpen=!0,e.img_baoxiang.visible=!0,e.handleReward()}):Utils.Socket.send("activity","BraveBookHuntTreasure",{costIndex:t}).then(function(t){e.isOpen=!0,e.returnData=t,e.img_baoxiang.visible=!0,e.handleReward()})}})}},this),this.btn_challenge10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;if(this.isOpen){if(this.isOpen=!1,!(this.backPackProxy.checkEnough([this.cofing[10].itemCosts],!1)||this.cofing[10].moneyCosts&&this.backPackProxy.checkEnough([this.cofing[10].moneyCosts],!1)))return this.isOpen=!0,void Utils.MsgUtils.addMidMsg("道具不足");var t=3,i=this.cofing[10].itemCosts,a=0<this.cofing[10].moneyCosts.length?this.cofing[10].moneyCosts:void 0;!this.backPackProxy.checkEnough([i],!1)&&a||(t=4),this.img_baoxiang.visible=!1,DragonBoneTools.playOnce({effectName:"common_buxiudebaozang_bxdk",parent:this.effect,y:this.effect.height/2-80,x:this.effect.width/2,doneCB:function(){e.type==EActivityType.NewBraveBook?e.actProxy.DoCommonOperation(EActivityType.NewBraveBook,t,0,function(){e.isOpen=!0,e.img_baoxiang.visible=!0,e.handleReward()}):Utils.Socket.send("activity","BraveBookHuntTreasure",{costIndex:t}).then(function(t){e.isOpen=!0,e.returnData=t,e.img_baoxiang.visible=!0,e.handleReward()})}})}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide(),this.type==EActivityType.BraveBook?i.AppFacade.getInstance().retrieveMediator(i.BraveBookMediator.N).updateView(i.BraveBookMediator.SV.MAIN):i.AppFacade.getInstance().retrieveMediator(i.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)},this),this.btn_last.visible=!1,this.btn_next.visible=!0,this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.sl_root.viewport.scrollH;(t-=188)<0&&(t=0),e.sl_root.viewport.scrollH=t,e.btn_next.visible=t<e.list.width-e.sl_root.width,e.btn_last.visible=0<t},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.sl_root.viewport.scrollH;(t+=188)>e.list.width-e.sl_root.width&&(t=e.list.width-e.sl_root.width),e.sl_root.viewport.scrollH=t,e.btn_next.visible=t<e.list.width-e.sl_root.width,e.btn_last.visible=0<t},this),this.sl_root.addEventListener(egret.Event.CHANGE,function(){var t=e.sl_root.viewport.scrollH;e.btn_next.visible=t<e.list.width-e.sl_root.width,e.btn_last.visible=0<t},this)},a.prototype.updateView=function(){var t=this.cofing[1].itemCosts,e=0<this.cofing[1].moneyCosts.length?this.cofing[1].moneyCosts:void 0,i=e,a=0<this.cofing[10].moneyCosts.length?this.cofing[10].moneyCosts:void 0;!this.backPackProxy.checkEnough([t],!1)&&e||(i=t),!this.backPackProxy.checkEnough([this.cofing[10].itemCosts],!1)&&a||(a=this.cofing[10].itemCosts),this.type==EActivityType.NewBraveBook&&(this.returnData=a),this.icon_resource_1.updateItem({cost:i,style:CommonIconStyle.RIGHT,showEnough:!1}),this.icon_resource_10.updateItem({cost:a,style:CommonIconStyle.RIGHT,showEnough:!1}),this.updateResourceBar()},a.prototype.handleReward=function(){var t=this.returnData;t&&(this.type==EActivityType.BraveBook&&i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).handleClientReward({rewards:t.rewardShow},2),this.updateView())},a.prototype.updateResourceBar=function(){var t=[];t.push(this.cofing[1].itemCosts[1]),this.cu_resBar.updateBar({costs:t,width:190,needAdd:!0})},a);function a(){var t=e.call(this)||this;return t.isOpen=!0,Utils.AssetsMgr.loadGroup("group_buxiu_baoxiang"),t.skinName="BuxiuBaoxiangViewSkin",t.backPackProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),t.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),t.actProxy=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),t}i.BuxiuBaoxiangView=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.HeroMediator.N,i.HeroMediator.SV.HERO_DETAIL,{code:this.data.model})},this)},r.prototype.dataChanged=function(){this.effect||DragonBoneTools.create(this.XIYOU_CONFIG[this.data.xiyou+1],function(t){t.x=this.gp_daoju.width/2,t.y=this.gp_daoju.height/2-22,t.animation.play(),this.effect=t,this.gp_daoju.addChildAt(this.effect,0)},this),this.img_xiyou.source="yslz_img_jianglidi"+(this.data.xiyou+1)+"_png",this.data.type==EEntityType.EEntityTypeHero?(this.cu_model.visible=!0,this.baseitem.visible=!1,this.cu_model.update({isStatic:!0,code:this.data.model})):(this.cu_model.visible=!1,this.baseitem.visible=!0,this.baseitem.updateData({code:this.data.model,num:this.data.num}),this.baseitem.img_bg.visible=!1,this.baseitem.img_frame.visible=!1,this.baseitem.gp_star_item.visible=!1,this.baseitem.blb_num.visible=!1,this.baseitem.blb_level.visible=!1,UIActionManager.jumping(this.baseitem)),this.gp_daoju.y=0<this.data.code%2?80:0},r);function r(){var t=n.call(this)||this;return t.XIYOU_CONFIG={1:"common_buxiudebaozang_lan",2:"common_buxiudebaozang_zi",3:"common_buxiudebaozang_jin"},t.skinName="BuxiuBaoxiangitemSkin",t}}(game=game||{}),function(s){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},e.prototype.updateView=function(t){t&&(this.params=t,this.makeAccess(this.params.type,this.params.code))},e.prototype.makeAccess=function(t,e){var i=this,a=s.Config.getMainWayConfigByIdAndEntityType(t,e);if(0<a.length)for(var n=0,o=a;n<o.length;n++){var r=o[n];this.gp_ways.addChild(new s.CommonAccessItem({wayCode:r,callBack:function(){i.hide()}}))}else this.gp_ways.addChild(new s.CommonAccessItem(void 0))},e);function e(t){var e=i.call(this)||this;return e.skinName="CommonGetWaysSkin",e}s.CommonGetWaysView=t}(game=game||{}),function(g){var m,t=(m=g.ActivityCommonFull,__extends(e,m),e.prototype.childrenCreated=function(){var i=this;m.prototype.childrenCreated.call(this);for(var t=0;t<this.colCount;t++)for(var e=0;e<this.rowCount;e++){var a=new c;this.gp_trees.addChild(a);var n=t*this.rowCount+e,o=this.getPosByIndex(n);a.x=o[0],a.y=o[1],this.treeItems.push(a)}this.gp_touch.visible=!1,this.checkbox_auto.selected=!1,this.activateComponent();var r=0;this.timer2=egret.setInterval(function(){for(var t="自动合成中",e=0;e<r;e++)t+=".";i.bm_collecting.text=t,r=(r+1)%4},this,1e3);var s=this.info.content[1][0][1];this.sunCode=s[0][1]},e.prototype.updateView=function(t){var e=this;m.prototype.updateView.call(this,t);var i=this.info;if(i&&i.data){var a,n=JSON.parse(i.content),o=(i.data.landInfo,n[0]),r=n[2],s=(a=g.GameMVC.backpackPy.getInfoByCode(o[0][1]))&&a.haveNum||0;this.bm_curSeedNum.text=Utils.MathUtils.formatNumStyle1(s),s=(a=g.GameMVC.backpackPy.getInfoByCode(this.sunCode))&&a.haveNum||0,this.bm_curEnergy.text=Utils.MathUtils.formatNumStyle1(s);for(var c=0,d=0;d<this.colCount*this.rowCount;d++){var h=this.getInfoByIndex(d),l=h[1],p=h[2],u=this.getPosByIndex(d);this.treeItems[d].x=u[0],this.treeItems[d].y=u[1],this.treeItems[d].update({index:d,level:l,lastTime:p,maxTime:n[8],rate:0<l?r[l-1]:0}),0<l&&(c+=r[l-1])}this.lb_produtivity.text=c+"星沙/分",this.bm_curSun.text=Utils.MathUtils.formatNumStyle1(i.data.totalSun),this.updateCanCollectSun(),this.updateFullImg(),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){e.collectEffect()},this,1e3),this.gp_trees.$children.sort(function(t,e){return t.data.index-e.data.index})}},e.prototype.oneKeyPlant=function(i){var a=this;if(this.inPlant)Utils.MsgUtils.addMidMsg("堆砌中");else if(this.inComposite)Utils.MsgUtils.addMidMsg("合成中");else if(this.inCollect)Utils.MsgUtils.addMidMsg("收获中");else{var t=this.info;if(t&&t.data){for(var e=JSON.parse(t.content)[0],n=g.GameMVC.backpackPy.getInfoByCode(e[0][1]),o=n&&n.haveNum||0,r=(t.data.landInfo,Math.floor(o/e[0][2])),s=0,c=0;c<this.colCount*this.rowCount;c++)0==this.getInfoByIndex(c)[1]&&s++;if(0!=s){var d=r<s?r:s,h=5<d?5:d;if(0<d){0<this.autoStatus&&(this.gp_touch.visible=!0);var l=[];this.lastAuto=this.autoStatus,this.inPlant=!0;var p=function(){for(var t=[],e=0;e<a.colCount*a.rowCount;e++)if(0==a.treeItems[e].data.level&&l.indexOf(e+1)<0&&(l.push(e+1),t.push(e),t.length==h||t.length==d)){t.forEach(function(t){var e=a.treeItems[t];e&&(e.img_tree.source="")}),a.playEffect("common_nc_chanzi",t,function(){d-=t.length,t.forEach(function(t){var e=a.treeItems[t];e&&(e.img_tree.source="znq_img_shabao01_png")}),a.hasDestroy||(d<=0||1==a.lastAuto&&0==a.autoStatus?a.getReward({code:a.code,id:1,num:0,info:JSON.stringify(l)},function(){i&&i(),a.inPlant=!1,1!=a.autoStatus&&3!=a.autoStatus||(a.autoStatus=2,a.oneKeyComposite())}):p())});break}};p()}else 1==this.autoStatus?(this.autoStatus=2,this.oneKeyComposite()):Utils.MsgUtils.addMidMsg("种子不足")}else 1==this.autoStatus?(this.autoStatus=2,this.oneKeyComposite()):Utils.MsgUtils.addMidMsg("没有空闲土地")}}},e.prototype.oneKeyComposite=function(t){var n=this;if(this.inPlant)Utils.MsgUtils.addMidMsg("堆砌中");else if(this.inComposite)Utils.MsgUtils.addMidMsg("合成中");else if(this.inCollect)Utils.MsgUtils.addMidMsg("收获中");else{0<this.autoStatus&&(this.gp_touch.visible=!0);var e=this.info;if(e&&e.data){JSON.parse(e.content),e.data.landInfo;var i=this.getCompositePosList();0<i.length?(this.inComposite=!0,i.forEach(function(t){var e=n.treeItems[t[1]-1];n.gp_trees.setChildIndex(e,n.colCount*n.rowCount),n.moveTree(t[1]-1,t[0]-1,function(){n.hasDestroy||(n.playEffect("common_activity_zhishujie05",t[1]-1,function(){}),i.forEach(function(t){n.treeItems[t[0]-1].upgrade(),n.treeItems[t[1]-1].upgrade()}))})}),egret.setTimeout(function(){Utils.Socket.send("activity","DoCommonOperation",{code:n.code,id:3,num:0,info:JSON.stringify(i)}).then(function(t){n.hasDestroy||(n.info.updateData(t.info,!0),i.forEach(function(t,e){var i=n.treeItems[t[0]-1].x,a=n.treeItems[t[0]-1].y;n.addEffect("item_icon_beike2_png",[n.x2h(i),n.y2v(a),.4],[n.x2h(i),n.y2v(a-40),.8],[n.x2h(260),n.y2v(632)],function(){0!=e||n.hasDestroy||(n.info.onDataUpdate(),n.inComposite=!1,2!=n.autoStatus&&3!=n.autoStatus||(n.autoStatus=1,n.canPlant?(n.autoStatus=1,n.oneKeyPlant()):0<n.getCompositePosList().length?(n.autoStatus=2,n.oneKeyComposite()):(n.gp_touch.visible=!1,n.autoStatus=0,n.checkbox_auto.selected=!1)))})}))})},this,1e3)):2==this.autoStatus||3==this.autoStatus?this.canPlant?(this.autoStatus=1,this.oneKeyPlant()):(this.gp_touch.visible=!1,this.autoStatus=0,this.checkbox_auto.selected=!1):Utils.MsgUtils.addMidMsg("没有可以合成的沙堡")}}},Object.defineProperty(e.prototype,"canPlant",{get:function(){var t=this.info;if(!t||!t.data)return!1;for(var e=JSON.parse(t.content)[0],i=g.GameMVC.backpackPy.getInfoByCode(e[0][1]),a=i&&i.haveNum||0,n=(t.data.landInfo,Math.floor(a/e[0][2])),o=0,r=0;r<this.colCount*this.rowCount;r++)0==this.getInfoByIndex(r)[1]&&o++;return 0<(n<o?n:o)},enumerable:!0,configurable:!0}),e.prototype.getCompositePosList=function(){for(var t=[],e={},i=0;i<this.colCount*this.rowCount;i++){var a=this.getInfoByIndex(i)[1];if(0<a&&!e[i]){e[i]=1;var n=this.findIndexByLevel(a,e);0<=n&&(t.push([i+1,n+1]),e[n]=1)}}return t},e.prototype.oneKeyCollect=function(){var a=this;this.inPlant?Utils.MsgUtils.addMidMsg("堆砌中"):this.inComposite?Utils.MsgUtils.addMidMsg("合成中"):this.inCollect?Utils.MsgUtils.addMidMsg("收获中"):"0"!=this.bm_canCollect.text?this.getReward2({code:this.code,id:5,num:0},function(e){if(a.info.updateData(e.info,!0),!a.hasDestroy){function t(t){a.addEffect("item_icon_xingsha_png",[a.x2h(204,83),a.y2v(-204,83),.4],[a.x2h(a.sunPos[t][0],83),a.y2v(a.sunPos[t][1],83),.8],[a.x2h(16,83),a.y2v(632)],function(){0!=t||a.hasDestroy||(a.inCollect=!1,a.info.onDataUpdate(),a.backpackProxy.handleClientReward(e.clientReward))})}a.inCollect=!0;for(var i=0;i<8;i++)t(i)}}):Utils.MsgUtils.addMidMsg("暂无可收集星沙")},e.prototype.collectEffect=function(){var a=this;if(!this.inPlant&&!this.inComposite){var n=0;this.treeItems.forEach(function(t){n+=t.collectSun()}),this.updateFullImg(),0<n&&egret.setTimeout(function(){a.updateCanCollectSun(2);var t=a.info.content[1][0][1],e=g.GameMVC.backpackPy.getInfoByCode(t[0][1]),i=e&&e.haveNum||0;a.bm_curEnergy.text=Utils.MathUtils.formatNumStyle1(i),Utils.MsgUtils.addRewardMsg({rewards:[{code:a.info.content[9],type:EEntityType.EEntityTypeItem,num:n}]},a.gp_sunBottle,{oriY:.25*a.gp_sunBottle.height,offsetY1:-85,offsetY2:-85}),DragonBoneTools.playOnce({effectName:"common_activity_zhishujie06",parent:a.gp_sunBottle,x:a.gp_sunBottle.width/2,y:a.gp_sunBottle.height/2,doneCB:function(){}})},this,2700)}},e.prototype.updateFullImg=function(){var i=!0,a=!1;this.treeItems.forEach(function(t){var e=t.isFull();3==e&&(a=!(i=!1)),2==e&&(a=!0)}),this.img_full.visible=!(!a||!i)},e.prototype.updateCanCollectSun=function(e){void 0===e&&(e=0);var i=this.info.data.bottonSun;this.treeItems.forEach(function(t){i+=t.updateSun(e)}),this.bm_canCollect.text=Utils.MathUtils.formatNumStyle1(i)},e.prototype.findIndexByLevel=function(t,e){for(var i=this.colCount*this.rowCount-1;0<=i;i--)if(this.getInfoByIndex(i)[1]==t&&!e[i])return i;return-1},e.prototype.getInfoByIndex=function(t){var e=this.info.data.landInfo;for(var i in e){var a=e[i];if(a[0]==t+1)return a}return[t+1,0,0]},e.prototype.moveTree=function(t,e,i){var a=this.treeItems[t],n=this.treeItems[e];egret.Tween.get(a).to({x:n.x,y:n.y},500).call(function(){i&&i()})},e.prototype.playEffect=function(t,e,i){if("number"==typeof e)this.gp_trees.setChildIndex(this.treeItems[e],this.allCount-1),DragonBoneTools.playOnce({effectName:t,parent:this.treeItems[e],x:this.treeWidth/2,y:this.treeHeight/2,doneCB:function(){i&&i()}});else for(var a in e){this.gp_trees.setChildIndex(this.treeItems[a],this.allCount-1);var n=e[a];"0"==a?DragonBoneTools.playOnce({effectName:t,parent:this.treeItems[n],x:this.treeWidth/2,y:this.treeHeight/2,doneCB:function(){i&&i()}}):DragonBoneTools.playOnce({effectName:t,parent:this.treeItems[n],x:this.treeWidth/2,y:this.treeHeight/2,doneCB:function(){}})}},e.prototype.getPosByIndex=function(t){var e=Math.floor(t/this.colCount);return[t%this.colCount*this.treeHorGap,e*this.treeVerGap]},e.prototype.activateComponent=function(){var i=this;this.gp_trees.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_trees.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_trees.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_trees.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_trees.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.btn_plant.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.oneKeyPlant()},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_cpmposite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.oneKeyComposite()},this),this.btn_collect.parent.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.oneKeyCollect()},this),this.checkbox_auto.addEventListener(egret.Event.CHANGE,function(){i.checkbox_auto.selected?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"勾选后使用一键堆砌或一键合成时，将自动进行堆砌并合成",source:"activity281checkbox",cb:!0,clickCB:function(t){if(1===t.type){if(i.inPlant)return i.autoStatus=1,void(i.lastAuto=1);if(i.inComposite)return void(i.autoStatus=2);i.autoStatus=3}else i.autoStatus=0,i.checkbox_auto.selected=!1}}):i.autoStatus=0},this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.gp_touch.visible=!1,i.autoStatus=0,i.checkbox_auto.selected=!1},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info,e=JSON.parse(t.content);g.GameMVC.activityMed.showHelpDialog(e[6])},this),this.btn_look.parent.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o})},this),this.btn_rewards.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new p})},this),this.gp_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.GameMVC.activityMed.showViewByCode(EActivityType.BeachReach)},this)},e.prototype.removeListener=function(){this.gp_trees.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_trees.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_trees.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_trees.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_trees.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.getTreeIndexByPos=function(t,e){var i=Math.floor(t/this.treeHorGap),a=Math.floor(e/this.treeVerGap);if(0<=i&&i<this.colCount&&0<=a&&a<this.rowCount){var n=t-i*this.treeHorGap,o=e-a*this.treeVerGap;if(0<=n&&n<=this.treeWidth&&0<=o&&o<=this.treeHeight)return a*this.colCount+i}return-1},e.prototype.onTouchBegin=function(t){var e=t.localX,i=t.localY,a=this.getTreeIndexByPos(e,i);if(0<=a){if(0==this.treeItems[a].data.level)return;this.curSelectTree=this.treeItems[a],this.curSelectTree.x=e-this.treeWidth/2,this.curSelectTree.y=i-this.treeHeight/2,this.gp_trees.setChildIndex(this.curSelectTree,this.colCount*this.rowCount)}},e.prototype.onTouchMove=function(t){if(this.curSelectTree){var e=t.localX,i=t.localY;this.curSelectTree.x=e-this.treeWidth/2,this.curSelectTree.y=i-this.treeHeight/2}},e.prototype.onTouchEnd=function(t){var e=this;if(this.curSelectTree){var i=t.localX,a=t.localY,n=this.getTreeIndexByPos(i,a),o=this.curSelectTree.data;if(0<=n)if(this.treeItems[n].data.level==o.level)if(n==o.index){var r=this.getPosByIndex(o.index);this.curSelectTree.x=r[0],this.curSelectTree.y=r[1]}else{var s=this.getPosByIndex(n);this.curSelectTree.x=s[0],this.curSelectTree.y=s[1];var c=o.index>n?o.index:n;this.getReward2({code:this.code,id:3,num:0,info:JSON.stringify([[n+1,o.index+1]])},function(t){e.info.updateData(t.info,!0),e.hasDestroy||(e.treeItems[o.index].upgrade(),e.treeItems[n].upgrade(),e.addEffect("item_icon_beike2_png",[e.x2h(s[0]),e.y2v(s[1]),.4],[e.x2h(s[0]),e.y2v(s[1]-40),.8],[e.x2h(260),e.y2v(632)],function(){e.hasDestroy||(e.info.onDataUpdate(),e.backpackProxy.handleClientReward(t.clientReward))}))}),this.playEffect("common_activity_zhishujie05",c,function(){})}else r=this.getPosByIndex(o.index),this.curSelectTree.x=r[0],this.curSelectTree.y=r[1],Utils.MsgUtils.addMidMsg("相同等级的沙堡才能合成");else r=this.getPosByIndex(o.index),this.curSelectTree.x=r[0],this.curSelectTree.y=r[1]}this.gp_trees.$children.sort(function(t,e){return t.data.index-e.data.index}),this.curSelectTree=void 0},e.prototype.addEffect=function(t,e,i,a,n){var o=this,r=new eui.Image(t);r.data={index:999},r.horizontalCenter=e[0],r.verticalCenter=e[1],r.scaleX=r.scaleY=e[2]||1,this.gp_trees.addChild(r),egret.Tween.get(r).to({scaleX:i[2]||1,scaleY:i[2],horizontalCenter:i[0],verticalCenter:i[1]},500).to({verticalCenter:i[1]-4},300).to({verticalCenter:i[1]+4},300).to({verticalCenter:i[1]-4},300).to({verticalCenter:i[1]+4},300).to({horizontalCenter:a[0],verticalCenter:a[1]},1e3,egret.Ease.quadIn).call(function(){n&&n(),o.gp_trees.removeChild(r)})},e.prototype.x2h=function(t,e){return e=e||this.treeWidth,t-this.gp_trees.width/2+e/2},e.prototype.y2v=function(t,e){return e=e||this.treeHeight,t-this.gp_trees.height/2+e/2},e.prototype.getReward2=function(t,e){var i=this,a=g.ActivityConfig.Config[this.code],n=a.getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,t).then(function(t){i.log(a.name+"——领取",n+"R",t),e&&e(t)})},e.prototype.onDestroy=function(){m.prototype.onDestroy.call(this),this.hasDestroy=!0,this.timer2&&egret.clearInterval(this.timer2)},e);function e(){var t=m.call(this)||this;return t.rowCount=6,t.colCount=5,t.treeHorGap=95,t.treeVerGap=105,t.treeWidth=90,t.treeHeight=90,t.allCount=30,t.sunCode=0,t.treeItems=[],t.curSelectTree=void 0,t.inPlant=!1,t.inComposite=!1,t.inCollect=!1,t.lastAuto=0,t.autoStatus=0,t.sunPos=[[201,-355],[300,-321],[342,-238],[301,-130],[201,-99],[104,-162],[57,-236],[104,-299],[,]],t.hasDestroy=!1,t.skinName="Activity336Skin",t.allCount=t.colCount*t.rowCount,t.code=EActivityType.BeachDiaoBao,t}g.Activity336=t;var i,c=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.sunImages[0]=new eui.Image("item_icon_xingsha_png"),this.sunImages[0].scaleX=this.sunImages[0].scaleY=.5,this.addChild(this.sunImages[0]),this.sunImages[0].visible=!1,this.energyImg=new eui.Image("item_icon_beike2_png"),this.addChild(this.energyImg),this.energyImg.visible=!1,this.update(this.data)},a.prototype.update=function(t){if(t&&(this.data=t,this.img_tree)){var e=t.level;this.img_tree.source=0<e?"znq_img_shabao"+(e<10?"0"+e:e)+"_png":"znq_img_keduisha_png",this.lb_level.text=0<e?"lv."+e:""}},a.prototype.updateSun=function(t){void 0===t&&(t=0);var e=this.data.lastTime,i=Utils.TimerManager.getServerTime()-e-t;return i>60*this.data.maxTime?this.data.maxTime*this.data.rate:Math.floor(i/60)*this.data.rate},a.prototype.collectSun=function(){var e=this;if(this.inCollect)return 0;if(0==this.data.level)return 0;var t=this.data.lastTime,i=Utils.TimerManager.getServerTime()-t;if(i>60*this.data.maxTime)return 0;if(i%60!=0)return 0;this.sunImages[0].visible=!0,this.sunImages[0].horizontalCenter=0,this.sunImages[0].verticalCenter=-10,this.sunImages[0].scaleX=this.sunImages[0].scaleY=.7,this.inCollect=!0;var a=240-this.x-this.width/2,n=-200-this.y;return this.sunImages.forEach(function(t){egret.Tween.get(t).to({scaleX:1,scaleY:1,verticalCenter:-40},500).to({verticalCenter:-36},300).to({verticalCenter:-44},300).to({verticalCenter:-36},300).to({verticalCenter:-44},300).to({horizontalCenter:a,verticalCenter:n},1e3,egret.Ease.quadIn).call(function(){e.inCollect=!1,e.sunImages[0].visible=!1})}),this.data.rate},a.prototype.upgrade=function(){if(this.data.level++,this.img_tree){var t=this.data.level;this.img_tree.source=0<t?"znq_img_shabao"+(t<10?"0"+t:t)+"_png":"zsj_img_kezhongzhi_png",this.lb_level.text="lv."+t}this.data.level--},a.prototype.isFull=function(){var t=this.data.lastTime,e=Utils.TimerManager.getServerTime()-t;return 0==this.data.level?1:e>=60*this.data.maxTime?2:3},a);function a(){var t=i.call(this)||this;return t.sunPos=[[],[[0,0]],[[-10,30],[10,30]],[[-20,30],[0,30],[20,30]]],t.inCollect=!1,t.skinName="Activity281TreeItemSkin",t.sunImages=[],t}var n,o=(n=BasePanel,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.updateInfo(),this.list_historyItem.itemRenderer=d},r.prototype.updateInfo=function(){var t=g.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(!t||!t.data)return!1;var e=JSON.parse(t.content)[2],i=t.data.landInfo,a={},n=[];for(var o in i){var r=i[o];0!=r[1]&&(a[r[1]]||(a[r[1]]=0),a[r[1]]++)}for(var s in e){var c=parseInt(s),d=e[c],h=a[c+1]||0;n.push({level:c+1,num:h,rate:d})}this.list_historyItem.dataProvider=new eui.ArrayCollection(n)},r);function r(){var t=n.call(this)||this;return t.skinName="Activity281LookSkin",t}var s,d=(s=eui.ItemRenderer,__extends(h,s),h.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this)},h.prototype.dataChanged=function(){var t=this.data.level,e="01";e=9<t?t:"0"+t,this.img_plant.source="znq_img_shabao"+e+"_png",this.img_di.visible=t%2==1,this.lb_num.text=this.data.num,0<this.data.num?UIActionManager.setAbsGrey(this.img_plant,!1):UIActionManager.setAbsGrey(this.img_plant,!0),this.lb_rate.text=this.data.rate+"星沙/分",this.lb_level.text="lv."+t},h);function h(){var t=s.call(this)||this;return t.skinName="Activity281LookItemSkin",t}var l,p=(l=BasePanel,__extends(u,l),u.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this),this.updateInfo(),this.list_historyItem.itemRenderer=v},u.prototype.updateInfo=function(){var t=g.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(!t||!t.data)return!1;var e=JSON.parse(t.content),i=e[1],a=(e[2],t.data.landInfo,[]);for(var n in i){var o=i[n];a.push({level:o[0]-1,rewards:o[1]})}this.list_historyItem.dataProvider=new eui.ArrayCollection(a)},u);function u(){var t=l.call(this)||this;return t.skinName="Activity281LookSkin2",t}var y,v=(y=eui.ItemRenderer,__extends(f,y),f.prototype.childrenCreated=function(){y.prototype.childrenCreated.call(this)},f.prototype.dataChanged=function(){var t=this.data.level,e="01";e=9<t?t:"0"+t,this.img_plant1.source="znq_img_shabao"+e+"_png",this.lb_level1.text="lv."+t,e="01",e=9<t+1?t+1:"0"+(t+1),this.img_plant2.source="znq_img_shabao"+e+"_png",this.lb_level2.text="lv."+(t+1),this.img_di.visible=t%2==1,this.data.rewards&&(this.bm_num.text=this.data.rewards[0][2])},f);function f(){var t=y.call(this)||this;return t.skinName="Activity281LookItemSkin2",t}}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonTaskListPanel,__extends(a,e),a.prototype.getDataList=function(){var r=this,t=this.info;if(!t||!t.data)return[];var e,i=JSON.parse(t.content),s=t.data.targeted,c=t.data.key||1,a=t.data.curCycle;for(var n in i[1]){var o=i[1][n];if(o[0]==a){e=o[1];break}}if(!e)return Utils.MsgUtils.addMidMsg("找不到配置"),[];var d=[];return e.forEach(function(t){var e=t[0],i=t[1],a=t[2],n=REWARD_STATUS.UNAVAILABLE;s.some(function(t){return t.id==e&&0<t.num})?n=REWARD_STATUS.RECEIVED:c>=t[1]&&(n=REWARD_STATUS.AVAILABLE);var o={id:i,title:"连续登录"+i+"天",tips:c+"/"+i,status:n,rewards:a,btnFunc:function(){r.getReward({code:r.code,id:e})}};d.push(o)}),d.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),d},a);function a(){return null!==e&&e.apply(this,arguments)||this}t.Activity342=i}(game=game||{}),function(g){var m,t=(m=g.ActivityCommonPanel,__extends(e,m),e.prototype.childrenCreated=function(){var t=this;m.prototype.childrenCreated.call(this),this.list_items.itemRenderer=o;var e=this.info;if(e&&e.data){var i=JSON.parse(e.content);this.pb_progress.maximum=1e3*i[0].length,this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.GameMVC.activityMed.showHelpDialog(t.info.content[2])},this)}},e.prototype.updateView=function(t){m.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=e.data.totalIntegral;this.bm_grade.text=e.data.integral,this.bm_canGet.text=e.data.getDiamond,this.bm_allGrade.text=a,this.gp_fengexian.removeChildren(),(u=new y).data={grade:0,diamond:0,totalIntegral:a},this.gp_fengexian.addChild(u);var n=i[0][i[0].length-1][0];for(var o in i[0]){var r=i[0][o];(u=new y).data={grade:r[0],diamond:r[1],max:n,totalIntegral:a},this.gp_fengexian.addChild(u)}var s=0,c=0;if(a<=i[0][0][0])s=a/i[0][0][0]*1e3;else for(var d=0;d<i[0].length;d++){if(!(a>=(r=i[0][d])[0])){s+=(a-i[0][d-1][0])/(r[0]-i[0][d-1][0])*1e3;break}s+=1e3,c=r[1]}var h=Math.ceil(s/1e3);3<h&&(h=3),this.img_cake.source="znq_img_dangao"+h+"_png",this.pb_progress.value=s,this.bm_allDiamond.text=c+"";var l=e.data.targeted,p=[];for(var o in i[1]){var u=i[1][o];p.push({id:u[0],key:u[1],grade:u[2],title:(g.ActivityCommonTaskView.TaskType_2_Title[u[3]]||"").format([u[1]%1e4]),finish:0<=l.indexOf(u[0])}),u[3]==TaskSubType.RechargeMoney&&(p[p.length-1].title="每日充值任意金额")}this.list_items.dataProvider=new eui.ArrayCollection(p)}},e);function e(){var t=m.call(this)||this;return t.skinName="Activity343Skin",t.code=EActivityType.DivideDiamond,t}g.Activity343=t;var i,y=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.dataChanged()},a.prototype.dataChanged=function(){this.bm_diamond&&(0!=this.data.grade?(this.bm_grade.text=this.data.grade,this.data.grade==this.data.max&&(this.img_gang.visible=!1),this.bm_diamond.text=Utils.MathUtils.formatNumStyle1(this.data.diamond),this.data.totalIntegral>=this.data.grade?UIActionManager.setGrey(this,!1):UIActionManager.setGrey(this,!0)):this.visible=!1)},a);function a(){var t=i.call(this)||this;return t.skinName="Activity343Item1",t}var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.dataChanged=function(){this.img_finish.visible=this.data.finish,this.lb_desc.text=this.data.title,this.bm_grade.text="+"+this.data.grade+"分"},r);function r(){var t=n.call(this)||this;return t.skinName="Activity343Item2",t}}(game=game||{}),function(m){var a,t=(a=m.ActivityCommonPanel,__extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_beginEffect,"common_activity_huiyishouce_1_01"),this.activateComponent()},e.prototype.updateView=function(t){a.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){JSON.parse(e.content);var i=Utils.LocalStorageUtil.getItem("Activity344");this.btn_skip.visible="1"==i,1==this.curIndex?(this.gp_beginEffect.visible=!0,this.gp_content0.visible=!1,this.btn_skip.visible=!1,this.gp_content1.visible=!1,this.gp_content2.visible=!1,this.gp_content3.visible=!1,this.gp_content4.visible=!1,this.gp_good.visible=!1,this.btn_next.visible=!1):this.curIndex<=6?(this.gp_good.visible=!1,this.btn_next.icon="hyse_btn_xiayiye_png",this.showContent()):(this.updateGood(),this.gp_beginEffect.visible=!1,this.gp_content1.visible=!1,this.gp_content2.visible=!1,this.gp_content3.visible=!1,this.gp_content4.visible=!1,this.gp_good.visible=!0,this.btn_next.visible=!0,this.btn_next.alpha=1,this.btn_next.icon="hyse_btn_guanbi_png",this.btn_skip.visible=!1,Utils.LocalStorageUtil.setItem("Activity344","1"))}},e.prototype.showContent=function(){var t=this;this.gp_beginEffect.visible=!1,this.gp_content0.visible=!0,this.gp_content1.visible=!0,this.gp_content2.visible=!0,this.gp_content3.visible=!0,this.gp_content4.visible=!0,this.btn_next.visible=!0,this.gp_content1.alpha=0,this.gp_content2.alpha=0,this.gp_content3.alpha=0,this.gp_content4.alpha=0,this.btn_next.alpha=0,this.makeContent();var e=0;egret.Tween.get(this.gp_content1).to({alpha:1},500),0<this.gp_content2.$children.length&&e++,egret.Tween.get(this.gp_content2).wait(500*e).to({alpha:1},500),0<this.gp_content3.$children.length&&e++,egret.Tween.get(this.gp_content3).wait(500*e).to({alpha:1},500),0<this.gp_content4.$children.length&&e++,egret.Tween.get(this.gp_content4).wait(500*e).to({alpha:1},500),e++,this.btn_next.touchEnabled=!1,egret.Tween.get(this.btn_next).wait(500*e).to({alpha:1},250).call(function(){t.btn_next.touchEnabled=!0})},e.prototype.makeContent=function(){this.img_bg.source="hyse_img_neirong"+this.curIndex+"_png",this.gp_content1.removeChildren(),this.gp_content2.removeChildren(),this.gp_content3.removeChildren(),this.gp_content4.removeChildren();var t=[],e=[],i=JSON.parse(this.info.data.keys)[this.curIndex];switch(this.curIndex){case 1:var a=new Date(1e3*i),n=a.getFullYear(),o=a.getMonth()+1,r=a.getDate(),s=Utils.TimerManager.getServerTime()-i,c=Math.floor(s/60/60/24);t=["您在%s年%s月%s日开始了征程","我们一起度过了%s个日日夜夜"],e=[[n,o,r],[c]],c<30?(t.push("冒险才刚开始"),t.push("我们将一路与您陪伴")):c<100?(t.push("与您并肩作战的日子"),t.push("真的很不赖")):(t.push("老朋友"),t.push("这一路走来    有您真好"));break;case 2:t=["您最晚一次登录是%s点","这个点您还没睡"],e=[[i]],i<3?(t.push("游戏虽好玩"),t.push("但是要多保重身体呀")):i<6?(t.push("是刚睡醒准备为了生活奔波"),t.push("还是习惯了与黑夜为伍")):(t.push("难得的早睡早起"),t.push("我很羡慕呢"));break;case 3:t=["在冒险旅行中","您发生了大大小小共%s次冒险战斗"],e=[void 0,[i]],i<500?(t.push("勇士，带上你的剑"),t.push("继续进行更大的远征吧")):(t.push("尊敬的勇士"),t.push("伤痕是荣耀的勋章，我们与你共沐荣光"));break;case 4:t=["您召唤过%s个英雄","","它们有的常驻在您身边","有的与您只是见过一面"],e=[[i]];break;case 5:t=["分解过%s只英雄","","它们也许是","换了一种方式陪伴在你的身边"],e=[[i]];break;case 6:t=["参与过%s次世界boss","对于打败他们","你也许已经习以为常了"],e=[[i]]}for(var d=1;d<=4;d++){var h=t[d-1]||"",l=e[d-1]||[],p=this["gp_content"+d];p.removeChildren();for(var u=h.split("%s"),g=0;g<u.length;g++){var m=u[g],y=l[g],v=new eui.Label;if(v.textColor=5781526,v.size=23,v.text=m,p.addChild(v),y||0==y){var f=new eui.BitmapLabel(y);f.font="zqtg_price_fnt",p.addChild(f)}}}},e.prototype.updateGood=function(){var t=this.info;if(t&&t.data){function e(t){var e=c[0][t],i=e[0];if(d.indexOf(i)<0)return"continue";var a=e[2],n=e[3],o=e[4];if(a[0]&&a[0][2]){u.lb_title1.text=a[0][2]+"钻礼包",u.bm_buyTImes1.text=o,u.gp_rewards1.removeChildren(),m.GameMVC.activityMed.CommonGpAddReward(u.gp_rewards1,n,.6);var r=0;h.forEach(function(t){t[0]==i&&(r=t[1])}),o<=r?(u.btn_get1.updateData({cost:void 0,text:"已购买"}),u.btn_get1.btn_oppr.skinName="skins.ButtonSkinSure"):(u.btn_get1.cui_freshCost.updateItem({cost:a[0],style:CommonIconStyle.RIGHT}),u.btn_get1.btn_oppr.skinName="skins.ButtonSkinYellow")}else{u.lb_title0.text="免费礼包",u.bm_buyTImes0.text=o,u.gp_rewards0.removeChildren(),m.GameMVC.activityMed.CommonGpAddReward(u.gp_rewards0,n,.6);var s=0;h.forEach(function(t){t[0]==i&&(s=t[1])}),o<=s?(u.btn_get0.label="",u.btn_get0.skinName="skins.ButtonSkinSure",u.btn_get0.label="已领取"):(u.btn_get0.label="",u.btn_get0.skinName="skins.ButtonSkinYellow",u.btn_get0.label="领取")}}var c=t.content,d=t.data.diamondGifts,h=t.data.diamondTargeted,l=t.data.rechargeGifts,p=t.data.rechargeTargeted,u=this;for(var i in c[0])e(i);function a(t){var e=c[1][t],i=e[0];if(l.indexOf(i)<0)return"continue";var a=e[2],n=e[3],o=e[4],r=m.GameMVC.rechargePy.getGoodInfo(a);if(!r)return Utils.MsgUtils.addMidMsg("找不到商品信息"),{value:void 0};g.lb_title2.text=r.price+"元礼包",g.gp_rewards2.removeChildren(),m.GameMVC.activityMed.CommonGpAddReward(g.gp_rewards2,n,.6),g.bm_buyTImes2.text=o;var s=0;p.forEach(function(t){t[0]==i&&(s=t[1])}),o<=s?(g.btn_get2.label="",g.btn_get2.skinName="skins.ButtonSkinSure",g.btn_get2.label="已购买"):(g.btn_get2.label="",g.btn_get2.skinName="skins.ButtonSkinYellow",g.btn_get2.label="购 买")}var g=this;for(var i in c[1]){var n=a(i);if("object"==typeof n)return n.value}}},e.prototype.activateComponent=function(){var h=this;this.gp_beginEffect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){DragonBoneTools.playOnce({effectName:"common_activity_huiyishouce_1_02",parent:h.gp_beginEffect,x:h.gp_beginEffect.width/2,y:h.gp_beginEffect.height/2-29,doneCB:function(){h.gp_beginEffect.$children[0]&&h.gp_beginEffect.removeChild(h.gp_beginEffect.$children[0]),h.showContent();var t=Utils.LocalStorageUtil.getItem("Activity344");h.btn_skip.visible="1"==t}})},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.curIndex<=6?(h.curIndex++,h.updateView()):h.hide()},this),this.btn_get0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=h.info;if(t&&t.data){function e(t){var e=r[0][t],i=e[0];if(s.indexOf(i)<0)return"continue";var a=e[2];if(a[0]&&a[0][2])return"continue";e[3];var n=e[4],o=0;c.forEach(function(t){t[0]==i&&(o=t[1])}),n<=o?Utils.MsgUtils.addMidMsg("已领取"):h.getReward({code:h.code,id:1,num:i,info:JSON.stringify({num:1})})}var r=t.content,s=t.data.diamondGifts,c=t.data.diamondTargeted;for(var i in r[0])e(i)}},this),this.btn_get1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=h.info;if(t&&t.data){function e(t){var e=r[0][t],i=e[0];if(s.indexOf(i)<0)return"continue";var a=e[2];if(a[0]&&a[0][2]){e[3];var n=e[4],o=0;c.forEach(function(t){t[0]==i&&(o=t[1])}),n<=o?Utils.MsgUtils.addMidMsg("已购买"):h.getReward({code:h.code,id:1,num:i,info:JSON.stringify({num:1})})}}var r=t.content,s=t.data.diamondGifts,c=t.data.diamondTargeted;for(var i in r[0])e(i)}},this),this.btn_get2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=h.info;if(t&&t.data){function e(t){var e=s[1][t],i=e[0];if(c.indexOf(i)<0)return"continue";var a=e[2],n=m.GameMVC.rechargePy.getGoodInfo(a);if(!a)return Utils.MsgUtils.addMidMsg("找不到商品信息"),{value:void 0};e[3];var o=e[4],r=0;d.forEach(function(t){t[0]==i&&(r=t[1])}),o<=r?Utils.MsgUtils.addMidMsg("已购买"):m.GameMVC.rechargePy.purchase(n,2,i,JSON.stringify({activityType:h.code,code:i}),{activityType:h.code,code:i})}var s=t.content,c=t.data.rechargeGifts,d=t.data.rechargeTargeted;for(var i in s[1]){var a=e(i);if("object"==typeof a)return a.value}}},this),this.btn_skip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.curIndex=7,egret.Tween.removeTweens(h.gp_content1),egret.Tween.removeTweens(h.gp_content2),egret.Tween.removeTweens(h.btn_next),h.gp_content1.alpha=1,h.gp_content2.alpha=1,h.gp_content3.alpha=1,h.gp_content4.alpha=1,h.btn_next.alpha=1,h.btn_next.touchEnabled=!0,h.updateView()},this)},e.prototype.onDestroy=function(){egret.Tween.removeTweens(this.gp_content1),egret.Tween.removeTweens(this.gp_content2),egret.Tween.removeTweens(this.btn_next)},e);function e(){var t=a.call(this)||this;return t.curIndex=1,t.skinName="Activity344Skin",t}m.Activity344=t}(game=game||{}),function(s){var c,t=(c=s.ActivityCommonPanel,__extends(e,c),e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.list_historyItem.itemRenderer=a,this.list_historyItem.dataProvider=this.dataprovider,DragonBoneTools.create("common_xysqiuzhao",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.scaleX=t.scaleY=.85,t.animation.play(),this.gp_effect.addChild(t)},this)},e.prototype.updateView=function(t){c.prototype.updateView.call(this,t),this.code=EActivityType.BeachDiaoBao;var e=this.info;if(e&&e.data){if(this.lb_level.text=e.data.maxLevel,0<e.data.maxLevel){this.img_plant.visible=!0,this.gp_effect.visible=!0;var i="01";i=9<e.data.maxLevel?e.data.maxLevel:"0"+e.data.maxLevel,this.img_plant.source="znq_img_shabao"+i+"_png"}else this.img_plant.visible=!1,this.gp_effect.visible=!1;var a=JSON.parse(e.content)[3],n=[];for(var o in a){var r={config:a[o],cb:this.updateView.bind(this)};n.push(r)}this.dataprovider.replaceAll(n)}},e);function e(){var t=c.call(this)||this;return t.dataprovider=new eui.ArrayCollection,t.skinName="Activity345Skin",t}s.Activity345=t;var i,a=(i=eui.ItemRenderer,__extends(n,i),n.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.py.DoCommonOperation(EActivityType.BeachDiaoBao,t.data.config[0],6,function(){t.cb&&t.cb()})},this),this.gp_effect.removeChildren(),UIActionManager.addEffect(this.gp_effect,"common_lingquanniu",{offectY:0,offectX:0,scaleX:1,scaleY:1})},n.prototype.dataChanged=function(){var t=this.data.config;this.cb=this.data.cb;var e="01";e=9<t[0]?t[0]:"0"+t[0],this.img_plant.source="znq_img_shabao"+e+"_png",this.lb_level.text="lv."+t[0],this.gp_rewards.removeChildren(),s.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t[1],.6);var i=s.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(!i||!i.data)return!1;JSON.parse(i.content);var a=i.data.maxLevel,n=i.data.targeted,o=2;if(t[0]>a)o=2;else for(var r in o=1,n)if(n[r]==t[0]){o=0;break}this.btn_get.visible=!1,this.gp_effect.visible=!1,this.btn_isGet.visible=!1,this.btn_get.touchEnabled=!1,0==o?this.btn_isGet.visible=!0:1==o?(this.btn_get.visible=!0,this.gp_effect.visible=!0,this.btn_get.touchEnabled=!0):(this.btn_get.visible=!0,this.gp_effect.visible=!1,this.btn_get.touchEnabled=!1),UIActionManager.setAbsGrey(this.btn_get,!this.btn_get.touchEnabled)},n);function n(){var t=i.call(this)||this;return t.py=s.AppFacade.getInstance().retrieveProxy(s.ActivityPy.N),t.cb=void 0,t.skinName="Activity287ItemSkin",t}}(game=game||{}),function(c){var e,t=(e=c.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"RankingTypeNewZoneBeachRank"})},this),this.list_item.itemRenderer=n,this.list_item.dataProvider=new eui.ArrayCollection,this.initEffect(),this.updateView()},i.prototype.updateView=function(t){var s=this;e.prototype.updateView.call(this,t),c.GameMVC.rankPy.GetRankList({rankType:RankingType.RankingTypeNewZoneBeachRank,refreshInterval:0},function(t){var e=(s.curRanks=t).ranks,i=t.selfRank;if(0!=e.length){for(var a=1;a<4;a++){var n=e[a-1];s.updateTop3Rank(a,n)}var o=[];e.forEach(function(t,e){2<e&&o.push({rankInfo:t})}),s.list_item.dataProvider=new eui.ArrayCollection(o)}s.gp_empty.visible=0==s.list_item.dataProvider.length;var r=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO;s.playerHead_self.updateData({vo:r}),s.lb_name_self.text=r.name,s.lb_rank_self.text=i&&i.rank||"暂无排名",s.lb_tips_popularity.text="累计获得星沙: "+(i&&i.key||0),s.lb_light_self.text=""})},i.prototype.updateTop3Rank=function(e,t){var i=this,a=this["img_nobody"+e],n=this["role_"+e],o=this["lb_popularity_"+e],r=this["lb_name_"+e],s=this["lb_light_"+e];t?(a.visible=!1,n.visible=!0,this["gp_info_"+e],o.text="第"+t.rank+"名",r.text=t.playerBaseInfo.name,s.text=t.key+"",c.GameMVC.playerPy.GetPublicPlayerBaseInfo([t.playerBaseInfo.playerId],function(t){n.update({vo:{fashionCode:t[0].baseInfo.fashionCode}}),i.top3FashionInfo[e]={vo:{fashionCode:t[0].baseInfo.fashionCode}},n.visible=!1,egret.setTimeout(function(){i.stage&&(n.onChangingDir(1),n.visible=!0)},i,1e3)})):(a.visible=!0,n.visible=!1,o.text="累计获得星沙: 0",r.text="虚席以待")},i.prototype.initEffect=function(){UIActionManager.addEffect(this.gp_rank1,"common_activity_yuandanjie_06",{offectX:0,offectY:0,childIndex:2,scaleX:.7,scaleY:.7}),UIActionManager.addEffect(this.gp_rank2,"common_activity_yuandanjie_07",{offectX:0,offectY:0,childIndex:2}),UIActionManager.addEffect(this.gp_rank3,"common_activity_yuandanjie_08",{offectX:0,offectY:0,childIndex:2})},i);function i(){var t=e.call(this)||this;return t.top3FashionInfo={},t.skinName="Activity288Skin",t}c.Activity346=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.playerHead.addTapEvent(function(){c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),t.data.rankInfo.playerBaseInfo&&t.data.rankInfo.playerBaseInfo.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:t.data.rankInfo.playerBaseInfo.playerId}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},o.prototype.dataChanged=function(){var t=this.data.rankInfo;this.lb_rank.text=t.rank.toString()||"";var e=t.playerBaseInfo;this.playerHead.updateData({vo:e}),this.lb_name.text=e.name,this.lb_popularity.text="累计获得星沙: "+t.key,this.lb_light.text=""},o);function o(){var t=a.call(this)||this;return t.skinName="Activity288ItemSkin",t}}(game=game||{}),function(r){var s,t=(s=r.ActivityCommonFull,__extends(e,s),e.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),UIActionManager.addEffect(this.gp_effect,"common_activity_zhounianqing_01",{offectX:0,offectY:0}),this.activateComponent(),this.addNotice()},e.prototype.updateView=function(t){var e=this;s.prototype.updateView.call(this,t),this.code=EActivityType.BeachDiaoBao;var i=r.GameMVC.activityPy.allActivityData[EActivityType.BeachCard];i&&i.data&&i.data.startEffectDt&&i.data.endEffectDt?UIActionManager.addEffect(this.gp_341,"common_tswpguang",{childIndex:0}):UIActionManager.hideEffect(this.gp_341,"common_tswpguang");var a=r.GameMVC.activityPy.allActivityData[EActivityType.Commemoration],n=JSON.parse(a.data&&a.data.keys);if(this.gp_344.visible=0<Object.keys(n).length,this.gp_344.visible){var o=r.ActivityConfig.getActivityEndDt(EActivityType.Commemoration)-Utils.TimerManager.getServerTime();this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){o--,e.bm_time344.text=""+Utils.TimerManager.getFormatBySecond2(o)},this,1e3)}},e.prototype.activateComponent=function(){var i=this;this.gp_336.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachDiaoBao)},this),this.gp_337.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachWishTrees)},this),this.gp_338.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachRecharge)},this),this.gp_1338.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachRecharge1)},this),this.gp_339.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachItemGift)},this),this.btn_340.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachTask)},this),this.gp_341.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachCard)},this),this.gp_342.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BirthDayCard)},this),this.gp_343.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.DivideDiamond)},this),this.gp_344.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.Commemoration)},this),this.btn_345.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachReach)},this),this.btn_346.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityMed.showViewByCode(EActivityType.BeachRank)},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info,e=JSON.parse(t.content);r.GameMVC.activityMed.showHelpDialog(e[7])},this)},e.prototype.addNotice=function(){NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.BeachDiaoBao],this.gp_336,this,{percentX:193/249,percentY:97/144}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.BeachCard],this.gp_341,this,{percentX:113/153,percentY:124/172}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.Commemoration],this.gp_344,this,{percentX:.728,percentY:3/105}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.BirthDayCard],this.gp_342,this,{percentX:179/237,percentY:244/299}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.DivideDiamond],this.gp_343,this,{percentX:240/405,percentY:373/432}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.BeachTask],this.btn_340,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.BeachReach],this.btn_345,this,BTN_ICON_NOTICE_POS)},e);function e(){var t=s.call(this)||this;return t.skinName="Activity347Skin",t}r.Activity347=t}(game=game||{}),function(c){var d,t=(d=c.ActivityCommonPanel,__extends(e,d),e.prototype.childrenCreated=function(){var a=this;function t(i){var t=e["gp_answer"+i];e.answerGp.push(t),t.$children[4].touchEnabled=!1,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.lastChoseId=i;for(var t=0;t<4;t++){var e=a.answerGp[t];if(!e)return;e.$children[4].selected=i==t}},e)}d.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,this.img_answerResult.source="",UIActionManager.addEffect(this.gp_effect,"hero_activity_018_01"),this.CommonDaTanChuKuang.onCloseCB=function(){a.hide()},this.CommonDaTanChuKuang.blb_title.text="知识问答",this.CommonDaTanChuKuang.img_close.visible=!1;for(var e=this,i=0;i<4;i++)t(i);this.btn_getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.getReward({code:a.code,num:2,id:1,info:JSON.stringify({code:a.code})})},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.timer&&egret.clearTimeout(a.timer),a.gp_answerParent.touchChildren=!0,a.lastChoseId=-1,a.timer=0,a.safeData&&(a.info.updateData(a.safeData),a.safeData=void 0);for(var t=0;t<4;t++){var e=a.answerGp[t];if(!e)return;e.$children[4].selected=!1}},this),this.btn_answer.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.answer()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.info,e=JSON.parse(t.content);c.GameMVC.activityMed.showHelpDialog(e[2])},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide()},this)},e.prototype.updateView=function(t){d.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=i[0];this.bm_allCount.text=a;var n=e.data.quora,o=n&&n.quoraCode||0,r=n?n.order-1:a,s=e.data.correctNum;if(this.btn_next.visible=!1,this.btn_answer.visible=!1,this.img_answerResult.source="",this.bm_correctNum.text=s,this.timer)this.updateRewardVisible(!1),this.updateQuestion(o),this.lb_questionId.text="第"+(r+1)+"题",this.updateAnswers(o,!0,this.lastChoseId),this.btn_next.label=r==a-1?"交 卷":"下一题",this.btn_next.visible=!0,this.img_everyDayReset.visible=!1;else if(0==r)this.updateRewardVisible(!1),this.lastQuestionId=0,this.updateQuestion(o),this.updateAnswers(o,!1),this.lb_questionId.text="第1题",this.btn_answer.visible=!0,this.img_everyDayReset.visible=!0;else{var c=i[0];i[1],r<c?(this.updateRewardVisible(!1),this.updateQuestion(o),this.updateAnswers(o,!1),this.lb_questionId.text="第"+(r+1)+"题("+(r+1)+"/"+a+")",this.btn_answer.visible=!0):(this.updateRewardVisible(!0),this.updateRewards()),this.img_everyDayReset.visible=!0}this.img_everyDayReset.visible=!1}else Utils.MsgUtils.addMidMsg("活动未开启")},e.prototype.updateRewardVisible=function(t){this.img_answerDone.visible=t,this.lb_question.visible=!t,this.lb_questionId.visible=!t,this.gp_rewardGp.visible=t,this.gp_answers.visible=!t},e.prototype.updateQuestion=function(t){var e=c.Config.quoraConfig()[t];e?this.lb_question.textFlow=(new egret.HtmlTextParser).parse(e.question):this.lb_question.text="找不到题目配置"},e.prototype.updateAnswers=function(t,e,i){void 0===i&&(i=-1);var a=c.Config.quoraConfig()[t];if(a){for(var n=JSON.parse(a.answer),o=0;o<4;o++){var r=n[o],s=!!r;e?this.updateAnswer(o,o+1==a.correct,r,s,i==o):this.updateAnswer(o,void 0,r,s,i==o)}e?this.lastChoseId+1==a.correct?DragonBoneTools.playOnce({effectName:"common_hdzq",parent:this,x:this.width/2,y:this.height/2-20,doneCB:function(){}}):DragonBoneTools.playOnce({effectName:"common_hdcw",parent:this,x:this.width/2,y:this.height/2-20,doneCB:function(){}}):this.img_answerResult.source=""}else for(o=0;o<4;o++)this.updateAnswer(o,void 0,"",!1)},e.prototype.updateAnswer=function(t,e,i,a,n){void 0===i&&(i=""),void 0===a&&(a=!0),void 0===n&&(n=!1);var o=this.answerGp[t];if(o){var r=o.$children[1],s=o.$children[2],c=o.$children[3];s&&(s.text=this.num2letter[t]+". "+i),c.visible=!1,0==a?(o.parent.removeChild(o),o.visible=!1):null==e?(o.visible=!0,r.visible=!1):(o.visible=!0,r.visible=!0,r.source=e?"jsjhd_img_gou_png":"jsjhd_img_cha_png")}},e.prototype.updateRewards=function(){var t=this.info;if(t&&t.data){var e=JSON.parse(t.content);t.data.isTargeted?c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.RECEIVED):c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.AVAILABLE),this.gp_rewards.removeChildren(),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,t.data.rewards),e[1],t.data.correctNum}},e.prototype.answer=function(){var e=this;if(this.lastChoseId<0)Utils.MsgUtils.addMidMsg("请选择答案");else{var i=c.ActivityConfig.Config[this.code],t=(i.getRewardName,this.info.data.quora);if(t){this.gp_answerParent.touchChildren=!1;var a=egret.setTimeout(function(){e.gp_answerParent.touchChildren=!0},this,3e3),n={order:t.order,quoraCode:t.quoraCode,optionNum:this.lastChoseId+1};Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:1,info:JSON.stringify(n)}).then(function(t){e.log(i.name+"——领取","DoCommonOperationR",t),a&&egret.clearTimeout(a),e.timer&&egret.clearTimeout(e.timer),e.timer=egret.setTimeout(function(){e.gp_answerParent.touchChildren=!0,e.lastChoseId=-1,e.timer=0,e.info.updateData(t.info),e.safeData=void 0},e,3e6),e.safeData=t.info,e.updateView()})}}},e.prototype.onDestroy=function(){this.timer&&egret.clearTimeout(this.timer),this.safeData&&this.info.updateData(this.safeData)},e);function e(){var t=d.call(this)||this;return t.lastQuestionId=0,t.lastChoseId=-1,t.num2letter=["A","B","C","D","E"],t.safeData=void 0,t.answerGp=[],t.skinName="Activity269Skin2",t}c.Activity269=t}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity271Skin",t}t.Activity271=e}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity272Skin",t}t.Activity272=e}(game=game||{}),function(t){var e,i=(e=t.ActivityCommonFull,__extends(a,e),a.groupActivityCode={entrance:EActivityType.QingMing,keng:EActivityType.QingMingKeng,soup:EActivityType.QingMingSoup,task:EActivityType.QingMingTask,event:EActivityType.QingMingRandomEvent,shoot:EActivityType.QingMingShoot,recharge:EActivityType.QingMingRecharge},a);function a(){return null!==e&&e.apply(this,arguments)||this}t.Activity235=i}(game=game||{}),function(l){var e,t=(e=BasePanel,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){return l.GameMVC.activityPy.allActivityData[l.Activity235.groupActivityCode.event]},enumerable:!0,configurable:!0}),i.prototype.initList=function(){this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.itemRenderer=n,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.heroModel_0.update({model:"hero_086_03",isStatic:!0})},i.prototype.updateView=function(t){t&&t.cb&&(this.cb=t.cb);var o=this.info.content[2],e=JSON.parse(this.info.data.gifts),r=l.GameMVC.rechargePy.goodList,s=[],c=Utils.TimerManager.getServerTime();e.forEach(function(t){var e={uuid:t.uuid,info:t,config:void 0,goodInfo:void 0,chosen:!1};for(var i in o){var a=o[i];if(a[0]===t.code){e.config=a;break}}for(var i in r){var n=r[i];if(Number(n.id)===e.config[1]){e.goodInfo=n;break}}0<t.triggerDt+e.config[3]-c&&s.push(e)}),0<s.length?(this.ac_item.source=s,this.ac_item.refresh(),this.onItemTap(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[l.Activity235.groupActivityCode.keng]),this.cb&&this.cb()):(this.cb&&this.cb(),this.hide())},i.prototype.onItemTap=function(t){this.curData=t&&t.item||this.ac_item.source[0],this.updateSelected(this.curData.uuid),this.updateContent(this.curData)},i.prototype.updateSelected=function(e){this.ac_item.source.forEach(function(t){t.chosen=t.uuid===e}),this.ac_item.replaceAll(this.ac_item.source)},i.prototype.updateContent=function(t){var e=this,i=t.config;this.gp_reward.removeChildren(),l.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,i[2],1);var a=t.info;this.timer&&egret.clearInterval(this.timer);var n=Utils.TimerManager.getServerTime(),o=a.triggerDt+i[3]-n;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(o),this.timer=egret.setInterval(function(){0<o?e.lb_time.text=Utils.TimerManager.getFormatBySecond1(--o):(egret.clearInterval(e.timer),e.updateView())},this,1e3);var r=t.goodInfo;r?(this.icon_cost.visible=!1,this.btn_purchase.label=""+r.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix):(this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:i[4][0],style:CommonIconStyle.RIGHT}),this.btn_purchase.label="")},i.prototype.activateComponent=function(){var i=this;this.CommonDaTanChuKuang.blb_title.text="礼包",this.CommonDaTanChuKuang.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=l.Activity235.groupActivityCode.event,t=i.curData.uuid;i.curData.config[1]?l.GameMVC.rechargePy.purchase(i.curData.goodInfo,2,t,JSON.stringify({uuid:t,activityType:e}),{code:t,activityType:e},function(){}):Utils.Socket.send("activity","DoCommonOperation",{code:e,id:3,info:t}).then(function(t){l.GameMVC.activityPy.updateData_View_Reward(e,t),i.cb&&i.cb(),i.updateView(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[l.Activity235.groupActivityCode.keng])})},this)},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityMidAutumnRewardAllPanelSkin",t}l.Activity238=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.dataChanged=function(){var t=this.data.config;this.img_icon.source=t[9]+"_png",this.bm_title.text=t[10],this.updateSelected()},o.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},o);function o(){var t=a.call(this)||this;return t.oldY=-5,t.oldId=0,t.activityProxy=l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N),t.skinName="ActivityRootPanel_ActivityItem",t}var r,s=(r=BasePanel,__extends(c,r),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.hero_model.update({code:41150037,isStatic:!0})},c.prototype.updateView=function(t){var e=this.proxy.allActivityData[l.Activity235.groupActivityCode.keng];if(e&&e.data){var i=e.data.playerInfo;this.gp_rewards.removeChildren();var a=i.treeRewards;l.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,a)}else this.hide()},c.prototype.perClose=function(){this.proxy.DoCommonOperation(l.Activity235.groupActivityCode.keng,1,3)},c);function c(){var t=r.call(this)||this;return t.proxy=l.GameMVC.activityPy,t.skinName="ActivityMidAutumnIdelRewardSkin",t}l.ActivityMidAutumnIdelRewardPanel=s;var d,h=(d=BasePanel,__extends(p,d),p.prototype.childrenCreated=function(){var i=this;d.prototype.childrenCreated.call(this),this.rootPanel.gp_title.visible=!1,this.rootPanel.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=l.Activity235.groupActivityCode.event,t=i.giftInfo.uuid;i.config[1]?l.GameMVC.rechargePy.purchase(i.goodInfo,2,t,JSON.stringify({uuid:t,activityType:e}),{code:t,activityType:e},function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[l.Activity235.groupActivityCode.keng]),i.cb&&i.cb(),i.hide()}):Utils.Socket.send("activity","DoCommonOperation",{code:e,id:3,info:t}).then(function(t){l.GameMVC.activityPy.updateData_View_Reward(e,t),NoticeManager.updateNotice(NT.ALL_ACTIVITY[l.Activity235.groupActivityCode.keng]),i.cb&&i.cb(),i.hide()})},this),this.updateView()},p.prototype.updateView=function(t){var e=this,i=l.GameMVC.activityPy.allActivityData[l.Activity235.groupActivityCode.event],a=JSON.parse(i.data.gifts);if(this.giftInfo)a.every(function(t){return t.uuid!=e.giftInfo.uuid})&&this.hide();else{this.code,a.forEach(function(t){(!e.giftInfo||t.triggerDt>e.giftInfo.triggerDt)&&(e.giftInfo=t)});var n=i.content[2];for(var o in n){var r=n[o];if(r[0]===this.giftInfo.code){this.config=r;break}}if(this.lb_desc.text=this.config[8],this.gp_rewards.removeChildren(),l.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.config[2],1),this.config[1]){var s=l.GameMVC.rechargePy.goodList;for(var o in s){var c=s[o];if(Number(c.id)===this.config[1]){this.goodInfo=c;break}}this.icon_cost.visible=!1,this.btn_purchase.label=""+this.goodInfo.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix}else this.btn_purchase.label="",this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:this.config[4][0],style:CommonIconStyle.RIGHT});this.timer&&egret.clearInterval(this.timer);var d=Utils.TimerManager.getServerTime(),h=this.giftInfo.triggerDt+this.config[3]-d;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(h),this.timer=egret.setInterval(function(){0<h?e.lb_time.text=Utils.TimerManager.getFormatBySecond1(--h):(egret.clearInterval(e.timer),e.hide())},this,1e3)}},p.prototype.onDestroy=function(){d.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},p);function p(t){var e=d.call(this)||this;return e.skinName="ActivityMidAutumnRewardPanelSkin",e.code=t.code,e.cb=t.cb,e}l.ActivityMidAutumnRewardPanel=h}(game=game||{}),function(r){var s,t=(s=r.ActivityCommonTaskListPanel,__extends(e,s),e.prototype.childrenCreated=function(){var t=this;s.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.purchaseEnjoyCard(t.code)},this)},e.prototype.updateView=function(t){if(s.prototype.updateView.call(this,t),this.info&&this.info.data){var e=this.info,i=e.data.startEffectDt,a=e.data.endEffectDt,n=this.rechargeProxy.getEnjoyCardInfo(this.code);if(!n){var o=JSON.parse(this.info.content);n=r.GameMVC.rechargePy.getMonthCardInfoById(o[2])}n&&(this.btn_buy.label=""+n.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix),i&&a?(o=JSON.parse(e.content),this.btn_buy.label="",this.btn_buy.skinName="skins.ButtonSkinSure",this.btn_buy.label="已购买",UIActionManager.setGrey(this.btn_buy,!1),this.btn_buy.scaleX=this.btn_buy.scaleY=1,this.btn_buy.touchEnabled=!1,e.data.targeted,Math.floor((a-i)/24/3600),this.bm_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(a-Utils.TimerManager.getServerTime())):(this.btn_buy.touchEnabled=!0,this.bm_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(e.endDt-Utils.TimerManager.getServerTime())),this.list_items.dataProvider=new eui.ArrayCollection(this.getDataList()),this.updateTitle()}},e.prototype.getDataList=function(){var s=this,t=this.info;if(!t||!t.data)return[];var c=JSON.parse(t.content),d=(t.data.startEffectDt,t.data.endEffectDt,t.data.targeted),e=new Date(1e3*t.startDt);e.setHours(23,59,59);var h=Math.ceil((Utils.TimerManager.getServerTime()-(e.getTime()/1e3+1))/24/3600);++h<=0&&(h=1);var i=1;for(var a in d.sort(function(t,e){return t-e}),d){if(d[a]!=i)break;i++}function n(t){var e=c[1][t],i=e[0],a=e[1],n=0*c[0]+i,o=REWARD_STATUS.AVAILABLE;0<=d.indexOf(n)?o=REWARD_STATUS.RECEIVED:h<n&&(o=REWARD_STATUS.UNAVAILABLE);var r={num:t,id:i,rewards:a,status:o,title:"第"+(t+1)+"天可领取",btnFunc:function(){s.getReward({day:n,code:s.code})}};l.push(r)}for(var l=[],o=0;o<c[1].length;o++)n(o);return this.commonSortDataList(l),l},e.prototype.purchaseEnjoyCard=function(t){var e=this.rechargeProxy.getEnjoyCardInfo(t);if(!e){var i=JSON.parse(this.info.content);e=r.GameMVC.rechargePy.getMonthCardInfoById(i[2])}e?(e.isMonthCard=!0,this.rechargeProxy.purchase(e,2,String(t),JSON.stringify({uuid:t,activityType:this.code,code:this.code}),{activityType:this.code,code:this.code})):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},e);function e(){var t=s.call(this)||this;return t.rechargeProxy=r.AppFacade.getInstance().retrieveProxy(r.RechargePy.N),t.skinName="Activity327Skin",t.code=EActivityType.LiuYiCard,t}r.Activity327=t}(game=game||{}),function(t){var n,e=(n=BasePanel,__extends(i,n),i.prototype.childrenCreated=function(){var e=this;function t(t){i["btn_dice"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=t,e.hide()},i)}n.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="选择点数",this.rootPanel.onCloseCB=function(){e.hide()};for(var i=this,a=1;a<7;a++)t(a)},i);function i(){var t=n.call(this)||this;return t.skinName="ActivityMagpieDiceSelectSkin",t}t.ActivityMagpieDiceSelectPanel=e}(game=game||{}),function(t){var e,i=(e=BasePanel,__extends(a,e),a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),egret.clearInterval(this.bookTimer),egret.clearInterval(this.bookTimer0)},a.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.gp_touch,egret.TouchEvent.TOUCH_TAP,function(){t.allDone&&t.hide()},this),this.go()},a.prototype.go=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.tg_changjing1.play(),[4,this.chagnjing1()];case 1:return t.sent(),this.tg_changjing2.play(),[4,this.chagnjing2()];case 2:return t.sent(),this.tg_changjing3.play(),[4,this.chagnjing3()];case 3:return t.sent(),this.tg_changjing4.play(),[4,this.chagnjing4()];case 4:return t.sent(),[2]}})})},a.prototype.popTips=function(t,e,i,a,n){var o=this;this.lb_content.text="",this.lb_content.size=20,this.gp_chat1.scaleX=1,this.gp_chat1.x=this.gp_chat1.y=0;var r=void 0,s=void 0;Array.isArray(i)?(r=i[0].content,this.lb_content.size=i[0].size||this.lb_content.size,s=i[1]):r=i,this.gp_chat1.visible=!0,t.scaleX<0&&(this.gp_chat1.scaleX*=-1),this.gp_chat1.y=e?-e.height*e.scaleY+30:30,t.addChild(this.gp_chat1),egret.clearInterval(this.bookTimer),this.bookTimer=egret.setInterval(function(){var t=o.lb_content.text.length;if(r[t])o.lb_content.text+=r[t];else{if(s){var e=new eui.Image;e.source=s.src,e.x=s.x,e.y=s.y,e.name="img_emoji",o.gp_chat1.addChild(e)}egret.clearInterval(o.bookTimer),egret.setTimeout(function(){o.lb_content.text="",o.gp_chat1.visible=!1;var t=o.gp_chat1.getChildByName("img_emoji");t&&o.gp_chat1.removeChild(t),n&&n()},o,a)}},this,100)},a.prototype.popTips0=function(t,e,i,a,n){var o=this;this.lb_content0.text="",this.lb_content0.size=20,this.gp_chat0.scaleX=1,this.gp_chat0.x=this.gp_chat0.y=0;var r=void 0,s=void 0;Array.isArray(i)?(r=i[0].content,this.lb_content0.size=i[0].size||this.lb_content0.size,s=i[1]):r=i,this.gp_chat0.visible=!0,t.scaleX<0&&(this.gp_chat0.scaleX*=-1),this.gp_chat0.y=e?-e.height*e.scaleY+30:30,t.addChild(this.gp_chat0),egret.clearInterval(this.bookTimer0),this.bookTimer0=egret.setInterval(function(){var t=o.lb_content0.text.length;if(r[t])o.lb_content0.text+=r[t];else{if(s){var e=new eui.Image;e.source=s.src,e.x=s.x,e.y=s.y,e.name="img_emoji",o.gp_chat0.addChild(e)}egret.clearInterval(o.bookTimer0),egret.setTimeout(function(){o.lb_content0.text="",o.gp_chat0.visible=!1;var t=o.gp_chat0.getChildByName("img_emoji");t&&o.gp_chat0.removeChild(t),n&&n()},o,a)}},this,100)},a.prototype.jiaCloud=function(t){var e=new eui.Image;e.source="_qqqy_m_json.qixihuodon_xjc_yun",e.anchorOffsetX=70,e.anchorOffsetY=23,t.addChild(e)},a.prototype.reset=function(){this.gp_r_0.removeChildren(),this.gp_r_1.removeChildren(),this.gp_r_2.removeChildren(),this.gp_r_3.removeChildren(),this.gp_r_4.removeChildren(),this.gp_r_5.removeChildren(),this.gp_r_6.removeChildren(),this.gp_r_7.removeChildren(),this.gp_root.setChildIndex(this.gp_r_4,1),this.gp_root.setChildIndex(this.gp_r_2,2),this.gp_root.setChildIndex(this.gp_r_3,3),this.gp_root.setChildIndex(this.gp_r_1,4),this.gp_root.setChildIndex(this.gp_r_0,5),this.gp_root.setChildIndex(this.gp_r_5,6),this.gp_root.setChildIndex(this.gp_r_6,7),this.gp_root.setChildIndex(this.gp_r_7,8)},a.prototype.chagnjing1=function(){var o=this;return new Promise(function(t,e){o.img_bg.source="qixihuodon_xjc_bg_1_png";var i=new eui.Image;i.source="_qqqy_m_json.qixihuodon_xjc_01",i.anchorOffsetX=25,i.anchorOffsetY=55,o.gp_r_4.addChild(i);var a,n=new eui.Image;n.source="_qqqy_m_json.qixihuodon_xjc_02",n.anchorOffsetX=21,n.anchorOffsetY=47,o.gp_r_5.addChild(n),DragonBoneTools.create("bangxiannv",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_3.addChild(t)},o),DragonBoneTools.create("yaochixiannv",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_2.addChild(t)},o),DragonBoneTools.create("fangzhixiannv",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_1.addChild(t)},o),DragonBoneTools.create("zhinv",function(t){this.jiaCloud(t),(a=t).animation.play(),this.gp_r_0.addChild(t)},o),egret.Tween.get(o).wait(5e3).call(function(){o.popTips(o.gp_r_0,a,o.CONTENT[0],1500)}).wait(6e3).call(function(){t()})})},a.prototype.chagnjing2=function(){var n=this;return new Promise(function(t,e){var i,a;n.img_bg.source="qixihuodon_xjc_bg_2_png",n.img_qixihuodon_xjc_txt.source="_qqqy_m_json.qixihuodon_xjc_txt_02",n.reset(),DragonBoneTools.create("zhinv",function(t){this.jiaCloud(t),(i=t).animation.play(),this.gp_r_0.addChild(t)},n),DragonBoneTools.create("niulang",function(t){(a=t).animation.play(),this.gp_r_1.addChild(t)},n),DragonBoneTools.create("niu",function(t){t.animation.play(),this.gp_r_2.addChild(t)},n),n.gp_r_2.parent.setChildIndex(n.gp_r_2,-1),egret.Tween.get(n).wait(4500).call(function(){n.popTips(n.gp_r_1,a,n.CONTENT[1],1500)}).wait(500).call(function(){n.popTips0(n.gp_r_0,i,n.CONTENT[2],1500)}).wait(4e3).call(function(){t()})})},a.prototype.chagnjing3=function(){var r=this;return new Promise(function(t,e){var i,a,n,o;r.img_bg.source="qixihuodon_xjc_bg_3_png",r.img_qixihuodon_xjc_txt.source="_qqqy_m_json.qixihuodon_xjc_txt_03",r.reset(),DragonBoneTools.create("zhinv",function(t){(i=t).animation.play(),this.gp_r_5.addChild(t)},r),DragonBoneTools.create("niulang",function(t){(a=t).animation.play(),this.gp_r_6.addChild(t)},r),DragonBoneTools.create("taoyuantianbing",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_4.addChild(t)},r),DragonBoneTools.create("taoyuantianbing",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_3.addChild(t)},r),DragonBoneTools.create("taoyuantianbing",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_2.addChild(t)},r),DragonBoneTools.create("yudi",function(t){this.jiaCloud(t),(n=t).animation.play(),this.gp_r_1.addChild(t)},r),DragonBoneTools.create("wangmu",function(t){this.jiaCloud(t),(o=t).animation.play(),this.gp_r_0.addChild(t)},r),egret.Tween.get(r).wait(5e3).call(function(){r.popTips(r.gp_r_1,n,r.CONTENT[3],750)}).wait(1e3).call(function(){r.popTips0(r.gp_r_0,o,r.CONTENT[4],750)}).wait(1500).call(function(){r.gp_r_2.parent.setChildIndex(r.gp_r_2,-1),r.gp_r_3.parent.setChildIndex(r.gp_r_3,-1)}).wait(1e3).call(function(){r.gp_r_2.parent.setChildIndex(r.gp_r_2,3)}).wait(500).call(function(){r.popTips(r.gp_r_5,i,r.CONTENT[5],750)}).wait(500).call(function(){r.popTips0(r.gp_r_6,a,r.CONTENT[6],750)}).wait(3500).call(function(){t()})})},a.prototype.chagnjing4=function(){var i=this;return new Promise(function(t,e){i.img_bg.source="qixihuodon_xjc_bg_4_png",i.img_qixihuodon_xjc_txt.source="_qqqy_m_json.qixihuodon_xjc_txt_04",i.reset(),DragonBoneTools.create("zhinv",function(t){this.jiaCloud(t),t.animation.play(),this.gp_r_0.addChild(t)},i),egret.Tween.get(i).wait(2e3).call(function(){i.popTips(i.gp_r_1,void 0,i.CONTENT[7],1500)}).wait(3e3).call(function(){i.allDone=!0,egret.Tween.get(i.img_enter,{loop:!0}).to({alpha:.5},250).to({alpha:1},250)})})},a);function a(){var t=e.call(this)||this;return t.allDone=!1,t.CONTENT=[[{content:"原谅我放荡不羁爱自由!",size:18}],[{content:"哇，女神！\n\n "},{src:"_qqqy_m_json.bq_aixin",x:55,y:35}],[{content:"好俊俏的少年\n！\n "},{src:"_qqqy_m_json.bq_haixiu",x:80,y:30}],"你配吗？","你不配！","牛牛~~","织织！！","织织，等我！"],t.skinName="ActivityMagpieJuChangViewSkin",t}t.ActivityMagpieJuChangView=i}(game=game||{}),function(c){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){var a=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.img_close.visible=!1,this.CommonDaTanChuKuang.gp_title.visible=!1,this.btn_shitou.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.selectIndex=0,a.updateImg()},this),this.btn_jiandao.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.selectIndex=1,a.updateImg()},this),this.btn_bu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.selectIndex=2,a.updateImg()},this),this.btn_comfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=FingerGameType.Rock;switch(a.selectIndex){case 0:i=FingerGameType.Rock;break;case 1:i=FingerGameType.Scissors;break;case 2:i=FingerGameType.Paper}a.actProxy.DoCommonOperation(a.code,i,a.eventNum,function(t,e){a.chooseEvent(i,t,e)},MagpieEventType.FingerGame)},this),this.updateView()},e.prototype.updateView=function(){var t=c.Config.magpieEventConfigsByCode(this.params.eventId);this.gp_reward.removeChildren();var e=JSON.parse(t.detail);if(e&&e[0])for(var i in e[0]){var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({id:e[0][i][1],num:e[0][i][2]}),this.gp_reward.addChild(a)}this.updateImg()},e.prototype.updateImg=function(){this.img_gou.horizontalCenter=132*(this.selectIndex-1),UIActionManager.setGrey(this.btn_shitou,0!=this.selectIndex),UIActionManager.setGrey(this.btn_jiandao,1!=this.selectIndex),UIActionManager.setGrey(this.btn_bu,2!=this.selectIndex)},e.prototype.chooseEvent=function(n,o,r){var s=this;this.gp_effect.visible=!0,this.gp_effect.removeChildren(),this.gp_hands.visible=!1,DragonBoneTools.playOnce({effectName:"common_caiquan",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,doneCB:function(){var t="";switch(n){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}(e=new eui.Image(t)).verticalCenter=-100,e.left=0,s.gp_effect.addChild(e);var e,i=JSON.parse(o.info);switch(i.rKey){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}(e=new eui.Image(t)).verticalCenter=-100,e.right=0,e.scaleX=-1,s.gp_effect.addChild(e);var a=s.judgeResult(n,i.rKey);egret.setTimeout(function(){if(s.hide(),3==a)r&&r(s.code,o);else{var t={ret:o,doneCB:r,resultShow:a,config:c.Config.magpieEventConfigsByCode(s.params.eventId)};PopUpManager.addPopUp({obj:new c.ActivityMagpieMoraResultPanel(t)})}},s,1500)}})},e.prototype.judgeResult=function(t,e){var i=1;switch(t){case FingerGameType.Rock:e==FingerGameType.Rock?i=3:e==FingerGameType.Paper?i=2:e==FingerGameType.Scissors&&(i=1);break;case FingerGameType.Paper:e==FingerGameType.Rock?i=1:e==FingerGameType.Paper?i=3:e==FingerGameType.Scissors&&(i=2);break;case FingerGameType.Scissors:e==FingerGameType.Rock?i=2:e==FingerGameType.Paper?i=1:e==FingerGameType.Scissors&&(i=3)}return i},e);function e(t){var e=i.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.actProxy=c.GameMVC.activityPy,e.code=EActivityType.MagpieActivity,e.eventNum=MagpieActivityOper.TriggerEvent,e.selectIndex=0,e.skinName="ActivityMagpieMoraPanelSkin2",e.params=t,e}c.ActivityMagpieMoraPanel=t}(game=game||{}),function(i){var a,t=(a=BasePanel,__extends(e,a),e.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.params.doneCB&&t.params.doneCB(t.code,t.params.ret)},this),this.updateView()},e.prototype.updateView=function(){var t=1==this.params.resultShow,e=t?"common_shengli_22":"common_zhanbai_22";this.gp_win.visible=t,this.gp_lose.visible=!t,this.gp_effect.removeChildren();var i=JSON.parse(this.params.config.desc2);if(this.lb_text.text=t?i[0]:i[1],DragonBoneTools.create(e,function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height,t.animation.play(),this.gp_effect.addChild(t)},this),t&&(this.gp_reward.removeChildren(),this.params.ret&&this.params.ret.clientReward&&this.params.ret.clientReward.rewards)){var a=this.params.ret.clientReward.rewards;for(var n in a){var o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.7,o.updateData({code:a[n].code,type:a[n].type,num:a[n].num}),this.gp_reward.addChild(o)}}},e);function e(t){var e=a.call(this)||this;return e.actProxy=i.GameMVC.activityPy,e.code=EActivityType.MagpieActivity,e.eventNum=MagpieActivityOper.TriggerEvent,e.params=void 0,e.doneCB=void 0,e.skinName="ActivityMagpieMoraResultPanelSkin",e.params=t,e}i.ActivityMagpieMoraResultPanel=t}(game=game||{}),function(s){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.commonDaTanKuang.gp_title.visible=!1,this.commonDaTanKuang.img_close.visible=!1,this.updateView()},e.prototype.updateView=function(){var t=this.params.talkId,e=s.Config.magpieConfigs()[t],i=JSON.parse(e.options),a=JSON.parse(e.resultDesc),n=JSON.parse(e.optionEvent);this.lb_desc.text=e.question,this.img_di.source=e.img+"_png";for(var o=0;o<i.length;o++){var r=new c;r.updateEvent({chooseNum:o+1,text:i[o],result:a[o],cb:this.hide.bind(this),optionEvent:n}),this.gp_event.addChild(r)}},e);function e(t){var e=i.call(this)||this;return e.actProxy=s.GameMVC.activityPy,e.code=EActivityType.MagpieActivity,e.eventNum=MagpieEventType.Talk,e.skinName="DungeonRandomEventPanelSkin",e.params=t,e}s.ActivityMagpieRandomEventPanel=t;var a,c=(a=eui.Component,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},n.prototype.updateEvent=function(t){this.info=t,this.lb_text.text=t.text},n.prototype.touchEvent=function(){var n=this;this.actProxy.DoCommonOperation(this.code,this.info.chooseNum,this.eventNum,function(t,e){var i={ret:t,text:n.info.result,doneCB:e};if(0!=n.info.optionEvent.length){var a=n.info.optionEvent[n.info.chooseNum-1][0];a?(i.doneCB&&i.doneCB(n.code,i.ret),s.AppFacade.getInstance().showSubView(s.ActivityMediator.N,s.ActivityMediator.SV.MAGPIE_GIFT,{eventId:a})):PopUpManager.addPopUp({obj:new s.ActivityMagpieRandomResultPanel(i)})}else PopUpManager.addPopUp({obj:new s.ActivityMagpieRandomResultPanel(i)});n.info.cb&&n.info.cb()},MagpieEventType.Talk)},n);function n(){var t=a.call(this)||this;return t.info=void 0,t.code=EActivityType.MagpieActivity,t.eventNum=MagpieActivityOper.TriggerEvent,t.actProxy=s.GameMVC.activityPy,t.skinName="DungeonRandomEventItemSkin",t.gp_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.gp_root.scaleX=t.gp_root.scaleY=.9},t),t.gp_root.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.gp_root.scaleX=t.gp_root.scaleY=1,t.touchEvent()},t),t.gp_root.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.gp_root.scaleX=t.gp_root.scaleY=1},t),t.gp_root.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.gp_root.scaleX=t.gp_root.scaleY=1},t),t}s.ActivityMagpieRandomEventItem=c}(game=game||{}),function(i){var a,t=(a=BasePanel,__extends(e,a),e.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.params.doneCB&&t.params.doneCB(t.code,t.params.ret)},this),this.updateView(this.params)},e.prototype.updateView=function(t){this.lb_desc.text=t.text;var e=[],i=void 0;for(var a in t&&t.ret&&t.ret.clientReward&&(i=t.ret.clientReward),i)for(var n in i[a])i[a][n]&&e.push(i[a][n]);for(var a in e){var o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.75,o.updateData({id:e[a].code,num:e[a].num,type:e[a].type}),this.gp_reward.addChild(o)}},e);function e(t){var e=a.call(this)||this;return e.proxy=i.GameMVC.dungeonPy,e.resultConfig=void 0,e.code=EActivityType.MagpieActivity,e.skinName="DungeonRandomResultPanelSkin",e.params=t,e}i.ActivityMagpieRandomResultPanel=t}(game=game||{}),function(d){var e,t=(e=BasePanel,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){return d.GameMVC.activityPy.allActivityData[EActivityType.MagpieActivity]},enumerable:!0,configurable:!0}),i.prototype.initList=function(){this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.itemRenderer=n,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.updateView()},i.prototype.updateView=function(){var o=this.info.content[4],t=JSON.parse(this.info.data.gifts),r=d.GameMVC.rechargePy.goodList,s=[],c=Utils.TimerManager.getServerTime();t.forEach(function(t){var e={uuid:t.uuid,info:t,config:void 0,goodInfo:void 0,chosen:!1};for(var i in o){var a=o[i];if(a[0]===t.code){e.config=a;break}}for(var i in r){var n=r[i];if(Number(n.id)===e.config[1]){e.goodInfo=n;break}}0<t.triggerDt+e.config[3]-c&&s.push(e)}),0<s.length?(this.ac_item.source=s,this.ac_item.refresh(),this.onItemTap()):this.hide()},i.prototype.onItemTap=function(t){this.curData=t&&t.item||this.ac_item.source[0],this.updateSelected(this.curData.uuid),this.updateContent(this.curData)},i.prototype.updateSelected=function(e){this.ac_item.source.forEach(function(t){t.chosen=t.uuid===e}),this.ac_item.replaceAll(this.ac_item.source)},i.prototype.updateContent=function(t){var e=this,i=t.config;this.armature.armatureName=i[7],this.armature.play("daiji"),this.img_desc.source=i[9]+"_png",this.gp_reward.removeChildren(),d.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,i[2],1);var a=t.info;this.timer&&egret.clearInterval(this.timer);var n=Utils.TimerManager.getServerTime(),o=a.triggerDt+i[3]-n;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(o),this.timer=egret.setInterval(function(){0<o?e.lb_time.text=Utils.TimerManager.getFormatBySecond1(--o):(egret.clearInterval(e.timer),e.updateView())},this,1e3);var r=t.goodInfo;r?(this.icon_cost.visible=!1,this.btn_purchase.label=r.price+"元"):(this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:i[8][0],style:CommonIconStyle.RIGHT}),this.btn_purchase.label="")},i.prototype.activateComponent=function(){var i=this;this.CommonDaTanChuKuang.blb_title.text="礼包",this.CommonDaTanChuKuang.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=EActivityType.MagpieActivity,t=i.curData.uuid;i.curData.config[1]?d.GameMVC.rechargePy.purchase(i.curData.goodInfo,2,t,JSON.stringify({uuid:t,activityType:e}),{code:t,activityType:e},function(){i.updateView()}):Utils.Socket.send("activity","DoCommonOperation",{code:e,id:MagpieActivityOper.BuyGift,info:t}).then(function(t){d.GameMVC.activityPy.updateData_View_Reward(e,t),i.updateView()})},this)},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityMagpieRewardAllPanelSkin",t}d.ActivityMagpieRewardAllPanel=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.dataChanged=function(){var t=this.data.config;this.img_icon.source=t[5]+"_png",this.bm_title.text=t[6],this.updateSelected()},o.prototype.updateSelected=function(){this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},o);function o(){var t=a.call(this)||this;return t.oldY=-5,t.oldId=0,t.activityProxy=d.AppFacade.getInstance().retrieveProxy(d.ActivityPy.N),t.skinName="ActivityRootPanel_ActivityItem",t}}(game=game||{}),function(u){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="礼 包",this.rootPanel.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=EActivityType.MagpieActivity,t=i.giftInfo.uuid;i.config[1]?u.GameMVC.rechargePy.purchase(i.goodInfo,2,t,JSON.stringify({uuid:t,activityType:e}),{code:t,activityType:e},function(){i.hide()}):Utils.Socket.send("activity","DoCommonOperation",{code:e,id:MagpieActivityOper.BuyGift,info:t}).then(function(t){u.GameMVC.activityPy.updateData_View_Reward(e,t),i.hide()})},this)},i.prototype.updateView=function(t){var e=this,i=u.GameMVC.activityPy.allActivityData[EActivityType.MagpieActivity],a=JSON.parse(i.data.gifts);if(this.giftInfo)a.every(function(t){return t.uuid!=e.giftInfo.uuid})&&this.hide();else{var n=t&&t.eventId,o=u.Config.magpieEventConfigs()[n];this.lb_desc.text=o.desc,a.forEach(function(t){(!e.giftInfo||t.triggerDt>e.giftInfo.triggerDt)&&(e.giftInfo=t)});var r=i.content[4];for(var s in r){var c=r[s];if(c[0]===this.giftInfo.code){this.config=c;break}}if(this.gp_rewards.removeChildren(),u.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.config[2],1),this.config[1]){var d=u.GameMVC.rechargePy.goodList;for(var s in d){var h=d[s];if(Number(h.id)===this.config[1]){this.goodInfo=h;break}}this.icon_cost.visible=!1,this.btn_purchase.label=this.goodInfo.price+"元"}else this.btn_purchase.label="",this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:this.config[8][0],style:CommonIconStyle.RIGHT});this.timer&&egret.clearInterval(this.timer);var l=Utils.TimerManager.getServerTime(),p=this.giftInfo.triggerDt+this.config[3]-l;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(p),this.timer=egret.setInterval(function(){0<p?e.lb_time.text=Utils.TimerManager.getFormatBySecond1(--p):(egret.clearInterval(e.timer),e.hide())},this,1e3)}},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.skinName="ActivityMagpieRewardPanelSkin",t}u.ActivityMagpieRewardPanel=t}(game=game||{}),function(_){var e,t=(e=_.ActivityCommonPanel,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){return this.actProxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cur_resource),this.initList(),this.btn_refresh.visible=!1,this.gp_time.visible=!1,this.updateView(),this.heroModel.update({model:"hero_skin_009_01"}),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.nowNumber++,t.nowNumber>t.pageNumber&&(t.nowNumber=t.pageNumber),t.updatePageBtnStatus()},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.nowNumber--,t.nowNumber<0&&(t.nowNumber=0),t.updatePageBtnStatus()},this)},i.prototype.initList=function(){this.list_item.removeChildren();var t=new eui.TileLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,t.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,t.requestedColumnCount=3,t.horizontalGap=-60,t.verticalGap=10,t.paddingTop=40,this.list_item.layout=t},i.prototype.updatePageBtnStatus=function(){this.btn_last.visible=0!=this.nowNumber,this.btn_next.visible=this.nowNumber!=this.pageNumber-1,this.updateList()},i.prototype.updateView=function(){this.list_item.itemRenderer=n,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list,this.allDataList=this.getDataList(),this.pageNumber=Math.ceil(this.allDataList.length/9)||1,this.cur_resource.updateBar({costs:this.moneyType,width:190,needAdd:!0}),this.updatePageBtnStatus()},i.prototype.updateList=function(){for(var t=0,e=[],i=0,a=this.allDataList;i<a.length;i++){var n=a[i],o=9*this.nowNumber,r=9*(this.nowNumber+1);o<=t&&t<r&&e.push(n),++t}this.collection_list.replaceAll(e),this.collection_list.refresh()},i.prototype.getDataList=function(){var u=this,t=this.info;if(!t||!t.data)return[];var g,m=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){g=n[1];break}}if(!g)return[];function o(t){var e=g[t],i=e[0],o=e[1],r=e[2],s=e[3],a=REWARD_STATUS.UNAVAILABLE,c=0;for(var n in m){var d=m[n];if(d.id==i){c=d.num;break}}if(r&&r.length){var h=!0;f.moneyType.forEach(function(t){t[0]==r[0][0]&&t[1]==r[0][1]&&(h=!1)}),h&&f.moneyType.push([r[0][0],r[0][1]])}s<=c?a=REWARD_STATUS.RECEIVED:y.checkEnough(r,!1)&&(a=REWARD_STATUS.AVAILABLE);var l=_.GeneralConfig.getEntityConfigByCode(o[0][0],o[0][1]),p={id:i,title:"兑换"+(l&&l.name),tips:c+"/"+s,buyTimes:s,hasBuy:c,rewards:o,costs:r,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=_.AppFacade.getInstance().retrieveMediator(_.ShopyMediator.N),i=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).getInfoByCode(r[0][1]),a=Math.floor(i.haveNum/r[0][2]),n=_.GeneralConfig.getEntityConfigByCode(o[0][0],o[0][1]).name;t.showSubView(_.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:o,costs:r,countFun:function(t){return{unit:r[0][2],total:r[0][2]*t}},name:n,limit:"[5,"+(s+1)+"]"},maxCount:s-c<a?s-c:a,buyNum:c+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(t){u.getReward({code:u.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("道具不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};v.push(p)}for(var y=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),v=[],f=this,r=0;r<g.length;r++)o(r);return v},i);function i(){var t=e.call(this)||this;return t.actProxy=_.GameMVC.activityPy,t.backpackProxy=_.GameMVC.backpackPy,t.code=EActivityType.SecondNewItemGifts,t.moneyType=[],t.pageNumber=0,t.nowNumber=0,t.allDataList=void 0,t.skinName="ShopSkin",t}_.ActivityMagpieShopPanel=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.activateComponent(),this.blb_price.visible=!0,this.img_costIcon.visible=!0,this.scaleX=.8,this.scaleY=.8},o.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},o.prototype.dataChanged=function(){var t=this.data;this.btnFunc=t.btnFunc;var e=JSON.parse(t.rewards)[0];this.backpackProxy.getInfoByTypeCodeNum(e[0],e[1],e[2]),this.baseItem.updateData({type:e[0],code:e[1],num:e[2]});var i=this.data.hasBuy;this.gp_discount.visible=!1;var a=t.buyTimes;this.leftNum=a-i,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1),this.img_onlyOne.visible=1==a,this.cost=JSON.parse(t.costs)[0];var n=this.cost[2];this.price=n,this.blb_price.text=""+this.price;var o=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);o&&o.info&&(this.img_costIcon.source=ResourceUtils.png(o.info.icon))},o);function o(){var t=a.call(this)||this;return t.shopProxy=_.AppFacade.getInstance().retrieveProxy(_.ShopPy.N),t.backpackProxy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),t.unlock=!0,t.skinName="ShopUIItemSkin",t}}(game=game||{}),function(r){var s,t=(s=r.ActivityCommonPanel,__extends(e,s),e.prototype.rand=function(){return this.POOLS[Utils.MathUtils.getRandomInt(0,this.POOLS.length-1)]},e.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this);var t=r.Config.magpieEventConfigsByCode(this.params.eventId);if(t){var e=JSON.parse(t.detail);this.gp_cups=[this.gp_0,this.gp_1,this.gp_2];for(var i=0;i<3;i++){var a=this["gp_"+i],n=customui.BaseItemFactory.create();n.updateData({reward:e[i][0]}),n.scaleX=n.scaleY=.7,n.horizontalCenter=0,n.y=21,a.addChildAt(n,1);var o=a.$children[2];a.$children[0],o.userdata_index=i,a.userdata_img=o,a.x=this.POS[i][0],a.y=this.POS[i][1],Utils.ComponentUtils.registerListener(o,egret.TouchEvent.TOUCH_TAP,this.click,this)}this.makeBtns()}},e.prototype.taiQiOrHeShang=function(t,e,i){if(void 0===e&&(e=!1),null!=t)egret.Tween.get(this.gp_cups[t].userdata_img).to({y:e?0:-100},500,egret.Ease.sineInOut).call(function(){i&&i()});else for(var a=0,n=this.gp_cups;a<n.length;a++){var o=n[a];egret.Tween.get(o.userdata_img).to({y:e?0:-100},500,egret.Ease.sineInOut)}},e.prototype.click=function(t){var e=this;if(this.canChose){var i=t.target.userdata_index;this.canChose=!1,this.taiQiOrHeShang(i,void 0,function(){e.getReward({code:e.code,id:e.eventNum,num:i+1},function(){e.hide()})})}},e.prototype.swap=function(t,e,i){var a=this;i/=this.SWAP_SPEED_SCALE,egret.Tween.get(t).to({x:e.x,y:e.y},i,egret.Ease.sineInOut),0<this.SWAP_SPEED.length?egret.Tween.get(e).to({x:t.x,y:t.y},i,egret.Ease.sineInOut).call(function(){var t=a.rand();a.swap(a.gp_cups[t[0]],a.gp_cups[t[1]],a.SWAP_SPEED.shift())}):(egret.Tween.get(e).to({x:t.x,y:t.y},i,egret.Ease.sineInOut),this.canChose=!0)},e.prototype.makeBtns=function(){var e=this;this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btn_begin.visible=!1,e.taiQiOrHeShang(),e.scheId=egret.setTimeout(function(){e.taiQiOrHeShang(void 0,!0),e.scheId=egret.setTimeout(function(){var t=e.rand();e.swap(e.gp_cups[t[0]],e.gp_cups[t[1]],e.SWAP_SPEED.shift())},e,1e3)},e,1500)},this)},e.prototype.onDestroy=function(){if(this.scheId){egret.clearTimeout(this.scheId);for(var t=0,e=this.gp_cups;t<e.length;t++){var i=e[t];egret.Tween.removeTweens(i)}}},e);function e(t){var e=s.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.eventNum=MagpieActivityOper.TriggerEvent,e.seleceIndex=0,e.POS=[[153,390],[411,390],[282,344]],e.SWAP_SPEED=[500,500,500,500,500,400,400,400,400,300,300,300,300,300],e.SWAP_SPEED_SCALE=1.5,e.POOLS=[[0,1],[0,2],[1,0],[1,2],[2,0],[2,1]],e.canChose=!1,e.params=t,e.code=EActivityType.MagpieActivity,e.skinName="ActivityMagpieSievePanelSkin",e}r.ActivityMagpieSievePanel=t}(game=game||{}),function(s){var c,t=(c=s.ActivityCommonPanel,__extends(e,c),e.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.sl_items.scrollPolicyH=this.sl_items.scrollPolicyV=eui.ScrollPolicy.OFF;var e=s.Config.magpieEventConfigsByCode(this.params.eventId);if(e){var i=JSON.parse(e.detail),a=[];for(var n in i){var o=i[n];parseInt(n)<i.length-1&&a.push({index:n,reward:o[0]})}var r=160*a.length;egret.Tween.get(this.sl_items.viewport,{loop:!0}).to({scrollH:r},1e3*a.length).call(function(){t.sl_items.viewport.scrollH=0}),a=a.concat(a),this.list_items.itemRenderer=d,this.list_items.dataProvider=new eui.ArrayCollection(a),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.doOpe()},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.img_ope.top=13},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.img_ope.top=0},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.img_ope.top=0},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.img_ope.top=0},this)}},e.prototype.doOpe=function(){egret.Tween.removeTweens(this.sl_items.viewport),this.sl_items.stopAnimation();var i=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,4e3),e=new eui.Group;e.width=e.height=76,e.anchorOffsetX=e.anchorOffsetY=38;var t=new eui.Image;t.width=t.height=76,t.horizontalCenter=t.verticalCenter=0,e.addChild(t);var a=new eui.Image;a.width=a.height=78,a.horizontalCenter=a.verticalCenter=0,e.addChild(a);var n=new eui.Image;n.width=n.height=59,n.horizontalCenter=n.verticalCenter=0,e.addChild(n);var o,r=this.sl_items.viewport.scrollH+this.sl_items.width/2,s=Math.floor(r/160),c=r-160*s;27<=c&&c<=132&&(o=this.list_items.getElementAt(s),t.source=o.baseitem.img_bg.source,a.source=o.baseitem.img_frame.source,n.source=o.baseitem.img_icon.source),DragonBoneTools.create("common_activity_61huodongdh",function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.armature.getSlot("wwjgz").display=e,t.animation.play("jia",1),egret.setTimeout(function(){var t=this,e=this.list_items.dataProvider.length;this.getReward({code:this.code,id:this.eventNum,num:o?s%(e/2)+1:e/2+1},function(){GameRootLayer.gameLayer().switchTouchEnable(!0),i&&egret.clearInterval(i),o||t.hide()},function(){t.hide()})},this,1400),egret.setTimeout(function(){o&&(o.baseitem.visible=!1)},this,730),egret.setTimeout(function(){t&&t.parent&&t.parent.contains(t)&&t.parent.removeChild(t),this.img_hook.visible=!0},this,1300),this.gp_effect.addChild(t),this.img_hook.visible=!1},this)},e.prototype.onDestroy=function(){egret.Tween.removeTweens(this.sl_items.viewport)},e);function e(t){var e=c.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.eventNum=MagpieActivityOper.TriggerEvent,e.params=t,e.code=EActivityType.MagpieActivity,e.skinName="ActivityMagpieSlotsPanelSkin",e}s.ActivityMagpieSlotsPanel=t;var i,d=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){var t=customui.BaseItemFactory.create();this.gp_main.addChild(t),t.scaleX=t.scaleY=.8,t.horizontalCenter=0,t.y=0,this.baseitem=t},a.prototype.dataChanged=function(){var t=this.data.reward;this.baseitem.updateData({reward:t})},a);function a(){var t=i.call(this)||this;return t.skinName="ActivityMagpieSlotsPanelItemSkin",t}}(game=game||{}),function(h){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.CommonDaTanChuKuang.blb_title.text="成 就",this.updateView()},i.prototype.updateView=function(){this.info=this.actProxy.allActivityData[this.code];var t,e=h.Config.magpieAchieveConfigs(),i=[],a=[],n=[];for(var o in e){var r={config:e[o],doneCB:this.updateView.bind(this),info:this.judgeIsCanGet(e[o])};r.info.isGet?n.push(r):r.info.isEnough?i.push(r):a.push(r)}t=i.concat(a,n),this.list_task.dataProvider=new eui.ArrayCollection(t),this.list_task.itemRenderer=s},i.prototype.judgeIsCanGet=function(t){var e={isEnough:!1,haveNum:0,allNum:0,isGet:!1},i=JSON.parse(t.target),a=0,n=0;switch(t.type){case MagpieAchieveType.Collect:for(var o=0;o<i.length;o++){var r=h.GameMVC.backpackPy.getItemNumByCode(i[o][1]);i[o][0]<=r&&n++}a=i.length;break;case MagpieAchieveType.FinishRound:n=this.info.data.round,a=i[0];break;case MagpieAchieveType.ThrowDiceTimes:n=this.info.data.throwRecord,a=i[0];break;case MagpieAchieveType.ChatWith:var s=this.info.data.talkRecord,c=i[1];for(var d in a=i[0],s)if(s[d][0]==c){n=s[d][1];break}}return e.haveNum=n,e.allNum=a,e.isEnough=a<=n,e.isGet=this.judgeIsGet(t.code),e},i.prototype.judgeIsGet=function(t){var e=!1;for(var i in this.info.data.targeted)if(t==this.info.data.targeted[i]){e=!0;break}return e},i);function i(){var t=e.call(this)||this;return t.params=void 0,t.doneCB=void 0,t.actProxy=h.GameMVC.activityPy,t.code=EActivityType.MagpieActivity,t.eventNum=MagpieActivityOper.TriggerEvent,t.skinName="ActivityMagpieTaskPanelSkin",t}h.ActivityMagpieTaskPanel=t;var a,s=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.isEnough?t.touchEvent():Utils.MsgUtils.addMidMsg("未满足条件")},this)},n.prototype.dataChanged=function(){var t=this.data;this.lb_title.text=t.config.desc,this.gp_rewards.removeChildren();var e=JSON.parse(t.config.rewards);if(t.config.type==MagpieAchieveType.Collect)for(var i=JSON.parse(t.config.target),a=0;a<i.length;a++){(r=customui.BaseItemFactory.create()).scaleX=r.scaleY=.7,r.updateData({id:i[a][1],num:i[a][0]}),this.gp_rewards.addChild(r);var n=new eui.Image;a==i.length-1?n.source="newactivity_img_denghao_png":n.source="common_img_jia_png",this.gp_rewards.addChild(n)}for(var o in e){var r;(r=customui.BaseItemFactory.create()).scaleX=r.scaleY=.7,r.updateData({id:e[o][1],num:e[o][2]}),this.gp_rewards.addChild(r)}var s=t.info.isGet;this.btn_get.visible=!s,this.btn_isGet.visible=s,this.lb_tips.text=t.info.haveNum+"/"+t.info.allNum,this.isEnough=t.info.isEnough,UIActionManager.setAbsGrey(this.btn_get,!this.isEnough)},n.prototype.touchEvent=function(){var t=this;this.actProxy.DoCommonOperation(this.code,this.data.config.code,MagpieActivityOper.GetAchievement,function(){t.data&&t.data.doneCB&&t.data.doneCB()})},n);function n(){var t=a.call(this)||this;return t.actProxy=h.GameMVC.activityPy,t.code=EActivityType.MagpieActivity,t.eventNum=MagpieActivityOper.TriggerEvent,t.bpProxy=h.GameMVC.backpackPy,t.isEnough=!1,t.skinName="ActivityMagpieTaskItemSkin",t}}(game=game||{}),function(o){var e,t=(e=BaseFull,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){return this.actProxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tileNum",{get:function(){return this.posArr.length},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btns),NoticeManager.addNoticeListener(NT.ACTIVITY_MAGPIE_TASK,this.btn_task.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.LiuYiTask],this.btn_activity_task,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.LiuYiExchange],this.btn_shop,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.LiuYiQuora],this.btn_quora,this,{percentX:.68,percentY:.71}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.LiuYiConsumeTask],this.btn_consume,this,{percentX:166/251,percentY:203/257}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.LiuYiCard],this.btn_card,this,{percentX:11/147,percentY:14/102}),UIActionManager.addEffect(this.gp_map,"common_activity_liuyihd_01",{childIndex:1}),UIActionManager.addEffect(this.btn_card,"common_tswpguang",{childIndex:0}),this.initRole(),this.initMapPos(),this.activateComponent()},i.prototype.initRole=function(){this.role=new c,this.gp_event.addChild(this.role)},i.prototype.initMapPos=function(){var a=this,n={1:[1,-1],2:[1,1],3:[-1,1],4:[-1,-1]},o=[this.gp_startPoint.x,this.gp_startPoint.y];this.posArr.push([o[0],o[1]]),[[4,2],[1,1],[4,1],[1,2],[4,1],[1,2],[4,3],[1,2],[4,1],[1,1],[4,1],[1,2],[2,1],[1,2],[2,3],[3,3],[2,2],[3,1],[2,1],[3,3],[2,4],[3,5],[4,1]].forEach(function(t){for(var e=t[0],i=t[1];0<i--;)o[0]+=134*n[e][0]/2,o[1]+=69*n[e][1]/2,a.posArr.push([o[0],o[1]])})},i.prototype.updateView=function(t){this.updateComponent(),this.updateMap(),this.checkCurEP(),o.AppFacade.getInstance().updateView(o.ActivityMediator.N,o.ActivityMediator.SV.MAGPIE_GIFT),o.AppFacade.getInstance().updateView(o.ActivityMediator.N,o.ActivityMediator.SV.MAGPIE_GIFT_ALL),this.updateCard()},i.prototype.updateCard=function(){var t=o.GameMVC.activityPy.allActivityData[EActivityType.LiuYiCard],e=t.data.startEffectDt,i=t.data.endEffectDt;e&&i?UIActionManager.setGrey(this.img_card,!1):UIActionManager.setGrey(this.img_card,!0)},i.prototype.updateComponent=function(){var t=this.info.content,e=this.info.data,i=t[5][0],a=t[6][0];if(this.normalDiceNum=o.GameMVC.backpackPy.getInfoByCode(i[1]).haveNum,this.trickDiceNum=o.GameMVC.backpackPy.getInfoByCode(a[1]).haveNum,this.lb_time1.text=this.normalDiceNum.toString(),0<this.normalDiceNum)this.icon_cost1.visible=!1,this.gp_times1.visible=!0;else{this.icon_cost1.visible=!0,this.gp_times1.visible=!1;var n=o.Config.publicBuyCostConfig(MODULE.MagpieActivity,e.buyCount).costs;this.icon_cost1.updateItem({cost:JSON.parse(n)[0],style:CommonIconStyle.RIGHT,needBg:!0})}this.gp_times2.visible=0<this.trickDiceNum,this.lb_time2.text=this.trickDiceNum.toString(),this.btn_gift.visible=0<JSON.parse(e.gifts).length},i.prototype.updateMap=function(){var n=this,t=this.info.data;for(var e in this.curEPs)(i=this.curEPs[e]).isExpire=!0;for(var e in t.map.forEach(function(t){var e=t[0];if(n.curEPs[e])(i=n.curEPs[e]).updateData(t);else{var i,a=n.posArr[e];(i=new l).x=a[0],i.y=a[1],n.curEPs[e]=i,n.gp_event.addChild(i),i.updateData(t)}}),this.curEPs)(i=this.curEPs[e]).isExpire&&(i.parent&&i.parent.removeChild(i),delete this.curEPs[e]);for(var e in this.updateRole(),this.gp_event.$children.sort(function(t,e){if(t.y!=e.y)return t.y-e.y}),0===this.role.index?this.gp_startPoint.visible=!1:this.gp_startPoint.visible=!0,this.curEPs){var i;(i=this.curEPs[e]).visible=this.role.index!=Number(e)}},i.prototype.updateRole=function(){var t=this.info.data;this.role.index=t.index;var e=this.posArr[t.index];this.role.x=e[0],this.role.y=e[1],this.updateRoleDir()},i.prototype.updateRoleDir=function(){var t=this.role.index,e=t+1===this.tileNum?0:t+1,i=this.posArr[t],a=this.posArr[e][0]-i[0];this.role.dir=0<a?2:1},i.prototype.checkCurEP=function(){var t=this.role.index,e=this.curEPs[t];e&&e.data.status!=MagpiePointStatus.Finish&&e.onTrigger()},i.prototype.rollDice=function(t){var a=this;Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.MagpieActivity,id:MagpieActivityOper.ThrowDice,num:t||void 0}).then(function(i){var t=JSON.parse(i.info);a.role.index,PopUpManager.addPopUp({obj:new o.CommonRollDicePanel({num:t.diceNum}),closeCB:function(){a.roleMoveTo(t.index,function(){var t=a.role.index,e=a.curEPs[t];e?e.onHandleResult(i):o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,i)})}})})},i.prototype.buyDice=function(t,e){void 0===t&&(t=1),Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.MagpieActivity,id:MagpieActivityOper.BuyCount,num:t}).then(function(t){o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,t),e&&e()})},i.prototype.roleMoveTo=function(n,o){var r=this;(r.gp_event.setChildIndex(r.role,r.gp_event.numChildren-1),r.role.switchRunStatus(!0),GameRootLayer.gameLayer().switchTouchEnable(!1),new Promise(function(t){t()})).then(function(){function t(){(i+=1)>=r.tileNum&&(i-=r.tileNum);var t=r.posArr[i],e=i;a.to({x:t[0],y:t[1]},300).call(function(){r.role.index=e,r.updateRoleDir()})}for(var i=r.role.index,e=n,a=egret.Tween.get(r.role);i!=e;)t();a.call(function(){r.role.switchRunStatus(!1),GameRootLayer.gameLayer().switchTouchEnable(!0),o&&o()})})},i.prototype.activateComponent=function(){var i=this;this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_roll1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info.data;if(0<i.normalDiceNum)i.rollDice();else{var e=o.Config.publicBuyCostConfig(MODULE.MagpieActivity,t.buyCount).costs;o.GameMVC.backpackPy.checkEnough(JSON.parse(e),!1)?o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.MagpieActivity,hasBuyNum:t.buyCount,tips:"购买骰子",buyCB:function(t){i.buyDice(t,function(){Utils.MsgUtils.addMidMsg("购买成功")})}}):Utils.MsgUtils.addMidMsg("货币不足")}},this),this.btn_roll2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<i.trickDiceNum?PopUpManager.addPopUp({obj:new o.ActivityMagpieDiceSelectPanel,closeCB:function(t){t&&i.rollDice(t)}}):Utils.MsgUtils.addMidMsg("道具不足")},this),this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showHelpDialog(i.info.content[8])},this),this.btn_gift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAGPIE_GIFT_ALL)},this),this.btn_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.ActivityMagpieTaskPanel})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiExchange)},this),this.btn_quora.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiQuora)},this),this.btn_consume.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiConsumeTask)},this),this.btn_recharge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiRecharge)},this),this.btn_activity_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiTask)},this),this.btn_card.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.activityMed.showViewByCode(EActivityType.LiuYiCard)},this)},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.MagpieActivity,t.actProxy=o.GameMVC.activityPy,t.backpackProxy=o.GameMVC.backpackPy,t.posArr=[],t.curEPs={},t.normalDiceNum=0,t.trickDiceNum=0,t.skinName="ActivityMagpieSkin",t}o.ActivityMagpieView=t;var a,n=(a=eui.Component,__extends(r,a),r.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.gp_root=new eui.Group,this.gp_root.width=this.gp_root.height=0,this.addChild(this.gp_root),this.img_icon=new eui.Image,this.img_icon.verticalCenter=this.img_icon.horizontalCenter=0,this.img_icon.width=this.img_icon.height=55,this.gp_root.addChild(this.img_icon)},r);function r(){return null!==a&&a.apply(this,arguments)||this}var s,c=(__extends(d,s=n),Object.defineProperty(d.prototype,"dir",{set:function(t){this._dir=t,this.armature&&(this.armature.scaleX=1===t?this.scale:-this.scale)},enumerable:!0,configurable:!0}),d.prototype.childrenCreated=function(){var t=this;s.prototype.childrenCreated.call(this),this.img_icon.source="",this.armature=new customui.SteadyArmature,this.gp_root.addChild(this.armature),this.armature.armatureName="zhujiao_01_z",this.armature.play("daiji"),this.armature.scaleY=this.scale,this.armature.setOnArmatureCreated(function(){t.dir=t._dir})},d.prototype.switchRunStatus=function(t){this.armature.play(t?"paobu":"daiji")},d);function d(){var t=null!==s&&s.apply(this,arguments)||this;return t.scale=.6,t}var h,l=(__extends(p,h=n),p.prototype.childrenCreated=function(){h.prototype.childrenCreated.call(this),this.armature=new customui.SteadyArmature,this.addChild(this.armature)},p.prototype.reset=function(){this.armature.scaleX=this.armature.scaleY=1,this.armature.armatureName="",this.img_icon.source=""},p.prototype.updateData=function(t){switch(t&&(this.index=t[0],this.data=t[1],this.isExpire=!1),this._lastUpdateType!=this.data.eventType&&this.reset(),egret.Tween.removeTweens(this.img_icon),this.img_icon.verticalCenter=0,this.data.eventType){case MagpieEventType.Box:var e="";e=this.data.status===MagpiePointStatus.Finish?"common_fbzcbaoxiang2":"common_fbzcbaoxiang",this.armature.scaleX=this.armature.scaleY=.5,this.armature.armatureName=e;break;case MagpieEventType.Empty:break;case MagpieEventType.FingerGame:case MagpieEventType.Slots:case MagpieEventType.Sieve:this.img_icon.source="lyhd_img_wenhao_png",egret.Tween.get(this.img_icon,{loop:!0}).to({verticalCenter:-10},1e3).to({verticalCenter:0},1e3);break;case MagpieEventType.Item:case MagpieEventType.Gift:break;case MagpieEventType.Talk:var i=o.Config.magpieConfigs()[this.data.talkId];this.armature.armatureName=i.model,this.armature.play("daiji");var a=JSON.parse(i.modelSize);this.armature.scaleX=a[0]/100||1,this.armature.scaleY=a[1]/100||1}this._lastUpdateType=this.data.eventType},p.prototype.onHandleResult=function(t){switch(this.data.eventType){case MagpieEventType.Box:DragonBoneTools.playOnce({effectName:"common_dabaoxiang",parent:GameRootLayer.gameLayer().popMsgLayer,doneCB:function(){o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,t)}});break;case MagpieEventType.Empty:break;case MagpieEventType.FingerGame:o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,t);break;case MagpieEventType.Item:if(o.GameMVC.activityPy.allActivityData[EActivityType.MagpieActivity].updateData(t.info),t.clientReward){var e=o.Config.magpieEventConfigs()[this.data.eventId];o.GameMVC.backpackPy.handleClientReward(t.clientReward,{top_tips:e.desc})}break;case MagpieEventType.Gift:o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,t),o.AppFacade.getInstance().showSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAGPIE_GIFT,{eventId:this.data.eventId});break;case MagpieEventType.Talk:case MagpieEventType.Sieve:case MagpieEventType.Slots:o.GameMVC.activityPy.updateData_View_Reward(EActivityType.MagpieActivity,t)}},p.prototype.onTrigger=function(){switch(this.data.eventType){case MagpieEventType.FingerGame:PopUpManager.addPopUp({obj:new o.ActivityMagpieMoraPanel(this.data),clickDarkClose:!1});break;case MagpieEventType.Talk:PopUpManager.addPopUp({obj:new o.ActivityMagpieRandomEventPanel(this.data),clickDarkClose:!1});break;case MagpieEventType.Sieve:PopUpManager.addPopUp({obj:new o.ActivityMagpieSievePanel(this.data),clickDarkClose:!1});break;case MagpieEventType.Slots:PopUpManager.addPopUp({obj:new o.ActivityMagpieSlotsPanel(this.data),clickDarkClose:!1})}},p);function p(){var t=null!==h&&h.apply(this,arguments)||this;return t.isExpire=!0,t}}(game=game||{}),function(t){var e,i=(e=BasePanel,__extends(a,e),a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),egret.clearInterval(this.bookTimer)},a.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.gp_touch,egret.TouchEvent.TOUCH_TAP,function(){t.allDone&&t.hide()},this),this.go()},a.prototype.go=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.tg_changjing1.play(),[4,this.chagnjing1()];case 1:return t.sent(),this.tg_changjing2.play(),[4,this.chagnjing2()];case 2:return t.sent(),this.tg_changjing3.play(),[4,this.chagnjing3()];case 3:return t.sent(),[2]}})})},a.prototype.reset=function(){this.lb_text.text="",egret.clearInterval(this.bookTimer),this.gp_r_0.removeChildren(),this.gp_r_1.removeChildren(),this.gp_r_2.removeChildren(),this.gp_r_3.removeChildren(),this.gp_r_4.removeChildren(),this.gp_r_5.removeChildren(),this.gp_r_9.removeChildren()},a.prototype.popTips=function(e,t){var i=this;this.lb_text.text="",this.lb_text.size=28,egret.clearInterval(this.bookTimer),this.bookTimer=egret.setInterval(function(){var t=i.lb_text.text.length;e[t]&&(i.lb_text.text+=e[t])},this,t)},a.prototype.chagnjing1=function(){var i=this;return new Promise(function(t,e){i.img_bg1.source="wanshengjie_bg_beijing1_png",i.img_bg2.source="wanshengjie_bg_beijing1_png",DragonBoneTools.create("wsj_jiaose_01",function(t){t.scaleX=t.scaleY=.7,t.animation.play("gongji"),this.gp_r_0.addChild(t)},i),DragonBoneTools.create("wsj_jiaose_02",function(t){t.scaleX=-.7,t.scaleY=.7,t.animation.play("gongji"),this.gp_r_1.addChild(t)},i),DragonBoneTools.create("wsj_jiaose_03",function(t){t.scaleX=t.scaleY=.55,t.animation.play("gongji"),this.gp_r_2.addChild(t)},i),DragonBoneTools.create("wsj_jiaose_04",function(t){t.scaleX=-.55,t.scaleY=.55,t.animation.play("gongji"),this.gp_r_3.addChild(t)},i),DragonBoneTools.create("wsj_jiaose_07",function(t){t.scaleX=t.scaleY=.7,t.animation.play("gongji"),this.gp_r_4.addChild(t)},i),DragonBoneTools.create("wsj_jiaose_06",function(t){t.scaleX=-.7,t.scaleY=.7,t.animation.play("gongji"),this.gp_r_5.addChild(t)},i),egret.Tween.get(i).wait(1e3).call(function(){i.popTips(i.CONTENT[0],100)}).wait(1500).call(function(){i.popTips(i.CONTENT[1],100)}).wait(2200).call(function(){t()})})},a.prototype.chagnjing2=function(){var i=this;return new Promise(function(t,e){i.reset(),i.img_bg1.source="",i.img_bg2.source="",egret.Tween.get(i).wait(1e3).call(function(){DragonBoneTools.playOnce({effectName:"wsj_xixuegui02",actionName:"daiji",parent:i.gp_r_9,x:i.gp_r_9.width/2,y:i.gp_r_9.height/2,loop:!1,keep:!0,doneCB:function(){}})}).wait(500).call(function(){i.popTips(i.CONTENT[2],100)}).wait(1e3).call(function(){DragonBoneTools.create("wsj_bianfu_01",function(t){t.animation.play(),this.gp_r_5.addChild(t)},i)}).wait(1e3).call(function(){t()})})},a.prototype.chagnjing3=function(){var i=this;return new Promise(function(t,e){i.reset(),i.img_bg2.x=0,i.img_bg2.source="wanshengjie_bg_beijing3_png",DragonBoneTools.create("wsj_bianfu_01",function(t){t.animation.play(),this.gp_r_5.addChild(t)},i),DragonBoneTools.create("wsj_xixuegui01",function(t){t.animation.play(),this.gp_r_3.addChild(t)},i),egret.Tween.get(i).wait(800).call(function(){i.popTips(i.CONTENT[3],100),DragonBoneTools.create("wsj_bianfu_02",function(t){t.animation.play(),this.gp_r_4.addChild(t)},i)}).wait(1500).call(function(){t(),i.img_enter.visible=!0,i.img_enter1.visible=!0,i.allDone=!0})})},a);function a(){var t=e.call(this)||this;return t.allDone=!1,t.CONTENT=["魂归于天 命归于地","逝去的英灵却未曾安息","今日让我们放下仇恨","来迎接这属于所有人的狂欢吧！"],t.skinName="ActivityMagpieWanJuChangViewSkin",t}t.ActivityMagpieWanJuChangView=i}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity314Skin",t}t.Activity314=e}(game=game||{}),function(t){var i,e=(i=t.ActivityCommonPanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},a.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.info;e&&e.data&&JSON.parse(e.content)},a.prototype.activateComponent=function(){},a);function a(){var t=i.call(this)||this;return t.skinName="Activity315Skin",t}t.Activity315=e}(game=game||{}),function(_){var A,t=(A=_.ActivityCommonPanel,__extends(e,A),e.prototype.childrenCreated=function(){var i=this;A.prototype.childrenCreated.call(this),this.baseitem_chose.visible=!1,this.baseitem_chose.touchEnabled=!1,this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),UIActionManager.fadeBlink(this.img_jiahao,!0,!1,1e3),this.gp_chose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=[];t.data.wishId&&e.push(String(t.data.wishId));var a=JSON.parse(t.content);PopUpManager.addPopUp({obj:new _.CommonChosePanel({getInfos:function(){var t={};for(var e in a[0]){var i=a[0][e];i[5]&&(t[i[0]]={uuid:i[0],type:i[1][0][0],code:i[1][0][1],num:i[1][0][2],isLocked:!1})}return t},type:EEntityType.EEntityTypeItem,isOnlyCode:!0,checkFull:function(t){return 1<=t.length},sortFunc:function(t,e){return t.info.uuid-e.info.uuid},selectUuids:e,singleChoose:!0,fullTip:"",title:"请选择你的心愿物品",source:BASEITEM_SOURCE.BACKPACK,needLongTap:!0}),closeCB:function(t){t&&i.getReward({code:i.code,id:WishTreeOper.SetWishId,num:t[0]?parseInt(t[0]):0})}})}},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.GameMVC.backpackPy.checkEnough([i.realCost1])?i.doOperation(1):Utils.MsgUtils.addMidMsg("货币不足")},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.GameMVC.backpackPy.checkEnough([i.realCost2])?i.doOperation(10):Utils.MsgUtils.addMidMsg("货币不足")},this);for(var t=0;t<9;t++){var e=new _.Activity162Item;e.x=this.pos[t][0],e.y=this.pos[t][1],e.visible=!1,e.scaleX=e.scaleY=.75,this.gp_rewards.addChild(e),this.reward_items.push(e)}this.btn_look.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a})},this)},e.prototype.updateView=function(t){var n=this;A.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),a=e.data.wishId,o=e.data.wishGrade;this.img_chose.source=a?"xyzs_txt_dangqian_png":"xyzs_txt_xuanze_png";var r=i[0],s=_.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(s&&s.data){var c=JSON.parse(s.content)[4],d=0;for(var h in c)c[h][0]==s.data.maxLevel&&(d=c[h][1]);if(this.lb_level.text=s.data.maxLevel,this.lb_num.text="-"+d/10+"%",!this.hasInit){this.hasInit=!0,this.pb_lucky.maximum=i[4];var l=1-d/1e3,p=[i[1][0][0],i[1][0][1],i[1][0][2]],u=[i[2][0][0],i[2][0][1],i[2][0][2]];p[2]=Math.floor(p[2]*l),u[2]=Math.floor(u[2]*l),this.realCost1=p,this.realCost2=u,this.cost_1.updateItem({cost:p,style:CommonIconStyle.RIGHT}),this.cost_10.updateItem({cost:u,style:CommonIconStyle.RIGHT}),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.info.content[5],e=[];for(var i in t){var a=t[i];a[0]&&e.push({text:a[0]}),a[1]&&e.push({text:a[1],style:{textColor:36807}}),e.push({text:"\n"})}PopUpManager.addPopUp({obj:new _.HelpDialog({text:e})})},this)}for(var h in this.CommonResourceBar.updateBar(i[2]),this.pb_lucky.value=o,this.bm_cur.text=o+"/",this.bm_max.text=this.pb_lucky.maximum+"",this.baseitem_chose.visible=!1,r){var g=r[h];g[0]==a&&(this.baseitem_chose.updateData({reward:g[1][0]}),this.baseitem_chose.visible=!0);var m=!!g[5],y=g[6]-1;this.reward_items[y]&&!m&&this.reward_items[y].update({isRare:1,rewards:g[1],id:g[0]})}var v="common_activity_zhishujie07_11",f=s.data.maxLevel;0<f&&f<=5?v="common_activity_zhishujie07_1"+f:5<f&&f<=10?v="common_activity_zhishujie07_2"+(f-5):10<f&&f<=15&&(v="common_activity_zhishujie07_3"+(f-10)),this.gp_effect.removeChildren(),UIActionManager.addEffect(this.gp_effect,v,{offectX:0,offectY:0})}}},e.prototype.doOperation=function(t){var o=this;this.info.data.wishId?(GameRootLayer.gameLayer().switchTouchEnable(!1),this.timer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,4e3),Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:t,id:WishTreeOper.Wish}).then(function(t){for(var e=JSON.parse(t.info).lastCode,i=[],a=0;a<e.length;a++){var n=e[a];0<=i.indexOf(n)||(i.push(n),0==a?o.reward_items[n-1].playEffect("common_activity_shengdanjie_07",function(){GameRootLayer.gameLayer().switchTouchEnable(!0),o.timer&&egret.clearTimeout(o.timer),_.GameMVC.activityPy.updateData_View_Reward(o.code,t)}):o.reward_items[n-1].playEffect("common_activity_shengdanjie_07"))}})):Utils.MsgUtils.addMidMsg("请先选择心愿物品")},e);function e(){var t=A.call(this)||this;return t.reward_items=[],t.pos=[[240,-20],[130,40],[350,40],[55,125],[180,125],[305,125],[430,125],[130,210],[350,210]],t.hasInit=!1,t.realCost1=[],t.realCost2=[],t.skinName="Activity282Skin",t}_.Activity282=t;var i,a=(i=BasePanel,__extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateInfo(),this.list_historyItem.itemRenderer=r},n.prototype.updateInfo=function(){var t=_.GameMVC.activityPy.allActivityData[EActivityType.BeachDiaoBao];if(!t||!t.data)return!1;var e=JSON.parse(t.content)[4],i=[];for(var a in e)i.push(e[a]);this.list_historyItem.dataProvider=new eui.ArrayCollection(i)},n);function n(){var t=i.call(this)||this;return t.skinName="Activity282LookSkin",t}_.Activity282LookPanel=a;var o,r=(o=eui.ItemRenderer,__extends(s,o),s.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},s.prototype.dataChanged=function(){var t=this.data,e="01";e=9<t[0]?t[0]:"0"+t[0],this.img_plant.source="znq_img_shabao"+e+"_png",this.img_di.visible=t[0]%2==1,this.lb_level.text=t[0],this.lb_num.text="-"+t[1]/10+"%"},s);function s(){var t=o.call(this)||this;return t.skinName="Activity282LookItemSkin",t}}(game=game||{}),function(A){var i,t=(i=A.ActivityCommonPanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.bm_title.text="商 店",Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.heroModel.update({code:41060037,isStatic:!0});var t=new eui.TileLayout;t.horizontalGap=95,t.verticalGap=0,t.requestedRowCount=0,t.paddingLeft=30,t.paddingTop=5,t.requestedColumnCount=3,t.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=t,this.list_items.itemRenderer=n,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect,this.activateComponent()},e.prototype.updateView=function(t){i.prototype.updateView.call(this,t);var e=this.getDataList();0==this.curIndex?this.btn_lastOne.visible=!1:this.btn_lastOne.visible=!0,this.curIndex==Math.ceil(e.length/9)-1?this.btn_nextOne.visible=!1:this.btn_nextOne.visible=!0,e=e.slice(9*this.curIndex,9*this.curIndex+9),this.collect.replaceAll(e),this.heroModel.visible=!1},e.prototype.getDataList=function(){var g=this,t=this.info;if(!t||!t.data)return this.hide(),Utils.MsgUtils.addMidMsg("活动未开启"),[];var d,m=t.data.targeted,e=t.content,i=t.data.curCycle||1;for(var a in e[1]){var n=e[1][a];if(n[0]==i){d=n[1];break}}if(!d)return[];function o(t){var e=d[t],i=e[0],h=e[1],l=e[2],p=e[3],a=e[4],n=(e[5],REWARD_STATUS.UNAVAILABLE),u=0;for(var o in m){var r=m[o];if(r.id==i){u=r.num;break}}_[l[0][1]]=l[0][1],p<=u?n=REWARD_STATUS.RECEIVED:y.checkEnough(l,!1)&&(n=REWARD_STATUS.AVAILABLE),f[i]=n;var s=A.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),c={id:i,title:"兑换"+(s&&s.name),tips:u+"/"+p,rewards:h,hasBuy:u,buyTimes:p,costs:l,status:n,discount:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:var t=A.AppFacade.getInstance().retrieveMediator(A.ShopyMediator.N),i=[],a=Number.MAX_VALUE;for(var n in l){var o=l[n],r=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N).getInfoByCode(o[1]),s=Math.floor(r.haveNum/o[2]);s<a&&(a=s,i=o)}var c=a,d=A.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;t.showSubView(A.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(t){return{unit:i[2],total:i[2]*t}},name:d,limit:"[5,"+(p+1)+"]"},maxCount:p-u<c?p-u:c,buyNum:u+1,btnLabel:"购买",costTip:"购买消耗",limitTip:"购买次数",doneCB:function(t){g.getReward({code:g.code,giftCode:e.id,num:t.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("道具不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};v.push(c)}for(var y=A.AppFacade.getInstance().retrieveProxy(A.BackpackPy.N),v=[],f={},_={},r=0;r<d.length;r++)o(r);return v.sort(function(t,e){return t.id-e.id}),this.resource_bar.updateBar(Object.keys(_)),this.code==EActivityType.CollectWords&&(this.resource_bar.visible=!1),v},e.prototype.activateComponent=function(){var t=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex--,t.updateView()},this),this.btn_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex++,t.updateView()},this)},e);function e(){var t=i.call(this)||this;return t.curIndex=0,t.skinName="Activity250Skin",t}A.Activity250=t;var a,n=(a=A.ShopUIItem,__extends(o,a),o.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.btnFunc&&this.data.btnFunc(this.data)},this)},o.prototype.dataChanged=function(){var t=this.data,e=this.data.rewards[0];this.baseItem.updateData({reward:e}),this.baseItem.touchEnabled=!0,this.img_buyok.visible=!1,this.btn_purchase.label=""+Utils.MathUtils.formatNumStyle1(this.data.costs[0][2]);var i=A.GameMVC.backpackPy.getInfoByTypeCodeNum(this.data.costs[0][0],this.data.costs[0][1],this.data.costs[0][2]);i&&i.info&&(this.btn_purchase.iconDisplay.source=ResourceUtils.png(i.info.icon));var a=t.hasBuy,n=t.buyTimes;this.leftNum=n-a,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1),this.img_onlyOne.visible=1==n,this.data.discount&&100!=this.data.discount?(this.gp_discount.visible=!0,this.blb_discount.text=this.data.discount/10+""):this.gp_discount.visible=!1},o);function o(){return null!==a&&a.apply(this,arguments)||this}}(game=game||{}),function(f){var a,t=(a=f.ActivityCommonPanel,__extends(e,a),e.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.list_root.itemRenderer=n,this.heroModel.update({code:41150009,isStatic:!0}),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=f.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve];if(t&&t.data){var e=JSON.parse(t.data.records);if(0!=e.length){var i=[];for(var a in e){var n=e[a],o=[{text:n.name+" ",style:{textColor:9499647,size:20}},{text:"购买 "+n.giftName+"，刮到",style:{textColor:16775312,size:20}},{text:" "+n.diamond+" ",style:{textColor:7339894,size:20}},{text:"钻石",style:{textColor:16775312,size:20}}];i.push({textFlow:o})}i=i.reverse(),PopUpManager.addPopUp({obj:new f.RecordPanel({records:i})})}else Utils.MsgUtils.addMidMsg("暂无记录")}else Utils.MsgUtils.addMidMsg("暂无记录")},this)},e.prototype.updateView=function(t){a.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=this.getDataList();this.list_root.dataProvider=new eui.ArrayCollection(i)}else Utils.MsgUtils.addMidMsg("获取活动数据失败")},e.prototype.getDataList=function(){var e=this,t=this.info;if(!t||!t.data)return[];var i=f.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve];if(!i||!i.data)return[];for(var a=f.GameMVC.playerPy.playerInfoVO.level,n=[],o=JSON.parse(t.content)[0],r=t.data.diamondTargeted,s=JSON.parse(i.data.rebateList),c=0;c<o.length;c++){var d=o[c],h=d[0],l=d[1],p=REWARD_STATUS.UNAVAILABLE;l<=a&&(p=REWARD_STATUS.CANBUY);var u=0;for(var g in r)if((y=r[g])[0]==h){u=y[1],y[1]>=d[4]&&(p=REWARD_STATUS.HASBUY);break}var m=[];for(var g in s){var y;(y=s[g])[1]==h&&m.push(y[0])}var v={id:h,title:Math.ceil(d[2][0][2])+"钻",name:d[6],icon:d[9]||"common_icon_fudai",hasBuy:u,maxBuy:d[4],status:p,rebates:m,rewards:d[3],costs:d[2],btnFunc:function(t){if(t)switch(t.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("等级不足");break;case REWARD_STATUS.CANBUY:e.getReward({code:e.code,id:t.type2,num:t.id,info:JSON.stringify({num:1})});break;case REWARD_STATUS.CANBUY:case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}else Utils.MsgUtils.addMidMsg("没传data")}};n.push(v)}return n.sort(function(t,e){return t.rebates.length!=e.rebates.length?e.rebates.length-t.rebates.length:t.status!=e.status?t.status-e.status:t.id-e.id}),n},e);function e(){var t=a.call(this)||this;return t.selectIndex=1,t.initTOP=!1,t.skinName="Activity1201",t}f.Activity1201=t;var i,n=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.btnFunc&&e.data.btnFunc(e.data)},this),this.gp_rebate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.rebates&&0<e.data.rebates.length?PopUpManager.addPopUp({obj:new s({id:e.data.id})}):Utils.MsgUtils.addMidMsg("无可刮奖次数")},this),this.effectObj||UIActionManager.addEffect(this.gp_rebate,"common_activity_shuang12",{offectY:-20},function(t){(e.effectObj=t).scaleX=t.scaleY=1.4,e.data&&e.data.rebates&&0<e.data.rebates.length?(e.img_rebate.visible=!1,e.effectObj&&(e.effectObj.visible=!0)):(e.img_rebate.visible=!0,e.effectObj&&(e.effectObj.visible=!1))})},o.prototype.dataChanged=function(){this.img_icon.source=this.data.icon+"_png",this.gp_rewards.removeChildren(),f.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards,.6),this.btn_buy.btn_oppr.label=" ",this.data.status!=REWARD_STATUS.HASBUY?(this.btn_buy.btn_oppr.skinName="skins.ButtonSkinYellow",this.btn_buy.cui_freshCost.visible=!0,this.btn_buy.cui_freshCost.updateItem({cost:[this.data.costs[0][0],this.data.costs[0][1],this.data.costs[0][2]],style:CommonIconStyle.RIGHT})):(this.btn_buy.btn_oppr.label="",this.btn_buy.cui_freshCost.visible=!1,f.GameMVC.activityMed.updateBtn(this.btn_buy.btn_oppr,this.data.status)),this.btn_buy.cui_freshCost.blb_num.scaleX=this.btn_buy.cui_freshCost.blb_num.scaleY=1.2,this.lb_canBuy.text="剩余"+(this.data.maxBuy-this.data.hasBuy)+"次",this.bm_title.text=this.data.name||"",this.data.rebates&&0<this.data.rebates.length?(this.img_rebate.visible=!1,this.effectObj&&(this.effectObj.visible=!0),this.lb_rebateTimes.text="还可刮奖"+this.data.rebates.length+"次"):(this.img_rebate.visible=!0,this.effectObj&&(this.effectObj.visible=!1),this.lb_rebateTimes.text="还可刮奖0次")},o);function o(){var t=i.call(this)||this;return t.effectObj=void 0,t.skinName="Activity1201Item",t}var r,s=(r=BasePanel,__extends(c,r),c.prototype.childrenCreated=function(){var i=this;if(r.prototype.childrenCreated.call(this),this.id){this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<i.target.length?i.updateView():Utils.MsgUtils.addMidMsg("无刮奖次数")},this);for(var a=0;a<this.row;a++){function t(t){var e=new eui.Image;e.source="she_img_gua_png",e.x=t*n.imgSize,e.y=a*n.imgSize,n.allImg.push(e),n.gp_cover.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(){e.visible&&(e.visible=!1,i.touchCount++,i.touchCount>=i.cAsAll&&(i.touchCount=0,Utils.Socket.send("activity","DoCommonOperation",{id:5,code:EActivityType.DoubleTwelve,num:1,info:i.target[0][0]}).then(function(t){f.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve].updateData(t.info),f.GameMVC.activityMed.updateViewByCode(EActivityType.ThirdLevelReward1),i.updateView(!0),i.allImg.forEach(function(t){t.visible=!1}),i.btn_next.visible=!0,f.GameMVC.backpackPy.handleClientReward(t.clientReward)})))},n)}for(var n=this,e=0;e<this.col;e++)t(e)}this.updateView()}},c.prototype.updateView=function(t){var e=this,i=f.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve];if(i&&i.data){var a=JSON.parse(i.data.rebateList);for(var n in this.target=[],a){var o=a[n];o[1]==this.id&&this.target.push(o)}if(0<this.target.length?(UIActionManager.setGrey(this.btn_next,!1),this.lb_leftTime.text="剩余"+this.target.length+"次"):(UIActionManager.setGrey(this.btn_next),this.lb_leftTime.text="剩余0次"),this.btn_next.visible=!1,!t){var r="00000"+(this.target[0]&&this.target[0][2]||"");egret.setTimeout(function(){e.bm_rewards.text=r.slice(r.length-5)},this,500),this.allImg.forEach(function(t){t.visible=!0}),this.touchCount=0}}},c.prototype.onDestroy=function(){r.prototype.onDestroy.call(this)},c);function c(t){var e=r.call(this)||this;return e.target=[],e.inCall=!1,e.row=7,e.col=25,e.allCount=1,e.cAsAll=1,e.allImg=[],e.imgSize=16,e.touchCount=0,e.skinName="Activity1201GuaguaPanel",e.id=t&&t.id,e.allCount=e.col*e.row,e.cAsAll=Math.ceil(60*e.allCount/100),e}}(game=game||{}),function(y){var e,t=(e=eui.Component,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.timer=egret.setInterval(function(){0<t.nextStatusLeftTime?(t.lb_limitTime.text=Utils.TimerManager.getFormatBySecond1(t.nextStatusLeftTime),t.nextStatusLeftTime--):1!=t.curLimitStatus&&2!=t.curLimitStatus||t.updateView()},this,1e3),this.btn_limitBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.limitBuyFunc&&t.limitBuyFunc()},this),this.updateView()},i.prototype.updateView=function(t){var e=this;this.updateLimitPanelTime();var i=y.GameMVC.activityPy.allActivityData[this.code];if(i&&i.data){var a=i.data.itemList,n=0,o=0;switch(this.btn_limitBuy.scaleX=this.btn_limitBuy.scaleY=.6,this.curLimitStatus){case 1:if(this.bm_timeTip.text="开始倒计时",this.gp_limitRewards.removeChildren(),this.limitConfig)if(this.btn_limitBuy.label="",this.btn_limitBuy.skinName="skins.ButtonSkinYellow",this.limitBuyFunc=function(){Utils.MsgUtils.addMidMsg("未开始")},this.limitConfig[3][0]){var r=this.limitConfig[3][0][2];y.GameMgr.getInstance().CommonGpAddReward(this.gp_limitRewards,r,.8);var s=this.limitConfig[3][0][1];this.btn_limitBuy.label=s[0][2]+"钻",this.lb_limitLeft.text=this.limitConfig[3][0][3]+"份"}else{r=this.limitConfig[4][0][2],y.GameMgr.getInstance().CommonGpAddReward(this.gp_limitRewards,r,.8);var c=y.GameMVC.rechargePy.getGoodInfo(this.limitConfig[4][0][1]);this.btn_limitBuy.label=c?c.price+"元":"",this.lb_limitLeft.text=this.limitConfig[4][0][3]+"份"}break;case 2:if(this.bm_timeTip.text="结束倒计时",this.gp_limitRewards.removeChildren(),this.limitConfig)if(this.btn_limitBuy.label="",this.btn_limitBuy.skinName="skins.ButtonSkinYellow",this.limitConfig[3][0]){var d=REWARD_STATUS.UNAVAILABLE,h=this.limitConfig[3][0];for(var l in a)if((u=a[l]).code==h[0]){n=u.times||0,o=u.num||0;break}switch(d=n<h[4]&&o<h[3]?REWARD_STATUS.AVAILABLE:o>=h[3]?REWARD_STATUS.HASBUY:REWARD_STATUS.RECEIVED,r=h[2],y.GameMgr.getInstance().CommonGpAddReward(this.gp_limitRewards,r,.8),d){case REWARD_STATUS.AVAILABLE:s=h[1],this.btn_limitBuy.skinName="skins.ButtonSkinYellow",this.btn_limitBuy.label=s[0][2]+"钻",this.limitBuyFunc=function(){Utils.Socket.send("activity","BuyLimitNumGift",{code:e.code,id:h[0]}).then(function(t){y.GameMVC.activityPy.updateData_View_Reward(e.code,t,function(){e.updateView()})})};break;case REWARD_STATUS.HASBUY:this.btn_limitBuy.skinName="skins.ButtonSkinSure",this.btn_limitBuy.label="已购完",this.btn_limitBuy.scaleX=this.btn_limitBuy.scaleY=.85,this.limitBuyFunc=function(){Utils.MsgUtils.addMidMsg("无存货")};break;case REWARD_STATUS.RECEIVED:this.btn_limitBuy.skinName="skins.ButtonSkinSure",this.btn_limitBuy.label="已购买",this.btn_limitBuy.scaleX=this.btn_limitBuy.scaleY=.85,this.limitBuyFunc=function(){Utils.MsgUtils.addMidMsg("已购买")}}this.lb_limitLeft.text=this.limitConfig[3][0][3]-o+"份"}else{var p=this.limitConfig[4][0];for(var l in a){var u;if((u=a[l]).code==p[0]){n=u.times||0,o=u.num||0;break}}var g=REWARD_STATUS.UNAVAILABLE;switch(g=n<p[4]&&o<p[3]?REWARD_STATUS.AVAILABLE:o>=p[3]?REWARD_STATUS.HASBUY:REWARD_STATUS.RECEIVED,r=p[2],y.GameMgr.getInstance().CommonGpAddReward(this.gp_limitRewards,r,.8),g){case REWARD_STATUS.AVAILABLE:s=p[1],this.btn_limitBuy.skinName="skins.ButtonSkinYellow";var m=y.GameMVC.rechargePy.getGoodInfo(p[1]);this.btn_limitBuy.label=m?m.price+"元":"",this.limitBuyFunc=function(){y.GameMVC.rechargePy.purchase(m,2,p[0],JSON.stringify({uuid:p[0],activityType:e.code}),{activityType:e.code,uuid:p[0]})};break;case REWARD_STATUS.HASBUY:this.btn_limitBuy.skinName="skins.ButtonSkinSure",this.btn_limitBuy.label="已购完",this.btn_limitBuy.scaleX=this.btn_limitBuy.scaleY=.85,this.limitBuyFunc=function(){Utils.MsgUtils.addMidMsg("无存货")};break;case REWARD_STATUS.RECEIVED:this.btn_limitBuy.skinName="skins.ButtonSkinSure",this.btn_limitBuy.label="已购买",this.btn_limitBuy.scaleX=this.btn_limitBuy.scaleY=.85,this.limitBuyFunc=function(){Utils.MsgUtils.addMidMsg("已购买")}}this.lb_limitLeft.text=this.limitConfig[4][0][3]-o+"份"}break;case 3:this.visible=!1}}},i.prototype.updateLimitPanelTime=function(){var t=y.GameMVC.activityPy.allActivityData[this.code];if(t&&t.data){function e(t){var e=[];for(var i in n){var a=n[i];a[0]==t&&e.push(a)}return e}var n=JSON.parse(t.content),i=y.GameMVC.activityPy.getToday(this.code),a=e(i),o=e(i+1);this.nextStatusLeftTime=0,this.curLimitStatus=0,this.limitConfig=void 0;var r=Utils.TimerManager.getServerTime();for(var s in a){var c=a[s][2];(l=new Date(1e3*r)).setHours(c[0][0],c[0][1],c[0][2]);var d=Math.floor(l.getTime()/1e3);l.setHours(c[1][0],c[1][1],c[1][2]);var h=Math.floor(l.getTime()/1e3);if(r<d){this.nextStatusLeftTime=d-r,this.curLimitStatus=1,this.limitConfig=a[s];break}if(r<h){this.nextStatusLeftTime=h-r,this.curLimitStatus=2,this.limitConfig=a[s];break}}if(!this.curLimitStatus)if(o&&0<o.length)for(var s in o){var l;if(c=o[s][2],(l=new Date(1e3*r)).setHours(c[0][0],c[0][1],c[0][2]),d=Math.floor(l.getTime()/1e3)+86400,l.setHours(c[1][0],c[1][1],c[1][2]),h=Math.floor(l.getTime()/1e3)+86400,r<d){this.nextStatusLeftTime=d-r,this.curLimitStatus=1,this.limitConfig=o[s];break}if(r<h){this.nextStatusLeftTime=h-r,this.curLimitStatus=2,this.limitConfig=o[s];break}}else this.curLimitStatus=3}},i);function i(){var t=e.call(this)||this;return t.code=EActivityType.LimitNumGift1,t.skinName="Activity202",y.GameMVC.activityPy.GetActivityInfo(t.code,function(){t.updateView()}),t}y.Activity1202=t}(game=game||{}),function(s){var e,t=(e=s.ActivityCommonPanel,__extends(i,e),i.prototype.initList=function(){this.list_items.itemRenderer=n},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){t.hide()},this.rootPanel.blb_title.text="超值礼盒",this.img_top.source="gewy_img_chaozhilihe_png"},i.prototype.updateView=function(t){if(t&&t.activityType){this.code=t.activityType;var e=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(e):this.list_items.dataProvider=new eui.ArrayCollection(e),0<=[EActivityType.DTRecharge,EActivityType.DTRecharge1,EActivityType.DTRecharge2].indexOf(this.code)?this.bm_time.visible=!0:this.bm_time.visible=!1,this.code}},i.prototype.getDataList=function(){var l=this;if(this.code){var p=s.ActivityConfig.Config[this.code];if(p){var t=this.info;if(t&&t.data){this.timer&&this.timer&&egret.clearInterval(this.timer);var e=t.endDt,i=Utils.TimerManager.getServerTime();this.leftTime=e-i,this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond1(this.leftTime),this.timer=egret.setInterval(function(){--l.leftTime<=0?l.hide():l.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond1(l.leftTime)},this,1e3);var u=t.data.targeted,g=(t.data.day,[]),a=JSON.parse(t.content);a[2]&&(this.img_top.source=a[2]+"_png");var n=t.data.curCycle;if(n&&p.cycle)for(var o in a[1]){var r=a[1][o];if(r[0]==n){a=r[1];break}}var m=s.AppFacade.getInstance().retrieveProxy(s.RechargePy.N),y=m.goodList;return a.forEach(function(t){var e,i=t[0],a=t[1],n=t[2];for(var o in y){var r=y[o];if(i==r.id){e=r;break}}var s="";s=e?p.formatString.format([e.price*Utils.SDKMgr.globalIAPRate]):"找不到商品信息";var c=0;u.forEach(function(t){t.id==i&&(c=t.num)});var d=REWARD_STATUS.CANBUY;n<=c&&(d=REWARD_STATUS.HASBUY);var h={title:s,tips:c+"/"+n,status:d,rewards:a,btnFunc:function(){e?c<n?m.purchase(e,2,"",JSON.stringify({activityType:l.code}),{activityType:l.code}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};g.push(h)}),g.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),g}}}},i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.leftTime=0,t.skinName="ActivityMidAutumnTaskSkin",t}s.Activity207=t;var a,n=(a=s.ActivityCommonListItem,__extends(o,a),o.prototype.dataChanged=function(){a.prototype.dataChanged.call(this),this.gp_rewards.scaleX=this.gp_rewards.scaleY=.85},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityCommonListItemSkin2",t}}(game=game||{}),function(v){var e,t=(e=BaseFull,__extends(i,e),Object.defineProperty(i.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent(),this.addNotice(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_redbag),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_shop3),v.GameMVC.rankPy.GetRankList(RankingType.RankingTypeActivityNewZoneDoubleTwelveRank,function(){});var t=new v.Activity1202;this.gp_limit.addChild(t),this.limitPanel=t,DragonBoneTools.create("common_11huodong04",function(t){t.scaleX=t.scaleY=1,t.x=this.gp_redEffect.width/2,t.y=this.gp_redEffect.height/2,t.animation.play(),this.gp_redEffect.addChild(t)},this),UIActionManager.addEffect(this.gp_effectRainF,"common_11huodong01_1",{offectY:110}),UIActionManager.addEffect(this.btn_shop,"common_11huodong01_2",{offectX:5,offectY:43}),UIActionManager.addEffect(this.gp_chongzhi,"common_11huodong01_3"),UIActionManager.addEffect(this.gp_shop2,"common_activity_shuang12_01",{childIndex:0})},i.prototype.updateView=function(t){var a=this;this.code=t&&t.activityType||t&&t.code||this.code;var e=this.info;if(e&&e.data){var i=JSON.parse(e.content),n=e.data.grade[0],o=e.data.grade[1],r=0;function s(t){var e=i[1][t];e[0]==n&&(c.img_panel.source=e[4]+"_png",c.titleEffectName!=e[5]&&UIActionManager.removeEffect(c.gp_effectTitle,function(){UIActionManager.addEffect(a.gp_effectTitle,e[5],{childIndex:0})})),e[0]==n+1&&(c.lb_needEXP.text=e[1]-o+"",r=1)}this.bm_curLevel.text=n;var c=this;for(var d in i[1])s(d);r||(this.lb_needEXP.text="已满级"),this.timer&&egret.clearInterval(this.timer),e.data.nowDt;var h=e.data.gExp;this.bm_hasGet.text=Utils.MathUtils.formatNumStyle1(h)+"/";var l=i[0][2];function p(t,e){var i=0;i=t<.33*e?1:t<.66*e?2:3,a.expProcessStage!=i&&(a.expProcessStage=i,UIActionManager.removeEffect(a.btn_exp,function(){UIActionManager.addEffect(a.btn_exp,"common_11huodong02_"+a.expProcessStage,{childIndex:0,offectX:-10,offectY:60})}))}this.bm_maxGet.text=l?Utils.MathUtils.formatNumStyle1(l):"",l<h&&(h=l);var u=i[0][1],g=i[0][0];if(p.call(this,h,l),this.timer=egret.setInterval(function(){(h+=u)<=l&&Utils.MsgUtils.addRewardMsg({rewards:[{type:2,code:6,num:u}]},a.btn_exp,{oriY:30}),l<h&&(h=l),p.call(a,h,l),a.bm_hasGet.text=Utils.MathUtils.formatNumStyle1(h)+"/"},this,1e3*g),this.updateTime(),this.timer2&&egret.clearInterval(this.timer2),this.timer2=egret.setInterval(function(){a.updateTime()},this,1e3),this.timer4&&egret.clearInterval(this.timer4),v.GameMVC.activityPy.isOpen(EActivityType.DTRechargeGift)){this.gp_shop3.touchEnabled=!0,this.gp_shop3.visible=!0;var m=v.ActivityConfig.getActivityEndDt(EActivityType.DTRechargeGift)-Utils.TimerManager.getServerTime();this.bm_shop3Time.text=Utils.TimerManager.getFormatBySecond1(m),this.timer4=egret.setInterval(function(){0<=--m?a.bm_shop3Time.text=Utils.TimerManager.getFormatBySecond1(m):a.gp_shop3.touchEnabled=!1},this,1e3)}else this.gp_shop3.visible=!1}},i.prototype.updateTime=function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney2];if(!t||!t.data)return!1;var e=v.GameMgr.getInstance().serverTime(),i=JSON.parse(t.content),a=t.data.targeted,n=[],o=new Date(1e3*e);for(var r in o.setHours(0,0,0),n.push(o.getTime()/1e3),i[0]){var s=i[0][r],c=s[0],d=s[1],h=new Date(1e3*e);h.setHours(c[0],c[1],c[2]||0);var l=h.getTime()/1e3,p=new Date(1e3*e);p.setHours(d[0],d[1],d[2]||0);var u=p.getTime()/1e3;n.push(l),n.push(u)}this.gp_redbag.visible=!0,this.gp_no.visible=!1,this.gp_redEffect.visible=!1;for(var g=0;g<n.length-1;g++)if(e>=n[g]&&e<=n[g+1]){if(g%2==0)return this.gp_no.visible=!0,void(this.lb_time.text=Utils.TimerManager.getFormatBySecond1(n[g+1]-e));var m=!1;for(var r in a){var y=a[r];if(y>=n[g]&&y<=n[g+1]){m=!0;break}}if(m)return void(n[g+2]?(this.gp_no.visible=!0,this.lb_time.text=Utils.TimerManager.getFormatBySecond1(n[g+2]-e)):this.gp_redbag.visible=!1);this.gp_redEffect.visible=!0}},i.prototype.addNotice=function(){NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.DoubleElevenCostTimes1],this.btn_achieve,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.DOUBLE12_EXP_REWARD,this.btn_nextExp,this,{percentX:130/222,percentY:10/226}),NoticeManager.addNoticeListenerAtParent(NT.ALL_ACTIVITY[EActivityType.ThirdLevelReward1],this.btn_shop,this,{percentX:237/327,percentY:270/310}),NoticeManager.addNoticeListenerAtParent(NT.DOUBLE12_CONSUME_REWARD,this.btn_rebate,this,BTN_ICON_NOTICE_POS)},i.prototype.activateComponent=function(){var i=this;this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=i.info;if(t&&t.data){var e=JSON.parse(t.content);v.GameMVC.activityMed.showHelpDialog(e[7])}},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.RankMediator.N,v.RankMediator.SV.COMMON,{module:"ActivityShuang12Rank"})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new v.ActivityShuang12TaskPanel({code:EActivityType.DoubleElevenCostTimes1,topSource:"ssy_img_renwutu2_png"})})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.GameMVC.activityMed.showViewByCode(EActivityType.ThirdLevelReward1)},this),this.gp_chongzhi.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.GameMVC.activityPy.isOpen(EActivityType.DTRecharge)?v.GameMVC.activityMed.showViewByCode(EActivityType.DTRecharge):v.GameMVC.activityPy.isOpen(EActivityType.DTRecharge1)?v.GameMVC.activityMed.showViewByCode(EActivityType.DTRecharge1):v.GameMVC.activityPy.isOpen(EActivityType.DTRecharge2)?v.GameMVC.activityMed.showViewByCode(EActivityType.DTRecharge2):Utils.MsgUtils.addMidMsg("活动未开启")},this),this.btn_exp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.DoubleTwelve,id:1,num:1}).then(function(t){v.GameMVC.activityPy.updateData_View_Reward(EActivityType.DoubleTwelve,t)})},this),this.btn_nextExp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n})},this),this.gp_redbag.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(i.gp_redEffect.visible||i.gp_no.visible)&&v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TimerLuckyMoney2)},this),this.gp_shop2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeDoubleTwelve})},this),this.gp_shop3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.GameMVC.activityPy.isOpen(EActivityType.DTRechargeGift)&&v.GameMVC.activityMed.showViewByCode(EActivityType.DTRechargeGift)},this),this.btn_rebate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s({topSource:""})})},this)},i);function i(){var t=e.call(this)||this;return t.actProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t.code=EActivityType.DoubleEleven,t.expProcessStage=0,t.titleEffectName="",t.skinName="Activity200",t}v.Activity211=t;var a,n=(a=BasePanel,__extends(o,a),Object.defineProperty(o.prototype,"info",{get:function(){return this.proxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),o.prototype.initTabbar=function(){this.tabbar.visible=!1},o.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items,this.list_items.itemRenderer=v.ActivityMidAutumnTaskPanel_TaskItem},o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.img_top.source="she_img_hengfu4_png",this.rootPanel.onCloseCB=function(){t.hide()},this.rootPanel.blb_title.text="奖励",this.initTabbar(),this.initList(),this.updateView()},o.prototype.updateView=function(t){var e=this.getDataList();this.ac_items.replaceAll(e)},o.prototype.getDataList=function(){var o=this,t=this.info;if(!t||!t.data)return[];function e(t){var e=s[t][0],i=s[t][2];if(s[t][3],1==e)return"continue";var a=REWARD_STATUS.UNAVAILABLE;e<=c&&(a=REWARD_STATUS.AVAILABLE),0<=d.indexOf(e)&&(a=REWARD_STATUS.RECEIVED);var n={id:e,key:c,title:"特惠店等级达到"+e,status:a,rewards:i,tips:c+"/"+e,btnFunc:function(t){switch(a){case REWARD_STATUS.AVAILABLE:o.getReward(e,function(){o.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};r.push(n)}var r=[],s=JSON.parse(t.content)[1],c=t.data.grade[0],d=t.data.levelTargeted;for(var i in s)e(i);return r.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),r},o.prototype.getReward=function(t,e){var i=this;Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.DoubleTwelve,id:3,num:t}).then(function(t){v.GameMVC.activityPy.updateData_View_Reward(EActivityType.DoubleTwelve,t),i.updateView()})},o);function o(t){var e=a.call(this)||this;return e.code=EActivityType.DoubleTwelve,e.proxy=v.GameMVC.activityPy,e.skinName="ActivityMidAutumnTaskSkin",e.code=EActivityType.DoubleTwelve,e}var r,s=(r=BasePanel,__extends(c,r),c.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items,this.list_items.itemRenderer=v.ActivityMidAutumnTaskPanel_TaskItem},c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.rootPanel.onCloseCB=function(){t.hide()},this.rootPanel.blb_title.text="消费返利",this.img_top.source="she_img_hengfu2_png",this.params.topSource&&(this.img_top.source=this.params.topSource),this.initList(),this.updateView()},c.prototype.updateView=function(t){var e=this.getDataList(),i=[];e.forEach(function(t){i.push(t)}),this.ac_items.replaceAll(i)},c.prototype.getDataList=function(){var r=this,t=v.GameMVC.activityPy.allActivityData[EActivityType.DoubleTwelve],s=[];if(!t||!t.data)return s;function e(t){var e=c[t],i=e[0],a=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;a<=h&&(o=REWARD_STATUS.AVAILABLE),0<=d.indexOf(i)&&(o=REWARD_STATUS.RECEIVED),s.push({id:i,rewards:n,status:o,title:"消费"+a+"钻石",tips:h+"/"+a,btnFunc:function(){switch(o){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.AVAILABLE:v.GameMVC.activityPy.DoCommonOperation(EActivityType.DoubleTwelve,i,2,function(){r.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}})}var c=JSON.parse(t.content)[4],d=t.data.targeted,h=t.data.totalCost;for(var i in c)e(i);return s.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),s},c);function c(t){var e=r.call(this)||this;return e.skinName="ActivityMidAutumnTaskSkin",e.params=t,e}}(game=game||{}),function(T){var e,t=(e=T.ActivityCommonPanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.list_root.itemRenderer=n,this.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params&&t.params.NoNeedWait?t.params&&t.params.cb&&t.params.cb.call(t):(t.btn_open.visible=!1,DragonBoneTools.playOnce({effectName:"common_weixinhongbao",parent:t.gp_main,x:t.gp_main.width/2||0,y:t.gp_main.height/2||0,keep:!1,loop:!1,doneCB:function(){t.params&&t.params.cb&&t.params.cb()}}))},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.btn_open.source="chunjie_btn_kai2_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.btn_open.source="chunjie_btn_kai1_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.btn_open.source="chunjie_btn_kai1_png"},this),this.timer=egret.setInterval(function(){t.updateRecords()},this,5e3)},i.prototype.updateRecords=function(){var t=this.info;if(!t||!t.data)return!1;var e=t.data.records,i=[],a=[];for(var n in e){var o=e[n];a.push(o)}for(var r=0;r<7;r++){var s=Math.floor(Math.random()*(a.length-1));a[s]&&(i.push(a[s]),a.splice(s,1))}i.sort(function(t,e){return t.dt-e.dt}),0<i.length?this.img_bg.visible=!0:this.img_bg.visible=!1,this.list_root.dataProvider=new eui.ArrayCollection(i)},i.prototype.updateView=function(){var e=this,t=this.info;if(!t||!t.data)return!1;var i=T.GameMgr.getInstance().serverTime(),a=JSON.parse(t.content),n=t.data.targeted,o=[],r=new Date(1e3*i);for(var s in r.setHours(0,0,0),o.push(r.getTime()/1e3),a[0]){var c=a[0][s],d=c[0],h=c[1],l=new Date(1e3*i);l.setHours(d[0],d[1],d[2]||0);var p=l.getTime()/1e3,u=new Date(1e3*i);u.setHours(h[0],h[1],h[2]||0);var g=u.getTime()/1e3;o.push(p),o.push(g)}for(var m=!1,y=void 0,v=1,f=0;f<o.length-1;f++)if(i>=o[f]&&i<=o[f+1])if(m=!0,f%2==0)v=0,y=function(){Utils.MsgUtils.addMidMsg("未到领取时间")};else{var _=!1;for(var s in n){var A=n[s];if(A>=o[f]&&A<=o[f+1]){_=!0;break}}y=_?(v=0,function(){Utils.MsgUtils.addMidMsg("未到下次领取时间")}):function(){Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.TimerLuckyMoney2}).then(function(t){e.actProxy.updateData_View_Reward(e.code,t,function(){e.hide(),T.GameMVC.activityMed.updateViewByCode(EActivityType.DoubleTwelve),T.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)})})}}m||(v=0,y=function(){Utils.MsgUtils.addMidMsg("活动未开启")}),this.params={cb:y,NoNeedWait:!v},this.updateRecords()},i);function i(){var t=e.call(this)||this;return t.skinName="RedPocketView",t.code=EActivityType.TimerLuckyMoney2,t.actProxy.GetActivityInfo(t.code),t}T.ActivityShuang12LuckyMoney=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.dataChanged=function(){this.lb_name.text=this.data.name;var t=this.data.rewards,e=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).getInfoByCode(t[0].code);this.lb_rewardName.text=e.info.name,this.lb_rewardName.textColor=COLOR_2_FONT_COLOR[e.info.color],this.lb_num.text="×"+t[0].num},o);function o(){var t=a.call(this)||this;return t.skinName="ActivityTimerLuckyMoneyItem",t}}(game=game||{}),function(b){var i,t=(i=BasePanel,__extends(e,i),Object.defineProperty(e.prototype,"info",{get:function(){return this.proxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),e.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items,this.list_items.itemRenderer=b.ActivityMidAutumnTaskPanel_TaskItem},e.prototype.onItemTap=function(t){this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0,this.updateView()},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.rootPanel.onCloseCB=function(){t.hide()},this.code==EActivityType.DoubleTwelve?this.rootPanel.blb_title.text="感恩回馈":this.rootPanel.blb_title.text="任务",this.initList(),this.updateView()},e.prototype.updateView=function(t){var e=this.getDataList(),i=[],a={};e.forEach(function(t){i.push(t),a[t.type]=a[t.type]||t.status==REWARD_STATUS.AVAILABLE}),this.ac_items.replaceAll(i);var n=b.Config.activityConfigs()[this.code];n&&(this.img_top.source=JSON.parse(n.img_title)[0]+"_png",this.rootPanel.blb_title.text=JSON.parse(n.des_title)[0])},e.prototype.getDataList=function(){var p=this,a=this.info;if(!a||!a.data)return[];var u=[],g=this.info.content,m=a.data.targeted;m[0]||(m=[]);var n=a.data.keyList;function y(t){if(p.code==EActivityType.DoubleTwelve)return a.data.totalCost;for(var e in n){var i=n[e];if(i.taskType==t)return v[t]=i.key,i.key}return 0}this.code==EActivityType.DoubleTwelve&&(g=this.info.content[4]);var v={},t=b.Config.activityConfigs()[this.code],f=t&&t.rotation||1,_=0,A=9999999,e=0;if(1!=f){for(var i=g.length/f,o=1;o<=f;o++){var r=g[l=o*i-1],s=(r[0],r[1]%1e4),c=r[3],d=this.getTypeKey(c,r);if(!(s<=(v[d]||y(d)))){A=s;break}if(!(m.length>l)){A=s;break}e++,_=s}f<=e&&(e=f-1,_=g[g.length-i-1]&&g[g.length-i-1][1]||0,A=g[g.length-1][1])}function h(t){var e=g[t],i=e[0],a=T.getMax(e[1]);if(1!=f&&(a<=_||A<a))return"continue";var n=e[2],o=e[3],r=e[4];T.code==EActivityType.DoubleTwelve&&(r=e[3]);var s=T.getTypeKey(o,e),c=v[s]||y(s),d=REWARD_STATUS.CANBUY;a<=c&&(d=REWARD_STATUS.AVAILABLE),0<=m.indexOf(i)&&(d=REWARD_STATUS.RECEIVED);var h=T.getTitle(o,e);T.code==EActivityType.ConsumeDiamondTask&&d==REWARD_STATUS.CANBUY&&(d=REWARD_STATUS.UNAVAILABLE);var l={id:i,key:a,title:h,status:d,rewards:n,tips:c-_+"/"+(a-_),btnText:d==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(t){switch(d){case REWARD_STATUS.AVAILABLE:p.code==EActivityType.DoubleTwelve?p.proxy.DoCommonOperation(p.code,i,2,function(){p.updateView(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.DoubleTwelve])}):p.getReward(i,function(){p.updateView(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.DoubleTwelve])});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:if(1e5<r){var e=r%1e5;b.GameMVC.activityMed.showViewByCode(e)}else b.MainJumpConfig.jumpTo(r);p.hide();break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}},type:T.code==EActivityType.DoubleTwelve?1:e[7]};u.push(l)}var T=this;for(var l in g)h(l);return u.sort(function(t,e){return t.status!=e.status?t.status-e.status:t.id-e.id}),u},e.prototype.getNameByCode=function(t){var e="";switch(t){case DoubleElevenPlace.Hero:e="英雄";break;case DoubleElevenPlace.Artifact:e="圣物";break;case DoubleElevenPlace.Equip:e="装备";break;case DoubleElevenPlace.Horse:e="坐骑";break;case DoubleElevenPlace.Pet:e="宠物";break;case DoubleElevenPlace.Role:e="主角"}return e},e.prototype.getTitle=function(t,e){if(this.code==EActivityType.DoubleTwelve)return"在大卖场消费满"+e[1]+"钻石";switch(t){case TaskSubType.DoubleElevenCostTimes:var i=Math.floor(e[1]/1e4),a=this.getNameByCode(i);return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([a,e[1]%1e4]);case TaskSubType.DoubleElevenViewTime:var n=Math.floor(e[1]/1e5),o=this.getNameByCode(n);return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([o,e[1]%1e5]);case TaskSubType.ActivityConsumeDiamond:return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]]);default:return(b.ActivityCommonTaskView.TaskType_2_Title[t]||"").format([e[1]%1e4])}},e.prototype.getMax=function(t){switch(this.code){case EActivityType.ConsumeDiamondTask:case EActivityType.NationalTask:case EActivityType.DoubleTwelve:case EActivityType.DoubleElevenCostTimes1:return t;default:return t%1e4}},e.prototype.getTypeKey=function(t,e){if(this.code==EActivityType.DoubleTwelve)return 1;var i=t;return 1e5<e[1]?i=1e5*Math.floor(e[1]/1e5):1e4<e[1]&&(i=1e4*Math.floor(e[1]/1e4)),i},e.prototype.getReward=function(t,e){var i=this;Utils.Socket.send("activity","GetCommonReward",{code:this.code,id:t}).then(function(t){i.info.updateData(t.info),b.GameMVC.backpackPy.handleClientReward(t.clientReward),e&&e(t)})},e);function e(t){var e=i.call(this)||this;return e.code=EActivityType.DoubleElevenCostTimes1,e.proxy=b.GameMVC.activityPy,e.skinName="ActivityMidAutumnTaskSkin",e.params=t,e.code=t&&t.activityType||t&&t.code||e.code,e}b.ActivityShuang12TaskPanel=t}(game=game||{}),function(s){var c,t=(c=s.ActivityCommonView,__extends(e,c),e.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this),UIActionManager.addEffect(this,"common_activity_kangjiyiqing_03"),this.activateComponent()},e.prototype.updateView=function(t){var n=this;c.prototype.updateView.call(this,t);var e=this.info;if(e&&e.data){var i=JSON.parse(e.content)[0],a=e.data.count,o=e.data.totalCount;c.prototype.updateActivityTime.call(this,this.bm_time,!1),UIActionManager.setGrey(this.btn_ope,a<=0);var r=REWARD_STATUS.UNAVAILABLE;0<o&&(r=REWARD_STATUS.AVAILABLE),0<o&&a<=0&&(r=REWARD_STATUS.RECEIVED,this.btn_ope.visible=!1),this.gp_rewards.removeChildren(),i.forEach(function(t){var e=new eui.Group,i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.8,Array.isArray(t)?i.updateData({reward:t}):i.updateData(t),i.horizontalCenter=i.verticalCenter=0,e.addChild(i),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.dispatchEvent(new egret.TouchEvent(egret.TouchEvent.TOUCH_TAP))},n),r==REWARD_STATUS.RECEIVED){var a=new eui.Image("xyzp_img_yilingqu_png");a.horizontalCenter=a.verticalCenter=0,e.addChild(a)}e.touchChildren=!1,n.gp_rewards.addChild(e)}),0<a?UIActionManager.addEffect(this.btn_ope,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_ope),s.GameMVC.activityMed.updateBtn(this.btn_ope,r)}},e.prototype.activateComponent=function(){var a=this;this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.info.data.count,e=a.info.data.totalCount,i=REWARD_STATUS.UNAVAILABLE;switch(0<e&&(i=REWARD_STATUS.AVAILABLE),0<e&&t<=0&&(i=REWARD_STATUS.RECEIVED),i){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("获得暗金圣物才能领取奖励哦");break;case REWARD_STATUS.AVAILABLE:a.getReward({code:a.code,id:1,num:1});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("奖励已领取")}},this)},e);function e(){var t=c.call(this)||this;return t.skinName="Activity279Skin",t}s.Activity279=t}(game=game||{}),function(a){var i,t=(i=BaseMediator,__extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,a.BattleZoneArenaView),this.addSubView(n.SV.JIJIE_CENTER,a.BattleZoneArenaJiJieCenterPanel),this.addSubView(n.SV.JIJIE_MY_TEAM,a.BattleZoneArenaJiJieMyTeamPanel),this.addSubView(n.SV.TEAM_BATTLE_RECORD,a.BattleZoneArenaTeamRecordPanel),this.addSubView(n.SV.VOTE,a.BattleZoneArenaVotePanel),this.addSubView(n.SV.TEAM_INFO,a.BattleZoneArenaTeamInfoPanel)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.PLAYER_LEVEL_UP,CN.FIGHT_ALL_DONE_AND_EXIT,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.TEAM_ARENA_UPDATE_INFO,CN.TEAM_ARENA_UPDATE_TEAM_INFO,CN.TEAM_ARENA_UPDATE_GROUP_INFO]},n.prototype.handleNotification=function(t){switch(t.getBody(),t.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.TEAM_ARENA_UPDATE_INFO:this.updateView(n.SV.MAIN);break;case CN.TEAM_ARENA_UPDATE_TEAM_INFO:this.updateView(n.SV.JIJIE_CENTER),this.updateView(n.SV.JIJIE_MY_TEAM);break;case CN.TEAM_ARENA_UPDATE_GROUP_INFO:this.updateView(n.SV.MAIN);break;case CN.PLAYER_LEVEL_UP:a.GameMVC.battleZoneArenaPy.updateNotice(!0);break;case CN.FIGHT_ALL_DONE_AND_EXIT:a.AppFacade.getInstance().retrieveProxy(a.FriendPy.N).clearInviteHistory(MODULE.TeamArena);break;case CN.LOGIN_FINAL_DONE:if(Utils.UnlockMgr.checkPass(MODULE.TeamArena,!1).allow){var e=a.GameMVC.battleZoneArenaPy;e.GetBattleZoneArenaInfo(function(){var t=e.getOpenInfo();t.status!=TeamArenaStatus.Enroll||e.isEnrolled()||PopUpManager.addPopUp({obj:new a.BattleZoneEnrollPanel(t.remainingTime)}),a.GameMVC.battleZoneArenaPy.initSchedule()}),e.GetApplyRecord()}break;case CN.GENERAL_PASS_DAY:var i=a.GameMVC.battleZoneArenaPy;i.recordController&&i.recordController.reset(),i.groupInfos.splice(0),this.updateView(n.SV.MAIN),i.initSchedule()}},n.prototype.onViewCreate=function(){},n.N="BattleZoneArenaMediator",n.SV={MAIN:1,JIJIE_CENTER:3,JIJIE_MY_TEAM:4,TEAM_BATTLE_RECORD:5,VOTE:6,TEAM_INFO:7},n);function n(t){void 0===t&&(t=null);var e=i.call(this,n.N,t)||this;return e.initNotice(),e}a.BattleZoneArenaMediator=t}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.clickCB&&t.clickCB(t.vo)},this),this.gp_heads.addChild(this.cu_playerHead1),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=.6,this.cu_playerHead1.addTapEvent(function(){t.vo.team.members[0]&&t.vo.team.members[0].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:t.vo.team.members[0].baseInfo.playerId})}),this.gp_heads.addChild(this.cu_playerHead2),this.cu_playerHead2.scaleX=this.cu_playerHead2.scaleY=.6,this.cu_playerHead2.addTapEvent(function(){t.vo.team.members[1]&&t.vo.team.members[1].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:t.vo.team.members[1].baseInfo.playerId})}),this.gp_heads.addChild(this.cu_playerHead3),this.cu_playerHead3.scaleX=this.cu_playerHead3.scaleY=.6,this.cu_playerHead3.addTapEvent(function(){t.vo.team.members[2]&&t.vo.team.members[2].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:t.vo.team.members[2].baseInfo.playerId})})},a.prototype.update=function(t){var a=this;if(t){this.vo=t.vo,this.clickCB=t.clickCB,this.amILeader=t.amILeader;var e=t.canFight;this.vo?(this.btn_fight.visible=this.amILeader,this.vo.team.serverId?this.lb_name.text="S"+this.vo.team.serverId+"·"+this.vo.team.name:this.lb_name.text=""+this.vo.team.name,3<this.vo.rank?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=this.vo.rank.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,RES.getResAsync("jjc_icon_pm_"+this.vo.rank+"_png",function(t){a.img_rank.source=t},this)),this.gp_heads.$children.forEach(function(t,e){var i=a.vo.team.members[e];t.updateData({vo:i&&i.baseInfo,showTag:!1})}),this.blb_cap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.score),this.btn_fight.visible=this.amILeader&&e,this.vo.team.id==this.proxy.team.id&&(this.btn_fight.visible=!1)):this.btn_fight.visible=!1}},a);function a(){var t=i.call(this)||this;return t.POS_X=[79,163,243],t.skinName="BattleZoneArenaPlayerItemSkin",t.proxy=game.AppFacade.getInstance().retrieveProxy(game.BattleZoneArenaPy.N),t.cu_playerHead1=e.PlayerHeadFactory.create(),t.cu_playerHead2=e.PlayerHeadFactory.create(),t.cu_playerHead3=e.PlayerHeadFactory.create(),t}e.BattleZoneArenaPlayerItem=t}(customui=customui||{}),function(a){var t=(e.registerAll=function(){(new n).register(),(new s).register()},e);function e(){}a.BattleZoneArenaProcessor=t;var i,n=(i=a.ProcessorBase,__extends(o,i),o.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.BattleZoneArenaPy.N).updateArenaInfo(e.info)},o);function o(){return i.call(this,"teamArena.TeamArenaInfoP",o)||this}var r,s=(r=a.ProcessorBase,__extends(c,r),c.prototype.execute=function(t){var e=t.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.BattleZoneArenaPy.N);i.amILeader()&&(Utils.MsgUtils.addMidMsg("组队竞技场有人申请加入队伍"),i.updateApplyRecord({records:[e.record]}))},c);function c(){return r.call(this,"teamArena.ApplyRecordP",c)||this}var d;d=a.ProcessorBase,__extends(h,d),h.prototype.execute=function(t){var e=t.getBody();a.GameMVC.battleZoneArenaPy.updateGroupInfo(e.groups)};function h(){return d.call(this,"teamArena.GroupInfoP",h)||this}}(game=game||{}),function(s){var e,t=(e=BaseProxy,__extends(i,e),i.prototype.checkApplyNotice=function(t){return this.amILeader()&&this.applyRecords&&0<this.applyRecords.length&&this.getOpenInfo().status==TeamArenaStatus.Enroll},i.prototype.checkEnrollNotice=function(){return!this.arenaInfo.teamInfo.enrolled&&this.getOpenInfo().status==TeamArenaStatus.Enroll},i.prototype.checkVoteNotice=function(){return this.checkVotable()},i.prototype.updateNotice=function(t){void 0===t&&(t=!1)},i.prototype.GetBattleZoneArenaInfo=function(e){var i=this;Utils.Socket.send("teamArena","GetTeamArenaInfo",{}).then(function(t){i.updateArenaInfo(t.info),e&&e()})},i.prototype.GetGroupInfo=function(e){var i=this;Utils.Socket.send("teamArena","GetGroupInfo",{}).then(function(t){i.updateGroupInfo(t.groups),e&&e()})},i.prototype.Enroll=function(e){var i=this;Utils.Socket.send("teamArena","Enroll",{}).then(function(t){i.updateArenaInfo(t.info),NoticeManager.updateNotice(NT.TEAM_ARENA_ENROLL),Utils.MsgUtils.addMidMsg("报名成功"),e&&e()})},i.prototype.Vote=function(t,e){var i=this;Utils.Socket.send("teamArena","Vote",{teamId:t}).then(function(t){i.updateArenaInfo(t.info),NoticeManager.updateNotice(NT.TEAM_ARENA_VOTE),Utils.MsgUtils.addMidMsg("投票成功"),e&&e()})},i.prototype.GetBattleRecord=function(i,a,n){var o=this;Utils.Socket.send("teamArena","GetBattleRecord",{teamId:i}).then(function(t){if(a==TeamArenaStatus.MatchBattle){var e=o.recordController&&o.recordController.curTeamBattleNum[i]||0;t.records=t.records.slice(0,e)}n(t)})},i.prototype.fetchAllRecord=function(e){var i=this;this.recordController||(this.recordController=new a),this.recordController.recordFetched?e():this.GetAllBattleRecord(0,function(t){i.recordController.total=t.total,i.recordController.recordFetched=!0,e()})},i.prototype.GetAllBattleRecord=function(e,i){var a=this;Utils.Socket.send("teamArena","GetAllBattleRecord",{index:e}).then(function(t){i&&i(t),0!=t.total&&(a.recordController.pushRecordToQueue(t.records),t.records.length==Number(s.Config.constConfig().TeamArenaBattleRecordOffset.constValue)&&a.GetAllBattleRecord(e+1))})},i.prototype.updateArenaInfo=function(t){this.arenaInfo.update(t),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_INFO),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_TEAM_INFO),this.updateNotice()},i.prototype.updateGroupInfo=function(t){var i=this;this.groupInfos.splice(0);var a=this.arenaInfo.teamInfo.team.id;t.forEach(function(t){var e=new s.TeamArenaGroupVO(t);e.isMyGroup=e.teams.some(function(t){return t.team.id==a}),i.groupInfos.push(e)})},i.prototype.updateTeam=function(t){this.arenaInfo.teamInfo.team.update(t),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_INFO),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_TEAM_INFO)},i.prototype.isInTeam=function(){return this.arenaInfo.teamInfo.team.id&&!0},i.prototype.isEnrolled=function(){return this.arenaInfo.teamInfo.enrolled&&!0},i.prototype.checkVotable=function(){var t=!s.GameMVC.loginPy.loginGameVO.singleSign&&!this.arenaInfo.voteTeamId&&1!=this.groupInfos.length;if(t){var e=(JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue)[0][0]+3-1-1)%7+1;t=(new Date(1e3*Utils.TimerManager.getServerTime()).getDay()||7)===e}return t},Object.defineProperty(i.prototype,"team",{get:function(){return this.arenaInfo.teamInfo.team},enumerable:!0,configurable:!0}),i.prototype.amILeader=function(){return this.isInTeam()&&this.arenaInfo.teamInfo.team.leader==this.playerProxy.playerInfoVO.playerId},i.prototype.GetCenterTeam=function(e){var i=this;this.centerTeams.splice(0),Utils.Socket.send("teamArena","GetTeamList",{}).then(function(t){Array.isArray(t.teams)&&t.teams.forEach(function(t){i.centerTeams.push(new s.TeamVO(t))}),e&&e()})},i.prototype.GetApplyRecord=function(e){var i=this;Utils.Socket.send("teamArena","GetApplyRecord",{}).then(function(t){i.updateApplyRecord(t),e&&e()})},i.prototype.updateApplyRecord=function(t){var e=this;this.applyRecords.splice(0),t&&Array.isArray(t.records)&&t.records.forEach(function(t){e.applyRecords.push(new s.ApplyRecordVO(t))}),NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},i.prototype.Quit=function(e){var i=this;Utils.Socket.send("teamArena","QuitTeam",{}).then(function(t){i.updateTeam(t.teams),e&&e(),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).clearInviteHistory(MODULE.TeamArena)})},i.prototype.Create=function(t,e){var i=this;Utils.Socket.send("teamArena","CreateTeam",{name:t}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.Refresh=function(t){return this.GetCenterTeam(t)},i.prototype.Search=function(t,e){var i=this;Utils.MathUtils.isNumber(t)?Utils.Socket.send("teamArena","SearchTeam",{id:Number(t)}).then(function(t){i.centerTeams.splice(0),Array.isArray(t.teams)&&t.teams.forEach(function(t){i.centerTeams.push(new s.TeamVO(t))}),e&&e()}):Utils.MsgUtils.addMidMsg("请输入正确的队伍ID")},i.prototype.Apply=function(t,e,i){var a=this;void 0===i&&(i=!1),Utils.Socket.send("teamArena","ApplyTeam",{id:t,isInvite:i}).then(function(t){Utils.MsgUtils.addMidMsg("已申请"),t.team&&a.updateTeam(t.team),e&&e()})},i.prototype.Kick=function(t,e){var i=this;Utils.Socket.send("teamArena","TickMember",{playerId:t}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.Agree=function(t,e){var i=this;Utils.Socket.send("teamArena","AgreeMember",{playerId:t}).then(function(t){i.updateTeam(t.team),i.updateApplyRecord(t),e&&e()})},i.prototype.Refuse=function(t,e){var i=this;Utils.Socket.send("teamArena","RefuseMember",{playerId:t}).then(function(t){i.updateTeam(t.team),i.updateApplyRecord(t),e&&e()})},i.prototype.SwitchLeader=function(t,e){var i=this;Utils.Socket.send("teamArena","TransferLeader",{playerId:t}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.SaveFormation=function(t,e){var i=this;Utils.Socket.send("teamArena","ChangeFormation",{playerIds:t}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.Archive=function(e){var i=this;Utils.Socket.send("teamArena","Archive",{}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.Invite=function(e){var i=this;Utils.Socket.send("teamArena","Invite",{}).then(function(t){i.updateTeam(t.team),e&&e()})},i.prototype.initSchedule=function(){if(this._schedule.resetSchedule(),s.GameMVC.loginPy.loginGameVO.singleSign)this._schedule.addSchedule(TeamArenaStatus.Close,[1,2,3,4,5,6,7],[[0,0],[24,0]]);else{var t=JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue),e=0!=t[2],i=[t[0][0]];this._schedule.addSchedule(TeamArenaStatus.Enroll,i,[t[0][1],t[0][2]],!e),this._schedule.addSchedule(TeamArenaStatus.Wait,i,[t[0][2],[24,0]],!e),this._schedule.addSchedule(TeamArenaStatus.Close,[1,2,3,4,5,6],[[0,0],[24,0]],!e);for(var a=[],n=t[0][0]+1;n<=t[0][0]+t[1][0];n++){var o=(n-1)%7+1;a.push(o)}var r=a.shift();this._schedule.addSchedule(TeamArenaStatus.MatchAdjust,r,[t[1][1],t[1][2]],e),this._schedule.addSchedule(TeamArenaStatus.MatchWaitBattle,r,[t[1][2],t[1][3]],e),this._schedule.addSchedule(TeamArenaStatus.MatchBattle,r,[t[1][3],[24,0]],e),this._schedule.addSchedule(TeamArenaStatus.Adjust,a,[t[1][1],t[1][2]],e),this._schedule.addSchedule(TeamArenaStatus.WaitBattle,a,[t[1][2],t[1][3]],e),this._schedule.addSchedule(TeamArenaStatus.Battle,a,[t[1][3],[24,0]],e),this._schedule.addSchedule(TeamArenaStatus.Close,7,[[0,0],[24,0]],e)}},i.prototype.getTeamArenaStatus=function(){return Utils.UnlockMgr.checkPass(MODULE.TeamArena,!1).allow&&this._schedule.checkCurrentStatus()[0]||TeamArenaStatus.Close},i.prototype.getOpenInfo=function(){var t={isOpen:!1,status:0,remainingTime:0};return t.status=this.getTeamArenaStatus(),t.isOpen=t.status!=TeamArenaStatus.NotOpen&&t.status!=TeamArenaStatus.Close,t.remainingTime=this._schedule.getCurrentTimeInterval().endDt-Utils.TimerManager.getServerTime(!1),t},i.N="BattleZoneArenaProxy",i);function i(){var t=e.call(this,i.N)||this;return t.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),t._schedule=Utils.TimerManager.createWeeklySchedule(),t.arenaInfo=new s.TeamArenaInfoVO,t.groupInfos=new Array,t.centerTeams=new Array,t.applyRecords=new Array,NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.TEAM_ARENA_ENTRANCE),NoticeManager.setChildType(NT.TEAM_ARENA_ENTRANCE,[NT.TEAM_ARENA_APPLY_CENTER,NT.TEAM_ARENA_ENROLL,NT.TEAM_ARENA_VOTE]),NoticeManager.setChildType(NT.TEAM_ARENA_APPLY_CENTER,[NT.TEAM_ARENA_APPLY]),NoticeManager.registerCB(NT.TEAM_ARENA_APPLY,t.checkApplyNotice,t,MODULE.TeamArena),NoticeManager.registerCB(NT.TEAM_ARENA_ENROLL,t.checkEnrollNotice,t,MODULE.TeamArena),NoticeManager.registerCB(NT.TEAM_ARENA_VOTE,t.checkVoteNotice,t,MODULE.TeamArena),t}s.BattleZoneArenaPy=t;var a=(n.prototype.pushRecordToQueue=function(t){this.recordQueue=this.recordQueue.concat(t);for(var e=Utils.TimerManager.getServerTime()-this.openDt,i=Math.floor(e/this._tick);this.showedRecord.length<i&&this.recordQueue[this.showedRecord.length];)this.pushRecordToShow(this.recordQueue[this.showedRecord.length]);this.showedRecord.length!=this.total?this.timer||(this.timer=egret.setInterval(this.onTicking,this,1e3*this._tick)):(this.allOver=!0,this.timer&&egret.clearInterval(this.timer)),this.onRecordChanged&&this.onRecordChanged.call(this.context)},n.prototype.onTicking=function(){if(this.showedRecord.length!=this.total){var t=this.recordQueue[this.showedRecord.length];t&&(this.pushRecordToShow(t),this.onRecordChanged&&this.onRecordChanged.call(this.context,t))}else this.allOver=!0,this.timer&&egret.clearInterval(this.timer)},n.prototype.pushRecordToShow=function(t){this.showedRecord.push(t),this.curTeamBattleNum[t.challengerTeamId]||(this.curTeamBattleNum[t.challengerTeamId]=0),this.curTeamBattleNum[t.teamId]||(this.curTeamBattleNum[t.teamId]=0),this.curTeamBattleNum[t.challengerTeamId]+=1,this.curTeamBattleNum[t.teamId]+=1},n.prototype.addRecordListener=function(t,e){this.onRecordChanged=t,this.context=e},n.prototype.removeListener=function(){this.onRecordChanged=void 0},n.prototype.reset=function(){this.recordQueue.splice(0),this.showedRecord.splice(0),this.allOver=!1,this.recordFetched=!1,this.curTeamBattleNum={}},n);function n(){this.recordQueue=[],this.showedRecord=[],this.curTeamBattleNum={},this.allOver=!1,this.recordFetched=!1,this._tick=1;var t=JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue)[1][3];this.openDt=new Date(1e3*Utils.TimerManager.getServerTime()).setHours(t[0],t[1],0,0)/1e3}}(game=game||{}),function(r){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.removeNotice(),this.battleZonePy.recordController&&this.battleZonePy.recordController.removeListener()},i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.list_rank.itemRenderer=n,this.tabbar_group.itemRendererSkinName="BattleZoneArenaView_GroupTab",this.addNotice(),this.activateComponent()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY_CENTER,this.btn_zudui,this,{percentX:110/123,percentY:10/107})},i.prototype.updateView=function(t){var e=this.battleZonePy.getOpenInfo();switch(this.curStatus=e.status,this.gp_signUp.visible=!1,this.gp_battle_match.visible=!1,this.gp_battle_prmpt.visible=!1,this.curStatus){case TeamArenaStatus.Wait:case TeamArenaStatus.Enroll:this.gp_signUp.visible=!0,this.updateSingUpGroup();break;case TeamArenaStatus.MatchAdjust:case TeamArenaStatus.MatchWaitBattle:case TeamArenaStatus.MatchBattle:this.gp_battle_match.visible=!0,this.updateMatchGroup();break;case TeamArenaStatus.Adjust:case TeamArenaStatus.WaitBattle:case TeamArenaStatus.Battle:this.gp_battle_prmpt.visible=!0,this.updatePromotionGroup();break;case TeamArenaStatus.Close:r.MainJumpConfig.jumpTo()}this.updateTime(e.remainingTime)},i.prototype.updateTopGroup=function(){var t,e=((t={})[TeamArenaStatus.Enroll]="邀请队员、调整队伍",t[TeamArenaStatus.Wait]="调整队伍",t[TeamArenaStatus.Adjust]="调整队伍",t[TeamArenaStatus.WaitBattle]="等待战斗",t[TeamArenaStatus.Battle]="战斗结束，耐心等待",t[TeamArenaStatus.MatchAdjust]="调整队伍",t[TeamArenaStatus.MatchWaitBattle]="等待战斗",t[TeamArenaStatus.MatchBattle]="战斗结束，耐心等待",t[TeamArenaStatus.Close]="冠军展示周",t),i=this.battleZonePy.isEnrolled(),a="",n=(this.battleZonePy.arenaInfo.teamInfo.team.id,this.battleZonePy.groupInfos.some(function(t){return t.isMyGroup}));a=this.curStatus==TeamArenaStatus.Enroll||i?i&&0<=[TeamArenaStatus.Adjust,TeamArenaStatus.WaitBattle,TeamArenaStatus.Battle].indexOf(this.curStatus)&&!n?"已被淘汰":e[this.curStatus]:"未报名",this.lb_curStatus.textFlow=[{text:"当前阶段：",style:{textColor:16510880}},{text:a,style:{textColor:16777215}}],i&&(this.curStatus==TeamArenaStatus.MatchBattle||this.curStatus==TeamArenaStatus.Battle&&n)?this.btn_myRecord.visible=!0:this.btn_myRecord.visible=!1,this.updateMyTeamInfo()},i.prototype.updateMyTeamInfo=function(){var t=this.curStatus!=TeamArenaStatus.MatchWaitBattle&&this.curStatus!=TeamArenaStatus.MatchAdjust,e=this.battleZonePy.arenaInfo.teamInfo;this.blb_win.text=(t?e.winNum:0)+"胜",this.blb_fail.text=(t?e.loseNum:0)+"负",this.blb_score.text="队伍积分:"+(t?e.score:0)},i.prototype.updateSingUpGroup=function(){this.heroModel.data||this.heroModel.update({model:"hero_009_01",isStatic:!0});var t=this.battleZonePy.isEnrolled();this.img_signUped.visible=t,this.btn_signUp.visible=!t,this.updateTopGroup()},i.prototype.updateMatchGroup=function(){var n=this;r.GameMVC.rankPy.GetRankList({rankType:RankingType.RankingTypeTeamArena,isTeam:!0,refreshInterval:0},function(t){var e=t.ranks;if(e.length){n.gp_battle_match_empty.visible=!1,n.gp_battle_match_list.visible=!0;var a=[];e.forEach(function(t,e){var i={info:t,index:e};a.push(i)}),n.list_rank.dataProvider=new eui.ArrayCollection(a),n.curStatus==TeamArenaStatus.MatchBattle?n.battleZonePy.fetchAllRecord(function(){if(n.gp_match_record.visible=!0,n.gp_empty.visible=!1,0!=n.battleZonePy.recordController.total)if(n.battleZonePy.recordController.allOver){if(n.gp_match_record.numChildren<5)for(var t=n.gp_match_record.numChildren;t<5;t++){var e=n.battleZonePy.recordController.showedRecord[t];if(e){var i=new g({result:e.result,team1:e.challengerTeam.name,team2:e.team.name});n.gp_match_record.addChild(i)}}}else n.updateMatchRecordList(),n.battleZonePy.recordController.addRecordListener(n.updateMatchRecordList,n)}):(n.gp_match_record.visible=!1,n.gp_empty.visible=!0)}else n.gp_battle_match_empty.visible=!0,n.gp_battle_match_list.visible=!1;n.updateTopGroup()})},i.prototype.updateMatchRecordList=function(t){var e=this.battleZonePy.recordController,i=this.list_rank.dataProvider,n=i.source;if(t){var a=t.result==EBattleResult.EBattleResultWin?t.challengerTeamId:t.teamId;for(var o in n){var r=n[o];if(r.info.team.id==a){r.info.key+=1;break}}var s=new g({result:t.result,team1:t.challengerTeam.name,team2:t.team.name});5==this.gp_match_record.numChildren&&this.gp_match_record.removeChildAt(0),this.gp_match_record.addChild(s);var c=this.battleZonePy.arenaInfo.teamInfo.team.id;t.challengerTeamId!=c&&t.teamId!=c||(a==c?this.battleZonePy.arenaInfo.teamInfo.winNum+=1:this.battleZonePy.arenaInfo.teamInfo.loseNum+=1,this.updateMyTeamInfo())}else{var d=this.battleZonePy.arenaInfo.teamInfo.team.id;n.forEach(function(t){t.info.key=0});var h=0,l=0;e.showedRecord.forEach(function(t){var e=t.result==EBattleResult.EBattleResultWin?t.challengerTeamId:t.teamId;for(var i in n){var a=n[i];if(a.info.team.id==e){a.info.key+=1;break}}t.challengerTeamId!=d&&t.teamId!=d||(e==d?h+=1:l+=1)}),this.battleZonePy.arenaInfo.teamInfo.winNum=h,this.battleZonePy.arenaInfo.teamInfo.loseNum=l,this.updateMyTeamInfo()}if(n.sort(function(t,e){return e.info.key-t.info.key}),n.forEach(function(t,e){t.index=e,t.info.rank=e+1}),i.replaceAll(n),e.allOver&&this.gp_match_record.numChildren<5)for(var p=this.gp_match_record.numChildren;p<5;p++){var u=this.battleZonePy.recordController.showedRecord[p];u&&(s=new g({result:u.result,team1:u.challengerTeam.name,team2:u.team.name}),this.gp_match_record.addChild(s))}},i.prototype.updatePromotionGroup=function(){var a=this;this.battleZonePy.GetGroupInfo(function(){if(a.battleZonePy.groupInfos.length){if(!a.tabbar_group.numChildren){for(var t=[],e=-1,i=0;i<a.battleZonePy.groupInfos.length;i++)t.push({text:""+(i+1),index:i}),a.battleZonePy.groupInfos[i].isMyGroup&&(e=i);a.tabbar_group.dataProvider=new eui.ArrayCollection(t),1==t.length&&(a.tabbar_group.visible=!1),a.tabbar_group.selectedIndex=0<=e?e:0}a.onTabbarItemTap()}else{for(i=0;i<7;i++)a.updatePmptGroup(i);a.updateVoteBtn(),Utils.MsgUtils.addMidMsg("没有小组信息")}a.updateTopGroup()})},i.prototype.onTabbarItemTap=function(t){var e=this;this.curTeamData.splice(0);var i=this.tabbar_group.selectedItem.index;this.battleZonePy.groupInfos[i].teams.forEach(function(t){e.curTeamData.push({team:t,win:void 0})}),this.arrangeTeamData();for(var a=0;a<7;a++)this.updatePmptGroup(a);this.updateVoteBtn()},i.prototype.arrangeTeamData=function(){this.curTeamData[0].team.rank!=this.curTeamData[1].team.rank&&(this.curTeamData[0].win=this.curTeamData[0].team.rank<this.curTeamData[1].team.rank,this.curTeamData[1].win=this.curTeamData[0].team.rank>this.curTeamData[1].team.rank,this.curTeamData.push(this.curTeamData[0].team.rank<this.curTeamData[1].team.rank?{team:this.curTeamData[0].team,win:void 0,left:!0}:{team:this.curTeamData[1].team,win:void 0,left:!1})),this.curTeamData[2].team.rank!=this.curTeamData[3].team.rank&&(this.curTeamData[2].win=this.curTeamData[2].team.rank<this.curTeamData[3].team.rank,this.curTeamData[3].win=this.curTeamData[2].team.rank>this.curTeamData[3].team.rank,this.curTeamData.push(this.curTeamData[2].team.rank<this.curTeamData[3].team.rank?{team:this.curTeamData[2].team,win:void 0,left:!0}:{team:this.curTeamData[3].team,win:void 0,left:!1})),this.curTeamData[4]&&this.curTeamData[5]&&this.curTeamData[4].team.rank!=this.curTeamData[5].team.rank&&(this.curTeamData[4].win=this.curTeamData[4].team.rank<this.curTeamData[5].team.rank,this.curTeamData[5].win=this.curTeamData[4].team.rank>this.curTeamData[5].team.rank,this.curTeamData.push(this.curTeamData[4].team.rank<this.curTeamData[5].team.rank?{team:this.curTeamData[4].team,win:void 0,left:!0}:{team:this.curTeamData[5].team,win:void 0,left:!1}))},i.prototype.updatePmptGroup=function(t){var e=this.curTeamData[t];if(3<t&&(e?(this["gp_line_"+t].visible=!0,this["img_line_"+t].scaleX=e.left?1:-1):this["gp_line_"+t].visible=!1),e){this["img_pmpt_bg_"+t].source=6==t?"zdjj_img_leitaik3_png":"zdjj_img_leitaik2_png",this["gp_pmpt_content_"+t].visible=!0,null!=e.win?this["img_pmpt_result_"+t].source=e.win?"zdjj_txt_sheng_png":"zdjj_txt_bai_png":this["img_pmpt_result_"+t].source="";for(var i=this["gp_pmpt_heads_"+t],a=0;a<3;a++){var n=i.$children[a];if(e.team.team.members[a]){n=n||i.addChild(customui.PlayerHeadFactory.create());var o=e.team.team.members[a].baseInfo;n.updateData({vo:o})}else n&&n.parent.removeChild(n)}return this["lb_pmpt_name_"+t].text=e.team.team.name,this["blb_pmpt_fightCap_"+t].text=e.team.team.fightCap.toString(),this["img_voted_"+t].visible=e.team.team.id==this.battleZonePy.arenaInfo.voteTeamId,!0}return this["img_pmpt_bg_"+t].source="zdjj_img_leitaik1_png",this["gp_pmpt_content_"+t].visible=!1},i.prototype.updateVoteBtn=function(){for(var t=this.battleZonePy.checkVotable(),e=1;e<5;e++){var i=this["btn_vote_"+e],a=this["lb_vote_"+e],n=this.curTeamData[e-1];n&&t?(i.visible=!0,a.visible=!0,a.text="票数："+n.team.ballot,this.battleZonePy.arenaInfo.voteTeamId==n.team.team.id?(UIActionManager.setAbsGrey(i,!0),i.label="已押注"):(UIActionManager.setAbsGrey(i,!1),i.label="押注")):(i.visible=!1,a.visible=!1)}},i.prototype.voteTeam=function(t){r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.VOTE,{team:this.curTeamData[t-1].team})},i.prototype.showBattleRecord=function(t){var i=[[1,0],[2,0],[4,1]][t];this.battleZonePy.GetBattleRecord(this.curTeamData[i[0]].team.team.id,this.curStatus,function(t){var e=t.records[i[1]];e?PopUpManager.addPopUp({obj:new r.FightRecordPreviewPanel({record:e})}):Utils.MsgUtils.addMidMsg("暂无记录")})},i.prototype.updateTime=function(t){this.timer||(this.timer=egret.setInterval(this.timerFunc,this,1e3)),this.timerDt=t,this.blb_timeDesc.text=this.curStatus==TeamArenaStatus.Close?"开启时间:":"剩余时间:"},i.prototype.timerFunc=function(){0<=this.timerDt?this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.timerDt--):this.battleZonePy.GetBattleZoneArenaInfo()},i.prototype.activateComponent=function(){var i=this;function t(t){Utils.ComponentUtils.registerListener(e["btn_vote_"+t],egret.TouchEvent.TOUCH_TAP,function(){i.voteTeam(t)},e),e["btn_review_"+(t+3)]&&Utils.ComponentUtils.registerListener(e["btn_review_"+(t+3)],egret.TouchEvent.TOUCH_TAP,function(){i.showBattleRecord(t-1)},e)}Utils.ComponentUtils.registerListener(this.tabbar_group,eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this),Utils.ComponentUtils.registerListener(this.btn_rank,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.loginPy.loginGameVO.singleSign?r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_RANK_SINGLE"}):r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_RANK"})},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.loginPy.loginGameVO.singleSign?r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_REWARD_SINGLE"}):r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_REWARD"})},this),Utils.ComponentUtils.registerListener(this.btn_shop,egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})},this),Utils.ComponentUtils.registerListener(this.btn_zudui,egret.TouchEvent.TOUCH_TAP,function(){i.battleZonePy.isInTeam()?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM,{status:i.curStatus}):i.curStatus==TeamArenaStatus.Enroll?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.JIJIE_CENTER):Utils.MsgUtils.addMidMsg("当前无法进行组队")},this),Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.TeamArena})})},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),Utils.ComponentUtils.registerListener(this.btn_signUp,egret.TouchEvent.TOUCH_TAP,function(){i.battleZonePy.isInTeam()?i.battleZonePy.amILeader()?1<i.battleZonePy.arenaInfo.teamInfo.memberNum?i.battleZonePy.Enroll():Utils.MsgUtils.addMidMsg("队伍人数不足"):Utils.MsgUtils.addMidMsg("只有队长可以报名"):Utils.MsgUtils.addMidMsg("请先组队")},this);for(var e=this,a=1;a<5;a++)t(a);function n(t){Utils.ComponentUtils.registerListener(o["gp_pmpt_"+t],egret.TouchEvent.TOUCH_TAP,function(){i.curTeamData[t]&&r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_INFO,{team:i.curTeamData[t].team.team})},o)}Utils.ComponentUtils.registerListener(this.btn_myRecord,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.battleZoneArenaPy.GetBattleRecord(i.battleZonePy.arenaInfo.teamInfo.team.id,i.curStatus,function(t){var e=t.records;e.length?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_BATTLE_RECORD,{records:e,id:i.battleZonePy.arenaInfo.teamInfo.team.id}):Utils.MsgUtils.addMidMsg("暂无战斗记录")})},this);var o=this;for(a=0;a<7;a++)n(a)},i.prototype.perClose=function(){this.timer&&egret.clearInterval(this.timer)},i);function i(){var t=e.call(this)||this;return t.battleZonePy=r.GameMVC.battleZoneArenaPy,t.backpackPy=r.GameMVC.backpackPy,t.playerPy=r.GameMVC.playerPy,t.curTeamData=[],t.skinName="BattleZoneArenaViewSkin",t}r.BattleZoneArenaView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var i=this;a.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){var t=r.GameMVC.battleZoneArenaPy.getOpenInfo().status;t==TeamArenaStatus.MatchBattle?r.GameMVC.battleZoneArenaPy.GetBattleRecord(i.data.info.team.id,t,function(t){var e=t.records;e.length?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_BATTLE_RECORD,{records:e,id:i.data.info.team.id}):Utils.MsgUtils.addMidMsg("暂无战斗记录")}):r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_INFO,{team:i.data.info.team})},this)},o.prototype.dataChanged=function(){var t=this.data.info;this.lb_name.text=t.team.name,this.lb_score.text=t.key.toString(),3<t.rank?(this.blb_rank.visible=!0,this.icon_rank.visible=!1,this.blb_rank.text=t.rank.toString()):(this.blb_rank.visible=!1,this.icon_rank.visible=!0,this.icon_rank.source=r.GameMVC.rankPy.rankIcon(t.rank)),this.data.index%2==0?this.img_bg.source="zdjj_img_zitiao2_png":this.img_bg.source="zdjj_img_zitiao1_png"},o);function o(){var t=a.call(this)||this;return t.skinName="BattleZoneArenaView_MatchRankItem",t}var s,g=(s=eui.Component,__extends(c,s),c.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.img_icon_1.source=this.data.result==EBattleResult.EBattleResultWin?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_icon_2.source=this.data.result==EBattleResult.EBattleResultWin?"zdjj_txt_bai_png":"zdjj_txt_sheng_png",this.lb_team_1.text=this.data.team1,this.lb_team_2.text=this.data.team2},c);function c(t){var e=s.call(this)||this;return e.skinName="BattleZoneArenaView_MatchRecordItem",e.data=t,e}}(game=game||{}),function(e){var i,t=(i=e.CommonJiJieCenterPanel,__extends(a,i),a.prototype.onViewCreated=function(){},a.prototype.onViewRemove=function(){},a.prototype.onShowMyTeam=function(){e.AppFacade.getInstance().showSubView(e.BattleZoneArenaMediator.N,e.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},a);function a(){var t=i.call(this)||this;return t.commonPy=e.AppFacade.getInstance().retrieveProxy(e.BattleZoneArenaPy.N),t}e.BattleZoneArenaJiJieCenterPanel=t}(game=game||{}),function(i){var a,t=(a=i.CommonJiJieMyTeamApplyPanel,__extends(e,a),e.prototype.onViewCreated=function(){},e.prototype.onViewRemove=function(){NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},e.prototype.onShowMyTeam=function(){i.AppFacade.getInstance().showSubView(i.BattleZoneArenaMediator.N,i.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},e.prototype.onFetch=function(t){this.commonPy.GetApplyRecord(function(){t()})},e);function e(t){var e=a.call(this,t)||this;return e.commonPy=i.AppFacade.getInstance().retrieveProxy(i.BattleZoneArenaPy.N),e}i.BattleZoneArenaJiJieMyTeamApplyPanel=t}(game=game||{}),function(o){var e,t=(e=o.CommonJiJieMyTeamPanel,__extends(i,e),Object.defineProperty(i.prototype,"py",{get:function(){return this.commonPy},enumerable:!0,configurable:!0}),i.prototype.canKick=function(){return!0},i.prototype.onViewCreated=function(){NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),NoticeManager.addNoticeListener},i.prototype.onViewRemove=function(){NoticeManager.removeNoticeListener(NT.TEAM_ARENA_APPLY)},i.prototype.inviteCallback=function(){var t=o.AppFacade.getInstance().retrieveProxy(o.BattleZoneArenaPy.N),a=o.Config.broadcastConfig()[28].content,e=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),n=[[2,e.playerInfoVO.name,e.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[1,"<<点击入队",t.arenaInfo.teamInfo.team.id,MODULE.TeamArena]];o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).getFriendList(function(){PopUpManager.addPopUp({obj:new o.InviteFriendView({moduleId:MODULE.TeamArena,tabbarType:11,inviteCallback:function(t,e){var i=o.AppFacade.getInstance().retrieveProxy(o.MainPy.N);i.addPrivatePlayer(t),i.SendMessage(EChatChannelType.EChatChannelTypePrivate,a,t,void 0,EChatSendCheckType.None,JSON.stringify(n),!0),o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).addInviteHistory(MODULE.TeamExpedition,t),e&&e()}})})})},i.prototype.changeOrderAbove=function(t){0<=[TeamArenaStatus.Adjust,TeamArenaStatus.MatchAdjust,TeamArenaStatus.Enroll,TeamArenaStatus.Wait].indexOf(this.curStatus)?e.prototype.changeOrderAbove.call(this,t):Utils.MsgUtils.addMidMsg("锁定时间不可调整")},i.prototype.updateView=function(t){e.prototype.updateView.call(this),this.btn_apply.enabled=this.btn_switch.enabled=this.commonPy.amILeader(),this.curStatus=t&&t.status||this.curStatus,this.curStatus&&this.curStatus!=TeamArenaStatus.Enroll?(this.btn_apply.enabled=this.btn_disband.enabled=this.btn_switch.enabled=!1,UIActionManager.setAbsGrey(this.btn_apply,!0),UIActionManager.setAbsGrey(this.btn_disband,!0),UIActionManager.setAbsGrey(this.btn_switch,!0)):(this.btn_disband.enabled=!0,UIActionManager.setAbsGrey(this.btn_disband,!1),NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),1==this.py.team.members.length&&(this.btn_switch.enabled=!1)),NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},i.prototype.onShowCenter=function(){o.AppFacade.getInstance().showSubView(o.BattleZoneArenaMediator.N,o.BattleZoneArenaMediator.SV.JIJIE_CENTER)},i.prototype.onShowApply=function(t){PopUpManager.addPopUp({obj:new o.BattleZoneArenaJiJieMyTeamApplyPanel({doneCB:function(){t&&t()}})})},i.prototype.onFetch=function(t){this.py.GetBattleZoneArenaInfo(function(){t()})},i);function i(){var t=e.call(this)||this;return t.commonPy=o.AppFacade.getInstance().retrieveProxy(o.BattleZoneArenaPy.N),t}o.BattleZoneArenaJiJieMyTeamPanel=t}(game=game||{}),function(c){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.updateView=function(t){function e(i){if(o.members[i]){var t=o.members[i].baseInfo;s["lb_name_"+i].text=t.name,s["gp_head_"+i].addChild(customui.PlayerHeadFactory.create({vo:t}));var a=t.playerId;c.GameMVC.playerPy.GetPublicPlayerInfo([a],function(t,e){e[a].publicPlayer.heroList.forEach(function(t,e){n["gp_formation_"+i].addChild(customui.BaseItemFactory.create({vo:t,type:EEntityType.EEntityTypeHero,code:t.code}))})}),r+=t.fightCap}else s.gp_root.removeChild(s["gp_"+i]),s.gp_root.height-=120}for(var n=this,o=t.team,r=0,s=this,i=0;i<3;i++)e(i);this.lb_teamName.text=o.name,this.lb_fightCap.text=r.toString()},i);function i(){var t=e.call(this)||this;return t.skinName="BattleZoneArenaTeamInfoSkin",t}c.BattleZoneArenaTeamInfoPanel=t}(game=game||{}),function(c){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.list_record.itemRenderer=n,Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},i.prototype.updateView=function(t){var e=t.records,n=[],o=t.id;e.forEach(function(t,e){var i=t.challengerTeamId==o,a={record:t,team1:i?t.challengerTeam:t.team,team2:i?t.team:t.challengerTeam,result:t.result==EBattleResult.EBattleResultDraw?EBattleResult.EBattleResultDraw:i?t.result:3-t.result,index:e+1};n.push(a)}),this.list_record.dataProvider=new eui.ArrayCollection(n)},i);function i(){var t=e.call(this)||this;return t.skinName="BattleZoneArenaTeamRecordSkin",t}c.BattleZoneArenaTeamRecordPanel=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this);for(var e=0;e<3;e++)this.gp_heads_1.addChild(customui.PlayerHeadFactory.create()),this.gp_heads_2.addChild(customui.PlayerHeadFactory.create());Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.FightRecordPreviewPanel({record:t.data.record})})},this)},o.prototype.dataChanged=function(){this.blb_index.text="第"+this.data.index+"场";var i=this.data.team1,a=this.data.team2;function t(t){var e;i.members[t]?(n.gp_heads_1.$children[t].visible=!0,(e=n.gp_heads_1.$children[t]).updateData({vo:i.members[t].baseInfo}),e.addTapEvent(function(){i.members[t].baseInfo.playerId!=c.GameMVC.playerPy.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.members[t].baseInfo.playerId})})):n.gp_heads_1.$children[t].visible=!1,a.members[t]?(n.gp_heads_2.$children[t].visible=!0,(e=n.gp_heads_2.$children[t]).updateData({vo:a.members[t].baseInfo}),e.addTapEvent(function(){a.members[t].baseInfo.playerId!=c.GameMVC.playerPy.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:a.members[t].baseInfo.playerId})})):n.gp_heads_2.$children[t].visible=!1}this.lb_name_1.text=i.name,this.lb_name_2.text=a.name;for(var n=this,e=0;e<3;e++)t(e);if(!i.fightCap){var o=0;i.members.forEach(function(t){o+=t.baseInfo.fightCap}),i.fightCap=o}if(this.blb_fightCap_1.text=i.fightCap.toString(),!a.fightCap){var r=0;a.members.forEach(function(t){r+=t.baseInfo.fightCap}),a.fightCap=r}this.blb_fightCap_2.text=a.fightCap.toString();var s=this.data.result==EBattleResult.EBattleResultWin;this.img_result_1.source=s?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_result_2.source=s?"zdjj_txt_bai_png":"zdjj_txt_sheng_png",this.img_bg.scaleX=s?1:-1},o);function o(){var t=a.call(this)||this;return t.skinName="BattleZoneArenaTeamRecordPanel_RecordItem",t}}(game=game||{}),function(e){var i,t=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_cancle,egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){e.GameMVC.battleZoneArenaPy.Vote(t.team.team.id,function(){t.hide()})},this)},a.prototype.updateView=function(t){this.team=t.team,this.lb_content.textFlow=[{text:"确定押注 "},{text:""+this.team.team.name,style:{textColor:3192305}},{text:" 为本轮组队竞技冠军吗？"}]},a);function a(){var t=i.call(this)||this;return t.skinName="BattleZoneArenaVoteSkin",t}e.BattleZoneArenaVotePanel=t}(game=game||{}),function(i){var a,t=(a=BasePanel,__extends(e,a),e.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){t.hide()}),Utils.TouchUtils.addTouchListener(this.btn_enroll,function(){i.MainJumpConfig.jumpTo(MODULE.TeamArena),t.hide()}),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer=egret.setInterval(function(){0<t.dt?t.blb_time.text=Utils.TimerManager.getFormatBySecond1(--t.dt):t.hide()},this,1e3)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e);function e(t){var e=a.call(this)||this;return e.dt=0,e.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),e.skinName="BattleZoneEnrollSkin",e.dt=t,e}i.BattleZoneEnrollPanel=t}(game=game||{}),function(i){var a,t=(a=BaseMediator,__extends(n,a),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.FashionMainView),this.addSubView(n.SV.SKILL_UP,i.FashionUpsectionPanel),this.addSubView(n.SV.ALL_INFO,i.FashionAllInfoPanel),this.addSubView(n.SV.SKILL_INFO_1,i.FashionSkillInfo1),this.addSubView(n.SV.SKILL_INFO_2,i.FashionSkillInfo2),this.addSubView(n.SV.SKILL_INFO_3,i.FashionSkillInfo3)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.TITLE_UPDATE,CN.FASHION_UPDATEMAIN,CN.SKILL_UPDATE,CN.SKILL_CHOOSE_CLEAN]},n.prototype.handleNotification=function(t){switch(t.getBody(),t.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Fashion,!1).allow&&this.proxy.GetFashionInfo(),Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&this.proxy.GetRoleSkillInfo();break;case CN.FASHION_UPDATEMAIN:(e=this.getSubView(n.SV.MAIN))&&e.onBarItemTap();break;case CN.TITLE_UPDATE:(e=this.getSubView(n.SV.MAIN))&&e.updateModel();break;case CN.SKILL_UPDATE:(e=this.getSubView(n.SV.MAIN))&&e.updateSkillInfo();break;case CN.SKILL_CHOOSE_CLEAN:var e;(e=this.getSubView(n.SV.MAIN))&&e.cleanSkillChoose()}},n.N="FashionMediator",n.SV={MAIN:1,SKILL_UP:2,ALL_INFO:3,SKILL_INFO_1:4,SKILL_INFO_2:5,SKILL_INFO_3:6},n);function n(t){void 0===t&&(t=null);var e=a.call(this,n.N,t)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.FashionPy.N),e}i.FashionMediator=t}(game=game||{}),function(t){var e=(i.registerAll=function(){},i);function i(){}t.FashionProcessor=e}(game=game||{}),function(p){var e,t=(e=BaseProxy,__extends(i,e),i.prototype.addFashionNotice=function(){NoticeManager.registerCB(NT.FASHION_ACTIVATION,this.checkNoticeInfo,this),NoticeManager.registerCB(NT.FASHION_UPGRADE,this.checkNoticeSkillUpgrade,this),NoticeManager.setChildType(NT.FASHION,[NT.FASHION_ACTIVATION,NT.FASHION_UPGRADE,NT.TITLE])},i.prototype.checkNoticeInfoByOne=function(t){var e=void 0,i=0;for(var a in this.allFashionByUuid)if(this.allFashionByUuid[a].code==t.code){var n=p.Config.fashionUpConfigByCode(t.code);if(this.allFashionByUuid[a].level+1>=n.length)return!1;for(var o in n)if(n[o].level==this.allFashionByUuid[a].level+1)return e=JSON.parse(n[o].costs),i=n[o].playerLevel,this.isInfoNotice(e,i)}return e=JSON.parse(t.costs),this.isInfoNotice(e,i)},i.prototype.checkNoticeInfo=function(){var t=!1,e=p.Config.fashionConfigList();for(var i in e){var a=e[i],n=void 0,o=0,r=!1;for(var s in this.allFashionByUuid)if(this.allFashionByUuid[s].code==a.code){r=!0;var c=p.Config.fashionUpConfigByCode(a.code);for(var d in c)if(c[d].level==this.allFashionByUuid[s].level+1){n=JSON.parse(c[d].costs),o=c[d].playerLevel;break}if(t=this.isInfoNotice(n,o))return t}if(r);else if(n=JSON.parse(a.costs),t=this.isInfoNotice(n,o))return t}return t},i.prototype.isInfoNotice=function(t,e){var i=0;if(t&&t.length){for(var a=0;a<t.length;a++)p.GameMVC.backpackPy.getItemNumByCode(t[a][1])>=t[a][2]&&i++;return i>=t.length&&this.playerPy.playerInfoVO.level>=e}return!1},i.prototype.updateFashionDict=function(t,e){var i=this;void 0===e&&(e=!1),Array.isArray(t)||(t=[t]),t.forEach(function(t){if(i.allFashionByUuid[t.uuid])i.allFashionByUuid[t.uuid].update(t);else{var e=new p.FashionVO(t);i.allFashionByUuid[t.uuid]=e}t.pos&&(i.onFormationUuid=t.uuid)})},i.prototype.getInfoByCode=function(t){for(var e in this.allFashionByUuid){var i=this.allFashionByUuid[e];if(i.code==t)return i}},i.prototype.deteleByUuids=function(t){var e=this;t.forEach(function(t){delete e.allFashionByUuid[t]})},i.prototype.GetFashionInfo=function(e){var i=this;Utils.Socket.send("fashion","GetFashionInfo",{}).then(function(t){i.updateFashionDict(t.fashionList),i.fashCoreInfo=t.info.coreInfo,i.handbookList=t.info.handbookList,NoticeManager.updateNotice(NT.FASHION),e&&e()})},i.prototype.ActivateFashion=function(t,i){var a=this;Utils.Socket.send("fashion","ActivateFashion",{code:t}).then(function(t){if(t.clientReward&&t.clientReward.fashions)for(var e in t.clientReward.fashions)a.updateFashionDict(t.clientReward.fashions[e]);a.fashCoreInfo=t.info.coreInfo,a.handbookList=t.info.handbookList,p.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),NoticeManager.updateNotice(NT.FASHION),i&&i()})},i.prototype.UpFashionGrade=function(t,e){var i=this;Utils.Socket.send("fashion","UpFashionGrade",{uuid:t}).then(function(t){i.updateFashionDict(t.fashion),i.fashCoreInfo=t.coreInfo,p.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),NoticeManager.updateNotice(NT.FASHION),e&&e()})},i.prototype.PutFashionOn=function(t,e){var i=this;Utils.Socket.send("fashion","PutFashionOn",{uuid:t}).then(function(t){i.updateFashionDict(t.fashion),i.updateFashionDict(t.oldFashion),p.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),e&&e()})},i.prototype.PutFashionDown=function(t,e){var i=this;Utils.Socket.send("fashion","PutFashionDown",{uuid:t}).then(function(t){i.updateFashionDict(t.fashion),p.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),e&&e()})},i.prototype.checkNoticeSkillUpgrade=function(){var t=!1,e=p.Config.roleSkill();for(var i in e){var a=1,n=p.Config.roleSkillUpByCode(e[i].code);for(var o in this.allSkillList)if(this.allSkillList[o][0]==e[i].code){a=this.allSkillList[o][1];break}if(a<n.length){var r=void 0,s=void 0,c=void 0,d=0;for(var h in n)if(n[h].level==a){r=n[h],s=JSON.parse(r.costs),c=JSON.parse(r.condition);break}if(this.checkSkillIsLock(c))if(s&&s.length){for(var l=0;l<s.length;l++)p.GameMVC.backpackPy.getItemNumByCode(s[l][1])>=s[l][2]&&d++;if(t=d>=s.length)return t}else t=!1}}return t},i.prototype.checkSkillIsLock=function(t){var e=!1,i=!1,a=[],n=this.allSkillList;if(t&&0<t.length&&(i=0!=t[0],a=t[1]),!(0<a.length))return e=!0;for(var o in a)for(var r in n)if(n[r][0]==a[o][0]){if(i)break;if(e=n[r][1]>=a[o][1])return e}return e},i.prototype.updateSkillDict=function(t){var e=JSON.parse(t),i=[];for(var a in e){var n=[Number(a),e[a]];i.push(n)}return i},i.prototype.GetRoleSkillInfo=function(e){var i=this;Utils.Socket.send("roleSkill","GetRoleSkillInfo",{}).then(function(t){i.allSkillList=i.updateSkillDict(t.info.skill),i.skillTreeList=t.info.skillTreeList,NoticeManager.updateNotice(NT.FASHION),e&&e()})},i.prototype.LearnRoleSkill=function(t,e){var i=this;Utils.Socket.send("roleSkill","LearnRoleSkill",{code:t}).then(function(t){i.allSkillList=i.updateSkillDict(t.info.skill),i.skillTreeList=t.info.skillTreeList,p.AppFacade.getInstance().sendNotification(CN.SKILL_UPDATE),NoticeManager.updateNotice(NT.FASHION),e&&e()})},i.prototype.ResetRoleSkill=function(e){var i=this;Utils.Socket.send("roleSkill","ResetRoleSkill",{}).then(function(t){i.allSkillList=i.updateSkillDict(t.info.skill),i.skillTreeList=t.info.skillTreeList,p.AppFacade.getInstance().sendNotification(CN.SKILL_UPDATE),NoticeManager.updateNotice(NT.FASHION),t.clientReward&&p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).handleClientReward(t.clientReward,2),e&&e()})},i.N="FashionPy",i);function i(){var t=e.call(this,i.N)||this;return t.fashCoreInfo=void 0,t.handbookList=[],t.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),t.allSkillList=void 0,t.skillTreeList=[],t.allFashionByUuid={},t.onFormationUuid="",t.addFashionNotice(),t.allSkillList=void 0,t.skillTreeList=[],t}p.FashionPy=t}(game=game||{}),function(y){var e,t=(e=BasePanel,__extends(i,e),i.prototype.perClose=function(){},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},i.prototype.updateView=function(t){if(t){var e=t.bookConfig,i=[];for(var a in e){var n={module:t.module,config:e[a],allUuid:t.allUuid,modelConfig:t.modelConfig};i.push(n)}this.list_derma.itemRenderer=o,this.list_derma.dataProvider=new eui.ArrayCollection(i)}},i);function i(){var t=e.call(this)||this;return t.py=y.AppFacade.getInstance().retrieveProxy(y.FashionPy.N),t.skinName="HeroDermaAllInfoSkin",t}y.FashionAllInfoPanel=t;var a,o=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){var t=this.data,e=JSON.parse(t.config.dermaIds),i=t.allUuid,a=0;for(var n in i)for(var o in e)i[n].code==e[o]&&a++;var r=a+"/"+e.length;for(this.lb_name.text=t.config.desc+r,this.img_isHave.visible=a==e.length,this.gp_list.removeChildren(),o=0;o<e.length;o++){var s=e[o],c=!1,d=i;for(var n in d)d[n].code==s&&(c=!0);var h=t.modelConfig[s],l=new v({info:h,isHave:c,module:t.module});l.scaleX=.8,l.scaleY=.8,l.x=140*o+10,l.y=0,this.gp_list.addChild(l)}var p=JSON.parse(t.config.attr),u=[];for(var n in p){var g={text:"+"+y.GeneralConfig.getAttrValue(p[n][1]),style:{textColor:8060686}},m={text:AttrConfig[p[n][0]].name+"   ",style:{textColor:16777215}};u.push(g,m)}this.lb_attr.textFlow=u},n);function n(){var t=a.call(this)||this;return t.skinName="HeroDermaOneInfoSkin",t}var r,v=(r=eui.Component,__extends(s,r),s.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.updateData()},s.prototype.updateData=function(){var a=this,n=this.params;this.img_choose.visible=!1,this.img_isLock.visible=!1,this.lb_name.text=n.name;var t=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]);this.isHave||(this.img_dermaType.filters=[t]),this.img_dermaType.source=n.dermaPic?n.dermaPic+"_png":"pf_img_hspz03_png",this.img_dermaType.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(a.module==MODULE.HeroDerma){var t=y.Config.allHeroConfig(),e=void 0;for(var i in t)if(t[i].subType==n.subType){e=t[i];break}y.AppFacade.getInstance().hideSubView(y.FashionMediator.N,y.FashionMediator.SV.ALL_INFO),y.AppFacade.getInstance().hideSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_DERMA),y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_DERMA,{info:e,uuid:void 0,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!1,putCB:void 0,putData:void 0})}},this)},s);function s(t){var e=r.call(this)||this;return e.skinName="HeroDermaItemSkin",t&&t.info&&(e.params=t.info,e.isHave=t.isHave,e.module=t.module),e}}(game=game||{}),function(M){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),M.GameMVC.playerPy.GetPlayerInfo()},i.prototype.childrenCreated=function(){var n=this;e.prototype.childrenCreated.call(this),this.initTabbar(),this.img_red1.visible=!1,this.img_red2.visible=!1,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this),this.cu_model.scaleX=this.cu_model.scaleY=1/.55,this.list_skill.itemRenderer=s,this.list_skill.dataProvider=this.skillDataprovider,this.scroller_skill.scrollPolicyV=eui.ScrollPolicy.OFF,this.root_list.img_lastOne.source="",this.root_list.img_nextOne.source="",this.root_list.needAutoScroll=!0,this.root_list.itemRenderer=o,this.root_list.dataProvider=this.dataprovider,this.root_list.sl_root.addEventListener(eui.UIEvent.CHANGE,this.changeItemY,this),this.root_list.addItemTapEvent(function(t){n.curSelectIndex=t.itemIndex,console.log("当前选择index",n.curSelectIndex),n.updatePos(),n.dataprovider.refresh(),n.updateFashion(),n.gp_skill.visible?n.onBarItemTap({itemIndex:i.TAB_VIEW.SKILL_TREE}):n.onBarItemTap();var e=.1*(n.root_list.sl_root.viewport.scrollH-n.lastH);0<e?n.gp_circle.rotation+=e:n.gp_circle.rotation-=-e,n.lastH=n.root_list.sl_root.viewport.scrollH},this),this.btn_book.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){M.AppFacade.getInstance().showSubView(M.FashionMediator.N,M.FashionMediator.SV.ALL_INFO,{module:MODULE.Fashion,allUuid:n.py.allFashionByUuid,bookConfig:M.Config.fashionBookConfig(),modelConfig:M.Config.fashionConfig()})},this),this.btn_all.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new M.CommonAttrDetailsPanel({attr:n.py.fashCoreInfo.attr})})},this),NoticeManager.addNoticeListener(NT.TITLE,this.btn_title.$children[0],this,BTN_ICON_NOTICE_POS),this.btn_title.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){M.GameMVC.titleMed.showSubView(M.TitleMediator.SV.MAIN)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=0;for(var e in n.py.allFashionByUuid)t+=n.py.allFashionByUuid[e].level;M.AppFacade.getInstance().showSubView(M.HeroMediator.N,M.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"时尚达人",config:M.Config.fashionMasterConfig(),totalLevel:t})},this),this.btn_puton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.uuid&&n.py.PutFashionOn(n.uuid,function(){Utils.MsgUtils.addMidMsg("佩戴成功")})},this),this.btn_putDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.uuid&&n.py.PutFashionDown(n.uuid,function(){Utils.MsgUtils.addMidMsg("卸下成功")})},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"升级"==n.btn_up.label?n.uuid&&(n.isEnough?n.py.UpFashionGrade(n.uuid,function(){n.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:n.gp_effect,y:n.gp_effect.height/2,x:n.gp_effect.width/2})}):n.playerPy.playerInfoVO.level>=n.needLevel?Utils.MsgUtils.addMidMsg("道具不足,无法升级"):Utils.MsgUtils.addMidMsg("角色等级不足,无法升级")):"激活"==n.btn_up.label&&n.code&&(n.isEnough?n.py.ActivateFashion(n.code,function(){n.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:n.gp_effect,x:n.gp_effect.width/2,y:n.gp_effect.height/2}),n.dataprovider.getItemAt(n.curSelectIndex).isCan=!1;var t=n.root_list.list_root.getVirtualElementAt(n.curSelectIndex);t&&t.gp_effect&&(t.gp_effect.removeChildren(),t.gp_effect.visible=!1)}):Utils.MsgUtils.addMidMsg("道具不足,无法激活"))},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=0,e=n.py.skillTreeList;for(var i in e)t+=e[i].num;if(0<t){var a=M.Config.constConfig().RoleSkillResetCosts;M.GameMgr.getInstance().showCommonTipsWin({costTips:"，重置主角天赋吗",source:"skill_reset",cost:a.constValue,cb:!0,clickCB:function(t){1===t.type&&n.py.ResetRoleSkill(function(){Utils.MsgUtils.addMidMsg("重置成功")})}})}else Utils.MsgUtils.addMidMsg("当前未激活任何天赋")},this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.jumpModule?M.MainJumpConfig.jumpTo(n.jumpModule):Utils.MsgUtils.addMidMsg("暂无获取途径")},this),this.btn_reborn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=n.dataprovider.getItemAt(n.curSelectIndex).config,e=n.py.getInfoByCode(t.code);e?Utils.Socket.send("fashion","RollBackFashionPreview",{uuid:e.uuid}).then(function(t){0<t.rewardPreview.rewards.length?PopUpManager.addPopUp({obj:new h({rewards:t.rewardPreview,uuid:e.uuid})}):Utils.MsgUtils.addMidMsg("没有可返还材料")}):Utils.MsgUtils.addMidMsg("该时装未激活")},this),DragonBoneTools.create("common_shizhuangtxk",function(t){this.gp_effect1.removeChildren(),t.x=this.gp_effect1.width/2,t.y=this.gp_effect1.height/2,t.scaleX=t.scaleY=1,t.animation.play(),this.gp_effect1.addChild(t)},this),DragonBoneTools.create("common_shizhuangdq",function(t){this.gp_effect2.removeChildren(),t.x=this.gp_effect2.width/2,t.y=-240,t.scaleX=t.scaleY=1,t.animation.play(),this.gp_effect2.addChild(t)},this)},i.prototype.initTabbar=function(){this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.heroInfo_tabbar.selectedIndex=0,this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_shizhuang_0",down:"_btn_yq_m_json.common_yeqian_shizhuang_1",itemIndex:i.TAB_VIEW.FASHION_INFO},{up:"_btn_yq_m_json.common_yeqian_jinengshu_0",down:"_btn_yq_m_json.common_yeqian_jinengshu_1",itemIndex:i.TAB_VIEW.SKILL_TREE}])},i.prototype.onBarItemTap=function(t){var e=this;switch(void 0===t&&(t={itemIndex:i.TAB_VIEW.FASHION_INFO}),this.gp_up.visible=!1,this.gp_skill.visible=!1,t.itemIndex){case i.TAB_VIEW.FASHION_INFO:this.blb_title.text="时装信息",this.updateFashion(),this.gp_up.visible=!0;break;case i.TAB_VIEW.SKILL_TREE:Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!0).allow?(this.blb_title.text="主角天赋",this.py.allSkillList?(this.updateSkillInfo({config:M.Config.roleSkillTree()[0],indexNum:0}),this.gp_skill.visible=!0):this.py.GetRoleSkillInfo(function(){e.updateSkillInfo({config:M.Config.roleSkillTree()[0],indexNum:0}),e.gp_skill.visible=!0})):(this.heroInfo_tabbar.selectedIndex=0,this.onBarItemTap())}},i.prototype.updatePos=function(){for(var t in this.dataprovider.source){var e=this.root_list.list_root.getVirtualElementAt(Number(t));if(this.dataprovider.getItemAt(Number(t)).isShow){var i=this.root_list.itemRenderer.itemWidth,a=(this.root_list.list_root.layout.gap+i)*Number(t),n=this.root_list.sl_root.viewport.scrollH+this.root_list.width/2,o=80-Math.abs(n-(120+a))/720*200;65<o&&(o=65),e.gp_main.y=o}}},i.prototype.changeItemY=function(){this.root_list.layout.gap;this.root_list.layout.paddingLeft;var t=this.root_list.itemRenderer.itemWidth;for(var e in this.root_list.sl_root.viewport.scrollH,this.root_list.width,this.dataprovider.source){var i=this.root_list.list_root.getVirtualElementAt(Number(e));if(this.dataprovider.getItemAt(Number(e)).isShow){var a=this.root_list.sl_root.viewport.scrollH+this.root_list.width/2,n=(this.root_list.list_root.layout.gap+t)*Number(e),o=80-Math.abs(a-(120+n))/720*200;65<o&&(o=65),i.gp_main.y=o}}var r=.1*(this.root_list.sl_root.viewport.scrollH-this.lastH);0<r?this.gp_circle.rotation+=r:this.gp_circle.rotation-=-r,this.lastH=this.root_list.sl_root.viewport.scrollH},i.prototype.updateView=function(t){t&&(this.isFirst=!0,this.params=t,this.curSelectIndex=this.params.chooseIndex,this.updateList(),this.updateFashion()),NoticeManager.updateNotice(NT.FASHION)},i.prototype.judgeListIndex=function(t){var e=this.py.allFashionByUuid;for(var i in e)if(e[i].code==t.code)return 1==e[i].pos?1:3;for(var a=0,n=JSON.parse(t.costs),o=0;o<n.length;o++)M.GameMVC.backpackPy.getItemNumByCode(n[o][1])>=n[o][2]&&a++;return a>=n.length?2:4},i.prototype.judgeIsCan=function(t){var e=this.py.allFashionByUuid;for(var i in e)if(e[i].code==t.code)return!1;for(var a=0,n=JSON.parse(t.costs),o=0;o<n.length;o++)M.GameMVC.backpackPy.getItemNumByCode(n[o][1])>=n[o][2]&&a++;return a>=n.length},i.prototype.updateList=function(){for(var t=this,e=[],i=M.Config.fashionConfigList(),a=0;a<i.length;a++){var n={indexNum:this.judgeListIndex(i[a]),isShow:!0,config:i[a],isCan:this.judgeIsCan(i[a])};e.push(n)}e.sort(function(t,e){return t.indexNum>=e.indexNum?1:-1});var o={isShow:!1};e.unshift(o),e.unshift(o),e.push(o),e.push(o);var r=e;this.dataprovider.replaceAll(r),this.isFirst&&(this.root_list.visible=!1,egret.setTimeout(function(){t.isFirst=!1,t.root_list.visible=!0,t.root_list.changeTo({itemIndex:t.curSelectIndex}),UIActionManager.playUIAction(t.root_list,5,function(){})},this,500))},i.prototype.updateModel=function(t){var e=this;if(t){if(t==this.code)return;this.code=t,this.cu_model.visible=!1,this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){e.cu_model.visible=!0,e.cu_model.onChangingDir(1)}}else this.cu_model.visible=!1,this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){e.cu_model.visible=!0,e.cu_model.onChangingDir(1)}},i.prototype.updateModelForce=function(){var t=this;this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}},i.prototype.updateFashion=function(){var i=this,t=this.py.allFashionByUuid,e=this.dataprovider.getItemAt(this.curSelectIndex).config;this.lb_name.text=e.name,this.lb_profession.text=e.name;var a=M.Config.fashionUpConfigByCode(e.code);this.lb_desc.text=e.desc,this.updateModel(e.code),this.gp_heroAvatar.removeChildren();var n=customui.PlayerHeadFactory.create();n.scaleX=n.scaleY=.7,n.touchEnabled=!1;var o=e.avatar;n.updateData({vo:{avatar:o}}),this.gp_heroAvatar.addChild(n),this.img_rarity.source=M.GeneralConfig.getTagByColor(e.color);var r=!1;this.gp_upgrade_attr.removeChildren();var s=void 0,c=!1;this.gp_costs_icon.removeChildren();var d=void 0,h=0,l=a.length-1;this.item_fightCap.update(0),this.uuid=void 0;var p=!1,u=!1;for(var g in t)if(t[g].code==this.code){c=r=!0,s=JSON.parse(t[g].attr),h=t[g].level,this.uuid=t[g].uuid,0==t[g].pos?p=!0:1==t[g].pos&&(u=!0),this.item_fightCap.update(t[g].fightCap);break}if(this.lb_level.text=h+"/"+l,this.btn_maxLevel.visible=h==l,this.btn_up.visible=!(l<=h),this.btn_puton.visible=p,this.btn_putDown.visible=u,r)for(var g in s)(y=new M.HeroMainView_AttrItem(void 0)).updateItem({type:g,num:s[g]||0}),this.gp_upgrade_attr.addChild(y);else{s=JSON.parse(e.attr);for(var m=0;m<s.length;m++){var y;(y=new M.HeroMainView_AttrItem(void 0)).updateItem({type:s[m][0],num:s[m][1]||0}),this.gp_upgrade_attr.addChild(y)}}if(c){for(var g in a)if(a[g].level==h+1){d=JSON.parse(a[g].costs),this.needLevel=a[g].playerLevel;break}}else d=JSON.parse(e.costs),this.needLevel=0;var v=0;if(this.jumpModule=e.jumpcode,d&&d.length){for(m=0;m<d.length;m++){var f=new customui.CommonIconWithNum({code:d[m][1],num:d[m][2],style:CommonIconStyle.RIGHT,showEnough:!0});f.scaleX=f.scaleY=.8,this.gp_costs_icon.addChild(f);var _=M.GameMVC.backpackPy.getItemNumByCode(d[m][1])>=d[m][2];UIActionManager.setAbsGrey(f,!_),_&&v++}this.isEnough=v>=d.length&&this.playerPy.playerInfoVO.level>=this.needLevel,this.isEnough?(this.gp_costs_icon.visible=!0,this.gp_costs_tip.visible=!1):(this.gp_costs_icon.visible=!1,this.gp_costs_tip.visible=!0,this.lb_costTip.text=e.wayDesc||"暂无获取途径")}else this.gp_costs_icon.removeChildren();if(r?(this.btn_up.label="升级",this.gp_costs_icon.visible=!0,this.gp_costs_tip.visible=!1):this.btn_up.label="激活",UIActionManager.setAbsGrey(this.btn_up,!this.isEnough),this.moneyType=[],d&&d.length){var A=!0;this.moneyType.forEach(function(t){t[0]==d[0][0]&&t[1]==d[0][1]&&(A=!1)}),A&&this.moneyType.push([d[0][0],d[0][1]])}else{var T=JSON.parse(a[1].costs),b=!0;this.moneyType.forEach(function(t){t[0]==T[0][0]&&t[1]==T[0][1]&&(b=!1)}),b&&this.moneyType.push([T[0][0],T[0][1]])}function C(e){if(I[e]){E[e].updateItem({code:I[e][2]}),E[e].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var t="";h<S[e]&&(t=S[e]+"级解锁"),i.skill_panel.visible=!0,i.skill_panel.updateItem({code:I[e][2],tips:t})},w),E[e].addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},w),E[e].addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},w),E[e].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},w);var t=h<S[e];UIActionManager.setAbsGrey(E[e],t)}else E[e].reset()}this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0});var E=[this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5],I=JSON.parse(e.skills),S=JSON.parse(e.skillUnlock),w=this;for(m=0;m<E.length;m++)C(m);this.img_red1.visible=this.py.checkNoticeInfoByOne(e),Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&(this.img_red2.visible=this.py.checkNoticeSkillUpgrade())},i.prototype.judgeIsLock=function(t){var e=!0,i=JSON.parse(t.condition),a=this.py.skillTreeList,n=0;if(i&&0<i.length){for(var o in i)for(var r in a)a[r].treeId==i[o][0]&&a[r].num>=i[o][1]&&n++;e=!(n>=i.length)}else e=!1;return e},i.prototype.updateSkillInfo=function(t){for(var e=[],i=M.Config.roleSkillTree(),a=0;a<i.length;a++){var n={indexNum:a,isChoose:0==a,isLock:this.judgeIsLock(i[a]),config:i[a],chooseCb:this.updateSkillInfo.bind(this)};e.push(n)}this.skillDataprovider.replaceAll(e);var o=void 0,r=0;for(var s in r=t?(o=t.config,t.indexNum):(o=this.dataConfig,this.chooseNum),this.dataConfig=o,this.chooseNum=r,this.skill_type_1.visible=!1,this.skill_type_2.visible=!1,this.skill_type_3.visible=!1,this.skillDataprovider.source){var c=this.list_skill.getVirtualElementAt(Number(s)),d=this.skillDataprovider.getItemAt(Number(s));r==Number(s)?(d.isChoose=!0,c&&c.gp_choose&&(c.gp_choose.visible=!0)):(d.isChoose=!1,c&&c.gp_choose&&(c.gp_choose.visible=!1))}switch(o.treeType){case 1:this.skill_type_1.visible=!0,this.skill_type_1.updateData(o.id);break;case 2:this.skill_type_2.visible=!0,this.skill_type_2.updateData(o.id);break;case 3:this.skill_type_3.visible=!0,this.skill_type_3.updateData(o.id)}var h=M.Config.roleSkillTree()[0],l=M.Config.roleSkillById(h.treeType)[0],p=M.Config.roleSkillUpByCode(l.code),u=JSON.parse(p[0].costs);if(this.moneyType=[],u&&u.length){var g=!0;this.moneyType.forEach(function(t){t[0]==u[0][0]&&t[1]==u[0][1]&&(g=!1)}),g&&this.moneyType.push([u[0][0],u[0][1]])}this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0});var m=0;for(var s in this.py.skillTreeList)o.id==this.py.skillTreeList[s].treeId&&(m=this.py.skillTreeList[s].num);var y=[];y.push({text:"该天赋树已投入",style:{textColor:6112045}}),y.push({text:m+"",style:{textColor:11012104}}),y.push({text:"点，重置返还全部资源",style:{textColor:6112045}}),this.lb_skillNum.textFlow=y,Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&(this.img_red2.visible=this.py.checkNoticeSkillUpgrade())},i.prototype.cleanSkillChoose=function(){this.skill_type_1.cleanSkillChoose(),this.skill_type_2.cleanSkillChoose(),this.skill_type_3.cleanSkillChoose()},i.TAB_VIEW={FASHION_INFO:0,SKILL_TREE:1},i);function i(){var t=e.call(this)||this;return t.moneyType=[],t.isFirst=!1,t.params=void 0,t.backpackproxy=M.AppFacade.getInstance().retrieveProxy(M.BackpackPy.N),t.py=M.AppFacade.getInstance().retrieveProxy(M.FashionPy.N),t.playerPy=M.AppFacade.getInstance().retrieveProxy(M.PlayerPy.N),t.curSelectIndex=0,t.dataprovider=new eui.ArrayCollection,t.lastH=12,t.code=void 0,t.uuid=void 0,t.isEnough=!1,t.jumpModule=0,t.needLevel=0,t.dataConfig=void 0,t.chooseNum=0,t.skillDataprovider=new eui.ArrayCollection,t.skinName="FashionMainViewSkin",t}M.FashionMainView=t;var a,o=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){this.data.isShow?(this.gp_main.visible=!0,this.img_vs.source=this.data.config.avatar+"_png",this.gp_effect.removeChildren(),this.gp_effect.visible=!1,this.data.isCan&&DragonBoneTools.create("common_shizhuangkjh",function(t){this.gp_effect.removeChildren(),t.x=this.gp_effect.width/2,t.y=this.gp_effect.height/2,t.scaleX=t.scaleY=1,t.animation.play(),this.gp_effect.addChild(t),this.gp_effect.visible=!0},this)):(this.gp_main.visible=!1,this.gp_effect.visible=!1)},n.itemWidth=130,n);function n(){var t=a.call(this)||this;return t.backpackproxy=M.AppFacade.getInstance().retrieveProxy(M.BackpackPy.N),t.playerproxy=M.AppFacade.getInstance().retrieveProxy(M.PlayerPy.N),t.py=M.AppFacade.getInstance().retrieveProxy(M.HeroSpiritPy.N),t.isLock=!1,t.skinName="FashionAvatarItemSkin",t}var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.isLock?t.updateText():t.data.isChoose||t.data.chooseCb&&t.data.chooseCb(t.data)},this),this.gp_root.scaleX=this.gp_root.scaleY=.75,this.gp_choose.scaleX=this.gp_choose.scaleY=.75,this.lb_text.scaleX=this.lb_text.scaleY=.75,this.lb_text.y=80},c.prototype.dataChanged=function(){var t=this.data;this.gp_activate.visible=!1,this.gp_choose.visible=t.isChoose,this.gp_non.visible=t.isLock,this.lb_text.text=t.config.name,this.img_icon.source=t.config.pic+"_png",UIActionManager.setAbsGrey(this.gp_root,t.isLock)},c.prototype.updateText=function(){var t=JSON.parse(this.data.config.condition);if(t&&0<t.length){var e=t[0][1],i=t[0][0],a=M.Config.roleSkillTree();for(var n in a)if(a[n].id==i){var o=a[n].name;Utils.MsgUtils.addMidMsg(o+"天赋投入"+e+"点后可解锁");break}}},c);function c(){var t=r.call(this)||this;return t.backpackproxy=M.AppFacade.getInstance().retrieveProxy(M.BackpackPy.N),t.playerproxy=M.AppFacade.getInstance().retrieveProxy(M.PlayerPy.N),t.py=M.AppFacade.getInstance().retrieveProxy(M.HeroSpiritPy.N),t.isLock=!1,t.skinName="FashionSkillItemSkin",t}var d,h=(d=BasePanel,__extends(l,d),l.prototype.childrenCreated=function(){var i=this;d.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){i.hide()},this.CommonDaTanChuKuang.blb_title.text="主角重置",this.gp_rewards.removeChildren(),M.GameMVC.activityMed.CommonGpAddReward(this.gp_rewards,this.params.rewards);var t=M.Config.constConfig().FashionRollBackCosts,e=JSON.parse(t.constValue);this.cost.updateItem({cost:e[0]}),this.CommonResourceBar.updateBar(e),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("fashion","RollBackFashion",{uuid:i.params.uuid}).then(function(t){M.GameMVC.fashionPy.updateFashionDict([t.fashion]),M.GameMVC.backpackPy.handleClientReward(t.clientReward,2);var e=M.GameMVC.fashionMed.getSubView(M.FashionMediator.SV.MAIN);e&&e.updateFashion(),i.hide()})},this)},l);function l(t){var e=d.call(this)||this;return e.skinName="PetRebornPanelSkin",e.params=t,e}}(game=game||{}),function(l){var e,t=(e=eui.Component,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.cleanSkillChoose=function(){var t=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7,this.skill_8,this.skill_9];for(var e in t)t[e].gp_choose.visible=!1},i.prototype.updateData=function(t){this.config=l.Config.roleSkillById(t),this.updateSkillInfo()},i.prototype.updateSkillInfo=function(){for(var t in this.config)this.judgeSkillPos(this.config[t])},i.prototype.judgeSkillPos=function(t){var e=JSON.parse(t.pos);1==e[0]?this.updateOneSkillInfo(this.skill_0,t):2==e[0]?1==e[1]?this.updateOneSkillInfo(this.skill_1,t,this.img_21):2==e[1]?this.updateOneSkillInfo(this.skill_2,t,this.img_22):3==e[1]&&this.updateOneSkillInfo(this.skill_3,t,this.img_23):3==e[0]?1==e[1]?this.updateOneSkillInfo(this.skill_4,t,this.img_31):2==e[1]?this.updateOneSkillInfo(this.skill_5,t,this.img_32):3==e[1]&&this.updateOneSkillInfo(this.skill_6,t,this.img_33):4==e[0]&&(1==e[1]?this.updateOneSkillInfo(this.skill_7,t,this.img_41):2==e[1]?this.updateOneSkillInfo(this.skill_8,t,this.img_42):3==e[1]&&this.updateOneSkillInfo(this.skill_9,t,this.img_43))},i.prototype.updateOneSkillInfo=function(t,e,i){var a={config:e,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};a.isLock=this.judgeLock(e),a.isActivate=this.judgeActivate(a.isLock,e),a.isEnough=this.judgeEnough(e),i&&(i.visible=a.isLock),t.updateData(a)},i.prototype.judgeLock=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0;for(var n in i)if(1==i[n].level){a=i[n];break}var o=0,r=JSON.parse(a.condition),s=!1,c=[],d=this.py.allSkillList;if(0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return e=!0;for(var n in c)for(var h in d)if(d[h][0]==c[n][0]){if(s){o++;break}if(e=d[h][1]>=c[n][1])return e}return e=o>=c.length},i.prototype.judgeActivate=function(t,e){var i=!1,a=this.py.allSkillList;if(t){for(var n in i=!0,a)if(a[n][0]==e.code){i=!1;break}}else i=!1;return i},i.prototype.judgeEnough=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0,n=0,o=this.py.allSkillList;for(var r in o)if(o[r][0]==t.code){n=o[r][1];break}if(n>=i.length)return!0;for(var s in i)if(i[s].level==n+1){a=i[s];break}var c=JSON.parse(a.costs),d=0;if(c&&c.length){for(r=0;r<c.length;r++)l.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&d++;e=d>=c.length}return e},i);function i(){var t=e.call(this)||this;return t.backpackproxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),t.py=l.AppFacade.getInstance().retrieveProxy(l.FashionPy.N),t.playerPy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.config=void 0,t.skinName="FashionSkillSkin1",t}l.FashionSkillInfo1=t}(game=game||{}),function(l){var e,t=(e=eui.Component,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.cleanSkillChoose=function(){var t=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7];for(var e in t)t[e].gp_choose.visible=!1},i.prototype.updateData=function(t){this.config=l.Config.roleSkillById(t),this.updateSkillInfo()},i.prototype.updateSkillInfo=function(){for(var t in this.config)this.judgeSkillPos(this.config[t])},i.prototype.judgeSkillPos=function(t){var e=JSON.parse(t.pos);1==e[0]?this.updateOneSkillInfo(this.skill_0,t):2==e[0]?1==e[1]?this.updateOneSkillInfo(this.skill_1,t,this.img_21):3==e[1]&&this.updateOneSkillInfo(this.skill_2,t,this.img_23):3==e[0]?1==e[1]?this.updateOneSkillInfo(this.skill_3,t,this.img_31):3==e[1]&&this.updateOneSkillInfo(this.skill_4,t,this.img_33):4==e[0]&&(1==e[1]?this.updateOneSkillInfo(this.skill_5,t,this.img_41):2==e[1]?this.updateOneSkillInfo(this.skill_6,t,void 0,[this.img_42_1,this.img_42_3]):3==e[1]&&this.updateOneSkillInfo(this.skill_7,t,this.img_43))},i.prototype.updateOneSkillInfo=function(t,e,i,a){var n={config:e,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};if(n.isLock=this.judgeLock(e),n.isActivate=this.judgeActivate(n.isLock,e),n.isEnough=this.judgeEnough(e),i&&(i.visible=n.isLock),a)for(var o=0;o<a.length;o++)a[o].visible=this.judgeImgLock(o,e);t.updateData(n)},i.prototype.judgeImgLock=function(t,e){var i=!1,a=l.Config.roleSkillUpByCode(e.code),n=void 0;for(var o in a)if(1==a[o].level){n=a[o];break}var r=JSON.parse(n.condition),s=!1,c=[],d=this.py.allSkillList;if(r&&0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return i=!0;for(var h in d)if(d[h][0]==c[t][0]){if(s)break;return i=d[h][1]>=c[t][1]}return i},i.prototype.judgeLock=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0;for(var n in i)if(1==i[n].level){a=i[n];break}var o=0,r=JSON.parse(a.condition),s=!1,c=[],d=this.py.allSkillList;if(r&&0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return e=!0;for(var n in c)for(var h in d)if(d[h][0]==c[n][0]){if(s){o++;break}if(e=d[h][1]>=c[n][1])return e}return e=o>=c.length},i.prototype.judgeActivate=function(t,e){var i=!1,a=this.py.allSkillList;if(t){for(var n in i=!0,a)if(a[n][0]==e.code){i=!1;break}}else i=!1;return i},i.prototype.judgeEnough=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0,n=0,o=this.py.allSkillList;for(var r in o)if(o[r][0]==t.code){n=o[r][1];break}if(n>=i.length)return!0;for(var s in i)if(i[s].level==n+1){a=i[s];break}var c=JSON.parse(a.costs),d=0;if(c&&c.length){for(r=0;r<c.length;r++)l.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&d++;e=d>=c.length}return e},i);function i(){var t=e.call(this)||this;return t.backpackproxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),t.py=l.AppFacade.getInstance().retrieveProxy(l.FashionPy.N),t.playerPy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.config=void 0,t.skinName="FashionSkillSkin2",t}l.FashionSkillInfo2=t}(game=game||{}),function(l){var e,t=(e=eui.Component,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.cleanSkillChoose=function(){var t=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7,this.skill_8];for(var e in t)t[e].gp_choose.visible=!1},i.prototype.updateData=function(t){this.config=l.Config.roleSkillById(t),this.updateSkillInfo()},i.prototype.updateSkillInfo=function(){for(var t in this.config)this.judgeSkillPos(this.config[t])},i.prototype.judgeSkillPos=function(t){var e=JSON.parse(t.pos);1==e[0]?this.updateOneSkillInfo(this.skill_0,t):2==e[0]?1==e[1]?this.updateOneSkillInfo(this.skill_1,t,this.img_1):2==e[1]?this.updateOneSkillInfo(this.skill_2,t,this.img_1):3==e[1]?this.updateOneSkillInfo(this.skill_3,t,this.img_1):4==e[1]&&this.updateOneSkillInfo(this.skill_4,t,this.img_1):3==e[0]&&(1==e[1]?this.updateOneSkillInfo(this.skill_5,t,this.img_31):2==e[1]?this.updateOneSkillInfo(this.skill_6,t,this.img_32):3==e[1]?this.updateOneSkillInfo(this.skill_7,t,this.img_33):4==e[1]&&this.updateOneSkillInfo(this.skill_8,t,this.img_34))},i.prototype.updateOneSkillInfo=function(t,e,i){var a={config:e,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};a.isLock=this.judgeLock(e),a.isActivate=this.judgeActivate(a.isLock,e),a.isEnough=this.judgeEnough(e),i&&(i.visible=a.isLock),t.updateData(a)},i.prototype.judgeLock=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0;for(var n in i)if(1==i[n].level){a=i[n];break}var o=0,r=JSON.parse(a.condition),s=!1,c=[],d=this.py.allSkillList;if(0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return e=!0;for(var n in c)for(var h in d)if(d[h][0]==c[n][0]){if(s){o++;break}if(e=d[h][1]>=c[n][1])return e}return e=o>=c.length},i.prototype.judgeActivate=function(t,e){var i=!1,a=this.py.allSkillList;if(t){for(var n in i=!0,a)if(a[n][0]==e.code){i=!1;break}}else i=!1;return i},i.prototype.judgeEnough=function(t){var e=!1,i=l.Config.roleSkillUpByCode(t.code),a=void 0,n=0,o=this.py.allSkillList;for(var r in o)if(o[r][0]==t.code){n=o[r][1];break}if(n>=i.length)return!0;for(var s in i)if(i[s].level==n+1){a=i[s];break}var c=JSON.parse(a.costs),d=0;if(c&&c.length){for(r=0;r<c.length;r++)l.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&d++;e=d>=c.length}return e},i);function i(){var t=e.call(this)||this;return t.backpackproxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),t.py=l.AppFacade.getInstance().retrieveProxy(l.FashionPy.N),t.playerPy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.config=void 0,t.skinName="FashionSkillSkin3",t}l.FashionSkillInfo3=t}(game=game||{}),function(o){var e,t=(e=eui.Component,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params.isCanTouch&&(o.AppFacade.getInstance().sendNotification(CN.SKILL_CHOOSE_CLEAN),t.gp_choose.visible=!0,o.AppFacade.getInstance().showSubView(o.FashionMediator.N,o.FashionMediator.SV.SKILL_UP,{config:t.params.config,isLock:t.params.isLock}))},this)},i.prototype.updateData=function(t){this.params=t,this.gp_non.visible=!1,this.gp_choose.visible=!1,this.gp_activate.visible=t.isActivate&&t.isEnough,this.img_icon.source=t.config.iconName+"_png";var e=o.Config.roleSkillUpByCode(t.config.code),i=0,a=this.py.allSkillList;for(var n in a)if(a[n][0]==t.config.code){i=a[n][1];break}this.lb_text.visible=t.isShowLevel,this.lb_text.text=i+"/"+e.length,t&&t.isNotSetAbsGrey?UIActionManager.setAbsGrey(this.gp_root,!1):this.gp_activate.visible?UIActionManager.setAbsGrey(this.gp_root,!1):UIActionManager.setAbsGrey(this.gp_root,0==i)},i);function i(){var t=e.call(this)||this;return t.params=void 0,t.backpackproxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t.py=o.AppFacade.getInstance().retrieveProxy(o.FashionPy.N),t.playerPy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),t.skinName="FashionSkillItemSkin",t}o.FashionSkillItem=t}(game=game||{}),function(v){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.isLock?this.isEnough?this.py.LearnRoleSkill(this.data.code,function(){t.updateEffect(),t.updateData()}):Utils.MsgUtils.addMidMsg("道具不足"):Utils.MsgUtils.addMidMsg("该技能暂未解锁")},this),this.resource_bar.visible=!0},i.prototype.updateEffect=function(){this.gp_effect.removeChildren(),"激活"==this.btn_up.label?DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2}):DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:this.gp_effect,y:this.gp_effect.height/2,x:this.gp_effect.width/2})},i.prototype.updateView=function(t){this.params=t,this.data=t.config,this.isLock=t.isLock,this.updateData()},i.prototype.updateData=function(){var t={config:this.params.config,isLock:!0,isActivate:!1,isEnough:!0,isShowLevel:!1,isCanTouch:!1,isNotSetAbsGrey:!0};this.skill_0.updateData(t),this.lb_name.text=this.params.config.name;var e=0,i=0,a=this.py.allSkillList,n=v.Config.roleSkillUpByCode(this.params.config.code);for(var o in a)if(a[o][0]==this.params.config.code){e=a[o][1];break}var r=!1;r=e>=n.length?(i=e,this.btn_up.visible=!1,this.img_max.visible=!0,this.img_max1.visible=!0):(i=e+1,this.btn_up.visible=!0,this.img_max.visible=!1,this.img_max1.visible=!1),this.lb_level.text=e+"/"+n.length;var s=JSON.parse(this.params.config.attr),c=void 0,d=void 0,h=0;for(var l in n)n[l].level==i?(d=JSON.parse(n[l].costs),c=JSON.parse(n[l].attr)):n[l].level==e&&(s=JSON.parse(n[l].attr));if(this.gp_cost.removeChildren(),d&&d.length&&!r){for(o=0;o<d.length;o++){var p=new customui.CommonIconWithNum({code:d[o][1],num:d[o][2],style:CommonIconStyle.RIGHT,showEnough:!0});p.scaleX=p.scaleY=.8,this.gp_cost.addChild(p);var u=v.GameMVC.backpackPy.getItemNumByCode(d[o][1])>=d[o][2];UIActionManager.setAbsGrey(p,!u),u&&h++}this.isEnough=h>=d.length}else this.gp_cost.removeChildren();if(UIActionManager.setAbsGrey(this.btn_up,!this.params.isLock||!this.isEnough),this.moneyType=[],d&&d.length){var g=!0;this.moneyType.forEach(function(t){t[0]==d[0][0]&&t[1]==d[0][1]&&(g=!1)}),g&&this.moneyType.push([d[0][0],d[0][1]])}else{var m=JSON.parse(n[0].costs),y=!0;this.moneyType.forEach(function(t){t[0]==m[0][0]&&t[1]==m[0][1]&&(y=!1)}),y&&this.moneyType.push([m[0][0],m[0][1]])}if(this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0}),this.gp_text_1.removeChildren(),this.gp_text_2.removeChildren(),r){if(c&&c.length)for(var l in c)this.updateText(this.gp_text_1,c[l],this.params.config)}else{if(s&&s.length)for(var l in s)this.updateText(this.gp_text_1,s[l],this.params.config);if(c&&c.length)for(var l in c)this.updateText(this.gp_text_2,c[l],this.params.config)}r?(this.btn_up.visible=!1,this.lb_lockText.visible=!1):(this.btn_up.visible=this.isLock,this.lb_lockText.visible=!this.btn_up.visible,this.btn_up.label=0==e?"激活":"升级"),this.lb_lockText.visible&&(this.gp_cost.removeChildren(),this.updateLockText())},i.prototype.updateLockText=function(){var t="",e=v.Config.roleSkillUpByCode(this.params.config.code),i=void 0;for(var a in e)if(1==e[a].level){i=e[a];break}var n=JSON.parse(i.condition),o=!1,r=[];if(this.py.allSkillList,0<n.length&&(o=0!=n[0],r=n[1]),0<r.length)if(1==r.length)t=(c=v.Config.roleSkillByCode()[r[0][0]]).name+"达到"+r[0][1]+"级解锁";else for(var s=0;s<r.length;s++){var c=v.Config.roleSkillByCode()[r[s][0]],d=o?"且":"或";s==r.length-1?t+=c.name+"达到"+r[s][1]+"级解锁":t+=c.name+"达到"+r[s][1]+"级"+d}this.lb_lockText.text=t},i.prototype.updateText=function(t,e,i){var a=new eui.Label;a.size=20,a.textAlign="left",a.bold=!0;var n=[];n.push({text:i.desc,style:{textColor:16775395}}),n.push({text:AttrConfig[e[0]].name+"+",style:{textColor:16775395}}),n.push({text:v.GeneralConfig.getAttrValue(e[1]),style:{textColor:36871}}),a.textFlow=n,t.addChild(a)},i);function i(){var t=e.call(this)||this;return t.isLock=!1,t.moneyType=[],t.backpackproxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),t.py=v.AppFacade.getInstance().retrieveProxy(v.FashionPy.N),t.playerPy=v.AppFacade.getInstance().retrieveProxy(v.PlayerPy.N),t.isEnough=!1,t.skinName="FashionSkillUpSkin",t}v.FashionUpsectionPanel=t}(game=game||{}),function(e){var t=(i.create=function(t){var e=Utils.ObjectPoolMgr.pop("game.ManorBaseHead",t);return e.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(e)},this),e},i);function i(){}e.ManorBaseHeadFactory=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},o.prototype.updateData=function(t){this._preParams=t,this.code=t.code,this.decorateHero(t)},o.prototype.decorateHero=function(t){this.config=e.Config.allHeroConfig(!1)[this.code]||e.Config.creepConfig(this.code),t.avatar?this.decorateIcon(ResourceUtils.png(t.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar))},o.prototype.decorateIcon=function(t){this.img_icon.source=t},o.prototype.onOPReset=function(){},o.prototype.onOPComeBack=function(t,e){t&&this.updateData(t)},o.prototype.onOPClean=function(){},o.prototype.onOPCheck=function(t){egret.log("alive")},o);function o(){var t=a.call(this)||this;return t.skinName="ManorBaseHead",t}e.ManorBaseHead=n}(game=game||{}),function(s){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.perShow=function(t){this.costValue=t.costValue,this.curNum=t.curNum,this.maxNum=t.maxNum,this.buyCB=t.buyCB,this.maxBuyNum=this.maxNum-this.curNum,this.cost=JSON.parse(this.costValue);var e=this.maxBuyNum;for(var i in this.cost){var a=this.bpProxy.getInfoByCode(this.cost[i][1]).haveNum;e=Math.min(Math.floor(a/this.cost[i][2]),e)}return this.maxBuyNum=e,!0},i.prototype.updateView=function(t){this.setValueTo(1)},i.prototype.setValueTo=function(t,e){t>this.maxBuyNum&&(t=this.maxBuyNum,e&&t<this.maxNum-this.curNum&&Utils.MsgUtils.addMidMsg("钻石不足!")),t<1&&(t=1),this.lb_num.text=t.toString(),this.updateTips()},i.prototype.updateTips=function(){this.gp_tips.removeChildren();var t=new eui.Label;for(var e in t.size=24,t.textColor=7491637,t.text="确定消耗",this.gp_tips.addChild(t),this.cost){var i=this.bpProxy.getInfoByCode(this.cost[e][1]),a=new eui.Image(ResourceUtils.png(i.info.icon));a.width=a.height=s.GeneralConfig.fixedSizeWH,this.gp_tips.addChild(a);var n=new eui.Label;n.size=24,n.textColor=7491637,this.gp_tips.addChild(n);var o=Number(this.lb_num.text)*Number(this.cost[e][2]);n.text="x"+o}var r=new eui.Label;r.size=24,r.textColor=7491637,r.text="购买?",this.gp_tips.addChild(r)},i.prototype.activateComponent=function(){var t=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(t.lb_num.text)>t.maxBuyNum&&(t.lb_num.text=t.maxBuyNum.toString()),t.updateTips()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=t.lb_num.text&&Number(t.lb_num.text)||t.setValueTo(1)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){t.setValueTo(Number(t.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){t.setValueTo(Number(t.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){t.setValueTo(Number(t.lb_num.text)+1,!0)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){t.setValueTo(Number(t.lb_num.text)+10,!0)}),Utils.TouchUtils.addTouchListener(this.btn_cancle,function(){t.hide()}),Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){t.hide(),t.buyCB(Number(t.lb_num.text))})},i);function i(){var t=e.call(this)||this;return t.skinName="ManorBuyPanel",t.bpProxy=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),t}s.ManorBuyPanel=t}(game=game||{}),function(e){var i,t=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.addEvent(),this.params&&this.params.entityList&&(2<this.params.entityList.length?this.gp_main.height=495:this.gp_main.height=445)},a.prototype.perShow=function(t){var i=(this.params=t).rewards;Array.isArray(i)&&(i={rewards:i});var a=0;return G_REWARD_NAME.forEach(function(t){var e=i[t]||[];a+=e.length}),0!=a},a.prototype.perClose=function(){if(this.params&&this.params.entityList)for(var t in this.params.entityList)e.GameMVC.manorPy.AccountRewards(Number(t))},a.prototype.addEvent=function(){var t=this;Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){t.hide()})},a.prototype.updateView=function(){var i=this;this.gp_desc.removeChildren();var t=new eui.Label;t.width=380,t.height=void 0,t.textFlow=this.params.textFlow,this.gp_desc.addChild(t),this.gp_rewards.removeChildren(),this.params.rewards.forEach(function(t){var e=customui.BaseItemFactory.create();e.updateData({reward:t}),i.gp_rewards.addChild(e)})},a);function a(){var t=i.call(this)||this;return t.skinName="ManorCollectRewardSkin",t}e.ManorCollectRewardPanel=t}(game=game||{}),function(A){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_tips),this.initScroll(),this.addEvent(),this.once(egret.Event.ENTER_FRAME,function(){t.manorPy.GetManorDetailInfo(t.vo.info.manorId)},this),this.surplus_time=0,this.cd_start=!1,this.cur_times=0,this.startTimer(1e3)},i.prototype.bindTipsPanelClick=function(t){var e=this,i=t.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.cb,this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.gp_tips.visible=!1},this)},i.prototype.perShow=function(t){return this.vo=t.vo,!0},i.prototype.perClose=function(){this.stopTimer()},i.prototype.initScroll=function(){this.list_item.itemRenderer=a},i.prototype.requireDetail=function(){this.vo&&this.vo.info&&this.vo.info.manorId&&this.manorPy.GetManorDetailInfo(this.vo.info.manorId)},i.prototype.updateView=function(t){var i=this,a=A.Config.manor()[this.vo.info.id];if(a){var n=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId),e=n.playerManorList;for(var o in this.isOwn=!1,e){var r=e[o].baseInfo.playerId;if(A.GameMVC.loginPy.isSelf(r)&&e[o].entityIndex==this.manorPy.lastEntityIndex){this.isOwn=!0;break}}var s=this.manorPy.selfEntity.baseInfo,c=!1;n.guildName&&""!=n.guildName&&s.guild&&""!=s.guild&&n.guildName==s.guild.name&&n.guildId==s.guild.id&&(c=!0);var d=[];n.num<a.num&&!this.isOwn&&d.push({isEmpty:!0,manorId:this.vo.info.manorId}),e.forEach(function(t){var e=t;e.manorId=i.vo.info.manorId,e.guildName=n.guildName,e.guildId=n.guildId,d.push(e)}),d.sort(function(t,e){return t.isEmpty?-1:e.isEmpty?1:A.GameMVC.loginPy.isSelf(t.baseInfo.playerId)&&t.entityIndex==i.manorPy.lastEntityIndex?-1:A.GameMVC.loginPy.isSelf(e.baseInfo.playerId)&&e.entityIndex==i.manorPy.lastEntityIndex?1:A.GameMVC.loginPy.isSelf(t.baseInfo.playerId)?-1:A.GameMVC.loginPy.isSelf(e.baseInfo.playerId)?1:t.baseInfo.guild&&t.baseInfo.guild.name&&t.baseInfo.guild.id==n.guildId&&t.baseInfo.guild.name==n.guildName?-1:e.baseInfo.guild&&e.baseInfo.guild.name&&e.baseInfo.guild.id==n.guildId&&e.baseInfo.guild.name==n.guildName?1:0}),this.scl_list.stopAnimation(),this.scl_list.validateNow();var h=this.scl_list.viewport.scrollV;this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(d):this.list_item.dataProvider=new eui.ArrayCollection(d);var l=this.scl_list.viewport.contentHeight-this.gp_scroll.contentHeight;this.scl_list.viewport.scrollV=Math.min(h,Math.max(l,0)),this.lb_title.text=a.name,this.lb_player_num.text=n.num+"/"+a.num,this.cd_start=0<n.num;var p=this.manorPy.calSurplusTime(n);this.surplus_time=Math.ceil(p/Math.max(n.num,1)),this.lb_collect_time.text=Utils.TimerManager.getFormatBySecond1(this.surplus_time);var u=this.manorPy.calCollectTotalGoods(n)+n.collectedTime,g=this.manorPy.calSurplusGoods(n);this.pb_exp.maximum=u+g,this.pb_exp.value=g,this.pb_exp.labelFunction=function(t,e){var i=100*t/e;return 99<=i&&a.maxCollectTime>p?"99%":Math.ceil(i)+"%"},""!=n.guildName&&n.guildName?(this.lb_guild_name.text="S"+n.guildServerId+"."+n.guildName,c?n.isSameGuild?(this.lb_improve_ratio1.textColor=16774656,this.lb_improve_ratio2.textColor=16774656):(this.lb_improve_ratio1.textColor=16774656,this.lb_improve_ratio2.textColor=9934743):(this.lb_improve_ratio1.textColor=9934743,this.lb_improve_ratio2.textColor=9934743)):(this.lb_guild_name.text="无",this.lb_improve_ratio1.textColor=9934743,this.lb_improve_ratio2.textColor=9934743);var m=this.lb_guild_name.width,y=this.img_name_bg.width;126<m&&(y=m+20,this.img_name_bg.width=Math.min(y,210));var v=JSON.parse(a.improveRatio),f=v[0]/10+"%",_=v[1]/10+"%";this.lb_improve_ratio1.text="公会归属加成+"+f,this.lb_improve_ratio2.text="公会独占加成+"+_,this.lb_enough_tips.visible=n.num>=a.num,this.bindTipsPanelClick({target:this.img_wenhao,cb:function(){i.gp_tips.visible=!0,i.lb_desc.textFlow=[{text:"占领该矿的公会，公会成员会增加"+f+"产量，当矿中没有其他公会成员时会额外增加"+_+"产量。",style:{size:20,textColor:16777215}}]}})}else console.log(" t_manor.json 未配置",this.vo.info.id)},i.prototype.removeManorEntity=function(t){this.vo.info.manorId==t.manorId&&this.hide()},i.prototype.addEvent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.gp_look.touchEnabled=!0,this.gp_look.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=A.Config.manor()[this.vo.info.id];if(t){var e=JSON.parse(t.oneDayRewards),i="";if(this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId).isSpecial){var a=JSON.parse(t.improveRatio);for(var n in i="超级矿产量额外增加"+a[2]/10+"%",e)e[n][2]=Math.ceil(e[n][2]*(1+a[2]/1e3))}A.AppFacade.getInstance().showSubView(A.CommonMediator.N,A.CommonMediator.SV.REWARD_PANEL,{rewards:e,top_tips:"预计每5秒可产出",bottom_tips:i,type:A.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else console.log(" t_manor.json 未配置",this.vo.info.id)},this),this.lb_look.textFlow=[{text:"点击查看",style:{href:"event:showTips",size:20,underline:!0}}],this.lb_look.touchEnabled=!1},i.prototype.startTimer=function(t,e){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=t||1e3,this.timer.repeatCount=e||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},i.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},i.prototype.timerFunc=function(){this.cur_times+=1,3<=this.cur_times&&(this.cur_times=0),this.cd_start&&(this.surplus_time-=1,this.surplus_time<=0&&(this.surplus_time=0),this.lb_collect_time&&this.isOwn&&(this.lb_collect_time.text=Utils.TimerManager.getFormatBySecond1(this.surplus_time)))},i.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},i);function i(){var t=e.call(this)||this;return t.skinName="ManorDetailPanel",t.isOwn=!1,t.manorPy=A.AppFacade.getInstance().retrieveProxy(A.ManorProxy.N),t}A.ManorDetailPanel=t;var h,a=(h=eui.ItemRenderer,__extends(n,h),n.prototype.childrenCreated=function(){h.prototype.childrenCreated.call(this),this.addEvent()},n.prototype.addEvent=function(){var t=this;this.btn_capture.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this,i=this.data.manorId,a=this.data.baseInfo.playerId,n=this.manorPy.lastEntityIndex,o=this.data.entityIndex;A.GameMVC.loginPy.isSelf(a)?Utils.MsgUtils.addMidMsg("不能挑战自己!"):(A.GameMVC.commonMed.showContinuousBattleView({pb1:"manor",pb2:"Capture",params:{manorId:i,tPlayerId:a,entityIndex:n,tEntityIndex:o},tipsFunc:function(t){return"第"+t+"场"},closeCB:function(){e.manorPy.GetManorDetailInfo(i)}}),this.manorMed.hideSubView(A.ManorMediator.SV.DETAIL))},this),this.img_add_zi.touchEnabled=!1,this.img_plus.touchEnabled=!1,this.img_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this.data.manorId,i=this.manorPy.lastEntityIndex;this.manorPy.Capture(e,0,i,0)},this),this.btn_leave.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var e=this;A.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定迁出该矿点吗?",source:"manor_leave",cb:!0,clickCB:function(t){1==t.type&&(e.manorPy.LeaveManor(e.manorPy.lastEntityIndex),e.manorMed.hideSubView(A.ManorMediator.SV.DETAIL))}})},this),this.playerHead.addTapEvent(function(){t.data&&t.data.baseInfo&&t.data.baseInfo.playerId&&A.AppFacade.getInstance().showSubView(A.FriendMediator.N,A.FriendMediator.SV.INFO,{playerId:t.data.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:t.data.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},n.prototype.dataChanged=function(){h.prototype.dataChanged.call(this);var t=this.data.isEmpty;if(this.ep_add.visible=t,this.ep_member.visible=!t,t);else{var e=this.data.baseInfo;this.img_self_team.visible=!1,this.blb_self_team.visible=!1,A.GameMVC.loginPy.isSelf(e.playerId)?(this.btn_capture.visible=!1,this.data.entityIndex==this.manorPy.lastEntityIndex?this.btn_leave.visible=!0:(this.btn_leave.visible=!1,this.img_self_team.visible=!0,this.blb_self_team.visible=!0)):(this.btn_capture.visible=!0,this.btn_leave.visible=!1);var i=0,a="",n=A.GameMVC.guildPy.guildDetail;n&&(i=n.guildId,a=n.name);var o=this.data.baseInfo.serverId,r=this.data.baseInfo.guild,s=0,c="";r&&(s=r.id,c=r.name),0!=i&&0!=s&&String(i)==String(s)&&""!=c&&""!=a&&c==a&&(this.btn_capture.visible=!1),this.playerHead.updateData({vo:e,ignoreLevel:1,effect:!1}),this.lb_name.text=e.name;var d="";e.guild&&e.guild.name&&(d="S"+o+"."+c),this.lb_guild_name.text=d,this.item_fightCap.update(this.data.teamInfo.fightCap),this.pb_exp.maximum=100,this.pb_exp.value=this.data.blood,this.data.guildName&&""!=this.data.guildName&&e.guild&&e.guild.name&&this.data.guildName==e.guild.name&&this.data.guildId==e.guild.id?this.img_own.visible=!0:this.img_own.visible=!1}},n);function n(){var t=h.call(this)||this;return t.skinName="ManorDetailPanel_Item",t.manorPy=A.AppFacade.getInstance().retrieveProxy(A.ManorProxy.N),t.manorMed=A.AppFacade.getInstance().retrieveMediator(A.ManorMediator.N),t}}(game=game||{}),function(v){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.addEvent()},i.prototype.perShow=function(t){return this.vo=t.vo,this.choice=t.choice,!0},i.prototype.perClose=function(){},i.prototype.updateView=function(t){var i=this,a=v.Config.manor()[this.vo.info.id];if(a){var e=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId);this.lb_title.text=a.name;var n=e.isSpecial;if(n){var o=JSON.parse(a.improveRatio);this.lb_tips.text="超级矿产量额外增加"+o[2]/10+"%"}this.lb_tips.visible=n,this.lb_player_num.text=e.num+"/"+a.num;var r=this.manorPy.calCollectTotalGoods(e)+e.collectedTime,s=this.manorPy.calSurplusGoods(e);this.pb_exp.maximum=r+s,this.pb_exp.value=s;var c=this.manorPy.calSurplusTime(e);this.pb_exp.labelFunction=function(t,e){var i=100*t/e;return 99<=i&&a.maxCollectTime>c?"99%":Math.ceil(i)+"%"},""!=e.guildName&&e.guildName?this.lb_guild_name.text="S"+e.guildServerId+"."+e.guildName:this.lb_guild_name.text="无";var d=this.lb_guild_name.width,h=this.img_name_bg.width;126<d&&(h=d+20,this.img_name_bg.width=Math.min(h,210));var l=JSON.parse(a.oneDayRewards);if(n)for(var p in o=JSON.parse(a.improveRatio),l)l[p][2]=Math.ceil(l[p][2]*(1+o[2]/1e3));var u=l;Array.isArray(u)&&(u={rewards:u}),this.rewardNum=0;var g=[];G_REWARD_NAME.forEach(function(t){var e=u[t]||[];0<e.length&&e.forEach(function(t){var e={type:t.type||t[0],code:t.code||t[1],num:t.num||t[2]||1};g.push(e),++i.rewardNum})}),u.isArray&&0==this.rewardNum&&0<u.length&&(u||[]).forEach(function(t){var e={type:t.type||t[0],code:t.code||t[1],num:t.num||t[2]||1};g.push(e),++i.rewardNum});var m=6<this.rewardNum?6:this.rewardNum,y=new eui.ArrayCollection(g);this.reward_1.itemRenderer=f,this.reward_1.dataProvider=y,this.sl_reward.width=84*m+10*(m-1),this.sl_reward.height=84,this.sl_reward.x=(this.gp_root.width-this.sl_reward.width)/2,this.btn_confirm.visible=this.choice}else console.log(" t_manor.json 未配置",this.vo.info.id)},i.prototype.addEvent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().sendNotification(CN.MANOR_CHOICE_MINI_MAP_POINT,{vo:this.vo}),this.hide(),v.AppFacade.getInstance().hideSubView(v.ManorMediator.N,v.ManorMediator.SV.MINI_MAP)},this)},i);function i(){var t=e.call(this)||this;return t.skinName="ManorDetailSimplePanel",t.manorPy=v.AppFacade.getInstance().retrieveProxy(v.ManorProxy.N),t}v.ManorDetailSimplePanel=t;var a,f=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){this.baseItem_1.updateData(this.data)},n);function n(){var t=a.call(this)||this;return t.skinName="BaseItemRenderSkin",t}}(game=game||{}),function(i){var a,t=(a=BaseMediator,__extends(n,a),Object.defineProperty(n.prototype,"manorView",{get:function(){return this.getSubView(n.SV.MAIN)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorDetailPanel",{get:function(){return this.getSubView(n.SV.DETAIL)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorRecordPanel",{get:function(){return this.getSubView(n.SV.RECORD)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorTargetPanel",{get:function(){return this.getSubView(n.SV.TARGET)},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.ManorView),this.addSubView(n.SV.MINI_MAP,i.ManorMiniMapPanel),this.addSubView(n.SV.RECORD,i.ManorRecordPanel),this.addSubView(n.SV.DETAIL,i.ManorDetailPanel),this.addSubView(n.SV.DETAIL_SIMPLE,i.ManorDetailSimplePanel),this.addSubView(n.SV.BUY,i.ManorBuyPanel),this.addSubView(n.SV.TARGET,i.ManorTargetPanel),this.addSubView(n.SV.TARGET_BUY,i.ManorTargetBuyPanel),this.addSubView(n.SV.COLLECT,i.ManorCollectRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY,CN.GUAJI_LAYER_INFO_TIPS_UPDATE,CN.PLAYER_LEVEL_UP,CN.PLAYER_VIP_LEVEL_UP,CN.PLAYER_INFO_UPDATE,CN.ME_MOVE_FINISH,CN.ME_MOVE_ONE_TILE,CN.REWARD_CLOSE,CN.MANOR_FORCE_EXIT,CN.MANOR_ALL_PLAYER_UPDATE,CN.MANOR_ALL_MANOR_UPDATE,CN.MANOR_REQUIRE_DETAIL,CN.MANOR_DETAIL_UPDATE,CN.MANOR_RECORD_UPDATE,CN.MANOR_WALKNUM_UPDATE,CN.MANOR_BLOODNUM_UPDATE,CN.MANOR_GET_AWARD,CN.MANOR_REMOVE_ONE_MANOR,CN.MANOR_REMOVE_ONE_PLAYER,CN.MANOR_CAPTURE_SUCCESS,CN.MANOR_OPEN_MINI_MAP,CN.MANOR_CHOICE_MINI_MAP_POINT,CN.MANOR_PLAYER_PROXY_INFO_UPDATE,CN.MANOR_AUTO_CAPTURE_UPDATE,CN.MANOR_COLLECT_REWARD_SHOW,CN.MANOR_COLLECT_SETTING_UPDATE,CN.MANOR_UPDATE_RANKS]},n.prototype.handleNotification=function(t){var e=t.getBody();switch(t.getName()){case CN.GENERAL_PASS_DAY:break;case CN.MANOR_FORCE_EXIT:this.getSubView(n.SV.MAIN)&&i.MainJumpConfig.jumpTo();break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUAJI_LAYER_INFO_TIPS_UPDATE:break;case CN.PLAYER_LEVEL_UP:case CN.PLAYER_VIP_LEVEL_UP:case CN.PLAYER_INFO_UPDATE:t.getName(),CN.PLAYER_LEVEL_UP,this.manorTargetPanel&&this.manorTargetPanel.updatePlayerInfo();break;case CN.MANOR_ALL_MANOR_UPDATE:this.manorView&&this.manorView.updateManorEntityInfo(e.isInit);break;case CN.MANOR_ALL_PLAYER_UPDATE:this.manorView&&this.manorView.updatePlayerEntityInfo(e.isInit);break;case CN.MANOR_REQUIRE_DETAIL:this.manorDetailPanel&&this.manorDetailPanel.requireDetail();break;case CN.MANOR_DETAIL_UPDATE:this.manorDetailPanel&&this.manorDetailPanel.updateView();break;case CN.MANOR_RECORD_UPDATE:this.manorRecordPanel&&this.manorRecordPanel.updateView();break;case CN.MANOR_WALKNUM_UPDATE:break;case CN.MANOR_BLOODNUM_UPDATE:this.manorView&&this.manorView.updateBloodNum();break;case CN.MANOR_GET_AWARD:this.manorView&&this.manorView.showRewardView(e);break;case CN.MANOR_REMOVE_ONE_MANOR:this.manorView&&this.manorView.removeManorEntity(e.data),this.manorDetailPanel&&this.manorDetailPanel.removeManorEntity(e.data);break;case CN.MANOR_REMOVE_ONE_PLAYER:this.manorView&&this.manorView.removePlayerEntity(e.data);break;case CN.ME_MOVE_FINISH:this.manorView&&this.manorView.onMeMoveFinish();break;case CN.ME_MOVE_ONE_TILE:case CN.FIGHT_RESULT_CLOSE:break;case CN.MANOR_CAPTURE_SUCCESS:this.manorView&&this.manorView.playSuccessEffect();break;case CN.MANOR_OPEN_MINI_MAP:this.manorView&&this.manorView.openMiniMap(e);break;case CN.MANOR_CHOICE_MINI_MAP_POINT:break;case CN.MANOR_PLAYER_PROXY_INFO_UPDATE:this.manorView&&this.manorView.updatePlayerProxyInfo();break;case CN.MANOR_AUTO_CAPTURE_UPDATE:this.manorTargetPanel&&this.manorTargetPanel.updateAutoCapture(e.reason);break;case CN.MANOR_COLLECT_REWARD_SHOW:i.AppFacade.getInstance().showSubView(i.ManorMediator.N,i.ManorMediator.SV.COLLECT,e);break;case CN.MANOR_COLLECT_SETTING_UPDATE:this.manorTargetPanel&&(1==e.type?this.manorTargetPanel.totalWalkDiamond=e.value:2==e.type?this.manorTargetPanel.totalBloodDiamond=e.value:3==e.type&&(this.manorTargetPanel.resurgenceNum=e.value),this.manorTargetPanel.sendAutoCapture(null,null,!0),"reset"==e.action?Utils.MsgUtils.addMidMsg("重置成功"):"update"==e.action&&Utils.MsgUtils.addMidMsg("更新设定成功"));break;case CN.MANOR_UPDATE_RANKS:this.manorView&&this.manorView.updateRank()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="ManorMediator",n.SV={MAIN:1,MINI_MAP:2,RECORD:3,DETAIL:4,DETAIL_SIMPLE:5,BUY:6,TARGET:7,TARGET_BUY:8,COLLECT:9},n);function n(t){void 0===t&&(t=null);var e=a.call(this,n.N,t)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.ManorProxy.N),e}i.ManorMediator=t}(game=game||{}),function(v){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_mapName.text="地 图",this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.gp_tile=new eui.Group,this.gp_tile.horizontalCenter=this.gp_tile.verticalCenter=0,this.gp_tile.scaleX=this.gp_tile.scaleY=1.2,this.gp_adapter=new eui.Group,this.gp_adapter.addChild(this.gp_tile),this.gp_viewport.addChild(this.gp_adapter)},e.prototype.updateView=function(t){var a=this;t&&(this.mwArr=t.mwArr,this.tileX=t.tileX,this.tileY=t.tileY,this.choice=t.choice);var e=v.Config.manorLayer()[1];this.lb_mapName.text="矿 区",this.w=e.long,this.h=e.wide,RES.getResAsync(e.tiled,function(t){try{t.layers.forEach(function(t){"tiled"==t.name?a.tmxTiledArr=t.data:"hinder"==t.name&&(a.tmxHinderArr=t.data)}),a.tilesets={},t.tilesets.forEach(function(i){i.tiles.forEach(function(e){e.properties.forEach(function(t){a.tilesets[e.id+i.firstgid]||(a.tilesets[e.id+i.firstgid]={}),a.tilesets[e.id+i.firstgid][t.name]=t.value})})})}catch(t){return void egret.warn("地形解析失败",t)}a.initAll()},this)},e.prototype.getTileIndex=function(t,e){return t+e*this.w},e.prototype.tile2MNMPos=function(t,e){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,this.scl_map.height/2)),egret.Point.create(this.jiZhunMNMP.x+67*(t+(this.h-1)-e)/2,this.jiZhunMNMP.y+37*(t+e-(this.h-1))/2)},e.prototype.initAll=function(){var u=this;this.gp_tile.removeChildren();var t=void 0,e=void 0,i=void 0,a=void 0,n=new egret.Shape;n.graphics.lineStyle(3,0);for(var o=0;o<this.w;o++)for(var r=0;r<this.h;r++){var s=this.getTileIndex(o,r),c=this.tmxTiledArr[s];if(null==c){egret.warn("地图尺寸"+this.w+"x"+this.h+"超过地形尺寸，请检查配置");break}if(0!=c&&0!=this.mwArr[s]){var d=this.tmxHinderArr[s],h=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==d?2:1)),l=this.tile2MNMPos(o,r);h.x=l.x,h.y=l.y,(null==t||l.x<t)&&(t=l.x),(null==e||l.x>e)&&(e=l.x),(null==i||l.y<i)&&(i=l.y),(null==a||l.y>a)&&(a=l.y),this.tileIndex2MNM[s]=h,this.gp_tile.addChild(h),egret.Point.release(l)}}for(var p in n.graphics.endFill(),this.tileIndex2MNM){var g=this.tileIndex2MNM[p];g.x-=t,g.y-=i}n.x-=t,n.y-=i,this.gp_tile.addChild(n);var m=[];this.manorPy.manorList.forEach(function(t){m.push(new v.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "captured":false, "id":'+t.id+', "manorId":'+t.manorId+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:t.coordinateInfo.x,y:t.coordinateInfo.y},type:RiskEventType.Manor}))}),m.forEach(function(t){var e=u.getTileIndex(t.position.x,t.position.y);if(u.tileIndex2MNM[e]){var i=new eui.Image;i.scaleX=i.scaleY=1.4;var a=v.Config.manor()[t.info.id],n=MAP_EP_TYPE_IMG_MNM[t.type];t.type==RiskEventType.Manor&&(n=v.GeneralConfig.getGuajiImg(a.model)[1],i.scaleX=i.scaleY=.5),RES.getResAsync(n,function(t){i.source=t,i.anchorOffsetX=t.textureWidth/2,i.anchorOffsetY=t.textureHeight},u),i.x=u.tileIndex2MNM[e].x+32.5,i.y=u.tileIndex2MNM[e].y+17.5,t.type==RiskEventType.Manor&&(i.y=u.tileIndex2MNM[e].y+35),u.tileIndex2MNMEP[e]=i,u.gp_tile.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.ManorMediator.N,v.ManorMediator.SV.DETAIL_SIMPLE,{vo:t,choice:this.choice})},u);var o=new eui.Group;o.touchEnabled=!1,o.width=40,o.height=20;var r=new eui.Image;r.source="_guaji_m_json.mx_img_mingchengdi",r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.8,o.addChild(r);var s=new eui.Image;s.source="item_icon_renshu_png",s.horizontalCenter=-30,s.verticalCenter=0,s.scaleX=s.scaleY=.3,o.addChild(s);var c=new eui.Label;c.size=12,c.horizontalCenter=0,c.verticalCenter=0,o.addChild(c);var d=new eui.Image;d.source="common_img_biaotidi2_png",d.horizontalCenter=0,d.verticalCenter=-76,d.scaleX=.35,d.scaleY=.4,o.addChild(d);var h=new eui.BitmapLabel;h.font="common_title_fnt",h.horizontalCenter=0,h.verticalCenter=-75,h.scaleX=h.scaleY=.5,o.addChild(h),o.x=u.tileIndex2MNM[e].x+32.5,o.y=u.tileIndex2MNM[e].y+17.5,t.type==RiskEventType.Manor&&(o.x=u.tileIndex2MNM[e].x+32.5-o.width/2,o.y=u.tileIndex2MNM[e].y+35),u.gp_tile.addChild(o);var l=u.manorPy.queryManoeEntityByManorId(t.info.manorId);c.text=l.num+"/"+a.num,h.text=""+a.name;var p=new eui.Image;p.source="mxkc_img_chaoji_png",p.horizontalCenter=30,p.bottom=50,p.scaleX=p.scaleY=.4,o.addChild(p),p.visible=l.isSpecial}}),this.img_meRedPointInMNM=new eui.Image,this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(t){u.img_meRedPointInMNM.source=t,u.img_meRedPointInMNM.anchorOffsetX=t.textureWidth/2,u.img_meRedPointInMNM.anchorOffsetY=t.textureHeight},this),this.gp_tile.addChildAt(this.img_meRedPointInMNM,-1);var y=this.getTileIndex(this.tileX,this.tileY);this.tileIndex2MNM[y]&&(this.img_meRedPointInMNM.x=this.tileIndex2MNM[y].x+32.5,this.img_meRedPointInMNM.y=this.tileIndex2MNM[y].y+17.5),this.scl_map.alpha=0,egret.setTimeout(function(){u.resizeAdapter(),u.resetMNM(0),egret.Tween.get(u.scl_map).to({alpha:1},200)},this,100)},e.prototype.resizeAdapter=function(){this.gp_tile.height*this.gp_tile.scaleY<this.scl_map.height&&(this.gp_adapter.height=this.scl_map.height+1),this.gp_tile.width*this.gp_tile.scaleX<this.scl_map.width&&(this.gp_adapter.width=this.scl_map.width+1),this.gp_adapter.validateNow()},e.prototype.resetMNM=function(t){if(void 0===t&&(t=250),this.img_meRedPointInMNM){var e=this.img_meRedPointInMNM.localToGlobal(this.img_meRedPointInMNM.anchorOffsetX,this.img_meRedPointInMNM.anchorOffsetY),i=this.scl_map.viewport.globalToLocal(e.x,e.y);egret.Tween.get(this.scl_map.viewport).to({scrollH:i.x-this.scl_map.viewport.width/2,scrollV:i.y-this.scl_map.viewport.height/2},t)}},e);function e(t){var e=i.call(this)||this;return e.guajiPy=v.AppFacade.getInstance().retrieveProxy(v.GuajiPy.N),e.manorPy=v.AppFacade.getInstance().retrieveProxy(v.ManorProxy.N),e.tileIndex2MNM={},e.tileIndex2MNMEP={},e.skinName="ManorMiniMapSkin",e}v.ManorMiniMapPanel=t}(game=game||{}),function(a){var t=(e.registerAll=function(){(new n).register(),(new s).register(),(new h).register(),(new u).register(),(new y).register(),(new _).register()},e);function e(){}a.ManorProcessor=t;var i,n=(i=a.ProcessorBase,__extends(o,i),o.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.ManorProxy.N).updateAllPlayerManorEntityInfo(e.info)},o);function o(){return i.call(this,"manor.ManorInfoP",o)||this}var r,s=(r=a.ProcessorBase,__extends(c,r),c.prototype.execute=function(t){var e=t.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.ManorProxy.N);e.entityIndex&&e.entityIndex!=i.lastEntityIndex||i.updateAllPlayerEntityInfo(e.playerEntityList)},c);function c(){return r.call(this,"manor.PlayerEntityListP",c)||this}var d,h=(d=a.ProcessorBase,__extends(l,d),l.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.ManorProxy.N).updateAllManorEntityInfo(e.manorEntityList),this.sendNotification(CN.MANOR_REQUIRE_DETAIL)},l);function l(){return d.call(this,"manor.ManorEntityListP",l)||this}var p,u=(p=a.ProcessorBase,__extends(g,p),g.prototype.execute=function(t){var e=t.getBody();e.info.attackEntity.baseInfo.playerId==a.GameMVC.playerPy.playerInfoVO.playerId&&a.AppFacade.getInstance().retrieveMediator(a.CommonMediator.N).pushBattleRecord(e.info)},g);function g(){return p.call(this,"manor.BattleRecordEntityInfoP",g)||this}var m,y=(m=a.ProcessorBase,__extends(v,m),v.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.ManorProxy.N).updatePlayerProxyInfo(e.playerProxyInfo)},v);function v(){return m.call(this,"manor.PlayerProxyInfoP",v)||this}var f,_=(f=a.ProcessorBase,__extends(A,f),A.prototype.execute=function(t){var e=t.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.ManorProxy.N);e.playerEntityInfo&&e.playerEntityInfo.baseInfo&&i.updatePlayerInfo(e.playerEntityInfo)},A);function A(){return f.call(this,"manor.AutoCaptureInfoP",A)||this}}(game=game||{}),function(B){var e,t=(e=BaseProxy,__extends(i,e),i.prototype.checkEntranceNotice=function(){return this.isShowRedPoint&&Utils.UnlockMgr.checkPass(MODULE.Arena,!1).allow},i.prototype.reset=function(){this.playerList.splice(0),this.manorList.splice(0)},i.prototype.updatePlayerProxyInfo=function(t){if(t){var e=this.queryPlayerProxyInfoByEntityId(t.lastEntityIndex);if(e){for(var i=void 0,a=0,n=t.playerEntityList;a<n.length;a++){var o=n[a];o.entityIndex==t.lastEntityIndex&&(i=o)}i&&0!=i.manorId&&e.manorId!=i.manorId&&B.AppFacade.getInstance().sendNotification(CN.MANOR_CAPTURE_SUCCESS,{manorId:i.manorId})}this.lastEntityIndex=t.lastEntityIndex,this.playerProxyInfo.update(t);var r=this.queryPlayerProxyInfoByEntityId(t.lastEntityIndex);this.selfEntity?this.selfEntity.update(r):this.selfEntity=new B.PlayerEntityInfo(r),this.checkRedPointState(t),this.checkCollectReward(t,null)}this.sendNotification(CN.MANOR_PLAYER_PROXY_INFO_UPDATE)},i.prototype.updateAllPlayerManorEntityInfo=function(t,e){t.manorEntityList&&this.updateAllManorEntityInfo(t.manorEntityList,e),t.playerEntityList&&this.updateAllPlayerEntityInfo(t.playerEntityList,e)},i.prototype.updateAllManorEntityInfo=function(t,e){if(t){for(var i=this.manorList.length-1;0<=i;i--){var a=!1;for(var n in t)if(t[n].manorId==this.manorList[i].manorId){a=!0;break}a||(this.manorList[i].remove=!0)}for(var n in t){for(a=!1,i=0;i<this.manorList.length;i++)if(t[n].manorId==this.manorList[i].manorId){this.manorList[i].update(t[n]),a=!0;break}a||this.manorList.push(new B.ManorEntityInfo(t[n]))}}this.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:e})},i.prototype.updateAllPlayerEntityInfo=function(t,e){for(var i in t)if(t[i].baseInfo){for(var a=!1,n=0;n<this.playerList.length;n++)if(t[i].baseInfo.playerId==this.playerList[n].baseInfo.playerId&&t[i].entityIndex==this.playerList[n].entityIndex){this.playerList[n].update(t[i]),a=!0;break}a||this.playerList.push(new B.PlayerEntityInfo(t[i])),this.selfEntity&&B.GameMVC.loginPy.isSelf(t[i].baseInfo.playerId)&&t[i].entityIndex==this.lastEntityIndex&&(this.selfEntity.rewards=t[i].rewards)}else console.log(" 服务器下推 PlayerEntityInfo 数据中 baseInfo 错误!");this.checkCollectReward(null,t),this.sendNotification(CN.MANOR_ALL_PLAYER_UPDATE,{isInit:e}),this.sendNotification(CN.MANOR_BLOODNUM_UPDATE)},i.prototype.checkCollectReward=function(t,e){var i=Array(),a=Array(),n=Array();if(t&&t.playerEntityList)for(var o in t.playerEntityList)t.playerEntityList[o].coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i.push(t.playerEntityList[o]):t.playerEntityList[o].coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?a.push(t.playerEntityList[o]):t.playerEntityList[o].coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&n.push(t.playerEntityList[o]);if(e)for(var o in e)e[o].baseInfo&&B.GameMVC.loginPy.isSelf(e[o].baseInfo.playerId)&&e[o].coordinateStatus&&(e[o].coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i.push(e[o]):e[o].coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?a.push(e[o]):e[o].coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&n.push(e[o]));if(0<i.length||0<a.length||0<n.length){var r=Array(),s=new Array,c=Array();for(var o in i)if(0<this.calcRewrdNum(i[o].rewards)){r[i[o].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"体力归0",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+i[o].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var d=0,h=i[o].rewards;d<h.length;d++){var l=h[d],p=!1;for(var u in c)if(l.type==c[u].type&&l.code==c[u].code){c[u].num+=l.num,p=!0;break}p||c.push(l)}}for(var o in a)if(0<this.calcRewrdNum(a[o].rewards)){r[a[o].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"矿被采空",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+a[o].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var g=0,m=a[o].rewards;g<m.length;g++){for(var u in l=m[g],p=!1,c)if(l.type==c[u].type&&l.code==c[u].code){c[u].num+=l.num,p=!0;break}p||c.push(l)}}for(var o in n)if(0<this.calcRewrdNum(n[o].rewards)){r[n[o].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"队伍状态改变",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+n[o].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var y=0,v=n[o].rewards;y<v.length;y++){for(var u in l=v[y],p=!1,c)if(l.type==c[u].type&&l.code==c[u].code){c[u].num+=l.num,p=!0;break}p||c.push(l)}}0<s.length&&this.sendNotification(CN.MANOR_COLLECT_REWARD_SHOW,{textFlow:s,rewards:c,entityList:r})}},i.prototype.calcRewrdNum=function(t){var i=t;Array.isArray(i)&&(i={rewards:i});var a=0;return G_REWARD_NAME.forEach(function(t){var e=i[t]||[];a+=e.length}),a},i.prototype.checkRedPointState=function(t){var e=this.isShowRedPoint;this.isShowRedPoint=!1;for(var i=0,a=t.playerEntityList;i<a.length;i++){var n=a[i];if(0==n.manorId){this.isShowRedPoint=!0;break}if(Utils.TimerManager.getServerTime()-n.captureDt>Number(B.Config.constConfig().ManorRedPointHintCycle.constValue)){this.isShowRedPoint=!0;break}}e!=this.isShowRedPoint&&NoticeManager.updateNotice(NT.MANOR_ENTRANCE)},i.prototype.updatePlayerInfo=function(t){var e=t.baseInfo.playerId,i=!1;for(var a in this.playerList)if(this.playerList[a].baseInfo.playerId==e&&this.playerList[a].entityIndex==t.entityIndex){this.playerList[a].update(t),i=!0;break}i||this.playerList.push(new B.PlayerEntityInfo(t)),this.selfEntity&&B.GameMVC.loginPy.isSelf(t.baseInfo.playerId)&&t.entityIndex==this.lastEntityIndex&&(this.selfEntity.rewards=t.rewards),this.sendNotification(CN.MANOR_BLOODNUM_UPDATE)},i.prototype.updateManorInfo=function(t){var e=t.manorId,i=!1;for(var a in this.manorList)if(this.manorList[a].manorId==e){this.manorList[a].update(t),i=!0;break}i||this.manorList.push(new B.ManorEntityInfo(t))},i.prototype.updateBattleRecordInfo=function(t){var e=this;t.battleRecordEntityList&&(this.recordList.splice(0),Array.isArray(t.battleRecordEntityList)&&t.battleRecordEntityList.forEach(function(t){e.recordList.push(new B.BattleRecordEntityInfo(t))})),this.sendNotification(CN.MANOR_RECORD_UPDATE)},i.prototype.queryManoeEntityByManorId=function(t){var e=void 0;for(var i in this.manorList)if(this.manorList[i].manorId==t){e=this.manorList[i];break}return e},i.prototype.queryPlayerEntityByPlayerId=function(t,e){void 0===e&&(e=this.lastEntityIndex);var i=void 0;for(var a in this.playerList)if(this.playerList[a].baseInfo.playerId==t&&this.playerList[a].entityIndex==e){i=this.playerList[a];break}return i},i.prototype.queryPlayerProxyInfoByEntityId=function(t){void 0===t&&(t=this.lastEntityIndex);for(var e=0,i=this.playerProxyInfo.playerEntityList;e<i.length;e++){var a=i[e];if(a.entityIndex==t)return a}return null},i.prototype.inSafeArea=function(t,e){var i=!1,a=JSON.parse(B.Config.constConfig().ManorBirthPlace.constValue);for(var n in a){var o=a[n];if(t>=o[0]&&t<o[0]+o[2]&&e>=o[1]&&e<o[1]+o[2]){i=!0;break}}return i},i.prototype.isMoveInSafeArea=function(t,e,i,a){var n=this.inSafeArea(t,e),o=this.inSafeArea(i,a);return!(!n||!o)},i.prototype.caleSafeAreaWalk=function(t){var e=0;for(var i in t)this.inSafeArea(t[i].y,t[i].x)&&(e+=1);return e},i.prototype.getTeamsByEntityIndex=function(t,e){for(var i in t)if(t[i].teamNo==e)return t[i];return null},i.prototype.checkFormation=function(t,e){void 0===e&&(e=!1);var i=B.GameMVC.backpackPy.getModuleTeam(MODULE.Manor),a=new Array,n=new Array,o=this.playerProxyInfo.playerEntityList;for(var r in o){var s=o[r],c=s.entityIndex,d=s.coordinateInfo,h=!1;if(e||this.inSafeArea(d.x,d.y))n.push(c);else{var l=void 0;for(var p in i.teams)if((m=i.teams[p]).teamNo==c){Number(p),l=m;break}var u=void 0,g=void 0;for(var p in t){var m;if((m=t[p]).teamNo==c){u=Number(p),g=m;break}}if(l||((l={heros:[],magicalUuid:"",petUuid:""}).teamNo=g.teamNo),l.magicalUuid!=g.magicalUuid)h=!0;else if(l.petUuid!=g.petUuid)h=!0;else if(l.heros.length!=g.heros.length)h=!0;else for(var y=0,v=l.heros;y<v.length;y++){for(var f=v[y],_=!1,A=0,T=g.heros;A<T.length;A++){var b=T[A];if(f.uuid==b.uuid){_=!0;break}}if(!_){h=!0;break}}h&&(t[u]=l,a.push(c))}}var C=new Array;if(0<a.length)for(var E=0,I=a;E<I.length;E++){var S=I[E];if(k=this.getTeamsByEntityIndex(i.teams,S))for(var w=0,M=k.heros;w<M.length;w++)b=M[w],C.push(b.uuid)}for(var R=0,U=n;R<U.length;R++){var k;if(S=U[R],k=this.getTeamsByEntityIndex(t,S))t:for(var N=0,P=k.heros;N<P.length;N++){f=P[N];for(var x=0,L=C;x<L.length;x++)if(b=L[x],f.uuid==b){for(var r in t)if(t[r].teamNo==S){t[r]=this.getTeamsByEntityIndex(i.teams,S);break}break t}}}if(0<a.length){var D="";for(var r in a)D=Number(r)!=a.length-1?D+"队伍"+a[r]+"、":D+"队伍"+a[r];D+="不在安全区,未保存成功!",Utils.MsgUtils.addMidMsg(D)}else 0<n.length&&Utils.MsgUtils.addMidMsg("保存成功!");return t},i.prototype.updateRank=function(t){this.ranks=t,this.sendNotification(CN.MANOR_UPDATE_RANKS)},i.prototype.calManorTotalGoods=function(t){var e=0,i=B.Config.manor()[t.id];if(i){var a=JSON.parse(i.goods)[0],n=t.num;0==n&&(n=1),e=a[2]*(i.maxCollectTime/n/i.collectCycle)}return e},i.prototype.calCollectGoods=function(t,e){var i=0;if(!e){var a=this.queryManoeEntityByManorId(t.manorId);a&&(e=a.id)}if(e){var n=B.Config.manor()[e];if(n){var o=Utils.TimerManager.getServerTime();i=Math.floor((o-t.captureDt)/n.collectCycle)}}return i},i.prototype.calCollectTotalGoods=function(t){var e=0,i=B.Config.manor()[t.id];if(i){var a=Utils.TimerManager.getServerTime();for(var n in t.playerManorList)e+=Math.floor((a-t.playerManorList[n].captureDt)/i.collectCycle)}return e},i.prototype.calSurplusGoods=function(t){var e=0,i=B.Config.manor()[t.id];return i&&(e=i.maxCollectTime-t.collectedTime-this.calCollectTotalGoods(t)),e},i.prototype.calCollectTotalTime=function(t){var e=0;if(B.Config.manor()[t.id]){var i=Utils.TimerManager.getServerTime();for(var a in t.playerManorList)e+=Math.floor(i-t.playerManorList[a].captureDt)}return e},i.prototype.calSurplusTime=function(t){var e=0,i=B.Config.manor()[t.id];return i&&(e=i.maxCollectTime-t.collectedTime-this.calCollectTotalTime(t)),e},i.prototype.GetManorInfo=function(e){var i=this;void 0===e&&(e=!1),Utils.UnlockMgr.checkPass(MODULE.Manor,!1).allow?Utils.Socket.send("manor","GetManorInfo",{},!0).then(function(t){i.EnterIntoModule(),i.updatePlayerProxyInfo(t.playerProxyInfo),i.updateAllManorEntityInfo(t.manorEntityList,!0)}).catch(function(t){t&&t.err&&(e||(10623==t.err?Utils.MsgUtils.addMidMsg("该功能紧急维护，暂时未开启"):10046==t.err?Utils.MsgUtils.addMidMsg("活动暂未开启"):Utils.MsgUtils.addMidMsg(t.err)),i.sendNotification(CN.MANOR_FORCE_EXIT))}):console.log("活动未开启, 中断请求 GetManorInfo")},i.prototype.GetPlayerManorInfo=function(e,t,i){var a=this;void 0===e&&(e=!1),void 0===t&&(t=this.lastEntityIndex),void 0===i&&(i=!1),Utils.UnlockMgr.checkPass(MODULE.Manor,!1).allow?Utils.Socket.send("manor","GetPlayerManorInfo",{isSelf:e,entityIndex:t},!0).then(function(t){e?a.updatePlayerProxyInfo(t.playerProxyInfo):a.updateAllPlayerEntityInfo(t.playerEntityList,i)}).catch(function(t){t&&t.err&&(10046==t.err||Utils.MsgUtils.addErrMsg(t.err))}):console.log("活动未开启, 中断请求 GetPlayerManorInfo")},i.prototype.Walk=function(t,e,i,a,n){var o=this;void 0===a&&(a=0),void 0===n&&(n=this.lastEntityIndex),Utils.Socket.send("manor","Walk",{originalInfo:t,info:e,walkNum:i,safeAreaWalkNum:a,entityIndex:n}).then(function(t){o.updateAllPlayerEntityInfo(t.playerEntityList),o.updatePlayerProxyInfo(t.playerProxyInfo)}).catch(function(t){})},i.prototype.Capture=function(e,t,i,a){var n=this;Utils.Socket.send("manor","Capture",{manorId:e,tPlayerId:t,entityIndex:i,tEntityIndex:a}).then(function(t){n.GetManorDetailInfo(e),n.GetPlayerManorInfo(!0,n.lastEntityIndex),n.GetPlayerManorInfo(!1)}).catch(function(t){})},i.prototype.LeaveManor=function(e){var i=this;Utils.Socket.send("manor","LeaveManor",{entityIndex:e}).then(function(t){i.updateAllPlayerEntityInfo(t.playerEntityList),i.GetPlayerManorInfo(!0,i.lastEntityIndex),i.AccountRewards(e)}).catch(function(t){})},i.prototype.GetBattleRecordInfo=function(){var e=this;Utils.Socket.send("manor","GetBattleRecordInfo",{}).then(function(t){e.updateBattleRecordInfo(t)}).catch(function(t){})},i.prototype.PurchaseBlood=function(t,e){var i=this;void 0===e&&(e=this.lastEntityIndex),Utils.Socket.send("manor","PurchaseBlood",{num:t,entityIndex:e}).then(function(t){i.updatePlayerInfo(t.playerEntityInfo),i.GetPlayerManorInfo()}).catch(function(t){})},i.prototype.AccountRewards=function(t){var e=this;void 0===t&&(t=this.lastEntityIndex),Utils.Socket.send("manor","AccountRewards",{entityIndex:t}).then(function(t){e.sendNotification(CN.MANOR_GET_AWARD,{clientReward:t.clientReward}),e.updatePlayerInfo(t.playerEntityInfo),e.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:!1})}).catch(function(t){})},i.prototype.GetManorDetailInfo=function(t){var e=this;Utils.Socket.send("manor","GetManorDetailInfo",{manorId:t}).then(function(t){e.updateManorInfo(t.info),e.sendNotification(CN.MANOR_DETAIL_UPDATE),e.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:!1})}).catch(function(t){})},i.prototype.EnterIntoModule=function(){Utils.Socket.send("manor","EnterIntoModule",{}).then(function(t){}).catch(function(t){})},i.prototype.LeaveModule=function(){Utils.Socket.send("manor","LeaveModule",{}).then(function(t){}).catch(function(t){})},i.prototype.AutoCapture=function(t,e,i){var a=this;void 0===i&&(i=""),Utils.Socket.send("manor","AutoCapture",{entityIndex:t,autoCaptureInfo:e}).then(function(t){a.updatePlayerProxyInfo(t.playerProxyInfo),a.sendNotification(CN.MANOR_GET_AWARD,{clientReward:t.clientReward}),a.sendNotification(CN.MANOR_AUTO_CAPTURE_UPDATE,{reason:i})}).catch(function(t){})},i.prototype.GetManorRank=function(){var e=this;Utils.Socket.send("ranking","GetCommonRank",{rankType:RankingType.RankingTypeManorPlayer,rankSubType:RankingSubType.Three}).then(function(t){e.updateRank(t)}).catch(function(t){})},i.prototype.startTimer=function(t,e){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=t||1e3,this.timer.repeatCount=e||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start(),this.timerFunc()},i.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},i.prototype.timerFunc=function(){this.GetPlayerManorInfo(!0,0)},i.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},i.N="ManorProxy",i);function i(){var t=e.call(this,i.N)||this;return t.lastEntityIndex=1,t.playerProxyInfo=new B.PlayerProxyInfo,t.selfEntity=new B.PlayerEntityInfo,t.playerList=new Array,t.manorList=new Array,t.recordList=new Array,t.isShowRedPoint=!1,NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.MANOR_ENTRANCE),NoticeManager.registerCB(NT.MANOR_ENTRANCE,t.checkEntranceNotice,t,MODULE.Manor),t}B.ManorProxy=t}(game=game||{}),function(h){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.initScroll(),this.addEvent(),this.onClickPage(this.curIdx)},i.prototype.initScroll=function(){this.list_item.itemRenderer=n,UIActionManager.hideScrollerBar(this.scl_list)},i.prototype.updateView=function(t){this.onClickPage(this.curIdx)},i.prototype.updateRecordList=function(e){this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0;var t=this.manorPy.recordList,i=[];t.forEach(function(t){(h.GameMVC.loginPy.isSelf(t.attackEntity.baseInfo.playerId)&&t.attackEntity.entityIndex==e||h.GameMVC.loginPy.isSelf(t.defenceEntity.baseInfo.playerId)&&t.defenceEntity.entityIndex==e)&&i.push(t)}),i.sort(function(t,e){return t.dt==e.dt?t.attackEntity.blood-e.attackEntity.blood:e.dt-t.dt}),this.list_item.dataProvider=new eui.ArrayCollection(i)},i.prototype.onClickPage=function(t){this.curIdx=t,this.img_bg_normal1.visible=1!=t,this.img_zi_normal1.visible=1!=t,this.img_bg_select1.visible=1==t,this.img_zi_select1.visible=1==t,this.img_bg_normal2.visible=2!=t,this.img_zi_normal2.visible=2!=t,this.img_bg_select2.visible=2==t,this.img_zi_select2.visible=2==t,this.img_bg_normal3.visible=3!=t,this.img_zi_normal3.visible=3!=t,this.img_bg_select3.visible=3==t,this.img_zi_select3.visible=3==t,this.updateRecordList(t)},i.prototype.addEvent=function(){var e=this;this.gp_btn1.touchEnabled=!0,this.gp_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.onClickPage(1)},this),this.gp_btn2.touchEnabled=!0,this.gp_btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.onClickPage(2)},this),this.gp_btn3.touchEnabled=!0,this.gp_btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.onClickPage(3)},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this)},i);function i(){var t=e.call(this)||this;return t.skinName="ManorRecordPanel",t.manorPy=h.AppFacade.getInstance().retrieveProxy(h.ManorProxy.N),t.curIdx=1,t}h.ManorRecordPanel=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.fightPy.BattlePlayBack(t.data.uuid)},this),this.playerHead_l.addTapEvent(function(){t.leftData&&t.leftData.baseInfo&&t.leftData.baseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:t.leftData.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:t.leftData.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)}),this.playerHead_r.addTapEvent(function(){t.rightData&&t.rightData.baseInfo&&t.rightData.baseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:t.rightData.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:t.rightData.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},o.prototype.dataChanged=function(){var t=this.data.attackEntity,e=this.data.defenceEntity,i=this.data.dt,a=(this.data.uuid,this.data.win),n=!0;if(this.leftData=t,this.rightData=e,h.GameMVC.loginPy.isSelf(e.baseInfo.playerId)&&(this.leftData=e,this.rightData=t,n=!1),this.leftData){this.leftData.baseInfo.playerId,this.leftData.baseInfo.avatar;var o=this.leftData.baseInfo.fightCap,r=this.leftData.baseInfo.name,s=this.leftData.blood,c=this.leftData.decreaseBlood;this.lb_name_l.text=r,this.item_fightCap_l.update(o),this.lb_lost_blood_l.text="损失"+c+"点体力",this.playerHead_l.updateData({vo:this.leftData.baseInfo,ignoreLevel:1,effect:!1}),this.pb_blood_l.maximum=100,this.pb_blood_l.value=s}if(this.rightData){this.rightData.baseInfo.avatar,o=this.rightData.baseInfo.fightCap;var d=this.rightData.baseInfo.name;s=this.rightData.blood,c=this.rightData.decreaseBlood,this.lb_name_r.text=d,this.item_fightCap_r.update(o),this.lb_lost_blood_r.text="损失"+c+"点体力",this.playerHead_r.updateData({vo:this.rightData.baseInfo,ignoreLevel:1,effect:!1}),this.pb_blood_r.maximum=100,this.pb_blood_r.value=s}n?(this.lb_result.textColor=15214370,a==EBattleResult.EBattleResultWin?this.lb_result.text="进攻胜利":this.lb_result.text="进攻失败"):(this.lb_result.textColor=4818228,a==EBattleResult.EBattleResultLose?this.lb_result.text="防守胜利":this.lb_result.text="防守失败"),this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-i)},o);function o(){var t=a.call(this)||this;return t.skinName="ManorRecordPanel_Item",t.fightPy=h.AppFacade.getInstance().retrieveProxy(h.FightPy.N),t}}(game=game||{}),function(n){var e,t=(e=BasePanel,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.maxPurchase=0,this.defaultPurchase=0,this.purchase=0,this.manorMaxResurgencePurchase=JSON.parse(n.Config.constConfig().ManorResurgenceRound.constValue)[1],this.manorDefaultResurgencePurchase=JSON.parse(n.Config.constConfig().ManorResurgenceRound.constValue)[0],this.manorResurgencePurchase=JSON.parse(n.Config.constConfig().ManorResurgenceCosts.constValue)[0][2],this.initComponent(),this.addEvent()},i.prototype.perShow=function(t){return!0},i.prototype.updateView=function(t){if(this.buyType=t.type,this.totalNum=t.totalNum||0,this.gp_cost_tips.removeChildren(),1==this.buyType);else if(2==this.buyType);else if(3==this.buyType){this.maxPurchase=this.manorMaxResurgencePurchase,this.defaultPurchase=this.manorDefaultResurgencePurchase,this.purchase=this.manorResurgencePurchase;var e=new eui.Label;e.size=23,e.textColor=7491637,e.text="购买复活次数上限:",this.gp_cost_tips.addChild(e)}this.setValueTo(this.totalNum,!1)},i.prototype.addEvent=function(){var t=this;this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.setValueTo(t.defaultPurchase),n.AppFacade.getInstance().sendNotification(CN.MANOR_COLLECT_SETTING_UPDATE,{type:t.buyType,value:t.defaultPurchase,action:"reset"})},this),this.btn_update.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().sendNotification(CN.MANOR_COLLECT_SETTING_UPDATE,{type:t.buyType,value:Number(t.lb_num.text),action:"update"}),t.hide()},this)},i.prototype.initComponent=function(){var t=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(t.lb_num.text)>t.maxPurchase&&(t.lb_num.text=t.maxPurchase.toString()),t.updateCost()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=t.lb_num.text&&Number(t.lb_num.text)||t.setValueTo(0)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){t.setValueTo(Number(t.lb_num.text)-100)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){t.setValueTo(Number(t.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){t.setValueTo(Number(t.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){t.setValueTo(Number(t.lb_num.text)+100)})},i.prototype.setValueTo=function(t,e){void 0===e&&(e=!0),t>this.maxPurchase&&(t=this.maxPurchase,e&&Utils.MsgUtils.addMidMsg("已达到最大上限!")),t<0&&(t=0),this.lb_num.text=t.toString(),this.updateCost()},i.prototype.updateCost=function(){Math.floor(Number(this.lb_num.text)/this.purchase),this.gp_buy_tips.removeChildren();var t=new eui.Label;if(t.size=23,t.textColor=7491637,t.text="对应",this.gp_buy_tips.addChild(t),1==this.buyType);else if(2==this.buyType);else if(3==this.buyType){this.maxPurchase=this.manorMaxResurgencePurchase,this.defaultPurchase=this.manorDefaultResurgencePurchase,this.purchase=this.manorResurgencePurchase;var e=Number(this.lb_num.text)*this.purchase;t.text="花费";var i=new eui.Image("item_icon_zuanshi_png");i.width=i.height=n.GeneralConfig.fixedSizeWH-10,this.gp_buy_tips.addChild(i);var a=new eui.Label;a.size=23,a.textColor=7491637,a.text="x"+e,this.gp_buy_tips.addChild(a)}},i);function i(){var t=e.call(this)||this;return t.skinName="ManorTargetBuyPanel",t}n.ManorTargetBuyPanel=t}(game=game||{}),function(s){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.addEvent(),this.updatePlayerInfo(),this.onClickPage(1)},e.prototype.updateView=function(t){},e.prototype.updateAutoCaptureInfoList=function(){for(var t=1;t<=3;t++)this.playerEntityInfoList[t].update(this.manorPy.queryPlayerProxyInfoByEntityId(t)),this.autoCaptureInfoList[t].update(this.playerEntityInfoList[t].autoCaptureInfo)},e.prototype.updateCurAutoCaptureInfo=function(t,e,i,a){this.autoCaptureInfoList[this.curIdx]&&(this.autoCaptureInfoList[this.curIdx].isAutoCapture=this.cb_0.selected,this.autoCaptureInfoList[this.curIdx].isAutoChallenge=this.cb_1.selected,this.autoCaptureInfoList[this.curIdx].isChallengePowerHouse=this.cb_2.selected,this.autoCaptureInfoList[this.curIdx].isAutoPurchaseWalk=!1,this.autoCaptureInfoList[this.curIdx].isAutoPurchaseBlood=!1,this.autoCaptureInfoList[this.curIdx].isAutoResurgence=this.cb_5.selected,null!=e&&null!=e&&(this.autoCaptureInfoList[this.curIdx].totalWalkDiamond=e),null!=i&&null!=i&&(this.autoCaptureInfoList[this.curIdx].totalBloodDiamond=i),null!=a&&null!=a&&(this.autoCaptureInfoList[this.curIdx].resurgenceNum=a),null!=t&&null!=t&&(this.autoCaptureInfoList[this.curIdx].isOpen=t))},e.prototype.onClickPage=function(t){this.curIdx!=t&&(this.curIdx=t,this.img_bg_normal1.visible=1!=t,this.img_zi_normal1.visible=1!=t,this.img_bg_select1.visible=1==t,this.img_zi_select1.visible=1==t,this.img_bg_normal2.visible=2!=t,this.img_zi_normal2.visible=2!=t,this.img_bg_select2.visible=2==t,this.img_zi_select2.visible=2==t,this.img_bg_normal3.visible=3!=t,this.img_zi_normal3.visible=3!=t,this.img_bg_select3.visible=3==t,this.img_zi_select3.visible=3==t,this.updateUI(t))},e.prototype.updateUI=function(t){this.playerEntityInfo.update(this.playerEntityInfoList[t]),this.autoCaptureInfo.update(this.autoCaptureInfoList[t]),this.autoCaptureInfo.manorId;var e=this.autoCaptureInfo.isAutoCapture||!1,i=this.autoCaptureInfo.isAutoChallenge||!1,a=this.autoCaptureInfo.isChallengePowerHouse||!1,n=this.autoCaptureInfo.isAutoResurgence||!1;this.totalWalkDiamond=0,this.totalBloodDiamond=0,this.resurgenceNum=this.autoCaptureInfo.resurgenceNum||0,this.isOpen=this.autoCaptureInfo.isOpen||!1,this.cb_0.selected=e,this.cb_1.selected=i,this.cb_2.selected=a,this.cb_3.selected=!1,this.cb_4.selected=!1,this.cb_5.selected=n,this.btn_close.visible=this.isOpen,this.btn_start.visible=!this.isOpen,this.updateFightCap()},e.prototype.addEvent=function(){var e=this;this.btn_diamond_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.MainJumpConfig.jumpTo(MODULE.Recharge)},this),this.gp_btn1.touchEnabled=!0,this.gp_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClickPage(1)},this),this.gp_btn2.touchEnabled=!0,this.gp_btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClickPage(2)},this),this.gp_btn3.touchEnabled=!0,this.gp_btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClickPage(3)},this),this.btn_revive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.ManorMediator.N,s.ManorMediator.SV.TARGET_BUY,{type:3,totalNum:this.autoCaptureInfo.resurgenceNum})},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cb_0.selected=!1,e.cb_1.selected=!1,e.cb_2.selected=!1,e.cb_3.selected=!1,e.cb_4.selected=!1,e.cb_5.selected=!1,e.totalWalkDiamond=0,e.totalBloodDiamond=0,e.resurgenceNum=JSON.parse(s.Config.constConfig().ManorResurgenceRound.constValue)[0];for(var t=1;t<=3;t++)e.sendAutoCapture(!1,t);Utils.MsgUtils.addMidMsg("重置成功")},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateSwitch(!1)},this),this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateSwitch(!0),Utils.MsgUtils.addMidMsg("开启成功")},this),this.bindTipsPanelClick({target:this.img_power_wenhao,targetBg:this.gp_tips_bg,cb:function(){e.gp_tips.visible=!e.gp_tips.visible,e.gp_tips_bg.visible=e.gp_tips.visible,e.lb_wenhao_desc.textFlow=[{text:"1、自动返回当前矿点：玩家队伍被击败送回安全区后，在行动力充足的情况下会自动返回上次占领的矿点，若矿点人数已满会自动挑战战斗力最低的队伍，默认只挑战战力比自己低的队伍。若矿点被采集空消失，辅助不会帮助玩家自动返回重新刷新的矿点。当体力值低于50时不会使用自动返回功能。\n",style:{size:20,textColor:16777215}},{text:"2、自动挑战其他公会玩家：勾选后玩家会自动挑战进入本矿点的其他公会的玩家，默认只挑战战力比自己低的队伍。\n",style:{size:20,textColor:16777215}},{text:"3、挑战大于自身战力的玩家：勾选后会挑战战斗力比自己高的玩家。\n",style:{size:20,textColor:16777215}},{text:"4、自动购买复活次数，勾选后玩家会自动购买复活次数，可在设置处设置购买复活次数所需要花费的最大钻石上限，当钻石不足时，停止自动购买功能，直到钻石足够才会继续生效。",style:{size:20,textColor:16777215}}]}}),this.cb_0.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_1.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_2.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_5.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this)},e.prototype.updateSwitch=function(t){for(var e=1;e<=3;e++)if(e==this.curIdx)this.sendAutoCapture(t);else if(this.autoCaptureInfoList[e]&&this.playerEntityInfoList[e]){var i=new s.AutoCaptureInfo;i.manorId=this.playerEntityInfoList[e].manorId,i.update(this.autoCaptureInfoList[e]),i.isOpen=t,this.manorPy.AutoCapture(e,i)}},e.prototype.checkBoxChangeHandler=function(t){this.isOpen&&this.sendAutoCapture(),this.updateCurAutoCaptureInfo()},e.prototype.sendAutoCapture=function(t,e,i){var a,n=e||this.curIdx,o=this.manorPy.queryPlayerProxyInfoByEntityId(n);if(i)return(a=o.autoCaptureInfo).manorId=o.manorId,a.totalWalkDiamond=0,a.totalBloodDiamond=0,a.resurgenceNum=this.resurgenceNum,this.updateCurAutoCaptureInfo(null,this.totalWalkDiamond,this.totalBloodDiamond,this.resurgenceNum),void this.manorPy.AutoCapture(n,a,"auto");(a=new s.AutoCaptureInfo).manorId=o.manorId,a.isAutoCapture=this.cb_0.selected,a.isAutoChallenge=this.cb_1.selected,a.isChallengePowerHouse=this.cb_2.selected,a.isAutoPurchaseWalk=!1,a.isAutoPurchaseBlood=!1,a.isAutoResurgence=this.cb_5.selected,a.totalWalkDiamond=0,a.totalBloodDiamond=0,a.resurgenceNum=this.resurgenceNum,a.isOpen=null!=t&&null!=t?t:this.isOpen,this.updateCurAutoCaptureInfo(a.isOpen);var r=a.isOpen?"open":"close";this.manorPy.AutoCapture(n,a,r)},e.prototype.updateAutoCapture=function(t){void 0===t&&(t=""),"auto"!=t&&this.updateAutoCaptureInfoList(),this.updateUI(this.curIdx)},e.prototype.bindTipsPanelClick=function(t){var e=t.target,i=t.targetBg;e.addEventListener(egret.TouchEvent.TOUCH_TAP,t.cb,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,t.cb,this)},e.prototype.updateFightCap=function(){this.item_fightCap.update(this.playerEntityInfo.teamInfo.fightCap||0)},e.prototype.updatePlayerInfo=function(){var t=s.GameMVC.backpackPy.getInfoByCode(EPropertyType.EPropertyTypeDiamond);this.blb_diamond.text=Utils.MathUtils.formatNumStyle1(t.haveNum)},e);function e(){var t=i.call(this)||this;t.skinName="ManorTargetPanel",t.manorPy=s.AppFacade.getInstance().retrieveProxy(s.ManorProxy.N),t.bpProxy=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),t.playerEntityInfo=new s.PlayerEntityInfo,t.autoCaptureInfo=new s.AutoCaptureInfo,t.playerEntityInfoList=new Array,t.autoCaptureInfoList=new Array;for(var e=1;e<=3;e++)t.playerEntityInfoList[e]=new s.PlayerEntityInfo,t.autoCaptureInfoList[e]=new s.AutoCaptureInfo;return t.updateAutoCaptureInfoList(),t.totalWalkDiamond=0,t.totalBloodDiamond=0,t.resurgenceNum=0,t.isOpen=!1,t}s.ManorTargetPanel=t}(game=game||{});var MANOR_UPDATE_RANK=10;!function(v){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.manorPy.LeaveModule()},i.prototype.childrenCreated=function(){var h=this;e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_left_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_right_top),this.initUI(),this.addEvent(),this.map=Utils.MapUtils.generateCommon({source:MODULE.Manor,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:void 0,onRequestToMove:function(t,e,i,a){if(i)return!1;var n=h.map.getAStarPath(h.map.me.tileX,h.map.me.tileY,t,e),o=!0;if(n.length<=0)return!1;if(h.map.me.tileX==t&&h.map.me.tileY==e)return!1;if(h.map.me.tileX==n[n.length-1].y&&h.map.me.tileY==n[n.length-1].x)return!1;var r=h.manorPy.queryPlayerProxyInfoByEntityId();if(r){var s=r.teamInfo;if(s&&s.heroBaseInfoList&&0==s.heroBaseInfoList.length)return Utils.MsgUtils.addMidMsg("当前队伍没有英雄上阵,不可移动"),!0}if(!h.map.me.visible)return console.log("玩家不可见,不能移动"),Utils.MsgUtils.addMidMsg("你已经占领了矿点,不可移动!"),!0;(h.map.me.isMoving||0<h.map.me.walkPaths.length)&&(console.log("当前移动未结束,不能移动"),o=!1);var c=v.GameMVC.manorPy.inSafeArea(h.map.me.tileX,h.map.me.tileY),d=v.GameMVC.manorPy.inSafeArea(n[n.length-1].y,n[n.length-1].x);if(0<h.recoverCD)return Utils.MsgUtils.addMidMsg("等待复活或者直接购买复活!"),!0;if(h.bloodNum<=0&&(!c||!d))return Utils.MsgUtils.addMidMsg("等待复活或者直接购买复活!"),!0;if(h.targetEP=void 0,a&&a.vo.type!=RiskEventType.Start&&(h.targetEP=a),(h.isInSafe=c)&&!d){if(h.bloodNum<h.ManorEnterIntoManorArenaMinBlood)return Utils.MsgUtils.addMidMsg("体力不足"+h.ManorEnterIntoManorArenaMinBlood+"不能进入矿区"),!0;if(h.bloodNum<h.ManorEnterIntoManorArenaHintBlood)return v.GameMgr.getInstance().showCommonTipsWin({commonTips:"当前体力较少,是否离开安全区?",source:"manor_blood_not_enough",cb:!0,clickCB:function(t){1==t.type&&h.requestWalk(n)}}),!0}return o&&h.requestWalk(n),!0},onTouchTap:function(t,e){}}),this.gp_map.addChildAt(this.map,0),this.manorPy.GetPlayerManorInfo(!0,0),egret.setTimeout(function(){h.loadMapResConf(),egret.setTimeout(function(){h.once(egret.Event.ENTER_FRAME,function(){h.manorPy.GetManorInfo(),h.manorPy.GetPlayerManorInfo(!1,void 0,!0)},h)},h,500)},this,100),egret.setTimeout(function(){h.manorPy.GetManorRank()},this,100),this.startTimer(),this.initFormationScroll(),this.onClickFormation(this.manorPy.lastEntityIndex,!0),this.lb_revive_cost.text=""+this.ManorResurgenceCosts},i.prototype.requestWalk=function(t){if(this.map.me.tileX!=t[t.length-1].y||this.map.me.tileY!=t[t.length-1].x){var e=this.map.me.tileX,i=this.map.me.tileY;if((this.map.me.tileX!=this.map.me.serverTileX||this.map.me.tileY!=this.map.me.serverTileY)&&(console.log(" 客户端主角当前位置 和 服务器主角当前位置不一致 "),t=this.map.getAStarPath(this.map.me.serverTileX,this.map.me.serverTileY,t[t.length-1].y,t[t.length-1].x),e=this.map.me.serverTileX,i=this.map.me.serverTileY,t.length<=0))return console.log(" 校正主角位置 移动到服务器位置 暂停请求移动 "),void this.map.handleTouchTap(e,i,!1,!0);var a=v.GameMVC.manorPy.caleSafeAreaWalk(t);console.log("请求移动到点 X:"+t[t.length-1].y+", Y:"+t[t.length-1].x+", 移动 "+t.length+" 步"),this.manorPy.Walk({x:e,y:i},{x:t[t.length-1].y,y:t[t.length-1].x},t.length,a)}else console.log(" 相同地方请求两次 ")},i.prototype.updateView=function(t,e){},i.prototype.perClose=function(){this.stopTimer(),this.manorPy.reset(),this.map.reset(),this.map.removeAllOtherPlayer()},i.prototype.initUI=function(){this.pb_time.labelFunction=function(t,e){return Utils.TimerManager.getFormatBySecond1(t)};var t=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);this.startDt=t.openTimeDt,this.endDt=t.endTimeDt},i.prototype.initFormationScroll=function(){this.list_item.itemRenderer=n},i.prototype.onClickFormation=function(d,t){var h=this;void 0===t&&(t=!1),this.curIdx!=d&&(this.curIdx=d,t?this.updateFormationTips(d):this.curIdx!=this.manorPy.lastEntityIndex&&(GameRootLayer.gameLayer().switchCloudLoading(!0),egret.setTimeout(function(){GameRootLayer.gameLayer().switchCloudLoading(!1)},this,1e3),egret.setTimeout(function(){for(var t=void 0,e=0,i=h.manorPy.playerProxyInfo.playerEntityList;e<i.length;e++){var a=i[e];if(a.entityIndex==h.curIdx){t=a;break}}if(t){if(h.map.me.forceStop(),h.map.me.serverTileX=t.coordinateInfo.x,h.map.me.serverTileY=t.coordinateInfo.y,h.map.me.setTilePos(t.coordinateInfo.x,t.coordinateInfo.y,!1),h.map.resetCamera(),h.map.onMeWalkTo(t.coordinateInfo.x,t.coordinateInfo.y),v.GameMVC.guajiPy.updateCurPosition(t.coordinateInfo.x,t.coordinateInfo.y),v.GameMVC.manorMed.hideSubView(v.ManorMediator.SV.DETAIL),h.map.me.isOccpuyManor=0!=t.manorId,h.map.me.visible=0==t.manorId,t.teamInfo&&t.teamInfo.heroBaseInfoList&&t.teamInfo.heroBaseInfoList[0]){var n=t.teamInfo.heroBaseInfoList[0],o=void 0;0!=n.dermaCode&&(o=v.Config.getHeroDermaConfig()[n.dermaCode].avatar),h.map.me.updateBaseItem({code:n.code,avatar:o})}else{var r=JSON.parse(v.Config.constConfig().DefaultAvatar.constValue)[0];h.map.me.updateBaseItem({avatar:r})}h.manorPy.lastEntityIndex=h.curIdx,h.manorPy.GetPlayerManorInfo(!0,h.curIdx),h.map.removeAllOtherPlayer(),h.manorPy.GetPlayerManorInfo(!1),h.map.updateManorEPCollect(),h.updateBloodNum(),h.updateFormationTips(d);var s=void 0;if(t.coordinateStatus==ManorPlayerCoordinateChangeType.Battle?s="由于体力归0，你已传送回安全区":t.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?s="矿已消失，你已传送回安全区":t.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&(s="由于队伍状态改变，你已被传送回安全区"),s){var c=new egret.Timer(1e3,1);c.addEventListener(egret.TimerEvent.TIMER,function(){Utils.MsgUtils.addMidMsg(s),c.stop()},h),c.start()}}},this,500)),this.img_formation1.visible=1==d,this.img_formation2.visible=2==d,this.img_formation3.visible=3==d,this.img_formation_bg1.visible=1==d,this.img_formation_bg2.visible=2==d,this.img_formation_bg3.visible=3==d)},i.prototype.updatePlayerProxyInfo=function(){this.updateFormationTips(this.curIdx);var t=this.manorPy.playerProxyInfo.playerEntityList;this.scl_list.stopAnimation(),this.scl_list.validateNow(),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(t):this.list_item.dataProvider=new eui.ArrayCollection(t)},i.prototype.addEvent=function(){var e=this;this.gp_btn.touchEnabled=!0,this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(!this.isFormationMoveing){this.isFormationMoveing=!0;var e=0;this.isFormationShow&&(e=-this.gp_left.width),this.isFormationShow=!this.isFormationShow,egret.Tween.get(this.gp_left).to({x:e},200).call(function(){t.isFormationMoveing=!1,t.img_right.visible=0!=e,t.img_left.visible=0==e,t.gp_formation_tips.visible=0!=e})}},this),this.gp_formation1.touchEnabled=!0,this.gp_formation1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(1)},this),this.gp_formation2.touchEnabled=!0,this.gp_formation2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(2)},this),this.gp_formation3.touchEnabled=!0,this.gp_formation3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(3)},this),this.gp_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.gp_weapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.MainJumpConfig.jumpTo("CITY")},this),this.btn_ditu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){e.openMiniMap()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){PopUpManager.addPopUp({obj:new v.HelpDialog({moduleId:MODULE.Manor})})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.manorPy.GetBattleRecordInfo(),v.AppFacade.getInstance().showSubView(v.ManorMediator.N,v.ManorMediator.SV.RECORD)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&v.AppFacade.getInstance().showSubView(v.ChatMediator.N,v.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.RankMediator.N,v.RankMediator.SV.COMMON,{module:"MANOR_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.RankMediator.N,v.RankMediator.SV.COMMON,{module:"MANOR_REWARD"})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeManor})},this),this.btn_target.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.ManorMediator.N,v.ManorMediator.SV.TARGET)},this),this.gp_recoverDt.touchEnabled=!0,this.gp_recoverDt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;v.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否花费"+this.ManorResurgenceCosts+"钻石立即复活?",source:"manor_buy_revive",cb:!0,clickCB:function(t){1==t.type&&e.manorPy.PurchaseBlood(0)}})},this)},i.prototype.chooseNewList=function(t){return v.GameMVC.manorPy.checkFormation(t)},i.prototype.openFormationUI=function(){v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍",clickDarkClose:!1})},i.prototype.loadMapResConf=function(){var t=v.Config.manorLayer()[1];this.map.tiled!=t.tiled&&this.map.update({isInit:!0,tiled:t.tiled,theme:t.theme,h:t.long,w:t.wide})},i.prototype.onMeMoveFinish=function(){if(null!=this.isInSafe){var t=v.GameMVC.manorPy.inSafeArea(this.map.me.tileX,this.map.me.tileY);this.isInSafe!=t&&(t?Utils.MsgUtils.addMidMsg("你已进入安全区"):Utils.MsgUtils.addMidMsg("你已离开安全区"),this.isInSafe=t)}},i.prototype.openMiniMap=function(t){var e=!1;t&&(e=t.choice),this.map&&v.AppFacade.getInstance().showSubView(v.ManorMediator.N,v.ManorMediator.SV.MINI_MAP,{mwArr:this.map.mwArr,tileX:this.map.me.tileX,tileY:this.map.me.tileY,choice:e})},i.prototype.updateFormationTips=function(t){void 0===t&&(t=1),this.gp_member_tips.removeChildren();for(var e=1;e<=6;e++)(h=new f).name=e.toString(),h.x=51*(e-1),h.scaleX=h.scaleY=.48,h.updateItem({},!0),this.gp_member_tips.addChildAt(h,0),h.img_add.visible=!1;var i=this.manorPy.queryPlayerProxyInfoByEntityId(this.manorPy.lastEntityIndex);if(i){var a=i.teamInfo,n=i.blood,o=i.manorId,r=0;a&&a.fightCap&&(r=a.fightCap),this.item_fightCap_tips.update(r),this.blb_blood_tips.text=""+n;var s="mxkc_img_caijizhong_png";0==o&&(s="mxkc_img_weizhanling_png"),this.img_mark_tips.source=s;for(var c=0,d=a.heroBaseInfoList;c<d.length;c++){var h,l=d[c],p=l.battlePos;(h=this.gp_member_tips.getChildByName(p.toString()))&&h.updateItem(l,!0)}if(a&&a.petList&&a.petList[0]){var u=a.petList[0],g=v.GameMVC.petPy.getInfoByCode(u)[0];g&&(this.img_usePet.source=g.config.avatar+"_png"),this.img_usePet.visible=!0}else this.img_usePet.visible=!1;if(a&&a.magicalList&&a.magicalList[0]){var m=a.magicalList[0],y=v.GameMVC.magicalArtifactPy.getInfoByCode(m);y&&(this.img_useArt.source=y.config.model+"_png"),this.img_useArt.visible=!0}else this.img_useArt.visible=!1}},i.prototype.playSuccessEffect=function(){DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!1,x:GameRootLayer.gameLayer().popMsgLayer.width/2,y:GameRootLayer.gameLayer().popMsgLayer.height/2,scaleX:1,scaleY:1,effectName:"common_zlcg",parent:GameRootLayer.gameLayer().popMsgLayer,timeScale:1})},i.prototype.updatePlayerEntityInfo=function(n){var o=this;this.manorPy.playerList.forEach(function(t){if(t.isSelf){if(o.map.updatePlayerEntityInfo(t,n,o.targetEP),o.targetEP=void 0,t.entityIndex==o.manorPy.lastEntityIndex){var e=Utils.TimerManager.getServerTime(),i=t.revivalBeginDt||0,a=e-i;0!=i&&a<o.ManorResurgenceCycle?o.recoverCD=o.ManorResurgenceCycle-a:o.recoverCD=0}}else o.map.updatePlayerEntityInfo(t,n)}),this.map.touchChildren=!0,this.map.touchEnabled=!1},i.prototype.updateManorEntityInfo=function(t){var i=[];this.manorPy.manorList.forEach(function(t){var e=RiskEventType.Manor;t.remove&&(e=RiskEventType.None),i.push(new v.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "captured":false, "id":'+t.id+', "manorId":'+t.manorId+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:t.coordinateInfo.x,y:t.coordinateInfo.y},type:e}))}),this.map.updateLayerEvent({events:i});for(var e=this.manorPy.manorList.length-1;0<=e;e--)this.manorPy.manorList[e].remove&&this.manorPy.manorList.splice(e,1);this.map.resetMNM()},i.prototype.updateBloodNum=function(){var t=this.manorPy.queryPlayerEntityByPlayerId(v.GameMVC.loginPy.playerProxy.playerInfoVO.playerId,this.manorPy.lastEntityIndex);t&&(this.bloodNum=t.blood,this.blb_blood.text=this.bloodNum+"/"+this.ManorInitBlood)},i.prototype.removeManorEntity=function(t){this.map.removeManorEntity(t)},i.prototype.removePlayerEntity=function(t){this.map.removePlayerEntity(t)},i.prototype.showRewardView=function(t){v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.REWARD_PANEL,{rewards:t.clientReward,type:v.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})},i.prototype.updateRank=function(){this.gp_ranking.visible=!1,this.gp_empty.visible=!0,this.img_rank1.visible=!1,this.img_rank2.visible=!1,this.img_rank3.visible=!1,this.img_score1.visible=!1,this.img_score2.visible=!1,this.img_score3.visible=!1;var t=this.manorPy.ranks;if(t){var e=t.ranks;Array.isArray(e)&&0<e.length&&(this.gp_ranking.visible=!0,this.gp_empty.visible=!1,e[0]?(this.lb_name1.text="S"+e[0].playerBaseInfo.serverId+"."+e[0].playerBaseInfo.name,this.lb_score1.text=""+e[0].key,this.img_rank1.visible=!0,this.img_score1.visible=!0):(this.lb_name1.text="",this.lb_score1.text=""),e[1]?(this.lb_name2.text="S"+e[1].playerBaseInfo.serverId+"."+e[1].playerBaseInfo.name,this.lb_score2.text=""+e[1].key,this.img_rank2.visible=!0,this.img_score2.visible=!0):(this.lb_name2.text="",this.lb_score2.text=""),e[2]?(this.lb_name3.text="S"+e[2].playerBaseInfo.serverId+"."+e[2].playerBaseInfo.name,this.lb_score3.text=""+e[2].key,this.img_rank3.visible=!0,this.img_score3.visible=!0):(this.lb_name3.text="",this.lb_score3.text=""));var i=t.selfRank;this.lb_my_ranking.text=""+i.rank,this.lb_my_score.text=""+i.key}},i.prototype.startTimer=function(t,e){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=t||1e3,this.timer.repeatCount=e||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},i.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},i.prototype.timerFunc=function(){if(0<this.recoverCD?(this.gp_recoverDt.visible||(this.gp_recoverDt.visible=!0),this.blb_dt_tips.text=""+Utils.TimerManager.getFormatBySecond1(this.recoverCD),this.recoverCD--):(this.gp_recoverDt.visible&&(this.gp_recoverDt.visible=!1),this.bloodNum<=0&&this.manorPy.GetPlayerManorInfo()),this.pb_time){var t=Utils.TimerManager.getServerTime(!1),e=this.endDt-t;if(this.pb_time.maximum=this.endDt-this.startDt,(this.pb_time.value=e)<=0)return Utils.MsgUtils.addMidMsg("活动已结束!"),void v.AppFacade.getInstance().sendNotification(CN.MANOR_FORCE_EXIT)}this.map&&this.map.updateManorEPCollect(),this.intervalRank<=0?(this.manorPy.GetManorRank(),this.intervalRank=MANOR_UPDATE_RANK):this.intervalRank-=1},i.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},i);function i(){var t=e.call(this)||this;return t.isFormationMoveing=!1,t.isFormationShow=!1,t.skinName="ManorSkin",t.intervalRank=STORM_WAR_UPDATE_RANK,t.ManorEnterIntoManorArenaMinBlood=Number(v.Config.constConfig().ManorEnterIntoManorArenaMinBlood.constValue),t.ManorEnterIntoManorArenaHintBlood=Number(v.Config.constConfig().ManorEnterIntoManorArenaHintBlood.constValue),t.ManorOpenDays=Number(v.Config.constConfig().ManorOpenDays.constValue),t.ManorInitBlood=Number(v.Config.constConfig().ManorInitBlood.constValue),t.ManorBloodRefreshCycle=Number(v.Config.constConfig().ManorBloodRefreshCycle.constValue),t.ManorResurgenceCosts=Number(JSON.parse(v.Config.constConfig().ManorResurgenceCosts.constValue)[0][2])||0,t.ManorResurgenceCycle=Number(v.Config.constConfig().ManorResurgenceCycle.constValue),t.manorPy=v.AppFacade.getInstance().retrieveProxy(v.ManorProxy.N),t.playerProxy=v.AppFacade.getInstance().retrieveProxy(v.PlayerPy.N),t.guajiPy=v.AppFacade.getInstance().retrieveProxy(v.GuajiPy.N),t.bloodNum=0,t.isInSafe=void 0,t.isFormationMoveing=!1,t.isFormationShow=!1,t.recoverCD=0,t}v.ManorView=t;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this);for(var t=1;t<=6;t++){var e=new f;e.name=t.toString(),e.x=51*(t-1),e.scaleX=e.scaleY=.48,e.updateItem({}),this.gp_member.addChildAt(e,0)}this.addEvent()},o.prototype.dataChanged=function(){var t=this.data.entityIndex||1,e=this.data.teamInfo,i=this.data.blood,a=this.data.manorId;this.lb_part.text="队伍"+t;var n=0;e&&e.fightCap&&(n=e.fightCap),this.item_fightCap_l.update(n),this.blb_blood.text=""+i;var o="mxkc_img_caijizhong_png";0==a&&(o="mxkc_img_weizhanling_png"),this.img_mark.source=o,this.lb_tips.touchEnabled=!1,0<e.heroBaseInfoList.length?this.lb_tips.visible=!1:this.lb_tips.visible=!0;for(var r=1;r<=6;r++)(d=this.gp_member.getChildByName(r.toString()))&&d.updateItem({});for(var s=0,c=e.heroBaseInfoList;s<c.length;s++){var d,h=c[s],l=h.battlePos;(d=this.gp_member.getChildByName(l.toString()))&&d.updateItem(h)}if(e&&e.petList&&e.petList[0]){var p=e.petList[0],u=v.GameMVC.petPy.getInfoByCode(p)[0];u&&(this.img_usePet.source=u.config.avatar+"_png"),this.img_usePet.visible=!0}else this.img_usePet.visible=!1;if(e&&e.magicalList&&e.magicalList[0]){var g=e.magicalList[0],m=v.GameMVC.magicalArtifactPy.getInfoByCode(g);m&&(this.img_useArt.source=m.config.model+"_png"),this.img_useArt.visible=!0}else this.img_useArt.visible=!1},o.prototype.chooseNewList=function(t){return v.GameMVC.manorPy.checkFormation(t)},o.prototype.openFormationUI=function(){v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍",clickDarkClose:!1})},o.prototype.addEvent=function(){this.btn_edit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.img_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.img_weapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this)},o);function o(){var t=a.call(this)||this;return t.skinName="ManorFormation_Item",t}var r,f=(r=eui.ItemRenderer,__extends(s,r),s.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍",clickDarkClose:!1})},this)},s.prototype.chooseNewList=function(t){return v.GameMVC.manorPy.checkFormation(t)},s.prototype.updateItem=function(t,e){if(void 0===e&&(e=!1),(this.data=t).code){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,this.gp_touch.visible=!1,this.img_add.visible=!1;var i=void 0;0!=t.dermaCode&&(i=v.Config.getHeroDermaConfig()[t.dermaCode].avatar),this.baseItem.updateData({code:t.code,avatar:i})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.gp_touch.visible=!0,this.img_add.visible=!0;e&&(this.gp_touch.visible=!0)},s);function s(){var t=r.call(this)||this;return t.skinName="ManorHead_Item",t}}(game=game||{}),function(f){var i,t=(i=BasePanel,__extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.addEvent()},e.prototype.updateView=function(t){var n=this;this.data=t.data,this.isCreep=t.isCreep,this.gp_player_info.visible=!this.isCreep,this.lb_monster_name.visible=this.isCreep;var e=this.py.selfPlayer,i=f.Config.stormWarLayer()[e.layerCode],a=JSON.parse(i.winScore);if(!this.isCreep){var o=Math.min(e.doubleHit+1,this.maxDoubleHit),r=this.stormWarDoubleHit[o];if(r){var s=JSON.parse(r.battleScore);Array.isArray(s)&&0<s.length&&(a[0][2]+=s[0][2])}}if(this.isCreep){this.defenceId=this.data.creepCode;var c=f.Config.stormWarCreep()[this.data.creepCode];if(!c)return;var d=JSON.parse(c.creeps);Array.isArray(d)&&d.forEach(function(t){if(t[0]){var e=customui.BaseItemFactory.create();e.updateData({type:EEntityType.EEntityTypeHero,id:t[0]}),e.scaleX=e.scaleY=.7,n.gp_enermy.addChild(e),e.touchEnabled=!1}});for(var h=0,l=g=JSON.parse(c.rewards);h<l.length;h++){var p=l[h],u=.7;(v=customui.BaseItemFactory.create(21)).updateData({type:p[0],code:p[1],num:p[2]}),v.scaleX=u,v.scaleY=u,this.gp_reward_show.addChild(v)}}else{var g;this.defenceId=this.data.playerId,this.lb_player_name.text="S"+this.data.serverId+"."+this.data.name,Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:this.data.playerId}).then(function(t){if(n.stage){var e=t.publicPlayer;if(e){var i=e.baseInfo,a=e.heroList;n.playerHead.updateData({vo:i}),n.item_fightCap.update(i.fightCap),n.gp_enermy.removeChildren(),Array.isArray(a)&&a.forEach(function(t){var e=customui.BaseItemFactory.create();e.updateData({type:EEntityType.EEntityTypeHero,id:t.code,level:t.level}),e.scaleX=e.scaleY=.7,n.gp_enermy.addChild(e),e.touchEnabled=!1})}}}).catch(function(t){}),(g=new Array).push(a[0]);for(var m=0,y=g;m<y.length;m++){var v;p=y[m],u=.7,(v=customui.BaseItemFactory.create(21)).updateData({type:p[0],code:p[1],num:p[2]}),v.scaleX=u,v.scaleY=u,this.gp_reward_show.addChild(v)}}},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.addEvent=function(){this.btn_challge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.defenceId&&this.py.Challenge(this.defenceId,this.isCreep),this.hide()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroMediator.N,f.HeroMediator.SV.FORMATION)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this)},e.prototype.checkIsRemoveTarget=function(t,e){e==this.isCreep&&this.defenceId==t&&this.hide()},e);function e(){var t=i.call(this)||this;for(var e in t.skinName="StormWarDialogSkin",t.py=f.AppFacade.getInstance().retrieveProxy(f.StormWarProxy.N),t.stormWarDoubleHit=f.Config.stormWarDoubleHit(),t.maxDoubleHit=0,t.stormWarDoubleHit)t.maxDoubleHit=Math.max(t.maxDoubleHit,t.stormWarDoubleHit[e].num);return t}f.StormWarDialog=t}(game=game||{}),function(a){var e,t=(e=BaseMediator,__extends(n,e),Object.defineProperty(n.prototype,"stormWarView",{get:function(){return this.getSubView(n.SV.MAIN)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stormWarDialog",{get:function(){return this.getSubView(n.SV.DIALOG)},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,a.StormWarView),this.addSubView(n.SV.DIALOG,a.StormWarDialog),this.addSubView(n.SV.RECORD,a.StormWarRecordPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CHANGE_PANEL,CN.STORM_WAR_UPDATE_LAYER,CN.STORM_WAR_UPDATE_CREEPS,CN.STORM_WAR_UPDATE_PLAYERS,CN.STORM_WAR_UPDATE_SELF_PLAYER,CN.STORM_WAR_UPDATE_WAR,CN.STORM_WAR_REMOVE_PLAYER,CN.STORM_WAR_REMOVE_CREEP,CN.STORM_WAR_FORCE_EXIT,CN.STORM_WAR_UPDATE_RANKS,CN.STORM_WAR_BATTLE_FINISH]},n.prototype.handleNotification=function(t){var e=t.getBody();switch(t.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var i=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);i.isOpen&&i.allow&&a.GameMVC.stormWarPy.GetStormWarPlayer();break;case CN.STORM_WAR_UPDATE_LAYER:this.stormWarView&&this.stormWarView.updateLayer();break;case CN.STORM_WAR_UPDATE_CREEPS:this.stormWarView&&this.stormWarView.updateCreeps();break;case CN.STORM_WAR_UPDATE_PLAYERS:this.stormWarView&&this.stormWarView.updatePlayers(e.isInit);break;case CN.STORM_WAR_UPDATE_SELF_PLAYER:this.stormWarView&&this.stormWarView.updateSelfPlayer(),NoticeManager.updateNotice(NT.STORM_WAR_ACHIEVE);break;case CN.STORM_WAR_UPDATE_WAR:this.stormWarView&&this.stormWarView.updateWar();break;case CN.STORM_WAR_REMOVE_PLAYER:this.stormWarView&&this.stormWarView.removePlayer(e.playerId),this.stormWarDialog&&this.stormWarDialog.checkIsRemoveTarget(e.playerId,!1);break;case CN.STORM_WAR_REMOVE_CREEP:this.stormWarDialog&&this.stormWarDialog.checkIsRemoveTarget(e.creepCode,!0);break;case CN.STORM_WAR_FORCE_EXIT:this.getSubView(n.SV.MAIN)&&a.MainJumpConfig.jumpTo();break;case CN.STORM_WAR_UPDATE_RANKS:this.stormWarView&&this.stormWarView.updateRank();break;case CN.STORM_WAR_BATTLE_FINISH:console.log("===== stormWar STORM_WAR_BATTLE_FINISH ===== 战斗结束, 请求拉取层玩家怪数据"),a.GameMVC.stormWarPy.GetStormWarInfo(!1),this.stormWarView&&this.stormWarView.onBattleFinish(e.result);break;case CN.CHANGE_PANEL:e&&e.isRemove&&this.stormWarView&&(this.stormWarView.gp_map.visible=!0)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="StormWarMediator",n.SV={MAIN:1,DIALOG:2,RECORD:3},n);function n(t){return void 0===t&&(t=null),e.call(this,n.N,t)||this}a.StormWarMediator=t}(game=game||{}),function(i){var t=(e.create=function(t){var e=Utils.ObjectPoolMgr.pop("game.StormWarPlayer",t);return e.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(e)},this),e},e);function e(){}i.StormWarPlayerFactory=t;var a,n=(a=i.Npc,__extends(o,a),o.prototype.resetTileXY=function(){this.lastTileX=this.lastTileY=void 0},o.prototype.setTilePos=function(t,e,i){void 0===i&&(i=!1),i?(this._tileX=t,this._tileY=e,this.updateFixedPos()):(this.tileX=t,this.tileY=e)},o.prototype.switchFocus=function(){this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ},o.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.roleDyModel=new customui.RoleDynamicModel({vo:{fashionCode:this.player.fashionCode,horseCode:this.player.horseCode,titleCode:this.player.titleCode,magicalCode:this.player.magicalCode},cacheFrameRate:6}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel),UIActionManager.addEffect(this.gp_foot,"common_gonghuizhanj",{offectY:-120},function(t){(e.effect_fighting=t).visible=!1}),this.img_name_bg=new eui.Image("mxkc_img_di_png"),this.img_name_bg.height=24,this.img_name_bg.horizontalCenter=0,this.gp_foot.addChild(this.img_name_bg),this.lb_name=new eui.Label,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=16777215,this.lb_name.size=18,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+this.player.serverId+"."+this.player.name,this.updateChampion(i.GameMVC.stormWarPy.war.champion),this.switchFocus(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this._hasInit=!0},o.prototype.updateChampion=function(t){var e=this,i=!1;t&&t.playerId==this.player.playerId&&(i=!0),i?(this.img_name_bg.source="_stormWar_m_json.fbzc_img_guanjundi",this.img_name_bg.height=83,this.lb_name.textColor=0):(this.img_name_bg.source="mxkc_img_di_png",this.img_name_bg.height=24,this.lb_name.textColor=16777215),this.roleDyModel.onArmatureLoadCB=function(){var t=e.roleDyModel.getHeadNameBottom();e.img_name_bg.bottom=t-e.img_name_bg.height/2-7.5,e.lb_name.bottom=t-e.lb_name.height}},o.prototype.updateFighting=function(t){this.effect_fighting&&(this.effect_fighting.visible=t)},o.prototype.onClick=function(){var t=this.player.playerId;if(!this.map.getStormWarPlayerByPlayerId(t))return this.reset(),void(this.parent&&this.parent.removeChild(this));console.log(" 点中玩家了 ");var e=this.map.getStormWarPlayerByTilePos(this._tileX,this._tileY);e&&0<e.length?i.AppFacade.getInstance().showSubView(i.StormWarMediator.N,i.StormWarMediator.SV.DIALOG,{data:e[0].player,isCreep:!1}):this.map.handleTouchTap(this.tileX,this.tileY)},o.prototype.walkByPath=function(t,e){var i=this;this.walkDoneCB=e,this.walkPaths.splice(0),t.forEach(function(t){i.walkPaths.push({tileX:t.y,tileY:t.x})}),0<this.walkPaths.length&&(this.walkPaths[this.walkPaths.length-1].isLast=!0),this.isMoving||this.walkByPathNext()},o.prototype.onChangingDir=function(t){this.roleDyModel.onChangingDir(t)},o.prototype.walkPathFinish=function(){this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ,this.walkDoneCB&&this.walkDoneCB(),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0)},o.prototype.forceStop=function(){this.walkPaths.splice(0)},o.prototype.walkByPathNext=function(){var t=this.walkPaths.shift();t?this.walkToTile(t.tileX,t.tileY):this.walkPathFinish()},o.prototype.onWalking=function(){var t=this;this.roleDyModel.curModelAct!=ROLE_ACTION_NAME.PB&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.PB),this.isMoving=!0;var e=this.map.tile2Pos(this.tileX,this.tileY);egret.Tween.get(this).to({x:e.x,y:e.y},this.map.npcMovingDura).call(function(){t.isMoving=!1,t.onAfterWalk()}),this.updateVisible(this.tileX,this.tileY),this.hasWalkPassPath.push({x:this.tileX,y:this.tileY})},o.prototype.updateVisible=function(t,e){void 0===t&&(t=this.tileX),void 0===e&&(e=this.tileY);var i=this.map.getTileIndex(this.tileX,this.tileY),a=this.map.mwArr[i];a&&(0==a||4==a?this.visible&&(this.visible=!1):2!=a&&3!=a||this.visible||(this.visible=!0))},o.prototype.onAfterWalk=function(){if(a.prototype.onAfterWalk.call(this),this.customAfterWalkCB){var t=this.hasWalkPassPath[this.hasWalkPassPath.length-1];this.customAfterWalkCB(t.x,t.y)}this.walkByPathNext()},o.prototype.reset=function(){a.prototype.reset.call(this),egret.Tween.removeTweens(this),this.walkPaths.splice(0),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),this.roleDyModel.reset(),this.isMoving=!1,this.visible=!1,this.zorder=0},o.prototype.onOPReset=function(){this.reset()},o.prototype.onOPComeBack=function(t,e){a.prototype.onOPComeBackCB.call(this),this.player=t.player,this.map=t.map,this._hasInit&&(this.roleDyModel.update({vo:{fashionCode:this.player.fashionCode,horseCode:this.player.horseCode,titleCode:this.player.titleCode,magicalCode:this.player.magicalCode}}),this.lb_name.text="S"+this.player.serverId+"."+this.player.name,this.updateChampion(i.GameMVC.stormWarPy.war.champion))},o.prototype.onOPClean=function(){},o.prototype.onOPCheck=function(t){egret.log("alive")},o);function o(){var t=a.call(this)||this;return t.walkPaths=new Array,t.hasWalkPassPath=new Array,t}i.StormWarPlayer=n}(game=game||{}),function(a){var t=(e.registerAll=function(){(new n).register(),(new s).register(),(new h).register(),(new u).register(),(new y).register()},e);function e(){}a.StormWarProcessor=t;var i,n=(i=a.ProcessorBase,__extends(o,i),o.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.StormWarProxy.N).updateSelfLayer(e.selfPlayer)},o);function o(){return i.call(this,"stormWar.PlayerStormWarInfoP",o)||this}var r,s=(r=a.ProcessorBase,__extends(c,r),c.prototype.execute=function(t){var e=t.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.StormWarProxy.N);i.isLayerCodeChange(e.layer.layerCode)?console.log("===== stormWar StormWarLayerInfoP ===== 场景发生改变 等待战斗结束"):i.updateLayer(e.layer)},c);function c(){return r.call(this,"stormWar.StormWarLayerInfoP",c)||this}var d,h=(d=a.ProcessorBase,__extends(l,d),l.prototype.execute=function(t){var e=t.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.StormWarProxy.N);i.isLayerCodeChange(e.layer.layerCode)?console.log("===== stormWar StormWarInfoP ===== 场景发生改变 等待战斗结束"):i.updateLayer(e.layer),i.updateSelfLayer(e.selfPlayer),i.updateWar(e.war)},l);function l(){return d.call(this,"stormWar.StormWarInfoP",l)||this}var p,u=(p=a.ProcessorBase,__extends(g,p),g.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.StormWarProxy.N).updateWar(e.war)},g);function g(){return p.call(this,"stormWar.WarInfoP",g)||this}var m,y=(m=a.ProcessorBase,__extends(v,m),v.prototype.execute=function(t){var e=t.getBody();a.AppFacade.getInstance().retrieveProxy(a.StormWarProxy.N).challengeResultInfo=e.battleRecord},v);function v(){return m.call(this,"stormWar.StormWarBattleRecordP",v)||this}}(game=game||{}),function(s){var e,t=(e=BaseProxy,__extends(i,e),i.prototype.reset=function(){},i.prototype.isLayerCodeChange=function(t){return 0==this.lastLayerCode?(this.lastLayerCode=t,!1):this.lastLayerCode!=t},i.prototype.updateLayer=function(t,e){void 0===e&&(e=!1),this.layer.update(t),this.sendNotification(CN.STORM_WAR_UPDATE_LAYER),this.updatePlayers(t.players,e),this.updateCreeps(t.creeps)},i.prototype.updateSelfLayer=function(t){this.selfPlayer.update(t),this.sendNotification(CN.STORM_WAR_UPDATE_SELF_PLAYER)},i.prototype.updateWar=function(t){this.war.update(t),this.sendNotification(CN.STORM_WAR_UPDATE_WAR)},i.prototype.updateCreeps=function(t){for(var e=this.creeps.length-1;0<=e;e--){var i=!1;for(var a in t)if(t[a].creepCode==this.creeps[e].creepCode){i=!0;break}i||(this.sendNotification(CN.STORM_WAR_REMOVE_CREEP,{creepCode:this.creeps[e].creepCode}),this.creeps[e].remove=!0)}for(var e in t){for(var a in i=!1,this.creeps)if(this.creeps[a].creepCode==t[e].creepCode){this.creeps[a].update(t[e]),i=!0;break}i||this.creeps.push(new s.SCreepBase(t[e]))}this.sendNotification(CN.STORM_WAR_UPDATE_CREEPS)},i.prototype.updatePlayers=function(t,e){void 0===e&&(e=!1);for(var i=0,a=this.players.length-1;0<=a;a--){var n=!1;for(var o in t)if(t[o].playerId==this.players[a].playerId){n=!0;break}n||(this.sendNotification(CN.STORM_WAR_REMOVE_PLAYER,{playerId:this.players[a].playerId}),this.players.splice(a,1),i++)}for(var a in egret.log("风暴stormWar 移除",i),i=0,t){var r=n=!1;for(var o in this.players)if(this.players[o].playerId==t[a].playerId){this.players[o].update(t[a]),n=!0;break}n||this.war.champion&&this.war.champion.playerId==t[a].playerId&&(r=!0),(r||this.players.length<this.MAX_SYNC_COUNT&&!n)&&(this.players.push(new s.SPlayerBase(t[a])),i++)}egret.log("风暴stormWar 追加",i),this.sendNotification(CN.STORM_WAR_UPDATE_PLAYERS,{isInit:e})},i.prototype.getPlayerByPlayerId=function(t){var e=null;for(var i in this.players)if(this.players[i].playerId==t){e=this.players[i];break}return e},i.prototype.updateRank=function(t){this.ranks=t,this.sendNotification(CN.STORM_WAR_UPDATE_RANKS)},i.prototype.GetStormWarInfo=function(i){var a=this;void 0===i&&(i=!1),Utils.Socket.send("stormWar","GetStormWarInfo",{},!0).then(function(t){var e=s.GameMVC.playerPy.playerInfoVO.playerId;t.layer.players.some(function(t){if(t.playerId==e)return!0})||(Utils.MsgUtils.addMidMsg("找不到自己"),s.MainJumpConfig.jumpTo("CITY")),a.lastLayerCode=t.layer.layerCode,a.updateLayer(t.layer,i),a.updateSelfLayer(t.selfPlayer),a.updateWar(t.war)}).catch(function(t){t&&t.err&&(Utils.MsgUtils.addErrMsg(t.err),a.sendNotification(CN.STORM_WAR_FORCE_EXIT))})},i.prototype.Challenge=function(t,e){var i=this;s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeStormWar,pb1:"stormWar",pb2:"Challenge",params:{defenceId:t,isCreep:e},reqCB:function(t){i.challengeResultInfo=t.battleRecord},doneCB:function(t){t.cbRet&&(i.isLayerCodeChange(t.cbRet.layer.layerCode)?console.log("===== stormWar ChallengeR ===== 场景发生改变 等待战斗结束"):i.updateLayer(t.cbRet.layer),i.updateSelfLayer(t.cbRet.selfPlayer),i.updateWar(t.cbRet.war),i.challengeResultInfo=void 0),s.AppFacade.getInstance().retrieveProxy(s.FightPy.N).queueExceExitCB()}})},i.prototype.GetRewards=function(t,e,i){var a=this;Utils.Socket.send("stormWar","GetRewards",{rewardType:t,rewardId:e}).then(function(t){a.updateSelfLayer(t.selfPlayer),i&&i(t)}).catch(function(t){})},i.prototype.GetStormWarRank=function(){var e=this;Utils.Socket.send("ranking","GetCommonRank",{rankType:RankingType.RankingTypeActivityStormWarTopThree}).then(function(t){e.updateRank(t)}).catch(function(t){})},i.prototype.GetStormWarPlayer=function(){var e=this;Utils.Socket.send("stormWar","GetStormWarPlayer",{}).then(function(t){e.selfPlayer.score=t.score,e.selfPlayer.targeted=t.targeted,NoticeManager.updateNotice(NT.STORM_WAR_ACHIEVE)}).catch(function(t){})},i.prototype.GetStormWarBattleRecordInfo=function(e){Utils.Socket.send("stormWar","GetStormWarBattleRecordInfo",{}).then(function(t){e&&e(t)}).catch(function(t){})},i.prototype.addNotice=function(){NoticeManager.setChildType(NT.CITY_EXT_ENTRANCE,NT.STORM_WAR),NoticeManager.setChildType(NT.STORM_WAR,NT.STORM_WAR_ACHIEVE),NoticeManager.registerCB(NT.STORM_WAR_ACHIEVE,this.checkAchieveNotice,this,MODULE.StormWar)},i.prototype.checkAchieveNotice=function(){var i=!1,t=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);if(!t)return i;if(!t.allow)return i;if(!t.isOpen)return i;function e(t){var e=o[t];if(e.score<=a&&n.every(function(t){return t.rewardId!=e.code}))return i=!0,"break"}var a=this.selfPlayer.score,n=this.selfPlayer.targeted,o=s.Config.stormWarRewards();for(var r in o)if("break"===e(r))break;return i},i.N="StormWarProxy",i);function i(){var t=e.call(this,i.N)||this;return t.MAX_SYNC_COUNT=50,t.challengeResultInfo=void 0,t.lastLayerCode=0,t.layer=new s.SLayer,t.selfPlayer=new s.SPlayer,t.war=new s.SWar,t.creeps=new Array,t.players=new Array,t.addNotice(),t}s.StormWarProxy=t}(game=game||{}),function(i){var e,t=(e=BasePanel,__extends(a,e),a.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.cu_xtck.blb_title.text="战斗记录",this.cu_xtck.onCloseCB=function(){t.hide()}},a.prototype.updateView=function(t){this.params=t,this.updateList(this.params.info.battleRecords)},a.prototype.updateList=function(t){0<t.length?(t.sort(function(t,e){return t.battleDt>e.battleDt?-1:1}),this.gp_empty.visible=!1,this.list_item.itemRenderer=o,this.list_item.dataProvider=new eui.ArrayCollection(t)):this.gp_empty.visible=!0},a);function a(){var t=e.call(this)||this;return t.skinName="StormWarRecordPanelSkin",t}i.StormWarRecordPanel=t;var n,o=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.data.battleUuid;e.proxy.BattlePlayBack(t)},this),this.gp_heads.addChild(this.cu_playerHead1);var t=.7;i.FightRecordPanel.curTeamId&&(t=.6),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=t},r.prototype.dataChanged=function(){var t;this.data,this.vo=this.data,this.lb_name.text=this.vo.baseInfo.name,t=this.vo.challengerId!=this.pPy.playerInfoVO.playerId?this.vo.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.vo.result,this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.cu_playerHead1.updateData({vo:this.vo.baseInfo});var e=JSON.parse(this.data.keyStr);this.lb_change.text=e.oldLayer+"→"+e.newLayer,this.lb_time.visible=!0;var i=this.vo||this.vo2;t===EBattleResult.EBattleResultWin?this.img_result.source="jjc_icon_sheng_png":this.img_result.source="jjc_icon_bai_png",this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-i.battleDt)},r);function r(){var t=n.call(this)||this;return t.skinName="StormWarRecordItemSkin",t.proxy=i.AppFacade.getInstance().retrieveProxy(i.FightPy.N),t.pPy=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),t.cu_playerHead1=customui.PlayerHeadFactory.create(),t}}(game=game||{}),function(f){var e,t=(e=BasePanel,__extends(i,e),i.prototype.perClose=function(){this.doneCB&&this.doneCB()},i.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},i.prototype.updateView=function(t){var i=this;this.params=t.info,this.doneCB=t.doneCB;var e=this.stormWarProxy.challengeResultInfo,a=e.result==EBattleResult.EBattleResultWin,n=a?"common_shengli_22":"common_zhanbai_22";if(this.gp_win.visible=a,this.gp_lose.visible=!a,this.gp_effect.removeChildren(),DragonBoneTools.create(n,function(t){t.x=this.gp_effect.width/2,t.y=this.gp_effect.height,t.animation.play(),this.gp_effect.addChild(t)},this),a&&(this.gp_reward.removeChildren(),this.params&&this.params.clientReward&&this.params.clientReward.rewards)){var o=this.params.clientReward.rewards;for(var r in o){var s=customui.BaseItemFactory.create();s.scaleX=s.scaleY=.7,s.updateData({code:o[r].code,type:o[r].type,num:o[r].num}),this.gp_reward.addChild(s)}}for(var r in this.params.teams){var c=this.params.teams[r];if(c.playerId&&c.playerId==this.playerPy.playerInfoVO.playerId)this.playerPy.GetPublicPlayerBaseInfo([c.playerId],function(t,e){t&&t[0]&&(i.player_my.updateData({vo:t[0].baseInfo}),i.lb_my.text=t[0].baseInfo.name)});else if(c&&c.playerId)this.player_other.visible=!0,this.gp_otherHero.visible=!1,this.lb_num_other.visible=!0,this.lbl_other.visible=!0,this.playerPy.GetPublicPlayerBaseInfo([c.playerId],function(t,e){t&&t[0]&&(i.player_other.updateData({vo:t[0].baseInfo}),i.lb_other.text=t[0].baseInfo.name)});else{this.player_other.visible=!1,this.gp_otherHero.visible=!0,this.lb_num_other.visible=!1,this.lbl_other.visible=!1,this.gp_otherHero.removeChildren();var d=customui.BaseItemFactory.create();d.touchEnabled=!1;var h=c.entities[0],l=void 0;h.dermaCode&&0!=h.dermaCode&&(l=f.Config.getHeroDermaConfig()[h.dermaCode].avatar),d.updateData({code:h.code,type:EEntityType.EEntityTypeHero,avatar:l,isShowZhongZhu:!0}),this.gp_otherHero.addChild(d),this.lb_other.text=f.Config.allHeroConfig()[h.code].name}}if(e&&e.keyStr){var p=JSON.parse(e.keyStr),u=p.newScore-p.oldScore;this.lbl_now.text="第"+this.toChinesNum(p.newLayer)+"层",this.lbl_last.text="第"+this.toChinesNum(p.oldLayer)+"层";var g=[];g.push({text:p.newScore+"(",style:{textColor:16777215}}),g.push({text:0<=u?"+"+u:u+"",style:{textColor:0<u?COLOR_2_FONT_COLOR[2]:COLOR_2_FONT_COLOR[6]}}),g.push({text:")",style:{textColor:16777215}}),this.lb_num_my.textFlow=g}if(e&&e.tKeyStr){var m=JSON.parse(e.tKeyStr),y=m.newScore-m.oldScore,v=[];v.push({text:m.newScore+"(",style:{textColor:16777215}}),v.push({text:0<=y?"+"+y:y+"",style:{textColor:0<y?COLOR_2_FONT_COLOR[2]:COLOR_2_FONT_COLOR[6]}}),v.push({text:")",style:{textColor:16777215}}),this.lb_num_other.textFlow=v}},i.prototype.toChinesNum=function(t){for(var e=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],a="",n="",o=0,r=!0,s=t;0<t;){var c=t%10;0==c?r||(r=!0,n=e[c]+n):(r=!1,a=e[c],n=(a+=i[o])+n),o++,t=Math.floor(t/10)}return 9<s&&s<20&&(n=n.replace("一","")),n},i);function i(){var t=e.call(this)||this;return t.params=void 0,t.doneCB=void 0,t.playerPy=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),t.stormWarProxy=f.AppFacade.getInstance().retrieveProxy(f.StormWarProxy.N),t.skinName="StormWarResultPanelSkin",t}f.StormWarResultPanel=t}(game=game||{});var game,STORM_WAR_MOVE_CD=1,STORM_WAR_UPDATE_RANK=5;!function(h){var e,t=(e=BaseFull,__extends(i,e),i.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),Utils.ObjectPoolMgr.clearClass("game.StormWarPlayer")},i.prototype.initBottom=function(){var t=this;this.roleDyModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),this.gp_bottom_roleModel.addChild(this.roleDyModel),this.roleDyModel.onArmatureLoadCB=function(){t.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ,t.roleArmature=t.roleDyModel.ead_model1,t.roleArmature.animation.timeScale=1.2,t.roleArmature.scaleX=-.8,t.roleArmature.scaleY=.8}},i.prototype.perClose=function(){this.py.reset(),this.map.reset(),this.map.removeAllStormWarPlayer(),this.stopTimer(),this.gp_effect&&egret.Tween.removeTweens(this.gp_effect),this.blb_win_num&&egret.Tween.removeTweens(this.blb_win_num),this.roleArmature&&egret.Tween.removeTweens(this.roleArmature),this.creepArmature&&egret.Tween.removeTweens(this.creepArmature),this.gp_bottom_roleModel&&egret.Tween.removeTweens(this.gp_bottom_roleModel),this.gp_bottom_creepModel&&egret.Tween.removeTweens(this.gp_bottom_creepModel),this.py.lastLayerCode=0},i.prototype.childrenCreated=function(){var n=this;e.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_right_top),this.pb_time.labelFunction=function(t,e){return Utils.TimerManager.getFormatBySecond1(t)},this.initBottom(),this.initUI(),this.addEvent(),this.addNotice(),this.map=Utils.MapUtils.generateCommon({npcMovingDura:500,source:MODULE.StormWar,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:void 0,onRequestToMove:function(t,e,i,a){return 0<n.moveCD?(console.log("===== storm ===== 移动CD中 "+n.moveCD),!0):(n.moveCD=STORM_WAR_MOVE_CD,!1)},onTouchTap:function(t,e){Utils.Socket.send("coordinate","SyncCoordinateInfo",{type:MODULE.StormWar,coordinate:{x:t,y:e,z:1}}).then(function(t){})}}),this.gp_map.addChildAt(this.map,0),this.py.GetStormWarInfo(!0),egret.setTimeout(function(){n.py.GetStormWarRank()},this,100)},i.prototype.updateView=function(t){},i.prototype.updateBottom=function(){var i=this,t=this.py.selfPlayer.hangUpIncomeDuration,e=Math.min(Math.floor(t/20),5);this.img_bottom_res.source=0===e?"":"mx_img_jinbidui"+e+"_png";var a=2<e?"common_fbzcbaoxiang":"common_fbzcbaoxiang2";this.chestArmature&&this.chestArmature.armature.name==a||(this.chestArmature&&this.chestArmature.parent.removeChild(this.chestArmature),DragonBoneTools.create(a,function(t){i.chestArmature=t,i.chestArmature.x=i.gp_bottom_res.width/2,i.chestArmature.y=i.gp_bottom_res.height,i.gp_bottom_res.addChild(i.chestArmature),i.chestArmature.animation.play(a)}));var n=this.py.selfPlayer.hangUpIncome;if(this._curResCache){var o=0,r=0,s=0;for(var c in n.some(function(t){var e=i._curResCache[t.code]||0;if(e<t.num)return o=t.type,r=t.code,s=t.num-e,!0})&&Utils.MsgUtils.addRewardMsg({rewards:[[o,r,s]]},this.gp_bottom_res),this._curResCache)delete this._curResCache[c]}else this._curResCache={};n.forEach(function(t){i._curResCache[t.code]=t.num})},i.prototype.beginIdelBattle=function(n){var o=this;function r(t,e,i){t&&t.armature&&(t.animation.play(e),i&&t.once(dragonBones.EgretEvent.LOOP_COMPLETE,function(){i()},this))}function s(t,e){var i=customui.FightPopTipsFactory.create({camp:t?EBattleSide.EBattleSideAttack:EBattleSide.EBattleSideDefence,timeScale:1,content:t?-1:-Utils.MathUtils.getRandomInt(100,1e3),status:0,x:0,y:-100,height:100});e.addChild(i)}new Promise(function(e){switch(n){case 1:var t=o.py.layer;if(t&&t.creeps.length){var i=t.creeps[Utils.MathUtils.getRandomInt(0,t.creeps.length-1)].creepCode,a=h.Config.stormWarCreep()[i];DragonBoneTools.create(a.model,function(t){o.creepArmature=t,o.creepArmature.scaleX=-.5,o.creepArmature.scaleY=.5,o.creepArmature.animation.timeScale=1.2,o.gp_bottom_creepModel.addChild(o.creepArmature),r(o.creepArmature,ROLE_ACTION_NAME.DJ),DragonBoneTools.playOnce({effectName:"common_fbzcguaichuxian",parent:o.gp_bottom_creepModel}),o.creepArmature.alpha=0,egret.Tween.get(o.creepArmature).to({alpha:1},500).wait(500).call(function(){e()})})}break;case 2:case 4:case 6:o.gp_bottom.getChildIndex(o.gp_bottom_roleModel)<o.gp_bottom.getChildIndex(o.gp_bottom_creepModel)&&o.gp_bottom.swapChildren(o.gp_bottom_roleModel,o.gp_bottom_creepModel),egret.Tween.get(o.gp_bottom_roleModel).to({x:475},50).call(function(){r(o.roleArmature,ROLE_ACTION_NAME.GJ,function(){r(o.roleArmature,ROLE_ACTION_NAME.DJ),egret.Tween.get(o.gp_bottom_roleModel).to({x:330},50).call(function(){e()})}),egret.setTimeout(function(){r(o.creepArmature,ROLE_ACTION_NAME.SJ,function(){o.creepArmature.animation.play(ROLE_ACTION_NAME.DJ)}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_1",parent:o.gp_bottom_roleModel,x:150}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_2",parent:o.gp_bottom_creepModel}),s(!1,o.gp_bottom_creepModel)},o,375)});break;case 3:case 5:o.gp_bottom.getChildIndex(o.gp_bottom_roleModel)>o.gp_bottom.getChildIndex(o.gp_bottom_creepModel)&&o.gp_bottom.swapChildren(o.gp_bottom_roleModel,o.gp_bottom_creepModel),egret.Tween.get(o.gp_bottom_creepModel).to({x:485},50).call(function(){r(o.creepArmature,ROLE_ACTION_NAME.GJ,function(){r(o.creepArmature,ROLE_ACTION_NAME.DJ),egret.Tween.get(o.gp_bottom_creepModel).to({x:630},50).call(function(){e()})}),egret.setTimeout(function(){r(o.roleArmature,ROLE_ACTION_NAME.SJ,function(){o.roleArmature.animation.play(ROLE_ACTION_NAME.DJ)}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_1",parent:o.gp_bottom_creepModel,scaleX:-1,x:-150}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_2",parent:o.gp_bottom_roleModel}),s(!0,o.gp_bottom_roleModel)},o,375)});break;case 7:egret.Tween.get(o.gp_bottom_roleModel).to({x:330},50),DragonBoneTools.playOnce({effectName:"common_fbzcguaishiwang",parent:o.gp_bottom_creepModel}),egret.Tween.get(o.creepArmature).to({alpha:0},500).call(function(){o.gp_bottom_creepModel.removeChild(o.creepArmature),o.creepArmature=void 0}).wait(1500).call(function(){n=0,e()})}}).then(function(t){o.beginIdelBattle(++n)})},i.prototype.initUI=function(){this.gp_win.visible=!1;var t=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);this.startDt=t.openTimeDt,this.endDt=t.endTimeDt,this.startTimer(),DragonBoneTools.create("common_fbzcliansheng",function(t){t.anchorOffsetX=0,t.anchorOffsetY=0,t.x=this.gp_win.width/2-34,t.y=this.gp_win.height/2+14,t.animation.play(),this.gp_win.addChildAt(t,10)},this)},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.STORM_WAR_ACHIEVE,this.btn_achievement.getChildAt(0),this,BTN_ICON_NOTICE_POS)},i.prototype.addEvent=function(){var e=this;this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,PopUpManager.addPopUp({obj:new h.HelpDialog({moduleId:MODULE.StormWar})})},this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_REWARD"})},this),this.btn_achievement.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_ACHIEVE"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.py.GetStormWarBattleRecordInfo(function(t){h.AppFacade.getInstance().showSubView(h.StormWarMediator.N,h.StormWarMediator.SV.RECORD,{info:t})})},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.MainJumpConfig.jumpTo()},this),this.gp_bottom_res.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.py.selfPlayer.hangUpIncomeDuration;t&&0<t&&e.py.GetRewards(0,0,function(t){DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:e.gp_bottom_res,doneCB:function(){h.GameMVC.backpackPy.handleClientReward(t.clientReward)}})})},this)},i.prototype.updateLayer=function(){var t=this.py.layer;this.layerCode!=t.layerCode&&(this.layerCode=t.layerCode,this.lastLayerCode||(this.lastLayerCode=this.layerCode),console.log("===== stormWar updateLayer ===== 切换场景"),this.loadMapResConf(this.layerCode,t),this.lastLayerCode=this.layerCode)},i.prototype.updateCreeps=function(){var i=[];this.py.creeps.forEach(function(t){var e=RiskEventType.StormWarCreep;t.remove&&(e=RiskEventType.None),i.push(new h.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "creepCode":'+t.creepCode+', "status":'+t.status+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:t.pos.x,y:t.pos.y},type:e}))}),this.map.updateLayerEvent({events:i});for(var t=this.py.creeps.length-1;0<=t;t--)this.py.creeps[t].remove&&this.py.creeps.splice(t,1);this._idelPlaying||(this._idelPlaying=!0,this.beginIdelBattle(1))},i.prototype.updatePlayers=function(e){var i=this;void 0===e&&(e=!1),this.py.players.forEach(function(t){i.map.updateMapPlayerInfo(t,e)}),this.map.touchChildren=!0,this.map.touchEnabled=!1},i.prototype.removePlayer=function(t){this.map.removeStormWarPlayer(t)},i.prototype.updateSelfPlayer=function(){var t=this.py.selfPlayer,e=t.doubleHit;this.gp_win.visible=0<e,this.blb_win_num.text=""+e,this.lBattleDt=t.lBattleDt,this.updateBottom()},i.prototype.updateWar=function(){var t=this.py.war;t&&t.champion?this.lb_winer.text="S"+t.champion.serverId+"."+t.champion.name:this.lb_winer.text="暂无数据",t&&t.champion&&h.GameMVC.loginPy.serverSelect.area==t.champion.serverId&&h.GameMVC.loginPy.playerProxy.playerInfoVO.playerId==t.champion.playerId?this.map.me.showName(!0):this.map.me.showName(!1),this.map.updateStormChampion(t.champion)},i.prototype.loadMapResConf=function(t,e){var i=this;this.blb_layer.text=""+t,this.blb_layer0.text=""+t,this.map.removeAllStormWarPlayer();var a=void 0,n=void 0,o=e.players;for(var r in o)if(h.GameMVC.loginPy.isSelf(o[r].playerId)){a=o[r].pos.x,n=o[r].pos.y;break}var s=h.Config.stormWarLayer()[Number(t)];this.map.tiled!=s.tiled&&this.map.update({isInit:!0,tiled:s.tiled,theme:s.theme,h:s.long,w:s.wide,meStartTileX:a,meStartTileY:n});var c=this.py.selfPlayer.doubleHit;if(this.lastDoubleHit!=c&&0<c){this.lastDoubleHit=c;var d=1e3;this.lastLayerCode!=this.layerCode&&(d=2500),egret.setTimeout(function(){egret.Tween.get(i.blb_win_num).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:.8,scaleY:.8},100).to({scaleX:1,scaleY:1},100)},this,d)}this.lastLayerCode!=this.layerCode&&(this.lastLayerCode=this.layerCode,egret.setTimeout(function(){egret.setTimeout(function(){i.gp_effect.visible=!0,egret.Tween.get(i.gp_effect).to({scaleX:3,scaleY:3},300).to({scaleX:1.8,scaleY:1.8},300).to({scaleX:2.2,scaleY:2.2,alpha:.4},500).call(function(){i.gp_effect.visible=!1,i.gp_effect.alpha=1})},i,500)},this,2e3))},i.prototype.updateRank=function(){this.gp_ranking.visible=!1,this.gp_empty.visible=!0,this.img_rank1.visible=!1,this.img_rank2.visible=!1,this.img_rank3.visible=!1,this.img_score1.visible=!1,this.img_score2.visible=!1,this.img_score3.visible=!1;var t=this.py.ranks;if(t){var e=t.ranks;Array.isArray(e)&&0<e.length&&(this.gp_ranking.visible=!0,this.gp_empty.visible=!1,e[0]?(this.lb_name1.text="S"+e[0].playerBaseInfo.serverId+"."+e[0].playerBaseInfo.name,this.lb_score1.text=""+e[0].key,this.img_rank1.visible=!0,this.img_score1.visible=!0):(this.lb_name1.text="",this.lb_score1.text=""),e[1]?(this.lb_name2.text="S"+e[1].playerBaseInfo.serverId+"."+e[1].playerBaseInfo.name,this.lb_score2.text=""+e[1].key,this.img_rank2.visible=!0,this.img_score2.visible=!0):(this.lb_name2.text="",this.lb_score2.text=""),e[2]?(this.lb_name3.text="S"+e[2].playerBaseInfo.serverId+"."+e[2].playerBaseInfo.name,this.lb_score3.text=""+e[2].key,this.img_rank3.visible=!0,this.img_score3.visible=!0):(this.lb_name3.text="",this.lb_score3.text=""));var i=t.selfRank;this.lb_my_ranking.text=""+i.rank,this.lb_my_score.text=""+i.key}},i.prototype.onBattleFinish=function(t){},i.prototype.startTimer=function(t,e){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=t||1e3,this.timer.repeatCount=e||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},i.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},i.prototype.timerFunc=function(){var t=Utils.TimerManager.getServerTime(),e=!1;this.lBattleDt&&t-this.lBattleDt<this.StormWarAttackCD&&(e=!0),this.map&&this.map.me&&this.map.me.showState(e);var i=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar),a=Utils.TimerManager.getServerTime(!1),n=this.endDt-a;if(this.pb_time.maximum=this.endDt-this.startDt,this.pb_time.value=n,!i.isOpen)return Utils.MsgUtils.addMidMsg("活动已结束!"),void h.AppFacade.getInstance().sendNotification(CN.STORM_WAR_FORCE_EXIT);this.intervalRank<=0?(this.py.GetStormWarRank(),this.intervalRank=STORM_WAR_UPDATE_RANK):this.intervalRank-=1,0<this.moveCD&&(this.moveCD-=1)},i.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},i);function i(){var t=e.call(this)||this;return t._idelPlaying=!1,t.skinName="StormWarSkin",t.py=h.AppFacade.getInstance().retrieveProxy(h.StormWarProxy.N),t.py.lastLayerCode=0,t.StormWarAttackCD=Number(h.Config.constConfig().StormWarAttackCD.constValue),t.lastDoubleHit=void 0,t.lastLayerCode=void 0,t.intervalRank=STORM_WAR_UPDATE_RANK,t.moveCD=0,t}h.StormWarView=t}(game=game||{});