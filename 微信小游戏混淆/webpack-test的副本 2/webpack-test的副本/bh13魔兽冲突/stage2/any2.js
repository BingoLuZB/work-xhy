var game=window.game;var customui=window.customui;var customui,game,__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(o,s,r,h){return new(r=r||Promise)(function(e,t){function i(e){try{n(h.next(e))}catch(e){t(e)}}function a(e){try{n(h.throw(e))}catch(e){t(e)}}function n(t){t.done?e(t.value):new r(function(e){e(t.value)}).then(i,a)}n((h=h.apply(o,s||[])).next())})},__generator=this&&this.__generator||function(i,a){var n,o,s,e,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[0,s.value]),t[0]){case 0:case 1:s=t;break;case 4:return r.label++,{value:t[1],done:!1};case 5:r.label++,o=t[1],t=[0];continue;case 7:t=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){r=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){r.label=t[1];break}if(6===t[0]&&r.label<s[1]){r.label=s[1],s=t;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(t);break}s[2]&&r.ops.pop(),r.trys.pop();continue}t=a.call(i,r)}catch(e){t=[6,e],o=0}finally{n=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(e){var t=(i.FIGHT_FSM_INIT="FIGHT_FSM_INIT",i.FIGHT_WAIT_INIT_PUSH="FIGHT_WAIT_INIT_PUSH",i.FIGHT_START="FIGHT_START",i.FIGHT_END="FIGHT_END",i.ROUND_START="ROUND_START",i.ROUND_END="ROUND_END",i.SEQ_START="SEQ_START",i.SEQ_END="SEQ_END",i.ATTACK_BEFORE="ATTACK_BEFORE",i.ATTACK_ING="ATTACK_ING",i.ATTACK_AFTER="ATTACK_AFTER",i);function i(){}e.FightState=t;var a=(n.NEXT="NEXT",n.SKIP="SKIP",n.INIT_DONE="INIT_DONE",n.BATTLE_BROADCAST_ARRIVE="BATTLE_BROADCAST_ARRIVE",n.ROUND_ALL_DONE="ROUND_ALL_DONE",n.SEQ_ALL_DONE="SEQ_ALL_DONE",n.FIGHT_ERROR="FIGHT_ERROR",n.RESET_FSM="RESET_FSM",n);function n(){}e.FightAction=a;var o=(s.prototype.createFsm=function(){return{"@initial":t.FIGHT_FSM_INIT,state:[{"@name":t.FIGHT_FSM_INIT,transition:[{"@action":a.INIT_DONE,"@target":t.FIGHT_WAIT_INIT_PUSH},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_WAIT_INIT_PUSH,transition:[{"@action":a.BATTLE_BROADCAST_ARRIVE,"@target":t.FIGHT_START},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_START,transition:[{"@action":a.NEXT,"@target":t.ROUND_START},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_END,transition:[{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ROUND_START,transition:[{"@action":a.NEXT,"@target":t.SEQ_START},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ROUND_END,transition:[{"@action":a.NEXT,"@target":t.ROUND_START},{"@action":a.ROUND_ALL_DONE,"@target":t.FIGHT_END},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.SEQ_START,transition:[{"@action":a.NEXT,"@target":t.ATTACK_BEFORE},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.SEQ_END,transition:[{"@action":a.NEXT,"@target":t.SEQ_START},{"@action":a.SEQ_ALL_DONE,"@target":t.ROUND_END},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_BEFORE,transition:[{"@action":a.NEXT,"@target":t.ATTACK_ING},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_ING,transition:[{"@action":a.NEXT,"@target":t.ATTACK_AFTER},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_AFTER,transition:[{"@action":a.NEXT,"@target":t.SEQ_END},{"@action":a.SKIP,"@target":t.FIGHT_END},{"@action":a.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]}]}},s);function s(){}e.FightFSM=o}(game=game||{}),function(F){var i,e=(i=BaseMediator,__extends(E,i),E.prototype.initSubView=function(){this.addSubView(E.SV.RESULT,F.FightResultPanel),this.addSubView(E.SV.RECORD,F.FightRecordPanel),this.addSubView(E.SV.STATISTICS,F.FightStatistics),this.addSubView(E.SV.ATTRIBUTE_CONTROL,F.AttributeControl),this.addSubView(E.SV.DEEPNEST_RESULT,F.DeepNestResultPanel),this.addSubView(E.SV.DUNGEON_RESULT,F.DungeonResultPanel),this.addSubView(E.SV.STORMWAR_RESULT,F.StormWarResultPanel),this.addSubView(E.SV.GLORYARENA_RESULT,F.GloryArenaFightResultPanel)},Object.defineProperty(E.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),E.prototype.listNotificationInterests=function(){return[puremvc.statemachine.StateMachine.CHANGED,CN.FIGHT_REQ_ANY_FIGHT,CN.FIGHT_OPEN_FIGHT,CN.FIGHT_CLOSE_FIGHT,CN.FIGHT_SPEED_UPDATE,CN.FIGHT_SKIP_FIGHT,CN.HIDE_ALL_SUBVIEW,CN.FIGHT_PZ,CN.FIGHT_FIGHT_UPDATE_UI,CN.FIGHT_MODEL_CREATED,CN.FIGHT_PAUSE,CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST,CN.FIGHT_LET_OBJ_RELEASE_SKILL,CN.FIGHT_CHANGE_ALL_MODEL,CN.FIGHT_SHOW_RESULT,CN.FIGHT_TEAM_RECORD_PLAYBACK,CN.ZZQ_STATUS_FIGHT_DAOJISHI,SocketConst.SOCKET_CONNECT,SocketConst.SOCKET_RECONNECT]},E.prototype.handleNotification=function(e){var i=this;switch(e.getName()){case puremvc.statemachine.StateMachine.CHANGED:var t=e.getBody().name;this.curFSMState=t,this.onFSMUpdate(t);break;case CN.FIGHT_REQ_ANY_FIGHT:if(this.fightPy.isInFight&&!this.fightPy.dailyFakeFight)return void this.log("其他战斗正在进行，暂时无法开始新的战斗");this.hideSubView(E.SV.RESULT);var a=e.getBody();this.fightPy.fightType=a.type,this.fightPy.reqFightParams=a,this.fightPy.fightType==EBattleType.EBattleTypeWchess?F.GameMVC.zzqPy.debug_slowFight?Utils.TimerManager.setTimeScaleExtra(1):Utils.TimerManager.setTimeScaleExtra(3):Utils.TimerManager.setTimeScaleExtra(1),this.fightPy.curLayerTheme={bg:this.fightPy.reqFightParams.bg,bgm:this.fightPy.reqFightParams.bgm},this.fightPy.reqFight(),this.fightPy.reqFightParams.isPassive&&this.fightPy.reqFightParams.preloadCB&&this.fightPy.reqFightParams.preloadCB();break;case CN.FIGHT_OPEN_FIGHT:GameRootLayer.gameLayer().switchMenLoading(!0,function(){i.openFight()},"UNTIL_FIGHT_LOADED"),Utils.TimerManager.setTimeScale(this.fightPy.timeScale);break;case CN.FIGHT_CLOSE_FIGHT:this.closeFight();break;case CN.FIGHT_MODEL_CREATED:this.queueFightModelInit.splice(this.queueFightModelInit.indexOf(e.getBody()),1),0==this.queueFightModelInit.length&&this.curFSMState==F.FightState.FIGHT_START&&(this.fightPy.reqFightParams.testSkill?Utils.MsgUtils.addMidMsg("技能测试模式"):(this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),this.fightTools.resortZOrder()));break;case CN.HIDE_ALL_SUBVIEW:break;case CN.FIGHT_SPEED_UPDATE:for(var n in Utils.TimerManager.setTimeScale(this.fightPy.timeScale),this.fightTools.updateTimeScale(),this.id2FightModel)this.id2FightModel[n].updataSpeed();break;case CN.FIGHT_FIGHT_UPDATE_UI:this.updateUI(e.getBody());break;case CN.FIGHT_SKIP_FIGHT:var o=e.getBody();this.ignoreResult=o&&o.ignoreResult,this.curFSMState==F.FightState.FIGHT_END?this.closeFight():this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.SKIP);break;case CN.FIGHT_PZ:var s=e.getBody();this.updateUI({pz:s&&s.pz});break;case CN.FIGHT_PAUSE:this.isPause=!this.isPause,this.isPause||this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT);break;case CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST:this.testInputPanel?(PopUpManager.removePopUp(this.testInputPanel,0),this.testInputPanel=null):(this.testInputPanel=new F.FightTestInput(e.getBody()),PopUpManager.addPopUp({obj:this.testInputPanel,clickDarkClose:!1,effectType:0}));break;case CN.FIGHT_LET_OBJ_RELEASE_SKILL:var r=e.getBody();if(!r)return;for(var h=this.id2FightModel[r.id],l=[],c={},d={},p=0,g=r.tIds;p<g.length;p++)d[n=g[p]]?d[n]++:d[n]=1,c[n]||(l.push(this.id2FightModel[n]),c[n]=!0),this.id2FightModel[n].pushCurOnAttackFrame(new F.FightVO.SBattleRes({value:-1,state:[1,2,4][Utils.MathUtils.getRandomInt(0,2)],buffAdd:[],buffRemove:[]}));h.releaseSkill(r.skill,l,r.cb,function(){},void 0,d);break;case CN.FIGHT_SHOW_RESULT:this.showResult();break;case SocketConst.SOCKET_RECONNECT:this.fightPy.isInFight&&F.AppFacade.getInstance().sendNotification(CN.FIGHT_SKIP_FIGHT);break;case CN.ZZQ_STATUS_FIGHT_DAOJISHI:if(this.fightPy.isInFight&&this.fightPy.fightType==EBattleType.EBattleTypeWchess){var u=e.getBody();Utils.MsgUtils.addMidMsg("下回合战斗于"+u+"后开始")}break;case CN.FIGHT_CHANGE_ALL_MODEL:var f=e.getBody();if(!f)return;for(var n in this.id2FightModel)(h=this.id2FightModel[n])&&h.parent&&h.parent.removeChild(h);this.id2FightModel={};var m=void 0,y=void 0,_=!1,v=F.Config.skillBaseConfig(),T=F.Config.allHeroConfig();if(f.modelFixed)y=41000001,F.Config.allHeroConfig()[41000001].model=f.modelFixed,_=!0;else do{for(var n in v)if(v[n].modelId==f.model)for(var C in m=n,T)if(T[C].actSkill==m||T[C].normalSkill==m){y=Number(C);break}if(!m){Utils.MsgUtils.addMidMsg("找不到skillId");break}if(!y){Utils.MsgUtils.addMidMsg("找不到tarCode");break}_=!0}while(0);_||(y=41010040,Utils.MsgUtils.addMidMsg("使用临时模型")),this.fightPy.sBattleResultVO.teams.forEach(function(t,e){t.entities.forEach(function(e){e.code=y,e.dermaCode=void 0,i.queueFightModelInit.push(e.entityId),i.id2FightModel[e.entityId]=i.fightTools.createFightObj({entity:e,camp:t.camp}),i.rootView.gp_battle.addChild(i.id2FightModel[e.entityId])})}),this.fightTools.resortZOrder();break;case CN.FIGHT_TEAM_RECORD_PLAYBACK:}},E.prototype.onFSMUpdate=function(O){return __awaiter(this,void 0,void 0,function(){var a,t,i,n,o,s,r,h,l,c,d,p,g,u,f,m,y,_,v,T,C,E,I,b,R,P,k,A,w,S,M,x,N,B=this;return __generator(this,function(e){switch(e.label){case 0:if(this.log("=onFSMUpdate====>"+O),this.isPause)return[2];switch(O){case F.FightState.FIGHT_WAIT_INIT_PUSH:return[3,1];case F.FightState.FIGHT_START:return[3,2];case F.FightState.FIGHT_END:return[3,3];case F.FightState.ROUND_START:return[3,4];case F.FightState.ROUND_END:return[3,5];case F.FightState.SEQ_START:return[3,9];case F.FightState.SEQ_END:return[3,10];case F.FightState.ATTACK_BEFORE:return[3,11];case F.FightState.ATTACK_ING:return[3,12];case F.FightState.ATTACK_AFTER:return[3,13]}return[3,14];case 1:return GameRootLayer.gameLayer().switchCloudLoading(!1),this.rootView.updateUI(void 0,!0),[3,14];case 2:for(this.rootView.updateUI({updateTeam:!0}),this.curFightUuid=this.fightPy.battleInfo.uuid,a=!1,this.fightPy.sBattleResultVO.teams.forEach(function(t,e){if(B.camp2PlayerId[t.camp]=t.playerId,!B.leftCamp&&t.playerId&&t.playerId==B.playerProxy.playerInfoVO.playerId&&(B.leftCamp=t.camp),t.magical&&t.magical.entityId){var i=t.magical;B.queueFightModelInit.push(i.entityId),B.id2FightModel[i.entityId]=B.fightTools.createFightObj({entity:i,camp:t.camp}),B.rootView.gp_battle.addChild(B.id2FightModel[i.entityId])}t.entities.forEach(function(e){a=!0,B.queueFightModelInit.push(e.entityId),B.id2FightModel[e.entityId]=B.fightTools.createFightObj({entity:e,camp:t.camp}),B.rootView.gp_battle.addChild(B.id2FightModel[e.entityId])})}),a||this.sendNotification(CN.FIGHT_SKIP_FIGHT),this.leftCamp||(this.leftCamp=EBattleSide.EBattleSideAttack),t=0,i=this.fightPy.sBattleResultVO.teams;t<i.length;t++)if((n=i[t]).camp==this.leftCamp){n.magical&&n.magical.entityId&&(this.id2FightModel[n.magical.entityId].isLeftCamp=!0,this.updateUI({anger:n.magical.anger,angerMax:n.magical.angerMax}));break}return[3,14];case 3:for(N in this.id2FightModel)(d=this.id2FightModel[N])&&d.parent&&d.parent.removeChild(d);return this.id2FightModel={},this.rootView.reset(),this.reset(),this.curDelayCallSchId&&(egret.clearTimeout(this.curDelayCallSchId),this.curDelayCallSchId=null),this.sendNotification(CN.FIGHT_SHOW_RESULT),[3,14];case 4:return this.fightPy.round?(o=function(){return __awaiter(B,void 0,void 0,function(){var t,i,a,n,o;return __generator(this,function(e){switch(e.label){case 0:for(this.updateUI({round:!0}),t=!1,i=0,a=this.fightPy.round.beforeBattleRes;i<a.length;i++)n=a[i],(o=this.id2FightModel[n.entityId])&&o.handleSeqBattleRes(n,F.FightState.ROUND_START),t=!0;return t?[4,this.holdOn(100)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[2]}})})},1==this.fightPy.round.roundNum&&F.GameMVC.guajiPy.tempData&&!F.GameMVC.guajiPy.tempData.showed?(F.GameMVC.guajiPy.tempData.showed=!0,s=F.GameMVC.guajiPy.tempData.eventId,r=F.Config.riskCreep()[s],(h=r&&r.heroShowID)?PopUpManager.addPopUp({obj:new F.FightBossDescView({id:h}),closeCB:o}):o()):o(),[3,14]):(this.log("回合数为0"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.SKIP),[2]);case 5:return 0<this.fightPy.round.afterBattleRes.length?[4,this.holdOn(100)]:[3,8];case 6:for(e.sent(),this.log("处理afterBattleRes"),l=0,c=this.fightPy.round.afterBattleRes;l<c.length;l++)b=c[l],(d=this.id2FightModel[b.entityId])&&d.handleSeqBattleRes(b,F.FightState.ROUND_END);return[4,this.holdOn(100)];case 7:e.sent(),e.label=8;case 8:return this.fightPy.nextRound()?this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT):this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.ROUND_ALL_DONE),[3,14];case 9:return this.seqAttack=this.fightPy.seqAttack,this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[3,14];case 10:return this.seqAttack=this.fightPy.changeNextSeqAttack(),this.seqAttack?this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT):this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.SEQ_ALL_DONE),[3,14];case 11:return this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[3,14];case 12:if(!this.seqAttack)return egret.warn("战 该回合没有人出手"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[2];if(!(d=this.id2FightModel[this.seqAttack.entityId]))return egret.warn("战 施法者已经不在了",this.seqAttack.entityId,this.fightPy.round),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[2];for(p=[],g={},u={},f=[],m={},v=_=y=0,T=this.seqAttack.seqBattleEffect;v<T.length;v++)for(C=T[v],y+=C.sockBlood,_-=C.antiInjury,E=0,I=C.seqBattleRes;E<I.length;E++)b=I[E],(R=this.id2FightModel[b.entityId])?(b.skillId==this.seqAttack.skillId?(g[b.entityId]=R,-1==p.indexOf(R)&&p.push(R),u[b.entityId]?u[b.entityId]++:u[b.entityId]=1):m[b.entityId]=R,R.pushCurOnAttackFrame(b)):egret.warn("当前模型已经不在了",b.entityId);for(P in m)f.push(m[P]);if(k=this.fightPy.curFightId,A=this.fightPy.nextSeqAttack,this.seqAttack.skillId&&0<p.length)this.log("战 出手",d.curEntity.entityId,this.seqAttack.skillId,p.length),d.releaseSkill(this.seqAttack.skillId,p,function(){B.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT)},function(){if(!B.checkFightInvalid(k))if(B.seqAttack){for(var e=0,t=f;e<t.length;e++)t[e].onAttackFrame();var i=B.id2FightModel[B.seqAttack.entityId];i&&(i.popSth(y),i.popSth(_),i.updateEntity({life:B.seqAttack.life,anger:B.seqAttack.anger}),i.handleBuff([],B.seqAttack.buffRemove,F.FightState.SEQ_END))}else egret.warn("出手后this.seqAttack没了")},A&&A.entityId==this.seqAttack.entityId&&A.combo,u);else{if(egret.warn("战 没有技能id或者没有受击者",this.seqAttack.skillId,p.length),(w=F.Config.skillBaseConfig()[this.seqAttack.skillId])&&w.forceAction)for(egret.log("强制播放onAttackFrame"),S=0,M=f;S<M.length;S++)M[S].onAttackFrame();(x=this.id2FightModel[this.seqAttack.entityId])&&(x.popSth(y),x.updateEntity({life:this.seqAttack.life,anger:this.seqAttack.anger}),x.handleBuff([],this.seqAttack.buffRemove,F.FightState.SEQ_END)),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT)}return[3,14];case 13:if(!this.seqAttack||!this.seqAttack.entityId)return egret.warn("战 该回合没有人出手或者神兵放技能了"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[2];for(N in this.id2FightModel)this.id2FightModel[N].handleDead(F.FightState.ATTACK_AFTER);return this.seqAttack.p||this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.NEXT),[3,14];case 14:return[2]}})})},E.prototype.initFSM=function(){var e=(new F.FightFSM).createFsm(),t=new puremvc.statemachine.FSMInjector(e);t.initializeNotifier(F.AppFacade.getInstance().multitonKey),t.inject()},E.prototype.getRes=function(e){RES.hasRes(e+"_skeleton_dbbin")?this.preloadResDict[e+"_skeleton_dbbin"]=1:this.preloadResDict[e+"_ske_dbbin"]=1,RES.hasRes(e+"_texture_json")?this.preloadResDict[e+"_texture_json"]=1:this.preloadResDict[e+"_tex_json"]=1,RES.hasRes(e+"_texture_png")?this.preloadResDict[e+"_texture_png"]=1:this.preloadResDict[e+"_tex_png"]=1},E.prototype.openFight=function(){var s=this;DragonBoneTools.removeAllNotStageDB(),this.preloadResDict={},this.fightPy.curLayerTheme.bg&&(this.preloadResDict[this.fightPy.curLayerTheme.bg]=1),this.fightPy.curLayerTheme.bgm&&(this.preloadResDict[this.fightPy.curLayerTheme.bgm]=1);var e={},t={};if(this.fightPy.fightType!=EBattleType.EBattleTypeWchess){for(var i in this.fightPy.battleEntityDetail){var a=this.fightPy.battleEntityDetail[i],n=void 0;if(a.code)if(a.type){var o=(n=this.fightPy.getConfigByFightEntity(a)).model;if(a.dermaCode){e[a.entityId]=a.dermaCode;var r=F.Config.getHeroDermaConfig(a.dermaCode);r&&(o=r.model)}this.getRes(o),t[o]=1}else n=F.Config.allMagicalConfig()[a.code],this.preloadResDict[ResourceUtils.png(n.model)]=1}for(var h=0,l=this.fightPy.battleInfo.rounds;h<l.length;h++)for(var c=0,d=l[h].seqAttack;c<d.length;c++){var p=d[c],g=F.Config.skillBaseConfig()[p.skillId];if(g&&g.modelId){var u=g.modelId;e[p.entityId]&&g.dermaModelId&&(n=F.Config.getHeroDermaConfig(e[p.entityId]))&&(u=JSON.parse(g.dermaModelId)[n.index-1]);var f=F.Config.skillConfig()[u];if(f){if(f.effectQP)for(var m=0,y=f.effectQP;m<y.length;m++){var _=y[m];this.getRes(_.src[0]),t[_.src[0]]=1,_.piaEffect&&(this.getRes(_.piaEffect.src),t[_.piaEffect.src]=1)}if(f.effectSrc)for(var v=0,T=f.effectSrc;v<T.length;v++)for(var C=0,E=(_=T[v]).src;C<E.length;C++){var I=E[C];this.getRes(I),t[I]=1}if(f.effectsTar)for(var b=0,R=f.effectsTar;b<R.length;b++)for(var P=0,k=(_=R[b]).src;P<k.length;P++)I=k[P],this.getRes(I),t[I]=1;if(f.effectsTarPia)for(var A=0,w=f.effectsTarPia;A<w.length;A++)for(var S=0,M=(_=w[A]).src;S<M.length;S++)I=M[S],this.getRes(I),t[I]=1}}}for(var x in this.preloadResDict)x&&!RES.getRes(x)||delete this.preloadResDict[x]}var N=Object.keys(this.preloadResDict);RES.createGroup("fight_cur",N,!0);var B=["fight_cur"];RES.isGroupLoaded("fight")||B.push("fight");var O=Object.keys(t);this.log("当前需要加载的资源",B),this.log("当前需要加载的资源",N),this.log("当前需要预处理的模型",O),this.preloadRes(B,function(){s.addRootView(F.FightUI),s.fightTools.bindView(s.rootView.gp_battle,s.rootView.gp_battle_up);var t=O.length;if(0<t){function e(e){t<=a?s.fu_mgr.insert({delayFrame:a,waitFrame:0,cb:function(){DragonBoneTools.preload(e),GameRootLayer.gameLayer().loadingUI&&GameRootLayer.gameLayer().loadingUI.setProgress(++i,t),GameRootLayer.gameLayer().switchMenLoading(!1,function(){Utils.SoundManager.playBg(SOUND_BGM_TYPE.zhan_dou),s.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),s.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.INIT_DONE),s.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.BATTLE_BROADCAST_ARRIVE)},"UNTIL_FIGHT_LOADED")},params:void 0}):s.fu_mgr.insert({delayFrame:a,waitFrame:0,cb:function(){DragonBoneTools.preload(e),GameRootLayer.gameLayer().loadingUI&&GameRootLayer.gameLayer().loadingUI.setProgress(++i,t)},params:void 0}),a++}for(var i=0,a=1,n=0,o=O;n<o.length;n++)e(o[n])}else GameRootLayer.gameLayer().switchMenLoading(!1,function(){Utils.SoundManager.playBg(SOUND_BGM_TYPE.zhan_dou),s.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),s.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.INIT_DONE),s.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.BATTLE_BROADCAST_ARRIVE)},"UNTIL_FIGHT_LOADED")})},E.prototype.resumeFight=function(){this.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),this.rootView.visible=!0},E.prototype.showResult=function(){var t=this;this.ignoreResult?(this.closeFight(),this.fightPy.playbackResult=void 0):this.fightPy.fightType==EBattleType.EBattleTypeWchess?this.proxy.latestFightStatis?F.AppFacade.getInstance().showSubView(F.ZzqMediator.N,F.ZzqMediator.SV.STATISTICS,{resultData:this.proxy.latestFightStatis,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}}):(this.closeFight(),this.fightPy.playbackResult=void 0):this.fightPy.fightType==EBattleType.EBattleTypeCardGame?F.AppFacade.getInstance().showSubView(F.HoldemMed.N,F.HoldemMed.SV.STATISTICS,{resultData:this.fightPy.sBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}}):this.fightPy.fightType==EBattleType.EBattleTypeAbyssLair&&0==this.fightPy.multiFightOriginPushs.length?(egret.log("深渊巢穴战斗，且当前已经是最后一场"),this.showSubView(E.SV.DEEPNEST_RESULT,{info:this.fightPy.sFinalBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}})):this.fightPy.fightType==EBattleType.EBattleTypeVestage&&this.fightPy.sBattleResultVO.vestageRecords?(egret.log("守护者遗迹战斗，且已经gg了"),this.showSubView(E.SV.DUNGEON_RESULT,{clickDarkClose:!1,info:this.fightPy.sBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}})):this.fightPy.fightType==EBattleType.EBattleTypeStormWar&&this.stormWarProxy.challengeResultInfo?(egret.log("风暴战场战斗结束"),this.showSubView(E.SV.STORMWAR_RESULT,{info:this.fightPy.sBattleResultVO,doneCB:function(){var e=t.stormWarProxy.challengeResultInfo.result;t.closeFight(),t.sendNotification(CN.STORM_WAR_BATTLE_FINISH,{result:e}),t.fightPy.playbackResult=void 0}})):this.fightPy.fightType==EBattleType.EBattleTypeGloryArena?(egret.log("荣耀竞技场"),this.showSubView(E.SV.GLORYARENA_RESULT,{info:this.fightPy.sFinalBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}})):this.showSubView(E.SV.RESULT,{customParams:this.fightPy.reqFightParams.customParams,result:this.fightPy.sBattleResultVO.result,resultVo:this.fightPy.sBattleResultVO,sClientReward:this.fightPy.sBattleResultVO.clientReward,normalRewards:this.fightPy.sBattleResultVO.normalRewards,extRewards:this.fightPy.sBattleResultVO.extRewards,hurt:this.fightPy.sBattleResultVO.hurt,star:this.fightPy.sBattleResultVO.star,battleType:this.fightPy.sBattleResultVO.battleType,clickDarkClose:!(this.fightPy.sBattleResultVO.battleType==EBattleType.EBattleTypeTeamArena&&3==this.fightPy.sFinalBattleResultVO.totalC),autoClose:this.fightPy.reqFightParams.autoClose,doneCB:function(){(t.fightPy.sBattleResultVO.battleType==EBattleType.EBattleTypeDailyFortress||t.fightPy.sBattleResultVO.battleType==EBattleType.EBattleTypeHeroChallenge2)&&t.fightPy.dailyFakeFight||(t.closeFight(),t.fightPy.playbackResult=void 0)}})},E.prototype.closeFight=function(){DragonBoneTools.manualClean(),this.queueFightModelInit.splice(0),this.fightPy.fightPreEnd(),this.rootView&&this.rootView.updateUI(void 0,!0),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.RESET_FSM),this.updateUI({focusReset:!0}),this.ignoreResult=void 0,0<this.fightPy.multiFightOriginPushs.length?(this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,F.FightAction.INIT_DONE),this.fightPy.respBattleResultP(this.fightPy.multiFightOriginPushs.shift(),!0)):(this.disMissFight(),this.fightPy.fightEnd())},E.prototype.disMissFight=function(){this.removeFromParent(),"FIGHT"==F.MainJumpConfig.getCurEvent()&&F.MainJumpConfig.jumpTo(),this.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!1}),Utils.TimerManager.setTimeScale(1)},E.prototype.updateUI=function(e,t){this.rootView&&this.rootView.updateUI(e,t)},E.prototype.checkFightInvalid=function(e){return e!=this.fightPy.curFightId},E.prototype.holdOn=function(a,n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){i.curDelayCallSchId=egret.setTimeout(function(){i.fightPy.isInFight&&(n&&n(),e())},i,a/i.fightPy.timeScale)})]})})},E.prototype.reset=function(){this.seqAttack=void 0,this.id2FightModel={},this.camp2PlayerId={},this.leftCamp=void 0},E.prototype.getFightModelById=function(e){return this.id2FightModel[e]},E.N="FightMediator",E.SV={RESULT:2,RECORD:3,STATISTICS:4,ATTRIBUTE_CONTROL:5,DEEPNEST_RESULT:6,DUNGEON_RESULT:7,STORMWAR_RESULT:8,GLORYARENA_RESULT:9},E);function E(e){void 0===e&&(e=null);var t=i.call(this,E.N,e)||this;return t.fightPy=F.AppFacade.getInstance().retrieveProxy(F.FightPy.N),t.playerProxy=F.AppFacade.getInstance().retrieveProxy(F.PlayerPy.N),t.camp2PlayerId={},t.queueFightModelInit=[],t.preloadResDict={},t.proxy=F.AppFacade.getInstance().retrieveProxy(F.ZzqPy.N),t.stormWarProxy=F.AppFacade.getInstance().retrieveProxy(F.StormWarProxy.N),t.fu_mgr=FrameUpdateMgr.getInstance(),FIGHT_CONST.DEBUG_GLOBAL_MEDIATOR&&(window._c=t),t.reset(),t.fightTools=F.FightTools.getInstance(),t.initFSM(),t}F.FightMediator=e}(game=game||{}),function(l){var e=(t.registerAll=function(){(new a).register(),(new s).register()},t);function t(){}l.FightProcessor=e;var i,a=(i=l.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).respBattleInfoP(e.getBody().battleInfo)},n);function n(){return i.call(this,"battle.SBattleInfoP",n)||this}var o,s=(o=l.ProcessorBase,__extends(r,o),r.prototype.execute=function(e){var t=l.AppFacade.getInstance().retrieveProxy(l.FightPy.N),i=t.getGuideFightParams();if(i&&i.fakeBroadcast){var a=JSON.parse(i.fakeBroadcast);t.respBattleResultP(a)}else{var n=e.getBody();if(t.dailyFakeFight)return void t.respBattleResultP(n);if(n.battleType==EBattleType.EBattleTypeTeamExpedition&&(Number(l.MainJumpConfig.getCurEvent())!=MODULE.TeamExpedition||GameRootLayer.gameLayer().isMiWuShow))return void egret.log("条件不允许，不需要播放战斗");if(n.battleType==EBattleType.EBattleTypeStormWar&&(Number(l.MainJumpConfig.getCurEvent())!=MODULE.StormWar||GameRootLayer.gameLayer().isMenShow))return void egret.log("条件不允许，不需要播放战斗");var o=void 0,s=void 0,r=void 0;if(n.battleType==EBattleType.EBattleTypeRisk){var h=l.GameMVC.guajiPy;o=h.curLayerTheme.bgm,s=h.curLayerTheme.bg,h.tempData&&h.tempData.config&&(r=function(e){if(h.tempData&&h.tempData.config){var t=e.result==EBattleResult.EBattleResultWin?0:1;h.tempData.order=t;var i={config:h.tempData.config,rewards:h.tempData.rewards,order:t};PopUpManager.addPopUp({obj:new l.BaseEpRewardView(i),closeCB:function(){l.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)}}),h.tempData=void 0}})}t.reqFightParams?(egret.log("处理主动战斗"),t.respBattleResultP(n)):(egret.log("处理被动战斗"),l.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:n.battleType,bgm:o,bg:s,customParams:{},isPassive:!0,preloadCB:function(){t.respBattleResultP(n)},doneCB:r}))}},r);function r(){return o.call(this,"battle.SBattleResultP",r)||this}}(game=game||{}),function(c){var t,e=(t=BaseProxy,__extends(a,t),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale=e,c.AppFacade.getInstance().sendNotification(CN.FIGHT_SPEED_UPDATE)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isInFight",{get:function(){return this._isInFight},set:function(e){e!=this._isInFight&&this.onInFightChangeUpdate(e)},enumerable:!0,configurable:!0}),a.prototype.getGuideFightParams=function(){return this.reqFightParams&&this.reqFightParams.guideFightParams},a.prototype.getCustomParams=function(){return this.reqFightParams&&this.reqFightParams.customParams},a.prototype.handleException=function(e,t){e||Utils.MsgUtils.addErrMsg(void 0,t),this.battleInfoVO.uuid||c.AppFacade.getInstance().sendNotification(CN.FIGHT_CLOSE_FIGHT),this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0)},a.prototype.reqFight=function(){var t=this;this.isInFight=!0,this.delayCBAfterFightExit.filter(function(e){return e.beforeFightReq}),this.reqFightParams?(this.addDelayCBAfterFightExit(this.reqFightParams.doneCB,this.reqFightParams.pb1),this.curFightId=c.GameMgr.getInstance().serverTime(),this.reqFightParams.isPassive||this.reqFightParams.pb1&&this.reqFightParams.pb2?(this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0),this.timeoutScheId=egret.setTimeout(function(){t.handleException(void 0,"战斗请求超时")},this,this.timeout),this.reqFightParams.isPassive||Utils.Socket.send(this.reqFightParams.pb1,this.reqFightParams.pb2,this.reqFightParams.params).then(function(e){e?(t.reqFightParams.reqCB&&t.reqFightParams.reqCB(e),t.lastsFinalBattleResultVO.cbRet=e):t.handleException(void 0,"战斗callback没有内容")}).catch(function(e){t.handleException(e)})):this.fightType!=EBattleType.EBattleTypeTest&&this.handleException(void 0,"缺少pb1或pb2有误"),this.log("战斗py已就绪")):this.handleException(void 0,"输入参数有误")},a.prototype.respBattleResultP=function(e,t){if(void 0===t&&(t=!1),!t&&this.battleInfoVO.uuid)return this.log("当前还有战斗没播完，多重战斗"),0<this.multiFightOriginPushs.length&&e.battleType!=this.multiFightOriginPushs[0].battleType?void this.log("该战斗跟当前堆积的战报不是同一战斗类型，跳过处理",e.battleType,this.multiFightOriginPushs[0].battleType):(this.multiFightOriginPushs.push(e),void(this.dailyFakeFight&&(c.AppFacade.getInstance().sendNotification(CN.FIGHT_CLOSE_FIGHT),this.dailyFakeFight=!1)));this.log("respBattleInfoP=====>",e),Utils.agentConfig.IsDebug&&this.log("战报头",JSON.stringify(e)),this.reqFightParams?(this.isTestFight()&&this.reqFightParams.needCopy&&Utils.SDKMgr.copyToClipBoard(JSON.stringify(e),function(e){"success"==e?Utils.MsgUtils.addMidMsg("复制成功"):Utils.MsgUtils.addMidMsg("复制失败")}),this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0),this.sBattleResultVO?this.sBattleResultVO.update(e):this.sBattleResultVO=new c.FightVO.SBattleResult(e),this.sFinalBattleResultVO.sum(e),this.sBattleResultVO.escaped?this.sendNotification(CN.FIGHT_SHOW_RESULT):this.respBattleInfoP(e.battleInfo,!0,t)):this.log("reqFightParams丢失跳过播放")},a.prototype.respBattleInfoP=function(e,t,i){var a=this;if(void 0===t&&(t=!1),void 0===i&&(i=!1),t)this.battleInfoVO.update(e,i),this.sBattleResultVO.teams.forEach(function(e){a.battleEntityDetail[e.magical.entityId]=e.magical,e.entities.forEach(function(e){a.battleEntityDetail[e.entityId]=e}),a.fightType==EBattleType.EBattleTypeWchess?a.positionTypes[e.camp]=PositionType.Chess8V8:FIGHT_CONST.FIGHT_POS[e.positionType]&&e.entities.length!=FIGHT_CONST.FIGHT_POS[e.positionType][e.camp].length-1?a.positionTypes[e.camp]=PositionType.Normal:a.positionTypes[e.camp]=e.positionType||PositionType.Normal}),i?c.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_FIGHT):c.MainJumpConfig.jumpTo("FIGHT");else if(this.battleInfo.uuid==e.uuid)Utils.agentConfig.IsDebug&&this.log("战报拼接",JSON.stringify(e)),this.battleInfo.pushRounds(e);else for(var n=0,o=this.multiFightOriginPushs;n<o.length;n++){var s=o[n];if(s.battleInfo.uuid==e.uuid){if(Array.isArray(e.rounds))for(var r=0,h=e.rounds;r<h.length;r++){var l=h[r];s.battleInfo.rounds.push(l)}break}}},Object.defineProperty(a.prototype,"seqAttack",{get:function(){return this.round.seqAttack[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"nextSeqAttack",{get:function(){return this.round.seqAttack[1]},enumerable:!0,configurable:!0}),a.prototype.changeNextSeqAttack=function(){return this.round.seqAttack.shift(),this.seqAttack},Object.defineProperty(a.prototype,"round",{get:function(){return this.battleInfo.rounds[0]},enumerable:!0,configurable:!0}),a.prototype.nextRound=function(){return this.battleInfo.rounds.shift(),this.round},Object.defineProperty(a.prototype,"battleInfo",{get:function(){return this.battleInfoVO},enumerable:!0,configurable:!0}),a.prototype.isTestFight=function(){return this.fightType===EBattleType.EBattleTypeTest},a.prototype.addDelayCBAfterFightExit=function(e,t,i,a){if(void 0===i&&(i=0),void 0===a&&(a=!1),e){for(var n=0,o=this.delayCBAfterFightExit;n<o.length;n++)if(o[n].source==t)return;a||this._isInFight||0<this.delayCBAfterFightExit.length?(this.delayCBAfterFightExit.push({order:i,cb:e,source:t,beforeFightReq:a}),this.delayCBAfterFightExit.sort(function(e,t){return t.order-e.order})):e()}},a.prototype.queueExceExitCB=function(){if(0!=this.delayCBAfterFightExit.length)try{var e=this.delayCBAfterFightExit.shift();e.cb&&e.cb(this.lastsFinalBattleResultVO)}catch(e){egret.error("queueExceExitCB exception",e)}},a.prototype.reset=function(){this.sendNotification(CN.FIGHT_ALL_DONE_AND_EXIT,{type:this.reqFightParams&&this.reqFightParams.type,result:this.sBattleResultVO&&this.sBattleResultVO.result}),this.isInFight=!1,this.reqFightParams=void 0,this.battleEntityDetail={},this.sFinalBattleResultVO.reset()},a.prototype.fightPreEnd=function(){this.battleInfoVO.reset()},a.prototype.fightEnd=function(){this.isInFight=!1;try{if(this.sBattleResultVO&&(this.fightType!=EBattleType.EBattleTypeTest&&this.sBattleResultVO.result===EBattleResult.EBattleResultWin?Utils.Socket.send("battle","BattleEnd",{battleType:this.fightType}).then(function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shengli)}):this.fightType==EBattleType.EBattleTypeStormWar&&this.sBattleResultVO.result===EBattleResult.EBattleResultLose?Utils.Socket.send("battle","BattleEnd",{battleType:this.fightType}).then(function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shibai)}):Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shibai),this.getGuideFightParams()&&this.getGuideFightParams().jumpToMoudleByCode)){var e=this.getGuideFightParams().jumpToMoudleByCode;c.MainJumpConfig.jumpTo(e)}}catch(e){console.error("战斗结束后的回调报错",e)}this.lastsFinalBattleResultVO.winC=this.sFinalBattleResultVO.winC,this.lastsFinalBattleResultVO.battleType=this.sFinalBattleResultVO.battleType,this.lastsFinalBattleResultVO.hurt=this.sFinalBattleResultVO.hurt,this.lastsFinalBattleResultVO.totalC=this.sFinalBattleResultVO.totalC,this.lastsFinalBattleResultVO.star=this.sFinalBattleResultVO.star,this.lastsFinalBattleResultVO.clientReward=JSON.parse(JSON.stringify(this.sFinalBattleResultVO.clientReward)),this.reset(),this.queueExceExitCB()},a.prototype.onInFightChangeUpdate=function(e){this._isInFight=e,this.sendNotification(CN.FIGHT_FIGHT_STATUS_SWITCH,{isInFight:e})},a.prototype.BattlePlayBack=function(t,i){if(!Array.isArray(t))try{t=JSON.parse(t)}catch(e){t=[t]}i&&i.moduleId==MODULE.TeamArena&&c.AppFacade.getInstance().sendNotification(CN.FIGHT_TEAM_RECORD_PLAYBACK,i.data),i&&i.doneCB?c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleBack,pb1:"battle",pb2:"BattlePlayBack",params:{uuids:t},doneCB:function(e){i.doneCB(),c.AppFacade.getInstance().retrieveProxy(a.N).queueExceExitCB()}}):c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleBack,pb1:"battle",pb2:"BattlePlayBack",params:{uuids:t}})},a.prototype.CommonFightRecord=function(e,t,i,a){Utils.Socket.send(e,t,{}).then(function(e){a&&a(e[i])})},a.prototype.getConfigByFightEntity=function(e){var t=void 0;return(t=this.fightType!=EBattleType.EBattleTypeWchess&&e.entityId%10==7?c.Config.allPetConfig()[e.code]:c.Config.allHeroConfig()[e.code]||c.Config.creepConfig()[e.code])||(egret.warn("使用临时配置"),t=c.Config.allHeroConfig()[41010040]),t},a.N="FightPy",a);function a(){var e=t.call(this,a.N)||this;return e.positionTypes={},e._timeScale=FIGHT_CONST.SPEED_X1,e.timeout=5e3,e.multiFightOriginPushs=[],e.forceCanSkip=!1,e.curLayerTheme={},e.battleInfoVO=new c.FightVO.SBattleInfo,e.delayCBAfterFightExit=new Array,e.sFinalBattleResultVO=new c.FightVO.SFinalBattleResult,e.lastsFinalBattleResultVO=new c.FightVO.SFinalBattleResult,e.battleEntityDetail={},e}c.FightPy=e}(game=game||{}),function(d){var p,e=(p=BasePanel,__extends(g,p),g.prototype.childrenCreated=function(){var a=this;p.prototype.childrenCreated.call(this),this.lb_title.text=this.targetConfig.name;var e,t=Utils.LocalStorageUtil.getItem("FightTestInput_"+this.fightType,!0);""!=t&&(e=JSON.parse(t)),this.et_all.text=Utils.LocalStorageUtil.getItem("FightTestInput_fake",!0);for(var i=this.targetConfig.expectNum,n=0;n<i;n++){var o=new eui.EditableText;o.width=250,this.tfs.push(o),this.gp_et1.addChild(o);var s=new eui.EditableText;s.width=250,this.tfs2.push(s),this.gp_et2.addChild(s)}e&&e.campA&&e.campB&&(e.campA.forEach(function(e,t){var i;try{i=JSON.stringify(e)}catch(e){i=""}a.tfs[t].text=i}),e.campB.forEach(function(e,t){var i;try{i=JSON.stringify(e)}catch(e){i=""}a.tfs2[t].text=i}));for(var r=0,h=this.tfs;r<h.length;r++)h[r].prompt=this.targetConfig.tips;for(var l=0,c=this.tfs2;l<c.length;l++)c[l].prompt=this.targetConfig.tips;this.btn_test_skill.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){d.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{isPassive:!0,testSkill:!0,type:EBattleType.EBattleTypeTest})},this,250),egret.setTimeout(function(){var e=FIGHT_CONST.GUIDE_INNER_FIGHT.a;d.AppFacade.getInstance().retrieveProxy(d.FightPy.N).respBattleResultP(e)},this,500)},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,t=this.et_all.text,i=!1;if(t&&""!=t)try{var a=FIGHT_CONST.GUIDE_INNER_FIGHT[t];a=a||JSON.parse(t),i=!0,Utils.LocalStorageUtil.setItem("FightTestInput_fake",t,!0),d.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){d.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{isPassive:!0,type:a.battleType})},this,200),egret.setTimeout(function(){d.AppFacade.getInstance().retrieveProxy(d.FightPy.N).respBattleResultP(a)},this,500)}catch(e){console.log(e),Utils.MsgUtils.addMidMsg("战报解析失败")}else Utils.LocalStorageUtil.setItem("FightTestInput_fake","",!0);if(!i){for(var n=new Array,o=new Array,s=0;s<this.tfs.length;s++)if(""!=this.tfs[s].text){var r=JSON.parse(this.tfs[s].text);n.push(r)}else null!=this.targetConfig.patch&&n.push(this.targetConfig.patch);for(s=0;s<this.tfs2.length;s++)""!=this.tfs2[s].text?(r=JSON.parse(this.tfs2[s].text),o.push(r)):null!=this.targetConfig.patch&&o.push(this.targetConfig.patch);Utils.LocalStorageUtil.setItem("FightTestInput_"+this.fightType,JSON.stringify({campA:n,campB:o}),!0),d.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){e.fightType==g.FIGHT_TYPE.CHESS&&(d.GameMVC.zzqPy.simFight=!0),d.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{needCopy:e.cb_needCopy.selected,type:EBattleType.EBattleTypeTest,pb1:"test",pb2:e.targetConfig.pb,params:e.targetConfig.paramsFormat(n,o),doneCB:function(){d.GameMVC.zzqPy.simFight=!1}})},this,250)}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST)},this),this.et_replay.text=Utils.LocalStorageUtil.getItem("FightTestInput_replay",!0)||"",this.btn_replay.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.LocalStorageUtil.setItem("FightTestInput_replay",this.et_replay.text,!0),d.AppFacade.getInstance().retrieveProxy(d.FightPy.N).BattlePlayBack(this.et_replay.text)},this)},g.FIGHT_TYPE={REGULAR:1,CHESS:2},g);function g(e){var t,i=p.call(this)||this;return i.CONFIG=((t={})[g.FIGHT_TYPE.REGULAR]={name:"常规战斗",pb:"BattleTest",tips:'请输入{"code":XXXX, ...}',patch:{code:0},expectNum:6,paramsFormat:function(e,t){return{attacks:e,defence:t}}},t[g.FIGHT_TYPE.CHESS]={name:"自走棋战斗",pb:"WchessBattleTest",tips:"直接输入code",patch:0,expectNum:8,paramsFormat:function(e,t){return{attackTeam:e,defenceTeam:t}}},t),i.loginPy=d.AppFacade.getInstance().retrieveProxy(d.LoginPy.N),i.skinName="FightTestInputSkin",i.tfs=new Array,i.tfs2=new Array,i.fightType=e&&e.type||g.FIGHT_TYPE.REGULAR,i.targetConfig=i.CONFIG[i.fightType],i}d.FightTestInput=e}(game=game||{}),function(o){var s,e=(s=BasePanel,__extends(t,s),t.prototype.onDestroy=function(){s.prototype.onDestroy.call(this)},t.prototype.setV=function(e){if(this.curFocusET){var t=this.curFocusET.name;this.curFocusET.text=(Number(this.curFocusET.text)+e).toString();var i=o.Config.heroModelOffsetConfig(this.curHeroModel);if(i)i[t]=Number(this.curFocusET.text);else{var a={};this.KEY.forEach(function(e){a[e]=0}),o.Config.pack.t_hero_model_offset[this.curHeroModel]=a,o.Config.pack.t_hero_model_offset[this.curHeroModel][t]=Number(this.curFocusET.text)}}else Utils.MsgUtils.addMidMsg("请选中输入框")},t.prototype.changeModel=function(e,t){if(e&&""!=e){t==EBattleSide.EBattleSideAttack?(this.curHeroModel!=e&&(this.curHeroModel=e,o.Config.allHeroConfig()[41000001].model=this.curHeroModel,this.gp_model.$children.forEach(function(e){e.text=""})),this.lb_curModelName.text=this.curHeroModel):o.Config.allHeroConfig()[41000002].model=e,7==this.modelIndex&&(this.modelIndex=1);var i=this.fightTools.createFightObj({entity:new o.FightVO.SBattleEntity({entityId:t==EBattleSide.EBattleSideAttack?"11"+this.modelIndex++:"21"+this.modelIndex++,code:t==EBattleSide.EBattleSideAttack?41000001:41000002,life:9999,lifeMax:9999,anger:50,angerMax:100,level:99}),camp:t});return this.gp_model.addChild(i),i}},t.prototype.childrenCreated=function(){function e(e){var t=new eui.EditableText;t.width=600,t.prompt=e,t.name=e,i.gp_inputs.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFocusET=t},i),t.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){this.setV(0)},i)}s.prototype.childrenCreated.call(this),this.fightTools=o.FightTools.getInstance(),this.fightTools.bindView(this.gp_model,this.gp_model),this.fightPy.positionTypes=((t={})[EBattleSide.EBattleSideAttack]=PositionType.Normal,t[EBattleSide.EBattleSideDefence]=PositionType.Normal,t);for(var t,i=this,a=0,n=this.KEY;a<n.length;a++)e(n[a]);this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.Config.skillConfig().common_skill_huikan;this.fightTools.handleSkill(this.tar,[this.tar2],e,function(){},function(){})},this),this.btn_sheji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.Config.skillConfig().common_skill_gong;this.fightTools.handleSkill(this.tar,[this.tar2],e,function(){},function(){})},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.tar2&&this.gp_model.removeChild(this.tar2),this.tar2=this.changeModel(this.et_hero1_0.text,EBattleSide.EBattleSideDefence)},this),this.btn_go0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.tar&&this.gp_model.removeChild(this.tar),this.tar=this.changeModel(this.et_hero1_1.text,EBattleSide.EBattleSideAttack)},this),this.btn_z1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(1)},this),this.btn_z10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(10)},this),this.btn_f1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(-1)},this),this.btn_f10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(-10)},this)},t);function t(e){var t=s.call(this)||this;return t.modelIndex=1,t.fightPy=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N),t.KEY=["headOX","headOY","attkOX","shejiOX","shejiOY","allAttkDelay","flyBackDelay"],t.skinName="FightTestModelSkin",t.params=e,t}o.FightTestModel=e}(game=game||{}),function(T){var i,e=(i=BaseClass,__extends(t,i),t.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【FightTools】："].concat(e))},t.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.getInstance.apply(this,e)},t.prototype.bindView=function(e,t){this.gp_battle=e,this.gp_battle_up=t},t.prototype.createFightObj=function(e){return e.entity.entityId%10==0?customui.FightMagicalFactory.create(e):customui.FightModelFactory.create(e)},t.prototype.getBattleResStatusTips=function(e){var t="";return e&1<<EEffectStatus.Miss?t+"闪避":e&1<<EEffectStatus.Crit?t+"暴击":""},t.prototype.handleCustomAct=function(e,a,n){function t(i){switch(i.type){case"sky_color":var e=s.gp_battle.parent.gp_evr;e.objCMColorType=i.CMOffsetColorType||7,egret.setTimeout(function(){egret.Tween.get(e).to({CMOffsetFactor:i.CMOffsetFactor},i.dt/o.timeScale)},s,i.delay/s.timeScale);break;case"pz":egret.setTimeout(function(){T.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:i.pz})},s,i.delay/s.timeScale);break;case"obj_src":egret.setTimeout(function(){a&&egret.Tween.get(a).to({alpha:i.alpha},i.dt/o.timeScale)},s,i.delay/s.timeScale);break;case"hide_self_camp":egret.setTimeout(function(){var e=T.AppFacade.getInstance().retrieveMediator(T.FightMediator.N).id2FightModel;for(var t in e)e[t]&&e[t].parent&&(e[t].isFightMagical||e[t].camp!=a.camp||e[t]==a||(e[t].visible=!i.value))},s,i.delay/s.timeScale);break;case"hide_other_camp":egret.setTimeout(function(){var e=T.AppFacade.getInstance().retrieveMediator(T.FightMediator.N).id2FightModel;for(var t in e)e[t]&&e[t].parent&&(e[t].isFightMagical||e[t].camp==a.camp||-1!=n.indexOf(e[t])||(e[t].visible=!i.value))},s,i.delay/s.timeScale)}}for(var o=this,s=this,i=0,r=e;i<r.length;i++)t(r[i])},t.prototype.showFenShen=function(e,t,i){var a=this;void 0===i&&(i=1);var n=0;e.camp==EBattleSide.EBattleSideAttack?n-=t.modelPos[2][0]:n+=t.modelPos[2][0],DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,z:t.parent.getChildIndex(t)+1,timeScale:this.timeScale*i,scaleX:-t.display.scaleX,scaleY:t.display.scaleY,x:t.x+n,y:t.y,effectName:e.modelQueue[0],actionName:MODEL_ACTION_NAME.GJ,parent:t.parent,loadFinishCB:function(e){e.filters=[a.fenShenColorFlilter]}})},t.prototype.handleTargetEffectPia=function(i,e,a,n){var o=this;void 0===n&&(n=void 0),e?e.forEach(function(e){var t=[i.modelPos[e.posType][0],i.modelPos[e.posType][1]];DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:a,timeScale:o.timeScale,x:t[0],y:t[1],z:e.z,effectName:e.src[0],parent:o.gp_battle,doneCB:function(){n&&n()}})}):n&&n()},t.prototype.handleTargetEffect=function(s,r,h,l,c,d,p,e,g){var u=this;void 0===l&&(l=1),void 0===c&&(c=1),void 0===d&&(d=1),void 0===p&&(p=void 0),void 0===e&&(e=void 0),void 0===g&&(g=1),d=1;var f=[h.modelPos[r.posType][0],h.modelPos[r.posType][1]],m=s.camp==EBattleSide.EBattleSideAttack?1:-1,y="";if(y=r.srcBySelfCamp&&h.camp==s.camp?r.srcBySelfCamp[(l-1)%r.srcBySelfCamp.length]:r.src[(l-1)%r.src.length],0==r.type)this.log("直接目标身上播放",s.curEntity.entityId,y,l,c),DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:m,timeScale:this.timeScale*(r.timeScale||1)*d,x:f[0],y:f[1],z:r.z,effectName:y,parent:this.gp_battle}),egret.setTimeout(function(){h.onAttackFrame(l,c),p&&p()},this,(r.piaDelay||0)/this.timeScale/d);else if(1==r.type||4==r.type||5==r.type||7==r.type){var _=r.type,t=s;7==_&&e&&(t=e);var v=[t.modelPos[3][0],t.modelPos[3][1]];if(r.scaleX&&(m*=r.scaleX),5==_){var i=FIGHT_CONST.FIGHT_POS[this.fightPy.positionTypes[h.camp]][0];f=0<=m?[this.gp_battle.width+i[0],this.gp_battle.height/2+i[1]]:[-this.gp_battle.width+i[0],this.gp_battle.height/2+i[1]]}DragonBoneTools.create(y,function(e){var t=new egret.Point(v[0],v[1]),i=new egret.Point(f[0],f[1]),a=egret.Point.distance(t,i),n=r.fixedWidth||e.width,o=void 0;n<a?(o=egret.Point.interpolate(t,i,n/a),u.log("距离修正",n/a,o.x,o.y,i.x,i.y)):o=i,r.offsetStart&&(v[0]=v[0]+m*r.offsetStart[0],v[1]=v[1]+m*r.offsetStart[1]);var s=Utils.MathUtils.getDegByAB(o.y-v[1],o.x-v[0]);e.scaleX=m,e.rotation=(m<0?180:0)+s,e.x=v[0],e.y=v[1],r.scaleY&&(e.scaleY=r.scaleY),e.animation.timeScale=u.timeScale,u.gp_battle.addChild(e),e.animation.play(y,0),4==_?(e.x=o.x,e.y=o.y,egret.Tween.get(e).to({x:v[0],y:v[1]},r.dt/u.timeScale/d).call(function(){e&&e.parent&&e.parent.removeChild(e),h.onAttackFrame(l,c),p&&p()})):7==_?(e.visible=!1,egret.Tween.get(e).wait(g*(r.eachWait||0)/u.timeScale/d).call(function(){e.visible=!0}).to({x:o.x,y:o.y},r.dt/u.timeScale/d).call(function(){e&&e.parent&&e.parent.removeChild(e),h.onAttackFrame(l,c),p&&p()})):egret.Tween.get(e).to({x:o.x,y:o.y},r.dt/u.timeScale/d).call(function(){e&&e.parent&&e.parent.removeChild(e),h.onAttackFrame(l,c),p&&p()}),egret.Point.release(o)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else if(2==r.type){var o=[s.modelPos[3][0],s.modelPos[3][1]];DragonBoneTools.create(y,function(e){r.offsetStart&&(o[0]=o[0]+m*r.offsetStart[0],o[1]=o[1]+m*r.offsetStart[1]);var t=Utils.MathUtils.getDegByAB(f[1]-o[1],f[0]-o[0]),i=new egret.Point(o[0],o[1]),a=new egret.Point(f[0],f[1]),n=egret.Point.distance(i,a);e.scaleX=m*n/(r.fixedWidth?r.fixedWidth:e.width),e.rotation=(m<0?180:0)+t,e.x=o[0],e.y=o[1],e.animation.timeScale=u.timeScale*(r.timeScale||1),u.gp_battle.addChild(e),e.animation.play(y),egret.setTimeout(function(){e&&e.parent&&e.parent.removeChild(e),h.onAttackFrame(l,c),p&&p()},u,r.dt/u.timeScale/d)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else if(3==r.type){var T=[s.modelPos[3][0],s.modelPos[3][1]];DragonBoneTools.create(y,function(e){r.offsetStart&&(T[0]=T[0]+m*r.offsetStart[0],T[1]=T[1]+m*r.offsetStart[1]);var t=Utils.MathUtils.getDegByAB(f[1]-T[1],f[0]-T[0]),i=new egret.Point(T[0],T[1]),a=new egret.Point(f[0],f[1]),n=egret.Point.distance(i,a),o=m*n/e.width;e.rotation=(m<0?180:0)+t,e.scaleX=0,e.x=T[0],e.y=T[1],e.animation.timeScale=u.timeScale,u.gp_battle.addChild(e),e.animation.play(y),egret.Tween.get(e).to({scaleX:o},r.dt/u.timeScale/d).to({scaleX:0},r.dt/u.timeScale/d).call(function(){e&&e.parent&&e.parent.removeChild(e),r.tarFlyConfig||(h.onAttackFrame(l,c),p&&p())}),r.tarFlyConfig&&2==r.tarFlyConfig[0]&&egret.Tween.get(h).wait(r.dt/u.timeScale/d).to({x:s.x,y:s.y},r.dt/u.timeScale/d).wait(r.tarFlyConfig[2]/u.timeScale/d).call(function(){h.resetAfterSeq(),e&&e.parent&&e.parent.removeChild(e),h.onAttackFrame(l,c),p&&p()},u,void 0,!0)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else 6==r.type&&(DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:m,timeScale:this.timeScale*(r.timeScale||1)*d,x:f[0],y:f[1],z:r.z,effectName:y,parent:this.gp_battle}),egret.setTimeout(function(){h.onAttackFrame(l,c),p&&p()},this,(r.piaDelay||0)/d))},t.prototype.handleSkill=function(c,d,p,g,u,e,f,t){var m=this;void 0===e&&(e=!1),void 0===f&&(f={}),void 0===t&&(t=0);var y=c.camp==EBattleSide.EBattleSideAttack?1:-1,_=[],i=0,a=!1;if(p.delyByPia&&p.effectsTarPia&&egret.warn("不支持delyByPia和effectsTarPia共用"),p.customAct&&this.handleCustomAct(p.customAct,c,d),!p.noGJ)if(0==p.meFlyConfig[0])c.playAction(MODEL_ACTION_NAME.GJ,1,function(){c.playAction()});else if(1==p.meFlyConfig[0])_[0]={},_[0].x=this.gp_battle.width/2-y*p.meFlyConfig[1],_[0].y=this.gp_battle.height/2+p.meFlyConfig[2];else if(2==p.meFlyConfig[0]){var n=c.modelPos[2][0];n=c.camp==EBattleSide.EBattleSideAttack?-n:n,d.forEach(function(e,t){_[t]={},_[t].x=e.modelPos[1][0]+n,_[t].y=e.modelPos[1][1]+10})}else if(3==p.meFlyConfig[0])for(var o=0,s=d;o<s.length;o++){var r=s[o];this.showFenShen(c,r)}if(null!=p.allAttkDelayFixed&&(i+=p.allAttkDelayFixed),Array.isArray(p.tarFlyConfig)){var h={},l=d[0];h.x=this.gp_battle.width/2-y*p.tarFlyConfig[1],h.y=this.gp_battle.height/2+p.tarFlyConfig[2],egret.Tween.get(l).to({x:h.x,y:h.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/this.timeScale).call(function(){l.setZOrder(!0)}).wait((l.flyBackDelay+(p.tarFlyConfig[3]||0))/this.timeScale).to({x:l.modelPos[1][0],y:l.modelPos[1][1]},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/2/this.timeScale).call(function(){l.setZOrder(!1)})}var v=_.shift();v&&(i=FIGHT_CONST.ACT_FACE_2_FACE_FLY_T,p.effectFly&&p.effectFly.forEach(function(e,t){DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:y,timeScale:m.timeScale*(e.timeScale||1),x:c.modelPos[e.posType][0]+(e.offset&&e.offset[0]?e.offset[0]*y:0),y:c.modelPos[e.posType][1]+(e.offset&&e.offset[1]?e.offset[1]:0),effectName:e.src[0],parent:m.gp_battle})}),c.isComboing||p.isComboing?egret.Tween.get(c).to({x:v.x,y:v.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/this.timeScale).call(function(){c.setZOrder(!0),c.playAction(MODEL_ACTION_NAME.GJ,1,function(){c.playAction()})}):egret.Tween.get(c).to({x:v.x,y:v.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/this.timeScale).call(function(){c.setZOrder(!0),c.playAction(MODEL_ACTION_NAME.GJ,1,function(){c.playAction()})}).wait((c.flyBackDelay+(p.meFlyConfig[3]||0))/this.timeScale).to({x:c.modelPos[1][0],y:c.modelPos[1][1]},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/2/this.timeScale).call(function(){c.setZOrder(!1)})),egret.setTimeout(function(){p.effectSrc&&p.effectSrc.forEach(function(e,t){egret.setTimeout(function(){DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:y,timeScale:m.timeScale*(e.timeScale||1),x:(v?v.x:c.modelPos[e.posType][0])+(e.offset&&e.offset[0]?e.offset[0]*y:0),y:(v?v.y:c.modelPos[e.posType][1])+(e.offset&&e.offset[1]?e.offset[1]:0),z:e.z,effectName:e.src[0],parent:m.gp_battle})},m,(c.allAttkDelay+(e.delay||0))/m.timeScale)}),p.effectQP&&p.effectQP.forEach(function(r,e){var i=FIGHT_CONST.FIGHT_POS[m.fightPy.positionTypes[c.camp]][0];egret.setTimeout(function(){var o=0,s=1,e=m.gp_battle.width/2+i[0]+y*r.offset[0],t=0;t=1==r.posType?d[0].y:m.gp_battle.height/2+i[1]+r.offset[1],DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:r.noScaleXByCamp?1:r.scaleX?r.scaleX*y:y,scaleY:r.scaleY,z:r.z,timeScale:m.timeScale*(r.timeScale||1),x:e,y:t,effectName:r.src[0],parent:m.gp_battle,frameCB:function(e){if("pz"==e.name)T.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:3});else if(p.delyByPia)if("pia"==e.name){console.log("pia! "+s+"/"+o+", "+d.length);for(var t=0,i=d;t<i.length;t++){var a=i[t];if(a.onAttackFrame(s,o),r.piaEffect){var n=[a.modelPos[r.piaEffect.posType][0],a.modelPos[r.piaEffect.posType][1]];DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:y,timeScale:m.timeScale,x:n[0],y:n[1],z:r.piaEffect.z,effectName:r.piaEffect.src[0],parent:m.gp_battle})}}s++}else"pia_count"==e.name&&(o=e.data&&e.data.ints&&e.data.ints[0])},doneCB:function(){p.delyByPia&&(u&&u(),u=void 0,g&&g(),g=void 0)}})},m,(c.allAttkDelay+(r.delay||0))/m.timeScale)}),p.effectsTar&&0<p.effectsTar.length&&(a=!0,p.effectsTar.forEach(function(l,e){egret.setTimeout(function(){var s=0,r=d.length,h=void 0;d.forEach(function(i,a){if(p.delyEachTar){function e(t){p.speedUpEveryHurt&&0<s&&(n=1+p.speedUpEveryHurt*s),egret.setTimeout(function(){p.delyEachTarNeedGJByFrame&&(c.updataSpeed(p.delyEachTarNeedGJByFrame[1]*n),c.gotoAndPlayByFrame(MODEL_ACTION_NAME.GJ,p.delyEachTarNeedGJByFrame[0],1)),egret.setTimeout(function(){m.handleTargetEffect(c,l,i,t,o,n,function(){if(p.delyEachTarNeedGJByFrame&&t==o)if(a==r-1)egret.setTimeout(function(){c.updataSpeed(),c.playAction(),c.x==c.modelPos[1][0]&&c.y==c.modelPos[1][1]||egret.Tween.get(c).to({x:c.modelPos[1][0],y:c.modelPos[1][1]},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/2/m.timeScale/n).call(function(){c.setZOrder(!1)})},m,(c.allAttkDelay||0)/m.timeScale);else if(0<_.length){var e=_.shift();egret.Tween.get(c).to({x:e.x,y:e.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/m.timeScale/n).call(function(){c.setZOrder(!0)})}m.handleTargetEffectPia(i,p.effectsTarPia,y,function(){r-1==a&&t==o&&(u&&u(),u=void 0,g&&g(),g=void 0)})})},m,(l.delay||0)/m.timeScale/n)},m,((p.attackFrameDelay||0)+(p.delyEachTar?p.delyEachTar*(++s-1):0))/m.timeScale/n)}for(var n=1,o=f[i.curEntity.entityId],t=1;t<=o;t++)e(t)}else m.handleTargetEffect(c,l,i,void 0,void 0,void 0,function(){p.attackFrameDelay||(m.handleTargetEffectPia(i,p.effectsTarPia,y),u&&u(),u=void 0)},h,a);h=i})},m,p.delyEachTar?0:(l.delay||0)/m.timeScale)},m))},this,(c.allAttkDelay+i+(p.meFlyConfig[4]||0))/this.timeScale),!p.attackFrameDelay||p.delyEachTar||p.delyByPia||a||egret.setTimeout(function(){for(var e=0,t=d;e<t.length;e++){var i=t[e];i.onAttackFrame(),m.handleTargetEffectPia(i,p.effectsTarPia,y)}u&&m.gp_battle.once(egret.Event.ENTER_FRAME,function(){u&&u(),u=void 0},m)},this,(c.allAttkDelay+p.attackFrameDelay)/this.timeScale),p.delyEachTar||p.delyByPia||egret.setTimeout(function(){g&&g(),g=void 0},this,(c.allAttkDelay+(p.attackDoneDelay||1e3))/this.timeScale)},t.prototype.shoujiActionShine=function(e){var t=e.obj;egret.Tween.removeTweens(t),t.filters=[],egret.Tween.get(t).to({alpha:0},100/this.timeScale).to({alpha:1},100/this.timeScale).to({alpha:0},60/this.timeScale).to({alpha:1},60/this.timeScale).to({alpha:0},30/this.timeScale).to({alpha:1},30/this.timeScale).call(function(){e.doneCB&&e.doneCB.call(e.context)},this)},t.prototype.updateTimeScale=function(){this.timeScale=Utils.TimerManager.getTimeScale()},t.prototype.getHeroSideInfoById=function(e){return{camp:Math.floor(e/100),teamId:Math.floor(e%100/10),posId:e%10}},t.prototype.calEntityZOrderToView=function(e){},t.prototype.calEntityPosToView=function(e){var t=e.curEntity.entityId.toString(),i=t[t.length-1],a=FIGHT_CONST.FIGHT_POS[this.fightPy.positionTypes[e.camp]][e.camp][Number(i)];if(e.x=this.gp_battle.width/2+a[0],e.y=this.gp_battle.height/5*4+a[1],a[3]&&(e.scaleX=e.scaleY=a[3]),FIGHT_CONST.DEBUG_DRAW_FIGHT_MODEL_ORIGIN_POS){var n=new egret.Sprite;n.graphics.clear(),n.graphics.beginFill(16711680,1),n.graphics.drawRect(0,0,5,5),n.graphics.endFill(),n.x=e.x,n.y=e.y,this.gp_battle.addChild(n)}},t.prototype.quickSort=function(e,t){var i,a,n,o;if(i=a=n=0,!(t<e)){for(o=this.needSortChildrenArr[e].y,i=e,a=t;i!=a;){for(;this.needSortChildrenArr[a].y>=o&&i<a;)a--;for(;this.needSortChildrenArr[i].y<=o&&i<a;)i++;i<a&&(this.gp_battle.swapChildren(this.needSortChildrenArr[i],this.needSortChildrenArr[a]),n=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=this.needSortChildrenArr[a],this.needSortChildrenArr[a]=n)}this.gp_battle.swapChildren(this.needSortChildrenArr[e],this.needSortChildrenArr[i]),n=this.needSortChildrenArr[e],this.needSortChildrenArr[e]=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=n,this.quickSort(e,i-1),this.quickSort(i+1,t)}},t.prototype.resortZOrder=function(){this.needSortChildrenArr.splice(0);for(var e=void 0,t=0,i=this.gp_battle.$children;t<i.length;t++){var a=i[t];a.curEntity&&(null==a.zorder?this.needSortChildrenArr.push(a):(e=e||[]).push(a))}if(this.quickSort(0,this.needSortChildrenArr.length-1),e)for(var n=0,o=e;n<o.length;n++){var s=o[n];this.gp_battle.setChildIndex(s,-1)}},t);function t(){var e=i.call(this)||this;e.flyTimeEffect=200,e.timeScale=1,e.fightPy=T.AppFacade.getInstance().retrieveProxy(T.FightPy.N),e.curWidth=Utils.DeviceUtils.curWidth(),e.curHeight=Utils.DeviceUtils.curHeight(),e.needSortChildrenArr=new Array;return e.fenShenColorFlilter=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,200,0,0,0,1,0]),e}T.FightTools=e}(game=game||{}),function(I){var p,e=(p=BaseFull,__extends(t,p),t.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},t.prototype.childrenCreated=function(){var n=this;p.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head);var e=Utils.LocalStorageUtil.getItem("FightUI_speed"),t=Number(e);if(t==FIGHT_CONST.SPEED_X2?Utils.UnlockMgr.checkPass(MODULE.FightSpeed,!1).allow||FIGHT_CONST.SPEED_X1:t=FIGHT_CONST.SPEED_X1,Utils.TimerManager.setTimeScale(t),this.fightProxy.timeScale=t,this.blb_speed.text=t==FIGHT_CONST.SPEED_X1?"x1":"x2",DragonBoneTools.create("common_shenqixulizhong",function(e){n.eff_shenqiXLZ=e,n.eff_shenqiXLZ.visible=!1,n.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),DragonBoneTools.create("common_shenqixuliwancheng",function(e){n.eff_shenqiXLWC=e,n.eff_shenqiXLWC.x=n.gp_pb_fade.width/2,n.eff_shenqiXLWC.visible=!1,n.gp_pb_fade.addChild(e),e.animation.play("common_shenqixuliwancheng")}),this.pb_anger.labelFunction=function(e,t){return t<=e?(n.eff_shenqiXLWC&&(n.eff_shenqiXLWC.visible=!0),n.eff_shenqiXLZ&&(n.eff_shenqiXLZ.visible=!1)):0==e?(n.eff_shenqiXLZ&&(n.eff_shenqiXLZ.visible=!1),n.eff_shenqiXLWC&&(n.eff_shenqiXLWC.visible=!1)):(n.eff_shenqiXLWC&&(n.eff_shenqiXLWC.visible=!1),n.eff_shenqiXLZ&&(n.eff_shenqiXLZ.visible=!0,n.eff_shenqiXLZ.x=e/t*n.gp_pb_fade.width-2)),""},this.gp_speed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.fightProxy.fightType!=EBattleType.EBattleTypeTest&&!Utils.UnlockMgr.checkPass(MODULE.FightSpeed).allow||(Utils.TimerManager.getTimeScale()===FIGHT_CONST.SPEED_X1?(Utils.TimerManager.setTimeScale(FIGHT_CONST.SPEED_X2),this.fightProxy.timeScale=FIGHT_CONST.SPEED_X2,this.blb_speed.text="x2"):(Utils.TimerManager.setTimeScale(FIGHT_CONST.SPEED_X1),this.fightProxy.timeScale=FIGHT_CONST.SPEED_X1,this.blb_speed.text="x1"),Utils.LocalStorageUtil.setItem("FightUI_speed",this.fightProxy.timeScale.toString()))},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.UnlockMgr.checkPass(MODULE.FightSkip,!1);e.allow||this.fightProxy.round&&this.fightProxy.round.roundNum>=FIGHT_CONST.ROUND_TO_SHOW_SKIP||this.fightProxy.fightType==EBattleType.EBattleTypeSummerTrain&&2<=this.fightProxy.round.roundNum?I.AppFacade.getInstance().sendNotification(CN.FIGHT_SKIP_FIGHT):Utils.MsgUtils.addMidMsg(e.ext.tips)},this),this.btn_debug.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),Utils.SDKMgr.getPerformConfig(2)?this.btn_chat.visible=!1:this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&I.AppFacade.getInstance().showSubView(I.ChatMediator.N,I.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_pause.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"恢复"==this.btn_pause.label?this.btn_pause.label="暂停":this.btn_pause.label="恢复",I.AppFacade.getInstance().sendNotification(CN.FIGHT_PAUSE)},this),this.btn_shuxing.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.haloCodesLeft.length&&I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.HERO_HALO,{codeList:this.haloCodesLeft})},this),this.gp_halo_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.fightProxy.fightType==EBattleType.EBattleTypeTexabPoker)0<n.haloCodesLeft.length&&I.AppFacade.getInstance().showSubView(I.HoldemMed.N,I.HoldemMed.SV.HALO,{codeList:n.haloCodesLeft});else if(n.fightProxy.fightType==EBattleType.EBattleTypeWchess){var e=n.haloCodesLeft,t=[],i=[];for(var a in e)i.indexOf(I.Config.chessHero()[e[a]])<0&&(t.push(e[a]),i.push(I.Config.chessHero()[e[a]]));0<t.length&&I.AppFacade.getInstance().showSubView(I.ZzqMediator.N,I.ZzqMediator.SV.HEROHALO,{codeList:t})}else 0<n.haloCodesLeft.length&&I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.HERO_HALO,{codeList:n.haloCodesLeft})},this),this.gp_halo_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.fightProxy.fightType==EBattleType.EBattleTypeTexabPoker)0<n.haloCodesRight.length&&I.AppFacade.getInstance().showSubView(I.HoldemMed.N,I.HoldemMed.SV.HALO,{codeList:n.haloCodesRight});else if(n.fightProxy.fightType==EBattleType.EBattleTypeWchess);else if(0<n.haloCodesRight.length)I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.HERO_HALO,{codeList:n.haloCodesRight});else{var e=n.haloCodesRight,t=[],i=[];for(var a in e)i.indexOf(I.Config.chessHero()[e[a]])<0&&(t.push(e[a]),i.push(I.Config.chessHero()[e[a]]));0<t.length&&I.AppFacade.getInstance().showSubView(I.ZzqMediator.N,I.ZzqMediator.SV.HEROHALO,{codeList:t})}},this),Utils.DebugUtils.isDebug||(this.btn_pause.visible=!1),this.initEvrCM(),this.updateUI(void 0,!0),Utils.DebugUtils.isDebug&&this.fightProxy.reqFightParams&&this.fightProxy.reqFightParams.testSkill){this.btn_go=new eui.Button,this.btn_go.label="攻击",this.btn_go.width=200;var i=new eui.Button;i.label="刷新技能对应模型",i.width=200;var a=new eui.Button;a.label="近战",a.width=200;var o=new eui.Button;o.label="远程",o.width=200;var s=void 0;try{s=JSON.parse(Utils.LocalStorageUtil.getItem("FightTestInput_skill",!0))}catch(e){}var r=new eui.EditableText;r.width=Utils.DeviceUtils.curWidth()/3,r.prompt="输入攻击者id(111、211那些，格式:111)",s&&""!=s.et_attackId&&(r.text=s.et_attackId);var h=new eui.EditableText;h.width=Utils.DeviceUtils.curWidth()/3,h.prompt="输入特效名",s&&""!=s.et_skill&&(h.text=s.et_skill);var l=new eui.EditableText;l.width=Utils.DeviceUtils.curWidth()/3,l.prompt="输入受击者id(111、211那些，格式:[211,212,...])",s&&s.et_defend&&(l.text=s.et_defend);var c=new eui.EditableText;function d(e){var t={et_skill:e,et_attackId:r.text,et_defend:l.text,et_modelFixed:c.text};Utils.LocalStorageUtil.setItem("FightTestInput_skill",JSON.stringify(t),!0),egret.Ticker.getInstance().register(n.onEnterFrame,n),n.dt=0,I.AppFacade.getInstance().sendNotification(CN.FIGHT_LET_OBJ_RELEASE_SKILL,{id:Number(r.text),tIds:JSON.parse(l.text),skill:e,cb:function(){egret.Ticker.getInstance().unregister(n.onEnterFrame,n),I.AppFacade.getInstance().sendNotification(CN.FIGHT_LET_OBJ_RELEASE_SKILL,{id:JSON.parse(l.text)[0],tIds:[Number(r.text)],skill:e,cb:function(){}})}})}c.width=Utils.DeviceUtils.curWidth()/3,c.prompt="输入技能对应模型资源",s&&s.et_modelFixed&&(c.text=s.et_modelFixed),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=h.text&&""!=r.text&&""!=l.text&&d(h.text)},this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=h.text&&""!=r.text&&""!=l.text&&d("common_skill_gong")},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=h.text&&""!=r.text&&""!=l.text&&d("common_skill_huikan")},this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=c.text?I.AppFacade.getInstance().sendNotification(CN.FIGHT_CHANGE_ALL_MODEL,{modelFixed:c.text}):""!=h.text&&I.AppFacade.getInstance().sendNotification(CN.FIGHT_CHANGE_ALL_MODEL,{model:h.text})},this),r.left=0,h.horizontalCenter=0,c.horizontalCenter=0,c.top=45,l.right=0,i.top=this.btn_go.top=70,a.top=o.top=130,a.horizontalCenter=this.btn_go.horizontalCenter=-125,o.horizontalCenter=i.horizontalCenter=125,this.addChild(this.btn_go),this.addChild(i),this.addChild(r),this.addChild(h),this.addChild(l),this.addChild(c),this.addChild(o),this.addChild(a),egret.setTimeout(function(){I.FightTools.getInstance().resortZOrder()},this,5e3)}},t.prototype.initEvrCM=function(){this.gp_evr.objCMColorType=7,this.gp_evr._CMOffsetFactor=0,Object.defineProperty(this.gp_evr,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(this._CMOffsetFactor=e,!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.filters=[t]}var i=this.filters[0].matrix;4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),this.filters[0].matrix=i}})},t.prototype.updateFightDetail=function(e){},t.prototype.updateUI=function(e,t){if(t)this.reset();else if(e.round&&(this.blb_round.text="回合"+this.fightProxy.round.roundNum,(this.fightProxy.round.roundNum==FIGHT_CONST.ROUND_TO_SHOW_SKIP||this.fightProxy.fightType==EBattleType.EBattleTypeSummerTrain&&2==this.fightProxy.round.roundNum)&&(this.btn_close.visible=!0,this.lb_skip_tips.visible=!1)),null!=e.anger&&(this.pb_anger.value=e.anger),null!=e.angerMax&&(this.pb_anger.maximum=e.angerMax),e.focus&&this.setCameraFocue(e.focus),e.focusReset&&this.setCameraFocue(),null!=e.pz&&this.evrShake(e.pz),e.updateTeam){for(var i=0,a=this.fightProxy.sBattleResultVO.teams;i<a.length;i++)if((c=a[i]).playerId)c.camp==EBattleSide.EBattleSideAttack?(this.cu_ph_left.updateData({vo:c,ignoreLevel:1}),this.blb_level_left.text=c.level&&c.level.toString()||"",this.lb_name_left.text=c.name):(this.cu_ph_right.updateData({vo:c,ignoreLevel:1}),this.blb_level_right.text=c.level&&c.level.toString()||"",this.lb_name_right.text=c.name);else{var n=I.Config.allHeroConfig()[c.entities[0].code];c.camp==EBattleSide.EBattleSideAttack?(this.cu_ph_left.updateData({fixedHead:n.avatar}),this.blb_level_left.text="",this.lb_name_left.text=n.name):(this.cu_ph_right.updateData({fixedHead:n.avatar}),this.blb_level_right.text="",this.lb_name_right.text=n.name)}for(var o in this.conditionForSkip){var s=Number(o),r=Utils.UnlockMgr.checkPass(this.conditionForSkip[s].moduleId,!1);r.allow?(-1==this.CAN_SKIP_FIGHT_TYPE.indexOf(s)&&this.CAN_SKIP_FIGHT_TYPE.push(s),this.lb_skip_tips.visible=!1):-1!=this.SHOW_SKIP_TIPS.indexOf(Number(this.fightProxy.fightType))&&(this.lb_skip_tips.visible=!0,this.lb_skip_tips.text=r.ext.requestLevel+"级解锁跳过战斗")}this.fightProxy.forceCanSkip||-1!=this.CAN_SKIP_FIGHT_TYPE.indexOf(Number(this.fightProxy.fightType))?(this.btn_close.visible=!0,this.lb_skip_tips.visible=!1):this.btn_close.visible=!1;for(var h=0,l=this.fightProxy.sBattleResultVO.teams;h<l.length;h++){var c=l[h];if(this.fightProxy.fightType!=EBattleType.EBattleTypeWchess){var d=this.haloCodesLeft,p=this.gp_halo_left;for(var g in c.camp==EBattleSide.EBattleSideDefence&&(p=this.gp_halo_right,d=this.haloCodesRight),d.splice(0,d.length),c.entities,c.entities){var u=c.entities[g];d.push(u.code)}var f=I.AppFacade.getInstance().retrieveProxy(I.HeroPy.N),m=HaloType.Normal;switch(this.fightProxy.fightType){case EBattleType.EBattleTypeTexabPoker:m=HaloType.TexanPoker}var y=f.getActivatedHaloId(d,m),_=I.Config.heroHaloConfig();for(var g in p.removeChildren(),y){var v=_[y[g]],T=new b({icon:I.GeneralConfig.getGuajiImg(v.img)[1]});c.camp==EBattleSide.EBattleSideDefence&&(T.scaleX=-1),p.addChild(T)}}else{for(var g in d=this.haloCodesLeft,p=this.gp_halo_left,c.camp==EBattleSide.EBattleSideDefence&&(p=this.gp_halo_right,d=this.haloCodesRight),d.splice(0,d.length),c.entities,c.entities)u=c.entities[g],d.push(u.code);var C=[],E=[];for(var g in d)E.indexOf(I.Config.chessHero()[d[g]])<0&&(C.push(d[g]),E.push(I.Config.chessHero()[d[g]]));if(0<C.length)for(var g in y=(f=I.AppFacade.getInstance().retrieveProxy(I.HeroPy.N)).getActivatedHaloId(C,HaloType.Chess),_=I.Config.heroHaloConfig(),y)v=_[y[g]],T=new I.ZzqHaloItem({icon:I.GeneralConfig.getGuajiImg(v.img)[1]}),c.camp==EBattleSide.EBattleSideDefence&&(T.scaleX=-1),p.addChild(T)}}}},t.prototype.reset=function(){this.lb_skip_tips.visible=this.btn_close.visible=!1,this.fightProxy.getCustomParams(),this.gp_evr.objCMColorType=7,this.gp_evr.CMOffsetFactor=0,this.img_bg.source=this.fightProxy.curLayerTheme&&this.fightProxy.curLayerTheme.bg||"dk_01_bg_01_png";var e=I.AppFacade.getInstance().retrieveMediator(I.FightMediator.N);e.getSubView(I.FightMediator.SV.ATTRIBUTE_CONTROL)&&e.hideSubView(I.FightMediator.SV.ATTRIBUTE_CONTROL)},t.prototype.setCameraFocue=function(e){},t.prototype.evrShake=function(e){void 0===e&&(e=3),Utils.ShakeUtils.shakeObj(this,.1,60,e)},t.prototype.onEnterFrame=function(e){this.dt+=e,this.btn_go&&(this.btn_go.label=this.dt.toString())},t);function t(){var e,t=p.call(this)||this;return t.fightProxy=I.AppFacade.getInstance().retrieveProxy(I.FightPy.N),t.playerProxy=I.AppFacade.getInstance().retrieveProxy(I.PlayerPy.N),t.CAN_SKIP_FIGHT_TYPE=[1,3,5,6,7,9,10,11,13,14,15,19,20,22,23,25,26,33,39,41,42],t.SHOW_SKIP_TIPS=[EBattleType.EBattleTypeRaceTower,EBattleType.EBattleTypeChampion],t.conditionForSkip=((e={})[EBattleType.EBattleTypeVestage]={moduleId:MODULE.FightSkipForVestage},e[EBattleType.EBattleTypeChampion]={moduleId:MODULE.FightSkipForChampion},e[EBattleType.EBattleTypeRaceTower]={moduleId:MODULE.FightSkipForRaceTower},e),t.haloCodesLeft=[],t.haloCodesRight=[],t.skinName="FightUISkin",t}I.FightUI=e;var i,a=(i=BasePanel,__extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},n);function n(){var e=i.call(this)||this;return e.skinName="AttributeControlSkin",e}I.AttributeControl=a;var o,b=(o=eui.ItemRenderer,__extends(s,o),s.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.img_icon.source=this.params.icon},s);function s(e){var t=o.call(this)||this;return t.skinName="FightHaloItem",t.params=e,t}}(game=game||{}),function(r){var i,e=(i=BasePanel,__extends(t,i),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateView(this.data)},t.prototype.updateView=function(e){var t=this;if(this.data=e,this.id=this.data.id,this.cb=this.data.cb,this.id){var i=r.Config.guideHeroShow()[this.id];if(!i)return;var a=r.Config.allHeroConfig()[this.id];this.heroModel.update({code:this.id,isStatic:!0}),this.lb_name.text=a.name,this.img_base.source=HeroRaceConfig[a.race].baseSrc,this.img_race.source=HeroRaceConfig[a.race].raceIconBig,this.lb_race.text=HeroRaceConfig[a.race].name,this.img_prof.source=ProfessionConfig[a.profession].icon,this.lb_prof.text=ProfessionConfig[a.profession].name;var n=new Array;n.push({text:i.desc1+"    "}),n.push({text:"\n\n",style:{size:10}}),n.push({text:"    "+i.desc2}),this.lb_desc.textFlow=n;var o=a.actSkill,s=r.Config.skillBaseConfig()[o];this.skillItem.updateItem({code:o}),this.lb_skillName.text=s.name,this.lb_skillDesc.text=s.desc,this.heroModel.visible=!1,UIActionManager.playUIAction(this.gp_model,3),UIActionManager.playUIAction(this.gp_bg,4,function(){t.heroModel.visible=!0;var e=t.heroModel.localToGlobal().y;t.heroModel.y-=e+t.heroModel.height,egret.Tween.get(t.heroModel).to({y:0},150).call(function(){Utils.ShakeUtils.shakeObj(t,.2,60,30),egret.setTimeout(function(){t.heroModel.changeAction(["gongji"]),t.timer||(t.timer=egret.setTimeout(t.autoClosePanel,t,t._autoCloseTime)),Utils.TouchUtils.addTouchListener(t.gp_root,function(){t.autoClosePanel()})},t,200)})})}},t.prototype.autoClosePanel=function(){var e=this;this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0),UIActionManager.playUIAction(this.gp_model,3,void 0,void 0,!0),UIActionManager.playUIAction(this.gp_bg,4,function(){e.hide()},void 0,!0)},t.prototype.perClose=function(){this.cb&&this.cb()},t.prototype.onDestroy=function(){this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0)},t);function t(e){var t=i.call(this)||this;return t._autoCloseTime=3e3,t.skinName="FightBossDescSkin",t.data=e,t}r.FightBossDescView=e}(game=game||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightBuffIcon",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.FightBuffIconFactory=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.jiayi=function(){this.count++,2<=this.count&&(this.blb.text=this.count.toString(),this.blb.visible=!0)},o.prototype.jianyi=function(){if(this.count--,this.blb.text=this.count.toString(),1==this.count)this.blb.visible=!1;else if(this.count<=0)return!0},o.prototype.reset=function(){this.count=1,this.img_icon.source="",this.blb.text="",this.blb.visible=!1},o.prototype.initUI=function(){this.img_icon=new eui.Image,this.img_icon.width=this.img_icon.height=this.width=this.height=52,this.addChild(this.img_icon),this.blb=new eui.BitmapLabel,this.blb.scaleX=this.blb.scaleY=1.5,this.blb.right=0,this.blb.y=25,this.blb.font="white_num_fnt",this.addChild(this.blb)},o.prototype.onOPReset=function(){this.reset()},o.prototype.onOPComeBack=function(e,t){t&&this.initUI(),this.params=e,this.img_icon.source="_fight_m_json."+this.params.icon},o.prototype.onOPClean=function(){},o.prototype.onOPCheck=function(e){egret.log("alive")},o);function o(e){var t=a.call(this)||this;return t.count=1,t}e.FightBuffIcon=n}(customui=customui||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightMagical",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.FightMagicalFactory=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.gp_head.visible=!1},o.prototype.onModelCreate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return game.AppFacade.getInstance().sendNotification(CN.FIGHT_MODEL_CREATED,this.curEntity.entityId),[2]})})},o.prototype.gotoAndPlayByFrame=function(e,t,i,a){},o.prototype.playAction=function(e,t,i){},o.prototype.updataSpeed=function(e){},o.prototype.updateBuffBeforAttack=function(e){return!0},o.prototype.updateEntity=function(e){this.curEntity.anger=this.pb_anger.value=e.anger,this.isLeftCamp&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_FIGHT_UPDATE_UI,{anger:e.anger})},o.prototype.pushCurOnAttackFrame=function(e){this.ress.push(e),this.totalCurOnAttackFrameCount=this.ress.length},o.prototype.onAttackFrame=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),0!=this.ress.length)if(1<t)e==t?this.onAttackFrame():e%Math.max(1,Math.floor(t/this.totalCurOnAttackFrameCount))==0&&this.handleSeqBattleRes(this.ress.shift(),game.FightState.ATTACK_ING);else{for(var i=0,a=this.ress;i<a.length;i++){var n=a[i];this.handleSeqBattleRes(n,game.FightState.ATTACK_ING)}this.ress.splice(0)}},o.prototype.popSth=function(e,t){void 0===t&&(t=0)},o.prototype.handleSeqBattleRes=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.updateEntity(t),[2,this.handleBuff(t.buffAdd,t.buffRemove,i)]})})},o.prototype.handleBuff=function(e,t,i){},o.prototype.updateBuff=function(){},o.prototype.addChildAsEff=function(e){this.addChildAt(e,this.getChildIndex(this.gp_model)+1)},o.prototype.releaseSkill=function(n,o,s,r,h,e){return void 0===h&&(h=!1),void 0===e&&(e={}),__awaiter(this,void 0,void 0,function(){var t,i,a;return __generator(this,function(e){switch(e.label){case 0:return this.isComboing=h,[4,this.appear()];case 1:return e.sent(),t=game.Config.skillBaseConfig()[n],i=t&&t.modelId||"","string"==typeof n&&(i=n),""==i?[2,s()]:((a=game.Config.skillConfig()[i])||(egret.warn("该技能"+i+"还没调，使用临时技能"),a=game.Config.skillConfig().common_skill_gong_1),this.fightTools.handleSkill(this,o,a,s,r),this.dismiss(),[2])}})})},o.prototype.holdOn=function(a,n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){egret.setTimeout(function(){i&&i.parent&&(n&&n(),e())},i,a/Utils.TimerManager.getTimeScale())})]})})},o.prototype.appear=function(){var i=this,e=1;this.visible=!0;var t=void 0;return this.camp==EBattleSide.EBattleSideDefence?(t=this.fightTools.gp_battle.width,e=-1):t=0,DragonBoneTools.playOnce({cacheAsBitmap:!1,scaleX:e,z:-1,effectName:"common_shenqichuxian_1",parent:this.fightTools.gp_battle}),DragonBoneTools.playOnce({cacheAsBitmap:!1,scaleX:e,z:this.parent.getChildIndex(this)-1,effectName:"common_shenqichuxian_2",parent:this.fightTools.gp_battle}),this.x=t,new Promise(function(e,t){egret.Tween.get(i).to({x:i.modelPos[1][0]},700,egret.Ease.bounceOut).call(function(){game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:5}),e()})})},o.prototype.shouji=function(){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return this.playAction(MODEL_ACTION_NAME.SJ,1,function(){i.playAction()}),[2,new Promise(function(e){var t=new egret.ColorMatrixFilter([1,0,0,0,200,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);i.gp_model.filters=[t],egret.setTimeout(function(){i.gp_model.filters=[],e()},i,150)})]})})},o.prototype.handleDead=function(){},o.prototype.dismiss=function(){var i=this;return new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){i.alpha=1,i.visible=!1},!0)})},Object.defineProperty(o.prototype,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(0===(this._CMOffsetFactor=e))this.gp_model.filters=[],this.rgbOriginValue=[];else{if(!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.gp_model.filters=[t]}var i=this.gp_model.filters[0].matrix,a=0;8&this.objCMColorType?(4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),null!=this.rgbOriginValue[0]&&(i[0]=this.rgbOriginValue[0]*(1-e)),null!=this.rgbOriginValue[1]&&(i[6]=this.rgbOriginValue[1]*(1-e)),null!=this.rgbOriginValue[2]&&(i[12]=this.rgbOriginValue[2]*(1-e))):(4&this.objCMColorType&&(i[4]=255*e,a|=4),2&this.objCMColorType&&(i[9]=255*e,a|=2),1&this.objCMColorType&&(i[14]=255*e,a|=1),4&~a&&(void 0===this.rgbOriginValue[0]&&(this.rgbOriginValue[0]=i[0]),i[0]=this.rgbOriginValue[0]/3*e),2&~a&&(void 0===this.rgbOriginValue[1]&&(this.rgbOriginValue[1]=i[6]),i[6]=this.rgbOriginValue[1]/3*e),1&~a&&(void 0===this.rgbOriginValue[2]&&(this.rgbOriginValue[2]=i[12]),i[12]=this.rgbOriginValue[2]/3*e)),this.gp_model.filters[0].matrix=i}},enumerable:!0,configurable:!0}),o.prototype.setZOrder=function(e){e&&this.parent.setChildIndex(this,-1)},o.prototype.resetAfterSeq=function(e){void 0===e&&(e=!1),this.isComboing=e,this.isComboing||(this.x=this.modelPos[1][0],this.y=this.modelPos[1][1])},o.prototype.onOPReset=function(){this.totalCurOnAttackFrameCount=0,this.ress.splice(0),this.modelQueue.splice(0),egret.Tween.removeTweens(this),this.gp_model.removeChildren()},o.prototype.onOPComeBack=function(e,t){var i=this;this.visible=!1,this.curEntity=e.entity,this.config=game.Config.allMagicalConfig()[this.curEntity.code],this.camp=e.camp,this.isLeftCamp=e.isLeftCamp,this.pb_anger.value=this.curEntity.anger,this.pb_anger.minimum=0,this.pb_anger.maximum=this.curEntity.angerMax;var a=void 0;a=""==this.config.model?"shenbing_img_wuqi01":this.config.model,this.modelQueue.push(a),RES.getResAsync(ResourceUtils.png(a),function(e){var t=new eui.Image;t.source=e,i.display=t,i.width=i.gp_model.width=Math.abs(e.textureWidth*t.scaleX),i.height=i.gp_model.height=Math.abs(e.textureHeight*t.scaleY),t.x=0,t.y=i.gp_model.height/2,i.gp_model.addChild(t),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height,i.fightTools.calEntityPosToView(i),i.modelPos=[[i.x,i.y-i.height/2],[i.x,i.y],[i.x,i.y],[i.x,i.y]],i.onModelCreate()},this),this.zorder=1e3,this.fightTools.calEntityZOrderToView(this)},o.prototype.onOPClean=function(){},o.prototype.onOPCheck=function(e){egret.log("alive")},o);function o(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var i=a.call(this)||this;return i.isFightMagical=!0,i.fightTools=game.FightTools.getInstance(),i.isLeftCamp=!1,i.totalCurOnAttackFrameCount=0,i.modelPos=[],i.flyBackDelay=600,i.allAttkDelay=0,i.rgbOriginValue=[],i.isComboing=!1,i.skinName="FightModelSkin",i.modelQueue=new Array,i.buffQueue={},i.ress=new Array,i.fightProxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),i}e.FightMagical=n}(customui=customui||{}),function(v){var e=(t.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightModel",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},t);function t(){}v.FightModelFactory=e;var a,i=(a=eui.Component,__extends(n,a),n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【FightModel】："].concat(e))},n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.pb_hp.slideDuration=250},n.prototype.onModelCreate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.visible=!0,this.display.animation.timeScale=Number(Utils.TimerManager.getTimeScale()),[4,this.appear()];case 1:return e.sent(),this.playAction(),game.AppFacade.getInstance().sendNotification(CN.FIGHT_MODEL_CREATED,this.curEntity.entityId),[2]}})})},n.prototype.checkCurBuffStatus=function(){this.display&&(1&this.curBuffStatus?this.display.animation.stop():this.display&&!this.display.animation.isPlaying&&this.playAction()),2&this.curBuffStatus?UIActionManager.setAbsGrey(this.gp_model):8&this.curBuffStatus?this.gp_model.filters=[this.fightTools.fenShenColorFlilter]:this.gp_model.filters=[],4&this.curBuffStatus?this.gp_model.alpha=.5:this.gp_model.alpha=1},n.prototype.gotoAndPlayByFrame=function(e,t,i,a){this.display&&this.display.animation.gotoAndPlayByFrame(e,t,i)},n.prototype.playAction=function(e,t,i){var a=this;this.display&&(i&&(this.onModelComplete=function(){a.checkCurBuffStatus(),a.onModelComplete=void 0,i()}),this.display.animation.play(e||MODEL_ACTION_NAME.DJ,t))},n.prototype.updataSpeed=function(e){this.parent&&this.display&&(this.display.animation.timeScale=(e||1)*Number(Utils.TimerManager.getTimeScale()))},n.prototype.updateBuffBeforAttack=function(e){return!0},n.prototype.updateEntity=function(e){this.curEntity.life=this.pb_hp.value=Math.max(e.life,0),null!=e.anger&&(this.curEntity.anger=this.pb_anger.value=e.anger),this.updateAngerEff()},n.prototype.updateAngerEff=function(){this.display_nengliangtiao&&(this.display_nengliangtiao.visible=this.pb_anger.value>=this.pb_anger.maximum)},n.prototype.pushCurOnAttackFrame=function(e){this.ress.push(e),this.totalCurOnAttackFrameCount=this.ress.length},n.prototype.onAttackFrame=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=1),0!=this.ress.length)if(1<t)e==t?this.onAttackFrame():e%Math.max(1,Math.floor(t/this.totalCurOnAttackFrameCount))==0&&this.handleSeqBattleRes(this.ress.shift(),game.FightState.ATTACK_ING);else{for(var i=0,a=this.ress;i<a.length;i++){var n=a[i];this.handleSeqBattleRes(n,game.FightState.ATTACK_ING)}this.ress.splice(0)}},n.prototype.popSth=function(e,t){if(void 0===t&&(t=0),this.parent){if(e&&0!=e||t){var i=v.FightPopTipsFactory.create({camp:this.camp,timeScale:Utils.TimerManager.getTimeScale(),content:e,status:t,x:this.x,y:this.y-this.height/2-30*this.popIndex++,height:this.height});this.fightTools.gp_battle_up.addChildAt(i,-1)}}else egret.error("该模型已经被移除，不能飘字",e,t)},n.prototype.handleSeqBattleRes=function(e,t){var i=e.value;this.popSth(i,e.status),i<0&&this.shouji(),this.handleBuff(e.buffAdd,e.buffRemove,t),this.updateEntity(e)},n.prototype.handleBuff=function(e,t,m){var y=this;if(e){function i(a){var e=game.Config.buffResConfig()[a.type];if(!e)return"continue";if(m==game.FightState.ROUND_END)_.log("handleBuff game.FightState.ROUND_END",a.value),_.popSth(a.value),a.value<0&&_.shouji();else{var n=game.Config.skillConfig().buff[e.type],o=1,t=0,i=void 0,s=0,r=!1;if(n&&n.hasDerma&&n.dermaConfigs){var h=game.GameMVC.fightMed.getFightModelById(a.value);n=h&&0<h.curDermaIndex?(r=!0,n.dermaConfigs[h.curDermaIndex]):n.dermaConfigs[0]}if(n){if(n.popValue&&(_.popSth(a.value),a.value<0&&_.shouji(),n.popValueAndBreak))return"continue";if(null!=n.fixedScaleX&&(o=n.fixedScaleX),n.pz&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:n.pz}),n.buffStatus&&(_.curBuffStatus|=n.buffStatus),t=2==n.posType?_.height:-20,n.campScale&&_.camp==EBattleSide.EBattleSideDefence&&(o=-1),n.fixedIcon)if(_.buffType2EffDict[a.type])_.buffType2EffDict[a.type].count++;else{var l=new eui.Image;l.source=e.icon,l.bottom=_.height-t,l.horizontalCenter=0,l.scaleX=o,_.buffType2EffDict[a.type]={objs:[l],c:n,count:1},_.addChildAt(l,_.getChildIndex(_.gp_model)+1)}if(n.noIcon&&(_.buffType2EffDict[a.type]?_.buffType2EffDict[a.type].count++:_.buffType2EffDict[a.type]={c:n,count:1}),s=n.effs?1:0,i=n.modelRep,n.hideInfo&&(_.gp_head.visible=!1),n.fixedModelDisplayScaleX&&_.buffType2EffDict[a.type]&&1==_.buffType2EffDict[a.type].count&&(_.display.scaleX*=n.fixedModelDisplayScaleX),!n.fenShen||(h=game.GameMVC.fightMed.getFightModelById(_.fightProxy.seqAttack.entityId))&&_.fightTools.showFenShen(h,_,n.fenShenTimeScale),n.fuchouzhihun&&(h=game.GameMVC.fightMed.getFightModelById(a.value))){var c=void 0,d=void 0;h.curDermaIndex?c="hero_skin_091_01_tz":(c=h.modelQueue[h.modelQueue.length-1]||"hero_091_01",d=_.fightTools.fenShenColorFlilter),i={preEff:n.fuchouzhihun.preEff,model:c,filters:d}}}if(n&&n.fixedIcon)return"continue";var p=e.modelId;if(!r&&e.dermaModelId&&null!=_.curDermaIndex&&(p=JSON.parse(e.dermaModelId)[_.curDermaIndex-1]||p),p||i)if(_.buffType2EffDict[a.type])n&&!n.notInsert&&_.buffType2EffDict[a.type].count++;else if(n&&!n.notInsert&&(_.buffType2EffDict[a.type]={objs:[],c:n,count:1}),s){function g(i){DragonBoneTools.create(i.src,function(e){if(n&&!n.notInsert){if(!y.buffType2EffDict[a.type])return;y.buffType2EffDict[a.type].objs.push(e)}e.x=y.width/2,e.scaleX=o,2==i.posType?e.y=y.height:e.y=-20,i.offset&&(e.x+=i.offset[0],e.y+=i.offset[1]),e.animation.timeScale=Utils.TimerManager.getTimeScale();var t=y.gp_model;i.parent&&"this"==i.parent&&(t=y),null!=i.z?t.addChildAt(e,i.z):t.addChild(e),n?e.animation.play(i.src,null==n.playTimes?-1:n.playTimes):e.animation.play(i.src)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}for(var u=0,f=n.effs;u<f.length;u++)g(f[u])}else i?_.modelRep(i):DragonBoneTools.create(p,function(e){if(n&&!n.notInsert){if(!y.buffType2EffDict[a.type])return;y.buffType2EffDict[a.type].objs.push(e)}e.scaleX=o,e.x=y.width/2,e.y=t,e.animation.timeScale=Utils.TimerManager.getTimeScale(),y.gp_model.addChild(e),n?e.animation.play(p,null==n.playTimes?-1:n.playTimes):e.animation.play(p)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1});else e.icon&&(_.buffType2Obj[e.type]?_.buffType2Obj[e.type].jiayi():(_.buffType2Obj[e.type]=v.FightBuffIconFactory.create({icon:e.icon}),_.gp_buffs.addChild(_.buffType2Obj[e.type])))}}for(var _=this,a=0,n=e;a<n.length;a++)i(n[a])}t&&t.forEach(function(e,t){var i=this.buffType2EffDict[e];if(i){if(null==i.count||--i.count<=0){if(i.c){if(i.c.buffStatus&&(this.curBuffStatus^=i.c.buffStatus),!i.c.noIcon&&Array.isArray(i.objs))for(var a=0,n=i.objs;a<n.length;a++){var o=n[a];o.parent&&o.parent.removeChild(o)}if(i.c.modelRep&&this.modelRep(i.c.modelRep,!0),i.c.hideInfo&&(this.gp_head.visible=!0),i.c.fixedModelDisplayScaleX&&(this.display.scaleX/=i.c.fixedModelDisplayScaleX),i.c.buffSubEff){var s=0;s=2==i.c.buffSubEff.posType?this.height:-20,DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,z:i.c.buffSubEff.z,timeScale:this.timeScale,x:this.width/2,y:s,effectName:i.c.buffSubEff.src,parent:this.gp_model})}}delete this.buffType2EffDict[e]}}else(i=this.buffType2Obj[e])&&i.jianyi()&&(this.gp_buffs.removeChild(i),delete this.buffType2Obj[e])},this),this.checkCurBuffStatus()},n.prototype.modelRep=function(h,e,l){var c=this;void 0===e&&(e=!1),void 0===l&&(l=!1);var d,p=void 0;if(this.curEntity.dermaCode){var t=game.Config.getHeroDermaConfig(this.curEntity.dermaCode);t&&(p=t.model)}else p=this.config.model;h.modelExt?p+=h.modelExt:p=h.model,d=h.preEff,e?(this.modelQueue.splice(this.modelQueue.indexOf(p),1),p=this.modelQueue[this.modelQueue.length-1]):this.modelQueue.push(p),DragonBoneTools.createForHero(p,function(e){var t=void 0,i=c.gp_model.width,a=c.gp_model.height;c.display&&(t=c.display.parent.getChildIndex(c.display),c.display.parent.removeChild(c.display),c.display=void 0,d&&DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,timeScale:Utils.TimerManager.getTimeScale(),x:c.modelPos[1].x,y:c.modelPos[1].y,effectName:d,parent:c.gp_model})),(c.display=e).addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){c.onModelFrameEvent&&c.onModelFrameEvent(e)},c),e.addEventListener(dragonBones.EventObject.COMPLETE,function(e){c.onModelComplete&&c.onModelComplete()},c);var n=1;c.camp==EBattleSide.EBattleSideDefence&&(n=-1),e.scaleX=.5*n,e.scaleY=.5,c.width=c.gp_model.width=Math.abs(e.width*e.scaleX);var o=game.Config.heroModelOffsetConfig(p);if(o?(c.flyBackDelay=o.flyBackDelay?o.flyBackDelay:c.flyBackDelay,c.allAttkDelay=o.allAttkDelay?o.allAttkDelay:0,c.gp_head.bottom=o.headOY*e.scaleY,c.gp_head.horizontalCenter=o.headOX*e.scaleY,c.height=c.gp_model.height=o.headOY*e.scaleY):c.height=c.gp_model.height=FIGHT_CONST.DEFAULT_HEAD_OY*e.scaleY,e.x=c.gp_model.width/2,e.y=c.gp_model.height,null!=t?c.gp_model.addChildAt(e,t):c.gp_model.addChild(e),c.anchorOffsetX=c.width/2,c.anchorOffsetY=c.height,c.fightTools.calEntityPosToView(c),c.modelPos=[[c.x,c.y-c.height/2],[c.x,c.y],[o&&o.attkOX||0,0],[c.x+(o&&o.shejiOX*n||0),c.y+(o&&o.shejiOY||0)],[c.x,c.y-c.height]],(c.gp_model.width!=i||c.gp_model.height!=a)&&0<Object.keys(c.buffType2EffDict).length)for(var s in i=(c.gp_model.width-i)/2,a=(c.gp_model.height-a)/2,c.buffType2EffDict){var r=c.buffType2EffDict[s];r&&Array.isArray(r.objs)&&r.objs.forEach(function(e){e.x+=i,e.y+=a})}l?c.onModelCreate():(c.display.animation.timeScale=Number(Utils.TimerManager.getTimeScale()),c.playAction()),h.filters&&(e.filters=[h.filters])},this)},n.prototype.releaseSkill=function(e,i,a,n,t,o){void 0===t&&(t=!1),void 0===o&&(o={}),this.log("battle releaseSkill",e),this.isComboing=t;var s="",r=game.Config.skillBaseConfig()[e];if("string"==typeof e?s=e:(s=r&&r.modelId||"",null!=this.curDermaIndex&&r&&r.dermaModelId&&(s=JSON.parse(r.dermaModelId)[this.curDermaIndex-1]||s)),""==s)return egret.warn("该技能"+e+"没有配置模型"),void egret.setTimeout(function(){for(var e=0,t=i;e<t.length;e++)t[e].onAttackFrame();n(),a()},this,1e3);var h=game.Config.skillConfig()[s];if(h||(egret.warn("该技能"+s+"还没调，使用临时技能"),h=game.Config.skillConfig().common_skill_zhanzhengnuhou),!this.fightProxy.seqAttack.ext||""==this.fightProxy.seqAttack.ext||1==JSON.parse(this.fightProxy.seqAttack.ext).noaction&&(h=game.Config.skillConfig()[s+"_ext_noaction"]),r&&r.sound&&""!=r.sound){var l=JSON.parse(r.sound)||[],c=l[0];null!=this.curDermaIndex&&l[this.curDermaIndex]&&(c=l[this.curDermaIndex]),c&&RES.hasRes(c)&&RES.getResAsync(c,function(e){Utils.SoundManager.playSound(c)},this)}this.fightTools.handleSkill(this,i,h,a,n,t,o)},n.prototype.holdOn=function(a,n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){egret.setTimeout(function(){i&&i.parent&&(n&&n(),e())},i,a/Utils.TimerManager.getTimeScale())})]})})},n.prototype.appear=function(){var i=this;return new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){e()})})},n.prototype.shouji=function(){var t=this;this.markCurFrameNeedShouJi||(this.markCurFrameNeedShouJi=!0),this.once(egret.Event.ENTER_FRAME,function(){t.playAction(MODEL_ACTION_NAME.SJ,1,function(){t.playAction()});var e=new egret.ColorMatrixFilter([1,0,0,0,200,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);t.gp_model.filters=[e],egret.setTimeout(function(){t.gp_model.filters=[],t.checkCurBuffStatus()},t,150),t.markCurFrameNeedShouJi=!1},this)},n.prototype.handleDead=function(e){var i=this;if(this.stage&&(this.popIndex=0,this.ress.splice(0),!(0<this.curEntity.life)))return this.log("死掉了",this.curEntity.entityId),new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){i.parent&&i.parent.contains(i)&&i.parent.removeChild(i)},!0)})},Object.defineProperty(n.prototype,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(0===(this._CMOffsetFactor=e))this.gp_model.filters=[],this.rgbOriginValue=[];else{if(!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.gp_model.filters=[t]}var i=this.gp_model.filters[0].matrix,a=0;8&this.objCMColorType?(4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),null!=this.rgbOriginValue[0]&&(i[0]=this.rgbOriginValue[0]*(1-e)),null!=this.rgbOriginValue[1]&&(i[6]=this.rgbOriginValue[1]*(1-e)),null!=this.rgbOriginValue[2]&&(i[12]=this.rgbOriginValue[2]*(1-e))):(4&this.objCMColorType&&(i[4]=255*e,a|=4),2&this.objCMColorType&&(i[9]=255*e,a|=2),1&this.objCMColorType&&(i[14]=255*e,a|=1),4&~a&&(void 0===this.rgbOriginValue[0]&&(this.rgbOriginValue[0]=i[0]),i[0]=this.rgbOriginValue[0]/3*e),2&~a&&(void 0===this.rgbOriginValue[1]&&(this.rgbOriginValue[1]=i[6]),i[6]=this.rgbOriginValue[1]/3*e),1&~a&&(void 0===this.rgbOriginValue[2]&&(this.rgbOriginValue[2]=i[12]),i[12]=this.rgbOriginValue[2]/3*e)),this.gp_model.filters[0].matrix=i}},enumerable:!0,configurable:!0}),n.prototype.setZOrder=function(e){this.fightTools.resortZOrder()},n.prototype.resetAfterSeq=function(e){void 0===e&&(e=!1),this.isComboing=e,this.x=this.modelPos[1][0],this.y=this.modelPos[1][1]},n.prototype.onOPReset=function(){for(var e in this.buffType2EffDict)if(Array.isArray(this.buffType2EffDict[e].objs))for(var t=0,i=this.buffType2EffDict[e].objs;t<i.length;t++){var a=i[t];a.parent&&a.parent.removeChild(a)}this.hero_soundchannel&&(this.hero_soundchannel.stop(),this.hero_soundchannel=void 0),this.allAttkDelay=this.flyBackDelay=0,this.curDermaIndex=void 0,this.gp_model.alpha=1,this.scaleX=this.scaleY=1,this.alpha=1,this.curBuffStatus=0,this.gp_buffs.removeChildren(),this.buffType2Obj={},this.buffType2EffDict={},this.totalCurOnAttackFrameCount=0,this.popIndex=0,this.ress.splice(0),this.modelQueue.splice(0),this.display_nengliangtiao&&this.display_nengliangtiao.parent==this.gp_head&&this.gp_head.removeChild(this.display_nengliangtiao),this.gp_head.visible=!0,this.display_nengliangtiao=void 0,this.display=void 0,egret.Tween.removeTweens(this),this.gp_model.removeChildren(),this.checkCurBuffStatus()},n.prototype.onOPComeBack=function(e,t){var i=this;this.visible=!1,this.curEntity=e.entity,this.config=this.fightProxy.getConfigByFightEntity(this.curEntity),this.camp=e.camp,this.curEntity.type==BattleEntityType.Boss?this.scaleX=this.scaleY=FIGHT_CONST.FIGHT_POS[this.fightProxy.positionTypes[this.camp]].BossScale||this.scaleX:this.scaleX=this.scaleY=.9,this.pb_anger.value=this.curEntity.anger,this.pb_anger.minimum=0,this.pb_anger.maximum=this.curEntity.angerMax,this.pb_hp.value=this.curEntity.life,this.pb_hp.minimum=0,this.pb_hp.maximum=this.curEntity.lifeMax,this.img_type.source=HeroRaceConfig[this.config.race].raceIcon,this.lb_lv.text=this.curEntity.level&&this.curEntity.level.toString(),this.voiceGJName=this.config.voiceGJ;var a=void 0;if(""==this.config.model)a="hero_020_01";else if(a=this.config.model,this.curEntity.dermaCode){var n=game.Config.getHeroDermaConfig(this.curEntity.dermaCode);n&&(a=n.model,this.voiceGJName=n.voiceGJ,this.curDermaIndex=n.index)}DragonBoneTools.create("common_skill_nengliangtiaoman",function(e){(i.display_nengliangtiao=e).x=90,e.y=20,i.gp_head.addChild(e),e.animation.play("common_skill_nengliangtiaoman"),i.display_nengliangtiao.visible=!1,i.updateAngerEff()}),this.modelRep({model:a},void 0,!0),this.fightTools.calEntityZOrderToView(this)},n.prototype.onOPClean=function(){},n.prototype.onOPCheck=function(e){this.log("alive")},n);function n(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var i=a.call(this)||this;return i.isFightMagical=!1,i.fightTools=game.FightTools.getInstance(),i.modelPos=[],i.flyBackDelay=600,i.allAttkDelay=0,i.rgbOriginValue=[],i.curBuffStatus=0,i.isComboing=!1,i.markCurFrameNeedShouJi=!1,i.popIndex=0,i.totalCurOnAttackFrameCount=0,i.skinName="FightModelSkin",i.buffType2Obj={},i.buffType2EffDict={},i.ress=new Array,i.modelQueue=new Array,i.fightProxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),i}v.FightModel=i}(customui=customui||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightPopTips",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.FightPopTipsFactory=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.reset=function(){egret.Tween.removeTweens(this),this.width=100,this.height=50,this.scaleX=this.scaleY=1,this.alpha=1,AnchorUtil.calculateAndSetAr(this),this.blb.scaleX=this.blb.scaleY=1,this.img_status.source="",this.blb.visible=!1,this.blb.x=0,this.img_status.y=this.blb.y=this.height/2},o.prototype.runRecoverAction=function(){var e=this,t=this.params,i=t.timeScale;this.alpha=0,egret.Tween.get(this).to({alpha:1,y:this.y-50},FIGHT_CONST.POP_TIPS_FLY/i).to({alpha:0,y:this.y-100},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){t.doneCB&&t.doneCB.call(e.params.context),e.parent.contains(e)&&e.parent.removeChild(e)},this)},o.prototype.runHurtAction=function(){var e=this,t=this.params,i=t.timeScale;this.params.camp==EBattleSide.EBattleSideAttack?this.factorO=[[0,0],[-15,-t.height/2],[-30,0]]:this.factorO=[[0,0],[15,-t.height/2],[30,0]],egret.Tween.get(this).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){e.params.camp==EBattleSide.EBattleSideAttack?e.factorO=[[-30,0],[-35,-t.height/5],[-40,0]]:e.factorO=[[30,0],[35,-t.height/5],[40,0]]},this).to({factor:0},0).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i/1.5).call(function(){e.params.camp==EBattleSide.EBattleSideAttack?e.factorO=[[-40,0],[-41.5,-t.height/8],[-42,0]]:e.factorO=[[40,0],[41.5,-t.height/8],[42,0]]},this).to({factor:0},0).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i/3).to({alpha:0},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){t.doneCB&&t.doneCB.call(this.params.context),this.parent.contains(this)&&this.parent.removeChild(this)},this)},o.prototype.initUI=function(){this.root=new eui.Group,this.blb=new eui.BitmapLabel,this.root.addChild(this.blb),this.img_status=new eui.Image,this.root.addChild(this.img_status),this.root.verticalCenter=0,this.root.horizontalCenter=0,this.addChild(this.root)},o.prototype.onOPReset=function(){this.reset()},o.prototype.onOPComeBack=function(e,t){t&&this.initUI(),this.params=e,this.x=this.params.x,this.y=this.params.y-this.params.height/4,this.baseX=this.x,this.baseY=this.y;var i=Number(this.params.content),a=void 0,n=1;i&&(i<0?a=2&this.params.status?(this.blb.scaleX=this.blb.scaleY=1.5,"fight_yellow_fnt"):"fight_white_fnt":0<i&&(a="fight_green_fnt",n=2),this.blb.visible=!0,this.blb.font=a,this.blb.text=Math.abs(i).toString()),16&this.params.status&&(this.img_status.source="_fight_m_json.zhandou_txt_diushi",this.blb.x=100),4&this.params.status&&(this.img_status.source="_fight_m_json.zhandou_txt_gedang",this.blb.x=100),2&this.params.status&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:5}),1&this.params.status&&(this.img_status.source="_fight_m_json.icon_buff_sb",this.blb.x=70),1==n?this.runHurtAction():this.runRecoverAction()},o.prototype.onOPClean=function(){},o.prototype.onOPCheck=function(e){egret.log("alive")},Object.defineProperty(o.prototype,"factor",{get:function(){return 0},set:function(e){this.factorO&&(this.x=(1-e)*(1-e)*(this.baseX+this.factorO[0][0])+2*e*(1-e)*(this.baseX+this.factorO[1][0])+e*e*(this.baseX+this.factorO[2][0]),this.y=(1-e)*(1-e)*(this.baseY+this.factorO[0][1])+2*e*(1-e)*(this.baseY+this.factorO[1][1])+e*e*(this.baseY+this.factorO[2][1]))},enumerable:!0,configurable:!0}),o);function o(e){var t=a.call(this)||this;return t.factorO=[],t}e.FightPopTips=n}(customui=customui||{}),function(i){var t,p=(t=BasePanel,__extends(a,t),a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.cu_xtck.blb_title.text="战斗记录",this.cu_xtck.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1},a.prototype.updateView=function(e){var t=this;this.params=e,a.curTeamId=e.curTeamId,a.tips=e.tips||"排名",this.params.records?this.updateList(this.params.records):this.fightPy.CommonFightRecord(this.params.pb1,this.params.pb2,this.params.key,function(e){t.updateList(e)})},a.prototype.updateList=function(e){var i=this;this.sl_root.removeChildren();var t=new eui.List,a=new eui.VerticalLayout;a.gap=10,a.paddingBottom=a.paddingTop=10,a.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=a,this.sl_root.viewport=t;var n=new eui.ArrayCollection,o=0;e.forEach(function(e){var t=e;t.index=o,t.moduleId=i.params&&i.params.moduleId,t.isGradeType=i.params&&i.params.isGradeType,n.addItem(t),++o}),n.source.sort(function(e,t){return t.battleDt-e.battleDt}),this.gp_empty.visible=0==n.length,t.dataProvider=n,t.itemRenderer=s},a);function a(){var e=t.call(this)||this;return e.fightPy=i.AppFacade.getInstance().retrieveProxy(i.FightPy.N),e.skinName="FightRecordPanelSkin",e}i.FightRecordPanel=p;var n,s=(n=eui.ItemRenderer,__extends(e,n),e.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.data.memberRecords;t.data.moduleId&&t.data.moduleId==MODULE.TeamArena&&0<e.length?PopUpManager.addPopUp({obj:new i.FightRecordPreviewPanel({index:t.data.index})}):t.proxy.BattlePlayBack(t.vo?t.vo.battleUuid:t.vo2.battleUuids)},this),this.lb_tips.text=p.tips,this.gp_heads.addChild(this.cu_playerHead1);var e=.7;p.curTeamId&&(e=.6),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=e},e.prototype.dataChanged=function(){var e,a=this;if(this.data.teamId){this.vo2=this.data,this.lb_name.text=this.vo2.team.name,e=this.vo2.challengerTeamId!=p.curTeamId?this.vo2.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.vo2.result;for(var t=this.vo2.team.members,i=0,n=0,o=0,s=t;o<s.length;o++)i+=s[o].baseInfo.fightCap,++n>=t.length&&(this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(i));if(this.gp_heads.numChildren<this.vo2.team.members.length)for(var r=this.vo2.team.members.length-this.gp_heads.numChildren;0<r;r--){var h=customui.PlayerHeadFactory.create(),l=.7;p.curTeamId&&(l=.6),h.scaleX=h.scaleY=l,this.gp_heads.addChild(h)}this.gp_heads.$children.forEach(function(e,t){var i=a.vo2.team.members[t];e.updateData({vo:i&&i.baseInfo,showTag:i&&i.isLeader})});var c=Number(this.vo2.rKey)-Number(this.vo2.pKey);0<c?(this.lb_change.textColor=4027448,this.lb_change.text=c.toString()):c<0?(this.lb_change.textColor=13107200,this.lb_change.text=c.toString()):(this.lb_change.textColor=6304792,this.lb_change.text="不变"),this.lb_time.visible=!1}else this.vo=this.data,this.lb_name.text=this.vo.baseInfo.name,e=this.vo.result,this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.cu_playerHead1.updateData({vo:this.vo.baseInfo}),this.data.isGradeType?this.vo.rKey<this.vo.pKey||0==this.vo.pKey?(this.lb_change.textColor=13107200,this.lb_change.text=this.vo.rKey.toString()):this.vo.rKey>this.vo.pKey?(this.lb_change.textColor=4259633,this.lb_change.text=this.vo.rKey.toString()):(this.lb_change.textColor=6304792,this.lb_change.text="不变"):this.vo.rKey<this.vo.pKey||0==this.vo.pKey?(this.lb_change.textColor=4259633,this.lb_change.text=this.vo.rKey.toString()):this.vo.rKey>this.vo.pKey?(this.lb_change.textColor=13107200,this.lb_change.text=this.vo.rKey.toString()):(this.lb_change.textColor=6304792,this.lb_change.text="不变"),this.lb_time.visible=!0;var d=this.vo||this.vo2;e===EBattleResult.EBattleResultWin?this.img_result.source="jjc_icon_sheng_png":this.img_result.source="jjc_icon_bai_png",this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-d.battleDt)},e);function e(){var e=n.call(this)||this;return e.skinName=p.curTeamId?"FightRecordPanelSkin_2":"FightRecordPanelSkin_1",e.proxy=i.AppFacade.getInstance().retrieveProxy(i.FightPy.N),e.pPy=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),e.cu_playerHead1=customui.PlayerHeadFactory.create(),e}}(game=game||{}),function(i){var a,e=(a=BasePanel,__extends(t,a),t.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.initView()},t.prototype.initView=function(){var e=this.data.record,t=e.challengerTeam.members,i=e.team.members,a=i.length;if(0==a)return Utils.MsgUtils.addMidMsg("暂无数据"),void PopUpManager.removePopUp(this);function n(e,t,i,a){for(var n=0,o=i;n<o.length;n++){var s=void 0,r=o[n].baseInfo,h=1==a?t.challengerId:t.beChallengerId,l=1==a?t.cHeroList:t.bHeroList;if(h==r.playerId){s={name:r.name,avatar:r.avatar,result:t.result,heroList:l},e.push(s);break}}}0<a&&a<2&&this.gp_all.removeChild(this.img_fenge_2);for(var o=0,s=0,r=0,h=0,l=e.memberRecords;h<l.length;h++){var c=l[h];if(c.battleUuid){++s,c.result==EBattleResult.EBattleResultWin&&++r;var d=this["gp_items_"+o],p={team:[],uuid:c.battleUuid,index:o,resultData:{result:c.result,winC:r,loseC:s-r}};n(p.team,c,t,1),n(p.team,c,i,2);var g=new customui.RecordPreviewItem;g.updateData(p),d.addChild(g),++o}}this.gp_root.height+=40},t);function t(e){var t=a.call(this)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.FightPy.N),t.battleZoneAreanPy=i.AppFacade.getInstance().retrieveProxy(i.BattleZoneArenaPy.N),t.skinName="FightRecordPreviewSkin",t.data=e,t}i.FightRecordPreviewPanel=e}(game=game||{}),function(_){var i,e=(i=BasePanel,__extends(t,i),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),this.closeTimer&&egret.clearInterval(this.closeTimer),this.autoCloseScheId&&(egret.clearInterval(this.autoCloseScheId),this.autoCloseScheId=void 0),this.doneCB&&this.doneCB(),_.AppFacade.getInstance().sendNotification(CN.REWARD_CLOSE,{result:this.result}),_.AppFacade.getInstance().sendNotification(CN.FIGHT_RESULT_CLOSE,{result:this.result})},t.prototype.updateView=function(e,t){var i=this;void 0===t&&(t=!1),this.params=e,this.doneCB=e.doneCB,this.context=e.context,this.customParams=e.customParams,this.normalRewards=e.normalRewards,this.extRewards=e.extRewards,this.result=e.result,this.tips=e.tips||this.customParams&&this.customParams.tips,this.hurt=e.hurt,this.star=e.star,this.gp_new.y=(this.gp_main.height-this.gp_new.height)/2-100,this.gp_ret_0.visible=!0,this.gp_ret_1.visible=!1,this.btn_ok.visible=!0,this.fightPy.playbackResult&&(this.params=this.fightPy.playbackResult,this.result=this.fightPy.playbackResult.result);var a=this.params.battleType;if(0<=[EBattleType.EBattleTypePvP,EBattleType.EBattleTypeTeamArena,EBattleType.EBattleTypeTribeBattle].indexOf(a))return this.pvpResultData(),void this.displayNumbersVS();this.normalRewards&&0<this.normalRewards.length&&this.extRewards&&0<this.extRewards.length?console.log("爆机啦"):this.normalRewards&&0<this.normalRewards.length&&!(e.sClientReward&&0<e.sClientReward.length)||(this.sClientReward=e.sClientReward);var n=!1;switch(a){case EBattleType.EBattleTypeTeamExpedition:this.teamExpePy.isInTeam()&&0<this.fightPy.multiFightOriginPushs.length&&(n=!0);break;case EBattleType.EBattleTypeDailyFortress:if(this.result==EBattleResult.EBattleResultWin){var o=_.AppFacade.getInstance().retrieveProxy(_.CopyEntrancePy.N),s=o.curFortessId,r=_.Config.dailyFortressStage()[s];(h=o.dailyFortressInfo[r.fortressId])&&0<h.leftChallenge&&(n=!0)}break;case EBattleType.EBattleTypeHeroChallenge2:var h;if(this.result==EBattleResult.EBattleResultWin&&(h=this.fightPy.lastsFinalBattleResultVO.cbRet.info)&&!h.waitSelect.length){var l=_.GameMVC.heroChallenge2Py,c=h.code,d=_.Config.heroChallengeStage(c);n=d&&d.model==l.curMode&&!h.clear}break;case EBattleType.EBattleTypeChampion:this.result==EBattleResult.EBattleResultWin&&2!=this.championProxy.championInfo.id&&(n=!0);break;case EBattleType.EBattleTypeAbyssLair:n=!0}if(n?function(){if(i.gp_next.visible=!0,a==EBattleType.EBattleTypeTeamExpedition?(i.btn_ok.visible=!1,i.gp_next.x=i.gp_new.width/2):i.btn_ok.horizontalCenter=-125.5,a==EBattleType.EBattleTypeDailyFortress)i.cb_needGuide.visible=!1;else if(i.cb_needGuide.visible=!0,i.cb_needGuide.selected=a==EBattleType.EBattleTypeDailyFortress||a!=EBattleType.EBattleTypeTeamExpedition?i.championProxy.isZiDong:i.teamExpePy.isZiDong,i.cb_needGuide.selected){i.timer&&egret.clearInterval(i.timer);var e=5;i.timer=egret.setInterval(function(){0<--e?i.cb_needGuide.label="自动战斗（"+e+"s）":i.nextFight()},i,1e3)}}():(this.gp_next.visible=!1,this.btn_ok.horizontalCenter=0),e.autoClose){var p=5;this.lb_closeCd.visible=!0,this.lb_closeCd.text="等待关闭："+p+"秒",this.closeTimer=egret.setInterval(function(){0<p?i.lb_closeCd.text="等待关闭："+--p+"秒":i.hide()},this,1e3)}var g=new eui.List;this.sl_reward.viewport=g;var u=new eui.TileLayout;u.horizontalGap=15,u.horizontalAlign=egret.HorizontalAlign.CENTER,u.verticalAlign=egret.VerticalAlign.MIDDLE,u.verticalGap=10,u.requestedColumnCount=4,u.requestedRowCount=2,g.layout=u,g.itemRenderer=v,this.sl_reward.verticalScrollBar.visible=!1,this.sl_reward.verticalScrollBar.autoVisibility=!1;var f=new eui.ArrayCollection;if(this.sClientReward&&this.sClientReward.heros&&this.sClientReward.heros.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHero,code:e.code,num:1})}),this.sClientReward&&this.sClientReward.heroEquips&&0<this.sClientReward.heroEquips.length&&this.sClientReward.heroEquips.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHeroEquip,code:e.code,num:1})}),this.sClientReward&&this.sClientReward.heroArtifacts&&0<this.sClientReward.heroArtifacts.length&&this.sClientReward.heroArtifacts.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHeroArtifact,code:e.code,num:e.num||1})}),this.sClientReward&&this.sClientReward.maps&&0<this.sClientReward.maps.length&&this.sClientReward.maps.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeMap,code:e.code,num:1})}),this.sClientReward&&this.sClientReward.rewards&&0<this.sClientReward.rewards.length&&this.sClientReward.rewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),this.normalRewards&&0<this.normalRewards.length&&this.extRewards&&0<this.extRewards.length&&(this.normalRewards&&0<this.normalRewards.length&&this.normalRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),this.extRewards&&0<this.extRewards.length&&this.extRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})})),!(this.normalRewards&&0<this.normalRewards.length)||e.sClientReward&&0<e.sClientReward.length||this.extRewards&&0<this.extRewards.length||this.normalRewards&&0<this.normalRewards.length&&this.normalRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),0<f.length?(this.sl_reward.width=84*(5<=f.length?4:f.length)+15*((5<=f.length?4:f.length)-1),5<=f.length&&(this.sl_reward.height=198),this.sl_reward.x=(this.gp_new.width-this.sl_reward.width)/2):0!=f.length||this.result!=EBattleResult.EBattleResultWin||this.params.battleType!=EBattleType.EBattleTypeServerBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildTranscript&&this.params.battleType!=EBattleType.EBattleTypeNianShou||(this.gp_hurt.y=this.gp_ret_0.height/2),this.result===EBattleResult.EBattleResultLose){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shibai),DragonBoneTools.create("common_zhanbai_2",function(e){e.x=this.gp_bg.width/2,e.y=this.gp_bg.height/2-107,e.animation.play(),this.gp_bg.addChild(e)},this),this.sl_reward.visible=!1,this.gp_result.visible=!0,this.lb_hints.visible=!1;var m=0;this.fightPy.reqFightParams.ignoreStringWay||(this.lb_hints.visible=!0,this.STRING_WAY.forEach(function(e){var t=new eui.Button;t.skinName="skins.ButtonSkinIcon",t.icon=e.icon,t.width=105,t.height=105,i["btn_"+m]=t,i.gp_result.addChild(i["btn_"+m]),++m}),this.addEvents()),this.gp_result.x=(this.gp_new.width-267)/2}else this.gp_result.visible=!1,this.sl_reward.visible=!0,this.lb_hints.visible=!1,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengli),DragonBoneTools.create("common_shengli_2",function(e){e.x=this.gp_bg.width/2,e.y=this.gp_bg.height/2-27,e.animation.play(),this.gp_bg.addChild(e)},this);this.hurtValueShow(),g.dataProvider=f,this.initPassWayBtns();var y=this.MILLSECOND;y&&(this.autoCloseScheId=egret.setInterval(function(){(y-=1e3)<=0&&(egret.clearInterval(i.autoCloseScheId),i.autoCloseScheId=void 0,i.hide())},this,1e3))},t.prototype.hurtValueShow=function(){if(0!=this.params.resultVo.teams.length){for(var e=this.params.resultVo.entityResults,t={},i=0,a=this.params.resultVo.teams[0].entities;i<a.length;i++){var n=a[i];t[n.entityId]=n.code}for(var o=0,s=0,r=e;s<r.length;s++){var h=r[s];t[h.entityId]&&(o+=h.totalHurt)}if(this.params.battleType!=EBattleType.EBattleTypeServerBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildBoss&&this.params.battleType!=EBattleType.EBattleTypeNianShou&&this.params.battleType!=EBattleType.EBattleTypeGuildTranscript||(this.gp_hurt.visible=!0,this.blb_hurt.text=""+(o||0)),this.params.battleType==EBattleType.EBattleTypeNianShou){var l=this.fightPy.lastsFinalBattleResultVO.cbRet;if(l&&l.info){var c=JSON.parse(l.info);c&&(this.gp_score.visible=!0,this.lb_score_name.text="功勋：",this.blb_score.text=""+(c.grade||0),this.gp_hurt.horizontalCenter=-80,this.gp_score.horizontalCenter=80)}}}else this.btn_statistics.visible=!1},t.prototype.pvpResultData=function(){var s=this;this.filter=this.params&&this.params.changeSkinType,this.blb_team_0.visible=!1,this.filter?(this.btn_statistics.visible=!1,this.gp_ret_1.y=265):this.gp_ret_1.y+=20;var r,h=this.params.battleType;function e(a){var e=r[a];function t(e){var t=customui.PlayerHeadFactory.create();t.scaleX=t.scaleY=.8;var i={avatar:e.avatar,frame:e.frame||"",level:e.level};t.updateData({vo:i}),s["gp_team_"+a].addChild(t)}if(l["gp_team_"+a].removeChildren(),h==EBattleType.EBattleTypeTeamArena&&l.filter)for(var i=0,n=r[a].members;i<n.length;i++){var o=n[i];t(o=o.baseInfo)}else t(e);l["lb_name_"+a].text=r[a].name}h==EBattleType.EBattleTypeTeamArena&&this.filter||(r=this.params.resultVo.teams);var l=this;for(var t in r)e(t);function n(e,t,i){var a=s["blb_"+e+"_1"],n=s["blb_"+e+"_2"];a.text=""+i;var o=t<=0?""+t:"+"+t;n.font=0<t?"green_num_fnt":"RedBlackStrocke_fnt",n.text=o}switch(h){case EBattleType.EBattleTypePvP:this.gp_score_0.visible=this.gp_score_1.visible=!1,this.blb_t_0.visible=this.blb_t_1.visible=!1;break;case EBattleType.EBattleTypeTeamArena:var i=_.AppFacade.getInstance().retrieveProxy(_.BattleZoneArenaPy.N),a=_.AppFacade.getInstance().retrieveProxy(_.FightPy.N).sFinalBattleResultVO,o="number"==typeof this.params.winC?this.params.winC:a.winC,c="number"==typeof this.params.loseC?this.params.loseC:a.totalC-a.winC;this.blb_team_0.visible=!0,this.blb_team_0.text=this.blb_team_0.text=o+":"+c,this.gp_score_0.visible=this.gp_score_1.visible=!1,this.blb_t_0.visible=this.blb_t_1.visible=!1,this.filter&&(function(e){if(s.filter){var t=e.latestRecord,i=t.rKey-t.pKey;n(0,i,t.rKey);var a=t.tRKey-t.tPKey;n(1,a,t.tRKey)}}(i),this.gp_score_0.visible=this.gp_score_1.visible=!0,this.blb_t_0.visible=this.blb_t_1.visible=!0,this.blb_t_0.text=this.blb_t_1.text="得分");break;case EBattleType.EBattleTypeTribeBattle:this.blb_t_0.text=this.blb_t_1.text="物资";var d=_.GameMVC.fightPy.lastsFinalBattleResultVO.cbRet.battleRecord,p=JSON.parse(d.keyStr),g=JSON.parse(d.tKeyStr);n(0,p.newGoods-p.oldGoods,p.newGoods),n(1,g.newGoods-g.oldGoods,g.newGoods)}},t.prototype.displayNumbersVS=function(){var i=this,e=this.params.battleType;function t(){i.btn_ok0.visible=!0,i.img_vs_bg.visible=!0,i.gp_bg.visible=!1,i.gp_vs.visible=!0;var e=i.result==EBattleResult.EBattleResultWin?"_fight_m_json.jiesuan_img_shenglidi":"_fight_m_json.jiesuan_img_shibaidi";i.img_vs_bg.source=e;var t=i.result==EBattleResult.EBattleResultWin?"common_shengli_21":"common_zhanbai_21";i.gp_vs_effect.removeChildren(),DragonBoneTools.create(t,function(e){e.x=this.gp_bg.width/2,e.y=this.result==EBattleResult.EBattleResultWin?e.height/2:e.height/2+100,e.animation.play(),this.gp_vs_effect.addChild(e)},i),egret.Tween.get(i.gp_ret_1).to({alpha:1},300)}switch(this.btn_ok.visible=!(e==EBattleType.EBattleTypePvP||e==EBattleType.EBattleTypeTeamArena),this.btn_oneMore.visible=!1,this.btn_ok.visible=!1,this.btn_next.visible=!1,e){case EBattleType.EBattleTypePvP:this.btn_ok0.visible=!0,this.gp_ret_0.visible=!1,this.gp_ret_1.visible=!0,this.btn_next.visible=this.btn_next.visible&&this.btn_ok.visible,this.btn_oneMore.visible=!0,t();break;case EBattleType.EBattleTypeTeamArena:this.btn_ok0.x=(this.gp_ret_1.width-this.btn_ok0.width)/2,this.gp_ret_1.visible=!0,this.gp_ret_1.alpha=0,e==EBattleType.EBattleTypeTeamArena?(this.gp_ret_0.visible=!1,t()):egret.Tween.get(this.gp_ret_0).wait(1e3).to({alpha:0},500).call(function(){i.gp_new.y-=100,t()});break;case EBattleType.EBattleTypeTribeBattle:this.gp_ret_0.visible=!1,this.gp_ret_1.visible=!0,this.btn_ok0.x=(this.gp_ret_1.width-this.btn_ok0.width)/2,t()}},t.prototype.nextFight=function(){if(this.params.battleType==EBattleType.EBattleTypeDailyFortress){var e=_.AppFacade.getInstance().retrieveProxy(_.CopyEntrancePy.N);this.fightPy.dailyFakeFight=!0;var t=e.curFortessId,i=_.Config.dailyFortressStage()[t];0<e.dailyFortressInfo[i.fortressId].leftChallenge?(e.ChallengeDailyFortress({id:t}),this.hide()):Utils.MsgUtils.addMidMsg("次数不足")}else if(this.params.battleType==EBattleType.EBattleTypeChampion)this.championProxy.isTwo=!0,this.hide();else if(this.params.battleType==EBattleType.EBattleTypeHeroChallenge2){var a=_.GameMVC.heroChallenge2Py;this.fightPy.dailyFakeFight=!0,a.Challenge(),this.hide()}else this.params.battleType==EBattleType.EBattleTypeTeamExpedition?this.hide():this.params.battleType==EBattleType.EBattleTypeAbyssLair&&this.hide()},t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,this.nextFight,this),this.btn_statistics.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.fightPy.fightType==EBattleType.EBattleTypeWchess?_.AppFacade.getInstance().showSubView(_.ZzqMediator.N,_.ZzqMediator.SV.STATISTICS,t.params.resultVo):_.AppFacade.getInstance().showSubView(_.FightMediator.N,_.FightMediator.SV.STATISTICS,t.params.resultVo)},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){t.championProxy.isZiDong=t.cb_needGuide.selected,t.teamExpePy.isZiDong=t.cb_needGuide.selected,t.cb_needGuide.selected?(t.championProxy.isTwo=!0,t.hide()):(t.cb_needGuide.label="自动战斗",t.timer&&egret.clearInterval(t.timer))},this),this.gp_hurt.visible=!1,this.gp_score.visible=!1,this.btn_oneMore.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide();var e=_.AppFacade.getInstance().retrieveProxy(_.PlayerPy.N);e.ChallengePlayer(e.challengePlayerId)},this),this.btn_ok0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=_.AppFacade.getInstance().retrieveProxy(_.FightPy.N).sFinalBattleResultVO;t.params&&t.params.battleType==EBattleType.EBattleTypeTeamArena&&3==e.totalC&&!t.filter?t.updateView({changeSkinType:!0,result:e.result,battleType:e.battleType,winC:e.winC,loseC:e.totalC-e.winC,doneCB:t.doneCB}):t.hide()},this),this.fightPy.sBattleResultVO.escaped?(this.taopaoActNameCurIndex=0,this.goTaoPaoAct(),this.gp_new.visible=!1,GameRootLayer.gameLayer().switchTouchEnable(!1)):this.gp_new.visible=!0},t.prototype.taoPaoCurActFinish=function(){if(this.taopaoActNameCurIndex>=this.taopaoActName.length)this.displayTaopao.parent.removeChild(this.displayTaopao),this.displayTaopao=void 0,this.gp_new.visible=!0,GameRootLayer.gameLayer().switchTouchEnable(!0);else{if(1==this.taopaoActNameCurIndex){var e=new eui.Image;e.x=-30,e.y=-330,e.source="_fight_m_json.common_img_dabuguoliule",e.name="common_img_dabuguoliule",this.displayTaopao.addChild(e)}else this.displayTaopao.getChildByName("common_img_dabuguoliule")&&this.displayTaopao.removeChild(this.displayTaopao.getChildByName("common_img_dabuguoliule"));this.displayTaopao.animation.play(this.taopaoActName[this.taopaoActNameCurIndex++])}},t.prototype.goTaoPaoAct=function(){var t=this;this.displayTaopao&&this.displayTaopao.animation?(this.displayTaopao.visible=!0,egret.Tween.get(this.displayTaopao).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width/2},500).call(this.taoPaoCurActFinish,this).wait(1250).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width+100},300).call(this.taoPaoCurActFinish,this)):DragonBoneTools.createForHero("taopao_01",function(e){(t.displayTaopao=e).x=-100,e.y=t.gp_main.height/2+160,e.scaleX=e.scaleY=1.2,t.gp_main.addChild(t.displayTaopao),t.goTaoPaoAct()})},t.prototype.addEvents=function(){function e(e){i["btn_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.STRING_WAY[e].clickFunc&&t.STRING_WAY[e].clickFunc()},i)}for(var t=this,i=this,a=0;a<=2;++a)e(a)},t.prototype.initPassWayBtns=function(){this.log("test initPassWayBtns")},t.prototype.perClose=function(){},t);function t(e){var t=i.call(this)||this;return t.MILLSECOND=0,t.championProxy=_.AppFacade.getInstance().retrieveProxy(_.ChampionPy.N),t.teamExpePy=_.AppFacade.getInstance().retrieveProxy(_.TeamExpePy.N),t.fightPy=_.AppFacade.getInstance().retrieveProxy(_.FightPy.N),t.taopaoActName=["qianjin","jingxia","qianjin2"],t.taopaoActNameCurIndex=0,t.STRING_WAY=[{icon:"common_icon_yingxiongpeiyang_png",text:"英雄培养",clickFunc:function(){_.MainJumpConfig.jumpTo(MODULE.Hero)}},{icon:"common_icon_yingxiongzhaohuan_png",text:"英雄召唤",clickFunc:function(){_.MainJumpConfig.jumpTo(MODULE.HeroGaCha)}},{icon:"common_icon_jingcaihuodong_png",text:"精彩活动",clickFunc:function(){_.AppFacade.getInstance().showSubView(_.ActivityMediator.N,_.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.JINGCAI})}}],t.skinName="FightResultPanelSkin",t.touchEnabled=!1,Utils.SoundManager.stopBg(),t}_.FightResultPanel=e;var a;a=eui.Component,__extends(n,a),n.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this);var e=_.GeneralConfig.getEntityConfigByCode(this.params.type,this.params.code);RES.getResAsync(ResourceUtils.png(e.icon),function(e){t.img_res.source=e},this),this.lb_num.text=this.params.num};function n(e){var t=a.call(this)||this;return t.skinName="BaseResItemRenderSkin",t.params=e,t}var o,v=(o=eui.ItemRenderer,__extends(s,o),s.prototype.dataChanged=function(){this.item.updateData({code:this.data.code,type:this.data.type,num:this.data.num}),this.addChild(this.item)},s);function s(){var e=o.call(this)||this;return e.currentState,e.width=84,e.height=84,e.item=customui.BaseItemFactory.create(21),e.item.scaleX=e.item.scaleY=.8,e}}(game=game||{}),function(g){var t,i=(t=BasePanel,__extends(a,t),a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.list_my.itemRenderer=o,this.list_ennemy.itemRenderer=o,this.initBtn()},a.prototype.updateView=function(e){this.result=e,this.updateInfo(),this.ChangeContent},a.prototype.updateInfo=function(){for(var c=this.result.entityResults,e=void 0,t=0,i=this.result.teams;t<i.length;t++)if((r=i[t]).camp==EBattleSide.EBattleSideAttack){e=r.playerId;break}this.data={},this.data.self=[],this.data.enemy=[];var d=-1,p=-1;for(var a in c){var n=c[a];d=d>n.totalHurt?d:n.totalHurt,p=p>n.totalCure?p:n.totalCure}for(var o in this.result.teams){function s(e,t,i){for(var a in e.entities){var n=e.entities[a];for(var o in t.push({isMagical:!1,code:n.code,entityId:n.entityId,isLeft:i,dermaCode:n.dermaCode}),c)(l=c[o]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure,d=d>l.totalHurt?d:l.totalHurt,p=p>l.totalCure?p:l.totalCure)}if(e.magical&&e.magical.entityId){var s=e.magical.code,r=g.Config.magicalUpgradeConfig(s);if(r[0]&&r[0].costs){var h=JSON.parse(r[0].costs)[0][1];for(var o in t.push({isMagical:!0,code:h,entityId:e.magical.entityId,isLeft:i}),c){var l;(l=c[o]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure)}}}t.forEach(function(e){e.maxHurt=d,e.maxCure=p}),t.sort(function(e,t){return e.isMagical?1:t.isMagical?-1:e.entityId-t.entityId})}var r;(r=this.result.teams[o]).playerId==e?s(r,this.data.self,!0):s(r,this.data.enemy,!1)}this.list_my.dataProvider=new eui.ArrayCollection(this.data.self),this.list_ennemy.dataProvider=new eui.ArrayCollection(this.data.enemy)},a.prototype.ChangeContent=function(e){var t=this.list_my.$children;for(var i in t)(a=t[i])&&a.changeState(e);for(var i in t=this.list_ennemy.$children){var a;(a=t[i])&&a.changeState(e)}},a.prototype.initBtn=function(){var e=this;this.btn_hurt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(a.LIST_TYPE.HURT),e.img_cure_bg.source="common_img_dikuang03_png",e.img_hurt_bg.source="common_img_dikuang01_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu1",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao2"},this),this.btn_cure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(a.LIST_TYPE.CURE),e.img_cure_bg.source="common_img_dikuang01_png",e.img_hurt_bg.source="common_img_dikuang03_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu2",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao1"},this)},a.LIST_TYPE={HURT:0,CURE:1,RESULT:2},a);function a(){var e=t.call(this)||this;return e.skinName="FightStatisticsSkin",e}g.FightStatistics=i;var n,o=(n=eui.ItemRenderer,__extends(e,n),e.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemFactory.create(),this.gp_head.addChild(this.baseitem),this.pb.slideDuration=0,this.pb.labelDisplay.visible=!1},e.prototype.dataChanged=function(){n.prototype.dataChanged.call(this);var e=this.data.code,t=void 0;this.data.dermaCode&&0!=this.data.dermaCode&&(t=g.Config.getHeroDermaConfig()[this.data.dermaCode].avatar),this.baseitem.updateData({code:e,avatar:t}),this.baseitem.scaleX=this.baseitem.scaleY=.6,this.baseitem.touchEnabled=this.baseitem.touchChildren=!1,this.changeState(i.LIST_TYPE.HURT),this.data.isLeft||(this.scaleX=-1,this.gp_head.scaleX=-1,this.bm_num.scaleX=-1)},e.prototype.changeState=function(e){this.pb.value=0,e==i.LIST_TYPE.HURT?(this.pb.maximum=this.data.maxHurt,this.pb.value=this.data.totalHurt,this.bm_num.text=this.data.totalHurt):(this.pb.maximum=this.data.maxCure,this.pb.value=this.data.totalCure,this.bm_num.text=this.data.totalCure)},e);function e(){var e=n.call(this)||this;return e.skinName="FightStatisticsItemSkin",e}}(game=game||{}),function(v){var t,e=(t=eui.Component,__extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_playback.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.BattlePlayBack(e.data.uuid,{moduleId:MODULE.TeamArena,data:e.resultData})},this)},i.prototype.updateData=function(e){this.data=e,this.resultData={resultVo:{teams:this.data.team},winC:this.data.resultData.winC,loseC:this.data.resultData.loseC,result:this.data.resultData.result,battleType:EBattleType.EBattleTypeTeamArena},this.lb_index.text="第"+{1:"一",2:"二",3:"三"}[this.data.index+1]+"场";var t=new eui.HorizontalLayout;t.gap=5,t.horizontalAlign=egret.HorizontalAlign.RIGHT,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_heros_2.layout=t;var i,a=new eui.HorizontalLayout;for(var n in a.gap=5,a.horizontalAlign=egret.HorizontalAlign.LEFT,a.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_heros_1.layout=a,e.team){var o=Number(n)+1,s=e.team[n],r=this["gp_"+o],h=this["gp_heros_"+o],l=this["img_bg"+o],c=this["img_flag_"+o],d=s.result;2==o&&d==EBattleResult.EBattleResultWin?d=EBattleResult.EBattleResultLose:2==o&&d==EBattleResult.EBattleResultLose&&(d=EBattleResult.EBattleResultWin),l.source=d==EBattleResult.EBattleResultWin?"_fight_m_json.jjc_img_kuang01":"_fight_m_json.jjc_img_kuang02",c.source=d==EBattleResult.EBattleResultWin?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this["lb_name_"+o].text=s.name;var p=this["playerhead_"+o];p.updateData({vo:{avatar:s.avatar}}),p.touchEnabled=!1;for(var g=s.heroList,u=0,f=g;u<f.length;u++){var m=f[u],y=v.BaseItemFactory.create();y.scaleX=y.scaleY=.5,y.updateData({type:EEntityType.EEntityTypeHero,code:m.code,level:m.level}),h.addChild(y)}var _=g.length;5<_&&(r.width+=53*(_-5)+5)}i=Math.max(this.gp_1.width,this.gp_2.width),this.gp_1.width=this.gp_2.width=i},i);function i(){var e=t.call(this)||this;return e.proxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),e.skinName="RecordPreviewItemSkin",e}v.RecordPreviewItem=e}(customui=customui||{}),function(y){var i,e=(i=BaseMediator,__extends(_,i),Object.defineProperty(_.prototype,"guajiUI",{get:function(){return this.getSubView(_.SV.MAIN)},enumerable:!0,configurable:!0}),_.prototype.initSubView=function(){this.addSubView(_.SV.MAIN,y.GuajiView),this.addSubView(_.SV.MINES_LIST,y.GuajiMinesListPanel),this.addSubView(_.SV.MINI_MAP,y.GuajiMiniMapPanel),this.addSubView(_.SV.MAIN_TASK,y.GuajiMainTaskPanel),this.addSubView(_.SV.DEMON,y.GuajiDemonPanel),this.addSubView(_.SV.MULTI,y.GuajiMultiPanel)},_.prototype.initNotice=function(){},_.prototype.listNotificationInterests=function(){return[CN.GUAJI_HIDE_ALL_SUBVIEW,CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GUAJI_LAYER_INFO_UPDATE,CN.GUAJI_LAYER_INFO_TIPS_UPDATE,CN.GUAJI_LAYER_EVENT_INFO_UPDATE,CN.GUAJI_PRETEND_CLICK_TILED,CN.GUAJI_FINGER_APPEAR_TO_XY,CN.GUAJI_RESET_CAMERA,CN.GUAJI_MAP_SCALE,CN.GUAJI_OPEN_CBT,CN.GUAJI_MAP_BACKPACK_UPDATE,CN.GUAJI_ON_ME_WALK_TO,CN.GUAJI_FINGER_TO_XY,CN.GUAJI_HUDONG_WITH_EP,CN.GUAJI_SHOW_ME_PATH_TO_POS,CN.GUAJI_DEMON_UPDATE,CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE,CN.PLAYER_OUTLOOK_UPDATE,CN.TASK_GET_REWARDS_POP_CLOSE,CN.CHANGE_PANEL,CN.FIGHT_ALL_DONE_AND_EXIT,CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,CN.GUAJI_MAP_INIT_ALL_DONE,CN.GUAJI_UPDATE_MINE,CN.GUAJI_GOLD_REFRESH,CN.GUAJI_ENTER_LAYER,CN.GUAJI_UPDATE_RES_NOTICE,CN.GENERAL_PASS_DAY]},_.prototype.handleNotification=function(e){var g=this,t=e.getBody(),i=e.getName();switch(i){case CN.HIDE_ALL_SUBVIEW:this.guajiUI&&(this.guajiUI.perClose(),this.guajiUI.visible=!1,this.guajiUI.parent&&this.guajiUI.parent.setChildIndex(this.guajiUI,0));break;case CN.GUAJI_HIDE_ALL_SUBVIEW:this.log("GUAJI_HIDE_ALL_SUBVIEW"),this.hideAllSubView(),this.viewComponent=void 0;break;case CN.GUAJI_ON_ME_WALK_TO:if(this.handleGuideEvent(i,t),!this.guajiProxy.localType)for(var a=0,n=this.guajiProxy.curLayerCBT;a<n.length;a++){var o=n[a];if(o.position.x==t.tileX&&o.position.y==t.tileY){this.guajiUI&&this.guajiUI.map&&this.guajiUI.map.me&&this.guajiUI.map.me.forceStop(),this.sendNotification(CN.GUAJI_OPEN_CBT,{vo:o,canGet:!0});break}}break;case CN.GUAJI_LAYER_INFO_TIPS_UPDATE:this.guajiUI&&this.guajiUI.updateLayerInfoTips();break;case CN.GUAJI_LAYER_INFO_UPDATE:this.log("GuajiMediator GUAJI_LAYER_INFO_UPDATE"),this.guajiUI&&this.guajiUI.updateLayerInfo(t);break;case CN.PLAYER_OUTLOOK_UPDATE:this.guajiUI&&this.guajiUI.updateNPCOutLook();break;case CN.GUAJI_LAYER_EVENT_INFO_UPDATE:if(this.guajiUI&&(this.guajiUI.updateLayerEventInfo(t),t.event)){var s=t.event,r=y.Config.riskEvent()[s.eventId],u=JSON.parse(r.dropImg);u.length&&y.GameMVC.fightPy.addDelayCBAfterFightExit(function(){egret.setTimeout(function(){var r={availabel:!0,imgArr:[],effectArr:[]},h={1:"common_mxwupin_cheng",2:"common_mxwupin_hong",3:"common_mxwupin_jin"},l=[[0,0],[-50,25],[-50,-25],[50,25],[50,-25],[0,50],[0,-50],[-100,0],[100,0]],c=g.guajiUI.map.me,e=g.guajiUI.map.tile2Pos(s.position.x,s.position.y);g.guajiUI.map.gp_ep.localToGlobal(e.x,e.y,e),g.guajiUI.map.me.globalToLocal(e.x,e.y,e);var d=[e.x,e.y-50],p=[c.anchorOffsetX+0,c.anchorOffsetY-90];DragonBoneTools.playOnce({effectName:"common_mxdiaoluo",parent:c,x:d[0],y:d[1]}),u.forEach(function(o,e){function t(){var e=Math.round(Math.random()*(l.length-1)),i=l.splice(e,1)[0],a=new eui.Group;a.width=a.height=50,a.anchorOffsetX=a.anchorOffsetY=25,a.x=d[0],a.y=d[1],a.touchEnabled=a.touchChildren=!1;var t=new eui.Image("_guaji_m_json.yingxion_img_touying");t.scaleX=t.scaleY=.23,t.bottom=0,t.horizontalCenter=0,a.addChild(t);var n=new eui.Image(s+"_png");n.width=n.height=50,a.addChild(n),i[1]+d[1]<p[1]?c.addChildAt(a,0):c.addChild(a),r.imgArr.push(a),egret.Tween.get(a).to({y:i[1]+d[1]-50},150,egret.Ease.cubicOut).to({y:i[1]+d[1]},150,egret.Ease.cubicIn),egret.Tween.get(a).to({x:i[0]+d[0]},300).call(function(){var e=o[2];if(e){var t=h[e];DragonBoneTools.create(t,function(e){r.availabel&&(e.animation.play(t,0),e.x=i[0]+d[0],e.y=i[1]+d[1],c.addChildAt(e,c.getChildIndex(a)+1),r.effectArr.push(e))})}Utils.TouchUtils.hasGlobalTouch("RISK_REWARD_OBTAIN")||Utils.TouchUtils.addGlobalTouch(function(){Utils.TouchUtils.removeGlobalTouch("RISK_REWARD_OBTAIN"),r.availabel=!1,r.imgArr.forEach(function(e){egret.Tween.removeTweens(e),egret.Tween.get(e).to({x:p[0],y:p[1],scaleX:.4,scaleY:.4},300).call(function(){e.parent.removeChild(e)})}),r.effectArr.forEach(function(e){e.parent&&e.parent.removeChild(e)})},"RISK_REWARD_OBTAIN")})}for(var s=o[0],i=o[1];0<i--;)t()})},g,200),y.GameMVC.fightPy.queueExceExitCB()},"riskRewardDrop")}break;case CN.GUAJI_RESET_CAMERA:this.guajiUI&&this.guajiUI.resetCamera(t);break;case CN.GUAJI_MAP_SCALE:this.guajiUI&&this.guajiUI.setMapScale(t);break;case CN.GUAJI_HUDONG_WITH_EP:this.guajiUI&&this.guajiUI.hudongWithEP(t);break;case CN.GUAJI_SHOW_ME_PATH_TO_POS:this.guajiUI&&this.guajiUI.showMePathToPos(t);break;case CN.GUAJI_OPEN_CBT:var h=!1;t&&null!=t.hideRewards&&(h=t.hideRewards),PopUpManager.addPopUp({obj:new y.GuajiCBTDetailPanel({hideRewards:h,canGet:t&&t.canGet,vo:t&&t.vo,config:t&&t.config,showAutoBtn:t&&t.showAutoBtn,forceJumpAndSearch:t&&t.forceJumpAndSearch,customCB:function(){t&&t.vo&&t.canGet?g.guajiProxy.OpenRiskMap(t.vo.uuid):t&&t.showAutoBtn&&g.guajiUI?g.guajiUI.handleTouchTap({tileX:t.vo.position.x,tileY:t.vo.position.y,num:t.vo.position.num}):t&&t.forceJumpAndSearch&&(y.MainJumpConfig.jumpTo("GUAJI"),g.guajiProxy.curLayerInfo.position.num==t.vo.position.num?g.guajiUI.handleTouchTap({tileX:t.vo.position.x,tileY:t.vo.position.y,num:t.vo.position.num}):egret.setTimeout(function(){g.guajiProxy.MiniTriggerEvent(t.vo.position.num),g.needAutoSearchCBTWhenEnterLayerVO=t.vo},g,500))}})});break;case CN.GUAJI_PRETEND_CLICK_TILED:this.guajiUI&&this.guajiUI.handleTouchTap(t);break;case CN.GUAJI_MAP_BACKPACK_UPDATE:this.guajiUI&&egret.setTimeout(function(){g.guajiUI&&g.guajiUI.updateCBTInfo()},this,1e3);break;case CN.GUAJI_ENTER_LAYER:if(this.guajiUI){var l=y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N);this.guajiProxy.GetLayerProgress(function(){g.guajiUI.pb_layerProgress&&(g.guajiUI.pb_layerProgress.firstMdfValue=!0),g.guajiUI.updateProgress(t)}),Utils.SoundManager.playBg(l.curLayerTheme.bgm)}if(t.source==MODULE.Risk){var c=y.AppFacade.getInstance().retrieveProxy(y.GuidePy.N);if(2==t.layerId)y.AppFacade.getInstance().retrieveProxy(y.LoginPy.N).loginGameVO.isCreated||y.AppFacade.getInstance().showSubView(y.PlayerMediator.N,y.PlayerMediator.SV.ROLE_NAME,{clickDarkClose:!1});else if(3!=t.layerId||c.serverGuideInfo.xinshou_img_dtjc_png)1001!=t.layerId||c.serverGuideInfo.xinshou_img_fbjc_png||(p=new BasePanel,(d=new eui.Image).horizontalCenter=0,d.verticalCenter=0,d.scaleX=d.scaleY=1.2,d.source="xinshou_img_fbjc_png",c.setGuideInfo("xinshou_img_fbjc_png"),p.addChild(d),PopUpManager.addPopUp({obj:p}));else{var d,p=new BasePanel;(d=new eui.Image).horizontalCenter=0,d.verticalCenter=0,d.scaleX=d.scaleY=1.2,d.source="xinshou_img_dtjc_png",c.setGuideInfo("xinshou_img_dtjc_png"),p.addChild(d),PopUpManager.addPopUp({obj:p})}this.needAutoSearchCBTWhenEnterLayerVO&&(this.guajiUI.handleTouchTap({tileX:this.needAutoSearchCBTWhenEnterLayerVO.position.x,tileY:this.needAutoSearchCBTWhenEnterLayerVO.position.y,num:this.needAutoSearchCBTWhenEnterLayerVO.position.num}),this.needAutoSearchCBTWhenEnterLayerVO=void 0)}this.handleGuideEvent(i,t);break;case CN.LOGIN_FINAL_DONE:this.guajiProxy.GetRiskMapInfo(),this.guajiProxy.GetPlayerDemonInfo(),this.guajiProxy.GetDemonList(),Utils.UnlockMgr.checkPass(MODULE.RiskMulti,!1).allow&&Utils.SDKMgr.getPerformConfig(40)&&this.guajiProxy.RiskMultiCommand("GetRoomInfo");break;case CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH:if(!this.guajiUI||!this.guajiUI.map)return;t.isInFight?this.guajiUI.map.onThisMapSwitch(!1):this.guajiUI.map.onThisMapSwitch(!0);case CN.CHANGE_PANEL:t&&t.isRemove&&this.handleGuideEvent(i,t);break;case CN.FIGHT_ALL_DONE_AND_EXIT:this.handleGuideEvent(i,t);break;case CN.TASK_GET_REWARDS_POP_CLOSE:if(!this.guidePy.isInMapGuide)return;if(this.curStep)return void console.log("guajiGuide 任务变化，当前存在流程");console.log("guajiGuide 任务变化，重新找下一步"),this.setCBAfterSubViewShow(_.SV.MAIN,function(){console.log("guajiGuide 挂机界面出现"),g.makeFlow(),g.next()});break;case CN.GUAJI_FINGER_APPEAR_TO_XY:this.setCBAfterSubViewShow(_.SV.MAIN,function(){g.guajiUI.riskFingerAppearToXY(t)});break;case CN.GUAJI_FINGER_TO_XY:this.setCBAfterSubViewShow(_.SV.MAIN,function(){g.guajiUI.showFingerToXY(t)});break;case CN.GUAJI_MAP_INIT_ALL_DONE:if(!t.source||t.source!=MODULE.Risk||!this.guajiUI)return;Utils.isNeedGuide&&this.setCBAfterSubViewShow(_.SV.MAIN,function(){g.log("新手开始"),g.guidePy.setInMapGuide(!0),g.makeFlow(),g.next()}),this.guajiUI.onMapInitAllDone();break;case CN.GUAJI_UPDATE_MINE:this.guajiUI&&this.guajiProxy.GetMineInfo({cb:function(){g.guajiUI.updateMine(t)},ispush:!0});break;case CN.GUAJI_UPDATE_RES_NOTICE:this.guajiUI&&this.guajiUI.updateResFullNotice(t);break;case CN.GUAJI_GOLD_REFRESH:if(this.guajiUI){if(!this.guajiUI.img_gold.visible){var f=Utils.TimerManager.getServerTime(),m=0;this.guajiProxy.minesInfo.forEach(function(e){if(e.lastGiveDt&&f-e.lastGiveDt>m){var t=0==m?1e6:m;m=f-e.lastGiveDt,m=Math.min(t,m)}}),10<=m&&(this.guajiUI.img_gold.visible=!0,this.guajiUI.img_gold.source="mx_img_jinbidui1_png")}t.mines.forEach(function(e){var a=g.guajiUI.map&&g.guajiUI.map.getEpByEventId(e.id);if(a&&a.visible){var t=JSON.parse(e.rewards);function i(){if(g.guajiUI){var t=new eui.Image;RES.getResAsync(ResourceUtils.png(n),function(e){t.source=e,t.anchorOffsetX=e.textureWidth/2,t.anchorOffsetY=e.textureHeight/2},g);var e=a.width/2+o.x,i=a.height/2+o.y;t.x=e,t.y=i,t.scaleX=t.scaleY=.6,t.alpha=0,g.guajiUI.addChild(t),egret.Tween.get(t).to({alpha:1,y:i-70},150).wait(200).call(function(){egret.Tween.get(t,{loop:!0}).to({scaleX:-.6},80).to({scaleX:.6},80)}).to({x:r.x,y:r.y},1e3,egret.Ease.quadIn).to({alpha:0},150).call(function(){egret.Tween.removeTweens(t),t&&t.parent&&t.parent.removeChild(t)})}}Utils.MsgUtils.addRewardMsg({rewards:t},a,{oriY:0,offsetY1:-50,offsetY2:-50});for(var n=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).getInfoByTypeCodeNum(t[0].type,t[0].code).info.icon,o=Utils.ComponentUtils.getPosInView(a),s=g.guajiUI.img_gold,r=Utils.ComponentUtils.getPosInView(s).add(new egret.Point(s.width/2,s.height/2)),h=5;0<h;)egret.setTimeout(i,g,150*h),h-=1}})}break;case CN.GENERAL_PASS_DAY:y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N).getQuickBattleInfo();break;case CN.GUAJI_DEMON_UPDATE:this.guajiUI&&this.guajiUI.updateDemonInfo();case CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE:this.updateView(_.SV.MULTI)}},_.prototype.handleGuideEvent=function(e,t){if(this.guidePy||!this.guidePy.isInMapGuide)for(var i in this.eventWaitId2C)this.eventWaitId2C[i].event==e&&(this.eventWaitId2C[i].func(t,this.curStepDone,this),delete this.eventWaitId2C[i])},_.prototype.makeFlow=function(){this.curVaildFlow.splice(0);for(var e=0,t=r;e<t.length;e++){for(var i=t[e],a=!0,n=0,o=i.guideCondParams;n<o.length;n++){var s=o[n];if(!(a=this.guidePy.checkCondition(s[0],s[1])))break}a&&this.curVaildFlow.push(i)}},_.prototype.curStepDone=function(){this.curStep&&this.curStep.autoNext&&this.next()},_.prototype.insert=function(e){},_.prototype.handleEvent=function(){},_.prototype.next=function(){this.curStep=this.curVaildFlow.shift(),console.log("guajiGuide下一个",this.curStep),this.curStep?this.curStep.event?this.eventWaitId2C[this.curStep.id]=this.curStep:this.curStep.func(void 0,this.curStepDone,this):console.log("guajiGuide 没有下一个了")},_.N="GuajiMediator",_.SV={MAIN:1,MINES_LIST:2,MINI_MAP:3,MAIN_TASK:4,DEMON:5,MULTI:6},_);function _(e){void 0===e&&(e=null);var t=i.call(this,_.N,e)||this;return t.curVaildFlow=[],t.eventWaitId2C={},t.guajiProxy=y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N),t.guidePy=y.AppFacade.getInstance().retrieveProxy(y.GuidePy.N),t.initNotice(),Utils.DebugUtils.isDebug&&(window._guaji=t),t}y.GuajiMediator=e;var r=[]}(game=game||{}),function(r){var e=(t.registerAll=function(){(new a).register(),(new s).register(),(new c).register(),(new m).register(),(new g).register(),(new v).register(),(new E).register(),(new R).register(),(new A).register()},t);function t(){}r.GuajiProcessor=e;var i,a=(i=r.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N).updateLayerInfo(e.getBody().info)},n);function n(){return i.call(this,"risk.LayerInfoP",n)||this}r.LayerInfoP=a;var o,s=(o=r.ProcessorBase,__extends(h,o),h.prototype.execute=function(e){var t=this,i=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),a=e.getBody();i.updateEventInfo(a.uuid,a.event);var n=a.event;if(n.type==RiskEventType.MysticalShop){var o=r.GameMVC.guajiMed;if(o.guajiUI&&o.guajiUI.map){var s=o.guajiUI.map.tile2EP(n.position.x,n.position.y);egret.setTimeout(function(){s.viewShowed||egret.setTimeout(function(){r.GameMVC.fightPy.addDelayCBAfterFightExit(function(){s.onTrigger(),r.GameMVC.fightPy.queueExceExitCB()},"RISK_MYSTICAL_SHOP")},t,2e3)},this,300)}}},h);function h(){return o.call(this,"risk.EventInfoP",h)||this}r.EventInfoP=s;var l,c=(l=r.ProcessorBase,__extends(d,l),d.prototype.execute=function(e){r.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},d);function d(){return l.call(this,"risk.MineFullP",d)||this}r.MineFullP=c;var p,g=(p=r.ProcessorBase,__extends(u,p),u.prototype.execute=function(e){var t=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),i=e.getBody();t.quickBattleInfo=i.info},u);function u(){return p.call(this,"risk.QuickBattleInfoP",u)||this}r.QuickBattleInfoP=g;var f,m=(f=r.ProcessorBase,__extends(y,f),y.prototype.execute=function(e){var t=this,i=e.getBody();r.GameMVC.guajiPy.riskProgress&&r.GameMVC.guajiPy.riskProgress.uuid==i.riskProgress.uuid&&(r.GameMVC.guajiPy.riskProgress=i.riskProgress,r.GameMVC.fightPy.addDelayCBAfterFightExit(function(){var e=r.AppFacade.getInstance().retrieveMediator(r.GuajiMediator.N);e.guajiUI&&(e.guajiUI.updateProgress({fromPush:!0}),egret.setTimeout(function(){e&&e.guajiUI&&e.guajiUI.tongGuan()},t,1e3)),r.GameMVC.fightPy.queueExceExitCB()},"layerProgress"))},y);function y(){return f.call(this,"risk.LayerProgressP",y)||this}r.LayerProgressP=m;var _,v=(_=r.ProcessorBase,__extends(T,_),T.prototype.execute=function(e){var t=e.getBody(),i=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N);t.mines,t.mines.forEach(function(e){for(var t in i.minesInfo)if(i.minesInfo[t].uuid==e.uuid){i.minesInfo[t]=e;break}}),r.AppFacade.getInstance().updateView(r.GuajiMediator.N,r.GuajiMediator.SV.MINES_LIST,t),r.AppFacade.getInstance().sendNotification(CN.GUAJI_GOLD_REFRESH,t)},T);function T(){return _.call(this,"risk.MineRewardP",T)||this}r.MineRewardP=v;var C,E=(C=r.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){var t=e.getBody();r.GameMVC.guajiPy.updateDemonList(t.demon,!0)},I);function I(){return C.call(this,"demon.DemonInfoP",I)||this}r.DemonInfoP=E;var b,R=(b=r.ProcessorBase,__extends(P,b),P.prototype.execute=function(e){var t=e.getBody();r.GameMVC.guajiPy.playerDemonInfo=t.info,r.AppFacade.getInstance().updateView(r.GuajiMediator.N,r.GuajiMediator.SV.DEMON)},P);function P(){return b.call(this,"demon.PlayerDemonInfoP",P)||this}r.PlayerDemonInfoP=R;var k,A=(k=r.ProcessorBase,__extends(w,k),w.prototype.execute=function(e){r.GameMVC.guajiPy.updateRiskMultiRoomInfo(e.getBody().info)},w);function w(){return k.call(this,"riskMulti.RoomInfoP",w)||this}r.RiskMultiRoomInfoP=A}(game=game||{}),function(c){var t,e=(t=BaseProxy,__extends(i,t),Object.defineProperty(i.prototype,"localType",{get:function(){return this._localType},set:function(e){this._localType=e,Utils.LocalStorageUtil.setItem("guajiLayerType",this._localType+"")},enumerable:!0,configurable:!0}),i.prototype.updateMapInfo=function(e){var i=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.AllMapInfo[e.uuid])i.AllMapInfo[e.uuid].update(e);else{var t=new c.MapVO(e);i.AllMapInfo[e.uuid]=t}}),c.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_BACKPACK_UPDATE)},i.prototype.deleteMapByUuids=function(e){delete this.AllMapInfo[e],c.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_BACKPACK_UPDATE)},i.prototype.updateCurPosition=function(e,t,i){if(this.curLayerInfo.curPosVO.x=e,this.curLayerInfo.curPosVO.y=t,i){this.curLayerInfo.curPosVO.layerId=i;var a=c.Config.risk()[i];a&&(this.localType=a.type,this.lastCurLayerId[this.curLayerInfo.position.difficultyType]=this.curLayerInfo.curPosVO.layerId)}c.AppFacade.getInstance().sendNotification(CN.GUAJI_LAYER_INFO_TIPS_UPDATE)},i.prototype.resetCurLayerInfo=function(){this.curLayerInfo.reset()},i.prototype.updateLayerInfo=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=void 0);var a=this.curLayerInfo.uuid!=e.uuid;t&&(a=!0),a&&this.curLayerCBT.splice(0),this.curLayerInfo.update(e),this.localType=this.curLayerInfo.position.difficultyType,c.Config.risk()[this.curLayerInfo.curPosVO.layerId]&&(this.lastCurLayerId[this.curLayerInfo.position.difficultyType]=this.curLayerInfo.curPosVO.layerId),this.sendNotification(CN.GUAJI_LAYER_INFO_UPDATE,{isEnterNewLayer:a})},i.prototype.updateEventInfo=function(e,t){var i,a=!1;if(e==this.curLayerInfo.uuid)for(var n=0,o=this.curLayerInfo.events;n<o.length;n++){var s=o[n];if(s.position.x==t.position.x&&s.position.y==t.position.y){console.log("risk更新事件"),s.update(t),i=s,a=!0;break}}a||(console.log("risk新增事件"),this.curLayerInfo.events.push(new c.EventVO(t))),this.sendNotification(CN.GUAJI_LAYER_EVENT_INFO_UPDATE,{event:i})},i.prototype.getShowTipsForPosition=function(e,t){void 0===t&&(t=0);var i="";return e.type==RiskNodeType.Risk?i+=c.Config.risk()[e.id].name:e.type==RiskNodeType.Fortress?i+=c.Config.riskFortress()[e.id].name+"("+e.num+"层)":e.type==RiskNodeType.Maze&&(i+=c.Config.riskMaze()[e.id].name+"("+e.num+"层)"),0==t&&(i+="("+e.x+","+e.y+")"),e.position&&e.position.type&&(i+="-"+this.getShowTipsForPosition(e.position,t)),i},i.prototype.GetLayerInfo=function(t,i){var a=this;void 0===t&&(t=!1),void 0===i&&(i=void 0),null==this._localType&&(this._localType=Number(Utils.LocalStorageUtil.getItem("guajiLayerType")),this._localType||(this._localType=0)),null==i&&(i=this.localType),Utils.Socket.send("risk","GetLayerInfo",{type:i}).then(function(e){a.updateLayerInfo(e.info,t,i)})},i.prototype.GetLayerNum=function(i,a){var n=this;null==a&&(a=this.localType),Utils.Socket.send("risk","GetRiskLayers",{type:a}).then(function(e){for(var t in n.allLayerNum=0,e.list)e.list[t].type==n.localType&&n.allLayerNum++;n.allLayersInfo[a]=e.list,i&&i()})},i.prototype.GetLayerProgress=function(t){var i=this;Utils.Socket.send("risk","GetLayerProgress",{type:this.localType}).then(function(e){i.riskProgress=e.riskProgress,t&&t()})},i.prototype.GetProgressReward=function(e,t,i){var a=this;null==i&&(i=this.localType),Utils.Socket.send("risk","GetProgressReward",{uuid:e||"",type:i}).then(function(e){a.riskProgress=e.riskProgress,c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward),t&&t()})},i.prototype.getPurePosition=function(e){var t=e||this.curLayerInfo.curPosVO;return{x:t.x,y:t.y}},i.prototype.Walk=function(e,t,i){Utils.Socket.send("risk","Walk",{positions:e,type:this.localType}).then(function(e){i&&i()})},i.prototype.getVoByPosition=function(e){for(var t=void 0,i=0,a=this.curLayerInfo.events;i<a.length;i++){var n=a[i];if(n.position.x==e.x&&n.position.y==e.y){t=n;break}}return t},i.prototype.MiniTriggerEvent=function(e,t){var i=0;2e4<e&&(e%=2e4,i=1),Utils.Socket.send("risk","SwitchRisk",{num:e,type:i}).then(function(e){t&&t()})},i.prototype.TriggerEvent=function(e,t,i,a,n){var o=this;void 0===n&&(n=!1),a&&this.setAfterFightAutoGoCurEPStory(a);var s=this.getVoByPosition(e);if(s){null!=t&&(t=t.toString());var r=s.eventId,h=r&&c.Config.riskEvent()[r];if(h){var l=c.Config.riskEventDesc()[h.descId];this.tempData={eventId:r},Utils.Socket.send("risk","TriggerEvent",{position:this.getPurePosition(e),key:t,type:this.localType}).then(function(e){if(a)o.goCurEPStory(function(){e.clientReward&&l&&PopUpManager.addPopUp({obj:new c.BaseEpRewardView({config:l,rewards:e.clientReward})}),i&&i(e)});else{if(l&&h.type==RiskEventType.StoryCreep)return o.tempData={eventId:r,config:l,rewards:e.clientReward},void(i&&i(e));e.clientReward&&!n&&l&&PopUpManager.addPopUp({obj:new c.BaseEpRewardView({eventId:r,config:l,rewards:e.clientReward})}),i&&i(e)}})}else Utils.MsgUtils.addMidMsg("事件不存在")}},i.prototype.ShopBuy=function(e,t,i,a){Utils.Socket.send("risk","ShopBuy",{grid:e,num:t,position:this.getPurePosition(i),type:this.localType}).then(function(e){c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:a})})},i.prototype.Answer=function(o,e,s,r){var h=this;void 0===r&&(r=!0),Utils.Socket.send("risk","Answer",{order:o,position:this.getPurePosition(e),type:this.localType}).then(function(e){for(var t,i=0,a=h.curLayerInfo.events;i<a.length;i++){var n=a[i];if(n.position.x==h.curLayerInfo.position.x&&n.position.y==h.curLayerInfo.position.y){(t=n).info=JSON.parse(e.info);break}}e.clientReward&&r&&c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward),c.AppFacade.getInstance().sendNotification(CN.GUAJI_LAYER_EVENT_INFO_UPDATE,{event:t}),c.AppFacade.getInstance().sendNotification(CN.GUIDE_MAKE_FLOW),s&&s(o,e.clientReward)})},i.prototype.GetMineInfo=function(t){var i=this;Utils.Socket.send("risk","GetMineInfo",{position:t.pos,type:this.localType}).then(function(e){i.minesInfo.splice(0),Array.isArray(e.infos)&&e.infos.forEach(function(e){i.minesInfo.push(e)}),i.mineNum=Math.max(i.mineNum,i.minesInfo.length),i.updateNotice(),t.cb&&t.cb()})},i.prototype.updateNotice=function(){var i=c.Config.riskMine();if(this.minesInfo){var a=0,e=c.AppFacade.getInstance().retrieveProxy(c.ActivityPy.N).allActivityData[EActivityType.WholeLifeCard];if(e&&e.data&&e.data.hasPurchased){var t=JSON.parse(e.content);a=t[2]}var n=!1,o=Utils.TimerManager.getServerTime();this.minesInfo.forEach(function(e){var t=i[e.id];0!=e.lastGiveDt&&o-e.lastGiveDt>=(a||t.upLimit)&&(n=!0)}),n?c.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!0):c.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!1)}else c.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!1)},i.prototype.GetRiskMapInfo=function(){var t=this;Utils.Socket.send("risk","GetRiskMapInfo",{}).then(function(e){t.updateMapInfo(e.mapList)})},i.prototype.OpenRiskMap=function(i){var a=this;Utils.Socket.send("risk","OpenRiskMap",{uuid:i}).then(function(e){if(a.deleteMapByUuids(i),e.clientReward){var t={config:{titleFixed:"藏宝图",resultDesc:[c.Config.getRiskMapItemsByCode(e.rewardCode).desc]},rewards:e.clientReward};PopUpManager.addPopUp({obj:new c.BaseEpRewardView(t)})}})},i.prototype.GetMineRewards=function(a){var n=this;Utils.Socket.send("risk","GetMineRewards",{}).then(function(e){if(e.clientReward){var t=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),i=a&&a.delay||0;egret.setTimeout(function(){t.handleClientReward(e.clientReward)},n,i)}n.minesInfo.splice(0),Array.isArray(e.infos)&&e.infos.forEach(function(e){n.minesInfo.push(e)}),a.cb&&a.cb(),c.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE),Utils.SDKMgr.getPerformConfig(55)&&Utils.SDKMgr.cmd({type:"requestSubscribeMessage"},function(e){if("accept"==e.result)Utils.Socket.send("mineSubscriber","Subscriber",{pid:parseInt(e.pid)||0,gid:parseInt(e.gid)||0,templateId:e.templateId||""}).then(function(e){});else{if("reject"==e.result)return void Utils.Socket.send("mineSubscriber","CancelSubscriber",{}).then(function(e){});"ban"==e.result?Utils.MsgUtils.addMidMsg("该订阅消息已被后台封禁"):"fail"==e.result&&Utils.MsgUtils.addMidMsg("订阅失败， errCode:"+e.errCode)}})})},i.prototype.checkCurLayerHasCBT=function(){for(var e in this.curLayerCBT.splice(0),this.AllMapInfo){var t=this.AllMapInfo[e];this.curLayerInfo.position.match(t.position)&&this.curLayerCBT.push(t)}return 0<this.curLayerCBT.length&&this.curLayerCBT[0]},i.prototype.setAfterFightAutoGoCurEPStory=function(e,t){var i=this;void 0===t&&(t=!1),this.doneStoryId=e;var a=c.AppFacade.getInstance().retrieveProxy(c.FightPy.N);a.addDelayCBAfterFightExit(function(){i.goCurEPStory(function(){a.queueExceExitCB()})},"setCurEPStory",0,t)},i.prototype.goCurEPStory=function(e){this.doneStoryId?PopUpManager.addPopUp({obj:new c.StoryView({storyId:this.doneStoryId,questionId:void 0,position:void 0,cb:function(){e&&e()}})}):e&&e()},i.prototype.getQuickBattleInfo=function(){var t=this;Utils.Socket.send("risk","GetQuickBattleInfo",{}).then(function(e){t.quickBattleInfo=e.info}).catch(function(e){console.log("GetQuickBattleInfo",e)})},i.prototype.quickBattle=function(){var t=this;Utils.Socket.send("risk","QuickBattle",{}).then(function(e){t.quickBattleInfo=e.info,c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward),c.AppFacade.getInstance().updateView(c.GuajiMediator.N,c.GuajiMediator.SV.MAIN)}).catch(function(e){console.log("QuickBattle",e)})},i.prototype.buyQuickBattleTimes=function(e){var t=this;Utils.Socket.send("risk","BuyQuickBattleTimes",{num:e.num}).then(function(e){t.quickBattleInfo=e.info,t.quickBattle(),c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientCost(e.clientCost)}).catch(function(e){})},i.prototype.handleQuickBattle=function(){var t=this,e=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),i=c.Config.unlockConfig(MODULE.RiskQuickBattle),a=JSON.parse(i.condition);if(e.playerInfoVO.level<a[1])Utils.MsgUtils.addMidMsg("达到"+a[1]+"级解锁");else if(this.mineNum<=0)Utils.MsgUtils.addMidMsg("还未占领矿！");else{var n=this.quickBattleInfo,o=c.Config.VIPConfig().quickBattleTimes,s=(c.Config.constConfig().QuickBattleFreeTimes,o-n.buyCount);if(n.count<=0){var r=c.Config.publicBuyCostConfig(MODULE.RiskQuickBattle,n.buyCount),h=JSON.parse(r.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(h,!0)&&c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.QUICK_BATTLE_DIALOG,{costTips:"快速开采资源，立刻获\n得",costTips2:"小时收益?",cost:h,reset:!0,num:s+n.count,cb:!0,clickCB:function(e){1===e.type&&PopUpManager.addPopUp({obj:new c.QuickMineView({doneCB:function(){t.buyQuickBattleTimes({num:1})}}),clickDarkClose:!1})}})}else c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.QUICK_BATTLE_DIALOG,{costTips:"是否免费开采资源，立刻获得",costTips2:"小时收益?",cost:"",reset:!0,num:s+n.count,cb:!0,clickCB:function(e){1===e.type&&PopUpManager.addPopUp({obj:new c.QuickMineView({doneCB:function(){t.quickBattle()}}),clickDarkClose:!1})}})}},i.prototype.checkDemonAvailable=function(){var e,t=c.GameMVC.playerPy.playerInfoVO.playerId,i=Utils.TimerManager.getServerTime();for(var a in this.demonList){var n=this.demonList[a];n.excapeDt>i&&(!e||n.excapeDt<e.excapeDt)&&(0==this.playerDemonInfo.count&&n.baseInfo.playerId!=t||(e=n))}return e},i.prototype.updateDemonList=function(e,t){var i=this;if(void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),t){var a=c.GameMVC.playerPy.playerInfoVO.playerId;e.some(function(e){return!i.demonList[e.uuid]&&e.baseInfo.playerId==a})&&DragonBoneTools.playOnce({effectName:"common_swlx",parent:GameRootLayer.gameLayer().popMsgLayer,y:.3*Utils.DeviceUtils.curHeight()})}if(e.length){var n=Utils.TimerManager.getServerTime();e.forEach(function(e){0==e.leftLife||e.excapeDt<=n?i.demonList[e.uuid]&&delete i.demonList[e.uuid]:(i.demonList[e.uuid]||(i.demonList[e.uuid]=new c.DemonVO),i.demonList[e.uuid].update(e))})}else for(var o in this.demonList)delete this.demonList[o];this.sendNotification(CN.GUAJI_DEMON_UPDATE),c.AppFacade.getInstance().updateView(c.GuajiMediator.N,c.GuajiMediator.SV.DEMON)},i.prototype.GetPlayerDemonInfo=function(){var t=this;Utils.Socket.send("demon","GetPlayerDemonInfo",{}).then(function(e){t.playerDemonInfo=e.info,c.AppFacade.getInstance().updateView(c.GuajiMediator.N,c.GuajiMediator.SV.DEMON)}).catch(function(e){})},i.prototype.GetDemonList=function(){var t=this;Utils.Socket.send("demon","GetDemonList",{}).then(function(e){t.demonList={},t.updateDemonList(e.list)}).catch(function(e){})},i.prototype.ChallengeDemon=function(e){var i=this;this.playerDemonInfo?0!=this.playerDemonInfo.count?this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeDemon,pb1:"demon",pb2:"Challenge",params:{uuid:e},doneCB:function(e){var t=e.cbRet;t&&(i.playerDemonInfo=t.info),c.GameMVC.fightPy.queueExceExitCB()}}):Utils.MsgUtils.addMidMsg("挑战次数不足"):Utils.MsgUtils.addMidMsg("找不到信息")},i.prototype.checkMultiNotice=function(){if(this.riskMultiConstV||(this.riskMultiConstV=JSON.parse(c.Config.constConfig().riskMultiConfig.constValue)),this.riskMultiRoomInfo.amIOwner()&&this.riskMultiRoomInfo.members.length<=this.riskMultiConstV[2]-1)return!0},i.prototype.updateRiskMultiRoomInfo=function(e){this.riskMultiRoomInfo.update(e),NoticeManager.updateNotice(NT.GUAJI_MULTI),c.AppFacade.getInstance().sendNotification(CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE)},i.prototype.RiskMultiCommand=function(e,t,i){var a=this;Utils.Socket.send("riskMulti",e,t||{}).then(function(e){e.info&&a.updateRiskMultiRoomInfo(e.info),i&&i()})},i.prototype.checkGZGZHNotice=function(){if(!Utils.LocalStorageUtil.getTodayVaild("HAS_CLICK_GZGZH_BTN"))return!0},i.N="GuajiProxy",i);function i(){var e=t.call(this,i.N)||this;return e.curLayerInfo=new c.LayerVO,e.lastCurLayerId=[],e.allCurLayerInfo=[],e.minesInfo=new Array,e.mineNum=0,e.curLayerCBT=new Array,e.allLayersInfo=[],e.riskMultiRoomInfo=new c.RiskMultiSRoomInfo,e.demonList={},e.curLayerTheme={},e.firstEnterMapAfterLogin=!0,e._localType=void 0,e.AllMapInfo={},NoticeManager.registerCB(NT.GUAJI_MULTI,e.checkMultiNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH,e.checkGZGZHNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH2,e.checkGZGZHNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH3,e.checkGZGZHNotice,e),e}c.GuajiPy=e}(game=game||{}),function(p){var t,e=(t=BaseTab,__extends(i,t),i.prototype.childrenCreated=function(){var a=this;t.prototype.childrenCreated.call(this),Utils.SDKMgr.nodeRecord(999999999),Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow?(this.hasUpdateLiuhai=!0,this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)):(this.btn_ditu.visible=!1,this.btn_ditu1.visible=!1,Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_mini_map_root)),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_mainTask),this.py.GetMineInfo({ispush:!0,cb:function(){a.updateMine()}}),this.sl_root.scrollPolicyV=this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.gp_mini_map_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MINI_MAP,{mwArr:a.map.mwArr,tileX:a.map.me.tileX,tileY:a.map.me.tileY})},this),this.btn_ditu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MINI_MAP,{mwArr:a.map.mwArr,tileX:a.map.me.tileX,tileY:a.map.me.tileY})},this),this.btn_ditu1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){a.py.GetLayerNum(function(){PopUpManager.addPopUp({obj:new p.GuajiGateListPanel({type:1-a.py.localType}),closeCB:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuajiPy.N);e&&t.MiniTriggerEvent(Number(e))}})},1-a.py.localType)},this),this.btn_cbt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=a.py.checkCurLayerHasCBT();if(t){var i=!1;t.position.x==a.py.curLayerInfo.position.x&&t.position.y==a.py.curLayerInfo.position.y&&(i=!0),p.AppFacade.getInstance().sendNotification(CN.GUAJI_OPEN_CBT,{hideRewards:!0,vo:t,showAutoBtn:!0,canGet:i})}},this),Utils.ComponentUtils.registerListener(this.btn_demon,egret.TouchEvent.TOUCH_TAP,function(){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.DEMON)},this),this.gp_mainTask_show.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mainTask.right=11,this.gp_mainTask_show.visible=!1},this),this.img_mainTask_hide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mainTask.right=-this.gp_mainTask.width,this.gp_mainTask_show.visible=!0},this),this.gp_content.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MAIN_TASK)},this),this.img_gold.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.shouJinbiEffect(),this.py.GetMineRewards({cb:function(){e.updateMine()},delay:500})},this),this.gp_jinkuang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MINES_LIST)},this),this.btn_quick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.py.handleQuickBattle()},this),this.gp_mask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mask.visible=this.gp_progress_details.visible=!1},this),this.gp_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("risk","Quit",{type:a.py.localType}).then(function(){})},this),Utils.agentConfig.OffLineTest?egret.setTimeout(function(){a.py.updateLayerInfo({layerId:4,num:1,uuid:"12312312dfa",position:{x:10,y:11,layerId:4}})},this,500):this.once(egret.Event.ENTER_FRAME,function(){a.py.resetCurLayerInfo(),a.py.GetLayerInfo(!0,a.py.localType)},this),this.gp_eEffect.touchEnabled=!1,this.gp_eEffect.touchChildren=!1,DragonBoneTools.create("common_maoxianztk",function(e){e.x=this.gp_eEffect.width/2,e.y=250,Utils.DeviceUtils.setBottomAdapter(e),e.scaleX=2,e.rotation=0,e.touchEnabled=!1,e.animation.play(),this.gp_eEffect.addChild(e)},this),DragonBoneTools.create("common_maoxianztk",function(e){e.x=0,e.y=-500,e.scaleX=2,e.rotation=90,e.animation.play(),e.touchEnabled=!1,this.gp_eEffect.addChild(e)},this),DragonBoneTools.create("common_maoxianztk",function(e){var t=this;this.once(egret.Event.ENTER_FRAME,function(){e.x=t.gp_eEffect.width},this),e.y=-500,e.scaleX=2,e.rotation=-90,e.animation.play(),e.touchEnabled=!1,this.gp_eEffect.addChild(e)},this)},i.prototype.addNotice=function(){},i.prototype.removeNotice=function(){},i.prototype.updateView=function(e,t){var i=this;if(this.py.GetLayerNum(),this.updateMainTask(),e.fromGuide);else if(e&&e.isFromJump){(Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow)&&(this.gp_mini_map_root.visible=!1),this.gp_right_bottom.visible=!1;var a=this.gp_mainTask.visible;this.gp_mainTask.visible=!1,this.gp_mask.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow?i.setGuideAvailable():(i.gp_mini_map_root.visible=!0,UIActionManager.playUIAction(i.gp_mini_map_root,4,function(){i.setGuideAvailable()},i)),i.gp_right_bottom.visible=!0,UIActionManager.playUIAction(i.gp_right_bottom,4),a&&(i.gp_mainTask.visible=!0,UIActionManager.playUIAction(i.gp_mainTask,4))},this)}if(this.py.quickBattleInfo){var n=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),o=p.Config.unlockConfig(MODULE.RiskQuickBattle),s=JSON.parse(o.condition);this.img_notice.visible=0<this.py.quickBattleInfo.count&&0<this.py.minesInfo.length&&n.playerInfoVO.level>=s[1]}this.hasUpdateLiuhai?0==this.btn_ditu1.visible&&Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow&&(this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)):(this.hasUpdateLiuhai=!0,Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow&&(this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)))},i.prototype.updateCBTInfo=function(){var e=this.py.checkCurLayerHasCBT();0==this.py.localType&&e?(this.gp_cbt.visible=!0,this.gp_cbt.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.blb_cbt_pos.text=e.position.x+":"+e.position.y):(this.gp_cbt.visible=!1,this.gp_cbt.height=0)},i.prototype.updateDemonInfo=function(){var e=this,t=this.py.checkDemonAvailable();t?(this.gp_demon.visible=!0,this.gp_demon.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.demonDt=t.excapeDt-Utils.TimerManager.getServerTime(),this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.demonTimer=egret.setInterval(this.updateDemonTime,this,1e3)):(this.gp_demon.visible=!1,this.gp_demon.height=0,this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.demonTimer=egret.setInterval(function(){e.py.GetDemonList()},this,15e3))},i.prototype.updateDemonTime=function(){0<this.demonDt?this.blb_demon_dt.text=Utils.TimerManager.getFormatBySecond1(--this.demonDt):(this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.py.GetDemonList())},i.prototype.tongGuan=function(){},i.prototype.updateLayerInfoTips=function(){this.lb_info.text=""+this.py.getShowTipsForPosition(this.py.curLayerInfo.position,1),this.lb_info2.text="X:"+this.py.curLayerInfo.curPosVO.x+" Y:"+this.py.curLayerInfo.curPosVO.y;var e=p.GameMVC.activityPy.allActivityData[EActivityType.RiskSecretTerritory];e&&e.content&&0<=e.content[1].indexOf(this.py.curLayerInfo.curPosVO.layerId)?(this.lb_mazeName.text=""+this.py.getShowTipsForPosition(this.py.curLayerInfo.position.position,1),this.gp_mazaName.visible=!0):this.gp_mazaName.visible=!1},i.prototype.updateMine=function(e){var t=this;if(this.mineTimer&&(egret.clearTimeout(this.mineTimer),this.mineTimer=void 0),0<this.py.minesInfo.length){var i=0,a=Utils.TimerManager.getServerTime();this.py.minesInfo.forEach(function(e){if(e.lastGiveDt&&a-e.lastGiveDt>i){var t=0==i?1e6:i;i=a-e.lastGiveDt,i=Math.min(t,i)}});var n=[10,600,1800,3600,7200,10800],o=n[0],s=!1;if(n[0]<=i){this.img_gold.visible=!0;for(var r=1;r<n.length;r++){if(n[r-1]<=i&&i<n[r]){o=n[r],this.img_gold.source="mx_img_jinbidui"+r+"_png",this.jibiduiEffect(r);break}s=n.length-1==r}s?(this.jibiduiEffect(n.length-1),this.img_gold.source="mx_img_jinbidui5_png"):this.mineTimer=egret.setTimeout(function(){t.py.GetMineInfo({ispush:!0,cb:function(){t.updateMine()}})},this,1e3*(o-i))}else this.img_gold.visible=!1,this.mineTimer=egret.setTimeout(function(){t.py.GetMineInfo({ispush:!0,cb:function(){t.updateMine()}})},this,1e4);this.gp_jinkuang.visible=!0,this.wangkuangEffect(),this.mineUpdateTimer||(this.mineUpdateTimer=egret.setTimeout(function(){t.goldMineEffect()},this,1e4))}else this.gp_jinkuang.visible=!1,this.img_gold.visible=!1},i.prototype.updateResFullNotice=function(e){this.img_resFull.visible=!!e},i.prototype.wangkuangEffect=function(){var e=this,a={1:{x:this.gp_effect.width/2-60,y:this.gp_effect.height-20,scaleX:-1},2:{x:this.gp_effect.width-20,y:this.gp_effect.height-70,scaleX:1},3:{x:this.gp_effect.width-60,y:this.gp_effect.height-4,scaleX:1}};function t(t){var i="kuangren_"+(t%2+1);egret.setTimeout(function(){MovieClipTools.create(i,function(e){e.x=a[t+1].x,e.y=a[t+1].y,e.scaleX=1.8*a[t+1].scaleX,e.scaleY=1.8,e.animation.play(i,-1),this.gp_effect.addChild(e)},e)},n,160*t)}this.gp_effect.removeChildren();for(var n=this,i=0;i<3;++i)t(i)},i.prototype.updateLayerInfo=function(e){var t=this;this.log("层信息变化");var i=e&&e.isEnterNewLayer;if(this.updateLayerInfoTips(),!this.map){var a=new p.Camera;a.horizontalCenter=0,a.verticalCenter=0,a.visible=!1,this.Group_main.addChildAt(a,this.cu_mls.parent.getChildIndex(this.cu_mls)+1),this.map=Utils.MapUtils.generateCommon({source:MODULE.Risk,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,camera:a}),this.gp_map.addChildAt(this.map,0)}var n=p.Config.riskLayer()[this.py.curLayerInfo.curPosVO.layerId];this.map.update({isInit:i,layerId:this.py.curLayerInfo.curPosVO.layerId,w:n.long,h:n.wide,tiled:n.tiled,theme:n.theme,meStartTileX:this.py.curLayerInfo.position.x,meStartTileY:this.py.curLayerInfo.position.y}),this.updateLayerEventInfo(e),this.updateMainTask(),this.updateCBTInfo(),this.py.localType?(this.btn_ditu1.icon="maoxian_icon_putong_png",this.gp_eEffect.visible=!0):(this.btn_ditu1.icon="maoxian_icon_emeng_png",this.gp_eEffect.visible=!1),this.py.GetLayerProgress(function(){t.pb_layerProgress&&(t.pb_layerProgress.firstMdfValue=!0),t.updateProgress(t.py.riskProgress)})},i.prototype.updateLayerEventInfo=function(e){this.map.updateLayerEvent({events:this.py.curLayerInfo.events}),this.map.updateNPC({curPosVO:this.py.curLayerInfo.curPosVO}),this.map.updateMWInfo({grids:this.py.curLayerInfo.grids})},i.prototype.updateNPCOutLook=function(e){this.map&&this.map.me.updateNPCOutLook()},i.prototype.resetCamera=function(e){this.map.resetCamera()},i.prototype.setMapScale=function(e){this.map.setMapScale(e)},i.prototype.handleTouchTap=function(e){this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.handleTouchTap(e.tileX,e.tileY):this.log("不在指定冒险地图")},i.prototype.riskFingerAppearToXY=function(e){!e||this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.riskFingerAppearToXY(e&&e.tileX,e&&e.tileY,e&&e.time):this.log("不在指定冒险地图")},i.prototype.showFingerToXY=function(e){this.py.curLayerInfo&&this.map?!e||this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.showFingerToXY(e&&e.tileX,e&&e.tileY):Utils.MsgUtils.addMidMsg("不在指定冒险地图"):this.delayShowFingerToXYP=e},i.prototype.hudongWithEP=function(e){this.map.hudongWithEP(e)},i.prototype.showMePathToPos=function(e){this.map.showMePathToPos(e)},i.prototype.onMapInitAllDone=function(){this.delayShowFingerToXYP&&(this.showFingerToXY(this.delayShowFingerToXYP),this.delayShowFingerToXYP=void 0)},i.prototype.onDestroy=function(){this.removeNotice(),this.mineUpdateTimer&&egret.clearTimeout(this.mineUpdateTimer)},i.prototype.updateMainTask=function(){var e=this.taskPy.getCurGuideTask(this.py.localType?TaskType.DifficultyGuide:TaskType.Guide);if(e){this.gp_mainTask.visible=!0;var t=e.config,i=this.taskPy.getTaskStatus(e);JSON.parse(t.target),i==TaskStatus.DONE?this.img_complete.visible=!0:this.img_complete.visible=!1,1==t.progress?i==TaskStatus.DONE?this.lb_progress.text="(1/1)":this.lb_progress.text="(0/1)":this.lb_progress.text=e.key.toString()+"/"+t.progress,this.lb_desc.text=t.name}else this.gp_mainTask.visible=!1},i.prototype.updateProgress=function(e){var s=this;this.pb_layerProgress||(this.pb_layerProgress=new customui.RoundProgressBar,this.pb_layerProgress.antiClockwise=!0,this.pb_layerProgress.needStep=!0,this.pb_layerProgress.skinName="skins.GuajiView_ProgressBarSkin",this.gp_layer_progress.addChildAt(this.pb_layerProgress,0),this.pb_layerProgress.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.py.riskProgress.isGot||this.pb_layerProgress.maximum!=this.pb_layerProgress.value?(this.pb_layerProgress.touchChildren=this.pb_layerProgress.touchEnabled=!1,this.gp_progress_details.scaleY=0,this.gp_progress_details.visible=!0,egret.Tween.get(this.gp_progress_details).to({scaleY:1},300).call(function(){e.gp_mask.visible=!0,e.pb_layerProgress.touchChildren=e.pb_layerProgress.touchEnabled=!0})):this.py.GetProgressReward("",function(){e.updateProgress()})},this),this.pb_layerProgress.labelFunction=function(e,t){return Math.floor(100*e/t)+"%"});var t=e&&e.layerId;if(t){this.gp_progress_rewards.removeChildren();var i=p.Config.riskLayer()[t],a=JSON.parse(i.rewards);if(!a.length)return this.gp_layer_progress.visible=!1,this.gp_layer_progress.height=0,this.gp_layer_progress.available=!1,this.gp_exit.visible=!0,void(this.gp_exit.height=this.RIGHT_BOTTOM_BTN_HEIGHT);this.gp_layer_progress.visible=!0,this.gp_layer_progress.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.gp_layer_progress.available=!0,this.gp_exit.visible=!1,this.gp_exit.height=0,a.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:e[0],code:e[1],num:e[2]}),s.gp_progress_rewards.addChild(t)})}if(this.gp_layer_progress.available){var n=this.py.riskProgress,r=((h={})[RiskDataType.Main]="主线任务",h[RiskDataType.Creep]="怪物",h[RiskDataType.Maze]="迷宫",h[RiskDataType.Box]="宝箱",h[RiskDataType.Fortress]="副本",h[RiskDataType.Mine]="矿产",h[RiskDataType.Npc]="特殊事件",h),o=[RiskDataType.Main,RiskDataType.Creep,RiskDataType.Maze,RiskDataType.Box,RiskDataType.Fortress,RiskDataType.Mine];n.datas.sort(function(e,t){return o.indexOf(e.type)-o.indexOf(t.type)});var h,l=0,c=0;function d(e){s.pb_layerProgress.maximum=c,s.pb_layerProgress.value=l,s.pb_layerProgress.step=c/100*2,s.lb_progress_title.textFlow=[{text:"地图探索统计",style:{textColor:8872248}},{text:"（"+Math.floor(100*l/c)+"%）",style:{textColor:l==c?3769856:10878976}}],n.isGot||c!=l?NoticeManager.redp(s.pb_layerProgress,!1):NoticeManager.redp(s.pb_layerProgress,!0,{x:75,y:15})}this.gp_progress_items.removeChildren(),n.datas.forEach(function(e){var t=e.progress,i=e.total;i<t&&(t=i);var a=new eui.Group;a.width=225;var n=new eui.Label("·"+r[e.type]);n.textColor=8872248,n.size=20,a.addChild(n);var o=new eui.Label(t+"/"+i);o.textColor=t==i?3769856:8872248,o.size=20,o.right=0,a.addChild(o),s.gp_progress_items.addChild(a),l+=t,c+=i}),this.gp_progress_details.height=this.gp_progress_items.height+186,c=c||(l=1),e&&e.fromPush?DragonBoneTools.create("common_xing",function(t){t.animation.play("common_xing",0);var e=s.map.me,i=Utils.ComponentUtils.getPosInView(e);t.x=i.x+e.width/2,t.y=i.y,s.addChild(t),egret.Tween.get(t).to({y:i.y-120},700,egret.Ease.quadOut).wait(300).call(function(){var e=Utils.ComponentUtils.getPosInView(s.pb_layerProgress);egret.Tween.get(t).to({x:e.x+s.pb_layerProgress.width/2},300,egret.Ease.quadOut),egret.Tween.get(t).to({y:e.y+s.pb_layerProgress.height/2},300,egret.Ease.quadIn).call(function(){t.parent&&t.parent.removeChild(t),d(),DragonBoneTools.playOnce({effectName:"common_tansuodu",parent:s.pb_layerProgress,y:s.pb_layerProgress.height/2-10,z:2})})})}):d()}},i.prototype.goldMineEffect=function(){var r=p.Config.riskMine();if(0<this.py.minesInfo.length){var h=[];this.py.minesInfo.forEach(function(e){for(var t=r[e.id],i=JSON.parse(t.rewards)[0],a=!0,n=0,o=h;n<o.length;n++){var s=o[n];if(s[0]==i[0]){s[2]+=i[2],a=!1;break}}a&&h.push(i)}),this.displayMineEffect(h,0)}},i.prototype.displayMineEffect=function(e,t){var i=this;if(t>=e.length)this.mineUpdateTimer&&(egret.clearTimeout(this.mineUpdateTimer),this.mineUpdateTimer=egret.setTimeout(function(){i.goldMineEffect()},this,1e4));else{var a=e[t];Utils.MsgUtils.addRewardMsg({rewards:[a]},this.gp_jinkuang,{oriY:100,offsetY1:-100,cb:function(){egret.setTimeout(function(){i.displayMineEffect(e,t+1)},i,100)}})}},i.prototype.perShow=function(){return this.map&&this.map.onThisMapSwitch(!0),t.prototype.perShow.call(this)},i.prototype.perClose=function(){return this.map&&this.map.onThisMapSwitch(!1),DragonBoneTools.removeAllNotStageDB(),t.prototype.perClose.call(this)},i.prototype.shouJinbiEffect=function(){for(var e=0;e<3;++e){var t=this["effect_"+e];t&&(t.visible=!1)}DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:this.gp_jinbi_effect,x:this.gp_jinbi_effect.width/2,y:this.gp_jinbi_effect.height/2-30})},i.prototype.jibiduiEffect=function(e){function t(t){n["effect_"+t]||MovieClipTools.create("common_jinbishan",function(e){e.x=a[t].x,e.y=a[t].y,e.animation.play("common_jinbishan",-1),this["effect_"+t]=e,this["effect_"+t].visible=a[t].visible,this.gp_jinbi_effect.addChild(this["effect_"+t])},n),n["effect_"+t]&&(n["effect_"+t].visible=a[t].visible)}for(var i=3<e?0:10,a={0:{x:120,y:this.gp_jinbi_effect.height/2+i,visible:2<e},1:{x:this.gp_jinbi_effect.width/2,y:this.gp_jinbi_effect.height/2-20,visible:e<=2||4<=e},2:{x:this.gp_jinbi_effect.width-120,y:this.gp_jinbi_effect.height/2+i,visible:2<e}},n=this,o=0;o<3;++o)t(o)},i);function i(){var e=t.call(this)||this;return e.RIGHT_BOTTOM_BTN_HEIGHT=110,e.hasUpdateLiuhai=!1,e.skinName="GuajiViewSkin",e.py=p.AppFacade.getInstance().retrieveProxy(p.GuajiPy.N),e.guideProxy=p.AppFacade.getInstance().retrieveProxy(p.GuidePy.N),e.taskPy=p.AppFacade.getInstance().retrieveProxy(p.TaskPy.N),e.guideEffectWait=!0,e}p.GuajiView=e}(game=game||{}),function(e){var i,t=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.displayEffects()},a.prototype.updateView=function(){},a.prototype.displayEffects=function(){var e,t=this;e=function(){egret.setTimeout(function(){DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:t.gp_bling_effect,x:t.gp_bling_effect.width/2,y:t.gp_bling_effect.height/2,doneCB:function(){egret.setTimeout(function(){PopUpManager.removePopUp(t),t.params.doneCB&&t.params.doneCB()},t,200)}}),egret.setTimeout(function(){t.img_title.visible=!1,t.img_bg.visible=!1},t,400)},t,500)},DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_2",parent:this.gp_airen_effect,x:this.gp_airen_effect.width/2,y:this.gp_airen_effect.height/2,doneCB:e()})},a);function a(e){var t=i.call(this)||this;return t.skinName="QuickMineEffectSkin",t.params=e,t}e.QuickMineView=t}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=this.height=0,this.initScan()},a.prototype.showTargetDir=function(e){null!=e?(this.img_targetDir||(this.img_targetDir=new eui.Image,this.img_targetDir.source="_main_m_json.mx_img_jiantou",this.img_targetDir.y=-50,this.img_targetDir.name="targetDir",this.addChild(this.img_targetDir),egret.Tween.get(this.img_targetDir,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)),this.img_targetDir.visible=!0,1==e?this.img_targetDir.scaleX=this.img_targetDir.scaleY=1:0==e?this.img_targetDir.scaleX=this.img_targetDir.scaleY=-1:3==e?(this.img_targetDir.scaleX=-1,this.img_targetDir.scaleY=1):(this.img_targetDir.scaleX=1,this.img_targetDir.scaleY=-1)):this.img_targetDir&&(this.img_targetDir.visible=!1)},a.prototype.initScan=function(){var e=new eui.Image("xinshou_img_zhedang_png");e.touchEnabled=!1,e.scaleX=e.scaleY=10,e.anchorOffsetX=e.anchorOffsetY=500,this.addChild(e)},a.prototype.onMove=function(){this.img_targetDir&&(this.img_targetDir.visible=!1)},a);function a(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e}e.Camera=i}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(a,t),a.prototype.onDestroy=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this)},a.prototype.checkPosValid=function(e,t){return this.map.checkPosValid(e,t)},a.prototype.enterFrame=function(){var e=this;if(this.isUICreated){if(this.isPosDirty){this.isPosDirty=!1;var t=this.map.tile2Pos(this._tileX,this._tileY);if(!this.hasEnterMap||1!=this.mapObjType&&2!=this.mapObjType)this.x=t.x,this.y=t.y,this.tileXYChange();else{this.isMoving=!0;var i=(t.x-this.x)*this.map.scaleX,a=(t.y-this.y)*this.map.scaleY;this.tileXYChange(),egret.Tween.get(this).to({x:t.x,y:t.y},this.map.npcMovingDura).call(function(){e.isMoving=!1,e.onAfterWalk()}),1==this.mapObjType&&this.map.scrollByOffset(i,a)}egret.Point.release(t)}this.isZOrderDirty&&(this.isZOrderDirty=!1,this.map.reqCalAllZOrder()),this.tileXYChangeFrameCheck()}},a.prototype.updateFixedPos=function(){var e=this.map.tile2Pos(this._tileX,this._tileY);this.x=e.x,this.y=e.y,this.tileXYChange(),this.map.reqCalAllZOrder()},a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.width=139,this.height=70,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.gp_foot=new eui.Group,this.gp_foot.width=this.width,this.gp_foot.height=this.height,this.gp_foot.horizontalCenter=0,this.gp_foot.bottom=38,this.addChild(this.gp_foot),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.onDestroy()},this),this.isUICreated=!0,this.touchEnabled=!1,this.gp_foot.touchEnabled=!0,this.gp_foot.touchChildren=!1},a.prototype.tileXYChangeFrameCheck=function(){this.zOrderDirtyframePass&&(this.zOrderDirtyframePass--,this.zOrderDirtyframePass<=0)&&(this.zorder=10*this.map.getTileIndex(this._tileX,this._tileY),this.map.tile2Deep(this._tileX,this._tileY),this.isZOrderDirty=!0)},a.prototype.tileXYChange=function(){this.zOrderDirtyframePass=5},a.prototype.onAfterWalk=function(){},Object.defineProperty(a.prototype,"tileX",{get:function(){return this._tileX},set:function(e){e!=this._tileX&&(this._tileX=e||0,this.isPosDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"tileY",{get:function(){return this._tileY},set:function(e){e!=this._tileY&&(this._tileY=e||0,this.isPosDirty=!0)},enumerable:!0,configurable:!0}),a.prototype.reset=function(){this.hasEnterMap=!1},a.prototype.onOPComeBackCB=function(){var e=this;this.hasEventListener(egret.Event.ENTER_FRAME)||this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.onDestroy()},this)},a);function a(){var e=t.call(this)||this;return e._tileX=0,e._tileY=0,e.zorder=0,e.zOrderDirtyframePass=0,e.serverTileX=0,e.serverTileY=0,e.addEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e),e}e.MapObj=i}(game=game||{}),function(o){var e=(t.create=function(e){if(e.vo){var t=void 0;if(null!=e.vo.type)switch(e.vo.type){case RiskEventType.Hinder:t=new o.EPHinder(e);break;case RiskEventType.Box:t=new o.EPBox(e);break;case RiskEventType.Mine:t=new o.EPMine(e);break;case RiskEventType.Creep:t=new o.EPCreep(e);break;case RiskEventType.StormWarCreep:t=new o.EPStormWarCreep(e);break;case RiskEventType.Gate:t=new o.EPGate(e);break;case RiskEventType.Tavern:case RiskEventType.Shop:case RiskEventType.MysticalShop:t=new o.EPShop(e);break;case RiskEventType.Fortress:t=new o.EPFortress(e);break;case RiskEventType.Maze:t=new o.EPMaze(e);break;case RiskEventType.Npc:t=new o.EPNpc(e);break;case RiskEventType.Quora:t=new o.EPQuora(e);break;case RiskEventType.Select:t=new o.EPSelect(e);break;case RiskEventType.Collect:t=new o.EPCollect(e);break;case RiskEventType.FingerGame:t=new o.EPFingerGame(e);break;case RiskEventType.GuessSize:t=new o.EPGuessSize(e);break;case RiskEventType.Trigger:t=new o.EPTrigger(e);break;case RiskEventType.Recharge:t=new o.EPFirstRecharge(e);break;case RiskEventType.StoryCreep:t=new o.EPCreep(e);break;case RiskEventType.BoxCreep:t=new o.EPBoxCreep(e);break;case RiskEventType.Task:t=new o.EPTask(e);break;case RiskEventType.Trigger2:var i=e.vo&&o.Config.riskEvent()[e.vo.eventId];if(i)switch(JSON.parse(i.detail)[0]){case RiskTrigger2Type.FlipCard:t=new o.EPSameCard(e);break;case RiskTrigger2Type.Unicursal:t=new o.EPUnicursal(e);break;case RiskTrigger2Type.Puzzle:t=new o.EPPuzzle(e);break;case RiskTrigger2Type.Sieve:t=new o.EPSieve(e);break;default:t=new o.EPTips(e)}else t=new o.EPTips(e);break;case RiskEventType.Manor:t=new o.EPManor(e);break;default:t=new o.EPTips(e)}else switch(e.vo.fadeType){case FadeRiskEventType.Creep:t=new o.EPFadeCreep(e);break;case FadeRiskEventType.Boss:t=new o.EPFadeBoss(e);break;case FadeRiskEventType.BigBoss:t=new o.EPFadeBigBoss(e);break;case FadeRiskEventType.ICON:t=new o.EPFadeIcon(e);break;case FadeRiskEventType.BigBoss2:t=new o.EPFadeBigBoss2(e)}return t}egret.warn("参数不对")},t);function t(){}o.EventPointFactory=e;var i,a=(i=o.MapObj,__extends(n,i),n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【RiskEP】："].concat(e))},n.getSubType=function(e){var t=o.Config.riskEvent()[e];return t&&t.subType||0},Object.defineProperty(n.prototype,"visible",{get:function(){return this.$visible},set:function(e){this.$setVisible(e),this.onVisibleUpdate()},enumerable:!0,configurable:!0}),n.prototype.addEffect=function(){this.effect||MovieClipTools.create("common_ditutswp",function(e){(this.effect=e).x=this.gp_foot.width/2,e.y=0,e.animation.play("common_ditutswp",-1),this.addChild(e)},this)},n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon=new eui.Image,this.img_icon.horizontalCenter=0,this.img_icon.bottom=0,this.addChild(this.img_icon),this.gp_effect=new eui.Group,this.gp_effect.horizontalCenter=0,this.gp_effect.bottom=0,this.addChild(this.gp_effect),this.img_tips_bg=new eui.Image,this.img_tips_bg.horizontalCenter=0,this.img_tips_bg.bottom=0,this.img_tips_bg.source="_guaji_m_json.mx_img_mingchengdi",this.addChild(this.img_tips_bg),this.lb_tips=new eui.Label,this.lb_tips.bottom=3,this.lb_tips.size=16,this.lb_tips.verticalCenter=void 0,this.lb_tips.horizontalCenter=0,this.lb_tips.bold=!0,this.addChild(this.lb_tips),this.gp_foot.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.map.handleTouchTap(this.tileX,this.tileY)},this),this.touchEnabled=!1,this.img_icon.touchEnabled=!1,this.img_tips_bg.touchEnabled=!1},n.prototype.makeDefaultIcon=function(){var e=this.vo.eventId,t=o.Config.riskEvent()[e];if(t){if(e&&t){var i=t.descId,a=o.Config.riskEventDesc()[i];if(!a||!i)return"";var n=o.GeneralConfig.getGuajiImg(a.icon);return 1==n[0]?this.img_icon.source=n[1]:2==n[0]&&(this.cu_model&&this.cu_model.parent&&this.cu_model.parent.removeChild(this.cu_model),this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({model:n[1],isStatic:!0})),n[1]}return""}},n.prototype.updateData=function(){if(this.vo.isDirty){this.log("risk脏数据"),this.vo.iAmClean(),this.vo&&(this.tileX=this.vo.position.x,this.tileY=this.vo.position.y);var e=o.Config.riskEvent()[this.vo.eventId];if(e){var t=o.Config.riskEventDesc()[e.descId];if(t){var i=t.scaleX/100||1,a=t.scaleY/100||1;this.gp_foot.scaleX=i,this.gp_foot.scaleY=a}}this.onDataChange()}},n.prototype.onDataChange=function(){egret.warn("子类需要重写该方法")},n.prototype.onTrigger=function(e,t){e&&e()},n.prototype.checkTriggerCD=function(){var e=Utils.TimerManager.getServerTime();return n.lastTriggerTime+n.TriggerCD<e?(n.lastTriggerTime=e,!0):(console.log("事件重复点击"),!1)},n.prototype.onDestroy=function(){},n.prototype.onVisibleUpdate=function(){this.isMapMoving||this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!this.visible)},n.prototype.onMapMoving=function(e){this.isMapMoving=e,this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,e)},n.prototype.onMapSwitch=function(e){this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&(e?DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!this.visible):DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!0))},n.prototype.hudongWithEP=function(e){},n.prototype.checkNotice=function(){return!0},n.prototype.handleStory=function(e,t){void 0===e&&(e=0);var i=o.Config.riskEvent()[this.vo.eventId],a=void 0;i.story&&(a=JSON.parse(i.story)[e]),a&&i&&i.story?PopUpManager.addPopUp({obj:new o.StoryView2({storyId:a,position:void 0,cb:function(){t&&t()}})}):t&&t()},n.lastTriggerTime=0,n.TriggerCD=2,n);function n(e){var t=i.call(this)||this;return t.aStarCost=0,t.canTrigger=!0,t.isMapMoving=!1,t.py=o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N),t.mapObjType=100,(t.params=e).vo&&(t.type=e.vo.type,t.vo=e.vo,t.tileX=t.vo.position.x,t.tileY=t.vo.position.y),t.map=e.map,t}o.EventPoint=a;var s,r=(__extends(h,s=a),h.prototype.updateData=function(){this.vo.isDirty&&this.vo.config&&(this.vo.config.scaleX&&(this.gp_foot.scaleX*=this.vo.config.scaleX/100),this.vo.config.scaleY&&(this.gp_foot.scaleY*=this.vo.config.scaleY/100)),s.prototype.updateData.call(this)},h);function h(){return null!==s&&s.apply(this,arguments)||this}o.FadeEventPoint=r}(game=game||{}),function(e){var t,i=(t=e.MapObj,__extends(a,t),a.prototype.tileXYChange=function(){t.prototype.tileXYChange.call(this),this.zorder+=1},a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},a.prototype.onAfterWalk=function(){},a.prototype.onWalking=function(){},a.prototype.onChangingDir=function(e){},a.prototype.resetWalk=function(){this.tileX=this.lastTileX,this.tileY=this.lastTileY},a.prototype.switchDir=function(e,t){this.onChangingDir(this.calDir(e,t))},a.prototype.calDir=function(e,t){null==this.lastTileX&&(this.lastTileX=this.tileX),null==this.lastTileY&&(this.lastTileY=this.tileY);var i=3;return e>this.lastTileX?i=1:e<this.lastTileX?i=0:t>this.lastTileY?i=3:t<this.lastTileY&&(i=2),i},a.prototype.walkToTile=function(e,t){this.tileX==e&&this.tileY==t||this.isMoving||this.checkPosValid(e,t)&&(this.lastTileX||(this.lastTileX=this._tileX),this.lastTileY||(this.lastTileY=this._tileY),this.lastTileX=this.tileX,this.lastTileY=this.tileY,this.onChangingDir(this.calDir(e,t)),this.tileX=e,this.tileY=t,this.onWalking())},a);function a(){var e=t.call(this)||this;return e.valid=!0,e}e.Npc=i}(game=game||{}),function(e){var i,t=(i=e.Npc,__extends(a,i),a.prototype.switchVisible=function(e){this.img_finger.x=this.img_finger.y=0,e?(this.visible=!0,egret.Tween.get(this.img_finger,{loop:!0}).to({y:20},500).to({y:0},500)):(this.visible=!1,egret.Tween.removeTweens(this.img_finger))},a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img_finger=new eui.Image,RES.getResAsync("xinshou_img_shouzhi_png",function(e){t.img_finger.source=e,t.img_finger.anchorOffsetX=20,t.img_finger.anchorOffsetY=39},this),this.gp_foot.addChild(this.img_finger)},a.prototype.tileXYChange=function(){i.prototype.tileXYChange.call(this),this.zorder=1e11},a);function a(){var e=i.call(this)||this;return e.mapObjType=3,e.visible=!1,e}e.Finger=t}(game=game||{}),function(i){var a,e=(a=BasePanel,__extends(t,a),t.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.inButton(),this.updateView()},t.prototype.inButton=function(){var e=this;this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide(),e.params.customCB&&e.params.customCB(e.opperationParams)},this)},t.prototype.updateView=function(){var e=void 0;if(this.params.vo){e=i.Config.getRiskMapByCode(this.params.vo.code);var t=this.py.getShowTipsForPosition(this.params.vo.position);this.lb_tips.text=e.desc.format([t]),this.params.vo.entityType==EEntityType.EEntityTypeMap&&(this.params.canGet?this.btn_ok.icon="mx_btn_wabao_png":this.params.showAutoBtn||this.params.forceJumpAndSearch?this.btn_ok.icon="mx_btn_zidongxunlu_png":this.btn_ok.icon="common_btn_queding_png")}else e=this.params.config,this.lb_tips.text=e.desc.format(["？？"]),this.btn_ok.icon="common_btn_queding_png";this.img_icon.source=ResourceUtils.png(e.icon),this.lb_reward_tips.visible=!1},t);function t(e){var t=a.call(this)||this;return t.skinName="GuajiCBTDetailPanelSkin",t.params=e,t.py=i.AppFacade.getInstance().retrieveProxy(i.GuajiPy.N),t}i.GuajiCBTDetailPanel=e}(game=game||{}),function(l){var t,e=(t=BasePanel,__extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.blb_title.text="宝藏守卫",this.rootPanel.onCloseCB=function(){e.hide()},Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.Demon})})},this)},i.prototype.initList=function(){this.list_item.itemRenderer=n},i.prototype.updateView=function(e){if(this.firstIn)this.firstIn=!1,l.GameMVC.guajiPy.GetDemonList();else{var t=l.GameMVC.guajiPy.playerDemonInfo.count;this.blb_times.text=t.toString();var i=l.GameMVC.guajiPy.demonList,a=[],n=l.GameMVC.playerPy.playerInfoVO.playerId;for(var o in i){var s=i[o],r=s.baseInfo.playerId==n;if(0!=t||r){var h={info:s,self:r};a.push(h)}}a.length?(a.sort(function(e,t){return e.info.excapeDt-t.info.excapeDt}),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(a):this.list_item.dataProvider=new eui.ArrayCollection(a),this.dtRefreshTimer||(this.dtRefreshTimer=egret.setInterval(this.refreshDt,this,1e3))):this.hide()}},i.prototype.refreshDt=function(){var i=Utils.TimerManager.getServerTime();this.list_item.numChildren&&this.list_item.$children.forEach(function(e){var t=e.data.info.excapeDt-i;0<=t&&(e.blb_time.text=Utils.TimerManager.getFormatBySecond1(t))})},i.prototype.perClose=function(){this.dtRefreshTimer&&(egret.clearInterval(this.dtRefreshTimer),this.dtRefreshTimer=void 0)},i);function i(){var e=t.call(this)||this;return e.firstIn=!0,e.skinName="GuajiDemonSkin",e}l.GuajiDemonPanel=e;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this.btn_challenge,egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.guajiPy.ChallengeDemon(e.data.info.uuid)},this),this.pb_hp.labelFunction=function(e,t){return(e/t*100).toFixed(0)+"%"}},o.prototype.dataChanged=function(){var i=this,e=this.data.info;this.lb_name.text="发现者："+e.baseInfo.name;var t=e.creeps[0];this.baseItem.updateData({code:t});var a=this.data.self&&e.foundRewards||JSON.parse(e.config.killRewards);this.gp_rewards.removeChildren(),a.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),i.gp_rewards.addChild(t)}),this.pb_hp.maximum=e.totalLife,this.pb_hp.value=e.leftLife,this.blb_time.text=Utils.TimerManager.getFormatBySecond1(e.excapeDt-Utils.TimerManager.getServerTime())},o);function o(){var e=a.call(this)||this;return e.skinName="GuajiDemonPanel_DemonItem",e}}(game=game||{}),function(c){var t,e=(t=BasePanel,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,t=this.taskPy.getCurGuideTask(0==c.GameMVC.guajiPy.localType?TaskType.Guide:TaskType.DifficultyGuide);this.taskPy.getTaskStatus(t)==TaskStatus.DONE?this.taskPy.GetTaskReward(t.config.type,t.config.code,function(){e.hide()}):this.hide()},this)},i.prototype.updateView=function(e){var i=this,t=this.taskPy.getCurGuideTask(0==c.GameMVC.guajiPy.localType?TaskType.Guide:TaskType.DifficultyGuide),a=t.config,n=this.taskPy.getTaskStatus(t),o=(JSON.parse(a.target),"");o=1==a.progress?n==TaskStatus.DONE?"(1/1)":"(0/1)":t.key.toString()+"/"+a.progress,this.btn_confirm.label=n==TaskStatus.DONE?"领取":"我知道了";var s=new eui.Label;s.size=22,s.width=448,s.textFlow=[{text:"[任务目标]：",style:{textColor:11222333}},{text:a.name,style:{textColor:7096888}},{text:o,style:{textColor:7096888}}],this.gp_desc.addChild(s);var r=new eui.Label;r.size=22,r.width=448,r.textFlow=[{text:"[任务地点]：",style:{textColor:11222333}},{text:a.map,style:{textColor:7096888}}],this.gp_desc.addChild(r);var h=new eui.Label;h.size=22,h.width=448,h.textFlow=[{text:"[任务内容]：",style:{textColor:11222333}},{text:a.desc,style:{textColor:7096888}}],this.gp_desc.addChild(h);var l=JSON.parse(a.rewards);this.gp_reward.removeChildren(),l.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),i.gp_reward.addChild(t)})},i);function i(){var e=t.call(this)||this;return e.taskPy=c.AppFacade.getInstance().retrieveProxy(c.TaskPy.N),e.skinName="GuajiMainTaskSkin",e}c.GuajiMainTaskPanel=e}(game=game||{}),function(r){var i,e=(i=BasePanel,__extends(t,i),t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="资产管理",this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.guajiPy.GetMineRewards({cb:function(){t.updateView(),t.isGotReward=!0}})},this),this.list_root.itemRenderer=n,this.collection=new eui.ArrayCollection,this.list_root.dataProvider=this.collection,this.mineInfo(),this.updateTimer=egret.setInterval(function(){t.mineInfo()},this,3e4)},t.prototype.mineInfo=function(){var e=this;this.guajiPy.GetMineInfo({cb:function(){e.updateView()},ispush:!0})},t.prototype.updateView=function(e){var n=this;if(e&&e.mines)e.mines.forEach(function(e){var t=n.list_root.$children;for(var i in t){var a=t[i];if(a.data.id==e.id){a.updateReward(e);break}}});else{var a=r.Config.riskMine();this.collection.removeAll();var o=0,s={};for(var t in this.guajiPy.minesInfo.forEach(function(e){var t=a[e.id],i=JSON.parse(t.rewards)[0];s[t.type]||(s[t.type]={id:e.id,totalRewards:0,name:t.name,icon:r.GeneralConfig.getGuajiImg(t.icon)[1],type:t.type,interval:1*t.interval,resC:r.GeneralConfig.getEntityConfigByCode(i[0],i[1]),speedRewards:0,count:0,upLimit:t.upLimit,reward:[i]}),s[t.type].count+=1,s[t.type].speedRewards+=i[2],e.rewards[0]&&(o+=e.rewards[0].num,s[t.type].totalRewards+=e.rewards[0].num)}),s)this.collection.addItem(s[t]);this.gp_empty.visible=0==this.collection.length;var i=0!=this.collection.length&&0==o;this.isGotReward=i,this.btn_oneKey.touchEnabled=!i,UIActionManager.setGrey(this.btn_oneKey,i),this.collection.refresh()}},t.prototype.perClose=function(){this.isGotReward&&r.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE,{isGot:this.isGotReward}),this.updateTimer&&egret.clearInterval(this.updateTimer)},t);function t(e){var t=i.call(this)||this;return t.isGotReward=!1,t.skinName="GuajiMinesListPanelSkin",t.params=e,t.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),t}r.GuajiMinesListPanel=e;var a,n=(a=eui.ItemRenderer,__extends(o,a),o.prototype.childrenCreated=function(){},o.prototype.dataChanged=function(){this.img_icon.source=this.data.icon,this.lb_name.text=this.data.name,this.lb_count.text="拥有:"+this.data.count,this.img_res.source=this.img_res2.source=ResourceUtils.png(this.data.resC.icon),-1!=[RiskMineType.Artifact,RiskMineType.Equip].indexOf(this.data.type)?this.lb_speed.text="概率产出":this.lb_speed.text="+"+this.data.speedRewards+"/"+this.data.interval+"秒";var e,t=this.actProxy.allActivityData[EActivityType.WholeLifeCard];e=t&&t.data&&t.data.hasPurchased?Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards*1.5):Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards),this.lb_total.text=Utils.MathUtils.formatNumStyle1(this.data.totalRewards+0)+"/"+e},o.prototype.updateReward=function(e){var t,i=this.actProxy.allActivityData[EActivityType.WholeLifeCard];t=i&&i.data&&i.data.hasPurchased?Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards*1.5):Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards),Utils.MsgUtils.addRewardMsg({rewards:e.rewards},this,{oriY:200,offsetY1:-100,offsetY2:-100}),this.data.totalRewards+=e.rewards[0].num,this.lb_total.text=Utils.MathUtils.formatNumStyle1(this.data.totalRewards)+"/"+t},o);function o(){var e=a.call(this)||this;return e.actProxy=r.AppFacade.getInstance().retrieveProxy(r.ActivityPy.N),e.skinName="GuajiMinesListItemRenderSkin",e.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.timer&&egret.clearInterval(e.timer)},e),e}}(game=game||{}),function(i){var a,e=(a=BasePanel,__extends(t,a),t.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.lb_mapName.text="地 图",this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_map.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide();var t=i.AppFacade.getInstance().retrieveProxy(i.GuajiPy.N);t.GetLayerNum(function(){PopUpManager.addPopUp({obj:new i.GuajiGateListPanel({type:t.localType}),closeCB:function(e){e&&t.MiniTriggerEvent(Number(e))}})})},this),this.gp_tile=new eui.Group,this.gp_tile.horizontalCenter=this.gp_tile.verticalCenter=0,this.gp_tile.scaleX=this.gp_tile.scaleY=1.2,this.gp_adapter=new eui.Group,this.gp_adapter.addChild(this.gp_tile),this.gp_viewport.addChild(this.gp_adapter)},t.prototype.updateView=function(e){var a=this;e&&(this.mwArr=e.mwArr,this.tileX=e.tileX,this.tileY=e.tileY);var t=i.Config.riskLayer()[this.guajiPy.curLayerInfo.curPosVO.layerId];this.lb_mapName.text=i.Config.risk()[this.guajiPy.curLayerInfo.curPosVO.layerId]&&i.Config.risk()[this.guajiPy.curLayerInfo.curPosVO.layerId].name,this.w=t.long,this.h=t.wide,RES.getResAsync(t.tiled,function(e){try{e.layers.forEach(function(e){"tiled"==e.name?a.tmxTiledArr=e.data:"hinder"==e.name&&(a.tmxHinderArr=e.data)}),a.tilesets={},e.tilesets.forEach(function(i){i.tiles.forEach(function(t){t.properties.forEach(function(e){a.tilesets[t.id+i.firstgid]||(a.tilesets[t.id+i.firstgid]={}),a.tilesets[t.id+i.firstgid][e.name]=e.value})})})}catch(e){return void egret.warn("地形解析失败",e)}a.initAll()},this)},t.prototype.getTileIndex=function(e,t){return e+t*this.w},t.prototype.tile2MNMPos=function(e,t){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,this.scl_map.height/2)),egret.Point.create(this.jiZhunMNMP.x+67*(e+(this.h-1)-t)/2,this.jiZhunMNMP.y+37*(e+t-(this.h-1))/2)},t.prototype.initAll=function(){var h=this;this.gp_tile.removeChildren();var l=void 0,c=void 0,d=void 0,p=void 0,g=new egret.Shape;function e(r){function e(o){var e=u.getTileIndex(r,o),t=u.tmxTiledArr[e];if(null==t)return egret.warn("地图尺寸"+u.w+"x"+u.h+"超过地形尺寸，请检查配置"),"break";if(0!=t&&0!=u.mwArr[e]){var i=u.tmxHinderArr[e],a=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==i?2:1)),n=u.tile2MNMPos(r,o);a.x=n.x,a.y=n.y,(null==l||n.x<l)&&(l=n.x),(null==c||n.x>c)&&(c=n.x),(null==d||n.y<d)&&(d=n.y),(null==p||n.y>p)&&(p=n.y),u.tileIndex2MNM[e]=a,u.gp_tile.addChild(a),egret.Point.release(n);var s=[[[32.5,0],[0,-1]],[[65,17.5],[1,0]],[[32.5,35],[0,1]],[[0,17.5],[-1,0]]];s.forEach(function(e){e[0][0]+=n.x,e[0][1]+=n.y}),s.forEach(function(e,t){var i=[r+e[1][0],o+e[1][1]];if(i[0]<0||i[1]<0||i[0]>h.w-1||i[1]>h.h-1||!h.tmxTiledArr[h.getTileIndex(i[0],i[1])]){var a=e[0],n=(s[t+1]||s[0])[0];g.graphics.moveTo(a[0],a[1]),g.graphics.lineTo(n[0],n[1])}})}}for(var t=0;t<u.h&&"break"!==e(t);t++);}g.graphics.lineStyle(3,0);for(var u=this,t=0;t<this.w;t++)e(t);for(var i in g.graphics.endFill(),this.tileIndex2MNM){var a=this.tileIndex2MNM[i];a.x-=l,a.y-=d}g.x-=l,g.y-=d,this.gp_tile.addChild(g),this.guajiPy.curLayerInfo.events.forEach(function(e){var t=h.getTileIndex(e.position.x,e.position.y);if(h.tileIndex2MNM[t]){var i=new eui.Image;i.scaleX=i.scaleY=1.4,RES.getResAsync(MAP_EP_TYPE_IMG_MNM[e.type],function(e){i.source=e,i.anchorOffsetX=e.textureWidth/2,i.anchorOffsetY=e.textureHeight},h),i.x=h.tileIndex2MNM[t].x+32.5,i.y=h.tileIndex2MNM[t].y+17.5,h.tileIndex2MNMEP[t]=i,h.gp_tile.addChild(i)}}),this.updateMW(),this.img_meRedPointInMNM=new eui.Image,this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(e){h.img_meRedPointInMNM.source=e,h.img_meRedPointInMNM.anchorOffsetX=e.textureWidth/2,h.img_meRedPointInMNM.anchorOffsetY=e.textureHeight},this),this.gp_tile.addChildAt(this.img_meRedPointInMNM,-1);var n=this.getTileIndex(this.tileX,this.tileY);this.tileIndex2MNM[n]&&(this.img_meRedPointInMNM.x=this.tileIndex2MNM[n].x+32.5,this.img_meRedPointInMNM.y=this.tileIndex2MNM[n].y+17.5),this.scl_map.alpha=0,egret.setTimeout(function(){h.resizeAdapter(),h.resetMNM(0),egret.Tween.get(h.scl_map).to({alpha:1},200)},this,100)},t.prototype.resizeAdapter=function(){this.gp_tile.height*this.gp_tile.scaleY<this.scl_map.height&&(this.gp_adapter.height=this.scl_map.height+1),this.gp_tile.width*this.gp_tile.scaleX<this.scl_map.width&&(this.gp_adapter.width=this.scl_map.width+1),this.gp_adapter.validateNow()},t.prototype.resetMNM=function(e){if(void 0===e&&(e=250),this.img_meRedPointInMNM){var t=this.img_meRedPointInMNM.localToGlobal(this.img_meRedPointInMNM.anchorOffsetX,this.img_meRedPointInMNM.anchorOffsetY),i=this.scl_map.viewport.globalToLocal(t.x,t.y);egret.Tween.get(this.scl_map.viewport).to({scrollH:i.x-this.scl_map.viewport.width/2,scrollV:i.y-this.scl_map.viewport.height/2},e)}},t.prototype.updateMW=function(){},t);function t(e){var t=a.call(this)||this;return t.guajiPy=i.AppFacade.getInstance().retrieveProxy(i.GuajiPy.N),t.tileIndex2MNM={},t.tileIndex2MNMEP={},t.skinName="GuajiMiniMapPanelSkin",t}i.GuajiMiniMapPanel=e}(game=game||{}),function(n){var t,e=(t=BasePanel,__extends(i,t),i.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.pos2Item[1]=this.cu_item1,this.pos2Item[2]=this.cu_item2,this.pos2Item[3]=this.cu_item3,this.pos2Item[4]=this.cu_item4,this.pos2Item[5]=this.cu_item5,this.py.riskMultiConstV||(this.py.riskMultiConstV=JSON.parse(n.Config.constConfig().riskMultiConfig.constValue)),this.rootPanel.blb_title.text="组队挂机",this.rootPanel.onCloseCB=function(){i.hide()},Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){var e=HELP_CONST[MODULE.RiskMulti].content,t=n.Config.unlockConfig()[MODULE.RiskMulti];e=t?e.format([JSON.parse(t.condition)[1],Math.floor(i.py.riskMultiConstV[1]/60/60)]):e.format(["1",Math.floor(i.py.riskMultiConstV[1]/60/60)]),PopUpManager.addPopUp({obj:new n.HelpDialog({text:e})})},this),this.dtRefreshTimer||(this.dtRefreshTimer=egret.setInterval(this.refreshDt,this,1e3)),this.py.RiskMultiCommand("GetRoomInfo")},i.prototype.updateView=function(e){this.updateRoomInfo(),this.updatePlayers()},i.prototype.updatePlayers=function(){var t=this,i={},a=!1;for(var e in this.py.riskMultiRoomInfo.members.forEach(function(e){i[e.pos]=!0,t.pos2Item[e.pos].updateForPlayer(e),e.baseInfo.playerId==n.GameMVC.playerPy.playerInfoVO.playerId&&(a=!0)}),this.pos2Item)i[e]||this.pos2Item[e].reset();0<this.py.riskMultiRoomInfo.members.length&&!a&&(Utils.MsgUtils.addMidMsg("你已不在房间了"),this.hide())},i.prototype.updateRoomInfo=function(){1<this.py.riskMultiRoomInfo.members.length?this.blb_total.text=Math.floor(this.py.riskMultiRoomInfo.gain/10)+"%":this.blb_total.text="0%"},i.prototype.refreshDt=function(){for(var e in this.pos2Item)this.pos2Item[e].updateTime()},i.prototype.perClose=function(){this.dtRefreshTimer&&(egret.clearInterval(this.dtRefreshTimer),this.dtRefreshTimer=void 0)},i);function i(){var e=t.call(this)||this;return e.pos2Item={},e.skinName="GuajiMultiPanelSkin",e.py=n.GameMVC.guajiPy,e}n.GuajiMultiPanel=e}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_yaoqing,egret.TouchEvent.TOUCH_TAP,function(){if(t.py.riskMultiRoomInfo.amIOwner()){var a=game.AppFacade.getInstance().retrieveProxy(game.FriendPy.N),n=game.Config.broadcastConfig()[49].content,e=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),o=[[2,e.playerInfoVO.name,e.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[1,"<<点击加入",t.py.riskMultiRoomInfo.id,MODULE.RiskMulti]];a.getFriendList(function(){var t=game.GameMVC.playerPy.playerInfoVO.level;PopUpManager.addPopUp({obj:new game.InviteFriendView({moduleId:MODULE.RiskMulti,filter:function(e){if(e.level<t)return!0},tabbarType:11,inviteCallback:function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.MainPy.N);i.addPrivatePlayer(e),i.SendMessage(EChatChannelType.EChatChannelTypePrivate,n,e,function(){a.addInviteHistory(MODULE.RiskMulti,e),t&&t()},EChatSendCheckType.None,JSON.stringify(o),!0)}})})})}else Utils.MsgUtils.addMidMsg("房主才能发起邀请")},this),Utils.ComponentUtils.registerListener(this.btn_tuichu,egret.TouchEvent.TOUCH_TAP,function(){game.GameMVC.guajiPy.RiskMultiCommand("QuitRoom",void 0,function(){game.AppFacade.getInstance().hideSubView(game.GuajiMediator.N,game.GuajiMediator.SV.MULTI)})},this),this.cu_ph.updateData()},a.prototype.updateTime=function(){if(this.player&&this.player.baseInfo.playerId!=this.py.riskMultiRoomInfo.ownerId){var e=this.py.riskMultiConstV[1]+this.player.dt-Utils.TimerManager.getServerTime();this.blb_countDown.text=0<e?Utils.TimerManager.getFormatBySecond1(e):""}},a.prototype.updateForPlayer=function(e){this.player=e,this.lb_name.text=e.baseInfo.name,this.cu_ph.updateData({vo:e.baseInfo}),this.btn_yaoqing.visible=!1,this.btn_tuichu.visible=!1;var t=this.py.riskMultiRoomInfo.ownerId==this.player.baseInfo.playerId,i=this.player.baseInfo.playerId==game.GameMVC.playerPy.playerInfoVO.playerId;t?this.gp_bottom.visible=!1:(this.gp_bottom.visible=!0,i&&(this.btn_tuichu.visible=!0))},a.prototype.reset=function(){this.cu_ph.updateData(),this.lb_name.text="",this.gp_bottom.visible=!1,this.btn_yaoqing.visible=!0,this.btn_tuichu.visible=!1},a);function a(){var e=i.call(this)||this;return e.py=game.GameMVC.guajiPy,e.skinName="GuajiMultiPanel_Item",e}e.GuajiMultiPanel_Item=t}(customui=customui||{}),function(e){var i,t=(i=e.Npc,__extends(a,i),a.prototype.switchVisible=function(e){this.img.x=this.img.y=0,e?(this.visible=!0,egret.Tween.get(this.img,{loop:!0}).to({y:20},500).to({y:0},500)):(this.visible=!1,egret.Tween.removeTweens(this.img))},a.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img=new eui.Image,RES.getResAsync("xinshou_img_shouzhi_png",function(e){t.img.source=e,t.img.anchorOffsetX=20,t.img.anchorOffsetY=39},this),this.gp_foot.addChild(this.img)},a.prototype.tileXYChange=function(){i.prototype.tileXYChange.call(this),this.zorder=1e11},a);function a(){var e=i.call(this)||this;return e.mapObjType=3,e.visible=!1,e}e.Guide=t}(game=game||{}),function(t){var i,e=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn1.labelDisplay.size=23,this.btn2.labelDisplay.size=23,this.btn3.labelDisplay.size=23,this.btn1.labelDisplay.horizontalCenter=10,this.btn2.labelDisplay.horizontalCenter=10,this.btn3.labelDisplay.horizontalCenter=10,this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.MainJumpConfig.jumpTo(MODULE.Champion)&&(e.opperationParams=1,e.hide())},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.MainJumpConfig.jumpTo("GUAJI"),e.opperationParams=1,e.hide(),t.AppFacade.getInstance().retrieveProxy(t.GuajiPy.N).handleQuickBattle()},this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.MainJumpConfig.jumpTo("GUAJI"),e.opperationParams=1,e.hide()},this),this.heroModel.update({isStatic:!0,code:41050009})},a);function a(){var e=i.call(this)||this;return e.skinName="LackExpView",e}t.LackExpView=e}(game=game||{}),function(n){var o,e=(o=n.Npc,__extends(t,o),t.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1;var e=new eui.Image("_guaji_m_json.maoxian_img_biaojiquan");e.horizontalCenter=0,e.bottom=-20,this.gp_foot.addChild(e),this.isMe?this.mapSource==MODULE.Manor?(this.lb_name=new eui.Label,this.lb_name.bottom=120,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=10092390,this.lb_name.size=16,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+n.GameMVC.loginPy.serverSelect.area+"."+n.GameMVC.loginPy.playerProxy.playerInfoVO.name,this.manorBi=n.ManorBaseHeadFactory.create(),this.manorBi.scaleX=this.manorBi.scaleY=.7,this.manorBi.touchEnabled=!1,this.manorBi.horizontalCenter=0,this.manorBi.bottom=40,this.gp_foot.addChild(this.manorBi),this.img_name_bg=new eui.Image("_guaji_m_json.maoxian_img_biaoji"),this.img_name_bg.horizontalCenter=0,this.img_name_bg.bottom=0,this.gp_foot.addChild(this.img_name_bg)):this.mapSource==MODULE.StormWar?(this.roleDyModel=new customui.RoleDynamicModel({vo:this.vo}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel),this.img_name_bg=new eui.Image("_stormWar_m_json.fbzc_img_guanjundi"),this.img_name_bg.height=83,this.img_name_bg.horizontalCenter=0,this.gp_foot.addChild(this.img_name_bg),this.lb_name=new eui.Label,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=0,this.lb_name.size=18,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+n.GameMVC.loginPy.serverSelect.area+"."+n.GameMVC.loginPy.playerProxy.playerInfoVO.name,this.img_state=new eui.Image("_stormWar_m_json.fbzc_img_bukexuan"),this.img_state.horizontalCenter=0,this.gp_foot.addChild(this.img_state),this.roleDyModel.onArmatureLoadCB=function(){var e=t.roleDyModel.getHeadNameBottom();t.img_name_bg.bottom=e-t.img_name_bg.height/2-7.5,t.img_state.bottom=e-t.img_state.height,t.lb_name.bottom=e-t.lb_name.height}):(this.roleDyModel=new customui.RoleDynamicModel({vo:this.vo}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel)):this.mapSource!=MODULE.Manor&&(this.roleDyModel=new customui.RoleDynamicModel({vo:this.vo}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel)),this.switchFocus(!0)},t.prototype.updateNPCOutLook=function(e){if(e){if(this.vo.fashionCode==e.fashionCode&&this.vo.horseCode==e.horseCode&&this.vo.titleCode==e.titleCode&&this.vo.magicalCode==e.magicalCode)return void egret.log("刷新模型形象，跳过");this.vo=e}egret.log("刷新模型形象"),this.roleDyModel.update({vo:this.vo})},t.prototype.resetTileXY=function(){this.lastTileX=this.lastTileY=void 0},t.prototype.setTilePos=function(e,t,i){void 0===i&&(i=!1),i?(this._tileX=e,this._tileY=t,this.updateFixedPos()):(this.tileX=e,this.tileY=t)},t.prototype.switchFocus=function(e){this.roleDyModel&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ)},t.prototype.showName=function(e){this.img_name_bg&&(this.img_name_bg.visible=e),this.lb_name&&(this.lb_name.visible=e)},t.prototype.showState=function(e){this.img_state&&this.img_state.visible!=e&&(this.img_state.visible=e)},t.prototype.updateBaseItem=function(e){this.manorBi&&(e.code?this.manorBi.updateData(e):this.manorBi.decorateIcon(ResourceUtils.png(e.avatar)))},t.prototype.walkByPath=function(e,t){var i=this;this.walkDoneCB=t,this.walkPaths.splice(0),e.forEach(function(e){i.walkPaths.push({tileX:e.y,tileY:e.x})}),0<this.walkPaths.length&&(this.walkPaths[this.walkPaths.length-1].isLast=!0),this.isMoving||this.walkByPathNext()},t.prototype.walkPathFinish=function(){this.roleDyModel&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ),this.walkDoneCB&&this.walkDoneCB(),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),n.AppFacade.getInstance().sendNotification(CN.ME_MOVE_FINISH)},t.prototype.forceStop=function(){this.walkPaths.splice(0)},t.prototype.walkByPathNext=function(){var e=this.walkPaths.shift();e?(n.AppFacade.getInstance().sendNotification(CN.ME_MOVE_ONE_TILE,{x:e.tileX,y:e.tileY}),this.walkToTile(e.tileX,e.tileY)):this.walkPathFinish()},t.prototype.onChangingDir=function(e){this.roleDyModel&&this.roleDyModel.onChangingDir(e)},t.prototype.onWalking=function(){this.roleDyModel&&this.roleDyModel.curModelAct!=ROLE_ACTION_NAME.PB&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.PB),this.hasWalkPassPath.push({x:this.tileX,y:this.tileY})},t.prototype.onAfterWalk=function(){if(o.prototype.onAfterWalk.call(this),this.customAfterWalkCB){var e=this.hasWalkPassPath[this.hasWalkPassPath.length-1];this.customAfterWalkCB(e.x,e.y)}this.walkByPathNext()},t.prototype.reset=function(){o.prototype.reset.call(this),egret.Tween.removeTweens(this),this.walkPaths.splice(0),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),this.roleDyModel&&this.roleDyModel.reset(),this.isMoving=!1,this.visible=!1},t);function t(e,t,i){void 0===t&&(t=MODULE.Risk);var a=o.call(this)||this;return a.isMe=!1,a.map=e,a.mapSource=t,a.vo=i,a.mapObjType=2,a.playerPy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),a.py=n.AppFacade.getInstance().retrieveProxy(n.GuajiPy.N),a.walkPaths=new Array,a.hasWalkPassPath=new Array,a}n.PlayerNpc=e}(game=game||{}),function(e){var a,t=(a=e.PlayerNpc,__extends(i,a),i.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.manorBi=e.ManorBaseHeadFactory.create(),this.manorBi.scaleX=this.manorBi.scaleY=.7,this.manorBi.touchEnabled=!1,this.manorBi.horizontalCenter=0,this.manorBi.bottom=40,this.gp_foot.addChild(this.manorBi),this.img_arrow=new eui.Image("_guaji_m_json.maoxian_img_biaoji"),this.img_arrow.horizontalCenter=0,this.img_arrow.bottom=0,this.gp_foot.addChild(this.img_arrow),this.lb_name=new eui.Label,this.lb_name.bottom=120,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=16777215,this.lb_name.size=16,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+this.baseInfo.serverId+"."+this.baseInfo.name,this.switchFocus()},i.prototype.updateBaseItem=function(e){this.manorBi&&(e.code?this.manorBi.updateData(e):this.manorBi.decorateIcon(ResourceUtils.png(e.avatar)))},i.prototype.onWalking=function(){var e=this;a.prototype.onWalking.call(this),this.isMoving=!0;var t=this.map.tile2Pos(this.tileX,this.tileY);egret.Tween.get(this).to({x:t.x,y:t.y},this.map.npcMovingDura).call(function(){e.isMoving=!1,e.onAfterWalk()}),this.updateVisible(this.tileX,this.tileY)},i.prototype.updateVisible=function(e,t){void 0===e&&(e=this.tileX),void 0===t&&(t=this.tileY);var i=this.map.getTileIndex(this.tileX,this.tileY),a=this.map.mwArr[i];a&&(0==a||4==a?this.visible&&(this.visible=!1):2!=a&&3!=a||this.visible||this.isOccupyManor||(this.visible=!0))},i);function i(e,t){var i=a.call(this,e,MODULE.Manor)||this;return i.baseInfo=t,i.entityIndex=void 0,i.isOccupyManor=!1,i}e.ManorPlayer=t}(game=game||{}),function(m){var e,t=(e=BaseClass,__extends(i,e),i.prototype.generateCommon=function(e){var t=new n;return t.source=e.source,t.bindAndAddChild(e.me||new m.Me(t,!1,e.source),e.multiLayerScroller,e.miniMapParent,e.camera),t.onTouchTap=e.onTouchTap,t.onRequestToMove=e.onRequestToMove,t.npcMovingDura=e.npcMovingDura||250,t},i);function i(){return null!==e&&e.apply(this,arguments)||this}m.MapUtils=t;var a,n=(a=eui.Component,__extends(o,a),o.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.winWidth=Utils.DeviceUtils.curWidth(),this.winHeight=Utils.DeviceUtils.curHeight(),this.scaleX=this.scaleY=1,Utils.DebugUtils.isDebug&&((window._map=this).name="_map"),this.gp_tile=new eui.Group,this.gp_ep=new eui.Group,this.gp_ep.touchEnabled=!1,this.gp_ep.touchChildren=!0,this.gp_touchTile=new eui.Group,this.addChild(this.gp_tile),this.addChild(this.gp_touchTile),this.addChild(this.gp_ep),this.img_youBiao=new eui.Image,this.img_youBiao.source="_guaji_m_json.maoxian_img_biaoji",this.img_youBiao.anchorOffsetX=17.5,this.img_youBiao.anchorOffsetY=38,this.img_youBiao.touchEnabled=!1,this.img_youBiao.alpha=0,this.addChild(this.img_youBiao)},o.prototype.bindAndAddChild=function(e,t,i,a){var n=this;this.gp_ep?(this.me=e,this.me.mapObjType=1,this.cu_mls=t,this.gp_miniMap=i,this.gp_miniMap&&(this.gp_miniMap.scaleX=this.gp_miniMap.scaleY=.8),this.cu_mls.scrollPolicyV=this.cu_mls.scrollPolicyH=eui.ScrollPolicy.OFF,this.camera=a,this.gp_ep.addChild(this.me),this.finger=new m.Finger,this.guide=new m.Guide,this.gp_ep.addChild(this.finger),this.gp_ep.addChild(this.guide),this.reset()):this.once(eui.UIEvent.CREATION_COMPLETE,function(){n.bindAndAddChild(e,t,i,a)},this)},o.prototype.scrollByOffset=function(e,t){egret.Tween.get(this.cu_mls.viewport).to({scrollH:this.cu_mls.viewport.scrollH+e,scrollV:this.cu_mls.viewport.scrollV+t},this.npcMovingDura)},o.prototype.getTileIndex=function(e,t){return e+t*this.w||0},o.prototype.onMeWalkTo=function(e,t){if(this.walkStep+=1,2<=this.walkStep&&(this.walkStep=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_jiaobu)),!Utils.SDKMgr.getPerformConfig(6)){var i=this.tileIndex2MBN[this.getTileIndex(e,t)];if(i){var a=this.tile2Pos(e,t,!0);i.y=a.y,egret.Tween.get(i).to({y:a.y+30},this.npcMovingDura).to({y:a.y},this.npcMovingDura,egret.Ease.backOut),egret.Point.release(a)}}this.curMeOnTargetPos&&this.curMeOnTargetPos.tileX==e&&this.curMeOnTargetPos.tileY==t&&(console.log("已经走到了目标点"),this.curMeOnTargetPos=void 0,this.checkCurMeTarget()),this.newEnterTile(e,t),this.updateMNMMePos(),this.source==MODULE.Risk&&m.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_WALK_TO,{tileX:e,tileY:t})},o.prototype.quickSort=function(e,t){var i,a,n,o;if(i=a=n=0,!(t<e)){for(o=this.needSortChildrenArr[e].zorder||1,i=e,a=t;i!=a;){for(;this.needSortChildrenArr[a].zorder>=o&&i<a;)a--;for(;this.needSortChildrenArr[i].zorder<=o&&i<a;)i++;i<a&&(this.gp_ep.swapChildren(this.needSortChildrenArr[i],this.needSortChildrenArr[a]),n=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=this.needSortChildrenArr[a],this.needSortChildrenArr[a]=n)}this.gp_ep.swapChildren(this.needSortChildrenArr[e],this.needSortChildrenArr[i]),n=this.needSortChildrenArr[e],this.needSortChildrenArr[e]=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=n,this.quickSort(e,i-1),this.quickSort(i+1,t)}},o.prototype.enterFrame=function(){this.isZOrderDirty&&(this.isZOrderDirty=!1,this.calAllZOrder())},o.prototype.reqCalAllZOrder=function(){this.isZOrderDirty=!0},o.prototype.calAllZOrder=function(){this.needSortChildrenArr.splice(0);for(var e=0,t=this.gp_ep.$children;e<t.length;e++){var i=t[e];this.needSortChildrenArr.push(i)}this.quickSort(0,this.needSortChildrenArr.length-1)},o.prototype.reset=function(){this.gp_touchTile&&(this.gp_touchTile.touchChildren=!1),this.isInitedGraph=!1,this.mwArr.splice(0),this.isInited=!1,this.me&&(this.me.reset(),this.switchVisible(this.me,!1)),this.switchVisible(this.camera,!1)},o.prototype.update=function(e,t){var a=this;if(void 0===t&&(t=!1),this.log("Map update"),e.w&&e.h||egret.warn("需提供宽高"),e.isInit){if(this.reset(),!t&&!GameRootLayer.gameLayer().isMenShow&&!m.GameMVC.guajiPy.firstEnterMapAfterLogin)return void GameRootLayer.gameLayer().switchCloudLoading(!0,function(){a.update(e,!0)});this.source==MODULE.Risk&&(m.GameMVC.guajiPy.firstEnterMapAfterLogin=!1),this.w=e.w,this.h=e.h,this.source==MODULE.Risk&&(this.layerId=e.layerId),this.tileW=e.tileW||139,this.tileH=e.tileH||70,this.radius=e.radius||5,this.me.resetTileXY(),this.me.setTilePos(e.meStartTileX||0,e.meStartTileY||0),this.source==MODULE.StormWar&&this.delatupdateNPCP&&this.delatupdateNPCP.curPosVO&&e&&e.meStartTileX&&e.meStartTileY&&(this.delatupdateNPCP.curPosVO.x=e.meStartTileX,this.delatupdateNPCP.curPosVO.y=e.meStartTileY);for(var i=0;i<this.w*this.h;i++)this.mwArr.push(void 0);if(this.tiled=e.tiled,this.theme=m.Config.riskLayerTheme()[e.theme],this.theme.deep=JSON.parse(this.theme.deep),this.theme.hinder=JSON.parse(this.theme.hinder),this.source==MODULE.Risk){var n=m.AppFacade.getInstance().retrieveProxy(m.GuajiPy.N);n.curLayerTheme.bg=ResourceUtils.png(this.theme.battleBg),n.curLayerTheme.bgm=this.theme.bgm}RES.getResAsync(e.tiled,function(e){try{e.layers.forEach(function(e){"tiled"==e.name?a.tmxTiledArr=e.data:"hinder"==e.name&&(a.tmxHinderArr=e.data)}),a.tilesets={},e.tilesets.forEach(function(i){i.tiles.forEach(function(t){t.properties.forEach(function(e){a.tilesets[t.id+i.firstgid]||(a.tilesets[t.id+i.firstgid]={}),a.tilesets[t.id+i.firstgid][e.name]=e.value})})}),a.isInited=!0}catch(e){return void egret.warn("地形解析失败",e)}a.initAll()},this)}},o.prototype.resetMNM=function(e,t){if(this.img_meRedPointInMNM&&this.gp_miniMap){var i=this.gp_miniMap.parent,a=(t&&t.x||this.img_meRedPointInMNM.x)-i.viewport.width/2,n=(t&&t.y||this.img_meRedPointInMNM.y)-i.viewport.height/2;egret.Tween.get(i.viewport).to({scrollH:a,scrollV:n},e||this.npcMovingDura)}},o.prototype.updateNPCOutLook=function(e){this.me&&this.me.updateNPCOutLook()},o.prototype.resetCamera=function(e){this.me.switchFocus(!0),this.cu_mls.stopAnimation(),egret.Tween.removeTweens(this);var t=this.me.parent.localToGlobal(this.me.x,this.me.y-35),i=this.cu_mls.viewport.globalToLocal(t.x,t.y);egret.Tween.get(this.cu_mls.viewport).to({scrollH:i.x-this.cu_mls.viewport.width/2,scrollV:i.y-this.cu_mls.viewport.height/2},50,egret.Ease.sineOut).call(function(){e&&e()}),this.resetMNM(50)},o.prototype.setMapScale=function(e){1.8<=this.scaleX+e&&(e=1.8-this.scaleX),this.scaleX+e<=.2&&(e=.2-this.scaleX),this.scaleX+=e,this.scaleY+=e},o.prototype.checkPosValid=function(e,t){if(this.isInited&&this.tmxTiledArr[this.getTileIndex(e,t)])return!0},o.prototype.getRandomValidPoint=function(e){if(void 0===e&&(e=!1),this.isInited){if(10<=this.randomCount)return egret.warn("当前地形找不到有效的随机点"),[];e?this.randomCount++:this.randomCount=0;var t=this.gp_tile.$children[Utils.MathUtils.getRandomInt(0,this.gp_tile.$children.length-1)],i=this.getTileIndex(t.tileX,t.tileY),a=this.tmxTiledArr[i],n=this.tmxHinderArr[i];return a&&!n?[t.tileX,t.tileY]:this.getRandomValidPoint(!0)}return[]},o.prototype.tile2Pos=function(e,t,i){return void 0===i&&(i=!1),this.jiZhunP||(this.jiZhunP=egret.Point.create(139,70*(this.w+this.h)/2/2+this.cu_mls.height/4)),i?egret.Point.create(this.jiZhunP.x+139*(e+(this.h-1)-t)/2,this.jiZhunP.y+70*(e+t-(this.h-1))/2):egret.Point.create(this.jiZhunP.x+139*(e+(this.h-1)-t)/2,this.jiZhunP.y+70*(e+t-(this.h-1))/2+this.getOffsetYForDeep(this.tile2Deep(e,t)))},o.prototype.pos2Tile=function(e,t){return{tileX:(e-this.cu_mls.width-278)/139*2,tileY:0}},o.prototype.tile2MNMPos=function(e,t){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,37*(this.w+this.h)/2/2)),egret.Point.create(this.jiZhunMNMP.x+67*(e+(this.h-1)-t)/2,this.jiZhunMNMP.y+37*(e+t-(this.h-1))/2)},o.prototype.tile2Deep=function(e,t){if(this.isInited){var i=this.tmxTiledArr[this.getTileIndex(e,t)];return i?this.tilesets[i].deep:(egret.warn("当前地形不含这个点("+e+","+t+")，请检查配置"),0)}return 0},o.prototype.tile2DeepTheme=function(e,t){if(this.isInited){var i=this.tmxTiledArr[this.getTileIndex(e,t)];return i?this.tilesets[i].theme||0:(egret.warn("当前地形不含这个点("+e+","+t+")，请检查配置"),0)}return 0},o.prototype.tile2EP=function(e,t){return this.tileIndex2EP[this.getTileIndex(e,t)]},o.prototype.getEpByEventId=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];if(i.vo.eventId==e)return i}},o.prototype.getEpByType=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];if(i.vo.type==e)return i}},o.prototype.getOffsetYForDeep=function(e){return-8*e},o.prototype.dumpMWData=function(){var i=this,a="";this.mwArr.forEach(function(e,t){null==e?a+="· ":a=a+e+" ",(t+1)%i.w==0&&(console.log(a.substring(0,a.length-1)),a="")})},o.prototype.updateNPC=function(e){var t=this;this.isInited?(e.curPosVO&&(e.curPosVO.hide?this.me.hasEnterMap||this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){t.stage&&(t.me.hasEnterMap=!0,t.me.visible=!1,t.resetCamera(function(){t.checkAllLoadDone(),GameRootLayer.gameLayer().switchCloudLoading(!1,function(){t.switchVisible(t.camera,!0)})}))},params:void 0}):(this.checkPosValid(e.curPosVO.x,e.curPosVO.y)&&this.me.setTilePos(e.curPosVO.x,e.curPosVO.y,e.curPosVO.isFixed),this.updateMNMMePos(),this.me.hasEnterMap||this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){t.stage&&(t.me.hasEnterMap=!0,t.me.isOccpuyManor||(t.me.visible=!0),t.resetCamera(function(){t.checkAllLoadDone(),GameRootLayer.gameLayer().isMenShow?t.switchVisible(t.camera,!0):GameRootLayer.gameLayer().switchCloudLoading(!1,function(){t.switchVisible(t.camera,!0),null!=t.preTileX&&null!=t.preTileY&&(t.handleTouchTap(t.preTileX,t.preTileY),t.preTileX=t.preTileY=void 0)})}))},params:void 0}))),null!=e.followers&&this.fu_mgr.insert({delayFrame:60,waitFrame:0,cb:function(){t.stage&&t.me.setFollowers(e.followers)},params:void 0}),null!=e.otherCoordInfos&&this.fu_mgr.insert({delayFrame:60,waitFrame:0,cb:function(){t.stage&&t.handleOtherNpc(e.otherCoordInfos)},params:void 0})):this.delatupdateNPCP=e},o.prototype.updateLayerEvent=function(e){var h=this;if(this.isInited){if(Array.isArray(e.events)){for(var t in this.log("risk当前层有效事件数："+e.events.length),this.tileIndex2EP)this.tileIndex2EP[t].vo.type!=RiskEventType.Hinder&&(this.tileIndex2EP[t].vo.isExpire=!0);var l=0,c=0;e.events.forEach(function(e){var t=h.getTileIndex(e.position.x,e.position.y);if(h.log("risk当前事件位置 "+e.position.x+":"+e.position.y+"，类型:"+(e.type||e.fadeType)+MAP_EP_TYPE_NAME[e.type||e.fadeType]),e.position.x>h.w-1||e.position.y>h.h-1)egret.warn("risk当前事件位置超过地图范围，丢弃");else if(e.type==RiskEventType.None)h.tileIndex2EP[t]&&h.gp_ep.contains(h.tileIndex2EP[t])&&(h.log("risk对象清理"),h.gp_ep.removeChild(h.tileIndex2EP[t]),delete h.tileIndex2EP[t]),h.gp_miniMap&&h.tileIndex2MNMEP[t]&&h.gp_miniMap.contains(h.tileIndex2MNMEP[t])&&(h.gp_miniMap.removeChild(h.tileIndex2MNMEP[t]),delete h.tileIndex2MNMEP[t]);else{if(h.tileIndex2EP[t]&&h.tileIndex2EP[t].type!=e.type&&h.gp_ep.contains(h.tileIndex2EP[t])&&(h.log("risk对象被替换了，删除"),h.gp_ep.removeChild(h.tileIndex2EP[t]),delete h.tileIndex2EP[t]),h.tileIndex2EP[t])h.log("risk对象复用"+ ++c);else{h.log("risk对象新建"+ ++l);var i=m.EventPointFactory.create({vo:e,map:h});h.tileIndex2EP[t]=i,h.gp_ep.addChild(i)}if(h.tileIndex2EP[t].updateData(),h.tileIndex2EP[t].vo.isExpire=!1,h.gp_miniMap){var a=1.2,n=MAP_EP_TYPE_IMG_MNM[e.type||e.fadeType];if(e.type==RiskEventType.Manor){var o=m.Config.manor()[e.info.id];o&&o.model&&(n=m.GeneralConfig.getGuajiImg(o.model)[1],a=.4)}if(h.tileIndex2MNMEP[t])RES.getResAsync(n,function(e){h.tileIndex2MNMEP[t].source=e,h.tileIndex2MNMEP[t].anchorOffsetX=e.textureWidth/2,h.tileIndex2MNMEP[t].anchorOffsetY=e.textureHeight/2},h);else{var s=new eui.Image;RES.getResAsync(n,function(e){s.source=e,s.anchorOffsetX=e.textureWidth/2,s.anchorOffsetY=e.textureHeight/2},h),s.scaleX=s.scaleY=a;var r=h.tile2MNMPos(e.position.x,e.position.y);s.x=r.x+32.5,s.y=r.y+17.5-5,h.tileIndex2MNMEP[t]=s,h.gp_miniMap.addChild(s)}}}});var i=0;for(var t in this.tileIndex2EP)this.tileIndex2EP[t].vo.isExpire&&(this.tileIndex2EP[t].type==RiskEventType.StormWarCreep?(this.gp_ep.contains(this.tileIndex2EP[t])&&this.gp_ep.removeChild(this.tileIndex2EP[t]),delete this.tileIndex2EP[t]):this.gp_ep.removeChild(this.tileIndex2EP[t]),i++);this.log("risk对象删除"+i),this.reqCalAllZOrder(),this.initGraph(),this.isInitedGraph||(this.isInitedGraph=!0)}}else this.delatUpdateLayerEventP=e},o.prototype.handleOtherNpc=function(e){for(var t in this.playerOrTeamId2NPC)this.playerOrTeamId2NPC[t].valid=!1;for(var i=0,a=e;i<a.length;i++){var n=a[i];if(t=void 0,n.playerBaseInfo?t=n.playerBaseInfo.playerId:n.team&&n.team.id&&(t=n.team.id),null==n.coordinate.x||null==n.coordinate.y||!this.checkPosValid(n.coordinate.x,n.coordinate.y)){var o=this.getRandomValidPoint();n.coordinate.x=o[0]||this.me.tileX,n.coordinate.y=o[1]||this.me.tileY}if(t){var s=this.playerOrTeamId2NPC[t];s?(s.setTilePos(n.coordinate.x,n.coordinate.y),s.valid=!0):((s=new m.PlayerNpc(this,this.source,n.playerBaseInfo)).setTilePos(n.coordinate.x,n.coordinate.y),this.gp_ep.addChild(s),this.playerOrTeamId2NPC[t]=s)}else this.log("handleOtherNpc 没有id")}for(var t in this.playerOrTeamId2NPC)this.playerOrTeamId2NPC[t].valid||(this.gp_ep.removeChild(this.playerOrTeamId2NPC[t]),delete this.playerOrTeamId2NPC[t])},o.prototype.checkAllLoadDone=function(){function t(){m.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_INIT_ALL_DONE,{source:i.source}),m.AppFacade.getInstance().sendNotification(CN.GUAJI_ENTER_LAYER,{layerId:i.layerId,source:i.source})}var i=this;if(this.source==MODULE.Risk){function e(){var e=1e7+i.layerId;n.serverGuideInfo[e]?t():PopUpManager.addPopUp({obj:new m.StoryView({storyId:a.storyId,questionId:void 0,position:void 0,cb:function(){n.setGuideInfo(e),t()}})})}var a=m.Config.riskLayer()[this.layerId],n=m.AppFacade.getInstance().retrieveProxy(m.GuidePy.N),o=!0;if(a.bigStoryId){var s=2e7+this.layerId;n.serverGuideInfo[s]||(o=!1,PopUpManager.addPopUp({effectType:0,obj:new m.BigStoryView({content:a.bigStoryId,cb:function(){n.setGuideInfo(s),a.storyId?e():t()}})}))}else a.storyId&&(o=!1,e());o&&t()}else t()},o.prototype.initGraph=function(){for(var e=[],t=0;t<this.h;t++){e[t]||(e[t]=[]);for(var i=0;i<this.w;i++){e[t][i]=0;var a=this.getTileIndex(i,t);if(this.tileIndex2MBN[a]){var n=1;this.tileIndex2EP[a]&&(n=this.tileIndex2EP[a].aStarCost),e[t][i]=n}}}this.curGraph=new astar.Graph(e),this.gp_touchTile.touchChildren=!0},o.prototype.handleMW=function(){for(var e=-1,t=this.me.tileX,i=this.me.tileY,a=this.source!=MODULE.Risk,n=0,o=this.mwArr;n<o.length;n++){var s=o[n];if(e++,null!=s)if(0==s||4==s)this.tileIndex2EP[e]&&(this.tileIndex2EP[e].visible=!1),this.tileIndex2MBN[e].visible=!1,this.tileIndex2MNMEP[e]&&(this.tileIndex2MNMEP[e].visible=!1),this.tileIndex2MNM[e]&&(this.tileIndex2MNM[e].visible=!1);else if(2==s||3==s){var r=this.tileIndex2EP[e];r&&(a?this.switchScanVisible(r,!0):r.vo.type!=RiskEventType.Hinder&&(Math.pow(r.tileX-t,2)+Math.pow(r.tileY-i,2)<=Math.pow(5,2)?r.visible?r.alpha=1:this.switchScanVisible(r,!0):r.visible&&this.switchScanVisible(r,!1))),3==s?(this.switchVisible(this.tileIndex2MBN[e],!0),r&&r.vo.type==RiskEventType.Hinder&&this.switchVisible(r,!0),this.mwArr[e]=2):(r&&(r.visible=!0),this.tileIndex2MBN[e].visible=!0),this.tileIndex2MNMEP[e]&&(this.tileIndex2MNMEP[e].visible=!0),this.tileIndex2MNM[e]&&(this.tileIndex2MNM[e].visible=!0)}}if(this.otherPlayers)for(var h in this.otherPlayers)for(var l in this.otherPlayers[h])this.otherPlayers[h][l].updateVisible();if(this.stormWarPlayers)for(var h in this.stormWarPlayers)this.stormWarPlayers[h].updateVisible()},o.prototype.switchVisible=function(e,t,i){if(e)if(t){e.alpha=0,e.visible=!0;var a=e.y;e.y+=50,egret.Tween.get(e).to({y:a,alpha:1},2*this.npcMovingDura,egret.Ease.backOut).call(function(){i&&i()})}else e.alpha=1,e.visible=!1,i&&i()},o.prototype.switchScanVisible=function(e,t){e&&(egret.Tween.removeTweens(e),t?(e.visible||(e.alpha=0,e.visible=!0),egret.Tween.get(e).to({alpha:1},2*this.npcMovingDura,egret.Ease.backOut)):egret.Tween.get(e).to({alpha:0},2*this.npcMovingDura,egret.Ease.backOut).call(function(){e.visible=!1}))},o.prototype.initAll=function(){var p=this;for(var e in this.log("Map initAll"),this.tileIndex2EP)this.gp_ep.removeChild(this.tileIndex2EP[e]);this.gp_ep.getChildByName("fade_rightP")&&this.gp_ep.removeChild(this.gp_ep.getChildByName("fade_rightP")),this.gp_ep.getChildByName("fade_bottomP")&&this.gp_ep.removeChild(this.gp_ep.getChildByName("fade_bottomP")),this.tileIndex2EP={},this.tileIndex2MBN={},this.tileIndex2MNM={},this.tileIndex2MNMEP={},this.gp_tile.removeChildren(),this.gp_miniMap&&this.gp_miniMap.removeChildren(),this.gp_touchTile.removeChildren();var t=this.tile2Pos(this.w-1,0,!0);(i=new m.MapObj).visible=!1,i.name="fade_rightP",i.x=t.x+this.cu_mls.width/4,i.y=t.y,this.gp_ep.addChild(i);var i,a=this.tile2Pos(this.w-1,this.h-1,!0);function n(d){function e(t){var e=g.tmxTiledArr[g.getTileIndex(d,t)];if(null==e)return egret.warn("地图尺寸"+g.w+"x"+g.h+"超过地形尺寸，请检查配置"),"break";if(0!=e){var i=g.getTileIndex(d,t),a=g.tile2Pos(d,t,!0),n=g.tile2Deep(d,t),o=g.tmxHinderArr[i];if(0!=o){var s=m.EventPointFactory.create({vo:new m.EventVO({type:RiskEventType.Hinder,position:{x:d,y:t}}),hinderImg:g.theme.hinder[g.tilesets[o].hinderIndex],map:g});g.tileIndex2EP[i]=s,g.gp_ep.addChild(s)}else{var r=new eui.Image("maoxian_img_zhishi_png");r.anchorOffsetX=70,r.anchorOffsetY=70,r.alpha=0,r.x=a.x,r.pixelHitTest=!0,r.y=a.y+g.getOffsetYForDeep(n),Utils.TouchUtils.addTouchListener(r,function(){p.curGraph&&(!p.curValidTouchPosXY.length||p.curValidTouchPosXY.some(function(e){return e.tileX==d&&e.tileY==t})?(p.img_youBiao.x=r.x,p.img_youBiao.y=r.y-120,p.setChildIndex(p.img_youBiao,-1),egret.Tween.removeTweens(p.img_youBiao),egret.Tween.get(p.img_youBiao).to({alpha:1,y:r.y-40},1e3,egret.Ease.elasticOut).call(function(){p.img_youBiao.alpha=0}),r.scaleX=r.scaleY=.1,egret.Tween.get(r).wait(120).to({alpha:1,scaleX:1,scaleY:1},880,egret.Ease.elasticOut).call(function(){r.alpha=0}),p.handleTouchTap(d,t)):p.log("当前点击位置不允许响应"))}),g.gp_touchTile.addChild(r)}var h=new u({x:d,y:t,tiledP:{deep:n,deepImg:g.theme.deep[n+4]?g.theme.deep[n+4][g.tile2DeepTheme(d,t)]:g.theme.deep[4][g.tile2DeepTheme(d,t)]},map:g});if(h.x=a.x,h.y=a.y,g.gp_tile.addChild(h),g.tileIndex2MBN[i]=h,egret.Point.release(a),g.source!=MODULE.Risk||Utils.agentConfig.OffLineTest?g.mwArr[i]=2:g.mwArr[i]=0,g.gp_miniMap){var l=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==o?2:1)),c=g.tile2MNMPos(d,t);l.x=c.x,l.y=c.y,g.tileIndex2MNM[i]=l,g.gp_miniMap.addChild(l),egret.Point.release(c)}}}for(var t=0;t<g.h&&"break"!==e(t);t++);}(i=new m.MapObj).visible=!1,i.x=a.x,i.y=a.y+this.cu_mls.height/4,i.name="fade_bottomP",this.gp_ep.addChild(i);for(var g=this,o=0;o<this.w;o++)n(o);this.initGraph(),this.gp_tile.$children.sort(function(e,t){return e.tileY+e.tileX-t.tileY-t.tileX}),this.delatupdateNPCP&&this.fu_mgr.insert({delayFrame:3,waitFrame:0,cb:function(){p.stage&&p.updateNPC(p.delatupdateNPCP)},params:void 0}),this.delatUpdateLayerEventP&&this.fu_mgr.insert({delayFrame:5,waitFrame:0,cb:function(){p.stage&&p.updateLayerEvent(p.delatUpdateLayerEventP)},params:void 0}),this.delatupdateMWP&&this.fu_mgr.insert({delayFrame:7,waitFrame:0,cb:function(){p.stage&&p.updateMWInfo(p.delatupdateMWP)},params:void 0}),this.delatupdateMapPlayerInfo&&this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){p.stage&&p.delatupdateMapPlayerInfo&&p.updateMapPlayerInfo(p.delatupdateMapPlayerInfo.player,p.delatupdateMapPlayerInfo.isInit)},params:void 0}),this.fu_mgr.insert({delayFrame:1,waitFrame:0,cb:function(){p.stage&&p.cu_mls.updateBg(p.theme.bg)},params:void 0})},o.prototype.updateMWInfo=function(e){var l=this;if(this.isInited){this.delatupdateMWP=void 0;var t=e&&e.grids;Array.isArray(t)&&t.forEach(function(e){for(var t=0;t<e.long;t++)for(var i=0;i<e.wide;i++){var a=e.x+t,n=e.y+i,o=l.getTileIndex(a,n);l.tmxTiledArr[o]?l.mwArr[o]=2:egret.warn("该点不在当前地图的可行地形",e.x,e.y,e.x+t,e.y+i);for(var s=a-l.radius;s<a+l.radius;s++)if(!(s<0||s>=l.w))for(var r=n-l.radius;r<n+l.radius;r++)if(!(r<0||r>=l.h)){var h=l.getTileIndex(s,r);l.tmxTiledArr[h]&&(l.mwArr[h]=2)}}}),this.newEnterTile(this.me.tileX,this.me.tileY)}else this.delatupdateMWP=e},o.prototype.newEnterTile=function(e,t){for(var i=0;i<this.w;i++)for(var a=0;a<this.h;a++){var n=this.getTileIndex(i,a),o=this.mwArr[n];if(null!=o){var s=Math.pow(i-e,2)+Math.pow(a-t,2);s>Math.pow(this.radiusScanOutside,2)?0!=o&&(o=4):s>Math.pow(this.radius,2)?4==o&&(o=2):0==o?o=3:2!=o&&(o=2),this.mwArr[n]=o}}this.once(egret.Event.ENTER_FRAME,this.handleMW,this)},o.prototype.hudongWithEP=function(e){e&&e.tileX&&e.tileY&&this.tile2EP(e.tileX,e.tileY).hudongWithEP(e.action)},o.prototype.showMePathToPos=function(e){e&&e.tileX&&e.tileY&&(this.curMeOnTargetPos={tileX:e.tileX,tileY:e.tileY},this.checkCurMeTarget())},o.prototype.showFingerToXY=function(e,t){null==e&&null==t?this.finger.switchVisible(!1):(this.finger.switchVisible(!0),this.finger.tileX=e,this.finger.tileY=t)},o.prototype.riskFingerAppearToXY=function(e,t,i){var a=this;null==e&&null==t?this.guide.switchVisible(!1):(this.guide.switchVisible(!0),this.guide.tileX=e,this.guide.tileY=t,egret.setTimeout(function(){a.guide.switchVisible(!1)},this,i))},o.prototype.cleanAllEP=function(){for(var e in this.tileIndex2EP)this.tileIndex2EP[e].type!=RiskEventType.Hinder&&(this.gp_ep.removeChild(this.tileIndex2EP[e]),delete this.tileIndex2EP[e])},o.prototype.onThisMapSwitch=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];i&&i.onMapSwitch(e)}},o.prototype.handleTouchTap=function(t,i,e,a){var n=this;if(void 0===e&&(e=!1),void 0===a&&(a=!1),this.source!=MODULE.Manor||!this.me.isMoving||a){if(!this.isInitedGraph)return this.preTileX=t,void(this.preTileY=i);if(!this.curValidTouchPosXY.length||this.curValidTouchPosXY.some(function(e){return e.tileX==t&&e.tileY==i})){var o=this.tile2EP(t,i);if(!this.onRequestToMove||!this.onRequestToMove(t,i,a,o)||a){if(m.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_ON_TOUCH_TILE_POS,{tileX:t,tileY:i,source:this.source}),this.finger.tileX==t&&this.finger.tileY==i&&this.showFingerToXY(),o&&o.vo.type!=RiskEventType.Start){this.me.switchDir(t,i),this.me.calDir(t,i);var s=Math.abs(t-this.me.tileX),r=Math.abs(i-this.me.tileY);if(1==s&&0==r||0==s&&1==r||0==s&&0==r&&!e){if(a)return;return this.log("risk当前触发 "+t+":"+i+"，触发事件："+(o.vo.type||o.vo.fadeType)+MAP_EP_TYPE_NAME[o.vo.type|o.vo.fadeType]),this.onEventTrigger(o),o.onTrigger(),m.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_STOP_ON,{tileX:this.me.tileX,tileY:this.me.tileY}),void this.me.forceStop()}}if(t!=this.me.tileX||i!=this.me.tileY){var h=this.me.gp_foot.parent.localToGlobal(this.me.gp_foot.x,this.me.gp_foot.y);h.x<this.me.width||h.x>this.winWidth-this.me.width||h.y<this.me.height||h.y>this.winHeight-120-this.me.height?this.resetCamera(function(){n.searchPathAndMove(t,i,o,e)}):this.searchPathAndMove(t,i,o,e)}else if(this.source==MODULE.StormWar){var l=this.getStormWarPlayerByTilePos(t,i);l&&0<l.length&&m.AppFacade.getInstance().showSubView(m.StormWarMediator.N,m.StormWarMediator.SV.DIALOG,{data:l[0].player,isCreep:!1})}}}else this.log("当前点击位置不允许响应")}else egret.log("角色移动中 不响应点击")},o.prototype.getAStarPath=function(e,t,i,a){return astar.astar.search(this.curGraph,this.curGraph.grid[t][e],this.curGraph.grid[a][i],{closest:!0})},o.prototype.searchPathAndMove=function(e,t,i,a){var n=this;if(void 0===a&&(a=!1),this.curGraph.grid&&this.curGraph.grid[t]){var o=this.getAStarPath(this.me.tileX,this.me.tileY,e,t);if(0!=o.length){var s=void 0;if(!a){for(var r=0,h=0,l=o;h<l.length;h++){var c=l[h],d=this.tile2EP(c.y,c.x);if(this.finger.tileX==c.y&&this.finger.tileY==c.x&&this.showFingerToXY(),d&&d.vo.type!=RiskEventType.Start&&d.canTrigger){s=d,o.splice(r);break}r++}s=s||i}for(var r in this.tileIndex2EP){var p=this.tileIndex2EP[r];p&&p.onMapMoving(!0)}this.camera&&this.camera.onMove(),this.me.walkByPath(o,function(){if(s&&(n.onEventTrigger(s),s.onTrigger()),!s&&n.source==MODULE.StormWar){var e=n.getStormWarPlayerByTilePos(n.me.tileX,n.me.tileY);e&&0<e.length&&m.AppFacade.getInstance().showSubView(m.StormWarMediator.N,m.StormWarMediator.SV.DIALOG,{data:e[0].player,isCreep:!1})}for(var t in m.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_STOP_ON,{tileX:n.me.tileX,tileY:n.me.tileY}),n.checkCurMeTarget(),n.tileIndex2EP){var i=n.tileIndex2EP[t];i&&i.onMapMoving(!1)}}),0<o.length&&this.onTouchTap&&this.onTouchTap(o[o.length-1].y,o[o.length-1].x)}}},o.prototype.onEventTrigger=function(e){this.curMeOnTargetPos&&this.curMeOnTargetPos.tileX==e.tileX&&this.curMeOnTargetPos.tileY==e.tileY&&(console.log("已经触发了目标点"),this.curMeOnTargetPos=void 0,this.checkCurMeTarget()),m.AppFacade.getInstance().sendNotification(CN.GUAJI_ENTER_EP,{type:e.vo.type,fadeType:e.vo.fadeType})},o.prototype.checkCurMeTarget=function(){if(this.curMeOnTargetPos&&(this.curMeOnTargetPos.tileX!=this.me.tileX||this.curMeOnTargetPos.tileY!=this.me.tileY)&&this.curGraph){var e=astar.astar.search(this.curGraph,this.curGraph.grid[this.me.tileY][this.me.tileX],this.curGraph.grid[this.curMeOnTargetPos.tileY][this.curMeOnTargetPos.tileX],{closest:!0});if(0==e.length)return;var t=e.shift();this.camera&&this.camera.showTargetDir(this.me.calDir(t.y,t.x))}this.curMeOnTargetPos||this.camera&&this.camera.showTargetDir(void 0)},o.prototype.updateMNMMePos=function(){var t=this;if(this.gp_miniMap){this.img_meRedPointInMNM||(this.img_meRedPointInMNM=new eui.Image,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(e){t.img_meRedPointInMNM.source=e,t.img_meRedPointInMNM.anchorOffsetX=e.textureWidth/2,t.img_meRedPointInMNM.anchorOffsetY=e.textureHeight},this),this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4);var e=this.getTileIndex(this.me.tileX,this.me.tileY);if(this.tileIndex2MNM[e]){var i=this.tileIndex2MNM[e].x+32.5,a=this.tileIndex2MNM[e].y+17.5;this.img_meRedPointInMNM.parent?(this.img_meRedPointInMNM.x=i,this.img_meRedPointInMNM.y=a):(this.img_meRedPointInMNM.x=i,this.img_meRedPointInMNM.y=a,this.gp_miniMap.addChildAt(this.img_meRedPointInMNM,-1)),this.resetMNM(this.npcMovingDura,{x:i,y:a})}}},o.prototype.updatePlayerEntityInfo=function(n,e,t){var o=this;if(void 0===e&&(e=!1),n.isSelf){if(n.entityIndex==m.GameMVC.manorPy.lastEntityIndex){if(this.me.serverTileX=n.coordinateInfo.x,this.me.serverTileY=n.coordinateInfo.y,e){this.updateNPC({curPosVO:{x:n.coordinateInfo&&n.coordinateInfo.x||0,y:n.coordinateInfo&&n.coordinateInfo.y||0,isFixed:!0}}),m.GameMVC.guajiPy.updateCurPosition(n.coordinateInfo.x,n.coordinateInfo.y);var i=void 0;if(n.coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i="由于体力归0，你已传送回安全区":n.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?i="矿已消失，你已传送回安全区":n.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&(i="由于队伍状态改变，你已被传送回安全区"),i){var a=new egret.Timer(3e3,1);a.addEventListener(egret.TimerEvent.TIMER,function(){Utils.MsgUtils.addMidMsg(i),a.stop()},this),a.start()}}else if(this.me.forceStop(),this.me.tileX!=n.coordinateInfo.x||this.me.tileY!=n.coordinateInfo.y)if(n.coordinateStatus==ManorPlayerCoordinateChangeType.Battle||n.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper||n.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero)this.me.setTilePos(n.coordinateInfo.x,n.coordinateInfo.y,!0),this.resetCamera(),this.onMeWalkTo(n.coordinateInfo.x,n.coordinateInfo.y),m.GameMVC.guajiPy.updateCurPosition(n.coordinateInfo.x,n.coordinateInfo.y),m.GameMVC.manorMed.hideSubView(m.ManorMediator.SV.DETAIL),n.coordinateStatus==ManorPlayerCoordinateChangeType.Battle&&Utils.MsgUtils.addMidMsg("由于体力归0，你已传送回安全区"),n.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper&&Utils.MsgUtils.addMidMsg("矿已消失，你已传送回安全区"),n.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&Utils.MsgUtils.addMidMsg("由于队伍状态改变，你已被传送回安全区");else{var s=n.coordinateInfo.x,r=n.coordinateInfo.y;t&&(s=t._tileX,r=t._tileY),this.handleTouchTap(s,r,!1,!0)}if(this.me.isOccpuyManor=0!=n.manorId,this.me.visible=0==n.manorId,n.teamInfo&&n.teamInfo.heroBaseInfoList&&n.teamInfo.heroBaseInfoList[0]){var h=void 0;0!=(g=n.teamInfo.heroBaseInfoList[0]).dermaCode&&(h=m.Config.getHeroDermaConfig()[g.dermaCode].avatar),this.me.updateBaseItem({code:g.code,avatar:h})}else{var l=JSON.parse(m.Config.constConfig().DefaultAvatar.constValue)[0];this.me.updateBaseItem({avatar:l})}}}else{var c=n.baseInfo.playerId,d=n.entityIndex,p=!1;if(this.otherPlayers[c]&&this.otherPlayers[c][d]||(p=!0),p)this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){if(o.stage&&!(o.caleOtherPlayerCount()>=Number(m.Config.constConfig().ManorMaxPlayerEntityShowNum.constValue)||o.otherPlayers[c]&&o.otherPlayers[c][d])){var e=new m.ManorPlayer(o,n.baseInfo);if(e.isOccupyManor=0!=n.manorId,e.visible=0==n.manorId,e.entityIndex=d,e.setTilePos(n.coordinateInfo.x,n.coordinateInfo.y),e.updateVisible(),o.gp_ep.addChild(e),o.otherPlayers[c]||(o.otherPlayers[c]={}),o.otherPlayers[c][d]=e,n.teamInfo&&n.teamInfo.heroBaseInfoList&&n.teamInfo.heroBaseInfoList[0]){var t=n.teamInfo.heroBaseInfoList[0],i=void 0;0!=t.dermaCode&&(i=m.Config.getHeroDermaConfig()[t.dermaCode].avatar),e.updateBaseItem({code:t.code,avatar:i})}else{var a=JSON.parse(m.Config.constConfig().DefaultAvatar.constValue)[0];e.updateBaseItem({avatar:a})}}},params:void 0});else{var g,u=this.otherPlayers[c][d];if(u.isOccupyManor=0!=n.manorId,u.visible=0==n.manorId,n.teamInfo&&n.teamInfo.heroBaseInfoList&&n.teamInfo.heroBaseInfoList[0])h=void 0,0!=(g=n.teamInfo.heroBaseInfoList[0]).dermaCode&&(h=m.Config.getHeroDermaConfig()[g.dermaCode].avatar),u.updateBaseItem({code:g.code,avatar:h});else l=JSON.parse(m.Config.constConfig().DefaultAvatar.constValue)[0],u.updateBaseItem({avatar:l});if(n.coordinateStatus==ManorPlayerCoordinateChangeType.Battle||n.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper||n.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero)u.setTilePos(n.coordinateInfo.x,n.coordinateInfo.y);else{var f=this.getAStarPath(u.tileX,u.tileY,n.coordinateInfo.x,n.coordinateInfo.y);u.walkByPath(f,function(){})}}}},o.prototype.caleOtherPlayerCount=function(){var e=0;for(var t in this.otherPlayers)for(var i in this.otherPlayers[t])e+=1;return e},o.prototype.removeOtherPlayer=function(e,t){this.otherPlayers[e]&&this.otherPlayers[e][t]&&(this.otherPlayers[e][t].reset(),this.gp_ep.removeChild(this.otherPlayers[e][t]),delete this.otherPlayers[e][t])},o.prototype.removeAllOtherPlayer=function(){for(var e in this.otherPlayers)for(var t in this.otherPlayers[e])this.removeOtherPlayer(e,t)},o.prototype.removeManorEntity=function(e){if(e){var t=!1;for(var i in this.tileIndex2EP)if(this.tileIndex2EP[i].vo.info.manorId==e.manorId){console.log("移除矿"+e.manorId),this.gp_ep.removeChild(this.tileIndex2EP[i]),delete this.tileIndex2EP[i],t=!0;break}t&&(this.reqCalAllZOrder(),this.initGraph())}},o.prototype.removePlayerEntity=function(e){e&&this.removeOtherPlayer(e.baseInfo.playerId,e.entityIndex)},o.prototype.updateManorEPCollect=function(){for(var e in this.tileIndex2EP)this.tileIndex2EP[e]&&this.tileIndex2EP[e].updateCollect&&this.tileIndex2EP[e].updateCollect()},o.prototype.updateMapPlayerInfo=function(t,e){var i=this;if(void 0===e&&(e=!1),t.isSelf)e&&(this.updateNPC({curPosVO:{x:t.pos&&t.pos.x||0,y:t.pos&&t.pos.y||0,isFixed:!0}}),m.GameMVC.guajiPy.updateCurPosition(t.pos.x,t.pos.y));else{if(!this.isInited)return void(this.delatupdateMapPlayerInfo={player:t,isInit:e});this.delatupdateMapPlayerInfo=void 0;var a=t.playerId;if(this.stormWarPlayers[a]){var n=this.stormWarPlayers[a];n.updateFighting(t.status==StormWarPlayerStatus.Battle);var o=this.getAStarPath(n.tileX,n.tileY,t.pos.x,t.pos.y);n.walkByPath(o,function(){})}else this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){if(i.stage&&!i.stormWarPlayers[a]){var e=m.StormWarPlayerFactory.create({map:i,player:t});e.setTilePos(t.pos.x,t.pos.y,!0),e.updateVisible(),e.updateFighting(t.status==StormWarPlayerStatus.Battle),i.gp_ep.addChild(e),i.stormWarPlayers[a]=e}},params:void 0})}},o.prototype.removeStormWarPlayer=function(e){this.stormWarPlayers[e]?(this.stormWarPlayers[e].reset(),this.gp_ep.removeChild(this.stormWarPlayers[e]),delete this.stormWarPlayers[e]):egret.log("===== storm ===== 移除风暴战场玩家 "+e+" 失败")},o.prototype.removeAllStormWarPlayer=function(){for(var e in this.stormWarPlayers)this.removeStormWarPlayer(e)},o.prototype.updateStormChampion=function(e){for(var t in this.stormWarPlayers)this.stormWarPlayers[t].updateChampion(e)},o.prototype.getStormWarPlayerByTilePos=function(e,t){var i=new Array;for(var a in this.stormWarPlayers){var n=this.stormWarPlayers[a];n&&n.tileX==e&&n.tileY==t&&i.push(n)}return i},o.prototype.getStormWarPlayerByPlayerId=function(e){var t=this.stormWarPlayers[e];return t||null},o);function o(){var e=a.call(this)||this;return e.radiusScanOutside=10,e.tileIndex2EP={},e.tileIndex2MBN={},e.tileIndex2MNM={},e.tileIndex2MNMEP={},e.playerOrTeamId2NPC={},e.otherPlayers={},e.stormWarPlayers={},e.walkStep=0,e.curValidTouchPosXY=[],e.mwArr=new Array,e.needSortChildrenArr=new Array,e.fu_mgr=FrameUpdateMgr.getInstance(),e.once(egret.Event.REMOVED_FROM_STAGE,function(){GameRootLayer.gameLayer().switchCloudLoading(!1),e.removeEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e)},e),e.addEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e),e}m.Map=n;var s,u=(s=eui.Group,__extends(r,s),r.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.img_bg=new eui.Image,this.addChild(this.img_bg),this.img_bg.source=this.deepImg,this.img_bg.touchEnabled=this.touchEnabled=!1},r);function r(e){var t=s.call(this)||this;return t.value=0,t.tileX=e.x,t.tileY=e.y,t.deep=e.tiledP.deep,t.deepImg=e.tiledP.deepImg,t.width=139,t.height=182,t.anchorOffsetX=70,t.anchorOffsetY=97,t}}(game=game||{}),function(h){var n,e=(n=h.PlayerNpc,__extends(t,n),t.prototype.setFollowers=function(e){var r=this;e=e||[],this.followers||(this.followers=new Array);for(var t=0,i=this.followers;t<i.length;t++)(o=i[t]).valid=!1;e.forEach(function(e,t){if(e.isLeader)r.updateNPCOutLook(e.baseInfo);else{for(var i=!1,a=0,n=r.followers;a<n.length;a++){var o=n[a];if(o.vo.playerId==e.baseInfo.playerId){i=!0,o.valid=!0,o.updateNPCOutLook(e.baseInfo);break}}if(!i){var s=new h.PlayerNpc(r.map,void 0,e.baseInfo);s.hasEnterMap=!0,s.setTilePos(r.tileX,r.tileY,!0),r.parent.addChild(s),r.followers.push(s)}}});for(var a=0,n=this.followers;a<n.length;a++){var o;(o=n[a]).valid||(o.reset(),this.parent.removeChild(o))}this.followers=this.followers.filter(function(e){return e.valid})},t.prototype.onWalking=function(){n.prototype.onWalking.call(this),this.map.onMeWalkTo(this.tileX,this.tileY),this.py.updateCurPosition(this.tileX,this.tileY),this.followers&&(this.followers[0]&&this.followers[0].walkToTile(this.lastTileX,this.lastTileY),this.followers[1]&&this.followers[1].walkToTile(this.followers[0].lastTileX,this.followers[0].lastTileY))},t.prototype.walkPathFinish=function(){0<this.hasWalkPassPath.length&&this.map.source==MODULE.Risk&&this.py.Walk(this.hasWalkPassPath),n.prototype.walkPathFinish.call(this)},t.prototype.reset=function(){if(n.prototype.reset.call(this),this.followers){for(var e=0,t=this.followers;e<t.length;e++)t[e].reset();this.followers.splice(0)}this._tileX=0,this._tileY=0},t);function t(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=MODULE.Risk);var a=n.call(this,e,i)||this;return a.isFollower=!1,a.isFollower=t,a.mapObjType=1,a.vo=h.GameMVC.playerPy.playerInfoVO,a.isMe=!0,a}h.Me=e}(game=game||{}),function(n){var t,e=(t=n.EventPoint,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){var e;this.c=n.GeneralConfig.getEntityConfigByCode(this.vo.info.rewards[0].type,this.vo.info.rewards[0].code),this.c&&(e=(e=t.prototype.makeDefaultIcon.call(this))||this.c.icon+"_png",this.img_icon.source=e,t.prototype.addEffect.call(this))},i.prototype.onTrigger=function(t,i){var a=this;this.c&&(this.checkTriggerCD()?PopUpManager.addPopUp({closeCB:function(e){1==e?(a.py.TriggerEvent(a.vo.position,void 0,void 0,a.doneStoryId),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0},obj:new n.EpBoxView({config:this.c,canGet:!0,vo:this.vo})}):i&&i())},i);function i(){return null!==t&&t.apply(this,arguments)||this}n.EPBox=e}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpBoxCreepView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPBoxCreep=t}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpCollectView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,String(e)),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPCollect=t}(game=game||{}),function(o){var n,e=(n=o.EventPoint,__extends(t,n),t.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},t.prototype.onDataChange=function(){if(this.vo.type==RiskEventType.StoryCreep){var e=this.vo&&this.vo.eventId,t=o.Config.riskEvent()[e],i=JSON.parse(t.detail)[0];this.c=o.Config.riskCreep()[i]}else this.c=o.Config.riskCreep()[this.vo.info.id];if(this.c&&(n.prototype.makeDefaultIcon.call(this)?this.img_icon.visible=!0:(this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:this.c.model})),0==this.c.difficulty||1==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touying":2==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touyinglan":3==this.c.difficulty&&(this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong"),this.c.difficulty&&!this.gp_foot.getChildByName("difficultySign")&&!this.gp_foot.getChildByName("showSign"))){var a=new eui.Image;a.source="_guaji_m_json.mx_img_jian"+this.c.difficulty,a.y=-70,a.scaleX=a.scaleY=.8,a.horizontalCenter=0,a.name="difficultySign",this.gp_foot.addChild(a)}},t.prototype.hudongWithEP=function(e){var t=this.gp_foot.getChildByName("showSign");if(e.showSign)if(t)t.visible=!0;else{var i=new eui.Image;i.source="_guaji_m_json.mx_img_gth",i.y=-60,i.name="showSign",this.gp_foot.addChild(i),UIActionManager.douDong(i)}else 0==e.showSign&&t&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"))},t.prototype.onTrigger=function(i,a){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){var e=n.vo&&n.vo.eventId,t=o.Config.riskEvent()[e];e&&t&&t.descId?PopUpManager.addPopUp({closeCB:function(e){1==e?(n.py.setAfterFightAutoGoCurEPStory(n.doneStoryId,!0),n.py.TriggerEvent(n.vo.position),i&&i()):a&&a(),o.EventPoint.lastTriggerTime=0},obj:new o.EpCreepView({config:n.c,vo:n.vo})}):PopUpManager.addPopUp({closeCB:function(e){1==e?(n.py.setAfterFightAutoGoCurEPStory(n.doneStoryId,!0),n.py.TriggerEvent(n.vo.position),i&&i()):a&&a(),o.EventPoint.lastTriggerTime=0},obj:new s({config:n.c})})}):a&&a()},t);function t(){var e=null!==n&&n.apply(this,arguments)||this;return e.guidePy=o.AppFacade.getInstance().retrieveProxy(o.GuidePy.N),e}o.EPCreep=e;var i,s=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.commonTanKuang.img_title_bg.visible=!1,this.inButton(),this.updateView()},a.prototype.inButton=function(){var e=this;this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.HeroMediator.N,o.HeroMediator.SV.FORMATION)},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){o.AppFacade.getInstance().retrieveProxy(o.HeroPy.N).showCurHeroHalo()}),this.commonTanKuang.onCloseCB=function(){e.hide()}},a.prototype.updateView=function(){for(var i=this,e=this.params.config,t=0,a=JSON.parse(e.rewards);t<a.length;t++){var n=a[t],o=customui.BaseItemFactory.create(21);o.updateData({type:n[0],code:n[1],num:n[2]}),o.scaleX=.7,o.scaleY=.7,this.gp_reward_show.addChild(o)}var s=JSON.parse(e.creeps);Array.isArray(s)&&s.forEach(function(e){if(e[0]){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e[0]}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t),t.touchEnabled=!1}})},a);function a(e){var t=i.call(this)||this;return t.skinName="GuajiCreepDetaiPanellSkin",t.params=e,t}}(game=game||{}),function(a){var e,t=(e=a.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new a.EpFingerGameView({vo:i.vo}),closeCB:function(e){a.EventPoint.lastTriggerTime=0}})}):t&&t()},i);function i(){return null!==e&&e.apply(this,arguments)||this}a.EPFingerGame=t}(game=game||{}),function(i){var e,t=(e=i.EventPoint,__extends(a,e),a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1},a.prototype.onDataChange=function(){var e=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];e&&e.data&&!this.cu_model&&(this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.4,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,code:41050009}))},a.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N).isOpen(EActivityType.FirstRecharge1)?PopUpManager.addPopUp({obj:new i.EpRechargeView}):Utils.MsgUtils.addMidMsg("活动未开启"):t&&t()},a);function a(){return null!==e&&e.apply(this,arguments)||this}i.EPFirstRecharge=t}(game=game||{}),function(n){var t,e=(t=n.EventPoint,__extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},i.prototype.onDataChange=function(){this.c=n.Config.riskFortress()[this.vo.info.id],this.c?(t.prototype.makeDefaultIcon.call(this),t.prototype.addEffect.call(this),this.lb_tips.text=this.c.name,this.vo.info.clear?(this.img_passed=new eui.Image("maoxian_txt_ytg_png"),this.img_passed.bottom=100,this.img_passed.horizontalCenter=0,this.addChild(this.img_passed)):this.img_passed&&this.img_passed.parent&&this.img_passed.parent.removeChild(this.img_passed)):egret.warn("找不到配置",this.vo.info.id)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({closeCB:function(e){1==e?(a.py.TriggerEvent(a.vo.position,void 0,void 0,a.doneStoryId),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0},obj:new n.EPFortressView({config:a.c,vo:a.vo})})}):i&&i()},i);function i(){return null!==t&&t.apply(this,arguments)||this}n.EPFortress=e}(game=game||{}),function(R){var t,e=(t=R.EventPoint,__extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},i.prototype.onDataChange=function(){var t=this;RES.getResAsync(MAP_EP_GATE_IMG[this.vo.info.type],function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2},this),this.lb_tips.text="传送门"},i.prototype.onTrigger=function(t,i){var a=this;if(this.log("risk当前传送门类型"+this.vo.info.type),this.checkTriggerCD())if(this.vo.info.type==GateType.Any){var e=R.AppFacade.getInstance().retrieveProxy(R.GuajiPy.N);e.GetLayerNum(function(){PopUpManager.addPopUp({obj:new o({type:e.localType}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,parseInt(e)%2e4+"",void 0,a.doneStoryId),t&&t(e)):i&&i(),R.EventPoint.lastTriggerTime=0}})})}else this.py.TriggerEvent(this.vo.position,void 0,void 0,this.doneStoryId),t&&t();else i&&i()},i);function i(){return null!==t&&t.apply(this,arguments)||this}R.EPGate=e;var a;a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.cb&&this.data.cb()},this)},n.prototype.dataChanged=function(){var e=this.data.c;this.guajiPy.curLayerInfo.position.layerId==e.id?this.lb_name.text=(e.name||e.id)+"号地图  大小"+e.wide+"x"+e.long+" （当前在这层）":this.lb_name.text=(e.name||e.id)+"号地图  大小"+e.wide+"x"+e.long,this.py.playerInfoVO.level<e.unlockLevel?(this.lb_unlock.text=e.unlockLevel+"级解锁",this.lb_unlock.visible=!0):this.lb_unlock.visible=!1,""!=e.clearCondition?(this.lb_unlock_cost.visible=this.cu_numIcon.visible=!0,this.cu_numIcon.updateItem({cost:JSON.parse(e.clearCondition)[0]})):this.lb_unlock_cost.visible=this.cu_numIcon.visible=!1,this.btn_apply.enabled=this.guajiPy.curLayerInfo.position.layerId!=e.id};function n(){var e=a.call(this)||this;return e.skinName="GuajiGateListItemRenderSkin",e.py=R.AppFacade.getInstance().retrieveProxy(R.PlayerPy.N),e.guajiPy=R.AppFacade.getInstance().retrieveProxy(R.GuajiPy.N),e}var l,o=(l=BasePanel,__extends(s,l),s.prototype.childrenCreated=function(){var a=this;l.prototype.childrenCreated.call(this);var e=R.Config.risk();function t(i){n["gate_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=R.Config.risk(),t=a.params&&a.params.type||0;e[a.allLayerNum+1+2e4*t]?i<=e[a.allLayerNum+1+2e4*t].chapterId?a.nowLay!=i&&a.updateMap(i):Utils.MsgUtils.addMidMsg("当前章节尚未解锁"):i<=e[a.allLayerNum].chapterId?a.nowLay!=i&&a.updateMap(i):Utils.MsgUtils.addMidMsg("敬请期待")},n)}this.params.type==this.guajiPy.localType?this.updateMap(e[this.guajiPy.curLayerInfo.position.layerId].chapterId):this.updateMap(e[this.guajiPy.lastCurLayerId[this.params.type]||1].chapterId),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide()},this);for(var n=this,i=1;i<6;i++)t(i);var o=new eui.Image;o.source="common_img_guangboditiao_png",this.gp_map.addChild(o),o.x=this.img_close.x-550,o.y=40,o.width=270;var s=new eui.Label;s.size=20,s.textColor=16777215,this.gp_map.addChild(s),s.text="标记有",s.x=this.img_close.x-550,s.y=50;var r=new eui.Image;r.source="_border_m_json.common_icon_xingji",this.gp_map.addChild(r),r.scaleX=.5,r.scaleY=.5,r.x=this.img_close.x-490,r.y=45;var h=new eui.Label;h.size=20,h.textColor=16777215,this.gp_map.addChild(h),h.text="的地图已100%探索",h.x=this.img_close.x-465,h.y=50},s.prototype.updateMap=function(u){var f=this;this.nowLay=u;var m=R.Config.risk(),y=R.Config.riskLayer(),_=new eui.Image,v=!0;_.source="mx_img_dizuo_png",this.layerList=[],this.gp_gate.visible=!m[this.allLayerNum+1]||1<m[this.allLayerNum+1].chapterId;for(var T=this.params&&this.params.type||0,e=1;e<6;e++)this["gate_"+e].source=1<e&&e<5?e==u?"maoxian_btn_yeqianl02_png":"maoxian_btn_yeqiana02_png":e==u?"maoxian_btn_yeqianl01_png":"maoxian_btn_yeqiana01_png",this["gate_lab_"+e].source=e==u?this.GATE_LAB[e].down:this.GATE_LAB[e].up;this.gp_unlock.removeChildren();var C=this.guajiPy.allLayersInfo[this.params.type];for(var t in C){var i=C[t],a=i.layerId,n=i.clear;if(i.isGot&&n){var o=(Number(a)-20*(this.nowLay-1))%2e4;if(this["lb_"+o]){var s=new eui.Image;s.source="_border_m_json.common_icon_xingji",s.x=this["lb_"+o].x-40,s.y=this["lb_"+o].y-15,this.gp_unlock.addChild(s),s.scaleX=.85,s.scaleY=.85}}}var E=[],r=R.GameMVC.activityPy.allActivityData[EActivityType.RiskSecretTerritory];function h(e){if(m[e].type!=T)return"continue";if(m[e].chapterId==u){var i=Number(e)%2e4-20*(u-1);b["gp_line_"+i]&&(b["gp_line_"+i].visible=!1),b["map_"+i].pixelHitTest=!0,b.mapTapFunc[i]=function(){0==y[m[e].layerId].isOpen?(Utils.MsgUtils.addMidMsg("暂未开放，敬请期待"),f["map_"+i].scaleX=f["map_"+i].scaleY=1):(-1!=f.layerList.indexOf(String(i+2e4*T+20*(f.nowLay-1)))?f.opperationParams=i+2e4*T+20*(f.nowLay-1):f.py.playerInfoVO.level<y[m[e].layerId].unlockLevel?PopUpManager.addPopUp({obj:new R.LackExpView,closeCB:function(e){e&&f.hide()}}):Utils.MsgUtils.addMidMsg("当前关卡尚未解锁"),f.hide())},b["map_"+i].hasEventListener(egret.TouchEvent.TOUCH_TAP)||b["map_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.mapTapFunc[i]&&f.mapTapFunc[i]()},b),b["map_"+i].hasEventListener(egret.TouchEvent.TOUCH_BEGIN)||b["map_"+i].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){f["map_"+i].scaleX=f["map_"+i].scaleY=1.1},b),b["map_"+i].hasEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE)||b["map_"+i].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){f["map_"+i].scaleX=f["map_"+i].scaleY=1},b),b["gp_effect_"+i].removeChildren(),b["gp_effect_"+i].x=0,b["gp_effect_"+i].y=0,b["gp_effect_"+i].visible=!1,b.taskPy.getCurGuideTask(0==b.params.type?TaskType.Guide:TaskType.DifficultyGuide);var t=Number(y[m[e].layerId].taskUnlock);b.isSure=!t;var a=0==b.params.type?b.taskPy.TaskDone[TaskType.Guide]:b.taskPy.TaskDone[TaskType.DifficultyGuide]||[];for(var n in a)a[n].code==t&&(b.isSure=!0);b["map_"+i].touchEnabled=b.guajiPy.curLayerInfo.position.layerId!=y[m[e].layerId].id,UIActionManager.setAbsGrey(b["map_"+i],!1);var o=R.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Risk,{id:e});if(v)if(b.py.playerInfoVO.level<y[m[e].layerId].unlockLevel||y[m[e].layerId].id%2e4>b.allLayerNum+1||!b.isSure||o.isBelonged&&!o.unlock||0==y[m[e].layerId].isOpen){b["lb_"+i].text=m[e].name;var s=new eui.Image,r=new eui.Image,h=new eui.Label;function l(){0==y[m[e].layerId].isOpen?(h.text="(暂未开放，敬请期待)",h.x=r.x-20,h.y=r.y+5,r.width=h.width+50,r.x=r.x-43):f.py.playerInfoVO.level<y[m[e].layerId].unlockLevel?(h.text="("+y[m[e].layerId].unlockLevel+"级后解锁)",h.x=r.x+23,h.y=r.y+5,r.width=h.width+50):y[m[e].layerId].id%2e4>f.allLayerNum+1?(h.text="(通过前一关解锁)",h.x=r.x,h.y=r.y+5,r.width=h.width+50,r.x=r.x-23):f.isSure||(h.text="(完成当前地图任务解锁)",h.x=r.x-20,h.y=r.y+5,r.width=h.width+50,r.x=r.x-43)}r.source="_guaji_m_json.mx_img_mingchengdi",s.source="maoxian_img_suo_png",UIActionManager.setAbsGrey(b["map_"+i]),s.scaleX=s.scaleX=.9,s.x=b["lb_"+i].x-31,s.y=b["lb_"+i].y-10,r.x=b["lb_"+i].x-28,r.y=b["lb_"+i].y+22,h.size=17,h.textColor=16187392,b.gp_unlock.addChild(s),b.gp_unlock.addChild(r),o.isBelonged?o.unlock?l():(h.text="(封印之地解锁)",h.x=r.x,h.y=r.y+5,r.width=h.width+50,r.x=r.x-23):l(),b.gp_unlock.addChild(h),v=!1}else{1<Number(i)&&(b["gp_line_"+m[Number(i)-1].layerId].visible=!0),b["lb_"+i].text=m[e].name,b.layerList.push(e);var c=C[Number(e)%2e4-1];if(c)if(100!=c.progress){var d=new eui.Image,p=new eui.Label;d.source="_guaji_m_json.mx_img_mingchengdi",d.x=b["lb_"+i].x-28,d.y=b["lb_"+i].y+22,p.size=20,p.textColor=16777215,p.text="探索度"+c.progress+"%",p.x=b["lb_"+i].x+2,p.y=b["lb_"+i].y+25,d.width=p.width+50,b.gp_unlock.addChild(d),b.gp_unlock.addChild(p)}else c.isGot||(b["gp_effect_"+i].visible=!0,b["gp_effect_"+i].touchEnabled=!0,b["gp_effect_"+i].x=50+b["lb_"+i].x+b["lb_"+i].width/2,b["gp_effect_"+i].y=b["lb_"+i].y-5,b["gp_effect_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:f["gp_effect_"+i],x:f["gp_effect_"+i].width/2,y:f["gp_effect_"+i].height/2,scaleX:.7,scaleY:.7,doneCB:function(){f.guajiPy.GetProgressReward(c.uuid,function(){c.isGot=!0,f["gp_effect_"+i].removeChildren(),f["gp_effect_"+i].visible=!1;var e=new eui.Image;e.source="_border_m_json.common_icon_xingji",e.x=f["lb_"+i].x-40,e.y=f["lb_"+i].y-15,f.gp_unlock.addChild(e),e.scaleX=.85,e.scaleY=.85;var t=R.GameMVC.guajiMed.getSubView(R.GuajiMediator.SV.MAIN);t&&c.layerId==R.GameMVC.guajiPy.curLayerInfo.position.layerId&&t.updateProgress(R.GameMVC.guajiPy.riskProgress)},f.params.type)}})},b),DragonBoneTools.create("common_baoxiang_5",function(e){e.x=this["gp_effect_"+i].width/2,e.y=this["gp_effect_"+i].height/2,e.scaleX=e.scaleY=.7,e.animation.play(),this["gp_effect_"+i].addChild(e)},b))}else b["lb_"+i].text="",UIActionManager.setAbsGrey(b["map_"+i]);if(b.guajiPy.curLayerInfo.position.layerId==y[m[e].layerId].id){var g=new customui.RoleDynamicModel;g.scaleX=g.scaleY=.7,g.update({reqStyle:ROLE_STYLE.Fashion}),g.x=b["lb_"+i].x+42,g.y=b["lb_"+i].y-16,_.x=b["lb_"+i].x+25,_.y=b["lb_"+i].y-28,b.gp_unlock.addChild(_),b.gp_unlock.addChild(g)}0<=E.indexOf(parseInt(e))?(b["gp_effect_"+i].touchChildren=!0,b["gp_effect_"+i].visible=!0,b["gp_effect_"+i].touchEnabled=!0,b["lb_"+i].text?b["gp_effect_"+i].x=50+b["lb_"+i].x+b["lb_"+i].width/2:(b["lb_"+i].text=m[e].name,b["gp_effect_"+i].x=50+b["lb_"+i].x+b["lb_"+i].width/2,b["lb_"+i].text=""),b["gp_effect_"+i].y=b["lb_"+i].y-5,DragonBoneTools.create("common_ui_huodongfb",function(e){var t=this;e.x=this["gp_effect_"+i].width/2+(I[i-1][0]||0)+20,e.y=this["gp_effect_"+i].height/2+(I[i-1][1]||0)+40,e.scaleX=e.scaleY=.5,e.animation.play(),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.mapTapFunc[i]&&t.mapTapFunc[i]()},this),this["gp_effect_"+i].addChildAt(e,0)},b)):b["gp_effect_"+i].touchChildren=!1}}r&&r.content&&r.content[0].forEach(function(e){E.push(e[0])});var I=[[-10,-20],[-30,-80],[-90,20],[-150,-90],[-170,-20],[-170,-20],[-40,-85],[-160,-30],[-160,-30],[-160,-30],[-150,-30],[-140,-80],[-40,-80],[-160,-30],[-160,-30],[-160,-30],[-40,-80],[-160,-30],[-160,-30],[-160,-30]],b=this;for(var l in m)h(l);this.checkNeedExp()},s.prototype.select=function(){},s.prototype.checkNeedExp=function(){var t=this,e=R.AppFacade.getInstance().retrieveProxy(R.PlayerPy.N).playerInfoVO.level,i=!1;if(e<parseInt(R.Config.constConfig().ExpHintMaxLevel.constValue)){var a=this.taskPy.getCurGuideTask(0==this.params.type?TaskType.Guide:TaskType.DifficultyGuide);if(a){var n=parseInt(this.layerList[this.layerList.length-1]),o=R.Config.riskLayer(),s=0;for(var r in o)if((p=o[r]).taskUnlock==a.code){s=p.id;break}if(0<=this.layerList.indexOf(s.toString));else{var h=R.Config.riskLayer()[n+1],l=h.taskUnlock,c=!1,d=0==this.params.type?this.taskPy.TaskDone[TaskType.Guide]:this.taskPy.TaskDone[TaskType.DifficultyGuide];if(d)for(var r in d){var p;(p=d[r]).code==l&&(c=!0)}c&&h&&e<h.unlockLevel&&1==h.isOpen&&(i=!0)}}}i&&PopUpManager.addPopUp({obj:new R.LackExpView,closeCB:function(e){e&&t.hide()}})},s);function s(e){var t=l.call(this)||this;t.allLayerNum=0,t.mapTapFunc={},t.GATE_LAB=((i={})[1]={up:"maoxian_txt_telaizesi00_png",down:"maoxian_txt_telaizesi01_png",enable:!1},i[2]={up:"maoxian_txt_huimieshenyuan00_png",down:"maoxian_txt_huimieshenyuan01_png",enable:!1},i[3]={up:"maoxian_txt_yijierukou00_png",down:"maoxian_txt_yijierukou01_png",enable:!1},i[4]={up:"maoxian_txt_mojiedalu00_png",down:"maoxian_txt_mojiedalu01_png",enable:!1},i[5]={up:"maoxian_txt_shenzhishijie00_png",down:"maoxian_txt_shenzhishijie01_png",enable:!1},i),t.skinName="GuajiGateListPanelSkin",t.params=e,t.py=R.AppFacade.getInstance().retrieveProxy(R.PlayerPy.N),t.guajiPy=R.AppFacade.getInstance().retrieveProxy(R.GuajiPy.N),t.taskPy=R.AppFacade.getInstance().retrieveProxy(R.TaskPy.N),e=e||{type:0},t.allLayerNum=0;var i,a=t.guajiPy.allLayersInfo[e.type];return a&&(t.allLayerNum=a.length),t.allLayerNum||(t.allLayerNum=1),t}R.GuajiGateListPanel=o}(game=game||{}),function(a){var e,t=(e=a.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new a.EpGuessSizeView({vo:i.vo}),closeCB:function(e){a.EventPoint.lastTriggerTime=0}})}):t&&t()},i);function i(){return null!==e&&e.apply(this,arguments)||this}a.EPGuessSize=t}(game=game||{}),function(e){var t,i=(t=e.EventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.source=this.params.hinderImg},a.prototype.onDataChange=function(){},a.prototype.onTrigger=function(e,t){t&&t()},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EPHinder=i}(game=game||{}),function(i){var e,t=(e=i.EventPoint,__extends(a,e),a.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.manorId=0,this.gp_effect.touchEnabled=!1,this.gp_effect.bottom=40,this.img_icon.visible=!1,this.img_player=new eui.Image,this.img_player.horizontalCenter=-40,this.img_player.bottom=-5,this.img_player.source="item_icon_renshu_png",this.img_player.scaleX=.4,this.img_player.scaleY=.4,this.addChild(this.img_player),this.img_special=new eui.Image,this.img_special.horizontalCenter=60,this.img_special.bottom=65,this.img_special.source="mxkc_img_chaoji_png",this.img_special.scaleX=.8,this.img_special.scaleY=.8,this.addChild(this.img_special),this.img_special.visible=!1,this.ep_collect=new eui.Group,this.ep_collect.horizontalCenter=20,this.ep_collect.bottom=120,this.addChild(this.ep_collect),MovieClipTools.create("common_caijizhong",function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=this.ep_collect.width/2,e.y=this.ep_collect.height/2,e.animation.play("common_caijizhong",0),this.ep_collect.addChild(e)},this),this.ep_collect.visible=!1,this.ep_box=new eui.Group,this.ep_box.horizontalCenter=0,this.ep_box.bottom=160,this.ep_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击 收取  manorID:"+this.vo.info.manorId+" "),this.manorPy.AccountRewards()},this),this.addChild(this.ep_box),MovieClipTools.create("common_baoxiang_5",function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=this.ep_box.width/2,e.y=this.ep_box.height/2,e.animation.play("common_baoxiang_5",0),this.ep_box.addChild(e)},this),this.ep_box.visible=!1,this.ep_guild=new eui.Group,this.ep_guild.touchEnabled=!1,this.ep_guild.width=63,this.ep_guild.height=78,this.ep_guild.horizontalCenter=-40,this.ep_guild.bottom=20,this.addChild(this.ep_guild),this.img_guild_qizi=new eui.Image,this.img_guild_qizi.horizontalCenter=0,this.img_guild_qizi.source="mxkc_img_qi1_png",this.ep_guild.addChild(this.img_guild_qizi),this.lb_guild_name=new eui.Label,this.lb_guild_name.top=26,this.lb_guild_name.horizontalCenter=0,this.lb_guild_name.height=20,this.lb_guild_name.width=36,this.lb_guild_name.textAlign="center",this.lb_guild_name.textColor=16774314,this.lb_guild_name.size=16,this.lb_guild_name.text="",this.lb_guild_name.bold=!0,this.ep_guild.addChild(this.lb_guild_name),this.manorPy=i.AppFacade.getInstance().retrieveProxy(i.ManorProxy.N)},a.prototype.updateData=function(){this.onDataChange()},a.prototype.onDataChange=function(){if(this.c=i.Config.manor()[this.vo.info.id],this.c){this.manorEntity=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId),this.setGuildQiZi(this.manorEntity.isSameGuild,this.manorEntity.guildName),this.lb_tips.text=this.manorEntity.num+"/"+this.c.num;var e=!1;if(0==this.manorId?e=!0:0!=this.vo.info.manorId&&this.manorId!=this.vo.info.manorId&&(e=!0),e&&(this.gp_effect.removeChildren(),this.c.model&&(MovieClipTools.create(this.c.model,function(e){e.visible=!0,e.scaleX=e.scaleY=1,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(this.c.model,0),this.gp_effect.addChild(e,3)},this),this.manorEntity.isSpecial))){var t="risk_event_kuangshits";MovieClipTools.create(t,function(e){e.visible=!0,e.scaleX=e.scaleY=1,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(t,0),this.gp_effect.addChildAt(e,5)},this)}this.manorId=this.vo.info.manorId,this.img_special.visible=this.manorEntity.isSpecial,this.updateCollect()}else egret.warn("找不到配置",this.vo.info.id)},a.prototype.setGuildQiZi=function(e,t){""!=t?(this.lb_guild_name.text=t,this.img_guild_qizi.source=e?"mxkc_img_qi1_png":"mxkc_img_qi2_png",this.lb_guild_name.visible=!0,this.img_guild_qizi.visible=!0):(this.lb_guild_name.visible=!1,this.img_guild_qizi.visible=!1)},a.prototype.checkNotice=function(){return!this.vo.info.captured},a.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().showSubView(i.ManorMediator.N,i.ManorMediator.SV.DETAIL,{vo:this.vo}):t&&t()},a.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},a.prototype.updateCollect=function(){this.manorPy.selfEntity&&this.manorPy.selfEntity.manorId&&this.manorPy.selfEntity.manorId==this.vo.info.manorId?(this.manorPy.selfEntity.rewards&&this.manorPy.selfEntity.rewards[0]?this.ep_box.visible=!0:this.ep_box.visible=!1,this.ep_collect.visible=!0):(this.ep_collect.visible=!1,this.ep_box.visible=!1)},a);function a(){return null!==e&&e.apply(this,arguments)||this}i.EPManor=t}(game=game||{}),function(n){var o,e=(o=n.EventPoint,__extends(t,o),t.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},t.prototype.onDataChange=function(){var t=this;if(this.c=n.Config.riskMaze()[this.vo.info.id],this.c){this.lb_tips.text=this.c.name,RES.getResAsync("_guaji_m_json.maoxian_icon_chuansongmen2",function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2,o.prototype.addEffect.call(t)},this),this.vo.info.clear?(this.img_passed=new eui.Image("maoxian_txt_ytg_png"),this.img_passed.bottom=100,this.img_passed.horizontalCenter=0,this.addChild(this.img_passed)):this.img_passed&&this.img_passed.parent&&this.img_passed.parent.removeChild(this.img_passed);var i=[],e=n.GameMVC.activityPy.allActivityData[EActivityType.RiskSecretTerritory];if(e&&e.content&&e.content[0].forEach(function(e){i.push(e[1])}),0<=i.indexOf(this.vo.eventId)){var a=n.ActivityConfig.getActivityEndDt(EActivityType.RiskSecretTerritory)-Utils.TimerManager.getServerTime();0<a&&(this.lb_tips.text=Utils.TimerManager.getFormatBySecond1(a),this.timer=egret.setInterval(function(){a--,t.lb_tips.text=Utils.TimerManager.getFormatBySecond1(a),a<=0&&(t.timer&&egret.clearInterval(t.timer),t.onDataChange())},this,1e3))}o.prototype.addEffect.call(this)}else egret.warn("找不到配置",this.vo.info.id)},t.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({closeCB:function(e){1==e?(a.py.TriggerEvent(a.vo.position,void 0,void 0,a.doneStoryId),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0},obj:new n.EPFortressView({config:a.c,vo:a.vo})})}):i&&i()},t.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},t);function t(){return null!==o&&o.apply(this,arguments)||this}n.EPMaze=e}(game=game||{}),function(s){var i,e=(i=s.EventPoint,__extends(t,i),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},t.prototype.onDataChange=function(){var e=this;if(this.c=s.Config.riskMine()[this.vo.info.id],this.c){this.lb_tips.text=this.c.name,i.prototype.makeDefaultIcon.call(this)||(this.img_icon.source=s.GeneralConfig.getGuajiImg(this.c.icon)[1]);var t=this.c.type;this.vo.info.captured&&!this.effect1&&(MovieClipTools.create("kuangren_2",function(e){this.effect1=e,this.effect1.visible=!0,2==t||4==t?(this.effect1.y=this.img_icon.height/2-40,this.effect1.x=this.img_icon.width-10):(this.effect1.x=this.img_icon.width,this.effect1.y=this.img_icon.height/2-30),this.effect1.animation.timeScale=.6,this.effect1.animation.play("kuangren_2",-1),this.addChild(this.effect1)},this),this.effect2||egret.setTimeout(function(){MovieClipTools.create("kuangren_1",function(e){this.effect2=e,this.effect2.visible=!0,this.effect2.x=25,this.effect2.y=this.img_icon.height/2-30,this.effect2.scaleX=-1,this.effect2.animation.timeScale=.6,this.effect2.animation.play("kuangren_1",-1),this.addChild(this.effect2)},e)},this,380),this.timer&&egret.clearInterval(this.timer))}else egret.warn("找不到配置",this.vo.info.id)},t.prototype.checkNotice=function(){return!this.vo.info.captured},t.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?PopUpManager.addPopUp({closeCB:function(e){1==e?(a.vo.info.captured||(a.py.setAfterFightAutoGoCurEPStory(a.doneStoryId,!0),s.CommonMediator.RewardCloseCallBack=function(e){e.result==EBattleResult.EBattleResultWin&&a.onTrigger()}),a.py.TriggerEvent(a.vo.position),t&&t()):i&&i(),s.EventPoint.lastTriggerTime=0},obj:new s.EpMineView({config:this.c,vo:this.vo})}):i&&i()},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},t);function t(){return null!==i&&i.apply(this,arguments)||this}s.EPMine=e;var a;a=BasePanel,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.inButton(),this.updateView()},n.prototype.inButton=function(){var e=this;this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide(),s.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},this),this.commonTanKuang.blb_title.text="资源矿洞",this.commonTanKuang.onCloseCB=function(){e.hide()}},n.prototype.updateView=function(){var i=this,a=this.params.config,n=this.params.vo;this.lb_desc.text=a.desc,this.img_icon.source=a.icon;var o=JSON.parse(a.rewards)[0],e=s.GeneralConfig.getEntityConfigByCode(o[0],o[1]);e&&(this.img_speed.source=ResourceUtils.png(e.icon),this.img_speed_right.source=ResourceUtils.png(e.icon)),this.lb_speed.text="+"+o[2]+"/"+a.interval+"秒";var t=this.params.vo.position;this.guajiPy.GetMineInfo({pos:{x:t.x,y:t.y},cb:function(){var e=i.guajiPy.minesInfo[0];if(e){var t=0<e.rewards.length?e.rewards[0].num.toString():"0";i.lb_speed_right.text=t+"/"+a.upLimit/a.interval*o[2],n.mineInfo.captured?(i.btn_ok.visible=0<e.rewards.length,i.btn_got.visible=e.rewards.length<=0,i.btn_ok.skinName="skins.ButtonSkinGreen",i.btn_ok.label="领 取",i.btn_status.visible=!1):(i.btn_ok.skinName="skins.ButtonSkinRed",i.btn_ok.label="战 斗",i.btn_status.label="未占领",i.btn_status.visible=!0)}else i.lb_speed_right.text="0"},ispush:!1})};function n(e){var t=a.call(this)||this;return t.guajiPy=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),t.skinName="GuajiMineDetaiPanellSkin",t.params=e,t}}(game=game||{}),function(a){var t,e=(t=a.EventPoint,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},i.prototype.onDataChange=function(){var e=a.Config.riskEvent()[this.vo.eventId];t.prototype.makeDefaultIcon.call(this)||(this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:JSON.parse(e.detail)[2]}),t.prototype.addEffect.call(this))},i.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new a.StoryView({storyId:i.vo.info.storyId,questionId:void 0,position:void 0,cb:function(){i.py.TriggerEvent(i.vo.position,void 0,void 0,i.doneStoryId),e&&e()}}),closeCB:function(e){a.EventPoint.lastTriggerTime=0}})}):t&&t()},i);function i(){return null!==t&&t.apply(this,arguments)||this}a.EPNpc=e}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpPuzzleView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,"1"),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPPuzzle=t}(game=game||{}),function(n){var t,e=(t=n.EventPoint,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},i.prototype.onDataChange=function(){if(this.c=n.Config.riskQuora()[this.vo.info.id],this.c){var e=t.prototype.makeDefaultIcon.call(this);e||(1==(e=n.GeneralConfig.getGuajiImg(this.c.model))[0]?(this.img_icon.source=e[1],this.img_icon.visible=!0):2==e[0]&&(this.cu_model=new customui.HeroDynamicModel,this.cu_model.update({model:e[1],isStatic:!0}),this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model))),t.prototype.addEffect.call(this)}},i.prototype.onTrigger=function(t,e){if(this.checkTriggerCD())if(this.c){var i=n.Config.riskEvent()[this.vo.eventId],a=(JSON.parse(this.c.questions)[this.vo.info.count],i.story?JSON.parse(i.story)[0]:void 0);a&&JSON.parse(n.Config.storyConfig()[a].subs),PopUpManager.addPopUp({obj:new n.EpQuoraView({vo:this.vo,cb:function(e){t&&t()}}),closeCB:function(e){n.EventPoint.lastTriggerTime=0}})}else Utils.MsgUtils.addMidMsg("找不到答题配置");else e&&e()},i);function i(){return null!==t&&t.apply(this,arguments)||this}n.EPQuora=e}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpSameCardView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,"1"),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPSameCard=t}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpSelectView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,String(e)),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPSelect=t}(game=game||{}),function(g){var e,t=(e=g.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},i.prototype.onDataChange=function(){var t=this,e=void 0;this.vo.type==RiskEventType.Shop||this.vo.type==RiskEventType.MysticalShop?(e="_guaji_m_json.bd_shangdian_01",this.vo.info.type==RiskShopType.Normal?this.lb_tips.text="神秘商店":this.lb_tips.text="刷新商店"):(e="_guaji_m_json.bd_jiuguan_01",this.vo.info.type==RiskShopType.Normal?this.lb_tips.text="酒馆":this.lb_tips.text="刷新酒馆"),RES.getResAsync(e,function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2},this),this.popView&&this.popView.updateView(this.vo)},i.prototype.onTrigger=function(t,e){var i=this;this.log("risk当前商店类型"+this.vo.type+"，"+this.vo.info.type),this.checkTriggerCD()?this.handleStory(void 0,function(){i.vo.info.type==RiskShopType.Refresh?i.popView=new y({eventVO:i.vo}):i.vo.type==RiskEventType.Shop?i.popView=new n({eventVO:i.vo}):i.vo.type==RiskEventType.MysticalShop?i.popView=new r({eventVO:i.vo}):i.popView=new c({eventVO:i.vo}),i.py.TriggerEvent(i.vo.position,void 0,function(){g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N).doneStoryId=i.doneStoryId,i.viewShowed=!0,PopUpManager.addPopUp({obj:i.popView,closeCB:function(e){i.viewShowed=!1,t&&t(),g.EventPoint.lastTriggerTime=0}})})}):e&&e()},i.prototype.onDestroy=function(){this.popView&&this.popView.hide()},i);function i(){return null!==e&&e.apply(this,arguments)||this}g.EPShop=t;var a,n=(a=BasePanel,__extends(o,a),o.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.hero_model.update(this.heroData)},o.prototype.adapterShopItems=function(){var e=new eui.HorizontalLayout;e.gap=50,1<this.eventVO.info.items.length?(e.horizontalAlign=egret.HorizontalAlign.LEFT,e.paddingLeft=25,e.paddingRight=25):e.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_items.layout=e},o.prototype.updateView=function(e){var d=this;e&&(this.eventVO=e),this.gp_items.removeChildren(),this.adapterShopItems();var p=g.Config.shop();this.eventVO.info.items.forEach(function(t){var e=p[t.id],i=JSON.parse(e.reward)[0],a=new eui.Group;a.width=112,a.height=185;var n=new eui.Image("mx_img_heiying_png");n.x=-14,n.y=0;var o=customui.BaseItemFactory.create(21);o.updateData({type:i[0],code:i[1],num:i[2]}),o.y=10,o.x=(a.width-o.width)/2;var s=new eui.Button;s.skinName="skins.ButtonSkinYellow2";var r=JSON.parse(e.costs)[0];s.label="  "+Utils.MathUtils.formatNumStyle1(r[2]);var h=g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).getInfoByCode(r[1]);s.icon=ResourceUtils.png(h.info.icon),s.iconDisplay.scaleX=s.iconDisplay.scaleY=.35,s.x=-1,s.y=a.height-s.height;var l=new eui.Image;l.source="common_img_biaoqian_yigoumai_png",l.x=12,l.y=(a.height-l.height)/2-40,l.visible=!1;var c=g.AppFacade.getInstance().retrieveProxy(g.ShopPy.N).getMaxNum(t.id);t.num>=c&&(l.visible=!0,s.touchEnabled=!1,UIActionManager.setGrey(s),UIActionManager.setGrey(o)),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N);d.py.ShopBuy(t.grid,1,d.eventVO.position,function(){e.goCurEPStory(function(){d.parent&&d.updateView(d.eventVO)})})},d),a.addChild(n),a.addChild(o),a.addChild(s),a.addChild(l),d.gp_items.addChild(a)})},o);function o(e){var t=a.call(this)||this;return t.heroData={code:41100018,model:"hero_018_03",isStatic:!0},t.skinName="GuajiShangdianViewSkin",t.py=g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N),t.eventVO=e.eventVO,t}var s,r=(s=BasePanel,__extends(h,s),h.prototype.childrenCreated=function(){var t=this;s.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_discount,egret.TouchEvent.TOUCH_TAP,function(){g.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受神秘商店额外3折优惠",btnStyle:{cancel:g.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:g.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&(t.hide(),g.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard))}})},this)},h.prototype.updateView=function(e){var s=this;e&&(this.eventVO=e);var r=g.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard]&&g.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard].data,h=g.GameMVC.activityPy.hasWholeLifeCard();UIActionManager.setAbsGrey(this.btn_discount,!h),this.btn_discount.enabled=!h;var t=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);this.btn_discount.visible=!t&&!!r,this.lb_discount.visible=!t&&!h&&!!r;var l=g.Config.shop(),c=g.Config.itemConfig();this.gp_items.removeChildren();var d=0;this.eventVO.info.items.forEach(function(e){var t=l[e.id],i={data:t,buyNum:e.num,grid:e.grid,hasWholeLifeCard:g.GameMVC.activityPy.hasWholeLifeCard(),hideDiscount:!0,buyFunc:function(){function t(){s.py.ShopBuy(e.grid,1,s.eventVO.position,function(){g.GameMVC.guajiPy.goCurEPStory(function(){s.parent&&s.updateView(s.eventVO)})})}!h&&r?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受3折优惠，\n是否前往购买？",btnStyle:{confirm:{text:"前往开卡",skin:"skins.ButtonSkinYellow"},cancel:{text:"我意已决",skin:"skins.ButtonSkinGreen"}},clickCB:function(e){e.type?(s.hide(),g.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard)):t()}}):t()}},a=new g.ShopUIItem(i);s.gp_items.addChild(a);var n=JSON.parse(t.reward)[0][1],o=JSON.parse(c[n].effect);d=o.length&&o[0][0]===EEntityType.EEntityTypeHero&&o[0][1]||0}),d&&(this.heroData.code=d),this.hero_model.update(this.heroData),this.timer||(this.timerDt=this.eventVO.dt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.timerDt),this.timer=egret.setInterval(function(){0<s.timerDt?s.blb_time.text=Utils.TimerManager.getFormatBySecond1(--s.timerDt):s.hide()},this,1e3))},h.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},h);function h(e){var t=s.call(this)||this;return t.heroData={code:41100018,isStatic:!0},t.skinName="GuajiMysticalShopViewSkin",t.py=g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N),t.eventVO=e.eventVO,t}var l,c=(l=BasePanel,__extends(d,l),d.prototype.childrenCreated=function(){var e=this;l.prototype.childrenCreated.call(this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex-1<0&&(e.curIndex=e.eventVO.info.items.length),e.curIndex--,e.updateSelected()},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex+1>=e.eventVO.info.items.length&&(e.curIndex=-1),e.curIndex++,e.updateSelected()},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curHeroCode&&g.AppFacade.getInstance().showSubView(g.HeroMediator.N,g.HeroMediator.SV.HERO_DETAIL,{code:e.curHeroCode})},this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N).goCurEPStory(function(){e.py.ShopBuy(e.items[e.curIndex].grid,1,e.eventVO.position,function(){})})},this),this.cu_tk.img_title_bg.visible=this.cu_tk.btn_close.visible=!1},d.prototype.updateSelected=function(){if(this.items[this.curIndex]){var e=g.Config.shop()[this.items[this.curIndex].id];if(e){var t=JSON.parse(e.reward)[0],i=g.GeneralConfig.getEntityConfigByCode(t[0],t[1]);i&&(this.curHeroCode=i.code,this.lb_name.text=i.name,this.lb_desc.text=i.desc,this.img_type.source=ProfessionConfig[i.profession].icon,this.cu_hdm.update({isStatic:!0,model:i.model}),this.cu_iwn.updateItem({cost:JSON.parse(e.costs)[0],style:CommonIconStyle.RIGHT}))}}},d.prototype.updateView=function(e){e&&(this.eventVO=e),this.items=this.eventVO.info.items,this.btn_right.visible=this.btn_left.visible=1<this.items.length,this.updateSelected()},d);function d(e){var t=l.call(this)||this;return t.curIndex=0,t.skinName="GuajiJiuGuanViewSkin",t.py=g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N),t.eventVO=e.eventVO,t}var p,u=(p=g.ShopUIItem2,__extends(f,p),f);function f(){var e=p.call(this)||this;return e.skinName="EPShopItemRenderSkin",e}var m,y=(m=BasePanel,__extends(_,m),_.prototype.onDestroy=function(){this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},_.prototype.childrenCreated=function(){var e=this;m.prototype.childrenCreated.call(this),this.eventVO.type==RiskEventType.Shop?this.cu_tk.blb_title.text="商店":this.cu_tk.blb_title.text="酒馆",this.cu_tk.onCloseCB=function(){e.hide()},this.initUI(),this.updateView()},_.prototype.initUI=function(){this.list_items.itemRenderer=u,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},_.prototype.updateSche=function(){var t=this;this.eventVO.info.type==RiskShopType.Refresh?(this.refreshShopRefreshDt=this.eventVO.info.interval,this.scheCountLeft||(this.scheCountLeft=egret.setInterval(function(){t.lb_time.visible||(t.lb_time.visible=!0);var e=t.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-t.eventVO.info.lastUpdateDt);0<e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e):(t.lb_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0,t.py.GetLayerInfo())},this,1e3))):this.lb_time.visible=!1},_.prototype.updateList=function(){var n=this,e=g.Config.shop(),t=this.eventVO.info.items;this.collect.removeAll();for(var i=0,a=t;i<a.length;i++){var o=a[i],s=e[o.id];s?this.collect.addItem({data:s,vo:o,grid:o.grid,isPopup:s.isPopup,buyNum:o.num,customCB:function(e,t,i,a){g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N).goCurEPStory(function(){n.py.ShopBuy(a,i,n.eventVO.position,function(){})})}}):egret.warn("找不到配置",o.id)}},_.prototype.updateView=function(e){var t=this;e&&(this.eventVO=e),this.updateSche(),this.once(egret.Event.ENTER_FRAME,function(){t.updateList()},this)},_);function _(e){var t=m.call(this)||this;return t.skinName="Guaji9PatchShopViewSkin",t.py=g.AppFacade.getInstance().retrieveProxy(g.GuajiPy.N),t.eventVO=e.eventVO,t}}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpSieveView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,String(e)),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPSieve=t}(game=game||{}),function(i){var t,e=(t=i.EventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow),DragonBoneTools.playOnce({effectName:"common_fbzcguaichuxian",parent:this.gp_foot})},a.prototype.onDataChange=function(){if(this.c=i.Config.stormWarCreep()[this.vo.info.creepCode],this.c&&(t.prototype.makeDefaultIcon.call(this)?this.img_icon.visible=!0:(this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:this.c.model})),0==this.c.difficulty||1==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touying":2==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touyinglan":3==this.c.difficulty&&(this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong"),this.c.difficulty&&!this.gp_foot.getChildByName("difficultySign")&&!this.gp_foot.getChildByName("showSign"))){var e=new eui.Image;e.source="_guaji_m_json.mx_img_jian"+this.c.difficulty,e.y=-70,e.scaleX=e.scaleY=.8,e.horizontalCenter=0,e.name="difficultySign",this.gp_foot.addChild(e)}},a.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},a.prototype.hudongWithEP=function(e){var t=this.gp_foot.getChildByName("showSign");if(e.showSign)if(t)t.visible=!0;else{var i=new eui.Image;i.source="_guaji_m_json.mx_img_gth",i.y=-60,i.name="showSign",this.gp_foot.addChild(i),UIActionManager.douDong(i)}else 0==e.showSign&&t&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"))},a.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().showSubView(i.StormWarMediator.N,i.StormWarMediator.SV.DIALOG,{data:this.vo.info,isCreep:!0}):t&&t()},a);function a(){return null!==t&&t.apply(this,arguments)||this}i.EPStormWarCreep=e}(game=game||{}),function(n){var o,e=(o=n.EventPoint,__extends(t,o),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5,this.img_finish=new eui.Image,this.img_finish.source="_guaji_m_json.mx_img_gth",this.img_finish.visible=!1,this.img_finish.horizontalCenter=0,this.img_finish.y=-100,this.gp_foot.addChild(this.img_finish)},t.prototype.onDataChange=function(){o.prototype.makeDefaultIcon.call(this),o.prototype.addEffect.call(this);var e=this.vo&&this.vo.eventId;if(e){var t=n.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0],a=n.Config.riskEventTask()[i];a?a.progress>this.vo.info.key?this.img_finish.visible=!1:(this.img_finish.visible=!0,UIActionManager.douDong(this.img_finish)):Utils.MsgUtils.addMidMsg("找不到任务配置")}}},t.prototype.onTrigger=function(t,i){var a=this;if(this.checkTriggerCD())switch(this.vo.info.status){case RiskTaskStatus.UnGot:this.py.TriggerEvent(this.vo.position,"1",function(){a.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpTaskView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,String(e)),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})})});break;case RiskTaskStatus.Got:this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpTaskView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,String(e)),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})});break;case RiskTaskStatus.Finish:Utils.MsgUtils.addMidMsg("任务已完成")}else i&&i()},t);function t(){return null!==o&&o.apply(this,arguments)||this}n.EPTask=e}(game=game||{}),function(e){var t,i=(t=e.EventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.canTrigger=!1,this.aStarCost=100},a.prototype.onDataChange=function(){this.lb_tips.text=""+MAP_EP_TYPE_NAME[this.vo.type],this.img_icon.source=""},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EPTips=i}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpTriggerView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPTrigger=t}(game=game||{}),function(n){var e,t=(e=n.EventPoint,__extends(i,e),i.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},i.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},i.prototype.onTrigger=function(t,i){var a=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpUnicursalView({vo:a.vo}),closeCB:function(e){e?(a.py.TriggerEvent(a.vo.position,"1"),t&&t()):i&&i(),n.EventPoint.lastTriggerTime=0}})}):i&&i()},i);function i(){return null!==e&&e.apply(this,arguments)||this}n.EPUnicursal=t}(game=game||{}),function(e){var t,i=(t=e.FadeEventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=1.5,this.img_shadow.bottom=-20*this.img_shadow.scaleX/.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=1,this.gp_foot.addChild(this.cu_model),this.bossInfo=new n,this.bossInfo.horizontalCenter=0,this.gp_foot.addChild(this.bossInfo)},a.prototype.hudongWithEP=function(e){var t=this;e.playDeadAction&&(this.bossInfo.fadeDead(),this.cu_model.egretArmDisplay.animation.timeScale=.25,this.cu_model.changeAction(["shouji"]),egret.setTimeout(function(){t.cu_model.egretArmDisplay?UIActionManager.fadeIn(t.cu_model,500,function(){t.img_shadow.visible=t.bossInfo.visible=t.cu_model.visible=!1,t.cu_model.egretArmDisplay.armature&&(t.cu_model.egretArmDisplay.animation.timeScale=1),e.cb&&e.cb()},!0):e.cb&&e.cb()},this,2e3)),e.appear&&(this.cu_model.egretArmDisplay.animation.timeScale=1,this.img_shadow.visible=this.bossInfo.visible=this.cu_model.visible=!0,UIActionManager.fadeIn(this.cu_model,500))},a.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model&&(this.cu_model.update({isStatic:!0,model:this.c.heroC.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)})),this.once(egret.Event.ENTER_FRAME,function(){e.bossInfo.top=e.cu_model&&-e.cu_model.height*e.cu_model.scaleY-100||-400},this),this.c.hideBossInfo?this.bossInfo.visible=!1:this.bossInfo.updateView(this.c))},a.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},a);function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}e.EPFadeBigBoss=i;var o,n=(o=eui.Component,__extends(s,o),s.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.bi_bossAvatar=customui.BaseItemFactory.create(),this.gp_bossAvatar.addChild(this.bi_bossAvatar),this.pb_bossHpYellow.slideDuration=0,this.pb_bossHpRed.slideDuration=1e3;var n=this;this.pb_bossHpYellow.labelFunction=function(e,t){var i=50;n.params&&n.params.module==MODULE.GuildBoss&&(i=5);var a=(e/t*100).toFixed(2);return Number(a)<i&&0!=Number(a)&&(a="??"),a+"%"}},s.prototype.updateView=function(e){this.params=e,this.bi_bossAvatar.updateData({type:EEntityType.EEntityTypeHero,code:this.params.heroC.code}),this.lb_boss_name.text=this.params.heroC.name,this.pb_bossHpRed.maximum=this.pb_bossHpYellow.maximum=this.params.initHp,this.pb_bossHpRed.value=this.pb_bossHpYellow.value=this.params.hp},s.prototype.fadeDead=function(){this.pb_bossHpRed.value=this.pb_bossHpYellow.value=0},s);function s(){var e=o.call(this)||this;return e.skinName="WorldBossMain_BossInfoSkin",e}}(game=game||{}),function(e){var t,i=(t=e.FadeEventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=1.5,this.img_shadow.bottom=-20*this.img_shadow.scaleX/.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=1,this.gp_foot.addChild(this.cu_model)},a.prototype.onDataChange=function(){var i=this;this.c=this.vo.config,this.c&&(this.cu_model&&!this.c.hideBoss?(this.cu_model.visible=!0,this.cu_model.update({isStatic:!0,model:this.c.heroC.model||"hero_001_01"})):this.cu_model&&(this.cu_model.visible=!1),this.c.effects?(this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.effects.forEach(function(e){var t=e.name;t&&i.addEffect3(i.gp_foot,t,e.params,function(e){i.effects.push({name:t,effect:e,dirty:1})})})):this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}))},a.prototype.addEffect3=function(t,e,i,a){DragonBoneTools.create(e,function(e){e.x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY)),i.rotation&&(e.rotation=i.rotation),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e),e.animation.play(),a&&a(e)},this)},a.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},a);function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e.effects=[],e}e.EPFadeBigBoss2=i}(game=game||{}),function(e){var t,i=(t=e.FadeEventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model)},a.prototype.hudongWithEP=function(e){var t=this;if(e){var i=this.gp_foot.getChildByName("showSign");if(e.showSign)if(i)i.visible=!0;else{var a=new eui.Image;a.source=e.showSign,a.scaleX=a.scaleY=1,a.horizontalCenter=0,a.y=this.cu_model&&-this.cu_model.height*this.cu_model.scaleY||-100,a.name="showSign",this.gp_foot.addChild(a)}else 0==e.showSign&&i&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"));UIActionManager.setAbsGrey(this,e.needGray),e.needGray?(this.canTrigger2=!1,this.cu_model.onArmatureLoadCB=function(e){egret.setTimeout(function(){try{e&&e.armature&&e.animation&&e.animation.stop()}catch(e){}},t,150)}):(this.canTrigger2=!0,this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&this.cu_model.egretArmDisplay.animation&&!this.cu_model.egretArmDisplay.animation.isPlaying&&(this.cu_model.onArmatureLoadCB=function(e){try{e&&e.animation&&e.animation.play("daiji")}catch(e){}}))}},a.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model.update({isStatic:!0,model:this.c.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)}))},a.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},a);function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}e.EPFadeBoss=i}(game=game||{}),function(e){var t,i=(t=e.FadeEventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model)},a.prototype.hudongWithEP=function(e){var t=this;if(e){var i=this.gp_foot.getChildByName("showSign");if(e.showSign)if(i)i.visible=!0;else{var a=new eui.Image;a.source=e.showSign,a.horizontalCenter=0,a.y=this.cu_model&&-this.cu_model.height*this.cu_model.scaleY||-100,a.name="showSign",this.gp_foot.addChild(a)}else 0==e.showSign&&i&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"));UIActionManager.setAbsGrey(this,e.needGray),e.needGray?(this.canTrigger2=!1,this.cu_model.onArmatureLoadCB=function(e){egret.setTimeout(function(){try{e&&e.armature&&e.animation&&e.animation.stop()}catch(e){}},t,150)}):(this.canTrigger2=!0,this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&this.cu_model.egretArmDisplay.animation&&!this.cu_model.egretArmDisplay.animation.isPlaying&&(this.cu_model.onArmatureLoadCB=function(e){try{e&&e.animation&&e.animation.play("daiji")}catch(e){}}))}},a.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model.update({isStatic:!0,model:this.c.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)}))},a.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},a);function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}e.EPFadeCreep=i}(game=game||{}),function(e){var t,i=(t=e.FadeEventPoint,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!0,this.aStarCost=1e5,this.touchChildren=!1},a.prototype.onDataChange=function(){var i=this;this.c=this.vo.config,this.c&&(this.img_icon.source=this.c.source,this.img_icon.scaleX=this.c.iconScaleX||1,this.img_icon.scaleY=this.c.iconScaleY||1,this.c.touchChildren&&(this.touchChildren=!0),this.c.effects?(this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.effects.forEach(function(e){var t=e.name;t&&i.addEffect3(i,t,e.params,function(e){i.effects.push({name:t,effect:e,dirty:1})})})):this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.addictImg&&this.c.addictImg.forEach(function(e){var t=new eui.Image;t.source=e.source,t.x=e.x||0,t.y=e.y||0,i.addChild(t),e.cb&&e.cb(t)}))},a.prototype.addEffect3=function(t,e,i,a){DragonBoneTools.create(e,function(e){e.x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY)),i.rotation&&(e.rotation=i.rotation),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e),e.animation.play(),a&&a(e)},this)},a.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},a);function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.effects=[],e.effectObj=[],e.canTrigger2=!0,e}e.EPFadeIcon=i}(game=game||{}),function(r){var i,e=(i=BasePanel,__extends(t,i),Object.defineProperty(t.prototype,"vo",{get:function(){if(this._data&&this._data.vo)return this._data.vo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){if(this._data)return this._data},set:function(e){this._data=e,this.onDataChanged()},enumerable:!0,configurable:!0}),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data=this._data,this.makeCosts(),this.makeReward(),this.makeBtns(),this.makeGpFree(),this.makeBottomReward(),this.afterAllAdd()},t.prototype.onDataChanged=function(){this._data&&this.makeThreeComponent()},t.prototype.addCallBack=function(e,t,i,a){void 0===a&&(a=-1);var n={cb:e,thiz:t,params:i};-1==a?this.callBackList.push(n):this.callBackList.splice(a,0,n)},t.prototype.callNext=function(e){var t=this.callBackList[0];this.callBackList.shift(),t&&t.cb&&t.cb.call(t.thiz,e||t.params)},t.prototype.makeThreeComponent=function(e){void 0===e&&(e=0);var t=this.data&&this.data.vo&&this.data.vo.eventId,i=r.Config.riskEvent()[t];if(t&&i||e){var a=e||i.descId,n=r.Config.riskEventDesc()[a];if(!n||!a)return;this.lb_title.text=n.title;try{var o=(new egret.HtmlTextParser).parser(n.desc);this.lb_desc.textFlow=o}catch(e){this.lb_desc.text=n.desc}var s=r.GeneralConfig.getGuajiImg(n.img);1==s[0]?this.img_icon.source=s[1]:2==s[0]&&this.HeroDynamicModel.update({model:s[1],isStatic:!0})}},t.prototype.makeCosts=function(){},t.prototype.makeGpFree=function(){},t.prototype.makeBottomReward=function(){this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},t.prototype.removeBottomReward=function(){this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},t.prototype.makeReward=function(){this.gp_rewardParent&&this.gp_rewardParent.parent&&this.gp_rewardParent.parent.removeChild(this.gp_rewardParent)},t.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide()}})},t.prototype.getConfigBtnText=function(e){void 0===e&&(e=0);var t=this.data&&this.data.vo&&this.data.vo.eventId,i=r.Config.riskEvent()[t];if(t&&i){var a=e||i.descId,n=r.Config.riskEventDesc()[a];return n?n&&n.buttonDesc:""}return""},t.prototype.addCost=function(e){for(var t in r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),e){var i=e[t],a=new s({cost:i,needHave:!0});this.gp_costs.addChild(a)}},t.prototype.addBottomReward=function(e){for(var t in e){var i=e[t],a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.8,a.updateData({reward:i}),this.gp_bottomRewardDetail.addChild(a)}},t.prototype.addReward=function(e){for(var t in e){var i=e[t],a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.8,a.updateData({reward:i}),this.gp_reward.addChild(a)}},t.prototype.addBtn=function(e){var t=new eui.Group;t.width=162,t.height=64;var i=0;if(e.costs){var a=e.costs[0],n=new s({cost:a});n.horizontalCenter=0,t.addChild(n),i=55,t.height=119}var o=new eui.Button;return o.skinName="skins.ButtonSkinLabel",o.label=e.text,e.cb&&o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cb&&e.cb.call(e.thiz)},this),o.y=i,o.horizontalCenter=0,t.addChild(o),this.gp_btns.addChild(t),o},t.prototype.afterAllAdd=function(){},t);function t(e){var t=i.call(this)||this;return t._data=void 0,t.callBackList=[],t.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),t.skinName="BaseEpViewSkin",t._data=e,t}r.BaseEpView=e;var a,s=(a=eui.ItemRenderer,__extends(n,a),n.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this);var e=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),t=this.params.cost,i=e.getInfoByCode(t[1]);this.img_icon.source=i.info.icon+"_png",this.params.needHave?this.bm_cost.text=Utils.MathUtils.formatNumStyle1(i.haveNum)+"/"+t[2]:this.bm_cost.text=""+t[2]},n);function n(e){var t=a.call(this)||this;return t.params=e,t.skinName="EPCostItem",t}var o,h=(o=BasePanel,__extends(l,o),Object.defineProperty(l.prototype,"vo",{get:function(){if(this._data&&this._data.vo)return this._data.vo},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"data",{get:function(){if(this._data)return this._data},set:function(e){this._data=e,this.onDataChanged()},enumerable:!0,configurable:!0}),l.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.data=this._data,this.makeReward(),this.makeBtns(),this.gp_img.parent.removeChild(this.gp_img),this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},l.prototype.onDataChanged=function(){this._data&&this.makeThreeComponent()},l.prototype.makeThreeComponent=function(){if(this.data.config){this.lb_title.text=this.data.config.titleFixed||"事件结果";try{var e=JSON.parse(this.data.config.resultDesc)[this.data.order||0],t=(new egret.HtmlTextParser).parser(e);this.lb_desc.textFlow=t}catch(e){this.lb_desc.text=""}}if(this.data.eventId){var i=r.Config.riskEvent()[this.data.eventId];if(i.type==RiskEventType.Trigger2){var a=JSON.parse(i.detail);a[0]!=RiskTrigger2Type.FlipCard&&a[0]!=RiskTrigger2Type.Unicursal&&a[0]!=RiskTrigger2Type.Puzzle||DragonBoneTools.playOnce({effectName:"common_jmcg",parent:this.gp_effect,horizontalCenter:210,verticalCenter:60})}}},l.prototype.makeReward=function(){if(this.data.rewards){var e=this.data.rewards;this.addReward(e)}else this.gp_rewardParent&&this.gp_rewardParent.parent&&this.gp_rewardParent.parent.removeChild(this.gp_rewardParent)},l.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.hide()}})},l.prototype.getConfigBtnText=function(e){return void 0===e&&(e=0),"确定"},l.prototype.addReward=function(e){for(var t in e){var i=e[t];if(i)for(var a in i){var n=i[a],o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.8,o.updateData({code:n.code,num:n.num||1}),this.gp_reward.addChild(o)}}},l.prototype.addBtn=function(e){var t=new eui.Group;t.width=162,t.height=64;var i=0;if(e.costs){var a=e.costs[0],n=new s({cost:a});n.horizontalCenter=0,t.addChild(n),i=55,t.height=119}var o=new eui.Button;o.skinName="skins.ButtonSkinLabel",o.label=e.text,e.cb&&o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cb&&e.cb.call(e.thiz)},this),o.y=i,o.horizontalCenter=0,t.addChild(o),this.gp_btns.addChild(t)},l);function l(e){var t=o.call(this)||this;return t._data=void 0,t.callBackList=[],t.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),t.skinName="BaseEpViewSkin",t._data=e,t}r.BaseEpRewardView=h}(game=game||{}),function(e){var t,i=(t=e.BaseEpView,__extends(a,t),a.prototype.makeBtns=function(){var t=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){egret.setTimeout(function(){t.opperationParams||(t.opperationParams=1,t.hide())},t,4e3),DragonBoneTools.playOnce({horizontalCenter:200,verticalCenter:-100,effectName:"common_bxglx",parent:t.gp_effect}),UIActionManager.addEffect(t.gp_effect,"maoxian_bxg",{offectX:0,offectY:0},function(e){e&&e.animation&&e.animation.play("dakai"),egret.setTimeout(function(){e&&e._armature&&e.animation&&e.animation.play("daiji2")},t,880),egret.setTimeout(function(){e&&e._armature&&e.animation&&e.animation.stop(),t.opperationParams||(t.opperationParams=1,t.hide())},t,2210)})}})},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EpBoxCreepView=i}(game=game||{}),function(e){var t,i=(t=e.BaseEpView,__extends(a,t),a.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide(),e.data.canGet&&e.data.customCB&&e.data.customCB(e.opperationParams)}})},a.prototype.afterAllAdd=function(){this.data.config.type==EPropType.EPropTypeMap&&this.makeThreeComponent(18)},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EpBoxView=i}(game=game||{}),function(a){var e,t=(e=a.BaseEpView,__extends(i,e),i.prototype.makeCosts=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=a.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0];this.addCost(i)}}},i.prototype.makeBtns=function(){var e=this,t=this.data&&this.data.vo&&this.data.vo.eventId;if(t){var i=a.Config.riskEvent()[t];i&&(JSON.parse(i.detail),this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide()}}))}},i.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=a.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[1];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},i);function i(){return null!==e&&e.apply(this,arguments)||this}a.EpCollectView=t}(game=game||{}),function(n){var a,e=(a=n.BaseEpView,__extends(t,a),t.prototype.makeReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=n.Config.riskEvent()[e.eventId];if(t){var i=JSON.parse(t.detail)[1];i?(this.addReward(i),this.lb_desc2.textFlow=[{text:"奖励",style:{textColor:7096888}}]):a.prototype.makeReward.call(this)}else a.prototype.makeReward.call(this)}},t.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=n.Config.riskEvent()[e.eventId];if(t&&t.isShow){var i=JSON.parse(t.detail)[0],a=n.Config.riskCreep()[i];if(a&&a.rewards)return void this.addBottomReward(JSON.parse(a.rewards))}}this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},t);function t(){return null!==a&&a.apply(this,arguments)||this}n.EpCreepView=e}(game=game||{}),function(o){var t,e=(t=o.BaseEpView,__extends(i,t),i.prototype.makeBtns=function(){function e(e){var t="";switch(e){case FingerGameType.Rock:t="拳";break;case FingerGameType.Scissors:t="剪";break;case FingerGameType.Paper:t="布";break;case 4:t="不玩了"}a.addBtn({text:t,cb:function(){4==e?i.hide():i.onBtnTap(e)}})}for(var i=this,a=this,t=1;t<=4;t++)e(t)},i.prototype.onBtnTap=function(e){var a=this;this.selectIndex=e;var t=o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N);this.visible=!1;var n=this.vo.eventId;t.TriggerEvent(this.data.vo.position,e+"",function(i){PopUpManager.addPopUp({obj:new s({x:0,y:0,key:i.key,selfKey:e,cb:function(){if(i.key==a.selectIndex)a.visible=!0;else{a.hide();var e=o.Config.riskEvent()[n],t=o.Config.riskEventDesc()[e.descId];PopUpManager.addPopUp({obj:new o.BaseEpRewardView({config:t,rewards:i.clientReward,order:i.clientReward?0:1})})}}})})},void 0,!0)},i.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=o.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectIndex=0,e}o.EpFingerGameView=e;var a,s=(a=BasePanel,__extends(n,a),n.prototype.childrenCreated=function(){var i=this;this.gp_effect.width=this.gp_effect.parent.width,this.gp_effect.height=this.gp_effect.parent.height,DragonBoneTools.playOnce({effectName:"common_caiquan",parent:this.gp_effect,x:this.params.x||this.gp_effect.width/2,y:this.params.y||this.gp_effect.height/2,doneCB:function(){var e,t="";switch(i.params.selfKey){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}switch((e=new eui.Image(t)).verticalCenter=-100,e.left=0,i.gp_content.addChild(e),parseInt(i.params.key)){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}(e=new eui.Image(t)).verticalCenter=-100,e.right=0,e.scaleX=-1,i.gp_content.addChild(e),egret.setTimeout(function(){i.hide(),i.params.cb&&i.params.cb()},i,1500)}})},n);function n(e){var t=a.call(this)||this;return t.skinName="EPEffectView",t.params=e,t}}(game=game||{}),function(e){var t,i=(t=e.BaseEpView,__extends(a,t),a.prototype.makeBtns=function(){var t=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){PopUpManager.addPopUp({obj:new o,closeCB:function(e){t.opperationParams=e,t.hide()}})}})},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EpFlipCardView=i;var n,o=(n=e.BaseEpView,__extends(s,n),s.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_img.removeChildren()},s.prototype.makeGpFree=function(){},s);function s(){return null!==n&&n.apply(this,arguments)||this}e.EpFlipCardView2=o}(game=game||{}),function(e){var t,i=(t=e.BaseEpView,__extends(a,t),a.prototype.childrenCreated=function(){if(t.prototype.childrenCreated.call(this),this.data&&this.data.vo&&this.data.vo.info&&this.data.vo.info.clear){var e=new eui.Image("zd_img_yitongguan_png");e.scaleX=e.scaleY=1.5,e.left=e.top=-70,e.rotation=-30,this.gp_main.addChild(e)}},a);function a(){return null!==t&&t.apply(this,arguments)||this}e.EPFortressView=i}(game=game||{}),function(h){var e,t=(e=h.BaseEpView,__extends(i,e),i.prototype.makeBtns=function(){var t=this,e=this.vo.eventId,i=h.Config.riskEvent()[e],a=void 0;if(e&&i){var n=JSON.parse(i.detail);a=n[2]}function o(e){s.addBtn({text:e==GuessSizeType.Big?"大":"小",cb:function(){t.btnCallBack(e)},costs:a})}for(var s=this,r=1;r<=2;r++)o(r)},i.prototype.makeCosts=function(){},i.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=h.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},i.prototype.btnCallBack=function(e){var t=this,i=h.AppFacade.getInstance().retrieveProxy(h.GuajiPy.N),a=this.vo.eventId;i.TriggerEvent(this.data.vo.position,e.toString(),function(i){t.hide(),i.key,PopUpManager.addPopUp({obj:new n({x:0,y:0,key:i.key,cb:function(){var e=h.Config.riskEvent()[a],t=h.Config.riskEventDesc()[e.descId];PopUpManager.addPopUp({obj:new h.BaseEpRewardView({config:t,rewards:i.clientReward,order:i.clientReward?0:1})})}})})},void 0,!0)},i);function i(){return null!==e&&e.apply(this,arguments)||this}h.EpGuessSizeView=t;var a,n=(a=BasePanel,__extends(o,a),o.prototype.childrenCreated=function(){var t=this;DragonBoneTools.playOnce({effectName:"common_105100",parent:this.gp_effect,x:this.params.x||this.gp_effect.width/2,y:this.params.y||this.gp_effect.height/2,doneCB:function(){var e=new eui.Image("maoxian_icon_shaizi"+t.params.key+"_png");e.horizontalCenter=e.verticalCenter=0,t.gp_content.addChild(e),egret.setTimeout(function(){t.hide(),t.params.cb&&t.params.cb()},t,1500)}})},o);function o(e){var t=a.call(this)||this;return t.skinName="EPEffectView",t.params=e,t}}(game=game||{}),function(l){var e,t=(e=l.BaseEpView,__extends(i,e),i.prototype.makeCosts=function(){var e=this.data.vo;if(e.info&&e.info.captured){var t=this.data.config,i=JSON.parse(t.rewards)[0],a=l.GeneralConfig.getEntityConfigByCode(i[0],i[1]);if(a){var n=new eui.Group,o=new eui.HorizontalLayout;o.verticalAlign=egret.VerticalAlign.MIDDLE,o.horizontalAlign=egret.HorizontalAlign.CENTER,n.layout=o;var s=new eui.Image(ResourceUtils.png(a.icon));s.scaleX=s.scaleY=.5;var r=new eui.Label;r.text="效率：",r.size=20,r.textColor=7096888;var h=new eui.BitmapLabel;-1!=[RiskMineType.Artifact,RiskMineType.Equip].indexOf(t.type)?h.text="概率产出":h.text="+"+i[2]+"/"+t.interval+"s",h.font="white_num_fnt",n.addChild(r),n.addChild(s),n.addChild(h),this.gp_costs.addChild(n)}}else this.gp_costs.removeChildren()},i.prototype.makeBtns=function(){var e=this,t=this.data.vo,i=this.getConfigBtnText();t.info&&t.info.captured&&(i=this.getConfigBtnText(this.getForceId())),this.addBtn({text:i,cb:function(){t.info&&t.info.captured||(e.opperationParams=1,egret.setTimeout(function(){l.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},e,300)),e.hide()}})},i.prototype.getForceId=function(){var e=this.data.vo.eventId,t=l.Config.riskEvent()[e],i=JSON.parse(t.detail),a=l.Config.riskMine()[i],n=16;if(a)switch(a.type){case 1:n=16;break;case 2:n=14;break;case 3:n=17;break;case 4:n=15;break;case 5:n=41;break;case 6:n=40;break;case 7:n=92;break;case 8:n=93;break;case 9:n=94}return n},i.prototype.afterAllAdd=function(){var e=this.data.vo;e.info&&e.info.captured&&this.makeThreeComponent(this.getForceId())},i);function i(){return null!==e&&e.apply(this,arguments)||this}l.EpMineView=t}(game=game||{}),function(r){var h,e=(h=r.BaseEpView,__extends(n,h),n.prototype.childrenCreated=function(){var e=this,t=this.data&&this.data.vo&&this.data.vo.eventId;if(t){var i=r.Config.riskEvent()[t];if(i){var a=JSON.parse(i.detail),n=(a[0],a[1]),o=r.Config.riskEventUnicursal()[n],s=JSON.parse(o.detail);this.colCount=s[0],this.rowCount=s[1],this.imgRoot="_guaji_pt_m_json."+s[2],this.curConfig=s[3],this.emptyItem=[this.rowCount,this.colCount,0],h.prototype.childrenCreated.call(this),this.gp_img.removeChildren(),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.perClose()},this)}}},n.prototype.makeGpFree=function(){var e=new eui.Image;e.source="common_img_jichukuang_12_png",e.top=-10,e.bottom=-10,e.left=-10,e.right=-10,e.scale9Grid=new egret.Rectangle(20,17,15,17),this.gp_free.addChild(e),this.loadConfig()},n.prototype.loadConfig=function(){var h=this,l=JSON.parse(Utils.LocalStorageUtil.getItem("guaji_pt_"+this.data.vo.eventId));function e(e){var t=parseInt(e)+1,i=l[e],a=new eui.Image,n=t%c.colCount?t%c.colCount:c.colCount,o=Math.floor((t-1)/c.colCount)+1;0==i&&(c.emptyItem=[o,n,0]),a.data=[o,n,i,o,n];var s=c.imgRoot+"_"+(i<=9?"0"+i:i);if(0==i){var r=c.colCount*c.rowCount;s=c.imgRoot+"_"+(r<=9?"0"+r:r),a.alpha=0}RES.getResAsync(s,function(e){if(e){var t=(a.source=e).textureWidth,i=e.textureHeight;a.x=(n-1)*t+(n-1)*h.gap,a.y=(o-1)*i+(o-1)*h.gap}},c),c.gp_free.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){h.touchItem||(h.touchPoint=[e.stageX,e.stageY],h.touchItem=e.target.data)},c),a.addEventListener(egret.TouchEvent.TOUCH_END,function(e){var t=e.target.data;h.touchItem&&h.touchItem[0]==t[0]&&h.touchItem[1]==t[1]&&h.oneMove([e.stageX,e.stageY])},c),a.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(e){var t=e.target.data;h.touchItem&&h.touchItem[0]==t[0]&&h.touchItem[1]==t[1]&&h.oneMove([e.stageX,e.stageY])},c)}l&&0!=l.length||(l=this.curConfig);var c=this;for(var t in l)e(t)},n.prototype.oneMove=function(e){var t=[];(e[0]-this.touchPoint[0])*(e[0]-this.touchPoint[0])+(e[1]-this.touchPoint[1])*(e[1]-this.touchPoint[1])<=2025?t=[n.DIR.DOWN,n.DIR.UP,n.DIR.LEFT,n.DIR.RIGHT]:(e[0]>this.touchPoint[0]?t.push(n.DIR.RIGHT):t.push(n.DIR.LEFT),e[1]>this.touchPoint[1]?t.push(n.DIR.DOWN):t.push(n.DIR.UP)),0<t.length?(this.switchItemByDir(this.touchItem,t),this.moveCount++,3<=this.moveCount&&(this.saveCash(),this.moveCount=0)):this.touchItem=void 0},n.prototype.switchItemByDir=function(e,t){void 0===t&&(t=[]);var i=n.DIR.NOTHING;if(e[0]==this.emptyItem[0]&&(0<e[1]-1&&e[1]-1==this.emptyItem[1]&&(i=n.DIR.LEFT),e[1]+1<=this.colCount&&e[1]+1==this.emptyItem[1]&&(i=n.DIR.RIGHT)),e[1]==this.emptyItem[1]&&(0<e[0]-1&&e[0]-1==this.emptyItem[0]&&(i=n.DIR.UP),e[0]+1<=this.rowCount&&e[0]+1==this.emptyItem[0]&&(i=n.DIR.DOWN)),i!=n.DIR.NOTHING&&0<=t.indexOf(i)){var a=[e[0],e[1],0];this.switchTwoItem(e,this.emptyItem),this.emptyItem=a}this.touchItem=void 0},n.prototype.makeBtns=function(){var t=this;this.addBtn({text:"重置",cb:function(){r.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定重置",clickCB:function(e){1==e.type&&t.superReset()}})}});var e=this.addBtn({text:"预览"});e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.showOrigin()},this),e.addEventListener(egret.TouchEvent.TOUCH_END,function(){t._reset()},this),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t._reset()},this)},n.prototype._reset=function(){for(var e=this.gp_free.$children,t=1;t<e.length;t++){var i=e[t],a=i.data,n=a[0],o=a[1];i.x=(o-1)*i.width+(o-1)*this.gap,i.y=(n-1)*i.height+(n-1)*this.gap}this.inOrigin=!1},n.prototype.superReset=function(){for(var e=this.curConfig,t=this.gp_free.$children,i=1;i<t.length;i++){var a=t[i],n=a.data,o=n[2],s=n[3],r=n[4];for(var h in e){var l=parseInt(h)+1;if(e[h]==o){r=l%this.colCount?l%this.colCount:this.colCount,s=Math.floor((l-1)/this.colCount)+1;break}}0==o&&(this.emptyItem=[s,r,0]),a.data[0]=s,a.data[1]=r,a.x=(r-1)*a.width+(r-1)*this.gap,a.y=(s-1)*a.height+(s-1)*this.gap}this.inOrigin=!1},n.prototype.showOrigin=function(){for(var e=this.gp_free.$children,t=1;t<e.length;t++){var i=e[t],a=i.data[2]||this.colCount*this.rowCount,n=a%this.colCount?a%this.colCount:this.colCount,o=Math.floor((a-1)/this.colCount)+1;i.x=(n-1)*i.width+(n-1)*this.gap,i.y=(o-1)*i.height+(o-1)*this.gap}this.inOrigin=!0},n.prototype.switchTwoItem=function(e,t){var i=this,a=this.getGpChild(e),n=this.getGpChild(t);if(a&&n){var o=a.x,s=n.x,r=a.y,h=n.y;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(a).to({x:s,y:h},300).call(function(){i.checkSucceed(function(e){GameRootLayer.gameLayer().switchTouchEnable(!0),e&&(i.opperationParams=1,i.hide())})},this),egret.Tween.get(n).to({x:o,y:r},300);var l=[e[0],e[1]];a.data[0]=t[0],a.data[1]=t[1],n.data[0]=l[0],n.data[1]=l[1]}},n.prototype.getGpChild=function(e){for(var t=this.gp_free.$children,i=1;i<t.length;i++){var a=t[i],n=a.data;if(n[0]==e[0]&&n[1]==e[1])return a}},n.prototype.checkSucceed=function(e){if(this.inOrigin)return!1;for(var t=!0,i=this.gp_free.$children,a=1;a<i.length;a++){var n=i[a].data;(n[0]-1)*this.colCount+n[1]!=(n[2]||this.colCount*this.rowCount)&&(t=!1)}if(t){var o=this.getGpChild(this.emptyItem);o&&egret.Tween.get(o).to({alpha:1},500).wait(500).call(function(){e&&e(1)})}else e&&e(0)},n.prototype.saveCash=function(){for(var e=[],t=this.gp_free.$children,i=1;i<t.length;i++){var a=t[i].data;e.push(a)}e.sort(function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]!=t[1]?e[1]-t[1]:0});var n=[];e.forEach(function(e){n.push(e[2])}),Utils.LocalStorageUtil.setItem("guaji_pt_"+this.data.vo.eventId,JSON.stringify(n))},n.prototype.perClose=function(){this.saveCash()},n.prototype.makeBottomReward=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=r.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.addBottomReward(i[0])}}},n.DIR={NOTHING:0,AUTO:1,UP:2,DOWN:3,LEFT:4,RIGHT:5},n);function n(){var e=null!==h&&h.apply(this,arguments)||this;return e.rowCount=1,e.colCount=1,e.emptyItem=[3,3,0],e.imgRoot="",e.gap=10,e.inOrigin=!1,e.moveCount=0,e}r.EpPuzzleView=e}(game=game||{}),function(h){var s,e=(s=h.BaseEpView,__extends(t,s),t.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.updateView()},t.prototype.makeBtns=function(){var n=this,e=this.data.vo.info.id,t=h.Config.riskQuora()[e],i=JSON.parse(t.questions)[this.data.vo.info.count||0],o=i&&h.Config.questionConfig()[i],a=JSON.parse(o.answer),s=void 0;o.backIsAnswer&&(a.push(o.backIsAnswer),s=a.length-1),a.forEach(function(e,t){var i=s==t,a={index:t,answer:e,isFade:i,position:n.data.vo.position,question:o};n.addBtn({text:e,cb:function(){if(a.isFade)n.callNext({order:parseInt(a.index)+1,isFade:i});else{var e=[];if(a.question.costs&&(e=JSON.parse(a.question.costs)[parseInt(a.index)]),e&&!h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).checkEnough(e,!0))return;n.callNext({order:parseInt(a.index)+1,isFade:i})}}})})},t.prototype.afterAllAdd=function(){var e=this;if(this.data&&this.data.vo&&this.data.vo.info&&this.data.vo.info.id){var t=this.data.vo.info.id,i=h.Config.riskQuora()[t],a=h.Config.riskEvent()[this.vo.eventId],n=JSON.parse(i.questions)[this.data.vo.info.count],o=n&&h.Config.questionConfig()[n],s=a.story?JSON.parse(a.story)[0]:void 0,r=s&&JSON.parse(h.Config.storyConfig()[s].subs);r&&r[0]&&this.addCallBack(this.handleStory,this,{storyId:s}),this.addCallBack(function(){e.visible=!0},this),o.story&&this.addCallBack(this.handleStory,this),this.addCallBack(this.callServer,this),this.callNext()}else this.hide()},t.prototype.handleStory=function(e){var t=this;this.visible=!1;var i=this.data.vo.info.id,a=h.Config.riskQuora()[i],n=JSON.parse(a.questions)[this.data.vo.info.count],o=n&&h.Config.questionConfig()[n],s=JSON.parse(o.story);PopUpManager.addPopUp({obj:new h.StoryView({storyId:e.storyId||s[e.order-1],questionId:void 0,position:void 0,cb:function(){t.callNext(e)}})})},t.prototype.callServer=function(e){var i=this;e.isFade?this.hide():(this.vo.eventId,h.AppFacade.getInstance().retrieveProxy(h.GuajiPy.N).Answer(e.order,this.data.vo.position,function(e,t){PopUpManager.addPopUp({obj:new h.BaseEpRewardView({config:i.questionConfig,rewards:t,order:e-1})}),i.hide()},!1))},t.prototype.makeThreeComponent=function(){if(this.data&&this.data.vo&&this.data.vo.info){s.prototype.makeThreeComponent.call(this);var e=this.data.vo.info.id,t=h.Config.riskQuora()[e],i=JSON.parse(t.questions)[this.data.vo.info.count],a=i&&h.Config.questionConfig()[i];if(this.questionConfig=a){this.lb_title.text=a.title;try{var n=(new egret.HtmlTextParser).parser(a.question);this.lb_desc.textFlow=n}catch(e){this.lb_desc.text=a.question}try{var o=h.GeneralConfig.getGuajiImg(a.img);1==o[0]?this.img_icon.source=o[1]:2==o[0]&&this.HeroDynamicModel.update({model:o[1]})}catch(e){console.log(e)}}}},t.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=this.data.vo.info.id,i=h.Config.riskQuora()[t],a=h.Config.riskEvent()[e.eventId],n=JSON.parse(i.questions)[this.data.vo.info.count],o=n&&h.Config.questionConfig()[n];if(o&&1==a.isShow){var s=JSON.parse(o.rewards);for(var r in s)s[r]&&0<s[r].length&&this.addBottomReward(s[r])}else this.removeBottomReward()}},t);function t(){return null!==s&&s.apply(this,arguments)||this}h.EpQuoraView=e}(game=game||{}),function(_){var t,e=(t=_.BaseEpView,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.makeThreeComponent()},i.prototype.makeThreeComponent=function(){if(this.isCreateComplete){this.lb_title.text="英雄招募";var e=_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){this.HeroDynamicModel.update({isStatic:!0,code:41050009});var t=_.Config.heroAndPetUpstarConfig()[41050009],i=t&&t.nextCode;this.makeSkills(i)}}},i.prototype.makeSkills=function(e){var s=this,r=_.Config.allHeroConfig()[e];if(r){function t(e){var t=SKILL_CODE[e],i=h["skill_"+e],a=r[t];if(t){var n={code:a,unlock:!0,notNeedLevel:!0};h["skill_"+e].updateItem(n)}else h["skill_"+e].updateItem();var o=i;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a&&(s.skill_panel.visible=!0,s.skill_panel.updateItem({code:a}))},h),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){s.skill_panel.visible=!1},h),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){s.skill_panel.visible=!1},h),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){s.skill_panel.visible=!1},h)}r.posSkill1,r.posSkill2,r.posSkill3;for(var h=this,i=1;i<=4;i++)t(i)}},i.prototype.makeBtns=function(){var t=this,i=_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N),e=i.allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){for(var a=JSON.parse(e.content),n=JSON.parse(e.data.rechargeTargeted),o=e.data.rewardTargeted,s=e.data.key,r=!1,h=0,l=0;l<3;l++){var c=a[l+0],d=c[0],p=(c[1],c[2]),g=(c[3],c[4]),u=REWARD_STATUS.UNAVAILABLE;p<=s&&(u=REWARD_STATUS.AVAILABLE),0<=o.indexOf(d)&&(u=REWARD_STATUS.RECEIVED);var f=0;for(var m in n){var y=n[m];y[0]==p&&(f=y[1])}switch(f<g&&(u=REWARD_STATUS.UNAVAILABLE),u){case REWARD_STATUS.UNAVAILABLE:break;case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.RECEIVED:h=d,r=!0}if(h)break}this.gp_btns.removeChildren(),r?this.addBtn({text:"领取",cb:function(){Utils.Socket.send("activity","GetFirstRechargeReward",{id:h,code:EActivityType.FirstRecharge1}).then(function(e){i.updateData_View_Reward(EActivityType.FirstRecharge1,e),_.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),t.hide()})}}):(this.addBtn({text:"考虑一下",cb:function(){t.hide()}}),this.addBtn({text:"花点小钱",cb:function(){_.MainJumpConfig.jumpTo(MODULE.Recharge),t.hide()}}))}},i);function i(){var e=t.call(this)||this;return e.skinName="EpRechargeView",e}_.EpRechargeView=e}(game=game||{}),function(p){var t,e=(t=p.BaseEpView,__extends(i,t),i.prototype.makeBtns=function(){var i=this;this.gp_free.removeChildren(),this.gp_img.visible=!1;var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=p.Config.riskEvent()[e];if(t){var a=JSON.parse(t.detail),n=(a[0],a[1]),o=JSON.parse(p.Config.riskEventUnicursal()[n].detail);o[2].sort(function(e,t){return.5<Math.random()?-1:1}),this.gp_img&&this.gp_img.parent&&this.gp_img.parent.removeChild(this.gp_img);var s=new eui.Group;s.width=120*o[1],s.height=160*o[0],s.horizontalCenter=0,s.verticalCenter=0,this.gp_free.addChild(s),this.cardList=[],this.showCardList=[],this.isCanTouch=!0;for(var r=this.successNum=0,h=0;h<o[1];h++){function l(e){var t=new g(o[2][r]);t.x=t.width*h+80-s.width/2,t.y=t.height*e+80-s.height/2,t.name=o[2][r],t.cardID=r,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.isCanTouch&&!t.isShow&&(i.isCanTouch=!1,i.updateCardListInfo(t))},c),s.addChild(t),c.cardList.push(t),r++}for(var c=this,d=0;d<o[0];d++)l(d)}}}},i.prototype.updateCardListInfo=function(e){var t=this;e.runCardAction();var i=!1;if(0==this.showCardList.length)return this.showCardList.push(e),void(this.isCanTouch=!0);for(var a in this.showCardList)this.showCardList[a].name==e.name&&this.showCardList[a].cardID!=e.cardID&&(i=!0,this.showCardList=[],this.successNum++);egret.setTimeout(function(){if(!i){for(var e in t.cardList)t.cardList[e].initCard();t.showCardList=[],t.successNum=0}t.isCanTouch=!0},this,500),6==this.successNum&&this.cardSuccess()},i.prototype.cardSuccess=function(){var e=this;egret.setTimeout(function(){e.opperationParams=1,e.hide()},this,500)},i.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=p.Config.riskEvent()[e.eventId];if(t.isShow,t&&1==t.isShow){var i=JSON.parse(t.detail)[2][0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectIndex=0,e.cardList=[],e.isCanTouch=!0,e.showCardList=[],e.successNum=0,e}p.EpSameCardView=e;var a,g=(a=BasePanel,__extends(n,a),n.prototype.childrenCreated=function(){},n.prototype.runCardAction=function(){this.isShow=!0,egret.Tween.get(this.img_normal).to({scaleX:0},150).call(function(){this.img_normal.visible=!1},this),egret.Tween.get(this.gp_result).to({scaleX:1},150).call(function(){this.gp_result.visible=!0},this).wait(200)},n.prototype.initCard=function(){this.isShow=!1,egret.Tween.get(this.gp_result).to({scaleX:0},150).call(function(){this.gp_result.visible=!1},this),egret.Tween.get(this.img_normal).to({scaleX:1},150).call(function(){this.img_normal.visible=!0},this).wait(200)},n);function n(e){var t=a.call(this)||this;return t.isShow=!1,t.skinName="EPSameCardView",t.cardID=e,t.config=p.Config.riskEventUnicursal()[1001],t.img_Item.source=e+"_png",t.img_normal.scaleX=1,t.img_normal.scaleY=1,t.img_normal.visible=!0,t.gp_result.scaleX=0,t.gp_result.scaleY=1,t.gp_result.visible=!1,t}}(game=game||{}),function(h){var t,e=(t=h.BaseEpView,__extends(i,t),i.prototype.makeReward=function(){var o=this,e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=h.Config.riskEvent()[e];if(t){function i(e){var t=s[e],i=new eui.Group;i.width=i.height=118,t.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.touchEnabled=!1,t.horizontalCenter=t.verticalCenter=0,i.addChild(t)});var a=h.GeneralConfig.getEntityConfigByCode(t[0][0],t[0][1]);"0"==e&&r.updateLabel(a.name+"×"+Utils.MathUtils.formatNumStyle1(t[0][2])),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.imgList[o.seleceIndex]&&(o.imgList[o.seleceIndex].visible=!1),o.seleceIndex=parseInt(e),o.imgList[o.seleceIndex]&&(o.imgList[o.seleceIndex].visible=!0),o.updateLabel(a.name+"×"+Utils.MathUtils.formatNumStyle1(t[0][2]))},r);var n=new eui.Image("common_img_touxiangxuanzhon_png");n.horizontalCenter=n.verticalCenter=0,n.visible=!1,n.scaleX=n.scaleY=1.05,i.addChild(n),r.imgList.push(n),i.scaleX=i.scaleY=.8,r.gp_reward.addChild(i)}var s=JSON.parse(t.detail),r=this;for(var a in s)i(a);this.imgList[this.seleceIndex]&&(this.imgList[this.seleceIndex].visible=!0)}}},i.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=e.seleceIndex+1,e.hide()},thiz:this})},i.prototype.updateLabel=function(e){this.lb_desc2.textFlow=[{text:"你选择了  ",style:{textColor:7096888}},{text:e,style:{textColor:1865435}}]},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.imgList=[],e.seleceIndex=0,e}h.EpSelectView=e}(game=game||{}),function(l){var t,e=(t=l.BaseEpView,__extends(i,t),i.prototype.rand=function(){return this.POOLS[Utils.MathUtils.getRandomInt(0,this.POOLS.length-1)]},i.prototype.afterAllAdd=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=l.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.gp_cups=new Array,this.gp_img.parent.removeChild(this.gp_img);var a=this.gp_free;a.width=460,a.height=360;for(var n=0;n<3;n++){var o=new eui.Group;o.width=131,o.height=165;var s=customui.BaseItemFactory.create();s.updateData({reward:i[n][0]});var r=new eui.Image("maoxian_img_touzhong_png"),h=new eui.Image("maoxian_img_touzhongdi_png");s.x=29,s.y=55,s.scaleX=s.scaleY=.7,r.x=7,r.y=0,h.x=0,h.y=76,r.userdata_index=n,o.userdata_img=r,o.addChild(h),o.addChild(s),o.addChild(r),o.x=this.POS[n][0],o.y=this.POS[n][1],Utils.ComponentUtils.registerListener(r,egret.TouchEvent.TOUCH_TAP,this.click,this),a.addChild(o),this.gp_cups.push(o)}}}},i.prototype.taiQiOrHeShang=function(e,t,i){if(void 0===t&&(t=!1),null!=e)egret.Tween.get(this.gp_cups[e].userdata_img).to({y:t?0:-100},500,egret.Ease.sineInOut).call(function(){i&&i()});else for(var a=0,n=this.gp_cups;a<n.length;a++){var o=n[a];egret.Tween.get(o.userdata_img).to({y:t?0:-100},500,egret.Ease.sineInOut)}},i.prototype.click=function(e){var t=this;if(this.canChose){var i=e.target.userdata_index;this.canChose=!1,this.taiQiOrHeShang(i,void 0,function(){t.opperationParams=i+1,t.hide()})}},i.prototype.swap=function(e,t,i){var a=this;i/=this.SWAP_SPEED_SCALE,egret.Tween.get(e).to({x:t.x,y:t.y},i,egret.Ease.sineInOut),0<this.SWAP_SPEED.length?egret.Tween.get(t).to({x:e.x,y:e.y},i,egret.Ease.sineInOut).call(function(){var e=a.rand();a.swap(a.gp_cups[e[0]],a.gp_cups[e[1]],a.SWAP_SPEED.shift())}):(egret.Tween.get(t).to({x:e.x,y:e.y},i,egret.Ease.sineInOut),this.canChose=!0)},i.prototype.makeBtns=function(){var t=this;this.addBtn({text:"开 始",cb:function(){t.gp_btns.visible=!1,t.taiQiOrHeShang(),t.scheId=egret.setTimeout(function(){t.taiQiOrHeShang(void 0,!0),t.scheId=egret.setTimeout(function(){var e=t.rand();t.swap(t.gp_cups[e[0]],t.gp_cups[e[1]],t.SWAP_SPEED.shift())},t,1e3)},t,1500)}})},i.prototype.onDestroy=function(){if(this.scheId){egret.clearTimeout(this.scheId);for(var e=0,t=this.gp_cups;e<t.length;e++){var i=t[e];egret.Tween.removeTweens(i)}}},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.seleceIndex=0,e.POS=[[35,200],[300,200],[165,40]],e.SWAP_SPEED=[500,500,500,500,500,400,400,400,400,300,300,300,300,300],e.SWAP_SPEED_SCALE=1.5,e.POOLS=[[0,1],[0,2],[1,0],[1,2],[2,0],[2,1]],e.canChose=!1,e}l.EpSieveView=e}(game=game||{}),function(h){var r,e=(r=h.BaseEpView,__extends(t,r),t.prototype.childrenCreated=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=h.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0],a=h.Config.riskEventTask()[i];if(a){r.prototype.childrenCreated.call(this),this.gp_img.removeChildren(),this.lb_desc2.text="奖励",this.lb_desc2.textColor=7096888;var n=a.progress,o="("+this.data.vo.info.key+"/"+n+")";this.lb_desc.textFlow=[{text:"[任务目标]：",style:{textColor:11222333}},{text:a.name,style:{textColor:7096888}},{text:o,style:{textColor:7096888}},{text:"\n",style:{textColor:7096888}},{text:"\n",style:{textColor:7096888}},{text:"[任务内容]：",style:{textColor:11222333}},{text:a.desc,style:{textColor:7096888}}],this.lb_desc.textAlign=egret.HorizontalAlign.LEFT;var s=JSON.parse(a.rewards);this.addReward(s),this.gp_height.height=10,this.updateBtn()}else Utils.MsgUtils.addMidMsg("找不到任务配置")}}},t.prototype.makeReward=function(){},t.prototype.updateBtn=function(){var e=this;this.gp_btns.removeChildren();var t="",i=void 0,a=this.data&&this.data.vo&&this.data.vo.eventId;if(a){var n=h.Config.riskEvent()[a];if(n){var o=JSON.parse(n.detail)[0],s=h.Config.riskEventTask()[o];if(s){var r=s.progress;switch(this.vo.info.status){case RiskTaskStatus.UnGot:t="领取任务",i=function(){h.GameMVC.guajiPy.TriggerEvent(e.data.vo.position,"1",function(){e.updateBtn()})};break;case RiskTaskStatus.Got:r&&(i=r<=this.data.vo.info.key?(t="领取",function(){e.opperationParams=1,e.hide()}):(t="前往",function(){e.opperationParams=0,e.hide(),h.MainJumpConfig.jumpTo(s.jumpModule)}));break;case RiskTaskStatus.Finish:this.hide(),Utils.MsgUtils.addMidMsg("任务已完成")}this.addBtn({text:t,cb:i})}else Utils.MsgUtils.addMidMsg("找不到任务配置")}}},t);function t(){return null!==r&&r.apply(this,arguments)||this}h.EpTaskView=e}(game=game||{}),function(c){var t,e=(t=c.BaseEpView,__extends(i,t),i.prototype.makeBtns=function(){var n=this,e=this.data&&this.data.vo&&this.data.vo.eventId,t=c.Config.riskEvent()[e];if(t){function i(i){var e=r[i],a=new eui.Button;a.skinName="skins.ButtonSkinLabel",a.label=e,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(parseInt(i)+1==s[n.curSequenceIndex])n.curSequenceIndex++,a.currentState="down",a.touchEnabled=!1,n.curSequenceIndex==s.length&&(n.opperationParams=1,n.hide());else for(var e in n.curSequenceIndex=0,n.gp_btns.$children){var t=n.gp_btns.$children[e];t&&(t.currentState="up"),t&&(t.touchEnabled=!0)}},h),h.gp_btns.addChild(a)}var a=c.Config.riskEventDesc()[t.descId],o=JSON.parse(t.detail),s=o[1],r=(o[0],JSON.parse(a.buttonDesc)),h=this;for(var l in r)i(l)}},i.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=c.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSequenceIndex=0,e}c.EpTriggerView=e}(game=game||{}),function(s){var r,t=(r=s.BaseEpView,__extends(h,r),h.prototype.childrenCreated=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=s.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail),a=(i[0],i[1]),n=s.Config.riskEventUnicursal()[a],o=JSON.parse(n.detail);this.colCount=o[0],this.rowCount=o[1],this.curConfig=o[2],r.prototype.childrenCreated.call(this)}}},h.prototype.makeGpFree=function(){var r=this,e=new eui.TileLayout;function t(e){var t=a.curConfig[e],i=new n;0==(i.data=t)[2]&&(a.beginItem=t),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){r.onTouchItem(t)},a),a.gp_free.addChild(i),t[2]!=h.BLOCK_STATUS.CANT_PASS&&a.targetLength++}e.requestedColumnCount=this.colCount,e.horizontalAlign="center",e.verticalAlign="middle",e.verticalGap=e.horizontalGap=18,this.gp_free.layout=e,this.gp_img.parent.removeChild(this.gp_img);var a=this;for(var i in this.curConfig)t(i);this.reset(),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){r.touchBegin=!0},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){var t=r.gp_free.$children,i=r.gp_free.globalToLocal(e.stageX,e.stageY),a=i.x,n=i.y;for(var o in t){var s=t[o];if(a>=s.x&&a<=s.x+s.width&&n>=s.y&&n<=s.y+s.height)return void s.dispatchEvent(new egret.TouchEvent(egret.TouchEvent.TOUCH_BEGIN))}},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_END,function(){r.touchBegin=!1,r.checkSucceed()},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.touchBegin=!1,r.checkSucceed()},this)},h.prototype.onTouchItem=function(e){if(0==this.selectList.length&&this.equal(e,this.beginItem))return e[3]=h.DIR.PASS,this.selectList.push(e),void this.updateItem(e);if(2<=this.selectList.length&&this.equal(this.selectList[this.selectList.length-2],e)){var t=this.selectList.pop();return t[3]=h.DIR.UNTOUCH,t[4]=0,t[5]=0,this.updateItem(t),e[3]=h.DIR.PASS,e[4]=1,void this.updateItem(e)}var i=this.checkVaild(e);if(i){var a=this.selectList[this.selectList.length-1];return a[3]=i,a[4]=0,e[3]=h.DIR.PASS,e[4]=1,e[5]=i%2==0?i+1:i-1,this.selectList.push(e),this.updateItem(a),void this.updateItem(e)}},h.prototype.checkVaild=function(e){if(2==e[2])return 0;if(this.selectList.length<=0)return 0;for(var t in this.selectList){var i=this.selectList[t];if(this.equal(i,e))return 0}var a=this.selectList[this.selectList.length-1],n=a[0],o=a[1];if(e[1]==o){if(0<n-1&&e[0]==n-1)return h.DIR.UP;if(n+1<=this.rowCount&&e[0]==n+1)return h.DIR.DOWN}if(e[0]==n){if(0<o-1&&e[1]==o-1)return h.DIR.LEFT;if(o+1<=this.colCount&&e[1]==o+1)return h.DIR.RIGHT}return 0},h.prototype.updateItem=function(e){var t=(e[0]-1)*this.colCount+e[1]-1,i=this.gp_free.$children[t];i&&i.update(e)},h.prototype.checkSucceed=function(){var e=this;GameRootLayer.gameLayer().switchTouchEnable(!1),this.selectList.length!=this.targetLength||this.opperationParams?GameRootLayer.gameLayer().switchTouchEnable(!0):(this.opperationParams=1,egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),e.hide()},this,1e3))},h.prototype.equal=function(e,t){return e[0]==t[0]&&e[1]==t[1]},h.prototype.reset=function(){for(var e in this.selectList.splice(0,this.selectList.length),this.curConfig){var t=this.curConfig[e];t[3]=h.DIR.UNTOUCH,t[4]=0,t[5]=0,this.updateItem(t)}},h.prototype.makeBtns=function(){var e=this;this.addBtn({text:"重置",cb:function(){e.reset()}}),this.addBtn({text:"放弃",cb:function(){e.opperationParams=0,e.hide()}})},h.prototype.makeBottomReward=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=s.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.addBottomReward(i[0])}}},h.BLOCK_STATUS={BRGIN:0,CAN_PASS:1,CANT_PASS:2},h.DIR={UNTOUCH:0,PASS:1,UP:2,DOWN:3,LEFT:4,RIGHT:5},h);function h(){var e=null!==r&&r.apply(this,arguments)||this;return e.selectList=[],e.beginItem=[],e.rowCount=1,e.colCount=1,e.targetLength=0,e.touchBegin=!1,e}s.EpUnicursalView=t;var i,n=(i=eui.ItemRenderer,__extends(e,i),e.prototype.update=function(e){switch(this.img_begin.visible=!1,this.bm_begin.visible=!1,this.gp_arrow.visible=!1,this.gp_arrow2.visible=!1,this.img_arrow.visible=!1,e[2]){case t.BLOCK_STATUS.BRGIN:this.bm_begin.visible=!0;break;case t.BLOCK_STATUS.CAN_PASS:break;case t.BLOCK_STATUS.CANT_PASS:return void(this.img_bg.source="_event_m_json.mx_img_zgz_01")}switch(e[3]){case t.DIR.UNTOUCH:this.img_bg.source="_event_m_json.mx_img_zgz_02";break;case t.DIR.PASS:this.img_bg.source="_event_m_json.mx_img_zgz_03";break;case t.DIR.UP:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=0;break;case t.DIR.DOWN:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=180;break;case t.DIR.LEFT:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=270;break;case t.DIR.RIGHT:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=90}switch(this.img_arrow.visible=!!e[4]&&e[2]!=t.BLOCK_STATUS.BRGIN,e[5]){case t.DIR.UP:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=0,this.img_arrow.rotation=180;break;case t.DIR.DOWN:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=180,this.img_arrow.rotation=0;break;case t.DIR.LEFT:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=270,this.img_arrow.rotation=90;break;case t.DIR.RIGHT:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=90,this.img_arrow.rotation=270}},e);function e(){var e=i.call(this)||this;return e.skinName="EPOneStrokeViewItem",e}}(game=game||{}),function(c){var t,e=(t=BasePanel,__extends(a,t),a.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.rankMed.hideAllSubView()},this),this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin"},a.prototype.initUI=function(){this.configs.length&&1<this.configs.length?(this.tabbar.visible=!0,this.initTabbar(),this.onTabbarItemTap()):(this.tabbar.visible=!1,this.showPanel(this.configs[0]||this.configs)),this.initialized=!0},a.prototype.initTabbar=function(){var i=[];this.configs.forEach(function(e){var t={source:{},config:e};e.tabbarSource?t.source=e.tabbarSource:(t.source.up=e.type==a.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_0":"_btn_yq_m_json.beibao_yeqian_baoxiang_0",t.source.down=e.type==a.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_1":"_btn_yq_m_json.beibao_yeqian_baoxiang_1"),i.push(t)}),this.tabbar.dataProvider=new eui.ArrayCollection(i),this.tabbar.selectedIndex=this.index,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this)},a.prototype.onTabbarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.tabIndex&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.tabIndex=e.itemIndex);var t=this.tabbar.selectedItem.config;this.rankMed.hideAllContentPanel(),this.showPanel(t)},a.prototype.updateView=function(e){this.module=e&&e.module||this.module,this.index=e.index||0,this.module?this.configs=c.RankConfig.Config[this.module]:this.configs=e,this.configs&&(this.initialized||this.initUI())},a.prototype.showPanel=function(e){if(e.clickFunc)e.clickFunc();else{switch(e.type||a.VIEW_TYPE.RANK){case a.VIEW_TYPE.RANK:this.blb_title.text=e.mainTitle||"排行榜",this.rankMed.showSubView(c.RankMediator.SV.COMMON_RANK,e);break;case a.VIEW_TYPE.REWARD:this.blb_title.text=e.mainTitle||"奖励",this.rankMed.showSubView(c.RankMediator.SV.COMMON_REWARD,e)}e&&e.bottomLabel?this.lb_bottom.text=e.bottomLabel:this.lb_bottom.text=""}},a.prototype.perClose=function(){this.rankMed.hideAllContentPanel()},a.VIEW_TYPE={RANK:1,REWARD:2},a);function a(){var e=t.call(this)||this;return e.tabIndex=0,e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.rankMed=c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N),e.skinName="CommonRankAndRewardPanelSkin",e}c.CommonRankAndRewardPanel=e;var i,n=(i=BaseView,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=d,this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this)},o.prototype.updateView=function(e){this.config=e&&e.configs?e.configs:e,this.initialize?this.updateList(this.targetConfig):this.initial()},o.prototype.initial=function(){this.config.length&&1<this.config.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.config[0].title||"",this.bm_tabTitle2.text=this.config[1].title||"",this.gp_topTitle.visible=!1,this.gp_topTitle2.visible=!0,this.gp_content.height=530,this.img_bg.height=664,this.onTabTap(1)):(this.gp_topTitle.visible=!0,this.gp_topTitle2.visible=!1,this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.gp_content.height=593,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},o.prototype.onTabTap=function(e){e?(this.gp_root.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_root.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.config[e-1],this.lb_name_desc2.text=(this.targetConfig.isGuild?"公会名称":this.targetConfig.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord2.text=this.targetConfig.keyWord||"战力"):this.targetConfig=this.config[0]||this.config,d.targetTab=e,this.updateList(this.targetConfig)},o.prototype.updateSelfRank=function(e,t){var a=this;this.gp_playerHead.removeChildren();var i=e&&e.rank;if(i){var n=this.rankProxy.rankIcon(i);""!=n?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=n):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}else this.img_icon.visible=!1,this.blb_rank.visible=!0,this.blb_rank.text="未上榜";if(this.lb_name.visible=!0,e.team)e.team.members.forEach(function(e,t){var i=customui.PlayerHeadFactory.create();i.blb_level.visible=!1,i.updateData({vo:e.baseInfo}),a.gp_playerHead.addChild(i)}),this.lb_name.visible=!1;else if(t)if(this.lb_name.x=220,e.guildBaseInfo){this.lb_name.text=e.guildBaseInfo.name;var o=customui.GuildHeadFactory.create();o.updateData({vo:e.guildBaseInfo}),this.gp_playerHead.addChild(o)}else this.lb_name.text=e.playerBaseInfo.name;else{var s=customui.PlayerHeadFactory.create();s.blb_level.visible=!1,s.updateData({vo:e.playerBaseInfo}),this.gp_playerHead.addChild(s),this.lb_name.x=220,this.lb_name.text=e.playerBaseInfo.name}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,this.targetConfig.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(this.targetConfig.updateExtraItem){var r=this.gp_extra.$children[0];this.targetConfig.updateExtraItem(r,e)}}else(r=this.targetConfig.getExtraItem(e)).horizontalCenter=r.verticalCenter=0,this.gp_extra.addChild(r);else this.targetConfig.keyWord?(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key&&e.key.toString()||"0"):(this.gp_fightCap.visible=!0,this.item_fightCap.update(e.playerBaseInfo.fightCap))},o.prototype.updateList=function(s){var r=this;if(s.rankType==RankingType.RankingTypeGuildTranscript){var e=[];for(var t in s.getRankList()){var i={info:s.getRankList()[t],config:s};e.push(i)}0<e.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,this.list_item.dataProvider=new eui.ArrayCollection(e),this.updateSelfRank(s.getRank()[0])}else this.rankProxy.GetRankList(s,function(e){var t=e.ranks;if(0<t.length){r.scl_list.visible=!0,r.gp_empty.visible=!1;var i=[];for(var a in t){var n={info:t[a],config:s};i.push(n)}r.list_item.dataProvider=new eui.ArrayCollection(i)}else r.scl_list.visible=!1,r.gp_empty.visible=!0;var o=e.selfRank||{};o.playerBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO,o.guildBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.GuildPy.N).guildDetail,r.updateSelfRank(o,s.isGuild)});this.lb_name_desc.text=(s.isGuild?"公会名称":s.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord.text=s.keyWord||"战力",this.lb_bottom.text="",s.hideSelf&&(this.gp_selfRank.visible=!1)},o.prototype.getParentView=function(){return c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N).getSubView(c.RankMediator.SV.COMMON).gp_content},o);function o(){var e=i.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRankPanelSkin",e}c.CommonRankPanel=n;var s,r=(s=BaseView,__extends(h,s),h.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,this.activateComponent()},h.prototype.initial=function(){this.configs.length&&1<this.configs.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.configs[0].title||"",this.bm_tabTitle2.text=this.configs[1].title||"",this.gp_topTitle.visible=!1,this.gp_content.height=585,this.img_bg.height=664,this.onTabTap(1)):(this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.lb_topLeft.text=this.configs[0].topTitle?"成就":"排名",this.img_bg.source=this.configs[0].topTitle?"common_img_shuzhidi_05_png":"common_img_shuzhidi_04_png",this.lb_topRight.x=this.configs[0].topTitle?272:326,this.gp_content.height=650,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},h.prototype.updateView=function(e){this.configs=e&&e.configs||this.configs,this.initialize?this.updateList(this.targetConfig):this.initial(),this.notice=this.configs.notice,this.addNotice()},h.prototype.onTabTap=function(e){e?(this.gp_tab.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_tab.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.configs[e-1],this.targetConfig.desc?this.targetConfig.type==h.VIEW_TYPE.RANK?(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!0,this.lb_name_desc3.text=this.targetConfig.desc[0]||"",this.lb_keyWord3.text=this.targetConfig.desc[1]||""):(this.gp_topTitle2.visible=!0,this.gp_topTitle3.visible=!1,this.lb_topLeft2.text=this.targetConfig.desc[0]||"",this.lb_topRight2.text=this.targetConfig.desc[1]||""):(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!1)):(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!1,this.targetConfig=this.configs[0]||this.configs),u.targetTab=e,this.updateList(this.targetConfig),this.targetConfig.img_bestRank?this.img_bestRank.source=this.targetConfig.img_bestRank:this.img_bestRank.source="paiweisai_txt_ndlszgpm_png"},h.prototype.updateList=function(i){var a=this;if(i.getTopRankInfo){this.gp_topTitle.visible=!1,this.gp_rank_reward.visible=!0,this.scl_list.top=120;var e=i.getTopRankInfo();this.blb_rank.text=(e.topRank||0).toString(),this.lb_desc.text=e.desc,this.gp_rewards.removeChildren(),e.targetRewards.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.65,t.updateData({reward:e}),a.gp_rewards.addChild(t)})}else this.gp_rank_reward.visible=!1,this.scl_list.top=0;var t=i.type;switch(this.gp_selfRank.visible=!1,this.scl_list.bottom=0,t){case h.VIEW_TYPE.RANK_REWARD:this.list_item.itemRenderer=u;break;case h.VIEW_TYPE.SCORE_REWARD:this.list_item.itemRenderer=y;break;case h.VIEW_TYPE.SCORE_REWARD2:this.list_item.itemRenderer=T;break;case h.VIEW_TYPE.RANK:this.list_item.itemRenderer=d,this.gp_selfRank.visible=!0,this.scl_list.bottom=50,i.hideSelf&&(this.gp_selfRank.visible=!1),c.GameMVC.rankPy.GetRankList(i,function(e){var t=e.selfRank||{};t.playerBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO,t.guildBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.GuildPy.N).guildDetail,a.updateSelfRank(t,i.isGuild)})}this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0;var n=i.getRewardList();this.list_item.dataProvider=new eui.ArrayCollection(n);var o=!1;for(var s in n)if(n[s].status==REWARD_STATUS.AVAILABLE){o=!0;break}i&&i.bottomBtn?(this.btn_bottom.label=i.bottomBtn.label,this.bottomBtnCb=function(){i.bottomBtn.callback&&i.bottomBtn.callback()},this.btn_bottom.visible=!0,UIActionManager.setAbsGrey(this.btn_bottom,!o),this.btn_bottom.touchEnabled=o):this.btn_bottom.visible=!1,this.lb_bottom.text=i.getBottomLabel&&i.getBottomLabel()||"",this.lb_bottomLeft.text=i.getBottomLeftLabel&&i.getBottomLeftLabel()||""},h.prototype.activateComponent=function(){var e=this;this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this),this.btn_bottom.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.bottomBtnCb&&e.bottomBtnCb()},this)},h.prototype.getParentView=function(){return c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N).getSubView(c.RankMediator.SV.COMMON).gp_content},h.prototype.updateSelfRank=function(e,t){var a=this;this.gp_playerHead.removeChildren();var i=e&&e.rank;if(i){var n=c.GameMVC.rankPy.rankIcon(i);""!=n?(this.blb_selfRank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=n):(this.blb_selfRank.visible=!0,this.img_icon.visible=!1,this.blb_selfRank.text=i.toString())}else this.img_icon.visible=!1,this.blb_selfRank.visible=!0,this.blb_selfRank.text="未上榜";if(this.lb_name.visible=!0,e.team)e.team.members.forEach(function(e,t){var i=customui.PlayerHeadFactory.create();i.blb_level.visible=!1,i.updateData({vo:e.baseInfo}),a.gp_playerHead.addChild(i)}),this.lb_name.visible=!1;else if(t)if(this.lb_name.x=220,e.guildBaseInfo){this.lb_name.text=e.guildBaseInfo.name;var o=customui.GuildHeadFactory.create();o.updateData({vo:e.guildBaseInfo}),this.gp_playerHead.addChild(o)}else this.lb_name.text=e.playerBaseInfo.name;else{var s=customui.PlayerHeadFactory.create();s.blb_level.visible=!1,s.updateData({vo:e.playerBaseInfo}),this.gp_playerHead.addChild(s),this.lb_name.x=220,this.lb_name.text=e.playerBaseInfo.name}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,this.targetConfig.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(this.targetConfig.updateExtraItem){var r=this.gp_extra.$children[0];this.targetConfig.updateExtraItem(r,e)}}else(r=this.targetConfig.getExtraItem(e)).horizontalCenter=r.verticalCenter=0,this.gp_extra.addChild(r);else if(this.targetConfig.keyWord){if(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key&&e.key.toString()||"0",this.targetConfig.rankType==RankingType.RankingTypeActivityNewZoneDoubleElevenRank&&(this.lb_keyValue.visible=!0,e.key&&0!=e.key)){var h=e.key%1e3,l=Math.ceil(e.key/1e3);this.lb_keyValue.text=h+"级("+l+")"}}else this.gp_fightCap.visible=!0,this.item_fightCap.update(e.playerBaseInfo.fightCap)},h.prototype.addNotice=function(){this.configs[1]&&this.configs[1].notice&&this.configs[1].notice!=this.notice&&(this.notice=this.configs[1].notice,NoticeManager.addNoticeListener(this.notice,this.gp_notice,this))},h.VIEW_TYPE={RANK_REWARD:1,SCORE_REWARD:2,SCORE_REWARD2:3,RANK:4},h);function h(){var e=s.call(this)||this;return e.initialize=!1,e.skinName="CommonRewardPanelSkin",e}c.CommonRewardPanel=r;var l,d=(l=eui.ItemRenderer,__extends(p,l),p.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this)},p.prototype.updateItem=function(e){this.data=e,this.dataChanged()},p.prototype.dataChanged=function(){var i=this;if(this.img_bg.source=p.targetTab?1==p.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png":"jjc_img_paihangbang02_png",this.gp_guildHead.visible=!1,this.gp_avatar.visible=!1,this.lb_name.visible=!0,this.data.info&&this.data.info.rank)if(this.gp_rank.visible=!0,this.data.info.team){function e(t){var e=customui.PlayerHeadFactory.create();e.addTapEvent(function(){var e=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N);i.data.info.team.members&&i.data.info.team.members[t].baseInfo.playerId!=e.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.data.info.team.members[t].baseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)}),e.blb_level.visible=!1,a.playerHeads.push(e),a.gp_avatar.addChild(e)}this.gp_avatar.visible=!0;for(var a=this,t=this.playerHeads.length;t<3;t++)e(t);this.updateForTeam()}else{if(this.gp_avatar.numChildren<=0){var n=customui.PlayerHeadFactory.create();n.blb_level.visible=!1,this.data.config.blockTouch||(n.touchEnabled=!0,n.addTapEvent(function(){var e=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N);i.data.info.playerBaseInfo&&i.data.info.playerBaseInfo.playerId!=e.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.data.info.playerBaseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})),this.playerHeads.push(n),this.gp_avatar.addChild(n)}if(this.data.config.isGuild){if(this.gp_guildHead.visible=!0,0==this.gp_guildHead.$children.length){var o=customui.GuildHeadFactory.create();this.gp_guildHead.addChild(o)}this.updateForGuild()}else this.gp_avatar.visible=!0,this.updateForPlayer()}else this.gp_rank.visible=!1},p.prototype.updateForPlayer=function(){var e=this.data.info;this.data.config,this.playerHeads[0].updateData({vo:e.playerBaseInfo}),this.lb_name.text=e.playerBaseInfo.name,this.lb_name.x=215,this.updateCommonPart()},p.prototype.updateForGuild=function(){var e=this.data.info;this.lb_name.text=e.guildBaseInfo.name,this.lb_name.x=215,this.gp_guildHead.$children[0].updateData({vo:e.guildBaseInfo}),this.updateCommonPart()},p.prototype.updateForTeam=function(){var i=this,e=this.data.info;this.data.config,e.team.members.forEach(function(e,t){i.playerHeads[t].updateData({vo:e.baseInfo})}),this.lb_name.visible=!1,this.updateCommonPart()},p.prototype.updateCommonPart=function(){var e=this.data.info,t=this.data.config,i=e.rank;if(i){var a=this.rankProxy.rankIcon(i);""!=a?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=a):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,t.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(t.updateExtraItem){var n=this.gp_extra.$children[0];t.updateExtraItem(n,e)}}else(n=t.getExtraItem(e))&&(n.horizontalCenter=n.verticalCenter=0,this.gp_extra.addChild(n));else if(t.keyWord){if(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key.toString(),t.rankType==RankingType.RankingTypeActivityNewZoneDoubleElevenRank&&(this.lb_keyValue.visible=!0,0!=e.key)){var o=e.key%1e3,s=Math.ceil(e.key/1e3);this.lb_keyValue.text=o+"级("+s+")"}}else this.gp_fightCap.visible=!0,e.playerBaseInfo?this.item_fightCap.update(e.playerBaseInfo.fightCap):this.gp_fightCap.visible=!1},p.targetTab=1,p);function p(){var e=l.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRankPanel_RankItem",e.playerHeads=[],e}c.CommonRankPanel_RankItem=d;var g,u=(g=eui.ItemRenderer,__extends(f,g),f.prototype.childrenCreated=function(){g.prototype.childrenCreated.call(this)},f.prototype.dataChanged=function(){var t=this;this.img_bg.source=1==f.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png",this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source;var e=this.data.rank;if(e){var i=this.rankProxy.rankIcon(e);""!=i?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=i):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=e.toString(),5<=e.length?this.blb_rank.scaleX=.8:this.blb_rank.scaleX=1)}else this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=this.data.icon||"";var a=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),a.forEach(function(e){t.gp_rewards.addChild(new customui.CommonIconWithNum({style:CommonIconStyle.RIGHT,showEnough:!1,code:e[1],num:e[2],showDetail:!0}))})},f.targetTab=1,f);function f(){var e=g.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRewardPanel_RewardItem",e}c.CommonRewardPanel_RewardItem=u;var m,y=(m=eui.ItemRenderer,__extends(_,m),_.prototype.childrenCreated=function(){m.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this),this.pb.slideDuration=0},_.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.pb.maximum=this.data.pbMax,this.pb.value=this.data.pbValue,this.btnFunc=this.data.btnFunc,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1)):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},_);function _(){var e=m.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}c.CommonRewardPanel_RewardItem2=y;var v,T=(v=eui.ItemRenderer,__extends(C,v),C.prototype.childrenCreated=function(){v.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this)},C.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.lb_desc.verticalCenter=10,this.pb.visible=!1,this.btnFunc=this.data.btnFunc,this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1),UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-3.5})):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),UIActionManager.hideEffect(this.btn_get)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},C);function C(){var e=v.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}c.CommonRewardPanel_RewardItem3=T;var E,I=(E=BaseView,__extends(b,E),b.prototype.childrenCreated=function(){E.prototype.childrenCreated.call(this),this.top=-750,this.horizontalCenter=-240,this.scaleX=this.scaleY=2},b.prototype.updateView=function(e){var t=this;e&&e.roleModel&&(this.role_model.update(e.roleModel),this.role_model.visible=!1,egret.setTimeout(function(){t.role_model.onChangingDir(1),t.role_model.visible=!0},this,1e3))},b.prototype.getParentView=function(){return c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N).getSubView(c.RankMediator.SV.COMMON).gp_content},b);function b(){var e=E.call(this)||this;return e.skinName="CommonRankModel",e}c.CommonRankModel=I}(game=game||{}),function(f){var i,e=(i=BasePanel,__extends(a,i),a.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="排行榜",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.list_items.itemRenderer=n,this.gp_rank0.touchChildren=!1,this.gp_rank1.touchChildren=!1,this.gp_rank2.touchChildren=!1,this.hdm_model_0.touchEnabled=!1,this.hdm_model_1.touchEnabled=!1,this.hdm_model_2.touchEnabled=!1,this.rdm_model_0.touchEnabled=!1,this.rdm_model_1.touchEnabled=!1,this.rdm_model_2.touchEnabled=!1,egret.Tween.get(this.img_model0,{loop:!0}).to({verticalCenter:-80},700).to({verticalCenter:-60},700),egret.Tween.get(this.img_model1,{loop:!0}).to({verticalCenter:-80},700).to({verticalCenter:-60},700),egret.Tween.get(this.img_model2,{loop:!0}).to({verticalCenter:-80},700).to({verticalCenter:-60},700),this.selfItem=new n,this.gp_my_item.addChild(this.selfItem),this.selfItem.horizontalCenter=0,this.initEffect(),this.initTabbar(),this.activateComponent(),this.updateView()},a.prototype.updateView=function(e){var r=this;e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var h=this.CONFIG[this.tabbar.selectedIndex];this.CommonDaTanChuKuang.blb_title.text=h.title,this.img_bg.source=h.bg_source,this.sl_items.stopAnimation(),this.sl_items.viewport.scrollV=0,f.GameMVC.rankPy.GetRankList(h,function(e){var t=(r.curRanks=e).ranks,i=e.selfRank;if(0!=t.length){for(var a=0;a<3;a++){var n=t[a];r.updateTop3Rank(a,n,h)}var o=[];t.forEach(function(e,t){2<t&&o.push({rankInfo:e,config:h})}),r.list_items.dataProvider=new eui.ArrayCollection(o),r.gp_empty.visible=0==o.length}else{for(a=0;a<3;a++){var n=t[a];r.updateTop3Rank(a,n,h)}var s=[];r.list_items.dataProvider=new eui.ArrayCollection(s),r.gp_empty.visible=0==s.length}r.selfItem.visible=!0,r.sl_items.height=307,i&&i.rank?(i.playerBaseInfo||(i.playerBaseInfo=f.GameMVC.playerPy.playerInfoVO),r.selfItem.data={isSelf:!0,rankInfo:i,config:h}):(n=h.SelfRankInfo())?r.selfItem.data={isSelf:!0,rankInfo:n,config:h}:(r.selfItem.visible=!1,r.sl_items.height=451)})},a.prototype.updateTop3Rank=function(e,t,i){var a=this["img_nobody"+e],n=this["btn_detail"+e],o=this["bm_grade"+e],s=this["lb_ownerName"+e],r=this["hdm_model_"+e],h=this["img_model"+e],l=this["rdm_model_"+e];if(r.visible=!1,h.visible=!1,l.visible=!1,t)switch(a.visible=!1,n.visible=!0,o.text=t.key+"",i.rankType){case RankingType.RankingTypeFightCap:case RankingType.RankingTypeLevel:l.visible=!0,l.update({vo:t.playerBaseInfo,reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),s.text=t.playerBaseInfo.name;break;case RankingType.RankingTypeGuild:l.visible=!0,l.update({vo:t.playerBaseInfo,reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),s.text=t.guildBaseInfo.name;break;case RankingType.RankingTypePetScore:var c=JSON.parse(t.additionInfo),d=f.Config.allPetConfig()[c.code];d&&(r.visible=!0,r.update({model:d.model,isStatic:!0})),s.text=c.name;break;case RankingType.RankingTypeImmortalScore:c=JSON.parse(t.additionInfo);var p=f.Config.immortalConfig()[c.code];p&&(h.visible=!0,h.source=p.img+"_png"),s.text=c.name}else a.visible=!0,o.text="0",s.text="虚席以待",n.visible=!1;var g=this["lb_nameTip"+e],u=this["lb_keyName"+e];g.text=i.nameTip,u.text=i.keyword+":"},a.prototype.initEffect=function(){UIActionManager.addEffect(this.gp_rank0,"common_activity_yuandanjie_06",{offectX:0,offectY:-30,childIndex:2,scaleX:.7,scaleY:.7},function(e){e.touchEnabled=!1}),UIActionManager.addEffect(this.gp_rank1,"common_activity_yuandanjie_07",{offectX:0,offectY:0,childIndex:2},function(e){e.touchEnabled=!1}),UIActionManager.addEffect(this.gp_rank2,"common_activity_yuandanjie_08",{offectX:0,offectY:0,childIndex:2},function(e){e.touchEnabled=!1})},a.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin";var e=[];for(var t in this.CONFIG)Utils.UnlockMgr.checkPass(this.CONFIG[t].module,!1).allow&&e.push({source:this.CONFIG[t].source});this.tabbar.dataProvider=new eui.ArrayCollection(e),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},a.prototype.activateComponent=function(){var e=this;this.gp_touch0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showInfo(0)},this),this.gp_touch1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showInfo(1)},this),this.gp_touch2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showInfo(2)},this)},a.prototype.showInfo=function(e){var t=this.curRanks.ranks[e],i=this.CONFIG[this.tabbar.selectedIndex];if(t)switch(i.rankType){case RankingType.RankingTypeFightCap:case RankingType.RankingTypeLevel:f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),t.playerBaseInfo&&t.playerBaseInfo.playerId&&t.playerBaseInfo.playerId!=f.GameMVC.playerPy.playerInfoVO.playerId&&f.AppFacade.getInstance().showSubView(f.FriendMediator.N,f.FriendMediator.SV.INFO,{playerId:t.playerBaseInfo.playerId});break;case RankingType.RankingTypeGuild:f.AppFacade.getInstance().showSubView(f.GuildMediator.N,f.GuildMediator.SV.INFO,t.guildBaseInfo);break;case RankingType.RankingTypePetScore:var a=JSON.parse(t.additionInfo);f.GameMVC.petPy.GetBasePetInfo(a.uuid,function(e){var t=JSON.parse(e.info);t.ownerName=t.name,f.GameMVC.petMed.showSubView(f.PetMediator.SV.OTHER_PET_DETAIL,{info:t})});break;case RankingType.RankingTypeImmortalScore:a=JSON.parse(t.additionInfo),f.GameMVC.immortalPy.showImmortalDetail(a.uuid)}else Utils.MsgUtils.addMidMsg("虚席以待")},a.VIEW_TYPE={FIGHTCAP:0,LEVEL:1,GUILD:2,PET:3,IMMORTAL:4},a);function a(){var e,t=i.call(this)||this;return t.index=0,t.CONFIG=((e={})[a.VIEW_TYPE.FIGHTCAP]={title:"战力榜",module:MODULE.Ranking,rankType:RankingType.RankingTypeFightCap,bg_source:"phb_img_zhanliditu_png",keyword:"战力",nameTip:"玩家名",additonTip:"我的战力",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_zhanli_0",down:"_btn_yq_m_json.common_yeqian_zhanli_1"},SelfRankInfo:function(){var e=new f.CommonRankItemVO,t=f.GameMVC.playerPy.playerInfoVO;return e.key=t.fightCap,e.rank=0,e.playerBaseInfo=t,e}},e[a.VIEW_TYPE.LEVEL]={title:"等级榜",rankType:RankingType.RankingTypeLevel,module:MODULE.Ranking,bg_source:"phb_img_dengjiditu_png",keyword:"等级",nameTip:"玩家名",additonTip:"我的等级",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_dengjii_0",down:"_btn_yq_m_json.common_yeqian_dengjii_1"},SelfRankInfo:function(){var e=new f.CommonRankItemVO,t=f.GameMVC.playerPy.playerInfoVO;return e.key=t.level,e.rank=0,e.playerBaseInfo=t,e}},e[a.VIEW_TYPE.GUILD]={title:"公会榜",module:MODULE.Ranking,rankType:RankingType.RankingTypeGuild,bg_source:"phb_img_gonghuiitu_png",keyword:"战力",nameTip:"公会名",additonTip:"我的公会",isGuild:!0,source:{up:"_btn_yq_m_json.common_yeqian_gonghui_0",down:"_btn_yq_m_json.common_yeqian_gonghui_1"},SelfRankInfo:function(){var e;e={};var t=f.GameMVC.guildPy.guildDetail;if(t){var i=f.GameMVC.playerPy.playerInfoVO;return e.key=t.level,e.rank=0,e.playerBaseInfo=i,e.guildBaseInfo=t,e}}},e[a.VIEW_TYPE.PET]={title:"宠物榜",rankType:RankingType.RankingTypePetScore,module:MODULE.Pet,bg_source:"phb_img_ditu_png",keyword:"评分",nameTip:"拥有者",additonTip:"我的宠物",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_chongwu_0",down:"_btn_yq_m_json.common_yeqian_chongwu_1"},SelfRankInfo:function(){var e="",t=0,i=0,a=f.GameMVC.petPy.allPetByUuid;for(var n in a){var o=a[n];(o.score>i||o.score==i&&o.uuid>e)&&(t=o.code,e=o.uuid,i=o.score)}return e?{rank:0,key:i,playerBaseInfo:null,guildBaseInfo:null,additionInfo:JSON.stringify({name:"我的宠物",uuid:e,code:t})}:void 0}},e[a.VIEW_TYPE.IMMORTAL]={title:"至宝榜",rankType:RankingType.RankingTypeImmortalScore,module:MODULE.Immortal,keyword:"评分",bg_source:"phb_img_zhibaoditu_png",nameTip:"拥有者",additonTip:"我的神兵",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_zhibao_0",down:"_btn_yq_m_json.common_yeqian_zhibao_1"},SelfRankInfo:function(){var e="",t=0,i=0,a=f.GameMVC.heroThingPy.AllImmortalInfo;for(var n in a){var o=a[n];(o.score>i||o.score==i&&o.uuid>e)&&(t=o.code,e=o.uuid,i=o.score)}return e?{rank:0,key:i,playerBaseInfo:null,guildBaseInfo:null,additionInfo:JSON.stringify({name:"我的至宝",uuid:e,code:t})}:void 0}},e),t.skinName="MainRankViewSkin",t}f.MainRankPanel=e;var t,n=(t=eui.ItemRenderer,__extends(o,t),o.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),egret.Tween.get(this.img_model,{loop:!0}).to({verticalCenter:-21},500).to({verticalCenter:-11},500),this.gp_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(i.data.config.rankType){case RankingType.RankingTypeFightCap:case RankingType.RankingTypeLevel:f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),i.data.rankInfo.playerBaseInfo&&i.data.rankInfo.playerBaseInfo.playerId&&i.data.rankInfo.playerBaseInfo.playerId!=f.GameMVC.playerPy.playerInfoVO.playerId&&f.AppFacade.getInstance().showSubView(f.FriendMediator.N,f.FriendMediator.SV.INFO,{playerId:i.data.rankInfo.playerBaseInfo.playerId});break;case RankingType.RankingTypeGuild:f.AppFacade.getInstance().showSubView(f.GuildMediator.N,f.GuildMediator.SV.INFO,i.data.rankInfo.guildBaseInfo);break;case RankingType.RankingTypePetScore:var e=JSON.parse(i.data.rankInfo.additionInfo);i.data.isSelf?f.GameMVC.petMed.showSubView(f.PetMediator.SV.SELF_PET_DETAIL,{uuid:e.uuid}):f.GameMVC.petPy.GetBasePetInfo(e.uuid,function(e){var t=JSON.parse(e.info);t.ownerName=t.name,f.GameMVC.petMed.showSubView(f.PetMediator.SV.OTHER_PET_DETAIL,{info:t})});break;case RankingType.RankingTypeImmortalScore:if(e=JSON.parse(i.data.rankInfo.additionInfo),i.data.isSelf){var t=f.GameMVC.heroThingPy.AllImmortalInfo[e.uuid];f.AppFacade.getInstance().showSubView(f.HeroThingMediator.N,f.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeImmortal,vo:new f.HeroImmortalVO(t),source:f.HeroThingMainView.VIEW_SOURCE.BACKPACK})}else f.GameMVC.immortalPy.showImmortalDetail(e.uuid)}},this)},o.prototype.dataChanged=function(){if(this.data){var e=this.data.rankInfo,t=this.data.config;switch(JSON.parse(e.additionInfo),this.bm_key.text=e.key,this.bm_rank.text=e.rank||"暂无名次",this.lb_keyName.text=t.keyword+":",this.lb_name.text=t.additonTip,this.data.isSelf?this.img_nameBg.source="common_img_kt_4_1_png":this.img_nameBg.source="common_img_kt_4_2_png",this.hdm_model.visible=!1,this.img_model.visible=!1,this.rdm_model.visible=!1,this.btn_detail.visible=!0,t.rankType){case RankingType.RankingTypeFightCap:case RankingType.RankingTypeLevel:this.rdm_model.visible=!0,this.rdm_model.update({vo:e.playerBaseInfo,reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),this.lb_name.text=e.playerBaseInfo.name,this.btn_detail.visible=!this.data.isSelf;break;case RankingType.RankingTypeGuild:this.rdm_model.visible=!0,this.rdm_model.update({vo:e.playerBaseInfo,reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),this.lb_name.text=e.guildBaseInfo.name;break;case RankingType.RankingTypePetScore:var i=JSON.parse(e.additionInfo),a=f.Config.allPetConfig()[i.code];a&&(this.hdm_model.visible=!0,this.hdm_model.update({model:a.model,isStatic:!0})),this.data.isSelf||(this.lb_name.text="拥有者:"+i.name);break;case RankingType.RankingTypeImmortalScore:var n=JSON.parse(e.additionInfo),o=f.Config.immortalConfig()[n.code];o&&(this.img_model.visible=!0,this.img_model.source=o.img+"_png"),this.data.isSelf||(this.lb_name.text="拥有者:"+n.name)}}},o);function o(){var e=t.call(this)||this;return e.skinName="MainRankPanel_RankItem",e}}(game=game||{}),function(g){var e=(t.Config={TEMPLATE:{rankType:void 0,keywordIcon:void 0,getExtraItem:function(e){},updateExtraItem:function(e,t){}},WORLD_KING_RANK:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeWorldWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeWorldWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.AppFacade.getInstance().retrieveProxy(g.WorldKingPy.N).worldKingInfo.cWorldRank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){function e(e){var t=d[e],i=g.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],a=-1!=c.indexOf(t.code),n=!a&&l.hLevel>=JSON.parse(t.key)[0],o=t.code,s=void 0;s=a?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,p.push({desc:"段位达到"+i.name,requestRank:o,pbMax:h,pbValue:o,status:s,rewards:t.rewards,btnFunc:function(){r.GetReward({type:t.type,id:t.code})}})}var r=g.AppFacade.getInstance().retrieveProxy(g.WorldKingPy.N),h=r.worldKingInfo.cWorldRank,l=r.worldKingInfo,c=JSON.parse(l.gotRewards),d=g.Config.worldKingRewardConfig(WorldKingRewardType.Level),p=[];for(var t in d)e(t);return p.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),p},bottomBtn:{label:"一键领取",callback:function(){g.AppFacade.getInstance().retrieveProxy(g.WorldKingPy.N).GetReward({type:1,id:0})}}}]}],ACTIVITY_QUORA:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){var e=i(RankingType.RankingTypeNewZoneActivityQuora);for(var t in e)e[t].backColor=!0;return e},img_bestRank:"jsjhd_txt_nddqpm_png",getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:[]},i=g.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeNewZoneActivityQuora);e=t.topRank=i&&i.rank||999,t.topRank=e;var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneActivityQuora);for(var n in a){var o=a[n];e>=o.rankUpper&&e<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],SF_ACTIVITY_QUORA:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){var e=i(RankingType.RankingTypeNewZoneActivityQuora1);for(var t in e)e[t].backColor=!0;return e},img_bestRank:"jsjhd_txt_nddqpm_png",getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:[]},i=g.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeNewZoneActivityQuora1);e=t.topRank=i&&i.rank||"暂无排名",t.topRank=e;var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneActivityQuora1);for(var n in a){var o=a[n];e>=o.rankUpper&&e<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],ARENA:{rankType:RankingType.RankingTypeArena,type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK},ARENA2:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeArena)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N).arenaInfo.hRank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeArena);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],notice:NT.ARENA_REWARD_LINQU,getRewardList:function(){function e(e){var t=r[e],i=t.rank;if(!i)return"continue";var a=REWARD_STATUS.UNAVAILABLE;-1!=o.indexOf(t.rank)?a=REWARD_STATUS.RECEIVED:n<=i&&(a=REWARD_STATUS.AVAILABLE),h.push({desc:"排名达到"+i+"名",requestRank:i,pbMax:s,pbValue:i,status:a,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:i}).then(function(e){g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward,2),g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N).arenaInfo.update(e.arenaInfo),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}var t=g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N),n=t.arenaInfo.hRank,o=t.arenaInfo.hRankTargeted,s=t.arenaInfo.rank,r=g.Config.arena_hRankReward(),h=[];for(var i in r)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:0}).then(function(e){g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward,2),g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N).arenaInfo.update(e.arenaInfo),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}}}]}],WORLD_BOSS_RANK:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypePlayerServerBossHurt,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypePlayerServerBossHurt);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,a=0<=r.indexOf(t),n=l[e].rankUpper,o=n<=h;i=a?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"挑战BOSS"+n+"次",requestRank:n,status:i,rewards:l[e].rewards,btnFunc:function(){s.GetPlayerTimesReward(t,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}var s=g.AppFacade.getInstance().retrieveProxy(g.WorldBossPy.N),t=s.playerInfo||s.temInfo.playerBossInfo,r=JSON.parse(t.timesReward),h=t.challengeTimes,l=g.Config.serverBossReward(2),c=[];for(var i in l)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){g.AppFacade.getInstance().retrieveProxy(g.WorldBossPy.N).GetPlayerTimesReward(0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}}}]}],HERO_SPRITE_RANK:{configs:[{rankType:RankingType.RankingTypeHeroSpirit,keyWord:"激活页数",title:"排行"}]},HERO_SPRITE_ACHIEVE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,a=0<=r.indexOf(t),n=l[e].num,o=n<=h;i=a?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"激活"+n+"页",request:n,status:i,rewards:l[e].rewards,btnFunc:function(){s.GetHeroSpiritAchievementRewards(t,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}var s=g.GameMVC.heroSpiritPy,r=JSON.parse(s.achieveTargeted),h=s.getAllLevelInfo(),l=g.Config.heroSpriteAchievementReward(),c=[];for(var t in l)e(t);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.request-t.request}),c},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.heroSpiritPy.GetHeroSpiritAchievementRewards(0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_BOSS:[{rankType:RankingType.RankingTypeGuildBoss,keyWord:"伤害"}],GUILD_COPY:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildTranscript,keyWord:"伤害",getRankList:function(){var e=g.AppFacade.getInstance().retrieveProxy(g.GuildInstancePy.N).upGuildTranscriptBossInfo.killInfo,t=[];for(var i in e){var a=e[i];t.push({rank:Number(i)+1,playerBaseInfo:a.baseInfo,key:a.num})}return t},getRank:function(){var e,t,i=g.AppFacade.getInstance().retrieveProxy(g.GuildInstancePy.N),a=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),n=a.playerInfoVO.playerId,o=1,s=i.upGuildTranscriptBossInfo.killInfo;for(var r in s){var h=s[r];h.baseInfo.playerId==n?(e=h,t=Number(r)+1):o++}var l=[];return l.push({rank:t||o,playerBaseInfo:a.playerInfoVO,key:e?e.num:0}),l}},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){var e=g.AppFacade.getInstance().retrieveProxy(g.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,t=g.Config.getGuildtranscriptRewardConfig(),i=[];for(var a in t){var n=t[a];n.sectionId==e&&i.push({rank:0<n.rankLower-n.rankUpper?9999<=n.rankLower?n.rankUpper+"-":n.rankUpper+"-"+n.rankLower:n.rankUpper,rewards:n.rewards,index:n.rankUpper,backColor:!0})}i.sort(function(e,t){return e.index-t.index});var o=g.AppFacade.getInstance().retrieveProxy(g.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,s=g.Config.getGuildtranscriptConfig()[o];return s&&(i=[{icon:"jjc_icon_pm_jisha_png",rewards:JSON.parse(s.killRewards),backColor:!0}].concat(i)),i},getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:void 0},i=g.AppFacade.getInstance().retrieveProxy(g.GuildInstancePy.N),a=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N).playerInfoVO.playerId,n=i.upGuildTranscriptBossInfo.killInfo;for(var o in n)n[o].baseInfo.playerId==a&&(e=Number(o)+1);t.topRank=e||1;var s=i.upGuildTranscriptBossInfo.sectionId,r=g.Config.getGuildtranscriptConfig()[s];if(r){var h=JSON.parse(r.challengeRewards);t.targetRewards=h}return t.desc="每次挑战时，可以获得以下奖励",t}}]}],GUILD_WAR:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=g.AppFacade.getInstance().retrieveProxy(g.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}],CHAMPION:{rankType:RankingType.RankingTypeChampion,keyWord:"关卡数"},DeepNest:{rankType:RankingType.RankingTypeAbyssLair,keyWord:"总星数"},FishingRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneFishing,keyWord:"总积分"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneFishing,{backColor:!0})}}]}],ZoneDevoteGoods:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneDevoteGoodsRank,keyWord:"祈愿积分"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneDevoteGoodsRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneConsumeRank,keyWord:"祈愿积分"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank1:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank1,{backColor:!0})}}]}],TopFarmMoneyRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeNewZoneActivityTopFarmMoneyRank,{backColor:!0})}}]}],NewZoneZongZiGradeRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneZongZiGradeRank,keyWord:"粽子积分"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneZongZiGradeRank,{backColor:!0})}}]}],DragonBoatGradeRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,keyWord:"龙舟里程"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,{backColor:!0})}}]}],TEAM_COPY:{rankType:RankingType.RankingTypeTeamExpedition,keyWord:"关卡数"},TEAM_BOSS:{rankType:RankingType.RankingTypeTeamBoss,keyWord:"关卡数"},RankingTypeGloryArena:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGloryArena,keyWord:"积分"},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeGloryArena,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeGloryArena,function(e){i=t.topRank=e.selfRank.rank});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeGloryArena);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],RankingTypeRaceTowerHuman:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerHuman,keyWord:"通关关卡数"}],RankingTypeRaceTowerOrc:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerOrc,keyWord:"通关关卡数"}],RankingTypeRaceTowerElf:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerElf,keyWord:"通关关卡数"}],RankingTypeRaceTowerAthanasy:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerAthanasy,keyWord:"通关关卡数"}],RankingTypeRaceTowerDemonNEldar:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerDemonNEldar,keyWord:"通关关卡数"}],TEAM_ARENA_RANK:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"本服奖励",getRewardList:function(){return i(RankingType.RankingTypeTeamArenaMatch,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.AppFacade.getInstance().retrieveProxy(g.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"晋级奖励",getRewardList:function(){var e=i(RankingType.RankingTypeTeamArenaEliminate),t=JSON.parse(g.Config.constConfig().TeamArenaVoteConfig.constValue);return t&&(e=[{icon:"zdjj_icon_toupiao_png",rewards:t[1]}].concat(e)),e},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.AppFacade.getInstance().retrieveProxy(g.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],TEAMCOPY:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e],i=-1!=h.indexOf(t.id),a=!i&&r.sectionId>=t.id,n=t.id,o=void 0;o=i?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"通关第"+g.Config.teamExpedition()[n].chapterId+"章"+g.Config.teamExpedition()[n].name,requestRank:n,pbMax:s,pbValue:n,status:o,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:n}).then(function(e){g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward,2),g.AppFacade.getInstance().retrieveProxy(g.TeamExpePy.N).info.update(e.info),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}})}var t=g.AppFacade.getInstance().retrieveProxy(g.TeamExpePy.N),s=t.info.sectionId,r=t.info,h=r.targeted,l=g.Config.teamRewardConfig(),c=[];for(var i in l)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:0}).then(function(e){g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward,2),g.AppFacade.getInstance().retrieveProxy(g.TeamExpePy.N).info.update(e.info),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}}}]}],HERO_CHALLENGE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeHeroChallenge,keyWord:"关卡数"}],ZZQ_RANK:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeChessGrade,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:t.key,fromRank:!0})},blockTouch:!0},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeChessGrade,{backColor:!0})},getTopRankInfo:function(){var e={topRank:g.GameMVC.zzqPy.curPlayer.maxRank,desc:"描述：",targetRewards:[]},t=g.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeChessGrade).rank,i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeChessGrade);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],ACTIVITY_EATINGZONGZI:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var e=g.GameMVC.activityPy.allActivityData[EActivityType.EatingZongZi];if(!e||!e.data)return[];function t(e){var t=n[e][0],i=n[e][1];a.push({desc:"粽子积分达到"+t+"分",pbValue:o,status:status,rewards:i,btnFunc:function(){g.GameMVC.activityPy.GetCommonReward(EActivityType.EatingZongZi,t,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD),g.GameMVC.activityMed.updateViewByCode(EActivityType.EatingZongZi)})}})}var a=[],n=JSON.parse(e.content)[0],o=e.data.integral||0;for(var i in n)t(i);return a.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),a},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.activityPy.GetCommonReward(EActivityType.EatingZongZi,0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+g.GameMVC.heroPy.gashaponInfo[GashaponType.High].hTimes}}]}],ActivityShuang12Rank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneDoubleTwelveRank,title:"排 行",desc:["玩家姓名","消费钻石"],getRewardList:function(){var e=g.GameMVC.rankPy._rankList[RankingType.RankingTypeActivityNewZoneDoubleTwelveRank],t=e&&e.rankList&&e.rankList.ranks||[],i=[];for(var a in t){var n=t[a];i.push({info:n,config:{type:1,rankType:RankingType.RankingTypeActivityNewZoneDoubleTwelveRank,keyWord:"消费钻石"}})}return i},keyWord:"消费钻石"},{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖 励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneDoubleTwelveRank)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityNewZoneDoubleTwelveRank,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityNewZoneDoubleTwelveRank);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],GACHA_HIGH_ACHIEVMENT:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e];if(t.type==GashaponType.High){var i=t.times,a=-1!=r.timesTargeted.indexOf(t.code),n=!a&&i<=h,o=void 0;o=a?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"高级招募"+i+"次",pbMax:i,pbValue:h,status:o,rewards:t.rewards,btnFunc:function(){s.GetTimesRewards(GashaponType.High,t.code,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}}var s=g.GameMVC.heroPy,r=s.gashaponInfo[GashaponType.High],h=r.hTimes,l=g.Config.gashaponTimes(),c=[];for(var t in l)e(t);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),c},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.heroPy.GetTimesRewards(GashaponType.High,0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+g.GameMVC.heroPy.gashaponInfo[GashaponType.High].hTimes}}]}],GACHA_RACE_ACHIEVMENT:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e];if(t.type==GashaponType.Race){var i=t.times,a=-1!=r.timesTargeted.indexOf(t.code),n=!a&&i<=h,o=void 0;o=a?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"时空召唤"+i+"次",pbMax:i,pbValue:h,status:o,rewards:t.rewards,btnFunc:function(){s.GetTimesRewards(GashaponType.Race,t.code,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}}var s=g.GameMVC.heroPy,r=s.gashaponInfo[GashaponType.Race],h=r.hTimes,l=g.Config.gashaponTimes(),c=[];for(var t in l)e(t);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),c},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.heroPy.GetTimesRewards(GashaponType.Race,0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+g.GameMVC.heroPy.gashaponInfo[GashaponType.Race].hTimes}}]}],STORM_WAR_RANK:{configs:[{rankType:RankingType.RankingTypeActivityStormWarPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeActivityStormWarGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},STORM_WAR_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){var e=i(RankingType.RankingTypeActivityStormWarPlayer,{backColor:!0});return e=[{icon:"_stormWar_m_json.fbzc_icon_guanjun",rewards:JSON.parse(g.Config.constConfig().StormWarChampionAccountRewards.constValue),backColor:!0}].concat(e)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarPlayer);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityStormWarGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarGuild,function(e){i=t.topRank=e.selfRank.rank});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarGuild);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],STORM_WAR_ACHIEVE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=r[e],i=t.score,a=void 0;a=o.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=s?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"积分达到"+i,requestRank:i,status:a,rewards:t.rewards,btnFunc:function(){n.GetRewards(1,t.code,function(e){g.GameMVC.backpackPy.handleClientReward(e.clientReward),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}var n=g.GameMVC.stormWarPy,o=n.selfPlayer.targeted,s=n.selfPlayer.score,r=g.Config.stormWarRewards(),h=[];for(var t in r)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.stormWarPy.GetRewards(2,0,function(e){g.GameMVC.backpackPy.handleClientReward(e.clientReward),g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}}}]}],MANOR_RANK:{configs:[{rankType:RankingType.RankingTypeManorPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeManorGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},MANOR_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeManorPlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorPlayer);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeManorGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorGuild,function(e){i=t.topRank=e.selfRank.rank});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorGuild);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_RANK:{configs:[{rankType:RankingType.RankingTypeTribeBattlePlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeTribeBattleGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},TRIBE_BATTLE_REWARD:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattlePlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattlePlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattlePlayer);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattleGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattleGuild,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattleGuild);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_ACHIEVE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"个人奖励",getRewardList:function(){function e(e){var t=r[e];if(t.rewardsType===TribeBattleAchieveType.SelfAchieve){var i=t.goods,a=void 0;a=s.private.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"个人物资达到"+i,backColor:!0,requestRank:i,status:a,rewards:t.rewards,btnFunc:function(){n.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:t.code,oneKey:0,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}})}}var n=g.GameMVC.tribeBattlePy,t=n.battleInfo.playerInfo,o=t.playerMaxGoods,s=t.targeted,r=g.Config.tribeBattleRewards(),h=[];for(var i in r)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:0,oneKey:1,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}}},{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"公会奖励",getRewardList:function(){function e(e){var t=r[e];if(t.rewardsType===TribeBattleAchieveType.GuildAchieve){var i=t.goods,a=void 0;a=s.guild.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"公会物资达到"+i,requestRank:i,status:a,rewards:t.rewards,btnFunc:function(){n.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:t.code,oneKey:0,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}})}}var n=g.GameMVC.tribeBattlePy,t=n.battleInfo.playerInfo,o=t.guildMaxGoods,s=t.targeted,r=g.Config.tribeBattleRewards(),h=[];for(var i in r)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:0,oneKey:1,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}}}]}],PEAK_WAR_RANK_FREE:{configs:[{rankType:RankingType.RankingTypePeakWarFreedom,keyWord:"积分",title:"个人排行"}]},PEAK_WAR_RANK_HIGH:{configs:[{rankType:RankingType.RankingTypePeakWarHighLadder,title:"个人排行"}]},PEAK_WAR_REWARD_FREE:{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarFreedom,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=g.GameMVC.peakWarPy.freeInfo.rank,i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarFreedom);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"挑战奖励",notice:NT.PEAK_WAR_REWARD_FREE_TAB,getRewardList:function(){function e(e){var t=r[e],i=t.target,a=void 0;a=s.some(function(e){return e===t.code})?REWARD_STATUS.RECEIVED:i<=o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"获胜"+i+"次",requestRank:i,status:a,rewards:t.rewards,btnFunc:function(){n.FreedomGetDailyReward({code:t.code,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}})}var n=g.GameMVC.peakWarPy,t=n.freeInfo,o=t.winCount,s=t.dailyTargeted,r=g.Config.peakWarFreeReward(),h=[];for(var i in r)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.peakWarPy.FreedomGetDailyReward({code:0,cb:function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)}})}}}]},PEAK_WAR_REWARD_HIGH:{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarHighLadder,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=g.GameMVC.peakWarPy.highInfo&&g.GameMVC.peakWarPy.highInfo.hRank||0,i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarHighLadder);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]},WORLD_KING_RANK_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeServerWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeServerWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.GameMVC.worldKingPy.worldKingInfo.cWorldRank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeServerWorldKing);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){function e(e){var t=c[e],i=g.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],a=-1!=l.indexOf(t.code),n=!a&&h.hLevel>=JSON.parse(t.key)[0],o=t.code,s=void 0;s=a?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,d.push({desc:"段位达到"+i.name,backColor:!0,requestRank:o,pbMax:r,pbValue:o,status:s,rewards:t.rewards,btnFunc:function(){g.GameMVC.worldKingPy.GetReward({type:t.type,id:t.code})}})}var r=g.GameMVC.worldKingPy.worldKingInfo.cWorldRank,h=g.GameMVC.worldKingPy.worldKingInfo,l=JSON.parse(h.gotRewards),c=g.Config.worldKingRewardConfig(WorldKingRewardType.SingleLevel),d=[];for(var t in c)e(t);return d.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),d},bottomBtn:{label:"一键领取",callback:function(){g.GameMVC.worldKingPy.GetReward({type:WorldKingRewardType.SingleLevel,id:0})}}}]}],TEAM_ARENA_RANK_SINGLE:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeTeamArenaEliminateSingle,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=g.GameMVC.battleZoneArenaPy.arenaInfo.teamInfo.rank;e.topRank=t;var i=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSingleTeamArena);for(var a in i){var n=i[a];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],WORLD_BOSS_RANK_SINGLE:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypeSinglePlayerServerBossHurt)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSinglePlayerServerBossHurt);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,a=0<=r.indexOf(t),n=l[e].rankUpper,o=n<=h;i=a?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"挑战BOSS"+n+"次",requestRank:n,status:i,rewards:l[e].rewards,btnFunc:function(){s.GetPlayerTimesReward(t,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}})}var s=g.AppFacade.getInstance().retrieveProxy(g.WorldBossPy.N),t=s.playerInfo||s.temInfo.playerBossInfo,r=JSON.parse(t.timesReward),h=t.challengeTimes,l=g.Config.serverBossReward(2),c=[];for(var i in l)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){g.AppFacade.getInstance().retrieveProxy(g.WorldBossPy.N).GetPlayerTimesReward(0,function(){g.AppFacade.getInstance().updateView(g.RankMediator.N,g.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_WAR_SINGLE:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeSingleGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=g.AppFacade.getInstance().retrieveProxy(g.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}],RankingTypeNewZoneBeachRank:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeNewZoneBeachRank)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeNewZoneBeachRank,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneBeachRank);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],RankingTypeTexanPoker:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeTexanPoker)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTexanPoker,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTexanPoker);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],RankingTypeTexanPokerSix:[{type:g.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:g.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeTexanPokerSix)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=g.AppFacade.getInstance().retrieveProxy(g.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTexanPokerSix,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var a=g.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTexanPokerSix);for(var n in a){var o=a[n];i>=o.rankUpper&&i<=o.rankLower&&(t.targetRewards=JSON.parse(o.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}]},t);function t(){}function i(e,t){var i=[],a=g.Config.rankingRewardByTypeConfig(e);for(var n in a){var o=a[n],s={rankSort:o.rankUpper,rank:0<o.rankLower-o.rankUpper?9999<=o.rankLower?o.rankUpper+"-":o.rankUpper+"-"+o.rankLower:o.rankUpper,rewards:o.rewards};if(t)for(var r in t)s[r]=t[r];i.push(s)}return i.sort(function(e,t){return e.rankSort-t.rankSort}),i}g.RankConfig=e}(game=game||{}),function(e){var t,i=(t=BaseMediator,__extends(a,t),a.prototype.initSubView=function(){this.addSubView(a.SV.MAIN,e.MainRankPanel),this.addSubView(a.SV.COMMON,e.CommonRankAndRewardPanel),this.addSubView(a.SV.COMMON_RANK,e.CommonRankPanel),this.addSubView(a.SV.COMMON_REWARD,e.CommonRewardPanel),this.addSubView(a.SV.COMMON_MODEL,e.CommonRankModel)},a.prototype.hideAllContentPanel=function(){this.hideSubView(a.SV.COMMON_RANK),this.hideSubView(a.SV.COMMON_REWARD),this.hideSubView(a.SV.COMMON_MODEL)},a.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.RANK_OPEN_MAIN]},a.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.RANK_OPEN_MAIN:this.showSubView(a.SV.MAIN);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView()}},a.N="RankMediator",a.SV={MAIN:1,COMMON:2,COMMON_RANK:3,COMMON_REWARD:4,COMMON_MODEL:5},a);function a(e){return void 0===e&&(e=null),t.call(this,a.N,e)||this}e.RankMediator=i}(game=game||{}),function(a){var e=(t.registerAll=function(){(new n).register()},t);function t(){}a.RankProcessor=e;var i,n=(i=a.ProcessorBase,__extends(o,i),o.prototype.execute=function(e){var t,i=e.getBody();this.log("CommonRankP",i),a.AppFacade.getInstance().retrieveProxy(a.RankPy.N).updateRankData(i),i.rankType!=RankingType.RankingTypeNewZoneActivityQuora||(t=a.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora))&&t.updateRank(),i.rankType==RankingType.RankingTypeNewZoneActivityQuora1&&(t=a.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora1))&&t.updateRank()},o);function o(){return i.call(this,"ranking.CommonRankP",o)||this}a.CommonRankP=n}(game=game||{}),function(h){var t,e=(t=BaseProxy,__extends(i,t),i.prototype.GetRankList=function(e,t){var i=this,a="object"!=typeof e&&e||e.rankType||e.rankingType,n=null!=e.refreshInterval?e.refreshInterval:this.REFRESH_INTERVAL,o=e.isTeam,s=Utils.TimerManager.getServerTime();if(this._rankList[a]&&s-this._rankList[a].dt<n)this.log("获取旧排行榜数据  ",this._rankList[a].rankList),t&&t(this._rankList[a].rankList);else{var r=o?"GetTeamCommonRank":"GetCommonRank";a&&Utils.Socket.send("ranking",r,{rankType:a}).then(function(e){i._rankList[a]||(i._rankList[a]={}),i._rankList[a].rankList=e,i._rankList[a].dt=Utils.TimerManager.getServerTime(),t&&t(i._rankList[a].rankList)})}},i.prototype.getSelfRank=function(e){var t;return this._rankList[e]&&(t=this._rankList[e].rankList.selfRank),t},i.prototype.rankIcon=function(e){var t="";return e<=3&&(t="jjc_icon_pm_"+e+"_png"),t},i.prototype.rankBg=function(e){return 0==e?"common_img_kt_5_png":e<=3?"common_img_kt_"+e:"common_img_kt_4_png"},i.prototype.keywordBg=function(e){return 0==e?"common_img_ktsz_1_png":e<=3?"common_img_ktsz_"+e:"common_img_ktsz_4_png"},i.prototype.updateRankData=function(e){var t=e.rankType,i=e.ranks;this._rankList[t]||(this._rankList[t]={});for(var a={ranks:i,selfRank:void 0},n=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO.playerId,o=0,s=i;o<s.length;o++){var r=s[o];if(r.playerId==n||r.playerBaseInfo&&r.playerBaseInfo.playerId==n){a.selfRank=r;break}}this._rankList[t].rankList=a,this._rankList[t].dt=Utils.TimerManager.getServerTime()},i.N="RankProxy",i);function i(){var e=t.call(this,i.N)||this;return e.REFRESH_INTERVAL=15,e._rankList={},e}h.RankPy=e}(game=game||{});